/*! For license information please see ae19fm.32.25e7f24b.chunk.js.LICENSE.txt */
(self.ufnpnb83drd=self.ufnpnb83drd||[]).push([[32],{14355:(E,U,g)=>{"use strict";var N=g(14363),L=g(14371),D=g(14373);g.g.__TYPEDARRAY_POOL||(g.g.__TYPEDARRAY_POOL={UINT8:L([32,0]),UINT16:L([32,0]),UINT32:L([32,0]),INT8:L([32,0]),INT16:L([32,0]),INT32:L([32,0]),FLOAT:L([32,0]),DOUBLE:L([32,0]),DATA:L([32,0]),UINT8C:L([32,0]),BUFFER:L([32,0])});var S="undefined"!==typeof Uint8ClampedArray,u=g.g.__TYPEDARRAY_POOL;u.UINT8C||(u.UINT8C=L([32,0])),u.BUFFER||(u.BUFFER=L([32,0]));var s=u.DATA,C=u.BUFFER;function B(E){if(E){var U=E.length||E.byteLength,g=N.log2(U);s[g].push(E)}}function P(E){E=N.nextPow2(E);var U=N.log2(E),g=s[U];return g.length>0?g.pop():new ArrayBuffer(E)}function F(E){return new Uint8Array(P(E),0,E)}function f(E){return new Uint16Array(P(2*E),0,E)}function d(E){return new Uint32Array(P(4*E),0,E)}function I(E){return new Int8Array(P(E),0,E)}function y(E){return new Int16Array(P(2*E),0,E)}function h(E){return new Int32Array(P(4*E),0,E)}function V(E){return new Float32Array(P(4*E),0,E)}function e(E){return new Float64Array(P(8*E),0,E)}function x(E){return S?new Uint8ClampedArray(P(E),0,E):F(E)}function l(E){return new DataView(P(E),0,E)}U.free=function(E){if(D(E))C[N.log2(E.length)].push(E);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(E)&&(E=E.buffer),!E)return;var U=E.length||E.byteLength,g=0|N.log2(U);s[g].push(E)}},U.freeUint8=U.freeUint16=U.freeUint32=U.freeInt8=U.freeInt16=U.freeInt32=U.freeFloat32=U.freeFloat=U.freeFloat64=U.freeDouble=U.freeUint8Clamped=U.freeDataView=function(E){B(E.buffer)},U.freeArrayBuffer=B,U.freeBuffer=function(E){C[N.log2(E.length)].push(E)},U.malloc=function(E,U){if(void 0===U||"arraybuffer"===U)return P(E);switch(U){case"uint8":return F(E);case"uint16":return f(E);case"uint32":return d(E);case"int8":return I(E);case"int16":return y(E);case"int32":return h(E);case"float":case"float32":return V(E);case"double":case"float64":return e(E);case"uint8_clamped":return x(E);case"buffer":throw"Buffer not supported";case"data":case"dataview":return l(E);default:return null}return null},U.mallocArrayBuffer=P,U.mallocUint8=F,U.mallocUint16=f,U.mallocUint32=d,U.mallocInt8=I,U.mallocInt16=y,U.mallocInt32=h,U.mallocFloat32=U.mallocFloat=V,U.mallocFloat64=U.mallocDouble=e,U.mallocUint8Clamped=x,U.mallocDataView=l,U.clearCache=function(){for(var E=0;E<32;++E)u.UINT8[E].length=0,u.UINT16[E].length=0,u.UINT32[E].length=0,u.INT8[E].length=0,u.INT16[E].length=0,u.INT32[E].length=0,u.FLOAT[E].length=0,u.DOUBLE[E].length=0,u.UINT8C[E].length=0,s[E].length=0,C[E].length=0}},14457:(E,U,g)=>{E.exports=L;var N=g(13148);function L(E,U){if(!(this instanceof L))return new L(E,U);var g=N.create();N.add(g,E,U),this.base=N.min(N.create(),E,g),this.kC=N.clone(U),this.max=N.max(N.create(),E,g),this.mag=N.length(this.kC)}var D=L.prototype;D.width=function(){return this.kC[0]},D.height=function(){return this.kC[1]},D.depth=function(){return this.kC[2]},D.x0=function(){return this.base[0]},D.y0=function(){return this.base[1]},D.z0=function(){return this.base[2]},D.x1=function(){return this.max[0]},D.y1=function(){return this.max[1]},D.z1=function(){return this.max[2]},D.translate=function(E){return N.add(this.max,this.max,E),N.add(this.base,this.base,E),this},D.setPosition=function(E){return N.add(this.max,E,this.kC),N.i(this.base,E),this},D.expand=function(E){var U=N.create(),g=N.create();return N.max(U,E.max,this.max),N.min(g,E.base,this.base),N.IU(U,U,g),new L(g,U)},D.intersects=function(E){return!(E.base[0]>this.max[0])&&(!(E.base[1]>this.max[1])&&(!(E.base[2]>this.max[2])&&(!(E.max[0]<this.base[0])&&(!(E.max[1]<this.base[1])&&!(E.max[2]<this.base[2])))))},D.touches=function(E){var U=this.union(E);return null!==U&&(0==U.width()||0==U.height()||0==U.depth())},D.union=function(E){if(!this.intersects(E))return null;var U=Math.max(E.base[0],this.base[0]),g=Math.max(E.base[1],this.base[1]),N=Math.max(E.base[2],this.base[2]);return new L([U,g,N],[Math.min(E.max[0],this.max[0])-U,Math.min(E.max[1],this.max[1])-g,Math.min(E.max[2],this.max[2])-N])}},14363:(E,U)=>{"use strict";function g(E){var U=32;return(E&=-E)&&U--,65535&E&&(U-=16),16711935&E&&(U-=8),252645135&E&&(U-=4),858993459&E&&(U-=2),1431655765&E&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(E){return(E>0)-(E<0)},U.abs=function(E){var U=E>>31;return(E^U)-U},U.min=function(E,U){return U^(E^U)&-(E<U)},U.max=function(E,U){return E^(E^U)&-(E<U)},U.isPow2=function(E){return!(E&E-1)&&!!E},U.log2=function(E){var U,g;return U=(E>65535)<<4,U|=g=((E>>>=U)>255)<<3,U|=g=((E>>>=g)>15)<<2,(U|=g=((E>>>=g)>3)<<1)|(E>>>=g)>>1},U.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},U.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},U.countTrailingZeros=g,U.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},U.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},U.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var N=new Array(256);!function(E){for(var U=0;U<256;++U){var g=U,N=U,L=7;for(g>>>=1;g;g>>>=1)N<<=1,N|=1&g,--L;E[U]=N<<L&255}}(N),U.reverse=function(E){return N[255&E]<<24|N[E>>>8&255]<<16|N[E>>>16&255]<<8|N[E>>>24&255]},U.interleave2=function(E,U){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(E,U){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>U&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},U.interleave3=function(E,U,g){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2))<<2},U.deinterleave3=function(E,U){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>U&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},U.nextCombination=function(E){var U=E|E-1;return U+1|(~U&-~U)-1>>>g(E)+1}},14348:(E,U,g)=>{"use strict";E.exports=function(E,U,g){switch(arguments.length){case 1:return N=[],C(L=E,L,B,!0),N;case 2:return"function"===typeof U?C(E,E,U,!0):function(E,U){return N=[],C(E,U,B,!1),N}(E,U);case 3:return C(E,U,g,!1);default:throw new Error("box-intersect: Invalid arguments")}var L};var N,L=g(14355),D=g(14382),S=g(14395);function u(E,U){for(var g=0;g<E;++g)if(!(U[g]<=U[g+E]))return!0;return!1}function s(E,U,g,N){for(var L=0,D=0,S=0,s=E.length;S<s;++S){var C=E[S];if(!u(U,C)){for(var B=0;B<2*U;++B)g[L++]=C[B];N[D++]=S}}return D}function C(E,U,g,N){var u=E.length,C=U.length;if(!(u<=0||C<=0)){var B=E[0].length>>>1;if(!(B<=0)){var P,F=L.mallocDouble(2*B*u),f=L.mallocInt32(u);if((u=s(E,B,F,f))>0){if(1===B&&N)D.init(u),P=D.sweepComplete(B,g,0,u,F,f,0,u,F,f);else{var d=L.mallocDouble(2*B*C),I=L.mallocInt32(C);(C=s(U,B,d,I))>0&&(D.init(u+C),P=1===B?D.sweepBipartite(B,g,0,u,F,f,0,C,d,I):S(B,g,N,u,F,f,C,d,I),L.free(d),L.free(I))}L.free(F),L.free(f)}return P}}}function B(E,U){N.push([E,U])}},14401:(E,U)=>{"use strict";var g="d",N="ax",L="fp",D="es",S="rs",u="re",s="rb",C="bs",B="be",P="bb",F=[g,N,"vv",S,u,s,"ri",C,B,P,"bi"];function f(E){var U="bruteForce"+(E?"Full":"Partial"),N=[],S=F.slice();E||S.splice(3,0,L);var u=["function "+U+"("+S.join()+"){"];function s(U,L){var S=function(E,U,N){var L="bruteForce"+(E?"Red":"Blue")+(U?"Flip":"")+(N?"Full":""),S=["function ",L,"(",F.join(),"){","var ",D,"=2*",g,";"],u="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",s="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(N?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return E?S.push(u,"Q",":",s):S.push(s,"Q",":",u),N?S.push("if(y1<x0||x1<y0)continue;"):U?S.push("if(y0<=x0||x1<y0)continue;"):S.push("if(y0<x0||x1<y0)continue;"),S.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),U?S.push("yi,xi"):S.push("xi,yi"),S.push(");if(rv!==void 0)return rv;}}}"),{name:L,code:S.join("")}}(U,L,E);N.push(S.code),u.push("return "+S.name+"("+F.join()+");")}u.push("if(re-rs>be-bs){"),E?(s(!0,!1),u.push("}else{"),s(!1,!1)):(u.push("if(fp){"),s(!0,!0),u.push("}else{"),s(!0,!1),u.push("}}else{if(fp){"),s(!1,!0),u.push("}else{"),s(!1,!1),u.push("}")),u.push("}}return "+U);var C=N.join("")+u.join("");return new Function(C)()}U.partial=f(!1),U.full=f(!0)},14395:(E,U,g)=>{"use strict";E.exports=function(E,U,g,D,B,v,o,c,r){!function(E,U){var g=8*L.log2(U+1)*(E+1)|0,D=L.nextPow2(x*g);Y.length<D&&(N.free(Y),Y=N.mallocInt32(D));var S=L.nextPow2(l*g);t.length<S&&(N.free(t),t=N.mallocDouble(S))}(E,D+o);var j,Z=0,A=2*E;G(Z++,0,0,D,0,o,g?16:0,-1/0,1/0),g||G(Z++,0,0,o,0,D,1,-1/0,1/0);for(;Z>0;){var w=(Z-=1)*x,a=Y[w],J=Y[w+1],q=Y[w+2],M=Y[w+3],mE=Y[w+4],W=Y[w+5],O=Z*l,Q=t[O],R=t[O+1],n=1&W,k=!!(16&W),z=B,i=v,p=c,H=r;if(n&&(z=c,i=r,p=B,H=v),!(2&W&&J>=(q=y(E,a,J,q,z,i,R)))&&!(4&W&&(J=h(E,a,J,q,z,i,Q))>=q)){var K=q-J,X=mE-M;if(k){if(E*K*(K+X)<f){if(void 0!==(j=s.scanComplete(E,a,U,J,q,z,i,M,mE,p,H)))return j;continue}}else{if(E*Math.min(K,X)<P){if(void 0!==(j=S(E,a,U,n,J,q,z,i,M,mE,p,H)))return j;continue}if(E*K*X<F){if(void 0!==(j=s.scanBipartite(E,a,U,n,J,q,z,i,M,mE,p,H)))return j;continue}}var EE=d(E,a,J,q,z,i,Q,R);if(J<EE)if(E*(EE-J)<P){if(void 0!==(j=u(E,a+1,U,J,EE,z,i,M,mE,p,H)))return j}else if(a===E-2){if(void 0!==(j=n?s.sweepBipartite(E,U,M,mE,p,H,J,EE,z,i):s.sweepBipartite(E,U,J,EE,z,i,M,mE,p,H)))return j}else G(Z++,a+1,J,EE,M,mE,n,-1/0,1/0),G(Z++,a+1,M,mE,J,EE,1^n,-1/0,1/0);if(EE<q){var UE=C(E,a,M,mE,p,H),gE=p[A*UE+a],NE=I(E,a,UE,mE,p,H,gE);if(NE<mE&&G(Z++,a,EE,q,NE,mE,(4|n)+(k?16:0),gE,R),M<UE&&G(Z++,a,EE,q,M,UE,(2|n)+(k?16:0),Q,gE),UE+1===NE){if(void 0!==(j=k?T(E,a,U,EE,q,z,i,UE,p,H[UE]):b(E,a,U,n,EE,q,z,i,UE,p,H[UE])))return j}else if(UE<NE){var LE;if(k){if(EE<(LE=V(E,a,EE,q,z,i,gE))){var DE=I(E,a,EE,LE,z,i,gE);if(a===E-2){if(EE<DE&&void 0!==(j=s.sweepComplete(E,U,EE,DE,z,i,UE,NE,p,H)))return j;if(DE<LE&&void 0!==(j=s.sweepBipartite(E,U,DE,LE,z,i,UE,NE,p,H)))return j}else EE<DE&&G(Z++,a+1,EE,DE,UE,NE,16,-1/0,1/0),DE<LE&&(G(Z++,a+1,DE,LE,UE,NE,0,-1/0,1/0),G(Z++,a+1,UE,NE,DE,LE,1,-1/0,1/0))}}else EE<(LE=n?e(E,a,EE,q,z,i,gE):V(E,a,EE,q,z,i,gE))&&(a===E-2?j=n?s.sweepBipartite(E,U,UE,NE,p,H,EE,LE,z,i):s.sweepBipartite(E,U,EE,LE,z,i,UE,NE,p,H):(G(Z++,a+1,EE,LE,UE,NE,n,-1/0,1/0),G(Z++,a+1,UE,NE,EE,LE,1^n,-1/0,1/0)))}}}}};var N=g(14355),L=g(14363),D=g(14401),S=D.partial,u=D.full,s=g(14382),C=g(14405),B=g(14413),P=128,F=1<<22,f=1<<22,d=B("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),I=B("lo===p0",["p0"]),y=B("lo<p0",["p0"]),h=B("hi<=p0",["p0"]),V=B("lo<=p0&&p0<=hi",["p0"]),e=B("lo<p0&&p0<=hi",["p0"]),x=6,l=2,Y=N.mallocInt32(1024),t=N.mallocDouble(1024);function G(E,U,g,N,L,D,S,u,s){var C=x*E;Y[C]=U,Y[C+1]=g,Y[C+2]=N,Y[C+3]=L,Y[C+4]=D,Y[C+5]=S;var B=l*E;t[B]=u,t[B+1]=s}function b(E,U,g,N,L,D,S,u,s,C,B){var P=2*E,F=s*P,f=C[F+U];E:for(var d=L,I=L*P;d<D;++d,I+=P){var y=S[I+U],h=S[I+U+E];if(!(f<y||h<f)&&(!N||f!==y)){for(var V,e=u[d],x=U+1;x<E;++x){y=S[I+x],h=S[I+x+E];var l=C[F+x],Y=C[F+x+E];if(h<l||Y<y)continue E}if(void 0!==(V=N?g(B,e):g(e,B)))return V}}}function T(E,U,g,N,L,D,S,u,s,C){var B=2*E,P=u*B,F=s[P+U];E:for(var f=N,d=N*B;f<L;++f,d+=B){var I=S[f];if(I!==C){var y=D[d+U],h=D[d+U+E];if(!(F<y||h<F)){for(var V=U+1;V<E;++V){y=D[d+V],h=D[d+V+E];var e=s[P+V],x=s[P+V+E];if(h<e||x<y)continue E}var l=g(I,C);if(void 0!==l)return l}}}}},14405:(E,U,g)=>{"use strict";E.exports=function(E,U,g,S,u,s){if(S<=g+1)return g;var C=g,B=S,P=S+g>>>1,F=2*E,f=P,d=u[F*P+U];for(;C<B;){if(B-C<L){D(E,U,C,B,u,s),d=u[F*P+U];break}var I=B-C,y=Math.random()*I+C|0,h=u[F*y+U],V=Math.random()*I+C|0,e=u[F*V+U],x=Math.random()*I+C|0,l=u[F*x+U];h<=e?l>=e?(f=V,d=e):h>=l?(f=y,d=h):(f=x,d=l):e>=l?(f=V,d=e):l>=h?(f=y,d=h):(f=x,d=l);for(var Y=F*(B-1),t=F*f,G=0;G<F;++G,++Y,++t){var b=u[Y];u[Y]=u[t],u[t]=b}var T=s[B-1];s[B-1]=s[f],s[f]=T;for(Y=F*(B-1),t=F*(f=N(E,U,C,B-1,u,s,d)),G=0;G<F;++G,++Y,++t){b=u[Y];u[Y]=u[t],u[t]=b}T=s[B-1];if(s[B-1]=s[f],s[f]=T,P<f){for(B=f-1;C<B&&u[F*(B-1)+U]===d;)B-=1;B+=1}else{if(!(f<P))break;for(C=f+1;C<B&&u[F*C+U]===d;)C+=1}}return N(E,U,g,P,u,s,u[F*P+U])};var N=g(14413)("lo<p0",["p0"]),L=8;function D(E,U,g,N,L,D){for(var S=2*E,u=S*(g+1)+U,s=g+1;s<N;++s,u+=S)for(var C=L[u],B=s,P=S*(s-1);B>g&&L[P+U]>C;--B,P-=S){for(var F=P,f=P+S,d=0;d<S;++d,++F,++f){var I=L[F];L[F]=L[f],L[f]=I}var y=D[B];D[B]=D[B-1],D[B-1]=y}}},14413:E=>{"use strict";E.exports=function(E,g){var N="abcdef".split("").concat(g),L=[];E.indexOf("lo")>=0&&L.push("lo=e[k+n]");E.indexOf("hi")>=0&&L.push("hi=e[k+o]");return N.push(U.replace("_",L.join()).replace("$",E)),Function.apply(void 0,N)};var U="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14391:E=>{"use strict";E.exports=function(E,N){N<=4*U?g(0,N-1,E):C(0,N-1,E)};var U=32;function g(E,U,g){for(var N=2*(E+1),L=E+1;L<=U;++L){for(var D=g[N++],S=g[N++],u=L,s=N-2;u-- >E;){var C=g[s-2],B=g[s-1];if(C<D)break;if(C===D&&B<S)break;g[s]=C,g[s+1]=B,s-=2}g[s]=D,g[s+1]=S}}function N(E,U,g){U*=2;var N=g[E*=2],L=g[E+1];g[E]=g[U],g[E+1]=g[U+1],g[U]=N,g[U+1]=L}function L(E,U,g){U*=2,g[E*=2]=g[U],g[E+1]=g[U+1]}function D(E,U,g,N){U*=2,g*=2;var L=N[E*=2],D=N[E+1];N[E]=N[U],N[E+1]=N[U+1],N[U]=N[g],N[U+1]=N[g+1],N[g]=L,N[g+1]=D}function S(E,U,g,N,L){U*=2,L[E*=2]=L[U],L[U]=g,L[E+1]=L[U+1],L[U+1]=N}function u(E,U,g){U*=2;var N=g[E*=2],L=g[U];return!(N<L)&&(N!==L||g[E+1]>g[U+1])}function s(E,U,g,N){var L=N[E*=2];return L<U||L===U&&N[E+1]<g}function C(E,B,P){var F=(B-E+1)/6|0,f=E+F,d=B-F,I=E+B>>1,y=I-F,h=I+F,V=f,e=y,x=I,l=h,Y=d,t=E+1,G=B-1,b=0;u(V,e,P)&&(b=V,V=e,e=b),u(l,Y,P)&&(b=l,l=Y,Y=b),u(V,x,P)&&(b=V,V=x,x=b),u(e,x,P)&&(b=e,e=x,x=b),u(V,l,P)&&(b=V,V=l,l=b),u(x,l,P)&&(b=x,x=l,l=b),u(e,Y,P)&&(b=e,e=Y,Y=b),u(e,x,P)&&(b=e,e=x,x=b),u(l,Y,P)&&(b=l,l=Y,Y=b);for(var T=P[2*e],v=P[2*e+1],o=P[2*l],c=P[2*l+1],r=2*V,j=2*x,Z=2*Y,A=2*f,w=2*I,a=2*d,J=0;J<2;++J){var q=P[r+J],M=P[j+J],mE=P[Z+J];P[A+J]=q,P[w+J]=M,P[a+J]=mE}L(y,E,P),L(h,B,P);for(var W=t;W<=G;++W)if(s(W,T,v,P))W!==t&&N(W,t,P),++t;else if(!s(W,o,c,P))for(;;){if(s(G,o,c,P)){s(G,T,v,P)?(D(W,t,G,P),++t,--G):(N(W,G,P),--G);break}if(--G<W)break}S(E,t-1,T,v,P),S(B,G+1,o,c,P),t-2-E<=U?g(E,t-2,P):C(E,t-2,P),B-(G+2)<=U?g(G+2,B,P):C(G+2,B,P),G-t<=U?g(t,G,P):C(t,G,P)}},14382:(E,U,g)=>{"use strict";E.exports={init:function(E){var U=L.nextPow2(E);s.length<U&&(N.free(s),s=N.mallocInt32(U));C.length<U&&(N.free(C),C=N.mallocInt32(U));B.length<U&&(N.free(B),B=N.mallocInt32(U));P.length<U&&(N.free(P),P=N.mallocInt32(U));F.length<U&&(N.free(F),F=N.mallocInt32(U));f.length<U&&(N.free(f),f=N.mallocInt32(U));var g=8*U;d.length<g&&(N.free(d),d=N.mallocDouble(g))},sweepBipartite:function(E,U,g,N,L,u,F,f,h,V){for(var e=0,x=2*E,l=E-1,Y=x-1,t=g;t<N;++t){var G=u[t],b=x*t;d[e++]=L[b+l],d[e++]=-(G+1),d[e++]=L[b+Y],d[e++]=G}for(t=F;t<f;++t){G=V[t]+S;var T=x*t;d[e++]=h[T+l],d[e++]=-G,d[e++]=h[T+Y],d[e++]=G}var v=e>>>1;D(d,v);var o=0,c=0;for(t=0;t<v;++t){var r=0|d[2*t+1];if(r>=S)I(B,P,c--,r=r-S|0);else if(r>=0)I(s,C,o--,r);else if(r<=-S){r=-r-S|0;for(var j=0;j<o;++j){if(void 0!==(Z=U(s[j],r)))return Z}y(B,P,c++,r)}else{r=-r-1|0;for(j=0;j<c;++j){var Z;if(void 0!==(Z=U(r,B[j])))return Z}y(s,C,o++,r)}}},sweepComplete:function(E,U,g,N,L,S,u,h,V,e){for(var x=0,l=2*E,Y=E-1,t=l-1,G=g;G<N;++G){var b=S[G]+1<<1,T=l*G;d[x++]=L[T+Y],d[x++]=-b,d[x++]=L[T+t],d[x++]=b}for(G=u;G<h;++G){b=e[G]+1<<1;var v=l*G;d[x++]=V[v+Y],d[x++]=1|-b,d[x++]=V[v+t],d[x++]=1|b}var o=x>>>1;D(d,o);var c=0,r=0,j=0;for(G=0;G<o;++G){var Z=0|d[2*G+1],A=1&Z;if(G<o-1&&Z>>1===d[2*G+3]>>1&&(A=2,G+=1),Z<0){for(var w=-(Z>>1)-1,a=0;a<j;++a){if(void 0!==(J=U(F[a],w)))return J}if(0!==A)for(a=0;a<c;++a){if(void 0!==(J=U(s[a],w)))return J}if(1!==A)for(a=0;a<r;++a){var J;if(void 0!==(J=U(B[a],w)))return J}0===A?y(s,C,c++,w):1===A?y(B,P,r++,w):2===A&&y(F,f,j++,w)}else{w=(Z>>1)-1;0===A?I(s,C,c--,w):1===A?I(B,P,r--,w):2===A&&I(F,f,j--,w)}}},scanBipartite:function(E,U,g,N,L,u,B,P,F,f,h,V){var e=0,x=2*E,l=U,Y=U+E,t=1,G=1;N?G=S:t=S;for(var b=L;b<u;++b){var T=b+t,v=x*b;d[e++]=B[v+l],d[e++]=-T,d[e++]=B[v+Y],d[e++]=T}for(b=F;b<f;++b){T=b+G;var o=x*b;d[e++]=h[o+l],d[e++]=-T}var c=e>>>1;D(d,c);var r=0;for(b=0;b<c;++b){var j=0|d[2*b+1];if(j<0){var Z=!1;if((T=-j)>=S?(Z=!N,T-=S):(Z=!!N,T-=1),Z)y(s,C,r++,T);else{var A=V[T],w=x*T,a=h[w+U+1],J=h[w+U+1+E];E:for(var q=0;q<r;++q){var M=s[q],mE=x*M;if(!(J<B[mE+U+1]||B[mE+U+1+E]<a)){for(var W=U+2;W<E;++W)if(h[w+W+E]<B[mE+W]||B[mE+W+E]<h[w+W])continue E;var O,Q=P[M];if(void 0!==(O=N?g(A,Q):g(Q,A)))return O}}}}else I(s,C,r--,j-t)}},scanComplete:function(E,U,g,N,L,u,C,B,P,F,f){for(var I=0,y=2*E,h=U,V=U+E,e=N;e<L;++e){var x=e+S,l=y*e;d[I++]=u[l+h],d[I++]=-x,d[I++]=u[l+V],d[I++]=x}for(e=B;e<P;++e){x=e+1;var Y=y*e;d[I++]=F[Y+h],d[I++]=-x}var t=I>>>1;D(d,t);var G=0;for(e=0;e<t;++e){var b=0|d[2*e+1];if(b<0){if((x=-b)>=S)s[G++]=x-S;else{var T=f[x-=1],v=y*x,o=F[v+U+1],c=F[v+U+1+E];E:for(var r=0;r<G;++r){var j=s[r],Z=C[j];if(Z===T)break;var A=y*j;if(!(c<u[A+U+1]||u[A+U+1+E]<o)){for(var w=U+2;w<E;++w)if(F[v+w+E]<u[A+w]||u[A+w+E]<F[v+w])continue E;var a=g(Z,T);if(void 0!==a)return a}}}}else{for(x=b-S,r=G-1;r>=0;--r)if(s[r]===x){for(w=r+1;w<G;++w)s[w-1]=s[w];break}--G}}}};var N=g(14355),L=g(14363),D=g(14391),S=1<<28,u=1024,s=N.mallocInt32(u),C=N.mallocInt32(u),B=N.mallocInt32(u),P=N.mallocInt32(u),F=N.mallocInt32(u),f=N.mallocInt32(u),d=N.mallocDouble(8192);function I(E,U,g,N){var L=U[N],D=E[g-1];E[L]=D,U[D]=L}function y(E,U,g,N){E[g]=N,U[N]=g}},14371:E=>{"use strict";function U(E,g,N){var L=0|E[N];if(L<=0)return[];var D,S=new Array(L);if(N===E.length-1)for(D=0;D<L;++D)S[D]=g;else for(D=0;D<L;++D)S[D]=U(E,g,N+1);return S}E.exports=function(E,g){switch("undefined"===typeof g&&(g=0),typeof E){case"number":if(E>0)return function(E,U){var g,N;for(g=new Array(E),N=0;N<E;++N)g[N]=U;return g}(0|E,g);break;case"object":if("number"===typeof E.length)return U(E,g,0)}return[]}},14316:(E,U,g)=>{E.exports=function(){var E=this;this.components={},this.comps=this.components;var U=this.components,g=1,L={},D=[],S=[],u={timeout:!1,removals:[],multiComps:[]};function s(E,g){var N=U[g],D=L[g],S=D.hash[E];S&&(D.remove(E),N.mg&&(N.multi?(S.forEach((U=>{U&&N.mg(E,U)})),S.length=0):N.mg(E,S)),u.removals.push(D),C())}function C(){u.timeout||(u.timeout=!0,setTimeout(B,1))}function B(){u.timeout=!1,P()}function P(){u.multiComps.length&&function(E){for(var U=0;U<E.length;U++){var{entID:g,data:N}=E[U],L=N.hash[g];if(L){for(var D=0;D<L.length;D++)L[D]||(L.splice(D,1),D--);0===L.length&&(N.remove(g),u.removals.push(N))}}E.length=0}(u.multiComps),u.removals.length&&function(E){for(var U=0;U<E.length;U++){E[U].flush()}E.length=0}(u.removals)}this.uP=L,this._systems=D,this._renderSystems=S,this.pC=function(U){var N=g++;return Array.isArray(U)&&U.forEach((U=>E.rs(N,U))),N},this.deleteEntity=function(U){return Object.keys(L).forEach((E=>{L[E].hash[U]&&s(U,E)})),E},this.PB=function(E){if(!E)throw new Error("Missing component definition");var g=E.name;if(!g)throw new Error("Component definition must have a name property.");if("string"!==typeof g)throw new Error("Component name must be a string.");if(""===g)throw new Error("Component name must be a non-empty string.");if(L[g])throw new Error(`Component ${g} already exists.`);var u={};return u.name=g,u.multi=!!E.multi,u.order=isNaN(E.order)?99:E.order,u.stateConstructor=E.stateConstructor||null,u.state=E.state||{},u.vu=E.vu||null,u.mg=E.mg||null,u.system=E.system||null,u.Au=E.Au||null,U[g]=u,L[g]=new N,L[g]._pendingMultiCleanup=!1,L[g]._multiCleanupIDs=u.multi?[]:null,u.system&&(D.push(g),D.sort(((E,g)=>U[E].order-U[g].order))),u.Au&&(S.push(g),S.sort(((E,g)=>U[E].order-U[g].order))),g},this.overwriteComponent=function(E,g){var N=U[E];if(!N)throw new Error(`Unknown component: ${E}`);if(!g)throw new Error("Missing component definition");if(N.name!==g.name)throw new Error("Overwriting component must use the same name property.");var u={};u.name=E,u.multi=!!g.multi,u.order=isNaN(g.order)?99:g.order,u.state=g.state||{},u.vu=g.vu||null,u.mg=g.mg||null,u.system=g.system||null,u.Au=g.Au||null,U[E]=u,L[E]._pendingMultiCleanup=!1,L[E]._multiCleanupIDs=u.multi?[]:null;var s=D.indexOf(E);u.system&&s<0&&D.push(E),!u.system&&s>=0&&D.splice(s,1),D.sort(((E,g)=>U[E].order-U[g].order));var C=S.indexOf(E);u.Au&&C<0&&S.push(E),!u.Au&&C>=0&&S.splice(C,1),S.sort(((E,g)=>U[E].order-U[g].order));var B=u.state;return this.rC(E).forEach((E=>{for(var U in B)U in E||(E[U]=B[U]);u.vu&&u.vu(E.ju,E)})),E},this.deleteComponent=function(g){var N=L[g];if(!N)throw new Error(`Unknown component: ${g}`);N.flush(),N.list.forEach((E=>{E&&s(E.ju||E[0].ju,g)}));var u=D.indexOf(g),C=S.indexOf(g);return u>-1&&D.splice(u,1),C>-1&&S.splice(C,1),L[g].dispose(),delete L[g],delete U[g],E},this.rs=function(E,g,N){var D,S=U[g],u=L[g];if(!u)throw new Error(`Unknown component: ${g}.`);if(u.hash[E]&&!S.multi)throw new Error(`Entity ${E} already has component: ${g}.`);if(S.stateConstructor){if(!(D=new S.stateConstructor).hasOwnProperty("ju"))throw new Error(`Component ${S.name} stateConstructor type does not have property __id`)}else D=Object.assign({},{ju:E},S.state,N);if(D.ju=E,S.multi){var s=u.hash[E];s||(s=[],u.add(E,s)),s.push(D)}else u.add(E,D);return S.vu&&S.vu(E,D),this},this.Os=function(E,U){var g=L[U];if(!g)throw new Error(`Unknown component: ${U}.`);return!!g.hash[E]},this.ws=function(U,g){if(!L[g])throw new Error(`Unknown component: ${g}.`);return s(U,g),E},this.getState=function(E,U){var g=L[U];if(!g)throw new Error(`Unknown component: ${U}.`);return g.hash[E]},this.rC=function(E){var U=L[E];if(!U)throw new Error(`Unknown component: ${E}.`);return P(),U.list},this.iF=function(E){if(!L[E])throw new Error(`Unknown component: ${E}.`);var U=L[E].hash;return E=>U[E]},this.KF=function(E){if(!L[E])throw new Error(`Unknown component: ${E}.`);var U=L[E].hash;return E=>!!U[E]},this.Fu=function(g){P();for(var N=0;N<D.length;N++){var S=D[N],u=U[S],s=L[S];u.system(g,s.list),P()}return E},this.render=function(g){P();for(var N=0;N<S.length;N++){var D=S[N],u=U[D],s=L[D];u.Au(g,s.list),P()}return E},this.removeMultiComponent=function(g,N,D){var S=U[N],s=L[N];if(!s)throw new Error(`Unknown component: ${N}.`);if(!S.multi)throw new Error("removeMultiComponent called on non-multi component");return function(E,U,g,N){var L=g.hash[E];if(L){var D=L[N];D&&(L[N]=null,U.mg&&U.mg(E,D),u.multiComps.push({entID:E,data:g}),C())}}(g,S,s,D),E}};var N=g(14320)},14320:E=>{function U(E,U){var g=E._map[U];if(delete E.hash[U],delete E._map[U],g===E.list.length-1)E.list.pop();else{var N=E.list.pop();if(E.list[g]=N,null===N||null===N[0]){var L=E.list.length;for(var D in E._map)if(E._map[D]===L)return void(E._map[D]=g)}else{var S=N.ju||N[0].ju;E._map[S]=g}}}E.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(E,U){if("number"===typeof this._map[E]){var g=this._map[E];this.hash[E]=U,this.list[g]=U}else this._map[E]=this.list.length,this.hash[E]=U,this.list.push(U)}remove(E){var U=this._map[E];this.hash[E]=null,this.list[U]=null,this._pendingRemovals.push(E)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var E=0;E<this._pendingRemovals.length;E++){var g=this._pendingRemovals[E];null===this.hash[g]&&U(this,g)}this._pendingRemovals.length=0}}},14285:E=>{"use strict";var U,g="object"===typeof Reflect?Reflect:null,N=function(E,U,g){return Function.prototype.apply.call(E,U,g)};U=g&&"function"===typeof g.ownKeys?g.ownKeys:Object.getOwnPropertySymbols?function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:function(E){return Object.getOwnPropertyNames(E)};var L=Number.isNaN||function(E){return E!==E};function D(){D.init.call(this)}E.exports=D,E.exports.once=function(E,U){return new Promise((function(g,N){function L(g){E.removeListener(U,D),N(g)}function D(){"function"===typeof E.removeListener&&E.removeListener("error",L),g([].slice.call(arguments))}I(E,U,D,{once:!0}),"error"!==U&&function(E,U,g){"function"===typeof E.on&&I(E,"error",U,g)}(E,L,{once:!0})}))},D.EventEmitter=D,D.prototype._events=void 0,D.prototype._eventsCount=0,D.prototype._maxListeners=void 0;var S=10;function u(E){if("function"!==typeof E)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}function s(E){return void 0===E._maxListeners?D.defaultMaxListeners:E._maxListeners}function C(E,U,g,N){var L,D,S,C;if(u(g),void 0===(D=E._events)?(D=E._events=Object.create(null),E._eventsCount=0):(void 0!==D.newListener&&(E.emit("newListener",U,g.listener?g.listener:g),D=E._events),S=D[U]),void 0===S)S=D[U]=g,++E._eventsCount;else if("function"===typeof S?S=D[U]=N?[g,S]:[S,g]:N?S.unshift(g):S.push(g),(L=s(E))>0&&S.length>L&&!S.warned){S.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+S.length+" "+String(U)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.NU=E,B.type=U,B.count=S.length,C=B,console&&console.warn&&console.warn(C)}return E}function B(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function P(E,U,g){var N={fired:!1,wrapFn:void 0,target:E,type:U,listener:g},L=B.bind(N);return L.listener=g,N.wrapFn=L,L}function F(E,U,g){var N=E._events;if(void 0===N)return[];var L=N[U];return void 0===L?[]:"function"===typeof L?g?[L.listener||L]:[L]:g?function(E){for(var U=new Array(E.length),g=0;g<U.length;++g)U[g]=E[g].listener||E[g];return U}(L):d(L,L.length)}function f(E){var U=this._events;if(void 0!==U){var g=U[E];if("function"===typeof g)return 1;if(void 0!==g)return g.length}return 0}function d(E,U){for(var g=new Array(U),N=0;N<U;++N)g[N]=E[N];return g}function I(E,U,g,N){if("function"===typeof E.on)N.once?E.once(U,g):E.on(U,g);else{if("function"!==typeof E.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E);E.addEventListener(U,(function L(D){N.once&&E.removeEventListener(U,L),g(D)}))}}Object.defineProperty(D,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(E){if("number"!==typeof E||E<0||L(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");S=E}}),D.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},D.prototype.setMaxListeners=function(E){if("number"!==typeof E||E<0||L(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this},D.prototype.getMaxListeners=function(){return s(this)},D.prototype.emit=function(E){for(var U=[],g=1;g<arguments.length;g++)U.push(arguments[g]);var L="error"===E,D=this._events;if(void 0!==D)L=L&&void 0===D.error;else if(!L)return!1;if(L){var S;if(U.length>0&&(S=U[0]),S instanceof Error)throw S;var u=new Error("Unhandled error."+(S?" ("+S.message+")":""));throw u.context=S,u}var s=D[E];if(void 0===s)return!1;if("function"===typeof s)N(s,this,U);else{var C=s.length,B=d(s,C);for(g=0;g<C;++g)N(B[g],this,U)}return!0},D.prototype.addListener=function(E,U){return C(this,E,U,!1)},D.prototype.on=D.prototype.addListener,D.prototype.prependListener=function(E,U){return C(this,E,U,!0)},D.prototype.once=function(E,U){return u(U),this.on(E,P(this,E,U)),this},D.prototype.prependOnceListener=function(E,U){return u(U),this.prependListener(E,P(this,E,U)),this},D.prototype.removeListener=function(E,U){var g,N,L,D,S;if(u(U),void 0===(N=this._events))return this;if(void 0===(g=N[E]))return this;if(g===U||g.listener===U)0===--this._eventsCount?this._events=Object.create(null):(delete N[E],N.removeListener&&this.emit("removeListener",E,g.listener||U));else if("function"!==typeof g){for(L=-1,D=g.length-1;D>=0;D--)if(g[D]===U||g[D].listener===U){S=g[D].listener,L=D;break}if(L<0)return this;0===L?g.shift():function(E,U){for(;U+1<E.length;U++)E[U]=E[U+1];E.pop()}(g,L),1===g.length&&(N[E]=g[0]),void 0!==N.removeListener&&this.emit("removeListener",E,S||U)}return this},D.prototype.off=D.prototype.removeListener,D.prototype.LU=function(E){var U,g,N;if(void 0===(g=this._events))return this;if(void 0===g.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==g[E]&&(0===--this._eventsCount?this._events=Object.create(null):delete g[E]),this;if(0===arguments.length){var L,D=Object.keys(g);for(N=0;N<D.length;++N)"removeListener"!==(L=D[N])&&this.LU(L);return this.LU("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(U=g[E]))this.removeListener(E,U);else if(void 0!==U)for(N=U.length-1;N>=0;N--)this.removeListener(E,U[N]);return this},D.prototype.listeners=function(E){return F(this,E,!0)},D.prototype.rawListeners=function(E){return F(this,E,!1)},D.listenerCount=function(E,U){return"function"===typeof E.listenerCount?E.listenerCount(U):f.call(E,U)},D.prototype.listenerCount=f,D.prototype.eventNames=function(){return this._eventsCount>0?U(this._events):[]}},14604:E=>{"use strict";E.exports=function(E,U,g,N,L,D){var S=+U[0],u=+U[1],s=+U[2],C=+g[0],B=+g[1],P=+g[2],F=Math.sqrt(C*C+B*B+P*P);if(0===F)throw new Error("Can't raycast along a zero vector");return function(E,U,g,N,L,D,S,u,s,C){for(var B=0,P=Math.floor,F=0|P(U),f=0|P(g),d=0|P(N),I=L>0?1:-1,y=D>0?1:-1,h=S>0?1:-1,V=Math.abs(1/L),e=Math.abs(1/D),x=Math.abs(1/S),l=V<1/0?V*(I>0?F+1-U:U-F):1/0,Y=e<1/0?e*(y>0?f+1-g:g-f):1/0,t=x<1/0?x*(h>0?d+1-N:N-d):1/0,G=-1;B<=u;){var b=E(F,f,d);if(b)return s&&(s[0]=U+B*L,s[1]=g+B*D,s[2]=N+B*S),C&&(C[0]=C[1]=C[2]=0,0===G&&(C[0]=-I),1===G&&(C[1]=-y),2===G&&(C[2]=-h)),b;l<Y?l<t?(F+=I,B=l,l+=V,G=0):(d+=h,B=t,t+=x,G=2):Y<t?(f+=y,B=Y,Y+=e,G=1):(d+=h,B=t,t+=x,G=2)}return s&&(s[0]=U+B*L,s[1]=g+B*D,s[2]=N+B*S),C&&(C[0]=C[1]=C[2]=0),0}(E,S,u,s,C/=F,B/=F,P/=F,N="undefined"===typeof N?64:+N,L,D)}},14625:(E,U,g)=>{"use strict";g.d(U,{e:()=>D});var N=g(14285);function L(){this.pP=!1,this.stopPropagation=!1,this.HP=!1,this.disabled=!1}class D{constructor(E,U){this.version="0.7.0";var g=Object.assign({},new L,U||{});this.element=E||document,this.pP=!!g.pP,this.stopPropagation=!!g.stopPropagation,this.HP=!!g.HP,this.disabled=!!g.disabled,this.filterEvents=(E,U)=>!0,this.down=new N.EventEmitter,this.up=new N.EventEmitter,this.state={},this.GC={dx:0,dy:0,MF:0,tC:0,mf:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?u(this):document.addEventListener("DOMContentLoaded",(E=>{u(this)}),{once:!0})}bind(E){for(var U=arguments.length,g=new Array(U>1?U-1:0),N=1;N<U;N++)g[N-1]=arguments[N];g.forEach((U=>{var g=this._keyBindmap[U]||[];g.includes(E)||(g.push(E),this._keyBindmap[U]=g)})),this.state[E]=!!this.state[E],this.pressCount[E]=this.pressCount[E]||0,this.releaseCount[E]=this.releaseCount[E]||0}unbind(E){for(var U in this._keyBindmap){var g=this._keyBindmap[U],N=g.indexOf(E);N>-1&&g.splice(N,1)}}getBindings(){var E={};for(var U in this._keyBindmap){this._keyBindmap[U].forEach((g=>{E[g]=E[g]||[],E[g].push(U)}))}return E}Fu(){S(this.GC),S(this.pressCount),S(this.releaseCount)}}function S(E){for(var U in E)E[U]=0}function u(E){window.addEventListener("keydown",d.bind(null,E,!0),!1),window.addEventListener("keyup",d.bind(null,E,!1),!1);var U={passive:!0};E.element.addEventListener("touchstart",P.bind(void 0,E),{passive:!1}),E.element.addEventListener("touchend",f.bind(void 0,E),U),E.element.addEventListener("mousedown",I.bind(null,E,!0),U),window.document.addEventListener("mouseup",I.bind(null,E,!1),U),E.element.addEventListener("touchmove",y.bind(null,E),U),E.element.addEventListener("mousemove",y.bind(null,E),U),window.PointerEvent,E.element.addEventListener("wheel",h.bind(null,E),U),E.element.addEventListener("contextmenu",V.bind(null,E),!1),window.addEventListener("blur",e.bind(null,E),!1)}var s=0,C=0,B=null;function P(E,U){U.preventDefault(),F(U)}function F(E){let U=!1;for(let g=0;g<E.touches.length;++g)if(E.touches[g].identifier===B){U=!0;break}if(!U){const U=E.changedTouches[0];s=U.clientX,C=U.clientY,B=U.identifier}}function f(E,U){for(var g=U.changedTouches,N=0;N<g.length;++N)g[N].identifier===B&&(B=null)}function d(E,U,g){x(g.code,U,E,g)}function I(E,U,g){if("pointerId"in g)if(U){if(null!==E._touches.currID)return;E._touches.currID=g.pointerId}else{if(E._touches.currID!==g.pointerId)return;E._touches.currID=null}return x("Mouse"+("button"in g?g.button+1:1),U,E,g),!1}function y(E,U){var g=U.movementX||U.mozMovementX||0,N=U.movementY||U.mozMovementY||0;if(U.touches&&0===(g|N)){var L=function(E){F(E);for(let U=0;U<E.changedTouches.length;++U)if(E.changedTouches[U].identifier==B){const g=E.changedTouches[U],N=[g.clientX-s,g.clientY-C];return s=g.clientX,C=g.clientY,N}return console.error(`Did not find touch id ${B}`),[0,0]}(U);g=L[0],N=L[1]}E.GC.dx+=g,E.GC.dy+=N}function h(E,U){var g=1;switch(U.deltaMode){case 0:g=1;break;case 1:g=12;break;case 2:g=E.element.clientHeight||window.innerHeight}E.GC.MF+=(U.deltaX||0)*g,E.GC.tC+=(U.deltaY||0)*g,E.GC.mf+=(U.deltaZ||0)*g}function V(E,U){if(!E.HP)return U.preventDefault(),!1}function e(E){for(var U in E._keyStates)E._keyStates[U]&&(/^Mouse\d/.test(U)||x(U,!1,E,{code:U,note:"w9bennuxom",preventDefault:()=>{},stopPropagation:()=>{}}))}function x(E,U,g,N){var L=g._keyBindmap[E];L&&(l(g._keyStates[E],U)&&(g._keyStates[E]=U,L.forEach((E=>{(!g.filterEvents||g.filterEvents(N,E))&&function(E,U,g,N){var L=U?g.pressCount:g.releaseCount;L[E]=(L[E]||0)+1;var D=g._bindPressCount[E]||0;(D+=U?1:-1)<0&&(D=0);g._bindPressCount[E]=D;var S=g.state[E];if(l(S,D)){g.state[E]=D>0;var u=U?g.down:g.up;g.disabled||u.emit(E,N)}}(E,U,g,N)}))),"button"in N||(g.pP&&!N.defaultPrevented&&N.preventDefault(),g.stopPropagation&&N.stopPropagation()))}function l(E,U){return E?!U:U}},13224:E=>{E.exports=function(E,U,g){return E[0]=U[0]+g[0],E[1]=U[1]+g[1],E[2]=U[2]+g[2],E}},13178:(E,U,g)=>{E.exports=function(E,U){var g=N(E[0],E[1],E[2]),S=N(U[0],U[1],U[2]);L(g,g),L(S,S);var u=D(g,S);return u>1?0:Math.acos(u)};var N=g(13185),L=g(13189),D=g(13198)},13271:E=>{E.exports=function(E,U){return E[0]=Math.ceil(U[0]),E[1]=Math.ceil(U[1]),E[2]=Math.ceil(U[2]),E}},13173:E=>{E.exports=function(E){var U=new Float32Array(3);return U[0]=E[0],U[1]=E[1],U[2]=E[2],U}},13207:E=>{E.exports=function(E,U){return E[0]=U[0],E[1]=U[1],E[2]=U[2],E}},13164:E=>{E.exports=function(){var E=new Float32Array(3);return E[0]=0,E[1]=0,E[2]=0,E}},13331:E=>{E.exports=function(E,U,g){var N=U[0],L=U[1],D=U[2],S=g[0],u=g[1],s=g[2];return E[0]=L*s-D*u,E[1]=D*S-N*s,E[2]=N*u-L*S,E}},13283:(E,U,g)=>{E.exports=g(13281)},13281:E=>{E.exports=function(E,U){var g=U[0]-E[0],N=U[1]-E[1],L=U[2]-E[2];return Math.sqrt(g*g+N*N+L*L)}},13258:(E,U,g)=>{E.exports=g(13256)},13256:E=>{E.exports=function(E,U,g){return E[0]=U[0]/g[0],E[1]=U[1]/g[1],E[2]=U[2]/g[2],E}},13198:E=>{E.exports=function(E,U){return E[0]*U[0]+E[1]*U[1]+E[2]*U[2]}},13155:E=>{E.exports=1e-6},13217:(E,U,g)=>{E.exports=function(E,U){var g=E[0],L=E[1],D=E[2],S=U[0],u=U[1],s=U[2];return Math.abs(g-S)<=N*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(L-u)<=N*Math.max(1,Math.abs(L),Math.abs(u))&&Math.abs(D-s)<=N*Math.max(1,Math.abs(D),Math.abs(s))};var N=g(13155)},13219:E=>{E.exports=function(E,U){return E[0]===U[0]&&E[1]===U[1]&&E[2]===U[2]}},13268:E=>{E.exports=function(E,U){return E[0]=Math.floor(U[0]),E[1]=Math.floor(U[1]),E[2]=Math.floor(U[2]),E}},13396:(E,U,g)=>{E.exports=function(E,U,g,L,D,S){var u,s;U||(U=3);g||(g=0);s=L?Math.min(L*U+g,E.length):E.length;for(u=g;u<s;u+=U)N[0]=E[u],N[1]=E[u+1],N[2]=E[u+2],D(N,N,S),E[u]=N[0],E[u+1]=N[1],E[u+2]=N[2];return E};var N=g(13164)()},13185:E=>{E.exports=function(E,U,g){var N=new Float32Array(3);return N[0]=E,N[1]=U,N[2]=g,N}},13148:(E,U,g)=>{E.exports={EPSILON:g(13155),create:g(13164),clone:g(13173),angle:g(13178),Nu:g(13185),i:g(13207),set:g(13211),equals:g(13217),exactEquals:g(13219),add:g(13224),IU:g(13227),sub:g(13235),multiply:g(13241),mul:g(13250),divide:g(13256),div:g(13258),min:g(13260),max:g(13263),floor:g(13268),ceil:g(13271),round:g(13275),scale:g(13277),Lu:g(13279),distance:g(13281),j:g(13283),squaredDistance:g(13288),sqrDist:g(13290),length:g(13293),len:g(13299),squaredLength:g(13303),Du:g(13306),negate:g(13313),inverse:g(13322),normalize:g(13189),dot:g(13198),cross:g(13331),Eu:g(13340),random:g(13349),transformMat4:g(13353),transformMat3:g(13359),transformQuat:g(13365),Su:g(13372),uu:g(13381),su:g(13387),forEach:g(13396)}},13322:E=>{E.exports=function(E,U){return E[0]=1/U[0],E[1]=1/U[1],E[2]=1/U[2],E}},13299:(E,U,g)=>{E.exports=g(13293)},13293:E=>{E.exports=function(E){var U=E[0],g=E[1],N=E[2];return Math.sqrt(U*U+g*g+N*N)}},13340:E=>{E.exports=function(E,U,g,N){var L=U[0],D=U[1],S=U[2];return E[0]=L+N*(g[0]-L),E[1]=D+N*(g[1]-D),E[2]=S+N*(g[2]-S),E}},13263:E=>{E.exports=function(E,U,g){return E[0]=Math.max(U[0],g[0]),E[1]=Math.max(U[1],g[1]),E[2]=Math.max(U[2],g[2]),E}},13260:E=>{E.exports=function(E,U,g){return E[0]=Math.min(U[0],g[0]),E[1]=Math.min(U[1],g[1]),E[2]=Math.min(U[2],g[2]),E}},13250:(E,U,g)=>{E.exports=g(13241)},13241:E=>{E.exports=function(E,U,g){return E[0]=U[0]*g[0],E[1]=U[1]*g[1],E[2]=U[2]*g[2],E}},13313:E=>{E.exports=function(E,U){return E[0]=-U[0],E[1]=-U[1],E[2]=-U[2],E}},13189:E=>{E.exports=function(E,U){var g=U[0],N=U[1],L=U[2],D=g*g+N*N+L*L;D>0&&(D=1/Math.sqrt(D),E[0]=U[0]*D,E[1]=U[1]*D,E[2]=U[2]*D);return E}},13349:E=>{E.exports=function(E,U){U=U||1;var g=2*Math.random()*Math.PI,N=2*Math.random()-1,L=Math.sqrt(1-N*N)*U;return E[0]=Math.cos(g)*L,E[1]=Math.sin(g)*L,E[2]=N*U,E}},13372:E=>{E.exports=function(E,U,g,N){var L=g[1],D=g[2],S=U[1]-L,u=U[2]-D,s=Math.sin(N),C=Math.cos(N);return E[0]=U[0],E[1]=L+S*C-u*s,E[2]=D+S*s+u*C,E}},13381:E=>{E.exports=function(E,U,g,N){var L=g[0],D=g[2],S=U[0]-L,u=U[2]-D,s=Math.sin(N),C=Math.cos(N);return E[0]=L+u*s+S*C,E[1]=U[1],E[2]=D+u*C-S*s,E}},13387:E=>{E.exports=function(E,U,g,N){var L=g[0],D=g[1],S=U[0]-L,u=U[1]-D,s=Math.sin(N),C=Math.cos(N);return E[0]=L+S*C-u*s,E[1]=D+S*s+u*C,E[2]=U[2],E}},13275:E=>{E.exports=function(E,U){return E[0]=Math.round(U[0]),E[1]=Math.round(U[1]),E[2]=Math.round(U[2]),E}},13277:E=>{E.exports=function(E,U,g){return E[0]=U[0]*g,E[1]=U[1]*g,E[2]=U[2]*g,E}},13279:E=>{E.exports=function(E,U,g,N){return E[0]=U[0]+g[0]*N,E[1]=U[1]+g[1]*N,E[2]=U[2]+g[2]*N,E}},13211:E=>{E.exports=function(E,U,g,N){return E[0]=U,E[1]=g,E[2]=N,E}},13290:(E,U,g)=>{E.exports=g(13288)},13306:(E,U,g)=>{E.exports=g(13303)},13288:E=>{E.exports=function(E,U){var g=U[0]-E[0],N=U[1]-E[1],L=U[2]-E[2];return g*g+N*N+L*L}},13303:E=>{E.exports=function(E){var U=E[0],g=E[1],N=E[2];return U*U+g*g+N*N}},13235:(E,U,g)=>{E.exports=g(13227)},13227:E=>{E.exports=function(E,U,g){return E[0]=U[0]-g[0],E[1]=U[1]-g[1],E[2]=U[2]-g[2],E}},13359:E=>{E.exports=function(E,U,g){var N=U[0],L=U[1],D=U[2];return E[0]=N*g[0]+L*g[3]+D*g[6],E[1]=N*g[1]+L*g[4]+D*g[7],E[2]=N*g[2]+L*g[5]+D*g[8],E}},13353:E=>{E.exports=function(E,U,g){var N=U[0],L=U[1],D=U[2],S=g[3]*N+g[7]*L+g[11]*D+g[15];return S=S||1,E[0]=(g[0]*N+g[4]*L+g[8]*D+g[12])/S,E[1]=(g[1]*N+g[5]*L+g[9]*D+g[13])/S,E[2]=(g[2]*N+g[6]*L+g[10]*D+g[14])/S,E}},13365:E=>{E.exports=function(E,U,g){var N=U[0],L=U[1],D=U[2],S=g[0],u=g[1],s=g[2],C=g[3],B=C*N+u*D-s*L,P=C*L+s*N-S*D,F=C*D+S*L-u*N,f=-S*N-u*L-s*D;return E[0]=B*C+f*-S+P*-s-F*-u,E[1]=P*C+f*-u+F*-S-B*-s,E[2]=F*C+f*-s+B*-u-P*-S,E}},14299:E=>{"use strict";E.exports=function(E){for(var U=new Array(E),g=0;g<E;++g)U[g]=g;return U}},14373:E=>{E.exports=function(E){return null!=E&&null!=E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}},14606:(E,U,g)=>{"use strict";g.d(U,{b:()=>N});class N{constructor(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.jB=!1,this.ZB=!1,this.cB=30,this.rB=0,this.WB=!1,this.fullscreen=!1,this.wB=function(E){},this.aB=function(){},this.MB=function(){},this.Dg=function(){},this.JB=function(E){},this.onFullscreenChanged=function(E){},C((()=>{!function(E,U){E._nowObject=performance||Date,E._lastTick=0,E._renderAccum=0,E._rt=0,E._frameCB=u.bind(null,E),requestAnimationFrame(E._frameCB),U>0&&(E._intervalCB=S.bind(null,E),E._interval=setInterval(E._intervalCB,Math.max(U,1e3/E.cB/2)))}(this,U),function(E,U){if(!U)return;var g=!1,N=!1;document.addEventListener("pointerlockchange",(N=>{g=document.pointerLockElement===U,E.JB(g)})),document.addEventListener("fullscreenchange",(g=>{N=document.fullscreenElement===U,E.onFullscreenChanged(N)})),Object.defineProperty(E,"WB",{get:()=>g,set:E=>{E&&!g?s(U):g&&!E&&function(E){E.exitPointerLock&&E.exitPointerLock()}(document)}}),Object.defineProperty(E,"fullscreen",{get:()=>N,set:E=>{E&&!N?U.requestFullscreen():N&&!E&&document.exitFullscreen()}}),U.addEventListener("click",(L=>{E.jB&&!g&&s(U),E.ZB&&!N&&U.requestFullscreen()}));var L=()=>E.Dg();if(window.ResizeObserver){new ResizeObserver(L).observe(U)}else window.addEventListener("resize",L)}(this,E),this.MB()}))}}var L=3,D=20;function S(E){for(var U=1e3/E.cB,g=E._nowObject.now()+D,N=0;E._nowObject.now()>=E._lastTick+U&&E._nowObject.now()<g&&++N<=L;)E.wB(U),E._lastTick+=U;var S=5*(U+5),u=E._nowObject.now();if(u-E._lastTick>S)for(;u>=E._lastTick+U;)E._lastTick+=U}function u(E){requestAnimationFrame(E._frameCB),S(E);var U=E._nowObject.now(),g=U-E._rt;if(E._rt=U,E.rB>0){E._renderAccum+=g;var N=1e3/E.rB;if(E._renderAccum<N)return;E._renderAccum=Math.min(E._renderAccum-N,N)}var L=1e3/E.cB,D=(U-E._lastTick)/L;E.aB(g,D,L)}function s(E){E.requestPointerLock&&E.requestPointerLock()}var C=E=>{if("loading"===document.readyState){var U=()=>{document.removeEventListener("readystatechange",U),E()};document.addEventListener("readystatechange",U)}else setTimeout(E,1)}},14294:(E,U,g)=>{var N=g(14299),L=g(14303),D="undefined"!==typeof Float64Array;function S(E,U){return E[0]-U[0]}function u(){var E,U=this.stride,g=new Array(U.length);for(E=0;E<g.length;++E)g[E]=[Math.abs(U[E]),E];g.sort(S);var N=new Array(g.length);for(E=0;E<N.length;++E)N[E]=g[E][1];return N}function s(E,U){var g=["View",U,"d",E].join("");U<0&&(g="View_Nil"+E);var L="generic"===E;if(-1===U){var D="function "+g+"(a){this.data=a;};var proto="+g+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+g+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+g+"(a){return new "+g+"(a);}";return new Function(D)()}if(0===U){D="function "+g+"(a,d) {this.data = a;this.offset = d};var proto="+g+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+g+"_copy() {return new "+g+"(this.data,this.offset)};proto.pick=function "+g+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+g+"_get(){return "+(L?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+g+"_set(v){return "+(L?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+g+"(a,b,c,d){return new "+g+"(a,d)}";return new Function("TrivialArray",D)(C[E][0])}D=["'use strict'"];var S=N(U),s=S.map((function(E){return"i"+E})),B="this.offset+"+S.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),P=S.map((function(E){return"b"+E})).join(","),F=S.map((function(E){return"c"+E})).join(",");D.push("function "+g+"(a,"+P+","+F+",d){this.data=a","this.shape=["+P+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+g+".prototype","proto.dtype='"+E+"'","proto.dimension="+U),D.push("Object.defineProperty(proto,'size',{get:function "+g+"_size(){return "+S.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===U?D.push("proto.order=[0]"):(D.push("Object.defineProperty(proto,'order',{get:"),U<4?(D.push("function "+g+"_order(){"),2===U?D.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&D.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):D.push("ORDER})")),D.push("proto.set=function "+g+"_set("+s.join(",")+",v){"),L?D.push("return this.data.set("+B+",v)}"):D.push("return this.data["+B+"]=v}"),D.push("proto.get=function "+g+"_get("+s.join(",")+"){"),L?D.push("return this.data.get("+B+")}"):D.push("return this.data["+B+"]}"),D.push("proto.index=function "+g+"_index(",s.join(),"){return "+B+"}"),D.push("proto.hi=function "+g+"_hi("+s.join(",")+"){return new "+g+"(this.data,"+S.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+S.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var f=S.map((function(E){return"a"+E+"=this.shape["+E+"]"})),d=S.map((function(E){return"c"+E+"=this.stride["+E+"]"}));D.push("proto.lo=function "+g+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+d.join(","));for(var I=0;I<U;++I)D.push("if(typeof i"+I+"==='number'&&i"+I+">=0){d=i"+I+"|0;b+=c"+I+"*d;a"+I+"-=d}");D.push("return new "+g+"(this.data,"+S.map((function(E){return"a"+E})).join(",")+","+S.map((function(E){return"c"+E})).join(",")+",b)}"),D.push("proto.step=function "+g+"_step("+s.join(",")+"){var "+S.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+S.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(I=0;I<U;++I)D.push("if(typeof i"+I+"==='number'){d=i"+I+"|0;if(d<0){c+=b"+I+"*(a"+I+"-1);a"+I+"=ceil(-a"+I+"/d)}else{a"+I+"=ceil(a"+I+"/d)}b"+I+"*=d}");D.push("return new "+g+"(this.data,"+S.map((function(E){return"a"+E})).join(",")+","+S.map((function(E){return"b"+E})).join(",")+",c)}");var y=new Array(U),h=new Array(U);for(I=0;I<U;++I)y[I]="a[i"+I+"]",h[I]="b[i"+I+"]";D.push("proto.transpose=function "+g+"_transpose("+s+"){"+s.map((function(E,U){return E+"=("+E+"===undefined?"+U+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+g+"(this.data,"+y.join(",")+","+h.join(",")+",this.offset)}"),D.push("proto.pick=function "+g+"_pick("+s+"){var a=[],b=[],c=this.offset");for(I=0;I<U;++I)D.push("if(typeof i"+I+"==='number'&&i"+I+">=0){c=(c+this.stride["+I+"]*i"+I+")|0}else{a.push(this.shape["+I+"]);b.push(this.stride["+I+"])}");return D.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),D.push("return function construct_"+g+"(data,shape,stride,offset){return new "+g+"(data,"+S.map((function(E){return"shape["+E+"]"})).join(",")+","+S.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",D.join("\n"))(C[E],u)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,U,g,N){if(void 0===E)return(0,C.array[0])([]);"number"===typeof E&&(E=[E]),void 0===U&&(U=[E.length]);var S=U.length;if(void 0===g){g=new Array(S);for(var u=S-1,B=1;u>=0;--u)g[u]=B,B*=U[u]}if(void 0===N){N=0;for(u=0;u<S;++u)g[u]<0&&(N-=(U[u]-1)*g[u])}for(var P=function(E){if(L(E))return"buffer";if(D)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),F=C[P];F.length<=S+1;)F.push(s(P,F.length-1));return(0,F[S+1])(E,U,g,N)}},14303:E=>{function U(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(U(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&U(E.slice(0,0))}(E)||!!E._isBuffer)}},14465:E=>{"use strict";var U=[],g=[],N=[],L=[],D=[],S=[],u=[],s=[],C=[],B=[],P=[],F=[];E.exports=function(E,f,d,I,y,h){for(var V=u,e=C,x=B,l=F,Y=0;Y<3;Y++)V[Y]=+d[Y],x[Y]=+f.max[Y],e[Y]=+f.base[Y];h||(h=1e-10);var t=function(E,u,C,B,F,f){var d=U,I=g,y=N,h=L,V=D,e=S,x=s,l=Math.floor,Y=0,t=0,G=0,b=0,T=0;if(v(),0===G)return 0;for(b=r();t<=G;){if(o(b)&&c())return Y;b=r()}for(Y+=G,T=0;T<3;T++)B[T]+=C[T],F[T]+=C[T];return Y;function v(){if(t=0,0!==(G=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])))for(var E=0;E<3;E++){var U=C[E]>=0;h[E]=U?1:-1;var g=U?F[E]:B[E];d[E]=U?B[E]:F[E],I[E]=j(g,h[E]),y[E]=Z(d[E],h[E]),x[E]=C[E]/G,V[E]=Math.abs(1/x[E]);var N=U?I[E]+1-g:g-I[E];e[E]=V[E]<1/0?V[E]*N:1/0}}function o(U){for(var g=h[0],N=0===U?I[0]:y[0],L=I[0]+g,D=h[1],S=1===U?I[1]:y[1],u=I[1]+D,s=h[2],C=2===U?I[2]:y[2],B=I[2]+s,P=N;P!=L;P+=g)for(var F=S;F!=u;F+=D)for(var f=C;f!=B;f+=s)if(E(P,F,f))return!0;return!1}function c(){Y+=t;var E=h[b],U=t/G,g=P;for(T=0;T<3;T++){var N=C[T]*U;B[T]+=N,F[T]+=N,g[T]=C[T]-N}if(E>0?F[b]=Math.round(F[b]):B[b]=Math.round(B[b]),u(Y,b,E,g))return!0;for(T=0;T<3;T++)C[T]=g[T];return v(),0===G}function r(){var E=e[0]<e[1]?e[0]<e[2]?0:2:e[1]<e[2]?1:2,U=e[E]-t;for(t=e[E],I[E]+=h[E],e[E]+=V[E],T=0;T<3;T++)d[T]+=U*x[T],y[T]=Z(d[T],h[T]);return E}function j(E,U){return l(E-U*f)}function Z(E,U){return l(E+U*f)}}(E,I,V,e,x,h);if(!y){for(Y=0;Y<3;Y++)l[Y]=d[Y]>0?x[Y]-f.max[Y]:e[Y]-f.base[Y];f.translate(l)}return t}},14633:(E,U,g)=>{"use strict";g.d(U,{b:()=>P});var N=g(14457),L=g(13148);class D{constructor(E,U,g,D,S,u,s){this.cC=new N(E.base,E.kC),this.cL=U,this.friction=g,this.restitution=D,this.kS=S,this.Pf=u,this.zS=!!s,this.nC=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.dd=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.DC=L.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=L.create(),this._impulses=L.create(),this._sleepFrameCount=10}loadFromCopy(E){L.i(this.cC.base,E.cC.base),L.i(this.cC.kC,E.cC.kC),L.i(this.cC.max,E.cC.max),this.cC.mag=E.cC.mag,this.cL=E.cL,this.friction=E.friction,this.restitution=E.restitution,this.kS=E.kS,this.Pf=E.Pf,this.zS=E.zS,this.nC=E.nC,this.fluidDrag=E.fluidDrag,this.dd=E.dd,this.preventFallOffEdge=E.preventFallOffEdge,this.rolledBackLastTick=E.rolledBackLastTick,L.i(this.DC,E.DC),L.i(this.resting,E.resting),this.inFluid=E.inFluid,this._ratioInFluid=E._ratioInFluid,L.i(this._forces,E._forces),L.i(this._impulses,E._impulses),this._sleepFrameCount=E._sleepFrameCount}setPosition(E){S(E),L.IU(E,E,this.cC.base),this.cC.translate(E),this.sC()}Sg(){return L.clone(this.cC.base)}applyForce(E){S(E),L.add(this._forces,this._forces,E),this.sC()}applyImpulse(E){S(E),L.add(this._impulses,this._impulses,E),this.sC()}sC(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var S=E=>{};var u=g(14457),s=g(13148),C=g(14465);function B(){this.nC=.1,this.fluidDrag=.4,this.XS=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function P(E,U,g){E=Object.assign(new B,E),this.gravity=E.gravity||[0,-10,0],this.nC=E.nC||.1,this.XS=E.XS||2,this.fluidDrag=E.fluidDrag||.4,this.minBounceImpulse=E.minBounceImpulse,this.bodies=[],this.oF=E.oF,this.testSolid=U,this.testFluid=g}P.prototype.Gf=function(E,U,g,N,L,S){E=E||new u([0,0,0],[1,1,1]),"undefined"==typeof U&&(U=1),"undefined"==typeof g&&(g=1),"undefined"==typeof N&&(N=0),"undefined"==typeof L&&(L=1);var s=new D(E,U,g,N,L,S);return this.bodies.push(s),s},P.prototype.bf=function(E){var U=this.bodies.indexOf(E);U<0||(this.bodies.splice(U,1),E.cC=E.Pf=null)};var F=s.create(),f=s.create(),d=s.create(),I=s.create(),y=s.create(),h=s.create(),V=s.create(),e=new u([0,0,0],[1,1,1]),x=new D(e,1,1,0,1,(()=>{}),!1);function l(E,U,g){return U=g,U*=1-(1-E.ratioInFluid)**2}P.prototype.Fu=function(E){E/=1e3;var U=q(0,s.squaredLength(this.gravity));this.bodies.forEach((g=>function(E,U,g,N){s.i(y,U.resting),E.oF&&x.loadFromCopy(U);if(U.cL<=0)return s.set(U.DC,0,0,0),s.set(U._forces,0,0,0),void s.set(U._impulses,0,0,0);var L=N||0===U.kS;if(function(E,U,g,N){if(U._sleepFrameCount>0)return!1;if(N)return!0;var L=!1,D=.5*g*g*U.kS;return s.scale(J,E.gravity,D),C(E.testSolid,U.cC,J,(function(){return L=!0,!0}),!0),L}(E,U,g,L))return;U._sleepFrameCount--,function(E,U){var g=U.cC,N=Math.floor(g.base[0]),L=Math.floor(g.base[2]),D=Math.floor(g.base[1]),S=Math.floor(g.max[1]);if(!E.testFluid(N,D,L))return U.inFluid=!1,void(U.ratioInFluid=0);var u=1,C=D+1;for(;C<=S&&E.testFluid(N,C,L);)u++,C++;var B=(D+u-g.base[1])/g.kC[1];B>1&&(B=1);var P=g.kC[0]*g.kC[1]*g.kC[2]*B,F=t;s.scale(F,E.gravity,-E.XS*P*U.kS),U.applyForce(F),U.inFluid=!0,U.ratioInFluid=B}(E,U),mE(U._forces),mE(U._impulses),mE(U.DC),mE(U.resting),s.scale(F,U._forces,1/U.cL),s.Lu(F,F,E.gravity,U.kS),s.scale(f,U._impulses,1/U.cL),s.Lu(f,f,F,g),s.add(U.DC,U.DC,f),U.friction&&(G(E,0,U,f,g),G(E,1,U,f,g),G(E,2,U,f,g));var D=U.fluidDrag>=0?U.fluidDrag:E.fluidDrag,S=U.nC>=0?U.nC:E.nC,u=S,B=S;U.inFluid&&(u=l(U,u,U.fluidDragHoriz>=0?U.fluidDragHoriz:D),B=l(U,B,U.fluidDragVert>=0?U.fluidDragVert:D));u=Math.max(1-u*g/U.cL,0),B=Math.max(1-B*g/U.cL,0),s.set(Y,u,B,u),s.multiply(U.DC,U.DC,Y),s.scale(d,U.DC,g),s.set(U._forces,0,0,0),s.set(U._impulses,0,0,0),U.zS&&M(v,U.cC);s.i(h,d),s.set(V,0,0,0),U.preventFallOffEdge&&function(E,U,g,N){if(!U.resting[1]||g[1]>0)return;var L=A;M(L,U.cC);for(var D=0;D<3;D+=2){s.set(Z,0,0,0),Z[D]=g[D];var S=!0;(S=(S=(S=(S=S&&!a(E,L.base[0]+Z[0]+1e-5,L.base[1],L.base[2]+Z[2]+1e-5))&&!a(E,L.max[0]+Z[0]-1e-5,L.base[1],L.base[2]+Z[2]+1e-5))&&!a(E,L.base[0]+Z[0]+1e-5,L.base[1],L.max[2]+Z[2]-1e-5))&&!a(E,L.max[0]+Z[0]-1e-5,L.base[1],L.max[2]+Z[2]-1e-5))?(N[D]=g[D]>0?1:-1,g[D]=0):0===D&&(s.set(w,g[0],0,0),T(E,L,w,N,U.slideOnCollision))}}(E,U,d,V);T(E,U.cC,d,U.resting,U.slideOnCollision),U.zS&&function(E,U,g,N){if(U.resting[1]>=0&&!U.inFluid)return;var L=0!==U.resting[0],D=0!==U.resting[2];if(!L&&!D)return;var S=Math.abs(N[0]/N[2]),u=4;if(!L&&S>u)return;if(!D&&S<1/u)return;s.add(c,g.base,N);var B=E.testSolid;C(B,g,N,(function(E,U,g,N){if(1!==U)return!0;N[U]=0}));var P=g.base[1],F=U.inFluid?1.951:1.001,f=Math.floor(P+F)-P;s.set(r,0,f,0);var d=!1;if(C(B,g,r,(function(E,U,g,N){return d=!0,!0})),d)return;s.IU(j,c,g.base),j[1]=0,T(E,g,j,o,!0);var I=q(g.base[0],c[0]),y=q(g.base[2],c[2]);if(L&&!I&&(!y||!D))return;if(D&&(!I||!L)&&!y)return;var h=!0;if(h=h&&!a(E,g.base[0]+1e-5,g.base[1],g.base[2]+1e-5),h=h&&!a(E,g.max[0]-1e-5,g.base[1],g.base[2]+1e-5),h=h&&!a(E,g.base[0]+1e-5,g.base[1],g.max[2]-1e-5),h=h&&!a(E,g.max[0]-1e-5,g.base[1],g.max[2]-1e-5),h)return;M(U.cC,g),U.resting[0]=o[0],U.resting[2]=o[2],U.dd&&U.dd()}(E,U,v,h);for(var P=0;P<3;++P)U.resting[P]=U.resting[P]||V[P],I[P]=0,U.resting[P]&&(y[P]||(I[P]=-U.DC[P]),U.DC[P]=0);var e=s.length(I);e>.001&&(s.scale(I,I,U.cL),U.Pf&&U.Pf(I),U.restitution>0&&e>E.minBounceImpulse&&(s.scale(I,I,U.restitution),U.applyImpulse(I)));var b=s.squaredLength(U.DC);b>1e-5&&U.sC();E.oF&&E.oF(U)?(U.loadFromCopy(x),U.rolledBackLastTick=!0):U.rolledBackLastTick=!1}(this,g,E,U)))};var Y=s.create([0,0,0]);var t=s.create();function G(E,U,g,N,L){var D=g.resting[U],S=N[U];if(!g.alwaysApplyHorizFriction||1!==U){if(0===D)return;if(D*S<=0)return}s.i(b,g.DC),b[U]=0;var u=s.length(b);if(!q(u,0)){var C=Math.abs(g.friction*E.gravity[U]*L),B=u>C?(u-C)/u:0;g.DC[(U+1)%3]*=B,g.DC[(U+2)%3]*=B}}var b=s.create();function T(E,U,g,N,L){return s.set(N,0,0,0),C(E.testSolid,U,g,(function(E,U,g,D){N[U]=g,D[U]=0,L||(D[0]=0,D[1]=0,D[2]=0)}))}var v=new u([],[]),o=s.create(),c=s.create(),r=s.create(),j=s.create();var Z=s.create(),A=new u([],[]),w=s.create();function a(E,U,g,N){return E.testSolid(Math.floor(U),Math.floor(g-1),Math.floor(N))}var J=s.create();function q(E,U){return Math.abs(E-U)<1e-5}function M(E,U){for(var g=0;g<3;g++)E.base[g]=U.base[g],E.max[g]=U.max[g],E.kC[g]=U.kC[g]}var mE=function(E){}},13010:function(E,U){!function(E){"use strict";var U=function(E,g){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,U){E.__proto__=U}||function(E,U){for(var g in U)Object.prototype.hasOwnProperty.call(U,g)&&(E[g]=U[g])},U(E,g)};function g(E,g){if("function"!==typeof g&&null!==g)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function N(){this.constructor=E}U(E,g),E.prototype=null===g?Object.create(g):(N.prototype=g.prototype,new N)}function N(E,U,g,N){var L,D=arguments.length,S=D<3?U:null===N?N=Object.getOwnPropertyDescriptor(U,g):N;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)S=Reflect.decorate(E,U,g,N);else for(var u=E.length-1;u>=0;u--)(L=E[u])&&(S=(D<3?L(S):D>3?L(U,g,S):L(U,g))||S);return D>3&&S&&Object.defineProperty(U,g,S),S}function L(E,U,g){if(g||2===arguments.length)for(var N,L=0,D=U.length;L<D;L++)!N&&L in U||(N||(N=Array.prototype.slice.call(U,0,L)),N[L]=U[L]);return E.concat(N||Array.prototype.slice.call(U))}var D,S=255,u=213;E.OPERATION=void 0,(D=E.OPERATION||(E.OPERATION={}))[D.ADD=128]="ADD",D[D.REPLACE=0]="REPLACE",D[D.DELETE=64]="DELETE",D[D.DELETE_AND_ADD=192]="DELETE_AND_ADD",D[D.TOUCH=1]="TOUCH",D[D.CLEAR=10]="CLEAR";var s=function(){function U(E,U,g){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=E,this.setParent(U,g)}return U.prototype.setParent=function(E,U,g){var N=this;if(this.indexes||(this.indexes=this.ref instanceof jE?this.ref._definition.indexes:{}),this.parent=E,this.parentIndex=g,U)if(this.root=U,this.ref instanceof jE){var L=this.ref._definition;for(var D in L.schema){var S=this.ref[D];if(S&&S.$changes){var u=L.indexes[D];S.$changes.setParent(this.ref,U,u)}}}else"object"===typeof this.ref&&this.ref.forEach((function(E,U){if(E instanceof jE){var g=E.$changes,L=N.ref.$changes.indexes[U];g.setParent(N.ref,N.root,L)}}))},U.prototype.operation=function(E){this.changes.set(--this.currentCustomOperation,E)},U.prototype.change=function(U,g){void 0===g&&(g=E.OPERATION.ADD);var N="number"===typeof U?U:this.indexes[U];this.assertValidIndex(N,U);var L=this.changes.get(N);L&&L.op!==E.OPERATION.DELETE&&L.op!==E.OPERATION.TOUCH||this.changes.set(N,{op:L&&L.op===E.OPERATION.DELETE?E.OPERATION.DELETE_AND_ADD:g,index:N}),this.allChanges.add(N),this.changed=!0,this.touchParents()},U.prototype.touch=function(U){var g="number"===typeof U?U:this.indexes[U];this.assertValidIndex(g,U),this.changes.has(g)||this.changes.set(g,{op:E.OPERATION.TOUCH,index:g}),this.allChanges.add(g),this.touchParents()},U.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},U.prototype.getType=function(E){if(this.ref._definition)return(U=this.ref._definition).schema[U.fieldsByIndex[E]];var U,g=(U=this.parent._definition).schema[U.fieldsByIndex[this.parentIndex]];return Object.values(g)[0]},U.prototype.getChildrenFilter=function(){var E=this.parent._definition.childFilters;return E&&E[this.parentIndex]},U.prototype.getValue=function(E){return this.ref.getByIndex(E)},U.prototype.delete=function(U){var g="number"===typeof U?U:this.indexes[U];if(void 0!==g){var N=this.getValue(g);this.changes.set(g,{op:E.OPERATION.DELETE,index:g}),this.allChanges.delete(g),delete this.caches[g],N&&N.$changes&&(N.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(U," (").concat(g,")"))},U.prototype.discard=function(U,g){var N=this;void 0===U&&(U=!1),void 0===g&&(g=!1),this.ref instanceof jE||this.changes.forEach((function(U){if(U.op===E.OPERATION.DELETE){var g=N.ref.getIndex(U.index);delete N.indexes[g]}})),this.changes.clear(),this.changed=U,g&&this.allChanges.clear(),this.currentCustomOperation=0},U.prototype.discardAll=function(){var E=this;this.changes.forEach((function(U){var g=E.getValue(U.index);g&&g.$changes&&g.$changes.discardAll()})),this.discard()},U.prototype.cache=function(E,U){this.caches[E]=U},U.prototype.clone=function(){return new U(this.ref,this.parent,this.root)},U.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},U.prototype.assertValidIndex=function(E,U){if(void 0===E)throw new Error('ChangeTree: missing index for field "'.concat(U,'"'))},U}();function C(E,U,g,N){return E[U]||(E[U]=[]),E[U].push(g),null===N||void 0===N||N.forEach((function(E,U){return g(E,U)})),function(){return P(E[U],E[U].indexOf(g))}}function B(U){var g=this,N="string"!==typeof this.$changes.getType();this.$items.forEach((function(L,D){U.push({refId:g.$changes.refId,op:E.OPERATION.DELETE,field:D,value:void 0,previousValue:L}),N&&g.$changes.root.removeRef(L.$changes.refId)}))}function P(E,U){if(-1===U||U>=E.length)return!1;for(var g=E.length-1,N=U;N<g;N++)E[N]=E[N+1];return E.length=g,!0}var F=function(E,U){var g=E.toString(),N=U.toString();return g<N?-1:g>N?1:0};function f(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,U){return"symbol"===typeof U||isNaN(U)?E[U]:E.at(U)},set:function(E,U,g){if("symbol"===typeof U||isNaN(U))E[U]=g;else{var N=Array.from(E.$items.keys()),L=parseInt(N[U]||U);void 0===g||null===g?E.deleteAt(L):E.setAt(L,g)}return!0},deleteProperty:function(E,U){return"number"===typeof U?E.deleteAt(U):delete E[U],!0}})}var d=function(){function U(){for(var E=[],U=0;U<arguments.length;U++)E[U]=arguments[U];this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,E)}return U.prototype.vu=function(U,g){return void 0===g&&(g=!0),C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,U,g?this.$items:void 0)},U.prototype.mg=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,U)},U.is=function(E){return Array.isArray(E)||void 0!==E.array},Object.defineProperty(U.prototype,"length",{get:function(){return this.$items.size},set:function(E){0===E?this.clear():this.splice(E,this.length-E)},enumerable:!1,configurable:!0}),U.prototype.push=function(){for(var E,U=this,g=[],N=0;N<arguments.length;N++)g[N]=arguments[N];return g.forEach((function(g){E=U.$refId++,U.setAt(E,g)})),E},U.prototype.pop=function(){var E=Array.from(this.$indexes.values()).pop();if(void 0!==E){this.$changes.delete(E),this.$indexes.delete(E);var U=this.$items.get(E);return this.$items.delete(E),U}},U.prototype.at=function(E){var U=Array.from(this.$items.keys())[E];return this.$items.get(U)},U.prototype.setAt=function(U,g){var N,L;if(void 0!==g&&null!==g){if(this.$items.get(U)!==g){void 0!==g.$changes&&g.$changes.setParent(this,this.$changes.root,U);var D=null!==(L=null===(N=this.$changes.indexes[U])||void 0===N?void 0:N.op)&&void 0!==L?L:E.OPERATION.ADD;this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,g),this.$changes.change(U,D)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},U.prototype.deleteAt=function(E){var U=Array.from(this.$items.keys())[E];return void 0!==U&&this.$deleteAt(U)},U.prototype.$deleteAt=function(E){return this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&B.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.concat=function(){for(var E,g=[],N=0;N<arguments.length;N++)g[N]=arguments[N];return new(U.bind.apply(U,L([void 0],(E=Array.from(this.$items.values())).concat.apply(E,g),!1)))},U.prototype.join=function(E){return Array.from(this.$items.values()).join(E)},U.prototype.reverse=function(){var E=this,U=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(g,N){E.setAt(U[N],g)})),this},U.prototype.shift=function(){var E=Array.from(this.$items.keys()).shift();if(void 0!==E){var U=this.$items.get(E);return this.$deleteAt(E),U}},U.prototype.slice=function(E,g){var N=new U;return N.push.apply(N,Array.from(this.$items.values()).slice(E,g)),N},U.prototype.sort=function(E){var U=this;void 0===E&&(E=F);var g=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(E).forEach((function(E,N){U.setAt(g[N],E)})),this},U.prototype.splice=function(E,U){void 0===U&&(U=this.length-E);for(var g=Array.from(this.$items.keys()),N=[],L=E;L<E+U;L++)N.push(this.$items.get(g[L])),this.$deleteAt(g[L]);return N},U.prototype.unshift=function(){for(var E=this,U=[],g=0;g<arguments.length;g++)U[g]=arguments[g];var N=this.length,L=U.length,D=Array.from(this.$items.values());return U.forEach((function(U,g){E.setAt(g,U)})),D.forEach((function(U,g){E.setAt(L+g,U)})),N+L},U.prototype.indexOf=function(E,U){return Array.from(this.$items.values()).indexOf(E,U)},U.prototype.lastIndexOf=function(E,U){return void 0===U&&(U=this.length-1),Array.from(this.$items.values()).lastIndexOf(E,U)},U.prototype.every=function(E,U){return Array.from(this.$items.values()).every(E,U)},U.prototype.some=function(E,U){return Array.from(this.$items.values()).some(E,U)},U.prototype.forEach=function(E,U){Array.from(this.$items.values()).forEach(E,U)},U.prototype.map=function(E,U){return Array.from(this.$items.values()).map(E,U)},U.prototype.filter=function(E,U){return Array.from(this.$items.values()).filter(E,U)},U.prototype.reduce=function(E,U){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},U.prototype.reduceRight=function(E,U){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},U.prototype.find=function(E,U){return Array.from(this.$items.values()).find(E,U)},U.prototype.findIndex=function(E,U){return Array.from(this.$items.values()).findIndex(E,U)},U.prototype.fill=function(E,U,g){throw new Error("ArraySchema#fill() not implemented")},U.prototype.copyWithin=function(E,U,g){throw new Error("ArraySchema#copyWithin() not implemented")},U.prototype.toString=function(){return this.$items.toString()},U.prototype.toLocaleString=function(){return this.$items.toLocaleString()},U.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},U.prototype.includes=function(E,U){return Array.from(this.$items.values()).includes(E,U)},U.prototype.flatMap=function(E,U){throw new Error("ArraySchema#flatMap() is not supported.")},U.prototype.flat=function(E){throw new Error("ArraySchema#flat() is not supported.")},U.prototype.findLast=function(){var E=Array.from(this.$items.values());return E.findLast.apply(E,arguments)},U.prototype.findLastIndex=function(){var E=Array.from(this.$items.values());return E.findLastIndex.apply(E,arguments)},U.prototype.setIndex=function(E,U){this.$indexes.set(E,U)},U.prototype.getIndex=function(E){return this.$indexes.get(E)},U.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},U.prototype.deleteByIndex=function(E){var U=this.$indexes.get(E);this.$items.delete(U),this.$indexes.delete(E)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){return this.toArray().map((function(E){return"function"===typeof E.toJSON?E.toJSON():E}))},U.prototype.clone=function(E){return E?new(U.bind.apply(U,L([void 0],Array.from(this.$items.values()),!1))):new(U.bind.apply(U,L([void 0],this.map((function(E){return E.$changes?E.clone():E})),!1)))},U}();function I(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,U){return"symbol"!==typeof U&&"undefined"===typeof E[U]?E.get(U):E[U]},set:function(E,U,g){return"symbol"!==typeof U&&-1===U.indexOf("$")&&"vu"!==U&&"mg"!==U&&"onChange"!==U?E.set(U,g):E[U]=g,!0},deleteProperty:function(E,U){return E.delete(U),!0}})}var y=function(){function U(E){var g=this;if(this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E)if(E instanceof Map||E instanceof U)E.forEach((function(E,U){return g.set(U,E)}));else for(var N in E)this.set(N,E[N])}return U.prototype.vu=function(U,g){return void 0===g&&(g=!0),C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,U,g?this.$items:void 0)},U.prototype.mg=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,U)},U.is=function(E){return void 0!==E.map},U.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(U.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.set=function(U,g){if(void 0===g||null===g)throw new Error("MapSchema#set('".concat(U,"', ").concat(g,"): trying to set ").concat(g," value on '").concat(U,"'."));U=U.toString();var N="undefined"!==typeof this.$changes.indexes[U],L=N?this.$changes.indexes[U]:this.$refId++,D=N?E.OPERATION.REPLACE:E.OPERATION.ADD,S=void 0!==g.$changes;if(S&&g.$changes.setParent(this,this.$changes.root,L),N){if(!S&&this.$items.get(U)===g)return;S&&this.$items.get(U)!==g&&(D=E.OPERATION.ADD)}else this.$changes.indexes[U]=L,this.$indexes.set(L,U);return this.$items.set(U,g),this.$changes.change(U,D),this},U.prototype.get=function(E){return this.$items.get(E)},U.prototype.delete=function(E){return this.$changes.delete(E),this.$items.delete(E)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&B.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(E){return this.$items.has(E)},U.prototype.forEach=function(E){this.$items.forEach(E)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(E,U){this.$indexes.set(E,U)},U.prototype.getIndex=function(E){return this.$indexes.get(E)},U.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},U.prototype.deleteByIndex=function(E){var U=this.$indexes.get(E);this.$items.delete(U),this.$indexes.delete(E)},U.prototype.toJSON=function(){var E={};return this.forEach((function(U,g){E[g]="function"===typeof U.toJSON?U.toJSON():U})),E},U.prototype.clone=function(E){var g;return E?g=Object.assign(new U,this):(g=new U,this.forEach((function(E,U){E.$changes?g.set(U,E.clone()):g.set(U,E)}))),g},U}(),h={};function V(E,U){h[E]=U}function e(E){return h[E]}var x=function(){function E(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return E.create=function(U){var g=new E;return g.schema=Object.assign({},U&&U.schema||{}),g.indexes=Object.assign({},U&&U.indexes||{}),g.fieldsByIndex=Object.assign({},U&&U.fieldsByIndex||{}),g.descriptors=Object.assign({},U&&U.descriptors||{}),g.deprecated=Object.assign({},U&&U.deprecated||{}),g},E.prototype.addField=function(E,U){var g=this.getNextFieldIndex();this.fieldsByIndex[g]=E,this.indexes[E]=g,this.schema[E]=Array.isArray(U)?{array:U[0]}:U},E.prototype.hasField=function(E){return void 0!==this.indexes[E]},E.prototype.addFilter=function(E,U){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[E]]=U,this.indexesWithFilters.push(this.indexes[E]),!0},E.prototype.addChildrenFilter=function(E,U){var g=this.indexes[E],N=this.schema[E];if(e(Object.keys(N)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[g]=U,!0;console.warn("@filterChildren: field '".concat(E,"' can't have children. Ignoring filter."))},E.prototype.getChildrenFilter=function(E){return this.childFilters&&this.childFilters[this.indexes[E]]},E.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},E}();function l(E){return E._context&&E._context.useFilters}var Y=function(){function E(){this.types={},this.schemas=new Map,this.useFilters=!1}return E.prototype.has=function(E){return this.schemas.has(E)},E.prototype.get=function(E){return this.types[E]},E.prototype.add=function(E,U){void 0===U&&(U=this.schemas.size),E._definition=x.create(E._definition),E._typeid=U,this.types[U]=E,this.schemas.set(E,U)},E.create=function(U){return void 0===U&&(U={}),function(g){return U.context||(U.context=new E),G(g,U)}},E}(),t=new Y;function G(E,U){return void 0===U&&(U={}),function(g,N){var D=U.context||t,S=g.constructor;if(S._context=D,!E)throw new Error("".concat(S.name,': @type() reference provided for "').concat(N,"\" is undefined. Make sure you don't have any circular dependencies."));D.has(S)||D.add(S);var u=S._definition;if(u.addField(N,E),u.descriptors[N]){if(u.deprecated[N])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(N,"' definition on '").concat(S.name,"'.\nCheck @type() annotation"))}catch(h){var s=h.stack.split("\n")[4].trim();throw new Error("".concat(h.message," ").concat(s))}}var C=d.is(E),B=!C&&y.is(E);if("string"!==typeof E&&!jE.is(E)){var P=Object.values(E)[0];"string"===typeof P||D.has(P)||D.add(P)}if(U.manual)u.descriptors[N]={enumerable:!0,configurable:!0,writable:!0};else{var F="_".concat(N);u.descriptors[F]={enumerable:!1,configurable:!1,writable:!0},u.descriptors[N]={get:function(){return this[F]},set:function(E){E!==this[F]&&(void 0!==E&&null!==E?(!C||E instanceof d||(E=new(d.bind.apply(d,L([void 0],E,!1)))),!B||E instanceof y||(E=new y(E)),void 0===E.$proxy&&(B?E=I(E):C&&(E=f(E))),this.$changes.change(N),E.$changes&&E.$changes.setParent(this,this.$changes.root,this._definition.indexes[N])):this[F]&&this.$changes.delete(N),this[F]=E)},enumerable:!0,configurable:!0}}}}function b(E){return function(U,g){var N=U.constructor;N._definition.addFilter(g,E)&&(N._context.useFilters=!0)}}function T(E){return function(U,g){var N=U.constructor;N._definition.addChildrenFilter(g,E)&&(N._context.useFilters=!0)}}function v(E){return void 0===E&&(E=!0),function(U,g){var N=U.constructor._definition;N.deprecated[g]=!0,E&&(N.descriptors[g]={get:function(){throw new Error("".concat(g," is deprecated."))},set:function(E){},enumerable:!1,configurable:!0})}}function o(E,U,g){for(var N in void 0===g&&(g={}),g.context||(g.context=E._context||g.context||t),U)G(U[N],g)(E.prototype,N);return E}function c(E){for(var U=0,g=0,N=0,L=E.length;N<L;N++)(U=E.charCodeAt(N))<128?g+=1:U<2048?g+=2:U<55296||U>=57344?g+=3:(N++,g+=4);return g}function r(E,U,g){for(var N=0,L=0,D=g.length;L<D;L++)(N=g.charCodeAt(L))<128?E[U++]=N:N<2048?(E[U++]=192|N>>6,E[U++]=128|63&N):N<55296||N>=57344?(E[U++]=224|N>>12,E[U++]=128|N>>6&63,E[U++]=128|63&N):(L++,N=65536+((1023&N)<<10|1023&g.charCodeAt(L)),E[U++]=240|N>>18,E[U++]=128|N>>12&63,E[U++]=128|N>>6&63,E[U++]=128|63&N)}function j(E,U){E.push(255&U)}function Z(E,U){E.push(255&U)}function A(E,U){E.push(255&U),E.push(U>>8&255)}function w(E,U){E.push(255&U),E.push(U>>8&255)}function a(E,U){E.push(255&U),E.push(U>>8&255),E.push(U>>16&255),E.push(U>>24&255)}function J(E,U){var g=U>>24,N=U>>16,L=U>>8,D=U;E.push(255&D),E.push(255&L),E.push(255&N),E.push(255&g)}function q(E,U){var g=Math.floor(U/Math.pow(2,32));J(E,U>>>0),J(E,g)}function M(E,U){var g=U/Math.pow(2,32)|0;J(E,U>>>0),J(E,g)}function mE(E,U){n(E,U)}function W(E,U){k(E,U)}var O=new Int32Array(2),Q=new Float32Array(O.buffer),R=new Float64Array(O.buffer);function n(E,U){Q[0]=U,a(E,O[0])}function k(E,U){R[0]=U,a(E,O[0]),a(E,O[1])}function z(E,U){return Z(E,U?1:0)}function i(E,U){U||(U="");var g=c(U),N=0;if(g<32)E.push(160|g),N=1;else if(g<256)E.push(217),Z(E,g),N=2;else if(g<65536)E.push(218),w(E,g),N=3;else{if(!(g<4294967296))throw new Error("String too long");E.push(219),J(E,g),N=5}return r(E,E.length,U),N+g}function p(E,U){return isNaN(U)?p(E,0):isFinite(U)?U!==(0|U)?(E.push(203),k(E,U),9):U>=0?U<128?(Z(E,U),1):U<256?(E.push(204),Z(E,U),2):U<65536?(E.push(205),w(E,U),3):U<4294967296?(E.push(206),J(E,U),5):(E.push(207),M(E,U),9):U>=-32?(E.push(224|U+32),1):U>=-128?(E.push(208),j(E,U),2):U>=-32768?(E.push(209),A(E,U),3):U>=-2147483648?(E.push(210),a(E,U),5):(E.push(211),q(E,U),9):p(E,U>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var H=Object.freeze({__proto__:null,utf8Write:r,int8:j,uint8:Z,int16:A,uint16:w,int32:a,uint32:J,int64:q,uint64:M,float32:mE,float64:W,writeFloat32:n,writeFloat64:k,boolean:z,string:i,number:p});function K(E,U,g){for(var N="",L=0,D=U,S=U+g;D<S;D++){var u=E[D];0!==(128&u)?192!==(224&u)?224!==(240&u)?240!==(248&u)?console.error("Invalid byte "+u.toString(16)):(L=(7&u)<<18|(63&E[++D])<<12|(63&E[++D])<<6|63&E[++D])>=65536?(L-=65536,N+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):N+=String.fromCharCode(L):N+=String.fromCharCode((15&u)<<12|(63&E[++D])<<6|63&E[++D]):N+=String.fromCharCode((31&u)<<6|63&E[++D]):N+=String.fromCharCode(u)}return N}function X(E,U){return EE(E,U)<<24>>24}function EE(E,U){return E[U.offset++]}function UE(E,U){return gE(E,U)<<16>>16}function gE(E,U){return E[U.offset++]|E[U.offset++]<<8}function NE(E,U){return E[U.offset++]|E[U.offset++]<<8|E[U.offset++]<<16|E[U.offset++]<<24}function LE(E,U){return NE(E,U)>>>0}function DE(E,U){return FE(E,U)}function SE(E,U){return fE(E,U)}function uE(E,U){var g=LE(E,U);return NE(E,U)*Math.pow(2,32)+g}function sE(E,U){var g=LE(E,U);return LE(E,U)*Math.pow(2,32)+g}var CE=new Int32Array(2),BE=new Float32Array(CE.buffer),PE=new Float64Array(CE.buffer);function FE(E,U){return CE[0]=NE(E,U),BE[0]}function fE(E,U){return CE[0]=NE(E,U),CE[1]=NE(E,U),PE[0]}function dE(E,U){return EE(E,U)>0}function IE(E,U){var g,N=E[U.offset++];N<192?g=31&N:217===N?g=EE(E,U):218===N?g=gE(E,U):219===N&&(g=LE(E,U));var L=K(E,U.offset,g);return U.offset+=g,L}function yE(E,U){var g=E[U.offset];return g<192&&g>160||217===g||218===g||219===g}function hE(E,U){var g=E[U.offset++];return g<128?g:202===g?FE(E,U):203===g?fE(E,U):204===g?EE(E,U):205===g?gE(E,U):206===g?LE(E,U):207===g?sE(E,U):208===g?X(E,U):209===g?UE(E,U):210===g?NE(E,U):211===g?uE(E,U):g>223?-1*(255-g+1):void 0}function VE(E,U){var g=E[U.offset];return g<128||g>=202&&g<=211}function eE(E,U){return E[U.offset]<160}function xE(E,U){return E[U.offset-1]===S&&(E[U.offset]<128||E[U.offset]>=202&&E[U.offset]<=211)}var lE=Object.freeze({__proto__:null,int8:X,uint8:EE,int16:UE,uint16:gE,int32:NE,uint32:LE,float32:DE,float64:SE,int64:uE,uint64:sE,readFloat32:FE,readFloat64:fE,boolean:dE,string:IE,stringCheck:yE,number:hE,numberCheck:VE,arrayCheck:eE,switchStructureCheck:xE}),YE=function(){function U(E){var U=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return U.add(E)}))}return U.prototype.vu=function(U,g){return void 0===g&&(g=!0),C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,U,g?this.$items:void 0)},U.prototype.mg=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,U)},U.is=function(E){return void 0!==E.collection},U.prototype.add=function(E){var U=this.$refId++;return void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,U),this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,E),this.$changes.change(U),U},U.prototype.at=function(E){var U=Array.from(this.$items.keys())[E];return this.$items.get(U)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(E){for(var U,g,N=this.$items.entries();(g=N.next())&&!g.done;)if(E===g.value[1]){U=g.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&B.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(E){return Array.from(this.$items.values()).some((function(U){return U===E}))},U.prototype.forEach=function(E){var U=this;this.$items.forEach((function(g,N,L){return E(g,N,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(E,U){this.$indexes.set(E,U)},U.prototype.getIndex=function(E){return this.$indexes.get(E)},U.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},U.prototype.deleteByIndex=function(E){var U=this.$indexes.get(E);this.$items.delete(U),this.$indexes.delete(E)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var E=[];return this.forEach((function(U,g){E.push("function"===typeof U.toJSON?U.toJSON():U)})),E},U.prototype.clone=function(E){var g;return E?g=Object.assign(new U,this):(g=new U,this.forEach((function(E){E.$changes?g.add(E.clone()):g.add(E)}))),g},U}(),tE=function(){function U(E){var U=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return U.add(E)}))}return U.prototype.vu=function(U,g){return void 0===g&&(g=!0),C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,U,g?this.$items:void 0)},U.prototype.mg=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,U)},U.is=function(E){return void 0!==E.set},U.prototype.add=function(U){var g,N;if(this.has(U))return!1;var L=this.$refId++;void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,L);var D=null!==(N=null===(g=this.$changes.indexes[L])||void 0===g?void 0:g.op)&&void 0!==N?N:E.OPERATION.ADD;return this.$changes.indexes[L]=L,this.$indexes.set(L,L),this.$items.set(L,U),this.$changes.change(L,D),L},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(E){for(var U,g,N=this.$items.entries();(g=N.next())&&!g.done;)if(E===g.value[1]){U=g.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&B.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(E){for(var U,g=this.$items.values(),N=!1;(U=g.next())&&!U.done;)if(E===U.value){N=!0;break}return N},U.prototype.forEach=function(E){var U=this;this.$items.forEach((function(g,N,L){return E(g,N,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(E,U){this.$indexes.set(E,U)},U.prototype.getIndex=function(E){return this.$indexes.get(E)},U.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},U.prototype.deleteByIndex=function(E){var U=this.$indexes.get(E);this.$items.delete(U),this.$indexes.delete(E)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var E=[];return this.forEach((function(U,g){E.push("function"===typeof U.toJSON?U.toJSON():U)})),E},U.prototype.clone=function(E){var g;return E?g=Object.assign(new U,this):(g=new U,this.forEach((function(E){E.$changes?g.add(E.clone()):g.add(E)}))),g},U}(),GE=function(){function E(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return E.prototype.addRefId=function(E){this.refIds.has(E)||(this.refIds.add(E),this.containerIndexes.set(E,new Set))},E.get=function(U){return void 0===U.$filterState&&(U.$filterState=new E),U.$filterState},E}(),bE=function(){function E(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return E.prototype.getNextUniqueId=function(){return this.nextUniqueId++},E.prototype.addRef=function(E,U,g){void 0===g&&(g=!0),this.refs.set(E,U),g&&(this.refCounts[E]=(this.refCounts[E]||0)+1)},E.prototype.removeRef=function(E){this.refCounts[E]=this.refCounts[E]-1,this.deletedRefs.add(E)},E.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},E.prototype.garbageCollectDeletedRefs=function(){var E=this;this.deletedRefs.forEach((function(U){if(!(E.refCounts[U]>0)){var g=E.refs.get(U);if(g instanceof jE)for(var N in g._definition.schema)"string"!==typeof g._definition.schema[N]&&g[N]&&g[N].$changes&&E.removeRef(g[N].$changes.refId);else{var L=g.$changes.parent._definition,D=L.schema[L.fieldsByIndex[g.$changes.parentIndex]];"function"===typeof Object.values(D)[0]&&Array.from(g.values()).forEach((function(U){return E.removeRef(U.$changes.refId)}))}E.refs.delete(U),delete E.refCounts[U]}})),this.deletedRefs.clear()},E}(),TE=function(E){function U(){return null!==E&&E.apply(this,arguments)||this}return g(U,E),U}(Error);function vE(E,U,g,N){var L,D=!1;switch(U){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":L="number",isNaN(E)&&console.log('trying to encode "NaN" in '.concat(g.constructor.name,"#").concat(N));break;case"string":L="string",D=!0;break;case"boolean":return}if(typeof E!==L&&(!D||D&&null!==E)){var S="'".concat(JSON.stringify(E),"'").concat(E&&E.constructor&&" (".concat(E.constructor.name,")")||"");throw new TE("a '".concat(L,"' was expected, but ").concat(S," was provided in ").concat(g.constructor.name,"#").concat(N))}}function oE(E,U,g,N){if(!(E instanceof U))throw new TE("a '".concat(U.name,"' was expected, but '").concat(E.constructor.name,"' was provided in ").concat(g.constructor.name,"#").concat(N))}function cE(E,U,g,N,L){vE(g,E,N,L);var D=H[E];if(!D)throw new TE("a '".concat(E,"' was expected, but ").concat(g," was provided in ").concat(N.constructor.name,"#").concat(L));D(U,g)}function rE(E,U,g){return lE[E](U,g)}var jE=function(){function U(){for(var E=[],U=0;U<arguments.length;U++)E[U]=arguments[U];Object.defineProperties(this,{$changes:{value:new s(this,void 0,new bE),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var g=this._definition.descriptors;g&&Object.defineProperties(this,g),E[0]&&this.assign(E[0])}return U.onError=function(E){console.error(E)},U.is=function(E){return E._definition&&void 0!==E._definition.schema},U.prototype.onChange=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,U)},U.prototype.mg=function(U){return C(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,U)},U.prototype.assign=function(E){return Object.assign(this,E),this},Object.defineProperty(U.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),U.prototype.setDirty=function(E,U){this.$changes.change(E,U)},U.prototype.listen=function(E,U,g){var N=this;return void 0===g&&(g=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[E]||(this.$callbacks[E]=[]),this.$callbacks[E].push(U),g&&void 0!==this[E]&&U(this[E],void 0),function(){return P(N.$callbacks[E],N.$callbacks[E].indexOf(U))}},U.prototype.decode=function(g,N,L){var D;void 0===N&&(N={offset:0}),void 0===L&&(L=this);var u=[],s=this.$changes.root,C=g.length,B=0;for(s.refs.set(B,this);N.offset<C;){var P=g[N.offset++];if(P!=S){var F=L.$changes,f=void 0!==L._definition,I=f?P>>6<<6:P;if(I!==E.OPERATION.CLEAR){var h=f?P%(I||255):hE(g,N),V=f?L._definition.fieldsByIndex[h]:"",x=F.getType(h),l=void 0,Y=void 0,t=void 0;if(f?Y=L["_".concat(V)]:(Y=L.getByIndex(h),(I&E.OPERATION.ADD)===E.OPERATION.ADD?(t=L instanceof y?IE(g,N):h,L.setIndex(h,t)):t=L.getIndex(h)),(I&E.OPERATION.DELETE)===E.OPERATION.DELETE&&(I!==E.OPERATION.DELETE_AND_ADD&&L.deleteByIndex(h),Y&&Y.$changes&&s.removeRef(Y.$changes.refId),l=null),void 0!==V){if(I===E.OPERATION.DELETE);else if(U.is(x)){var G=hE(g,N);if(l=s.refs.get(G),I!==E.OPERATION.REPLACE){var b=this.getSchemaType(g,N,x);l||((l=this.createTypeInstance(b)).$changes.refId=G,Y&&(l.$callbacks=Y.$callbacks,Y.$changes.refId&&G!==Y.$changes.refId&&s.removeRef(Y.$changes.refId))),s.addRef(G,l,l!==Y)}}else if("string"===typeof x)l=rE(x,g,N);else{var T=e(Object.keys(x)[0]),v=hE(g,N),o=s.refs.has(v)?Y||s.refs.get(v):new T.constructor;if((l=o.clone(!0)).$changes.refId=v,Y&&(l.$callbacks=Y.$callbacks,Y.$changes.refId&&v!==Y.$changes.refId)){s.removeRef(Y.$changes.refId);for(var c=Y.entries(),r=void 0;(r=c.next())&&!r.done;){var j=(D=r.value)[0],Z=D[1];u.push({refId:v,op:E.OPERATION.DELETE,field:j,value:void 0,previousValue:Z})}}s.addRef(v,l,o!==Y)}if(null!==l&&void 0!==l)if(l.$changes&&l.$changes.setParent(F.ref,F.root,h),L instanceof U)L[V]=l;else if(L instanceof y)j=t,L.$items.set(j,l),L.$changes.allChanges.add(h);else if(L instanceof d)L.setAt(h,l);else if(L instanceof YE){var A=L.add(l);L.setIndex(h,A)}else L instanceof tE&&!1!==(A=L.add(l))&&L.setIndex(h,A);Y!==l&&u.push({refId:B,op:I,field:V,dynamicIndex:t,value:l,previousValue:Y})}else{console.warn("@colyseus/schema: definition mismatch");for(var w={offset:N.offset};N.offset<C&&(!xE(g,N)||(w.offset=N.offset+1,!s.refs.has(hE(g,w))));)N.offset++}}else L.clear(u)}else{B=hE(g,N);var a=s.refs.get(B);if(!a)throw new Error('"refId" not found: '.concat(B));L=a}}return this._triggerChanges(u),s.garbageCollectDeletedRefs(),u},U.prototype.encode=function(g,N,L){void 0===g&&(g=!1),void 0===N&&(N=[]),void 0===L&&(L=!1);for(var D=this.$changes,u=new WeakSet,s=[D],C=1,B=0;B<C;B++){var P=s[B],F=P.ref,f=F instanceof U;P.ensureRefId(),u.add(P),P!==D&&(P.changed||g)&&(Z(N,S),p(N,P.refId));for(var d=g?Array.from(P.allChanges):Array.from(P.changes.values()),I=0,h=d.length;I<h;I++){var V=g?{op:E.OPERATION.ADD,index:d[I]}:d[I],x=V.index,l=f?F._definition.fieldsByIndex&&F._definition.fieldsByIndex[x]:x,Y=N.length;if(V.op!==E.OPERATION.TOUCH)if(f)Z(N,x|V.op);else{if(Z(N,V.op),V.op===E.OPERATION.CLEAR)continue;p(N,x)}if(f||(V.op&E.OPERATION.ADD)!=E.OPERATION.ADD||F instanceof y&&i(N,P.ref.$indexes.get(x)),V.op!==E.OPERATION.DELETE){var t=P.getType(x),G=P.getValue(x);if(G&&G.$changes&&!u.has(G.$changes)&&(s.push(G.$changes),G.$changes.ensureRefId(),C++),V.op!==E.OPERATION.TOUCH){if(U.is(t))oE(G,t,F,l),p(N,G.$changes.refId),(V.op&E.OPERATION.ADD)===E.OPERATION.ADD&&this.tryEncodeTypeId(N,t,G.constructor);else if("string"===typeof t)cE(t,N,G,F,l);else{var b=e(Object.keys(t)[0]);oE(F["_".concat(l)],b.constructor,F,l),p(N,G.$changes.refId)}L&&P.cache(x,N.slice(Y))}}}g||L||P.discard()}return N},U.prototype.encodeAll=function(E){return this.encode(!0,[],E)},U.prototype.applyFilters=function(g,N){var L,D;void 0===N&&(N=!1);for(var u=this,s=new Set,C=GE.get(g),B=[this.$changes],P=1,F=[],f=function(f){var d=B[f];if(s.has(d.refId))return"continue";var I=d.ref,h=I instanceof U;Z(F,S),p(F,d.refId);var V=C.refIds.has(d),e=N||!V;C.addRefId(d);var x=C.containerIndexes.get(d),l=e?Array.from(d.allChanges):Array.from(d.changes.values());!N&&h&&I._definition.indexesWithFilters&&I._definition.indexesWithFilters.forEach((function(U){!x.has(U)&&d.allChanges.has(U)&&(e?l.push(U):l.push({op:E.OPERATION.ADD,index:U}))}));for(var Y=0,t=l.length;Y<t;Y++){var G=e?{op:E.OPERATION.ADD,index:l[Y]}:l[Y];if(G.op!==E.OPERATION.CLEAR){var b=G.index;if(G.op!==E.OPERATION.DELETE){var T=d.getValue(b),v=d.getType(b);if(h){if((o=I._definition.filters&&I._definition.filters[b])&&!o.call(I,g,T,u)){T&&T.$changes&&s.add(T.$changes.refId);continue}}else{var o,c=d.parent;if((o=d.getChildrenFilter())&&!o.call(c,g,I.$indexes.get(b),T,u)){T&&T.$changes&&s.add(T.$changes.refId);continue}}if(T.$changes&&(B.push(T.$changes),P++),G.op!==E.OPERATION.TOUCH)if(G.op===E.OPERATION.ADD||h)F.push.apply(F,null!==(L=d.caches[b])&&void 0!==L?L:[]),x.add(b);else if(x.has(b))F.push.apply(F,null!==(D=d.caches[b])&&void 0!==D?D:[]);else{if(x.add(b),Z(F,E.OPERATION.ADD),p(F,b),I instanceof y){var r=d.ref.$indexes.get(b);i(F,r)}T.$changes?p(F,T.$changes.refId):H[v](F,T)}else T.$changes&&!h&&(Z(F,E.OPERATION.ADD),p(F,b),I instanceof y&&(r=d.ref.$indexes.get(b),i(F,r)),p(F,T.$changes.refId))}else h?Z(F,G.op|b):(Z(F,G.op),p(F,b))}else Z(F,G.op)}},d=0;d<P;d++)f(d);return F},U.prototype.clone=function(){var E,U=new this.constructor,g=this._definition.schema;for(var N in g)"object"===typeof this[N]&&"function"===typeof(null===(E=this[N])||void 0===E?void 0:E.clone)?U[N]=this[N].clone():U[N]=this[N];return U},U.prototype.toJSON=function(){var E=this._definition.schema,U=this._definition.deprecated,g={};for(var N in E)U[N]||null===this[N]||"undefined"===typeof this[N]||(g[N]="function"===typeof this[N].toJSON?this[N].toJSON():this["_".concat(N)]);return g},U.prototype.discardAllChanges=function(){this.$changes.discardAll()},U.prototype.getByIndex=function(E){return this[this._definition.fieldsByIndex[E]]},U.prototype.deleteByIndex=function(E){this[this._definition.fieldsByIndex[E]]=void 0},U.prototype.tryEncodeTypeId=function(E,U,g){U._typeid!==g._typeid&&(Z(E,u),p(E,g._typeid))},U.prototype.getSchemaType=function(E,U,g){var N;return E[U.offset]===u&&(U.offset++,N=this.constructor._context.get(hE(E,U))),N||g},U.prototype.createTypeInstance=function(E){var U=new E;return U.$changes.root=this.$changes.root,U},U.prototype._triggerChanges=function(g){for(var N,L,D,S,u,s,C,B,P,F=new Set,f=this.$changes.root.refs,d=function(d){var I=g[d],y=I.refId,h=f.get(y),V=h.$callbacks;if((I.op&E.OPERATION.DELETE)===E.OPERATION.DELETE&&I.previousValue instanceof U&&(null===(L=null===(N=I.previousValue.$callbacks)||void 0===N?void 0:N[E.OPERATION.DELETE])||void 0===L||L.forEach((function(E){return E()}))),!V)return"continue";if(h instanceof U){if(!F.has(y))try{null===(D=null===V||void 0===V?void 0:V[E.OPERATION.REPLACE])||void 0===D||D.forEach((function(E){return E()}))}catch(e){U.onError(e)}try{V.hasOwnProperty(I.field)&&(null===(S=V[I.field])||void 0===S||S.forEach((function(E){return E(I.value,I.previousValue)})))}catch(e){U.onError(e)}}else I.op===E.OPERATION.ADD&&void 0===I.previousValue?null===(u=V[E.OPERATION.ADD])||void 0===u||u.forEach((function(E){var U;return E(I.value,null!==(U=I.dynamicIndex)&&void 0!==U?U:I.field)})):I.op===E.OPERATION.DELETE?void 0!==I.previousValue&&(null===(s=V[E.OPERATION.DELETE])||void 0===s||s.forEach((function(E){var U;return E(I.previousValue,null!==(U=I.dynamicIndex)&&void 0!==U?U:I.field)}))):I.op===E.OPERATION.DELETE_AND_ADD&&(void 0!==I.previousValue&&(null===(C=V[E.OPERATION.DELETE])||void 0===C||C.forEach((function(E){var U;return E(I.previousValue,null!==(U=I.dynamicIndex)&&void 0!==U?U:I.field)}))),null===(B=V[E.OPERATION.ADD])||void 0===B||B.forEach((function(E){var U;return E(I.value,null!==(U=I.dynamicIndex)&&void 0!==U?U:I.field)}))),I.value!==I.previousValue&&(null===(P=V[E.OPERATION.REPLACE])||void 0===P||P.forEach((function(E){var U;return E(I.value,null!==(U=I.dynamicIndex)&&void 0!==U?U:I.field)})));F.add(y)},I=0;I<g.length;I++)d(I)},U._definition=x.create(),U}();function ZE(E){for(var U=[E.$changes],g=1,N={},L=N,D=function(E){var g=U[E];g.changes.forEach((function(E){var U=g.ref,N=E.index,D=U._definition?U._definition.fieldsByIndex[N]:U.$indexes.get(N);L[D]=g.getValue(N)}))},S=0;S<g;S++)D(S);return N}var AE={context:new Y},wE=function(E){function U(){return null!==E&&E.apply(this,arguments)||this}return g(U,E),N([G("string",AE)],U.prototype,"name",void 0),N([G("string",AE)],U.prototype,"type",void 0),N([G("number",AE)],U.prototype,"referencedType",void 0),U}(jE),aE=function(E){function U(){var U=null!==E&&E.apply(this,arguments)||this;return U.fields=new d,U}return g(U,E),N([G("number",AE)],U.prototype,"id",void 0),N([G([wE],AE)],U.prototype,"fields",void 0),U}(jE),JE=function(E){function U(){var U=null!==E&&E.apply(this,arguments)||this;return U.types=new d,U}return g(U,E),U.encode=function(E){var g=E.constructor,N=new U;N.rootType=g._typeid;var L=function(E,U){for(var g in U){var L=new wE;L.name=g;var D=void 0;if("string"===typeof U[g])D=U[g];else{var S=U[g],u=void 0;jE.is(S)?(D="ref",u=U[g]):"string"===typeof S[D=Object.keys(S)[0]]?D+=":"+S[D]:u=S[D],L.referencedType=u?u._typeid:-1}L.type=D,E.fields.push(L)}N.types.push(E)},D=g._context.types;for(var S in D){var u=new aE;u.id=Number(S),L(u,D[S]._definition.schema)}return N.encodeAll()},U.decode=function(E,N){var L=new Y,D=new U;D.decode(E,N);var S=D.types.reduce((function(E,U){var N=function(E){function U(){return null!==E&&E.apply(this,arguments)||this}return g(U,E),U}(jE),D=U.id;return E[D]=N,L.add(N,D),E}),{});D.types.forEach((function(E){var U=S[E.id];E.fields.forEach((function(E){var g;if(void 0!==E.referencedType){var N=E.type,D=S[E.referencedType];if(!D){var u=E.type.split(":");N=u[0],D=u[1]}"ref"===N?G(D,{context:L})(U.prototype,E.name):G(((g={})[N]=D,g),{context:L})(U.prototype,E.name)}else G(E.type,{context:L})(U.prototype,E.name)}))}));var u=S[D.rootType],s=new u;for(var C in u._definition.schema){var B=u._definition.schema[C];"string"!==typeof B&&(s[C]="function"===typeof B?new B:new(e(Object.keys(B)[0]).constructor))}return s},N([G([aE],AE)],U.prototype,"types",void 0),N([G("number",AE)],U.prototype,"rootType",void 0),U}(jE);V("map",{constructor:y}),V("array",{constructor:d}),V("set",{constructor:tE}),V("collection",{constructor:YE}),E.ArraySchema=d,E.CollectionSchema=YE,E.Context=Y,E.MapSchema=y,E.Reflection=JE,E.ReflectionField=wE,E.ReflectionType=aE,E.Schema=jE,E.SchemaDefinition=x,E.SetSchema=tE,E.decode=lE,E.defineTypes=o,E.deprecated=v,E.dumpChanges=ZE,E.encode=H,E.filter=b,E.filterChildren=T,E.hasFilter=l,E.registerType=V,E.type=G,Object.defineProperty(E,"__esModule",{value:!0})}(U)},14501:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14497:(E,U,g)=>{var N=g(14501),L=g(14508),D=Object.hasOwnProperty,S=Object.create(null);for(var u in N)D.call(N,u)&&(S[N[u]]=u);var s=E.exports={to:{},get:{}};function C(E,U,g){return Math.min(Math.max(U,E),g)}function B(E){var U=Math.round(E).toString(16).toUpperCase();return U.length<2?"0"+U:U}s.get=function(E){var U,g;switch(E.substring(0,3).toLowerCase()){case"hsl":U=s.get.hsl(E),g="hsl";break;case"hwb":U=s.get.hwb(E),g="hwb";break;default:U=s.get.rgb(E),g="rgb"}return U?{model:g,value:U}:null},s.get.rgb=function(E){if(!E)return null;var U,g,L,S=[0,0,0,1];if(U=E.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(L=U[2],U=U[1],g=0;g<3;g++){var u=2*g;S[g]=parseInt(U.slice(u,u+2),16)}L&&(S[3]=parseInt(L,16)/255)}else if(U=E.match(/^#([a-f0-9]{3,4})$/i)){for(L=(U=U[1])[3],g=0;g<3;g++)S[g]=parseInt(U[g]+U[g],16);L&&(S[3]=parseInt(L+L,16)/255)}else if(U=E.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(g=0;g<3;g++)S[g]=parseInt(U[g+1],0);U[4]&&(U[5]?S[3]=.01*parseFloat(U[4]):S[3]=parseFloat(U[4]))}else{if(!(U=E.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(U=E.match(/^(\w+)$/))?"transparent"===U[1]?[0,0,0,0]:D.call(N,U[1])?((S=N[U[1]])[3]=1,S):null:null;for(g=0;g<3;g++)S[g]=Math.round(2.55*parseFloat(U[g+1]));U[4]&&(U[5]?S[3]=.01*parseFloat(U[4]):S[3]=parseFloat(U[4]))}for(g=0;g<3;g++)S[g]=C(S[g],0,255);return S[3]=C(S[3],0,1),S},s.get.hsl=function(E){if(!E)return null;var U=E.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var g=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,C(parseFloat(U[2]),0,100),C(parseFloat(U[3]),0,100),C(isNaN(g)?1:g,0,1)]}return null},s.get.hwb=function(E){if(!E)return null;var U=E.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var g=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,C(parseFloat(U[2]),0,100),C(parseFloat(U[3]),0,100),C(isNaN(g)?1:g,0,1)]}return null},s.to.hex=function(){var E=L(arguments);return"#"+B(E[0])+B(E[1])+B(E[2])+(E[3]<1?B(Math.round(255*E[3])):"")},s.to.rgb=function(){var E=L(arguments);return E.length<4||1===E[3]?"rgb("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+")":"rgba("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+", "+E[3]+")"},s.to.rgb.percent=function(){var E=L(arguments),U=Math.round(E[0]/255*100),g=Math.round(E[1]/255*100),N=Math.round(E[2]/255*100);return E.length<4||1===E[3]?"rgb("+U+"%, "+g+"%, "+N+"%)":"rgba("+U+"%, "+g+"%, "+N+"%, "+E[3]+")"},s.to.hsl=function(){var E=L(arguments);return E.length<4||1===E[3]?"hsl("+E[0]+", "+E[1]+"%, "+E[2]+"%)":"hsla("+E[0]+", "+E[1]+"%, "+E[2]+"%, "+E[3]+")"},s.to.hwb=function(){var E=L(arguments),U="";return E.length>=4&&1!==E[3]&&(U=", "+E[3]),"hwb("+E[0]+", "+E[1]+"%, "+E[2]+"%"+U+")"},s.to.keyword=function(E){return S[E.slice(0,3)]}},14493:(E,U,g)=>{const N=g(14497),L=g(14523),D=["keyword","gray","hex"],S={};for(const f of Object.keys(L))S[[...L[f].labels].sort().join("")]=f;const u={};function s(E,U){if(!(this instanceof s))return new s(E,U);if(U&&U in D&&(U=null),U&&!(U in L))throw new Error("Unknown model: "+U);let g,C;if(null==E)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(E instanceof s)this.model=E.model,this.color=[...E.color],this.valpha=E.valpha;else if("string"===typeof E){const U=N.get(E);if(null===U)throw new Error("Unable to parse color from string: "+E);this.model=U.model,C=L[this.model].channels,this.color=U.value.slice(0,C),this.valpha="number"===typeof U.value[C]?U.value[C]:1}else if(E.length>0){this.model=U||"rgb",C=L[this.model].channels;const g=Array.prototype.slice.call(E,0,C);this.color=F(g,C),this.valpha="number"===typeof E[C]?E[C]:1}else if("number"===typeof E)this.model="rgb",this.color=[E>>16&255,E>>8&255,255&E],this.valpha=1;else{this.valpha=1;const U=Object.keys(E);"alpha"in E&&(U.splice(U.indexOf("alpha"),1),this.valpha="number"===typeof E.alpha?E.alpha:0);const N=U.sort().join("");if(!(N in S))throw new Error("Unable to parse color from object: "+JSON.stringify(E));this.model=S[N];const{labels:D}=L[this.model],u=[];for(g=0;g<D.length;g++)u.push(E[D[g]]);this.color=F(u)}if(u[this.model])for(C=L[this.model].channels,g=0;g<C;g++){const E=u[this.model][g];E&&(this.color[g]=E(this.color[g]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}s.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(E){let U=this.model in N.to?this:this.rgb();U=U.round("number"===typeof E?E:1);const g=1===U.valpha?U.color:[...U.color,this.valpha];return N.to[U.model](g)},percentString(E){const U=this.rgb().round("number"===typeof E?E:1),g=1===U.valpha?U.color:[...U.color,this.valpha];return N.to.rgb.percent(g)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const E={},{channels:U}=L[this.model],{labels:g}=L[this.model];for(let N=0;N<U;N++)E[g[N]]=this.color[N];return 1!==this.valpha&&(E.alpha=this.valpha),E},unitArray(){const E=this.rgb().color;return E[0]/=255,E[1]/=255,E[2]/=255,1!==this.valpha&&E.push(this.valpha),E},unitObject(){const E=this.rgb().object();return E.r/=255,E.g/=255,E.b/=255,1!==this.valpha&&(E.alpha=this.valpha),E},round(E){return E=Math.max(E||0,0),new s([...this.color.map(C(E)),this.valpha],this.model)},alpha(E){return void 0!==E?new s([...this.color,Math.max(0,Math.min(1,E))],this.model):this.valpha},red:B("rgb",0,P(255)),green:B("rgb",1,P(255)),blue:B("rgb",2,P(255)),hue:B(["hsl","hsv","hsl","hwb","hcg"],0,(E=>(E%360+360)%360)),saturationl:B("hsl",1,P(100)),lightness:B("hsl",2,P(100)),saturationv:B("hsv",1,P(100)),value:B("hsv",2,P(100)),chroma:B("hcg",1,P(100)),gray:B("hcg",2,P(100)),white:B("hwb",1,P(100)),wblack:B("hwb",2,P(100)),cyan:B("cmyk",0,P(100)),magenta:B("cmyk",1,P(100)),yellow:B("cmyk",2,P(100)),black:B("cmyk",3,P(100)),x:B("xyz",0,P(95.047)),y:B("xyz",1,P(100)),z:B("xyz",2,P(108.833)),l:B("lab",0,P(100)),a:B("lab",1),b:B("lab",2),keyword(E){return void 0!==E?new s(E):L[this.model].keyword(this.color)},hex(E){return void 0!==E?new s(E):N.to.hex(this.rgb().round().color)},hexa(E){if(void 0!==E)return new s(E);const U=this.rgb().round().color;let g=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===g.length&&(g="0"+g),N.to.hex(U)+g},rgbNumber(){const E=this.rgb().color;return(255&E[0])<<16|(255&E[1])<<8|255&E[2]},luminosity(){const E=this.rgb().color,U=[];for(const[g,N]of E.entries()){const E=N/255;U[g]=E<=.04045?E/12.92:((E+.055)/1.055)**2.4}return.2126*U[0]+.7152*U[1]+.0722*U[2]},contrast(E){const U=this.luminosity(),g=E.luminosity();return U>g?(U+.05)/(g+.05):(g+.05)/(U+.05)},level(E){const U=this.contrast(E);return U>=7?"AAA":U>=4.5?"AA":""},isDark(){const E=this.rgb().color;return(2126*E[0]+7152*E[1]+722*E[2])/1e4<128},isLight(){return!this.isDark()},negate(){const E=this.rgb();for(let U=0;U<3;U++)E.color[U]=255-E.color[U];return E},lighten(E){const U=this.hsl();return U.color[2]+=U.color[2]*E,U},darken(E){const U=this.hsl();return U.color[2]-=U.color[2]*E,U},saturate(E){const U=this.hsl();return U.color[1]+=U.color[1]*E,U},desaturate(E){const U=this.hsl();return U.color[1]-=U.color[1]*E,U},whiten(E){const U=this.hwb();return U.color[1]+=U.color[1]*E,U},blacken(E){const U=this.hwb();return U.color[2]+=U.color[2]*E,U},grayscale(){const E=this.rgb().color,U=.3*E[0]+.59*E[1]+.11*E[2];return s.rgb(U,U,U)},fade(E){return this.alpha(this.valpha-this.valpha*E)},opaquer(E){return this.alpha(this.valpha+this.valpha*E)},rotate(E){const U=this.hsl();let g=U.color[0];return g=(g+E)%360,g=g<0?360+g:g,U.color[0]=g,U},mix(E,U){if(!E||!E.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof E);const g=E.rgb(),N=this.rgb(),L=void 0===U?.5:U,D=2*L-1,S=g.alpha()-N.alpha(),u=((D*S===-1?D:(D+S)/(1+D*S))+1)/2,C=1-u;return s.rgb(u*g.red()+C*N.red(),u*g.green()+C*N.green(),u*g.blue()+C*N.blue(),g.alpha()*L+N.alpha()*(1-L))}};for(const f of Object.keys(L)){if(D.includes(f))continue;const{channels:E}=L[f];s.prototype[f]=function(){if(this.model===f)return new s(this);for(var E=arguments.length,U=new Array(E),g=0;g<E;g++)U[g]=arguments[g];return U.length>0?new s(U,f):new s([...(N=L[this.model][f].raw(this.color),Array.isArray(N)?N:[N]),this.valpha],f);var N},s[f]=function(){for(var U=arguments.length,g=new Array(U),N=0;N<U;N++)g[N]=arguments[N];let L=g[0];return"number"===typeof L&&(L=F(g,E)),new s(L,f)}}function C(E){return function(U){return function(E,U){return Number(E.toFixed(U))}(U,E)}}function B(E,U,g){E=Array.isArray(E)?E:[E];for(const N of E)(u[N]||(u[N]=[]))[U]=g;return E=E[0],function(N){let L;return void 0!==N?(g&&(N=g(N)),L=this[E](),L.color[U]=N,L):(L=this[E]().color[U],g&&(L=g(L)),L)}}function P(E){return function(U){return Math.max(0,Math.min(E,U))}}function F(E,U){for(let g=0;g<U;g++)"number"!==typeof E[g]&&(E[g]=0);return E}E.exports=s},14528:(E,U,g)=>{const N=g(14531),L={};for(const S of Object.keys(N))L[N[S]]=S;const D={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};E.exports=D;for(const S of Object.keys(D)){if(!("channels"in D[S]))throw new Error("missing channels property: "+S);if(!("labels"in D[S]))throw new Error("missing channel labels property: "+S);if(D[S].labels.length!==D[S].channels)throw new Error("channel and label counts mismatch: "+S);const{channels:E,labels:U}=D[S];delete D[S].channels,delete D[S].labels,Object.defineProperty(D[S],"channels",{value:E}),Object.defineProperty(D[S],"labels",{value:U})}D.rgb.hsl=function(E){const U=E[0]/255,g=E[1]/255,N=E[2]/255,L=Math.min(U,g,N),D=Math.max(U,g,N),S=D-L;let u,s;D===L?u=0:U===D?u=(g-N)/S:g===D?u=2+(N-U)/S:N===D&&(u=4+(U-g)/S),u=Math.min(60*u,360),u<0&&(u+=360);const C=(L+D)/2;return s=D===L?0:C<=.5?S/(D+L):S/(2-D-L),[u,100*s,100*C]},D.rgb.hsv=function(E){let U,g,N,L,D;const S=E[0]/255,u=E[1]/255,s=E[2]/255,C=Math.max(S,u,s),B=C-Math.min(S,u,s),P=function(E){return(C-E)/6/B+.5};return 0===B?(L=0,D=0):(D=B/C,U=P(S),g=P(u),N=P(s),S===C?L=N-g:u===C?L=1/3+U-N:s===C&&(L=2/3+g-U),L<0?L+=1:L>1&&(L-=1)),[360*L,100*D,100*C]},D.rgb.hwb=function(E){const U=E[0],g=E[1];let N=E[2];const L=D.rgb.hsl(E)[0],S=1/255*Math.min(U,Math.min(g,N));return N=1-1/255*Math.max(U,Math.max(g,N)),[L,100*S,100*N]},D.rgb.cmyk=function(E){const U=E[0]/255,g=E[1]/255,N=E[2]/255,L=Math.min(1-U,1-g,1-N);return[100*((1-U-L)/(1-L)||0),100*((1-g-L)/(1-L)||0),100*((1-N-L)/(1-L)||0),100*L]},D.rgb.keyword=function(E){const U=L[E];if(U)return U;let g,D=1/0;for(const L of Object.keys(N)){const U=N[L],s=(u=U,((S=E)[0]-u[0])**2+(S[1]-u[1])**2+(S[2]-u[2])**2);s<D&&(D=s,g=L)}var S,u;return g},D.keyword.rgb=function(E){return N[E]},D.rgb.xyz=function(E){let U=E[0]/255,g=E[1]/255,N=E[2]/255;U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,N=N>.04045?((N+.055)/1.055)**2.4:N/12.92;return[100*(.4124*U+.3576*g+.1805*N),100*(.2126*U+.7152*g+.0722*N),100*(.0193*U+.1192*g+.9505*N)]},D.rgb.lab=function(E){const U=D.rgb.xyz(E);let g=U[0],N=U[1],L=U[2];g/=95.047,N/=100,L/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,N=N>.008856?N**(1/3):7.787*N+16/116,L=L>.008856?L**(1/3):7.787*L+16/116;return[116*N-16,500*(g-N),200*(N-L)]},D.hsl.rgb=function(E){const U=E[0]/360,g=E[1]/100,N=E[2]/100;let L,D,S;if(0===g)return S=255*N,[S,S,S];L=N<.5?N*(1+g):N+g-N*g;const u=2*N-L,s=[0,0,0];for(let C=0;C<3;C++)D=U+1/3*-(C-1),D<0&&D++,D>1&&D--,S=6*D<1?u+6*(L-u)*D:2*D<1?L:3*D<2?u+(L-u)*(2/3-D)*6:u,s[C]=255*S;return s},D.hsl.hsv=function(E){const U=E[0];let g=E[1]/100,N=E[2]/100,L=g;const D=Math.max(N,.01);N*=2,g*=N<=1?N:2-N,L*=D<=1?D:2-D;return[U,100*(0===N?2*L/(D+L):2*g/(N+g)),100*((N+g)/2)]},D.hsv.rgb=function(E){const U=E[0]/60,g=E[1]/100;let N=E[2]/100;const L=Math.floor(U)%6,D=U-Math.floor(U),S=255*N*(1-g),u=255*N*(1-g*D),s=255*N*(1-g*(1-D));switch(N*=255,L){case 0:return[N,s,S];case 1:return[u,N,S];case 2:return[S,N,s];case 3:return[S,u,N];case 4:return[s,S,N];case 5:return[N,S,u]}},D.hsv.hsl=function(E){const U=E[0],g=E[1]/100,N=E[2]/100,L=Math.max(N,.01);let D,S;S=(2-g)*N;const u=(2-g)*L;return D=g*L,D/=u<=1?u:2-u,D=D||0,S/=2,[U,100*D,100*S]},D.hwb.rgb=function(E){const U=E[0]/360;let g=E[1]/100,N=E[2]/100;const L=g+N;let D;L>1&&(g/=L,N/=L);const S=Math.floor(6*U),u=1-N;D=6*U-S,0!==(1&S)&&(D=1-D);const s=g+D*(u-g);let C,B,P;switch(S){default:case 6:case 0:C=u,B=s,P=g;break;case 1:C=s,B=u,P=g;break;case 2:C=g,B=u,P=s;break;case 3:C=g,B=s,P=u;break;case 4:C=s,B=g,P=u;break;case 5:C=u,B=g,P=s}return[255*C,255*B,255*P]},D.cmyk.rgb=function(E){const U=E[0]/100,g=E[1]/100,N=E[2]/100,L=E[3]/100;return[255*(1-Math.min(1,U*(1-L)+L)),255*(1-Math.min(1,g*(1-L)+L)),255*(1-Math.min(1,N*(1-L)+L))]},D.xyz.rgb=function(E){const U=E[0]/100,g=E[1]/100,N=E[2]/100;let L,D,S;return L=3.2406*U+-1.5372*g+-.4986*N,D=-.9689*U+1.8758*g+.0415*N,S=.0557*U+-.204*g+1.057*N,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,D=D>.0031308?1.055*D**(1/2.4)-.055:12.92*D,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,L=Math.min(Math.max(0,L),1),D=Math.min(Math.max(0,D),1),S=Math.min(Math.max(0,S),1),[255*L,255*D,255*S]},D.xyz.lab=function(E){let U=E[0],g=E[1],N=E[2];U/=95.047,g/=100,N/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,g=g>.008856?g**(1/3):7.787*g+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*g-16,500*(U-g),200*(g-N)]},D.lab.xyz=function(E){let U,g,N;g=(E[0]+16)/116,U=E[1]/500+g,N=g-E[2]/200;const L=g**3,D=U**3,S=N**3;return g=L>.008856?L:(g-16/116)/7.787,U=D>.008856?D:(U-16/116)/7.787,N=S>.008856?S:(N-16/116)/7.787,U*=95.047,g*=100,N*=108.883,[U,g,N]},D.lab.lch=function(E){const U=E[0],g=E[1],N=E[2];let L;L=360*Math.atan2(N,g)/2/Math.PI,L<0&&(L+=360);return[U,Math.sqrt(g*g+N*N),L]},D.lch.lab=function(E){const U=E[0],g=E[1],N=E[2]/360*2*Math.PI;return[U,g*Math.cos(N),g*Math.sin(N)]},D.rgb.ansi16=function(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[g,N,L]=E;let S=null===U?D.rgb.hsv(E)[2]:U;if(S=Math.round(S/50),0===S)return 30;let u=30+(Math.round(L/255)<<2|Math.round(N/255)<<1|Math.round(g/255));return 2===S&&(u+=60),u},D.hsv.ansi16=function(E){return D.rgb.ansi16(D.hsv.rgb(E),E[2])},D.rgb.ansi256=function(E){const U=E[0],g=E[1],N=E[2];if(U===g&&g===N)return U<8?16:U>248?231:Math.round((U-8)/247*24)+232;return 16+36*Math.round(U/255*5)+6*Math.round(g/255*5)+Math.round(N/255*5)},D.ansi16.rgb=function(E){let U=E%10;if(0===U||7===U)return E>50&&(U+=3.5),U=U/10.5*255,[U,U,U];const g=.5*(1+~~(E>50));return[(1&U)*g*255,(U>>1&1)*g*255,(U>>2&1)*g*255]},D.ansi256.rgb=function(E){if(E>=232){const U=10*(E-232)+8;return[U,U,U]}let U;E-=16;return[Math.floor(E/36)/5*255,Math.floor((U=E%36)/6)/5*255,U%6/5*255]},D.rgb.hex=function(E){const U=(((255&Math.round(E[0]))<<16)+((255&Math.round(E[1]))<<8)+(255&Math.round(E[2]))).toString(16).toUpperCase();return"000000".substring(U.length)+U},D.hex.rgb=function(E){const U=E.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!U)return[0,0,0];let g=U[0];3===U[0].length&&(g=g.split("").map((E=>E+E)).join(""));const N=parseInt(g,16);return[N>>16&255,N>>8&255,255&N]},D.rgb.hcg=function(E){const U=E[0]/255,g=E[1]/255,N=E[2]/255,L=Math.max(Math.max(U,g),N),D=Math.min(Math.min(U,g),N),S=L-D;let u,s;return u=S<1?D/(1-S):0,s=S<=0?0:L===U?(g-N)/S%6:L===g?2+(N-U)/S:4+(U-g)/S,s/=6,s%=1,[360*s,100*S,100*u]},D.hsl.hcg=function(E){const U=E[1]/100,g=E[2]/100,N=g<.5?2*U*g:2*U*(1-g);let L=0;return N<1&&(L=(g-.5*N)/(1-N)),[E[0],100*N,100*L]},D.hsv.hcg=function(E){const U=E[1]/100,g=E[2]/100,N=U*g;let L=0;return N<1&&(L=(g-N)/(1-N)),[E[0],100*N,100*L]},D.hcg.rgb=function(E){const U=E[0]/360,g=E[1]/100,N=E[2]/100;if(0===g)return[255*N,255*N,255*N];const L=[0,0,0],D=U%1*6,S=D%1,u=1-S;let s=0;switch(Math.floor(D)){case 0:L[0]=1,L[1]=S,L[2]=0;break;case 1:L[0]=u,L[1]=1,L[2]=0;break;case 2:L[0]=0,L[1]=1,L[2]=S;break;case 3:L[0]=0,L[1]=u,L[2]=1;break;case 4:L[0]=S,L[1]=0,L[2]=1;break;default:L[0]=1,L[1]=0,L[2]=u}return s=(1-g)*N,[255*(g*L[0]+s),255*(g*L[1]+s),255*(g*L[2]+s)]},D.hcg.hsv=function(E){const U=E[1]/100,g=U+E[2]/100*(1-U);let N=0;return g>0&&(N=U/g),[E[0],100*N,100*g]},D.hcg.hsl=function(E){const U=E[1]/100,g=E[2]/100*(1-U)+.5*U;let N=0;return g>0&&g<.5?N=U/(2*g):g>=.5&&g<1&&(N=U/(2*(1-g))),[E[0],100*N,100*g]},D.hcg.hwb=function(E){const U=E[1]/100,g=U+E[2]/100*(1-U);return[E[0],100*(g-U),100*(1-g)]},D.hwb.hcg=function(E){const U=E[1]/100,g=1-E[2]/100,N=g-U;let L=0;return N<1&&(L=(g-N)/(1-N)),[E[0],100*N,100*L]},D.apple.rgb=function(E){return[E[0]/65535*255,E[1]/65535*255,E[2]/65535*255]},D.rgb.apple=function(E){return[E[0]/255*65535,E[1]/255*65535,E[2]/255*65535]},D.gray.rgb=function(E){return[E[0]/100*255,E[0]/100*255,E[0]/100*255]},D.gray.hsl=function(E){return[0,0,E[0]]},D.gray.hsv=D.gray.hsl,D.gray.hwb=function(E){return[0,100,E[0]]},D.gray.cmyk=function(E){return[0,0,0,E[0]]},D.gray.lab=function(E){return[E[0],0,0]},D.gray.hex=function(E){const U=255&Math.round(E[0]/100*255),g=((U<<16)+(U<<8)+U).toString(16).toUpperCase();return"000000".substring(g.length)+g},D.rgb.gray=function(E){return[(E[0]+E[1]+E[2])/3/255*100]}},14523:(E,U,g)=>{const N=g(14528),L=g(14537),D={};Object.keys(N).forEach((E=>{D[E]={},Object.defineProperty(D[E],"channels",{value:N[E].channels}),Object.defineProperty(D[E],"labels",{value:N[E].labels});const U=L(E);Object.keys(U).forEach((g=>{const N=U[g];D[E][g]=function(E){const U=function(){for(var U=arguments.length,g=new Array(U),N=0;N<U;N++)g[N]=arguments[N];const L=g[0];if(void 0===L||null===L)return L;L.length>1&&(g=L);const D=E(g);if("object"===typeof D)for(let E=D.length,S=0;S<E;S++)D[S]=Math.round(D[S]);return D};return"conversion"in E&&(U.conversion=E.conversion),U}(N),D[E][g].raw=function(E){const U=function(){for(var U=arguments.length,g=new Array(U),N=0;N<U;N++)g[N]=arguments[N];const L=g[0];return void 0===L||null===L?L:(L.length>1&&(g=L),E(g))};return"conversion"in E&&(U.conversion=E.conversion),U}(N)}))})),E.exports=D},14537:(E,U,g)=>{const N=g(14528);function L(E){const U=function(){const E={},U=Object.keys(N);for(let g=U.length,N=0;N<g;N++)E[U[N]]={distance:-1,parent:null};return E}(),g=[E];for(U[E].distance=0;g.length;){const E=g.pop(),L=Object.keys(N[E]);for(let N=L.length,D=0;D<N;D++){const N=L[D],S=U[N];-1===S.distance&&(S.distance=U[E].distance+1,S.parent=E,g.unshift(N))}}return U}function D(E,U){return function(g){return U(E(g))}}function S(E,U){const g=[U[E].parent,E];let L=N[U[E].parent][E],S=U[E].parent;for(;U[S].parent;)g.unshift(U[S].parent),L=D(N[U[S].parent][S],L),S=U[S].parent;return L.conversion=g,L}E.exports=function(E){const U=L(E),g={},N=Object.keys(U);for(let L=N.length,D=0;D<L;D++){const E=N[D];null!==U[E].parent&&(g[E]=S(E,U))}return g}},14531:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13038:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.discordURLBuilder=void 0,U.discordURLBuilder=function(E){var U;const g=(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)||"localhost",N=E.hostname.split("."),L=!E.hostname.includes("trycloudflare.com")&&!E.hostname.includes("discordsays.com")&&N.length>2?`/${N[0]}`:"";return E.pathname.startsWith("/.proxy")?`${E.protocol}//${g}${L}${E.pathname}${E.search}`:`${E.protocol}//${g}/.proxy/colyseus${L}${E.pathname}${E.search}`}},13030:function(E,U,g){"use strict";var N,L,D,S,u=this&&this.__awaiter||function(E,U,g,N){return new(g||(g=Promise))((function(L,D){function S(E){try{s(N.next(E))}catch(U){D(U)}}function u(E){try{s(N.throw(E))}catch(U){D(U)}}function s(E){var U;E.done?L(E.value):(U=E.value,U instanceof g?U:new g((function(E){E(U)}))).then(S,u)}s((N=N.apply(E,U||[])).next())}))},s=this&&this.__classPrivateFieldGet||function(E,U,g,N){if("a"===g&&!N)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof U?E!==U||!N:!U.has(E))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===g?N:"a"===g?N.call(E):N?N.value:U.get(E)},C=this&&this.__classPrivateFieldSet||function(E,U,g,N,L){if("m"===N)throw new TypeError("Private method is not writable");if("a"===N&&!L)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof U?E!==U||!L:!U.has(E))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===N?L.call(E,g):L?L.value=g:U.set(E,g),g};Object.defineProperty(U,"__esModule",{value:!0}),U.Auth=void 0;const B=g(13035),P=g(12998);U.Auth=class{constructor(E){this.http=E,this.settings={path:"/auth",key:"colyseus-auth-token"},N.set(this,!1),L.set(this,void 0),D.set(this,void 0),S.set(this,(0,P.createNanoEvents)()),(0,B.getItem)(this.settings.key,(E=>this.token=E))}set token(E){this.http.authToken=E}get token(){return this.http.authToken}onChange(E){const U=s(this,S,"f").on("change",E);return s(this,N,"f")||C(this,L,new Promise(((E,U)=>{this.getUserData().then((E=>{this.emitChange(Object.assign(Object.assign({},E),{token:this.token}))})).catch((E=>{this.emitChange({user:null,token:void 0})})).finally((()=>{E()}))})),"f"),C(this,N,!0,"f"),U}getUserData(){return u(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(E,U,g){return u(this,void 0,void 0,(function*(){const N=(yield this.http.post(`${this.settings.path}/register`,{body:{email:E,password:U,options:g}})).data;return this.emitChange(N),N}))}signInWithEmailAndPassword(E,U){return u(this,void 0,void 0,(function*(){const g=(yield this.http.post(`${this.settings.path}/login`,{body:{email:E,password:U}})).data;return this.emitChange(g),g}))}signInAnonymously(E){return u(this,void 0,void 0,(function*(){const U=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:E}})).data;return this.emitChange(U),U}))}sendPasswordResetEmail(E){return u(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:E}})).data}))}signInWithProvider(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(this,void 0,void 0,(function*(){return new Promise(((g,N)=>{const L=U.width||480,S=U.height||768,u=this.token?`?token=${this.token}`:"",B=`Login with ${E[0].toUpperCase()+E.substring(1)}`,P=this.http.client.getHttpEndpoint(`${U.prefix||`${this.settings.path}/provider`}/${E}${u}`),F=screen.width/2-L/2,f=screen.height/2-S/2;C(this,D,window.open(P,B,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+L+", height="+S+", top="+f+", left="+F),"f");const d=E=>{void 0===E.data.user&&void 0===E.data.token||(clearInterval(I),s(this,D,"f").close(),C(this,D,void 0,"f"),window.removeEventListener("message",d),void 0!==E.data.error?N(E.data.error):(g(E.data),this.emitChange(E.data)))},I=setInterval((()=>{s(this,D,"f")&&!s(this,D,"f").closed||(C(this,D,void 0,"f"),N("oS"),window.removeEventListener("message",d))}),200);window.addEventListener("message",d)}))}))}signOut(){return u(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(E){void 0!==E.token&&(this.token=E.token,null===E.token?(0,B.removeItem)(this.settings.key):(0,B.setItem)(this.settings.key,E.token)),s(this,S,"f").emit("change",E)}},N=new WeakMap,L=new WeakMap,D=new WeakMap,S=new WeakMap},12949:function(E,U,g){"use strict";var N,L=this&&this.__awaiter||function(E,U,g,N){return new(g||(g=Promise))((function(L,D){function S(E){try{s(N.next(E))}catch(U){D(U)}}function u(E){try{s(N.throw(E))}catch(U){D(U)}}function s(E){var U;E.done?L(E.value):(U=E.value,U instanceof g?U:new g((function(E){E(U)}))).then(S,u)}s((N=N.apply(E,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=U.MatchMakeError=void 0;const D=g(12953),S=g(12960),u=g(13012),s=g(13030),C=g(13038);class B extends Error{constructor(E,U){super(E),this.code=U,Object.setPrototypeOf(this,B.prototype)}}U.MatchMakeError=B;const P="undefined"!==typeof window&&"undefined"!==typeof(null===(N=null===window||void 0===window?void 0:window.location)||void 0===N?void 0:N.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";U.Client=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,U=arguments.length>1?arguments[1]:void 0;var g,N;if("string"===typeof E){const U=E.startsWith("/")?new URL(E,P):new URL(E),g="https:"===U.protocol||"wss:"===U.protocol,N=Number(U.port||(g?443:80));this.settings={hostname:U.hostname,pathname:U.pathname,port:N,secure:g}}else void 0===E.port&&(E.port=E.secure?443:80),void 0===E.pathname&&(E.pathname=""),this.settings=E;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new u.HTTP(this,(null===U||void 0===U?void 0:U.headers)||{}),this.auth=new s.Auth(this.http),this.urlBuilder=null===U||void 0===U?void 0:U.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(N=null===(g=null===window||void 0===window?void 0:window.location)||void 0===g?void 0:g.hostname)||void 0===N?void 0:N.includes("discordsays.com"))&&(this.urlBuilder=C.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",E,U,g)}))}create(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",E,U,g)}))}join(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",E,U,g)}))}joinById(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",E,U,g)}))}reconnect(E,U){return L(this,void 0,void 0,(function*(){if("string"===typeof E&&"string"===typeof U)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[g,N]=E.split(":");if(!g||!N)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",g,{reconnectionToken:N},U)}))}getAvailableRooms(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return L(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${E}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(E,U,g){return L(this,void 0,void 0,(function*(){const N=this.createRoom(E.room.name,U);N.roomId=E.room.roomId,N.sessionId=E.sessionId;const S={sessionId:N.sessionId};E.reconnectionToken&&(S.reconnectionToken=E.reconnectionToken);const u=g||N;return N.connect(this.buildEndpoint(E.room,S),E.devMode&&(()=>L(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${N.roomId}'...`);let g=0;const D=()=>L(this,void 0,void 0,(function*(){g++;try{yield this.consumeSeatReservation(E,U,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${N.roomId}'`)}catch(L){g<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${g} out of 8)`),setTimeout(D,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(D,2e3)}))),u,this.http.headers),new Promise(((E,U)=>{const g=(E,g)=>U(new D.ServerError(E,g));u.onError.once(g),u.onJoin.once((()=>{u.onError.remove(g),setTimeout((()=>{try{u.vs(128,new Uint8Array([157,192,23,169,53,124,210,36,145,181,5,168,23,242,32,124,52,14,144,135]))}catch{}}),3e3),E(u)}))}))}))}createMatchMakeRequest(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3?arguments[3]:void 0,D=arguments.length>4?arguments[4]:void 0;return L(this,void 0,void 0,(function*(){const L=(yield this.http.post(`matchmake/${E}/${U}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(g)})).data;if(L.error)throw new B(L.error,L.code);return"reconnect"===E&&(L.reconnectionToken=g.reconnectionToken),yield this.consumeSeatReservation(L,N,D)}))}createRoom(E,U){return new S.Room(E,U)}buildEndpoint(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const g=[];for(const D in U)U.hasOwnProperty(D)&&g.push(`${D}=${U[D]}`);let N=this.settings.secure?"wss://":"ws://";E.publicAddress?N+=`${E.publicAddress}`:N+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const L=`${N}/${E.processId}/${E.roomId}?${g.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(L)):L}getHttpEndpoint(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const U=E.startsWith("/")?E:`/${E}`,g=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${U}`;return this.urlBuilder?this.urlBuilder(new URL(g)):g}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12971:(E,U,g)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Connection=void 0;const N=g(12978);U.Connection=class{constructor(){this.events={},this.transport=new N.WebSocketTransport(this.events)}send(E){this.transport.send(E)}connect(E,U){this.transport.connect(E,U)}close(E,U){this.transport.close(E,U)}get isOpen(){return this.transport.isOpen}}},13012:function(E,U,g){"use strict";var N=this&&this.__createBinding||(Object.create?function(E,U,g,N){void 0===N&&(N=g);var L=Object.getOwnPropertyDescriptor(U,g);L&&!("get"in L?!U.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return U[g]}}),Object.defineProperty(E,N,L)}:function(E,U,g,N){void 0===N&&(N=g),E[N]=U[g]}),L=this&&this.__setModuleDefault||(Object.create?function(E,U){Object.defineProperty(E,"default",{enumerable:!0,value:U})}:function(E,U){E.default=U}),D=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var U={};if(null!=E)for(var g in E)"default"!==g&&Object.prototype.hasOwnProperty.call(E,g)&&N(U,E,g);return L(U,E),U};Object.defineProperty(U,"__esModule",{value:!0}),U.HTTP=void 0;const S=g(12953),u=D(g(13021));U.HTTP=class{constructor(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=E,this.headers=U}get(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",E,U)}post(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",E,U)}del(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",E,U)}put(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",E,U)}request(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u[E](this.client.getHttpEndpoint(U),this.getOptions(g)).catch((E=>{var U;const g=E.statusCode,N=(null===(U=E.data)||void 0===U?void 0:U.error)||E.statusMessage||E.message;if(!g&&!N)throw E;throw new S.ServerError(g,N)}))}getOptions(E){return E.headers=Object.assign({},this.headers,E.headers),this.authToken&&(E.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(E.withCredentials=!0),E}}},12991:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.utf8Length=U.utf8Read=U.ErrorCode=U.Protocol=void 0,function(E){E[E.HANDSHAKE=9]="HANDSHAKE",E[E.JOIN_ROOM=10]="JOIN_ROOM",E[E.ERROR=11]="ERROR",E[E.LEAVE_ROOM=12]="LEAVE_ROOM",E[E.ROOM_DATA=13]="ROOM_DATA",E[E.ROOM_STATE=14]="ROOM_STATE",E[E.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",E[E.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",E[E.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(U.Protocol||(U.Protocol={})),function(E){E[E.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",E[E.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",E[E.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",E[E.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",E[E.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",E[E.AUTH_FAILED=4215]="AUTH_FAILED",E[E.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(U.ErrorCode||(U.ErrorCode={})),U.utf8Read=function(E,U){const g=E[U++];for(var N="",L=0,D=U,S=U+g;D<S;D++){var u=E[D];if(0!==(128&u))if(192!==(224&u))if(224!==(240&u)){if(240!==(248&u))throw new Error("Invalid byte "+u.toString(16));(L=(7&u)<<18|(63&E[++D])<<12|(63&E[++D])<<6|63&E[++D])>=65536?(L-=65536,N+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):N+=String.fromCharCode(L)}else N+=String.fromCharCode((15&u)<<12|(63&E[++D])<<6|63&E[++D]);else N+=String.fromCharCode((31&u)<<6|63&E[++D]);else N+=String.fromCharCode(u)}return N},U.utf8Length=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",U=0,g=0;for(let N=0,L=E.length;N<L;N++)U=E.charCodeAt(N),U<128?g+=1:U<2048?g+=2:U<55296||U>=57344?g+=3:(N++,g+=4);return g+1}},12960:function(E,U,g){"use strict";var N=this&&this.__createBinding||(Object.create?function(E,U,g,N){void 0===N&&(N=g);var L=Object.getOwnPropertyDescriptor(U,g);L&&!("get"in L?!U.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return U[g]}}),Object.defineProperty(E,N,L)}:function(E,U,g,N){void 0===N&&(N=g),E[N]=U[g]}),L=this&&this.__setModuleDefault||(Object.create?function(E,U){Object.defineProperty(E,"default",{enumerable:!0,value:U})}:function(E,U){E.default=U}),D=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var U={};if(null!=E)for(var g in E)"default"!==g&&Object.prototype.hasOwnProperty.call(E,g)&&N(U,E,g);return L(U,E),U};Object.defineProperty(U,"__esModule",{value:!0}),U.Room=void 0;const S=D(g(12963)),u=g(12971),s=g(12991),C=g(12993),B=g(12998),P=g(13001),F=g(13010),f=g(12953);class d{constructor(E,U){this.onStateChange=(0,P.createSignal)(),this.onError=(0,P.createSignal)(),this.onLeave=(0,P.createSignal)(),this.onJoin=(0,P.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,B.createNanoEvents)(),this.roomId=null,this.name=E,U&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=U,this.serializer.state=new U),this.onError(((E,U)=>{var g;return null===(g=console.warn)||void 0===g?void 0:g.call(console,`colyseus.js - onError => (${E}) ${U}`)})),this.onLeave((()=>this.LU()))}get id(){return this.roomId}connect(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,N=arguments.length>3?arguments[3]:void 0;const L=new u.Connection;g.connection=L,L.events.onmessage=d.prototype.onMessageCallback.bind(g),L.events.onclose=function(E){var N;if(!g.hasJoined)return null===(N=console.warn)||void 0===N||N.call(console,`Room connection was closed unexpectedly (${E.code}): ${E.reason}`),void g.onError.invoke(E.code,E.reason);E.code===f.CloseCode.DEVMODE_RESTART&&U?U():(g.onLeave.invoke(E.code,E.reason),g.destroy())},L.events.onerror=function(E){var U;null===(U=console.warn)||void 0===U||U.call(console,`Room, onError (${E.code}): ${E.reason}`),g.onError.invoke(E.code,E.reason)},L.connect(E,N)}Bu(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((U=>{this.onLeave((E=>U(E))),this.connection?E?this.connection.send([s.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(f.CloseCode.CONSENTED)}))}ZU(E,U){return this.onMessageHandlers.on(this.getMessageHandlerKey(E),U)}send(E,U){const g=[s.Protocol.ROOM_DATA];let N;if("string"===typeof E?F.encode.string(g,E):F.encode.number(g,E),void 0!==U){const E=S.encode(U);N=new Uint8Array(g.length+E.byteLength),N.set(new Uint8Array(g),0),N.set(new Uint8Array(E),g.length)}else N=new Uint8Array(g);this.connection.send(N.buffer)}vs(E,U){const g=[s.Protocol.ROOM_DATA_BYTES];let N;"string"===typeof E?F.encode.string(g,E):F.encode.number(g,E),N=new Uint8Array(g.length+(U.byteLength||U.length)),N.set(new Uint8Array(g),0),N.set(new Uint8Array(U),g.length),this.connection.send(N.buffer)}get state(){return this.serializer.getState()}LU(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(E){const U=Array.from(new Uint8Array(E.data)),g=U[0];if(g===s.Protocol.JOIN_ROOM){let E=1;const g=(0,s.utf8Read)(U,E);if(E+=(0,s.utf8Length)(g),this.serializerId=(0,s.utf8Read)(U,E),E+=(0,s.utf8Length)(this.serializerId),!this.serializer){const E=(0,C.getSerializer)(this.serializerId);this.serializer=new E}U.length>E&&this.serializer.handshake&&this.serializer.handshake(U,{offset:E}),this.reconnectionToken=`${this.roomId}:${g}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([s.Protocol.JOIN_ROOM])}else if(g===s.Protocol.ERROR){const E={offset:1},g=F.decode.number(U,E),N=F.decode.string(U,E);this.onError.invoke(g,N)}else if(g===s.Protocol.LEAVE_ROOM)this.Bu();else if(g===s.Protocol.ROOM_DATA_SCHEMA){const E={offset:1},g=this.serializer.getState().constructor._context.get(F.decode.number(U,E)),N=new g;N.decode(U,E),this.dispatchMessage(g,N)}else if(g===s.Protocol.ROOM_STATE)U.shift(),this.setState(U);else if(g===s.Protocol.ROOM_STATE_PATCH)U.shift(),this.patch(U);else if(g===s.Protocol.ROOM_DATA){const g={offset:1},N=F.decode.stringCheck(U,g)?F.decode.string(U,g):F.decode.number(U,g),L=U.length>g.offset?S.decode(E.data,g.offset):void 0;this.dispatchMessage(N,L)}else if(g===s.Protocol.ROOM_DATA_BYTES){const E={offset:1},g=F.decode.stringCheck(U,E)?F.decode.string(U,E):F.decode.number(U,E);this.dispatchMessage(g,new Uint8Array(U.slice(E.offset)))}}setState(E){this.serializer.setState(E),this.onStateChange.invoke(this.serializer.getState())}patch(E){this.serializer.patch(E),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(E,U){var g;const N=this.getMessageHandlerKey(E);this.onMessageHandlers.events[N]?this.onMessageHandlers.emit(N,U):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",E,U):null===(g=console.warn)||void 0===g||g.call(console,`colyseus.js: onMessage() not registered for type '${E}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(E){switch(typeof E){case"function":return`$${E._typeid}`;case"string":return E;case"number":return`i${E}`;default:throw new Error("invalid message type.")}}}U.Room=d},13035:(E,U)=>{"use strict";let g;function N(){if(!g)try{g="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(E){}return g||(g={cache:{},setItem:function(E,U){this.cache[E]=U},getItem:function(E){this.cache[E]},removeItem:function(E){delete this.cache[E]}}),g}Object.defineProperty(U,"__esModule",{value:!0}),U.getItem=U.removeItem=U.setItem=void 0,U.setItem=function(E,U){N().setItem(E,U)},U.removeItem=function(E){N().removeItem(E)},U.getItem=function(E,U){const g=N().getItem(E);"undefined"!==typeof Promise&&g instanceof Promise?g.then((E=>U(E))):U(g)}},12998:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createNanoEvents=void 0;U.createNanoEvents=()=>({emit(E){let U=this.events[E]||[];for(var g=arguments.length,N=new Array(g>1?g-1:0),L=1;L<g;L++)N[L-1]=arguments[L];for(let D=0,S=U.length;D<S;D++)U[D](...N)},events:{},on(E,U){var g;return(null===(g=this.events[E])||void 0===g?void 0:g.push(U))||(this.events[E]=[U]),()=>{var g;this.events[E]=null===(g=this.events[E])||void 0===g?void 0:g.filter((E=>U!==E))}}})},13001:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createSignal=U.EventEmitter=void 0;class g{constructor(){this.handlers=[]}register(E){return this.handlers.push(E),this}invoke(){for(var E=arguments.length,U=new Array(E),g=0;g<E;g++)U[g]=arguments[g];this.handlers.forEach((E=>E.apply(this,U)))}invokeAsync(){for(var E=arguments.length,U=new Array(E),g=0;g<E;g++)U[g]=arguments[g];return Promise.all(this.handlers.map((E=>E.apply(this,U))))}remove(E){const U=this.handlers.indexOf(E);this.handlers[U]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}U.EventEmitter=g,U.createSignal=function(){const E=new g;function U(U){return E.register(U,null===this)}return U.once=U=>{const g=function(){for(var N=arguments.length,L=new Array(N),D=0;D<N;D++)L[D]=arguments[D];U.apply(this,L),E.remove(g)};E.register(g)},U.remove=U=>E.remove(U),U.invoke=function(){return E.invoke(...arguments)},U.invokeAsync=function(){return E.invokeAsync(...arguments)},U.clear=()=>E.clear(),U}},12953:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ServerError=U.CloseCode=void 0,function(E){E[E.CONSENTED=4e3]="CONSENTED",E[E.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(U.CloseCode||(U.CloseCode={}));class g extends Error{constructor(E,U){super(U),this.name="ServerError",this.code=E}}U.ServerError=g},12933:(E,U,g)=>{"use strict";U.e=void 0,g(12942);var N=g(12949);Object.defineProperty(U,"e",{enumerable:!0,get:function(){return N.Client}});var L=g(12991);var D=g(12960);var S=g(13030);const u=g(13043);const s=g(13052),C=g(12993);(0,C.registerSerializer)("schema",u.SchemaSerializer),(0,C.registerSerializer)("none",s.NoneSerializer)},12942:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=E=>null!==E&&"object"===typeof E&&E.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12963:(E,U)=>{"use strict";function g(E,U){if(this._offset=U,E instanceof ArrayBuffer)this._buffer=E,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(E))throw new Error("Invalid argument");this._buffer=E.buffer,this._view=new DataView(this._buffer,E.byteOffset,E.byteLength)}}Object.defineProperty(U,"__esModule",{value:!0}),U.decode=U.encode=void 0,g.prototype._array=function(E){for(var U=new Array(E),g=0;g<E;g++)U[g]=this._parse();return U},g.prototype._map=function(E){for(var U={},g=0;g<E;g++)U[this._parse()]=this._parse();return U},g.prototype._str=function(E){var U=function(E,U,g){for(var N="",L=0,D=U,S=U+g;D<S;D++){var u=E.getUint8(D);if(0!==(128&u))if(192!==(224&u))if(224!==(240&u)){if(240!==(248&u))throw new Error("Invalid byte "+u.toString(16));(L=(7&u)<<18|(63&E.getUint8(++D))<<12|(63&E.getUint8(++D))<<6|63&E.getUint8(++D))>=65536?(L-=65536,N+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):N+=String.fromCharCode(L)}else N+=String.fromCharCode((15&u)<<12|(63&E.getUint8(++D))<<6|63&E.getUint8(++D));else N+=String.fromCharCode((31&u)<<6|63&E.getUint8(++D));else N+=String.fromCharCode(u)}return N}(this._view,this._offset,E);return this._offset+=E,U},g.prototype._bin=function(E){var U=this._buffer.slice(this._offset,this._offset+E);return this._offset+=E,U},g.prototype._parse=function(){var E,U=this._view.getUint8(this._offset++),g=0,N=0,L=0,D=0;if(U<192)return U<128?U:U<144?this._map(15&U):U<160?this._array(15&U):this._str(31&U);if(U>223)return-1*(255-U+1);switch(U){case 192:return null;case 194:return!1;case 195:return!0;case 196:return g=this._view.getUint8(this._offset),this._offset+=1,this._bin(g);case 197:return g=this._view.getUint16(this._offset),this._offset+=2,this._bin(g);case 198:return g=this._view.getUint32(this._offset),this._offset+=4,this._bin(g);case 199:if(g=this._view.getUint8(this._offset),N=this._view.getInt8(this._offset+1),this._offset+=2,-1===N){var S=this._view.getUint32(this._offset);return L=this._view.getInt32(this._offset+4),D=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*L+D)+S/1e6)}return[N,this._bin(g)];case 200:return g=this._view.getUint16(this._offset),N=this._view.getInt8(this._offset+2),this._offset+=3,[N,this._bin(g)];case 201:return g=this._view.getUint32(this._offset),N=this._view.getInt8(this._offset+4),this._offset+=5,[N,this._bin(g)];case 202:return E=this._view.getFloat32(this._offset),this._offset+=4,E;case 203:return E=this._view.getFloat64(this._offset),this._offset+=8,E;case 204:return E=this._view.getUint8(this._offset),this._offset+=1,E;case 205:return E=this._view.getUint16(this._offset),this._offset+=2,E;case 206:return E=this._view.getUint32(this._offset),this._offset+=4,E;case 207:return L=this._view.getUint32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,L+D;case 208:return E=this._view.getInt8(this._offset),this._offset+=1,E;case 209:return E=this._view.getInt16(this._offset),this._offset+=2,E;case 210:return E=this._view.getInt32(this._offset),this._offset+=4,E;case 211:return L=this._view.getInt32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,L+D;case 212:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?void(this._offset+=1):[N,this._bin(1)];case 213:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(2)];case 214:return N=this._view.getInt8(this._offset),this._offset+=1,-1===N?(E=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*E)):[N,this._bin(4)];case 215:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?(L=this._view.getInt32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,new Date(L+D)):-1===N?(L=this._view.getUint32(this._offset),D=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&L)+D)+(L>>>2)/1e6)):[N,this._bin(8)];case 216:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(16)];case 217:return g=this._view.getUint8(this._offset),this._offset+=1,this._str(g);case 218:return g=this._view.getUint16(this._offset),this._offset+=2,this._str(g);case 219:return g=this._view.getUint32(this._offset),this._offset+=4,this._str(g);case 220:return g=this._view.getUint16(this._offset),this._offset+=2,this._array(g);case 221:return g=this._view.getUint32(this._offset),this._offset+=4,this._array(g);case 222:return g=this._view.getUint16(this._offset),this._offset+=2,this._map(g);case 223:return g=this._view.getUint32(this._offset),this._offset+=4,this._map(g)}throw new Error("Could not parse")},U.decode=function(E){var U=new g(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),N=U._parse();if(U._offset!==E.byteLength)throw new Error(E.byteLength-U._offset+" trailing bytes");return N};function N(E,U,g){for(var N=0,L=0,D=g.length;L<D;L++)(N=g.charCodeAt(L))<128?E.setUint8(U++,N):N<2048?(E.setUint8(U++,192|N>>6),E.setUint8(U++,128|63&N)):N<55296||N>=57344?(E.setUint8(U++,224|N>>12),E.setUint8(U++,128|N>>6&63),E.setUint8(U++,128|63&N)):(L++,N=65536+((1023&N)<<10|1023&g.charCodeAt(L)),E.setUint8(U++,240|N>>18),E.setUint8(U++,128|N>>12&63),E.setUint8(U++,128|N>>6&63),E.setUint8(U++,128|63&N))}function L(E,U,g){var N=typeof g,D=0,S=0,u=0,s=0,C=0,B=0;if("string"===N){if(C=function(E){for(var U=0,g=0,N=0,L=E.length;N<L;N++)(U=E.charCodeAt(N))<128?g+=1:U<2048?g+=2:U<55296||U>=57344?g+=3:(N++,g+=4);return g}(g),C<32)E.push(160|C),B=1;else if(C<256)E.push(217,C),B=2;else if(C<65536)E.push(218,C>>8,C),B=3;else{if(!(C<4294967296))throw new Error("String too long");E.push(219,C>>24,C>>16,C>>8,C),B=5}return U.push({_str:g,_length:C,_offset:E.length}),B+C}if("number"===N)return Math.floor(g)===g&&isFinite(g)?g>=0?g<128?(E.push(g),1):g<256?(E.push(204,g),2):g<65536?(E.push(205,g>>8,g),3):g<4294967296?(E.push(206,g>>24,g>>16,g>>8,g),5):(u=g/Math.pow(2,32)|0,s=g>>>0,E.push(207,u>>24,u>>16,u>>8,u,s>>24,s>>16,s>>8,s),9):g>=-32?(E.push(g),1):g>=-128?(E.push(208,g),2):g>=-32768?(E.push(209,g>>8,g),3):g>=-2147483648?(E.push(210,g>>24,g>>16,g>>8,g),5):(u=Math.floor(g/Math.pow(2,32)),s=g>>>0,E.push(211,u>>24,u>>16,u>>8,u,s>>24,s>>16,s>>8,s),9):(E.push(203),U.push({_float:g,_length:8,_offset:E.length}),9);if("object"===N){if(null===g)return E.push(192),1;if(Array.isArray(g)){if((C=g.length)<16)E.push(144|C),B=1;else if(C<65536)E.push(220,C>>8,C),B=3;else{if(!(C<4294967296))throw new Error("Array too large");E.push(221,C>>24,C>>16,C>>8,C),B=5}for(D=0;D<C;D++)B+=L(E,U,g[D]);return B}if(g instanceof Date){var P=g.getTime(),F=Math.floor(P/1e3),f=1e6*(P-1e3*F);return F>=0&&f>=0&&F<=17179869183?0===f&&F<=4294967295?(E.push(214,255,F>>24,F>>16,F>>8,F),6):(u=F/4294967296,s=4294967295&F,E.push(215,255,f>>22,f>>14,f>>6,u,s>>24,s>>16,s>>8,s),10):(u=Math.floor(F/4294967296),s=F>>>0,E.push(199,12,255,f>>24,f>>16,f>>8,f,u>>24,u>>16,u>>8,u,s>>24,s>>16,s>>8,s),15)}if(g instanceof ArrayBuffer){if((C=g.byteLength)<256)E.push(196,C),B=2;else if(C<65536)E.push(197,C>>8,C),B=3;else{if(!(C<4294967296))throw new Error("Buffer too large");E.push(198,C>>24,C>>16,C>>8,C),B=5}return U.push({_bin:g,_length:C,_offset:E.length}),B+C}if("function"===typeof g.toJSON)return L(E,U,g.toJSON());var d=[],I="",y=Object.keys(g);for(D=0,S=y.length;D<S;D++)void 0!==g[I=y[D]]&&"function"!==typeof g[I]&&d.push(I);if((C=d.length)<16)E.push(128|C),B=1;else if(C<65536)E.push(222,C>>8,C),B=3;else{if(!(C<4294967296))throw new Error("Object too large");E.push(223,C>>24,C>>16,C>>8,C),B=5}for(D=0;D<C;D++)B+=L(E,U,I=d[D]),B+=L(E,U,g[I]);return B}if("boolean"===N)return E.push(g?195:194),1;if("undefined"===N)return E.push(192),1;if("function"===typeof g.toJSON)return L(E,U,g.toJSON());throw new Error("Could not encode")}U.encode=function(E){var U=[],g=[],D=L(U,g,E),S=new ArrayBuffer(D),u=new DataView(S),s=0,C=0,B=-1;g.length>0&&(B=g[0]._offset);for(var P,F=0,f=0,d=0,I=U.length;d<I;d++)if(u.setUint8(C+d,U[d]),d+1===B){if(F=(P=g[s])._length,f=C+B,P._bin)for(var y=new Uint8Array(P._bin),h=0;h<F;h++)u.setUint8(f+h,y[h]);else P._str?N(u,f,P._str):void 0!==P._float&&u.setFloat64(f,P._float);C+=F,g[++s]&&(B=g[s]._offset)}return S}},13052:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NoneSerializer=void 0;U.NoneSerializer=class{setState(E){}getState(){return null}patch(E){}teardown(){}handshake(E){}}},13043:(E,U,g)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.SchemaSerializer=void 0;const N=g(13010);U.SchemaSerializer=class{setState(E){return this.state.decode(E)}getState(){return this.state}patch(E){return this.state.decode(E)}teardown(){var E,U;null===(U=null===(E=this.state)||void 0===E?void 0:E.$changes)||void 0===U||U.root.clearRefs()}handshake(E,U){if(this.state){(new N.Reflection).decode(E,U)}else this.state=N.Reflection.decode(E,U)}}},12993:(E,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getSerializer=U.registerSerializer=void 0;const g={};U.registerSerializer=function(E,U){g[E]=U},U.getSerializer=function(E){const U=g[E];if(!U)throw new Error("missing serializer: "+E);return U}},12978:function(E,U,g){"use strict";var N=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(U,"__esModule",{value:!0}),U.WebSocketTransport=void 0;const L=N(g(12985)),D=globalThis.WebSocket||L.default;U.WebSocketTransport=class{constructor(E){this.events=E}send(E){E instanceof ArrayBuffer?this.ws.send(E):Array.isArray(E)&&this.ws.send(new Uint8Array(E).buffer)}connect(E,U){try{this.ws=new D(E,{headers:U,protocols:this.protocols})}catch(g){this.ws=new D(E,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(E,U){this.ws.close(E,U)}get isOpen(){return this.ws.readyState===D.OPEN}}},12985:E=>{"use strict";E.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13438:E=>{"use strict";E.exports=function(E){for(var U=new Array(E),g=0;g<E;++g)U[g]=g;return U}},13444:E=>{function U(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(U(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&U(E.slice(0,0))}(E)||!!E._isBuffer)}},13430:(E,U,g)=>{var N=g(13438),L=g(13444),D="undefined"!==typeof Float64Array;function S(E,U){return E[0]-U[0]}function u(){var E,U=this.stride,g=new Array(U.length);for(E=0;E<g.length;++E)g[E]=[Math.abs(U[E]),E];g.sort(S);var N=new Array(g.length);for(E=0;E<N.length;++E)N[E]=g[E][1];return N}function s(E,U){var g=["View",U,"d",E].join("");U<0&&(g="View_Nil"+E);var L="generic"===E;if(-1===U){var D="function "+g+"(a){this.data=a;};var proto="+g+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+g+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+g+"(a){return new "+g+"(a);}";return new Function(D)()}if(0===U){D="function "+g+"(a,d) {this.data = a;this.offset = d};var proto="+g+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+g+"_copy() {return new "+g+"(this.data,this.offset)};proto.pick=function "+g+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+g+"_get(){return "+(L?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+g+"_set(v){return "+(L?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+g+"(a,b,c,d){return new "+g+"(a,d)}";return new Function("TrivialArray",D)(C[E][0])}D=["'use strict'"];var S=N(U),s=S.map((function(E){return"i"+E})),B="this.offset+"+S.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),P=S.map((function(E){return"b"+E})).join(","),F=S.map((function(E){return"c"+E})).join(",");D.push("function "+g+"(a,"+P+","+F+",d){this.data=a","this.shape=["+P+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+g+".prototype","proto.dtype='"+E+"'","proto.dimension="+U),D.push("Object.defineProperty(proto,'size',{get:function "+g+"_size(){return "+S.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===U?D.push("proto.order=[0]"):(D.push("Object.defineProperty(proto,'order',{get:"),U<4?(D.push("function "+g+"_order(){"),2===U?D.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&D.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):D.push("ORDER})")),D.push("proto.set=function "+g+"_set("+s.join(",")+",v){"),L?D.push("return this.data.set("+B+",v)}"):D.push("return this.data["+B+"]=v}"),D.push("proto.get=function "+g+"_get("+s.join(",")+"){"),L?D.push("return this.data.get("+B+")}"):D.push("return this.data["+B+"]}"),D.push("proto.index=function "+g+"_index(",s.join(),"){return "+B+"}"),D.push("proto.hi=function "+g+"_hi("+s.join(",")+"){return new "+g+"(this.data,"+S.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+S.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var f=S.map((function(E){return"a"+E+"=this.shape["+E+"]"})),d=S.map((function(E){return"c"+E+"=this.stride["+E+"]"}));D.push("proto.lo=function "+g+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+d.join(","));for(var I=0;I<U;++I)D.push("if(typeof i"+I+"==='number'&&i"+I+">=0){d=i"+I+"|0;b+=c"+I+"*d;a"+I+"-=d}");D.push("return new "+g+"(this.data,"+S.map((function(E){return"a"+E})).join(",")+","+S.map((function(E){return"c"+E})).join(",")+",b)}"),D.push("proto.step=function "+g+"_step("+s.join(",")+"){var "+S.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+S.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(I=0;I<U;++I)D.push("if(typeof i"+I+"==='number'){d=i"+I+"|0;if(d<0){c+=b"+I+"*(a"+I+"-1);a"+I+"=ceil(-a"+I+"/d)}else{a"+I+"=ceil(a"+I+"/d)}b"+I+"*=d}");D.push("return new "+g+"(this.data,"+S.map((function(E){return"a"+E})).join(",")+","+S.map((function(E){return"b"+E})).join(",")+",c)}");var y=new Array(U),h=new Array(U);for(I=0;I<U;++I)y[I]="a[i"+I+"]",h[I]="b[i"+I+"]";D.push("proto.transpose=function "+g+"_transpose("+s+"){"+s.map((function(E,U){return E+"=("+E+"===undefined?"+U+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+g+"(this.data,"+y.join(",")+","+h.join(",")+",this.offset)}"),D.push("proto.pick=function "+g+"_pick("+s+"){var a=[],b=[],c=this.offset");for(I=0;I<U;++I)D.push("if(typeof i"+I+"==='number'&&i"+I+">=0){c=(c+this.stride["+I+"]*i"+I+")|0}else{a.push(this.shape["+I+"]);b.push(this.stride["+I+"])}");return D.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),D.push("return function construct_"+g+"(data,shape,stride,offset){return new "+g+"(data,"+S.map((function(E){return"shape["+E+"]"})).join(",")+","+S.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",D.join("\n"))(C[E],u)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,U,g,N){if(void 0===E)return(0,C.array[0])([]);"number"===typeof E&&(E=[E]),void 0===U&&(U=[E.length]);var S=U.length;if(void 0===g){g=new Array(S);for(var u=S-1,B=1;u>=0;--u)g[u]=B,B*=U[u]}if(void 0===N){N=0;for(u=0;u<S;++u)g[u]<0&&(N-=(U[u]-1)*g[u])}for(var P=function(E){if(L(E))return"buffer";if(D)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),F=C[P];F.length<=S+1;)F.push(s(P,F.length-1));return(0,F[S+1])(E,U,g,N)}},14481:E=>{var U;self,U=()=>(()=>{"use strict";var E={d:(U,g)=>{for(var N in g)E.o(g,N)&&!E.o(U,N)&&Object.defineProperty(U,N,{enumerable:!0,get:g[N]})},o:(E,U)=>Object.prototype.hasOwnProperty.call(E,U)},U={};E.d(U,{default:()=>Z});var g,N=function(E,U){var g=U.x-E.x,N=U.y-E.y;return Math.sqrt(g*g+N*N)},L=function(E){return E*(Math.PI/180)},D=new Map,S=function(E){D.has(E)&&clearTimeout(D.get(E)),D.set(E,setTimeout(E,100))},u=function(E,U,g){for(var N,L=U.split(/[ ,]+/g),D=0;D<L.length;D+=1)N=L[D],E.addEventListener?E.addEventListener(N,g,!1):E.attachEvent&&E.attachEvent(N,g)},s=function(E,U,g){for(var N,L=U.split(/[ ,]+/g),D=0;D<L.length;D+=1)N=L[D],E.removeEventListener?E.removeEventListener(N,g):E.detachEvent&&E.detachEvent(N,g)},C=function(E){return E.preventDefault(),E.type.match(/^touch/)?E.changedTouches:E},B=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},P=function(E,U){U.top||U.right||U.bottom||U.left?(E.style.top=U.top,E.style.right=U.right,E.style.bottom=U.bottom,E.style.left=U.left):(E.style.left=U.x+"px",E.style.top=U.y+"px")},F=function(E,U,g){var N=f(E);for(var L in N)if(N.hasOwnProperty(L))if("string"==typeof U)N[L]=U+" "+g;else{for(var D="",S=0,u=U.length;S<u;S+=1)D+=U[S]+" "+g+", ";N[L]=D.slice(0,-2)}return N},f=function(E){var U={};return U[E]="",["webkit","Moz","o"].forEach((function(g){U[g+E.charAt(0).toUpperCase()+E.slice(1)]=""})),U},d=function(E,U){for(var g in U)U.hasOwnProperty(g)&&(E[g]=U[g]);return E},I=function(E,U){if(E.length)for(var g=0,N=E.length;g<N;g+=1)U(E[g]);else U(E)},y="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,h=window.matchMedia("(any-hover: none)").matches,V=!!("ontouchstart"in window),e=!!window.PointerEvent,x=!!window.MSPointerEvent,l={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},Y={start:"mousedown",move:"mousemove",end:"mouseup"},t={};function G(){}y&&!h?g=l:e?g={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?g={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:V?(g=l,t=Y):g=Y,G.prototype.on=function(E,U){var g,N=this,L=E.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var D=0;D<L.length;D+=1)g=L[D],N._handlers_[g]=N._handlers_[g]||[],N._handlers_[g].push(U);return N},G.prototype.off=function(E,U){var g=this;return g._handlers_=g._handlers_||{},void 0===E?g._handlers_={}:void 0===U?g._handlers_[E]=null:g._handlers_[E]&&g._handlers_[E].indexOf(U)>=0&&g._handlers_[E].splice(g._handlers_[E].indexOf(U),1),g},G.prototype.trigger=function(E,U){var g,N=this,L=E.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var D=0;D<L.length;D+=1)g=L[D],N._handlers_[g]&&N._handlers_[g].length&&N._handlers_[g].forEach((function(E){E.call(N,{type:g,target:N},U)}))},G.prototype.config=function(E){var U=this;U.options=U.defaults||{},E&&(U.options=function(E,U){var g={};for(var N in E)E.hasOwnProperty(N)&&U.hasOwnProperty(N)?g[N]=U[N]:E.hasOwnProperty(N)&&(g[N]=E[N]);return g}(U.options,E))},G.prototype.bindEvt=function(E,U){var N=this;return N._domHandlers_=N._domHandlers_||{},N._domHandlers_[U]=function(){"function"==typeof N["on"+U]?N["on"+U].apply(N,arguments):console.warn('[WARNING] : Missing "on'+U+'" handler.')},u(E,g[U],N._domHandlers_[U]),t[U]&&u(E,t[U],N._domHandlers_[U]),N},G.prototype.unbindEvt=function(E,U){var N=this;return N._domHandlers_=N._domHandlers_||{},s(E,g[U],N._domHandlers_[U]),t[U]&&s(E,t[U],N._domHandlers_[U]),delete N._domHandlers_[U],this};const b=G;function T(E,U){return this.identifier=U.identifier,this.position=U.position,this.frontPosition=U.frontPosition,this.collection=E,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(U),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=T.id,T.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}T.prototype=new b,T.constructor=T,T.id=0,T.prototype.buildEl=function(E){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},T.prototype.stylize=function(){if(this.options.dataOnly)return this;var E=this.options.fadeTime+"ms",U=function(){var E=f("borderRadius");for(var U in E)E.hasOwnProperty(U)&&(E[U]="50%");return E}(),g=F("transition","opacity",E),N={};return N.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},N.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},N.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},d(N.el,g),"circle"===this.options.shape&&d(N.back,U),d(N.front,U),this.applyStyles(N),this},T.prototype.applyStyles=function(E){for(var U in this.ui)if(this.ui.hasOwnProperty(U))for(var g in E[U])this.ui[U].style[g]=E[U][g];return this},T.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},T.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},T.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},T.prototype.show=function(E){var U=this;return U.options.dataOnly||(clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.addToDom(),U.restCallback(),setTimeout((function(){U.ui.el.style.opacity=1}),0),U.showTimeout=setTimeout((function(){U.trigger("shown",U.instance),"function"==typeof E&&E.call(this)}),U.options.fadeTime)),U},T.prototype.hide=function(E){var U=this;if(U.options.dataOnly)return U;if(U.ui.el.style.opacity=U.options.restOpacity,clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.removeTimeout=setTimeout((function(){var g="dynamic"===U.options.mode?"none":"block";U.ui.el.style.display=g,"function"==typeof E&&E.call(U),U.trigger("hidden",U.instance)}),U.options.fadeTime),U.options.restJoystick){var g=U.options.restJoystick,N={};N.x=!0===g||!1!==g.x?0:U.instance.frontPosition.x,N.y=!0===g||!1!==g.y?0:U.instance.frontPosition.y,U.setPosition(E,N)}return U},T.prototype.setPosition=function(E,U){var g=this;g.frontPosition={x:U.x,y:U.y};var N=g.options.fadeTime+"ms",L={};L.front=F("transition",["transform"],N);var D={front:{}};D.front={transform:"translate("+g.frontPosition.x+"px,"+g.frontPosition.y+"px)"},g.applyStyles(L),g.applyStyles(D),g.restTimeout=setTimeout((function(){"function"==typeof E&&E.call(g),g.restCallback()}),g.options.fadeTime)},T.prototype.restCallback=function(){var E=this,U={};U.front=F("transition","none",""),E.applyStyles(U),E.trigger("rested",E.instance)},T.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},T.prototype.computeDirection=function(E){var U,g,N,L=E.angle.radian,D=Math.PI/4,S=Math.PI/2;if(L>D&&L<3*D&&!E.lockX?U="up":L>-D&&L<=D&&!E.lockY?U="left":L>3*-D&&L<=-D&&!E.lockX?U="down":E.lockY||(U="right"),E.lockY||(g=L>-S&&L<S?"left":"right"),E.lockX||(N=L>0?"up":"down"),E.force>this.options.threshold){var u,s={};for(u in this.direction)this.direction.hasOwnProperty(u)&&(s[u]=this.direction[u]);var C={};for(u in this.direction={x:g,y:N,angle:U},E.direction=this.direction,s)s[u]===this.direction[u]&&(C[u]=!0);if(C.x&&C.y&&C.angle)return E;C.x&&C.y||this.trigger("plain",E),C.x||this.trigger("plain:"+g,E),C.y||this.trigger("plain:"+N,E),C.angle||this.trigger("dir dir:"+U,E)}else this.resetDirection();return E};const v=T;function o(E,U){var g=this;g.nipples=[],g.idles=[],g.actives=[],g.ids=[],g.pressureIntervals={},g.manager=E,g.id=o.id,o.id+=1,g.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},g.config(U),"static"!==g.options.mode&&"semi"!==g.options.mode||(g.options.multitouch=!1),g.options.multitouch||(g.options.maxNumberOfNipples=1);var N=getComputedStyle(g.options.zone.parentElement);return N&&"flex"===N.display&&(g.parentIsFlex=!0),g.updateBox(),g.prepareNipples(),g.KP(),g.begin(),g.nipples}o.prototype=new b,o.constructor=o,o.id=0,o.prototype.prepareNipples=function(){var E=this,U=E.nipples;U.on=E.on.bind(E),U.off=E.off.bind(E),U.options=E.options,U.destroy=E.destroy.bind(E),U.ids=E.ids,U.id=E.id,U.processOnMove=E.processOnMove.bind(E),U.processOnEnd=E.processOnEnd.bind(E),U.get=function(E){if(void 0===E)return U[0];for(var g=0,N=U.length;g<N;g+=1)if(U[g].identifier===E)return U[g];return!1}},o.prototype.KP=function(){var E=this;E.bindEvt(E.options.zone,"start"),E.options.zone.style.touchAction="none",E.options.zone.style.msTouchAction="none"},o.prototype.begin=function(){var E=this,U=E.options;if("static"===U.mode){var g=E.createNipple(U.position,E.manager.getIdentifier());g.add(),E.idles.push(g)}},o.prototype.createNipple=function(E,U){var g=this,N=g.manager.scroll,L={},D=g.options,S=g.parentIsFlex?N.x:N.x+g.box.left,u=g.parentIsFlex?N.y:N.y+g.box.top;if(E.x&&E.y)L={x:E.x-S,y:E.y-u};else if(E.top||E.right||E.bottom||E.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=E.top,s.style.right=E.right,s.style.bottom=E.bottom,s.style.left=E.left,s.style.position="absolute",D.zone.appendChild(s);var C=s.getBoundingClientRect();D.zone.removeChild(s),L=E,E={x:C.left+N.x,y:C.top+N.y}}var B=new v(g,{color:D.color,size:D.size,threshold:D.threshold,fadeTime:D.fadeTime,dataOnly:D.dataOnly,restJoystick:D.restJoystick,restOpacity:D.restOpacity,mode:D.mode,identifier:U,position:E,zone:D.zone,frontPosition:{x:0,y:0},shape:D.shape});return D.dataOnly||(P(B.ui.el,L),P(B.ui.front,B.frontPosition)),g.nipples.push(B),g.trigger("added "+B.identifier+":added",B),g.manager.trigger("added "+B.identifier+":added",B),g.bindNipple(B),B},o.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},o.prototype.bindNipple=function(E){var U,g=this,N=function(E,N){U=E.type+" "+N.id+":"+E.type,g.trigger(U,N)};E.on("destroyed",g.onDestroyed.bind(g)),E.on("shown hidden rested dir plain",N),E.on("dir:up dir:right dir:down dir:left",N),E.on("plain:up plain:right plain:down plain:left",N)},o.prototype.pressureFn=function(E,U,g){var N=this,L=0;clearInterval(N.pressureIntervals[g]),N.pressureIntervals[g]=setInterval(function(){var g=E.force||E.pressure||E.webkitForce||0;g!==L&&(U.trigger("pressure",g),N.trigger("pressure "+U.identifier+":pressure",g),L=g)}.bind(N),100)},o.prototype.onstart=function(E){var U=this,g=U.options,N=E;return E=C(E),U.updateBox(),I(E,(function(L){U.actives.length<g.maxNumberOfNipples?U.processOnStart(L):N.type.match(/^touch/)&&(Object.keys(U.manager.ids).forEach((function(g){if(Object.values(N.touches).findIndex((function(E){return E.identifier===g}))<0){var L=[E[0]];L.identifier=g,U.processOnEnd(L)}})),U.actives.length<g.maxNumberOfNipples&&U.processOnStart(L))})),U.manager.bindDocument(),!1},o.prototype.processOnStart=function(E){var U,g=this,L=g.options,D=g.manager.getIdentifier(E),S=E.force||E.pressure||E.webkitForce||0,u={x:E.pageX,y:E.pageY},s=g.getOrCreate(D,u);s.identifier!==D&&g.manager.removeIdentifier(s.identifier),s.identifier=D;var C=function(U){U.trigger("start",U),g.trigger("start "+U.id+":start",U),U.show(),S>0&&g.pressureFn(E,U,U.identifier),g.processOnMove(E)};if((U=g.idles.indexOf(s))>=0&&g.idles.splice(U,1),g.actives.push(s),g.ids.push(s.identifier),"semi"!==L.mode)C(s);else{if(!(N(u,s.position)<=L.catchDistance))return s.destroy(),void g.processOnStart(E);C(s)}return s},o.prototype.getOrCreate=function(E,U){var g,N=this,L=N.options;return/(semi|static)/.test(L.mode)?(g=N.idles[0])?(N.idles.splice(0,1),g):"semi"===L.mode?N.createNipple(U,E):(console.warn("Coudln't find the needed nipple."),!1):g=N.createNipple(U,E)},o.prototype.processOnMove=function(E){var U=this,g=U.options,D=U.manager.getIdentifier(E),S=U.nipples.get(D),u=U.manager.scroll;if(function(E){return isNaN(E.buttons)?0!==E.pressure:0!==E.buttons}(E)){if(!S)return console.error("Found zombie joystick with ID "+D),void U.manager.removeIdentifier(D);if(g.dynamicPage){var s=S.el.getBoundingClientRect();S.position={x:u.x+s.left,y:u.y+s.top}}S.identifier=D;var C=S.options.size/2,B={x:E.pageX,y:E.pageY};g.lockX&&(B.y=S.position.y),g.lockY&&(B.x=S.position.x);var P,F,f,d,I,y,h,V,e,x,l=N(B,S.position),Y=(P=B,f=(F=S.position).x-P.x,d=F.y-P.y,function(E){return E*(180/Math.PI)}(Math.atan2(d,f))),t=L(Y),G=l/C,b={distance:l,position:B};if("circle"===S.options.shape?(I=Math.min(l,C),h=S.position,V=I,x={x:0,y:0},e=L(e=Y),x.x=h.x-V*Math.cos(e),x.y=h.y-V*Math.sin(e),y=x):(y=function(E,U,g){return{x:Math.min(Math.max(E.x,U.x-g),U.x+g),y:Math.min(Math.max(E.y,U.y-g),U.y+g)}}(B,S.position,C),I=N(y,S.position)),g.follow){if(l>C){var T=B.x-y.x,v=B.y-y.y;S.position.x+=T,S.position.y+=v,S.el.style.top=S.position.y-(U.box.top+u.y)+"px",S.el.style.left=S.position.x-(U.box.left+u.x)+"px",l=N(B,S.position)}}else B=y,l=I;var o=B.x-S.position.x,c=B.y-S.position.y;S.frontPosition={x:o,y:c},g.dataOnly||(S.ui.front.style.transform="translate("+o+"px,"+c+"px)");var r={identifier:S.identifier,position:B,force:G,pressure:E.force||E.pressure||E.webkitForce||0,distance:l,angle:{radian:t,degree:Y},vector:{x:o/C,y:-c/C},raw:b,instance:S,lockX:g.lockX,lockY:g.lockY};(r=S.computeDirection(r)).angle={radian:L(180-Y),degree:180-Y},S.trigger("move",r),U.trigger("move "+S.id+":move",r)}else this.processOnEnd(E)},o.prototype.processOnEnd=function(E){var U=this,g=U.options,N=U.manager.getIdentifier(E),L=U.nipples.get(N),D=U.manager.removeIdentifier(L.identifier);L&&(g.dataOnly||L.hide((function(){"dynamic"===g.mode&&(L.trigger("removed",L),U.trigger("removed "+L.id+":removed",L),U.manager.trigger("removed "+L.id+":removed",L),L.destroy())})),clearInterval(U.pressureIntervals[L.identifier]),L.resetDirection(),L.trigger("end",L),U.trigger("end "+L.id+":end",L),U.ids.indexOf(L.identifier)>=0&&U.ids.splice(U.ids.indexOf(L.identifier),1),U.actives.indexOf(L)>=0&&U.actives.splice(U.actives.indexOf(L),1),/(semi|static)/.test(g.mode)?U.idles.push(L):U.nipples.indexOf(L)>=0&&U.nipples.splice(U.nipples.indexOf(L),1),U.manager.unbindDocument(),/(semi|static)/.test(g.mode)&&(U.manager.ids[D.id]=D.identifier))},o.prototype.onDestroyed=function(E,U){var g=this;g.nipples.indexOf(U)>=0&&g.nipples.splice(g.nipples.indexOf(U),1),g.actives.indexOf(U)>=0&&g.actives.splice(g.actives.indexOf(U),1),g.idles.indexOf(U)>=0&&g.idles.splice(g.idles.indexOf(U),1),g.ids.indexOf(U.identifier)>=0&&g.ids.splice(g.ids.indexOf(U.identifier),1),g.manager.removeIdentifier(U.identifier),g.manager.unbindDocument()},o.prototype.destroy=function(){var E=this;for(var U in E.unbindEvt(E.options.zone,"start"),E.nipples.forEach((function(E){E.destroy()})),E.pressureIntervals)E.pressureIntervals.hasOwnProperty(U)&&clearInterval(E.pressureIntervals[U]);E.trigger("destroyed",E.nipples),E.manager.unbindDocument(),E.off()};const c=o;function r(E){var U=this;U.ids={},U.index=0,U.collections=[],U.scroll=B(),U.config(E),U.prepareCollections();var g=function(){var E;U.collections.forEach((function(g){g.forEach((function(g){E=g.el.getBoundingClientRect(),g.position={x:U.scroll.x+E.left,y:U.scroll.y+E.top}}))}))};u(window,"resize",(function(){S(g)}));var N=function(){U.scroll=B()};return u(window,"scroll",(function(){S(N)})),U.collections}r.prototype=new b,r.constructor=r,r.prototype.prepareCollections=function(){var E=this;E.collections.create=E.create.bind(E),E.collections.on=E.on.bind(E),E.collections.off=E.off.bind(E),E.collections.destroy=E.destroy.bind(E),E.collections.get=function(U){var g;return E.collections.every((function(E){return!(g=E.get(U))})),g}},r.prototype.create=function(E){return this.createCollection(E)},r.prototype.createCollection=function(E){var U=this,g=new c(U,E);return U.bindCollection(g),U.collections.push(g),g},r.prototype.bindCollection=function(E){var U,g=this,N=function(E,N){U=E.type+" "+N.id+":"+E.type,g.trigger(U,N)};E.on("destroyed",g.onDestroyed.bind(g)),E.on("shown hidden rested dir plain",N),E.on("dir:up dir:right dir:down dir:left",N),E.on("plain:up plain:right plain:down plain:left",N)},r.prototype.bindDocument=function(){var E=this;E.binded||(E.bindEvt(document,"move").bindEvt(document,"end"),E.binded=!0)},r.prototype.unbindDocument=function(E){var U=this;Object.keys(U.ids).length&&!0!==E||(U.unbindEvt(document,"move").unbindEvt(document,"end"),U.binded=!1)},r.prototype.getIdentifier=function(E){var U;return E?void 0===(U=void 0===E.identifier?E.pointerId:E.identifier)&&(U=this.latest||0):U=this.index,void 0===this.ids[U]&&(this.ids[U]=this.index,this.index+=1),this.latest=U,this.ids[U]},r.prototype.removeIdentifier=function(E){var U={};for(var g in this.ids)if(this.ids[g]===E){U.id=g,U.identifier=this.ids[g],delete this.ids[g];break}return U},r.prototype.onmove=function(E){return this.onAny("move",E),!1},r.prototype.onend=function(E){return this.onAny("end",E),!1},r.prototype.oncancel=function(E){return this.onAny("end",E),!1},r.prototype.onAny=function(E,U){var g,N=this,L="processOn"+E.charAt(0).toUpperCase()+E.slice(1);U=C(U);var D=function(E,U,g){g.ids.indexOf(U)>=0&&(g[L](E),E._found_=!0)};return I(U,(function(E){g=N.getIdentifier(E),I(N.collections,D.bind(null,E,g)),E._found_||N.removeIdentifier(g)})),!1},r.prototype.destroy=function(){var E=this;E.unbindDocument(!0),E.ids={},E.index=0,E.collections.forEach((function(E){E.destroy()})),E.off()},r.prototype.onDestroyed=function(E,U){var g=this;if(g.collections.indexOf(U)<0)return!1;g.collections.splice(g.collections.indexOf(U),1)};var j=new r;const Z={create:function(E){return j.create(E)},factory:j};return U.default})(),E.exports=U()},13462:(E,U,g)=>{"use strict";const{Deflate:N,deflate:L,deflateRaw:D,gzip:S}=g(13466),{Inflate:u,inflate:s,inflateRaw:C,ungzip:B}=g(13521),P=g(13502);E.exports.Deflate=N,E.exports.deflate=L,E.exports.deflateRaw=D,E.exports.gzip=S,E.exports.Inflate=u,E.exports.inflate=s,E.exports.inflateRaw=C,E.exports.ungzip=B,E.exports.constants=P},13466:(E,U,g)=>{"use strict";const N=g(13473),L=g(13506),D=g(13513),S=g(13499),u=g(13519),s=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:B,Z_FULL_FLUSH:P,Z_FINISH:F,Z_OK:f,Z_STREAM_END:d,Z_DEFAULT_COMPRESSION:I,Z_DEFAULT_STRATEGY:y,Z_DEFLATED:h}=g(13502);function V(E){this.options=L.assign({level:I,method:h,qE:16384,windowBits:15,memLevel:8,strategy:y},E||{});let U=this.options;U.raw&&U.windowBits>0?U.windowBits=-U.windowBits:U.gzip&&U.windowBits>0&&U.windowBits<16&&(U.windowBits+=16),this.err=0,this.CU="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;let g=N.deflateInit2(this.strm,U.level,U.method,U.windowBits,U.memLevel,U.strategy);if(g!==f)throw new Error(S[g]);if(U.header&&N.deflateSetHeader(this.strm,U.header),U.dictionary){let E;if(E="string"===typeof U.dictionary?D.string2buf(U.dictionary):"[object ArrayBuffer]"===s.call(U.dictionary)?new Uint8Array(U.dictionary):U.dictionary,g=N.deflateSetDictionary(this.strm,E),g!==f)throw new Error(S[g]);this._dict_set=!0}}function e(E,U){const g=new V(U);if(g.push(E,!0),g.err)throw g.CU||S[g.err];return g.result}V.prototype.push=function(E,U){const g=this.strm,L=this.options.qE;let S,u;if(this.ended)return!1;for(u=U===~~U?U:!0===U?F:C,"string"===typeof E?g.input=D.string2buf(E):"[object ArrayBuffer]"===s.call(E)?g.input=new Uint8Array(E):g.input=E,g.next_in=0,g.avail_in=g.input.length;;)if(0===g.avail_out&&(g.output=new Uint8Array(L),g.next_out=0,g.avail_out=L),(u===B||u===P)&&g.avail_out<=6)this.onData(g.output.subarray(0,g.next_out)),g.avail_out=0;else{if(S=N.deflate(g,u),S===d)return g.next_out>0&&this.onData(g.output.subarray(0,g.next_out)),S=N.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===f;if(0!==g.avail_out){if(u>0&&g.next_out>0)this.onData(g.output.subarray(0,g.next_out)),g.avail_out=0;else if(0===g.avail_in)break}else this.onData(g.output)}return!0},V.prototype.onData=function(E){this.chunks.push(E)},V.prototype.onEnd=function(E){E===f&&(this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.CU=this.strm.CU},E.exports.Deflate=V,E.exports.deflate=e,E.exports.deflateRaw=function(E,U){return(U=U||{}).raw=!0,e(E,U)},E.exports.gzip=function(E,U){return(U=U||{}).gzip=!0,e(E,U)},E.exports.constants=g(13502)},13521:(E,U,g)=>{"use strict";const N=g(13528),L=g(13506),D=g(13513),S=g(13499),u=g(13519),s=g(13541),C=Object.prototype.toString,{Z_NO_FLUSH:B,Z_FINISH:P,Z_OK:F,Z_STREAM_END:f,Z_NEED_DICT:d,Z_STREAM_ERROR:I,Z_DATA_ERROR:y,Z_MEM_ERROR:h}=g(13502);function V(E){this.options=L.assign({qE:65536,windowBits:15,to:""},E||{});const U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,0===U.windowBits&&(U.windowBits=-15)),!(U.windowBits>=0&&U.windowBits<16)||E&&E.windowBits||(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&0===(15&U.windowBits)&&(U.windowBits|=15),this.err=0,this.CU="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;let g=N.inflateInit2(this.strm,U.windowBits);if(g!==F)throw new Error(S[g]);if(this.header=new s,N.inflateGetHeader(this.strm,this.header),U.dictionary&&("string"===typeof U.dictionary?U.dictionary=D.string2buf(U.dictionary):"[object ArrayBuffer]"===C.call(U.dictionary)&&(U.dictionary=new Uint8Array(U.dictionary)),U.raw&&(g=N.inflateSetDictionary(this.strm,U.dictionary),g!==F)))throw new Error(S[g])}function e(E,U){const g=new V(U);if(g.push(E),g.err)throw g.CU||S[g.err];return g.result}V.prototype.push=function(E,U){const g=this.strm,L=this.options.qE,S=this.options.dictionary;let u,s,V;if(this.ended)return!1;for(s=U===~~U?U:!0===U?P:B,"[object ArrayBuffer]"===C.call(E)?g.input=new Uint8Array(E):g.input=E,g.next_in=0,g.avail_in=g.input.length;;){for(0===g.avail_out&&(g.output=new Uint8Array(L),g.next_out=0,g.avail_out=L),u=N.inflate(g,s),u===d&&S&&(u=N.inflateSetDictionary(g,S),u===F?u=N.inflate(g,s):u===y&&(u=d));g.avail_in>0&&u===f&&g.state.wrap>0&&0!==E[g.next_in];)N.inflateReset(g),u=N.inflate(g,s);switch(u){case I:case y:case d:case h:return this.onEnd(u),this.ended=!0,!1}if(V=g.avail_out,g.next_out&&(0===g.avail_out||u===f))if("string"===this.options.to){let E=D.utf8border(g.output,g.next_out),U=g.next_out-E,N=D.buf2string(g.output,E);g.next_out=U,g.avail_out=L-U,U&&g.output.set(g.output.subarray(E,E+U),0),this.onData(N)}else this.onData(g.output.length===g.next_out?g.output:g.output.subarray(0,g.next_out));if(u!==F||0!==V){if(u===f)return u=N.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(0===g.avail_in)break}}return!0},V.prototype.onData=function(E){this.chunks.push(E)},V.prototype.onEnd=function(E){E===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.CU=this.strm.CU},E.exports.Inflate=V,E.exports.inflate=e,E.exports.inflateRaw=function(E,U){return(U=U||{}).raw=!0,e(E,U)},E.exports.ungzip=e,E.exports.constants=g(13502)},13506:E=>{"use strict";const U=(E,U)=>Object.prototype.hasOwnProperty.call(E,U);E.exports.assign=function(E){const g=Array.prototype.slice.call(arguments,1);for(;g.length;){const N=g.shift();if(N){if("object"!==typeof N)throw new TypeError(N+"must be non-object");for(const g in N)U(N,g)&&(E[g]=N[g])}}return E},E.exports.flattenChunks=E=>{let U=0;for(let N=0,L=E.length;N<L;N++)U+=E[N].length;const g=new Uint8Array(U);for(let N=0,L=0,D=E.length;N<D;N++){let U=E[N];g.set(U,L),L+=U.length}return g}},13513:E=>{"use strict";let U=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(N){U=!1}const g=new Uint8Array(256);for(let L=0;L<256;L++)g[L]=L>=252?6:L>=248?5:L>=240?4:L>=224?3:L>=192?2:1;g[254]=g[254]=1,E.exports.string2buf=E=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(E);let U,g,N,L,D,S=E.length,u=0;for(L=0;L<S;L++)g=E.charCodeAt(L),55296===(64512&g)&&L+1<S&&(N=E.charCodeAt(L+1),56320===(64512&N)&&(g=65536+(g-55296<<10)+(N-56320),L++)),u+=g<128?1:g<2048?2:g<65536?3:4;for(U=new Uint8Array(u),D=0,L=0;D<u;L++)g=E.charCodeAt(L),55296===(64512&g)&&L+1<S&&(N=E.charCodeAt(L+1),56320===(64512&N)&&(g=65536+(g-55296<<10)+(N-56320),L++)),g<128?U[D++]=g:g<2048?(U[D++]=192|g>>>6,U[D++]=128|63&g):g<65536?(U[D++]=224|g>>>12,U[D++]=128|g>>>6&63,U[D++]=128|63&g):(U[D++]=240|g>>>18,U[D++]=128|g>>>12&63,U[D++]=128|g>>>6&63,U[D++]=128|63&g);return U};E.exports.buf2string=(E,N)=>{const L=N||E.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(E.subarray(0,N));let D,S;const u=new Array(2*L);for(S=0,D=0;D<L;){let U=E[D++];if(U<128){u[S++]=U;continue}let N=g[U];if(N>4)u[S++]=65533,D+=N-1;else{for(U&=2===N?31:3===N?15:7;N>1&&D<L;)U=U<<6|63&E[D++],N--;N>1?u[S++]=65533:U<65536?u[S++]=U:(U-=65536,u[S++]=55296|U>>10&1023,u[S++]=56320|1023&U)}}return((E,g)=>{if(g<65534&&E.subarray&&U)return String.fromCharCode.apply(null,E.length===g?E:E.subarray(0,g));let N="";for(let U=0;U<g;U++)N+=String.fromCharCode(E[U]);return N})(u,S)},E.exports.utf8border=(E,U)=>{(U=U||E.length)>E.length&&(U=E.length);let N=U-1;for(;N>=0&&128===(192&E[N]);)N--;return N<0||0===N?U:N+g[E[N]]>U?N:U}},13484:E=>{"use strict";E.exports=(E,U,g,N)=>{let L=65535&E,D=E>>>16&65535,S=0;for(;0!==g;){S=g>2e3?2e3:g,g-=S;do{L=L+U[N++]|0,D=D+L|0}while(--S);L%=65521,D%=65521}return L|D<<16}},13502:E=>{"use strict";E.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13490:E=>{"use strict";const U=new Uint32Array((()=>{let E,U=[];for(var g=0;g<256;g++){E=g;for(var N=0;N<8;N++)E=1&E?3988292384^E>>>1:E>>>1;U[g]=E}return U})());E.exports=(E,g,N,L)=>{const D=U,S=L+N;E^=-1;for(let U=L;U<S;U++)E=E>>>8^D[255&(E^g[U])];return~E}},13473:(E,U,g)=>{"use strict";const{_tr_init:N,_tr_stored_block:L,_tr_flush_block:D,_tr_tally:S,_tr_align:u}=g(13475),s=g(13484),C=g(13490),B=g(13499),{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:F,Z_FULL_FLUSH:f,Z_FINISH:d,Z_BLOCK:I,Z_OK:y,Z_STREAM_END:h,Z_STREAM_ERROR:V,Z_DATA_ERROR:e,Z_BUF_ERROR:x,Z_DEFAULT_COMPRESSION:l,Z_FILTERED:Y,Z_HUFFMAN_ONLY:t,Z_RLE:G,Z_FIXED:b,Z_DEFAULT_STRATEGY:T,Z_UNKNOWN:v,Z_DEFLATED:o}=g(13502),c=258,r=262,j=103,Z=113,A=666,w=(E,U)=>(E.CU=B[U],U),a=E=>(E<<1)-(E>4?9:0),J=E=>{let U=E.length;for(;--U>=0;)E[U]=0};let q=(E,U,g)=>(U<<E.hash_shift^g)&E.hash_mask;const M=E=>{const U=E.state;let g=U.pending;g>E.avail_out&&(g=E.avail_out),0!==g&&(E.output.set(U.pending_buf.subarray(U.pending_out,U.pending_out+g),E.next_out),E.next_out+=g,U.pending_out+=g,E.total_out+=g,E.avail_out-=g,U.pending-=g,0===U.pending&&(U.pending_out=0))},mE=(E,U)=>{D(E,E.block_start>=0?E.block_start:-1,E.strstart-E.block_start,U),E.block_start=E.strstart,M(E.strm)},W=(E,U)=>{E.pending_buf[E.pending++]=U},O=(E,U)=>{E.pending_buf[E.pending++]=U>>>8&255,E.pending_buf[E.pending++]=255&U},Q=(E,U,g,N)=>{let L=E.avail_in;return L>N&&(L=N),0===L?0:(E.avail_in-=L,U.set(E.input.subarray(E.next_in,E.next_in+L),g),1===E.state.wrap?E.adler=s(E.adler,U,L,g):2===E.state.wrap&&(E.adler=C(E.adler,U,L,g)),E.next_in+=L,E.total_in+=L,L)},R=(E,U)=>{let g,N,L=E.max_chain_length,D=E.strstart,S=E.prev_length,u=E.nice_match;const s=E.strstart>E.w_size-r?E.strstart-(E.w_size-r):0,C=E.window,B=E.w_mask,P=E.prev,F=E.strstart+c;let f=C[D+S-1],d=C[D+S];E.prev_length>=E.good_match&&(L>>=2),u>E.lookahead&&(u=E.lookahead);do{if(g=U,C[g+S]===d&&C[g+S-1]===f&&C[g]===C[D]&&C[++g]===C[D+1]){D+=2,g++;do{}while(C[++D]===C[++g]&&C[++D]===C[++g]&&C[++D]===C[++g]&&C[++D]===C[++g]&&C[++D]===C[++g]&&C[++D]===C[++g]&&C[++D]===C[++g]&&C[++D]===C[++g]&&D<F);if(N=c-(F-D),D=F-c,N>S){if(E.match_start=U,S=N,N>=u)break;f=C[D+S-1],d=C[D+S]}}}while((U=P[U&B])>s&&0!==--L);return S<=E.lookahead?S:E.lookahead},n=E=>{const U=E.w_size;let g,N,L,D,S;do{if(D=E.window_size-E.lookahead-E.strstart,E.strstart>=U+(U-r)){E.window.set(E.window.subarray(U,U+U),0),E.match_start-=U,E.strstart-=U,E.block_start-=U,N=E.hash_size,g=N;do{L=E.head[--g],E.head[g]=L>=U?L-U:0}while(--N);N=U,g=N;do{L=E.prev[--g],E.prev[g]=L>=U?L-U:0}while(--N);D+=U}if(0===E.strm.avail_in)break;if(N=Q(E.strm,E.window,E.strstart+E.lookahead,D),E.lookahead+=N,E.lookahead+E.insert>=3)for(S=E.strstart-E.insert,E.ins_h=E.window[S],E.ins_h=q(E,E.ins_h,E.window[S+1]);E.insert&&(E.ins_h=q(E,E.ins_h,E.window[S+3-1]),E.prev[S&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=S,S++,E.insert--,!(E.lookahead+E.insert<3)););}while(E.lookahead<r&&0!==E.strm.avail_in)},k=(E,U)=>{let g,N;for(;;){if(E.lookahead<r){if(n(E),E.lookahead<r&&U===P)return 1;if(0===E.lookahead)break}if(g=0,E.lookahead>=3&&(E.ins_h=q(E,E.ins_h,E.window[E.strstart+3-1]),g=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),0!==g&&E.strstart-g<=E.w_size-r&&(E.match_length=R(E,g)),E.match_length>=3)if(N=S(E,E.strstart-E.match_start,E.match_length-3),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=3){E.match_length--;do{E.strstart++,E.ins_h=q(E,E.ins_h,E.window[E.strstart+3-1]),g=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart}while(0!==--E.match_length);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=q(E,E.ins_h,E.window[E.strstart+1]);else N=S(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(N&&(mE(E,!1),0===E.strm.avail_out))return 1}return E.insert=E.strstart<2?E.strstart:2,U===d?(mE(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(mE(E,!1),0===E.strm.avail_out)?1:2},z=(E,U)=>{let g,N,L;for(;;){if(E.lookahead<r){if(n(E),E.lookahead<r&&U===P)return 1;if(0===E.lookahead)break}if(g=0,E.lookahead>=3&&(E.ins_h=q(E,E.ins_h,E.window[E.strstart+3-1]),g=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=2,0!==g&&E.prev_length<E.max_lazy_match&&E.strstart-g<=E.w_size-r&&(E.match_length=R(E,g),E.match_length<=5&&(E.strategy===Y||3===E.match_length&&E.strstart-E.match_start>4096)&&(E.match_length=2)),E.prev_length>=3&&E.match_length<=E.prev_length){L=E.strstart+E.lookahead-3,N=S(E,E.strstart-1-E.prev_match,E.prev_length-3),E.lookahead-=E.prev_length-1,E.prev_length-=2;do{++E.strstart<=L&&(E.ins_h=q(E,E.ins_h,E.window[E.strstart+3-1]),g=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart)}while(0!==--E.prev_length);if(E.match_available=0,E.match_length=2,E.strstart++,N&&(mE(E,!1),0===E.strm.avail_out))return 1}else if(E.match_available){if(N=S(E,0,E.window[E.strstart-1]),N&&mE(E,!1),E.strstart++,E.lookahead--,0===E.strm.avail_out)return 1}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(N=S(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<2?E.strstart:2,U===d?(mE(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(mE(E,!1),0===E.strm.avail_out)?1:2};function i(E,U,g,N,L){this.good_length=E,this.max_lazy=U,this.nice_length=g,this.max_chain=N,this.func=L}const p=[new i(0,0,0,0,((E,U)=>{let g=65535;for(g>E.pending_buf_size-5&&(g=E.pending_buf_size-5);;){if(E.lookahead<=1){if(n(E),0===E.lookahead&&U===P)return 1;if(0===E.lookahead)break}E.strstart+=E.lookahead,E.lookahead=0;const N=E.block_start+g;if((0===E.strstart||E.strstart>=N)&&(E.lookahead=E.strstart-N,E.strstart=N,mE(E,!1),0===E.strm.avail_out))return 1;if(E.strstart-E.block_start>=E.w_size-r&&(mE(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,U===d?(mE(E,!0),0===E.strm.avail_out?3:4):(E.strstart>E.block_start&&(mE(E,!1),E.strm.avail_out),1)})),new i(4,4,8,4,k),new i(4,5,16,8,k),new i(4,6,32,32,k),new i(4,4,16,16,z),new i(8,16,32,32,z),new i(8,16,128,128,z),new i(8,32,128,256,z),new i(32,128,258,1024,z),new i(32,258,258,4096,z)];function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=o,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const K=E=>{if(!E||!E.state)return w(E,V);E.total_in=E.total_out=0,E.data_type=v;const U=E.state;return U.pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?42:Z,E.adler=2===U.wrap?0:1,U.last_flush=P,N(U),y},X=E=>{const U=K(E);var g;return U===y&&((g=E.state).window_size=2*g.w_size,J(g.head),g.max_lazy_match=p[g.level].max_lazy,g.good_match=p[g.level].good_length,g.nice_match=p[g.level].nice_length,g.max_chain_length=p[g.level].max_chain,g.strstart=0,g.block_start=0,g.lookahead=0,g.insert=0,g.match_length=g.prev_length=2,g.match_available=0,g.ins_h=0),U},EE=(E,U,g,N,L,D)=>{if(!E)return V;let S=1;if(U===l&&(U=6),N<0?(S=0,N=-N):N>15&&(S=2,N-=16),L<1||L>9||g!==o||N<8||N>15||U<0||U>9||D<0||D>b)return w(E,V);8===N&&(N=9);const u=new H;return E.state=u,u.strm=E,u.wrap=S,u.gzhead=null,u.w_bits=N,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=L+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<L+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=U,u.strategy=D,u.method=g,X(E)};E.exports.deflateInit=(E,U)=>EE(E,U,o,15,8,T),E.exports.deflateInit2=EE,E.exports.deflateReset=X,E.exports.deflateResetKeep=K,E.exports.deflateSetHeader=(E,U)=>E&&E.state?2!==E.state.wrap?V:(E.state.gzhead=U,y):V,E.exports.deflate=(E,U)=>{let g,N;if(!E||!E.state||U>I||U<0)return E?w(E,V):V;const D=E.state;if(!E.output||!E.input&&0!==E.avail_in||D.status===A&&U!==d)return w(E,0===E.avail_out?x:V);D.strm=E;const s=D.last_flush;if(D.last_flush=U,42===D.status)if(2===D.wrap)E.adler=0,W(D,31),W(D,139),W(D,8),D.gzhead?(W(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),W(D,255&D.gzhead.time),W(D,D.gzhead.time>>8&255),W(D,D.gzhead.time>>16&255),W(D,D.gzhead.time>>24&255),W(D,9===D.level?2:D.strategy>=t||D.level<2?4:0),W(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(W(D,255&D.gzhead.extra.length),W(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(E.adler=C(E.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(W(D,0),W(D,0),W(D,0),W(D,0),W(D,0),W(D,9===D.level?2:D.strategy>=t||D.level<2?4:0),W(D,3),D.status=Z);else{let U=o+(D.w_bits-8<<4)<<8,g=-1;g=D.strategy>=t||D.level<2?0:D.level<6?1:6===D.level?2:3,U|=g<<6,0!==D.strstart&&(U|=32),U+=31-U%31,D.status=Z,O(D,U),0!==D.strstart&&(O(D,E.adler>>>16),O(D,65535&E.adler)),E.adler=1}if(69===D.status)if(D.gzhead.extra){for(g=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>g&&(E.adler=C(E.adler,D.pending_buf,D.pending-g,g)),M(E),g=D.pending,D.pending!==D.pending_buf_size));)W(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>g&&(E.adler=C(E.adler,D.pending_buf,D.pending-g,g)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(73===D.status)if(D.gzhead.name){g=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>g&&(E.adler=C(E.adler,D.pending_buf,D.pending-g,g)),M(E),g=D.pending,D.pending===D.pending_buf_size)){N=1;break}N=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,W(D,N)}while(0!==N);D.gzhead.hcrc&&D.pending>g&&(E.adler=C(E.adler,D.pending_buf,D.pending-g,g)),0===N&&(D.gzindex=0,D.status=91)}else D.status=91;if(91===D.status)if(D.gzhead.comment){g=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>g&&(E.adler=C(E.adler,D.pending_buf,D.pending-g,g)),M(E),g=D.pending,D.pending===D.pending_buf_size)){N=1;break}N=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,W(D,N)}while(0!==N);D.gzhead.hcrc&&D.pending>g&&(E.adler=C(E.adler,D.pending_buf,D.pending-g,g)),0===N&&(D.status=j)}else D.status=j;if(D.status===j&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&M(E),D.pending+2<=D.pending_buf_size&&(W(D,255&E.adler),W(D,E.adler>>8&255),E.adler=0,D.status=Z)):D.status=Z),0!==D.pending){if(M(E),0===E.avail_out)return D.last_flush=-1,y}else if(0===E.avail_in&&a(U)<=a(s)&&U!==d)return w(E,x);if(D.status===A&&0!==E.avail_in)return w(E,x);if(0!==E.avail_in||0!==D.lookahead||U!==P&&D.status!==A){let g=D.strategy===t?((E,U)=>{let g;for(;;){if(0===E.lookahead&&(n(E),0===E.lookahead)){if(U===P)return 1;break}if(E.match_length=0,g=S(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,g&&(mE(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,U===d?(mE(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(mE(E,!1),0===E.strm.avail_out)?1:2})(D,U):D.strategy===G?((E,U)=>{let g,N,L,D;const u=E.window;for(;;){if(E.lookahead<=c){if(n(E),E.lookahead<=c&&U===P)return 1;if(0===E.lookahead)break}if(E.match_length=0,E.lookahead>=3&&E.strstart>0&&(L=E.strstart-1,N=u[L],N===u[++L]&&N===u[++L]&&N===u[++L])){D=E.strstart+c;do{}while(N===u[++L]&&N===u[++L]&&N===u[++L]&&N===u[++L]&&N===u[++L]&&N===u[++L]&&N===u[++L]&&N===u[++L]&&L<D);E.match_length=c-(D-L),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=3?(g=S(E,1,E.match_length-3),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(g=S(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),g&&(mE(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,U===d?(mE(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(mE(E,!1),0===E.strm.avail_out)?1:2})(D,U):p[D.level].func(D,U);if(3!==g&&4!==g||(D.status=A),1===g||3===g)return 0===E.avail_out&&(D.last_flush=-1),y;if(2===g&&(U===F?u(D):U!==I&&(L(D,0,0,!1),U===f&&(J(D.head),0===D.lookahead&&(D.strstart=0,D.block_start=0,D.insert=0))),M(E),0===E.avail_out))return D.last_flush=-1,y}return U!==d?y:D.wrap<=0?h:(2===D.wrap?(W(D,255&E.adler),W(D,E.adler>>8&255),W(D,E.adler>>16&255),W(D,E.adler>>24&255),W(D,255&E.total_in),W(D,E.total_in>>8&255),W(D,E.total_in>>16&255),W(D,E.total_in>>24&255)):(O(D,E.adler>>>16),O(D,65535&E.adler)),M(E),D.wrap>0&&(D.wrap=-D.wrap),0!==D.pending?y:h)},E.exports.deflateEnd=E=>{if(!E||!E.state)return V;const U=E.state.status;return 42!==U&&69!==U&&73!==U&&91!==U&&U!==j&&U!==Z&&U!==A?w(E,V):(E.state=null,U===Z?w(E,e):y)},E.exports.deflateSetDictionary=(E,U)=>{let g=U.length;if(!E||!E.state)return V;const N=E.state,L=N.wrap;if(2===L||1===L&&42!==N.status||N.lookahead)return V;if(1===L&&(E.adler=s(E.adler,U,g,0)),N.wrap=0,g>=N.w_size){0===L&&(J(N.head),N.strstart=0,N.block_start=0,N.insert=0);let E=new Uint8Array(N.w_size);E.set(U.subarray(g-N.w_size,g),0),U=E,g=N.w_size}const D=E.avail_in,S=E.next_in,u=E.input;for(E.avail_in=g,E.next_in=0,E.input=U,n(N);N.lookahead>=3;){let E=N.strstart,U=N.lookahead-2;do{N.ins_h=q(N,N.ins_h,N.window[E+3-1]),N.prev[E&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=E,E++}while(--U);N.strstart=E,N.lookahead=2,n(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=2,N.match_available=0,E.next_in=S,E.input=u,E.avail_in=D,N.wrap=L,y},E.exports.deflateInfo="pako deflate (from Nodeca project)"},13541:E=>{"use strict";E.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13534:E=>{"use strict";E.exports=function(E,U){let g,N,L,D,S,u,s,C,B,P,F,f,d,I,y,h,V,e,x,l,Y,t,G,b;const T=E.state;g=E.next_in,G=E.input,N=g+(E.avail_in-5),L=E.next_out,b=E.output,D=L-(U-E.avail_out),S=L+(E.avail_out-257),u=T.dmax,s=T.wsize,C=T.whave,B=T.wnext,P=T.window,F=T.hold,f=T.bits,d=T.lencode,I=T.distcode,y=(1<<T.lenbits)-1,h=(1<<T.distbits)-1;E:do{f<15&&(F+=G[g++]<<f,f+=8,F+=G[g++]<<f,f+=8),V=d[F&y];U:for(;;){if(e=V>>>24,F>>>=e,f-=e,e=V>>>16&255,0===e)b[L++]=65535&V;else{if(!(16&e)){if(0===(64&e)){V=d[(65535&V)+(F&(1<<e)-1)];continue U}if(32&e){T.mode=12;break E}E.CU="invalid literal/length code",T.mode=30;break E}x=65535&V,e&=15,e&&(f<e&&(F+=G[g++]<<f,f+=8),x+=F&(1<<e)-1,F>>>=e,f-=e),f<15&&(F+=G[g++]<<f,f+=8,F+=G[g++]<<f,f+=8),V=I[F&h];g:for(;;){if(e=V>>>24,F>>>=e,f-=e,e=V>>>16&255,!(16&e)){if(0===(64&e)){V=I[(65535&V)+(F&(1<<e)-1)];continue g}E.CU="invalid distance code",T.mode=30;break E}if(l=65535&V,e&=15,f<e&&(F+=G[g++]<<f,f+=8,f<e&&(F+=G[g++]<<f,f+=8)),l+=F&(1<<e)-1,l>u){E.CU="invalid distance too far back",T.mode=30;break E}if(F>>>=e,f-=e,e=L-D,l>e){if(e=l-e,e>C&&T.sane){E.CU="invalid distance too far back",T.mode=30;break E}if(Y=0,t=P,0===B){if(Y+=s-e,e<x){x-=e;do{b[L++]=P[Y++]}while(--e);Y=L-l,t=b}}else if(B<e){if(Y+=s+B-e,e-=B,e<x){x-=e;do{b[L++]=P[Y++]}while(--e);if(Y=0,B<x){e=B,x-=e;do{b[L++]=P[Y++]}while(--e);Y=L-l,t=b}}}else if(Y+=B-e,e<x){x-=e;do{b[L++]=P[Y++]}while(--e);Y=L-l,t=b}for(;x>2;)b[L++]=t[Y++],b[L++]=t[Y++],b[L++]=t[Y++],x-=3;x&&(b[L++]=t[Y++],x>1&&(b[L++]=t[Y++]))}else{Y=L-l;do{b[L++]=b[Y++],b[L++]=b[Y++],b[L++]=b[Y++],x-=3}while(x>2);x&&(b[L++]=b[Y++],x>1&&(b[L++]=b[Y++]))}break}}break}}while(g<N&&L<S);x=f>>3,g-=x,f-=x<<3,F&=(1<<f)-1,E.next_in=g,E.next_out=L,E.avail_in=g<N?N-g+5:5-(g-N),E.avail_out=L<S?S-L+257:257-(L-S),T.hold=F,T.bits=f}},13528:(E,U,g)=>{"use strict";const N=g(13484),L=g(13490),D=g(13534),S=g(13539),{Z_FINISH:u,Z_BLOCK:s,Z_TREES:C,Z_OK:B,Z_STREAM_END:P,Z_NEED_DICT:F,Z_STREAM_ERROR:f,Z_DATA_ERROR:d,Z_MEM_ERROR:I,Z_BUF_ERROR:y,Z_DEFLATED:h}=g(13502),V=12,e=30,x=E=>(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24);function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Y=E=>{if(!E||!E.state)return f;const U=E.state;return E.total_in=E.total_out=U.total=0,E.CU="",U.wrap&&(E.adler=1&U.wrap),U.mode=1,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new Int32Array(852),U.distcode=U.distdyn=new Int32Array(592),U.sane=1,U.back=-1,B},t=E=>{if(!E||!E.state)return f;const U=E.state;return U.wsize=0,U.whave=0,U.wnext=0,Y(E)},G=(E,U)=>{let g;if(!E||!E.state)return f;const N=E.state;return U<0?(g=0,U=-U):(g=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?f:(null!==N.window&&N.wbits!==U&&(N.window=null),N.wrap=g,N.wbits=U,t(E))},b=(E,U)=>{if(!E)return f;const g=new l;E.state=g,g.window=null;const N=G(E,U);return N!==B&&(E.state=null),N};let T,v,o=!0;const c=E=>{if(o){T=new Int32Array(512),v=new Int32Array(32);let U=0;for(;U<144;)E.lens[U++]=8;for(;U<256;)E.lens[U++]=9;for(;U<280;)E.lens[U++]=7;for(;U<288;)E.lens[U++]=8;for(S(1,E.lens,0,288,T,0,E.work,{bits:9}),U=0;U<32;)E.lens[U++]=5;S(2,E.lens,0,32,v,0,E.work,{bits:5}),o=!1}E.lencode=T,E.lenbits=9,E.distcode=v,E.distbits=5},r=(E,U,g,N)=>{let L;const D=E.state;return null===D.window&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new Uint8Array(D.wsize)),N>=D.wsize?(D.window.set(U.subarray(g-D.wsize,g),0),D.wnext=0,D.whave=D.wsize):(L=D.wsize-D.wnext,L>N&&(L=N),D.window.set(U.subarray(g-N,g-N+L),D.wnext),(N-=L)?(D.window.set(U.subarray(g-N,g),0),D.wnext=N,D.whave=D.wsize):(D.wnext+=L,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=L))),0};E.exports.inflateReset=t,E.exports.inflateReset2=G,E.exports.inflateResetKeep=Y,E.exports.inflateInit=E=>b(E,15),E.exports.inflateInit2=b,E.exports.inflate=(E,U)=>{let g,l,Y,t,G,b,T,v,o,j,Z,A,w,a,J,q,M,mE,W,O,Q,R,n=0;const k=new Uint8Array(4);let z,i;const p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!E||!E.state||!E.output||!E.input&&0!==E.avail_in)return f;g=E.state,g.mode===V&&(g.mode=13),G=E.next_out,Y=E.output,T=E.avail_out,t=E.next_in,l=E.input,b=E.avail_in,v=g.hold,o=g.bits,j=b,Z=T,R=B;E:for(;;)switch(g.mode){case 1:if(0===g.wrap){g.mode=13;break}for(;o<16;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(2&g.wrap&&35615===v){g.check=0,k[0]=255&v,k[1]=v>>>8&255,g.check=L(g.check,k,2,0),v=0,o=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&v)<<8)+(v>>8))%31){E.CU="incorrect header check",g.mode=e;break}if((15&v)!==h){E.CU="unknown compression method",g.mode=e;break}if(v>>>=4,o-=4,Q=8+(15&v),0===g.wbits)g.wbits=Q;else if(Q>g.wbits){E.CU="invalid window size",g.mode=e;break}g.dmax=1<<g.wbits,E.adler=g.check=1,g.mode=512&v?10:V,v=0,o=0;break;case 2:for(;o<16;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(g.flags=v,(255&g.flags)!==h){E.CU="unknown compression method",g.mode=e;break}if(57344&g.flags){E.CU="unknown header flags set",g.mode=e;break}g.head&&(g.head.text=v>>8&1),512&g.flags&&(k[0]=255&v,k[1]=v>>>8&255,g.check=L(g.check,k,2,0)),v=0,o=0,g.mode=3;case 3:for(;o<32;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}g.head&&(g.head.time=v),512&g.flags&&(k[0]=255&v,k[1]=v>>>8&255,k[2]=v>>>16&255,k[3]=v>>>24&255,g.check=L(g.check,k,4,0)),v=0,o=0,g.mode=4;case 4:for(;o<16;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}g.head&&(g.head.xflags=255&v,g.head.os=v>>8),512&g.flags&&(k[0]=255&v,k[1]=v>>>8&255,g.check=L(g.check,k,2,0)),v=0,o=0,g.mode=5;case 5:if(1024&g.flags){for(;o<16;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}g.length=v,g.head&&(g.head.extra_len=v),512&g.flags&&(k[0]=255&v,k[1]=v>>>8&255,g.check=L(g.check,k,2,0)),v=0,o=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(A=g.length,A>b&&(A=b),A&&(g.head&&(Q=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Uint8Array(g.head.extra_len)),g.head.extra.set(l.subarray(t,t+A),Q)),512&g.flags&&(g.check=L(g.check,l,A,t)),b-=A,t+=A,g.length-=A),g.length))break E;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(0===b)break E;A=0;do{Q=l[t+A++],g.head&&Q&&g.length<65536&&(g.head.name+=String.fromCharCode(Q))}while(Q&&A<b);if(512&g.flags&&(g.check=L(g.check,l,A,t)),b-=A,t+=A,Q)break E}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(0===b)break E;A=0;do{Q=l[t+A++],g.head&&Q&&g.length<65536&&(g.head.comment+=String.fromCharCode(Q))}while(Q&&A<b);if(512&g.flags&&(g.check=L(g.check,l,A,t)),b-=A,t+=A,Q)break E}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;o<16;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(v!==(65535&g.check)){E.CU="header crc mismatch",g.mode=e;break}v=0,o=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),E.adler=g.check=0,g.mode=V;break;case 10:for(;o<32;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}E.adler=g.check=x(v),v=0,o=0,g.mode=11;case 11:if(0===g.havedict)return E.next_out=G,E.avail_out=T,E.next_in=t,E.avail_in=b,g.hold=v,g.bits=o,F;E.adler=g.check=1,g.mode=V;case V:if(U===s||U===C)break E;case 13:if(g.last){v>>>=7&o,o-=7&o,g.mode=27;break}for(;o<3;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}switch(g.last=1&v,v>>>=1,o-=1,3&v){case 0:g.mode=14;break;case 1:if(c(g),g.mode=20,U===C){v>>>=2,o-=2;break E}break;case 2:g.mode=17;break;case 3:E.CU="invalid block type",g.mode=e}v>>>=2,o-=2;break;case 14:for(v>>>=7&o,o-=7&o;o<32;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if((65535&v)!==(v>>>16^65535)){E.CU="invalid stored block lengths",g.mode=e;break}if(g.length=65535&v,v=0,o=0,g.mode=15,U===C)break E;case 15:g.mode=16;case 16:if(A=g.length,A){if(A>b&&(A=b),A>T&&(A=T),0===A)break E;Y.set(l.subarray(t,t+A),G),b-=A,t+=A,T-=A,G+=A,g.length-=A;break}g.mode=V;break;case 17:for(;o<14;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(g.nlen=257+(31&v),v>>>=5,o-=5,g.ndist=1+(31&v),v>>>=5,o-=5,g.ncode=4+(15&v),v>>>=4,o-=4,g.nlen>286||g.ndist>30){E.CU="too many length or distance symbols",g.mode=e;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;o<3;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}g.lens[p[g.have++]]=7&v,v>>>=3,o-=3}for(;g.have<19;)g.lens[p[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,z={bits:g.lenbits},R=S(0,g.lens,0,19,g.lencode,0,g.work,z),g.lenbits=z.bits,R){E.CU="invalid code lengths set",g.mode=e;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;n=g.lencode[v&(1<<g.lenbits)-1],J=n>>>24,q=n>>>16&255,M=65535&n,!(J<=o);){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(M<16)v>>>=J,o-=J,g.lens[g.have++]=M;else{if(16===M){for(i=J+2;o<i;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(v>>>=J,o-=J,0===g.have){E.CU="invalid bit length repeat",g.mode=e;break}Q=g.lens[g.have-1],A=3+(3&v),v>>>=2,o-=2}else if(17===M){for(i=J+3;o<i;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}v>>>=J,o-=J,Q=0,A=3+(7&v),v>>>=3,o-=3}else{for(i=J+7;o<i;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}v>>>=J,o-=J,Q=0,A=11+(127&v),v>>>=7,o-=7}if(g.have+A>g.nlen+g.ndist){E.CU="invalid bit length repeat",g.mode=e;break}for(;A--;)g.lens[g.have++]=Q}}if(g.mode===e)break;if(0===g.lens[256]){E.CU="invalid code -- missing end-of-block",g.mode=e;break}if(g.lenbits=9,z={bits:g.lenbits},R=S(1,g.lens,0,g.nlen,g.lencode,0,g.work,z),g.lenbits=z.bits,R){E.CU="invalid literal/lengths set",g.mode=e;break}if(g.distbits=6,g.distcode=g.distdyn,z={bits:g.distbits},R=S(2,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,z),g.distbits=z.bits,R){E.CU="invalid distances set",g.mode=e;break}if(g.mode=20,U===C)break E;case 20:g.mode=21;case 21:if(b>=6&&T>=258){E.next_out=G,E.avail_out=T,E.next_in=t,E.avail_in=b,g.hold=v,g.bits=o,D(E,Z),G=E.next_out,Y=E.output,T=E.avail_out,t=E.next_in,l=E.input,b=E.avail_in,v=g.hold,o=g.bits,g.mode===V&&(g.back=-1);break}for(g.back=0;n=g.lencode[v&(1<<g.lenbits)-1],J=n>>>24,q=n>>>16&255,M=65535&n,!(J<=o);){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(q&&0===(240&q)){for(mE=J,W=q,O=M;n=g.lencode[O+((v&(1<<mE+W)-1)>>mE)],J=n>>>24,q=n>>>16&255,M=65535&n,!(mE+J<=o);){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}v>>>=mE,o-=mE,g.back+=mE}if(v>>>=J,o-=J,g.back+=J,g.length=M,0===q){g.mode=26;break}if(32&q){g.back=-1,g.mode=V;break}if(64&q){E.CU="invalid literal/length code",g.mode=e;break}g.extra=15&q,g.mode=22;case 22:if(g.extra){for(i=g.extra;o<i;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}g.length+=v&(1<<g.extra)-1,v>>>=g.extra,o-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;n=g.distcode[v&(1<<g.distbits)-1],J=n>>>24,q=n>>>16&255,M=65535&n,!(J<=o);){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(0===(240&q)){for(mE=J,W=q,O=M;n=g.distcode[O+((v&(1<<mE+W)-1)>>mE)],J=n>>>24,q=n>>>16&255,M=65535&n,!(mE+J<=o);){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}v>>>=mE,o-=mE,g.back+=mE}if(v>>>=J,o-=J,g.back+=J,64&q){E.CU="invalid distance code",g.mode=e;break}g.offset=M,g.extra=15&q,g.mode=24;case 24:if(g.extra){for(i=g.extra;o<i;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}g.offset+=v&(1<<g.extra)-1,v>>>=g.extra,o-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){E.CU="invalid distance too far back",g.mode=e;break}g.mode=25;case 25:if(0===T)break E;if(A=Z-T,g.offset>A){if(A=g.offset-A,A>g.whave&&g.sane){E.CU="invalid distance too far back",g.mode=e;break}A>g.wnext?(A-=g.wnext,w=g.wsize-A):w=g.wnext-A,A>g.length&&(A=g.length),a=g.window}else a=Y,w=G-g.offset,A=g.length;A>T&&(A=T),T-=A,g.length-=A;do{Y[G++]=a[w++]}while(--A);0===g.length&&(g.mode=21);break;case 26:if(0===T)break E;Y[G++]=g.length,T--,g.mode=21;break;case 27:if(g.wrap){for(;o<32;){if(0===b)break E;b--,v|=l[t++]<<o,o+=8}if(Z-=T,E.total_out+=Z,g.total+=Z,Z&&(E.adler=g.check=g.flags?L(g.check,Y,Z,G-Z):N(g.check,Y,Z,G-Z)),Z=T,(g.flags?v:x(v))!==g.check){E.CU="incorrect data check",g.mode=e;break}v=0,o=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;o<32;){if(0===b)break E;b--,v+=l[t++]<<o,o+=8}if(v!==(4294967295&g.total)){E.CU="incorrect length check",g.mode=e;break}v=0,o=0}g.mode=29;case 29:R=P;break E;case e:R=d;break E;case 31:return I;default:return f}return E.next_out=G,E.avail_out=T,E.next_in=t,E.avail_in=b,g.hold=v,g.bits=o,(g.wsize||Z!==E.avail_out&&g.mode<e&&(g.mode<27||U!==u))&&r(E,E.output,E.next_out,Z-E.avail_out)?(g.mode=31,I):(j-=E.avail_in,Z-=E.avail_out,E.total_in+=j,E.total_out+=Z,g.total+=Z,g.wrap&&Z&&(E.adler=g.check=g.flags?L(g.check,Y,Z,E.next_out-Z):N(g.check,Y,Z,E.next_out-Z)),E.data_type=g.bits+(g.last?64:0)+(g.mode===V?128:0)+(20===g.mode||15===g.mode?256:0),(0===j&&0===Z||U===u)&&R===B&&(R=y),R)},E.exports.inflateEnd=E=>{if(!E||!E.state)return f;let U=E.state;return U.window&&(U.window=null),E.state=null,B},E.exports.inflateGetHeader=(E,U)=>{if(!E||!E.state)return f;const g=E.state;return 0===(2&g.wrap)?f:(g.head=U,U.done=!1,B)},E.exports.inflateSetDictionary=(E,U)=>{const g=U.length;let L,D,S;return E&&E.state?(L=E.state,0!==L.wrap&&11!==L.mode?f:11===L.mode&&(D=1,D=N(D,U,g,0),D!==L.check)?d:(S=r(E,U,g,g),S?(L.mode=31,I):(L.havedict=1,B))):f},E.exports.inflateInfo="pako inflate (from Nodeca project)"},13539:E=>{"use strict";const U=15,g=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),N=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),L=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),D=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);E.exports=(E,S,u,s,C,B,P,F)=>{const f=F.bits;let d,I,y,h,V,e,x=0,l=0,Y=0,t=0,G=0,b=0,T=0,v=0,o=0,c=0,r=null,j=0;const Z=new Uint16Array(16),A=new Uint16Array(16);let w,a,J,q=null,M=0;for(x=0;x<=U;x++)Z[x]=0;for(l=0;l<s;l++)Z[S[u+l]]++;for(G=f,t=U;t>=1&&0===Z[t];t--);if(G>t&&(G=t),0===t)return C[B++]=20971520,C[B++]=20971520,F.bits=1,0;for(Y=1;Y<t&&0===Z[Y];Y++);for(G<Y&&(G=Y),v=1,x=1;x<=U;x++)if(v<<=1,v-=Z[x],v<0)return-1;if(v>0&&(0===E||1!==t))return-1;for(A[1]=0,x=1;x<U;x++)A[x+1]=A[x]+Z[x];for(l=0;l<s;l++)0!==S[u+l]&&(P[A[S[u+l]]++]=l);if(0===E?(r=q=P,e=19):1===E?(r=g,j-=257,q=N,M-=257,e=256):(r=L,q=D,e=-1),c=0,l=0,x=Y,V=B,b=G,T=0,y=-1,o=1<<G,h=o-1,1===E&&o>852||2===E&&o>592)return 1;for(;;){w=x-T,P[l]<e?(a=0,J=P[l]):P[l]>e?(a=q[M+P[l]],J=r[j+P[l]]):(a=96,J=0),d=1<<x-T,I=1<<b,Y=I;do{I-=d,C[V+(c>>T)+I]=w<<24|a<<16|J}while(0!==I);for(d=1<<x-1;c&d;)d>>=1;if(0!==d?(c&=d-1,c+=d):c=0,l++,0===--Z[x]){if(x===t)break;x=S[u+P[l]]}if(x>G&&(c&h)!==y){for(0===T&&(T=G),V+=Y,b=x-T,v=1<<b;b+T<t&&(v-=Z[b+T],!(v<=0));)b++,v<<=1;if(o+=1<<b,1===E&&o>852||2===E&&o>592)return 1;y=c&h,C[y]=G<<24|b<<16|V-B}}return 0!==c&&(C[V+c]=x-T<<24|64<<16),F.bits=G,0}},13499:E=>{"use strict";E.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13475:E=>{"use strict";function U(E){let U=E.length;for(;--U>=0;)E[U]=0}const g=256,N=286,L=30,D=15,S=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),u=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),s=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),B=new Array(576);U(B);const P=new Array(60);U(P);const F=new Array(512);U(F);const f=new Array(256);U(f);const d=new Array(29);U(d);const I=new Array(L);function y(E,U,g,N,L){this.static_tree=E,this.extra_bits=U,this.extra_base=g,this.elems=N,this.max_length=L,this.has_stree=E&&E.length}let h,V,e;function x(E,U){this.dyn_tree=E,this.max_code=0,this.stat_desc=U}U(I);const l=E=>E<256?F[E]:F[256+(E>>>7)],Y=(E,U)=>{E.pending_buf[E.pending++]=255&U,E.pending_buf[E.pending++]=U>>>8&255},t=(E,U,g)=>{E.bi_valid>16-g?(E.bi_buf|=U<<E.bi_valid&65535,Y(E,E.bi_buf),E.bi_buf=U>>16-E.bi_valid,E.bi_valid+=g-16):(E.bi_buf|=U<<E.bi_valid&65535,E.bi_valid+=g)},G=(E,U,g)=>{t(E,g[2*U],g[2*U+1])},b=(E,U)=>{let g=0;do{g|=1&E,E>>>=1,g<<=1}while(--U>0);return g>>>1},T=(E,U,g)=>{const N=new Array(16);let L,S,u=0;for(L=1;L<=D;L++)N[L]=u=u+g[L-1]<<1;for(S=0;S<=U;S++){let U=E[2*S+1];0!==U&&(E[2*S]=b(N[U]++,U))}},v=E=>{let U;for(U=0;U<N;U++)E.dyn_ltree[2*U]=0;for(U=0;U<L;U++)E.dyn_dtree[2*U]=0;for(U=0;U<19;U++)E.bl_tree[2*U]=0;E.dyn_ltree[512]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0},o=E=>{E.bi_valid>8?Y(E,E.bi_buf):E.bi_valid>0&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0},c=(E,U,g,N)=>{const L=2*U,D=2*g;return E[L]<E[D]||E[L]===E[D]&&N[U]<=N[g]},r=(E,U,g)=>{const N=E.heap[g];let L=g<<1;for(;L<=E.heap_len&&(L<E.heap_len&&c(U,E.heap[L+1],E.heap[L],E.depth)&&L++,!c(U,N,E.heap[L],E.depth));)E.heap[g]=E.heap[L],g=L,L<<=1;E.heap[g]=N},j=(E,U,N)=>{let L,D,s,C,B=0;if(0!==E.last_lit)do{L=E.pending_buf[E.d_buf+2*B]<<8|E.pending_buf[E.d_buf+2*B+1],D=E.pending_buf[E.l_buf+B],B++,0===L?G(E,D,U):(s=f[D],G(E,s+g+1,U),C=S[s],0!==C&&(D-=d[s],t(E,D,C)),L--,s=l(L),G(E,s,N),C=u[s],0!==C&&(L-=I[s],t(E,L,C)))}while(B<E.last_lit);G(E,256,U)},Z=(E,U)=>{const g=U.dyn_tree,N=U.stat_desc.static_tree,L=U.stat_desc.has_stree,S=U.stat_desc.elems;let u,s,C,B=-1;for(E.heap_len=0,E.heap_max=573,u=0;u<S;u++)0!==g[2*u]?(E.heap[++E.heap_len]=B=u,E.depth[u]=0):g[2*u+1]=0;for(;E.heap_len<2;)C=E.heap[++E.heap_len]=B<2?++B:0,g[2*C]=1,E.depth[C]=0,E.opt_len--,L&&(E.static_len-=N[2*C+1]);for(U.max_code=B,u=E.heap_len>>1;u>=1;u--)r(E,g,u);C=S;do{u=E.heap[1],E.heap[1]=E.heap[E.heap_len--],r(E,g,1),s=E.heap[1],E.heap[--E.heap_max]=u,E.heap[--E.heap_max]=s,g[2*C]=g[2*u]+g[2*s],E.depth[C]=(E.depth[u]>=E.depth[s]?E.depth[u]:E.depth[s])+1,g[2*u+1]=g[2*s+1]=C,E.heap[1]=C++,r(E,g,1)}while(E.heap_len>=2);E.heap[--E.heap_max]=E.heap[1],((E,U)=>{const g=U.dyn_tree,N=U.max_code,L=U.stat_desc.static_tree,S=U.stat_desc.has_stree,u=U.stat_desc.extra_bits,s=U.stat_desc.extra_base,C=U.stat_desc.max_length;let B,P,F,f,d,I,y=0;for(f=0;f<=D;f++)E.bl_count[f]=0;for(g[2*E.heap[E.heap_max]+1]=0,B=E.heap_max+1;B<573;B++)P=E.heap[B],f=g[2*g[2*P+1]+1]+1,f>C&&(f=C,y++),g[2*P+1]=f,P>N||(E.bl_count[f]++,d=0,P>=s&&(d=u[P-s]),I=g[2*P],E.opt_len+=I*(f+d),S&&(E.static_len+=I*(L[2*P+1]+d)));if(0!==y){do{for(f=C-1;0===E.bl_count[f];)f--;E.bl_count[f]--,E.bl_count[f+1]+=2,E.bl_count[C]--,y-=2}while(y>0);for(f=C;0!==f;f--)for(P=E.bl_count[f];0!==P;)F=E.heap[--B],F>N||(g[2*F+1]!==f&&(E.opt_len+=(f-g[2*F+1])*g[2*F],g[2*F+1]=f),P--)}})(E,U),T(g,B,E.bl_count)},A=(E,U,g)=>{let N,L,D=-1,S=U[1],u=0,s=7,C=4;for(0===S&&(s=138,C=3),U[2*(g+1)+1]=65535,N=0;N<=g;N++)L=S,S=U[2*(N+1)+1],++u<s&&L===S||(u<C?E.bl_tree[2*L]+=u:0!==L?(L!==D&&E.bl_tree[2*L]++,E.bl_tree[32]++):u<=10?E.bl_tree[34]++:E.bl_tree[36]++,u=0,D=L,0===S?(s=138,C=3):L===S?(s=6,C=3):(s=7,C=4))},w=(E,U,g)=>{let N,L,D=-1,S=U[1],u=0,s=7,C=4;for(0===S&&(s=138,C=3),N=0;N<=g;N++)if(L=S,S=U[2*(N+1)+1],!(++u<s&&L===S)){if(u<C)do{G(E,L,E.bl_tree)}while(0!==--u);else 0!==L?(L!==D&&(G(E,L,E.bl_tree),u--),G(E,16,E.bl_tree),t(E,u-3,2)):u<=10?(G(E,17,E.bl_tree),t(E,u-3,3)):(G(E,18,E.bl_tree),t(E,u-11,7));u=0,D=L,0===S?(s=138,C=3):L===S?(s=6,C=3):(s=7,C=4)}};let a=!1;const J=(E,U,g,N)=>{t(E,0+(N?1:0),3),((E,U,g,N)=>{o(E),N&&(Y(E,g),Y(E,~g)),E.pending_buf.set(E.window.subarray(U,U+g),E.pending),E.pending+=g})(E,U,g,!0)};E.exports._tr_init=E=>{a||((()=>{let E,U,g,C,x;const l=new Array(16);for(g=0,C=0;C<28;C++)for(d[C]=g,E=0;E<1<<S[C];E++)f[g++]=C;for(f[g-1]=C,x=0,C=0;C<16;C++)for(I[C]=x,E=0;E<1<<u[C];E++)F[x++]=C;for(x>>=7;C<L;C++)for(I[C]=x<<7,E=0;E<1<<u[C]-7;E++)F[256+x++]=C;for(U=0;U<=D;U++)l[U]=0;for(E=0;E<=143;)B[2*E+1]=8,E++,l[8]++;for(;E<=255;)B[2*E+1]=9,E++,l[9]++;for(;E<=279;)B[2*E+1]=7,E++,l[7]++;for(;E<=287;)B[2*E+1]=8,E++,l[8]++;for(T(B,287,l),E=0;E<L;E++)P[2*E+1]=5,P[2*E]=b(E,5);h=new y(B,S,257,N,D),V=new y(P,u,0,L,D),e=new y(new Array(0),s,0,19,7)})(),a=!0),E.l_desc=new x(E.dyn_ltree,h),E.d_desc=new x(E.dyn_dtree,V),E.bl_desc=new x(E.bl_tree,e),E.bi_buf=0,E.bi_valid=0,v(E)},E.exports._tr_stored_block=J,E.exports._tr_flush_block=(E,U,N,L)=>{let D,S,u=0;E.level>0?(2===E.strm.data_type&&(E.strm.data_type=(E=>{let U,N=4093624447;for(U=0;U<=31;U++,N>>>=1)if(1&N&&0!==E.dyn_ltree[2*U])return 0;if(0!==E.dyn_ltree[18]||0!==E.dyn_ltree[20]||0!==E.dyn_ltree[26])return 1;for(U=32;U<g;U++)if(0!==E.dyn_ltree[2*U])return 1;return 0})(E)),Z(E,E.l_desc),Z(E,E.d_desc),u=(E=>{let U;for(A(E,E.dyn_ltree,E.l_desc.max_code),A(E,E.dyn_dtree,E.d_desc.max_code),Z(E,E.bl_desc),U=18;U>=3&&0===E.bl_tree[2*C[U]+1];U--);return E.opt_len+=3*(U+1)+5+5+4,U})(E),D=E.opt_len+3+7>>>3,S=E.static_len+3+7>>>3,S<=D&&(D=S)):D=S=N+5,N+4<=D&&-1!==U?J(E,U,N,L):4===E.strategy||S===D?(t(E,2+(L?1:0),3),j(E,B,P)):(t(E,4+(L?1:0),3),((E,U,g,N)=>{let L;for(t(E,U-257,5),t(E,g-1,5),t(E,N-4,4),L=0;L<N;L++)t(E,E.bl_tree[2*C[L]+1],3);w(E,E.dyn_ltree,U-1),w(E,E.dyn_dtree,g-1)})(E,E.l_desc.max_code+1,E.d_desc.max_code+1,u+1),j(E,E.dyn_ltree,E.dyn_dtree)),v(E),L&&o(E)},E.exports._tr_tally=(E,U,N)=>(E.pending_buf[E.d_buf+2*E.last_lit]=U>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&U,E.pending_buf[E.l_buf+E.last_lit]=255&N,E.last_lit++,0===U?E.dyn_ltree[2*N]++:(E.matches++,U--,E.dyn_ltree[2*(f[N]+g+1)]++,E.dyn_dtree[2*l(U)]++),E.last_lit===E.lit_bufsize-1),E.exports._tr_align=E=>{t(E,2,3),G(E,256,B),(E=>{16===E.bi_valid?(Y(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):E.bi_valid>=8&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)})(E)}},13519:E=>{"use strict";E.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.CU="",this.state=null,this.data_type=2,this.adler=0}},13132:E=>{function U(E,U,g){for(var N=E.length,L=-1/0,D=1/0,S=0;S<N;S++){var u=(g[0][S]-E[S])/U[S],s=(g[1][S]-E[S])/U[S];if(u>s){var C=u;u=s,s=C}if(s<L||u>D)return 1/0;u>L&&(L=u),s<D&&(D=s)}return L>D?1/0:L}E.exports=function(E,g,N,L){var D=U(g,N,L);if(D===1/0)E=null;else{E=E||[];for(var S=0;S<g.length;S++)E[S]=g[S]+N[S]*D}return E},E.exports.distance=U},14563:(E,U,g)=>{"use strict";g.d(U,{d:()=>S});var N=g(34);const L=N.useLayoutEffect;const D=function(E){var U=(0,N.useRef)(E);return L((function(){U.current=E})),U};var S=function(E){var U=D(E);(0,N.SU)((function(){var E=function(E){var g;if(null!=U.current&&(g=U.current(E)),E.defaultPrevented&&(E.returnValue=""),"string"===typeof g)return E.returnValue=g,g};return window.addEventListener("beforeunload",E),function(){window.removeEventListener("beforeunload",E)}}),[])}},14508:(E,U,g)=>{"use strict";var N=g(14516),L=Array.prototype.concat,D=Array.prototype.slice,S=E.exports=function(E){for(var U=[],g=0,S=E.length;g<S;g++){var u=E[g];N(u)?U=L.call(U,D.call(u)):U.push(u)}return U};S.wrap=function(E){return function(){return E(S(arguments))}}},14516:E=>{E.exports=function(E){return!(!E||"string"===typeof E)&&(E instanceof Array||Array.isArray(E)||E.length>=0&&(E.splice instanceof Function||Object.getOwnPropertyDescriptor(E,E.length-1)&&"String"!==E.constructor.name))}},13412:(E,U,g)=>{var N=g(13421);function L(E){for(var U,g,L=0,D=E.length,S=0;S<E.length;){for(U=E[S],g=0;S<D&&E[S]===U;)++S,++g;L+=N.log2(g)/7|0,L+=N.log2(U>>>0)/7|0,L+=2}return L}U.size=L,U.encode=function(E,U){U||(U=new Uint8Array(L(E)));for(var g,N,D=0,S=U.length,u=0;u<E.length;){for(g=E[u],N=0;u<E.length&&E[u]===g;)++u,++N;for(;D<S&&N>=128;)U[D++]=128+(127&N),N>>>=7;if(D>=S)throw new Error("RLE buffer overflow");for(U[D++]=N,g>>>=0;D<S&&g>=128;)U[D++]=128+(127&g),g>>>=7;if(D>=S)throw new Error("RLE buffer overflow");U[D++]=g}return U},U.decode=function(E,U){for(var g,N,L,D,S=U.length,u=E.length,s=0,C=0;C<u;){for(g=0,N=0;C<u&&E[C]>=128;)g+=(127&E[C++])<<N,N+=7;if(g+=E[C++]<<N,C>=u)throw new Error("RLE buffer underrun");if(s+g>S)throw new Error("Chunk buffer overflow");for(L=0,N=0;C<u&&E[C]>=128;)L+=(127&E[C++])<<N,N+=7;if(C>=u)throw new Error("RLE buffer underrun");for(L+=E[C++]<<N,D=0;D<g;++D)U[s++]=L}return U}},13421:(E,U)=>{"use strict";function g(E){var U=32;return(E&=-E)&&U--,65535&E&&(U-=16),16711935&E&&(U-=8),252645135&E&&(U-=4),858993459&E&&(U-=2),1431655765&E&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(E){return(E>0)-(E<0)},U.abs=function(E){var U=E>>31;return(E^U)-U},U.min=function(E,U){return U^(E^U)&-(E<U)},U.max=function(E,U){return E^(E^U)&-(E<U)},U.isPow2=function(E){return!(E&E-1)&&!!E},U.log2=function(E){var U,g;return U=(E>65535)<<4,U|=g=((E>>>=U)>255)<<3,U|=g=((E>>>=g)>15)<<2,(U|=g=((E>>>=g)>3)<<1)|(E>>>=g)>>1},U.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},U.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},U.countTrailingZeros=g,U.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},U.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},U.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var N=new Array(256);!function(E){for(var U=0;U<256;++U){var g=U,N=U,L=7;for(g>>>=1;g;g>>>=1)N<<=1,N|=1&g,--L;E[U]=N<<L&255}}(N),U.reverse=function(E){return N[255&E]<<24|N[E>>>8&255]<<16|N[E>>>16&255]<<8|N[E>>>24&255]},U.interleave2=function(E,U){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(E,U){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>U&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},U.interleave3=function(E,U,g){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2))<<2},U.deinterleave3=function(E,U){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>U&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},U.nextCombination=function(E){var U=E|E-1;return U+1|(~U&-~U)-1>>>g(E)+1}},13454:E=>{"use strict";E.exports=function(E,U,g,N){var L=self||window;try{try{var D;try{D=new L.Blob([E])}catch(C){(D=new(L.BlobBuilder||L.WebKitBlobBuilder||L.MozBlobBuilder||L.MSBlobBuilder)).append(E),D=D.getBlob()}var S=L.URL||L.webkitURL,u=S.createObjectURL(D),s=new L[U](u,g);return S.revokeObjectURL(u),s}catch(C){return new L[U]("data:application/javascript,".concat(encodeURIComponent(E)),g)}}catch(C){if(!N)throw Error("Inline worker is not supported");return new L[U](N,g)}}},13113:(E,U,g)=>{"use strict";function N(E,U,g,N,L){var D={};return Object.keys(N).forEach((function(E){D[E]=N[E]})),D.enumerable=!!D.enumerable,D.configurable=!!D.configurable,("value"in D||D.initializer)&&(D.writable=!0),D=g.slice().reverse().reduce((function(g,N){return N(E,U,g)||g}),D),L&&void 0!==D.initializer&&(D.value=D.initializer?D.initializer.call(L):void 0,D.initializer=void 0),void 0===D.initializer&&(Object.defineProperty(E,U,D),D=null),D}g.d(U,{d:()=>N})},13111:(E,U,g)=>{"use strict";function N(E,U,g,N){g&&Object.defineProperty(E,U,{enumerable:g.enumerable,configurable:g.configurable,writable:g.writable,value:g.initializer?g.initializer.call(N):void 0})}g.d(U,{c:()=>N})},14551:(E,U,g)=>{"use strict";g.d(U,{d:()=>S,g:()=>P,h:()=>u,l:()=>D,n:()=>s,r:()=>L,s:()=>C,v:()=>B});var N=g(12542);class L{constructor(){this._easingMode=L.EASINGMODE_EASEIN}setEasingMode(E){const U=Math.min(Math.max(E,0),2);this._easingMode=U}getEasingMode(){return this._easingMode}easeInCore(E){throw new Error("You must implement this method")}ease(E){switch(this._easingMode){case L.EASINGMODE_EASEIN:return this.easeInCore(E);case L.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-E)}return E>=.5?.5*(1-this.easeInCore(2*(1-E)))+.5:.5*this.easeInCore(2*E)}}L.EASINGMODE_EASEIN=0,L.EASINGMODE_EASEOUT=1,L.EASINGMODE_EASEINOUT=2;class D extends L{easeInCore(E){return E=Math.max(0,Math.min(1,E)),1-Math.sqrt(1-E*E)}}class S extends L{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=E}easeInCore(E){const U=Math.max(0,this.amplitude);return Math.pow(E,3)-E*U*Math.sin(3.141592653589793*E)}}class u extends L{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=E,this.bounciness=U}easeInCore(E){const U=Math.max(0,this.bounces);let g=this.bounciness;g<=1&&(g=1.001);const N=Math.pow(g,U),L=1-g,D=(1-N)/L+.5*N,S=E*D,u=Math.log(-S*(1-g)+1)/Math.log(g),s=Math.floor(u),C=s+1,B=(1-Math.pow(g,s))/(L*D),P=.5*(B+(1-Math.pow(g,C))/(L*D)),F=E-P,f=P-B;return-Math.pow(1/g,U-s)/(f*f)*(F-f)*(F+f)}}class s extends L{easeInCore(E){return E*E*E}}class C extends L{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=E,this.springiness=U}easeInCore(E){let U;const g=Math.max(0,this.oscillations),N=Math.max(0,this.springiness);return U=0==N?E:(Math.exp(N*E)-1)/(Math.exp(N)-1),U*Math.sin((6.283185307179586*g+1.5707963267948966)*E)}}class B extends L{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=E}easeInCore(E){return this.exponent<=0?E:(Math.exp(this.exponent*E)-1)/(Math.exp(this.exponent)-1)}}class P extends L{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=E,this.y1=U,this.x2=g,this.y2=N}easeInCore(E){return N.c.Interpolate(E,this.x1,this.y1,this.x2,this.y2)}}},13972:(E,U,g)=>{"use strict";g.d(U,{b:()=>S});var N=g(12334),L=g(12345),D=g(12752);class S extends D.c{get _matrix(){return this._compose(),this.fF}set _matrix(E){(E.updateFlag!==this.fF.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.fF.D(E),this._markAsDirtyAndDecompose())}constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(E,U.tE(),!1),this.name=E,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=U,this.fF=(null===L||void 0===L?void 0:L.clone())??N.Matrix.Identity(),this._restMatrix=D??this.fF.clone(),this._bindMatrix=S??this.fF.clone(),this._index=u,this._absoluteMatrix=new N.Matrix,this._absoluteBindMatrix=new N.Matrix,this._absoluteInverseBindMatrix=new N.Matrix,this._finalMatrix=new N.Matrix,U.bones.push(this),this.setParent(g,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(E){this.setParent(E)}setParent(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==E){if(this.parent){const E=this.parent.children.indexOf(this);-1!==E&&this.parent.children.splice(E,1)}this._parentNode=E,this.parent&&this.parent.children.push(this),U&&this._updateAbsoluteBindMatrices(),this.qC()}}getLocalMatrix(){return this._compose(),this.fF}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(E){this._restMatrix.D(E)}setRestPose(E){this.setRestMatrix(E)}getBindPose(){return this.getBindMatrix()}setBindMatrix(E){this.zg(E)}setBindPose(E){this.setBindMatrix(E)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const E=N.TmpVectors.dU[0],U=N.TmpVectors.Quaternion[0],g=N.TmpVectors.dU[1];this.getRestMatrix().decompose(E,U,g),this._linkedTransformNode.position.D(g),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??N.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.D(U),this._linkedTransformNode.Iu.D(E)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(E){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=E,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Wu}set position(E){this._decompose(),this.Wu.D(E),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(E){this.setRotation(E)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(E){this.setRotationQuaternion(E)}get Iu(){return this.getScale()}set Iu(E){this.setScale(E)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=N.dU.Zero(),this._localRotation=N.Quaternion.Zero(),this.Wu=N.dU.Zero()),this.fF.decompose(this._localScaling,this._localRotation,this.Wu))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,N.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Wu,this.fF)):this._needToCompose=!1)}zg(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.D(E),U&&this._updateAbsoluteBindMatrices(),g?this._matrix=E:this.qC()}_updateAbsoluteBindMatrices(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(E||(E=this._bindMatrix),this.parent?E.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.D(E),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),U)for(let g=0;g<this.children.length;g++)this.children[g]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}qC(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.qC(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.qC(),this._needToDecompose=!0}_updatePosition(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0,L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const D=this.getLocalMatrix();if(0==U)L?(D.addAtIndex(12,E.x),D.addAtIndex(13,E.y),D.addAtIndex(14,E.z)):D.setTranslationFromFloats(E.x,E.y,E.z);else{let U=null;g&&(U=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=S._TmpMats[0],s=S._TmpVecs[0];this.parent?g&&U?(u.D(this.parent.getAbsoluteMatrix()),u.multiplyToRef(U,u)):u.D(this.parent.getAbsoluteMatrix()):N.Matrix.IdentityToRef(u),L&&u.setTranslationFromFloats(0,0,0),u.invert(),N.dU.TransformCoordinatesToRef(E,u,s),L?(D.addAtIndex(12,s.x),D.addAtIndex(13,s.y),D.addAtIndex(14,s.z)):D.setTranslationFromFloats(s.x,s.y,s.z)}this._markAsDirtyAndDecompose()}translate(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,U,g,!0)}setPosition(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,U,g,!1)}setAbsolutePosition(E,U){this.setPosition(E,1,U)}scale(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const D=this.getLocalMatrix(),u=S._TmpMats[0];N.Matrix.ScalingToRef(E,U,g,u),u.multiplyToRef(D,D),u.invert();for(const N of this.children){const L=N.getLocalMatrix();L.multiplyToRef(u,L),L.multiplyAtIndex(12,E),L.multiplyAtIndex(13,U),L.multiplyAtIndex(14,g),N._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),L)for(const N of this.children)N.scale(E,U,g,L)}setScale(E){this._decompose(),this._localScaling.D(E),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(E){this._decompose(),E.D(this._localScaling)}setYawPitchRoll(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,D=arguments.length>4?arguments[4]:void 0;if(0===L){const u=S._TmpQuat;return N.Quaternion.RotationYawPitchRollToRef(E,U,g,u),void this.setRotationQuaternion(u,L,D)}const u=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,D))return;const s=S._TmpMats[1];N.Matrix.RotationYawPitchRollToRef(E,U,g,s),u.multiplyToRef(s,s),this._rotateWithMatrix(s,L,D)}rotate(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3?arguments[3]:void 0;const D=S._TmpMats[0];D.setTranslationFromFloats(0,0,0),N.Matrix.RotationAxisToRef(E,U,D),this._rotateWithMatrix(D,g,L)}setAxisAngle(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3?arguments[3]:void 0;if(0===g){const D=S._TmpQuat;return N.Quaternion.RotationAxisToRef(E,U,D),void this.setRotationQuaternion(D,g,L)}const D=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(D,L))return;const u=S._TmpMats[1];N.Matrix.RotationAxisToRef(E,U,u),D.multiplyToRef(u,u),this._rotateWithMatrix(u,g,L)}setRotation(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(E.y,E.x,E.z,U,g)}setRotationQuaternion(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;if(0===U)return this._decompose(),this._localRotation.D(E),void this._markAsDirtyAndCompose();const L=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,g))return;const D=S._TmpMats[1];N.Matrix.FromQuaternionToRef(E,D),L.multiplyToRef(D,D),this._rotateWithMatrix(D,U,g)}setRotationMatrix(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;if(0===U){const L=S._TmpQuat;return N.Quaternion.FromRotationMatrixToRef(E,L),void this.setRotationQuaternion(L,U,g)}const L=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,g))return;const D=S._TmpMats[1];D.D(E),L.multiplyToRef(E,D),this._rotateWithMatrix(D,U,g)}_rotateWithMatrix(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;const N=this.getLocalMatrix(),L=N.m[12],D=N.m[13],u=N.m[14],s=this.getParent(),C=S._TmpMats[3],B=S._TmpMats[4];s&&1==U?(g?(C.D(g.getWorldMatrix()),s.getAbsoluteMatrix().multiplyToRef(C,C)):C.D(s.getAbsoluteMatrix()),B.D(C),B.invert(),N.multiplyToRef(C,N),N.multiplyToRef(E,N),N.multiplyToRef(B,N)):1==U&&g?(C.D(g.getWorldMatrix()),B.D(C),B.invert(),N.multiplyToRef(C,N),N.multiplyToRef(E,N),N.multiplyToRef(B,N)):N.multiplyToRef(E,N),N.setTranslationFromFloats(L,D,u),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(E,U){const g=S._TmpMats[2];return E.D(this.getAbsoluteMatrix()),U?(E.multiplyToRef(U.getWorldMatrix(),E),N.Matrix.ScalingToRef(U.Iu.x,U.Iu.y,U.Iu.z,g)):N.Matrix.IdentityToRef(g),E.invert(),!isNaN(E.m[0])&&(g.multiplyAtIndex(0,this._scalingDeterminant),E.multiplyToRef(g,E),!0)}Sg(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=N.dU.Zero();return this.getPositionToRef(E,U,g),g}getPositionToRef(){let E=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const E=this.getLocalMatrix();U.x=E.m[12],U.y=E.m[13],U.z=E.m[14]}else{let g=null;E&&(g=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let N=S._TmpMats[0];E&&g?(N.D(this.getAbsoluteMatrix()),N.multiplyToRef(g,N)):N=this.getAbsoluteMatrix(),U.x=N.m[12],U.y=N.m[13],U.z=N.m[14]}}getAbsolutePosition(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=N.dU.Zero();return this.getPositionToRef(1,E,U),U}getAbsolutePositionToRef(E,U){this.getPositionToRef(1,E,U)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.fF.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.D(this.fF);const E=this._skeleton.getPoseMatrix();E&&this._absoluteMatrix.multiplyToRef(E,this._absoluteMatrix)}const E=this.children,U=E.length;for(let g=0;g<U;g++)E[g].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Is(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=N.dU.Zero();return this.getDirectionToRef(E,U,g),g}getDirectionToRef(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0,L=null;U&&(L=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=S._TmpMats[0];D.D(this.getAbsoluteMatrix()),U&&L&&D.multiplyToRef(L,D),N.dU.TransformNormalToRef(E,D,g),g.normalize()}getRotation(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=N.dU.Zero();return this.getRotationToRef(E,U,g),g}getRotationToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0;const N=S._TmpQuat;this.getRotationQuaternionToRef(E,U,N),N.toEulerAnglesToRef(g)}getRotationQuaternion(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=N.Quaternion.Identity();return this.getRotationQuaternionToRef(E,U,g),g}getRotationQuaternionToRef(){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),U.D(this._localRotation);else{const g=S._TmpMats[0],N=this.getAbsoluteMatrix();E?N.multiplyToRef(E.getWorldMatrix(),g):g.D(N),g.multiplyAtIndex(0,this._scalingDeterminant),g.multiplyAtIndex(1,this._scalingDeterminant),g.multiplyAtIndex(2,this._scalingDeterminant),g.decompose(void 0,U,void 0)}}getRotationMatrix(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1?arguments[1]:void 0;const g=N.Matrix.Identity();return this.getRotationMatrixToRef(E,U,g),g}getRotationMatrixToRef(){let E=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(U);else{const g=S._TmpMats[0],N=this.getAbsoluteMatrix();E?N.multiplyToRef(E.getWorldMatrix(),g):g.D(N),g.multiplyAtIndex(0,this._scalingDeterminant),g.multiplyAtIndex(1,this._scalingDeterminant),g.multiplyAtIndex(2,this._scalingDeterminant),g.getRotationMatrixToRef(U)}}getAbsolutePositionFromLocal(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=N.dU.Zero();return this.getAbsolutePositionFromLocalToRef(E,U,g),g}getAbsolutePositionFromLocalToRef(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0,L=null;U&&(L=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=S._TmpMats[0];D.D(this.getAbsoluteMatrix()),U&&L&&D.multiplyToRef(L,D),N.dU.TransformCoordinatesToRef(E,D,g)}getLocalPositionFromAbsolute(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=N.dU.Zero();return this.getLocalPositionFromAbsoluteToRef(E,U,g),g}getLocalPositionFromAbsoluteToRef(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0,L=null;U&&(L=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=S._TmpMats[0];D.D(this.getAbsoluteMatrix()),U&&L&&D.multiplyToRef(L,D),D.invert(),N.dU.TransformCoordinatesToRef(E,D,g)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const E=this._skeleton.bones.indexOf(this);if(-1!==E&&this._skeleton.bones.splice(E,1),this._parentNode&&this._parentNode.children){const E=this._parentNode.children,U=E.indexOf(this);-1!==U&&E.splice(U,1)}super.dispose()}}S._TmpVecs=(0,L.b)(2,N.dU.Zero),S._TmpQuat=N.Quaternion.Identity(),S._TmpMats=(0,L.b)(5,N.Matrix.Identity)},14542:(E,U,g)=>{"use strict";g.d(U,{c:()=>Z});var N=g(12320),L=g(12322),D=g(12174),S=g(12334),u=g(12353),s=g(12752),C=g(12774),B=g(12609),P=g(12197),F=g(12336);class f{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(E){this._idleRotationSpeed=E}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(E){this._idleRotationWaitTime=E}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(E){this._idleRotationSpinupTime=E}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(E){this._attachedCamera=E;const U=this._attachedCamera.tE();this._onPrePointerObservableObserver=U.onPrePointerObservable.add((E=>{E.type!==B.b.POINTERDOWN?E.type===B.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const E=P.b.Now;let U=0;null!=this._lastFrameTime&&(U=E-this._lastFrameTime),this._lastFrameTime=E,this._applyUserInteraction();const g=E-this._lastInteractionTime-this._idleRotationWaitTime,N=Math.max(Math.min(g/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*N,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(U/1e3))}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.tE();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(E){this._lastInteractionTime=E??P.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<F.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let E=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(E=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?E:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=P.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var d=g(14551),I=g(12853);class y{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(E){if(this._autoTransitionRange===E)return;this._autoTransitionRange=E;const U=this._attachedCamera;U&&(E?this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((E=>{if(E&&(E.pg(!0),E.getBoundingInfo)){const U=E.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*U,this.upperRadiusTransitionRange=.05*U}})):this._onMeshTargetChangedObserver&&U.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(E){this._attachedCamera=E,this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(E){return!!this._attachedCamera&&(this._attachedCamera.radius===E&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(E){if(!this._attachedCamera)return;this._radiusBounceTransition||(y.EasingFunction.setEasingMode(y.EasingMode),this._radiusBounceTransition=I.c.CreateAnimation("radius",I.c.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const U=I.c.TransitionTo("radius",this._attachedCamera.radius+E,this._attachedCamera,this._attachedCamera.tE(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));U&&this._animatables.push(U)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}y.EasingFunction=new d.d(.3),y.EasingMode=d.r.EASINGMODE_EASEOUT;class h{constructor(){this.onTargetFramingAnimationEndObservable=new D.b,this._mode=h.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(E){this._mode=E}get mode(){return this._mode}set radiusScale(E){this._radiusScale=E}get radiusScale(){return this._radiusScale}set positionScale(E){this._positionScale=E}get positionScale(){return this._positionScale}set defaultElevation(E){this._defaultElevation=E}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(E){this._elevationReturnTime=E}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(E){this._elevationReturnWaitTime=E}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(E){this._framingTime=E}get framingTime(){return this._framingTime}init(){}attach(E){this._attachedCamera=E;const U=this._attachedCamera.tE();h.EasingFunction.setEasingMode(h.EasingMode),this._onPrePointerObservableObserver=U.onPrePointerObservable.add((E=>{E.type!==B.b.POINTERDOWN?E.type===B.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((E=>{E&&E.getBoundingInfo&&this.zoomOnMesh(E,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.tE();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.pg(!0);const N=E.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(N.minimumWorld,N.maximumWorld,U,g)}zoomOnMeshHierarchy(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.pg(!0);const N=E.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(N.min,N.max,U,g)}zoomOnMeshesHierarchy(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new S.dU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new S.dU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let D=0;D<E.length;D++){const U=E[D].getHierarchyBoundingVectors(!0);S.dU.CheckExtends(U.min,N,L),S.dU.CheckExtends(U.max,N,L)}this.zoomOnBoundingInfo(N,L,U,g)}zoomOnBoundingInfo(E,U){let g,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const D=E.y,u=D+(U.y-D)*this._positionScale,s=U.IU(E).scale(.5);if(!isFinite(u))return!1;if(N)g=new S.dU(0,u,0);else{const U=E.add(s);g=new S.dU(U.x,u,U.z)}this._vectorTransition||(this._vectorTransition=I.c.CreateAnimation("target",I.c.ANIMATIONTYPE_VECTOR3,60,h.EasingFunction)),this._betaIsAnimating=!0;let C=I.c.TransitionTo("target",g,this._attachedCamera,this._attachedCamera.tE(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let B=0;if(this._mode===h.FitFrustumSidesMode){const g=this._calculateLowerRadiusFromModelBoundingSphere(E,U);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=s.length()+this._attachedCamera.kg),B=g}else this._mode===h.IgnoreBoundsSizeMode&&(B=this._calculateLowerRadiusFromModelBoundingSphere(E,U),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.kg));if(this.autoCorrectCameraLimitsAndSensibility){const g=U.IU(E).length();this._attachedCamera.panningSensibility=5e3/g,this._attachedCamera.wheelPrecision=100/B}return this._radiusTransition||(this._radiusTransition=I.c.CreateAnimation("radius",I.c.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),C=I.c.TransitionTo("radius",B,this._attachedCamera,this._attachedCamera.tE(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),L&&L(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(E,U){const g=this._attachedCamera;if(!g)return 0;let N=g._calculateLowerRadiusFromModelBoundingSphere(E,U,this._radiusScale);return g.lowerRadiusLimit&&this._mode===h.IgnoreBoundsSizeMode&&(N=N<g.lowerRadiusLimit?g.lowerRadiusLimit:N),g.upperRadiusLimit&&(N=N>g.upperRadiusLimit?g.upperRadiusLimit:N),N}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const E=P.b.Now-this._lastInteractionTime,U=.5*Math.PI-this._defaultElevation,g=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>g&&E>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=I.c.CreateAnimation("beta",I.c.ANIMATIONTYPE_FLOAT,60,h.EasingFunction));const E=I.c.TransitionTo("beta",U,this._attachedCamera,this._attachedCamera.tE(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));E&&this._animatables.push(E)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=P.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h.EasingFunction=new d.v,h.EasingMode=d.r.EASINGMODE_EASEINOUT,h.IgnoreBoundsSizeMode=0,h.FitFrustumSidesMode=1;var V=g(12781),e=g(12822),x=g(13963),l=g(12165);class Y{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(E){E=l.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),g=U.getInputElement();let N=0,L=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=D=>{var S,u;const s=D.event,C="touch"===s.pointerType;if(D.type!==B.b.POINTERMOVE&&-1===this.buttons.indexOf(s.button))return;const P=s.target;if(this._altKey=s.altKey,this._ctrlKey=s.ctrlKey,this._metaKey=s.metaKey,this._shiftKey=s.shiftKey,this._buttonsPressed=s.buttons,U.isPointerLock){const E=s.movementX,U=s.movementY;this.onTouch(null,E,U),this._pointA=null,this._pointB=null}else{if(D.type!==B.b.POINTERDOWN&&D.type!==B.b.POINTERDOUBLETAP&&C&&(null===(S=this._pointA)||void 0===S?void 0:S.pointerId)!==s.pointerId&&(null===(u=this._pointB)||void 0===u?void 0:u.pointerId)!==s.pointerId)return;if(D.type!==B.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!C)if(D.type===B.b.POINTERDOUBLETAP)this.onDoubleTap(s.pointerType);else if(D.type!==B.b.POINTERUP||this._currentMousePointerIdDown!==s.pointerId&&!C){if(D.type===B.b.POINTERMOVE)if(E||s.preventDefault(),this._pointA&&null===this._pointB){const E=s.clientX-this._pointA.x,U=s.clientY-this._pointA.y;this._pointA.x=s.clientX,this._pointA.y=s.clientY,this.onTouch(this._pointA,E,U)}else if(this._pointA&&this._pointB){const E=this._pointA.pointerId===s.pointerId?this._pointA:this._pointB;E.x=s.clientX,E.y=s.clientY;const U=this._pointA.x-this._pointB.x,g=this._pointA.y-this._pointB.y,S=U*U+g*g,u={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:s.pointerId,type:D.type};this.onMultiTouch(this._pointA,this._pointB,N,S,L,u),L=u,N=S}}else{try{null===P||void 0===P||P.releasePointerCapture(s.pointerId)}catch(F){}C||(this._pointB=null),U._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==s.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==s.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==N||L)&&(this.onMultiTouch(this._pointA,this._pointB,N,0,L,null),N=0,L=null),this._currentMousePointerIdDown=-1,this.onButtonUp(s),E||s.preventDefault()}else{try{null===P||void 0===P||P.setPointerCapture(s.pointerId)}catch(F){}if(null===this._pointA)this._pointA={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType};else{if(null!==this._pointB)return;this._pointB={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}}-1!==this._currentMousePointerIdDown||C||(this._currentMousePointerIdDown=s.pointerId),this.onButtonDown(s),E||(s.preventDefault(),g&&g.focus())}}},this._observer=this.camera.tE()._inputManager._addCameraPointerObserver(this._pointerInput,B.b.POINTERDOWN|B.b.POINTERUP|B.b.POINTERMOVE|B.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,N=0,L=null,this.onLostFocus()},this._contextMenuBind=E=>this.onContextMenu(E),g&&g.addEventListener("contextmenu",this._contextMenuBind,!1);const D=this.camera.tE().getEngine().getHostWindow();D&&l.Tools.RegisterTopRootEvents(D,[{name:"blur",handler:this._onLostFocus}])}GP(){if(this._onLostFocus){const E=this.camera.tE().getEngine().getHostWindow();E&&l.Tools.UnregisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.tE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const E=this.camera.tE().getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(E){}onTouch(E,U,g){}onMultiTouch(E,U,g,N,L,D){}onContextMenu(E){E.preventDefault()}onButtonDown(E){}onButtonUp(E){}onLostFocus(){}}(0,N.e)([(0,L.E)()],Y.prototype,"buttons",void 0);class t extends Y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(E,U){if(0!==this.panningSensibility&&E&&U){const g=U.x-E.x,N=U.y-E.y;this.camera.inertialPanningX+=-g/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility}}_computePinchZoom(E,U){const g=this.camera.radius||t.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=g*Math.sqrt(E)/Math.sqrt(U):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(U-E)*g*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(U-E)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(E,U,g){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=g/this.panningSensibility):(this.camera.inertialAlphaOffset-=U/this.angularSensibilityX,this.camera.inertialBetaOffset-=g/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(E,U,g,N,L,D){0===g&&null===L||0===N&&null===D||(this.multiTouchPanAndZoom?(this._computePinchZoom(g,N),this._computeMultiTouchPanning(L,D)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(N)-Math.sqrt(g))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(g,N),this._isPinching=!0):this._computeMultiTouchPanning(L,D)):this.multiTouchPanning?this._computeMultiTouchPanning(L,D):this.pinchZoom&&this._computePinchZoom(g,N))}onButtonDown(E){this._isPanClick=E.button===this.camera._panningMouseButton}onButtonUp(E){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}t.MinimumRadiusForPinch=.001,(0,N.e)([(0,L.E)()],t.prototype,"buttons",void 0),(0,N.e)([(0,L.E)()],t.prototype,"angularSensibilityX",void 0),(0,N.e)([(0,L.E)()],t.prototype,"angularSensibilityY",void 0),(0,N.e)([(0,L.E)()],t.prototype,"pinchPrecision",void 0),(0,N.e)([(0,L.E)()],t.prototype,"pinchDeltaPercentage",void 0),(0,N.e)([(0,L.E)()],t.prototype,"useNaturalPinchZoom",void 0),(0,N.e)([(0,L.E)()],t.prototype,"pinchZoom",void 0),(0,N.e)([(0,L.E)()],t.prototype,"panningSensibility",void 0),(0,N.e)([(0,L.E)()],t.prototype,"multiTouchPanning",void 0),(0,N.e)([(0,L.E)()],t.prototype,"multiTouchPanAndZoom",void 0),x.d.ArcRotateCameraPointersInput=t;var G=g(12617);class b{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(E){E=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.tE(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const g=U.event;if(!g.metaKey)if(U.type===G.b.KEYDOWN){if(this._ctrlPressed=g.ctrlKey,this._altPressed=g.altKey,-1!==this.keysUp.indexOf(g.keyCode)||-1!==this.keysDown.indexOf(g.keyCode)||-1!==this.keysLeft.indexOf(g.keyCode)||-1!==this.keysRight.indexOf(g.keyCode)||-1!==this.keysReset.indexOf(g.keyCode)){-1===this._keys.indexOf(g.keyCode)&&this._keys.push(g.keyCode),g.preventDefault&&(E||g.preventDefault())}}else if(-1!==this.keysUp.indexOf(g.keyCode)||-1!==this.keysDown.indexOf(g.keyCode)||-1!==this.keysLeft.indexOf(g.keyCode)||-1!==this.keysRight.indexOf(g.keyCode)||-1!==this.keysReset.indexOf(g.keyCode)){const U=this._keys.indexOf(g.keyCode);U>=0&&this._keys.splice(U,1),g.preventDefault&&(E||g.preventDefault())}})))}GP(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let U=0;U<this._keys.length;U++){const g=this._keys[U];-1!==this.keysLeft.indexOf(g)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX-=1/this.panningSensibility:E.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(g)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset+=1/this.zoomingSensibility:E.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(g)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX+=1/this.panningSensibility:E.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(g)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset-=1/this.zoomingSensibility:E.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(g)&&E.useInputToRestoreState&&E.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,N.e)([(0,L.E)()],b.prototype,"keysUp",void 0),(0,N.e)([(0,L.E)()],b.prototype,"keysDown",void 0),(0,N.e)([(0,L.E)()],b.prototype,"keysLeft",void 0),(0,N.e)([(0,L.E)()],b.prototype,"keysRight",void 0),(0,N.e)([(0,L.E)()],b.prototype,"keysReset",void 0),(0,N.e)([(0,L.E)()],b.prototype,"panningSensibility",void 0),(0,N.e)([(0,L.E)()],b.prototype,"zoomingSensibility",void 0),(0,N.e)([(0,L.E)()],b.prototype,"useAltToZoom",void 0),(0,N.e)([(0,L.E)()],b.prototype,"angularSpeed",void 0),x.d.ArcRotateCameraKeyboardMoveInput=b;var T=g(12382),v=g(12623);class o{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new S.dU(0,0,0),this._globalOffset=new S.dU(0,0,0),this._inertialPanning=S.dU.Zero()}_computeDeltaFromMouseWheelLegacyEvent(E,U){let g=0;const N=.01*E*this.wheelDeltaPercentage*U;return g=E>0?N/(1+this.wheelDeltaPercentage):N*(1+this.wheelDeltaPercentage),g}attachControl(E){E=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==B.b.POINTERWHEEL)return;const g=U.event;let N=0;const L=g.deltaMode===v.b.DOM_DELTA_LINE?40:1,D=-g.deltaY*L;if(this.customComputeDeltaFromMouseWheel)N=this.customComputeDeltaFromMouseWheel(D,this,g);else if(this.wheelDeltaPercentage){if(N=this._computeDeltaFromMouseWheelLegacyEvent(D,this.camera.radius),N>0){let E=this.camera.radius,U=this.camera.inertialRadiusOffset+N;for(let g=0;g<20&&!(E<=U)&&!(Math.abs(U*this.camera.inertia)<.001);g++)E-=U,U*=this.camera.inertia;E=(0,u.Clamp)(E,0,Number.MAX_VALUE),N=this._computeDeltaFromMouseWheelLegacyEvent(D,E)}}else N=D/(40*this.wheelPrecision);N&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(N)):this.camera.inertialRadiusOffset+=N),g.preventDefault&&(E||g.preventDefault())},this._observer=this.camera.tE()._inputManager._addCameraPointerObserver(this._wheel,B.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.yu(0)}GP(){this._observer&&(this.camera.tE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const E=this.camera;0+E.inertialAlphaOffset+E.inertialBetaOffset+E.inertialRadiusOffset&&(this._updateHitPlane(),E.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(E.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const E=this.camera,U=E.target.IU(E.position);this._hitPlane=T.c.FromPositionAndNormal(E.target,U)}_getPosition(){const E=this.camera,U=E.tE(),g=U.createPickingRay(U.pointerX,U.pointerY,S.Matrix.Identity(),E,!1);0===E.targetScreenOffset.x&&0===E.targetScreenOffset.y||(this._viewOffset.set(E.targetScreenOffset.x,E.targetScreenOffset.y,0),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),this._globalOffset=S.dU.TransformNormal(this._viewOffset,E._cameraTransformMatrix),g.origin.addInPlace(this._globalOffset));let N=0;return this._hitPlane&&(N=g.intersectsPlane(this._hitPlane)??0),g.origin.addInPlace(g.direction.scaleInPlace(N))}_zoomToMouse(E){const U=this.camera,g=1-U.inertia;if(U.lowerRadiusLimit){const N=U.lowerRadiusLimit??0;U.radius-(U.inertialRadiusOffset+E)/g<N&&(E=(U.radius-N)*g-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const N=U.upperRadiusLimit??0;U.radius-(U.inertialRadiusOffset+E)/g>N&&(E=(U.radius-N)*g-U.inertialRadiusOffset)}const N=E/g/U.radius,L=this._getPosition(),D=S.TmpVectors.dU[6];L.subtractToRef(U.target,D),D.scaleInPlace(N),D.scaleInPlace(g),this._inertialPanning.addInPlace(D),U.inertialRadiusOffset+=E}_zeroIfClose(E){Math.abs(E.x)<F.c&&(E.x=0),Math.abs(E.y)<F.c&&(E.y=0),Math.abs(E.z)<F.c&&(E.z=0)}}(0,N.e)([(0,L.E)()],o.prototype,"wheelPrecision",void 0),(0,N.e)([(0,L.E)()],o.prototype,"zoomToMouseLocation",void 0),(0,N.e)([(0,L.E)()],o.prototype,"wheelDeltaPercentage",void 0),x.d.ArcRotateCameraMouseWheelInput=o;class c extends x.g{constructor(E){super(E)}addMouseWheel(){return this.add(new o),this}addPointers(){return this.add(new t),this}addKeyboard(){return this.add(new b),this}}var r=g(12292);function j(E,U){return isNaN(E)?U:E}s.c.AddNodeConstructor("ArcRotateCamera",((E,U)=>()=>new Z(E,0,0,1,S.dU.Zero(),U)));class Z extends e.d{get target(){return this._target}set target(E){this.setTarget(E)}get targetHost(){return this._targetHost}set targetHost(E){E&&this.setTarget(E)}getTarget(){return this.target}get position(){return this._position}set position(E){this.setPosition(E)}set upVector(E){this._upToYMatrix||(this._yToUpMatrix=new S.Matrix,this._upToYMatrix=new S.Matrix,this._upVector=S.dU.Zero()),E.normalize(),this._upVector.D(E),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){S.Matrix.RotationAlignToRef(S.dU.UpReadOnly,this._upVector,this._yToUpMatrix),S.Matrix.RotationAlignToRef(this._upVector,S.dU.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityX:0}set angularSensibilityX(E){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityX=E)}get angularSensibilityY(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityY:0}set angularSensibilityY(E){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityY=E)}get pinchPrecision(){const E=this.inputs.attached.pointers;return E?E.pinchPrecision:0}set pinchPrecision(E){const U=this.inputs.attached.pointers;U&&(U.pinchPrecision=E)}get pinchDeltaPercentage(){const E=this.inputs.attached.pointers;return E?E.pinchDeltaPercentage:0}set pinchDeltaPercentage(E){const U=this.inputs.attached.pointers;U&&(U.pinchDeltaPercentage=E)}get useNaturalPinchZoom(){const E=this.inputs.attached.pointers;return!!E&&E.useNaturalPinchZoom}set useNaturalPinchZoom(E){const U=this.inputs.attached.pointers;U&&(U.useNaturalPinchZoom=E)}get panningSensibility(){const E=this.inputs.attached.pointers;return E?E.panningSensibility:0}set panningSensibility(E){const U=this.inputs.attached.pointers;U&&(U.panningSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const U=this.inputs.attached.keyboard;U&&(U.keysUp=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const U=this.inputs.attached.keyboard;U&&(U.keysDown=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const U=this.inputs.attached.keyboard;U&&(U.keysRight=E)}get wheelPrecision(){const E=this.inputs.attached.mousewheel;return E?E.wheelPrecision:0}set wheelPrecision(E){const U=this.inputs.attached.mousewheel;U&&(U.wheelPrecision=E)}get zoomToMouseLocation(){const E=this.inputs.attached.mousewheel;return!!E&&E.zoomToMouseLocation}set zoomToMouseLocation(E){const U=this.inputs.attached.mousewheel;U&&(U.zoomToMouseLocation=E)}get wheelDeltaPercentage(){const E=this.inputs.attached.mousewheel;return E?E.wheelDeltaPercentage:0}set wheelDeltaPercentage(E){const U=this.inputs.attached.mousewheel;U&&(U.wheelDeltaPercentage=E)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(E){E!==this.useBouncingBehavior&&(E?(this._bouncingBehavior=new y,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(E){E!==this.useFramingBehavior&&(E?(this._framingBehavior=new h,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(E){E!==this.useAutoRotationBehavior&&(E?(this._autoRotationBehavior=new f,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(E,U,g,N,L,u){var s;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(E,S.dU.Zero(),u,C),s=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=S.dU.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=S.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new S.Matrix,this.panningAxis=new S.dU(1,1,0),this._transformedDirection=new S.dU,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new D.b,this.checkCollisions=!1,this.collisionRadius=new S.dU(.5,.5,.5),this._previousPosition=S.dU.Zero(),this._collisionVelocity=S.dU.Zero(),this._newPosition=S.dU.Zero(),this._computationVector=S.dU.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new S.dU(NaN,NaN,NaN),this._goalTargetScreenOffset=new S.Vector2(NaN,NaN),this._onCollisionPositionChange=function(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g?(s.setPosition(U),s.Pf&&s.Pf(g)):s._previousPosition.D(s._position);const N=Math.cos(s.alpha),L=Math.sin(s.alpha),D=Math.cos(s.beta);let S=Math.sin(s.beta);0===S&&(S=1e-4);const u=s._getTargetPosition();s._computationVector.du(s.radius*N*S,s.radius*D,s.radius*L*S),u.addToRef(s._computationVector,s._newPosition),s._position.D(s._newPosition);let C=s.upVector;s.allowUpsideDown&&s.beta<0&&(C=C.clone(),C=C.negate()),s._computeViewMatrix(s._position,u,C),s._viewMatrix.addAtIndex(12,s.targetScreenOffset.x),s._viewMatrix.addAtIndex(13,s.targetScreenOffset.y),s._collisionTriggered=!1},this._target=S.dU.Zero(),L&&this.setTarget(L),this.alpha=U,this.beta=g,this.radius=N,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new S.dU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=S.Vector2.Zero()}_updateCache(E){E||super._updateCache(),this._cache._target.D(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.D(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const E=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?E.addToRef(this._targetBoundingCenter,this._target):this._target.D(E)}const E=this._getLockedTargetPosition();return E||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>F.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,D=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=D?this._currentInterpolationFactor=D:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=j(E,this._goalAlpha),this._goalBeta=j(U,this._goalBeta),this._goalRadius=j(g,this._goalRadius),this._goalTarget.set(j(N.x,this._goalTarget.x),j(N.y,this._goalTarget.y),j(N.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(j(L.x,this._goalTargetScreenOffset.x),j(L.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,u.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,u.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,u.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,u.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(E,U){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const L=arguments;U=l.Tools.BackCompatCameraNoPreventDefault(L),this._useCtrlForPanning=g,this._panningMouseButton=N,"boolean"===typeof L[0]&&(L.length>1&&(this._useCtrlForPanning=L[1]),L.length>2&&(this._panningMouseButton=L[2])),this.inputs.attachElement(U),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}GP(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let E=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){E=!0;const U=this.invertRotation?-1:1,g=this._calculateHandednessMultiplier();let N=this.inertialAlphaOffset*g;this.beta<0&&(N*=-1),this.alpha+=N*U,this.beta+=this.inertialBetaOffset*U,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<F.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<F.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*F.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){E=!0;const U=new S.dU(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),U.multiplyInPlace(this.panningAxis),S.dU.TransformNormalToRef(U,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const E=this.upVector,U=S.dU.CrossToRef(this._transformedDirection,E,this._transformedDirection);S.dU.CrossToRef(E,U,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);S.dU.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.D(this._transformedDirection)}else{if(this.parent){const E=S.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(E),E.transposeToRef(E),S.dU.TransformCoordinatesToRef(this._transformedDirection,E,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*F.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*F.c&&(this.inertialPanningY=0)}if(E)this.stopInterpolation();else if(this._isInterpolating){let E=!1;const U=this._scene.getEngine().getDeltaTime()/1e3,g=1-Math.pow(2,-U/this._currentInterpolationFactor),N=j(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const U=S.TmpVectors.dU[0].set(j(this._goalTarget.x,this._target.x),j(this._goalTarget.y,this._target.y),j(this._goalTarget.z,this._target.z));S.dU.LerpToRef(this.target,U,g,this._target),10*S.dU.Distance(this.target,U)/N<F.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.D(U),this.setTarget(this.target,!1,!0,!0)):E=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const U=S.Quaternion.RotationAlphaBetaGammaToRef(j(this._goalAlpha,this.alpha),j(this._goalBeta,this.beta),0,S.TmpVectors.Quaternion[0]),N=S.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,S.TmpVectors.Quaternion[1]),L=S.Quaternion.SlerpToRef(N,U,g,S.TmpVectors.Quaternion[2]);L.normalize();const D=L.toAlphaBetaGammaToRef(S.TmpVectors.dU[0]);if(this.alpha=D.x,this.beta=D.y,L.isApprox(U,F.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const E=U.toAlphaBetaGammaToRef(S.TmpVectors.dU[0]);this.alpha=E.x,this.beta=E.y}else E=!0}if(isNaN(this._goalRadius)||(this.radius+=(N-this.radius)*g,Math.abs(N/this.radius-1)<F.c?(this._goalRadius=NaN,this.radius=N):E=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const U=S.TmpVectors.Vector2[0].set(j(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),j(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));S.Vector2.LerpToRef(this.targetScreenOffset,U,g,this.targetScreenOffset),S.Vector2.Distance(this.targetScreenOffset,U)<F.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.D(U)):E=!0}this._isInterpolating=E}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||S.dU.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const E=this.alpha;var U,g;this.alpha=function(E){let U=Math.PI/2;return 0===E.x&&0===E.z||(U=Math.acos(E.x/Math.sqrt(Math.pow(E.x,2)+Math.pow(E.z,2)))),E.z<0&&(U=2*Math.PI-U),U}(this._computationVector),this.beta=(U=this._computationVector.y,g=this.radius,Math.acos(U/g));const N=Math.round((E-this.alpha)/(2*Math.PI));this.alpha+=2*N*Math.PI,this._checkLimits()}setPosition(E){this._position.equals(E)||(this._position.D(E),this.rebuildAnglesAndRadius())}setTarget(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(N=this.overrideCloneAlphaBetaRadius??N,E.pg)U&&E.getBoundingInfo?this._targetBoundingCenter=E.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,E.pg(),this._targetHost=E,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const U=E,N=this._getTargetPosition();if(N&&!g&&N.equals(U))return;this._targetHost=null,this._target=U,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}N||this.rebuildAnglesAndRadius()}_getViewMatrix(){const E=Math.cos(this.alpha),U=Math.sin(this.alpha),g=Math.cos(this.beta);let N=Math.sin(this.beta);0===N&&(N=1e-4),0===this.radius&&(this.radius=1e-4);const L=this._getTargetPosition();if(this._computationVector.du(this.radius*E*N,this.radius*g,this.radius*U*N),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||S.dU.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),L.addToRef(this._computationVector,this._newPosition),this.tE().collisionsEnabled&&this.checkCollisions){const E=this.tE().collisionCoordinator;this._collider||(this._collider=E.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,E.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.D(this._newPosition);let E=this.upVector;this.allowUpsideDown&&N<0&&(E=E.negate()),this._computeViewMatrix(this._position,L,E),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.D(L),this._viewMatrix}zoomOn(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E||this.tE().meshes;const g=C.e.MinMax(E);let N=this._calculateLowerRadiusFromModelBoundingSphere(g.min,g.max);if(N=Math.max(Math.min(N,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=N*this.zoomOnFactor,this.mode===V.d.ORTHOGRAPHIC_CAMERA){const E=this.tE().getEngine().getAspectRatio(this),U=N*this.zoomOnFactor/2;this.orthoLeft=-U*E,this.orthoRight=U*E,this.orthoBottom=-U,this.orthoTop=U}this.focusOn({min:g.min,max:g.max,distance:N},U)}focusOn(E){let U,g,N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===E.min){const N=E||this.tE().meshes;U=C.e.MinMax(N),g=S.dU.Distance(U.min,U.max)}else{U=E,g=E.distance}this._target=C.e.Center(U),N||(this.maxZ=2*g)}createRigCamera(E,U){let g=0;switch(this.cameraRigMode){case V.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.d.RIG_MODE_VR:g=this._cameraRigParams.stereoHalfAngle*(0===U?1:-1);break;case V.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:g=this._cameraRigParams.stereoHalfAngle*(0===U?-1:1)}const N=new Z(E,this.alpha+g,this.beta,this.radius,this._target,this.tE());return N._cameraRigParams={},N.isRigCamera=!0,N.rigParent=this,N.upVector=this.upVector,N.mode=this.mode,N.orthoLeft=this.orthoLeft,N.orthoRight=this.orthoRight,N.orthoBottom=this.orthoBottom,N.orthoTop=this.orthoTop,N}_updateRigCameras(){const E=this._rigCameras[0],U=this._rigCameras[1];switch(E.beta=U.beta=this.beta,this.cameraRigMode){case V.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.d.RIG_MODE_VR:E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case V.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const N=S.dU.Distance(E,U),L=this.tE().getEngine().getAspectRatio(this),D=Math.tan(this.fov/2),u=D*L,s=.5*N*g,C=s*Math.sqrt(1+1/(u*u)),B=s*Math.sqrt(1+1/(D*D));return Math.max(C,B)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,N.e)([(0,L.E)()],Z.prototype,"alpha",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"beta",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"radius",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,N.e)([(0,L.D)("target")],Z.prototype,"_target",void 0),(0,N.e)([(0,L.v)("targetHost")],Z.prototype,"_targetHost",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"inertialAlphaOffset",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"inertialBetaOffset",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"inertialRadiusOffset",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"lowerAlphaLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"upperAlphaLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"lowerBetaLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"upperBetaLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"lowerRadiusLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"upperRadiusLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"lowerTargetYLimit",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"inertialPanningX",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"inertialPanningY",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"pinchToPanMaxDistance",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"panningDistanceLimit",void 0),(0,N.e)([(0,L.D)()],Z.prototype,"panningOriginTarget",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"panningInertia",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"zoomToMouseLocation",null),(0,N.e)([(0,L.E)()],Z.prototype,"zoomOnFactor",void 0),(0,N.e)([(0,L.C)()],Z.prototype,"targetScreenOffset",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"allowUpsideDown",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"useInputToRestoreState",void 0),(0,N.e)([(0,L.E)()],Z.prototype,"restoreStateInterpolationFactor",void 0),(0,r.f)("BABYLON.ArcRotateCamera",Z)},13963:(E,U,g)=>{"use strict";g.d(U,{d:()=>S,g:()=>u});var N=g(12186),L=g(12367),D=g(12781),S={};class u{constructor(E){this.attachedToElement=!1,this.attached={},this.camera=E,this.checkInputs=()=>{}}add(E){const U=E.getSimpleName();this.attached[U]?N.d.Warn("camera input of type "+U+" already exists on camera"):(this.attached[U]=E,E.camera=this.camera,E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E))),this.attachedToElement&&E.attachControl(this.noPreventDefault))}remove(E){for(const U in this.attached){const g=this.attached[U];if(g===E)return g.GP(),g.camera=null,delete this.attached[U],void this.rebuildInputCheck()}}removeByType(E){for(const U in this.attached){const g=this.attached[U];g.getClassName()===E&&(g.GP(),g.camera=null,delete this.attached[U],this.rebuildInputCheck())}}_addCheckInputs(E){const U=this.checkInputs;return()=>{U(),E()}}attachInput(E){this.attachedToElement&&E.attachControl(this.noPreventDefault)}attachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){E=!D.d.ForceAttachControlToAlwaysPreventDefault&&E,this.attachedToElement=!0,this.noPreventDefault=E;for(const U in this.attached)this.attached[U].attachControl(E)}}detachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const U in this.attached)this.attached[U].GP(),E&&(this.attached[U].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const E in this.attached){const U=this.attached[E];U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(E){const U={};for(const g in this.attached){const E=this.attached[g],N=L.b.Serialize(E);U[E.getClassName()]=N}E.inputsmgr=U}parse(E){const U=E.inputsmgr;if(U){this.clear();for(const E in U){const g=S[E];if(g){const N=U[E],D=L.b.Parse((()=>new g),N,null);this.add(D)}}}else for(const g in this.attached){const U=S[this.attached[g].getClassName()];if(U){const N=L.b.Parse((()=>new U),E,null);this.remove(this.attached[g]),this.add(N)}}}}},13954:(E,U,g)=>{"use strict";g.d(U,{c:()=>Y});var N=g(12320),L=g(12322),D=g(12334),S=g(12822),u=g(13963),s=g(12617),C=g(12165);class B{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(E){E=C.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.tE(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const g=U.event;if(!g.metaKey)if(U.type===s.b.KEYDOWN){if(-1!==this.keysUp.indexOf(g.keyCode)||-1!==this.keysDown.indexOf(g.keyCode)||-1!==this.keysLeft.indexOf(g.keyCode)||-1!==this.keysRight.indexOf(g.keyCode)||-1!==this.keysUpward.indexOf(g.keyCode)||-1!==this.keysDownward.indexOf(g.keyCode)||-1!==this.keysRotateLeft.indexOf(g.keyCode)||-1!==this.keysRotateRight.indexOf(g.keyCode)||-1!==this.keysRotateUp.indexOf(g.keyCode)||-1!==this.keysRotateDown.indexOf(g.keyCode)){-1===this._keys.indexOf(g.keyCode)&&this._keys.push(g.keyCode),E||g.preventDefault()}}else if(-1!==this.keysUp.indexOf(g.keyCode)||-1!==this.keysDown.indexOf(g.keyCode)||-1!==this.keysLeft.indexOf(g.keyCode)||-1!==this.keysRight.indexOf(g.keyCode)||-1!==this.keysUpward.indexOf(g.keyCode)||-1!==this.keysDownward.indexOf(g.keyCode)||-1!==this.keysRotateLeft.indexOf(g.keyCode)||-1!==this.keysRotateRight.indexOf(g.keyCode)||-1!==this.keysRotateUp.indexOf(g.keyCode)||-1!==this.keysRotateDown.indexOf(g.keyCode)){const U=this._keys.indexOf(g.keyCode);U>=0&&this._keys.splice(U,1),E||g.preventDefault()}})))}GP(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let U=0;U<this._keys.length;U++){const g=this._keys[U],N=E._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(g)?E._localDirection.du(-N,0,0):-1!==this.keysUp.indexOf(g)?E._localDirection.du(0,0,N):-1!==this.keysRight.indexOf(g)?E._localDirection.du(N,0,0):-1!==this.keysDown.indexOf(g)?E._localDirection.du(0,0,-N):-1!==this.keysUpward.indexOf(g)?E._localDirection.du(0,N,0):-1!==this.keysDownward.indexOf(g)?E._localDirection.du(0,-N,0):-1!==this.keysRotateLeft.indexOf(g)?(E._localDirection.du(0,0,0),E.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(g)?(E._localDirection.du(0,0,0),E.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(g)?(E._localDirection.du(0,0,0),E.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(g)&&(E._localDirection.du(0,0,0),E.cameraRotation.x+=this._getLocalRotation()),E.tE().useRightHandedSystem&&(E._localDirection.z*=-1),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),D.dU.TransformNormalToRef(E._localDirection,E._cameraTransformMatrix,E._transformedDirection),E.cameraDirection.addInPlace(E._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const E=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*E}}(0,N.e)([(0,L.E)()],B.prototype,"keysUp",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysUpward",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysDown",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysDownward",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysLeft",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysRight",void 0),(0,N.e)([(0,L.E)()],B.prototype,"rotationSpeed",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysRotateLeft",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysRotateRight",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysRotateUp",void 0),(0,N.e)([(0,L.E)()],B.prototype,"keysRotateDown",void 0),u.d.FreeCameraKeyboardMoveInput=B;var P=g(12174),F=g(12609);class f{constructor(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=E,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new P.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(E){E=C.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),g=U.getInputElement();this._pointerInput||(this._pointerInput=N=>{const L=N.event,D="touch"===L.pointerType;if(!this.touchEnabled&&D)return;if(N.type!==F.b.POINTERMOVE&&-1===this.buttons.indexOf(L.button))return;const S=L.target;if(N.type===F.b.POINTERDOWN){if(D&&-1!==this._activePointerId||!D&&-1!==this._currentActiveButton)return;this._activePointerId=L.pointerId;try{null===S||void 0===S||S.setPointerCapture(L.pointerId)}catch(u){}-1===this._currentActiveButton&&(this._currentActiveButton=L.button),this._previousPosition={x:L.clientX,y:L.clientY},E||(L.preventDefault(),g&&g.focus()),U.isPointerLock&&this._onMouseMove&&this._onMouseMove(N.event)}else if(N.type===F.b.POINTERUP){if(D&&this._activePointerId!==L.pointerId||!D&&this._currentActiveButton!==L.button)return;try{null===S||void 0===S||S.releasePointerCapture(L.pointerId)}catch(u){}this._currentActiveButton=-1,this._previousPosition=null,E||L.preventDefault(),this._activePointerId=-1}else if(N.type===F.b.POINTERMOVE&&(this._activePointerId===L.pointerId||!D))if(U.isPointerLock&&this._onMouseMove)this._onMouseMove(N.event);else if(this._previousPosition){const U=this.camera._calculateHandednessMultiplier(),g=(L.clientX-this._previousPosition.x)*U,N=L.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=g/this.angularSensibility,this.camera.cameraRotation.x+=N/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:g,offsetY:N}),this._previousPosition={x:L.clientX,y:L.clientY},E||L.preventDefault()}}),this._onMouseMove=g=>{if(!U.isPointerLock)return;const N=this.camera._calculateHandednessMultiplier(),L=g.movementX*N;this.camera.cameraRotation.y+=L/this.angularSensibility;const D=g.movementY;this.camera.cameraRotation.x+=D/this.angularSensibility,this._previousPosition=null,E||g.preventDefault()},this._observer=this.camera.tE()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE),g&&(this._contextMenuBind=E=>this.onContextMenu(E),g.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(E){E.preventDefault()}GP(){if(this._observer){if(this.camera.tE()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,N.e)([(0,L.E)()],f.prototype,"buttons",void 0),(0,N.e)([(0,L.E)()],f.prototype,"angularSensibility",void 0),u.d.FreeCameraMouseInput=f;var d,I=g(12623);class y{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new P.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(E){E=C.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==F.b.POINTERWHEEL)return;const g=U.event,N=g.deltaMode===I.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*N*g.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*N*g.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*N*g.deltaZ/this._normalize,g.preventDefault&&(E||g.preventDefault())},this._observer=this.camera.tE()._inputManager._addCameraPointerObserver(this._wheel,F.b.POINTERWHEEL)}GP(){this._observer&&(this.camera.tE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,N.e)([(0,L.E)()],y.prototype,"wheelPrecisionX",void 0),(0,N.e)([(0,L.E)()],y.prototype,"wheelPrecisionY",void 0),(0,N.e)([(0,L.E)()],y.prototype,"wheelPrecisionZ",void 0),function(E){E[E.MoveRelative=0]="MoveRelative",E[E.RotateRelative=1]="RotateRelative",E[E.MoveScene=2]="MoveScene"}(d||(d={}));class h extends y{constructor(){super(...arguments),this._moveRelative=D.dU.Zero(),this._rotateRelative=D.dU.Zero(),this._moveScene=D.dU.Zero(),this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(E){null===E&&this._wheelXAction!==d.MoveRelative||(this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=E)}get wheelXMoveRelative(){return this._wheelXAction!==d.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(E){null===E&&this._wheelYAction!==d.MoveRelative||(this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=E)}get wheelYMoveRelative(){return this._wheelYAction!==d.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(E){null===E&&this._wheelZAction!==d.MoveRelative||(this._wheelZAction=d.MoveRelative,this._wheelZActionCoordinate=E)}get wheelZMoveRelative(){return this._wheelZAction!==d.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(E){null===E&&this._wheelXAction!==d.RotateRelative||(this._wheelXAction=d.RotateRelative,this._wheelXActionCoordinate=E)}get wheelXRotateRelative(){return this._wheelXAction!==d.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(E){null===E&&this._wheelYAction!==d.RotateRelative||(this._wheelYAction=d.RotateRelative,this._wheelYActionCoordinate=E)}get wheelYRotateRelative(){return this._wheelYAction!==d.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(E){null===E&&this._wheelZAction!==d.RotateRelative||(this._wheelZAction=d.RotateRelative,this._wheelZActionCoordinate=E)}get wheelZRotateRelative(){return this._wheelZAction!==d.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(E){null===E&&this._wheelXAction!==d.MoveScene||(this._wheelXAction=d.MoveScene,this._wheelXActionCoordinate=E)}get wheelXMoveScene(){return this._wheelXAction!==d.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(E){null===E&&this._wheelYAction!==d.MoveScene||(this._wheelYAction=d.MoveScene,this._wheelYActionCoordinate=E)}get wheelYMoveScene(){return this._wheelYAction!==d.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(E){null===E&&this._wheelZAction!==d.MoveScene||(this._wheelZAction=d.MoveScene,this._wheelZActionCoordinate=E)}get wheelZMoveScene(){return this._wheelZAction!==d.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.yu(0),this._rotateRelative.yu(0),this._moveScene.yu(0),this._updateCamera(),this.camera.tE().useRightHandedSystem&&(this._moveRelative.z*=-1);const E=D.Matrix.Zero();this.camera.getViewMatrix().invertToRef(E);const U=D.dU.Zero();D.dU.TransformNormalToRef(this._moveRelative,E,U),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(U),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(E,U,g){if(0===E)return;if(null===U||null===g)return;let N=null;switch(U){case d.MoveRelative:N=this._moveRelative;break;case d.RotateRelative:N=this._rotateRelative;break;case d.MoveScene:N=this._moveScene}switch(g){case 0:N.set(E,0,0);break;case 1:N.set(0,E,0);break;case 2:N.set(0,0,E)}}}(0,N.e)([(0,L.E)()],h.prototype,"wheelXMoveRelative",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelYMoveRelative",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelZMoveRelative",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelXRotateRelative",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelYRotateRelative",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelZRotateRelative",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelXMoveScene",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelYMoveScene",null),(0,N.e)([(0,L.E)()],h.prototype,"wheelZMoveScene",null),u.d.FreeCameraMouseWheelInput=h;class V{constructor(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=E,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.Tools.IsSafari()}attachControl(E){E=C.Tools.BackCompatCameraNoPreventDefault(arguments);let U=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=g=>{const N=g.event,L="mouse"===N.pointerType||this._isSafari&&"undefined"===typeof N.pointerType;if(this.allowMouse||!L)if(g.type===F.b.POINTERDOWN){if(E||N.preventDefault(),this._pointerPressed.push(N.pointerId),1!==this._pointerPressed.length)return;U={x:N.clientX,y:N.clientY}}else if(g.type===F.b.POINTERUP){E||N.preventDefault();const g=this._pointerPressed.indexOf(N.pointerId);if(-1===g)return;if(this._pointerPressed.splice(g,1),0!=g)return;U=null,this._offsetX=null,this._offsetY=null}else if(g.type===F.b.POINTERMOVE){if(E||N.preventDefault(),!U)return;if(0!=this._pointerPressed.indexOf(N.pointerId))return;this._offsetX=N.clientX-U.x,this._offsetY=-(N.clientY-U.y)}}),this._observer=this.camera.tE()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.addEventListener("blur",this._onLostFocus)}}GP(){if(this._pointerInput){if(this._observer&&(this.camera.tE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const E=this.camera,U=E._calculateHandednessMultiplier();E.cameraRotation.y=U*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)E.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const U=E._computeLocalCameraSpeed(),g=new D.dU(0,0,0!==this.touchMoveSensibility?U*this._offsetY/this.touchMoveSensibility:0);D.Matrix.RotationYawPitchRollToRef(E.rotation.y,E.rotation.x,0,E._cameraRotationMatrix),E.cameraDirection.addInPlace(D.dU.TransformCoordinates(g,E._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,N.e)([(0,L.E)()],V.prototype,"touchAngularSensibility",void 0),(0,N.e)([(0,L.E)()],V.prototype,"touchMoveSensibility",void 0),u.d.FreeCameraTouchInput=V;class e extends u.g{constructor(E){super(E),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new B),this}addMouse(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new f(E),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new h,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new V),this}clear(){super.clear(),this._mouseInput=null}}var x=g(12292),l=g(12243);class Y extends S.d{get angularSensibility(){const E=this.inputs.attached.mouse;return E?E.angularSensibility:0}set angularSensibility(E){const U=this.inputs.attached.mouse;U&&(U.angularSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const U=this.inputs.attached.keyboard;U&&(U.keysUp=E)}get keysUpward(){const E=this.inputs.attached.keyboard;return E?E.keysUpward:[]}set keysUpward(E){const U=this.inputs.attached.keyboard;U&&(U.keysUpward=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const U=this.inputs.attached.keyboard;U&&(U.keysDown=E)}get keysDownward(){const E=this.inputs.attached.keyboard;return E?E.keysDownward:[]}set keysDownward(E){const U=this.inputs.attached.keyboard;U&&(U.keysDownward=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const U=this.inputs.attached.keyboard;U&&(U.keysRight=E)}get keysRotateLeft(){const E=this.inputs.attached.keyboard;return E?E.keysRotateLeft:[]}set keysRotateLeft(E){const U=this.inputs.attached.keyboard;U&&(U.keysRotateLeft=E)}get keysRotateRight(){const E=this.inputs.attached.keyboard;return E?E.keysRotateRight:[]}set keysRotateRight(E){const U=this.inputs.attached.keyboard;U&&(U.keysRotateRight=E)}get keysRotateUp(){const E=this.inputs.attached.keyboard;return E?E.keysRotateUp:[]}set keysRotateUp(E){const U=this.inputs.attached.keyboard;U&&(U.keysRotateUp=E)}get keysRotateDown(){const E=this.inputs.attached.keyboard;return E?E.keysRotateDown:[]}set keysRotateDown(E){const U=this.inputs.attached.keyboard;U&&(U.keysRotateDown=E)}constructor(E,U,g){var N;super(E,U,g,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),N=this,this.ellipsoid=new D.dU(.5,1,.5),this.ellipsoidOffset=new D.dU(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=D.dU.Zero(),this._diffPosition=D.dU.Zero(),this._newPosition=D.dU.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N._newPosition.D(U),N._newPosition.subtractToRef(N._oldPosition,N._diffPosition),N._diffPosition.length()>l.b.CollisionsEpsilon&&(N.position.addToRef(N._diffPosition,N._deferredPositionUpdate),N._deferOnly?N._deferredUpdated=!0:N.position.D(N._deferredPositionUpdate),N.Pf&&g&&N.Pf(g))},this.inputs=new e(this),this.inputs.addKeyboard().addMouse()}attachControl(E,U){U=C.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(U)}GP(){this.inputs.detachElement(),this.cameraDirection=new D.dU(0,0,0),this.cameraRotation=new D.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(E){this._collisionMask=isNaN(E)?-1:E}_collideWithWorld(E){let U;U=this.parent?D.dU.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,U.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const g=this.tE().collisionCoordinator;this._collider||(this._collider=g.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let N=E;this.applyGravity&&(N=E.add(this.tE().gravity)),g.getNewPosition(this._oldPosition,N,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=D.dU.Zero(),this._transformedDirection=D.dU.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(E){this._needMoveForGravity=E}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.tE().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"uf"}}(0,N.e)([(0,L.D)()],Y.prototype,"ellipsoid",void 0),(0,N.e)([(0,L.D)()],Y.prototype,"ellipsoidOffset",void 0),(0,N.e)([(0,L.E)()],Y.prototype,"checkCollisions",void 0),(0,N.e)([(0,L.E)()],Y.prototype,"applyGravity",void 0),(0,x.f)("BABYLON.FreeCamera",Y)},14608:(E,U,g)=>{"use strict";g.d(U,{e:()=>D});var N=g(12422),L=g(14611);class D{constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=g,this.RB=[],this._maxBlockCapacity=U||64,this._selectionContent=new N.c(1024),this._creationFunc=E}update(E,U,g){L.d._CreateBlocks(E,U,g,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}KC(E){for(let U=0;U<this.BB.length;U++){this.BB[U].addEntry(E)}}HC(E){for(let U=0;U<this.BB.length;U++){this.BB[U].removeEntry(E)}}select(E,U){this._selectionContent.reset();for(let g=0;g<this.BB.length;g++){this.BB[g].select(E,this._selectionContent,U)}return U?this._selectionContent.concat(this.RB):this._selectionContent.concatWithNoDuplicate(this.RB),this._selectionContent}intersects(E,U,g){this._selectionContent.reset();for(let N=0;N<this.BB.length;N++){this.BB[N].intersects(E,U,this._selectionContent,g)}return g?this._selectionContent.concat(this.RB):this._selectionContent.concatWithNoDuplicate(this.RB),this._selectionContent}intersectsRay(E){this._selectionContent.reset();for(let U=0;U<this.BB.length;U++){this.BB[U].intersectsRay(E,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.RB),this._selectionContent}}D.CreationFuncForMeshes=(E,U)=>{const g=E.getBoundingInfo();!E.isBlocked&&g.boundingBox.intersectsMinMax(U.pB,U.HB)&&U.entries.push(E)},D.CreationFuncForSubMeshes=(E,U)=>{E.getBoundingInfo().boundingBox.intersectsMinMax(U.pB,U.HB)&&U.entries.push(E)}},14611:(E,U,g)=>{"use strict";g.d(U,{d:()=>D});var N=g(12334),L=g(12682);class D{constructor(E,U,g,N,L,D){this.entries=[],this.KB=new Array,this._capacity=g,this._depth=N,this._maxDepth=L,this._creationFunc=D,this._minPoint=E,this._maxPoint=U,this.KB.push(E.clone()),this.KB.push(U.clone()),this.KB.push(E.clone()),this.KB[2].x=U.x,this.KB.push(E.clone()),this.KB[3].y=U.y,this.KB.push(E.clone()),this.KB[4].z=U.z,this.KB.push(U.clone()),this.KB[5].z=E.z,this.KB.push(U.clone()),this.KB[6].x=E.x,this.KB.push(U.clone()),this.KB[7].y=E.y}get aU(){return this._capacity}get pB(){return this._minPoint}get HB(){return this._maxPoint}addEntry(E){if(this.BB)for(let U=0;U<this.BB.length;U++){this.BB[U].addEntry(E)}else this._creationFunc(E,this),this.entries.length>this.aU&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(E){if(this.BB){for(let U=0;U<this.BB.length;U++){this.BB[U].removeEntry(E)}return}const U=this.entries.indexOf(E);U>-1&&this.entries.splice(U,1)}addEntries(E){for(let U=0;U<E.length;U++){const g=E[U];this.addEntry(g)}}select(E,U,g){if(L.d.IsInFrustum(this.KB,E)){if(this.BB){for(let N=0;N<this.BB.length;N++){this.BB[N].select(E,U,g)}return}g?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersects(E,U,g,N){if(L.d.IntersectsSphere(this._minPoint,this._maxPoint,E,U)){if(this.BB){for(let L=0;L<this.BB.length;L++){this.BB[L].intersects(E,U,g,N)}return}N?g.concat(this.entries):g.concatWithNoDuplicate(this.entries)}}intersectsRay(E,U){if(E.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.BB){for(let g=0;g<this.BB.length;g++){this.BB[g].intersectsRay(E,U)}return}U.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){D._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(E,U,g,L,S,u,s,C){s.BB=new Array;const B=new N.dU((U.x-E.x)/2,(U.y-E.y)/2,(U.z-E.z)/2);for(let N=0;N<2;N++)for(let U=0;U<2;U++)for(let P=0;P<2;P++){const F=E.add(B.multiplyByFloats(N,U,P)),f=E.add(B.multiplyByFloats(N+1,U+1,P+1)),d=new D(F,f,L,S+1,u,C);d.addEntries(g),s.BB.push(d)}}}},14613:(E,U,g)=>{"use strict";g.d(U,{e:()=>B});var N=g(12573),L=g(12334),D=g(12760),S=g(13713),u=g(12607),s=g(14608),C=g(12205);N.c.prototype.createOrUpdateSelectionOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,g=this._getComponent(u.b.NAME_OCTREE);g||(g=new B(this),this.o(g)),this.OB||(this.OB=new s.e(s.e.CreationFuncForMeshes,E,U));const N=this.getWorldExtends();return this.OB.update(N.min,N.max,this.meshes),this.OB},Object.defineProperty(N.c.prototype,"selectionOctree",{get:function(){return this.OB},enumerable:!0,configurable:!0}),D.b.prototype.createOrUpdateSubmeshesOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const g=this.tE();let N=g._getComponent(u.b.NAME_OCTREE);N||(N=new B(g),g.o(N)),this._submeshesOctree||(this._submeshesOctree=new s.e(s.e.CreationFuncForSubMeshes,E,U)),this.pg(!0);const L=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(L.minimumWorld,L.maximumWorld,this.Wg),this._submeshesOctree};class B{constructor(E){this.name=u.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new S.d(L.dU.Zero(),new L.dU(1,1,1)),(E=E||C.b.LastCreatedScene)&&(this.yU=E,this.yU.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.yU.getActiveSubMeshCandidates=E=>this.getActiveSubMeshCandidates(E),this.yU.getCollidingSubMeshCandidates=(E,U)=>this.getCollidingSubMeshCandidates(E,U),this.yU.getIntersectingSubMeshCandidates=(E,U)=>this.getIntersectingSubMeshCandidates(E,U))}register(){this.yU.onMeshRemovedObservable.add((E=>{const U=this.yU.selectionOctree;if(void 0!==U&&null!==U){const g=U.RB.indexOf(E);-1!==g&&U.RB.splice(g,1)}})),this.yU.onMeshImportedObservable.add((E=>{const U=this.yU.selectionOctree;void 0!==U&&null!==U&&U.KC(E)}))}getActiveMeshCandidates(){var E;return(null===(E=this.yU.OB)||void 0===E?void 0:E.select(this.yU.frustumPlanes))||this.yU._getDefaultMeshCandidates()}getActiveSubMeshCandidates(E){if(E._submeshesOctree&&E.useOctreeForRenderingSelection){return E._submeshesOctree.select(this.yU.frustumPlanes)}return this.yU._getDefaultSubMeshCandidates(E)}getIntersectingSubMeshCandidates(E,U){if(E._submeshesOctree&&E.useOctreeForPicking){S.d.TransformToRef(U,E.getWorldMatrix(),this._tempRay);return E._submeshesOctree.intersectsRay(this._tempRay)}return this.yU._getDefaultSubMeshCandidates(E)}getCollidingSubMeshCandidates(E,U){if(E._submeshesOctree&&E.useOctreeForCollisions){const g=U._velocityWorldLength+Math.max(U._radius.x,U._radius.y,U._radius.z);return E._submeshesOctree.intersects(U._basePointWorld,g)}return this.yU._getDefaultSubMeshCandidates(E)}rebuild(){}dispose(){}}},13713:(E,U,g)=>{"use strict";g.d(U,{d:()=>f});var N=g(12573),L=g(12781),D=g(12336),S=g(12334),u=g(12345),s=g(12672),C=g(12601),B=g(12205),P=g(12630);const F={internalPickerForMesh:void 0};class f{constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.c;this.origin=E,this.direction=U,this.length=g,this.epsilon=N}clone(){return new f(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const N=f._TmpVector3[0].du(E.x-g,E.y-g,E.z-g),L=f._TmpVector3[1].du(U.x+g,U.y+g,U.z+g);let D,S,u,s,C=0,B=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<N.x||this.origin.x>L.x)return!1}else if(D=1/this.direction.x,S=(N.x-this.origin.x)*D,u=(L.x-this.origin.x)*D,u===-1/0&&(u=1/0),S>u&&(s=S,S=u,u=s),C=Math.max(S,C),B=Math.min(u,B),C>B)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<N.y||this.origin.y>L.y)return!1}else if(D=1/this.direction.y,S=(N.y-this.origin.y)*D,u=(L.y-this.origin.y)*D,u===-1/0&&(u=1/0),S>u&&(s=S,S=u,u=s),C=Math.max(S,C),B=Math.min(u,B),C>B)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<N.z||this.origin.z>L.z)return!1}else if(D=1/this.direction.z,S=(N.z-this.origin.z)*D,u=(L.z-this.origin.z)*D,u===-1/0&&(u=1/0),S>u&&(s=S,S=u,u=s),C=Math.max(S,C),B=Math.min(u,B),C>B)return!1;return!0}intersectsBox(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(E.minimum,E.maximum,U)}intersectsSphere(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const g=E.center.x-this.origin.x,N=E.center.y-this.origin.y,L=E.center.z-this.origin.z,D=g*g+N*N+L*L,S=E.radius+U,u=S*S;if(D<=u)return!0;const s=g*this.direction.x+N*this.direction.y+L*this.direction.z;if(s<0)return!1;return D-s*s<=u}intersectsTriangle(E,U,g){const N=f._TmpVector3[0],L=f._TmpVector3[1],D=f._TmpVector3[2],u=f._TmpVector3[3],C=f._TmpVector3[4];U.subtractToRef(E,N),g.subtractToRef(E,L),S.dU.CrossToRef(this.direction,L,D);const B=S.dU.Dot(N,D);if(0===B)return null;const P=1/B;this.origin.subtractToRef(E,u);const F=S.dU.Dot(u,D)*P;if(F<-this.epsilon||F>1+this.epsilon)return null;S.dU.CrossToRef(u,N,C);const d=S.dU.Dot(this.direction,C)*P;if(d<-this.epsilon||F+d>1+this.epsilon)return null;const I=S.dU.Dot(L,C)*P;return I>this.length?null:new s.d(1-F-d,F,I)}intersectsPlane(E){let U;const g=S.dU.Dot(E.normal,this.direction);if(Math.abs(g)<9.99999997475243e-7)return null;{const N=S.dU.Dot(E.normal,this.origin);return U=(-E.d-N)/g,U<0?U<-9.99999997475243e-7?null:0:U}}intersectsAxis(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(E){case"y":{const E=(this.origin.y-U)/this.direction.y;return E>0?null:new S.dU(this.origin.x+this.direction.x*-E,U,this.origin.z+this.direction.z*-E)}case"x":{const E=(this.origin.x-U)/this.direction.x;return E>0?null:new S.dU(U,this.origin.y+this.direction.y*-E,this.origin.z+this.direction.z*-E)}case"z":{const E=(this.origin.z-U)/this.direction.z;return E>0?null:new S.dU(this.origin.x+this.direction.x*-E,this.origin.y+this.direction.y*-E,U)}default:return null}}intersectsMesh(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=S.TmpVectors.Matrix[0];return E.getWorldMatrix().invertToRef(u),this._tmpRay?f.TransformToRef(this,u,this._tmpRay):this._tmpRay=f.Transform(this,u),E.intersects(this._tmpRay,U,g,N,L,D)}intersectsMeshes(E,U,g){g?g.length=0:g=[];for(let N=0;N<E.length;N++){const L=this.intersectsMesh(E[N],U);L.hit&&g.push(L)}return g.sort(this._comparePickingInfo),g}_comparePickingInfo(E,U){return E.distance<U.distance?-1:E.distance>U.distance?1:0}intersectionSegment(E,U,g){const N=this.origin,L=S.TmpVectors.dU[0],D=S.TmpVectors.dU[1],u=S.TmpVectors.dU[2],s=S.TmpVectors.dU[3];U.subtractToRef(E,L),this.direction.scaleToRef(f._Rayl,u),N.addToRef(u,D),E.subtractToRef(N,s);const C=S.dU.Dot(L,L),B=S.dU.Dot(L,u),P=S.dU.Dot(u,u),F=S.dU.Dot(L,s),d=S.dU.Dot(u,s),I=C*P-B*B;let y,h,V=I,e=I;I<f._Smallnum?(y=0,V=1,h=d,e=P):(y=B*d-P*F,h=C*d-B*F,y<0?(y=0,h=d,e=P):y>V&&(y=V,h=d+B,e=P)),h<0?(h=0,-F<0?y=0:-F>C?y=V:(y=-F,V=C)):h>e&&(h=e,-F+B<0?y=0:-F+B>C?y=V:(y=-F+B,V=C));const x=Math.abs(y)<f._Smallnum?0:y/V,l=Math.abs(h)<f._Smallnum?0:h/e,Y=S.TmpVectors.dU[4];u.scaleToRef(l,Y);const t=S.TmpVectors.dU[5];L.scaleToRef(x,t),t.addInPlace(s);const G=S.TmpVectors.dU[6];t.subtractToRef(Y,G);return l>0&&l<=this.length&&G.lengthSquared()<g*g?t.length():-1}update(E,U,g,N,L,D,u){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){f._RayDistant||(f._RayDistant=f.Zero()),f._RayDistant.unprojectRayToRef(E,U,g,N,S.Matrix.IdentityReadOnly,D,u);const s=S.TmpVectors.Matrix[0];L.invertToRef(s),f.TransformToRef(f._RayDistant,s,this)}else this.unprojectRayToRef(E,U,g,N,L,D,u);return this}static Zero(){return new f(S.dU.Zero(),S.dU.Zero())}static CreateNew(E,U,g,N,L,D,S){return f.Zero().update(E,U,g,N,L,D,S)}static CreateNewFromTo(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.Matrix.IdentityReadOnly;const N=new f(new S.dU(0,0,0),new S.dU(0,0,0));return f.CreateFromToToRef(E,U,N,g)}static CreateFromToToRef(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.Matrix.IdentityReadOnly;g.origin.D(E);const L=U.subtractToRef(E,g.direction),D=Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z);return g.length=D,g.direction.normalize(),f.TransformToRef(g,N,g)}static Transform(E,U){const g=new f(new S.dU(0,0,0),new S.dU(0,0,0));return f.TransformToRef(E,U,g),g}static TransformToRef(E,U,g){S.dU.TransformCoordinatesToRef(E.origin,U,g.origin),S.dU.TransformNormalToRef(E.direction,U,g.direction),g.length=E.length,g.epsilon=E.epsilon;const N=g.direction,L=N.length();if(0!==L&&1!==L){const E=1/L;N.x*=E,N.y*=E,N.z*=E,g.length*=L}return g}unprojectRayToRef(E,U,g,N,L,D,u){const s=S.TmpVectors.Matrix[0];L.multiplyToRef(D,s),s.multiplyToRef(u,s),s.invert();const C=B.b.LastCreatedEngine,P=S.TmpVectors.dU[0];P.x=E/g*2-1,P.y=-(U/N*2-1),P.z=null!==C&&void 0!==C&&C.Fg?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const F=S.TmpVectors.dU[1].du(P.x,P.y,1-1e-8),f=S.TmpVectors.dU[2],d=S.TmpVectors.dU[3];S.dU._UnprojectFromInvertedMatrixToRef(P,s,f),S.dU._UnprojectFromInvertedMatrixToRef(F,s,d),this.origin.D(f),d.subtractToRef(f,this.direction),this.direction.normalize()}}function d(E,U,g,N,L){let D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=f.Zero();return I(E,U,g,N,S,L,D),S}function I(E,U,g,N,L,D){let u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=E.getEngine();if(!D&&!(D=E.activeCamera))return E;const B=D.viewport,P=C.getRenderHeight(),{x:F,y:f,width:d,height:I}=B.toGlobal(C.getRenderWidth(),P),y=1/C.getHardwareScalingLevel();return U=U*y-F,g=g*y-(P-f-I),L.update(U,g,d,I,N||S.Matrix.IdentityReadOnly,u?S.Matrix.IdentityReadOnly:D.getViewMatrix(),D.getProjectionMatrix(),s),E}function y(E,U,g,N,L){if(!C.e)return E;const D=E.getEngine();if(!L&&!(L=E.activeCamera))throw new Error("Active camera not set");const u=L.viewport,s=D.getRenderHeight(),{x:B,y:P,width:F,height:f}=u.toGlobal(D.getRenderWidth(),s),d=S.Matrix.Identity(),I=1/D.getHardwareScalingLevel();return U=U*I-B,g=g*I-(s-P-f),N.update(U,g,F,f,d,d,L.getProjectionMatrix()),E}function h(E,U,g,N,L,D,S,u){const s=U(N,g.enableDistantPicking),C=g.intersects(s,L,S,D,N,u);return C&&C.hit?!L&&null!=E&&C.distance>=E.distance?null:C:null}function V(E,U,g,N,L,D){let u=null;const s=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),B=E.cameraToUseForPointers||E.activeCamera,P=F.internalPickerForMesh||h;for(let C=0;C<E.meshes.length;C++){const F=E.meshes[C];if(g){if(!g(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.Zs)continue;const f=s&&F.isWorldMatrixCameraDependent(),d=F.pg(f,B);if(F.hasThinInstances&&F.dC){const E=P(u,U,F,d,!0,!0,D);if(E){if(L)return E;const s=S.TmpVectors.Matrix[1],C=F.thinInstanceGetWorldMatrices();for(let E=0;E<C.length;E++){if(g&&!g(F,E))continue;C[E].multiplyToRef(d,s);const S=P(u,U,F,s,N,L,D,!0);if(S&&(u=S,u.thinInstanceIndex=E,N))return u}}}else{const E=P(u,U,F,d,N,L,D);if(E&&(u=E,N))return u}}return u||new C.e}function e(E,U,g,N){if(!C.e)return null;const L=[],D=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),u=E.cameraToUseForPointers||E.activeCamera,s=F.internalPickerForMesh||h;for(let C=0;C<E.meshes.length;C++){const B=E.meshes[C];if(g){if(!g(B,-1))continue}else if(!B.isEnabled()||!B.isVisible||!B.Zs)continue;const P=D&&B.isWorldMatrixCameraDependent(),F=B.pg(P,u);if(B.hasThinInstances&&B.dC){if(s(null,U,B,F,!0,!0,N)){const E=S.TmpVectors.Matrix[1],D=B.thinInstanceGetWorldMatrices();for(let S=0;S<D.length;S++){if(g&&!g(B,S))continue;D[S].multiplyToRef(F,E);const u=s(null,U,B,E,!1,!1,N,!0);u&&(u.thinInstanceIndex=S,L.push(u))}}}else{const E=s(null,U,B,F,!1,!1,N);E&&L.push(E)}}return L}function x(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,N=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;N||(N=E.getWorldMatrix()),U.length=g,L?U.origin.D(L):U.origin.D(E.position);const D=S.TmpVectors.dU[2];D.set(0,0,E._scene.useRightHandedSystem?-1:1);const u=S.TmpVectors.dU[3];return S.dU.TransformNormalToRef(D,N,u),S.dU.NormalizeToRef(u,U.direction),U}var l,Y;f._TmpVector3=(0,u.b)(6,S.dU.Zero),f._RayDistant=f.Zero(),f._Smallnum=1e-8,f._Rayl=1e9,l=N.c,(Y=L.d)&&(Y.prototype.getForwardRay=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,U=arguments.length>1?arguments[1]:void 0,g=arguments.length>2?arguments[2]:void 0;return x(this,new f(S.dU.Zero(),S.dU.Zero(),E),E,U,g)},Y.prototype.getForwardRayToRef=function(E){return x(this,E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),l&&(P.d._IsPickingAvailable=!0,l.prototype.createPickingRay=function(E,U,g,N){return d(this,E,U,g,N,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),N.c.prototype.createPickingRayToRef=function(E,U,g,N,L){return I(this,E,U,g,N,L,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},N.c.prototype.createPickingRayInCameraSpace=function(E,U,g){return function(E,U,g,N){const L=f.Zero();return y(E,U,g,L,N),L}(this,E,U,g)},N.c.prototype.createPickingRayInCameraSpaceToRef=function(E,U,g,N){return y(this,E,U,g,N)},N.c.prototype.pickWithBoundingInfo=function(E,U,g,N,L){return function(E,U,g,N,L,D){if(!C.e)return null;const u=V(E,(N=>(E._tempPickingRay||(E._tempPickingRay=f.Zero()),I(E,U,g,N,E._tempPickingRay,D||null),E._tempPickingRay)),N,L,!0);return u&&(u.ray=d(E,U,g,S.Matrix.Identity(),D||null)),u}(this,E,U,g,N,L)},N.c.prototype.lg=function(E,U,g,N,L,D){return function(E,U,g,N,L,D,u){const s=V(E,((N,L)=>(E._tempPickingRay||(E._tempPickingRay=f.Zero()),I(E,U,g,N,E._tempPickingRay,D||null,!1,L),E._tempPickingRay)),N,L,!1,u);return s&&(s.ray=d(E,U,g,S.Matrix.Identity(),D||null)),s}(this,E,U,g,N,L,D)},N.c.prototype.pickWithRay=function(E,U,g,N){return function(E,U,g,N,L){const D=V(E,(g=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=S.Matrix.Identity()),g.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=f.Zero()),f.TransformToRef(U,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),g,N,!1,L);return D&&(D.ray=U),D}(this,E,U,g,N)},N.c.prototype.multiPick=function(E,U,g,N,L){return function(E,U,g,N,L,D){return e(E,(N=>d(E,U,g,N,L||null)),N,D)}(this,E,U,g,N,L)},N.c.prototype.multiPickWithRay=function(E,U,g){return function(E,U,g,N){return e(E,(g=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=S.Matrix.Identity()),g.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=f.Zero()),f.TransformToRef(U,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),g,N)}(this,E,U,g)}},14021:(E,U,g)=>{"use strict";var N=g(12273),L=g(12186),D=g(12210),S=g(12296),u=g(12243),s=g(12282);u.b.prototype._partialLoadFile=function(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(E,(E=>{g[U]=E,g._internalCount++,6===g._internalCount&&N(g)}),void 0,void 0,!0,((E,U)=>{L&&E&&L(E.status+" "+E.statusText,U)}))},u.b.prototype._cascadeLoadFiles=function(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=[];L._internalCount=0;for(let D=0;D<6;D++)this._partialLoadFile(g[D],D,L,U,N)},u.b.prototype._cascadeLoadImgs=function(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5?arguments[5]:void 0;const S=[];S._internalCount=0;for(let u=0;u<6;u++)this._partialLoadImg(N[u],u,S,E,U,g,L,D)},u.b.prototype._partialLoadImg=function(E,U,g,N,L,u){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const B=(0,S.e)();(0,D.n)(E,(E=>{g[U]=E,g._internalCount++,N&&N.removePendingData(B),6===g._internalCount&&u&&u(L,g)}),((E,U)=>{N&&N.removePendingData(B),s&&s(E,U)}),N?N.offlineProvider:null,C),N&&N.addPendingData(B)},u.b.prototype.createCubeTextureBase=function(E,U,g,D){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14],V=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const e=d||new N.c(this,7);e.isCube=!0,e.url=E,e.generateMipMaps=!D,e._lodGenerationScale=F,e._lodGenerationOffset=f,e._useSRGBBuffer=!!h&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!D),e!==d&&(e.label=E.substring(0,60)),this._doNotHandleContextLost||(e._extension=B,e._files=g,e._buffer=V);const x=E;this._transformTextureUrl&&!d&&(E=this._transformTextureUrl(E));const l=B??function(E){const U=E.split("?")[0],g=U.lastIndexOf(".");return g>-1?U.substring(g).toLowerCase():""}(E),Y=(0,s.b)(l),t=(E,U)=>{e.dispose(),u?u(E,U):E&&L.d.Warn(E)},G=(N,u)=>{E===x?N&&t(N.status+" "+N.statusText,u):(L.d.Warn(`Failed to load ${E}, falling back to the ${x}`),this.createCubeTextureBase(x,U,g,!!D,S,t,C,B,P,F,f,e,I,y,h,V))};if(Y)Y.then((N=>{const L=E=>{I&&I(e,E),N.loadCubeData(E,e,P,S,((E,U)=>{t(E,U)}))};V?L(V):g&&6===g.length?N.supportCascades?this._cascadeLoadFiles(U,(E=>L(E.map((E=>new Uint8Array(E))))),g,t):t("Textures type does not support cascades."):this._loadFile(E,(E=>L(new Uint8Array(E))),void 0,void 0,!0,G)}));else{if(!g||0===g.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,e,((E,U)=>{y&&y(E,U)}),g,t)}return this._internalTexturesCache.push(e),e}},14619:(E,U,g)=>{"use strict";g(12186);var N=g(12462);g(12273),g(12410),g(12264),g(12517),g(12478);N.c},14050:(E,U,g)=>{"use strict";g.d(U,{c:()=>L});var N=g(12292);class L{constructor(E){this.value=this._toInt(E)}_toInt(E){return 0|E}add(E){return new L(this.value+E.value)}IU(E){return new L(this.value-E.value)}multiply(E){return new L(Math.imul(this.value,E.value))}divide(E){return new L(this.value/E.value)}getClassName(){return L.ClassName}equals(E){return this.value===E.value}static FromValue(E){return new L(E)}toString(){return this.value.toString()}}L.ClassName="FlowGraphInteger",(0,N.f)("FlowGraphInteger",L)},14062:(E,U,g)=>{"use strict";g.d(U,{c:()=>L,e:()=>D});var N=g(12334);class L{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.vg=E}get m(){return this.vg}transformVector(E){return this.transformVectorToRef(E,new N.Vector2)}transformVectorToRef(E,U){return U.x=E.x*this.vg[0]+E.y*this.vg[1],U.y=E.x*this.vg[2]+E.y*this.vg[3],U}Og(){return this.toArray()}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<4;U++)E[U]=this.vg[U];return E}Yg(E){for(let U=0;U<4;U++)this.vg[U]=E[U];return this}multiplyToRef(E,U){const g=E.vg,N=this.vg,L=U.vg;return L[0]=g[0]*N[0]+g[1]*N[2],L[1]=g[0]*N[1]+g[1]*N[3],L[2]=g[2]*N[0]+g[3]*N[2],L[3]=g[2]*N[1]+g[3]*N[3],U}multiply(E){return this.multiplyToRef(E,new L)}divideToRef(E,U){const g=this.vg,N=E.vg,L=U.vg;return L[0]=g[0]/N[0],L[1]=g[1]/N[1],L[2]=g[2]/N[2],L[3]=g[3]/N[3],U}divide(E){return this.divideToRef(E,new L)}addToRef(E,U){const g=this.vg,N=E.m,L=U.m;return L[0]=g[0]+N[0],L[1]=g[1]+N[1],L[2]=g[2]+N[2],L[3]=g[3]+N[3],U}add(E){return this.addToRef(E,new L)}subtractToRef(E,U){const g=this.vg,N=E.m,L=U.m;return L[0]=g[0]-N[0],L[1]=g[1]-N[1],L[2]=g[2]-N[2],L[3]=g[3]-N[3],U}IU(E){return this.subtractToRef(E,new L)}transpose(){const E=this.vg;return new L([E[0],E[2],E[1],E[3]])}determinant(){const E=this.vg;return E[0]*E[3]-E[1]*E[2]}inverse(){const E=this.determinant();if(0===E)throw new Error("Matrix is not invertible");const U=this.vg,g=1/E;return new L([U[3]*g,-U[1]*g,-U[2]*g,U[0]*g])}equals(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const g=this.vg,N=E.m;return 0===U?g[0]===N[0]&&g[1]===N[1]&&g[2]===N[2]&&g[3]===N[3]:Math.abs(g[0]-N[0])<U&&Math.abs(g[1]-N[1])<U&&Math.abs(g[2]-N[2])<U&&Math.abs(g[3]-N[3])<U}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.vg.join(", ")})`}}class D{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.vg=E}get m(){return this.vg}transformVector(E){return this.transformVectorToRef(E,new N.dU)}transformVectorToRef(E,U){const g=this.vg;return U.x=E.x*g[0]+E.y*g[1]+E.z*g[2],U.y=E.x*g[3]+E.y*g[4]+E.z*g[5],U.z=E.x*g[6]+E.y*g[7]+E.z*g[8],U}multiplyToRef(E,U){const g=E.vg,N=this.vg,L=U.m;return L[0]=g[0]*N[0]+g[1]*N[3]+g[2]*N[6],L[1]=g[0]*N[1]+g[1]*N[4]+g[2]*N[7],L[2]=g[0]*N[2]+g[1]*N[5]+g[2]*N[8],L[3]=g[3]*N[0]+g[4]*N[3]+g[5]*N[6],L[4]=g[3]*N[1]+g[4]*N[4]+g[5]*N[7],L[5]=g[3]*N[2]+g[4]*N[5]+g[5]*N[8],L[6]=g[6]*N[0]+g[7]*N[3]+g[8]*N[6],L[7]=g[6]*N[1]+g[7]*N[4]+g[8]*N[7],L[8]=g[6]*N[2]+g[7]*N[5]+g[8]*N[8],U}multiply(E){return this.multiplyToRef(E,new D)}divideToRef(E,U){const g=this.vg,N=E.m,L=U.m;return L[0]=g[0]/N[0],L[1]=g[1]/N[1],L[2]=g[2]/N[2],L[3]=g[3]/N[3],L[4]=g[4]/N[4],L[5]=g[5]/N[5],L[6]=g[6]/N[6],L[7]=g[7]/N[7],L[8]=g[8]/N[8],U}divide(E){return this.divideToRef(E,new D)}addToRef(E,U){const g=this.vg,N=E.m,L=U.m;return L[0]=g[0]+N[0],L[1]=g[1]+N[1],L[2]=g[2]+N[2],L[3]=g[3]+N[3],L[4]=g[4]+N[4],L[5]=g[5]+N[5],L[6]=g[6]+N[6],L[7]=g[7]+N[7],L[8]=g[8]+N[8],U}add(E){return this.addToRef(E,new D)}subtractToRef(E,U){const g=this.vg,N=E.m,L=U.m;return L[0]=g[0]-N[0],L[1]=g[1]-N[1],L[2]=g[2]-N[2],L[3]=g[3]-N[3],L[4]=g[4]-N[4],L[5]=g[5]-N[5],L[6]=g[6]-N[6],L[7]=g[7]-N[7],L[8]=g[8]-N[8],U}IU(E){return this.subtractToRef(E,new D)}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<9;U++)E[U]=this.vg[U];return E}Og(){return this.toArray()}Yg(E){for(let U=0;U<9;U++)this.vg[U]=E[U];return this}transpose(){const E=this.vg;return new D([E[0],E[3],E[6],E[1],E[4],E[7],E[2],E[5],E[8]])}determinant(){const E=this.vg;return E[0]*(E[4]*E[8]-E[5]*E[7])-E[1]*(E[3]*E[8]-E[5]*E[6])+E[2]*(E[3]*E[7]-E[4]*E[6])}inverse(){const E=this.determinant();if(0===E)throw new Error("Matrix is not invertible");const U=this.vg,g=1/E;return new D([(U[4]*U[8]-U[5]*U[7])*g,(U[2]*U[7]-U[1]*U[8])*g,(U[1]*U[5]-U[2]*U[4])*g,(U[5]*U[6]-U[3]*U[8])*g,(U[0]*U[8]-U[2]*U[6])*g,(U[2]*U[3]-U[0]*U[5])*g,(U[3]*U[7]-U[4]*U[6])*g,(U[1]*U[6]-U[0]*U[7])*g,(U[0]*U[4]-U[1]*U[3])*g])}equals(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const g=this.vg,N=E.m;return 0===U?g[0]===N[0]&&g[1]===N[1]&&g[2]===N[2]&&g[3]===N[3]&&g[4]===N[4]&&g[5]===N[5]&&g[6]===N[6]&&g[7]===N[7]&&g[8]===N[8]:Math.abs(g[0]-N[0])<U&&Math.abs(g[1]-N[1])<U&&Math.abs(g[2]-N[2])<U&&Math.abs(g[3]-N[3])<U&&Math.abs(g[4]-N[4])<U&&Math.abs(g[5]-N[5])<U&&Math.abs(g[6]-N[6])<U&&Math.abs(g[7]-N[7])<U&&Math.abs(g[8]-N[8])<U}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.vg.join(", ")})`}}},14067:(E,U,g)=>{"use strict";var N;function L(E,U,g,N){switch(U){case"Animation":return N?E.animations.find((E=>E.uniqueId===g))??null:E.animations[g]??null;case"AnimationGroup":return N?E.animationGroups.find((E=>E.uniqueId===g))??null:E.animationGroups[g]??null;case"Mesh":return N?E.meshes.find((E=>E.uniqueId===g))??null:E.meshes[g]??null;case"Material":return N?E.materials.find((E=>E.uniqueId===g))??null:E.materials[g]??null;case"SB":return N?E.cameras.find((E=>E.uniqueId===g))??null:E.cameras[g]??null;case"Light":return N?E.lights.find((E=>E.uniqueId===g))??null:E.lights[g]??null;default:return null}}g.d(U,{b:()=>L}),function(E){E.Animation="Animation",E.AnimationGroup="AnimationGroup",E.Mesh="Mesh",E.Material="Material",E.SB="SB",E.Light="Light"}(N||(N={}))},14094:(E,U,g)=>{"use strict";g.d(U,{e:()=>L});var N=g(14100);class L extends N.e{constructor(E,U){if(super(E),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),U)for(const g of U)this._eventsSignalOutputs[g]=this._registerSignalOutput(g+"Event")}_executeOnTick(E){}_startPendingTasks(E){E._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(E),this._resetAfterCanceled(E)),this._preparePendingTasks(E),E._addPendingBlock(this),this.out._activateSignal(E),E._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(E){E._deleteExecutionVariable(this,"_initialized"),E._removePendingBlock(this)}}},14077:(E,U,g)=>{"use strict";g.d(U,{b:()=>C});var N=g(12296),L=g(12292),D=g(14081),S=g(12174),u=g(14043);class s extends D.c{constructor(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:N.defaultValue,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(E,U,g),this.richType=N,this._defaultValue=L,this._optional=D,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new S.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(E){this._isDisabled!==E&&(this._isDisabled=E,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(E,U){U._getConnectionValue(this)!==E&&(U._setConnectionValue(this,E),this.onValueChangedObservable.notifyObservers(E))}resetToDefaultValue(E){E._setConnectionValue(this,this._defaultValue)}connectTo(E){this._isDisabled||super.connectTo(E)}_getValueOrDefault(E){const U=E._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(E){if(1===this.connectionType){E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(E);const U=this._getValueOrDefault(E);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}const U=this.isConnected()?this._connectedPoint[0].getValue(E):this._getValueOrDefault(E);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.richType={},this.richType.serialize(E.richType),E.optional=this._optional,(0,u.h)("defaultValue",this._defaultValue,E)}}(0,L.f)("FlowGraphDataConnection",s);class C{constructor(E){var U;this.config=E,this.uniqueId=(0,N.e)(),this.name=(null===(U=this.config)||void 0===U?void 0:U.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(E){}registerDataInput(E,U,g){const N=new s(E,0,this,U,g);return this.dataInputs.push(N),N}registerDataOutput(E,U,g){const N=new s(E,1,this,U,g);return this.dataOutputs.push(N),N}getDataInput(E){return this.dataInputs.find((U=>U.name===E))}getDataOutput(E){return this.dataOutputs.find((U=>U.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.h;if(E.uniqueId=this.uniqueId,E.config={},this.config){const g=this.config,N=Object.keys(g);for(const L of N)U(L,g[L],E.config)}E.dataInputs=[],E.dataOutputs=[],E.className=this.getClassName();for(const g of this.dataInputs){const U={};g.serialize(U),E.dataInputs.push(U)}for(const g of this.dataOutputs){const U={};g.serialize(U),E.dataOutputs.push(U)}}deserialize(E){}_log(E,U,g){var N;null===(N=E.logger)||void 0===N||N.addLogItem({action:U,tg:g,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14081:(E,U,g)=>{"use strict";g.d(U,{c:()=>D});var N,L=g(12296);!function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(N||(N={}));class D{constructor(E,U,g){this._ownerBlock=g,this._connectedPoint=[],this.uniqueId=(0,L.e)(),this.connectedPointIds=[],this.name=E,this._connectionType=U}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(E){if(this._connectionType===E._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||E._isSingularConnection()&&E._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(E),E._connectedPoint.push(this)}disconnectFrom(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const g=this._connectedPoint.indexOf(E),N=E._connectedPoint.indexOf(this);-1!==g&&-1!==N&&(U&&this._connectedPoint.splice(g,1),E._connectedPoint.splice(N,1))}disconnectFromAll(){for(const E of this._connectedPoint)this.disconnectFrom(E,!1);this._connectedPoint.length=0}dispose(){for(const E of this._connectedPoint)this.disconnectFrom(E)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E.uniqueId=this.uniqueId,E.name=this.name,E._connectionType=this._connectionType,E.connectedPointIds=[],E.className=this.getClassName();for(const U of this._connectedPoint)E.connectedPointIds.push(U.uniqueId)}getClassName(){return"FGConnection"}deserialize(E){this.uniqueId=E.uniqueId,this.name=E.name,this._connectionType=E._connectionType,this.connectedPointIds=E.connectedPointIds}}},14041:(E,U,g)=>{"use strict";g.d(U,{d:()=>e});var N,L=g(12174),D=g(12320),S=g(12322),u=g(12296),s=g(14043),C=g(14067),B=g(12186);!function(E){E.ExecuteBlock="ExecuteBlock",E.ExecuteEvent="ExecuteEvent",E.TriggerConnection="TriggerConnection",E.ContextVariableSet="ContextVariableSet",E.GlobalVariableSet="GlobalVariableSet",E.GlobalVariableDelete="GlobalVariableDelete",E.GlobalVariableGet="GlobalVariableGet",E.AddConnection="AddConnection",E.GetConnectionValue="GetConnectionValue",E.SetConnectionValue="SetConnectionValue",E.ActivateSignal="ActivateSignal",E.ContextVariableGet="ContextVariableGet"}(N||(N={}));class P{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(E){if(E.time||(E.time=Date.now()),this.log.push(E),this.logToConsole){var U;const g=null===(U=E.tg)||void 0===U?void 0:U.value;"object"===typeof g&&g.getClassName?B.d.Log(`[FGLog] ${E.className}:${E.uniqueId.split("-")[0]} ${E.action} - ${JSON.stringify(g.getClassName())}: ${g.toString()}`):B.d.Log(`[FGLog] ${E.className}:${E.uniqueId.split("-")[0]} ${E.action} - ${JSON.stringify(E.tg)}`)}}getItemsOfType(E){return this.log.filter((U=>U.action===E))}}class F{get enableLogging(){return this._enableLogging}set enableLogging(E){this._enableLogging!==E&&(this._enableLogging=E,this._enableLogging?(this.logger=new P,this.logger.logToConsole=!0):this.logger=null)}constructor(E){this.uniqueId=(0,u.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new L.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=E,this.assetsContext=E.assetsContext??E.yU}hasVariable(E){return E in this._userVariables}setVariable(E,U){var g;this._userVariables[E]=U,null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",tg:{name:E,value:U}})}getAsset(E,U){return(0,C.b)(this.assetsContext,E,U)}getVariable(E){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",tg:{name:E,value:this._userVariables[E]}}),this._userVariables[E]}get userVariables(){return this._userVariables}tE(){return this._configuration.yU}_getUniqueIdPrefixedName(E,U){return`${E.uniqueId}_${U}`}_getGlobalContextVariable(E,U){var g;return null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",tg:{name:E,defaultValue:U,possibleValue:this._globalContextVariables[E]}}),this._hasGlobalContextVariable(E)?this._globalContextVariables[E]:U}_setGlobalContextVariable(E,U){var g;null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",tg:{name:E,value:U}}),this._globalContextVariables[E]=U}_deleteGlobalContextVariable(E){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",tg:{name:E}}),delete this._globalContextVariables[E]}_hasGlobalContextVariable(E){return E in this._globalContextVariables}_setExecutionVariable(E,U,g){this._executionVariables[this._getUniqueIdPrefixedName(E,U)]=g}_getExecutionVariable(E,U,g){return this._hasExecutionVariable(E,U)?this._executionVariables[this._getUniqueIdPrefixedName(E,U)]:g}_deleteExecutionVariable(E,U){delete this._executionVariables[this._getUniqueIdPrefixedName(E,U)]}_hasExecutionVariable(E,U){return this._getUniqueIdPrefixedName(E,U)in this._executionVariables}_hasConnectionValue(E){return E.uniqueId in this._connectionValues}_setConnectionValue(E,U){var g;this._connectionValues[E.uniqueId]=U,null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",tg:{connectionPointId:E.uniqueId,value:U}})}_setConnectionValueByKey(E,U){this._connectionValues[E]=U}_getConnectionValue(E){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",tg:{connectionPointId:E.uniqueId,value:this._connectionValues[E.uniqueId]}}),this._connectionValues[E.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(E){this._pendingBlocks.includes(E)||(this._pendingBlocks.push(E),this._pendingBlocks.sort(((E,U)=>E.priority-U.priority)))}_removePendingBlock(E){const U=this._pendingBlocks.indexOf(E);-1!==U&&this._pendingBlocks.splice(U,1)}_clearPendingBlocks(){for(const E of this._pendingBlocks)E._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(E){var U;this.onNodeExecutedObservable.notifyObservers(E),null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:E.getClassName(),uniqueId:E.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(E){this._setGlobalContextVariable("timeSinceStart",E.timeSinceStart),this._setGlobalContextVariable("deltaTime",E.deltaTime);for(const g of this._pendingBlocks){var U;null===(U=g._executeOnTick)||void 0===U||U.call(g,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.h;E.uniqueId=this.uniqueId,E._userVariables={};for(const N in this._userVariables)U(N,this._userVariables[N],E._userVariables);E._connectionValues={};for(const N in this._connectionValues)U(N,this._connectionValues[N],E._connectionValues);var g;this.assetsContext!==this.tE()&&(E._assetsContext={meshes:this.assetsContext.meshes.map((E=>E.id)),materials:this.assetsContext.materials.map((E=>E.id)),textures:this.assetsContext.textures.map((E=>E.name)),animations:this.assetsContext.animations.map((E=>E.name)),lights:this.assetsContext.lights.map((E=>E.id)),cameras:this.assetsContext.cameras.map((E=>E.id)),GF:null===(g=this.assetsContext.GF)||void 0===g?void 0:g.map((E=>E.name)),skeletons:this.assetsContext.skeletons.map((E=>E.id)),RP:this.assetsContext.RP.map((E=>E.name)),geometries:this.assetsContext.geometries.map((E=>E.id)),multiMaterials:this.assetsContext.multiMaterials.map((E=>E.id)),transformNodes:this.assetsContext.transformNodes.map((E=>E.id))})}getClassName(){return"FlowGraphContext"}}(0,D.e)([(0,S.E)()],F.prototype,"uniqueId",void 0);var f=g(14072),d=g(12609);class I{constructor(E){this.onEventTriggeredObservable=new L.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=E,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.hg.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const E=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",tg:{timeSinceStart:this._startingTime,deltaTime:E}}),this._startingTime+=E})),this._meshPickedObserver=this._scene.onPointerObservable.add((E=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",tg:E})}),d.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((E=>{const U=E.pointerId,g=E.mesh,N=this._pointerUnderMeshState[U];!N&&g?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",tg:{pointerId:U,mesh:g}}):N&&!g?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",tg:{pointerId:U,mesh:N}}):N&&g&&N!==g&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",tg:{pointerId:U,mesh:N,over:g}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",tg:{pointerId:U,mesh:g,out:N}})),this._pointerUnderMeshState[U]=g}),d.b.POINTERMOVE)}dispose(){var E,U,g,N,L;null===(E=this._sceneDisposeObserver)||void 0===E||E.remove(),null===(U=this._sceneReadyObserver)||void 0===U||U.remove(),null===(g=this._sceneOnBeforeRenderObserver)||void 0===g||g.remove(),null===(N=this._meshPickedObserver)||void 0===N||N.remove(),null===(L=this._meshUnderPointerObserver)||void 0===L||L.remove(),this.onEventTriggeredObservable.clear()}}var y,h=g(14084);!function(E){E[E.Stopped=0]="Stopped",E[E.Started=1]="Started"}(y||(y={}));class V{get state(){return this._state}set state(E){this._state=E,this.onStateChangedObservable.notifyObservers(E)}constructor(E){this.onStateChangedObservable=new L.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=E.yU,this._sceneEventCoordinator=new I(this._scene),this._coordinator=E.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((E=>{for(const U of this._executionContexts){const g=this._getContextualOrder(E.type,U);for(const N of g)if(!N._executeEvent(U,E.tg))break}switch(E.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const U of this._executionContexts)U._notifyOnTick(E.tg);break;case"SceneDispose":this.dispose()}}))}createContext(){const E=new F({yU:this._scene,coordinator:this._coordinator});return this._executionContexts.push(E),E}getContext(E){return this._executionContexts[E]}addEventBlock(E){if("PointerOver"!==E.type&&"PointerOut"!==E.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==E.type&&this._eventBlocks[E.type].push(E),1===this.state)for(const U of this._executionContexts)E._startPendingTasks(U);else this.onStateChangedObservable.addOnce((U=>{if(1===U)for(const g of this._executionContexts)E._startPendingTasks(g)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((E=>{1===E&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const E of this._executionContexts)for(const U in this._eventBlocks){const g=this._getContextualOrder(U,E);for(const U of g)U._startPendingTasks(E)}}_getContextualOrder(E,U){const g=this._eventBlocks[E].sort(((E,U)=>U.initPriority-E.initPriority));if("MeshPick"===E){const E=[];for(const N of g){const L=N.asset.getValue(U);let D=0;for(;D<g.length;D++){const E=g[D].asset.getValue(U);if(L&&E&&(0,h.s)(L,E))break}E.splice(D,0,N)}return E}return g}dispose(){var E;if(0!==this.state){this.state=0;for(const E of this._executionContexts)E._clearPendingBlocks();this._executionContexts.length=0;for(const E in this._eventBlocks)this._eventBlocks[E].length=0;null===(E=this._eventObserver)||void 0===E||E.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(E){const U=[],g=new Set;for(const N in this._eventBlocks)for(const E of this._eventBlocks[N])U.push(E),g.add(E.uniqueId);for(;U.length>0;){const N=U.pop();E(N);for(const E of N.dataInputs)for(const N of E._connectedPoint)g.has(N._ownerBlock.uniqueId)||(U.push(N._ownerBlock),g.add(N._ownerBlock.uniqueId));if(N instanceof f.e)for(const E of N.signalOutputs)for(const N of E._connectedPoint)g.has(N._ownerBlock.uniqueId)||(U.push(N._ownerBlock),g.add(N._ownerBlock.uniqueId))}}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1?arguments[1]:void 0;E.allBlocks=[],this.visitAllBlocks((U=>{const g={};U.serialize(g),E.allBlocks.push(g)})),E.executionContexts=[];for(const g of this._executionContexts){const N={};g.serialize(N,U),E.executionContexts.push(N)}}}class e{constructor(E){this.config=E,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.yU.hg.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.yU.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const E=this._executeOnNextFrame.slice(0);if(E.length)for(const U of E){this.notifyCustomEvent(U.id,U.data,!1);const E=this._executeOnNextFrame.findIndex((E=>E.uniqueId===U.uniqueId));-1!==E&&this._executeOnNextFrame.splice(E,1)}}));(e.SceneCoordinators.get(this.config.yU)??[]).push(this)}createGraph(){const E=new V({yU:this.config.yU,coordinator:this});return this._flowGraphs.push(E),E}removeGraph(E){const U=this._flowGraphs.indexOf(E);-1!==U&&(E.dispose(),this._flowGraphs.splice(U,1))}start(){for(const E of this._flowGraphs)E.start()}dispose(){var E,U;for(const L of this._flowGraphs)L.dispose();this._flowGraphs.length=0,null===(E=this._disposeObserver)||void 0===E||E.remove(),null===(U=this._onBeforeRenderObserver)||void 0===U||U.remove();const g=e.SceneCoordinators.get(this.config.yU)??[],N=g.indexOf(this);-1!==N&&g.splice(N,1)}serialize(E,U){E._flowGraphs=[];for(const g of this._flowGraphs){const N={};g.serialize(N,U),E._flowGraphs.push(N)}E.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(E){let U=this._customEventsMap.get(E);return U||(U=new L.b,this._customEventsMap.set(E,U)),U}notifyCustomEvent(E,U){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:E,data:U,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(E)){const U=this._eventExecutionCounter.get(E);if(this._eventExecutionCounter.set(E,U+1),U>=e.MaxEventTypeExecutionPerFrame)return void(U===e.MaxEventTypeExecutionPerFrame&&B.d.Warn(`FlowGraphCoordinator: Too many executions of event "${E}".`))}else this._eventExecutionCounter.set(E,1);const g=this._customEventsMap.get(E);g&&g.notifyObservers(U)}}e.MaxEventsPerType=30,e.MaxEventTypeExecutionPerFrame=30,e.SceneCoordinators=new Map},14087:(E,U,g)=>{"use strict";g.d(U,{e:()=>L});var N=g(14094);class L extends N.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(E){E._notifyExecuteNode(this),this.done._activateSignal(E)}}},14072:(E,U,g)=>{"use strict";g.d(U,{e:()=>u});var N=g(14077),L=g(14081),D=g(12292);class S extends L.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(E){super.connectTo(E),this._connectedPoint.sort(((E,U)=>U.priority-E.priority))}_activateSignal(E){var U;if(null===(U=E.logger)||void 0===U||U.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,tg:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(E,this),E._increaseExecutionId();else for(const g of this._connectedPoint)g._activateSignal(E)}}(0,D.f)("FlowGraphSignalConnection",S);class u extends N.b{constructor(E){super(E),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(E){const U=new S(E,0,this);return this.signalInputs.push(U),U}_registerSignalOutput(E){const U=new S(E,1,this);return this.signalOutputs.push(U),U}_unregisterSignalInput(E){const U=this.signalInputs.findIndex((U=>U.name===E));-1!==U&&(this.signalInputs[U].dispose(),this.signalInputs.splice(U,1))}_unregisterSignalOutput(E){const U=this.signalOutputs.findIndex((U=>U.name===E));-1!==U&&(this.signalOutputs[U].dispose(),this.signalOutputs.splice(U,1))}_reportError(E,U){this.error.tg="string"===typeof U?new Error(U):U,this.error._activateSignal(E)}getSignalInput(E){return this.signalInputs.find((U=>U.name===E))}getSignalOutput(E){return this.signalOutputs.find((U=>U.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.signalInputs=[],E.signalOutputs=[];for(const U of this.signalInputs){const g={};U.serialize(g),E.signalInputs.push(g)}for(const U of this.signalOutputs){const g={};U.serialize(g),E.signalOutputs.push(g)}}deserialize(E){for(let U=0;U<E.signalInputs.length;U++){const g=this.getSignalInput(E.signalInputs[U].name);if(!g)throw new Error("Could not find signal input with name "+E.signalInputs[U].name+" in block "+E.className);g.deserialize(E.signalInputs[U])}for(let U=0;U<E.signalOutputs.length;U++){const g=this.getSignalOutput(E.signalOutputs[U].name);if(!g)throw new Error("Could not find signal output with name "+E.signalOutputs[U].name+" in block "+E.className);g.deserialize(E.signalOutputs[U])}}getClassName(){return"FlowGraphExecutionBlock"}}},14100:(E,U,g)=>{"use strict";g.d(U,{e:()=>L});var N=g(14072);class L extends N.e{constructor(E){super(E),this.out=this._registerSignalOutput("out")}}},14058:(E,U,g)=>{"use strict";g.d(U,{A:()=>B,C:()=>f,D:()=>d,G:()=>I,I:()=>b,K:()=>T,L:()=>G,P:()=>t,e:()=>C,g:()=>F,j:()=>Y,k:()=>y,o:()=>h,r:()=>V,t:()=>P,w:()=>l});var N,L=g(12334),D=g(12379),S=g(14050),u=g(14062);!function(E){E.Any="any",E.String="string",E.Number="number",E.Boolean="boolean",E.Object="object",E.Integer="FlowGraphInteger",E.Vector2="Vector2",E.dU="dU",E.Vector4="Vector4",E.Quaternion="Quaternion",E.Matrix="Matrix",E.Matrix2D="Matrix2D",E.Matrix3D="Matrix3D",E.VU="VU",E.hu="hu"}(N||(N={}));class s{constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=E,this.defaultValue=U,this.animationType=g}serialize(E){E.typeName=this.typeName,E.defaultValue=this.defaultValue}}const C=new s("any",void 0),B=new s("string",""),P=new s("number",0,0),F=new s("boolean",!1),f=new s("Vector2",L.Vector2.Zero(),5),d=new s("dU",L.dU.Zero(),1),I=new s("Vector4",L.Vector4.Zero()),y=new s("Matrix",L.Matrix.Identity(),3),h=new s("Matrix2D",new u.c),V=new s("Matrix3D",new u.e),e=new s("VU",D.VU.Black(),4),x=new s("hu",new D.hu(0,0,0,0),7),l=new s("Quaternion",L.Quaternion.Identity(),2);l.typeTransformer=E=>{if(E.getClassName){if("Vector4"===E.getClassName())return L.Quaternion.eU(E.Og());if("dU"===E.getClassName())return L.Quaternion.FromEulerVector(E);if("Matrix"===E.getClassName())return L.Quaternion.FromRotationMatrix(E)}return E};const Y=new s("FlowGraphInteger",new S.c(0),0);function t(E){const U=E;switch(typeof E){case"string":return B;case"number":return P;case"boolean":return F;case"object":if(U.getClassName)switch(U.getClassName()){case"Vector2":return f;case"dU":return d;case"Vector4":return I;case"Matrix":return y;case"VU":return e;case"hu":return x;case"Quaternion":return l;case"FlowGraphInteger":return Y;case"Matrix2D":return h;case"Matrix3D":return V}return C;default:return C}}function G(E){switch(E){case"string":return B;case"number":return P;case"boolean":return F;case"Vector2":return f;case"dU":return d;case"Vector4":return I;case"Matrix":return y;case"VU":return e;case"hu":return x;case"Quaternion":return l;case"FlowGraphInteger":return Y;case"Matrix2D":return h;case"Matrix3D":return V;default:return C}}function b(E){switch(E){case"number":default:return 0;case"Vector2":return 5;case"dU":return 1;case"Matrix":return 3;case"VU":return 4;case"hu":return 7;case"Quaternion":return 2}}function T(E){switch(E){case 0:return P;case 5:return f;case 1:return d;case 3:return y;case 4:return e;case 7:return x;case 2:return l;default:return C}}},14043:(E,U,g)=>{"use strict";g.d(U,{e:()=>B,h:()=>C,i:()=>P});var N=g(12379),L=g(12334),D=g(14050),S=g(14058),u=g(14062);function s(E){return"Vector2"===E||"dU"===E||"Vector4"===E||"Quaternion"===E||"VU"===E||"hu"===E}function C(E,U,g){var N;const L=(null===U||void 0===U||null===(N=U.getClassName)||void 0===N?void 0:N.call(U))??"";if(s(L)||function(E){return"Matrix"===E||"Matrix2D"===E||"Matrix3D"===E}(L))g[E]={value:U.Og(),className:L};else if("FlowGraphInteger"===L)g[E]={value:U.value,className:L};else if(L&&(U.id||U.name))g[E]={id:U.id,name:U.name,className:L};else{if("object"===typeof U)throw new Error(`Could not serialize value ${U}`);g[E]=U}}function B(E,U,g,C){const P=U[E];let F;const f=(null===P||void 0===P?void 0:P.type)??(null===P||void 0===P?void 0:P.className);if(function(E){return"Mesh"===E||"AbstractMesh"===E||"GroundMesh"===E||"InstanceMesh"===E||"LinesMesh"===E||"GoldbergMesh"===E||"GreasedLineMesh"===E||"TrailMesh"===E}(f)){let E=C.meshes.filter((E=>P.id?E.id===P.id:E.name===P.name));0===E.length&&(E=C.transformNodes.filter((E=>P.id?E.id===P.id:E.name===P.name))),F=P.uniqueId?E.find((E=>E.uniqueId===P.uniqueId)):E[0]}else if(s(f))F=function(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===E)return L.Vector2.eU(U);if("dU"===E)return g&&(U[2]*=-1),L.dU.eU(U);if("Vector4"===E)return L.Vector4.eU(U);if("Quaternion"===E)return g&&(U[2]*=-1,U[3]*=-1),L.Quaternion.eU(U);if("VU"===E)return new N.VU(U[0],U[1],U[2]);if("hu"===E)return new N.hu(U[0],U[1],U[2],U[3]);throw new Error(`Unknown vector class name ${E}`)}(f,P.value);else if(function(E){return"AnimationGroup"===E}(f)){const E=C.animationGroups.filter((E=>E.name===P.name));F=1===E.length?E[0]:E.find((E=>E.uniqueId===P.uniqueId))}else F="Matrix"===f?L.Matrix.eU(P.value):"Matrix2D"===f?new u.c(P.value):"Matrix3D"===f?new u.e(P.value):"FlowGraphInteger"===f?D.c.FromValue(P.value):"number"===f||"string"===f||"boolean"===f?P.value[0]:P&&void 0!==P.value?P.value:Array.isArray(P)?P.reduce(((E,U)=>U.eventData?(E[U.id]={type:(0,S.L)(U.type)},"undefined"!==typeof U.value&&(E[U.id].value=B("value",U,g,C)),E):E),{}):P;return F}function P(E){return"FlowGraphJsonPointerParserBlock"===E}},14084:(E,U,g)=>{"use strict";function N(E,U){return!(!E.parent||E.parent!==U&&!N(E.parent,U))}function L(E){if(E.getClassName)return E.getClassName()}function D(E,U){return E===U&&("Vector2"===E||"dU"===E||"Vector4"===E||"Quaternion"===E)}function S(E,U){return E===U&&("Matrix"===E||"Matrix2D"===E||"Matrix3D"===E)}function u(E,U){return"FlowGraphInteger"===E&&"FlowGraphInteger"===U}function s(E,U){const g="number"===typeof E||"number"===typeof(null===E||void 0===E?void 0:E.value);return g&&!U?!isNaN(C(E)):g}function C(E){return"number"===typeof E?E:E.value}g.d(U,{e:()=>u,i:()=>S,m:()=>D,p:()=>L,s:()=>N,v:()=>C,x:()=>s})},13446:(E,U,g)=>{"use strict";g.r(U),g.d(U,{SceneInstrumentation:()=>D});var N=g(12165),L=g(12551);class D{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(E){E!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=E,E?(this._onBeforeActiveMeshesEvaluationObserver=this.yU.onBeforeActiveMeshesEvaluationObservable.add((()=>{N.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.yU.onAfterActiveMeshesEvaluationObservable.add((()=>{N.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.yU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(E){E!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=E,E?(this._onBeforeRenderTargetsRenderObserver=this.yU.onBeforeRenderTargetsRenderObservable.add((()=>{N.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.yU.onAfterRenderTargetsRenderObservable.add((()=>{N.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.yU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(E){E!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=E,E?(this._onBeforeParticlesRenderingObserver=this.yU.onBeforeParticlesRenderingObservable.add((()=>{N.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.yU.onAfterParticlesRenderingObservable.add((()=>{N.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.yU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(E){E!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=E,this.yU.spriteManagers&&(E?(this._onBeforeSpritesRenderingObserver=this.yU.onBeforeSpritesRenderingObservable.add((()=>{N.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.yU.onAfterSpritesRenderingObservable.add((()=>{N.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.yU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.yU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(E){E!==this._capturePhysicsTime&&this.yU.onBeforePhysicsObservable&&(this._capturePhysicsTime=E,E?(this._onBeforePhysicsObserver=this.yU.onBeforePhysicsObservable.add((()=>{N.Tools.StartPerformanceCounter("Cf"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.yU.onAfterPhysicsObservable.add((()=>{N.Tools.EndPerformanceCounter("Cf"),this._physicsTime.endMonitoring()}))):(this.yU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.yU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(E){E!==this._captureAnimationsTime&&(this._captureAnimationsTime=E,E?this._onAfterAnimationsObserver=this.yU.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.yU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(E){this._captureFrameTime=E}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(E){this._captureInterFrameTime=E}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(E){E!==this._captureRenderTime&&(this._captureRenderTime=E,E?(this._onBeforeDrawPhaseObserver=this.yU.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),N.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.yU.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),N.Tools.EndPerformanceCounter("Main render")}))):(this.yU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(E){E!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=E,E?(this._onBeforeCameraRenderObserver=this.yU.onBeforeCameraRenderObservable.add((E=>{this._cameraRenderTime.beginMonitoring(),N.Tools.StartPerformanceCounter(`Rendering camera ${E.name}`)})),this._onAfterCameraRenderObserver=this.yU.onAfterCameraRenderObservable.add((E=>{this._cameraRenderTime.endMonitoring(!1),N.Tools.EndPerformanceCounter(`Rendering camera ${E.name}`)}))):(this.yU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.yU.getEngine()._drawCalls}constructor(E){this.yU=E,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new L.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new L.e,this._captureFrameTime=!1,this._frameTime=new L.e,this._captureRenderTime=!1,this._renderTime=new L.e,this._captureInterFrameTime=!1,this._interFrameTime=new L.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new L.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new L.e,this._capturePhysicsTime=!1,this._physicsTime=new L.e,this._captureAnimationsTime=!1,this._animationsTime=new L.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new L.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=E.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(N.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.yU.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=E.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(N.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ig(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ig(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ig(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ig(),this._captureRenderTime&&this._renderTime.Ig(),this._captureCameraRenderTime&&this._cameraRenderTime.Ig()}))}dispose(){this._disposed||(this.yU.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.yU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.yU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.yU.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.yU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.yU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.yU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.yU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.yU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.yU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.yU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.yU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.yU=null,this._disposed=!0)}}},14033:(E,U,g)=>{"use strict";g.d(U,{d:()=>B});var N=g(12320),L=g(12322),D=g(12334),S=g(12752),u=g(12874),s=g(12917),C=g(12292);S.c.AddNodeConstructor("Light_Type_1",((E,U)=>()=>new B(E,D.dU.Zero(),U)));class B extends s.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(E){this._shadowFrustumSize=E,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(E){this._shadowOrthoScale=E,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(E){this._orthoLeft=E}get orthoRight(){return this._orthoRight}set orthoRight(E){this._orthoRight=E}get orthoTop(){return this._orthoTop}set orthoTop(E){this._orthoTop=E}get orthoBottom(){return this._orthoBottom}set orthoBottom(E){this._orthoBottom=E}constructor(E,U,g){super(E,g),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=U.scale(-1),this.direction=U}getClassName(){return"Ff"}getTypeID(){return u.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(E,U,g){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(E):this._setDefaultAutoExtendShadowProjectionMatrix(E,U,g)}_setDefaultFixedFrustumShadowProjectionMatrix(E){const U=this.tE().activeCamera;U&&D.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:U.kg,void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,E,this.tE().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(E,U,g){const N=this.tE().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const E=D.dU.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let N=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(let S=0;S<g.length;S++){const u=g[S];if(!u)continue;const s=u.getBoundingInfo().boundingBox;for(let g=0;g<s.vectorsWorld.length;g++)D.dU.TransformCoordinatesToRef(s.vectorsWorld[g],U,E),E.x<this._orthoLeft&&(this._orthoLeft=E.x),E.y<this._orthoBottom&&(this._orthoBottom=E.y),E.x>this._orthoRight&&(this._orthoRight=E.x),E.y>this._orthoTop&&(this._orthoTop=E.y),this.autoCalcShadowZBounds&&(E.z<N&&(N=E.z),E.z>L&&(L=E.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=N,this._shadowMaxZ=L)}const L=this._orthoRight-this._orthoLeft,S=this._orthoTop-this._orthoBottom,u=void 0!==this.shadowMinZ?this.shadowMinZ:(null===N||void 0===N?void 0:N.kg)||0,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===N||void 0===N?void 0:N.maxZ)||1e4,C=this.tE().getEngine().Fg;D.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-L*this.shadowOrthoScale,this._orthoRight+L*this.shadowOrthoScale,this._orthoBottom-S*this.shadowOrthoScale,this._orthoTop+S*this.shadowOrthoScale,C?s:u,C?u:s,E,this.tE().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,U){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,U),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,U),this)}transferToNodeMaterialEffect(E,U){return this.computeTransformedInformation()?(E.setFloat3(U,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(E.setFloat3(U,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(E){const U=this._scene.getEngine();return!U.Fg&&U.isNDCHalfZRange?0:1}getDepthMaxZ(E){const U=this._scene.getEngine();return U.Fg&&U.isNDCHalfZRange?0:1}prepareLightSpecificDefines(E,U){E["DIRLIGHT"+U]=!0}}(0,N.e)([(0,L.E)()],B.prototype,"shadowFrustumSize",null),(0,N.e)([(0,L.E)()],B.prototype,"shadowOrthoScale",null),(0,N.e)([(0,L.E)()],B.prototype,"autoUpdateExtends",void 0),(0,N.e)([(0,L.E)()],B.prototype,"autoCalcShadowZBounds",void 0),(0,N.e)([(0,L.E)("orthoLeft")],B.prototype,"_orthoLeft",void 0),(0,N.e)([(0,L.E)("orthoRight")],B.prototype,"_orthoRight",void 0),(0,N.e)([(0,L.E)("orthoTop")],B.prototype,"_orthoTop",void 0),(0,N.e)([(0,L.E)("orthoBottom")],B.prototype,"_orthoBottom",void 0),(0,C.f)("BABYLON.DirectionalLight",B)},14560:(E,U,g)=>{"use strict";g.d(U,{b:()=>B});var N=g(12320),L=g(12322),D=g(12334),S=g(12379),u=g(12752),s=g(12874),C=g(12292);u.c.AddNodeConstructor("Light_Type_3",((E,U)=>()=>new B(E,D.dU.Zero(),U)));class B extends s.c{constructor(E,U,g){super(E,g),this.groundColor=new S.VU(0,0,0),this.direction=U||D.dU.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"df"}setDirectionToTarget(E){return this.direction=D.dU.Normalize(E.IU(D.dU.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(E,U){const g=D.dU.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",g.x,g.y,g.z,0,U),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.xu),U),this}transferToNodeMaterialEffect(E,U){const g=D.dU.Normalize(this.direction);return E.setFloat3(U,g.x,g.y,g.z),this}pg(){return this._worldMatrix||(this._worldMatrix=D.Matrix.Identity()),this._worldMatrix}getTypeID(){return s.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(E,U){E["HEMILIGHT"+U]=!0}}(0,N.e)([(0,L.k)()],B.prototype,"groundColor",void 0),(0,N.e)([(0,L.D)()],B.prototype,"direction",void 0),(0,C.f)("BABYLON.HemisphericLight",B)},13996:(E,U,g)=>{"use strict";g.d(U,{c:()=>P});var N=g(12320),L=g(12322),D=g(12334),S=g(12752),u=g(12874),s=g(12917),C=g(12311),B=g(12292);S.c.AddNodeConstructor("Light_Type_2",((E,U)=>()=>new P(E,D.dU.Zero(),D.dU.Zero(),0,0,U)));class P extends s.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(E){this._iesProfileTexture!==E&&(this._iesProfileTexture=E,this._iesProfileTexture&&P._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(E){this._angle=E,this._cosHalfAngle=Math.cos(.5*E),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(E){this._innerAngle=E,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(E){this._shadowAngleScale=E,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(E){this._projectionTextureLightNear=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(E){this._projectionTextureLightFar=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(E){this._projectionTextureUpDirection=E,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(E){this._projectionTexture!==E&&(this._projectionTexture=E,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(P._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):P._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(E){return void 0!==E.onGeneratedObservable}static _IsTexture(E){return void 0!==E.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(E){this._projectionTextureProjectionLightMatrix=E,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(E,U,g,N,L,S){super(E,S),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=D.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=D.dU.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=D.dU.Zero(),this._projectionTextureViewLightMatrix=D.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=D.Matrix.Zero(),this._projectionTextureScalingMatrix=D.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=U,this.direction=g,this.angle=N,this.exponent=L}getClassName(){return"SpotLight"}getTypeID(){return u.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(E){super._setDirection(E),this._projectionTextureViewLightDirty=!0}_setPosition(E){super._setPosition(E),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(E,U,g){const N=this.tE().activeCamera;if(!N)return;this._shadowAngleScale=this._shadowAngleScale||1;const L=this._shadowAngleScale*this._angle,S=void 0!==this.shadowMinZ?this.shadowMinZ:N.kg,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,s=this.tE().getEngine().Fg;D.Matrix.PerspectiveFovLHToRef(L,1,s?u:S,s?S:u,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,s)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),D.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const E=this.projectionTextureLightFar,U=this.projectionTextureLightNear,g=E/(E-U),N=-g*U,L=1/Math.tan(this._angle/2);D.Matrix.FromValuesToRef(L/1,0,0,0,0,L,0,0,0,0,g,1,0,0,N,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.c){const E=this._projectionTexture.uScale/2,U=this._projectionTexture.vScale/2;D.Matrix.FromValuesToRef(E,0,0,0,0,U,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(E,U){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),E.setMatrix("textureProjectionMatrix"+U,this._projectionTextureMatrix),E.setTexture("projectionLightTexture"+U,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&E.setTexture("iesLightTexture"+U,this._iesProfileTexture),this}transferToEffect(E,U){let g;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,U),g=D.dU.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,U),g=D.dU.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",g.x,g.y,g.z,this._cosHalfAngle,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,U),this}transferToNodeMaterialEffect(E,U){let g;return g=this.computeTransformedInformation()?D.dU.Normalize(this.transformedDirection):D.dU.Normalize(this.direction),this.tE().useRightHandedSystem?E.setFloat3(U,-g.x,-g.y,-g.z):E.setFloat3(U,g.x,g.y,g.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(E){const U=this._scene.getEngine(),g=void 0!==this.shadowMinZ?this.shadowMinZ:(null===E||void 0===E?void 0:E.kg)??0;return U.Fg&&U.isNDCHalfZRange?g:this._scene.getEngine().isNDCHalfZRange?0:g}getDepthMaxZ(E){const U=this._scene.getEngine(),g=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===E||void 0===E?void 0:E.maxZ)??1e4;return U.Fg&&U.isNDCHalfZRange?0:g}prepareLightSpecificDefines(E,U){E["SPOTLIGHT"+U]=!0,E["PROJECTEDLIGHTTEXTURE"+U]=!(!this.projectionTexture||!this.projectionTexture.isReady()),E["IESLIGHTTEXTURE"+U]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,N.e)([(0,L.E)()],P.prototype,"angle",null),(0,N.e)([(0,L.E)()],P.prototype,"innerAngle",null),(0,N.e)([(0,L.E)()],P.prototype,"shadowAngleScale",null),(0,N.e)([(0,L.E)()],P.prototype,"exponent",void 0),(0,N.e)([(0,L.E)()],P.prototype,"projectionTextureLightNear",null),(0,N.e)([(0,L.E)()],P.prototype,"projectionTextureLightFar",null),(0,N.e)([(0,L.E)()],P.prototype,"projectionTextureUpDirection",null),(0,N.e)([(0,L.y)("projectedLightTexture")],P.prototype,"_projectionTexture",void 0),(0,B.f)("BABYLON.SpotLight",P)},13708:(E,U,g)=>{"use strict";g.d(U,{d:()=>S,g:()=>D,i:()=>u});const N={},L={};function D(E,U){N[E]=U}function S(E,U){L[E]=U}function u(E){return L[E]?L[E]:null}},13612:(E,U,g)=>{"use strict";g.d(U,{b:()=>t,f:()=>w});var N,L=g(12165),D=g(12174),S=g(12573),u=g(12205),s=g(12186),C=g(12798),B=g(12210),P=g(12212),F=g(12296),f=g(12243),d=g(12202);!function(E){E[E.Clean=0]="Clean",E[E.Stop=1]="Stop",E[E.Sync=2]="Sync",E[E.NoSync=3]="NoSync"}(N||(N={}));const I=new D.b,y={};let h=!1;function V(){return y[".babylon"]}function e(E,U){const g=y[E];return g||(s.d.Warn("Unable to find a plugin to load "+E+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U?V():void 0)}function x(E,U,g){let N="Unable to load from "+(E.rawData?"binary data":E.url);return U?N+=`: ${U}`:g&&(N+=`: ${g}`),N}async function l(E,U,g,N,L,D,S,u,s){var C;const P="data:"===(F=E.url).substring(0,5)?F.substring(5):null;var F;if(E.rawData&&!S)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=P||S?"":function(E){const U=E.indexOf("?");-1!==U&&(E=E.substring(0,U));const g=E.lastIndexOf(".");return E.substring(g,E.length).toLowerCase()}(E.url);let x=S?e(S,!0):P?function(E){for(const U in y){const g=y[U].plugin;if(g.canDirectLoad&&g.canDirectLoad(E))return y[U]}return V()}(E.url):e(h,!1);if(!x&&h){if(E.url&&!E.url.startsWith("blob:")){const U=await async function(E,U){const g=U.method||"GET";return await new Promise(((N,L)=>{const D=new d.e;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const E={};if(U.responseHeaders)for(const g of U.responseHeaders)E[g]=D.getResponseHeader(g)||"";N({response:D.response,headerValues:E})}else L(`Unable to fetch data from ${E}. Error code: ${D.status}`)})),D.open(g,E),D.send()}))}(E.url,{method:"HEAD",responseHeaders:["Content-Type"]}),g=U.headerValues?U.headerValues["Content-Type"]:"";g&&(x=function(E){for(const U in y){const g=y[U];if(g.mimeType===E)return g}}(g))}x||(x=V())}if(!x)throw new Error(`No plugin or fallback for ${S??E.url}`);if(!1===(null===s||void 0===s||null===(C=s[x.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${x.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(E.rawData&&!x.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(E=>{if(x.plugin.createPlugin){const U=x.plugin.createPlugin(s??{});return U instanceof Promise?(U.then(E).catch((E=>{L("Error instantiating plugin.",E)})),null):(E(U),U)}return E(x.plugin),x.plugin})((s=>{var C;if(!s)throw`The loader plugin corresponding to the '${S}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(I.notifyObservers(s),P&&(s.canDirectLoad&&s.canDirectLoad(E.url)||!(0,B.h)(E.url))){if(s.directLoad){const E=s.directLoad(U,P);E instanceof Promise?E.then((E=>{g(s,E)})).catch((E=>{L("Error in directLoad of _loadData: "+E,E)})):g(s,E)}else g(s,P);return}const F=x.isBinary,d=(E,N)=>{U.C?L("Scene has been disposed"):g(s,E,N)};let y=null,h=!1;null===(C=s.hg)||void 0===C||C.add((()=>{h=!0,y&&(y.abort(),y=null),D()}));const V=()=>{if(h)return;const g=(E,U)=>{L(null===E||void 0===E?void 0:E.statusText,U)};if(!s.loadFile&&E.rawData)throw"Plugin does not support loading ArrayBufferView.";y=s.loadFile?s.loadFile(U,E.rawData||E.file||E.url,E.rootUrl,d,N,F,g,u):U._loadFile(E.file||E.url,d,N,!0,F,g)},e=U.getEngine();let l=e.enableOfflineSupport;if(l){let g=!1;for(const N of U.disableOfflineSupportExceptionRules)if(N.test(E.url)){g=!0;break}l=!g}l&&f.b.OfflineProviderFactory?U.offlineProvider=f.b.OfflineProviderFactory(E.url,V,e.disableManifestCheck):V()}))}function Y(E,U){let g,N,D=null,S=null;if(U)if(U.name)g=`file:${U.name}`,N=U.name,D=U;else if(ArrayBuffer.isView(U))g="",N=(0,F.e)(),S=U;else if(U.startsWith("data:"))g=U,N="";else if(E){const D=U;if("/"===D.substring(0,1))return L.Tools.Error("Wrong sceneFilename parameter"),null;g=E+D,N=D}else g=U,N=L.Tools.GetFilename(U),E=L.Tools.GetFolderPath(U);else g=E,N=L.Tools.GetFilename(E),E=L.Tools.GetFolderPath(E);return{url:g,rootUrl:E,name:N,file:D,rawData:S}}function t(E){if("string"===typeof E.extensions){const U=E.extensions;y[U.toLowerCase()]={plugin:E,isBinary:!1}}else{const U=E.extensions,g=Object.keys(U);for(const N of g)y[N.toLowerCase()]={plugin:E,isBinary:U[N].isBinary,mimeType:U[N].mimeType}}}async function G(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.b.LastCreatedScene,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!N)return s.d.Error("No scene available to import mesh to"),null;const f=Y(U,g);if(!f)return null;const d={};N.addPendingData(d);const I=()=>{N.removePendingData(d)},y=(E,U)=>{const g=x(f,E,U);S?S(N,g,new P.h(g,P.f.SceneLoaderError,U)):s.d.Error(g),I()},h=D?E=>{try{D(E)}catch(U){y("Error in onProgress callback: "+U,U)}}:void 0,V=(E,U,g,D,S,u,s,C)=>{if(N.importedMeshesFiles.push(f.url),L)try{L(E,U,g,D,S,u,s,C)}catch(B){y("Error in onSuccess callback: "+B,B)}N.removePendingData(d)};return await l(f,N,((U,g,L)=>{if(U.rewriteRootURL&&(f.rootUrl=U.rewriteRootURL(f.rootUrl,L)),U.importMesh){const L=[],D=[],S=[];if(!U.importMesh(E,N,g,f.rootUrl,L,D,S,y))return;N.loadingPluginName=U.name,V(L,D,S,[],[],[],[],[])}else{U.importMeshAsync(E,N,g,f.rootUrl,h,f.name).then((E=>{N.loadingPluginName=U.name,V(E.meshes,E.RP,E.skeletons,E.animationGroups,E.transformNodes,E.geometries,E.lights,E.spriteManagers)})).catch((E=>{y(E.message,E)}))}}),h,y,I,C,B,F)}async function b(E,U,g,N,L,D,S,u){return await new Promise(((s,C)=>{try{G(E,U,g,N,((E,U,g,N,L,D,S,u)=>{s({meshes:E,RP:U,skeletons:g,animationGroups:N,transformNodes:L,geometries:D,lights:S,spriteManagers:u})}),L,((E,U,g)=>{C(g||new Error(U))}),D,S,u).catch(C)}catch(P){C(P)}}))}async function T(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedEngine,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};g?await o(E,U,new S.c(g),N,D,s,C,B,P):L.Tools.Error("No engine available")}async function v(E,U,g,N,L,D,S){return await new Promise(((u,s)=>{T(E,U,g,(E=>{u(E)}),N,((E,U,g)=>{s(g||new Error(U))}),L,D,S)}))}async function o(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!g)return s.d.Error("No scene available to append to"),null;const f=Y(E,U);if(!f)return null;const d={};g.addPendingData(d);const I=()=>{g.removePendingData(d)};C.b.ShowLoadingScreen&&!h&&(h=!0,g.getEngine().displayLoadingUI(),g.executeWhenReady((()=>{g.getEngine().hideLoadingUI(),h=!1})));const y=(E,U)=>{const N=x(f,E,U);D?D(g,N,new P.h(N,P.f.SceneLoaderError,U)):s.d.Error(N),I()},V=L?E=>{try{L(E)}catch(U){y("Error in onProgress callback",U)}}:void 0,e=()=>{if(N)try{N(g)}catch(E){y("Error in onSuccess callback",E)}g.removePendingData(d)};return await l(f,g,((E,U)=>{if(E.load){if(!E.load(g,U,f.rootUrl,y))return;g.loadingPluginName=E.name,e()}else{E.loadAsync(g,U,f.rootUrl,V,f.name).then((()=>{g.loadingPluginName=E.name,e()})).catch((E=>{y(E.message,E)}))}}),V,y,I,S,B,F)}async function c(E,U,g,N,L,D,S){return await new Promise(((u,s)=>{try{o(E,U,g,(E=>{u(E)}),N,((E,U,g)=>{s(g||new Error(U))}),L,D,S).catch(s)}catch(P){s(P)}}))}async function r(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!g)return s.d.Error("No scene available to load asset container to"),null;const F=Y(E,U);if(!F)return null;const f={};g.addPendingData(f);const d=()=>{g.removePendingData(f)},I=(E,U)=>{const N=x(F,E,U);D?D(g,N,new P.h(N,P.f.SceneLoaderError,U)):s.d.Error(N),d()},y=L?E=>{try{L(E)}catch(U){I("Error in onProgress callback",U)}}:void 0,h=E=>{if(N)try{N(E)}catch(U){I("Error in onSuccess callback",U)}g.removePendingData(f)};return await l(F,g,((E,U)=>{if(E.loadAssetContainer){const N=E.loadAssetContainer(g,U,F.rootUrl,I);if(!N)return;N.populateRootNodes(),g.loadingPluginName=E.name,h(N)}else if(E.loadAssetContainerAsync){E.loadAssetContainerAsync(g,U,F.rootUrl,y,F.name).then((U=>{U.populateRootNodes(),g.loadingPluginName=E.name,h(U)})).catch((E=>{I(E.message,E)}))}else I("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),y,I,d,S,C,B)}async function j(E,U,g,N,L,D,S){return await new Promise(((u,s)=>{try{r(E,U,g,(E=>{u(E)}),N,((E,U,g)=>{s(g||new Error(U))}),L,D,S).catch(s)}catch(P){s(P)}}))}async function Z(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedScene,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!g)return void s.d.Error("No scene available to load animations to");if(N){for(const N of g.animatables)N.reset();g.stopAllAnimations();const E=g.animationGroups.slice();for(const g of E)g.dispose();const U=g.getNodes();for(const g of U)g.animations&&(g.animations=[])}else switch(L){case 0:const E=g.animationGroups.slice();for(const U of E)U.dispose();break;case 1:for(const U of g.animationGroups)U.stop();break;case 2:for(const U of g.animationGroups)U.reset(),U.restart();break;case 3:break;default:return void s.d.Error("Unknown animation group loading mode value '"+L+"'")}const d=g.animatables.length;await r(E,U,g,(E=>{E.mergeAnimationsTo(g,g.animatables.slice(d),D),E.dispose(),g.onAnimationFileImportedObservable.notifyObservers(g),S&&S(g)}),C,B,P,F,f)}async function A(E,U,g,N,L,D,S,u,s,C){return await new Promise(((B,F)=>{try{Z(E,U,g,N,L,D,(E=>{B(E)}),S,((E,U,g)=>{F(g||new Error(U))}),u,s,C).catch(F)}catch(P){F(P)}}))}class w{static get ForceFullSceneLoadingForIncremental(){return C.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(E){C.b.ForceFullSceneLoadingForIncremental=E}static get ShowLoadingScreen(){return C.b.ShowLoadingScreen}static set ShowLoadingScreen(E){C.b.ShowLoadingScreen=E}static get loggingLevel(){return C.b.loggingLevel}static set loggingLevel(E){C.b.loggingLevel=E}static get CleanBoneMatrixWeights(){return C.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(E){C.b.CleanBoneMatrixWeights=E}static GetDefaultPlugin(){return V()}static GetPluginForExtension(E){var U;return null===(U=e(E,!0))||void 0===U?void 0:U.plugin}static IsPluginForExtensionAvailable(E){return function(E){return!!y[E]}(E)}static RegisterPlugin(E){t(E)}static ImportMesh(E,U,g,N,L,D,S,s,C){G(E,U,g,N,L,D,S,s,C).catch((E=>null===S||void 0===S?void 0:S(u.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async ImportMeshAsync(E,U,g,N,L,D,S){return await b(E,U,g,N,L,D,S)}static Load(E,U,g,N,L,D,S,s){T(E,U,g,N,L,D,S,s).catch((E=>null===D||void 0===D?void 0:D(u.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async LoadAsync(E,U,g,N,L,D){return await v(E,U,g,N,L,D)}static Append(E,U,g,N,L,D,S,s){o(E,U,g,N,L,D,S,s).catch((E=>null===D||void 0===D?void 0:D(g??u.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async AppendAsync(E,U,g,N,L,D){return await c(E,U,g,N,L,D)}static LoadAssetContainer(E,U,g,N,L,D,S,s){r(E,U,g,N,L,D,S,s).catch((E=>null===D||void 0===D?void 0:D(g??u.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async LoadAssetContainerAsync(E,U,g,N,L,D){return await j(E,U,g,N,L,D)}static ImportAnimations(E,U,g,N,L,D,S,s,C,B,P){Z(E,U,g,N,L,D,S,s,C,B,P).catch((E=>null===C||void 0===C?void 0:C(g??u.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async ImportAnimationsAsync(E,U,g,N,L,D,S,u,s,C,B){return await A(E,U,g,N,L,D,u,C,B)}}w.NO_LOGGING=0,w.MINIMAL_LOGGING=1,w.SUMMARY_LOGGING=2,w.DETAILED_LOGGING=3,w.OnPluginActivatedObservable=I},14016:(E,U,g)=>{"use strict";g.d(U,{e:()=>F});var N=g(12320),L=g(12322),D=g(12165),S=g(12334),u=g(12355),s=g(12311),C=g(12292),B=g(12174),P=g(12367);g(14021);class F extends u.d{set boundingBoxSize(E){if(this._boundingBoxSize&&this._boundingBoxSize.equals(E))return;this._boundingBoxSize=E;const U=this.tE();U&&U.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(E){this._rotationY=E,this.setReflectionTextureMatrix(S.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(E,U,g){let N="";for(const L of E)N+=L;return new F(N,U,null,g,E)}static CreateFromPrefilteredData(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const D=new F(E,U,null,!1,null,null,null,void 0,!0,g,N);return U.useDelayedTextureLoading=L,D}constructor(E,U){var g;let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,h=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0;super(U),this.onLoadObservable=new B.b,this.boundingBoxPosition=S.dU.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new S.Matrix,this._buffer=null,this.name=E,this.url=E,this._noMipmap=L,this.Qg=!1,this.isCube=!0,this._textureMatrix=S.Matrix.Identity(),this.coordinatesMode=s.c.CUBIC_MODE;let e=null,x=null;null===N||Array.isArray(N)?(this._noMipmap=L,this._format=P,this._createPolynomials=d,e=N,this._loaderOptions=h,this._useSRGBBuffer=V,this._lodScale=I,this._lodOffset=y):(e=N.extensions??null,this._noMipmap=N.noMipmap??!1,D=N.files??null,x=N.buffer??null,this._format=N.format??5,F=N.prefiltered??!1,f=N.forcedExtension??null,this._createPolynomials=N.createPolynomials??!1,this._lodScale=N.lodScale??.8,this._lodOffset=N.lodOffset??0,this._loaderOptions=N.loaderOptions,this._useSRGBBuffer=N.useSRGBBuffer,u=N.H??null,C=N.onError??null),(E||D)&&this.updateURL(E,f,u,F,C,e,null===(g=this.tE())||void 0===g?void 0:g.useDelayedTextureLoading,D,x)}getClassName(){return"CubeTexture"}updateURL(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=E),this.url=E,U&&(this._forcedExtension=U);const C=E.lastIndexOf("."),B=U||(C>-1?E.substring(C).toLowerCase():""),P=0===B.indexOf(".dds"),F=0===B.indexOf(".env"),f=0===B.indexOf(".basis");if(F?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=N,N&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),u)this._files=u;else if(f||F||P||D||(D=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,D){for(let U=0;U<D.length;U++)this._files.push(E+D[U]);this._extensions=D}this._buffer=s,S?(this.delayLoadState=4,this._delayedOnLoad=g,this._delayedOnError=L):this._loadTexture(g,L)}delayLoad(E){4===this.delayLoadState&&(E&&(this._forcedExtension=E),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(E){var U,g;if(E.updateFlag===this._textureMatrix.updateFlag)return;E.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(g=this.tE())||void 0===g||g.markAllMaterialsAsDirty(1,(E=>-1!==E.getActiveTextures().indexOf(this))));if(this._textureMatrix=E,null===(U=this.tE())||void 0===U||!U.useRightHandedSystem)return;const N=S.TmpVectors.dU[0],L=S.TmpVectors.Quaternion[0],D=S.TmpVectors.dU[1];this._textureMatrix.decompose(N,L,D),L.z*=-1,L.w*=-1,S.Matrix.ComposeToRef(N,L,D,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var E;return null!==(E=this.tE())&&void 0!==E&&E.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=this.tE(),N=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const L=()=>{var U;(this.onLoadObservable.notifyObservers(this),N)&&(N.dispose(),null===(U=this.tE())||void 0===U||U.markAllMaterialsAsDirty(1));E&&E()},S=(E,g)=>{this._loadingError=!0,this._errorObject={message:E,exception:g},U&&U(E,g),s.c.OnTextureLoadErrorObservable.notifyObservers(this)};var u;this._texture?this._texture.isReady?D.Tools.SetImmediate((()=>L())):this._texture.onLoadedObservable.add((()=>L())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,g,this._lodScale,this._lodOffset,E,S,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,g,this._files,this._noMipmap,E,S,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(u=this._texture)||void 0===u||u.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(E,U,g){const N=P.b.Parse((()=>{let N=!1;return E.prefiltered&&(N=E.prefiltered),new F(g+(E.url??E.name),U,E.extensions,!1,E.files||null,null,null,void 0,N,E.forcedExtension)}),E,U);if(E.boundingBoxPosition&&(N.boundingBoxPosition=S.dU.eU(E.boundingBoxPosition)),E.boundingBoxSize&&(N.boundingBoxSize=S.dU.eU(E.boundingBoxSize)),E.animations)for(let L=0;L<E.animations.length;L++){const U=E.animations[L],g=(0,C.d)("BABYLON.Animation");g&&N.animations.push(g.Parse(U))}return N}clone(){let E=0;const U=P.b.Clone((()=>{const U=new F(this.url,this.tE()||this._getEngine(),this._extensions,this._noMipmap,this._files);return E=U.uniqueId,U}),this);return U.uniqueId=E,U}}(0,N.e)([(0,L.E)()],F.prototype,"url",void 0),(0,N.e)([(0,L.D)()],F.prototype,"boundingBoxPosition",void 0),(0,N.e)([(0,L.D)()],F.prototype,"boundingBoxSize",null),(0,N.e)([(0,L.E)("rotationY")],F.prototype,"rotationY",null),(0,N.e)([(0,L.E)("files")],F.prototype,"_files",void 0),(0,N.e)([(0,L.E)("forcedExtension")],F.prototype,"_forcedExtension",void 0),(0,N.e)([(0,L.E)("extensions")],F.prototype,"_extensions",void 0),(0,N.e)([(0,L.u)("textureMatrix")],F.prototype,"_textureMatrix",void 0),(0,N.e)([(0,L.u)("textureMatrixRefraction")],F.prototype,"_textureMatrixRefraction",void 0),s.c._CubeTextureParser=F.Parse,(0,C.f)("BABYLON.CubeTexture",F)},14571:(E,U,g)=>{"use strict";g.d(U,{b:()=>s});var N=g(12186),L=g(12311),D=g(12300),S=g(12471),u=g(12273);S.ThinEngine.prototype.createDynamicTexture=function(E,U,g,N){const L=new u.c(this,4);return L.baseWidth=E,L.baseHeight=U,g&&(E=this.needPOTTextures?(0,D.f)(E,this._caps.maxTextureSize):E,U=this.needPOTTextures?(0,D.f)(U,this._caps.maxTextureSize):U),L.width=E,L.height=U,L.isReady=!1,L.generateMipMaps=g,L.samplingMode=N,this.updateTextureSamplingMode(N,L),this._internalTexturesCache.push(L),L},S.ThinEngine.prototype.updateDynamicTexture=function(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!E)return;const S=this._gl,u=S.TEXTURE_2D,s=this._bindTextureDirectly(u,E,!0,D);this._unpackFlipY(void 0===g?E.invertY:g),N&&S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(E.type),B=this._getInternalFormat(L||E.format),P=this._getRGBABufferInternalSizedFormat(E.type,B);S.texImage2D(u,0,P,B,C,U),E.generateMipMaps&&S.generateMipmap(u),s||this._bindTextureDirectly(u,null),N&&S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),L&&(E.format=L),E._dynamicTextureSource=U,E._premulAlpha=N,E.invertY=g||!1,E.isReady=!0};class s extends L.c{constructor(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,u=arguments.length>6?arguments[6]:void 0;const s=!g||g._isScene;super(null,s?g:null===g||void 0===g?void 0:g.yU,s?!N:g,u,D,void 0,void 0,void 0,void 0,S),this.name=E,this.wrapU=L.c.CLAMP_ADDRESSMODE,this.wrapV=L.c.CLAMP_ADDRESSMODE,this._generateMipMaps=N;const C=this._getEngine();if(!C)return;if(U.getContext)this._canvas=U,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,N,D);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const E=U;E.width||0===E.width?this._texture=C.createDynamicTexture(E.width,E.height,N,D):this._texture=C.createDynamicTexture(U,U,N,D)}const B=this.getSize();this._canvas.width!==B.width&&(this._canvas.width=B.width),this._canvas.height!==B.height&&(this._canvas.height=B.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(E){this._canvas.width=E.width,this._canvas.height=E.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(E.width,E.height,this._generateMipMaps,this.samplingMode)}scale(E){const U=this.getSize();U.width*=E,U.height*=E,this._recreate(U)}scaleTo(E,U){const g=this.getSize();g.width=E,g.height=U,this._recreate(g)}getContext(){return this._context}clear(E){const U=this.getSize();E&&(this._context.fillStyle=E),this._context.clearRect(0,0,U.width,U.height)}update(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===E||E,U,this._format||void 0,void 0,g)}drawText(E,U,g,N,L,D,S){let u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const s=this.getSize();if(D&&(this._context.fillStyle=D,this._context.fillRect(0,0,s.width,s.height)),this._context.font=N,null===U||void 0===U){const g=this._context.measureText(E);U=(s.width-g.width)/2}if(null===g||void 0===g){const E=parseInt(N.replace(/\D/g,""));g=s.height/2+E/3.65}this._context.fillStyle=L||"",this._context.fillText(E,U,g),u&&this.update(S)}dispose(){var E,U;(super.dispose(),this._ownCanvas)&&(null===(E=this._canvas)||void 0===E||null===(U=E.remove)||void 0===U||U.call(E));this._canvas=null,this._context=null}clone(){const E=this.tE();if(!E)return this;const U=this.getSize(),g=new s(this.name,U,E,this._generateMipMaps);return g.Qg=this.Qg,g.level=this.level,g.wrapU=this.wrapU,g.wrapV=this.wrapV,g}serialize(){const E=this.tE();E&&!E.isReady()&&N.d.Warn("The scene must be ready before serializing the dynamic texture");const U=super.serialize();return s._IsCanvasElement(this._canvas)&&(U.base64String=this._canvas.toDataURL()),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U}static _IsCanvasElement(E){return void 0!==E.toDataURL}_rebuild(){this.update()}}},13918:(E,U,g)=>{"use strict";g.d(U,{e:()=>L});var N=g(12311);class L extends N.c{get depth(){return this._depth}constructor(E,U,g,L,D,S){let u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:N.c.TRILINEAR_SAMPLINGMODE,B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,P=arguments.length>10?arguments[10]:void 0;super(null,S,!u,s),this.format=D,this._texture=S.getEngine().createRawTexture2DArray(E,U,g,L,D,u,s,C,null,B,P),this._depth=L,this.is2DArray=!0}update(E){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,E,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(E,U,g,N,D){return new L(E,U,g,N,5,D,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13722:(E,U,g)=>{"use strict";g.d(U,{c:()=>u,d:()=>s,f:()=>D,g:()=>S});var N=g(12353),L=g(12334);function D(E,U){return`{X: ${E.x.toFixed(U)} Y: ${E.y.toFixed(U)}}`}function S(E,U){return`{X: ${E._x.toFixed(U)} Y: ${E._y.toFixed(U)} Z: ${E._z.toFixed(U)}}`}function u(E,U){return 2*Math.acos((0,N.Clamp)(L.Quaternion.Dot(E,U)))}function s(E,U){const g=new L.Quaternion;return function(E,U,g){const D=L.dU.Cross(E,U),S=Math.acos((0,N.Clamp)(L.dU.Dot(E,U),-1,1));L.Quaternion.RotationAxisToRef(D,S,g)}(E,U,g),g}},13570:(E,U,g)=>{"use strict";g.d(U,{b:()=>C});var N=g(12334),L=g(12379),D=g(12774),S=g(12764),u=g(12390);g(13572);function s(E){let U=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const g=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],D=[];let s=[];const C=E.width||E.size||1,B=E.height||E.size||1,P=E.depth||E.size||1,F=E.wrap||!1;let f=void 0===E.topBaseAt?1:E.topBaseAt,d=void 0===E.bottomBaseAt?0:E.bottomBaseAt;f=(f+4)%4,d=(d+4)%4;let I=[2,0,3,1][f],y=[2,0,1,3][d],h=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(F){U=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],h=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let E=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],g=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const N=[17,18,19,16],L=[22,23,20,21];for(;I>0;)E.unshift(E.pop()),N.unshift(N.pop()),I--;for(;y>0;)g.unshift(g.pop()),L.unshift(L.pop()),y--;E=E.flat(),g=g.flat(),h=h.concat(E).concat(g),U.push(N[0],N[2],N[3],N[0],N[1],N[2]),U.push(L[0],L[2],L[3],L[0],L[1],L[2])}const V=[C/2,B/2,P/2];s=h.reduce(((E,U,g)=>E.concat(U*V[g%3])),[]);const e=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,x=E.faceUV||new Array(6),l=E.faceColors,Y=[];for(let S=0;S<6;S++)void 0===x[S]&&(x[S]=new N.Vector4(0,0,1,1)),l&&void 0===l[S]&&(l[S]=new L.hu(1,1,1,1));for(let N=0;N<6;N++)if(D.push(x[N].z,u.b?1-x[N].w:x[N].w),D.push(x[N].x,u.b?1-x[N].w:x[N].w),D.push(x[N].x,u.b?1-x[N].y:x[N].y),D.push(x[N].z,u.b?1-x[N].y:x[N].y),l)for(let E=0;E<4;E++)Y.push(l[N].r,l[N].g,l[N].b,l[N].a);S.e._ComputeSides(e,s,U,g,D,E.frontUVs,E.backUVs);const t=new S.e;if(t.indices=U,t.bE=s,t.TE=g,t.oE=D,l){const E=e===S.e.DOUBLESIDE?Y.concat(Y):Y;t.vE=E}return t}function C(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new D.e(E,g);U.sideOrientation=D.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return s(U).rE(N,U.updatable),N}S.e.CreateBox=s,D.e.CreateBox=function(E,U){return C(E,{size:U,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13710:(E,U,g)=>{"use strict";g.d(U,{b:()=>u});var N=g(12774),L=g(12764),D=g(12390);function S(E){const U=[],g=[],N=[],S=[],u=E.radius||.5,s=E.tessellation||64,C=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,B=0===E.sideOrientation?0:E.sideOrientation||L.e.DEFAULTSIDE;U.push(0,0,0),S.push(.5,.5);const P=2*Math.PI*C,F=1===C?P/s:P/(s-1);let f=0;for(let L=0;L<s;L++){const E=Math.cos(f),g=Math.sin(f),N=(E+1)/2,L=(1-g)/2;U.push(u*E,u*g,0),S.push(N,D.b?1-L:L),f+=F}1===C&&(U.push(U[3],U[4],U[5]),S.push(S[2],D.b?1-S[3]:S[3]));const d=U.length/3;for(let L=1;L<d-1;L++)g.push(L+1,0,L);L.e.ComputeNormals(U,g,N),L.e._ComputeSides(B,U,g,N,S,E.frontUVs,E.backUVs);const I=new L.e;return I.indices=g,I.bE=U,I.TE=N,I.oE=S,I}function u(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new N.e(E,g);U.sideOrientation=N.e._GetDefaultSideOrientation(U.sideOrientation),L._originalBuilderSideOrientation=U.sideOrientation;return S(U).rE(L,U.updatable),L}L.e.CreateDisc=S,N.e.CreateDisc=function(E,U,g){return u(E,{radius:U,tessellation:g,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13572:(E,U,g)=>{"use strict";g.d(U,{g:()=>y,e:()=>V,h:()=>h});var N=g(12334),L=g(12379),D=g(12774),S=g(12764),u=g(12407);D.e._GroundMeshParser=(E,U)=>s.Parse(E,U);class s extends D.e{constructor(E,U){super(E,U),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=E,this._subdivisionsY=E,this.subdivide(E);const g=this;g.createOrUpdateSubmeshesOctree&&g.createOrUpdateSubmeshesOctree(U)}getHeightAtCoordinates(E,U){const g=this.getWorldMatrix(),L=N.TmpVectors.Matrix[5];g.invertToRef(L);const D=N.TmpVectors.dU[8];if(N.dU.TransformCoordinatesFromFloatsToRef(E,0,U,L,D),E=D.x,U=D.z,E<this._minX||E>=this._maxX||U<=this._minZ||U>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(E,U),u=-(S.x*E+S.z*U+S.w)/S.y;return N.dU.TransformCoordinatesFromFloatsToRef(0,u,0,g,D),D.y}getNormalAtCoordinates(E,U){const g=new N.dU(0,1,0);return this.getNormalAtCoordinatesToRef(E,U,g),g}getNormalAtCoordinatesToRef(E,U,g){const L=this.getWorldMatrix(),D=N.TmpVectors.Matrix[5];L.invertToRef(D);const S=N.TmpVectors.dU[8];if(N.dU.TransformCoordinatesFromFloatsToRef(E,0,U,D,S),E=S.x,U=S.z,E<this._minX||E>this._maxX||U<this._minZ||U>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(E,U);return N.dU.TransformNormalFromFloatsToRef(u.x,u.y,u.z,L,g),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(E,U){const g=Math.floor((E+this._maxX)*this._subdivisionsX/this._width),N=Math.floor(-(U+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),L=this._heightQuads[N*this._subdivisionsX+g];let D;return D=U<L.slope.x*E+L.slope.y?L.facet1:L.facet2,D}_initHeightQuads(){const E=this._subdivisionsX,U=this._subdivisionsY;this._heightQuads=[];for(let g=0;g<U;g++)for(let U=0;U<E;U++){const L={slope:N.Vector2.Zero(),facet1:new N.Vector4(0,0,0,0),facet2:new N.Vector4(0,0,0,0)};this._heightQuads[g*E+U]=L}return this}_computeHeightQuads(){const E=this.getVerticesData(u.f.PositionKind);if(!E)return this;const U=N.TmpVectors.dU[3],g=N.TmpVectors.dU[2],L=N.TmpVectors.dU[1],D=N.TmpVectors.dU[0],S=N.TmpVectors.dU[4],s=N.TmpVectors.dU[5],C=N.TmpVectors.dU[6],B=N.TmpVectors.dU[7],P=N.TmpVectors.dU[8];let F=0,f=0,d=0,I=0,y=0,h=0,V=0;const e=this._subdivisionsX,x=this._subdivisionsY;for(let u=0;u<x;u++)for(let x=0;x<e;x++){F=3*x,f=u*(e+1)*3,d=(u+1)*(e+1)*3,U.x=E[f+F],U.y=E[f+F+1],U.z=E[f+F+2],g.x=E[f+F+3],g.y=E[f+F+4],g.z=E[f+F+5],L.x=E[d+F],L.y=E[d+F+1],L.z=E[d+F+2],D.x=E[d+F+3],D.y=E[d+F+4],D.z=E[d+F+5],I=(D.z-U.z)/(D.x-U.x),y=U.z-I*U.x,g.subtractToRef(U,S),L.subtractToRef(U,s),D.subtractToRef(U,C),N.dU.CrossToRef(C,s,B),N.dU.CrossToRef(S,C,P),B.normalize(),P.normalize(),h=-(B.x*U.x+B.y*U.y+B.z*U.z),V=-(P.x*g.x+P.y*g.y+P.z*g.z);const l=this._heightQuads[u*e+x];l.slope.du(I,y),l.facet1.du(B.x,B.y,B.z,h),l.facet2.du(P.x,P.y,P.z,V)}return this}serialize(E){super.serialize(E),E.subdivisionsX=this._subdivisionsX,E.subdivisionsY=this._subdivisionsY,E.minX=this._minX,E.maxX=this._maxX,E.kg=this._minZ,E.maxZ=this._maxZ,E.width=this._width,E.height=this._height}static Parse(E,U){const g=new s(E.name,U);return g._subdivisionsX=E.subdivisionsX||1,g._subdivisionsY=E.subdivisionsY||1,g._minX=E.minX,g._maxX=E.maxX,g._minZ=E.kg,g._maxZ=E.maxZ,g._width=E.width,g._height=E.height,g}}var C=g(12165),B=g(12205),P=g(12336),F=g(12390);function f(E){const U=[],g=[],L=[],D=[];let u,s;const C=E.width||E.size||1,B=E.height||E.size||1,P=0|(E.subdivisionsX||E.subdivisions||1),f=0|(E.subdivisionsY||E.subdivisions||1);for(u=0;u<=f;u++)for(s=0;s<=P;s++){const E=new N.dU(s*C/P-C/2,0,(f-u)*B/f-B/2),U=new N.dU(0,1,0);g.push(E.x,E.y,E.z),L.push(U.x,U.y,U.z),D.push(s/P,F.b?u/f:1-u/f)}for(u=0;u<f;u++)for(s=0;s<P;s++)U.push(s+1+(u+1)*(P+1)),U.push(s+1+u*(P+1)),U.push(s+u*(P+1)),U.push(s+(u+1)*(P+1)),U.push(s+1+(u+1)*(P+1)),U.push(s+u*(P+1));const d=new S.e;return d.indices=U,d.bE=g,d.TE=L,d.oE=D,d}function d(E){const U=void 0!==E.xmin&&null!==E.xmin?E.xmin:-1,g=void 0!==E.zmin&&null!==E.zmin?E.zmin:-1,L=void 0!==E.xmax&&null!==E.xmax?E.xmax:1,D=void 0!==E.zmax&&null!==E.zmax?E.zmax:1,u=E.subdivisions||{w:1,h:1},s=E.precision||{w:1,h:1},C=[],B=[],P=[],F=[];let f,d,I,y;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,s.w=s.w<1?1:s.w,s.h=s.h<1?1:s.h;const h=(L-U)/u.w,V=(D-g)/u.h;function e(E,U,g,L){const D=B.length/3,S=s.w+1;for(f=0;f<s.h;f++)for(d=0;d<s.w;d++){const E=[D+d+f*S,D+(d+1)+f*S,D+(d+1)+(f+1)*S,D+d+(f+1)*S];C.push(E[1]),C.push(E[2]),C.push(E[3]),C.push(E[0]),C.push(E[1]),C.push(E[3])}const u=N.dU.Zero(),I=new N.dU(0,1,0);for(f=0;f<=s.h;f++)for(u.z=f*(L-U)/s.h+U,d=0;d<=s.w;d++)u.x=d*(g-E)/s.w+E,u.y=0,B.push(u.x,u.y,u.z),P.push(I.x,I.y,I.z),F.push(d/s.w,f/s.h)}for(I=0;I<u.h;I++)for(y=0;y<u.w;y++)e(U+y*h,g+I*V,U+(y+1)*h,g+(I+1)*V);const x=new S.e;return x.indices=C,x.bE=B,x.TE=P,x.oE=F,x}function I(E){const U=[],g=[],D=[],u=[];let s,C;const B=E.colorFilter||new L.VU(.3,.59,.11),F=E.alphaFilter||0;let f=!1;if(E.minHeight>E.maxHeight){f=!0;const U=E.maxHeight;E.maxHeight=E.minHeight,E.minHeight=U}for(s=0;s<=E.subdivisions;s++)for(C=0;C<=E.subdivisions;C++){const U=new N.dU(C*E.width/E.subdivisions-E.width/2,0,(E.subdivisions-s)*E.height/E.subdivisions-E.height/2),L=4*(((U.x+E.width/2)/E.width*(E.bufferWidth-1)|0)+((1-(U.z+E.height/2)/E.height)*(E.bufferHeight-1)|0)*E.bufferWidth);let S=E.buffer[L]/255,d=E.buffer[L+1]/255,I=E.buffer[L+2]/255;const y=E.buffer[L+3]/255;f&&(S=1-S,d=1-d,I=1-I);const h=S*B.r+d*B.g+I*B.b;U.y=y>=F?E.minHeight+(E.maxHeight-E.minHeight)*h:E.minHeight-P.c,E.heightBuffer&&(E.heightBuffer[s*(E.subdivisions+1)+C]=U.y),g.push(U.x,U.y,U.z),D.push(0,0,0),u.push(C/E.subdivisions,1-s/E.subdivisions)}for(s=0;s<E.subdivisions;s++)for(C=0;C<E.subdivisions;C++){const N=C+1+(s+1)*(E.subdivisions+1),L=C+1+s*(E.subdivisions+1),D=C+s*(E.subdivisions+1),S=C+(s+1)*(E.subdivisions+1),u=g[3*N+1]>=E.minHeight,B=g[3*L+1]>=E.minHeight,P=g[3*D+1]>=E.minHeight;u&&B&&P&&(U.push(N),U.push(L),U.push(D));g[3*S+1]>=E.minHeight&&u&&P&&(U.push(S),U.push(N),U.push(D))}S.e.ComputeNormals(g,U,D);const d=new S.e;return d.indices=U,d.bE=g,d.TE=D,d.oE=u,d}function y(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const g=new s(E,arguments.length>2?arguments[2]:void 0);g._setReady(!1),g._subdivisionsX=U.subdivisionsX||U.subdivisions||1,g._subdivisionsY=U.subdivisionsY||U.subdivisions||1,g._width=U.width||1,g._height=U.height||1,g._maxX=g._width/2,g._maxZ=g._height/2,g._minX=-g._maxX,g._minZ=-g._maxZ;return f(U).rE(g,U.updatable),g._setReady(!0),g}function h(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new D.e(E,g);return d(U).rE(N,U.updatable),N}function V(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const D=g.width||10,S=g.height||10,u=g.subdivisions||1,P=g.minHeight||0,F=g.maxHeight||1,f=g.colorFilter||new L.VU(.3,.59,.11),d=g.alphaFilter||0,y=g.updatable,h=g.onReady;N=N||B.b.LastCreatedScene;const V=new s(E,N);let e;V._subdivisionsX=u,V._subdivisionsY=u,V._width=D,V._height=S,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ,V._setReady(!1),g.passHeightBufferInCallback&&(e=new Float32Array((u+1)*(u+1)));const x=(E,U,g)=>{I({width:D,height:S,subdivisions:u,minHeight:P,maxHeight:F,colorFilter:f,buffer:E,bufferWidth:U,bufferHeight:g,alphaFilter:d,heightBuffer:e}).rE(V,y),h&&h(V,e),V._setReady(!0)};if("string"===typeof U){const E=E=>{var U;const g=E.width,L=E.height;if(N.C)return;const D=null===(U=N)||void 0===U?void 0:U.getEngine().resizeImageBitmap(E,g,L);x(D,g,L)};C.Tools.LoadImage(U,E,g.onError?g.onError:()=>{},N.offlineProvider)}else x(U.data,U.width,U.height);return V}S.e.CreateGround=f,S.e.CreateTiledGround=d,S.e.CreateGroundFromHeightMap=I,D.e.CreateGround=(E,U,g,N,L,D)=>y(E,{width:U,height:g,subdivisions:N,updatable:D},L),D.e.CreateTiledGround=(E,U,g,N,L,D,S,u,s)=>h(E,{xmin:U,zmin:g,xmax:N,zmax:L,subdivisions:D,precision:S,updatable:s},u),D.e.CreateGroundFromHeightMap=(E,U,g,N,L,D,S,u,s,C,B)=>V(E,U,{width:g,height:N,subdivisions:L,minHeight:D,maxHeight:S,updatable:s,onReady:C,alphaFilter:B},u)},14246:(E,U,g)=>{"use strict";g.d(U,{e:()=>f,f:()=>P,h:()=>F});var N=g(12334),L=g(12774),D=g(12764),S=g(12877),u=g(12407),s=g(12186);function C(E){const U=[],g=[],N=E.lines,L=E.vE,S=[];let u=0;for(let D=0;D<N.length;D++){const E=N[D];for(let N=0;N<E.length;N++){const{x:s,y:C,z:B}=E[N];if(g.push(s,C,B),L){const E=L[D],{r:U,g:g,b:u,a:s}=E[N];S.push(U,g,u,s)}N>0&&(U.push(u-1),U.push(u)),u++}}const s=new D.e;return s.indices=U,s.bE=g,L&&(s.vE=S),s}function B(E){const U=E.dashSize||3,g=E.gapSize||1,L=E.dashNb||200,S=E.points,u=[],s=[],C=N.dU.Zero();let B=0,P=0,F=0,f=0,d=0,I=0,y=0;for(y=0;y<S.length-1;y++)S[y+1].subtractToRef(S[y],C),B+=C.length();for(F=B/L,f=U*F/(U+g),y=0;y<S.length-1;y++){S[y+1].subtractToRef(S[y],C),P=Math.floor(C.length()/F),C.normalize();for(let E=0;E<P;E++)d=F*E,u.push(S[y].x+d*C.x,S[y].y+d*C.y,S[y].z+d*C.z),u.push(S[y].x+(d+f)*C.x,S[y].y+(d+f)*C.y,S[y].z+(d+f)*C.z),s.push(I,I+1),I+=2}const h=new D.e;return h.bE=u,h.indices=s,h}function P(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=U.instance,L=U.lines,D=U.vE;if(N){const E=N.getVerticesData(u.f.PositionKind);let U,g;D&&(U=N.getVerticesData(u.f.ColorKind));let S=0,s=0;for(let N=0;N<L.length;N++){const u=L[N];for(let L=0;L<u.length;L++)E[S]=u[L].x,E[S+1]=u[L].y,E[S+2]=u[L].z,D&&U&&(g=D[N],U[s]=g[L].r,U[s+1]=g[L].g,U[s+2]=g[L].b,U[s+3]=g[L].a,s+=4),S+=3}return N.updateVerticesData(u.f.PositionKind,E,!1,!1),D&&U&&N.updateVerticesData(u.f.ColorKind,U,!1,!1),N.refreshBoundingInfo(),N}const s=!!D,B=new S.e(E,g,null,void 0,void 0,s,U.useVertexAlpha,U.material);return C(U).rE(B,U.updatable),B}function F(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=U.vE?[U.vE]:null;return P(E,{lines:[U.points],updatable:U.updatable,instance:U.instance,vE:N,useVertexAlpha:U.useVertexAlpha,material:U.material},g)}function f(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=U.points,u=U.instance,C=U.gapSize||1,P=U.dashSize||3;if(u){const E=E=>{const U=N.dU.Zero(),g=E.length/6;let L=0,S=0,s=0,C=0,B=0,P=0,F=0,f=0;for(F=0;F<D.length-1;F++)D[F+1].subtractToRef(D[F],U),L+=U.length();s=L/g;const d=u._creationDataStorage.dashSize;for(C=d*s/(d+u._creationDataStorage.gapSize),F=0;F<D.length-1;F++)for(D[F+1].subtractToRef(D[F],U),S=Math.floor(U.length()/s),U.normalize(),f=0;f<S&&P<E.length;)B=s*f,E[P]=D[F].x+B*U.x,E[P+1]=D[F].y+B*U.y,E[P+2]=D[F].z+B*U.z,E[P+3]=D[F].x+(B+C)*U.x,E[P+4]=D[F].y+(B+C)*U.y,E[P+5]=D[F].z+(B+C)*U.z,P+=6,f++;for(;P<E.length;)E[P]=D[F].x,E[P+1]=D[F].y,E[P+2]=D[F].z,P+=3};return(U.dashNb||U.dashSize||U.gapSize||U.useVertexAlpha||U.material)&&s.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),u.updateMeshPositions(E,!1),u}const F=new S.e(E,g,null,void 0,void 0,void 0,U.useVertexAlpha,U.material);return B(U).rE(F,U.updatable),F._creationDataStorage=new L.g,F._creationDataStorage.dashSize=P,F._creationDataStorage.gapSize=C,F}D.e.CreateLineSystem=C,D.e.CreateDashedLines=B,L.e.fC=function(E,U){return F(E,{points:U,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},L.e.CreateDashedLines=function(E,U,g,N,L){return f(E,{points:U,dashSize:g,gapSize:N,dashNb:L,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13616:(E,U,g)=>{"use strict";g.d(U,{d:()=>u,f:()=>s});var N=g(12774),L=g(12764),D=g(12390);function S(E){const U=[],g=[],N=[],S=[],u=void 0!==E.width?E.width:void 0!==E.size?E.size:1,s=void 0!==E.height?E.height:void 0!==E.size?E.size:1,C=0===E.sideOrientation?0:E.sideOrientation||L.e.DEFAULTSIDE,B=u/2,P=s/2;g.push(-B,-P,0),N.push(0,0,-1),S.push(0,D.b?1:0),g.push(B,-P,0),N.push(0,0,-1),S.push(1,D.b?1:0),g.push(B,P,0),N.push(0,0,-1),S.push(1,D.b?0:1),g.push(-B,P,0),N.push(0,0,-1),S.push(0,D.b?0:1),U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),L.e._ComputeSides(C,g,U,N,S,E.frontUVs,E.backUVs);const F=new L.e;return F.indices=U,F.bE=g,F.TE=N,F.oE=S,F}function u(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new N.e(E,g);U.sideOrientation=N.e._GetDefaultSideOrientation(U.sideOrientation),L._originalBuilderSideOrientation=U.sideOrientation;return S(U).rE(L,U.updatable),U.sourcePlane&&(L.translate(U.sourcePlane.normal,-U.sourcePlane.d),L.setDirection(U.sourcePlane.normal.scale(-1))),L}const s={yC:u};L.e.yC=S,N.e.yC=(E,U,g,N,L)=>u(E,{size:U,width:U,height:U,sideOrientation:L,updatable:N},g)},13703:(E,U,g)=>{"use strict";g.d(U,{d:()=>s});var N=g(12334),L=g(12774),D=g(12764),S=g(12390);function u(E){const U=0|(E.segments||32),g=E.diameterX||E.diameter||1,L=E.diameterY||E.diameter||1,u=E.diameterZ||E.diameter||1,s=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,C=E.slice&&E.slice<=0?1:E.slice||1,B=0===E.sideOrientation?0:E.sideOrientation||D.e.DEFAULTSIDE,P=!!E.dedupTopBottomIndices,F=new N.dU(g/2,L/2,u/2),f=2+U,d=2*f,I=[],y=[],h=[],V=[];for(let D=0;D<=f;D++){const E=D/f,U=E*Math.PI*C;for(let g=0;g<=d;g++){const L=g/d,D=L*Math.PI*2*s,u=N.Matrix.RotationZ(-U),C=N.Matrix.RotationY(D),B=N.dU.TransformCoordinates(N.dU.Up(),u),P=N.dU.TransformCoordinates(B,C),f=P.multiply(F),I=P.divide(F).normalize();y.push(f.x,f.y,f.z),h.push(I.x,I.y,I.z),V.push(L,S.b?1-E:E)}if(D>0){const E=y.length/3;for(let U=E-2*(d+1);U+d+2<E;U++)P?(D>1&&(I.push(U),I.push(U+1),I.push(U+d+1)),(D<f||C<1)&&(I.push(U+d+1),I.push(U+1),I.push(U+d+2))):(I.push(U),I.push(U+1),I.push(U+d+1),I.push(U+d+1),I.push(U+1),I.push(U+d+2))}}D.e._ComputeSides(B,y,I,h,V,E.frontUVs,E.backUVs);const e=new D.e;return e.indices=I,e.bE=y,e.TE=h,e.oE=V,e}function s(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return u(U).rE(N,U.updatable),N}D.e.CreateSphere=u,L.e.CreateSphere=(E,U,g,N,L,D)=>s(E,{segments:U,diameterX:g,diameterY:g,diameterZ:g,sideOrientation:D,updatable:L},N)},14586:(E,U,g)=>{"use strict";g.d(U,{d:()=>u});var N=g(12889),L=g(14027),D=g(12907),S=g(12764);class u{static get Configuration(){return{get decoder(){return L.d.DefaultConfiguration},set decoder(E){L.d.DefaultConfiguration=E}}}static set Configuration(E){L.d.DefaultConfiguration=E.decoder}static get DecoderAvailable(){return(0,N.f)(L.d.DefaultConfiguration)}static get Default(){return u._Default??(u._Default=new u),u._Default}static ResetDefault(E){u._Default&&(E||u._Default.dispose(),u._Default=null)}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.DefaultNumWorkers;const U="number"===typeof E?{...L.d.DefaultConfiguration,numWorkers:E}:{...L.d.DefaultConfiguration,...E};this._decoder=new L.d(U)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(E,U,g){return this._decoder.decodeMeshToMeshDataAsync(E,U,g)}async decodeMeshToGeometryAsync(E,U,g,N){return await this._decoder.decodeMeshToGeometryAsync(E,U,g,N)}async _decodeMeshToGeometryForGltfAsync(E,U,g,N,L,D){return await this._decoder._decodeMeshToGeometryForGltfAsync(E,U,g,N,L,D)}async decodeMeshAsync(E,U){const g=await this._decoder.decodeMeshToMeshDataAsync(E,U),N=new S.e;g.indices&&(N.indices=g.indices);for(const L of g.attributes){const E=D.e.GetFloatData(L.data,L.size,D.e.GetDataType(L.data),L.byteOffset,L.byteStride,L.normalized,g.totalVertices);N.set(E,L.kind)}return N}}u.DefaultNumWorkers=(0,N.c)(),u._Default=null},14027:(E,U,g)=>{"use strict";g.d(U,{d:()=>C});var N=g(12889),L=g(12165),D=g(12790),S=g(12907),u=g(12186),s=g(12905);class C extends N.b{static get DefaultAvailable(){return(0,N.f)(C.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(E){C._Default&&(E||C._Default.dispose(),C._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(E,U){return{module:await(U||DracoDecoderModule)({wasmBinary:E})}}_getWorkerContent(){return`${s.b}(${s.c})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultConfiguration)}decodeMeshToMeshDataAsync(E,U,g){const N=E instanceof ArrayBuffer?new Int8Array(E):new Int8Array(E.buffer,E.byteOffset,E.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async E=>await new Promise(((L,D)=>{E.push(((E,S)=>{let s=null;const C=[],B=U=>{E.removeEventListener("error",B),E.removeEventListener("message",P),D(U),S()},P=U=>{const N=U.data;switch(N.id){case"indices":s=N.data;break;case"attribute":C.push({kind:N.kind,data:N.data,size:N.size,byteOffset:N.byteOffset,byteStride:N.byteStride,normalized:(D=N.kind,F=N.normalized,g&&void 0!==g[D]?(F!==g[D]&&u.d.Warn(`Normalized flag from Draco data (${F}) does not match normalized flag from glTF accessor (${g[D]}). Using flag from glTF accessor.`),g[D]):F)});break;case"decodeMeshDone":E.removeEventListener("error",B),E.removeEventListener("message",P),L({indices:s,attributes:C,totalVertices:N.totalVertices}),S()}var D,F};E.addEventListener("error",B),E.addEventListener("message",P);const F=N.slice();E.postMessage({id:"decodeMesh",dataView:F,attributes:U},[F.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((E=>{let g=null;const L=[],D=(0,s.b)(E.module,N,U,(E=>{g=E}),((E,U,g,N,D,S)=>{L.push({kind:E,data:U,size:g,byteOffset:N,byteStride:D,normalized:S})}));return{indices:g,attributes:L,totalVertices:D}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(E,U,g,N){const L=await this.decodeMeshToMeshDataAsync(g,N),u=new D.e(E,U);L.indices&&u.setIndices(L.indices);for(const D of L.attributes)u.setVerticesBuffer(new S.e(U.getEngine(),D.data,D.kind,!1,void 0,D.byteStride,void 0,D.byteOffset,D.size,void 0,D.normalized,!0),L.totalVertices);return u}async _decodeMeshToGeometryForGltfAsync(E,U,g,N,L,u){const s=await this.decodeMeshToMeshDataAsync(g,N,L),C=new D.e(E,U);u&&(C._boundingInfo=u,C.useBoundingInfoFromGeometry=!0),s.indices&&C.setIndices(s.indices);for(const D of s.attributes)C.setVerticesBuffer(new S.e(U.getEngine(),D.data,D.kind,!1,void 0,D.byteStride,void 0,D.byteOffset,D.size,void 0,D.normalized,!0),s.totalVertices);return C}}C.DefaultConfiguration={wasmUrl:`${L.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${L.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${L.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},C._Default=null},14242:(E,U,g)=>{"use strict";g.d(U,{d:()=>uE});var N=g(12334),L=g(12774),D=g(12407),S=g(12764),u=g(12390);function s(E){let U=E.pathArray;const g=E.closeArray||!1,N=E.closePath||!1,L=E.invertUV||!1,s=Math.floor(U[0].length/2);let C=E.offset||s;C=C>s?s:Math.floor(C);const B=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,P=E.oE,F=E.vE,f=[],d=[],I=[],y=[],h=[],V=[],e=[],x=[];let l;const Y=[],t=[];let G,b,T;if(U.length<2){const E=[],g=[];for(b=0;b<U[0].length-C;b++)E.push(U[0][b]),g.push(U[0][b+C]);U=[E,g]}let v=0;const o=N?1:0,c=g?1:0;let r,j,Z,A,w,a;for(l=U[0].length,G=0;G<U.length+c;G++){for(e[G]=0,h[G]=[0],r=G===U.length?U[0]:U[G],j=r.length,l=l<j?l:j,T=0;T<j;)f.push(r[T].x,r[T].y,r[T].z),T>0&&(Z=r[T].IU(r[T-1]).length(),A=Z+e[G],h[G].push(A),e[G]=A),T++;N&&(T--,f.push(r[0].x,r[0].y,r[0].z),Z=r[T].IU(r[0]).length(),A=Z+e[G],h[G].push(A),e[G]=A),Y[G]=j+o,t[G]=v,v+=j+o}let J,q,M=null,mE=null;for(b=0;b<l+o;b++)for(x[b]=0,V[b]=[0],G=0;G<U.length-1+c;G++)w=U[G],a=G===U.length-1?U[0]:U[G+1],b===l?(M=w[0],mE=a[0]):(M=w[b],mE=a[b]),Z=mE.IU(M).length(),A=Z+x[b],V[b].push(A),x[b]=A;if(P)for(G=0;G<P.length;G++)y.push(P[G].x,u.b?1-P[G].y:P[G].y);else for(G=0;G<U.length+c;G++)for(b=0;b<l+o;b++)J=0!=e[G]?h[G][b]/e[G]:0,q=0!=x[b]?V[b][G]/x[b]:0,L?y.push(q,J):y.push(J,u.b?1-q:q);G=0;let W=0,O=Y[G]-1,Q=Y[G+1]-1,R=O<Q?O:Q,n=t[1]-t[0];const k=Y.length-1;for(;W<=R&&G<k;)d.push(W,W+n,W+1),d.push(W+n+1,W+1,W+n),W+=1,W===R&&(G++,n=t[G+1]-t[G],O=Y[G]-1,Q=Y[G+1]-1,W=t[G],R=O<Q?O+W:Q+W);if(S.e.ComputeNormals(f,d,I),N){let E=0,g=0;for(G=0;G<U.length;G++){E=3*t[G],g=G+1<U.length?3*(t[G+1]-1):I.length-3,I[E]=.5*(I[E]+I[g]),I[E+1]=.5*(I[E+1]+I[g+1]),I[E+2]=.5*(I[E+2]+I[g+2]);const N=Math.sqrt(I[E]*I[E]+I[E+1]*I[E+1]+I[E+2]*I[E+2]);I[E]/=N,I[E+1]/=N,I[E+2]/=N,I[g]=I[E],I[g+1]=I[E+1],I[g+2]=I[E+2]}}if(g){let E=3*t[0],g=3*t[U.length];for(b=0;b<l+o;b++){I[E]=.5*(I[E]+I[g]),I[E+1]=.5*(I[E+1]+I[g+1]),I[E+2]=.5*(I[E+2]+I[g+2]);const U=Math.sqrt(I[E]*I[E]+I[E+1]*I[E+1]+I[E+2]*I[E+2]);I[E]/=U,I[E+1]/=U,I[E+2]/=U,I[g]=I[E],I[g+1]=I[E+1],I[g+2]=I[E+2],E+=3,g+=3}}S.e._ComputeSides(B,f,d,I,y,E.frontUVs,E.backUVs);let z=null;if(F){z=new Float32Array(4*F.length);for(let E=0;E<F.length;E++)z[4*E]=F[E].r,z[4*E+1]=F[E].g,z[4*E+2]=F[E].b,z[4*E+3]=F[E].a}const i=new S.e,p=new Float32Array(f),H=new Float32Array(I),K=new Float32Array(y);return i.indices=d,i.bE=p,i.TE=H,i.oE=K,z&&i.set(z,D.f.ColorKind),N&&(i._idx=t),i}function C(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=U.pathArray,B=U.closeArray,P=U.closePath,F=L.e._GetDefaultSideOrientation(U.sideOrientation),f=U.instance,d=U.updatable;if(f){const E=N.TmpVectors.dU[0].yu(Number.MAX_VALUE),g=N.TmpVectors.dU[1].yu(-Number.MAX_VALUE),s=U=>{let N=C[0].length;const D=f;let S=0;const u=D._originalBuilderSideOrientation===L.e.DOUBLESIDE?2:1;for(let L=1;L<=u;++L)for(let u=0;u<C.length;++u){const L=C[u],s=L.length;N=N<s?N:s;for(let D=0;D<N;++D){const N=L[D];U[S]=N.x,U[S+1]=N.y,U[S+2]=N.z,E.minimizeInPlaceFromFloats(N.x,N.y,N.z),g.maximizeInPlaceFromFloats(N.x,N.y,N.z),S+=3}if(D._creationDataStorage&&D._creationDataStorage.closePath){const E=L[0];U[S]=E.x,U[S+1]=E.y,U[S+2]=E.z,S+=3}}},B=f.getVerticesData(D.f.PositionKind);if(s(B),f.hasBoundingInfo?f.getBoundingInfo().reConstruct(E,g,f._worldMatrix):f.buildBoundingInfo(E,g,f._worldMatrix),f.updateVerticesData(D.f.PositionKind,B,!1,!1),U.vE){const E=f.getVerticesData(D.f.ColorKind);for(let g=0,N=0;g<U.vE.length;g++,N+=4){const L=U.vE[g];E[N]=L.r,E[N+1]=L.g,E[N+2]=L.b,E[N+3]=L.a}f.updateVerticesData(D.f.ColorKind,E,!1,!1)}if(U.oE){const E=f.getVerticesData(D.f.UVKind);for(let g=0;g<U.oE.length;g++)E[2*g]=U.oE[g].x,E[2*g+1]=u.b?1-U.oE[g].y:U.oE[g].y;f.updateVerticesData(D.f.UVKind,E,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){const E=f.CD(),U=f.getVerticesData(D.f.NormalKind),g=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(S.e.ComputeNormals(B,E,U,g),f._creationDataStorage&&f._creationDataStorage.closePath){let E=0,g=0;for(let N=0;N<C.length;N++)E=3*f._creationDataStorage.idx[N],g=N+1<C.length?3*(f._creationDataStorage.idx[N+1]-1):U.length-3,U[E]=.5*(U[E]+U[g]),U[E+1]=.5*(U[E+1]+U[g+1]),U[E+2]=.5*(U[E+2]+U[g+2]),U[g]=U[E],U[g+1]=U[E+1],U[g+2]=U[E+2]}f.areNormalsFrozen||f.updateVerticesData(D.f.NormalKind,U,!1,!1)}return f}{const N=new L.e(E,g);N._originalBuilderSideOrientation=F,N._creationDataStorage=new L.g;const D=s(U);return P&&(N._creationDataStorage.idx=D._idx),N._creationDataStorage.closePath=P,N._creationDataStorage.closeArray=B,D.rE(N,d),N}}S.e.CreateRibbon=s,L.e.CreateRibbon=function(E,U){return C(E,{pathArray:U,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var B=g(13710),P=g(13570),F=g(12379);function f(E){const U=E.pattern||L.e.NO_FLIP,g=E.tileWidth||E.tileSize||1,N=E.tileHeight||E.tileSize||1,D=E.alignHorizontal||0,u=E.alignVertical||0,s=E.width||E.size||1,C=Math.floor(s/g);let B=s-C*g;const P=E.height||E.size||1,F=Math.floor(P/N);let f=P-F*N;const d=g*C/2,I=N*F/2;let y=0,h=0,V=0,e=0,x=0,l=0;if(B>0||f>0){switch(V=-d,e=-I,x=d,l=I,D){case L.e.CENTER:B/=2,V-=B,x+=B;break;case L.e.LEFT:x+=B,y=-B/2;break;case L.e.RIGHT:V-=B,y=B/2}switch(u){case L.e.CENTER:f/=2,e-=f,l+=f;break;case L.e.BOTTOM:l+=f,h=-f/2;break;case L.e.TOP:e-=f,h=f/2}}const Y=[],t=[],G=[];G[0]=[0,0,1,0,1,1,0,1],G[1]=[0,0,1,0,1,1,0,1],U!==L.e.ROTATE_TILE&&U!==L.e.ROTATE_ROW||(G[1]=[1,1,0,1,0,0,1,0]),U!==L.e.FLIP_TILE&&U!==L.e.FLIP_ROW||(G[1]=[1,0,0,0,0,1,1,1]),U!==L.e.FLIP_N_ROTATE_TILE&&U!==L.e.FLIP_N_ROTATE_ROW||(G[1]=[0,1,1,1,1,0,0,0]);let b=[];const T=[],v=[];let o=0;for(let S=0;S<F;S++)for(let E=0;E<C;E++)Y.push(E*g-d+y,S*N-I+h,0),Y.push((E+1)*g-d+y,S*N-I+h,0),Y.push((E+1)*g-d+y,(S+1)*N-I+h,0),Y.push(E*g-d+y,(S+1)*N-I+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),b=U===L.e.FLIP_TILE||U===L.e.ROTATE_TILE||U===L.e.FLIP_N_ROTATE_TILE?b.concat(G[(E%2+S%2)%2]):U===L.e.FLIP_ROW||U===L.e.ROTATE_ROW||U===L.e.FLIP_N_ROTATE_ROW?b.concat(G[S%2]):b.concat(G[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),o+=4;if(B>0||f>0){const E=f>0&&(u===L.e.CENTER||u===L.e.TOP),S=f>0&&(u===L.e.CENTER||u===L.e.BOTTOM),s=B>0&&(D===L.e.CENTER||D===L.e.RIGHT),P=B>0&&(D===L.e.CENTER||D===L.e.LEFT);let G,c,r,j,Z=[];if(E&&s&&(Y.push(V+y,e+h,0),Y.push(-d+y,e+h,0),Y.push(-d+y,e+f+h,0),Y.push(V+y,e+f+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,G=1-B/g,c=1-f/N,r=1,j=1,Z=[G,c,r,c,r,j,G,j],U===L.e.ROTATE_ROW&&(Z=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),U===L.e.FLIP_ROW&&(Z=[1-G,c,1-r,c,1-r,j,1-G,j]),U===L.e.FLIP_N_ROTATE_ROW&&(Z=[G,1-c,r,1-c,r,1-j,G,1-j]),b=b.concat(Z),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E&&P&&(Y.push(d+y,e+h,0),Y.push(x+y,e+h,0),Y.push(x+y,e+f+h,0),Y.push(d+y,e+f+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,G=0,c=1-f/N,r=B/g,j=1,Z=[G,c,r,c,r,j,G,j],(U===L.e.ROTATE_ROW||U===L.e.ROTATE_TILE&&C%2===0)&&(Z=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),(U===L.e.FLIP_ROW||U===L.e.FLIP_TILE&&C%2===0)&&(Z=[1-G,c,1-r,c,1-r,j,1-G,j]),(U===L.e.FLIP_N_ROTATE_ROW||U===L.e.FLIP_N_ROTATE_TILE&&C%2===0)&&(Z=[G,1-c,r,1-c,r,1-j,G,1-j]),b=b.concat(Z),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&s&&(Y.push(V+y,I+h,0),Y.push(-d+y,I+h,0),Y.push(-d+y,l+h,0),Y.push(V+y,l+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,G=1-B/g,c=0,r=1,j=f/N,Z=[G,c,r,c,r,j,G,j],(U===L.e.ROTATE_ROW&&F%2===1||U===L.e.ROTATE_TILE&&F%1===0)&&(Z=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),(U===L.e.FLIP_ROW&&F%2===1||U===L.e.FLIP_TILE&&F%2===0)&&(Z=[1-G,c,1-r,c,1-r,j,1-G,j]),(U===L.e.FLIP_N_ROTATE_ROW&&F%2===1||U===L.e.FLIP_N_ROTATE_TILE&&F%2===0)&&(Z=[G,1-c,r,1-c,r,1-j,G,1-j]),b=b.concat(Z),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&P&&(Y.push(d+y,I+h,0),Y.push(x+y,I+h,0),Y.push(x+y,l+h,0),Y.push(d+y,l+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,G=0,c=0,r=B/g,j=f/N,Z=[G,c,r,c,r,j,G,j],(U===L.e.ROTATE_ROW&&F%2===1||U===L.e.ROTATE_TILE&&(F+C)%2===1)&&(Z=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),(U===L.e.FLIP_ROW&&F%2===1||U===L.e.FLIP_TILE&&(F+C)%2===1)&&(Z=[1-G,c,1-r,c,1-r,j,1-G,j]),(U===L.e.FLIP_N_ROTATE_ROW&&F%2===1||U===L.e.FLIP_N_ROTATE_TILE&&(F+C)%2===1)&&(Z=[G,1-c,r,1-c,r,1-j,G,1-j]),b=b.concat(Z),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E){const E=[];G=0,c=1-f/N,r=1,j=1,E[0]=[G,c,r,c,r,j,G,j],E[1]=[G,c,r,c,r,j,G,j],U!==L.e.ROTATE_TILE&&U!==L.e.ROTATE_ROW||(E[1]=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),U!==L.e.FLIP_TILE&&U!==L.e.FLIP_ROW||(E[1]=[1-G,c,1-r,c,1-r,j,1-G,j]),U!==L.e.FLIP_N_ROTATE_TILE&&U!==L.e.FLIP_N_ROTATE_ROW||(E[1]=[G,1-c,r,1-c,r,1-j,G,1-j]);for(let N=0;N<C;N++)Y.push(N*g-d+y,e+h,0),Y.push((N+1)*g-d+y,e+h,0),Y.push((N+1)*g-d+y,e+f+h,0),Y.push(N*g-d+y,e+f+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,b=U===L.e.FLIP_TILE||U===L.e.ROTATE_TILE||U===L.e.FLIP_N_ROTATE_TILE?b.concat(E[(N+1)%2]):U===L.e.FLIP_ROW||U===L.e.ROTATE_ROW||U===L.e.FLIP_N_ROTATE_ROW?b.concat(E[1]):b.concat(E[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const E=[];G=0,c=0,r=1,j=f/N,E[0]=[G,c,r,c,r,j,G,j],E[1]=[G,c,r,c,r,j,G,j],U!==L.e.ROTATE_TILE&&U!==L.e.ROTATE_ROW||(E[1]=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),U!==L.e.FLIP_TILE&&U!==L.e.FLIP_ROW||(E[1]=[1-G,c,1-r,c,1-r,j,1-G,j]),U!==L.e.FLIP_N_ROTATE_TILE&&U!==L.e.FLIP_N_ROTATE_ROW||(E[1]=[G,1-c,r,1-c,r,1-j,G,1-j]);for(let N=0;N<C;N++)Y.push(N*g-d+y,l-f+h,0),Y.push((N+1)*g-d+y,l-f+h,0),Y.push((N+1)*g-d+y,l+h,0),Y.push(N*g-d+y,l+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,b=U===L.e.FLIP_TILE||U===L.e.ROTATE_TILE||U===L.e.FLIP_N_ROTATE_TILE?b.concat(E[(N+F)%2]):U===L.e.FLIP_ROW||U===L.e.ROTATE_ROW||U===L.e.FLIP_N_ROTATE_ROW?b.concat(E[F%2]):b.concat(E[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(s){const E=[];G=1-B/g,c=0,r=1,j=1,E[0]=[G,c,r,c,r,j,G,j],E[1]=[G,c,r,c,r,j,G,j],U!==L.e.ROTATE_TILE&&U!==L.e.ROTATE_ROW||(E[1]=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),U!==L.e.FLIP_TILE&&U!==L.e.FLIP_ROW||(E[1]=[1-G,c,1-r,c,1-r,j,1-G,j]),U!==L.e.FLIP_N_ROTATE_TILE&&U!==L.e.FLIP_N_ROTATE_ROW||(E[1]=[G,1-c,r,1-c,r,1-j,G,1-j]);for(let g=0;g<F;g++)Y.push(V+y,g*N-I+h,0),Y.push(V+B+y,g*N-I+h,0),Y.push(V+B+y,(g+1)*N-I+h,0),Y.push(V+y,(g+1)*N-I+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,b=U===L.e.FLIP_TILE||U===L.e.ROTATE_TILE||U===L.e.FLIP_N_ROTATE_TILE?b.concat(E[(g+1)%2]):U===L.e.FLIP_ROW||U===L.e.ROTATE_ROW||U===L.e.FLIP_N_ROTATE_ROW?b.concat(E[g%2]):b.concat(E[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const E=[];G=0,c=0,r=B/N,j=1,E[0]=[G,c,r,c,r,j,G,j],E[1]=[G,c,r,c,r,j,G,j],U!==L.e.ROTATE_TILE&&U!==L.e.ROTATE_ROW||(E[1]=[1-G,1-c,1-r,1-c,1-r,1-j,1-G,1-j]),U!==L.e.FLIP_TILE&&U!==L.e.FLIP_ROW||(E[1]=[1-G,c,1-r,c,1-r,j,1-G,j]),U!==L.e.FLIP_N_ROTATE_TILE&&U!==L.e.FLIP_N_ROTATE_ROW||(E[1]=[G,1-c,r,1-c,r,1-j,G,1-j]);for(let g=0;g<F;g++)Y.push(x-B+y,g*N-I+h,0),Y.push(x+y,g*N-I+h,0),Y.push(x+y,(g+1)*N-I+h,0),Y.push(x-B+y,(g+1)*N-I+h,0),v.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,b=U===L.e.FLIP_TILE||U===L.e.ROTATE_TILE||U===L.e.FLIP_N_ROTATE_TILE?b.concat(E[(g+C)%2]):U===L.e.FLIP_ROW||U===L.e.ROTATE_ROW||U===L.e.FLIP_N_ROTATE_ROW?b.concat(E[g%2]):b.concat(E[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE;S.e._ComputeSides(c,Y,v,t,b,E.frontUVs,E.backUVs);const r=new S.e;r.indices=v,r.bE=Y,r.TE=t,r.oE=b;const j=c===S.e.DOUBLESIDE?T.concat(T):T;return r.vE=j,r}function d(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return f(U).rE(N,U.updatable),N}function I(E){const U=E.faceUV||new Array(6),g=E.faceColors,D=E.pattern||L.e.NO_FLIP,s=E.width||E.size||1,C=E.height||E.size||1,B=E.depth||E.size||1,P=E.tileWidth||E.tileSize||1,d=E.tileHeight||E.tileSize||1,I=E.alignHorizontal||0,y=E.alignVertical||0,h=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE;for(let L=0;L<6;L++)void 0===U[L]&&(U[L]=new N.Vector4(0,0,1,1)),g&&void 0===g[L]&&(g[L]=new F.hu(1,1,1,1));const V=s/2,e=C/2,x=B/2,l=[];for(let N=0;N<2;N++)l[N]=f({pattern:D,tileWidth:P,tileHeight:d,width:s,height:C,alignVertical:y,alignHorizontal:I,sideOrientation:h});for(let N=2;N<4;N++)l[N]=f({pattern:D,tileWidth:P,tileHeight:d,width:B,height:C,alignVertical:y,alignHorizontal:I,sideOrientation:h});let Y=y;y===L.e.BOTTOM?Y=L.e.TOP:y===L.e.TOP&&(Y=L.e.BOTTOM);for(let N=4;N<6;N++)l[N]=f({pattern:D,tileWidth:P,tileHeight:d,width:s,height:B,alignVertical:Y,alignHorizontal:I,sideOrientation:h});let t=[],G=[],b=[],T=[];const v=[],o=[],c=[],r=[];let j=0,Z=0;for(let L=0;L<6;L++){const E=l[L].bE.length;o[L]=[],c[L]=[];for(let U=0;U<E/3;U++)o[L].push(new N.dU(l[L].bE[3*U],l[L].bE[3*U+1],l[L].bE[3*U+2])),c[L].push(new N.dU(l[L].TE[3*U],l[L].TE[3*U+1],l[L].TE[3*U+2]));j=l[L].oE.length,r[L]=[];for(let g=0;g<j;g+=2)r[L][g]=U[L].x+(U[L].z-U[L].x)*l[L].oE[g],r[L][g+1]=U[L].y+(U[L].w-U[L].y)*l[L].oE[g+1],u.b&&(r[L][g+1]=1-r[L][g+1]);if(b=b.concat(r[L]),T=T.concat(l[L].indices.map((E=>E+Z))),Z+=o[L].length,g)for(let U=0;U<4;U++)v.push(g[L].r,g[L].g,g[L].b,g[L].a)}const A=new N.dU(0,0,x),w=N.Matrix.RotationY(Math.PI);t=o[0].map((E=>N.dU.TransformNormal(E,w).add(A))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[]),G=c[0].map((E=>N.dU.TransformNormal(E,w))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[]),t=t.concat(o[1].map((E=>E.IU(A))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[])),G=G.concat(c[1].map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[]));const a=new N.dU(V,0,0),J=N.Matrix.RotationY(-Math.PI/2);t=t.concat(o[2].map((E=>N.dU.TransformNormal(E,J).add(a))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[])),G=G.concat(c[2].map((E=>N.dU.TransformNormal(E,J))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[]));const q=N.Matrix.RotationY(Math.PI/2);t=t.concat(o[3].map((E=>N.dU.TransformNormal(E,q).IU(a))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[])),G=G.concat(c[3].map((E=>N.dU.TransformNormal(E,q))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[]));const M=new N.dU(0,e,0),mE=N.Matrix.RotationX(Math.PI/2);t=t.concat(o[4].map((E=>N.dU.TransformNormal(E,mE).add(M))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[])),G=G.concat(c[4].map((E=>N.dU.TransformNormal(E,mE))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[]));const W=N.Matrix.RotationX(-Math.PI/2);t=t.concat(o[5].map((E=>N.dU.TransformNormal(E,W).IU(M))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[])),G=G.concat(c[5].map((E=>N.dU.TransformNormal(E,W))).map((E=>[E.x,E.y,E.z])).reduce(((E,U)=>E.concat(U)),[])),S.e._ComputeSides(h,t,T,G,b);const O=new S.e;if(O.indices=T,O.bE=t,O.TE=G,O.oE=b,g){const E=h===S.e.DOUBLESIDE?v.concat(v):v;O.vE=E}return O}function y(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return I(U).rE(N,U.updatable),N}S.e.CreateTiledPlane=f;S.e.CreateTiledBox=I;var h=g(13703),V=g(12573),e=g(12531);function x(E){const U=E.height||2;let g=0===E.diameterTop?0:E.diameterTop||E.diameter||1,D=0===E.diameterBottom?0:E.diameterBottom||E.diameter||1;g=g||1e-5,D=D||1e-5;const s=0|(E.tessellation||24),C=0|(E.subdivisions||1),B=!!E.hasRings,P=!!E.enclose,f=0===E.cap?0:E.cap||L.e.CAP_ALL,d=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,I=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,y=E.faceUV||new Array(3),h=E.faceColors,V=2+(1+(1!==d&&P?2:0))*(B?C:1);let x;for(x=0;x<V;x++)h&&void 0===h[x]&&(h[x]=new F.hu(1,1,1,1));for(x=0;x<V;x++)y&&void 0===y[x]&&(y[x]=new N.Vector4(0,0,1,1));const l=[],Y=[],t=[],G=[],b=[],T=2*Math.PI*d/s;let v,o,c;const r=(D-g)/2/U,j=N.dU.Zero(),Z=N.dU.Zero(),A=N.dU.Zero(),w=N.dU.Zero(),a=N.dU.Zero(),J=e.e.Y;let q,M,mE,W=1,O=1,Q=0,R=0;for(q=0;q<=C;q++)for(o=q/C,c=(o*(g-D)+D)/2,W=B&&0!==q&&q!==C?2:1,mE=0;mE<W;mE++){for(B&&(O+=mE),P&&(O+=2*mE),M=0;M<=s;M++)v=M*T,j.x=Math.cos(-v)*c,j.y=-U/2+o*U,j.z=Math.sin(-v)*c,0===g&&q===C?(Z.x=t[t.length-3*(s+1)],Z.y=t[t.length-3*(s+1)+1],Z.z=t[t.length-3*(s+1)+2]):(Z.x=j.x,Z.z=j.z,Z.y=Math.sqrt(Z.x*Z.x+Z.z*Z.z)*r,Z.normalize()),0===M&&(A.D(j),w.D(Z)),Y.push(j.x,j.y,j.z),t.push(Z.x,Z.y,Z.z),R=B?Q!==O?y[O].y:y[O].w:y[O].y+(y[O].w-y[O].y)*o,G.push(y[O].x+(y[O].z-y[O].x)*M/s,u.b?1-R:R),h&&b.push(h[O].r,h[O].g,h[O].b,h[O].a);1!==d&&P&&(Y.push(j.x,j.y,j.z),Y.push(0,j.y,0),Y.push(0,j.y,0),Y.push(A.x,A.y,A.z),N.dU.CrossToRef(J,Z,a),a.normalize(),t.push(a.x,a.y,a.z,a.x,a.y,a.z),N.dU.CrossToRef(w,J,a),a.normalize(),t.push(a.x,a.y,a.z,a.x,a.y,a.z),R=B?Q!==O?y[O+1].y:y[O+1].w:y[O+1].y+(y[O+1].w-y[O+1].y)*o,G.push(y[O+1].x,u.b?1-R:R),G.push(y[O+1].z,u.b?1-R:R),R=B?Q!==O?y[O+2].y:y[O+2].w:y[O+2].y+(y[O+2].w-y[O+2].y)*o,G.push(y[O+2].x,u.b?1-R:R),G.push(y[O+2].z,u.b?1-R:R),h&&(b.push(h[O+1].r,h[O+1].g,h[O+1].b,h[O+1].a),b.push(h[O+1].r,h[O+1].g,h[O+1].b,h[O+1].a),b.push(h[O+2].r,h[O+2].g,h[O+2].b,h[O+2].a),b.push(h[O+2].r,h[O+2].g,h[O+2].b,h[O+2].a))),Q!==O&&(Q=O)}const n=1!==d&&P?s+4:s;for(q=0,O=0;O<C;O++){let E=0,U=0,g=0,N=0;for(M=0;M<s;M++)E=q*(n+1)+M,U=(q+1)*(n+1)+M,g=q*(n+1)+(M+1),N=(q+1)*(n+1)+(M+1),l.push(E,U,g),l.push(N,g,U);1!==d&&P&&(l.push(E+2,U+2,g+2),l.push(N+2,g+2,U+2),l.push(E+4,U+4,g+4),l.push(N+4,g+4,U+4)),q=B?q+2:q+1}const k=E=>{const L=E?g/2:D/2;if(0===L)return;let S,C,B;const P=E?y[V-1]:y[0];let F=null;h&&(F=E?h[V-1]:h[0]);const f=Y.length/3,I=E?U/2:-U/2,e=new N.dU(0,I,0);Y.push(e.x,e.y,e.z),t.push(0,E?1:-1,0);const x=P.y+.5*(P.w-P.y);G.push(P.x+.5*(P.z-P.x),u.b?1-x:x),F&&b.push(F.r,F.g,F.b,F.a);const T=new N.Vector2(.5,.5);for(B=0;B<=s;B++){S=2*Math.PI*B*d/s;const U=Math.cos(-S),g=Math.sin(-S);C=new N.dU(U*L,I,g*L);const D=new N.Vector2(U*T.x+.5,g*T.y+.5);Y.push(C.x,C.y,C.z),t.push(0,E?1:-1,0);const f=P.y+(P.w-P.y)*D.y;G.push(P.x+(P.z-P.x)*D.x,u.b?1-f:f),F&&b.push(F.r,F.g,F.b,F.a)}for(B=0;B<s;B++)E?(l.push(f),l.push(f+(B+2)),l.push(f+(B+1))):(l.push(f),l.push(f+(B+1)),l.push(f+(B+2)))};f!==L.e.CAP_START&&f!==L.e.CAP_ALL||k(!1),f!==L.e.CAP_END&&f!==L.e.CAP_ALL||k(!0),S.e._ComputeSides(I,Y,l,t,G,E.frontUVs,E.backUVs);const z=new S.e;return z.indices=l,z.bE=Y,z.TE=t,z.oE=G,h&&(z.vE=b),z}function l(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return x(U).rE(N,U.updatable),N}function Y(E){const U=[],g=[],L=[],D=[],s=E.diameter||1,C=E.thickness||.5,B=0|(E.tessellation||16),P=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,F=B+1;for(let S=0;S<=B;S++){const E=S/B,P=S*Math.PI*2/B-Math.PI/2,f=N.Matrix.Translation(s/2,0,0).multiply(N.Matrix.RotationY(P));for(let s=0;s<=B;s++){const P=1-s/B,d=s*Math.PI*2/B+Math.PI,I=Math.cos(d),y=Math.sin(d);let h=new N.dU(I,y,0),V=h.scale(C/2);const e=new N.Vector2(E,P);V=N.dU.TransformCoordinates(V,f),h=N.dU.TransformNormal(h,f),g.push(V.x,V.y,V.z),L.push(h.x,h.y,h.z),D.push(e.x,u.b?1-e.y:e.y);const x=(S+1)%F,l=(s+1)%F;U.push(S*F+s),U.push(S*F+l),U.push(x*F+s),U.push(S*F+l),U.push(x*F+l),U.push(x*F+s)}}S.e._ComputeSides(P,g,U,L,D,E.frontUVs,E.backUVs);const f=new S.e;return f.indices=U,f.bE=g,f.TE=L,f.oE=D,f}function t(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return Y(U).rE(N,U.updatable),N}S.e.CreateCylinder=x,L.e.CreateCylinder=(E,U,g,N,D,S,u,s,C)=>{void 0!==u&&u instanceof V.c||(void 0!==u&&(C=s||L.e.DEFAULTSIDE,s=u),u=S,S=1);return l(E,{height:U,diameterTop:g,diameterBottom:N,tessellation:D,subdivisions:S,sideOrientation:C,updatable:s},u)};function G(E){const U=[],g=[],L=[],D=[],s=E.radius||2,C=E.tube||.5,B=E.radialSegments||32,P=E.tubularSegments||32,F=E.p||2,f=E.q||3,d=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,I=E=>{const U=Math.cos(E),g=Math.sin(E),L=f/F*E,D=Math.cos(L),S=s*(2+D)*.5*U,u=s*(2+D)*g*.5,C=s*Math.sin(L)*.5;return new N.dU(S,u,C)};let y,h;for(y=0;y<=B;y++){const E=y%B/B*2*F*Math.PI,U=I(E),L=I(E+.01),S=L.IU(U);let s=L.add(U);const f=N.dU.Cross(S,s);for(s=N.dU.Cross(f,S),f.normalize(),s.normalize(),h=0;h<P;h++){const E=h%P/P*2*Math.PI,N=-C*Math.cos(E),L=C*Math.sin(E);g.push(U.x+N*s.x+L*f.x),g.push(U.y+N*s.y+L*f.y),g.push(U.z+N*s.z+L*f.z),D.push(y/B),D.push(u.b?1-h/P:h/P)}}for(y=0;y<B;y++)for(h=0;h<P;h++){const E=(h+1)%P,g=y*P+h,N=(y+1)*P+h,L=(y+1)*P+E,D=y*P+E;U.push(D),U.push(N),U.push(g),U.push(D),U.push(L),U.push(N)}S.e.ComputeNormals(g,U,L),S.e._ComputeSides(d,g,U,L,D,E.frontUVs,E.backUVs);const V=new S.e;return V.indices=U,V.bE=g,V.TE=L,V.oE=D,V}function b(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return G(U).rE(N,U.updatable),N}S.e.CreateTorus=Y,L.e.CreateTorus=(E,U,g,N,L,D,S)=>t(E,{diameter:U,thickness:g,tessellation:N,sideOrientation:S,updatable:D},L);S.e.CreateTorusKnot=G,L.e.CreateTorusKnot=(E,U,g,N,L,D,S,u,s,C)=>b(E,{radius:U,tube:g,radialSegments:N,tubularSegments:L,p:D,q:S,sideOrientation:C,updatable:s},u);var T=g(14246),v=g(12882),o=g(12542);function c(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=U.path,D=U.shape,S=U.scale||1,u=U.rotation||0,s=0===U.cap?0:U.cap||L.e.NO_CAP,C=U.updatable,B=L.e._GetDefaultSideOrientation(U.sideOrientation),P=U.instance||null,F=U.invertUV||!1,f=U.closeShape||!1,d=U.closePath||!1,I=U.capFunction||null;return j(E,D,N,S,u,null,null,d,f,s,!1,g,!!C,B,P,F,U.frontUVs||null,U.backUVs||null,U.firstNormal||null,!!U.adjustFrame,I)}function r(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=U.path,D=U.shape,S=U.scaleFunction||(()=>1),u=U.rotationFunction||(()=>0),s=U.closePath||U.ribbonCloseArray||!1,C=U.closeShape||U.ribbonClosePath||!1,B=0===U.cap?0:U.cap||L.e.NO_CAP,P=U.updatable,F=U.firstNormal||null,f=U.adjustFrame||!1,d=L.e._GetDefaultSideOrientation(U.sideOrientation),I=U.instance,y=U.invertUV||!1,h=U.capFunction||null;return j(E,D,N,null,null,S,u,s,C,B,!0,g,!!P,d,I||null,y,U.frontUVs||null,U.backUVs||null,F,f,h||null)}function j(E,U,g,D,S,u,s,B,P,F,f,d,I,y,h,V,e,x,l,Y,t){const G=(E,U,g,D,S,u,s,C,B,P,F)=>{const f=g.getTangents(),d=g.getNormals(),I=g.getBinormals(),y=g.getDistances();if(F)for(let L=0;L<f.length;L++)if(0==f[L].x&&0==f[L].y&&0==f[L].z&&f[L].D(f[L-1]),0==d[L].x&&0==d[L].y&&0==d[L].z&&d[L].D(d[L-1]),0==I[L].x&&0==I[L].y&&0==I[L].z&&I[L].D(I[L-1]),L>0){let E=f[L-1];N.dU.Dot(E,f[L])<0&&f[L].scaleInPlace(-1),E=d[L-1],N.dU.Dot(E,d[L])<0&&d[L].scaleInPlace(-1),E=I[L-1],N.dU.Dot(E,I[L])<0&&I[L].scaleInPlace(-1)}let h=0;const V=P&&C?C:()=>null!==u?u:0,e=P&&s?s:()=>null!==S?S:1;let x=B===L.e.NO_CAP||B===L.e.CAP_END?0:2;const l=N.TmpVectors.Matrix[0];for(let L=0;L<U.length;L++){const g=[],S=V(L,y[L]),u=e(L,y[L]);N.Matrix.RotationAxisToRef(f[L],h,l);for(let D=0;D<E.length;D++){const S=f[L].scale(E[D].z).add(d[L].scale(E[D].x)).add(I[L].scale(E[D].y)),s=N.dU.Zero();N.dU.TransformCoordinatesToRef(S,l,s),s.scaleInPlace(u).addInPlace(U[L]),g[D]=s}D[x]=g,h+=S,x++}const Y=t||(E=>{const U=Array(),g=N.dU.Zero();let L;for(L=0;L<E.length;L++)g.addInPlace(E[L]);for(g.scaleInPlace(1/E.length),L=0;L<E.length;L++)U.push(g);return U});switch(B){case L.e.NO_CAP:break;case L.e.CAP_START:D[0]=Y(D[2]),D[1]=D[2];break;case L.e.CAP_END:D[x]=D[x-1],D[x+1]=Y(D[x-1]);break;case L.e.CAP_ALL:D[0]=Y(D[2]),D[1]=D[2],D[x]=D[x-1],D[x+1]=Y(D[x-1])}return D};let b,T;if(h){const E=h._creationDataStorage;return b=l?E.path3D.update(g,l):E.path3D.update(g),T=G(U,g,E.path3D,E.pathArray,D,S,u,s,E.cap,f,Y),h=C("",{pathArray:T,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:h},d||void 0)}b=l?new o.m(g,l):new o.m(g);T=G(U,g,b,new Array,D,S,u,s,F=F<0||F>3?0:F,f,Y);const v=C(E,{pathArray:T,closeArray:B,closePath:P,updatable:I,sideOrientation:y,invertUV:V,frontUVs:e||void 0,backUVs:x||void 0},d);return v._creationDataStorage.pathArray=T,v._creationDataStorage.path3D=b,v._creationDataStorage.cap=F,v}function Z(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=U.arc?U.arc<=0||U.arc>1?1:U.arc:1,S=void 0===U.closed||U.closed,u=U.shape,s=U.radius||1,B=U.tessellation||64,P=U.clip||0,F=U.updatable,f=L.e._GetDefaultSideOrientation(U.sideOrientation),d=U.cap||L.e.NO_CAP,I=2*Math.PI,y=[],h=U.invertUV||!1;let V=0,e=0;const x=I/B*D;let l,Y;for(V=0;V<=B-P;V++){for(Y=[],d!=L.e.CAP_START&&d!=L.e.CAP_ALL||(Y.push(new N.dU(0,u[0].y,0)),Y.push(new N.dU(Math.cos(V*x)*u[0].x*s,u[0].y,Math.sin(V*x)*u[0].x*s))),e=0;e<u.length;e++)l=new N.dU(Math.cos(V*x)*u[e].x*s,u[e].y,Math.sin(V*x)*u[e].x*s),Y.push(l);d!=L.e.CAP_END&&d!=L.e.CAP_ALL||(Y.push(new N.dU(Math.cos(V*x)*u[u.length-1].x*s,u[u.length-1].y,Math.sin(V*x)*u[u.length-1].x*s)),Y.push(new N.dU(0,u[u.length-1].y,0))),y.push(Y)}return C(E,{pathArray:y,closeArray:S,sideOrientation:f,updatable:F,invertUV:h,frontUVs:U.frontUVs,backUVs:U.backUVs},g)}L.e.ExtrudeShape=function(E,U,g,N,D,S){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,B=arguments.length>9?arguments[9]:void 0;return c(E,{shape:U,path:g,scale:N,rotation:D,cap:0===S?0:S||L.e.NO_CAP,sideOrientation:C,instance:B,updatable:s},u)},L.e.ExtrudeShapeCustom=(E,U,g,N,D,S,u,s,C,B,P,F)=>r(E,{shape:U,path:g,scaleFunction:N,rotationFunction:D,ribbonCloseArray:S,ribbonClosePath:u,cap:0===s?0:s||L.e.NO_CAP,sideOrientation:P,instance:F,updatable:B},C);L.e.CreateLathe=(E,U,g,N,L,D,S)=>Z(E,{shape:U,radius:g,tessellation:N,sideOrientation:S,updatable:D},L);var A=g(13616),w=g(13572);function a(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=U.path;let S=U.instance,u=1;void 0!==U.radius?u=U.radius:S&&(u=S._creationDataStorage.radius);const s=U.tessellation||64,B=U.radiusFunction||null;let P=U.cap||L.e.NO_CAP;const F=U.invertUV||!1,f=U.updatable,d=L.e._GetDefaultSideOrientation(U.sideOrientation);U.arc=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1;const I=(E,U,g,D,S,u,s,C)=>{const B=U.getTangents(),P=U.getNormals(),F=U.getDistances(),f=2*Math.PI/S*C,d=u||(()=>D);let I,y,h,V;const e=N.TmpVectors.Matrix[0];let x=s===L.e.NO_CAP||s===L.e.CAP_END?0:2;for(let L=0;L<E.length;L++){y=d(L,F[L]),I=Array(),h=P[L];for(let U=0;U<S;U++)N.Matrix.RotationAxisToRef(B[L],f*U,e),V=I[U]?I[U]:N.dU.Zero(),N.dU.TransformCoordinatesToRef(h,e,V),V.scaleInPlace(y).addInPlace(E[L]),I[U]=V;g[x]=I,x++}const l=(U,g)=>{const N=Array();for(let L=0;L<U;L++)N.push(E[g]);return N};switch(s){case L.e.NO_CAP:break;case L.e.CAP_START:g[0]=l(S,0),g[1]=g[2].slice(0);break;case L.e.CAP_END:g[x]=g[x-1].slice(0),g[x+1]=l(S,E.length-1);break;case L.e.CAP_ALL:g[0]=l(S,0),g[1]=g[2].slice(0),g[x]=g[x-1].slice(0),g[x+1]=l(S,E.length-1)}return g};let y,h;if(S){const E=S._creationDataStorage,g=U.arc||E.arc;return y=E.path3D.update(D),h=I(D,y,E.pathArray,u,E.tessellation,B,E.cap,g),S=C("",{pathArray:h,instance:S}),E.path3D=y,E.pathArray=h,E.arc=g,E.radius=u,S}y=new o.m(D);P=P<0||P>3?0:P,h=I(D,y,new Array,u,s,B,P,U.arc);const V=C(E,{pathArray:h,closePath:!0,closeArray:!1,updatable:f,sideOrientation:d,invertUV:F,frontUVs:U.frontUVs,backUVs:U.backUVs},g);return V._creationDataStorage.pathArray=h,V._creationDataStorage.path3D=y,V._creationDataStorage.tessellation=s,V._creationDataStorage.cap=P,V._creationDataStorage.arc=U.arc,V._creationDataStorage.radius=u,V}function J(E){const U=[];U[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},U[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},U[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},U[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},U[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},U[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},U[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},U[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},U[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},U[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},U[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},U[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},U[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},U[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},U[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const g=E.type&&(E.type<0||E.type>=U.length)?0:E.type||0,L=E.size,D=E.sizeX||L||1,s=E.sizeY||L||1,C=E.sizeZ||L||1,B=E.custom||U[g],P=B.face.length,f=E.faceUV||new Array(P),d=E.faceColors,I=void 0===E.flat||E.flat,y=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,h=[],V=[],e=[],x=[],l=[];let Y=0,t=0;const G=[];let b,T,v,o,c,r,j=0,Z=0;if(I)for(Z=0;Z<P;Z++)d&&void 0===d[Z]&&(d[Z]=new F.hu(1,1,1,1)),f&&void 0===f[Z]&&(f[Z]=new N.Vector4(0,0,1,1));if(I)for(Z=0;Z<P;Z++){const E=B.face[Z].length;for(v=2*Math.PI/E,o=.5*Math.tan(v/2),c=.5,j=0;j<E;j++)h.push(B.vertex[B.face[Z][j]][0]*D,B.vertex[B.face[Z][j]][1]*s,B.vertex[B.face[Z][j]][2]*C),G.push(Y),Y++,b=f[Z].x+(f[Z].z-f[Z].x)*(.5+o),T=f[Z].y+(f[Z].w-f[Z].y)*(c-.5),x.push(b,u.b?1-T:T),r=o*Math.cos(v)-c*Math.sin(v),c=o*Math.sin(v)+c*Math.cos(v),o=r,d&&l.push(d[Z].r,d[Z].g,d[Z].b,d[Z].a);for(j=0;j<E-2;j++)V.push(G[0+t],G[j+2+t],G[j+1+t]);t+=E}else{for(j=0;j<B.vertex.length;j++)h.push(B.vertex[j][0]*D,B.vertex[j][1]*s,B.vertex[j][2]*C),x.push(0,u.b?1:0);for(Z=0;Z<P;Z++)for(j=0;j<B.face[Z].length-2;j++)V.push(B.face[Z][0],B.face[Z][j+2],B.face[Z][j+1])}S.e.ComputeNormals(h,V,e),S.e._ComputeSides(y,h,V,e,x,E.frontUVs,E.backUVs);const A=new S.e;return A.bE=h,A.indices=V,A.TE=e,A.oE=x,d&&I&&(A.vE=l),A}function q(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return J(U).rE(N,U.updatable),N}L.e.CreateTube=(E,U,g,N,L,D,S,u,s,C)=>a(E,{path:U,radius:g,tessellation:N,radiusFunction:L,arc:1,cap:D,updatable:u,sideOrientation:s,instance:C},S);function M(E){const U=E.sideOrientation||S.e.DEFAULTSIDE,g=E.radius||1,L=void 0===E.flat||E.flat,D=0|(E.subdivisions||4),s=E.radiusX||g,C=E.radiusY||g,B=E.radiusZ||g,P=(1+Math.sqrt(5))/2,F=[-1,P,-0,1,P,0,-1,-P,0,1,-P,0,0,-1,-P,0,1,-P,0,-1,P,0,1,P,P,0,1,P,0,-1,-P,0,1,-P,0,-1],f=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],d=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],I=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],y=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],h=[],V=[],e=[],x=[];let l=0;const Y=new Array(3),t=new Array(3);let G;for(G=0;G<3;G++)Y[G]=N.dU.Zero(),t[G]=N.Vector2.Zero();for(let S=0;S<20;S++){for(G=0;G<3;G++){const E=f[3*S+G];Y[G].du(F[3*d[E]],F[3*d[E]+1],F[3*d[E]+2]),Y[G].normalize(),t[G].du(.134765625*I[2*E]+.05859375+-.0390625*y[S],.2333984375*I[2*E+1]+.025390625+.01953125*y[S])}const E=(E,U,g,S)=>{const P=N.dU.Lerp(Y[0],Y[2],U/D),F=N.dU.Lerp(Y[1],Y[2],U/D),f=D===U?Y[2]:N.dU.Lerp(P,F,E/(D-U));let d;if(f.normalize(),L){const E=N.dU.Lerp(Y[0],Y[2],S/D),U=N.dU.Lerp(Y[1],Y[2],S/D);d=N.dU.Lerp(E,U,g/(D-S))}else d=new N.dU(f.x,f.y,f.z);d.x/=s,d.y/=C,d.z/=B,d.normalize();const I=N.Vector2.Lerp(t[0],t[2],U/D),y=N.Vector2.Lerp(t[1],t[2],U/D),G=D===U?t[2]:N.Vector2.Lerp(I,y,E/(D-U));V.push(f.x*s,f.y*C,f.z*B),e.push(d.x,d.y,d.z),x.push(G.x,u.b?1-G.y:G.y),h.push(l),l++};for(let U=0;U<D;U++)for(let g=0;g+U<D;g++)E(g,U,g+1/3,U+1/3),E(g+1,U,g+1/3,U+1/3),E(g,U+1,g+1/3,U+1/3),g+U+1<D&&(E(g+1,U,g+2/3,U+2/3),E(g+1,U+1,g+2/3,U+2/3),E(g,U+1,g+2/3,U+2/3))}S.e._ComputeSides(U,V,h,e,x,E.frontUVs,E.backUVs);const b=new S.e;return b.indices=h,b.bE=V,b.TE=e,b.oE=x,b}function mE(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new L.e(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),N._originalBuilderSideOrientation=U.sideOrientation;return M(U).rE(N,U.updatable),N}S.e.CreatePolyhedron=J,L.e.CreatePolyhedron=(E,U,g)=>q(E,U,g);S.e.CreateIcoSphere=M,L.e.CreateIcoSphere=(E,U,g)=>mE(E,U,g);var W=g(12353);const O=new N.dU(1,0,0),Q=new N.dU(-1,0,0),R=new N.dU(0,1,0),n=new N.dU(0,-1,0),k=new N.dU(0,0,1),z=new N.dU(0,0,-1);class i{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.dU.Zero(),U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.dU.Up(),g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.Vector2.Zero(),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=E,this.normal=U,this.uv=g,this.vertexIdx=L,this.vertexIdxForBones=D,this.localPositionOverride=S,this.localNormalOverride=u,this.matrixIndicesOverride=s,this.matrixWeightsOverride=C}clone(){var E,U,g,N;return new i(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(E=this.localPositionOverride)||void 0===E?void 0:E.slice(),null===(U=this.localNormalOverride)||void 0===U?void 0:U.slice(),null===(g=this.matrixIndicesOverride)||void 0===g?void 0:g.slice(),null===(N=this.matrixWeightsOverride)||void 0===N?void 0:N.slice())}}function p(E,U,g){var s,C,B,P,F;const f=!!U.skeleton,d=!(null===(s=U.morphTargetManager)||void 0===s||!s.numTargets),I=g.localMode||f,y=U.CD(),h=f||d?U.cu(!0,!0):U.getVerticesData(D.f.PositionKind),V=f||d?U.getNormalsData(!0,!0):U.getVerticesData(D.f.NormalKind),e=I?f?U.getVerticesData(D.f.PositionKind):h:null,x=I?f?U.getVerticesData(D.f.NormalKind):V:null,l=U.getVerticesData(D.f.UVKind),Y=f?U.getVerticesData(D.f.MatricesIndicesKind):null,t=f?U.getVerticesData(D.f.MatricesWeightsKind):null,G=f?U.getVerticesData(D.f.MatricesIndicesExtraKind):null,b=f?U.getVerticesData(D.f.MatricesWeightsExtraKind):null,T=g.position||N.dU.Zero();let v=g.normal||N.dU.Up();const o=g.size||N.dU.One(),c=g.angle||0;if(!v){const E=new N.dU(0,0,1),g=U.tE().activeCamera,L=N.dU.TransformCoordinates(E,g.getWorldMatrix());v=g.globalPosition.IU(L)}const r=-Math.atan2(v.z,v.x)-Math.PI/2,j=Math.sqrt(v.x*v.x+v.z*v.z),Z=Math.atan2(v.y,j),A=new S.e;A.indices=[],A.bE=[],A.TE=[],A.oE=[],A.matricesIndices=f?[]:null,A.matricesWeights=f?[]:null,A.matricesIndicesExtra=G?[]:null,A.matricesWeightsExtra=b?[]:null;let w=0;const a=(E,U)=>{const L=new i;if(!y||!h||!V)return L;const D=y[E];if(L.vertexIdx=3*D,L.vertexIdxForBones=4*D,L.position=new N.dU(h[3*D],h[3*D+1],h[3*D+2]),N.dU.TransformCoordinatesToRef(L.position,U,L.position),L.normal=new N.dU(V[3*D],V[3*D+1],V[3*D+2]),N.dU.TransformNormalToRef(L.normal,U,L.normal),g.captureUVS&&l){const E=l[2*D+1];L.uv=new N.Vector2(l[2*D],u.b?1-E:E)}return L},J=[0,0,0,0],q=(E,U)=>{if(0===E.length)return E;const g=.5*Math.abs(N.dU.Dot(o,U)),L=(E,U,g,N)=>{for(let L=0;L<N;++L)if(E[g+L]===U)return g+L;return-1},D=(E,D)=>{const S=N.dU.GetClipFactor(E.position,D.position,U,g);let u=J,s=J;if(Y&&t){const U=E.matrixIndicesOverride?0:E.vertexIdxForBones,g=E.matrixIndicesOverride??Y,N=E.matrixWeightsOverride??t,C=D.matrixIndicesOverride?0:D.vertexIdxForBones,B=D.matrixIndicesOverride??Y,P=D.matrixWeightsOverride??t;u=[0,0,0,0],s=[0,0,0,0];let F=0;for(let E=0;E<4;++E)if(N[U+E]>0){const D=L(B,g[U+E],C,4);u[F]=g[U+E],s[F]=(0,W.Lerp)(N[U+E],D>=0?P[D]:0,S),F++}for(let E=0;E<4&&F<4;++E){const N=B[C+E];-1===L(g,N,U,4)&&(u[F]=N,s[F]=(0,W.Lerp)(0,P[C+E],S),F++)}const f=s[0]+s[1]+s[2]+s[3];s[0]/=f,s[1]/=f,s[2]/=f,s[3]/=f}const C=E.localPositionOverride?E.localPositionOverride[0]:(null===e||void 0===e?void 0:e[E.vertexIdx])??0,B=E.localPositionOverride?E.localPositionOverride[1]:(null===e||void 0===e?void 0:e[E.vertexIdx+1])??0,P=E.localPositionOverride?E.localPositionOverride[2]:(null===e||void 0===e?void 0:e[E.vertexIdx+2])??0,F=D.localPositionOverride?D.localPositionOverride[0]:(null===e||void 0===e?void 0:e[D.vertexIdx])??0,f=D.localPositionOverride?D.localPositionOverride[1]:(null===e||void 0===e?void 0:e[D.vertexIdx+1])??0,d=D.localPositionOverride?D.localPositionOverride[2]:(null===e||void 0===e?void 0:e[D.vertexIdx+2])??0,I=E.localNormalOverride?E.localNormalOverride[0]:(null===x||void 0===x?void 0:x[E.vertexIdx])??0,y=E.localNormalOverride?E.localNormalOverride[1]:(null===x||void 0===x?void 0:x[E.vertexIdx+1])??0,h=E.localNormalOverride?E.localNormalOverride[2]:(null===x||void 0===x?void 0:x[E.vertexIdx+2])??0,V=I+((D.localNormalOverride?D.localNormalOverride[0]:(null===x||void 0===x?void 0:x[D.vertexIdx])??0)-I)*S,l=y+((D.localNormalOverride?D.localNormalOverride[1]:(null===x||void 0===x?void 0:x[D.vertexIdx+1])??0)-y)*S,G=h+((D.localNormalOverride?D.localNormalOverride[2]:(null===x||void 0===x?void 0:x[D.vertexIdx+2])??0)-h)*S,b=Math.sqrt(V*V+l*l+G*G);return new i(N.dU.Lerp(E.position,D.position,S),N.dU.Lerp(E.normal,D.normal,S).normalize(),N.Vector2.Lerp(E.uv,D.uv,S),-1,-1,e?[C+(F-C)*S,B+(f-B)*S,P+(d-P)*S]:null,x?[V/b,l/b,G/b]:null,u,s)};let S=null;E.length>3&&(S=[]);for(let u=0;u<E.length;u+=3){let L=0,s=null,C=null,B=null,P=null;const F=N.dU.Dot(E[u].position,U)-g>0,f=N.dU.Dot(E[u+1].position,U)-g>0,d=N.dU.Dot(E[u+2].position,U)-g>0;switch(L=(F?1:0)+(f?1:0)+(d?1:0),L){case 0:E.length>3?(S.push(E[u]),S.push(E[u+1]),S.push(E[u+2])):S=E;break;case 1:if(S=S??new Array,F&&(s=E[u+1],C=E[u+2],B=D(E[u],s),P=D(E[u],C)),f){s=E[u],C=E[u+2],B=D(E[u+1],s),P=D(E[u+1],C),S.push(B),S.push(C.clone()),S.push(s.clone()),S.push(C.clone()),S.push(B.clone()),S.push(P);break}d&&(s=E[u],C=E[u+1],B=D(E[u+2],s),P=D(E[u+2],C)),s&&C&&B&&P&&(S.push(s.clone()),S.push(C.clone()),S.push(B),S.push(P),S.push(B.clone()),S.push(C.clone()));break;case 2:S=S??new Array,F||(s=E[u].clone(),C=D(s,E[u+1]),B=D(s,E[u+2]),S.push(s),S.push(C),S.push(B)),f||(s=E[u+1].clone(),C=D(s,E[u+2]),B=D(s,E[u]),S.push(s),S.push(C),S.push(B)),d||(s=E[u+2].clone(),C=D(s,E[u]),B=D(s,E[u+1]),S.push(s),S.push(C),S.push(B))}}return S},M=U instanceof L.e?U:null,mE=null===M||void 0===M?void 0:M._thinInstanceDataStorage.matrixData,p=(null===M||void 0===M?void 0:M.eu)||1,H=N.TmpVectors.Matrix[0];H.D(N.Matrix.IdentityReadOnly);for(let L=0;L<p;++L){if(null!==M&&void 0!==M&&M.hasThinInstances&&mE){const E=16*L;H.setRowFromFloats(0,mE[E+0],mE[E+1],mE[E+2],mE[E+3]),H.setRowFromFloats(1,mE[E+4],mE[E+5],mE[E+6],mE[E+7]),H.setRowFromFloats(2,mE[E+8],mE[E+9],mE[E+10],mE[E+11]),H.setRowFromFloats(3,mE[E+12],mE[E+13],mE[E+14],mE[E+15])}const E=N.Matrix.RotationYawPitchRoll(r,Z,c).multiply(N.Matrix.Translation(T.x,T.y,T.z)),D=N.Matrix.Invert(E),S=U.getWorldMatrix(),s=H.multiply(S).multiply(D),C=new Array(3);for(let U=0;U<y.length;U+=3){let E=C;if(E[0]=a(U,s),E[1]=a(U+1,s),E[2]=a(U+2,s),!(g.cullBackFaces&&-E[0].normal.z<=0&&-E[1].normal.z<=0&&-E[2].normal.z<=0)&&(E=q(E,O),E&&(E=q(E,Q),E&&(E=q(E,R),E&&(E=q(E,n),E&&(E=q(E,k),E&&(E=q(E,z),E)))))))for(let U=0;U<E.length;U++){const N=E[U];if(A.indices.push(w),I?(N.localPositionOverride?(A.bE[3*w]=N.localPositionOverride[0],A.bE[3*w+1]=N.localPositionOverride[1],A.bE[3*w+2]=N.localPositionOverride[2]):e&&(A.bE[3*w]=e[N.vertexIdx],A.bE[3*w+1]=e[N.vertexIdx+1],A.bE[3*w+2]=e[N.vertexIdx+2]),N.localNormalOverride?(A.TE[3*w]=N.localNormalOverride[0],A.TE[3*w+1]=N.localNormalOverride[1],A.TE[3*w+2]=N.localNormalOverride[2]):x&&(A.TE[3*w]=x[N.vertexIdx],A.TE[3*w+1]=x[N.vertexIdx+1],A.TE[3*w+2]=x[N.vertexIdx+2])):(N.position.toArray(A.bE,3*w),N.normal.toArray(A.TE,3*w)),A.matricesIndices&&A.matricesWeights&&(N.matrixIndicesOverride?(A.matricesIndices[4*w]=N.matrixIndicesOverride[0],A.matricesIndices[4*w+1]=N.matrixIndicesOverride[1],A.matricesIndices[4*w+2]=N.matrixIndicesOverride[2],A.matricesIndices[4*w+3]=N.matrixIndicesOverride[3]):(Y&&(A.matricesIndices[4*w]=Y[N.vertexIdxForBones],A.matricesIndices[4*w+1]=Y[N.vertexIdxForBones+1],A.matricesIndices[4*w+2]=Y[N.vertexIdxForBones+2],A.matricesIndices[4*w+3]=Y[N.vertexIdxForBones+3]),G&&A.matricesIndicesExtra&&(A.matricesIndicesExtra[4*w]=G[N.vertexIdxForBones],A.matricesIndicesExtra[4*w+1]=G[N.vertexIdxForBones+1],A.matricesIndicesExtra[4*w+2]=G[N.vertexIdxForBones+2],A.matricesIndicesExtra[4*w+3]=G[N.vertexIdxForBones+3])),N.matrixWeightsOverride?(A.matricesWeights[4*w]=N.matrixWeightsOverride[0],A.matricesWeights[4*w+1]=N.matrixWeightsOverride[1],A.matricesWeights[4*w+2]=N.matrixWeightsOverride[2],A.matricesWeights[4*w+3]=N.matrixWeightsOverride[3]):(t&&(A.matricesWeights[4*w]=t[N.vertexIdxForBones],A.matricesWeights[4*w+1]=t[N.vertexIdxForBones+1],A.matricesWeights[4*w+2]=t[N.vertexIdxForBones+2],A.matricesWeights[4*w+3]=t[N.vertexIdxForBones+3]),b&&A.matricesWeightsExtra&&(A.matricesWeightsExtra[4*w]=b[N.vertexIdxForBones],A.matricesWeightsExtra[4*w+1]=b[N.vertexIdxForBones+1],A.matricesWeightsExtra[4*w+2]=b[N.vertexIdxForBones+2],A.matricesWeightsExtra[4*w+3]=b[N.vertexIdxForBones+3]))),g.captureUVS)N.uv.toArray(A.oE,2*w);else{A.oE.push(.5+N.position.x/o.x);const E=.5+N.position.y/o.y;A.oE.push(u.b?1-E:E)}w++}}}0===A.indices.length&&(A.indices=null),0===A.bE.length&&(A.bE=null),0===A.TE.length&&(A.TE=null),0===A.oE.length&&(A.oE=null),0===(null===(C=A.matricesIndices)||void 0===C?void 0:C.length)&&(A.matricesIndices=null),0===(null===(B=A.matricesWeights)||void 0===B?void 0:B.length)&&(A.matricesWeights=null),0===(null===(P=A.matricesIndicesExtra)||void 0===P?void 0:P.length)&&(A.matricesIndicesExtra=null),0===(null===(F=A.matricesWeightsExtra)||void 0===F?void 0:F.length)&&(A.matricesWeightsExtra=null);const K=new L.e(E,U.tE());return A.rE(K),I?(K.skeleton=U.skeleton,K.parent=U):(K.position=T.clone(),K.rotation=new N.dU(Z,r,c)),K.pg(!0),K.refreshBoundingInfo(!0,!0),K}function H(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const U=0|Math.max(E.subdivisions?E.subdivisions:2,1),g=0|Math.max(E.tessellation?E.tessellation:16,3),L=Math.max(E.height?E.height:1,0),D=Math.max(E.radius?E.radius:.25,0),s=0|Math.max(E.capSubdivisions?E.capSubdivisions:6,1),C=g,B=U,P=Math.max(E.radiusTop?E.radiusTop:D,0),F=Math.max(E.radiusBottom?E.radiusBottom:D,0),f=L-(P+F),d=2*Math.PI,I=Math.max(E.topCapSubdivisions?E.topCapSubdivisions:s,1),y=Math.max(E.bottomCapSubdivisions?E.bottomCapSubdivisions:s,1),h=Math.acos((F-P)/L);let V=[];const e=[],x=[],l=[];let Y=0;const t=[],G=.5*f,b=.5*Math.PI;let T,v;const o=N.dU.Zero(),c=N.dU.Zero(),r=Math.cos(h),j=Math.sin(h),Z=new N.Vector2(P*j,G+P*r).IU(new N.Vector2(F*j,F*r-G)).length(),A=P*h+Z+F*(b-h);let w=0;for(v=0;v<=I;v++){const E=[],U=b-h*(v/I);w+=P*h/I;const g=Math.cos(U),N=Math.sin(U),L=g*P;for(T=0;T<=C;T++){const U=T/C,D=U*d+0,S=Math.sin(D),s=Math.cos(D);c.x=L*S,c.y=G+N*P,c.z=L*s,e.push(c.x,c.y,c.z),o.set(g*S,N,g*s),x.push(o.x,o.y,o.z),l.push(U,u.b?w/A:1-w/A),E.push(Y),Y++}t.push(E)}const a=L-P-F+r*P-r*F,J=j*(F-P)/a;for(v=1;v<=B;v++){const E=[];w+=Z/B;const U=j*(v*(F-P)/B+P);for(T=0;T<=C;T++){const g=T/C,N=g*d+0,L=Math.sin(N),D=Math.cos(N);c.x=U*L,c.y=G+r*P-v*a/B,c.z=U*D,e.push(c.x,c.y,c.z),o.set(L,J,D).normalize(),x.push(o.x,o.y,o.z),l.push(g,u.b?w/A:1-w/A),E.push(Y),Y++}t.push(E)}for(v=1;v<=y;v++){const E=[],U=b-h-(Math.PI-h)*(v/y);w+=F*h/y;const g=Math.cos(U),N=Math.sin(U),L=g*F;for(T=0;T<=C;T++){const U=T/C,D=U*d+0,S=Math.sin(D),s=Math.cos(D);c.x=L*S,c.y=N*F-G,c.z=L*s,e.push(c.x,c.y,c.z),o.set(g*S,N,g*s),x.push(o.x,o.y,o.z),l.push(U,u.b?w/A:1-w/A),E.push(Y),Y++}t.push(E)}for(T=0;T<C;T++)for(v=0;v<I+B+y;v++){const E=t[v][T],U=t[v+1][T],g=t[v+1][T+1],N=t[v][T+1];V.push(E),V.push(U),V.push(N),V.push(U),V.push(g),V.push(N)}if(V=V.reverse(),E.orientation&&!E.orientation.equals(N.dU.Up())){const U=new N.Matrix;E.orientation.clone().scale(.5*Math.PI).cross(N.dU.Up()).toQuaternion().toRotationMatrix(U);const g=N.dU.Zero();for(let E=0;E<e.length;E+=3)g.set(e[E],e[E+1],e[E+2]),N.dU.TransformCoordinatesToRef(g.clone(),U,g),e[E]=g.x,e[E+1]=g.y,e[E+2]=g.z}const q=new S.e;return q.bE=e,q.TE=x,q.oE=l,q.indices=V,q}function K(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:N.dU.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=new L.e(E,g);return H(U).rE(D,U.updatable),D}L.e.CreateDecal=(E,U,g,N,L,D)=>p(E,U,{position:g,normal:N,size:L,angle:D});L.e.CreateCapsule=(E,U,g)=>K(E,U,g),S.e.CreateCapsule=H;var X=g(12186),EE=g(12336);class UE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=E,this.y=U,E!==Math.floor(E)&&(E=Math.floor(E),X.d.Warn("x is not an integer, floor(x) used")),U!==Math.floor(U)&&(U=Math.floor(U),X.d.Warn("y is not an integer, floor(y) used"))}clone(){return new UE(this.x,this.y)}rotate60About(E){const U=this.x;return this.x=E.x+E.y-this.y,this.y=U+this.y-E.x,this}rotateNeg60About(E){const U=this.x;return this.x=U+this.y-E.y,this.y=E.x+E.y-U,this}rotate120(E,U){E!==Math.floor(E)&&(E=Math.floor(E),X.d.Warn("m not an integer only floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),X.d.Warn("n not an integer only floor(n) used"));const g=this.x;return this.x=E-g-this.y,this.y=U+g,this}rotateNeg120(E,U){E!==Math.floor(E)&&(E=Math.floor(E),X.d.Warn("m is not an integer, floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),X.d.Warn("n is not an integer,   floor(n) used"));const g=this.x;return this.x=this.y-U,this.y=E+U-g-this.y,this}toCartesianOrigin(E,U){const g=N.dU.Zero();return g.x=E.x+2*this.x*U+this.y*U,g.y=E.y+Math.sqrt(3)*this.y*U,g}static Zero(){return new UE(0,0)}}class gE{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new NE("icosahedron","Regular",[[0,EE.e,-1],[-EE.e,1,0],[-1,0,-EE.e],[1,0,-EE.e],[EE.e,1,0],[0,EE.e,1],[-1,0,EE.e],[-EE.e,-1,0],[0,-EE.e,-1],[EE.e,-1,0],[1,0,EE.e],[0,-EE.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let E=12;const U={},g=this.m,N=this.n;let L,D,S,u,s,C=g,B=1,P=0;0!==N&&(C=(0,W.HighestCommonFactor)(g,N)),B=g/C,P=N/C;const F=UE.Zero(),f=new UE(g,N),d=new UE(-N,g+N),I=UE.Zero(),y=UE.Zero(),h=UE.Zero();let V,e,x,l,Y=[];const t=[],G=this.vertByDist,b=(g,N,L,D)=>{V=g+"|"+L,e=N+"|"+D,V in U||e in U?V in U&&!(e in U)?U[e]=U[V]:e in U&&!(V in U)&&(U[V]=U[e]):(U[V]=E,U[e]=E,E++),G[L][0]>2?t[U[V]]=[-G[L][0],G[L][1],U[V]]:t[U[V]]=[Y[G[L][0]],G[L][1],U[V]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let T=0;T<20;T++){if(Y=this.IDATA.face[T],S=Y[2],u=Y[1],s=Y[0],x=F.x+"|"+F.y,V=T+"|"+x,V in U||(U[V]=S,t[S]=[Y[G[x][0]],G[x][1]]),x=f.x+"|"+f.y,V=T+"|"+x,V in U||(U[V]=u,t[u]=[Y[G[x][0]],G[x][1]]),x=d.x+"|"+d.y,V=T+"|"+x,V in U||(U[V]=s,t[s]=[Y[G[x][0]],G[x][1]]),L=this.IDATA.edgematch[T][0],D=this.IDATA.edgematch[T][1],"B"===D)for(let E=1;E<C;E++)y.x=g-E*(B+P),y.y=N+E*B,h.x=-E*P,h.y=E*(B+P),x=y.x+"|"+y.y,l=h.x+"|"+h.y,b(T,L,x,l);if("O"===D)for(let E=1;E<C;E++)h.x=-E*P,h.y=E*(B+P),I.x=E*B,I.y=E*P,x=h.x+"|"+h.y,l=I.x+"|"+I.y,b(T,L,x,l);if(L=this.IDATA.edgematch[T][2],D=this.IDATA.edgematch[T][3],D&&"A"===D)for(let E=1;E<C;E++)I.x=E*B,I.y=E*P,y.x=g-(C-E)*(B+P),y.y=N+(C-E)*B,x=I.x+"|"+I.y,l=y.x+"|"+y.y,b(T,L,x,l);for(let g=0;g<this.vertices.length;g++)x=this.vertices[g].x+"|"+this.vertices[g].y,V=T+"|"+x,V in U||(U[V]=E++,G[x][0]>2?t[U[V]]=[-G[x][0],G[x][1],U[V]]:t[U[V]]=[Y[G[x][0]],G[x][1],U[V]])}this.closestTo=t,this.vecToidx=U}calcCoeffs(){const E=this.m,U=this.n,g=Math.sqrt(3)/3,N=E*E+U*U+E*U;this.coau=(E+U)/N,this.cobu=-U/N,this.coav=-g*(E-U)/N,this.cobv=g*(2*E+U)/N}createInnerFacets(){const E=this.m,U=this.n;for(let g=0;g<U+E+1;g++)for(let E=this.min[g];E<this.max[g]+1;E++)E<this.max[g]&&E<this.max[g+1]+1&&this.innerFacets.push(["|"+E+"|"+g,"|"+E+"|"+(g+1),"|"+(E+1)+"|"+g]),g>0&&E<this.max[g-1]&&E+1<this.max[g]+1&&this.innerFacets.push(["|"+E+"|"+g,"|"+(E+1)+"|"+g,"|"+(E+1)+"|"+(g-1)])}edgeVecsABOB(){const E=this.m,U=this.n,g=new UE(-U,E+U);for(let N=1;N<E+U;N++){const E=new UE(this.min[N],N),U=new UE(this.min[N-1],N-1),L=new UE(this.min[N+1],N+1),D=E.clone(),S=U.clone(),u=L.clone();D.rotate60About(g),S.rotate60About(g),u.rotate60About(g);const s=new UE(this.max[D.y],D.y),C=new UE(this.max[D.y-1],D.y-1),B=new UE(this.max[D.y-1]-1,D.y-1);D.x===s.x&&D.y===s.y||(D.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,C,B]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,B,s])):D.y===u.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,U,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([E,C,L])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,U,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,C,s])))}}mapABOBtoOBOA(){const E=new UE(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const g=[];for(let N=0;N<3;N++)E.x=this.isoVecsABOB[U][N].x,E.y=this.isoVecsABOB[U][N].y,0===this.vertexTypes[U][N]&&E.rotateNeg120(this.m,this.n),g.push(E.clone());this.isoVecsOBOA.push(g)}}mapABOBtoBAOA(){const E=new UE(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const g=[];for(let N=0;N<3;N++)E.x=this.isoVecsABOB[U][N].x,E.y=this.isoVecsABOB[U][N].y,1===this.vertexTypes[U][N]&&E.rotate120(this.m,this.n),g.push(E.clone());this.isoVecsBAOA.push(g)}}MapToFace(E,U){const g=this.IDATA.face[E],L=g[2],D=g[1],S=g[0],u=N.dU.eU(this.IDATA.vertex[L]),s=N.dU.eU(this.IDATA.vertex[D]),C=N.dU.eU(this.IDATA.vertex[S]),B=s.IU(u),P=C.IU(u),F=B.scale(this.coau).add(P.scale(this.cobu)),f=B.scale(this.coav).add(P.scale(this.cobv)),d=[];let I,y=N.TmpVectors.dU[0];for(let N=0;N<this.cartesian.length;N++)y=F.scale(this.cartesian[N].x).add(f.scale(this.cartesian[N].y)).add(u),d[N]=[y.x,y.y,y.z],I=E+"|"+this.vertices[N].x+"|"+this.vertices[N].y,U.vertex[this.vecToidx[I]]=[y.x,y.y,y.z]}build(E,U){const g=[],N=UE.Zero(),L=new UE(E,U),D=new UE(-U,E+U);g.push(N,L,D);for(let x=U;x<E+1;x++)for(let U=0;U<E+1-x;U++)g.push(new UE(U,x));if(U>0){const N=(0,W.HighestCommonFactor)(E,U),L=E/N,D=U/N;for(let u=1;u<N;u++)g.push(new UE(u*L,u*D)),g.push(new UE(-u*D,u*(L+D))),g.push(new UE(E-u*(L+D),U+u*L));const S=E/U;for(let u=1;u<U;u++)for(let N=0;N<u*S;N++)g.push(new UE(N,u)),g.push(new UE(N,u).rotate120(E,U)),g.push(new UE(N,u).rotateNeg120(E,U))}g.sort(((E,U)=>E.x-U.x)),g.sort(((E,U)=>E.y-U.y));const S=new Array(E+U+1),u=new Array(E+U+1);for(let x=0;x<S.length;x++)S[x]=1/0,u[x]=-1/0;let s=0,C=0;const B=g.length;for(let x=0;x<B;x++)C=g[x].x,s=g[x].y,S[s]=Math.min(C,S[s]),u[s]=Math.max(C,u[s]);const P=(g,N)=>{const L=g.clone();return"A"===N&&L.rotateNeg120(E,U),"B"===N&&L.rotate120(E,U),L.x<0?L.y:L.x+L.y},F=[],f=[],d=[],I=[],y={},h=[];let V=-1,e=-1;for(let x=0;x<B;x++)F[x]=g[x].toCartesianOrigin(new UE(0,0),.5),f[x]=P(g[x],"O"),d[x]=P(g[x],"A"),I[x]=P(g[x],"B"),f[x]===d[x]&&d[x]===I[x]?(V=3,e=f[x]):f[x]===d[x]?(V=4,e=f[x]):d[x]===I[x]?(V=5,e=d[x]):I[x]===f[x]&&(V=6,e=f[x]),f[x]<d[x]&&f[x]<I[x]&&(V=2,e=f[x]),d[x]<f[x]&&d[x]<I[x]&&(V=1,e=d[x]),I[x]<d[x]&&I[x]<f[x]&&(V=0,e=I[x]),h.push([V,e,g[x].x,g[x].y]);h.sort(((E,U)=>E[2]-U[2])),h.sort(((E,U)=>E[3]-U[3])),h.sort(((E,U)=>E[1]-U[1])),h.sort(((E,U)=>E[0]-U[0]));for(let x=0;x<h.length;x++)y[h[x][2]+"|"+h[x][3]]=[h[x][0],h[x][1],x];return this.m=E,this.n=U,this.vertices=g,this.vertByDist=y,this.cartesian=F,this.min=S,this.max=u,this}}class NE{constructor(E,U,g,N){this.name=E,this.category=U,this.vertex=g,this.face=N}}class LE extends NE{innerToData(E,U){for(let g=0;g<U.innerFacets.length;g++)this.face.push(U.innerFacets[g].map((g=>U.vecToidx[E+g])))}mapABOBtoDATA(E,U){const g=U.IDATA.edgematch[E][0];for(let N=0;N<U.isoVecsABOB.length;N++){const L=[];for(let D=0;D<3;D++)0===U.vertexTypes[N][D]?L.push(E+"|"+U.isoVecsABOB[N][D].x+"|"+U.isoVecsABOB[N][D].y):L.push(g+"|"+U.isoVecsABOB[N][D].x+"|"+U.isoVecsABOB[N][D].y);this.face.push([U.vecToidx[L[0]],U.vecToidx[L[1]],U.vecToidx[L[2]]])}}mapOBOAtoDATA(E,U){const g=U.IDATA.edgematch[E][0];for(let N=0;N<U.isoVecsOBOA.length;N++){const L=[];for(let D=0;D<3;D++)1===U.vertexTypes[N][D]?L.push(E+"|"+U.isoVecsOBOA[N][D].x+"|"+U.isoVecsOBOA[N][D].y):L.push(g+"|"+U.isoVecsOBOA[N][D].x+"|"+U.isoVecsOBOA[N][D].y);this.face.push([U.vecToidx[L[0]],U.vecToidx[L[1]],U.vecToidx[L[2]]])}}mapBAOAtoDATA(E,U){const g=U.IDATA.edgematch[E][2];for(let N=0;N<U.isoVecsBAOA.length;N++){const L=[];for(let D=0;D<3;D++)1===U.vertexTypes[N][D]?L.push(E+"|"+U.isoVecsBAOA[N][D].x+"|"+U.isoVecsBAOA[N][D].y):L.push(g+"|"+U.isoVecsBAOA[N][D].x+"|"+U.isoVecsBAOA[N][D].y);this.face.push([U.vecToidx[L[0]],U.vecToidx[L[1]],U.vecToidx[L[2]]])}}orderData(E){const U=[];for(let D=0;D<13;D++)U[D]=[];const g=E.closestTo;for(let D=0;D<g.length;D++)g[D][0]>-1?g[D][1]>0&&U[g[D][0]].push([D,g[D][1]]):U[12].push([D,g[D][0]]);const N=[];for(let D=0;D<12;D++)N[D]=D;let L=12;for(let D=0;D<12;D++){U[D].sort(((E,U)=>E[1]-U[1]));for(let E=0;E<U[D].length;E++)N[U[D][E][0]]=L++}for(let D=0;D<U[12].length;D++)N[U[12][D][0]]=L++;for(let D=0;D<this.vertex.length;D++)this.vertex[D].push(N[D]);this.vertex.sort(((E,U)=>E[3]-U[3]));for(let D=0;D<this.vertex.length;D++)this.vertex[D].pop();for(let D=0;D<this.face.length;D++)for(let E=0;E<this.face[D].length;E++)this.face[D][E]=N[this.face[D][E]];this.sharedNodes=U[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(E,U){const g=[],N=[];let L=U.pop();N.push(L);let D=this.face[L].indexOf(E);D=(D+2)%3;let S=this.face[L][D];g.push(S);let u=0;for(;U.length>0;)L=U[u],this.face[L].indexOf(S)>-1?(D=(this.face[L].indexOf(S)+1)%3,S=this.face[L][D],g.push(S),N.push(L),U.splice(u,1),u=0):u++;return this.adjacentFaces.push(g),N}toGoldbergPolyhedronData(){const E=new NE("GeoDual","Goldberg",[],[]);E.name="GD dual";const U=this.vertex.length,g=new Array(U);for(let s=0;s<U;s++)g[s]=[];for(let s=0;s<this.face.length;s++)for(let E=0;E<3;E++)g[this.face[s][E]].push(s);let N=0,L=0,D=0,S=[],u=[];this.adjacentFaces=[];for(let s=0;s<g.length;s++){E.face[s]=this.setOrder(s,g[s].concat([]));for(const U of g[s]){N=0,L=0,D=0,S=this.face[U];for(let E=0;E<3;E++)u=this.vertex[S[E]],N+=u[0],L+=u[1],D+=u[2];E.vertex[U]=[N/3,L/3,D/3]}}return E}static BuildGeodesicData(E){const U=new LE("Geodesic-m-n","Geodesic",[[0,EE.e,-1],[-EE.e,1,0],[-1,0,-EE.e],[1,0,-EE.e],[EE.e,1,0],[0,EE.e,1],[-1,0,EE.e],[-EE.e,-1,0],[0,-EE.e,-1],[EE.e,-1,0],[1,0,EE.e],[0,-EE.e,1]],[]);E.setIndices(),E.calcCoeffs(),E.createInnerFacets(),E.edgeVecsABOB(),E.mapABOBtoOBOA(),E.mapABOBtoBAOA();for(let g=0;g<E.IDATA.face.length;g++)E.MapToFace(g,U),U.innerToData(g,E),"B"===E.IDATA.edgematch[g][1]&&U.mapABOBtoDATA(g,E),"O"===E.IDATA.edgematch[g][1]&&U.mapOBOAtoDATA(g,E),"A"===E.IDATA.edgematch[g][3]&&U.mapBAOAtoDATA(g,E);U.orderData(E);return U.vertex=U.vertex.map((function(E){const U=E[0],g=E[1],N=E[2],L=Math.sqrt(U*U+g*g+N*N);return E[0]*=1/L,E[1]*=1/L,E[2]*=1/L,E})),U}}L.e._GoldbergMeshParser=(E,U)=>DE.Parse(E,U);class DE extends L.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(E,U){return void 0===U?(E>this.goldbergData.nbUnsharedFaces-1&&(X.d.Warn("Maximum number of unshared faces used"),E=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+E):(E>11&&(X.d.Warn("Last pole used"),E=11),U>this.goldbergData.nbFacesAtPole-1&&(X.d.Warn("Maximum number of faces at a pole used"),U=this.goldbergData.nbFacesAtPole-1),12+E*this.goldbergData.nbFacesAtPole+U)}_changeGoldbergFaceColors(E){for(let g=0;g<E.length;g++){const U=E[g][0],N=E[g][1],L=E[g][2];for(let E=U;E<N+1;E++)this.goldbergData.faceColors[E]=L}const U=[];for(let g=0;g<12;g++)for(let E=0;E<5;E++)U.push(this.goldbergData.faceColors[g].r,this.goldbergData.faceColors[g].g,this.goldbergData.faceColors[g].b,this.goldbergData.faceColors[g].a);for(let g=12;g<this.goldbergData.faceColors.length;g++)for(let E=0;E<6;E++)U.push(this.goldbergData.faceColors[g].r,this.goldbergData.faceColors[g].g,this.goldbergData.faceColors[g].b,this.goldbergData.faceColors[g].a);return U}setGoldbergFaceColors(E){const U=this._changeGoldbergFaceColors(E);this.wE(D.f.ColorKind,U)}updateGoldbergFaceColors(E){const U=this._changeGoldbergFaceColors(E);this.updateVerticesData(D.f.ColorKind,U)}_changeGoldbergFaceUVs(E){const U=this.getVerticesData(D.f.UVKind);for(let g=0;g<E.length;g++){const N=E[g][0],L=E[g][1],D=E[g][2],S=E[g][3],u=E[g][4],s=[],C=[];let B,P;for(let E=0;E<5;E++)B=D.x+S*Math.cos(u+E*Math.PI/2.5),P=D.y+S*Math.sin(u+E*Math.PI/2.5),B<0&&(B=0),B>1&&(B=1),s.push(B,P);for(let E=0;E<6;E++)B=D.x+S*Math.cos(u+E*Math.PI/3),P=D.y+S*Math.sin(u+E*Math.PI/3),B<0&&(B=0),B>1&&(B=1),C.push(B,P);for(let E=N;E<Math.min(12,L+1);E++)for(let g=0;g<5;g++)U[10*E+2*g]=s[2*g],U[10*E+2*g+1]=s[2*g+1];for(let E=Math.max(12,N);E<L+1;E++)for(let g=0;g<6;g++)U[12*E-24+2*g]=C[2*g],U[12*E-23+2*g]=C[2*g+1]}return U}setGoldbergFaceUVs(E){const U=this._changeGoldbergFaceUVs(E);this.wE(D.f.UVKind,U)}updateGoldbergFaceUVs(E){const U=this._changeGoldbergFaceUVs(E);this.updateVerticesData(D.f.UVKind,U)}placeOnGoldbergFaceAt(E,U,g){const L=N.dU.RotationFromAxis(this.goldbergData.faceXaxis[U],this.goldbergData.faceYaxis[U],this.goldbergData.faceZaxis[U]);E.rotation=L,E.position=this.goldbergData.faceCenters[U].add(this.goldbergData.faceXaxis[U].scale(g.x)).add(this.goldbergData.faceYaxis[U].scale(g.y)).add(this.goldbergData.faceZaxis[U].scale(g.z))}serialize(E){super.serialize(E),E.type="GoldbergMesh";const U={};if(U.adjacentFaces=this.goldbergData.adjacentFaces,U.nbSharedFaces=this.goldbergData.nbSharedFaces,U.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,U.nbFaces=this.goldbergData.nbFaces,U.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){U.faceColors=[];for(const E of this.goldbergData.faceColors)U.faceColors.push(E.Og())}if(this.goldbergData.faceCenters){U.faceCenters=[];for(const E of this.goldbergData.faceCenters)U.faceCenters.push(E.Og())}if(this.goldbergData.faceZaxis){U.faceZaxis=[];for(const E of this.goldbergData.faceZaxis)U.faceZaxis.push(E.Og())}if(this.goldbergData.faceYaxis){U.faceYaxis=[];for(const E of this.goldbergData.faceYaxis)U.faceYaxis.push(E.Og())}if(this.goldbergData.faceXaxis){U.faceXaxis=[];for(const E of this.goldbergData.faceXaxis)U.faceXaxis.push(E.Og())}E.goldbergData=U}static Parse(E,U){const g=E.goldbergData;g.faceColors=g.faceColors.map((E=>F.hu.eU(E))),g.faceCenters=g.faceCenters.map((E=>N.dU.eU(E))),g.faceZaxis=g.faceZaxis.map((E=>N.dU.eU(E))),g.faceXaxis=g.faceXaxis.map((E=>N.dU.eU(E))),g.faceYaxis=g.faceYaxis.map((E=>N.dU.eU(E)));const L=new DE(E.name,U);return L.goldbergData=g,L}}var SE=g(12879);const uE={CreateBox:P.b,CreateTiledBox:y,CreateSphere:h.d,CreateDisc:B.b,CreateIcoSphere:mE,CreateRibbon:C,CreateCylinder:l,CreateTorus:t,CreateTorusKnot:b,CreateLineSystem:T.f,fC:T.h,CreateDashedLines:T.e,ExtrudeShape:c,ExtrudeShapeCustom:r,CreateLathe:Z,CreateTiledPlane:d,yC:A.d,CreateGround:w.g,CreateTiledGround:w.h,CreateGroundFromHeightMap:w.e,CreatePolygon:v.d,ExtrudePolygon:v.g,CreateTube:a,CreatePolyhedron:q,CreateGeodesic:function(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=U.m||1;N!==Math.floor(N)&&(N=Math.floor(N),X.d.Warn("m not an integer only floor(m) used"));let L=U.n||0;if(L!==Math.floor(L)&&(L=Math.floor(L),X.d.Warn("n not an integer only floor(n) used")),L>N){const E=L;L=N,N=E,X.d.Warn("n > m therefore m and n swapped")}const D=new gE;return D.build(N,L),q(E,{custom:LE.BuildGeodesicData(D),size:U.size,sizeX:U.sizeX,sizeY:U.sizeY,sizeZ:U.sizeZ,faceUV:U.faceUV,faceColors:U.faceColors,flat:U.flat,updatable:U.updatable,sideOrientation:U.sideOrientation,frontUVs:U.frontUVs,backUVs:U.backUVs},g)},CreateGoldberg:function(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=U.size,s=U.sizeX||D||1,C=U.sizeY||D||1,B=U.sizeZ||D||1;let P=U.m||1;P!==Math.floor(P)&&(P=Math.floor(P),X.d.Warn("m not an integer only floor(m) used"));let f=U.n||0;if(f!==Math.floor(f)&&(f=Math.floor(f),X.d.Warn("n not an integer only floor(n) used")),f>P){const E=f;f=P,P=E,X.d.Warn("n > m therefore m and n swapped")}const d=new gE;d.build(P,f);const I=LE.BuildGeodesicData(d),y=I.toGoldbergPolyhedronData(),h=new DE(E,g);U.sideOrientation=L.e._GetDefaultSideOrientation(U.sideOrientation),h._originalBuilderSideOrientation=U.sideOrientation;(function(E,U){const g=E.size,L=E.sizeX||g||1,D=E.sizeY||g||1,s=E.sizeZ||g||1,C=0===E.sideOrientation?0:E.sideOrientation||S.e.DEFAULTSIDE,B=[],P=[],F=[],f=[];let d=1/0,I=-1/0,y=1/0,h=-1/0;for(let N=0;N<U.vertex.length;N++)d=Math.min(d,U.vertex[N][0]*L),I=Math.max(I,U.vertex[N][0]*L),y=Math.min(y,U.vertex[N][1]*D),h=Math.max(h,U.vertex[N][1]*D);let V=0;for(let S=0;S<U.face.length;S++){const E=U.face[S],g=N.dU.eU(U.vertex[E[0]]),C=N.dU.eU(U.vertex[E[2]]),e=N.dU.eU(U.vertex[E[1]]),x=C.IU(g),l=e.IU(g),Y=N.dU.Cross(l,x).normalize();for(let N=0;N<E.length;N++){F.push(Y.x,Y.y,Y.z);const g=U.vertex[E[N]];B.push(g[0]*L,g[1]*D,g[2]*s);const S=(g[1]*D-y)/(h-y);f.push((g[0]*L-d)/(I-d),u.b?1-S:S)}for(let U=0;U<E.length-2;U++)P.push(V,V+U+2,V+U+1);V+=E.length}S.e._ComputeSides(C,B,P,F,f);const e=new S.e;return e.bE=B,e.indices=P,e.TE=F,e.oE=f,e})(U,y).rE(h,U.updatable),h.goldbergData.nbSharedFaces=I.sharedNodes,h.goldbergData.nbUnsharedFaces=I.poleNodes,h.goldbergData.adjacentFaces=I.adjacentFaces,h.goldbergData.nbFaces=h.goldbergData.nbSharedFaces+h.goldbergData.nbUnsharedFaces,h.goldbergData.nbFacesAtPole=(h.goldbergData.nbUnsharedFaces-12)/12;for(let L=0;L<I.vertex.length;L++)h.goldbergData.faceCenters.push(N.dU.eU(I.vertex[L])),h.goldbergData.faceCenters[L].x*=s,h.goldbergData.faceCenters[L].y*=C,h.goldbergData.faceCenters[L].z*=B,h.goldbergData.faceColors.push(new F.hu(1,1,1,1));for(let L=0;L<y.face.length;L++){const E=y.face[L],U=N.dU.eU(y.vertex[E[0]]),g=N.dU.eU(y.vertex[E[2]]),D=N.dU.eU(y.vertex[E[1]]),S=g.IU(U),u=D.IU(U),s=N.dU.Cross(u,S).normalize(),C=N.dU.Cross(u,s).normalize();h.goldbergData.faceXaxis.push(u.normalize()),h.goldbergData.faceYaxis.push(s),h.goldbergData.faceZaxis.push(C)}return h},CreateDecal:p,CreateCapsule:K,CreateText:SE.g}},13637:(E,U,g)=>{"use strict";g.d(U,{b:()=>uU});var N=g(12334),L=g(12721);class D extends L.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var S=g(12379),u=(g(12511),g(12292));class s{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(E){this._targetStopDuration!==E&&(this._targetStopDuration=E)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(E){this._noiseTexture!==E&&(this._noiseTexture=E,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(E){this._animationSheetEnabled!==E&&(this._animationSheetEnabled=E)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(E){this._isAnimationSheetEnabled!=E&&(this._isAnimationSheetEnabled=E,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){this._useLogarithmicDepth=E&&this.tE().getEngine().getCaps().fragmentDepthSupported}tE(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(E){switch(E){case s.BLENDMODE_MULTIPLYADD:return;case s.BLENDMODE_ADD:E=1;break;case s.BLENDMODE_ONEONE:E=6;break;case s.BLENDMODE_STANDARD:E=2;break;case s.BLENDMODE_MULTIPLY:E=4;break;case s.BLENDMODE_SUBTRACT:E=3}this._engine.setAlphaMode(E)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:N.dU.Zero()}set direction1(E){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=E)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:N.dU.Zero()}set direction2(E){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=E)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:N.dU.Zero()}set minEmitBox(E){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=E)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:N.dU.Zero()}set maxEmitBox(E){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=E)}get billboardMode(){return this._billboardMode}set billboardMode(E){this._billboardMode!==E&&(this._billboardMode=E,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(E){this._isBillboardBased!==E&&(this._isBillboardBased=E,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(E){this._attachImageProcessingConfiguration(E)}_attachImageProcessingConfiguration(E){E!==this._imageProcessingConfiguration&&(!E&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=E)}_reset(){}_removeGradientAndTexture(E,U,g){if(!U)return this;let N=0;for(const L of U){if(L.gradient===E){U.splice(N,1);break}N++}return g&&g.dispose(),this}constructor(E){this.animations=[],this.renderingGroupId=0,this.NU=N.dU.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new N.dU(10,10,10),this.onAnimationEnd=null,this.blendMode=s.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new N.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.BC=new N.dU(0,0,0),this._useLogarithmicDepth=!1,this.gravity=N.dU.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new S.hu(1,1,1,1),this.color2=new S.hu(1,1,1,1),this.colorDead=new S.hu(0,0,0,1),this.textureMask=new S.hu(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new D,this.id=E,this.name=E}createPointEmitter(E,U){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new N.dU(0,1,0),arguments.length>2&&void 0!==arguments[2]||new N.dU(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new N.dU(0,1,0),arguments.length>4&&void 0!==arguments[4]||new N.dU(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new N.dU(0,1,0),arguments.length>3&&void 0!==arguments[3]||new N.dU(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(E,U,g,N){throw new Error("Method not implemented.")}}s.BLENDMODE_ONEONE=0,s.BLENDMODE_STANDARD=1,s.BLENDMODE_ADD=2,s.BLENDMODE_MULTIPLY=3,s.BLENDMODE_MULTIPLYADD=4,s.BLENDMODE_SUBTRACT=-1,(0,u.f)("BABYLON.BaseParticleSystem",s);var C=g(12353),B=g(12188);class P{constructor(){this.direction1=new N.dU(0,1,0),this.direction2=new N.dU(0,1,0),this.minEmitBox=new N.dU(-.5,-.5,-.5),this.maxEmitBox=new N.dU(.5,.5,.5)}startDirectionFunction(E,U,g,L){const D=(0,C.RandomRange)(this.direction1.x,this.direction2.x),S=(0,C.RandomRange)(this.direction1.y,this.direction2.y),u=(0,C.RandomRange)(this.direction1.z,this.direction2.z);if(L)return U.x=D,U.y=S,void(U.z=u);N.dU.TransformNormalFromFloatsToRef(D,S,u,E,U)}startPositionFunction(E,U,g,L){const D=(0,C.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),S=(0,C.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),u=(0,C.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(L)return U.x=D,U.y=S,void(U.z=u);N.dU.TransformCoordinatesFromFloatsToRef(D,S,u,E,U)}clone(){const E=new P;return B.b.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2),E.setVector3("minEmitBox",this.minEmitBox),E.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3),E.addUniform("minEmitBox",3),E.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.Og(),E.direction2=this.direction2.Og(),E.minEmitBox=this.minEmitBox.Og(),E.maxEmitBox=this.maxEmitBox.Og(),E}parse(E){N.dU.FromArrayToRef(E.direction1,0,this.direction1),N.dU.FromArrayToRef(E.direction2,0,this.direction2),N.dU.FromArrayToRef(E.minEmitBox,0,this.minEmitBox),N.dU.FromArrayToRef(E.maxEmitBox,0,this.maxEmitBox)}}class F{get radius(){return this._radius}set radius(E){this._radius=E,this._buildHeight()}get angle(){return this._angle}set angle(E){this._angle=E,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=g,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=U,this.radius=E}startDirectionFunction(E,U,g,L){L?N.TmpVectors.dU[0].D(g.Wu).normalize():g.position.subtractToRef(E.getTranslation(),N.TmpVectors.dU[0]).normalize();const D=(0,C.RandomRange)(0,this.directionRandomizer),S=(0,C.RandomRange)(0,this.directionRandomizer),u=(0,C.RandomRange)(0,this.directionRandomizer);U.x=N.TmpVectors.dU[0].x+D,U.y=N.TmpVectors.dU[0].y+S,U.z=N.TmpVectors.dU[0].z+u,U.normalize()}startPositionFunction(E,U,g,L){const D=(0,C.RandomRange)(0,2*Math.PI);let S;this.emitFromSpawnPointOnly?S=1e-4:(S=(0,C.RandomRange)(0,this.heightRange),S=1-S*S);let u=this._radius-(0,C.RandomRange)(0,this._radius*this.radiusRange);u*=S;const s=u*Math.sin(D),B=u*Math.cos(D),P=S*this._height;if(L)return U.x=s,U.y=P,void(U.z=B);N.dU.TransformCoordinatesFromFloatsToRef(s,P,B,E,U)}clone(){const E=new F(this._radius,this._angle,this.directionRandomizer);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat2("radius",this._radius,this.radiusRange),E.setFloat("coneAngle",this._angle),E.setFloat2("height",this._height,this.heightRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",2),E.addUniform("coneAngle",1),E.addUniform("height",2),E.addUniform("directionRandomizer",1)}getEffectDefines(){let E="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(E+="\n#define CONEEMITTERSPAWNPOINT"),E}getClassName(){return"ConeParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this._radius,E.angle=this._angle,E.directionRandomizer=this.directionRandomizer,E.radiusRange=this.radiusRange,E.heightRange=this.heightRange,E.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,E}parse(E){this.radius=E.radius,this.angle=E.angle,this.directionRandomizer=E.directionRandomizer,this.radiusRange=void 0!==E.radiusRange?E.radiusRange:1,this.heightRange=void 0!==E.radiusRange?E.heightRange:1,this.emitFromSpawnPointOnly=void 0!==E.emitFromSpawnPointOnly&&E.emitFromSpawnPointOnly}}class f extends F{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0);super(E,U),this.direction1=g,this.direction2=L}startDirectionFunction(E,U){const g=(0,C.RandomRange)(this.direction1.x,this.direction2.x),L=(0,C.RandomRange)(this.direction1.y,this.direction2.y),D=(0,C.RandomRange)(this.direction1.z,this.direction2.z);N.dU.TransformNormalFromFloatsToRef(g,L,D,E,U)}clone(){const E=new f(this.radius,this.angle,this.direction1,this.direction2);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.Og(),E.direction2=this.direction2.Og(),E}parse(E){super.parse(E),this.direction1.D(E.direction1),this.direction2.D(E.direction2)}}class d{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=E,this.height=U,this.radiusRange=g,this.directionRandomizer=L,this._tempVector=N.dU.Zero()}startDirectionFunction(E,U,g,L,D){g.position.subtractToRef(E.getTranslation(),this._tempVector),this._tempVector.normalize(),N.dU.TransformNormalToRef(this._tempVector,D,this._tempVector);const S=(0,C.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let u=Math.atan2(this._tempVector.x,this._tempVector.z);u+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=S,this._tempVector.x=Math.sin(u),this._tempVector.z=Math.cos(u),this._tempVector.normalize(),L?U.D(this._tempVector):N.dU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E,U)}startPositionFunction(E,U,g,L){const D=(0,C.RandomRange)(-this.height/2,this.height/2),S=(0,C.RandomRange)(0,2*Math.PI),u=(0,C.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),s=Math.sqrt(u)*this.radius,B=s*Math.cos(S),P=s*Math.sin(S);L?U.du(B,D,P):N.dU.TransformCoordinatesFromFloatsToRef(B,D,P,E,U)}clone(){const E=new d(this.radius,this.directionRandomizer);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.height=this.height,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.height=E.height,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class I extends d{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0),D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.dU(0,1,0);super(E,U,g),this.direction1=L,this.direction2=D}startDirectionFunction(E,U,g,L){const D=(0,C.RandomRange)(this.direction1.x,this.direction2.x),S=(0,C.RandomRange)(this.direction1.y,this.direction2.y),u=(0,C.RandomRange)(this.direction1.z,this.direction2.z);L?U.du(D,S,u):N.dU.TransformNormalFromFloatsToRef(D,S,u,E,U)}clone(){const E=new I(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.Og(),E.direction2=this.direction2.Og(),E}parse(E){super.parse(E),N.dU.FromArrayToRef(E.direction1,0,this.direction1),N.dU.FromArrayToRef(E.direction2,0,this.direction2)}}class y{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=U,this.directionRandomizer=g}startDirectionFunction(E,U,g,L){const D=g.position.IU(E.getTranslation()).normalize(),S=(0,C.RandomRange)(0,this.directionRandomizer),u=(0,C.RandomRange)(0,this.directionRandomizer),s=(0,C.RandomRange)(0,this.directionRandomizer);D.x+=S,D.y+=u,D.z+=s,D.normalize(),L?U.D(D):N.dU.TransformNormalFromFloatsToRef(D.x,D.y,D.z,E,U)}startPositionFunction(E,U,g,L){const D=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),S=(0,C.RandomRange)(0,1),u=(0,C.RandomRange)(0,2*Math.PI),s=Math.acos(2*S-1),B=D*Math.cos(u)*Math.sin(s),P=D*Math.cos(s),F=D*Math.sin(u)*Math.sin(s);L?U.du(B,Math.abs(P),F):N.dU.TransformCoordinatesFromFloatsToRef(B,Math.abs(P),F,E,U)}clone(){const E=new y(this.radius,this.directionRandomizer);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class h{constructor(){this.direction1=new N.dU(0,1,0),this.direction2=new N.dU(0,1,0)}startDirectionFunction(E,U,g,L){const D=(0,C.RandomRange)(this.direction1.x,this.direction2.x),S=(0,C.RandomRange)(this.direction1.y,this.direction2.y),u=(0,C.RandomRange)(this.direction1.z,this.direction2.z);L?U.du(D,S,u):N.dU.TransformNormalFromFloatsToRef(D,S,u,E,U)}startPositionFunction(E,U,g,L){L?U.du(0,0,0):N.dU.TransformCoordinatesFromFloatsToRef(0,0,0,E,U)}clone(){const E=new h;return B.b.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.Og(),E.direction2=this.direction2.Og(),E}parse(E){N.dU.FromArrayToRef(E.direction1,0,this.direction1),N.dU.FromArrayToRef(E.direction2,0,this.direction2)}}class V{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=U,this.directionRandomizer=g}startDirectionFunction(E,U,g,L){const D=g.position.IU(E.getTranslation()).normalize(),S=(0,C.RandomRange)(0,this.directionRandomizer),u=(0,C.RandomRange)(0,this.directionRandomizer),s=(0,C.RandomRange)(0,this.directionRandomizer);D.x+=S,D.y+=u,D.z+=s,D.normalize(),L?U.D(D):N.dU.TransformNormalFromFloatsToRef(D.x,D.y,D.z,E,U)}startPositionFunction(E,U,g,L){const D=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),S=(0,C.RandomRange)(0,1),u=(0,C.RandomRange)(0,2*Math.PI),s=Math.acos(2*S-1),B=D*Math.cos(u)*Math.sin(s),P=D*Math.cos(s),F=D*Math.sin(u)*Math.sin(s);L?U.du(B,P,F):N.dU.TransformCoordinatesFromFloatsToRef(B,P,F,E,U)}clone(){const E=new V(this.radius,this.directionRandomizer);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class e extends V{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.dU(0,1,0),g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0);super(E),this.direction1=U,this.direction2=g}startDirectionFunction(E,U){const g=(0,C.RandomRange)(this.direction1.x,this.direction2.x),L=(0,C.RandomRange)(this.direction1.y,this.direction2.y),D=(0,C.RandomRange)(this.direction1.z,this.direction2.z);N.dU.TransformNormalFromFloatsToRef(g,L,D,E,U)}clone(){const E=new e(this.radius,this.direction1,this.direction2);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.Og(),E.direction2=this.direction2.Og(),E}parse(E){super.parse(E),this.direction1.D(E.direction1),this.direction2.D(E.direction2)}}class x{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(E,U,g,L){const D=N.TmpVectors.dU[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,g,D);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,g,D);const E=N.TmpVectors.dU[1];D.subtractToRef(g.position,E),E.scaleToRef(1/g.lifeTime,D)}else D.set(0,0,0);L?U.D(D):N.dU.TransformNormalToRef(D,E,U)}startPositionFunction(E,U,g,L){const D=N.TmpVectors.dU[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,g,D):D.set(0,0,0),L?U.D(D):N.dU.TransformCoordinatesToRef(D,E,U)}clone(){const E=new x;return B.b.DeepCopy(this,E),E}applyToShader(E){}buildUniformLayout(E){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.particlePositionGenerator=this.particlePositionGenerator,E.particleDestinationGenerator=this.particleDestinationGenerator,E}parse(E){E.particlePositionGenerator&&(this.particlePositionGenerator=E.particlePositionGenerator),E.particleDestinationGenerator&&(this.particleDestinationGenerator=E.particleDestinationGenerator)}}var l=g(12407);class Y{get mesh(){return this._mesh}set mesh(E){this._mesh!==E&&(this._mesh=E,E?(this._indices=E.CD(),this._positions=E.getVerticesData(l.f.PositionKind),this._normals=E.getVerticesData(l.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=N.dU.Zero(),this._mesh=null,this.direction1=new N.dU(0,1,0),this.direction2=new N.dU(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=E}startDirectionFunction(E,U,g,L){if(this.useMeshNormalsForDirection&&this._normals)return void N.dU.TransformNormalToRef(this._storedNormal,E,U);const D=(0,C.RandomRange)(this.direction1.x,this.direction2.x),S=(0,C.RandomRange)(this.direction1.y,this.direction2.y),u=(0,C.RandomRange)(this.direction1.z,this.direction2.z);L?U.du(D,S,u):N.dU.TransformNormalFromFloatsToRef(D,S,u,E,U)}startPositionFunction(E,U,g,L){if(!this._indices||!this._positions)return;const D=3*(Math.random()*(this._indices.length/3)|0),S=Math.random(),u=Math.random()*(1-S),s=1-S-u,C=this._indices[D],B=this._indices[D+1],P=this._indices[D+2],F=N.TmpVectors.dU[0],f=N.TmpVectors.dU[1],d=N.TmpVectors.dU[2],I=N.TmpVectors.dU[3];N.dU.FromArrayToRef(this._positions,3*C,F),N.dU.FromArrayToRef(this._positions,3*B,f),N.dU.FromArrayToRef(this._positions,3*P,d),I.x=S*F.x+u*f.x+s*d.x,I.y=S*F.y+u*f.y+s*d.y,I.z=S*F.z+u*f.z+s*d.z,L?U.du(I.x,I.y,I.z):N.dU.TransformCoordinatesFromFloatsToRef(I.x,I.y,I.z,E,U),this.useMeshNormalsForDirection&&this._normals&&(N.dU.FromArrayToRef(this._normals,3*C,F),N.dU.FromArrayToRef(this._normals,3*B,f),N.dU.FromArrayToRef(this._normals,3*P,d),this._storedNormal.x=S*F.x+u*f.x+s*d.x,this._storedNormal.y=S*F.y+u*f.y+s*d.y,this._storedNormal.z=S*F.z+u*f.z+s*d.z)}clone(){const E=new Y(this.mesh);return B.b.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var E;const U={};return U.type=this.getClassName(),U.direction1=this.direction1.Og(),U.direction2=this.direction2.Og(),U.meshId=null===(E=this.mesh)||void 0===E?void 0:E.id,U.useMeshNormalsForDirection=this.useMeshNormalsForDirection,U}parse(E,U){N.dU.FromArrayToRef(E.direction1,0,this.direction1),N.dU.FromArrayToRef(E.direction2,0,this.direction2),E.meshId&&U&&(this.mesh=U.getLastMeshById(E.meshId)),this.useMeshNormalsForDirection=E.useMeshNormalsForDirection}}class t{_isUbo(E){return void 0!==E.addUniform}constructor(E){this._isUbo(E)?(this.setMatrix3x3=E.updateMatrix3x3.bind(E),this.setMatrix2x2=E.updateMatrix2x2.bind(E),this.setFloat=E.updateFloat.bind(E),this.setFloat2=E.updateFloat2.bind(E),this.setFloat3=E.updateFloat3.bind(E),this.setFloat4=E.updateFloat4.bind(E),this.setFloatArray=E.updateFloatArray.bind(E),this.setArray=E.updateArray.bind(E),this.setIntArray=E.updateIntArray.bind(E),this.setMatrix=E.zg.bind(E),this.setMatrices=E.updateMatrices.bind(E),this.setVector3=E.updateVector3.bind(E),this.setVector4=E.updateVector4.bind(E),this.setColor3=E.updateColor3.bind(E),this.setColor4=E.updateColor4.bind(E),this.setDirectColor4=E.updateDirectColor4.bind(E),this.setInt=E.updateInt.bind(E),this.setInt2=E.updateInt2.bind(E),this.setInt3=E.updateInt3.bind(E),this.setInt4=E.updateInt4.bind(E)):(this.setMatrix3x3=E.setMatrix3x3.bind(E),this.setMatrix2x2=E.setMatrix2x2.bind(E),this.setFloat=E.setFloat.bind(E),this.setFloat2=E.setFloat2.bind(E),this.setFloat3=E.setFloat3.bind(E),this.setFloat4=E.setFloat4.bind(E),this.setFloatArray=E.setFloatArray.bind(E),this.setArray=E.setArray.bind(E),this.setIntArray=E.setIntArray.bind(E),this.setMatrix=E.setMatrix.bind(E),this.setMatrices=E.setMatrices.bind(E),this.setVector3=E.setVector3.bind(E),this.setVector4=E.setVector4.bind(E),this.setColor3=E.setColor3.bind(E),this.setColor4=E.setColor4.bind(E),this.setDirectColor4=E.setDirectColor4.bind(E),this.setInt=E.setInt.bind(E),this.setInt2=E.setInt2.bind(E),this.setInt3=E.setInt3.bind(E),this.setInt4=E.setInt4.bind(E))}}var G=g(12250);const b="gpuUpdateParticlesPixelShader",T="#version 300 es\nvoid main() {discard;}\n";G.e.ShadersStore[b]||(G.e.ShadersStore[b]=T);const v="gpuUpdateParticlesVertexShader",o="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";G.e.ShadersStore[v]||(G.e.ShadersStore[v]=o);(0,u.f)("BABYLON.WebGL2ParticleSystem",class{constructor(E,U){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=E,this._engine=U,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var E;return(null===(E=this._updateEffect)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof x&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=E,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new t(this._updateEffect)}createVertexBuffers(E,U){this._updateVAO.push(this._createUpdateVAO(E)),this._renderVAO.push(this._engine.recordVertexArrayObject(U,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=U}createParticleBuffer(E){return E}bindDrawBuffers(E,U,g){g?this._engine.bindBuffers(this._renderVertexBuffers,g,U):this._engine.bindVertexArrayObject(this._renderVAO[E],null)}preUpdateParticleBuffer(){const E=this._engine;if(this._engine.enableEffect(this._updateEffect),!E.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(E,U,g){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[E],null);const N=this._engine;N.bindTransformFeedbackBuffer(U.getBuffer()),N.setRasterizerState(!1),N.beginTransformFeedback(!0),N.drawArraysType(3,0,g),N.endTransformFeedback(),N.setRasterizerState(!0),N.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let E=0;E<this._updateVAO.length;E++)this._engine.releaseVertexArrayObject(this._updateVAO[E]);this._updateVAO.length=0;for(let E=0;E<this._renderVAO.length;E++)this._engine.releaseVertexArrayObject(this._renderVAO[E]);this._renderVAO.length=0}_createUpdateVAO(E){const U={};U.position=E.createVertexBuffer("position",0,3);let g=3;U.age=E.createVertexBuffer("age",g,1),g+=1,U.size=E.createVertexBuffer("size",g,3),g+=3,U.life=E.createVertexBuffer("life",g,1),g+=1,U.seed=E.createVertexBuffer("seed",g,4),g+=4,U.direction=E.createVertexBuffer("direction",g,3),g+=3,this._parent.particleEmitterType instanceof x&&(U.initialPosition=E.createVertexBuffer("initialPosition",g,3),g+=3),this._parent._colorGradientsTexture||(U.color=E.createVertexBuffer("color",g,4),g+=4),this._parent._isBillboardBased||(U.initialDirection=E.createVertexBuffer("initialDirection",g,3),g+=3),this._parent.noiseTexture&&(U.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",g,3),g+=3,U.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",g,3),g+=3),this._parent._angularSpeedGradientsTexture?(U.angle=E.createVertexBuffer("angle",g,1),g+=1):(U.angle=E.createVertexBuffer("angle",g,2),g+=2),this._parent._isAnimationSheetEnabled&&(U.cellIndex=E.createVertexBuffer("cellIndex",g,1),g+=1,this._parent.spriteRandomStartCell&&(U.cellStartOffset=E.createVertexBuffer("cellStartOffset",g,1),g+=1));const N=this._engine.recordVertexArrayObject(U,null,this._updateEffect);return this._engine.bindArrayBuffer(null),N}});class c{constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3?arguments[3]:void 0;this._engine=E,this._label=N,this._engine._storageBuffers.push(this),this._create(U,g)}_create(E,U){this._bufferSize=E,this._creationFlags=U,this._buffer=this._engine.createStorageBuffer(E,U,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(E,U,g){this._buffer&&this._engine.updateStorageBuffer(this._buffer,E,U,g)}async read(E,U,g,N){return await this._engine.readFromStorageBuffer(this._buffer,E,U,g,N)}dispose(){const E=this._engine._storageBuffers,U=E.indexOf(this);-1!==U&&(E[U]=E[E.length-1],E.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var r=g(12320),j=g(12322),Z=g(12367),A=g(12311),w=g(12638),a=g(12186),J=g(12280),q=g(12551);class M{constructor(){this._gpuTimeInFrameId=-1,this.counter=new q.e}_addDuration(E,U){E<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==E?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(U,!1),this._gpuTimeInFrameId=E):this.counter.addCount(U,!1))}}var mE=g(12234);class W{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=E,this._engine=U,this.uniqueId=w.b.UniqueId,U.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new M),this._engine.getCaps().supportComputeShaders?N.bindingsMapping?(this._context=U.createComputeContext(),this._shaderPath=g,this._options={bindingsMapping:{},defines:[],...N}):a.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):a.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(E,U){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=this._bindings[E];this._bindings[E]={type:g?0:4,object:U,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!N||N.object!==U||N.type!==this._bindings[E].type)}setStorageTexture(E,U){const g=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!g||g.object!==U),this._bindings[E]={type:1,object:U,indexInGroupEntries:null===g||void 0===g?void 0:g.indexInGroupEntries}}setExternalTexture(E,U){const g=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!g||g.object!==U),this._bindings[E]={type:6,object:U,indexInGroupEntries:null===g||void 0===g?void 0:g.indexInGroupEntries}}setVideoTexture(E,U){return!!U.externalTexture&&(this.setExternalTexture(E,U.externalTexture),!0)}setUniformBuffer(E,U){const g=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!g||g.object!==U),this._bindings[E]={type:W._BufferIsDataBuffer(U)?7:2,object:U,indexInGroupEntries:null===g||void 0===g?void 0:g.indexInGroupEntries}}setStorageBuffer(E,U){const g=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!g||g.object!==U),this._bindings[E]={type:W._BufferIsDataBuffer(U)?7:3,object:U,indexInGroupEntries:null===g||void 0===g?void 0:g.indexInGroupEntries}}setTextureSampler(E,U){const g=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!g||!U.compareSampler(g.object)),this._bindings[E]={type:5,object:U,indexInGroupEntries:null===g||void 0===g?void 0:g.indexInGroupEntries}}isReady(){let E=this._effect;for(const L in this._bindings){const E=this._bindings[L],U=E.type,g=E.object;switch(U){case 0:case 4:case 1:if(!g.isReady())return!1;break;case 6:if(!g.isReady())return!1;break}}const U=[],g=this._shaderPath;if(this._options.defines)for(let L=0;L<this._options.defines.length;L++)U.push(this._options.defines[L]);const N=U.join("\n");return this._cachedDefines!==N&&(this._cachedDefines=N,E=this._engine.createComputeEffect(g,{defines:N,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=E),!!E.isReady()}dispatch(E,U,g){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,E,U,g,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const g=W._BufferIsDataBuffer(E)?E:E.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,g,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const U in this._bindings){const g=this._bindings[U];if(!this._options.bindingsMapping[U])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+U+"'");switch(g.type){case 0:{const N=this._samplers[U],L=g.object;var E;if(!N||!L._texture||!N.compareSampler(L._texture))this._samplers[U]=(new J.c).setParameters(L.wrapU,L.wrapV,L.wrapR,L.anisotropicFilteringLevel,L._texture.samplingMode,null===(E=L._texture)||void 0===E?void 0:E._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const E=g.object;E.getBuffer()!==g.buffer&&(g.buffer=E.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((L=>{(0,mE.f)((()=>this.dispatch(E,U,g)),L,void 0,N)}))}serialize(){const E=Z.b.Serialize(this);E.options=this._options,E.shaderPath=this._shaderPath,E.KP={},E.textures={};for(const U in this._bindings){const g=this._bindings[U],N=g.object;switch(g.type){case 0:case 4:case 1:{const L=N.serialize();L&&(E.textures[U]=L,E.KP[U]={type:g.type});break}}}return E}static Parse(E,U,g){const N=Z.b.Parse((()=>new W(E.name,U.getEngine(),E.shaderPath,E.options)),E,U,g);for(const L in E.textures){const D=E.KP[L],S=A.c.Parse(E.textures[L],U,g);0===D.type?N.setTexture(L,S):4===D.type?N.setTexture(L,S,!1):N.setStorageTexture(L,S)}return N}static _BufferIsDataBuffer(E){return void 0!==E.underlyingResource}}(0,r.e)([(0,j.E)()],W.prototype,"name",void 0),(0,r.e)([(0,j.E)()],W.prototype,"fastMode",void 0),(0,u.f)("BABYLON.ComputeShader",W);var O=g(12598);const Q="gpuUpdateParticlesComputeShader",R="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";G.e.ShadersStoreWGSL[Q]||(G.e.ShadersStoreWGSL[Q]=R);(0,u.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(E,U){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=E,this._engine=U}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var E;return(null===(E=this._updateComputeShader)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){var U;const g={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(g.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(g.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(g.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(g.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(g.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(g.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(g.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new W("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:g,defines:E.split("\n")}),null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=new O.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new t(this._simParamsComputeShader)}createVertexBuffers(E,U){this._renderVertexBuffers.push(U)}createParticleBuffer(E){const U=new c(this._engine,4*E.length,11,"ComputeShaderParticleSystemBuffer");return U.update(E),this._bufferComputeShader.push(U),U.getBuffer()}bindDrawBuffers(E,U,g){this._engine.bindBuffers(this._renderVertexBuffers[E],g,U)}preUpdateParticleBuffer(){}updateParticleBuffer(E,U,g){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[E]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^E]),this._updateComputeShader.dispatch(Math.ceil(g/64))}releaseBuffers(){var E;for(let U=0;U<this._bufferComputeShader.length;++U)this._bufferComputeShader[U].dispose();this._bufferComputeShader.length=0,null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class n{constructor(E,U,g){this.gradient=E,this.color1=U,this.color2=g}getColorToRef(E){this.color2?S.hu.LerpToRef(this.color1,this.color2,Math.random(),E):E.D(this.color1)}}class k{constructor(E,U){this.gradient=E,this.color=U}}class z{constructor(E,U,g){this.gradient=E,this.factor1=U,this.factor2=g}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class i{static GetCurrentGradient(E,U,g){if(U[0].gradient>E)return void g(U[0],U[0],1);for(let L=0;L<U.length-1;L++){const N=U[L],D=U[L+1];if(E>=N.gradient&&E<=D.gradient){return void g(N,D,(E-N.gradient)/(D.gradient-N.gradient))}}const N=U.length-1;g(U[N],U[N],1)}}var p=g(12174),H=g(12811),K=g(12205);class X{constructor(E){this.particleSystem=E,this.position=N.dU.Zero(),this.direction=N.dU.Zero(),this.color=new S.hu(0,0,0,0),this.colorStep=new S.hu(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new N.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new S.hu(0,0,0,0),this._currentColor2=new S.hu(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=X._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let E=this.age,U=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===U?(U=1,E=this._randomCellOffset):E+=this._randomCellOffset);const g=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let N;N=this._initialSpriteCellLoop?(0,C.Clamp)(E*U%this.lifeTime/this.lifeTime):(0,C.Clamp)(E*U/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+N*g|0}_inheritParticleInfoToSubEmitter(E){if(E.particleSystem.NU.position){const U=E.particleSystem.NU;if(U.position.D(this.position),E.inheritDirection){const E=N.TmpVectors.dU[0];this.direction.normalizeToRef(E),U.setDirection(E,0,Math.PI/2)}}else{E.particleSystem.NU.D(this.position)}this.direction.scaleToRef(E.inheritedVelocityAmount/2,N.TmpVectors.dU[0]),E.particleSystem._inheritedVelocityOffset.D(N.TmpVectors.dU[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const E of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(E)}_reset(){this.age=0,this.id=X._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(E){E.position.D(this.position),this._initialDirection?E._initialDirection?E._initialDirection.D(this._initialDirection):E._initialDirection=this._initialDirection.clone():E._initialDirection=null,E.direction.D(this.direction),this.Wu&&(E.Wu?E.Wu.D(this.Wu):E.Wu=this.Wu.clone()),E.color.D(this.color),E.colorStep.D(this.colorStep),E.lifeTime=this.lifeTime,E.age=this.age,E._randomCellOffset=this._randomCellOffset,E.size=this.size,E.scale.D(this.scale),E.angle=this.angle,E.angularSpeed=this.angularSpeed,E.particleSystem=this.particleSystem,E.cellIndex=this.cellIndex,E.id=this.id,E._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(E._currentColorGradient=this._currentColorGradient,E._currentColor1.D(this._currentColor1),E._currentColor2.D(this._currentColor2)),this._currentSizeGradient&&(E._currentSizeGradient=this._currentSizeGradient,E._currentSize1=this._currentSize1,E._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(E._currentAngularSpeedGradient=this._currentAngularSpeedGradient,E._currentAngularSpeed1=this._currentAngularSpeed1,E._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(E._currentVelocityGradient=this._currentVelocityGradient,E._currentVelocity1=this._currentVelocity1,E._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(E._currentLimitVelocityGradient=this._currentLimitVelocityGradient,E._currentLimitVelocity1=this._currentLimitVelocity1,E._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(E._currentDragGradient=this._currentDragGradient,E._currentDrag1=this._currentDrag1,E._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(E._initialStartSpriteCellId=this._initialStartSpriteCellId,E._initialEndSpriteCellId=this._initialEndSpriteCellId,E._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(E.remapData&&this.remapData?E.remapData.D(this.remapData):E.remapData=new N.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.D(this._randomNoiseCoordinates1),E._randomNoiseCoordinates2.D(this._randomNoiseCoordinates2)):(E._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),E._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}X._Count=0;var EE=g(12450),UE=(g(12504),g(12699)),gE=g(12693),NE=g(12595);function LE(E,U){const g=(0,C.RandomRange)(0,1);S.hu.LerpToRef(U.color1,U.color2,g,E.color),U.colorDead.subtractToRef(E.color,U._colorDiff),U._colorDiff.scaleToRef(1/E.lifeTime,E.colorStep)}function DE(E,U){E._currentColorGradient=U._colorGradients[0],E._currentColorGradient.getColorToRef(E.color),E._currentColor1.D(E.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(E._currentColor2):E._currentColor2.D(E.color)}function SE(E,U){const g=U._colorGradients;i.GetCurrentGradient(U._ratio,g,((U,g,N)=>{U!==E._currentColorGradient&&(E._currentColor1.D(E._currentColor2),g.getColorToRef(E._currentColor2),E._currentColorGradient=U),S.hu.LerpToRef(E._currentColor1,E._currentColor2,N,E.color)}))}function uE(E,U){E.colorStep.scaleToRef(U._scaledUpdateSpeed,U._scaledColorStep),E.color.addInPlace(U._scaledColorStep),E.color.a<0&&(E.color.a=0)}function sE(E,U){i.GetCurrentGradient(U._ratio,U._angularSpeedGradients,((U,g,N)=>{U!==E._currentAngularSpeedGradient&&(E._currentAngularSpeed1=E._currentAngularSpeed2,E._currentAngularSpeed2=g.getFactor(),E._currentAngularSpeedGradient=U),E.angularSpeed=(0,C.Lerp)(E._currentAngularSpeed1,E._currentAngularSpeed2,N)}))}function CE(E,U){E.angle+=E.angularSpeed*U._scaledUpdateSpeed}function BE(E,U){U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,E.direction,E,U.isLocal,U._emitterInverseWorldMatrix)}function PE(E,U){U.startDirectionFunction(U._emitterWorldMatrix,E.direction,E,U.isLocal)}function FE(E,U){E._currentVelocityGradient=U._velocityGradients[0],E._currentVelocity1=E._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?E._currentVelocity2=U._velocityGradients[1].getFactor():E._currentVelocity2=E._currentVelocity1}function fE(E,U){E._currentLimitVelocityGradient=U._limitVelocityGradients[0],E._currentLimitVelocity1=E._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?E._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():E._currentLimitVelocity2=E._currentLimitVelocity1}function dE(E,U){i.GetCurrentGradient(U._ratio,U._velocityGradients,((g,N,L)=>{g!==E._currentVelocityGradient&&(E._currentVelocity1=E._currentVelocity2,E._currentVelocity2=N.getFactor(),E._currentVelocityGradient=g),U._directionScale*=(0,C.Lerp)(E._currentVelocity1,E._currentVelocity2,L)}))}function IE(E,U){i.GetCurrentGradient(U._ratio,U._limitVelocityGradients,((g,N,L)=>{g!==E._currentLimitVelocityGradient&&(E._currentLimitVelocity1=E._currentLimitVelocity2,E._currentLimitVelocity2=N.getFactor(),E._currentLimitVelocityGradient=g);const D=(0,C.Lerp)(E._currentLimitVelocity1,E._currentLimitVelocity2,L);E.direction.length()>D&&E.direction.scaleInPlace(U.limitVelocityDamping)}))}function yE(E,U){E.direction.scaleToRef(U._directionScale,U._scaledDirection)}function hE(E,U){U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,E.position,E,U.isLocal)}function VE(E,U){U.startPositionFunction(U._emitterWorldMatrix,E.position,E,U.isLocal)}function eE(E,U){E.Wu?E.Wu.D(E.position):E.Wu=E.position.clone(),N.dU.TransformCoordinatesToRef(E.Wu,U._emitterWorldMatrix,E.position)}function xE(E,U){U.isLocal&&E.Wu?(E.Wu.addInPlace(U._scaledDirection),N.dU.TransformCoordinatesToRef(E.Wu,U._emitterWorldMatrix,E.position)):E.position.addInPlace(U._scaledDirection)}function lE(E,U){E._currentDragGradient=U._dragGradients[0],E._currentDrag1=E._currentDragGradient.getFactor(),U._dragGradients.length>1?E._currentDrag2=U._dragGradients[1].getFactor():E._currentDrag2=E._currentDrag1}function YE(E,U){i.GetCurrentGradient(U._ratio,U._dragGradients,((g,N,L)=>{g!==E._currentDragGradient&&(E._currentDrag1=E._currentDrag2,E._currentDrag2=N.getFactor(),E._currentDragGradient=g);const D=(0,C.Lerp)(E._currentDrag1,E._currentDrag2,L);U._scaledDirection.scaleInPlace(1-D)}))}function tE(E,U){E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.du(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2.du(Math.random(),Math.random(),Math.random())):(E._randomNoiseCoordinates1=new N.dU(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2=new N.dU(Math.random(),Math.random(),Math.random()))}function GE(E,U){const g=U._noiseTextureData,L=U._noiseTextureSize;if(g&&L&&E._randomNoiseCoordinates1){const D=U._fetchR(E._randomNoiseCoordinates1.x,E._randomNoiseCoordinates1.y,L.width,L.height,g),S=U._fetchR(E._randomNoiseCoordinates1.z,E._randomNoiseCoordinates2.x,L.width,L.height,g),u=U._fetchR(E._randomNoiseCoordinates2.y,E._randomNoiseCoordinates2.z,L.width,L.height,g),s=N.TmpVectors.dU[0],C=N.TmpVectors.dU[1];s.du((2*D-1)*U.noiseStrength.x,(2*S-1)*U.noiseStrength.y,(2*u-1)*U.noiseStrength.z),s.scaleToRef(U._tempScaledUpdateSpeed,C),E.direction.addInPlace(C)}}function bE(E,U){U.gravity.scaleToRef(U._tempScaledUpdateSpeed,U._scaledGravity),E.direction.addInPlace(U._scaledGravity)}function TE(E,U){E.size=(0,C.RandomRange)(U.minSize,U.maxSize),E.scale.du((0,C.RandomRange)(U.minScaleX,U.maxScaleX),(0,C.RandomRange)(U.minScaleY,U.maxScaleY))}function vE(E,U){E._currentSizeGradient=U._sizeGradients[0],E._currentSize1=E._currentSizeGradient.getFactor(),E.size=E._currentSize1,U._sizeGradients.length>1?E._currentSize2=U._sizeGradients[1].getFactor():E._currentSize2=E._currentSize1,E.scale.du((0,C.RandomRange)(U.minScaleX,U.maxScaleX),(0,C.RandomRange)(U.minScaleY,U.maxScaleY))}function oE(E,U){const g=U._actualFrame/U.targetStopDuration;i.GetCurrentGradient(g,U._startSizeGradients,((g,N,L)=>{g!==U._currentStartSizeGradient&&(U._currentStartSize1=U._currentStartSize2,U._currentStartSize2=N.getFactor(),U._currentStartSizeGradient=g);const D=(0,C.Lerp)(U._currentStartSize1,U._currentStartSize2,L);E.scale.scaleInPlace(D)}))}function cE(E,U){i.GetCurrentGradient(U._ratio,U._sizeGradients,((U,g,N)=>{U!==E._currentSizeGradient&&(E._currentSize1=E._currentSize2,E._currentSize2=g.getFactor(),E._currentSizeGradient=U),E.size=(0,C.Lerp)(E._currentSize1,E._currentSize2,N)}))}function rE(E,U){E.remapData=new N.Vector4(0,1,0,1)}function jE(E,U){U._colorRemapGradients&&U._colorRemapGradients.length>0&&i.GetCurrentGradient(U._ratio,U._colorRemapGradients,((U,g,N)=>{const L=(0,C.Lerp)(U.factor1,g.factor1,N),D=(0,C.Lerp)(U.factor2,g.factor2,N);E.remapData.x=L,E.remapData.y=D-L})),U._alphaRemapGradients&&U._alphaRemapGradients.length>0&&i.GetCurrentGradient(U._ratio,U._alphaRemapGradients,((U,g,N)=>{const L=(0,C.Lerp)(U.factor1,g.factor1,N),D=(0,C.Lerp)(U.factor2,g.factor2,N);E.remapData.z=L,E.remapData.w=D-L}))}function ZE(E,U){const g=(0,C.Clamp)(U._actualFrame/U.targetStopDuration);i.GetCurrentGradient(g,U._lifeTimeGradients,((U,N)=>{const L=U,D=N,S=L.getFactor(),u=D.getFactor(),s=(g-L.gradient)/(D.gradient-L.gradient);E.lifeTime=(0,C.Lerp)(S,u,s)})),U._emitPower=(0,C.RandomRange)(U.minEmitPower,U.maxEmitPower)}function AE(E,U){E.lifeTime=(0,C.RandomRange)(U.minLifeTime,U.maxLifeTime),U._emitPower=(0,C.RandomRange)(U.minEmitPower,U.maxEmitPower)}function wE(E,U){0===U._emitPower?(E._initialDirection?E._initialDirection.D(E.direction):E._initialDirection=E.direction.clone(),E.direction.set(0,0,0)):(E._initialDirection=null,E.direction.scaleInPlace(U._emitPower)),E.direction.addInPlace(U._inheritedVelocityOffset)}function aE(E,U){E.angularSpeed=(0,C.RandomRange)(U.minAngularSpeed,U.maxAngularSpeed),E.angle=(0,C.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function JE(E,U){E._currentAngularSpeedGradient=U._angularSpeedGradients[0],E.angularSpeed=E._currentAngularSpeedGradient.getFactor(),E._currentAngularSpeed1=E.angularSpeed,U._angularSpeedGradients.length>1?E._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():E._currentAngularSpeed2=E._currentAngularSpeed1,E.angle=(0,C.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function qE(E,U){E._initialStartSpriteCellId=U.startSpriteCellID,E._initialEndSpriteCellId=U.endSpriteCellID,E._initialSpriteCellLoop=U.spriteCellLoop}function ME(E,U){E.previousItem=U.previousItem,E.nextItem=U,U.previousItem&&(U.previousItem.nextItem=E),U.previousItem=E}function mU(E,U){E.previousItem=U,E.nextItem=U.nextItem,U.nextItem&&(U.nextItem.previousItem=E),U.nextItem=E}function WE(E,U){let g=U;for(;g.nextItem;)g=g.nextItem;E.previousItem=g,E.nextItem=g.nextItem,g.nextItem=E}function OE(E){E.previousItem&&(E.previousItem.nextItem=E.nextItem),E.nextItem&&(E.nextItem.previousItem=E.previousItem)}class QE extends s{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(E){this._startDirectionFunction!==E&&(this._startDirectionFunction=E,this._directionProcessing.process=E?PE:BE)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(E){this._startPositionFunction!==E&&(this._startPositionFunction=E,this._positionCreation.process=E?VE:hE)}set onDispose(E){this._onDisposeObserver&&this.hg.remove(this._onDisposeObserver),this._onDisposeObserver=this.hg.add(E)}get C(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(E){this._useRampGradients!==E&&(this._useRampGradients=E,this._resetEffect(),E?(this._rampCreation={process:rE,previousItem:null,nextItem:null},mU(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:jE,previousItem:null,nextItem:null},mU(this._remapGradientProcessing,this._gravityProcessing)):(OE(this._rampCreation),OE(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(E){this._isLocal!==E&&(this._isLocal=E,E?(this._isLocalCreation={process:eE,previousItem:null,nextItem:null},mU(this._isLocalCreation,this._positionCreation)):OE(this._isLocalCreation))}get particles(){return this.kP}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(E){this._animationSheetEnabled!==E&&(this._animationSheetEnabled=E,E?(this._sheetCreation={process:qE,previousItem:null,nextItem:null},mU(this._sheetCreation,this._colorCreation)):OE(this._sheetCreation),this._reset())}getActiveCount(){return this.kP.length}getClassName(){return"Nf"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var E;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[U])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new EE.c(this._engine),this._customWrappers[U].effect=E,this._customWrappers[U].drawContext&&(this._customWrappers[U].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(E){if(this.noiseTexture!==E){if(this._noiseTexture=E,!E)return OE(this._noiseCreation),void OE(this._noiseProcessing);this._noiseCreation={process:tE,previousItem:null,nextItem:null},mU(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:GE,previousItem:null,nextItem:null},mU(this._noiseProcessing,this._positionProcessing)}}constructor(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(E),this._emitterInverseWorldMatrix=N.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new N.dU,this.hg=new p.b,this.onStoppedObservable=new p.b,this.onStartedObservable=new p.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.kP=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new S.hu(0,0,0,0),this._colorDiff=new S.hu(0,0,0,0),this._scaledDirection=N.dU.Zero(),this._scaledGravity=N.dU.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=E=>{},this.recycleParticle=E=>{const U=this.kP.pop();U!==E&&U.copyTo(E),this._stockParticles.push(U)},this._createParticle=()=>{let E;return 0!==this._stockParticles.length?(E=this._stockParticles.pop(),E._reset()):E=new X(this),this._prepareParticle(E),E},this.paused=!1,this._shadersLoaded=!1,this._capacity=U,this._epsilon=u,g&&"Scene"!==g.getClassName()?(this._engine=g,this.defaultProjectionMatrix=N.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=g||K.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.RP.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:AE,previousItem:null,nextItem:null},this._positionCreation={process:hE,previousItem:null,nextItem:null},mU(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:BE,previousItem:null,nextItem:null},mU(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:wE,previousItem:null,nextItem:null},mU(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:TE,previousItem:null,nextItem:null},mU(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:aE,previousItem:null,nextItem:null},mU(this._angleCreation,this._sizeCreation),this._colorCreation={process:LE,previousItem:null,nextItem:null},mU(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,s||(this._colorProcessing={process:uE,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:CE,previousItem:null,nextItem:null},mU(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:yE,previousItem:null,nextItem:null},mU(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:xE,previousItem:null,nextItem:null},mU(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:bE,previousItem:null,nextItem:null},mU(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=D,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new EE.c(this._engine)},this._customWrappers[0].effect=L,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new P,this.updateFunction=E=>{var U;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(U=this.noiseTexture.getContent())||void 0===U||U.then((E=>{this._noiseTextureData=E})));const g=E===this.kP;for(let N=0;N<E.length;N++){const U=E[N];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const L=U.age;if(U.age+=this._tempScaledUpdateSpeed,U.age>U.lifeTime){const E=U.age-L,g=U.lifeTime-L;this._tempScaledUpdateSpeed=g*this._tempScaledUpdateSpeed/E,U.age=U.lifeTime}this._ratio=U.age/U.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let D=this._updateQueueStart;for(;D;)D.process(U,this),D=D.nextItem;if(this._isAnimationSheetEnabled&&!s&&U.updateCellIndex(),U._inheritParticleInfoToSubEmitters(),U.age>=U.lifeTime){if(this._emitFromParticle(U),U._attachedSubEmitters){for(const E of U._attachedSubEmitters)E.particleSystem.disposeOnStop=!0,E.particleSystem.stop();U._attachedSubEmitters=null}this.recycleParticle(U),g&&N--}else;}}}serialize(E){throw new Error("Method not implemented.")}clone(E,U){throw new Error("Method not implemented.")}_addFactorGradient(E,U,g,N){const L=new z(U,g,N);E.push(L),E.sort(((E,U)=>E.gradient<U.gradient?-1:E.gradient>U.gradient?1:0))}_removeFactorGradient(E,U){if(!E)return;let g=0;for(const N of E){if(N.gradient===U){E.splice(g,1);break}g++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=ZE:this._lifeTimeCreation.process=AE}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:oE,previousItem:null,nextItem:null},mU(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(OE(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(E){this.targetStopDuration!==E&&(this._targetStopDuration=E,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(E,U,g){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,E,U,g),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(E){return this._removeFactorGradient(this._lifeTimeGradients,E),this._syncLifeTimeCreation(),this}addSizeGradient(E,U,g){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=vE,this._sizeGradientProcessing={process:cE,previousItem:null,nextItem:null},ME(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,E,U,g),this}removeSizeGradient(E){var U;return this._removeFactorGradient(this._sizeGradients,E),0===(null===(U=this._sizeGradients)||void 0===U?void 0:U.length)&&(OE(this._sizeGradientProcessing),this._sizeCreation.process=TE),this}addColorRemapGradient(E,U,g){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,E,U,g),this}removeColorRemapGradient(E){return this._removeFactorGradient(this._colorRemapGradients,E),this}addAlphaRemapGradient(E,U,g){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,E,U,g),this}removeAlphaRemapGradient(E){return this._removeFactorGradient(this._alphaRemapGradients,E),this}addAngularSpeedGradient(E,U,g){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=JE,this._angularSpeedGradientProcessing={process:sE,previousItem:null,nextItem:null},ME(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,E,U,g),this}removeAngularSpeedGradient(E){var U;return this._removeFactorGradient(this._angularSpeedGradients,E),0===(null===(U=this._angularSpeedGradients)||void 0===U?void 0:U.length)&&(this._angleCreation.process=aE,OE(this._angularSpeedGradientProcessing)),this}addVelocityGradient(E,U,g){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:FE,previousItem:null,nextItem:null},mU(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:dE,previousItem:null,nextItem:null},ME(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,E,U,g),this}removeVelocityGradient(E){var U;return this._removeFactorGradient(this._velocityGradients,E),0===(null===(U=this._velocityGradients)||void 0===U?void 0:U.length)&&(OE(this._velocityCreation),OE(this._velocityGradientProcessing)),this}addLimitVelocityGradient(E,U,g){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:fE,previousItem:null,nextItem:null},mU(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:IE,previousItem:null,nextItem:null},mU(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,E,U,g),this}removeLimitVelocityGradient(E){var U;return this._removeFactorGradient(this._limitVelocityGradients,E),0===(null===(U=this._limitVelocityGradients)||void 0===U?void 0:U.length)&&(OE(this._limitVelocityCreation),OE(this._limitVelocityGradientProcessing)),this}addDragGradient(E,U,g){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:lE,previousItem:null,nextItem:null},ME(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:YE,previousItem:null,nextItem:null},ME(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,E,U,g),this}removeDragGradient(E){var U;return this._removeFactorGradient(this._dragGradients,E),0===(null===(U=this._dragGradients)||void 0===U?void 0:U.length)&&(OE(this._dragCreation),OE(this._dragGradientProcessing)),this}addEmitRateGradient(E,U,g){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,E,U,g),this}removeEmitRateGradient(E){return this._removeFactorGradient(this._emitRateGradients,E),this}addStartSizeGradient(E,U,g){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,E,U,g),this._syncStartSizeCreation(),this}removeStartSizeGradient(E){return this._removeFactorGradient(this._startSizeGradients,E),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const E=new Uint8Array(4*this._rawTextureWidth),U=S.TmpColors.VU[0];for(let g=0;g<this._rawTextureWidth;g++){const N=g/this._rawTextureWidth;i.GetCurrentGradient(N,this._rampGradients,((N,L,D)=>{S.VU.LerpToRef(N.color,L.color,D,U),E[4*g]=255*U.r,E[4*g+1]=255*U.g,E[4*g+2]=255*U.b,E[4*g+3]=255}))}this._rampGradientsTexture=H.e.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((E,U)=>E.gradient<U.gradient?-1:E.gradient>U.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(E,U){this._rampGradients||(this._rampGradients=[]);const g=new k(E,U);return this._rampGradients.push(g),this._syncRampGradientTexture(),this}removeRampGradient(E){return this._removeGradientAndTexture(E,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(E,U,g){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=DE,this._colorProcessing.process=SE);const N=new n(E,U,g);return this._colorGradients.push(N),this._colorGradients.sort(((E,U)=>E.gradient<U.gradient?-1:E.gradient>U.gradient?1:0)),this}removeColorGradient(E){if(!this._colorGradients)return this;let U=0;for(const g of this._colorGradients){if(g.gradient===E){this._colorGradients.splice(U,1);break}U++}return 0===this._colorGradients.length&&(this._colorCreation.process=LE,this._colorProcessing.process=uE),this}resetDrawCache(){if(this._drawWrappers){for(const E of this._drawWrappers)if(E)for(const U of E)null===U||void 0===U||U.dispose();this._drawWrappers=[]}}_fetchR(E,U,g,N,L){return L[4*(((E=.5*Math.abs(E)+.5)*g%g|0)+((U=.5*Math.abs(U)+.5)*N%N|0)*g)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const E=this._engine,U=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*U),this._vertexBuffer=new l.d(E,this._vertexData,!0,U);let g=0;const N=this._vertexBuffer.createVertexBuffer(l.f.PositionKind,g,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.f.PositionKind]=N,g+=3;const L=this._vertexBuffer.createVertexBuffer(l.f.ColorKind,g,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.f.ColorKind]=L,g+=4;const D=this._vertexBuffer.createVertexBuffer("angle",g,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=D,g+=1;const S=this._vertexBuffer.createVertexBuffer("size",g,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=S,g+=2,this._isAnimationSheetEnabled){const E=this._vertexBuffer.createVertexBuffer("cellIndex",g,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=E,g+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const E=this._vertexBuffer.createVertexBuffer("direction",g,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=E,g+=3}if(this._useRampGradients){const E=this._vertexBuffer.createVertexBuffer("remapData",g,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=E,g+=4}let u;if(this._useInstancing){const U=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new l.d(E,U,!1,2),u=this._spriteBuffer.createVertexBuffer("offset",0,2)}else u=this._vertexBuffer.createVertexBuffer("offset",g,2,this._vertexBufferSize,this._useInstancing),g+=2;this._vertexBuffers.offset=u,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const E=[],U=[];let g=0;for(let N=0;N<this._capacity;N++)E.push(g),E.push(g+1),E.push(g+2),E.push(g),E.push(g+2),E.push(g+3),U.push(g,g+1,g+1,g+2,g+2,g+3,g+3,g,g,g+3),g+=4;this._indexBuffer=this._engine.createIndexBuffer(E),this._linesIndexBuffer=this._engine.createIndexBuffer(U)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(E)setTimeout((()=>{this.start(0)}),E);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var U;-1!==(null===(U=this.NU)||void 0===U?void 0:U.getClassName().indexOf("Mesh"))&&this.NU.pg(!0);const E=this.noiseTexture;if(E&&E.onGeneratedObservable)E.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),E.render()}))}));else for(let U=0;U<this.preWarmCycles;U++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(E))}_postStop(E){}reset(){this._stockParticles.length=0,this.kP.length=0}_appendParticleVertex(E,U,g,L){let D=E*this._vertexBufferSize;if(this._vertexData[D++]=U.position.x+this.BC.x,this._vertexData[D++]=U.position.y+this.BC.y,this._vertexData[D++]=U.position.z+this.BC.z,this._vertexData[D++]=U.color.r,this._vertexData[D++]=U.color.g,this._vertexData[D++]=U.color.b,this._vertexData[D++]=U.color.a,this._vertexData[D++]=U.angle,this._vertexData[D++]=U.scale.x*U.size,this._vertexData[D++]=U.scale.y*U.size,this._isAnimationSheetEnabled&&(this._vertexData[D++]=U.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[D++]=U.direction.x,this._vertexData[D++]=U.direction.y,this._vertexData[D++]=U.direction.z);else if(U._initialDirection){let E=U._initialDirection;this.isLocal&&(N.dU.TransformNormalToRef(E,this._emitterWorldMatrix,N.TmpVectors.dU[0]),E=N.TmpVectors.dU[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[D++]=E.x,this._vertexData[D++]=E.y,this._vertexData[D++]=E.z}else{let E=U.direction;this.isLocal&&(N.dU.TransformNormalToRef(E,this._emitterWorldMatrix,N.TmpVectors.dU[0]),E=N.TmpVectors.dU[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[D++]=E.x,this._vertexData[D++]=E.y,this._vertexData[D++]=E.z}this._useRampGradients&&U.remapData&&(this._vertexData[D++]=U.remapData.x,this._vertexData[D++]=U.remapData.y,this._vertexData[D++]=U.remapData.z,this._vertexData[D++]=U.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===g?g=this._epsilon:1===g&&(g=1-this._epsilon),0===L?L=this._epsilon:1===L&&(L=1-this._epsilon)),this._vertexData[D++]=g,this._vertexData[D++]=L)}_prepareParticle(E){}_createNewOnes(E){let U;for(let g=0;g<E&&this.kP.length!==this._capacity;g++){U=this._createParticle(),this.kP.push(U);let E=this._createQueueStart;for(;E;)E.process(U,this),E=E.nextItem;U._inheritParticleInfoToSubEmitters()}}_update(E){if(this._alive=this.kP.length>0,this.NU.position){const E=this.NU;this._emitterWorldMatrix=E.getWorldMatrix()}else{const E=this.NU;this._emitterWorldMatrix=N.Matrix.Translation(E.x,E.y,E.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.kP),this._createNewOnes(E)}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=[l.f.PositionKind,l.f.ColorKind,"angle","offset","size"];return E&&N.push("cellIndex"),U||N.push("direction"),g&&N.push("remapData"),N}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,UE.d)(N),E&&N.push("particlesInfos"),U&&N.push("logarithmicDepthConstant"),g&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(E,U){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UE.k)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&E.push("#define FOG")),this._isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),U===s.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&E.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case 2:E.push("#define BILLBOARDY");break;case 8:case 9:E.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&E.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:E.push("#define BILLBOARDMODE_ALL")}g&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,U,g){U.push(...QE._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),E.push(...QE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),g.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,NE.f)(E,this._imageProcessingConfigurationDefines),(0,NE.d)(g,this._imageProcessingConfigurationDefines))}_getWrapper(E){const U=this._getCustomDrawWrapper(E);if(null!==U&&void 0!==U&&U.effect)return U;const g=[];this.fillDefines(g,E);const N=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let L=this._drawWrappers[N];L||(L=this._drawWrappers[N]=[]);let D=L[E];D||(D=new EE.c(this._engine),D.drawContext&&(D.drawContext.useInstancing=this._useInstancing),L[E]=D);const S=g.join("\n");if(D.defines!==S){const E=[],U=[],g=[];this.fillUniformsAttributesAndSamplerNames(U,E,g),D.setEffect(this._engine.createEffect("particles",E,U,g,S,void 0,void 0,void 0,void 0,this._shaderLanguage),S)}return D}animate(){var E;let U,g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!g&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(g?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this.manualEmitCount>-1)U=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let E=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const U=this._actualFrame/this.targetStopDuration;i.GetCurrentGradient(U,this._emitRateGradients,((U,g,N)=>{U!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=g.getFactor(),this._currentEmitRateGradient=U),E=(0,C.Lerp)(this._currentEmitRate1,this._currentEmitRate2,N)}))}U=E*this._scaledUpdateSpeed|0,this._newPartsExcess+=E*this._scaledUpdateSpeed-U}if(this._newPartsExcess>1&&(U+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?U=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(U),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!g){let E=0;for(let U=0;U<this.kP.length;U++){const g=this.kP[U];this._appendParticleVertices(E,g),E+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.kP.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(E,U){this._appendParticleVertex(E++,U,0,0),this._useInstancing||(this._appendParticleVertex(E++,U,1,0),this._appendParticleVertex(E++,U,1,1),this._appendParticleVertex(E++,U,0,1))}rebuild(){var E;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(E=this._spriteBuffer)||void 0===E||E._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!QE.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(g.bind(g,13808)),Promise.resolve().then(g.bind(g,13749))])):await Promise.all([Promise.resolve().then(g.bind(g,13737)),Promise.resolve().then(g.bind(g,13729))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.NU||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==s.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(s.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(s.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(E){const U=this._getWrapper(E),g=U.effect,L=this._engine;L.enableEffect(U);const D=this.defaultViewMatrix??this._scene.getViewMatrix();if(g.setTexture("diffuseSampler",this.particleTexture),g.setMatrix("view",D),g.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();g.setFloat3("particlesInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,this.spriteCellWidth/E.width)}if(g.setVector2("translationPivot",this.translationPivot),g.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;g.setVector3("eyePosition",E.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),g.setTexture("rampSampler",this._rampGradientsTexture));const S=g.defines;var u,s,C,B,P,F;(this._scene&&((0,UE.e)(g,this,this._scene),this.applyFog&&(0,gE.f)(this._scene,void 0,g)),S.indexOf("#define BILLBOARDMODE_ALL")>=0&&(D.invertToRef(N.TmpVectors.Matrix[0]),g.setMatrix("invView",N.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?L.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,g):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,g)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?L.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,g):L.bindBuffers(this._vertexBuffers,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null,g);(this.useLogarithmicDepth&&this._scene&&(0,gE.k)(S,g,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(g),this._setEngineBasedOnBlendMode(E),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(g),this._useInstancing)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?L.drawElementsType(6,0,10,this.kP.length):L.drawArraysType(7,0,4,this.kP.length):null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?L.drawElementsType(1,0,10*this.kP.length):L.drawElementsType(0,0,6*this.kP.length);return this.kP.length}render(){if(!this.isReady()||!this.kP.length)return 0;const E=this._engine;E.setState&&(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0));let U=0;return U=this.blendMode===s.BLENDMODE_MULTIPLYADD?this._render(s.BLENDMODE_MULTIPLY)+this._render(s.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),U}_onDispose(){}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(U,g),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const E=this._scene.RP.indexOf(this);E>-1&&this._scene.RP.splice(E,1),this._scene._activeParticleSystems.dispose()}this.hg.notifyObservers(this),this.hg.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}QE.ForceGLSL=!1;var RE,nE=g(12199);!function(E){E[E.ATTACHED=0]="ATTACHED",E[E.END=1]="END"}(RE||(RE={}));class kE{constructor(E){if(this.particleSystem=E,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!E.NU||!E.NU.dispose){const U=(0,u.d)("BABYLON.AbstractMesh");E.NU=new U("SubemitterSystemEmitter",E.tE()),E._disposeEmitterOnDispose=!0}}clone(){let E=this.particleSystem.NU;if(E){if(E instanceof N.dU)E=E.clone();else if(-1!==E.getClassName().indexOf("Mesh")){E=new((0,u.d)("BABYLON.Mesh"))("",E.tE()),E.isVisible=!1}}else E=new N.dU;const U=new kE(this.particleSystem.clone(this.particleSystem.name,E));return U.particleSystem.name+="Clone",U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem._disposeEmitterOnDispose=!0,U.particleSystem.disposeOnStop=!0,U}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem=this.particleSystem.serialize(E),U}static _ParseParticleSystem(E,U,g){throw(0,nE.e)("ParseParticle")}static Parse(E,U,g){const N=E.particleSystem,L=new kE(kE._ParseParticleSystem(N,U,g,!0));return L.type=E.type,L.inheritDirection=E.inheritDirection,L.inheritedVelocityAmount=E.inheritedVelocityAmount,L.particleSystem._isSubEmitter=!0,L}dispose(){this.particleSystem.dispose()}}var zE=g(12243);function iE(E,U){const g=new h;return g.direction1=E,g.direction2=U,g}function pE(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function HE(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function KE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.dU(0,1,0),g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0);return new e(E,U,g)}function XE(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function EU(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0),D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.dU(0,1,0);return new I(E,U,g,L,D)}function UU(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new F(E,U)}function gU(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0);return new f(E,U,g,L)}const NU=N.dU.Zero(),LU=N.dU.Zero(),DU=N.dU.Zero();class SU{constructor(){this.strength=0,this.position=N.dU.Zero()}_processParticle(E,U){this.position.subtractToRef(E.position,NU);const g=NU.lengthSquared()+1;NU.normalize().scaleToRef(this.strength/g,LU),LU.scaleToRef(U._tempScaledUpdateSpeed,DU),E.direction.addInPlace(DU)}serialize(){return{position:this.position.Og(),strength:this.strength}}}class uU extends QE{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=E=>{if(!this._subEmitters||0===this._subEmitters.length)return;const U=Math.floor(Math.random()*this._subEmitters.length);for(const g of this._subEmitters[U])if(1===g.type){const U=g.clone();E._inheritParticleInfoToSubEmitter(U),U.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(U.particleSystem),U.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(E,U){const g=iE(E,U);return this.particleEmitterType=g,g}get flowMap(){return this._flowMap}set flowMap(E){this._flowMap!==E&&(this._flowMap=E,this._flowMapUpdate&&(OE(this._flowMapUpdate),this._flowMapUpdate=null),E&&(this._flowMapUpdate={process:E=>{var U;const g=null===(U=this.tE())||void 0===U?void 0:U.getTransformMatrix();this._flowMap._processParticle(E,this.flowMapStrength*this._tempScaledUpdateSpeed,g)},previousItem:null,nextItem:null},mU(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(E){this._attractors.push(E),1===this._attractors.length&&(this._attractorUpdate={process:E=>{for(const U of this._attractors)U._processParticle(E,this)},previousItem:null,nextItem:null},mU(this._attractorUpdate,this._directionProcessing))}removeAttractor(E){const U=this._attractors.indexOf(E);-1!==U&&this._attractors.splice(U,1),0===this._attractors.length&&OE(this._attractorUpdate)}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(E)}createHemisphericEmitter(){const E=pE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=HE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=KE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.dU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=XE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=EU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.dU(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=gU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,U,g,N){const L=new P;return this.particleEmitterType=L,this.direction1=E,this.direction2=U,this.minEmitBox=g,this.maxEmitBox=N,L}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const E of this.subEmitters)E instanceof uU?this._subEmitters.push([new kE(E)]):E instanceof kE?this._subEmitters.push([E]):E instanceof Array&&this._subEmitters.push(E)}_stopSubEmitters(){if(this.activeSubSystems){for(const E of this.activeSubSystems)E.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const E=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==E&&this._rootParticleSystem.activeSubSystems.splice(E,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(E){E&&this._stopSubEmitters()}_prepareParticle(E){if(this._subEmitters&&this._subEmitters.length>0){const U=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];E._attachedSubEmitters=[];for(const g of U)if(0===g.type){const U=g.clone();E._attachedSubEmitters.push(U),U.particleSystem.start()}}}_onDispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),E&&this.particles)for(const g of this.particles)if(g._attachedSubEmitters)for(let E=g._attachedSubEmitters.length-1;E>=0;E-=1)g._attachedSubEmitters[E].dispose();if(U&&this.activeSubSystems)for(let g=this.activeSubSystems.length-1;g>=0;g-=1)this.activeSubSystems[g].dispose();if(this._subEmitters&&this._subEmitters.length){for(let E=0;E<this._subEmitters.length;E++)for(const U of this._subEmitters[E])U.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.NU&&this.NU.dispose&&this.NU.dispose(!0)}static _Parse(E,U,g,L){let D;D=g instanceof zE.b?null:g;const s=(0,u.d)("BABYLON.Texture");if(s&&D&&(E.texture?U.particleTexture=s.Parse(E.texture,D,L):E.textureName&&(U.particleTexture=new s(L+E.textureName,D,!1,void 0===E.invertY||E.invertY),U.particleTexture.name=E.textureName)),E.emitterId||0===E.emitterId||void 0!==E.NU?E.emitterId&&D?U.NU=D.getLastMeshById(E.emitterId):U.NU=N.dU.eU(E.NU):U.NU=N.dU.Zero(),U.isLocal=!!E.isLocal,void 0!==E.renderingGroupId&&(U.renderingGroupId=E.renderingGroupId),void 0!==E.isBillboardBased&&(U.isBillboardBased=E.isBillboardBased),void 0!==E.billboardMode&&(U.billboardMode=E.billboardMode),void 0!==E.useLogarithmicDepth&&(U.useLogarithmicDepth=E.useLogarithmicDepth),E.animations){for(let g=0;g<E.animations.length;g++){const N=E.animations[g],L=(0,u.d)("BABYLON.Animation");L&&U.animations.push(L.Parse(N))}U.beginAnimationOnStart=E.beginAnimationOnStart,U.beginAnimationFrom=E.beginAnimationFrom,U.beginAnimationTo=E.beginAnimationTo,U.beginAnimationLoop=E.beginAnimationLoop}if(E.autoAnimate&&D&&D.beginAnimation(U,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),U.startDelay=0|E.startDelay,U.minAngularSpeed=E.minAngularSpeed,U.maxAngularSpeed=E.maxAngularSpeed,U.minSize=E.minSize,U.maxSize=E.maxSize,E.minScaleX&&(U.minScaleX=E.minScaleX,U.maxScaleX=E.maxScaleX,U.minScaleY=E.minScaleY,U.maxScaleY=E.maxScaleY),void 0!==E.preWarmCycles&&(U.preWarmCycles=E.preWarmCycles,U.preWarmStepOffset=E.preWarmStepOffset),void 0!==E.minInitialRotation&&(U.minInitialRotation=E.minInitialRotation,U.maxInitialRotation=E.maxInitialRotation),U.minLifeTime=E.minLifeTime,U.maxLifeTime=E.maxLifeTime,U.minEmitPower=E.minEmitPower,U.maxEmitPower=E.maxEmitPower,U.emitRate=E.emitRate,U.gravity=N.dU.eU(E.gravity),E.noiseStrength&&(U.noiseStrength=N.dU.eU(E.noiseStrength)),U.color1=S.hu.eU(E.color1),U.color2=S.hu.eU(E.color2),U.colorDead=S.hu.eU(E.colorDead),U.updateSpeed=E.updateSpeed,U.targetStopDuration=E.targetStopDuration,U.blendMode=E.blendMode,E.colorGradients)for(const N of E.colorGradients)U.addColorGradient(N.gradient,S.hu.eU(N.color1),N.color2?S.hu.eU(N.color2):void 0);if(E.rampGradients){for(const g of E.rampGradients)U.addRampGradient(g.gradient,S.VU.eU(g.color));U.useRampGradients=E.useRampGradients}if(E.colorRemapGradients)for(const N of E.colorRemapGradients)U.addColorRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.alphaRemapGradients)for(const N of E.alphaRemapGradients)U.addAlphaRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.sizeGradients)for(const N of E.sizeGradients)U.addSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.angularSpeedGradients)for(const N of E.angularSpeedGradients)U.addAngularSpeedGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.velocityGradients)for(const N of E.velocityGradients)U.addVelocityGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.dragGradients)for(const N of E.dragGradients)U.addDragGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.emitRateGradients)for(const N of E.emitRateGradients)U.addEmitRateGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.startSizeGradients)for(const N of E.startSizeGradients)U.addStartSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.lifeTimeGradients)for(const N of E.lifeTimeGradients)U.addLifeTimeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(E.limitVelocityGradients){for(const g of E.limitVelocityGradients)U.addLimitVelocityGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);U.limitVelocityDamping=E.limitVelocityDamping}if(E.noiseTexture&&D){const g=(0,u.d)("BABYLON.ProceduralTexture");U.noiseTexture=g.Parse(E.noiseTexture,D,L)}let C;if(E.particleEmitterType){switch(E.particleEmitterType.type){case"SphereParticleEmitter":C=new V;break;case"SphereDirectedParticleEmitter":C=new e;break;case"ConeEmitter":case"ConeParticleEmitter":C=new F;break;case"ConeDirectedParticleEmitter":C=new f;break;case"CylinderParticleEmitter":C=new d;break;case"CylinderDirectedParticleEmitter":C=new I;break;case"HemisphericParticleEmitter":C=new y;break;case"PointParticleEmitter":C=new h;break;case"MeshParticleEmitter":C=new Y;break;case"CustomParticleEmitter":C=new x;break;default:C=new P}C.parse(E.particleEmitterType,D)}else C=new P,C.parse(E,D);U.particleEmitterType=C,U.startSpriteCellID=E.startSpriteCellID,U.endSpriteCellID=E.endSpriteCellID,U.spriteCellLoop=E.spriteCellLoop??!0,U.spriteCellWidth=E.spriteCellWidth,U.spriteCellHeight=E.spriteCellHeight,U.spriteCellChangeSpeed=E.spriteCellChangeSpeed,U.spriteRandomStartCell=E.spriteRandomStartCell,U.disposeOnStop=E.disposeOnStop??!1,U.manualEmitCount=E.manualEmitCount??-1}static Parse(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=arguments.length>4?arguments[4]:void 0;const u=E.name;let s,C,B=null,P=null;if(U instanceof zE.b?s=U:(C=U,s=C.getEngine()),E.customShader&&s.createEffectForParticles){P=E.customShader;const U=P.shaderOptions.defines.length>0?P.shaderOptions.defines.join("\n"):"";B=s.createEffectForParticles(P.shaderPath.fragmentElement,P.shaderOptions.uniforms,P.shaderOptions.samplers,U)}const F=new uU(u,D||E.aU,U,B,E.isAnimationSheetEnabled);if(F.customShader=P,F._rootUrl=g,E.id&&(F.id=E.id),E.subEmitters){F.subEmitters=[];for(const N of E.subEmitters){const E=[];for(const L of N)E.push(kE.Parse(L,U,g));F.subEmitters.push(E)}}if(E.attractors)for(const S of E.attractors){const E=new SU;E.position=N.dU.eU(S.position),E.strength=S.strength,F.addAttractor(E)}return uU._Parse(E,F,U,g),E.textureMask&&(F.textureMask=S.hu.eU(E.textureMask)),E.BC&&(F.BC=N.dU.eU(E.BC)),E.preventAutoStart&&(F.preventAutoStart=E.preventAutoStart),L||F.preventAutoStart||F.start(),F}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};if(uU._Serialize(U,this,E),U.textureMask=this.textureMask.Og(),U.customShader=this.customShader,U.preventAutoStart=this.preventAutoStart,U.BC=this.BC.Og(),this.subEmitters){U.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const g of this._subEmitters){const N=[];for(const U of g)N.push(U.serialize(E));U.subEmitters.push(N)}}if(this._attractors&&this._attractors.length){U.attractors=[];for(const E of this._attractors)U.attractors.push(E.serialize())}return U}static _Serialize(E,U,g){if(E.name=U.name,E.id=U.id,E.aU=U.getCapacity(),E.disposeOnStop=U.disposeOnStop,E.manualEmitCount=U.manualEmitCount,U.NU.position){const g=U.NU;E.emitterId=g.id}else{const g=U.NU;E.NU=g.Og()}U.particleEmitterType&&(E.particleEmitterType=U.particleEmitterType.serialize()),U.particleTexture&&(g?E.texture=U.particleTexture.serialize():(E.textureName=U.particleTexture.name,E.invertY=!!U.particleTexture._invertY)),E.isLocal=U.isLocal,Z.b.AppendSerializedAnimations(U,E),E.beginAnimationOnStart=U.beginAnimationOnStart,E.beginAnimationFrom=U.beginAnimationFrom,E.beginAnimationTo=U.beginAnimationTo,E.beginAnimationLoop=U.beginAnimationLoop,E.startDelay=U.startDelay,E.renderingGroupId=U.renderingGroupId,E.isBillboardBased=U.isBillboardBased,E.billboardMode=U.billboardMode,E.minAngularSpeed=U.minAngularSpeed,E.maxAngularSpeed=U.maxAngularSpeed,E.minSize=U.minSize,E.maxSize=U.maxSize,E.minScaleX=U.minScaleX,E.maxScaleX=U.maxScaleX,E.minScaleY=U.minScaleY,E.maxScaleY=U.maxScaleY,E.minEmitPower=U.minEmitPower,E.maxEmitPower=U.maxEmitPower,E.minLifeTime=U.minLifeTime,E.maxLifeTime=U.maxLifeTime,E.emitRate=U.emitRate,E.gravity=U.gravity.Og(),E.noiseStrength=U.noiseStrength.Og(),E.color1=U.color1.Og(),E.color2=U.color2.Og(),E.colorDead=U.colorDead.Og(),E.updateSpeed=U.updateSpeed,E.targetStopDuration=U.targetStopDuration,E.blendMode=U.blendMode,E.preWarmCycles=U.preWarmCycles,E.preWarmStepOffset=U.preWarmStepOffset,E.minInitialRotation=U.minInitialRotation,E.maxInitialRotation=U.maxInitialRotation,E.startSpriteCellID=U.startSpriteCellID,E.spriteCellLoop=U.spriteCellLoop,E.endSpriteCellID=U.endSpriteCellID,E.spriteCellChangeSpeed=U.spriteCellChangeSpeed,E.spriteCellWidth=U.spriteCellWidth,E.spriteCellHeight=U.spriteCellHeight,E.spriteRandomStartCell=U.spriteRandomStartCell,E.isAnimationSheetEnabled=U.isAnimationSheetEnabled,E.useLogarithmicDepth=U.useLogarithmicDepth;const N=U.getColorGradients();if(N){E.colorGradients=[];for(const U of N){const g={gradient:U.gradient,color1:U.color1.Og()};U.color2?g.color2=U.color2.Og():g.color2=U.color1.Og(),E.colorGradients.push(g)}}const L=U.getRampGradients();if(L){E.rampGradients=[];for(const U of L){const g={gradient:U.gradient,color:U.color.Og()};E.rampGradients.push(g)}E.useRampGradients=U.useRampGradients}const D=U.getColorRemapGradients();if(D){E.colorRemapGradients=[];for(const U of D){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.colorRemapGradients.push(g)}}const S=U.getAlphaRemapGradients();if(S){E.alphaRemapGradients=[];for(const U of S){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.alphaRemapGradients.push(g)}}const u=U.getSizeGradients();if(u){E.sizeGradients=[];for(const U of u){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.sizeGradients.push(g)}}const s=U.getAngularSpeedGradients();if(s){E.angularSpeedGradients=[];for(const U of s){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.angularSpeedGradients.push(g)}}const C=U.getVelocityGradients();if(C){E.velocityGradients=[];for(const U of C){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.velocityGradients.push(g)}}const B=U.getDragGradients();if(B){E.dragGradients=[];for(const U of B){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.dragGradients.push(g)}}const P=U.getEmitRateGradients();if(P){E.emitRateGradients=[];for(const U of P){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.emitRateGradients.push(g)}}const F=U.getStartSizeGradients();if(F){E.startSizeGradients=[];for(const U of F){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.startSizeGradients.push(g)}}const f=U.getLifeTimeGradients();if(f){E.lifeTimeGradients=[];for(const U of f){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.lifeTimeGradients.push(g)}}const d=U.getLimitVelocityGradients();if(d){E.limitVelocityGradients=[];for(const U of d){const g={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?g.factor2=U.factor2:g.factor2=U.factor1,E.limitVelocityGradients.push(g)}E.limitVelocityDamping=U.limitVelocityDamping}U.noiseTexture&&(E.noiseTexture=U.noiseTexture.serialize())}clone(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let L=null;const D=this._engine;if(D.createEffectForParticles&&null!=this.customShader){L=this.customShader;const E=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"",U=D.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,E);N[0]?N[0].effect=U:this.setCustomEffect(U,0)}const S=this.serialize(g),u=uU.Parse(S,this._scene||this._engine,this._rootUrl);return u.name=E,u.customShader=L,u._customWrappers=N,void 0===U&&(U=this.NU),this.noiseTexture&&(u.noiseTexture=this.noiseTexture.clone()),u.NU=U,this.preventAutoStart||u.start(),u}}uU.BILLBOARDMODE_Y=2,uU.BILLBOARDMODE_ALL=7,uU.BILLBOARDMODE_STRETCHED=8,uU.BILLBOARDMODE_STRETCHED_LOCAL=9,kE._ParseParticleSystem=uU.Parse;var sU=g(12580),CU=g(12573),BU=g(12462);BU.c.prototype.createTransformFeedback=function(){const E=this._gl.createTransformFeedback();if(!E)throw new Error("Unable to create Transform Feedback");return E},BU.c.prototype.deleteTransformFeedback=function(E){this._gl.deleteTransformFeedback(E)},BU.c.prototype.bindTransformFeedback=function(E){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,E)},BU.c.prototype.beginTransformFeedback=function(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(E?this._gl.POINTS:this._gl.TRIANGLES)},BU.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},BU.c.prototype.setTranformFeedbackVaryings=function(E,U){this._gl.transformFeedbackVaryings(E,U,this._gl.INTERLEAVED_ATTRIBS)},BU.c.prototype.bindTransformFeedbackBuffer=function(E){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E?E.underlyingResource:null)},BU.c.prototype.readTransformFeedbackBuffer=function(E){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E)};const PU="clipPlaneFragmentDeclaration2",FU="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";G.e.IncludesShadersStore[PU]||(G.e.IncludesShadersStore[PU]=FU);g(13641),g(13646),g(13651),g(13655),g(13659),g(13666),g(13672),g(13674);const fU="gpuRenderParticlesPixelShader",dU="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";G.e.ShadersStore[fU]||(G.e.ShadersStore[fU]=dU);const IU="clipPlaneVertexDeclaration2",yU="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";G.e.IncludesShadersStore[IU]||(G.e.IncludesShadersStore[IU]=yU);g(13680),g(13682),g(13689),g(13696);const hU="gpuRenderParticlesVertexShader",VU="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";G.e.ShadersStore[hU]||(G.e.ShadersStore[hU]=VU);class eU extends s{static get IsSupported(){if(!K.b.LastCreatedEngine)return!1;const E=K.b.LastCreatedEngine.getCaps();return E.supportTransformFeedbacks||E.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(E){this._maxActiveParticleCount=Math.min(E,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(E){this.maxActiveParticleCount=E}createPointEmitter(E,U){const g=iE(E,U);return this.particleEmitterType=g,g}createHemisphericEmitter(){const E=pE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=HE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=KE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.dU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=XE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=EU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.dU(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=gU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.dU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.dU(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,U,g,N){const L=new P;return this.particleEmitterType=L,this.direction1=E,this.direction2=U,this.minEmitBox=g,this.maxEmitBox=N,L}get flowMap(){return this._flowMap}set flowMap(E){this._flowMap!==E&&(this._flowMap=E)}isReady(){if(!this.NU||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==uU.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(uU.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(uU.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";E?setTimeout((()=>{this.start(0)}),E):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var E;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[U])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new EE.c(this._engine),this._customWrappers[U].effect=E}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(E,U,g){return super._removeGradientAndTexture(E,U,g),this._releaseBuffers(),this}addColorGradient(E,U){this._colorGradients||(this._colorGradients=[]);const g=new n(E,U);return this._colorGradients.push(g),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(E&&this._colorGradients.sort(((E,U)=>E.gradient<U.gradient?-1:E.gradient>U.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(E){return this._removeGradientAndTexture(E,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const U in this._drawWrappers){var E;null===(E=this._drawWrappers[U].drawContext)||void 0===E||E.reset()}}_addFactorGradient(E,U,g){const N=new z(U,g);E.push(N),this._releaseBuffers()}addSizeGradient(E,U){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,E,U),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(E){return this._removeGradientAndTexture(E,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(E,U){if(!E)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&E.sort(((E,U)=>E.gradient<U.gradient?-1:E.gradient>U.gradient?1:0));const g=this;g[U]&&(g[U].dispose(),g[U]=null)}addAngularSpeedGradient(E,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,E,U),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(E){return this._removeGradientAndTexture(E,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(E,U){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,E,U),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(E){return this._removeGradientAndTexture(E,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(E,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,E,U),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(E){return this._removeGradientAndTexture(E,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(E,U){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,E,U),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(E){return this._removeGradientAndTexture(E,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(E){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(E),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.hg=new p.b,this.onStoppedObservable=new p.b,this.onStartedObservable=new p.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,g&&"Scene"!==g.getClassName()?(this._engine=g,this.defaultProjectionMatrix=N.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=g||K.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.RP.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,u.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,u.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,u.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,u.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new EE.c(this._engine)},this._customWrappers[0].effect=L,this._drawWrappers={0:new EE.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(U=U??{}).randomTextureSize||delete U.randomTextureSize;const S={aU:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...U},s=U;isFinite(s)&&(S.aU=s),this._capacity=S.aU,this._maxActiveParticleCount=S.aU,this._currentActiveCount=0,this._isAnimationSheetEnabled=D,this.particleEmitterType=new P;const C=Math.min(this._engine.getCaps().maxTextureSize,S.randomTextureSize);let B=[];for(let N=0;N<C;++N)B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random());this._randomTexture=new H.e(new Float32Array(B),C,1,5,g,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,B=[];for(let N=0;N<C;++N)B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random());this._randomTexture2=new H.e(new Float32Array(B),C,1,5,g,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(E,U,g){const N={};N.position=U.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let L=3;N.age=U.createVertexBuffer("age",L,1,this._attributesStrideSize,!0),L+=1,N.size=U.createVertexBuffer("size",L,3,this._attributesStrideSize,!0),L+=3,N.life=U.createVertexBuffer("life",L,1,this._attributesStrideSize,!0),L+=1,L+=4,this.billboardMode===uU.BILLBOARDMODE_STRETCHED&&(N.direction=U.createVertexBuffer("direction",L,3,this._attributesStrideSize,!0)),L+=3,this._platform.alignDataInBuffer&&(L+=1),this.particleEmitterType instanceof x&&(L+=3,this._platform.alignDataInBuffer&&(L+=1)),this._colorGradientsTexture||(N.color=U.createVertexBuffer("color",L,4,this._attributesStrideSize,!0),L+=4),this._isBillboardBased||(N.initialDirection=U.createVertexBuffer("initialDirection",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1)),this.noiseTexture&&(N.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1),N.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1)),N.angle=U.createVertexBuffer("angle",L,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?L++:L+=2,this._isAnimationSheetEnabled&&(N.cellIndex=U.createVertexBuffer("cellIndex",L,1,this._attributesStrideSize,!0),L+=1,this.spriteRandomStartCell&&(N.cellStartOffset=U.createVertexBuffer("cellStartOffset",L,1,this._attributesStrideSize,!0),L+=1)),N.offset=g.createVertexBuffer("offset",0,2),N.uv=g.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(N),this._platform.createVertexBuffers(E,N),this.resetDrawCache()}_initialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!E)return;const U=this._engine,g=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof x&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const L=this.particleEmitterType instanceof x,D=N.TmpVectors.dU[0];let S=0;for(let N=0;N<this._capacity;N++)if(g.push(0),g.push(0),g.push(0),g.push(0),g.push(0),g.push(0),g.push(0),g.push(0),g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),L?(this.particleEmitterType.particleDestinationGenerator(N,null,D),g.push(D.x),g.push(D.y),g.push(D.z)):(g.push(0),g.push(0),g.push(0)),this._platform.alignDataInBuffer&&g.push(0),S+=16,L&&(this.particleEmitterType.particlePositionGenerator(N,null,D),g.push(D.x),g.push(D.y),g.push(D.z),this._platform.alignDataInBuffer&&g.push(0),S+=4),this._colorGradientsTexture||(g.push(0),g.push(0),g.push(0),g.push(0),S+=4),this.isBillboardBased||(g.push(0),g.push(0),g.push(0),this._platform.alignDataInBuffer&&g.push(0),S+=4),this.noiseTexture&&(g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),this._platform.alignDataInBuffer&&g.push(0),g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),this._platform.alignDataInBuffer&&g.push(0),S+=8),g.push(0),S+=1,this._angularSpeedGradientsTexture||(g.push(0),S+=1),this._isAnimationSheetEnabled&&(g.push(0),S+=1,this.spriteRandomStartCell&&(g.push(0),S+=1)),this._platform.alignDataInBuffer){let E=3-(S+3&3);for(S+=E;E-- >0;)g.push(0)}const u=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),s=this._platform.createParticleBuffer(g),C=this._platform.createParticleBuffer(g);this._buffer0=new l.d(U,s,!1,this._attributesStrideSize),this._buffer1=new l.d(U,C,!1,this._attributesStrideSize),this._spriteBuffer=new l.d(U,u,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let E=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(E+="\n#define BILLBOARD"),this._colorGradientsTexture&&(E+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(E+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(E+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(E+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(E+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(E+="\n#define DRAGGRADIENTS"),this._flowMap&&(E+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(E+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(E+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(E+="\n#define NOISE"),this.isLocal&&(E+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===E||(this._cachedUpdateDefines=E,this._updateBuffer=this._platform.createUpdateBuffer(E)),this._platform.isUpdateBufferReady()}_getWrapper(E){const U=this._getCustomDrawWrapper(E);if(null!==U&&void 0!==U&&U.effect)return U;const g=[];this.fillDefines(g,E);let N=this._drawWrappers[E];N||(N=new EE.c(this._engine),N.drawContext&&(N.drawContext.useInstancing=!0),this._drawWrappers[E]=N);const L=g.join("\n");if(N.defines!==L){const E=[],U=[],g=[];this.fillUniformsAttributesAndSamplerNames(U,E,g),N.setEffect(this._engine.createEffect("gpuRenderParticles",E,U,g,L),L)}return N}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=[l.f.PositionKind,"age","life","size","angle"];return E||L.push(l.f.ColorKind),U&&L.push("cellIndex"),g||L.push("initialDirection"),N&&L.push("direction"),L.push("offset",l.f.UVKind),L}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["emitterWM","BC","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,UE.d)(N),E&&N.push("sheetInfos"),U&&N.push("logarithmicDepthConstant"),g&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UE.k)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==CU.c.FOGMODE_NONE&&E.push("#define FOG")),U===uU.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this.isLocal&&E.push("#define LOCAL"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case uU.BILLBOARDMODE_Y:E.push("#define BILLBOARDY");break;case uU.BILLBOARDMODE_STRETCHED:E.push("#define BILLBOARDSTRETCHED");break;case uU.BILLBOARDMODE_ALL:E.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&E.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),g&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,U,g){U.push(...eU._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===uU.BILLBOARDMODE_STRETCHED)),E.push(...eU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),g.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(sU.b.PrepareUniforms(E,this._imageProcessingConfigurationDefines),sU.b.PrepareSamplers(g,this._imageProcessingConfigurationDefines))}animate(){var E;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(U?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(E,U){const g=this[U];if(!E||!E.length||g)return;const N=new Float32Array(this._rawTextureWidth);for(let L=0;L<this._rawTextureWidth;L++){const U=L/this._rawTextureWidth;i.GetCurrentGradient(U,E,((E,U,g)=>{N[L]=(0,C.Lerp)(E.factor1,U.factor1,g)}))}this[U]=H.e.CreateRTexture(N,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[U].name=U.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const E=new Uint8Array(4*this._rawTextureWidth),U=S.TmpColors.hu[0];for(let g=0;g<this._rawTextureWidth;g++){const N=g/this._rawTextureWidth;i.GetCurrentGradient(N,this._colorGradients,((N,L,D)=>{S.hu.LerpToRef(N.color1,L.color1,D,U),E[4*g]=255*U.r,E[4*g+1]=255*U.g,E[4*g+2]=255*U.b,E[4*g+3]=255*U.a}))}this._colorGradientsTexture=H.e.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(E,U){var g,L,D,S;const u=this._getWrapper(E),s=u.effect;this._engine.enableEffect(u);const C=(null===(g=this._scene)||void 0===g?void 0:g.getViewMatrix())||N.Matrix.IdentityReadOnly;if(s.setMatrix("view",C),s.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),s.setTexture("diffuseSampler",this.particleTexture),s.setVector2("translationPivot",this.translationPivot),s.setVector3("BC",this.BC),this.isLocal&&s.setMatrix("emitterWM",U),this._colorGradientsTexture?s.setTexture("colorGradientSampler",this._colorGradientsTexture):s.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();s.setFloat3("sheetInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,E.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;s.setVector3("eyePosition",E.globalPosition)}const B=s.defines;if(this._scene&&((0,UE.e)(s,this,this._scene),this.applyFog&&(0,gE.f)(this._scene,void 0,s)),B.indexOf("#define BILLBOARDMODE_ALL")>=0){const E=C.clone();E.invert(),s.setMatrix("invView",E)}return this.useLogarithmicDepth&&this._scene&&(0,gE.k)(B,s,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(s),this._setEngineBasedOnBlendMode(E),this._platform.bindDrawBuffers(this._targetIndex,s,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(s),null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(S=this._scene)&&void 0!==S&&S.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(E){if(!this.NU||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!E)if(this.NU.position){E=this.NU.getWorldMatrix()}else{const U=this.NU;E=N.TmpVectors.Matrix[0],N.Matrix.TranslationToRef(U.x,U.y,U.z,E)}const U=this._engine,g=U.getDepthWrite();if(U.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const E=this.tE();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",E.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",E),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const L=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=L,U.setDepthWrite(g)}render(){let E,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!U&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const E=0|this._accumulatedCount;this._accumulatedCount-=E,this._currentActiveCount+=E}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.NU.position){E=this.NU.getWorldMatrix()}else{const U=this.NU;E=N.TmpVectors.Matrix[0],N.Matrix.TranslationToRef(U.x,U.y,U.z,E)}const L=this._engine;this.updateInAnimate||this._update(E);let D=0;return U||g||(L.setState(!1),this.forceDepthWrite&&L.setDepthWrite(!0),D=this.blendMode===uU.BLENDMODE_MULTIPLYADD?this._render(uU.BLENDMODE_MULTIPLY,E)+this._render(uU.BLENDMODE_ADD,E):this._render(this.blendMode,E),this._engine.setAlphaMode(0)),D}rebuild(){const E=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(E,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,E()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const U in this._drawWrappers){this._drawWrappers[U].dispose()}if(this._drawWrappers={},this._scene){const E=this._scene.RP.indexOf(this);E>-1&&this._scene.RP.splice(E,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let U=0;U<this._renderVertexBuffers.length;++U){const E=this._renderVertexBuffers[U];for(const U in E)E[U].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.hg.notifyObservers(this),this.hg.clear()}clone(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let L=null;const D=this._engine;if(D.createEffectForParticles&&null!=this.customShader){L=this.customShader;const E=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";N[0]=D.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,E,void 0,void 0,void 0,this)}const S=this.serialize(g),u=eU.Parse(S,this._scene||this._engine,this._rootUrl);return u.name=E,u.customShader=L,u._customWrappers=N,void 0===U&&(U=this.NU),this.noiseTexture&&(u.noiseTexture=this.noiseTexture.clone()),u.NU=U,u}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return uU._Serialize(U,this,E),U.activeParticleCount=this.activeParticleCount,U.randomTextureSize=this._randomTextureSize,U.customShader=this.customShader,U}static Parse(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const D=E.name;let S,u;U instanceof zE.b?S=U:(u=U,S=u.getEngine());const s=new eU(D,{aU:L||E.aU,randomTextureSize:E.randomTextureSize},U,null,E.isAnimationSheetEnabled);if(s._rootUrl=g,E.customShader&&S.createEffectForParticles){const U=E.customShader,g=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",N=S.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,g,void 0,void 0,void 0,s);s.setCustomEffect(N,0),s.customShader=U}return E.id&&(s.id=E.id),E.activeParticleCount&&(s.activeParticleCount=E.activeParticleCount),uU._Parse(E,s,U,g),E.preventAutoStart&&(s.preventAutoStart=E.preventAutoStart),N||s.preventAutoStart||s.start(),s}}var xU=g(12165),lU=g(13703),YU=g(12707);class tU{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(E){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const U of this.systems)U.NU=E;this._emitterNode=E}setEmitterAsSphere(E,U,g){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:E,renderingGroupId:U};const N=(0,lU.d)("emitterSphere",{diameter:E.diameter,segments:E.segments},g);N.renderingGroupId=U;const L=new YU.hU("emitterSphereMaterial",g);L.emissiveColor=E.color,N.material=L;for(const D of this.systems)D.NU=N;this._emitterNode=N}start(E){for(const U of this.systems)E&&(U.NU=E),U.start()}dispose(){for(const E of this.systems)E.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={systems:[]};for(const g of this.systems)U.systems.push(g.serialize(E));return this._emitterNode&&(U.NU=this._emitterCreationOptions),U}static Parse(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;const L=new tU,D=this.BaseAssetsUrl+"/textures/";U=U||K.b.LastCreatedScene;for(const S of E.systems)L.systems.push(g?eU.Parse(S,U,D,!0,N):uU.Parse(S,U,D,!0,N));if(E.NU){const g=E.NU.options;if("Sphere"===E.NU.kind)L.setEmitterAsSphere({diameter:g.diameter,segments:g.segments,color:S.VU.eU(g.color)},E.NU.renderingGroupId,U)}return L}}tU.BaseAssetsUrl="https://assets.babylonjs.com/particles";var GU=g(12202);class bU{static CreateDefault(E){let U,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,N=arguments.length>2?arguments[2]:void 0;U=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new eU("default system",{aU:g},N):new uU("default system",g,N),U.NU=E;const L=xU.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return U.particleTexture=new A.c(L,U.tE()),U.createConeEmitter(.1,Math.PI/4),U.color1=new S.hu(1,1,1,1),U.color2=new S.hu(1,1,1,1),U.colorDead=new S.hu(1,1,1,0),U.minSize=.1,U.maxSize=.1,U.minEmitPower=2,U.maxEmitPower=2,U.updateSpeed=1/60,U.emitRate=30,U}static CreateAsync(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;U||(U=K.b.LastCreatedScene);const L={};return U.addPendingData(L),new Promise(((D,S)=>{if(g&&!eU.IsSupported)return U.removePendingData(L),S("Particle system with GPU is not supported.");xU.Tools.LoadFile(`${bU.BaseAssetsUrl}/systems/${E}.json`,(E=>{U.removePendingData(L);const S=JSON.parse(E.toString());return D(tU.Parse(S,U,g,N))}),void 0,void 0,void 0,(()=>(U.removePendingData(L),S(`An error occurred with the creation of your particle system. Check if your type '${E}' exists.`))))}))}static ExportSet(E){const U=new tU;for(const g of E)U.systems.push(g);return U}static ParseFromFileAsync(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",D=arguments.length>5?arguments[5]:void 0;return new Promise(((S,u)=>{const s=new GU.e;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const U=JSON.parse(s.responseText);let u;u=N?eU.Parse(U,g,L,!1,D):uU.Parse(U,g,L,!1,D),E&&(u.name=E),S(u)}else u("Unable to load the particle system")})),s.open("GET",U),s.send()}))}static ParseFromSnippetAsync(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0;if("_BLANK"===E){const E=this.CreateDefault(null);return E.start(),Promise.resolve(E)}return new Promise(((D,S)=>{const u=new GU.e;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const S=JSON.parse(JSON.parse(u.responseText).jsonPayload),s=JSON.parse(S.particleSystem);let C;C=g?eU.Parse(s,U,N,!1,L):uU.Parse(s,U,N,!1,L),C.snippetId=E,D(C)}else S("Unable to load the snippet "+E)})),u.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),u.send()}))}}bU.BaseAssetsUrl=tU.BaseAssetsUrl,bU.SnippetUrl="https://snippet.babylonjs.com",bU.CreateFromSnippetAsync=bU.ParseFromSnippetAsync;var TU=g(12774),vU=g(12607),oU=g(13708);(0,oU.g)(vU.b.NAME_PARTICLESYSTEM,((E,U,g,N)=>{const L=(0,oU.i)(vU.b.NAME_PARTICLESYSTEM);if(L&&void 0!==E.RP&&null!==E.RP)for(let D=0,S=E.RP.length;D<S;D++){const S=E.RP[D];g.RP.push(L(S,U,N))}})),(0,oU.d)(vU.b.NAME_PARTICLESYSTEM,((E,U,g)=>{if(E.activeParticleCount){return eU.Parse(E,U,g)}return uU.Parse(E,U,g)})),zE.b.prototype.createEffectForParticles=function(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",D=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,B=arguments.length>9?arguments[9]:void 0,P=[],F=[];const f=[];return s?s.fillUniformsAttributesAndSamplerNames(F,P,f):(P=uU._GetAttributeNamesOrOptions(),F=uU._GetEffectCreationOptions()),-1===L.indexOf(" BILLBOARD")&&(L+="\n#define BILLBOARD\n"),null!==s&&void 0!==s&&s.isAnimationSheetEnabled&&-1===L.indexOf(" ANIMATESHEET")&&(L+="\n#define ANIMATESHEET\n"),-1===N.indexOf("diffuseSampler")&&N.push("diffuseSampler"),this.createEffect({vertex:B??(null===s||void 0===s?void 0:s.vertexShaderName)??"particles",fragmentElement:E},P,F.concat(U),f.concat(N),L,D,S,u,void 0,C,(async()=>{0===C?await Promise.resolve().then(g.bind(g,13737)):await Promise.resolve().then(g.bind(g,13808))}))},TU.e.prototype.getEmittedParticleSystems=function(){const E=[];for(let U=0;U<this.tE().RP.length;U++){const g=this.tE().RP[U];g.NU===this&&E.push(g)}return E},TU.e.prototype.getHierarchyEmittedParticleSystems=function(){const E=[],U=this.getDescendants();U.push(this);for(let g=0;g<this.tE().RP.length;g++){const N=this.tE().RP[g],L=N.NU;L.position&&-1!==U.indexOf(L)&&E.push(N)}return E};g(12675),g(12684),g(12760);g(12764),g(13710),g(12531),g(12664),g(12802);g(12529);var cU;g(13713),g(12355);!function(E){E[E.Color=2]="Color",E[E.UV=1]="UV",E[E.Random=0]="Random",E[E.Stated=3]="Stated"}(cU||(cU={}));var rU=g(12557);const jU=new N.dU(0,0,0),ZU=new N.dU(0,0,0),AU=new N.dU(0,0,0);class wU{constructor(E,U,g){this.width=E,this.height=U,this.data=g}processFlowable(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2?arguments[2]:void 0;if(!g)return;g instanceof N.Matrix?N.dU.TransformCoordinatesToRef(E.position,g,AU):(AU.x=g.x,AU.y=g.y,AU.z=g.z);const L=.5*AU.x+.5,D=1-(.5*AU.y+.5),S=Math.floor(L*this.width),u=Math.floor(D*this.height);if(S<0||S>=this.width||u<0||u>=this.height)return;const s=4*(u*this.width+S),C=this.data[s]/255*2-1,B=this.data[s+1]/255*2-1,P=this.data[s+2]/255*2-1,F=this.data[s+3]/255;jU.set(C,B,P),jU.scaleToRef(U*F,ZU),E.direction.addInPlace(ZU)}_processParticle(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=arguments.length>2?arguments[2]:void 0;this.processFlowable(E,U,g)}static async FromUrlAsync(E){return await new Promise(((U,g)=>{const N=document.createElement("canvas"),L=N.getContext("2d");let D=null;const S=new Image;S.crossOrigin="anonymous",S.src=E,S.onerror=U=>{g(new Error(`Failed to load image: ${E} : ${U}`))},S.onload=()=>{N.width=S.width,N.height=S.height,L.drawImage(S,0,0),D=L.getImageData(0,0,N.width,N.height),U(new wU(N.width,N.height,D.data))}}))}static async ExtractFromTextureAsync(E){return await new Promise(((U,g)=>{if(!E.isReady())return void E.onLoadObservable.addOnce((async()=>{try{const g=await this.ExtractFromTextureAsync(E);U(g)}catch(N){g(N)}}));const N=E.getSize();rU.i.GetTextureDataAsync(E,N.width,N.height).then((E=>{U(new wU(N.width,N.height,new Uint8ClampedArray(E)))})).catch(g)}))}}var aU,JU,qU,MU,mg,WU,OU,QU,RU;!function(E){E[E.Int=1]="Int",E[E.Float=2]="Float",E[E.Vector2=4]="Vector2",E[E.dU=8]="dU",E[E.Matrix=16]="Matrix",E[E.Particle=32]="Particle",E[E.Texture=64]="Texture",E[E.hu=128]="hu",E[E.FloatGradient=256]="FloatGradient",E[E.Vector2Gradient=512]="Vector2Gradient",E[E.Vector3Gradient=1024]="Vector3Gradient",E[E.Color4Gradient=2048]="Color4Gradient",E[E.System=4096]="System",E[E.AutoDetect=8192]="AutoDetect",E[E.BasedOnInput=16384]="BasedOnInput",E[E.Undefined=32768]="Undefined",E[E.All=65535]="All"}(aU||(aU={})),function(E){E[E.Compatible=0]="Compatible",E[E.TypeIncompatible=1]="TypeIncompatible",E[E.HierarchyIssue=2]="HierarchyIssue"}(JU||(JU={})),function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(qU||(qU={}));class nU{get direction(){return this._direction}get type(){if(this._type===aU.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===aU.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(E){this._type=E}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((E=>E.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(E,U,g){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=aU.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new p.b,this.onDisconnectionObservable=new p.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=U,this.name=E,this._direction=g}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(E){var U;return this.isConnected?null!==(U=this._connectedPoint)&&void 0!==U&&U._storedFunction?this._connectedPoint._storedFunction(E):this._connectedPoint._storedValue:this.value}canConnectTo(E){return 0===this.checkCompatibilityState(E)}checkCompatibilityState(E){const U=this._ownerBlock,g=E.ownerBlock;if(this.type!==E.type&&E.innerType!==aU.AutoDetect)return E.acceptedConnectionPointTypes&&-1!==E.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(E.excludedConnectionPointTypes&&-1!==E.excludedConnectionPointTypes.indexOf(this.type))return 1;let N=g,L=U;return 0===this.direction&&(N=U,L=g),N.isAnAncestorOf(L)?2:0}connectTo(E){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(E))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${E.ownerBlock.name}".${E.name}`;return this._endpoints.push(E),E._connectedPoint=this,this.onConnectionObservable.notifyObservers(E),E.onConnectionObservable.notifyObservers(this),this}disconnectFrom(E){const U=this._endpoints.indexOf(E);return-1===U||(this._endpoints.splice(U,1),E._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(E),E.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(E){let U=1;for(;U<aU.All;)E&U||this.excludedConnectionPointTypes.push(U),U<<=1}serialize(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U={};return U.name=this.name,U.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Og?(U.valueType="BABYLON."+this.value.getClassName(),U.value=this.value.Og()):(U.valueType="number",U.value=this.value)),E&&this.connectedPoint&&(U.inputName=this.name,U.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,U.targetConnectionName=this.connectedPoint.name,U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),U}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class kU{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(E){this._name=E}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(E){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new p.b,this.hg=new p.b,this.onInputChangedObservable=new p.b,this.visibleOnFrame=!1,this._name=E,this.uniqueId=w.b.UniqueId}_inputRename(E){return E}_outputRename(E){return E}isAnAncestorOf(E){for(const U of this._outputs)if(U.hasEndpoints)for(const g of U.endpoints){if(g.ownerBlock===E)return!0;if(g.ownerBlock.isAnAncestorOf(E))return!0}return!1}isAnAncestorOfType(E){if(this.getClassName()===E)return!0;for(const U of this._outputs)if(U.hasEndpoints)for(const g of U.endpoints)if(g.ownerBlock.isAnAncestorOfType(E))return!0;return!1}getInputByName(E){const U=this._inputs.filter((U=>U.name===E));return U.length?U[0]:null}_linkConnectionTypes(E,U){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[U]._acceptedConnectionPointType=this._inputs[E]:(this._inputs[E]._linkedConnectionSource=this._inputs[U],this._inputs[E]._isMainLinkSource=!0),this._inputs[U]._linkedConnectionSource=this._inputs[E]}registerInput(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0,D=arguments.length>5?arguments[5]:void 0;const S=new nU(E,this,0);return S.type=U,S.isOptional=g,S.defaultValue=N,S.value=N,S.valueMin=L,S.valueMax=D,this._inputs.push(S),this.onInputChangedObservable.notifyObservers(S),this}registerOutput(E,U,g){return(g=g??new nU(E,this,1)).type=U,this._outputs.push(g),this}_build(E){}_customBuildStep(E){}build(E){if(this._buildId===E.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((E=>E.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=E.buildId;for(const U of this._inputs){if(!U.connectedPoint){U.isOptional||E.notConnectedNonOptionalInputs.push(U);continue}const g=U.connectedPoint.ownerBlock;g&&g!==this&&!g.isSystem&&g.build(E)}return this._customBuildStep(E),E.verbose&&a.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(E),this.onBuildObservable.notifyObservers(this),!1}serialize(){const E={};E.customType="BABYLON."+this.getClassName(),E.id=this.uniqueId,E.name=this.name,E.visibleOnFrame=this.visibleOnFrame,E.inputs=[],E.outputs=[];for(const U of this.inputs)E.inputs.push(U.serialize());for(const U of this.outputs)E.outputs.push(U.serialize(!1));return E}_deserialize(E){this._name=E.name,this.comments=E.comments,this.visibleOnFrame=!!E.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(E)}_deserializePortDisplayNamesAndExposedOnFrame(E){const U=E.inputs,g=E.outputs;if(U)for(const N of U){const E=this.inputs.find((E=>E.name===N.name));if(!E)return;if(N.displayName&&(E.displayName=N.displayName),N.isExposedOnFrame&&(E.isExposedOnFrame=N.isExposedOnFrame,E.exposedPortPosition=N.exposedPortPosition),void 0!==N.value&&null!==N.value)if("number"===N.valueType)E.value=N.value;else{const U=(0,u.d)(N.valueType);U&&(E.value=U.eU(N.value))}}if(g)for(let N=0;N<g.length;N++){const E=g[N];E.displayName&&(this.outputs[N].displayName=E.displayName),E.isExposedOnFrame&&(this.outputs[N].isExposedOnFrame=E.isExposedOnFrame,this.outputs[N].exposedPortPosition=E.exposedPortPosition)}}clone(){const E=this.serialize(),U=(0,u.d)(E.customType);if(U){const g=new U;return g._deserialize(E),g}return null}dispose(){this.hg.notifyObservers(this),this.hg.clear();for(const E of this.inputs)E.dispose();for(const E of this.outputs)E.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function zU(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",N=arguments.length>3?arguments[3]:void 0;return(L,D)=>{let S=L._propStore;S||(S=[],L._propStore=S),S.push({propertyName:D,displayName:E,type:U,groupName:g,options:N??{},className:L.getClassName()})}}(0,r.e)([(0,j.E)("comment")],kU.prototype,"comments",void 0),function(E){E[E.Boolean=0]="Boolean",E[E.Float=1]="Float",E[E.Int=2]="Int",E[E.Vector2=3]="Vector2",E[E.List=4]="List",E[E.hu=5]="hu",E[E.SamplingMode=6]="SamplingMode",E[E.TextureFormat=7]="TextureFormat",E[E.TextureType=8]="TextureType"}(MU||(MU={})),function(E){E[E.None=0]="None",E[E.Position=1]="Position",E[E.Direction=2]="Direction",E[E.Age=3]="Age",E[E.Lifetime=4]="Lifetime",E[E.Color=5]="Color",E[E.ScaledDirection=6]="ScaledDirection",E[E.Scale=7]="Scale",E[E.AgeGradient=8]="AgeGradient",E[E.Angle=9]="Angle",E[E.SpriteCellIndex=16]="SpriteCellIndex",E[E.SpriteCellStart=17]="SpriteCellStart",E[E.SpriteCellEnd=18]="SpriteCellEnd"}(mg||(mg={})),function(E){E[E.None=0]="None",E[E.Time=1]="Time",E[E.Delta=2]="Delta",E[E.Emitter=3]="Emitter"}(WU||(WU={}));class iU{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let E="";for(const U of this.notConnectedNonOptionalInputs)E+=`input ${U.name} from block ${U.ownerBlock.name}[${U.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(E)throw"Build of Node Particle System Set failed:\n"+E}adapt(E,U){const g=E.getConnectedValue(this)||0;if(E.type===U)return g;switch(U){case aU.Vector2:return new N.Vector2(g,g);case aU.dU:return new N.dU(g,g,g);case aU.hu:return new S.hu(g,g,g,g)}return null}getContextualValue(E){if(!this.particleContext||!this.systemContext)return null;switch(E){case mg.Position:return this.particleContext.position;case mg.Direction:return this.particleContext.direction;case mg.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case mg.Color:return this.particleContext.color;case mg.Age:return this.particleContext.age;case mg.Lifetime:return this.particleContext.lifeTime;case mg.Angle:return this.particleContext.angle;case mg.Scale:return this.particleContext.scale;case mg.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case mg.SpriteCellEnd:return this.systemContext.endSpriteCellID;case mg.SpriteCellIndex:return this.particleContext.cellIndex;case mg.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.NU.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.NU.absolutePosition:this.systemContext.NU:null}getSystemValue(E){if(!this.particleContext||!this.systemContext)return null;switch(E){case WU.Time:return this.systemContext._actualFrame;case WU.Delta:return this.systemContext._scaledUpdateSpeed;case WU.Emitter:if(this.isEmitterTransformNode){return this.systemContext.NU.absolutePosition}return this.systemContext.NU}return null}}function pU(E,U,g){const N=new iU;N.yU=U;const L=E.createSystem(N);return L.canStart=()=>!0,L.NU=g.clone(),L.disposeOnStop=!0,L.start(),L}class HU extends kU{constructor(E){super(E),this.blendMode=s.BLENDMODE_ONEONE,this.aU=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",aU.Particle),this.registerInput("texture",aU.Texture),this.registerInput("onStart",aU.System,!0),this.registerInput("onEnd",aU.System,!0),this.registerOutput("system",aU.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(E){E.aU=this.aU,E.buildId=this._buildId++,this.build(E);const U=this.particle.getConnectedValue(E);return U.particleTexture=this.texture.getConnectedValue(E),U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.name=this.name,U._nodeGenerated=!0,U._targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,this.system._storedValue=this,U.canStart=()=>!this.doNoStart,U.onStartedObservable.add((g=>{const N=this.onStart.getConnectedValue(E);N&&g.onStartedObservable.addOnce((()=>{E.systemContext=U;const g=pU(N,E.yU,E.emitterPosition);this.hg.addOnce((()=>{g.dispose()}))}));const L=this.onEnd.getConnectedValue(E);L&&g.onStoppedObservable.addOnce((()=>{E.systemContext=U;const g=pU(L,E.yU,E.emitterPosition);this.hg.addOnce((()=>{g.dispose()}))}))})),this.hg.addOnce((()=>{U.dispose()})),U}serialize(){const E=super.serialize();return E.aU=this.aU,E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.doNoStart=this.doNoStart,E.targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,E}_deserialize(E){super._deserialize(E),this.aU=E.aU,this.emitRate=E.emitRate,this.doNoStart=!!E.doNoStart,void 0!==E.blendMode&&(this.blendMode=E.blendMode),void 0!==E.targetStopDuration&&(this.targetStopDuration=E.targetStopDuration),void 0!==E.startDelay&&(this.startDelay=E.startDelay)}}(0,r.e)([zU("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:s.BLENDMODE_ONEONE},{label:"Standard",value:s.BLENDMODE_STANDARD},{label:"Add",value:s.BLENDMODE_ADD},{label:"Multiply",value:s.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:s.BLENDMODE_MULTIPLYADD}]})],HU.prototype,"blendMode",void 0),(0,r.e)([zU("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],HU.prototype,"aU",void 0),(0,r.e)([zU("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HU.prototype,"emitRate",void 0),(0,r.e)([zU("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HU.prototype,"targetStopDuration",void 0),(0,r.e)([zU("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HU.prototype,"startDelay",void 0),(0,r.e)([zU("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HU.prototype,"doNoStart",void 0),(0,u.f)("BABYLON.SystemBlock",HU);class KU extends kU{get type(){if(this._type===aU.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=aU.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=aU.Vector2,this._type;case"dU":return this._type=aU.dU,this._type;case"hu":return this._type=aU.hu,this._type;case"Matrix":return this._type=aU.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===mg.None&&this._systemSource!==WU.None}get systemSource(){return this._systemSource}set systemSource(E){if(this._systemSource=E,E!==WU.None){switch(this._contextualSource=mg.None,this._type=aU.Float,E){case WU.Time:case WU.Delta:this._type=aU.Float;break;case WU.Emitter:this._type=aU.dU}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==mg.None}get contextualValue(){return this._contextualSource}set contextualValue(E){if(this._contextualSource=E,E!==mg.None){switch(this._systemSource=WU.None,E){case mg.Scale:this._type=aU.Vector2;break;case mg.Position:case mg.Direction:case mg.ScaledDirection:this._type=aU.dU;break;case mg.Color:this._type=aU.hu;break;case mg.Age:case mg.Lifetime:case mg.Angle:case mg.AgeGradient:this._type=aU.Float;break;case mg.SpriteCellEnd:case mg.SpriteCellStart:case mg.SpriteCellIndex:this._type=aU.Int}this.output&&(this.output.type=this._type)}}constructor(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:aU.AutoDetect;super(E),this._type=aU.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new p.b,this._systemSource=WU.None,this._contextualSource=mg.None,this._type=U,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",U)}get value(){return this._storedValue}set value(E){this.type===aU.Float&&this.min!==this.max&&(E=Math.max(this.min,E),E=Math.min(this.max,E)),this._storedValue=E,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(E){this._valueCallback=E}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case aU.Int:case aU.Float:this.value=0;break;case aU.Vector2:this.value=N.Vector2.Zero();break;case aU.dU:this.value=N.dU.Zero();break;case aU.hu:this.value=new S.hu(1,1,1,1);break;case aU.Matrix:this.value=N.Matrix.Identity()}}_build(E){super._build(E),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=E=>E.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=E=>E.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const E=super.serialize();return E.type=this.type,E.contextualValue=this.contextualValue,E.systemSource=this.systemSource,E.min=this.min,E.max=this.max,E.groupInInspector=this.groupInInspector,E.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Og?(E.valueType="BABYLON."+this._storedValue.getClassName(),E.value=this._storedValue.Og()):(E.valueType="number",E.value=this._storedValue)),E}_deserialize(E){if(super._deserialize(E),this._type=E.type,this.contextualValue=E.contextualValue,this.systemSource=E.systemSource||WU.None,this.min=E.min||0,this.max=E.max||0,this.groupInInspector=E.groupInInspector||"",void 0!==E.displayInInspector&&(this.displayInInspector=E.displayInInspector),E.valueType)if("number"===E.valueType)this._storedValue=E.value;else{const U=(0,u.d)(E.valueType);U&&(this._storedValue=U.eU(E.value))}}}(0,u.f)("BABYLON.ParticleInputBlock",KU);class XU extends kU{get url(){return this._url}set url(E){this._url!==E&&(this._cachedData=null,this._url=E,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(E){this._textureDataUrl!==E&&(this._cachedData=null,this._textureDataUrl=E,this._url="",this._sourceTexture=null)}set sourceTexture(E){this._sourceTexture!==E&&(this._cachedData=null,this._sourceTexture=E,this._url="",this._textureDataUrl="")}constructor(E){super(E),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",aU.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const E=this.texture._storedValue;return await new Promise(((U,g)=>{if(!E.isReady())return void E.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),U(this._cachedData)}catch(E){g(E)}}));const N=E.getSize();rU.i.GetTextureDataAsync(E,N.width,N.height).then((g=>{this._cachedData={width:N.width,height:N.height,data:new Uint8ClampedArray(g)},E.dispose(),U(this._cachedData)})).catch(g)}))}_build(E){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new A.c(this._textureDataUrl,E.yU):this.texture._storedValue=new A.c(this._url,E.yU):this.texture._storedValue=null}serialize(){const E=super.serialize();return E.url=this.url,E.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(E.textureDataUrl=this.textureDataUrl),E}_deserialize(E){super._deserialize(E),this.url=E.url,this.serializedCachedData=!!E.serializedCachedData,E.textureDataUrl&&(this.textureDataUrl=E.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,u.f)("BABYLON.ParticleTextureSourceBlock",XU);class Eg extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("position",aU.dU),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(E){const U=this.particle.getConnectedValue(E);if(this.output._storedValue=U,!this.position.isConnected)return;const g={process:g=>{E.particleContext=g,E.systemContext=U,g.position.D(this.position.getConnectedValue(E))},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g}}(0,u.f)("BABYLON.UpdatePositionBlock",Eg),function(E){E[E.Add=0]="Add",E[E.Subtract=1]="Subtract",E[E.Multiply=2]="Multiply",E[E.Divide=3]="Divide",E[E.Max=4]="Max",E[E.Min=5]="Min"}(OU||(OU={}));class Ug extends kU{constructor(E){super(E),this.operation=OU.Add,this.registerInput("left",aU.AutoDetect),this.registerInput("right",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this.output._typeConnectionSource=this.left;const U=[aU.Matrix,aU.Particle,aU.Texture,aU.System,aU.FloatGradient,aU.Color4Gradient,aU.Vector2Gradient,aU.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...U),this.right.excludedConnectionPointTypes.push(...U),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(E){let U;const g=this.left,L=this.right;if(!g.isConnected||!L.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const D=g.type===aU.Float||g.type===aU.Int,u=L.type===aU.Float||L.type===aU.Int,s=D&&u;switch(this.operation){case OU.Add:U=s?E=>g.getConnectedValue(E)+L.getConnectedValue(E):D?E=>E.adapt(g,L.type).add(L.getConnectedValue(E)):E=>g.getConnectedValue(E).add(E.adapt(L,g.type));break;case OU.Subtract:U=s?E=>g.getConnectedValue(E)-L.getConnectedValue(E):D?E=>E.adapt(g,L.type).IU(L.getConnectedValue(E)):E=>g.getConnectedValue(E).IU(E.adapt(L,g.type));break;case OU.Multiply:U=s?E=>g.getConnectedValue(E)*L.getConnectedValue(E):D?E=>E.adapt(g,L.type).multiply(L.getConnectedValue(E)):E=>g.getConnectedValue(E).multiply(E.adapt(L,g.type));break;case OU.Divide:U=s?E=>g.getConnectedValue(E)/L.getConnectedValue(E):D?E=>E.adapt(g,L.type).divide(L.getConnectedValue(E)):E=>g.getConnectedValue(E).divide(E.adapt(L,g.type));break;case OU.Min:if(s)U=E=>Math.min(g.getConnectedValue(E),L.getConnectedValue(E));else{const[E,u]=D?[L,g]:[g,L];switch(E.type){case aU.Vector2:U=U=>N.Vector2.Minimize(E.getConnectedValue(U),U.adapt(u,E.type));break;case aU.dU:U=U=>N.dU.Minimize(E.getConnectedValue(U),U.adapt(u,E.type));break;case aU.hu:U=U=>{const g=E.getConnectedValue(U),{r:N,g:L,b:D,a:s}=U.adapt(u,E.type);return new S.hu(Math.min(g.r,N),Math.min(g.g,L),Math.min(g.b,D),Math.min(g.a,s))}}}break;case OU.Max:if(!s){const[E,u]=D?[L,g]:[g,L];switch(E.type){case aU.Vector2:U=U=>N.Vector2.Maximize(E.getConnectedValue(U),U.adapt(u,E.type));break;case aU.dU:U=U=>N.dU.Maximize(E.getConnectedValue(U),U.adapt(u,E.type));break;case aU.hu:U=U=>{const g=E.getConnectedValue(U),{r:N,g:L,b:D,a:s}=U.adapt(u,E.type);return new S.hu(Math.max(g.r,N),Math.min(g.g,L),Math.min(g.b,D),Math.min(g.a,s))}}break}U=E=>Math.max(g.getConnectedValue(E),L.getConnectedValue(E))}this.output._storedFunction=E=>g.type===aU.Int?0|U(E):U(E)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===aU.Int||this.left.type===aU.Float&&this.right.type!==aU.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[E,U]of[[this.left,this.right],[this.right,this.left]])E.acceptedConnectionPointTypes=[aU.Int,aU.Float],U.isConnected&&(E.acceptedConnectionPointTypes.push(U.type),U.type!==aU.Int&&U.type!==aU.Float||E.acceptedConnectionPointTypes.push(aU.Vector2,aU.dU,aU.hu))}dispose(){super.dispose();for(const E of this._connectionObservers)E.remove();this._connectionObservers.length=0}serialize(){const E=super.serialize();return E.operation=this.operation,E}_deserialize(E){super._deserialize(E),this.operation=E.operation}}(0,r.e)([zU("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:OU.Add},{label:"Subtract",value:OU.Subtract},{label:"Multiply",value:OU.Multiply},{label:"Divide",value:OU.Divide},{label:"Max",value:OU.Max},{label:"Min",value:OU.Min}]})],Ug.prototype,"operation",void 0),(0,u.f)("BABYLON.ParticleMathBlock",Ug);class gg extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("direction1",aU.dU,!0,new N.dU(0,1,0)),this.registerInput("direction2",aU.dU,!0,new N.dU(0,1,0)),this.registerInput("minEmitBox",aU.dU,!0,new N.dU(-.5,-.5,-.5)),this.registerInput("maxEmitBox",aU.dU,!0,new N.dU(.5,.5,.5)),this.registerOutput("output",aU.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(E){const U=this.particle.getConnectedValue(E);U._directionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.direction1.getConnectedValue(E),D=this.direction2.getConnectedValue(E),S=(0,C.RandomRange)(L.x,D.x),u=(0,C.RandomRange)(L.y,D.y),s=(0,C.RandomRange)(L.z,D.z);E.isEmitterTransformNode?N.dU.TransformNormalFromFloatsToRef(S,u,s,E.emitterWorldMatrix,g.direction):g.direction.du(S,u,s)},U._positionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.minEmitBox.getConnectedValue(E),D=this.maxEmitBox.getConnectedValue(E),S=(0,C.RandomRange)(L.x,D.x),u=(0,C.RandomRange)(L.y,D.y),s=(0,C.RandomRange)(L.z,D.z);E.isEmitterTransformNode?N.dU.TransformCoordinatesFromFloatsToRef(S,u,s,E.emitterWorldMatrix,g.position):(g.position.du(S,u,s),g.position.addInPlace(E.emitterPosition))},this.output._storedValue=U}}(0,u.f)("BABYLON.BoxShapeBlock",gg);class Ng extends kU{constructor(E){super(E),this.registerInput("emitPower",aU.Float,!0,1),this.registerInput("lifeTime",aU.Float,!0,1),this.registerInput("color",aU.hu,!0,new S.hu(1,1,1,1)),this.registerInput("scale",aU.Vector2,!0,new N.Vector2(1,1)),this.registerInput("angle",aU.Float,!0,0),this.registerOutput("particle",aU.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(E){const U=new uU(this.name,E.aU,E.yU,null,!1,void 0,!0);U.particleEmitterType=new h,U._lifeTimeCreation.process=(U,g)=>{E.particleContext=U,U.lifeTime=this.lifeTime.getConnectedValue(E),g._emitPower=this.emitPower.getConnectedValue(E)},U._colorCreation.process=U=>{E.particleContext=U,U.color.D(this.color.getConnectedValue(E))},U._sizeCreation.process=U=>{E.particleContext=U,U.size=1,U.scale.D(this.scale.getConnectedValue(E))},U._angleCreation.process=U=>{E.particleContext=U,U.angle=this.angle.getConnectedValue(E)},this.particle._storedValue=U}}(0,u.f)("BABYLON.CreateParticleBlock",Ng);class Lg{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const E=[];for(const U of this.attachedBlocks)U.isInput&&E.push(U);return E}constructor(E){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new p.b,this.name=E}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(E)&&this.attachedBlocks.push(E);for(const g of E.inputs){const N=g.connectedPoint;if(N){const g=N.ownerBlock;g!==E&&this._initializeBlock(g,U)}}}async buildAsync(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((g=>{const N=new tU;for(const E of this._systemBlocks)this._initializeBlock(E);for(const L of this.systemBlocks){const g=new iU;g.buildId=this._buildId++,g.yU=E,g.verbose=U;const D=L.createSystem(g);g.emitErrors(),N.systems.push(D)}this.onBuildObservable.notifyObservers(this),g(N)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const E=new HU("Particle system"),U=new Eg("Update position");U.output.connectTo(E.particle);const g=new KU("Position");g.contextualValue=mg.Position;const N=new KU("Scaled direction");N.contextualValue=mg.ScaledDirection;const L=new Ug("Add");L.operation=OU.Add,g.output.connectTo(L.left),N.output.connectTo(L.right),L.output.connectTo(U.position);const D=new Ng("Create particle"),S=new gg("Box shape");D.particle.connectTo(S.particle),S.output.connectTo(U.particle);const u=new XU("Texture");u.texture.connectTo(E.texture),u.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(E)}removeBlock(E){const U=this.attachedBlocks.indexOf(E);if(U>-1&&this.attachedBlocks.splice(U,1),E.isSystem){const U=this._systemBlocks.indexOf(E);U>-1&&this._systemBlocks.splice(U,1)}}parseSerializedObject(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U||this.clear();const g={};for(const N of E.BB){const E=(0,u.d)(N.customType);if(E){const U=new E;U._deserialize(N),g[N.id]=U,this.attachedBlocks.push(U),U.isSystem&&this._systemBlocks.push(U)}}for(const N of this.attachedBlocks)if(N.isTeleportOut){const E=N,U=E._tempEntryPointUniqueId;if(U){const N=g[U];N&&N.attachToEndpoint(E)}}for(let N=0;N<E.BB.length;N++){const L=E.BB[N],D=g[L.id];D&&(D.inputs.length&&L.inputs.some((E=>E.targetConnectionName))&&!U||this._restoreConnections(D,E,g))}if(E.locations||E.editorData&&E.editorData.locations){const N=E.locations||E.editorData.locations;for(const E of N)g[E.FL]&&(E.FL=g[E.FL].uniqueId);U&&this.editorData&&this.editorData.locations&&N.concat(this.editorData.locations),E.locations?this.editorData={locations:N}:(this.editorData=E.editorData,this.editorData.locations=N);const L=[];for(const E in g)L[E]=g[E].uniqueId;this.editorData.map=L}this.comment=E.comment}_restoreConnections(E,U,g){for(const N of E.outputs)for(const L of U.BB){const D=g[L.id];if(D)for(const S of L.inputs)if(g[S.targetBlockId]!==E||S.targetConnectionName!==N.name);else{const E=D.getInputByName(S.inputName);if(!E||E.isConnected)continue;N.connectTo(E,!0),this._restoreConnections(D,U,g)}}}serialize(E){const U=E?{}:Z.b.Serialize(this);U.editorData=JSON.parse(JSON.stringify(this.editorData));let g=[];E?g=E:U.customType="BABYLON.NodeParticleSystemSet",U.BB=[];for(const N of g)U.BB.push(N.serialize());if(!E)for(const N of this.attachedBlocks)-1===g.indexOf(N)&&U.BB.push(N.serialize());return U}dispose(){for(const E of this.attachedBlocks)E.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(E){const U=new Lg(E);return U.setToDefault(),U}static Parse(E){const U=Z.b.Parse((()=>new Lg(E.name)),E,null);return U.parseSerializedObject(E),U}static ParseFromSnippetAsync(E,U){return"_BLANK"===E?Promise.resolve(Lg.CreateDefault("blank")):new Promise(((g,N)=>{const L=new GU.e;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const S=JSON.parse(JSON.parse(L.responseText).jsonPayload),u=JSON.parse(S.nodeParticle);U||(U=Z.b.Parse((()=>new Lg(E)),u,null)),U.parseSerializedObject(u),U.snippetId=E;try{g(U)}catch(D){N(D)}}else N("Unable to load the snippet "+E)})),L.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),L.send()}))}}Lg.EditorURL=`${xU.Tools._DefaultCdnUrl}/v${zE.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Lg.SnippetUrl="https://snippet.babylonjs.com",(0,r.e)([(0,j.E)()],Lg.prototype,"name",void 0),(0,r.e)([(0,j.E)("comment")],Lg.prototype,"comment",void 0),function(E){E[E.None=0]="None",E[E.PerParticle=1]="PerParticle",E[E.PerSystem=2]="PerSystem"}(QU||(QU={}));class Dg extends kU{constructor(E){super(E),this._currentLockId=-2,this.lockMode=QU.PerParticle,this.registerInput("min",aU.AutoDetect,!0,0),this.registerInput("max",aU.AutoDetect,!0,1),this.registerOutput("output",aU.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(aU.Float|aU.Int|aU.Vector2|aU.dU|aU.hu),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(aU.Float|aU.Int|aU.Vector2|aU.dU|aU.hu),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=aU.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let E=null;switch(this._currentLockId=-2,this.min.type){case aU.AutoDetect:case aU.Int:case aU.Float:E=E=>{const U=this.min.getConnectedValue(E)||0,g=this.max.getConnectedValue(E)||1;return U+Math.random()*(g-U)};break;case aU.Vector2:E=E=>{const U=this.min.getConnectedValue(E)||N.Vector2.Zero(),g=this.max.getConnectedValue(E)||N.Vector2.One();return new N.Vector2(U.x+Math.random()*(g.x-U.x),U.y+Math.random()*(g.y-U.y))};break;case aU.dU:E=E=>{const U=this.min.getConnectedValue(E)||N.dU.Zero(),g=this.max.getConnectedValue(E)||N.dU.One();return new N.dU(U.x+Math.random()*(g.x-U.x),U.y+Math.random()*(g.y-U.y),U.z+Math.random()*(g.z-U.z))};break;case aU.hu:E=E=>{const U=this.min.getConnectedValue(E)||new S.hu(0,0,0,0),g=this.max.getConnectedValue(E)||new S.hu(1,1,1,1);return new S.hu(U.x+Math.random()*(g.x-U.x),U.y+Math.random()*(g.y-U.y),U.z+Math.random()*(g.z-U.z),U.w+Math.random()*(g.w-U.w))}}this.output._storedFunction=U=>{var g;let N=0;switch(this.lockMode){case QU.PerParticle:N=(null===(g=U.particleContext)||void 0===g?void 0:g.id)||-1;break;case QU.PerSystem:N=U.buildId||0}return this._currentLockId!==N&&(this.lockMode!==QU.None&&(this._currentLockId=N),this.output._storedValue=E(U)),this.output._storedValue}}serialize(){const E=super.serialize();return E.lockMode=this.lockMode,E}_deserialize(E){super._deserialize(E),this.lockMode=E.lockMode}}(0,r.e)([zU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:QU.None},{label:"Per particle",value:QU.PerParticle},{label:"Per system",value:QU.PerSystem}]})],Dg.prototype,"lockMode",void 0),(0,u.f)("BABYLON.ParticleRandomBlock",Dg);class Sg extends kU{constructor(E){super(E),this._currentLockId=-2,this.lockMode=QU.PerParticle,this.registerInput("min",aU.AutoDetect),this.registerInput("max",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const U=[aU.Matrix,aU.Particle,aU.Texture,aU.System,aU.FloatGradient,aU.Color4Gradient,aU.Vector2Gradient,aU.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...U),this.max.excludedConnectionPointTypes.push(...U)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let E=null;switch(this._currentLockId=-2,this.min.type){case aU.Float:case aU.Int:E=E=>{const U=this.min.getConnectedValue(E),g=this.max.getConnectedValue(E);return Math.random()*(g-U)+U};break;case aU.Vector2:E=E=>{const U=this.min.getConnectedValue(E),g=this.max.getConnectedValue(E);return new N.Vector2(Math.random()*(g.x-U.x)+U.x,Math.random()*(g.y-U.y)+U.y)};break;case aU.dU:E=E=>{const U=this.min.getConnectedValue(E),g=this.max.getConnectedValue(E);return new N.dU(Math.random()*(g.x-U.x)+U.x,Math.random()*(g.y-U.y)+U.y,Math.random()*(g.z-U.z)+U.z)};break;case aU.hu:E=E=>{const U=this.min.getConnectedValue(E),g=this.max.getConnectedValue(E);return new S.hu(Math.random()*(g.r-U.r)+U.r,Math.random()*(g.g-U.g)+U.g,Math.random()*(g.b-U.b)+U.b,Math.random()*(g.a-U.a)+U.a)}}this.output._storedFunction=U=>{var g;let N=0;switch(this.lockMode){case QU.PerParticle:N=(null===(g=U.particleContext)||void 0===g?void 0:g.id)||-1;break;case QU.PerSystem:N=U.buildId||0}return this._currentLockId!==N&&(this.lockMode!==QU.None&&(this._currentLockId=N),this.output._storedValue=E(U)),this.output._storedValue}}serialize(){const E=super.serialize();return E.lockMode=this.lockMode,E}_deserialize(E){super._deserialize(E),void 0!==E.lockMode&&(this.lockMode=E.lockMode)}}(0,r.e)([zU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:QU.None},{label:"Per particle",value:QU.PerParticle},{label:"Per system",value:QU.PerSystem}]})],Sg.prototype,"lockMode",void 0),(0,u.f)("BABYLON.RandomRangeBlock",Sg);(0,u.f)("BABYLON.ParticleLerpBlock",class extends kU{constructor(E){super(E),this.registerInput("left",aU.AutoDetect),this.registerInput("right",aU.AutoDetect),this.registerInput("gradient",aU.Float,!0,0,0,1),this.registerOutput("output",aU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(aU.Float|aU.Int|aU.Vector2|aU.dU|aU.hu)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const E=(E,U,g)=>(1-E)*U+E*g;this.output._storedFunction=U=>{const g=this.left.getConnectedValue(U),L=this.right.getConnectedValue(U),D=this.gradient.getConnectedValue(U);switch(this.left.type){case aU.Int:case aU.Float:return E(D,g,L);case aU.Vector2:return new N.Vector2(E(D,g.x,L.x),E(D,g.y,L.y));case aU.dU:return new N.dU(E(D,g.x,L.x),E(D,g.y,L.y),E(D,g.z,L.z));case aU.hu:return new S.hu(E(D,g.r,L.r),E(D,g.g,L.g),E(D,g.b,L.b),E(D,g.a,L.a))}return 0}}});(0,u.f)("BABYLON.UpdateDirectionBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("direction",aU.dU),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(E){const U=this.particle.getConnectedValue(E);if(this.output._storedValue=U,!this.direction.isConnected)return;const g={process:g=>{E.particleContext=g,E.systemContext=U,g.direction.D(this.direction.getConnectedValue(E))},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g}});(0,u.f)("BABYLON.UpdateColorBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("color",aU.hu),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(E){const U=this.particle.getConnectedValue(E);if(this.output._storedValue=U,!this.color.isConnected)return;const g={process:g=>{E.particleContext=g,E.systemContext=U,g.color.D(this.color.getConnectedValue(E))},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g}});(0,u.f)("BABYLON.UpdateScaleBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("scale",aU.Vector2),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(E){const U=this.particle.getConnectedValue(E);if(this.output._storedValue=U,!this.scale.isConnected)return;const g={process:g=>{E.particleContext=g,E.systemContext=U,g.scale.D(this.scale.getConnectedValue(E))},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g}});(0,u.f)("BABYLON.UpdateAngleBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("angle",aU.Float),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(E){const U=this.particle.getConnectedValue(E);if(this.output._storedValue=U,!this.angle.isConnected)return;const g={process:g=>{E.particleContext=g,E.systemContext=U,g.angle=this.angle.getConnectedValue(E)},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g}});(0,u.f)("BABYLON.BasicPositionUpdateBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(E){const U=this.particle.getConnectedValue(E),g={process:g=>{E.particleContext=g,E.systemContext=U,g.direction.scaleToRef(U._directionScale,U._scaledDirection),g.position.addInPlace(U._scaledDirection)},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g,this.output._storedValue=U}});(0,u.f)("BABYLON.BasicSpriteUpdateBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(E){const U=this.particle.getConnectedValue(E),g={process:g=>{E.particleContext=g,E.systemContext=U,g.updateCellIndex()},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g,this.output._storedValue=U}});(0,u.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("cellIndex",aU.Int),this.registerOutput("output",aU.Particle),this.cellIndex.acceptedConnectionPointTypes=[aU.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(E){const U=this.particle.getConnectedValue(E);if(this.output._storedValue=U,!this.cellIndex.isConnected)return;const g={process:g=>{E.particleContext=g,E.systemContext=U,g.cellIndex=Math.floor(this.cellIndex.getConnectedValue(E))},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g}});class ug extends kU{constructor(E){super(E),this.strength=1,this.registerInput("particle",aU.Particle),this.registerInput("flowMap",aU.Texture),this.registerOutput("output",aU.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(E){var U;const g=this.particle.getConnectedValue(E),N=E.yU;let L;(null===(U=this.flowMap.connectedPoint)||void 0===U?void 0:U.ownerBlock).extractTextureContentAsync().then((E=>{E&&(L=new wU(E.width,E.height,E.data))}));const D={process:E=>{const U=N.getTransformMatrix();L&&L._processParticle(E,this.strength*g._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null};g._updateQueueStart?WE(D,g._updateQueueStart):g._updateQueueStart=D,this.output._storedValue=g}serialize(){const E=super.serialize();return E.strength=this.strength,E}_deserialize(E){super._deserialize(E),this.strength=E.strength}}(0,r.e)([zU("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ug.prototype,"strength",void 0),(0,u.f)("BABYLON.UpdateFlowMapBlock",ug);(0,u.f)("BABYLON.SphereShapeBlock",class extends kU{constructor(E){super(E),this.registerInput("input",aU.Particle),this.registerInput("radius",aU.Float,!0,1),this.registerInput("radiusRange",aU.Float,!0,1,0,1),this.registerInput("directionRandomizer",aU.Float,!0,0,0,1),this.registerOutput("output",aU.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(E){const U=this.input.getConnectedValue(E);U._directionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.directionRandomizer.getConnectedValue(E),D=g.position.IU(E.emitterPosition).normalize(),S=(0,C.RandomRange)(0,L),u=(0,C.RandomRange)(0,L),s=(0,C.RandomRange)(0,L);D.x+=S,D.y+=u,D.z+=s,D.normalize(),E.isEmitterTransformNode?N.dU.TransformNormalFromFloatsToRef(S,u,s,E.emitterWorldMatrix,g.direction):g.direction.du(S,u,s)},U._positionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.radius.getConnectedValue(E),D=this.radiusRange.getConnectedValue(E),S=L-(0,C.RandomRange)(0,L*D),u=(0,C.RandomRange)(0,1),s=(0,C.RandomRange)(0,2*Math.PI),B=Math.acos(2*u-1),P=S*Math.cos(s)*Math.sin(B),F=S*Math.cos(B),f=S*Math.sin(s)*Math.sin(B);E.isEmitterTransformNode?N.dU.TransformCoordinatesFromFloatsToRef(P,F,f,E.emitterWorldMatrix,g.position):(g.position.du(P,F,f),g.position.addInPlace(E.emitterPosition))},this.output._storedValue=U}});(0,u.f)("BABYLON.PointShapeBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("direction1",aU.dU,!0,new N.dU(0,1,0)),this.registerInput("direction2",aU.dU,!0,new N.dU(0,1,0)),this.registerOutput("output",aU.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){const U=this.particle.getConnectedValue(E);U._directionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.direction1.getConnectedValue(E),D=this.direction2.getConnectedValue(E),S=(0,C.RandomRange)(L.x,D.x),u=(0,C.RandomRange)(L.y,D.y),s=(0,C.RandomRange)(L.z,D.z);E.isEmitterTransformNode?N.dU.TransformNormalFromFloatsToRef(S,u,s,E.emitterWorldMatrix,g.direction):g.direction.du(S,u,s)},U._positionCreation.process=g=>{E.systemContext=U,E.isEmitterTransformNode?N.dU.TransformCoordinatesFromFloatsToRef(0,0,0,E.emitterWorldMatrix,g.position):g.position.D(E.emitterPosition)},this.output._storedValue=U}});(0,u.f)("BABYLON.CustomShapeBlock",class extends kU{constructor(E){super(E),this.registerInput("particle",aU.Particle),this.registerInput("position",aU.dU,!0,new N.dU(0,0,0)),this.registerInput("direction",aU.dU,!0,new N.dU(0,1,0)),this.registerOutput("output",aU.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){const U=this.particle.getConnectedValue(E);U._directionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.direction.getConnectedValue(E);E.isEmitterTransformNode?N.dU.TransformNormalToRef(L,E.emitterWorldMatrix,g.direction):g.direction.D(L)},U._positionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.position.getConnectedValue(E);E.isEmitterTransformNode?N.dU.TransformCoordinatesToRef(L,E.emitterWorldMatrix,g.position):(g.position.D(L),g.position.addInPlace(E.emitterPosition))},this.output._storedValue=U}});(0,u.f)("BABYLON.CylinderShapeBlock",class extends kU{constructor(E){super(E),this._tempVector=N.dU.Zero(),this.registerInput("particle",aU.Particle),this.registerInput("radius",aU.Float,!0,1),this.registerInput("height",aU.Float,!0,1,0),this.registerInput("radiusRange",aU.Float,!0,1,0,1),this.registerInput("directionRandomizer",aU.Float,!0,0,0,1),this.registerOutput("output",aU.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(E){const U=this.particle.getConnectedValue(E);U._directionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.directionRandomizer.getConnectedValue(E);g.position.subtractToRef(E.emitterPosition,this._tempVector),this._tempVector.normalize(),E.isEmitterTransformNode&&N.dU.TransformNormalToRef(this._tempVector,E.emitterInverseWorldMatrix,this._tempVector);const D=(0,C.RandomRange)(-L/2,L/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*L,this._tempVector.y=D,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),E.isEmitterTransformNode?N.dU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E.emitterWorldMatrix,g.direction):g.direction.D(this._tempVector)},U._positionCreation.process=g=>{E.particleContext=g,E.systemContext=U;const L=this.height.getConnectedValue(E),D=this.radiusRange.getConnectedValue(E),S=this.radius.getConnectedValue(E),u=(0,C.RandomRange)(-L/2,L/2),s=(0,C.RandomRange)(0,2*Math.PI),B=(0,C.RandomRange)((1-D)*(1-D),1),P=Math.sqrt(B)*S,F=P*Math.cos(s),f=P*Math.sin(s);E.isEmitterTransformNode?N.dU.TransformCoordinatesFromFloatsToRef(F,u,f,E.emitterWorldMatrix,g.position):(g.position.du(F,u,f),g.position.addInPlace(E.emitterPosition))},this.output._storedValue=U}});class sg extends kU{constructor(E){super(E),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",aU.Particle),this.registerOutput("output",aU.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);const U=this.particle.getConnectedValue(E);U._isAnimationSheetEnabled=!0,U.spriteCellWidth=this.width,U.spriteCellHeight=this.height,U.startSpriteCellID=this.start,U.endSpriteCellID=this.end,U.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=U}serialize(){const E=super.serialize();return E.width=this.width,E.height=this.height,E.start=this.start,E.end=this.end,E.randomStartCell=this.randomStartCell,E}_deserialize(E){super._deserialize(E),this.width=E.width,this.height=E.height,this.start=E.start,this.end=E.end,this.randomStartCell=E.randomStartCell}}(0,r.e)([zU("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sg.prototype,"start",void 0),(0,r.e)([zU("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sg.prototype,"end",void 0),(0,r.e)([zU("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sg.prototype,"width",void 0),(0,r.e)([zU("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sg.prototype,"height",void 0),(0,r.e)([zU("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],sg.prototype,"loop",void 0),(0,r.e)([zU("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],sg.prototype,"randomStartCell",void 0),(0,u.f)("BABYLON.SetupSpriteSheetBlock",sg);class Cg extends kU{constructor(E){super(E),this.reference=0,this.registerInput("value",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=E=>{switch(E){case aU.Float:return aU.FloatGradient;case aU.Vector2:return aU.Vector2Gradient;case aU.dU:return aU.Vector3Gradient;case aU.hu:return aU.Color4Gradient}return E},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(aU.Float|aU.Vector2|aU.dU|aU.hu)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=E=>null}serialize(){const E=super.serialize();return E.reference=this.reference,E}_deserialize(E){super._deserialize(E),this.reference=E.reference}}(0,r.e)([zU("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Cg.prototype,"reference",void 0),(0,u.f)("BABYLON.ParticleGradientValueBlock",Cg);(0,u.f)("BABYLON.ParticleGradientBlock",class extends kU{constructor(E){super(E),this._entryCount=1,this.registerInput("gradient",aU.Float,!0,1,0,1),this.registerInput("value0",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=E=>{switch(E){case aU.FloatGradient:return aU.Float;case aU.Vector2Gradient:return aU.Vector2;case aU.Vector3Gradient:return aU.dU;case aU.Color4Gradient:return aU.hu}return E},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(aU.FloatGradient|aU.Vector2Gradient|aU.Vector3Gradient|aU.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(E){this._inputs[E].onConnectionObservable.add((()=>{this._entryCount>E||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),aU.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const E=[];for(let g=1;g<this._inputs.length;g++){var U;if(this._inputs[g].isConnected)E.push(null===(U=this._inputs[g].connectedPoint)||void 0===U?void 0:U.ownerBlock)}E.sort(((E,U)=>E.reference-U.reference)),this.output._storedFunction=U=>{const g=this.gradient.getConnectedValue(U);if(1===E.length)return E[0].value.getConnectedValue(U);let L=null;for(let D=E.length-1;D>=0;D--){const u=E[D];if(u.reference<=g){const E=u.value.getConnectedValue(U);if(L){const D=L.value.getConnectedValue(U),s=L.reference,B=u.reference,P=Math.max(0,Math.min(1,(g-B)/(s-B)));switch(this.output.type){case aU.Float:return(0,C.Lerp)(E,D,P);case aU.Vector2:return N.Vector2.Lerp(E,D,P);case aU.dU:return N.dU.Lerp(E,D,P);case aU.hu:return S.hu.Lerp(E,D,P)}}return E}L=u}return 0}}});(0,u.f)("BABYLON.ParticleConverterBlock",class extends kU{constructor(E){super(E),this.registerInput("color ",aU.hu,!0),this.registerInput("xyz ",aU.dU,!0),this.registerInput("xy ",aU.Vector2,!0),this.registerInput("zw ",aU.Vector2,!0),this.registerInput("x ",aU.Float,!0),this.registerInput("y ",aU.Float,!0),this.registerInput("z ",aU.Float,!0),this.registerInput("w ",aU.Float,!0),this.registerOutput("color",aU.hu),this.registerOutput("xyz",aU.dU),this.registerOutput("xy",aU.Vector2),this.registerOutput("zw",aU.Vector2),this.registerOutput("x",aU.Float),this.registerOutput("y",aU.Float),this.registerOutput("z",aU.Float),this.registerOutput("w",aU.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(E){return"color "===E?"colorIn":"xyz "===E?"xyzIn":"xy "===E?"xyIn":"zw "===E?"zwIn":"x "===E?"xIn":"y "===E?"yIn":"z "===E?"zIn":"w "===E?"wIn":E}_outputRename(E){switch(E){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return E}}_build(E){super._build(E);const U=this.xIn,g=this.yIn,L=this.zIn,D=this.wIn,u=this.xyIn,s=this.zwIn,C=this.xyzIn,B=this.colorIn,P=this.colorOut,F=this.xyzOut,f=this.xyOut,d=this.zwOut,I=this.xOut,y=this.yOut,h=this.zOut,V=this.wOut,e=E=>{if(B.isConnected)return B.getConnectedValue(E);let N=0,P=0,F=0,f=0;if(U.isConnected&&(N=U.getConnectedValue(E)),g.isConnected&&(P=g.getConnectedValue(E)),L.isConnected&&(F=L.getConnectedValue(E)),D.isConnected&&(f=D.getConnectedValue(E)),u.isConnected){const U=u.getConnectedValue(E);U&&(N=U.x,P=U.y)}if(s.isConnected){const U=s.getConnectedValue(E);U&&(F=U.x,f=U.y)}if(C.isConnected){const U=C.getConnectedValue(E);U&&(N=U.x,P=U.y,F=U.z)}return new S.hu(N,P,F,f)};P._storedFunction=E=>e(E),F._storedFunction=E=>{const U=e(E);return new N.dU(U.r,U.g,U.b)},f._storedFunction=E=>{const U=e(E);return new N.Vector2(U.r,U.g)},d._storedFunction=E=>{const U=e(E);return new N.Vector2(U.b,U.a)},I._storedFunction=E=>e(E).r,y._storedFunction=E=>e(E).g,h._storedFunction=E=>e(E).b,V._storedFunction=E=>e(E).a}}),function(E){E[E.Cos=0]="Cos",E[E.Sin=1]="Sin",E[E.Abs=2]="Abs",E[E.Exp=3]="Exp",E[E.Exp2=4]="Exp2",E[E.Round=5]="Round",E[E.Floor=6]="Floor",E[E.Ceiling=7]="Ceiling",E[E.Sqrt=8]="Sqrt",E[E.Log=9]="Log",E[E.Tan=10]="Tan",E[E.ArcTan=11]="ArcTan",E[E.ArcCos=12]="ArcCos",E[E.ArcSin=13]="ArcSin",E[E.Sign=14]="Sign",E[E.Negate=15]="Negate",E[E.OneMinus=16]="OneMinus",E[E.Reciprocal=17]="Reciprocal",E[E.ToDegrees=18]="ToDegrees",E[E.ToRadians=19]="ToRadians",E[E.Fract=20]="Fract"}(RU||(RU={}));class Bg extends kU{constructor(E){super(E),this.operation=RU.Cos,this.registerInput("input",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(aU.Float|aU.Int|aU.Vector2|aU.dU|aU.hu)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);let U=null;switch(this.operation){case RU.Cos:U=E=>Math.cos(E);break;case RU.Sin:U=E=>Math.sin(E);break;case RU.Abs:U=E=>Math.abs(E);break;case RU.Exp:U=E=>Math.exp(E);break;case RU.Exp2:U=E=>Math.pow(2,E);break;case RU.Round:U=E=>Math.round(E);break;case RU.Floor:U=E=>Math.floor(E);break;case RU.Ceiling:U=E=>Math.ceil(E);break;case RU.Sqrt:U=E=>Math.sqrt(E);break;case RU.Log:U=E=>Math.log(E);break;case RU.Tan:U=E=>Math.tan(E);break;case RU.ArcTan:U=E=>Math.atan(E);break;case RU.ArcCos:U=E=>Math.acos(E);break;case RU.ArcSin:U=E=>Math.asin(E);break;case RU.Sign:U=E=>Math.sign(E);break;case RU.Negate:U=E=>-E;break;case RU.OneMinus:U=E=>1-E;break;case RU.Reciprocal:U=E=>1/E;break;case RU.ToRadians:U=E=>E*Math.PI/180;break;case RU.ToDegrees:U=E=>180*E/Math.PI;break;case RU.Fract:U=E=>E>=0?E-Math.floor(E):E-Math.ceil(E)}if(!U)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case aU.Int:case aU.Float:this.output._storedFunction=E=>{const g=this.input.getConnectedValue(E);return U(g)};break;case aU.Vector2:this.output._storedFunction=E=>{const g=this.input.getConnectedValue(E);return new N.Vector2(U(g.x),U(g.y))};break;case aU.dU:this.output._storedFunction=E=>{const g=this.input.getConnectedValue(E);return new N.dU(U(g.x),U(g.y),U(g.z))};break;case aU.hu:this.output._storedFunction=E=>{const g=this.input.getConnectedValue(E);return new S.hu(U(g.r),U(g.g),U(g.b),U(g.a))}}return this}serialize(){const E=super.serialize();return E.operation=this.operation,E}_deserialize(E){super._deserialize(E),this.operation=E.operation}}(0,r.e)([zU("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:RU.Cos},{label:"Sin",value:RU.Sin},{label:"Abs",value:RU.Abs},{label:"Exp",value:RU.Exp},{label:"Exp2",value:RU.Exp2},{label:"Round",value:RU.Round},{label:"Floor",value:RU.Floor},{label:"Ceiling",value:RU.Ceiling},{label:"Sqrt",value:RU.Sqrt},{label:"Log",value:RU.Log},{label:"Tan",value:RU.Tan},{label:"ArcTan",value:RU.ArcTan},{label:"ArcCos",value:RU.ArcCos},{label:"ArcSin",value:RU.ArcSin},{label:"Sign",value:RU.Sign},{label:"Negate",value:RU.Negate},{label:"OneMinus",value:RU.OneMinus},{label:"Reciprocal",value:RU.Reciprocal},{label:"ToDegrees",value:RU.ToDegrees},{label:"ToRadians",value:RU.ToRadians},{label:"Fract",value:RU.Fract}]})],Bg.prototype,"operation",void 0),(0,u.f)("BABYLON.ParticleTrigonometryBlock",Bg);var Pg,Fg=g(13722);class fg extends kU{constructor(E){super(E),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(aU.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(aU.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(aU.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(aU.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(aU.System),this._inputs[0].excludedConnectionPointTypes.push(aU.Particle),this._inputs[0].excludedConnectionPointTypes.push(aU.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const U=E=>{const U=this.input.getConnectedValue(E);if(this.log.length>=this.stackSize)return U;if(null===U||void 0===U)return this.log.push(["null",""]),U;switch(this.input.type){case aU.Vector2:this.log.push([(0,Fg.f)(U,4),U.toString()]);break;case aU.dU:this.log.push([(0,Fg.g)(U,4),U.toString()]);break;case aU.hu:this.log.push([`{R: ${U.r.toFixed(4)} G: ${U.g.toFixed(4)} B: ${U.b.toFixed(4)} A: ${U.a.toFixed(4)}}`,U.toString()]);break;default:this.log.push([U.toString(),U.toString()])}return U};this.output.isConnected?this.output._storedFunction=U:this.output._storedValue=U(E)}serialize(){const E=super.serialize();return E.stackSize=this.stackSize,E}_deserialize(E){super._deserialize(E),this.stackSize=E.stackSize}}(0,r.e)([zU("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],fg.prototype,"stackSize",void 0),(0,u.f)("BABYLON.ParticleDebugBlock",fg);(0,u.f)("BABYLON.ParticleElbowBlock",class extends kU{constructor(E){super(E),this.registerInput("input",aU.AutoDetect),this.registerOutput("output",aU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);const U=this._outputs[0],g=this._inputs[0];U._storedFunction=E=>g.getConnectedValue(E)}});(0,u.f)("BABYLON.ParticleTeleportInBlock",class extends kU{get endpoints(){return this._endpoints}constructor(E){super(E),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",aU.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(E){if(this.getClassName()===E)return!0;for(const U of this.endpoints)if(U.isAnAncestorOfType(E))return!0;return!1}isAnAncestorOf(E){for(const U of this.endpoints){if(U===E)return!0;if(U.isAnAncestorOf(E))return!0}return!1}attachToEndpoint(E){E.detach(),this._endpoints.push(E),E._entryPoint=this,E._outputs[0]._typeConnectionSource=this._inputs[0],E._tempEntryPointUniqueId=null,E.name="> "+this.name}detachFromEndpoint(E){const U=this._endpoints.indexOf(E);-1!==U&&(this._endpoints.splice(U,1),E._outputs[0]._typeConnectionSource=null,E._entryPoint=null)}_build(){for(const E of this._endpoints)E.output._storedFunction=E=>this.input.getConnectedValue(E)}});(0,u.f)("BABYLON.ParticleTeleportOutBlock",class extends kU{constructor(E){super(E),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",aU.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(E){this.entryPoint&&this.entryPoint.build(E)}clone(){const E=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(E),E}serialize(){var E;const U=super.serialize();return U.entryPoint=(null===(E=this.entryPoint)||void 0===E?void 0:E.uniqueId)??"",U}_deserialize(E){super._deserialize(E),this._tempEntryPointUniqueId=E.entryPoint}}),function(E){E[E.Equal=0]="Equal",E[E.NotEqual=1]="NotEqual",E[E.LessThan=2]="LessThan",E[E.GreaterThan=3]="GreaterThan",E[E.LessOrEqual=4]="LessOrEqual",E[E.GreaterOrEqual=5]="GreaterOrEqual",E[E.Xor=6]="Xor",E[E.Or=7]="Or",E[E.And=8]="And"}(Pg||(Pg={}));class dg extends kU{constructor(E){super(E),this.test=Pg.Equal,this.epsilon=0,this.registerInput("left",aU.Float),this.registerInput("right",aU.Float,!0,0),this.registerInput("ifTrue",aU.AutoDetect,!0,1),this.registerInput("ifFalse",aU.AutoDetect,!0,0),this.registerOutput("output",aU.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=aU.Float,this._inputs[0].acceptedConnectionPointTypes.push(aU.Int),this._inputs[1].acceptedConnectionPointTypes.push(aU.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const E=E=>{const U=this.left.getConnectedValue(E),g=this.right.getConnectedValue(E);let N=!1;switch(this.test){case Pg.Equal:N=(0,C.WithinEpsilon)(U,g,this.epsilon);break;case Pg.NotEqual:N=!(0,C.WithinEpsilon)(U,g,this.epsilon);break;case Pg.LessThan:N=U<g+this.epsilon;break;case Pg.GreaterThan:N=U>g-this.epsilon;break;case Pg.LessOrEqual:N=U<=g+this.epsilon;break;case Pg.GreaterOrEqual:N=U>=g-this.epsilon;break;case Pg.Xor:N=!!U&&!g||!U&&!!g;break;case Pg.Or:N=!!U||!!g;break;case Pg.And:N=!!U&&!!g}return N};this.output._storedFunction=U=>E(U)?this.ifTrue.getConnectedValue(U):this.ifFalse.getConnectedValue(U)}serialize(){const E=super.serialize();return E.test=this.test,E.epsilon=this.epsilon,E}_deserialize(E){super._deserialize(E),this.test=E.test,void 0!==E.epsilon&&(this.epsilon=E.epsilon)}}(0,r.e)([zU("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Pg.Equal},{label:"NotEqual",value:Pg.NotEqual},{label:"LessThan",value:Pg.LessThan},{label:"GreaterThan",value:Pg.GreaterThan},{label:"LessOrEqual",value:Pg.LessOrEqual},{label:"GreaterOrEqual",value:Pg.GreaterOrEqual},{label:"Xor",value:Pg.Xor},{label:"Or",value:Pg.Or},{label:"And",value:Pg.And}]})],dg.prototype,"test",void 0),(0,r.e)([zU("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dg.prototype,"epsilon",void 0),(0,u.f)("BABYLON.ParticleConditionBlock",dg);class Ig extends kU{constructor(E){super(E),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",aU.Particle),this.registerInput("condition",aU.Float,!0,0),this.registerInput("system",aU.System),this.registerOutput("output",aU.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){this._triggerCount=0;const U=this.input.getConnectedValue(E),g={process:g=>{if(E.particleContext=g,E.systemContext=U,0!==this.condition.getConnectedValue(E)&&(0===this.limit||this._triggerCount<this.limit)){const N=(new Date).getTime();if(this._previousOne&&N-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=N;const L=this.system.getConnectedValue(E);if(L){const N=pU(L,E.yU,g.position);N.hg.addOnce((()=>{this._triggerCount--})),U.hg.addOnce((()=>{N.dispose()}))}}},previousItem:null,nextItem:null};U._updateQueueStart?WE(g,U._updateQueueStart):U._updateQueueStart=g,this.output._storedValue=U}serialize(){const E=super.serialize();return E.limit=this.limit,E.delay=this.delay,E}_deserialize(E){super._deserialize(E),void 0!==E.limit&&(this.limit=E.limit),void 0!==E.delay&&(this.delay=E.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,r.e)([zU("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ig.prototype,"limit",void 0),(0,r.e)([zU("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ig.prototype,"delay",void 0),(0,u.f)("BABYLON.ParticleTriggerBlock",Ig);g(13729),g(13737),g(13749),g(13808)},13788:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneFragment",D="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13754:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneFragmentDeclaration",D="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13829:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneVertex",D="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13817:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneVertexDeclaration",D="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13800:(E,U,g)=>{"use strict";var N=g(12250);const L="fogFragment",D="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13782:(E,U,g)=>{"use strict";var N=g(12250);const L="fogFragmentDeclaration",D="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13831:(E,U,g)=>{"use strict";var N=g(12250);const L="fogVertex",D="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13820:(E,U,g)=>{"use strict";var N=g(12250);const L="fogVertexDeclaration",D="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13769:(E,U,g)=>{"use strict";var N=g(12250);const L="helperFunctions",D="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13758:(E,U,g)=>{"use strict";var N=g(12250);const L="imageProcessingDeclaration",D="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13775:(E,U,g)=>{"use strict";var N=g(12250);const L="imageProcessingFunctions",D="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13761:(E,U,g)=>{"use strict";var N=g(12250);const L="logDepthDeclaration",D="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13793:(E,U,g)=>{"use strict";var N=g(12250);const L="logDepthFragment",D="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13835:(E,U,g)=>{"use strict";var N=g(12250);const L="logDepthVertex",D="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";N.e.IncludesShadersStoreWGSL[L]||(N.e.IncludesShadersStoreWGSL[L]=D)},13749:(E,U,g)=>{"use strict";g.r(U),g.d(U,{particlesPixelShaderWGSL:()=>S});var N=g(12250);g(13754),g(13758),g(13761),g(13769),g(13775),g(13782),g(13788),g(13793),g(13800);const L="particlesPixelShader",D="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.e.ShadersStoreWGSL[L]||(N.e.ShadersStoreWGSL[L]=D);const S={name:L,shader:D}},13808:(E,U,g)=>{"use strict";g.r(U),g.d(U,{particlesVertexShaderWGSL:()=>S});var N=g(12250);g(13817),g(13820),g(13761),g(13829),g(13831),g(13835);const L="particlesVertexShader",D="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.e.ShadersStoreWGSL[L]||(N.e.ShadersStoreWGSL[L]=D);const S={name:L,shader:D}},13666:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneFragment",D="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13731:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneFragmentDeclaration",D="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13682:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneVertex",D="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13741:(E,U,g)=>{"use strict";var N=g(12250);const L="clipPlaneVertexDeclaration",D="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13674:(E,U,g)=>{"use strict";var N=g(12250);const L="fogFragment",D="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13659:(E,U,g)=>{"use strict";var N=g(12250);const L="fogFragmentDeclaration",D="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13689:(E,U,g)=>{"use strict";var N=g(12250);const L="fogVertex",D="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13680:(E,U,g)=>{"use strict";var N=g(12250);const L="fogVertexDeclaration",D="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13651:(E,U,g)=>{"use strict";var N=g(12250);const L="helperFunctions",D="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13641:(E,U,g)=>{"use strict";var N=g(12250);const L="imageProcessingDeclaration",D="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13655:(E,U,g)=>{"use strict";var N=g(12250);const L="imageProcessingFunctions",D="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13646:(E,U,g)=>{"use strict";var N=g(12250);const L="logDepthDeclaration",D="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13672:(E,U,g)=>{"use strict";var N=g(12250);const L="logDepthFragment",D="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13696:(E,U,g)=>{"use strict";var N=g(12250);const L="logDepthVertex",D="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";N.e.IncludesShadersStore[L]||(N.e.IncludesShadersStore[L]=D)},13729:(E,U,g)=>{"use strict";g.r(U),g.d(U,{particlesPixelShader:()=>S});var N=g(12250);g(13731),g(13641),g(13646),g(13651),g(13655),g(13659),g(13666),g(13672),g(13674);const L="particlesPixelShader",D="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.e.ShadersStore[L]||(N.e.ShadersStore[L]=D);const S={name:L,shader:D}},13737:(E,U,g)=>{"use strict";g.r(U),g.d(U,{particlesVertexShader:()=>S});var N=g(12250);g(13741),g(13680),g(13646),g(13682),g(13689),g(13696);const L="particlesVertexShader",D="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.e.ShadersStore[L]||(N.e.ShadersStore[L]=D);const S={name:L,shader:D}},14108:(E,U,g)=>{"use strict";g.r(U),g.d(U,{FlowGraphGLTFDataProvider:()=>D});var N=g(14077),L=g(14058);class D extends N.b{constructor(E){var U,g;super();const N=E.glTF,D=(null===(U=N.animations)||void 0===U?void 0:U.map((E=>E._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",L.e,D);const S=(null===(g=N.nodes)||void 0===g?void 0:g.map((E=>E._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",L.e,S)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13992:(E,U,g)=>{"use strict";g.d(U,{e:()=>y,f:()=>d,j:()=>f,n:()=>I});var N=g(12334),L=g(12815),D=g(12379),S=g(13996);const u=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class s{constructor(E,U){this._gltf=E,this._infoTree=U}convert(E){let U,g=this._gltf,N=this._infoTree;if(!E.startsWith("/"))throw new Error("Path must start with a /");const L=E.split("/");if(L.shift(),L[L.length-1].includes(".length")){const E=L[L.length-1].split(".");L.pop(),L.push(...E)}let D=!1;for(const s of L){const L="length"===s;if(L&&!N.__array__)throw new Error(`Path ${E} is invalid`);if(N.__ignoreObjectTree__&&(D=!0),N.__array__&&!L)N=N.__array__;else if(N=N[s],!N)throw new Error(`Path ${E} is invalid`);if(!D)if(void 0===g){if(!u.find((U=>U.regex.test(E))))throw new Error(`Path ${E} is invalid`)}else if(!L){var S;g=null===(S=g)||void 0===S?void 0:S[s]}(N.__target__||L)&&(U=g)}return{object:U,info:N}}}function C(E,U,g,N){const L=B(E,U);return N?L[g][N]:L[g]}function B(E,U,g){var N,D;return null===(N=E._data)||void 0===N||null===(D=N[(null===g||void 0===g?void 0:g.fillMode)??L.c.MATERIAL_TriangleFillMode])||void 0===D?void 0:D.babylonMaterial}function P(E,U){return{offset:{componentsCount:2,type:"Vector2",get:(g,L,D)=>{const S=C(g,D,E,U);return new N.Vector2(null===S||void 0===S?void 0:S.uOffset,null===S||void 0===S?void 0:S.vOffset)},getTarget:B,set:(g,N,L,D)=>{const S=C(N,D,E,U);S.uOffset=g.x,S.vOffset=g.y},getPropertyName:[()=>`${E}${U?"."+U:""}.uOffset`,()=>`${E}${U?"."+U:""}.vOffset`]},rotation:{type:"number",get:(g,N,L)=>{var D;return null===(D=C(g,L,E,U))||void 0===D?void 0:D.wAng},getTarget:B,set:(g,N,L,D)=>C(N,D,E,U).wAng=g,getPropertyName:[()=>`${E}${U?"."+U:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(g,L,D)=>{const S=C(g,D,E,U);return new N.Vector2(null===S||void 0===S?void 0:S.uScale,null===S||void 0===S?void 0:S.vScale)},getTarget:B,set:(g,N,L,D)=>{const S=C(N,D,E,U);S.uScale=g.x,S.vScale=g.y},getPropertyName:[()=>`${E}${U?"."+U:""}.uScale`,()=>`${E}${U?"."+U:""}.vScale`]}}}const F={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:E=>{var U,g;return new N.Vector2((null===(U=E._babylonCamera)||void 0===U?void 0:U.orthoLeft)??0,(null===(g=E._babylonCamera)||void 0===g?void 0:g.orthoRight)??0)},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.orthoLeft=E.x,U._babylonCamera.orthoRight=E.y)},getTarget:E=>E,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:E=>{var U,g;return new N.Vector2((null===(U=E._babylonCamera)||void 0===U?void 0:U.orthoBottom)??0,(null===(g=E._babylonCamera)||void 0===g?void 0:g.orthoTop)??0)},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.orthoBottom=E.x,U._babylonCamera.orthoTop=E.y)},getTarget:E=>E,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:E=>{var U;return null===(U=E._babylonCamera)||void 0===U?void 0:U.maxZ},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=E)},getTarget:E=>E,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:E=>{var U;return null===(U=E._babylonCamera)||void 0===U?void 0:U.kg},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.kg=E)},getTarget:E=>E,getPropertyName:[()=>"kg"]}},perspective:{aspectRatio:{type:"number",get:E=>{var U;return null===(U=E._babylonCamera)||void 0===U?void 0:U.getEngine().getAspectRatio(E._babylonCamera)},getTarget:E=>E,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:E=>{var U;return null===(U=E._babylonCamera)||void 0===U?void 0:U.fov},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.fov=E)},getTarget:E=>E,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:E=>{var U;return null===(U=E._babylonCamera)||void 0===U?void 0:U.maxZ},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=E)},getTarget:E=>E,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:E=>{var U;return null===(U=E._babylonCamera)||void 0===U?void 0:U.kg},set:(E,U)=>{U._babylonCamera&&(U._babylonCamera.kg=E)},getTarget:E=>E,getPropertyName:[()=>"kg"]}}}},nodes:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"dU",get:E=>{var U;return null===(U=E._babylonTransformNode)||void 0===U?void 0:U.position},set:(E,U)=>{var g;return null===(g=U._babylonTransformNode)||void 0===g?void 0:g.position.D(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:E=>{var U;return null===(U=E._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion},set:(E,U)=>{var g,N;return null===(g=U._babylonTransformNode)||void 0===g||null===(N=g.rotationQuaternion)||void 0===N?void 0:N.D(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"dU",get:E=>{var U;return null===(U=E._babylonTransformNode)||void 0===U?void 0:U.Iu},set:(E,U)=>{var g;return null===(g=U._babylonTransformNode)||void 0===g?void 0:g.Iu.D(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"Iu"]},weights:{length:{type:"number",get:E=>E._numMorphTargets,getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(E,U)=>{var g,N;return void 0!==U?null===(g=E._primitiveBabylonMeshes)||void 0===g||null===(N=g[0].morphTargetManager)||void 0===N?void 0:N.getTarget(U).influence:void 0},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(E,U)=>[0],getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:E=>{var U,g,L;return N.Matrix.Compose(null===(U=E._babylonTransformNode)||void 0===U?void 0:U.Iu,null===(g=E._babylonTransformNode)||void 0===g?void 0:g.rotationQuaternion,null===(L=E._babylonTransformNode)||void 0===L?void 0:L.position)},getTarget:E=>E._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:E=>{var U,g,L,D;const S=N.Matrix.Identity();let u=E.parent;for(;u&&u.parent;)u=u.parent;const s=(null===(U=E._babylonTransformNode)||void 0===U?void 0:U.position._isDirty)||(null===(g=E._babylonTransformNode)||void 0===g||null===(L=g.rotationQuaternion)||void 0===L?void 0:L._isDirty)||(null===(D=E._babylonTransformNode)||void 0===D?void 0:D.Iu._isDirty);if(u){var C;const U=null===(C=u._babylonTransformNode)||void 0===C?void 0:C.pg(!0).invert();var B,P;if(U)null===(B=E._babylonTransformNode)||void 0===B||null===(P=B.pg(s))||void 0===P||P.multiplyToRef(U,S)}else E._babylonTransformNode&&S.D(E._babylonTransformNode.pg(s));return S},getTarget:E=>E._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:E=>{var U,g;return null===(U=E._babylonTransformNode)||void 0===U||null===(g=U.getChildren((E=>E instanceof S.c),!0)[0])||void 0===g?void 0:g.xu},getTarget:E=>{var U;return null===(U=E._babylonTransformNode)||void 0===U?void 0:U.getChildren((E=>E instanceof S.c),!0)[0]},set:(E,U)=>{if(U._babylonTransformNode){const g=U._babylonTransformNode.getChildren((E=>E instanceof S.c),!0)[0];g&&(g.xu=E)}}},color:{type:"VU",get:E=>{var U,g;return null===(U=E._babylonTransformNode)||void 0===U||null===(g=U.getChildren((E=>E instanceof S.c),!0)[0])||void 0===g?void 0:g.lu},getTarget:E=>{var U;return null===(U=E._babylonTransformNode)||void 0===U?void 0:U.getChildren((E=>E instanceof S.c),!0)[0]},set:(E,U)=>{if(U._babylonTransformNode){const g=U._babylonTransformNode.getChildren((E=>E instanceof S.c),!0)[0];g&&(g.lu=E)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"VU",get:(E,U,g)=>B(E,U,g).emissiveColor,set:(E,U,g,N)=>B(U,g,N).emissiveColor.D(E),getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:P("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(E,U,g)=>{var N;return null===(N=C(E,g,"bumpTexture"))||void 0===N?void 0:N.level},set:(E,U,g,N)=>{const L=C(U,N,"bumpTexture");L&&(L.level=E)},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:P("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(E,U,g)=>B(E,U,g).ambientTextureStrength,set:(E,U,g,N)=>{const L=B(U,g,N);L&&(L.ambientTextureStrength=E)},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:P("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"hu",get:(E,U,g)=>{const N=B(E,U,g);return D.hu.FromColor3(N.albedoColor,N.alpha)},set:(E,U,g,N)=>{const L=B(U,g,N);L.albedoColor.set(E.r,E.g,E.b),L.alpha=E.a},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:P("albedoTexture")}},metallicFactor:{type:"number",get:(E,U,g)=>B(E,U,g).metallic,set:(E,U,g,N)=>{const L=B(U,g,N);L&&(L.metallic=E)},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(E,U,g)=>B(E,U,g).roughness,set:(E,U,g,N)=>{const L=B(U,g,N);L&&(L.roughness=E)},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:P("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(E,U,g)=>B(E,U,g).anisotropy.xu,set:(E,U,g,N)=>{B(U,g,N).anisotropy.xu=E},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(E,U,g)=>B(E,U,g).anisotropy.angle,set:(E,U,g,N)=>{B(U,g,N).anisotropy.angle=E},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:P("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(E,U,g)=>B(E,U,g).clearCoat.xu,set:(E,U,g,N)=>{B(U,g,N).clearCoat.xu=E},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(E,U,g)=>B(E,U,g).clearCoat.roughness,set:(E,U,g,N)=>{B(U,g,N).clearCoat.roughness=E},getTarget:(E,U,g)=>B(E,U,g),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:P("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(E,U,g)=>{var N;return null===(N=B(E,U,g).clearCoat.bumpTexture)||void 0===N?void 0:N.level},getTarget:B,set:(E,U,g,N)=>B(U,g,N).clearCoat.bumpTexture.level=E},extensions:{KHR_texture_transform:P("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:P("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(E,U,g)=>B(E,U,g).subSurface.dispersion,getTarget:B,set:(E,U,g,N)=>B(U,g,N).subSurface.dispersion=E}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(E,U,g)=>B(E,U,g).emissiveIntensity,getTarget:B,set:(E,U,g,N)=>B(U,g,N).emissiveIntensity=E}},KHR_materials_ior:{ior:{type:"number",get:(E,U,g)=>B(E,U,g).indexOfRefraction,getTarget:B,set:(E,U,g,N)=>B(U,g,N).indexOfRefraction=E}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(E,U,g)=>B(E,U,g).iridescence.xu,getTarget:B,set:(E,U,g,N)=>B(U,g,N).iridescence.xu=E},iridescenceIor:{type:"number",get:(E,U,g)=>B(E,U,g).iridescence.indexOfRefraction,getTarget:B,set:(E,U,g,N)=>B(U,g,N).iridescence.indexOfRefraction=E},iridescenceTexture:{extensions:{KHR_texture_transform:P("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(E,U,g)=>B(E,U,g).iridescence.maximumThickness,getTarget:B,set:(E,U,g,N)=>B(U,g,N).iridescence.maximumThickness=E},iridescenceThicknessMinimum:{type:"number",get:(E,U,g)=>B(E,U,g).iridescence.minimumThickness,getTarget:B,set:(E,U,g,N)=>B(U,g,N).iridescence.minimumThickness=E},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:P("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"VU",get:(E,U,g)=>B(E,U,g).sheen.color,getTarget:B,set:(E,U,g,N)=>B(U,g,N).sheen.color.D(E)},sheenColorTexture:{extensions:{KHR_texture_transform:P("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(E,U,g)=>B(E,U,g).sheen.xu,getTarget:B,set:(E,U,g,N)=>B(U,g,N).sheen.xu=E},sheenRoughnessTexture:{extensions:{KHR_texture_transform:P("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(E,U,g)=>B(E,U,g).metallicF0Factor,getTarget:B,set:(E,U,g,N)=>B(U,g,N).metallicF0Factor=E,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"VU",get:(E,U,g)=>B(E,U,g).metallicReflectanceColor,getTarget:B,set:(E,U,g,N)=>B(U,g,N).metallicReflectanceColor.D(E),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:P("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:P("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(E,U,g)=>B(E,U,g).subSurface.refractionIntensity,getTarget:B,set:(E,U,g,N)=>B(U,g,N).subSurface.refractionIntensity=E,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(E,U,g)=>B(E,U,g).subSurface.translucencyIntensity,getTarget:B,set:(E,U,g,N)=>B(U,g,N).subSurface.translucencyIntensity=E},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"VU",get:(E,U,g)=>B(E,U,g).subSurface.translucencyColor,getTarget:B,set:(E,U,g,N)=>{var L;return E&&(null===(L=B(U,g,N).subSurface.translucencyColor)||void 0===L?void 0:L.D(E))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"VU",get:(E,U,g)=>B(E,U,g).subSurface.tintColor,getTarget:B,set:(E,U,g,N)=>B(U,g,N).subSurface.tintColor.D(E)},attenuationDistance:{type:"number",get:(E,U,g)=>B(E,U,g).subSurface.tintColorAtDistance,getTarget:B,set:(E,U,g,N)=>B(U,g,N).subSurface.tintColorAtDistance=E},thicknessFactor:{type:"number",get:(E,U,g)=>B(E,U,g).subSurface.maximumThickness,getTarget:B,set:(E,U,g,N)=>B(U,g,N).subSurface.maximumThickness=E},thicknessTexture:{extensions:{KHR_texture_transform:P("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonLight)),getPropertyName:[E=>"length"]},__array__:{__target__:!0,color:{type:"VU",get:E=>{var U;return null===(U=E._babylonLight)||void 0===U?void 0:U.lu},set:(E,U)=>{var g;return null===(g=U._babylonLight)||void 0===g?void 0:g.lu.D(E)},getTarget:E=>E._babylonLight,getPropertyName:[E=>"diffuse"]},xu:{type:"number",get:E=>{var U;return null===(U=E._babylonLight)||void 0===U?void 0:U.xu},set:(E,U)=>U._babylonLight?U._babylonLight.xu=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"intensity"]},range:{type:"number",get:E=>{var U;return null===(U=E._babylonLight)||void 0===U?void 0:U.range},set:(E,U)=>U._babylonLight?U._babylonLight.range=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"range"]},spot:{innerConeAngle:{type:"number",get:E=>{var U;return null===(U=E._babylonLight)||void 0===U?void 0:U.innerAngle},set:(E,U)=>U._babylonLight?U._babylonLight.innerAngle=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"innerConeAngle"]},outerConeAngle:{type:"number",get:E=>{var U;return null===(U=E._babylonLight)||void 0===U?void 0:U.angle},set:(E,U)=>U._babylonLight?U._babylonLight.angle=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonLight)),getPropertyName:[E=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonTexture)),getPropertyName:[E=>"length"]},__array__:{__target__:!0,xu:{type:"number",get:E=>{var U;return null===(U=E._babylonTexture)||void 0===U?void 0:U.level},set:(E,U)=>{U._babylonTexture&&(U._babylonTexture.level=E)},getTarget:E=>E._babylonTexture},rotation:{type:"Quaternion",get:E=>{var U;return E._babylonTexture&&N.Quaternion.FromRotationMatrix(null===(U=E._babylonTexture)||void 0===U?void 0:U.getReflectionTextureMatrix())},set:(E,U)=>{var g;U._babylonTexture&&(null!==(g=U._babylonTexture.tE())&&void 0!==g&&g.useRightHandedSystem||(E=N.Quaternion.Inverse(E)),N.Matrix.FromQuaternionToRef(E,U._babylonTexture.getReflectionTextureMatrix()))},getTarget:E=>E._babylonTexture}}}}},animations:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>{var U;return null===(U=E.primitives[0]._instanceData)||void 0===U?void 0:U.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function f(E){return new s(E,F)}function d(E){const U=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let g=F;for(const N of U)N&&(g=g[N]);if(g&&g.type&&g.get)return g}function I(E,U){const g=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let N=F;for(const L of g)L&&(N=N[L]);N&&N.type&&N.get&&(N.interpolation=U)}function y(E,U){const g=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let N=F;for(const L of g)if(L){if(!N[L]){if("?"===L){N.__ignoreObjectTree__=!0;continue}N[L]={},"__array__"===L&&(N[L].__target__=!0)}N=N[L]}Object.assign(N,U)}},14005:(E,U,g)=>{"use strict";g.r(U),g.d(U,{AnimationPropertyInfo:()=>C,TransformNodeAnimationPropertyInfo:()=>B,WeightAnimationPropertyInfo:()=>P,getQuaternion:()=>u,getVector3:()=>S,getWeights:()=>s});var N=g(12853),L=g(12334),D=g(13992);function S(E,U,g,N){return L.dU.eU(U,g).scaleInPlace(N)}function u(E,U,g,N){return L.Quaternion.eU(U,g).scaleInPlace(N)}function s(E,U,g,N){const L=new Array(E._numMorphTargets);for(let D=0;D<L.length;D++)L[D]=U[g++]*N;return L}class C{constructor(E,U,g,N){this.type=E,this.name=U,this.getValue=g,this.getStride=N}_buildAnimation(E,U,g){const L=new N.c(E,this.name,U,this.type);return L.setKeys(g),L}}class B extends C{buildAnimations(E,U,g,N){const L=[];return L.push({babylonAnimatable:E._babylonTransformNode,babylonAnimation:this._buildAnimation(U,g,N)}),L}}class P extends C{buildAnimations(E,U,g,L){const D=[];if(E._numMorphTargets)for(let S=0;S<E._numMorphTargets;S++){const u=new N.c(`${U}_${S}`,this.name,g,this.type);if(u.setKeys(L.map((E=>({frame:E.frame,inTangent:E.inTangent?E.inTangent[S]:void 0,value:E.value[S],outTangent:E.outTangent?E.outTangent[S]:void 0,interpolation:E.interpolation})))),E._primitiveBabylonMeshes)for(const U of E._primitiveBabylonMeshes)if(U.morphTargetManager){const E=U.morphTargetManager.getTarget(S),g=u.clone();E.animations.push(g),D.push({babylonAnimatable:E,babylonAnimation:g})}}return D}}(0,D.n)("/nodes/{}/translation",[new B(N.c.ANIMATIONTYPE_VECTOR3,"position",S,(()=>3))]),(0,D.n)("/nodes/{}/rotation",[new B(N.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",u,(()=>4))]),(0,D.n)("/nodes/{}/scale",[new B(N.c.ANIMATIONTYPE_VECTOR3,"Iu",S,(()=>3))]),(0,D.n)("/nodes/{}/weights",[new P(N.c.ANIMATIONTYPE_FLOAT,"influence",s,(E=>E._numMorphTargets))])},13952:(E,U,g)=>{"use strict";class N{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((E,U)=>{this._resolve=E,this._reject=U}))}}var L=g(12334),D=g(12379),S=g(12165),u=g(12781),s=g(13954),C=g(13972),B=g(12174),P=g(12811),F=g(12853),f=g(12857),d=g(12205),I=g(12186),y=g(12188);class h{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(E){this._useTextureToStoreBoneMatrices=E,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(E,U,g){this.name=E,this.id=U,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=L.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new B.b,this.bones=[],this._scene=g||d.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const N=this._scene.getEngine().getCaps();this._canUseTextureForBones=N.textureFloat&&N.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((E=>!E.getParent()))}getTransformMatrices(E){if(this.needInitialSkinMatrix){if(!E)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return E._bonesTransformMatrices||this.prepare(!0),E._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(E){return this.needInitialSkinMatrix&&E._transformMatrixTexture?E._transformMatrixTexture:this._transformMatrixTexture}tE(){return this._scene}toString(E){let U=`Name: ${this.name}, nBones: ${this.bones.length}`;if(U+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,E){U+=", Ranges: {";let E=!0;for(const g in this._ranges)E&&(U+=", ",E=!1),U+=g;U+="}"}return U}getBoneIndexByName(E){for(let U=0,g=this.bones.length;U<g;U++)if(this.bones[U].name===E)return U;return-1}createAnimationRange(E,U,g){if(!this._ranges[E]){this._ranges[E]=new f.d(E,U,g);for(let N=0,L=this.bones.length;N<L;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].createRange(E,U,g)}}deleteAnimationRange(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let g=0,N=this.bones.length;g<N;g++)this.bones[g].animations[0]&&this.bones[g].animations[0].deleteRange(E,U);this._ranges[E]=null}getAnimationRange(E){return this._ranges[E]||null}getAnimationRanges(){const E=[];let U;for(U in this._ranges)E.push(this._ranges[U]);return E}copyAnimationRange(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[U]||!E.getAnimationRange(U))return!1;let N=!0;const L=this._getHighestAnimationFrame()+1,D={},S=E.bones;let u,s;for(s=0,u=S.length;s<u;s++)D[S[s].name]=S[s];this.bones.length!==S.length&&(I.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${S.length}`),N=!1);const C=g&&this.dimensionsAtRest&&E.dimensionsAtRest?this.dimensionsAtRest.divide(E.dimensionsAtRest):null;for(s=0,u=this.bones.length;s<u;s++){const E=this.bones[s].name,S=D[E];S?N=N&&this.bones[s].copyAnimationRange(S,U,L,g,C):(I.d.Warn("copyAnimationRange: not same rig, missing source bone "+E),N=!1)}const B=E.getAnimationRange(U);return B&&(this._ranges[U]=new f.d(U,B.from+L,B.to+L)),N}returnToRest(){for(const E of this.bones)-1!==E._index&&E.returnToRest()}_getHighestAnimationFrame(){let E=0;for(let U=0,g=this.bones.length;U<g;U++)if(this.bones[U].animations[0]){const g=this.bones[U].animations[0].getHighestFrame();E<g&&(E=g)}return E}beginAnimation(E,U,g,N){const L=this.getAnimationRange(E);return L?this._scene.beginAnimation(this,L.from,L.to,U,g,N):null}static MakeAnimationAdditive(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,g=arguments.length>2?arguments[2]:void 0;const N=E.getAnimationRange(g);if(!N)return null;const L=E._scene.getAllAnimatablesByTarget(E);let D=null;for(let u=0;u<L.length;u++){const E=L[u];if(E.fromFrame===(null===N||void 0===N?void 0:N.from)&&E.toFrame===(null===N||void 0===N?void 0:N.to)){D=E;break}}const S=E.getAnimatables();for(let u=0;u<S.length;u++){const E=S[u].animations;if(E)for(let N=0;N<E.length;N++)F.c.MakeAnimationAdditive(E[N],U,g)}return D&&(D.isAdditive=!0),E}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(E){this._meshesWithPoseMatrix.push(E)}_unregisterMeshWithPoseMatrix(E){const U=this._meshesWithPoseMatrix.indexOf(E);U>-1&&this._meshesWithPoseMatrix.splice(U,1)}_computeTransformMatrices(E,U){this.onBeforeComputeObservable.notifyObservers(this);for(let g=0;g<this.bones.length;g++){const N=this.bones[g];N._childUpdateId++;const L=N.getParent();if(L?N.getLocalMatrix().multiplyToRef(L.getFinalMatrix(),N.getFinalMatrix()):U?N.getLocalMatrix().multiplyToRef(U,N.getFinalMatrix()):N.getFinalMatrix().D(N.getLocalMatrix()),-1!==N._index){const U=null===N._index?g:N._index;N.getAbsoluteInverseBindMatrix().multiplyToArray(N.getFinalMatrix(),E,16*U)}}this._identity.copyToArray(E,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const E=this.tE().getRenderId();if(this._currentRenderId===E)return;this._currentRenderId=E}if(this._numBonesWithLinkedTransformNode>0)for(const E of this.bones)if(E._linkedTransformNode){const U=E._linkedTransformNode;E.position=U.position,U.rotationQuaternion?E.rotationQuaternion=U.rotationQuaternion:E.rotation=U.rotation,E.Iu=U.Iu}if(this.needInitialSkinMatrix)for(const E of this._meshesWithPoseMatrix){const U=E.getPoseMatrix();let g=this._isDirty;if(E._bonesTransformMatrices&&E._bonesTransformMatrices.length===16*(this.bones.length+1)||(E._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),g=!0),g){if(this._synchronizedWithMesh!==E){this._synchronizedWithMesh=E;for(const E of this.bones)if(!E.getParent()){E.getBindMatrix().multiplyToRef(U,L.TmpVectors.Matrix[1]),E._updateAbsoluteBindMatrices(L.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const U=4*(this.bones.length+1);E._transformMatrixTexture&&E._transformMatrixTexture.getSize().width===U||(E._transformMatrixTexture&&E._transformMatrixTexture.dispose(),E._transformMatrixTexture=P.e.CreateRGBATexture(E._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(E._bonesTransformMatrices,U),this.isUsingTextureForMatrices&&E._transformMatrixTexture&&E._transformMatrixTexture.update(E._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=P.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let E=0;E<this.bones.length;E++)this._animatables.push(this.bones[E])}return this._animatables}clone(E,U){const g=new h(E,U||E,this._scene);g.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let N=0;N<this.bones.length;N++){const E=this.bones[N];let U=null;const L=E.getParent();if(L){const E=this.bones.indexOf(L);U=g.bones[E]}const D=new C.b(E.name,g,U,E.getBindMatrix().clone(),E.getRestMatrix().clone());D._index=E._index,E._linkedTransformNode&&D.linkTransformNode(E._linkedTransformNode),y.b.DeepCopy(E.animations,D.animations)}if(this._ranges){g._ranges={};for(const E in this._ranges){const U=this._ranges[E];U&&(g._ranges[E]=U.clone())}}return this._isDirty=!0,g.prepare(!0),g}enableBlending(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const U of this.bones)for(const g of U.animations)g.enableBlending=!0,g.blendingSpeed=E}dispose(){if(this._meshesWithPoseMatrix.length=0,this.tE().stopAnimation(this),this.tE().removeSkeleton(this),this._parentContainer){const E=this._parentContainer.skeletons.indexOf(this);E>-1&&this._parentContainer.skeletons.splice(E,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const E={};E.name=this.name,E.id=this.id,this.dimensionsAtRest&&(E.dimensionsAtRest=this.dimensionsAtRest.Og()),E.bones=[],E.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let g=0;g<this.bones.length;g++){var U;const N=this.bones[g],L=N.getParent(),D={parentBoneIndex:L?this.bones.indexOf(L):-1,index:N.getIndex(),name:N.name,id:N.id,matrix:N.getBindMatrix().Og(),rest:N.getRestMatrix().Og(),linkedTransformNodeId:null===(U=N.getTransformNode())||void 0===U?void 0:U.id};E.bones.push(D),N.length&&(D.length=N.length),N.metadata&&(D.metadata=N.metadata),N.animations&&N.animations.length>0&&(D.animation=N.animations[0].serialize()),E.ranges=[];for(const U in this._ranges){const g=this._ranges[U];if(!g)continue;const N={};N.name=U,N.from=g.from,N.to=g.to,E.ranges.push(N)}}return E}static Parse(E,U){const g=new h(E.name,E.id,U);let N;for(E.dimensionsAtRest&&(g.dimensionsAtRest=L.dU.eU(E.dimensionsAtRest)),g.needInitialSkinMatrix=E.needInitialSkinMatrix,N=0;N<E.bones.length;N++){const U=E.bones[N],D=E.bones[N].index;let S=null;U.parentBoneIndex>-1&&(S=g.bones[U.parentBoneIndex]);const u=U.rest?L.Matrix.eU(U.rest):null,s=new C.b(U.name,g,S,L.Matrix.eU(U.matrix),u,null,D);void 0!==U.id&&null!==U.id&&(s.id=U.id),U.length&&(s.length=U.length),U.metadata&&(s.metadata=U.metadata),U.animation&&s.animations.push(F.c.Parse(U.animation)),void 0!==U.linkedTransformNodeId&&null!==U.linkedTransformNodeId&&(g._hasWaitingData=!0,s._waitingTransformNodeId=U.linkedTransformNodeId)}if(E.ranges)for(N=0;N<E.ranges.length;N++){const U=E.ranges[N];g.createAnimationRange(U.name,U.from,U.to)}return g}computeAbsoluteMatrices(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||E)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(E)}getPoseMatrix(){let E=null;return this._meshesWithPoseMatrix.length>0&&(E=this._meshesWithPoseMatrix[0].getPoseMatrix()),E}sortBones(){const E=[],U=new Array(this.bones.length);for(let g=0;g<this.bones.length;g++)this._sortBones(g,E,U);this.bones=E}_sortBones(E,U,g){if(g[E])return;g[E]=!0;const N=this.bones[E];if(!N)return;void 0===N._index&&(N._index=E);const L=N.getParent();L&&this._sortBones(this.bones.indexOf(L),U,g),U.push(N)}setCurrentPoseAsRest(){for(const E of this.bones)E.setCurrentPoseAsRest()}}var V=g(12656),e=g(12829),x=g(12311),l=g(12750),Y=g(12407),t=g(12790),G=g(12760),b=g(12774),T=g(12866),v=g(12422),o=g(13918);class c{set areUpdatesFrozen(E){E?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new v.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,E||(E=d.b.LastCreatedScene),this._scene=E,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const E=this._scene.getEngine().getCaps();this._canUseTextureForTargets=E.canUseGLVertexID&&E.textureFloat&&E.maxVertexTextureImageUnits>0&&E.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return c.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?c.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(E){this._numMaxInfluencers!==E&&(this._numMaxInfluencers=E,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(E){this._useTextureToStoreTargets!==E&&(this._useTextureToStoreTargets=E,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var E;return c.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(E=this._scene)&&void 0!==E&&E.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(E){return this._activeTargets.data[E]}getTarget(E){return this._targets[E]}getTargetByName(E){for(const U of this._targets)if(U.name===E)return U;return null}addTarget(E){this._targets.push(E),this._targetInfluenceChangedObservers.push(E.onInfluenceChanged.add((E=>{this.areUpdatesFrozen&&E&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(E)}))),this._targetDataLayoutChangedObservers.push(E._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(E){const U=this._targets.indexOf(E);U>=0&&(this._targets.splice(U,1),E.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(U,1)[0]),E._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(U,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(E)}_bind(E){E.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),E.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),E.setTexture("morphTargets",this._targetStoreTexture),E.setInt("morphTargetCount",this.numInfluencers)}clone(){const E=new c(this._scene);for(const U of this._targets)E.addTarget(U.clone());return E.enablePositionMorphing=this.enablePositionMorphing,E.enableNormalMorphing=this.enableNormalMorphing,E.enableTangentMorphing=this.enableTangentMorphing,E.enableUVMorphing=this.enableUVMorphing,E.enableUV2Morphing=this.enableUV2Morphing,E.enableColorMorphing=this.enableColorMorphing,E}serialize(){const E={};E.id=this.uniqueId,E.targets=[];for(const U of this._targets)E.targets.push(U.serialize());return E}_syncActiveTargets(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const U=!!this._targetStoreTexture,g=this.isUsingTextureForTargets;(this._mustSynchronize||U!==g)&&(this._mustSynchronize=!1,this.synchronize());let N=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let L=-1;for(const D of this._targets)if(L++,0!==D.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=c.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(D),this._morphTargetTextureIndices[N]=L,this._tempInfluences[N++]=D.influence}this._morphTargetTextureIndices.length!==N&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,N)),this._influences&&this._influences.length===N||(this._influences=new Float32Array(N));for(let D=0;D<N;D++)this._influences[D]=this._tempInfluences[D];if(E&&this._scene)for(const D of this._scene.meshes)D.morphTargetManager===this&&(g?D._markSubMeshesAsAttributesDirty():D._syncGeometryWithMorphTargetManager())}synchronize(){var E;if(!this._scene||this.areUpdatesFrozen)return;const U=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(E=this._targetStoreTexture)||void 0===E||E.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>U.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const g of this._targets){this._supportsPositions=this._supportsPositions&&g.hasPositions,this._supportsNormals=this._supportsNormals&&g.hasNormals,this._supportsTangents=this._supportsTangents&&g.hasTangents,this._supportsUVs=this._supportsUVs&&g.hasUVs,this._supportsUV2s=this._supportsUV2s&&g.hasUV2s,this._supportsColors=this._supportsColors&&g.hasColors;const E=g.vertexCount;if(0===this._vertexCount)this._vertexCount=E;else if(this._vertexCount!==E)return void I.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${g.name}": ${E}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const E=U.getCaps().maxTextureSize;this._textureWidth>E&&(this._textureHeight=Math.ceil(this._textureWidth/E),this._textureWidth=E);const g=this._targets.length,N=new Float32Array(g*this._textureWidth*this._textureHeight*4);let L=0;for(let U=0;U<g;U++){const E=this._targets[U],g=E.getPositions(),D=E.getNormals(),S=E.getUVs(),u=E.getTangents(),s=E.getUV2s(),C=E.getColors();L=U*this._textureWidth*this._textureHeight*4;for(let U=0;U<this._vertexCount;U++)this._supportsPositions&&g&&(N[L]=g[3*U],N[L+1]=g[3*U+1],N[L+2]=g[3*U+2],L+=4),this._supportsNormals&&D&&(N[L]=D[3*U],N[L+1]=D[3*U+1],N[L+2]=D[3*U+2],L+=4),this._supportsUVs&&S&&(N[L]=S[2*U],N[L+1]=S[2*U+1],L+=4),this._supportsTangents&&u&&(N[L]=u[3*U],N[L+1]=u[3*U+1],N[L+2]=u[3*U+2],L+=4),this._supportsUV2s&&s&&(N[L]=s[2*U],N[L+1]=s[2*U+1],L+=4),this._supportsColors&&C&&(N[L]=C[4*U],N[L+1]=C[4*U+1],N[L+2]=C[4*U+2],N[L+3]=C[4*U+3],L+=4)}this._targetStoreTexture=o.e.CreateRGBATexture(N,this._textureWidth,this._textureHeight,g,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const g of this._scene.meshes)g.morphTargetManager===this&&g._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const E=this._parentContainer.morphTargetManagers.indexOf(this);E>-1&&this._parentContainer.morphTargetManagers.splice(E,1),this._parentContainer=null}for(const E of this._targets)this._scene.stopAnimation(E)}}static Parse(E,U){const g=new c(U);for(const N of E.targets)g.addTarget(T.c.Parse(N,U));return g}}c.EnableTextureStorage=!0,c.MaxActiveMorphTargetsInVertexAttributeMode=8,c.ConstantTargetCountForTextureMode=0;var r=g(13981),j=g(12210),Z=g(12675);const A=new Map,w=A;function a(E,U,g){J(E)&&I.d.Warn(`Extension with the name '${E}' already exists`),A.set(E,{isGLTFExtension:U,factory:g})}function J(E){return A.delete(E)}var q=g(13992),M=g(12914),mE=g(12418);class W{static Get(E,U,g){if(!U||void 0==g||!U[g])throw new Error(`${E}: Failed to find index (${g})`);return U[g]}static TryGet(E,U){return E&&void 0!=U&&E[U]?E[U]:null}static Assign(E){if(E)for(let U=0;U<E.length;U++)E[U].index=U}}function O(E){if(E.min&&E.max){const U=E.min,g=E.max,N=L.TmpVectors.dU[0].du(U[0],U[1],U[2]),D=L.TmpVectors.dU[1].du(g[0],g[1],g[2]);if(E.normalized&&5126!==E.componentType){let U=1;switch(E.componentType){case 5120:U=127;break;case 5121:U=255;break;case 5122:U=32767;break;case 5123:U=65535}const g=1/U;N.scaleInPlace(g),D.scaleInPlace(g)}return new Z.b(N,D)}return null}class Q{static RegisterExtension(E,U){a(E,!1,U)}static UnregisterExtension(E){return J(E)}get Zg(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(E){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=E}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((E=>E.dispose&&E.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(E,U,g,N,L,D){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=U,this._assetContainer=g,this._loadData(N);let D=null;if(E){const U={};if(this._gltf.nodes)for(const E of this._gltf.nodes)E.name&&(U[E.name]=E.index);D=(E instanceof Array?E:[E]).map((E=>{const g=U[E];if(void 0===g)throw new Error(`Failed to find node '${E}'`);return g}))}return await this._loadAsync(L,S,D,(()=>({meshes:this._getMeshes(),RP:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=E,this._loadData(U),await this._loadAsync(g,L,null,(()=>{}))}async _loadAsync(E,U,g,N){return await Promise.resolve().then((async()=>{this._rootUrl=E,this._uniqueRootUrl=!E.startsWith("file:")&&U?E:`${E}${Date.now()}/`,this._fileName=U,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const L=`${r.h[r.h.LOADING]} => ${r.h[r.h.READY]}`,D=`${r.h[r.h.LOADING]} => ${r.h[r.h.COMPLETE]}`;this._parent._startPerformanceCounter(L),this._parent._startPerformanceCounter(D),this._parent._setState(r.h.LOADING),this._extensionsOnLoading();const u=new Array;if(!this.parent.loadOnlyMaterials)if(g)u.push(this.loadSceneAsync("/nodes",{nodes:g,index:-1}));else if(void 0!=this._gltf.yU||this._gltf.scenes&&this._gltf.scenes[0]){const E=W.Get("/scene",this._gltf.scenes,this._gltf.yU||0);u.push(this.loadSceneAsync(`/scenes/${E.index}`,E))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let E=0;E<this._gltf.materials.length;++E){const U=this._gltf.materials[E],g="/materials/"+E,N=V.b.TriangleFillMode;u.push(this._loadMaterialAsync(g,U,null,N,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&u.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&u.push(this._compileShadowGeneratorsAsync());const s=Promise.all(u).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.qu(!0);for(const E of this._babylonScene.materials){const U=E;void 0!==U.maxSimultaneousLights&&(U.maxSimultaneousLights=Math.max(U.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(r.h.READY),this._skipStartAnimationStep||this._startAnimations(),N()}));return await s.then((E=>(this._parent._endPerformanceCounter(L),S.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(D),this._parent._setState(r.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(E=>{this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()}))})),E)))})).catch((E=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()),E}))}_loadData(E){if(this._gltf=E.json,this._setupData(),E.bin){const U=this._gltf.buffers;if(U&&U[0]&&!U[0].uri){const g=U[0];(g.byteLength<E.bin.byteLength-3||g.byteLength>E.bin.byteLength)&&I.d.Warn(`Binary buffer length (${g.byteLength}) from JSON does not match chunk length (${E.bin.byteLength})`),this._bin=E.bin}else I.d.Warn("Unexpected BIN chunk")}}_setupData(){if(W.Assign(this._gltf.accessors),W.Assign(this._gltf.animations),W.Assign(this._gltf.buffers),W.Assign(this._gltf.bufferViews),W.Assign(this._gltf.cameras),W.Assign(this._gltf.images),W.Assign(this._gltf.materials),W.Assign(this._gltf.meshes),W.Assign(this._gltf.nodes),W.Assign(this._gltf.samplers),W.Assign(this._gltf.scenes),W.Assign(this._gltf.skins),W.Assign(this._gltf.textures),this._gltf.nodes){const E={};for(const g of this._gltf.nodes)if(g.children)for(const U of g.children)E[U]=g.index;const U=this._createRootNode();for(const g of this._gltf.nodes){const N=E[g.index];g.parent=void 0===N?U:this._gltf.nodes[N]}}}async _loadExtensionsAsync(){const E=[];if(w.forEach(((U,g)=>{var N;!1===(null===(N=this.parent.extensionOptions[g])||void 0===N?void 0:N.enabled)?U.isGLTFExtension&&this.isExtensionUsed(g)&&I.d.Warn(`Extension ${g} is used but has been explicitly disabled.`):U.isGLTFExtension&&!this.isExtensionUsed(g)||E.push((async()=>{const E=await U.factory(this);return E.name!==g&&I.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${E.name} !== ${g}`),this._parent.onExtensionLoadedObservable.notifyObservers(E),E})())})),this._extensions.push(...await Promise.all(E)),this._extensions.sort(((E,U)=>(E.order||Number.MAX_VALUE)-(U.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const g of this._gltf.extensionsRequired){if(!this._extensions.some((E=>E.name===g&&E.enabled))){var U;if(!1===(null===(U=this.parent.extensionOptions[g])||void 0===U?void 0:U.enabled))throw new Error(`Required extension ${g} is disabled`);throw new Error(`Required extension ${g} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new b.e("__root__",this._babylonScene);this._rootBabylonMesh=E,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.qu(!1);const U={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case r.f.AUTO:this._babylonScene.useRightHandedSystem||(U.rotation=[0,1,0,0],U.scale=[1,1,-1],Q._LoadTransform(U,this._rootBabylonMesh));break;case r.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(E),U}loadSceneAsync(E,U){const g=this._extensionsLoadSceneAsync(E,U);if(g)return g;const N=new Array;if(this.logOpen(`${E} ${U.name||""}`),U.nodes)for(const L of U.nodes){const U=W.Get(`${E}/nodes/${L}`,this._gltf.nodes,L);N.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(E=>{E.parent=this._rootBabylonMesh})))}for(const L of this._postSceneLoadActions)L();return N.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(N).then((()=>{}))}_forEachPrimitive(E,U){if(E._primitiveBabylonMeshes)for(const g of E._primitiveBabylonMeshes)U(g)}_getGeometries(){const E=[],U=this._gltf.nodes;if(U)for(const g of U)this._forEachPrimitive(g,(U=>{const g=U.XL;g&&-1===E.indexOf(g)&&E.push(g)}));return E}_getMeshes(){const E=[];this._rootBabylonMesh instanceof G.b&&E.push(this._rootBabylonMesh);const U=this._gltf.nodes;if(U)for(const g of U)this._forEachPrimitive(g,(U=>{E.push(U)}));return E}_getTransformNodes(){const E=[],U=this._gltf.nodes;if(U)for(const g of U)g._babylonTransformNode&&"Df"===g._babylonTransformNode.getClassName()&&E.push(g._babylonTransformNode),g._babylonTransformNodeForSkin&&E.push(g._babylonTransformNodeForSkin);return E}_getSkeletons(){const E=[],U=this._gltf.skins;if(U)for(const g of U)g._data&&E.push(g._data.babylonSkeleton);return E}_getAnimationGroups(){const E=[],U=this._gltf.animations;if(U)for(const g of U)g._babylonAnimationGroup&&E.push(g._babylonAnimationGroup);return E}_startAnimations(){switch(this._parent.animationStartMode){case r.e.NONE:break;case r.e.FIRST:{const E=this._getAnimationGroups();0!==E.length&&E[0].start(!0);break}case r.e.ALL:{const E=this._getAnimationGroups();for(const U of E)U.start(!0);break}default:return void I.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadNodeAsync(E,U,g);if(N)return N;if(U._babylonTransformNode)throw new Error(`${E}: Invalid recursive node hierarchy`);const L=new Array;this.logOpen(`${E} ${U.name||""}`);const D=N=>{if(Q.AddPointerMetadata(N,E),Q._LoadTransform(U,N),void 0!=U.camera){const g=W.Get(`${E}/camera`,this._gltf.cameras,U.camera);L.push(this.loadCameraAsync(`/cameras/${g.index}`,g,(E=>{E.parent=N,this._babylonScene.useRightHandedSystem||(N.Iu.x=-1)})))}if(U.children)for(const g of U.children){const U=W.Get(`${E}/children/${g}`,this._gltf.nodes,g);L.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(E=>{E.parent=N})))}g(N)},S=void 0!=U.mesh,u=this._parent.loadSkins&&void 0!=U.skin;if(!S||u){const E=U.name||`node${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new l.c(E,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==U.mesh?U._babylonTransformNode=g:U._babylonTransformNodeForSkin=g,D(g)}if(S)if(u){const g=W.Get(`${E}/mesh`,this._gltf.meshes,U.mesh);L.push(this._loadMeshAsync(`/meshes/${g.index}`,U,g,(g=>{const N=U._babylonTransformNodeForSkin;g.metadata=(0,M.d)(N.metadata,g.metadata||{});const D=W.Get(`${E}/skin`,this._gltf.skins,U.skin);L.push(this._loadSkinAsync(`/skins/${D.index}`,U,D,(E=>{this._forEachPrimitive(U,(U=>{U.skeleton=E})),this._postSceneLoadActions.push((()=>{if(void 0!=D.skeleton){const E=W.Get(`/skins/${D.index}/skeleton`,this._gltf.nodes,D.skeleton).parent;U.index===E.index?g.parent=N.parent:g.parent=E._babylonTransformNode}else g.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:N,skinnedNode:g})}))})))})))}else{const g=W.Get(`${E}/mesh`,this._gltf.meshes,U.mesh);L.push(this._loadMeshAsync(`/meshes/${g.index}`,U,g,D))}return this.logClose(),Promise.all(L).then((()=>(this._forEachPrimitive(U,(E=>{const U=E;!U.isAnInstance&&U.XL&&U.XL.useBoundingInfoFromGeometry?E.ZE():E.refreshBoundingInfo(!0,!0)})),U._babylonTransformNode)))}_loadMeshAsync(E,U,g,N){const L=g.primitives;if(!L||!L.length)throw new Error(`${E}: Primitives are missing`);void 0==L[0].index&&W.Assign(L);const D=new Array;this.logOpen(`${E} ${g.name||""}`);const S=U.name||`node${U.index}`;if(1===L.length){const N=g.primitives[0];D.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${N.index}`,S,U,g,N,(E=>{U._babylonTransformNode=E,U._primitiveBabylonMeshes=[E]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,U._babylonTransformNode=new l.c(S,this._babylonScene),U._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._primitiveBabylonMeshes=[];for(const N of L)D.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${N.index}`,`${S}_primitive${N.index}`,U,g,N,(E=>{E.parent=U._babylonTransformNode,U._primitiveBabylonMeshes.push(E)})))}return N(U._babylonTransformNode),this.logClose(),Promise.all(D).then((()=>U._babylonTransformNode))}_loadMeshPrimitiveAsync(E,U,g,N,L,D){const S=this._extensionsLoadMeshPrimitiveAsync(E,U,g,N,L,D);if(S)return S;this.logOpen(`${E}`);const u=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==g.skin&&!N.primitives[0].targets;let s,C;if(u&&L._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,s=L._instanceData.babylonSourceMesh.createInstance(U),s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=L._instanceData.promise;else{const D=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new b.e(U,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.sideOrientation=this._babylonScene.useRightHandedSystem?V.b.CounterClockWiseSideOrientation:V.b.ClockWiseSideOrientation,this._createMorphTargets(E,g,N,L,S),D.push(this._loadVertexDataAsync(E,L,S).then((async U=>await this._loadMorphTargetsAsync(E,L,S,U).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,U.rE(S),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const B=Q._GetDrawMode(E,L.mode);if(void 0==L.material){let E=this._defaultBabylonMaterialData[B];E||(E=this._createDefaultMaterial("__GLTFLoader._default",B),this._parent.onMaterialLoadedObservable.notifyObservers(E),this._defaultBabylonMaterialData[B]=E),S.material=E}else if(!this.parent.skipMaterials){const U=W.Get(`${E}/material`,this._gltf.materials,L.material);D.push(this._loadMaterialAsync(`/materials/${U.index}`,U,S,B,(E=>{S.material=E})))}C=Promise.all(D),u&&(L._instanceData={babylonSourceMesh:S,promise:C}),s=S}return Q.AddPointerMetadata(s,E),this._parent.onMeshLoadedObservable.notifyObservers(s),D(s),this.logClose(),C.then((()=>s))}_loadVertexDataAsync(E,U,g){const N=this._extensionsLoadVertexDataAsync(E,U,g);if(N)return N;const L=U.attributes;if(!L)throw new Error(`${E}: Attributes are missing`);const D=new Array,S=new t.e(g.name,this._babylonScene);if(void 0==U.indices)g.isUnIndexed=!0;else{const g=W.Get(`${E}/indices`,this._gltf.accessors,U.indices);D.push(this._loadIndicesAccessorAsync(`/accessors/${g.index}`,g).then((E=>{S.setIndices(E)})))}const u=(U,N,u)=>{if(void 0==L[U])return;g._delayInfo=g._delayInfo||[],-1===g._delayInfo.indexOf(N)&&g._delayInfo.push(N);const s=W.Get(`${E}/attributes/${U}`,this._gltf.accessors,L[U]);D.push(this._loadVertexAccessorAsync(`/accessors/${s.index}`,s,N).then((E=>{if(E.getKind()===Y.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!g.skeleton){const E=O(s);E&&(S._boundingInfo=E,S.useBoundingInfoFromGeometry=!0)}S.setVerticesBuffer(E,s.count)}))),N==Y.f.MatricesIndicesExtraKind&&(g.numBoneInfluencers=8),u&&u(s)};return u("POSITION",Y.f.PositionKind),u("NORMAL",Y.f.NormalKind),u("TANGENT",Y.f.TangentKind),u("TEXCOORD_0",Y.f.UVKind),u("TEXCOORD_1",Y.f.UV2Kind),u("TEXCOORD_2",Y.f.UV3Kind),u("TEXCOORD_3",Y.f.UV4Kind),u("TEXCOORD_4",Y.f.UV5Kind),u("TEXCOORD_5",Y.f.UV6Kind),u("JOINTS_0",Y.f.MatricesIndicesKind),u("WEIGHTS_0",Y.f.MatricesWeightsKind),u("JOINTS_1",Y.f.MatricesIndicesExtraKind),u("WEIGHTS_1",Y.f.MatricesWeightsExtraKind),u("COLOR_0",Y.f.ColorKind,(E=>{"VEC4"===E.type&&(g.hasVertexAlpha=!0)})),Promise.all(D).then((()=>S))}_createMorphTargets(E,U,g,N,L){if(!N.targets||!this._parent.loadMorphTargets)return;if(void 0==U._numMorphTargets)U._numMorphTargets=N.targets.length;else if(N.targets.length!==U._numMorphTargets)throw new Error(`${E}: Primitives do not have the same number of targets`);const D=g.extras?g.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,L.morphTargetManager=new c(this._babylonScene),L.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.morphTargetManager.areUpdatesFrozen=!0;for(let S=0;S<N.targets.length;S++){const E=U.weights?U.weights[S]:g.weights?g.weights[S]:0,N=D?D[S]:`morphTarget${S}`;L.morphTargetManager.addTarget(new T.c(N,E,L.tE()))}}_loadMorphTargetsAsync(E,U,g,N){if(!U.targets||!this._parent.loadMorphTargets)return Promise.resolve();const L=new Array,D=g.morphTargetManager;for(let S=0;S<D.numTargets;S++){const g=D.getTarget(S);L.push(this._loadMorphTargetVertexDataAsync(`${E}/targets/${S}`,N,U.targets[S],g))}return Promise.all(L).then((()=>{D.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(E,U,g,N){const L=new Array,D=(N,D,S)=>{if(void 0==g[N])return;const u=U.getVertexBuffer(D);if(!u)return;const s=W.Get(`${E}/${N}`,this._gltf.accessors,g[N]);L.push(this._loadFloatAccessorAsync(`/accessors/${s.index}`,s).then((E=>{S(u,E)})))};return D("POSITION",Y.f.PositionKind,((E,U)=>{const g=new Float32Array(U.length);E.forEach(U.length,((E,N)=>{g[N]=U[N]+E})),N.setPositions(g)})),D("NORMAL",Y.f.NormalKind,((E,U)=>{const g=new Float32Array(U.length);E.forEach(g.length,((E,N)=>{g[N]=U[N]+E})),N.setNormals(g)})),D("TANGENT",Y.f.TangentKind,((E,U)=>{const g=new Float32Array(U.length/3*4);let L=0;E.forEach(U.length/3*4,((E,N)=>{(N+1)%4!==0&&(g[L]=U[L]+E,L++)})),N.setTangents(g)})),D("TEXCOORD_0",Y.f.UVKind,((E,U)=>{const g=new Float32Array(U.length);E.forEach(U.length,((E,N)=>{g[N]=U[N]+E})),N.setUVs(g)})),D("TEXCOORD_1",Y.f.UV2Kind,((E,U)=>{const g=new Float32Array(U.length);E.forEach(U.length,((E,N)=>{g[N]=U[N]+E})),N.setUV2s(g)})),D("COLOR_0",Y.f.ColorKind,((U,g)=>{let L=null;const D=U.getSize();if(3===D){L=new Float32Array(g.length/3*4),U.forEach(g.length,((E,U)=>{const N=Math.floor(U/3),D=U%3;L[4*N+D]=g[3*N+D]+E}));for(let E=0;E<g.length/3;++E)L[4*E+3]=1}else{if(4!==D)throw new Error(`${E}: Invalid number of components (${D}) for COLOR_0 attribute`);L=new Float32Array(g.length),U.forEach(g.length,((E,U)=>{L[U]=g[U]+E}))}N.setColors(L)})),await Promise.all(L).then((()=>{}))}static _LoadTransform(E,U){if(void 0!=E.skin)return;let g=L.dU.Zero(),N=L.Quaternion.Identity(),D=L.dU.One();if(E.matrix){L.Matrix.eU(E.matrix).decompose(D,N,g)}else E.translation&&(g=L.dU.eU(E.translation)),E.rotation&&(N=L.Quaternion.eU(E.rotation)),E.scale&&(D=L.dU.eU(E.scale));U.position=g,U.rotationQuaternion=N,U.Iu=D}_loadSkinAsync(E,U,g,N){if(!this._parent.loadSkins)return Promise.resolve();const L=this._extensionsLoadSkinAsync(E,U,g);if(L)return L;if(g._data)return N(g._data.babylonSkeleton),g._data.promise;const D=`skeleton${g.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new h(g.name||D,D,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(E,g,S);const u=this._loadSkinInverseBindMatricesDataAsync(E,g).then((E=>{this._updateBoneMatrices(S,E)}));return g._data={babylonSkeleton:S,promise:u},N(S),u}_loadBones(E,U,g){if(void 0==U.skeleton||this._parent.alwaysComputeSkeletonRootNode){const g=this._findSkeletonRootNode(`${E}/joints`,U.joints);if(g)if(void 0===U.skeleton)U.skeleton=g.index;else{const N=(E,U)=>{for(;U.parent;U=U.parent)if(U.parent===E)return!0;return!1},L=W.Get(`${E}/skeleton`,this._gltf.nodes,U.skeleton);L===g||N(L,g)||(I.d.Warn(`${E}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),U.skeleton=g.index)}else I.d.Warn(`${E}: Failed to find common root`)}const N={};for(const L of U.joints){const D=W.Get(`${E}/joints/${L}`,this._gltf.nodes,L);this._loadBone(D,U,g,N)}}_findSkeletonRootNode(E,U){if(0===U.length)return null;const g={};for(const L of U){const U=[];let N=W.Get(`${E}/${L}`,this._gltf.nodes,L);for(;-1!==N.index;)U.unshift(N),N=N.parent;g[L]=U}let N=null;for(let L=0;;++L){let E=g[U[0]];if(L>=E.length)return N;const D=E[L];for(let S=1;S<U.length;++S)if(E=g[U[S]],L>=E.length||D!==E[L])return N;N=D}}_loadBone(E,U,g,N){E._isJoint=!0;let L=N[E.index];if(L)return L;let D=null;E.index!==U.skeleton&&(E.parent&&-1!==E.parent.index?D=this._loadBone(E.parent,U,g,N):void 0!==U.skeleton&&I.d.Warn(`/skins/${U.index}/skeleton: Skeleton node is not a common root`));const S=U.joints.indexOf(E.index);return L=new C.b(E.name||`joint${E.index}`,g,D,this._getNodeMatrix(E),null,null,S),N[E.index]=L,this._postSceneLoadActions.push((()=>{L.linkTransformNode(E._babylonTransformNode)})),L}_loadSkinInverseBindMatricesDataAsync(E,U){if(void 0==U.inverseBindMatrices)return Promise.resolve(null);const g=W.Get(`${E}/inverseBindMatrices`,this._gltf.accessors,U.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${g.index}`,g)}_updateBoneMatrices(E,U){for(const g of E.bones){const E=L.Matrix.Identity(),N=g._index;U&&-1!==N&&(L.Matrix.FromArrayToRef(U,16*N,E),E.invertToRef(E));const D=g.getParent();D&&E.multiplyToRef(D.getAbsoluteInverseBindMatrix(),E),g.zg(E,!1,!1),g._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(E){return E.matrix?L.Matrix.eU(E.matrix):L.Matrix.Compose(E.scale?L.dU.eU(E.scale):L.dU.One(),E.rotation?L.Quaternion.eU(E.rotation):L.Quaternion.Identity(),E.translation?L.dU.eU(E.translation):L.dU.Zero())}loadCameraAsync(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadCameraAsync(E,U,g);if(N)return N;const D=new Array;this.logOpen(`${E} ${U.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new s.c(U.name||`camera${U.index}`,L.dU.Zero(),this._babylonScene,!1);switch(S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonCamera=S,S.setTarget(new L.dU(0,0,-1)),U.type){case"perspective":{const g=U.perspective;if(!g)throw new Error(`${E}: Camera perspective properties are missing`);S.fov=g.yfov,S.kg=g.znear,S.maxZ=g.zfar||0;break}case"orthographic":if(!U.orthographic)throw new Error(`${E}: Camera orthographic properties are missing`);S.mode=u.d.ORTHOGRAPHIC_CAMERA,S.orthoLeft=-U.orthographic.xmag,S.orthoRight=U.orthographic.xmag,S.orthoBottom=-U.orthographic.ymag,S.orthoTop=U.orthographic.ymag,S.kg=U.orthographic.znear,S.maxZ=U.orthographic.zfar;break;default:throw new Error(`${E}: Invalid camera type (${U.type})`)}return Q.AddPointerMetadata(S,E),this._parent.onCameraLoadedObservable.notifyObservers(S),g(S),this.logClose(),Promise.all(D).then((()=>S))}_loadAnimationsAsync(){const E=this._gltf.animations;if(!E)return Promise.resolve();const U=new Array;for(let g=0;g<E.length;g++){const N=E[g];U.push(this.loadAnimationAsync(`/animations/${N.index}`,N).then((E=>{0===E.targetedAnimations.length&&E.dispose()})))}return Promise.all(U).then((()=>{}))}loadAnimationAsync(E,U){const N=this._extensionsLoadAnimationAsync(E,U);return N||g.e(78).then(g.bind(g,15533)).then((g=>{let{AnimationGroup:N}=g;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new N(U.name||`animation${U.index}`,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonAnimationGroup=L;const D=new Array;W.Assign(U.channels),W.Assign(U.samplers);for(const S of U.channels)D.push(this._loadAnimationChannelAsync(`${E}/channels/${S.index}`,E,U,S,((E,U)=>{E.animations=E.animations||[],E.animations.push(U),L.addTargetedAnimation(U,E)})));return Promise.all(D).then((()=>(L.normalize(0),L)))}))}async _loadAnimationChannelAsync(E,U,N,L,D){const S=this._extensionsLoadAnimationChannelAsync(E,U,N,L,D);if(S)return await S;if(void 0==L.target.node)return await Promise.resolve();const u=W.Get(`${E}/target/node`,this._gltf.nodes,L.target.node),s=L.target.path,C="weights"===s;if(C&&!u._numMorphTargets||!C&&!u._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!u._isJoint)return await Promise.resolve();let B;switch(await Promise.resolve().then(g.bind(g,14005)),s){case"translation":var P;B=null===(P=(0,q.f)("/nodes/{}/translation"))||void 0===P?void 0:P.interpolation;break;case"rotation":var F;B=null===(F=(0,q.f)("/nodes/{}/rotation"))||void 0===F?void 0:F.interpolation;break;case"scale":var f;B=null===(f=(0,q.f)("/nodes/{}/scale"))||void 0===f?void 0:f.interpolation;break;case"weights":var d;B=null===(d=(0,q.f)("/nodes/{}/weights"))||void 0===d?void 0:d.interpolation;break;default:throw new Error(`${E}/target/path: Invalid value (${L.target.path})`)}if(!B)throw new Error(`${E}/target/path: Could not find interpolation properties for target path (${L.target.path})`);const I={object:u,info:B};return await this._loadAnimationChannelFromTargetInfoAsync(E,U,N,L,I,D)}_loadAnimationChannelFromTargetInfoAsync(E,U,g,N,L,D){const S=this.parent.targetFps,u=1/S,s=W.Get(`${E}/sampler`,g.samplers,N.sampler);return this._loadAnimationSamplerAsync(`${U}/samplers/${N.sampler}`,s).then((E=>{let U=0;const s=L.object,C=L.info;for(const L of C){const C=L.getStride(s),B=E.input,P=E.output,F=new Array(B.length);let f=0;switch(E.interpolation){case"STEP":for(let E=0;E<B.length;E++){const U=L.getValue(s,P,f,1);f+=C,F[E]={frame:B[E]*S,value:U,interpolation:1}}break;case"CUBICSPLINE":for(let E=0;E<B.length;E++){const U=L.getValue(s,P,f,u);f+=C;const g=L.getValue(s,P,f,1);f+=C;const N=L.getValue(s,P,f,u);f+=C,F[E]={frame:B[E]*S,inTangent:U,value:g,outTangent:N}}break;case"LINEAR":for(let E=0;E<B.length;E++){const U=L.getValue(s,P,f,1);f+=C,F[E]={frame:B[E]*S,value:U}}}if(f>0){const E=`${g.name||`animation${g.index}`}_channel${N.index}_${U}`,u=L.buildAnimations(s,E,S,F);for(const g of u)U++,D(g.babylonAnimatable,g.babylonAnimation)}}}))}_loadAnimationSamplerAsync(E,U){if(U._data)return U._data;const g=U.interpolation||"LINEAR";switch(g){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${E}/interpolation: Invalid value (${U.interpolation})`)}const N=W.Get(`${E}/input`,this._gltf.accessors,U.input),L=W.Get(`${E}/output`,this._gltf.accessors,U.output);return U._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${N.index}`,N),this._loadFloatAccessorAsync(`/accessors/${L.index}`,L)]).then((E=>{let[U,N]=E;return{input:U,interpolation:g,output:N}})),U._data}loadBufferAsync(E,U,g,N){const L=this._extensionsLoadBufferAsync(E,U,g,N);if(L)return L;if(!U._data)if(U.uri)U._data=this.loadUriAsync(`${E}/uri`,U,U.uri);else{if(!this._bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);U._data=this._bin.readAsync(0,U.byteLength)}return U._data.then((U=>{try{return new Uint8Array(U.buffer,U.byteOffset+g,N)}catch(L){throw new Error(`${E}: ${L.message}`)}}))}loadBufferViewAsync(E,U){const g=this._extensionsLoadBufferViewAsync(E,U);if(g)return g;if(U._data)return U._data;const N=W.Get(`${E}/buffer`,this._gltf.buffers,U.buffer);return U._data=this.loadBufferAsync(`/buffers/${N.index}`,N,U.byteOffset||0,U.byteLength),U._data}_loadAccessorAsync(E,U,g){if(U._data)return U._data;const N=Q._GetNumComponents(E,U.type),L=N*Y.f.GetTypeByteLength(U.componentType),D=N*U.count;if(void 0==U.bufferView)U._data=Promise.resolve(new g(D));else{const S=W.Get(`${E}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((u=>{if(5126!==U.componentType||U.normalized||S.byteStride&&S.byteStride!==L){const E=new g(D);return Y.f.ForEach(u,U.byteOffset||0,S.byteStride||L,N,U.componentType,E.length,U.normalized||!1,((U,g)=>{E[g]=U})),E}return Q._GetTypedArray(E,U.componentType,u,U.byteOffset,D)}))}if(U.sparse){const D=U.sparse;U._data=U._data.then((S=>{const u=S,s=W.Get(`${E}/sparse/indices/bufferView`,this._gltf.bufferViews,D.indices.bufferView),C=W.Get(`${E}/sparse/values/bufferView`,this._gltf.bufferViews,D.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${s.index}`,s),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((S=>{let[s,C]=S;const B=Q._GetTypedArray(`${E}/sparse/indices`,D.indices.componentType,s,D.indices.byteOffset,D.count),P=N*D.count;let F;if(5126!==U.componentType||U.normalized){const S=Q._GetTypedArray(`${E}/sparse/values`,U.componentType,C,D.values.byteOffset,P);F=new g(P),Y.f.ForEach(S,0,L,N,U.componentType,F.length,U.normalized||!1,((E,U)=>{F[U]=E}))}else F=Q._GetTypedArray(`${E}/sparse/values`,U.componentType,C,D.values.byteOffset,P);let f=0;for(let E=0;E<B.length;E++){let U=B[E]*N;for(let E=0;E<N;E++)u[U++]=F[f++]}return u}))}))}return U._data}_loadFloatAccessorAsync(E,U){return this._loadAccessorAsync(E,U,Float32Array)}_loadIndicesAccessorAsync(E,U){if("SCALAR"!==U.type)throw new Error(`${E}/type: Invalid value ${U.type}`);if(5121!==U.componentType&&5123!==U.componentType&&5125!==U.componentType)throw new Error(`${E}/componentType: Invalid value ${U.componentType}`);if(U._data)return U._data;if(U.sparse){const g=Q._GetTypedArrayConstructor(`${E}/componentType`,U.componentType);U._data=this._loadAccessorAsync(E,U,g)}else{const g=W.Get(`${E}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((g=>Q._GetTypedArray(E,U.componentType,g,U.byteOffset,U.count)))}return U._data}_loadVertexBufferViewAsync(E){if(E._babylonBuffer)return E._babylonBuffer;const U=this._babylonScene.getEngine();return E._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((E=>new Y.d(U,E,!1))),E._babylonBuffer}_loadVertexAccessorAsync(E,U,g){var N;if(null!==(N=U._babylonVertexBuffer)&&void 0!==N&&N[g])return U._babylonVertexBuffer[g];U._babylonVertexBuffer||(U._babylonVertexBuffer={});const L=this._babylonScene.getEngine();if(U.sparse||void 0==U.bufferView)U._babylonVertexBuffer[g]=this._loadFloatAccessorAsync(E,U).then((E=>new Y.f(L,E,g,!1)));else{const N=W.Get(`${E}/bufferView`,this._gltf.bufferViews,U.bufferView);U._babylonVertexBuffer[g]=this._loadVertexBufferViewAsync(N).then((D=>{const S=Q._GetNumComponents(E,U.type);return new Y.f(L,D,g,!1,void 0,N.byteStride,void 0,U.byteOffset,S,U.componentType,U.normalized,!0,void 0,!0)}))}return U._babylonVertexBuffer[g]}_loadMaterialMetallicRoughnessPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return U&&(U.baseColorFactor?(g.albedoColor=D.VU.eU(U.baseColorFactor),g.alpha=U.baseColorFactor[3]):g.albedoColor=D.VU.White(),g.metallic=void 0==U.metallicFactor?1:U.metallicFactor,g.roughness=void 0==U.roughnessFactor?1:U.roughnessFactor,U.baseColorTexture&&N.push(this.loadTextureInfoAsync(`${E}/baseColorTexture`,U.baseColorTexture,(E=>{E.name=`${g.name} (Base Color)`,g.albedoTexture=E}))),U.metallicRoughnessTexture&&(U.metallicRoughnessTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${E}/metallicRoughnessTexture`,U.metallicRoughnessTexture,(E=>{E.name=`${g.name} (Metallic Roughness)`,g.metallicTexture=E}))),g.useMetallnessFromMetallicTextureBlue=!0,g.useRoughnessFromMetallicTextureGreen=!0,g.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(N).then((()=>{}))}_loadMaterialAsync(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const D=this._extensionsLoadMaterialAsync(E,U,g,N,L);if(D)return D;U._data=U._data||{};let S=U._data[N];if(!S){this.logOpen(`${E} ${U.name||""}`);const g=this.createMaterial(E,U,N);S={babylonMaterial:g,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(E,U,g)},U._data[N]=S,Q.AddPointerMetadata(g,E),this._parent.onMaterialLoadedObservable.notifyObservers(g),this.logClose()}return g&&(S.babylonMeshes.push(g),g.hg.addOnce((()=>{const E=S.babylonMeshes.indexOf(g);-1!==E&&S.babylonMeshes.splice(E,1)}))),L(S.babylonMaterial),S.promise.then((()=>S.babylonMaterial))}_createDefaultMaterial(E,U){this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new e.b(E,this._babylonScene);return g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.fillMode=U,g.enableSpecularAntiAliasing=!0,g.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,g.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,g.transparencyMode=e.b.PBRMATERIAL_OPAQUE,g.metallic=1,g.roughness=1,g}createMaterial(E,U,g){const N=this._extensionsCreateMaterial(E,U,g);if(N)return N;const L=U.name||`material${U.index}`;return this._createDefaultMaterial(L,g)}loadMaterialPropertiesAsync(E,U,g){const N=this._extensionsLoadMaterialPropertiesAsync(E,U,g);if(N)return N;const L=new Array;return L.push(this.loadMaterialBasePropertiesAsync(E,U,g)),U.pbrMetallicRoughness&&L.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${E}/pbrMetallicRoughness`,U.pbrMetallicRoughness,g)),this.loadMaterialAlphaProperties(E,U,g),Promise.all(L).then((()=>{}))}loadMaterialBasePropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return g.emissiveColor=U.emissiveFactor?D.VU.eU(U.emissiveFactor):new D.VU(0,0,0),U.doubleSided&&(g.fu=!1,g.twoSidedLighting=!0),U.normalTexture&&(U.normalTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${E}/normalTexture`,U.normalTexture,(E=>{E.name=`${g.name} (Normal)`,g.bumpTexture=E}))),g.invertNormalMapX=!this._babylonScene.useRightHandedSystem,g.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=U.normalTexture.scale&&g.bumpTexture&&(g.bumpTexture.level=U.normalTexture.scale),g.forceIrradianceInFragment=!0),U.occlusionTexture&&(U.occlusionTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${E}/occlusionTexture`,U.occlusionTexture,(E=>{E.name=`${g.name} (Occlusion)`,g.ambientTexture=E}))),g.useAmbientInGrayScale=!0,void 0!=U.occlusionTexture.strength&&(g.ambientTextureStrength=U.occlusionTexture.strength)),U.emissiveTexture&&N.push(this.loadTextureInfoAsync(`${E}/emissiveTexture`,U.emissiveTexture,(E=>{E.name=`${g.name} (Emissive)`,g.emissiveTexture=E}))),Promise.all(N).then((()=>{}))}loadMaterialAlphaProperties(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);switch(U.alphaMode||"OPAQUE"){case"OPAQUE":g.transparencyMode=e.b.PBRMATERIAL_OPAQUE,g.alpha=1;break;case"MASK":g.transparencyMode=e.b.PBRMATERIAL_ALPHATEST,g.alphaCutOff=void 0==U.alphaCutoff?.5:U.alphaCutoff,g.albedoTexture&&(g.albedoTexture.Qg=!0);break;case"BLEND":g.transparencyMode=e.b.PBRMATERIAL_ALPHABLEND,g.albedoTexture&&(g.albedoTexture.Qg=!0,g.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${E}/alphaMode: Invalid value (${U.alphaMode})`)}}loadTextureInfoAsync(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureInfoAsync(E,U,g);if(N)return N;if(this.logOpen(`${E}`),U.texCoord>=6)throw new Error(`${E}/texCoord: Invalid value (${U.texCoord})`);const L=W.Get(`${E}/index`,this._gltf.textures,U.index);L._textureInfo=U;const D=this._loadTextureAsync(`/textures/${U.index}`,L,(N=>{N.coordinatesIndex=U.texCoord||0,Q.AddPointerMetadata(N,E),this._parent.onTextureLoadedObservable.notifyObservers(N),g(N)}));return this.logClose(),D}_loadTextureAsync(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureAsync(E,U,g);if(N)return N;this.logOpen(`${E} ${U.name||""}`);const L=void 0==U.sampler?Q.DefaultSampler:W.Get(`${E}/sampler`,this._gltf.samplers,U.sampler),D=W.Get(`${E}/source`,this._gltf.images,U.source),S=this._createTextureAsync(E,L,D,g,void 0,!U._textureInfo.nonColorData);return this.logClose(),S}_createTextureAsync(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},D=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;const u=this._loadSampler(`/samplers/${U.index}`,U),s=new Array,C=new N;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B={noMipmap:u.noMipMaps,invertY:!1,samplingMode:u.samplingMode,H:()=>{this._disposed||C.resolve()},onError:(U,g)=>{this._disposed||C.reject(new Error(`${E}: ${g&&g.message?g.message:U||"Failed to load texture"}`))},mimeType:g.mimeType??(0,j.e)(g.uri??""),loaderOptions:D,useSRGBBuffer:!!S&&this._parent.useSRGBBuffers},P=new x.c(null,this._babylonScene,B);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.push(C.promise),s.push(this.loadImageAsync(`/images/${g.index}`,g).then((E=>{const U=g.uri||`${this._fileName}#image${g.index}`,N=`data:${this._uniqueRootUrl}${U}`;P.updateURL(N,E);const L=P.getInternalTexture();L&&(L.label=g.name)}))),P.wrapU=u.wrapU,P.wrapV=u.wrapV,L(P),this._parent.useGltfTextureNames&&(P.name=g.name||g.uri||`image${g.index}`),Promise.all(s).then((()=>P))}_loadSampler(E,U){return U._data||(U._data={noMipMaps:9728===U.minFilter||9729===U.minFilter,samplingMode:Q._GetTextureSamplingMode(E,U),wrapU:Q._GetTextureWrapMode(`${E}/wrapS`,U.wrapS),wrapV:Q._GetTextureWrapMode(`${E}/wrapT`,U.wrapT)}),U._data}loadImageAsync(E,U){if(!U._data){if(this.logOpen(`${E} ${U.name||""}`),U.uri)U._data=this.loadUriAsync(`${E}/uri`,U,U.uri);else{const g=W.Get(`${E}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g)}this.logClose()}return U._data}loadUriAsync(E,U,g){const N=this._extensionsLoadUriAsync(E,U,g);if(N)return N;if(!Q._ValidateUri(g))throw new Error(`${E}: '${g}' is invalid`);if((0,j.h)(g)){const U=new Uint8Array((0,j.b)(g));return this.log(`${E}: Decoded ${g.substring(0,64)}... (${U.length} bytes)`),Promise.resolve(U)}return this.log(`${E}: Loading ${g}`),this._parent.preprocessUrlAsync(this._rootUrl+g).then((U=>new Promise(((N,L)=>{this._parent._loadFile(this._babylonScene,U,(U=>{this._disposed||(this.log(`${E}: Loaded ${g} (${U.byteLength} bytes)`),N(new Uint8Array(U)))}),!0,(U=>{L(new j.j(`${E}: Failed to load '${g}'${U?": "+U.status+" "+U.statusText:""}`,U))}))}))))}static AddPointerMetadata(E,U){E.metadata=E.metadata||{};const g=E._internalMetadata=E._internalMetadata||{},N=g.Zg=g.Zg||{};(N.pointers=N.pointers||[]).push(U)}static _GetTextureWrapMode(E,U){switch(U=void 0==U?10497:U){case 33071:return x.c.CLAMP_ADDRESSMODE;case 33648:return x.c.MIRROR_ADDRESSMODE;case 10497:return x.c.WRAP_ADDRESSMODE;default:return I.d.Warn(`${E}: Invalid value (${U})`),x.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(E,U){const g=void 0==U.magFilter?9729:U.magFilter,N=void 0==U.minFilter?9987:U.minFilter;if(9729===g)switch(N){case 9728:return x.c.LINEAR_NEAREST;case 9729:return x.c.LINEAR_LINEAR;case 9984:return x.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return x.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return x.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return x.c.LINEAR_LINEAR_MIPLINEAR;default:return I.d.Warn(`${E}/minFilter: Invalid value (${N})`),x.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==g&&I.d.Warn(`${E}/magFilter: Invalid value (${g})`),N){case 9728:return x.c.NEAREST_NEAREST;case 9729:return x.c.NEAREST_LINEAR;case 9984:return x.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return x.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return x.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return x.c.NEAREST_LINEAR_MIPLINEAR;default:return I.d.Warn(`${E}/minFilter: Invalid value (${N})`),x.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(E,U){try{return(0,mE.n)(U)}catch(g){throw new Error(`${E}: ${g.message}`)}}static _GetTypedArray(E,U,g,N,L){const D=g.buffer;N=g.byteOffset+(N||0);const S=Q._GetTypedArrayConstructor(`${E}/componentType`,U),u=Y.f.GetTypeByteLength(U);return N%u!==0?(I.d.Warn(`${E}: Copying buffer as byte offset (${N}) is not a multiple of component type byte length (${u})`),new S(D.slice(N,N+L*u),0)):new S(D,N,L)}static _GetNumComponents(E,U){switch(U){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${E}: Invalid type (${U})`)}static _ValidateUri(E){return S.Tools.IsBase64(E)||-1===E.indexOf("..")}static _GetDrawMode(E,U){switch(void 0==U&&(U=4),U){case 0:return V.b.PointListDrawMode;case 1:return V.b.LineListDrawMode;case 2:return V.b.LineLoopDrawMode;case 3:return V.b.LineStripDrawMode;case 4:return V.b.TriangleFillMode;case 5:return V.b.TriangleStripDrawMode;case 6:return V.b.TriangleFanDrawMode}throw new Error(`${E}: Invalid mesh primitive mode (${U})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const E=new Array;if(this._gltf.materials)for(const U of this._gltf.materials)if(U._data)for(const g in U._data){const N=U._data[g];for(const U of N.babylonMeshes){U.pg(!0);const g=N.babylonMaterial;E.push(g.forceCompilationAsync(U)),E.push(g.forceCompilationAsync(U,{useInstances:!0})),this._parent.useClipPlane&&(E.push(g.forceCompilationAsync(U,{clipPlane:!0})),E.push(g.forceCompilationAsync(U,{clipPlane:!0,useInstances:!0})))}}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const E=new Array,U=this._babylonScene.lights;for(const g of U){const U=g.getShadowGenerator();U&&E.push(U.forceCompilationAsync())}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(E){for(const U of this._extensions)U.enabled&&E(U)}_applyExtensions(E,U,g){for(const N of this._extensions)if(N.enabled){const L=`${N.name}.${U}`,D=E;D._activeLoaderExtensionFunctions=D._activeLoaderExtensionFunctions||{};const S=D._activeLoaderExtensionFunctions;if(!S[L]){S[L]=!0;try{const E=g(N);if(E)return E}finally{delete S[L]}}}return null}_extensionsOnLoading(){this._forEachExtensions((E=>E.onLoading&&E.onLoading()))}_extensionsOnReady(){this._forEachExtensions((E=>E.onReady&&E.onReady()))}_extensionsLoadSceneAsync(E,U){return this._applyExtensions(U,"loadScene",(g=>g.loadSceneAsync&&g.loadSceneAsync(E,U)))}_extensionsLoadNodeAsync(E,U,g){return this._applyExtensions(U,"loadNode",(N=>N.loadNodeAsync&&N.loadNodeAsync(E,U,g)))}_extensionsLoadCameraAsync(E,U,g){return this._applyExtensions(U,"loadCamera",(N=>N.loadCameraAsync&&N.loadCameraAsync(E,U,g)))}_extensionsLoadVertexDataAsync(E,U,g){return this._applyExtensions(U,"loadVertexData",(N=>N._loadVertexDataAsync&&N._loadVertexDataAsync(E,U,g)))}_extensionsLoadMeshPrimitiveAsync(E,U,g,N,L,D){return this._applyExtensions(L,"loadMeshPrimitive",(S=>S._loadMeshPrimitiveAsync&&S._loadMeshPrimitiveAsync(E,U,g,N,L,D)))}_extensionsLoadMaterialAsync(E,U,g,N,L){return this._applyExtensions(U,"loadMaterial",(D=>D._loadMaterialAsync&&D._loadMaterialAsync(E,U,g,N,L)))}_extensionsCreateMaterial(E,U,g){return this._applyExtensions(U,"createMaterial",(N=>N.createMaterial&&N.createMaterial(E,U,g)))}_extensionsLoadMaterialPropertiesAsync(E,U,g){return this._applyExtensions(U,"loadMaterialProperties",(N=>N.loadMaterialPropertiesAsync&&N.loadMaterialPropertiesAsync(E,U,g)))}_extensionsLoadTextureInfoAsync(E,U,g){return this._applyExtensions(U,"loadTextureInfo",(N=>N.loadTextureInfoAsync&&N.loadTextureInfoAsync(E,U,g)))}_extensionsLoadTextureAsync(E,U,g){return this._applyExtensions(U,"loadTexture",(N=>N._loadTextureAsync&&N._loadTextureAsync(E,U,g)))}_extensionsLoadAnimationAsync(E,U){return this._applyExtensions(U,"loadAnimation",(g=>g.loadAnimationAsync&&g.loadAnimationAsync(E,U)))}_extensionsLoadAnimationChannelAsync(E,U,g,N,L){return this._applyExtensions(g,"loadAnimationChannel",(D=>D._loadAnimationChannelAsync&&D._loadAnimationChannelAsync(E,U,g,N,L)))}_extensionsLoadSkinAsync(E,U,g){return this._applyExtensions(g,"loadSkin",(N=>N._loadSkinAsync&&N._loadSkinAsync(E,U,g)))}_extensionsLoadUriAsync(E,U,g){return this._applyExtensions(U,"loadUri",(N=>N._loadUriAsync&&N._loadUriAsync(E,U,g)))}_extensionsLoadBufferViewAsync(E,U){return this._applyExtensions(U,"loadBufferView",(g=>g.loadBufferViewAsync&&g.loadBufferViewAsync(E,U)))}_extensionsLoadBufferAsync(E,U,g,N){return this._applyExtensions(U,"loadBuffer",(L=>L.loadBufferAsync&&L.loadBufferAsync(E,U,g,N)))}static LoadExtensionAsync(E,U,g,N){if(!U.extensions)return null;const L=U.extensions[g];return L?N(`${E}/extensions/${g}`,L):null}static LoadExtraAsync(E,U,g,N){if(!U.extras)return null;const L=U.extras[g];return L?N(`${E}/extras/${g}`,L):null}isExtensionUsed(E){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(E)}logOpen(E){this._parent._logOpen(E)}logClose(){this._parent._logClose()}log(E){this._parent._log(E)}startPerformanceCounter(E){this._parent._startPerformanceCounter(E)}endPerformanceCounter(E){this._parent._endPerformanceCounter(E)}}Q.DefaultSampler={index:-1},r.d._CreateGLTF2Loader=E=>new Q(E);var R=g(14005),n=g(12527),k=g(12367),z=g(14008),i=g(14016);class p extends i.e{constructor(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",E),this._texture=E.getEngine().createRawCubeTexture(U,g,N,L,D,S,u,s)}update(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,E,U,g,N,L)}updateRGBDAsync(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,z.l)(this._texture,E,U,g,N).then((()=>{}))}clone(){return k.b.Clone((()=>{const E=this.tE(),U=this._texture,g=new p(E,U._bufferViewArray,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression);return 13===U.source&&g.updateRGBDAsync(U._bufferViewArrayArray,U._sphericalPolynomial,U._lodGenerationScale,U._lodGenerationOffset),g}),this)}}const H="EXT_lights_image_based";class K{constructor(E){this.name=H,this._loader=E,this.enabled=this._loader.isExtensionUsed(H)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.Zg.extensions;if(E&&E[this.name]){const U=E[this.name];this._lights=U.lights}}loadSceneAsync(E,U){return Q.LoadExtensionAsync(E,U,this.name,(async(g,N)=>{this._loader._allMaterialsDirtyRequired=!0;const L=new Array;L.push(this._loader.loadSceneAsync(E,U)),this._loader.logOpen(`${g}`);const D=W.Get(`${g}/light`,this._lights,N.Cg);return L.push(this._loadLightAsync(`/extensions/${this.name}/lights/${N.Cg}`,D).then((E=>{this._loader.babylonScene.environmentTexture=E}))),this._loader.logClose(),await Promise.all(L).then((()=>{}))}))}_loadLightAsync(E,U){if(!U._loaded){const g=new Array;this._loader.logOpen(`${E}`);const N=new Array(U.specularImages.length);for(let L=0;L<U.specularImages.length;L++){const D=U.specularImages[L];N[L]=new Array(D.length);for(let U=0;U<D.length;U++){const S=`${E}/specularImages/${L}/${U}`;this._loader.logOpen(`${S}`);const u=D[U],s=W.Get(S,this._loader.Zg.images,u);g.push(this._loader.loadImageAsync(`/images/${u}`,s).then((E=>{N[L][U]=E}))),this._loader.logClose()}}this._loader.logClose(),U._loaded=Promise.all(g).then((async()=>{const g=new p(this._loader.babylonScene,null,U.specularImageSize);if(g.name=U.name||"environment",U._babylonTexture=g,void 0!=U.xu&&(g.level=U.xu),U.rotation){let E=L.Quaternion.eU(U.rotation);this._loader.babylonScene.useRightHandedSystem||(E=L.Quaternion.Inverse(E)),L.Matrix.FromQuaternionToRef(E,g.getReflectionTextureMatrix())}if(!U.irradianceCoefficients)throw new Error(`${E}: Irradiance coefficients are missing`);const D=n.c.eU(U.irradianceCoefficients);D.scaleInPlace(U.xu),D.convertIrradianceToLambertianRadiance();const S=n.f.FromHarmonics(D),u=(N.length-1)/Math.log2(U.specularImageSize);return await g.updateRGBDAsync(N,S,u)}))}return U._loaded.then((()=>U._babylonTexture))}}J(H),a(H,!0,(E=>new K(E)));g(12885);const X="EXT_mesh_gpu_instancing";class EE{constructor(E){this.name=X,this._loader=E,this.enabled=this._loader.isExtensionUsed(X)}dispose(){this._loader=null}loadNodeAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(E,N)=>{this._loader._disableInstancedMesh++;const D=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,g);if(this._loader._disableInstancedMesh--,!U._primitiveBabylonMeshes)return await D;const S=new Array;let u=0;const s=U=>{if(void 0==N.attributes[U])return void S.push(Promise.resolve(null));const g=W.Get(`${E}/attributes/${U}`,this._loader.Zg.accessors,N.attributes[U]);if(S.push(this._loader._loadFloatAccessorAsync(`/accessors/${g.bufferView}`,g)),0===u)u=g.count;else if(u!==g.count)throw new Error(`${E}/attributes: Instance buffer accessors do not have the same count.`)};return s("TRANSLATION"),s("ROTATION"),s("SCALE"),await D.then((async E=>{const[g,N,D]=await Promise.all(S),s=new Float32Array(16*u);L.TmpVectors.dU[0].du(0,0,0),L.TmpVectors.Quaternion[0].du(0,0,0,1),L.TmpVectors.dU[1].du(1,1,1);for(let U=0;U<u;++U)g&&L.dU.FromArrayToRef(g,3*U,L.TmpVectors.dU[0]),N&&L.Quaternion.FromArrayToRef(N,4*U,L.TmpVectors.Quaternion[0]),D&&L.dU.FromArrayToRef(D,3*U,L.TmpVectors.dU[1]),L.Matrix.ComposeToRef(L.TmpVectors.dU[1],L.TmpVectors.Quaternion[0],L.TmpVectors.dU[0],L.TmpVectors.Matrix[0]),L.TmpVectors.Matrix[0].copyToArray(s,16*U);for(const L of U._primitiveBabylonMeshes)L.PP("matrix",s,16,!0);return E}))}))}}J(X),a(X,!0,(E=>new EE(E)));let UE=0,gE=null;class NE{static get Default(){return NE._Default||(NE._Default=new NE),NE._Default}constructor(){const E=NE.Configuration.decoder;this._decoderModulePromise=S.Tools.LoadBabylonScriptAsync(E.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(E,U,g,N,L){await this._decoderModulePromise,0===UE&&(MeshoptDecoder.useWorkers(1),UE=1);const D=await MeshoptDecoder.decodeGltfBufferAsync(U,g,E,N,L);return null!==gE&&clearTimeout(gE),gE=setTimeout((()=>{MeshoptDecoder.useWorkers(0),UE=0,gE=null}),1e3),D}}NE.Configuration={decoder:{url:`${S.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},NE._Default=null;const LE="EXT_meshopt_compression";class DE{constructor(E){this.name=LE,this.enabled=E.isExtensionUsed(LE),this._loader=E}dispose(){this._loader=null}loadBufferViewAsync(E,U){return Q.LoadExtensionAsync(E,U,this.name,(async(g,N)=>{const L=U;if(L._meshOptData)return await L._meshOptData;const D=W.Get(`${E}/buffer`,this._loader.Zg.buffers,N.buffer);return L._meshOptData=this._loader.loadBufferAsync(`/buffers/${D.index}`,D,N.byteOffset||0,N.byteLength).then((async E=>await NE.Default.decodeGltfBufferAsync(E,N.count,N.byteStride,N.mode,N.filter))),await L._meshOptData}))}}J(LE),a(LE,!0,(E=>new DE(E)));const SE="EXT_texture_webp";class uE{constructor(E){this.name=SE,this._loader=E,this.enabled=E.isExtensionUsed(SE)}dispose(){this._loader=null}_loadTextureAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=void 0==U.sampler?Q.DefaultSampler:W.Get(`${E}/sampler`,this._loader.Zg.samplers,U.sampler),S=W.Get(`${N}/source`,this._loader.Zg.images,L.source);return await this._loader._createTextureAsync(E,D,S,(E=>{g(E)}),void 0,!U._textureInfo.nonColorData)}))}}J(SE),a(SE,!0,(E=>new uE(E)));const sE="EXT_texture_avif";class CE{constructor(E){this.name=sE,this._loader=E,this.enabled=E.isExtensionUsed(sE)}dispose(){this._loader=null}_loadTextureAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=void 0==U.sampler?Q.DefaultSampler:W.Get(`${E}/sampler`,this._loader.Zg.samplers,U.sampler),S=W.Get(`${N}/source`,this._loader.Zg.images,L.source);return await this._loader._createTextureAsync(E,D,S,(E=>{g(E)}),void 0,!U._textureInfo.nonColorData)}))}}J(sE),a(sE,!0,(E=>new CE(E)));var BE=g(13996),PE=g(12874);const FE="EXT_lights_ies";class fE{constructor(E){this.name=FE,this._loader=E,this.enabled=this._loader.isExtensionUsed(FE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.Zg.extensions;if(E&&E[this.name]){const U=E[this.name];this._lights=U.lights,W.Assign(this._lights)}}loadNodeAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,S)=>{let u,s;this._loader._allMaterialsDirtyRequired=!0;const C=await this._loader.loadNodeAsync(E,U,(E=>{s=W.Get(N,this._lights,S.Cg);const U=s.name||E.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u=new BE.c(U,L.dU.Zero(),L.dU.Backward(),0,1,this._loader.babylonScene),u.angle=Math.PI/2,u.innerAngle=0,u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=u,u.falloffType=PE.c.FALLOFF_GLTF,u.lu=S.color?D.VU.eU(S.color):D.VU.White(),u.xu=S.multiplier||1,u.range=Number.MAX_VALUE,u.parent=E,this._loader._babylonLights.push(u),Q.AddPointerMetadata(u,N),g(E)}));let B;if(s.uri)B=await this._loader.loadUriAsync(E,s,s.uri);else{const U=W.Get(`${E}/bufferView`,this._loader.Zg.bufferViews,s.bufferView);B=await this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return u.iesProfileTexture=new x.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,B,!0,void 0,void 0,void 0,void 0,".ies"),C}))}}J(FE),a(FE,!0,(E=>new fE(E)));var dE=g(14027);const IE="KHR_draco_mesh_compression";class yE{constructor(E){this.name=IE,this.useNormalizedFlagFromAccessor=!0,this._loader=E,this.enabled=dE.d.DefaultAvailable&&this._loader.isExtensionUsed(IE)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{if(void 0!=U.mode&&4!==U.mode&&5!==U.mode)throw new Error(`${E}: Unsupported mode ${U.mode}`);const D={},S={},u=(E,N)=>{const u=L.attributes[E];if(void 0!=u&&(g._delayInfo=g._delayInfo||[],-1===g._delayInfo.indexOf(N)&&g._delayInfo.push(N),D[N]=u,this.useNormalizedFlagFromAccessor)){const g=W.TryGet(this._loader.Zg.accessors,U.attributes[E]);g&&(S[N]=g.normalized||!1)}};u("POSITION",Y.f.PositionKind),u("NORMAL",Y.f.NormalKind),u("TANGENT",Y.f.TangentKind),u("TEXCOORD_0",Y.f.UVKind),u("TEXCOORD_1",Y.f.UV2Kind),u("TEXCOORD_2",Y.f.UV3Kind),u("TEXCOORD_3",Y.f.UV4Kind),u("TEXCOORD_4",Y.f.UV5Kind),u("TEXCOORD_5",Y.f.UV6Kind),u("JOINTS_0",Y.f.MatricesIndicesKind),u("WEIGHTS_0",Y.f.MatricesWeightsKind),u("COLOR_0",Y.f.ColorKind);const s=W.Get(N,this._loader.Zg.bufferViews,L.bufferView);return s._dracoBabylonGeometry||(s._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((async N=>{const L=this.dracoDecoder||dE.d.Default,u=W.TryGet(this._loader.Zg.accessors,U.attributes.POSITION),s=this._loader.parent.alwaysComputeBoundingBox||g.skeleton||!u?null:O(u);return await L._decodeMeshToGeometryForGltfAsync(g.name,this._loader.babylonScene,N,D,S,s).catch((U=>{throw new Error(`${E}: ${U.message}`)}))}))),await s._dracoBabylonGeometry}))}}J(IE),a(IE,!0,(E=>new yE(E)));var hE=g(14033),VE=g(12320),eE=g(12322),xE=g(12752),lE=g(12917),YE=g(12292);xE.c.AddNodeConstructor("Light_Type_0",((E,U)=>()=>new tE(E,L.dU.Zero(),U)));class tE extends lE.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(E){this._shadowAngle=E,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(E){const U=this.needCube();if(this._direction=E,this.needCube()!==U&&this._shadowGenerators){const E=this._shadowGenerators.values();for(let U=E.next();!0!==U.done;U=E.next()){U.value.recreateShadowMap()}}}constructor(E,U,g){super(E,g),this._shadowAngle=Math.PI/2,this.position=U}getClassName(){return"PointLight"}getTypeID(){return PE.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(E){if(this.direction)return super.getShadowDirection(E);switch(E){case 0:return new L.dU(1,0,0);case 1:return new L.dU(-1,0,0);case 2:return new L.dU(0,-1,0);case 3:return new L.dU(0,1,0);case 4:return new L.dU(0,0,1);case 5:return new L.dU(0,0,-1)}return L.dU.Zero()}_setDefaultShadowProjectionMatrix(E,U,g){const N=this.tE().activeCamera;if(!N)return;const D=void 0!==this.shadowMinZ?this.shadowMinZ:N.kg,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,u=this.tE().getEngine().Fg;L.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,u?S:D,u?D:S,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,u)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,U){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,U):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,U),this}transferToNodeMaterialEffect(E,U){return this.computeTransformedInformation()?E.setFloat3(U,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):E.setFloat3(U,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(E,U){E["POINTLIGHT"+U]=!0}}(0,VE.e)([(0,eE.E)()],tE.prototype,"shadowAngle",null),(0,YE.f)("BABYLON.PointLight",tE);const GE="KHR_lights_punctual";class bE{constructor(E){this.name=GE,this._loader=E,this.enabled=this._loader.isExtensionUsed(GE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.Zg.extensions;if(E&&E[this.name]){const U=E[this.name];this._lights=U.lights,W.Assign(this._lights)}}loadNodeAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,S)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(E,U,(E=>{let U;const u=W.Get(N,this._lights,S.Cg),s=u.name||E.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u.type){case"directional":{const E=new hE.d(s,L.dU.Backward(),this._loader.babylonScene);E.position.yu(0),U=E;break}case"point":U=new tE(s,L.dU.Zero(),this._loader.babylonScene);break;case"spot":{const E=new BE.c(s,L.dU.Zero(),L.dU.Backward(),0,1,this._loader.babylonScene);E.angle=2*(u.spot&&u.spot.outerConeAngle||Math.PI/4),E.innerAngle=2*(u.spot&&u.spot.innerConeAngle||0),U=E;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${N}: Invalid light type (${u.type})`)}U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=U,U.falloffType=PE.c.FALLOFF_GLTF,U.lu=u.color?D.VU.eU(u.color):D.VU.White(),U.xu=void 0==u.xu?1:u.xu,U.range=void 0==u.range?Number.MAX_VALUE:u.range,U.parent=E,this._loader._babylonLights.push(U),Q.AddPointerMetadata(U,N),g(E)})))))}}J(GE),a(GE,!0,(E=>new bE(E)));const TE="KHR_materials_pbrSpecularGlossiness";class vE{constructor(E){this.name=TE,this.order=200,this._loader=E,this.enabled=this._loader.isExtensionUsed(TE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialBasePropertiesAsync(E,U,g)),D.push(this._loadSpecularGlossinessPropertiesAsync(N,L,g)),this._loader.loadMaterialAlphaProperties(E,U,g),await Promise.all(D).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return g.metallic=null,g.roughness=null,U.diffuseFactor?(g.albedoColor=D.VU.eU(U.diffuseFactor),g.alpha=U.diffuseFactor[3]):g.albedoColor=D.VU.White(),g.reflectivityColor=U.specularFactor?D.VU.eU(U.specularFactor):D.VU.White(),g.microSurface=void 0==U.glossinessFactor?1:U.glossinessFactor,U.diffuseTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTexture`,U.diffuseTexture,(E=>{E.name=`${g.name} (Diffuse)`,g.albedoTexture=E}))),U.specularGlossinessTexture&&(N.push(this._loader.loadTextureInfoAsync(`${E}/specularGlossinessTexture`,U.specularGlossinessTexture,(E=>{E.name=`${g.name} (Specular Glossiness)`,g.reflectivityTexture=E,g.reflectivityTexture.Qg=!0}))),g.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(N).then((()=>{}))}}J(TE),a(TE,!0,(E=>new vE(E)));const oE="KHR_materials_unlit";class cE{constructor(E){this.name=oE,this.order=210,this._loader=E,this.enabled=this._loader.isExtensionUsed(oE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async()=>await this._loadUnlitPropertiesAsync(E,U,g)))}_loadUnlitPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;g.unlit=!0;const L=U.pbrMetallicRoughness;return L&&(L.baseColorFactor?(g.albedoColor=D.VU.eU(L.baseColorFactor),g.alpha=L.baseColorFactor[3]):g.albedoColor=D.VU.White(),L.baseColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/baseColorTexture`,L.baseColorTexture,(E=>{E.name=`${g.name} (Base Color)`,g.albedoTexture=E})))),U.doubleSided&&(g.fu=!1,g.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(E,U,g),Promise.all(N).then((()=>{}))}}J(oE),a(oE,!0,(E=>new cE(E)));const rE="KHR_materials_clearcoat";class jE{constructor(E){this.name=rE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(rE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadClearCoatPropertiesAsync(N,L,g)),await Promise.all(D)}))}_loadClearCoatPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return g.clearCoat.isEnabled=!0,g.clearCoat.useRoughnessFromMainTexture=!1,g.clearCoat.remapF0OnInterfaceChange=!1,void 0!=U.clearcoatFactor?g.clearCoat.xu=U.clearcoatFactor:g.clearCoat.xu=0,U.clearcoatTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatTexture`,U.clearcoatTexture,(E=>{E.name=`${g.name} (ClearCoat)`,g.clearCoat.texture=E}))),void 0!=U.clearcoatRoughnessFactor?g.clearCoat.roughness=U.clearcoatRoughnessFactor:g.clearCoat.roughness=0,U.clearcoatRoughnessTexture&&(U.clearcoatRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatRoughnessTexture`,U.clearcoatRoughnessTexture,(E=>{E.name=`${g.name} (ClearCoat Roughness)`,g.clearCoat.textureRoughness=E})))),U.clearcoatNormalTexture&&(U.clearcoatNormalTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatNormalTexture`,U.clearcoatNormalTexture,(E=>{E.name=`${g.name} (ClearCoat Normal)`,g.clearCoat.bumpTexture=E}))),g.invertNormalMapX=!g.tE().useRightHandedSystem,g.invertNormalMapY=g.tE().useRightHandedSystem,void 0!=U.clearcoatNormalTexture.scale&&(g.clearCoat.bumpTexture.level=U.clearcoatNormalTexture.scale)),Promise.all(N).then((()=>{}))}}J(rE),a(rE,!0,(E=>new jE(E)));const ZE="KHR_materials_iridescence";class AE{constructor(E){this.name=ZE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(ZE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadIridescencePropertiesAsync(N,L,g)),await Promise.all(D).then((()=>{}))}))}_loadIridescencePropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return g.iridescence.isEnabled=!0,g.iridescence.xu=U.iridescenceFactor??0,g.iridescence.indexOfRefraction=U.iridescenceIor??U.iridescenceIOR??1.3,g.iridescence.minimumThickness=U.iridescenceThicknessMinimum??100,g.iridescence.maximumThickness=U.iridescenceThicknessMaximum??400,U.iridescenceTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceTexture`,U.iridescenceTexture,(E=>{E.name=`${g.name} (Iridescence)`,g.iridescence.texture=E}))),U.iridescenceThicknessTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceThicknessTexture`,U.iridescenceThicknessTexture,(E=>{E.name=`${g.name} (Iridescence Thickness)`,g.iridescence.thicknessTexture=E}))),Promise.all(N).then((()=>{}))}}J(ZE),a(ZE,!0,(E=>new AE(E)));const wE="KHR_materials_anisotropy";class aE{constructor(E){this.name=wE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(wE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadIridescencePropertiesAsync(N,L,g)),await Promise.all(D)}))}async _loadIridescencePropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;g.anisotropy.isEnabled=!0,g.anisotropy.xu=U.anisotropyStrength??0,g.anisotropy.angle=U.anisotropyRotation??0,U.anisotropyTexture&&(U.anisotropyTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${E}/anisotropyTexture`,U.anisotropyTexture,(E=>{E.name=`${g.name} (Anisotropy Intensity)`,g.anisotropy.texture=E})))),await Promise.all(N)}}J(wE),a(wE,!0,(E=>new aE(E)));const JE="KHR_materials_emissive_strength";class qE{constructor(E){this.name=JE,this.order=170,this._loader=E,this.enabled=this._loader.isExtensionUsed(JE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>await this._loader.loadMaterialPropertiesAsync(E,U,g).then((()=>{this._loadEmissiveProperties(N,L,g)}))))}_loadEmissiveProperties(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);void 0!==U.emissiveStrength&&(g.emissiveIntensity=U.emissiveStrength)}}J(JE),a(JE,!0,(E=>new qE(E)));const ME="KHR_materials_sheen";class mU{constructor(E){this.name=ME,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(ME)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadSheenPropertiesAsync(N,L,g)),await Promise.all(D).then((()=>{}))}))}_loadSheenPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return g.sheen.isEnabled=!0,g.sheen.xu=1,void 0!=U.sheenColorFactor?g.sheen.color=D.VU.eU(U.sheenColorFactor):g.sheen.color=D.VU.Black(),U.sheenColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/sheenColorTexture`,U.sheenColorTexture,(E=>{E.name=`${g.name} (Sheen Color)`,g.sheen.texture=E}))),void 0!==U.sheenRoughnessFactor?g.sheen.roughness=U.sheenRoughnessFactor:g.sheen.roughness=0,U.sheenRoughnessTexture&&(U.sheenRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${E}/sheenRoughnessTexture`,U.sheenRoughnessTexture,(E=>{E.name=`${g.name} (Sheen Roughness)`,g.sheen.textureRoughness=E})))),g.sheen.albedoScaling=!0,g.sheen.useRoughnessFromMainTexture=!1,Promise.all(N).then((()=>{}))}}J(ME),a(ME,!0,(E=>new mU(E)));var WE=g(12815);const OE="KHR_materials_specular";class QE{constructor(E){this.name=OE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(OE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;if(D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadSpecularPropertiesAsync(N,L,g)),L.extensions&&L.extensions.EXT_materials_specular_edge_color&&g instanceof e.b){L.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(g.brdf.dielectricSpecularModel=WE.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,g.brdf.conductorSpecularModel=WE.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(D).then((()=>{}))}))}_loadSpecularPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return void 0!==U.specularFactor&&(g.metallicF0Factor=U.specularFactor),void 0!==U.specularColorFactor&&(g.metallicReflectanceColor=D.VU.eU(U.specularColorFactor)),U.specularTexture&&(U.specularTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${E}/specularTexture`,U.specularTexture,(E=>{E.name=`${g.name} (Specular)`,g.metallicReflectanceTexture=E,g.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),U.specularColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/specularColorTexture`,U.specularColorTexture,(E=>{E.name=`${g.name} (Specular Color)`,g.reflectanceTexture=E}))),Promise.all(N).then((()=>{}))}}J(OE),a(OE,!0,(E=>new QE(E)));const RE="KHR_materials_ior";class nE{constructor(E){this.name=RE,this.order=180,this._loader=E,this.enabled=this._loader.isExtensionUsed(RE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadIorPropertiesAsync(N,L,g)),await Promise.all(D).then((()=>{}))}))}_loadIorPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);return void 0!==U.ior?g.indexOfRefraction=U.ior:g.indexOfRefraction=nE._DEFAULT_IOR,Promise.resolve()}}nE._DEFAULT_IOR=1.5,J(RE),a(RE,!0,(E=>new nE(E)));const kE="KHR_materials_variants";class zE{constructor(E){this.name=kE,this._loader=E,this.enabled=this._loader.isExtensionUsed(kE)}dispose(){this._loader=null}static GetAvailableVariants(E){const U=this._GetExtensionMetadata(E);return U?Object.keys(U.variants):[]}getAvailableVariants(E){return zE.GetAvailableVariants(E)}static SelectVariant(E,U){const g=this._GetExtensionMetadata(E);if(!g)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${kE} extension`);const N=E=>{const U=g.variants[E];if(U)for(const g of U)g.mesh.material=g.material};if(U instanceof Array)for(const L of U)N(L);else N(U);g.lastSelected=U}selectVariant(E,U){zE.SelectVariant(E,U)}static Reset(E){const U=this._GetExtensionMetadata(E);if(!U)throw new Error(`Cannot reset on a glTF mesh that does not have the ${kE} extension`);for(const g of U.original)g.mesh.material=g.material;U.lastSelected=null}reset(E){zE.Reset(E)}static GetLastSelectedVariant(E){const U=this._GetExtensionMetadata(E);if(!U)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${kE} extension`);return U.lastSelected}getLastSelectedVariant(E){return zE.GetLastSelectedVariant(E)}static _GetExtensionMetadata(E){var U,g;return(null===E||void 0===E||null===(U=E._internalMetadata)||void 0===U||null===(g=U.Zg)||void 0===g?void 0:g[kE])||null}onLoading(){const E=this._loader.Zg.extensions;if(E&&E[this.name]){const U=E[this.name];this._variants=U.variants}}onReady(){const E=this._loader.rootBabylonMesh;if(E){var U;const g=this._loader.parent.extensionOptions[kE];null!==g&&void 0!==g&&g.defaultVariant&&zE.SelectVariant(E,g.defaultVariant),null===g||void 0===g||null===(U=g.onLoaded)||void 0===U||U.call(g,{get variants(){return zE.GetAvailableVariants(E)},get selectedVariant(){const U=zE.GetLastSelectedVariant(E);return U?Array.isArray(U)?U[0]:U:zE.GetAvailableVariants(E)[0]},set selectedVariant(U){zE.SelectVariant(E,U)}})}}_loadMeshPrimitiveAsync(E,U,g,N,L,D){return Q.LoadExtensionAsync(E,L,this.name,(async(S,u)=>{const s=new Array;return s.push(this._loader._loadMeshPrimitiveAsync(E,U,g,N,L,(U=>{if(D(U),U instanceof b.e){const g=Q._GetDrawMode(E,L.mode),N=this._loader.rootBabylonMesh,D=N?N._internalMetadata=N._internalMetadata||{}:{},C=D.Zg=D.Zg||{},B=C[kE]=C[kE]||{lastSelected:null,original:[],variants:{}};B.original.push({mesh:U,material:U.material});for(let E=0;E<u.mappings.length;++E){const L=u.mappings[E],D=W.Get(`${S}/mappings/${E}/material`,this._loader.Zg.materials,L.material);s.push(this._loader._loadMaterialAsync(`#/materials/${L.material}`,D,U,g,(E=>{for(let g=0;g<L.variants.length;++g){const D=L.variants[g],S=W.Get(`/extensions/${kE}/variants/${D}`,this._variants,D);B.variants[S.name]=B.variants[S.name]||[],B.variants[S.name].push({mesh:U,material:E}),U.onClonedObservable.add((E=>{const g=E;let L=null,D=g;do{if(D=D.parent,!D)return;L=zE._GetExtensionMetadata(D)}while(null===L);if(N&&L===zE._GetExtensionMetadata(N)){D._internalMetadata={};for(const E in N._internalMetadata)D._internalMetadata[E]=N._internalMetadata[E];D._internalMetadata.Zg=[];for(const E in N._internalMetadata.Zg)D._internalMetadata.Zg[E]=N._internalMetadata.Zg[E];D._internalMetadata.Zg[kE]={lastSelected:null,original:[],variants:{}};for(const E of L.original)D._internalMetadata.Zg[kE].original.push({mesh:E.mesh,material:E.material});for(const E in L.variants)if(Object.prototype.hasOwnProperty.call(L.variants,E)){D._internalMetadata.Zg[kE].variants[E]=[];for(const U of L.variants[E])D._internalMetadata.Zg[kE].variants[E].push({mesh:U.mesh,material:U.material})}L=D._internalMetadata.Zg[kE]}for(const N of L.original)N.mesh===U&&(N.mesh=g);for(const N of L.variants[S.name])N.mesh===U&&(N.mesh=g)}))}})))}}}))),await Promise.all(s).then((E=>{let[U]=E;return U}))}))}}J(kE),a(kE,!0,(E=>new zE(E)));var iE=g(12396);class pE{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:WE.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(E,U){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...pE._GetDefaultOptions(),...E},this._scene=U,this._scene._transmissionHelper=this,this.onErrorObservable=new B.b,this._scene.hg.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(E){if(!Object.keys(E).filter((U=>this._options[U]!==E[U])).length)return;const U={...this._options,...E},g=this._options;this._options=U,U.renderSize===g.renderSize&&U.renderTargetTextureType===g.renderTargetTextureType&&U.generateMipmaps===g.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=U.samples,this._opaqueRenderTarget.lodGenerationScale=U.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=U.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(E){return!!E&&!!(E instanceof e.b&&E.subSurface.isRefractionEnabled)}_addMesh(E){this._materialObservers[E.uniqueId]=E.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),S.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(E.material)?(E.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(E)&&this._transparentMeshesCache.push(E)):-1===this._opaqueMeshesCache.indexOf(E)&&this._opaqueMeshesCache.push(E)}))}_removeMesh(E){E.onMaterialChangedObservable.remove(this._materialObservers[E.uniqueId]),delete this._materialObservers[E.uniqueId];let U=this._transparentMeshesCache.indexOf(E);-1!==U&&this._transparentMeshesCache.splice(U,1),U=this._opaqueMeshesCache.indexOf(E),-1!==U&&this._opaqueMeshesCache.splice(U,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(E){const U=this._transparentMeshesCache.indexOf(E),g=this._opaqueMeshesCache.indexOf(E);this._shouldRenderAsTransmission(E.material)?(E.material instanceof e.b&&(E.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==g?(this._opaqueMeshesCache.splice(g,1),this._transparentMeshesCache.push(E)):-1===U&&this._transparentMeshesCache.push(E)):-1!==U?(this._transparentMeshesCache.splice(U,1),this._opaqueMeshesCache.push(E)):-1===g&&this._opaqueMeshesCache.push(E)}_isRenderTargetValid(){var E;return null!==(null===(E=this._opaqueRenderTarget)||void 0===E?void 0:E.getInternalTexture())}_setupRenderTargets(){var E;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new iE.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(E=this._options.clearColor)||void 0===E?void 0:E.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((E=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?E.clearColor.D(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(E.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const g of this._transparentMeshesCache)this._shouldRenderAsTransmission(g.material)&&(g.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const HE="KHR_materials_transmission";class KE{constructor(E){this.name=HE,this.order=175,this._loader=E,this.enabled=this._loader.isExtensionUsed(HE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadTransparentPropertiesAsync(N,U,g,L)),await Promise.all(D).then((()=>{}))}))}_loadTransparentPropertiesAsync(E,U,g,N){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const L=g;if(L.subSurface.isRefractionEnabled=!0,L.subSurface.volumeIndexOfRefraction=1,L.subSurface.useAlbedoToTintRefraction=!0,void 0===N.transmissionFactor)return L.subSurface.refractionIntensity=0,L.subSurface.isRefractionEnabled=!1,Promise.resolve();{var D;L.subSurface.refractionIntensity=N.transmissionFactor;const E=L.tE();if(L.subSurface.refractionIntensity&&!E._transmissionHelper)new pE({},L.tE());else if(L.subSurface.refractionIntensity&&(null===(D=E._transmissionHelper)||void 0===D||!D._isRenderTargetValid())){var S;null===(S=E._transmissionHelper)||void 0===S||S._setupRenderTargets()}}return L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=0,N.transmissionTexture?(N.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/transmissionTexture`,N.transmissionTexture,void 0).then((E=>{E.name=`${g.name} (Transmission)`,L.subSurface.refractionIntensityTexture=E,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(HE),a(HE,!0,(E=>new KE(E)));const XE="KHR_materials_diffuse_transmission";class EU{constructor(E){this.name=XE,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(XE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadTranslucentPropertiesAsync(N,U,g,L)),await Promise.all(D).then((()=>{}))}))}_loadTranslucentPropertiesAsync(E,U,g,N){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const L=g;if(L.subSurface.isTranslucencyEnabled=!0,L.subSurface.volumeIndexOfRefraction=1,L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=0,L.subSurface.useAlbedoToTintTranslucency=!1,void 0===N.diffuseTransmissionFactor)return L.subSurface.translucencyIntensity=0,L.subSurface.isTranslucencyEnabled=!1,Promise.resolve();L.subSurface.translucencyIntensity=N.diffuseTransmissionFactor;const S=new Array;return L.subSurface.useGltfStyleTextures=!0,N.diffuseTransmissionTexture&&(N.diffuseTransmissionTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionTexture`,N.diffuseTransmissionTexture).then((E=>{E.name=`${g.name} (Diffuse Transmission)`,L.subSurface.translucencyIntensityTexture=E})))),void 0!==N.diffuseTransmissionColorFactor?L.subSurface.translucencyColor=D.VU.eU(N.diffuseTransmissionColorFactor):L.subSurface.translucencyColor=D.VU.White(),N.diffuseTransmissionColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionColorTexture`,N.diffuseTransmissionColorTexture).then((E=>{E.name=`${g.name} (Diffuse Transmission Color)`,L.subSurface.translucencyColorTexture=E}))),Promise.all(S).then((()=>{}))}}J(XE),a(XE,!0,(E=>new EU(E)));const UU="KHR_materials_volume";class gU{constructor(E){this.name=UU,this.order=173,this._loader=E,this.enabled=this._loader.isExtensionUsed(UU),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadVolumePropertiesAsync(N,U,g,L)),await Promise.all(D).then((()=>{}))}))}_loadVolumePropertiesAsync(E,U,g,N){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);if(!g.subSurface.isRefractionEnabled&&!g.subSurface.isTranslucencyEnabled||!N.thicknessFactor)return Promise.resolve();g.subSurface.volumeIndexOfRefraction=g.indexOfRefraction;const L=void 0!==N.attenuationDistance?N.attenuationDistance:Number.MAX_VALUE;return g.subSurface.tintColorAtDistance=L,void 0!==N.attenuationColor&&3==N.attenuationColor.length&&g.subSurface.tintColor.du(N.attenuationColor[0],N.attenuationColor[1],N.attenuationColor[2]),g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=N.thicknessFactor,g.subSurface.useThicknessAsDepth=!0,N.thicknessTexture?(N.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/thicknessTexture`,N.thicknessTexture).then((E=>{E.name=`${g.name} (Thickness)`,g.subSurface.thicknessTexture=E,g.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(UU),a(UU,!0,(E=>new gU(E)));const NU="KHR_materials_dispersion";class LU{constructor(E){this.name=NU,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(NU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadDispersionPropertiesAsync(N,U,g,L)),await Promise.all(D).then((()=>{}))}))}_loadDispersionPropertiesAsync(E,U,g,N){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);return g.subSurface.isRefractionEnabled&&N.dispersion?(g.subSurface.isDispersionEnabled=!0,g.subSurface.dispersion=N.dispersion,Promise.resolve()):Promise.resolve()}}J(NU),a(NU,!0,(E=>new LU(E)));const DU="EXT_materials_diffuse_roughness";class SU{constructor(E){this.name=DU,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(DU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(E,U,g)),D.push(this._loadDiffuseRoughnessPropertiesAsync(N,L,g)),await Promise.all(D).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(E,U,g){if(!(g instanceof e.b))throw new Error(`${E}: Material type not supported`);const N=new Array;return g.brdf.baseDiffuseModel=WE.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=U.diffuseRoughnessFactor?g.baseDiffuseRoughness=U.diffuseRoughnessFactor:g.baseDiffuseRoughness=0,U.diffuseRoughnessTexture&&N.push(this._loader.loadTextureInfoAsync(`${E}/diffuseRoughnessTexture`,U.diffuseRoughnessTexture,(E=>{E.name=`${g.name} (Diffuse Roughness)`,g.baseDiffuseRoughnessTexture=E}))),Promise.all(N).then((()=>{}))}}J(DU),a(DU,!0,(E=>new SU(E)));const uU="KHR_mesh_quantization";class sU{constructor(E){this.name=uU,this.enabled=E.isExtensionUsed(uU)}dispose(){}}J(uU),a(uU,!0,(E=>new sU(E)));const CU="KHR_texture_basisu";class BU{constructor(E){this.name=CU,this._loader=E,this.enabled=E.isExtensionUsed(CU)}dispose(){this._loader=null}_loadTextureAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>{const D=void 0==U.sampler?Q.DefaultSampler:W.Get(`${E}/sampler`,this._loader.Zg.samplers,U.sampler),S=W.Get(`${N}/source`,this._loader.Zg.images,L.source);return await this._loader._createTextureAsync(E,D,S,(E=>{g(E)}),U._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!U._textureInfo.nonColorData)}))}}J(CU),a(CU,!0,(E=>new BU(E)));const PU="KHR_texture_transform";class FU{constructor(E){this.name=PU,this._loader=E,this.enabled=this._loader.isExtensionUsed(PU)}dispose(){this._loader=null}loadTextureInfoAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(N,L)=>await this._loader.loadTextureInfoAsync(E,U,(E=>{if(!(E instanceof x.c))throw new Error(`${N}: Texture type not supported`);L.offset&&(E.uOffset=L.offset[0],E.vOffset=L.offset[1]),E.uRotationCenter=0,E.vRotationCenter=0,L.rotation&&(E.wAng=-L.rotation),L.scale&&(E.uScale=L.scale[0],E.vScale=L.scale[1]),void 0!=L.texCoord&&(E.coordinatesIndex=L.texCoord),g(E)}))))}}J(PU),a(PU,!0,(E=>new FU(E)));const fU="KHR_xmp_json_ld";class dU{constructor(E){this.name=fU,this.order=100,this._loader=E,this.enabled=this._loader.isExtensionUsed(fU)}dispose(){this._loader=null}onLoading(){var E,U,g;if(null===this._loader.rootBabylonMesh)return;const N=null===(E=this._loader.Zg.extensions)||void 0===E?void 0:E.KHR_xmp_json_ld,L=null===(U=this._loader.Zg.asset)||void 0===U||null===(g=U.extensions)||void 0===g?void 0:g.KHR_xmp_json_ld;if(N&&L){const E=+L.packet;N.packets&&E<N.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=N.packets[E])}}}function IU(E,U,g,N){return D.VU.eU(U,g).scale(N)}function yU(E,U,g,N){return U[g]*N}function hU(E,U,g,N){return-U[g]*N}function VU(E,U,g,N){return U[g+1]*N}function eU(E,U,g,N){return U[g]*N*2}function xU(E){return{scale:[new YU(F.c.ANIMATIONTYPE_FLOAT,`${E}.uScale`,yU,(()=>2)),new YU(F.c.ANIMATIONTYPE_FLOAT,`${E}.vScale`,VU,(()=>2))],offset:[new YU(F.c.ANIMATIONTYPE_FLOAT,`${E}.uOffset`,yU,(()=>2)),new YU(F.c.ANIMATIONTYPE_FLOAT,`${E}.vOffset`,VU,(()=>2))],rotation:[new YU(F.c.ANIMATIONTYPE_FLOAT,`${E}.wAng`,hU,(()=>1))]}}J(fU),a(fU,!0,(E=>new dU(E)));class lU extends R.AnimationPropertyInfo{buildAnimations(E,U,g,N){return[{babylonAnimatable:E._babylonCamera,babylonAnimation:this._buildAnimation(U,g,N)}]}}class YU extends R.AnimationPropertyInfo{buildAnimations(E,U,g,N){const L=[];for(const D in E._data)L.push({babylonAnimatable:E._data[D].babylonMaterial,babylonAnimation:this._buildAnimation(U,g,N)});return L}}class tU extends R.AnimationPropertyInfo{buildAnimations(E,U,g,N){return[{babylonAnimatable:E._babylonLight,babylonAnimation:this._buildAnimation(U,g,N)}]}}(0,q.n)("/cameras/{}/orthographic/xmag",[new lU(F.c.ANIMATIONTYPE_FLOAT,"orthoLeft",hU,(()=>1)),new lU(F.c.ANIMATIONTYPE_FLOAT,"orthoRight",VU,(()=>1))]),(0,q.n)("/cameras/{}/orthographic/ymag",[new lU(F.c.ANIMATIONTYPE_FLOAT,"orthoBottom",hU,(()=>1)),new lU(F.c.ANIMATIONTYPE_FLOAT,"orthoTop",VU,(()=>1))]),(0,q.n)("/cameras/{}/orthographic/zfar",[new lU(F.c.ANIMATIONTYPE_FLOAT,"maxZ",yU,(()=>1))]),(0,q.n)("/cameras/{}/orthographic/znear",[new lU(F.c.ANIMATIONTYPE_FLOAT,"kg",yU,(()=>1))]),(0,q.n)("/cameras/{}/perspective/yfov",[new lU(F.c.ANIMATIONTYPE_FLOAT,"fov",yU,(()=>1))]),(0,q.n)("/cameras/{}/perspective/zfar",[new lU(F.c.ANIMATIONTYPE_FLOAT,"maxZ",yU,(()=>1))]),(0,q.n)("/cameras/{}/perspective/znear",[new lU(F.c.ANIMATIONTYPE_FLOAT,"kg",yU,(()=>1))]),(0,q.n)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new YU(F.c.ANIMATIONTYPE_COLOR3,"albedoColor",IU,(()=>4)),new YU(F.c.ANIMATIONTYPE_FLOAT,"alpha",(function(E,U,g,N){return U[g+3]*N}),(()=>4))]),(0,q.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"metallic",yU,(()=>1))]),(0,q.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"roughness",yU,(()=>1))]);const GU=xU("albedoTexture");(0,q.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",GU.scale),(0,q.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",GU.offset),(0,q.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",GU.rotation);const bU=xU("metallicTexture");(0,q.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",bU.scale),(0,q.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",bU.offset),(0,q.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",bU.rotation),(0,q.n)("/materials/{}/emissiveFactor",[new YU(F.c.ANIMATIONTYPE_COLOR3,"emissiveColor",IU,(()=>3))]);const TU=xU("bumpTexture");(0,q.n)("/materials/{}/normalTexture/scale",[new YU(F.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",yU,(()=>1))]),(0,q.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",TU.scale),(0,q.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",TU.offset),(0,q.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",TU.rotation),(0,q.n)("/materials/{}/occlusionTexture/strength",[new YU(F.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",yU,(()=>1))]);const vU=xU("ambientTexture");(0,q.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",vU.scale),(0,q.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",vU.offset),(0,q.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",vU.rotation);const oU=xU("emissiveTexture");(0,q.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",oU.scale),(0,q.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",oU.offset),(0,q.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",oU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new YU(F.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new YU(F.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",yU,(()=>1))]);const cU=xU("anisotropy.texture");(0,q.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",cU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",cU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",cU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",yU,(()=>1))]);const rU=xU("clearCoat.texture");(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",rU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",rU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",rU.rotation);const jU=xU("clearCoat.bumpTexture");(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new YU(F.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",jU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",jU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",jU.rotation);const ZU=xU("clearCoat.textureRoughness");(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ZU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ZU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ZU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new YU(F.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_ior/ior",[new YU(F.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new YU(F.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new YU(F.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",yU,(()=>1))]);const AU=xU("iridescence.texture");(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",AU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",AU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",AU.rotation);const wU=xU("iridescence.thicknessTexture");(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",wU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",wU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",wU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new YU(F.c.ANIMATIONTYPE_COLOR3,"sheen.color",IU,(()=>3))]),(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",yU,(()=>1))]);const aU=xU("sheen.texture");(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",aU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",aU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",aU.rotation);const JU=xU("sheen.textureRoughness");(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",JU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",JU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",JU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new YU(F.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",IU,(()=>3))]);const qU=xU("metallicReflectanceTexture");(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",qU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",qU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",qU.rotation);const MU=xU("reflectanceTexture");(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",MU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",MU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",MU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",yU,(()=>1))]);const mg=xU("subSurface.refractionIntensityTexture");(0,q.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",mg.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",mg.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",mg.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new YU(F.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",IU,(()=>3))]),(0,q.n)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new YU(F.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",yU,(()=>1))]),(0,q.n)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",yU,(()=>1))]);const WU=xU("subSurface.thicknessTexture");(0,q.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",WU.scale),(0,q.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",WU.offset),(0,q.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",WU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new YU(F.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",yU,(()=>1))]);const OU=xU("subSurface.translucencyIntensityTexture");(0,q.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",OU.scale),(0,q.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",OU.offset),(0,q.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",OU.rotation),(0,q.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new YU(F.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",IU,(()=>3))]);const QU=xU("subSurface.translucencyColorTexture");(0,q.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",QU.scale),(0,q.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",QU.offset),(0,q.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",QU.rotation),(0,q.n)("/extensions/KHR_lights_punctual/lights/{}/color",[new tU(F.c.ANIMATIONTYPE_COLOR3,"diffuse",IU,(()=>3))]),(0,q.n)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new tU(F.c.ANIMATIONTYPE_FLOAT,"intensity",yU,(()=>1))]),(0,q.n)("/extensions/KHR_lights_punctual/lights/{}/range",[new tU(F.c.ANIMATIONTYPE_FLOAT,"range",yU,(()=>1))]),(0,q.n)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new tU(F.c.ANIMATIONTYPE_FLOAT,"innerAngle",eU,(()=>1))]),(0,q.n)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new tU(F.c.ANIMATIONTYPE_FLOAT,"angle",eU,(()=>1))]),(0,q.n)("/nodes/{}/extensions/EXT_lights_ies/color",[new tU(F.c.ANIMATIONTYPE_COLOR3,"diffuse",IU,(()=>3))]),(0,q.n)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new tU(F.c.ANIMATIONTYPE_FLOAT,"intensity",yU,(()=>1))]);const RU="KHR_animation_pointer";class nU{constructor(E){this.name=RU,this._loader=E,this._pathToObjectConverter=(0,q.j)(this._loader.Zg)}get enabled(){return this._loader.isExtensionUsed(RU)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(E,U,g,N,L){var D;const S=null===(D=N.target.extensions)||void 0===D?void 0:D.KHR_animation_pointer;if(!S||!this._pathToObjectConverter)return null;"pointer"!==N.target.path&&I.d.Warn(`${E}/target/path: Value (${N.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=N.target.node&&I.d.Warn(`${E}/target/node: Value (${N.target.node}) must not be present when using the ${this.name} extension`);const u=`${E}/extensions/${this.name}`,s=S.pointer;if(!s)throw new Error(`${u}: Pointer is missing`);try{const D=this._pathToObjectConverter.convert(s);if(!D.info.interpolation)throw new Error(`${u}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(E,U,g,N,{object:D.object,info:D.info.interpolation},L)}catch(C){return I.d.Warn(`${u}/pointer: Invalid pointer (${s}) skipped`),null}}}J(RU),a(RU,!0,(E=>new nU(E)));class kU{constructor(E,U,g){this.frame=E,this.action=U,this.onlyOnce=g,this.isDone=!1}_clone(){return new kU(this.frame,this.action,this.onlyOnce)}}var zU=g(12199),iU=g(12243),pU=g(12234);class HU{get loop(){return this._loop}set loop(E){E!==this._loop&&(this._loop=E,this.updateOptions({loop:E}))}get currentTime(){var E;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(E=iU.b.audioEngine)&&void 0!==E&&E.audioContext&&(this.isPlaying||this.isPaused)){const E=this.isPaused?0:iU.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+E}return 0}get spatialSound(){return this._spatialSound}set spatialSound(E){if(E==this._spatialSound)return;const U=this.isPlaying;this.pause(),E?(this._spatialSound=E,this._updateSpatialParameters()):this._disableSpatialSound(),U&&this.play()}constructor(E,U,g){var N;let D=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new B.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=L.dU.Zero(),this._localDirection=new L.dU(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=E,g=g||d.b.LastCreatedScene)if(this._scene=g,HU._SceneComponentInitialization(g),this._readyToPlayCallback=D,this._customAttenuationFunction=(E,U,g,N,L)=>U<g?E*(1-U/g):0,u&&(this.autoplay=u.autoplay||!1,this._loop=u.loop||!1,void 0!==u.volume&&(this._volume=u.volume),this._spatialSound=u.spatialSound??!1,this.maxDistance=u.maxDistance??100,this.useCustomAttenuation=u.useCustomAttenuation??!1,this.rolloffFactor=u.rolloffFactor||1,this.refDistance=u.refDistance||1,this.distanceModel=u.distanceModel||"linear",this._playbackRate=u.playbackRate||1,this._streaming=u.streaming??!1,this._length=u.length,this._offset=u.offset),null!==(N=iU.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&iU.b.audioEngine.audioContext){this._soundGain=iU.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let E=!0;if(U)try{"string"===typeof U?(this._urlType="String",this._url=U):U instanceof ArrayBuffer?this._urlType="ArrayBuffer":U instanceof HTMLMediaElement?this._urlType="MediaElement":U instanceof MediaStream?this._urlType="MediaStream":U instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(U)&&(this._urlType="Array");let g=[],N=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=iU.b.audioEngine.audioContext.createMediaElementSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=iU.b.audioEngine.audioContext.createMediaStreamSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":U.byteLength>0&&(N=!0,this._soundLoaded(U));break;case"AudioBuffer":this._audioBufferLoaded(U);break;case"String":g.push(U);case"Array":0===g.length&&(g=U);for(let E=0;E<g.length;E++){const U=g[E];if(N=u&&u.skipCodecCheck||-1!==U.indexOf(".mp3",U.length-4)&&iU.b.audioEngine.isMP3supported||-1!==U.indexOf(".ogg",U.length-4)&&iU.b.audioEngine.isOGGsupported||-1!==U.indexOf(".wav",U.length-4)||-1!==U.indexOf(".m4a",U.length-4)||-1!==U.indexOf(".mp4",U.length-4)||-1!==U.indexOf("blob:"),N){this._streaming?(this._htmlAudioElement=new Audio(U),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,S.Tools.SetCorsBehavior(U,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(U,(E=>{this._soundLoaded(E)}),void 0,!0,!0,(E=>{E&&I.d.Error("XHR "+E.status+" error on: "+U+"."),I.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:E=!1}E?N||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):I.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(s){I.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),iU.b.audioEngine&&!iU.b.audioEngine.WarnedWebAudioUnsupported&&(I.d.Error("Web Audio is not supported by your browser."),iU.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var E;null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(E){var U;null!==(U=iU.b.audioEngine)&&void 0!==U&&U.audioContext&&(this._audioBuffer=E,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(E){var U;null!==(U=iU.b.audioEngine)&&void 0!==U&&U.audioContext&&iU.b.audioEngine.audioContext.decodeAudioData(E,(E=>{this._audioBufferLoaded(E)}),(E=>{I.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+E)}))}setAudioBuffer(E){var U;null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this._audioBuffer=E,this._isReadyToPlay=!0)}updateOptions(E){E&&(this.loop=E.loop??this.loop,this.maxDistance=E.maxDistance??this.maxDistance,this.useCustomAttenuation=E.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=E.rolloffFactor??this.rolloffFactor,this.refDistance=E.refDistance??this.refDistance,this.distanceModel=E.distanceModel??this.distanceModel,this._playbackRate=E.playbackRate??this._playbackRate,this._length=E.length??void 0,this.spatialSound=E.spatialSound??this._spatialSound,this._setOffset(E.offset??void 0),this.setVolume(E.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var E;null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&iU.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??iU.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var E;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(E=this._soundPanner)||void 0===E||E.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var E;null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(E){var U;null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(E),this._isOutputConnected=!0)}setDirectionalCone(E,U,g){U<E?I.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=E,this._coneOuterAngle=U,this._coneOuterGain=g,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!=this._coneInnerAngle){var U;if(this._coneOuterAngle<E)return void I.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E,null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!=this._coneOuterAngle){var U;if(E<this._coneInnerAngle)return void I.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E,null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(E){var U;E.equals(this._position)||(this._position.D(E),null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(E){var U;this._localDirection=E,null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const E=this._connectedTransformNode.getWorldMatrix(),U=L.dU.TransformNormal(this._localDirection,E);U.normalize(),this._soundPanner.orientationX.value=U.x,this._soundPanner.orientationY.value=U.y,this._soundPanner.orientationZ.value=U.z}updateDistanceFromListener(){var E;if(null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const E=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.IU(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,E,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(E){this._customAttenuationFunction=E}play(E,U,g){var N;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(N=iU.b.audioEngine)&&void 0!==N&&N.audioContext)try{var L,D;this._clearTimeoutsAndObservers();let N=E?(null===(L=iU.b.audioEngine)||void 0===L?void 0:L.audioContext.currentTime)+E:null===(D=iU.b.audioEngine)||void 0===D?void 0:D.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=iU.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const E=()=>{var g;if(null!==(g=iU.b.audioEngine)&&void 0!==g&&g.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=U??0;const g=this._htmlAudioElement.play();void 0!==g&&g.catch((()=>{var U,g;(null===(U=iU.b.audioEngine)||void 0===U||U.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(g=iU.b.audioEngine)||void 0===g?void 0:g.onAudioUnlockedObservable.addOnce((()=>{E()})))}))}else{var N;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(N=iU.b.audioEngine)||void 0===N?void 0:N.onAudioUnlockedObservable.addOnce((()=>{E()}))}};E()}}else{var S;const L=()=>{var L;if(null!==(L=iU.b.audioEngine)&&void 0!==L&&L.audioContext){var D;if(g=g||this._length,void 0!==U&&this._setOffset(U),this._soundSource){const E=this._soundSource;E.onended=()=>{E.disconnect()}}if(this._soundSource=null===(D=iU.b.audioEngine)||void 0===D?void 0:D.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var S;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==U&&(this._soundSource.loopStart=U),void 0!==g&&(this._soundSource.loopEnd=(0|U)+g),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},N=E?(null===(S=iU.b.audioEngine)||void 0===S?void 0:S.audioContext.currentTime)+E:iU.b.audioEngine.audioContext.currentTime;const L=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(N,L,this.loop?void 0:g)}}};"suspended"===(null===(S=iU.b.audioEngine)||void 0===S?void 0:S.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var E;"suspended"===(null===(E=iU.b.audioEngine)||void 0===E?void 0:E.audioContext.state)?(iU.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=iU.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{L()})))):L()}),500):L()}this._startTime=N,this.isPlaying=!0,this.isPaused=!1}catch(u){I.d.Error("Error while trying to play audio: "+this.name+", "+u.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(E){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var g;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(g=this._streamingSource)||void 0===g||g.disconnect();this.isPlaying=!1}else if(null!==(U=iU.b.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource){const U=E?iU.b.audioEngine.audioContext.currentTime+E:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(U)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(E=iU.b.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=iU.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(E,U){var g;null!==(g=iU.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._soundGain&&(U&&iU.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(iU.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,iU.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(E,iU.b.audioEngine.audioContext.currentTime+U)):this._soundGain.gain.value=E),this._volume=E}setPlaybackRate(E){this._playbackRate=E,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(E){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=E,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=E=>this._onRegisterAfterWorldMatrixUpdate(E),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(E){var U;if(E.getBoundingInfo){const U=E.getBoundingInfo();this.setPosition(U.boundingSphere.centerWorld)}else this.setPosition(E.absolutePosition);null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const E=()=>{(0,pU.f)((()=>this._isReadyToPlay),(()=>{g._audioBuffer=this.getAudioBuffer(),g._isReadyToPlay=!0,g.autoplay&&g.play(0,this._offset,this._length)}),void 0,300)},U={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},g=new HU(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,U);return this.useCustomAttenuation&&g.setAttenuationFunction(this._customAttenuationFunction),g.setPosition(this._position),g.setPlaybackRate(this._playbackRate),E(),g}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const E={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(E.connectedMeshId=this._connectedTransformNode.id),E.position=this._position.Og(),E.refDistance=this.refDistance,E.distanceModel=this.distanceModel,E.isDirectional=this._isDirectional,E.localDirectionToMesh=this._localDirection.Og(),E.coneInnerAngle=this._coneInnerAngle,E.coneOuterAngle=this._coneOuterAngle,E.coneOuterGain=this._coneOuterGain),E}static Parse(E,U,g,N){const D=E.name;let S;S=E.url?g+E.url:g+D;const u={autoplay:E.autoplay,loop:E.loop,volume:E.volume,spatialSound:E.spatialSound,maxDistance:E.maxDistance,rolloffFactor:E.rolloffFactor,refDistance:E.refDistance,distanceModel:E.distanceModel,playbackRate:E.playbackRate};let s;if(N){const E=()=>{(0,pU.f)((()=>N._isReadyToPlay),(()=>{s._audioBuffer=N.getAudioBuffer(),s._isReadyToPlay=!0,s.autoplay&&s.play(0,s._offset,s._length)}),void 0,300)};s=new HU(D,new ArrayBuffer(0),U,null,u),E()}else s=new HU(D,S,U,(()=>{U.removePendingData(s)}),u),U.addPendingData(s);if(E.position){const U=L.dU.eU(E.position);s.setPosition(U)}if(E.isDirectional&&(s.setDirectionalCone(E.coneInnerAngle||360,E.coneOuterAngle||360,E.coneOuterGain||0),E.localDirectionToMesh)){const U=L.dU.eU(E.localDirectionToMesh);s.setLocalDirectionToMesh(U)}if(E.connectedMeshId){const g=U.getMeshById(E.connectedMeshId);g&&s.attachToMesh(g)}return E.metadata&&(s.metadata=E.metadata),s}_setOffset(E){this._offset!==E&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=E)}_clearTimeoutsAndObservers(){var E;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(E=iU.b.audioEngine)||void 0===E||E.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}HU._SceneComponentInitialization=E=>{throw(0,zU.e)("AudioSceneComponent")},(0,YE.f)("BABYLON.Sound",HU);class KU{constructor(E,U,g){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],U.length!==g.length)throw new Error("Sounds length does not equal weights length");this.loop=E,this._weights=g;let N=0;for(const D of g)N+=D;const L=N>0?1/N:0;for(let D=0;D<this._weights.length;D++)this._weights[D]*=L;this._sounds=U;for(const D of this._sounds)D.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!==this._coneInnerAngle){if(this._coneOuterAngle<E)return void I.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E;for(const U of this._sounds)U.directionalConeInnerAngle=E}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!==this._coneOuterAngle){if(E<this._coneInnerAngle)return void I.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E;for(const U of this._sounds)U.directionalConeOuterAngle=E}}get volume(){return this._volume}set volume(E){if(E!==this._volume)for(const U of this._sounds)U.setVolume(E)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(E){if(!this.isPaused){this.stop();const E=Math.random();let U=0;for(let g=0;g<this._weights.length;g++)if(U+=this._weights[g],E<=U){this._currentIndex=g;break}}const U=this._sounds[this._currentIndex??0];U.isReady()?U.play(0,this.isPaused?void 0:E):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class XU{constructor(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(E=E||d.b.LastCreatedScene)&&(this._scene=E,this.soundCollection=[],this._options=U,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var E;null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&iU.b.audioEngine.audioContext&&(this._outputAudioNode=iU.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(iU.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(iU.b.audioEngine&&iU.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(E){var U;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&E.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==E.soundTrackId&&(-1===E.soundTrackId?this._scene.mainSoundTrack.removeSound(E):this._scene.soundTracks&&this._scene.soundTracks[E.soundTrackId].removeSound(E)),this.soundCollection.push(E),E.soundTrackId=this.id}removeSound(E){const U=this.soundCollection.indexOf(E);-1!==U&&this.soundCollection.splice(U,1)}setVolume(E){var U;null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=E)}switchPanningModelToHRTF(){var E;if(null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var E;if(null!==(E=iU.b.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToEqualPower()}connectToAnalyser(E){var U;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=E,null!==(U=iU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,iU.b.audioEngine.masterGain))}}var Eg=g(12607),Ug=g(12573),gg=g(12183);iU.b.AudioEngineFactory=(E,U,g)=>new Ng(E,U,g);class Ng{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new B.b,this.onAudioLockedObservable=new B.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,gg.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const N=document.createElement("audio");this._hostElement=E,this._audioContext=U,this._audioDestination=g;try{N&&N.canPlayType&&(N.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||N.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(L){}try{N&&N.canPlayType&&N.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(L){}}lock(){this._triggerSuspendedState()}unlock(){var E,U;if("running"===(null===(E=this._audioContext)||void 0===E?void 0:E.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(U=this._audioContext)||void 0===U||U.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{I.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var E;null===(E=this._audioContext)||void 0===E||E.addEventListener("statechange",(()=>{var E;this.unlocked&&"running"!==(null===(E=this._audioContext)||void 0===E?void 0:E.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var E;return null!==(E=this._audioContext)&&void 0!==E&&E.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(E){this.canUseWebAudio=!1,I.d.Error("Web Audio: "+E.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(E){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const E=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",U=document.createElement("style");U.appendChild(document.createTextNode(E)),document.getElementsByTagName("head")[0].appendChild(U),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var E;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(E=this._audioContext)||void 0===E||E.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(E){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=E)}connectToAnalyser(E){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=E,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Lg=g(12197);(0,g(13708).g)(Eg.b.NAME_AUDIO,((E,U,g,N)=>{let L,D=[];if(g.GF=g.GF||[],void 0!==E.GF&&null!==E.GF)for(let u=0,s=E.GF.length;u<s;u++){var S;const s=E.GF[u];null!==(S=iU.b.audioEngine)&&void 0!==S&&S.canUseWebAudio?(s.url||(s.url=s.name),D[s.url]?g.GF.push(HU.Parse(s,U,N,D[s.url])):(L=HU.Parse(s,U,N),D[s.url]=L,g.GF.push(L))):g.GF.push(new HU(s.name,null,U))}D=[]})),Object.defineProperty(Ug.c.prototype,"mainSoundTrack",{get:function(){let E=this._getComponent(Eg.b.NAME_AUDIO);return E||(E=new Dg(this),this.o(E)),this._mainSoundTrack||(this._mainSoundTrack=new XU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Ug.c.prototype.getSoundByName=function(E){let U;for(U=0;U<this.mainSoundTrack.soundCollection.length;U++)if(this.mainSoundTrack.soundCollection[U].name===E)return this.mainSoundTrack.soundCollection[U];if(this.soundTracks)for(let g=0;g<this.soundTracks.length;g++)for(U=0;U<this.soundTracks[g].soundCollection.length;U++)if(this.soundTracks[g].soundCollection[U].name===E)return this.soundTracks[g].soundCollection[U];return null},Object.defineProperty(Ug.c.prototype,"audioEnabled",{get:function(){let E=this._getComponent(Eg.b.NAME_AUDIO);return E||(E=new Dg(this),this.o(E)),E.audioEnabled},set:function(E){let U=this._getComponent(Eg.b.NAME_AUDIO);U||(U=new Dg(this),this.o(U)),E?U.enableAudio():U.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Ug.c.prototype,"headphone",{get:function(){let E=this._getComponent(Eg.b.NAME_AUDIO);return E||(E=new Dg(this),this.o(E)),E.headphone},set:function(E){let U=this._getComponent(Eg.b.NAME_AUDIO);U||(U=new Dg(this),this.o(U)),E?U.switchAudioModeForHeadphones():U.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Ug.c.prototype,"audioListenerPositionProvider",{get:function(){let E=this._getComponent(Eg.b.NAME_AUDIO);return E||(E=new Dg(this),this.o(E)),E.audioListenerPositionProvider},set:function(E){let U=this._getComponent(Eg.b.NAME_AUDIO);if(U||(U=new Dg(this),this.o(U)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");U.audioListenerPositionProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(Ug.c.prototype,"audioListenerRotationProvider",{get:function(){let E=this._getComponent(Eg.b.NAME_AUDIO);return E||(E=new Dg(this),this.o(E)),E.audioListenerRotationProvider},set:function(E){let U=this._getComponent(Eg.b.NAME_AUDIO);if(U||(U=new Dg(this),this.o(U)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");U.audioListenerRotationProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(Ug.c.prototype,"audioPositioningRefreshRate",{get:function(){let E=this._getComponent(Eg.b.NAME_AUDIO);return E||(E=new Dg(this),this.o(E)),E.audioPositioningRefreshRate},set:function(E){let U=this._getComponent(Eg.b.NAME_AUDIO);U||(U=new Dg(this),this.o(U)),U.audioPositioningRefreshRate=E},enumerable:!0,configurable:!0});class Dg{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(E){this.name=Eg.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new L.dU,this._cachedCameraPosition=new L.dU,this._lastCheck=0,this._invertMatrixTemp=new L.Matrix,this._cameraDirectionTemp=new L.dU,(E=E||d.b.LastCreatedScene)&&(this.yU=E,E.soundTracks=[],E.GF=[])}register(){this.yU._afterRenderStage.registerStep(Eg.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(E){if(E.GF=[],this.yU.soundTracks)for(let U=0;U<this.yU.soundTracks.length;U++){const g=this.yU.soundTracks[U];for(let U=0;U<g.soundCollection.length;U++)E.GF.push(g.soundCollection[U].serialize())}}addFromContainer(E){if(E.GF)for(const U of E.GF)U.play(),U.autoplay=!0,this.yU.mainSoundTrack.addSound(U)}removeFromContainer(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(E.GF)for(const g of E.GF)g.stop(),g.autoplay=!1,this.yU.mainSoundTrack.removeSound(g),U&&g.dispose()}dispose(){const E=this.yU;if(E._mainSoundTrack&&E.mainSoundTrack.dispose(),E.soundTracks)for(let U=0;U<E.soundTracks.length;U++)E.soundTracks[U].dispose()}disableAudio(){const E=this.yU;let U;for(this._audioEnabled=!1,iU.b.audioEngine&&iU.b.audioEngine.audioContext&&iU.b.audioEngine.audioContext.suspend(),U=0;U<E.mainSoundTrack.soundCollection.length;U++)E.mainSoundTrack.soundCollection[U].pause();if(E.soundTracks)for(U=0;U<E.soundTracks.length;U++)for(let g=0;g<E.soundTracks[U].soundCollection.length;g++)E.soundTracks[U].soundCollection[g].pause()}enableAudio(){const E=this.yU;let U;for(this._audioEnabled=!0,iU.b.audioEngine&&iU.b.audioEngine.audioContext&&iU.b.audioEngine.audioContext.resume(),U=0;U<E.mainSoundTrack.soundCollection.length;U++)E.mainSoundTrack.soundCollection[U].isPaused&&E.mainSoundTrack.soundCollection[U].play();if(E.soundTracks)for(U=0;U<E.soundTracks.length;U++)for(let g=0;g<E.soundTracks[U].soundCollection.length;g++)E.soundTracks[U].soundCollection[g].isPaused&&E.soundTracks[U].soundCollection[g].play()}switchAudioModeForHeadphones(){const E=this.yU;if(this._headphone=!0,E.mainSoundTrack.switchPanningModelToHRTF(),E.soundTracks)for(let U=0;U<E.soundTracks.length;U++)E.soundTracks[U].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const E=this.yU;if(this._headphone=!1,E.mainSoundTrack.switchPanningModelToEqualPower(),E.soundTracks)for(let U=0;U<E.soundTracks.length;U++)E.soundTracks[U].switchPanningModelToEqualPower()}_afterRender(){const E=Lg.b.Now;if(this._lastCheck&&E-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=E;const U=this.yU;if(!this._audioEnabled||!U._mainSoundTrack||!U.soundTracks||0===U._mainSoundTrack.soundCollection.length&&1===U.soundTracks.length)return;const g=iU.b.audioEngine;if(g&&g.audioContext){let E,N=U.activeCamera;if(U.activeCameras&&U.activeCameras.length>0&&(N=U.activeCameras[0]),this.audioListenerPositionProvider){const E=this.audioListenerPositionProvider();g.audioContext.listener.setPosition(E.x||0,E.y||0,E.z||0)}else N?this._cachedCameraPosition.equals(N.globalPosition)||(this._cachedCameraPosition.D(N.globalPosition),g.audioContext.listener.setPosition(N.globalPosition.x,N.globalPosition.y,N.globalPosition.z)):g.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const E=this.audioListenerRotationProvider();g.audioContext.listener.setOrientation(E.x||0,E.y||0,E.z||0,0,1,0)}else N?(N.rigCameras&&N.rigCameras.length>0&&(N=N.rigCameras[0]),N.getViewMatrix().invertToRef(this._invertMatrixTemp),L.dU.TransformNormalToRef(Dg._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.D(this._cameraDirectionTemp),g.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):g.audioContext.listener.setOrientation(0,0,0,0,1,0);for(E=0;E<U.mainSoundTrack.soundCollection.length;E++){const g=U.mainSoundTrack.soundCollection[E];g.useCustomAttenuation&&g.updateDistanceFromListener()}if(U.soundTracks)for(E=0;E<U.soundTracks.length;E++)for(let g=0;g<U.soundTracks[E].soundCollection.length;g++){const N=U.soundTracks[E].soundCollection[g];N.useCustomAttenuation&&N.updateDistanceFromListener()}}}}Dg._CameraDirection=new L.dU(0,0,-1),HU._SceneComponentInitialization=E=>{let U=E._getComponent(Eg.b.NAME_AUDIO);U||(U=new Dg(E),E.o(U))};const Sg="MSFT_audio_emitter";class ug{constructor(E){this.name=Sg,this._loader=E,this.enabled=this._loader.isExtensionUsed(Sg)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const E=this._loader.Zg.extensions;if(E&&E[this.name]){const U=E[this.name];this._clips=U.clips,this._emitters=U.emitters,W.Assign(this._clips),W.Assign(this._emitters)}}loadSceneAsync(E,U){return Q.LoadExtensionAsync(E,U,this.name,(async(g,N)=>{const L=new Array;L.push(this._loader.loadSceneAsync(E,U));for(const E of N.emitters){const U=W.Get(`${g}/emitters`,this._emitters,E);if(void 0!=U.refDistance||void 0!=U.maxDistance||void 0!=U.rolloffFactor||void 0!=U.distanceModel||void 0!=U.innerAngle||void 0!=U.outerAngle)throw new Error(`${g}: Direction or Distance properties are not allowed on emitters attached to a scene`);L.push(this._loadEmitterAsync(`${g}/emitters/${U.index}`,U))}await Promise.all(L)}))}loadNodeAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(E,N)=>{const D=new Array,u=await this._loader.loadNodeAsync(E,U,(U=>{for(const g of N.emitters){const N=W.Get(`${E}/emitters`,this._emitters,g);D.push(this._loadEmitterAsync(`${E}/emitters/${N.index}`,N).then((()=>{for(const E of N._babylonSounds)E.attachToMesh(U),void 0==N.innerAngle&&void 0==N.outerAngle||(E.setLocalDirectionToMesh(L.dU.Forward()),E.setDirectionalCone(2*S.Tools.ToDegrees(void 0==N.innerAngle?Math.PI:N.innerAngle),2*S.Tools.ToDegrees(void 0==N.outerAngle?Math.PI:N.outerAngle),0))})))}g(U)}));return await Promise.all(D),u}))}loadAnimationAsync(E,U){return Q.LoadExtensionAsync(E,U,this.name,(async(g,N)=>{const L=await this._loader.loadAnimationAsync(E,U),D=new Array;W.Assign(N.events);for(const S of N.events)D.push(this._loadAnimationEventAsync(`${g}/events/${S.index}`,E,U,S,L));return await Promise.all(D),L}))}_loadClipAsync(E,U){if(U._objectURL)return U._objectURL;let g;if(U.uri)g=this._loader.loadUriAsync(E,U,U.uri);else{const N=W.Get(`${E}/bufferView`,this._loader.Zg.bufferViews,U.bufferView);g=this._loader.loadBufferViewAsync(`/bufferViews/${N.index}`,N)}return U._objectURL=g.then((E=>URL.createObjectURL(new Blob([E],{type:U.mimeType})))),U._objectURL}_loadEmitterAsync(E,U){if(U._babylonSounds=U._babylonSounds||[],!U._babylonData){const E=new Array,g=U.name||`emitter${U.index}`,N={loop:!1,autoplay:!1,volume:void 0==U.volume?1:U.volume};for(let D=0;D<U.clips.length;D++){const L=`/extensions/${this.name}/clips`,S=W.Get(L,this._clips,U.clips[D].clip);E.push(this._loadClipAsync(`${L}/${U.clips[D].clip}`,S).then((E=>{const L=U._babylonSounds[D]=new HU(g,E,this._loader.babylonScene,null,N);L.refDistance=U.refDistance||1,L.maxDistance=U.maxDistance||256,L.rolloffFactor=U.rolloffFactor||1,L.distanceModel=U.distanceModel||"exponential"})))}const L=Promise.all(E).then((()=>{const E=U.clips.map((E=>E.weight||1)),g=new KU(U.loop||!1,U._babylonSounds,E);U.innerAngle&&(g.directionalConeInnerAngle=2*S.Tools.ToDegrees(U.innerAngle)),U.outerAngle&&(g.directionalConeOuterAngle=2*S.Tools.ToDegrees(U.outerAngle)),U.volume&&(g.volume=U.volume),U._babylonData.sound=g}));U._babylonData={loaded:L}}return U._babylonData.loaded}_getEventAction(E,U,g,N,L){switch(g){case"play":return E=>{const g=(L||0)+(E-N);U.play(g)};case"stop":return()=>{U.stop()};case"pause":return()=>{U.pause()};default:throw new Error(`${E}: Unsupported action ${g}`)}}_loadAnimationEventAsync(E,U,g,N,L){if(0==L.targetedAnimations.length)return Promise.resolve();const D=L.targetedAnimations[0],S=N.NU,u=W.Get(`/extensions/${this.name}/emitters`,this._emitters,S);return this._loadEmitterAsync(E,u).then((()=>{const U=u._babylonData.sound;if(U){const g=new kU(N.time,this._getEventAction(E,U,N.action,N.time,N.startOffset));D.animation.addEvent(g),L.onAnimationGroupEndObservable.add((()=>{U.stop()})),L.onAnimationGroupPauseObservable.add((()=>{U.pause()}))}}))}}J(Sg),a(Sg,!0,(E=>new ug(E)));const sg="MSFT_lod";class Cg{constructor(E){var U;this.name=sg,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new B.b,this.onMaterialLODsLoadedObservable=new B.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=E,this.maxLODsToLoad=(null===(U=this._loader.parent.extensionOptions[sg])||void 0===U?void 0:U.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(sg)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let E=0;E<this._nodePromiseLODs.length;E++){const U=Promise.all(this._nodePromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Node LOD ${E}`),this._loader.log(`Loaded node LOD ${E}`)),this.onNodeLODsLoadedObservable.notifyObservers(E),E!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${E+1}`),this._loadBufferLOD(this._nodeBufferLODs,E+1),this._nodeSignalLODs[E]&&this._nodeSignalLODs[E].resolve())}));this._loader._completePromises.push(U)}for(let E=0;E<this._materialPromiseLODs.length;E++){const U=Promise.all(this._materialPromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Material LOD ${E}`),this._loader.log(`Loaded material LOD ${E}`)),this.onMaterialLODsLoadedObservable.notifyObservers(E),E!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${E+1}`),this._loadBufferLOD(this._materialBufferLODs,E+1),this._materialSignalLODs[E]&&this._materialSignalLODs[E].resolve())}));this._loader._completePromises.push(U)}}loadSceneAsync(E,U){const g=this._loader.loadSceneAsync(E,U);return this._loadBufferLOD(this._bufferLODs,0),g}loadNodeAsync(E,U,g){return Q.LoadExtensionAsync(E,U,this.name,(async(E,L)=>{let D;const S=this._getLODs(E,U,this._loader.Zg.nodes,L.ids);this._loader.logOpen(`${E}`);for(let U=0;U<S.length;U++){const E=S[U];0!==U&&(this._nodeIndexLOD=U,this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new N);const L=E=>{g(E),E.qu(!1)},u=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,L).then((E=>{if(0!==U){const E=S[U-1];E._babylonTransformNode&&(this._disposeTransformNode(E._babylonTransformNode),delete E._babylonTransformNode)}return E.qu(!0),E}));this._nodePromiseLODs[U]=this._nodePromiseLODs[U]||[],0===U?D=u:(this._nodeIndexLOD=null,this._nodePromiseLODs[U].push(u))}return this._loader.logClose(),await D}))}_loadMaterialAsync(E,U,g,N,L){return this._nodeIndexLOD?null:Q.LoadExtensionAsync(E,U,this.name,(async(E,D)=>{let S;const u=this._getLODs(E,U,this._loader.Zg.materials,D.ids);this._loader.logOpen(`${E}`);for(let U=0;U<u.length;U++){const E=u[U];0!==U&&(this._materialIndexLOD=U);const D=this._loader._loadMaterialAsync(`/materials/${E.index}`,E,g,N,(E=>{0===U&&L(E)})).then((E=>{if(0!==U){L(E);const g=u[U-1]._data;g[N]&&(this._disposeMaterials([g[N].babylonMaterial]),delete g[N])}return E}));this._materialPromiseLODs[U]=this._materialPromiseLODs[U]||[],0===U?S=D:(this._materialIndexLOD=null,this._materialPromiseLODs[U].push(D))}return this._loader.logClose(),await S}))}_loadUriAsync(E,U,g){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const L=this._nodeIndexLOD-1;return this._nodeSignalLODs[L]=this._nodeSignalLODs[L]||new N,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(E,U,g)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const L=this._materialIndexLOD-1;return this._materialSignalLODs[L]=this._materialSignalLODs[L]||new N,this._materialSignalLODs[L].promise.then((async()=>await this._loader.loadUriAsync(E,U,g)))}return null}loadBufferAsync(E,U,g,L){if(this._loader.parent.useRangeRequests&&!U.uri){if(!this._loader.bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);const U=async(E,U)=>{const D=g,S=D+L-1;let u=E[U];return u?(u.start=Math.min(u.start,D),u.end=Math.max(u.end,S)):(u={start:D,end:S,loaded:new N},E[U]=u),await u.loaded.promise.then((E=>new Uint8Array(E.buffer,E.byteOffset+g-u.start,L)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?U(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?U(this._materialBufferLODs,this._materialIndexLOD):U(this._bufferLODs,0)}return null}_loadBufferLOD(E,U){const g=E[U];g&&(this._loader.log(`Loading buffer range [${g.start}-${g.end}]`),this._loader.bin.readAsync(g.start,g.end-g.start+1).then((E=>{g.loaded.resolve(E)}),(E=>{g.loaded.reject(E)})))}_getLODs(E,U,g,N){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const L=[];for(let D=N.length-1;D>=0;D--)if(L.push(W.Get(`${E}/ids/${N[D]}`,g,N[D])),L.length===this.maxLODsToLoad)return L;return L.push(U),L}_disposeTransformNode(E){const U=[],g=E.material;g&&U.push(g);for(const L of E.getChildMeshes())L.material&&U.push(L.material);E.dispose();const N=U.filter((E=>this._loader.babylonScene.meshes.every((U=>U.material!=E))));this._disposeMaterials(N)}_disposeMaterials(E){const U={};for(const g of E){for(const E of g.getActiveTextures())U[E.uniqueId]=E;g.dispose()}for(const g in U)for(const E of this._loader.babylonScene.materials)E.hasTexture(U[g])&&delete U[g];for(const g in U)U[g].dispose()}}J(sg),a(sg,!0,(E=>new Cg(E)));const Bg="MSFT_minecraftMesh";class Pg{constructor(E){this.name=Bg,this._loader=E,this.enabled=this._loader.isExtensionUsed(Bg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtraAsync(E,U,this.name,(async(N,L)=>{if(L){if(!(g instanceof e.b))throw new Error(`${N}: Material type not supported`);const L=this._loader.loadMaterialPropertiesAsync(E,U,g);return g.needAlphaBlending()&&(g.forceDepthWrite=!0,g.separateCullingPass=!0),g.fu=g.forceDepthWrite,g.twoSidedLighting=!0,await L}}))}}J(Bg),a(Bg,!0,(E=>new Pg(E)));const Fg="MSFT_sRGBFactors";class fg{constructor(E){this.name=Fg,this._loader=E,this.enabled=this._loader.isExtensionUsed(Fg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,U,g){return Q.LoadExtraAsync(E,U,this.name,(async(N,L)=>{if(L){if(!(g instanceof e.b))throw new Error(`${N}: Material type not supported`);const L=this._loader.loadMaterialPropertiesAsync(E,U,g),D=g.tE().getEngine().useExactSrgbConversions;return g.albedoTexture||g.albedoColor.toLinearSpaceToRef(g.albedoColor,D),g.reflectivityTexture||g.reflectivityColor.toLinearSpaceToRef(g.reflectivityColor,D),await L}}))}}J(Fg),a(Fg,!0,(E=>new fg(E)));var dg=g(14041);const Ig={};var yg=g(14087),hg=g(14072),Vg=g(14043),eg=g(14058);function xg(E,U){for(const g of E)for(const E of g.dataOutputs)if(E.uniqueId===U)return E;throw new Error("Could not find data out connection with unique id "+U)}function lg(E,U){for(const g of E)if(g instanceof hg.e)for(const E of g.signalInputs)if(E.uniqueId===U)return E;throw new Error("Could not find signal in connection with unique id "+U)}async function Yg(E,U){const N=await Promise.all(E.allBlocks.map((async E=>{const U=function(E){switch(E){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([g.e(78),g.e(79)]).then(g.bind(g,15535))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await g.e(80).then(g.bind(g,15538))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await g.e(81).then(g.bind(g,15540))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await g.e(82).then(g.bind(g,15546))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await g.e(83).then(g.bind(g,15553))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await g.e(84).then(g.bind(g,15562))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await g.e(85).then(g.bind(g,15569))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await g.e(86).then(g.bind(g,15571))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await g.e(87).then(g.bind(g,15575))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await g.e(90).then(g.bind(g,15610))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await g.e(90).then(g.bind(g,15610))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await g.e(90).then(g.bind(g,15610))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await g.e(90).then(g.bind(g,15610))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await g.e(95).then(g.bind(g,15617))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await g.e(96).then(g.bind(g,15625))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await g.e(97).then(g.bind(g,15634))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await g.e(98).then(g.bind(g,15637))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await g.e(99).then(g.bind(g,15646))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await g.e(100).then(g.bind(g,15655))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await g.e(101).then(g.bind(g,15662))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await g.e(102).then(g.bind(g,15665))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await g.e(103).then(g.bind(g,15670))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await g.e(104).then(g.bind(g,15673))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await g.e(105).then(g.bind(g,15682))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await g.e(106).then(g.bind(g,15686))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await g.e(107).then(g.bind(g,15692))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await g.e(108).then(g.bind(g,15698))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await g.e(109).then(g.bind(g,15706))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await g.e(110).then(g.bind(g,15710))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await g.e(111).then(g.bind(g,15719))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await g.e(112).then(g.bind(g,15725))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await g.e(113).then(g.bind(g,15730))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await g.e(92).then(g.bind(g,15736))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await g.e(114).then(g.bind(g,15742))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await g.e(115).then(g.bind(g,15747))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await g.e(116).then(g.bind(g,15756))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await g.e(93).then(g.bind(g,15759))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await g.e(88).then(g.bind(g,15583))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await g.e(94).then(g.bind(g,15766))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await g.e(89).then(g.bind(g,15604))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await g.e(90).then(g.bind(g,15610))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await g.e(90).then(g.bind(g,15610))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await g.e(91).then(g.bind(g,15774))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await g.e(91).then(g.bind(g,15774))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await g.e(91).then(g.bind(g,15774))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await g.e(91).then(g.bind(g,15774))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await g.e(91).then(g.bind(g,15774))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await g.e(91).then(g.bind(g,15774))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await g.e(117).then(g.bind(g,15781))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await g.e(118).then(g.bind(g,15787))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await g.e(119).then(g.bind(g,15792))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await g.e(120).then(g.bind(g,15799))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await g.e(121).then(g.bind(g,15806))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await g.e(122).then(g.bind(g,15813))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await g.e(123).then(g.bind(g,15819))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await g.e(124).then(g.bind(g,15823))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await g.e(125).then(g.bind(g,15827))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await g.e(126).then(g.bind(g,15836))).FlowGraphDataSwitchBlock;default:if(Ig[E])return Ig[E];throw new Error(`Unknown block name ${E}`)}}(E.className);return await U()})));return function(E,U,g){const N=U.coordinator.createGraph(),L=[],D=U.valueParseFunction??Vg.e;for(let S=0;S<E.allBlocks.length;S++){const u=Gg(E.allBlocks[S],{yU:U.coordinator.config.yU,pathConverter:U.pathConverter,assetsContainer:U.coordinator.config.yU,valueParseFunction:D},g[S]);L.push(u),u instanceof yg.e&&N.addEventBlock(u)}for(const S of L){for(const E of S.dataInputs)for(const U of E.connectedPointIds){const g=xg(L,U);E.connectTo(g)}if(S instanceof hg.e)for(const E of S.signalOutputs)for(const U of E.connectedPointIds){const g=lg(L,U);E.connectTo(g)}}for(const S of E.executionContexts)tg(S,{graph:N,valueParseFunction:D},E.rightHanded);return N}(E,U,N)}function tg(E,U,g){const N=U.graph.createContext();E.enableLogging&&(N.enableLogging=!0),N.treatDataAsRightHanded=g||!1;const L=U.valueParseFunction??Vg.e;N.uniqueId=E.uniqueId;const D=N.tE();if(E._assetsContext){var S,u,s,C,B,P,F,f,d,I;const U=E._assetsContext,g={meshes:null===(S=U.meshes)||void 0===S?void 0:S.map((E=>D.getMeshById(E))),lights:null===(u=U.lights)||void 0===u?void 0:u.map((E=>D.getLightByName(E))),cameras:null===(s=U.cameras)||void 0===s?void 0:s.map((E=>D.getCameraByName(E))),materials:null===(C=U.materials)||void 0===C?void 0:C.map((E=>D.getMaterialById(E))),textures:null===(B=U.textures)||void 0===B?void 0:B.map((E=>D.getTextureByName(E))),animations:null===(P=U.animations)||void 0===P?void 0:P.map((E=>D.animations.find((U=>U.name===E)))),skeletons:null===(F=U.skeletons)||void 0===F?void 0:F.map((E=>D.getSkeletonByName(E))),RP:null===(f=U.RP)||void 0===f?void 0:f.map((E=>D.getParticleSystemById(E))),animationGroups:null===(d=U.animationGroups)||void 0===d?void 0:d.map((E=>D.getAnimationGroupByName(E))),transformNodes:null===(I=U.transformNodes)||void 0===I?void 0:I.map((E=>D.getTransformNodeById(E))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],GF:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};N.assetsContext=g}for(const y in E._userVariables){const U=L(y,E._userVariables,N.assetsContext,D);N.userVariables[y]=U}for(const y in E._connectionValues){const U=L(y,E._connectionValues,N.assetsContext,D);N._setConnectionValueByKey(y,U)}return N}function Gg(E,U,g){const N={},L=U.valueParseFunction??Vg.e;if(E.config)for(const S in E.config)N[S]=L(S,E.config,U.assetsContainer||U.yU,U.yU);if((0,Vg.i)(E.className)){if(!U.pathConverter)throw new Error("Path converter is required for this block");N.pathConverter=U.pathConverter}const D=new g(N);D.uniqueId=E.uniqueId;for(let S=0;S<E.dataInputs.length;S++){const U=D.getDataInput(E.dataInputs[S].name);if(!U)throw new Error("Could not find data input with name "+E.dataInputs[S].name+" in block "+E.className);U.deserialize(E.dataInputs[S])}for(let S=0;S<E.dataOutputs.length;S++){const U=D.getDataOutput(E.dataOutputs[S].name);if(!U)throw new Error("Could not find data output with name "+E.dataOutputs[S].name+" in block "+E.className);U.deserialize(E.dataOutputs[S])}return D.metadata=E.metadata,D.deserialize&&D.deserialize(E),D}function bg(E){const[U,g]=E.split(":");return Tg({op:U,extension:g})}function Tg(E){var U;let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=E.extension?null===(U=og[E.extension])||void 0===U?void 0:U[E.op]:cg[E.op];if(!N&&(I.d.Warn(`No mapping found for operation ${E.op} and extension ${E.extension||"KHR_interactivity"}`),g)){const U={},g={flows:{}};if(E.inputValueSockets){U.values={};for(const g in E.inputValueSockets)U.values[g]={name:g}}return E.outputValueSockets&&(g.values={},Object.keys(E.outputValueSockets).forEach((E=>{g.values[E]={name:E}}))),{BB:[],inputs:U,outputs:g}}return N}function vg(E,U,g){og[U]||(og[U]={}),og[U][E]=g}const og={BABYLON:{"flow/log":{BB:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},cg={"event/onStart":{BB:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{BB:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{BB:["FlowGraphSendCustomEventBlock"],extraProcessor(E,U,g,N,L){if("event/send"!==U.op||!E.configuration||1!==Object.keys(E.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const D=E.configuration.event.value[0];if("number"!==typeof D)throw new Error("Event id should be a number");const S=N.arrays.events[D],u=L[0];return u.config||(u.config={}),u.config.eventId=S.eventId,u.config.eventData=S.eventData,L}},"event/receive":{BB:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(E,U){var g;if(!E.configuration)return I.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const N=E.configuration.event;if(!N)return I.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const L=N.value[0];if("number"!==typeof L)return I.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(g=U.events)||void 0===g?void 0:g[L])?{valid:!0}:(I.d.Error(`Event with id ${L} not found`),{valid:!1,error:`Event with id ${L} not found`})},extraProcessor(E,U,g,N,L){if("event/receive"!==U.op||!E.configuration||1!==Object.keys(E.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const D=E.configuration.event.value[0];if("number"!==typeof D)throw new Error("Event id should be a number");const S=N.arrays.events[D],u=L[0];return u.config||(u.config={}),u.config.eventId=S.eventId,u.config.eventData=S.eventData,L}},"math/e":rg("FlowGraphEBlock"),"math/pi":rg("FlowGraphPIBlock"),"math/inf":rg("FlowGraphInfBlock"),"math/nan":rg("FlowGraphNaNBlock"),"math/abs":rg("FlowGraphAbsBlock"),"math/sign":rg("FlowGraphSignBlock"),"math/trunc":rg("FlowGraphTruncBlock"),"math/floor":rg("FlowGraphFloorBlock"),"math/ceil":rg("FlowGraphCeilBlock"),"math/round":{BB:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L){var D;return(D=L[0]).config||(D.config={}),L[0].config.roundHalfAwayFromZero=!0,L}},"math/fract":rg("FlowGraphFractBlock"),"math/neg":rg("FlowGraphNegationBlock"),"math/add":rg("FlowGraphAddBlock",["a","b"],!0),"math/sub":rg("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{BB:["FlowGraphMultiplyBlock"],extraProcessor(E,U,g,N,L){var D;(D=L[0]).config||(D.config={}),L[0].config.useMatrixPerComponent=!0,L[0].config.preventIntegerFloatArithmetic=!0;let S=-1;return Object.keys(E.values||{}).find((U=>{var g;return void 0!==(null===(g=E.values)||void 0===g?void 0:g[U].type)&&(S=E.values[U].type,!0)})),-1!==S&&(L[0].config.type=N.arrays.types[S].flowGraphType),L},validation:E=>E.values?jg(E):{valid:!0}},"math/div":rg("FlowGraphDivideBlock",["a","b"],!0),"math/rem":rg("FlowGraphModuloBlock",["a","b"]),"math/min":rg("FlowGraphMinBlock",["a","b"]),"math/max":rg("FlowGraphMaxBlock",["a","b"]),"math/clamp":rg("FlowGraphClampBlock",["a","b","c"]),"math/saturate":rg("FlowGraphSaturateBlock"),"math/mix":rg("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":rg("FlowGraphEqualityBlock",["a","b"]),"math/lt":rg("FlowGraphLessThanBlock",["a","b"]),"math/le":rg("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":rg("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":rg("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":rg("FlowGraphIsNaNBlock"),"math/isinf":rg("FlowGraphIsInfBlock"),"math/select":{BB:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{BB:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":rg("FlowGraphSinBlock"),"math/cos":rg("FlowGraphCosBlock"),"math/tan":rg("FlowGraphTanBlock"),"math/asin":rg("FlowGraphASinBlock"),"math/acos":rg("FlowGraphACosBlock"),"math/atan":rg("FlowGraphATanBlock"),"math/atan2":rg("FlowGraphATan2Block",["a","b"]),"math/sinh":rg("FlowGraphSinhBlock"),"math/cosh":rg("FlowGraphCoshBlock"),"math/tanh":rg("FlowGraphTanhBlock"),"math/asinh":rg("FlowGraphASinhBlock"),"math/acosh":rg("FlowGraphACoshBlock"),"math/atanh":rg("FlowGraphATanhBlock"),"math/exp":rg("FlowGraphExponentialBlock"),"math/log":rg("FlowGraphLogBlock"),"math/log2":rg("FlowGraphLog2Block"),"math/log10":rg("FlowGraphLog10Block"),"math/sqrt":rg("FlowGraphSquareRootBlock"),"math/cbrt":rg("FlowGraphCubeRootBlock"),"math/pow":rg("FlowGraphPowerBlock",["a","b"]),"math/length":rg("FlowGraphLengthBlock"),"math/normalize":rg("FlowGraphNormalizeBlock"),"math/dot":rg("FlowGraphDotBlock",["a","b"]),"math/cross":rg("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":rg("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":rg("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{BB:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{BB:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{BB:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{BB:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{BB:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{BB:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{BB:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":rg("FlowGraphTransposeBlock"),"math/determinant":rg("FlowGraphDeterminantBlock"),"math/inverse":rg("FlowGraphInvertMatrixBlock"),"math/matmul":rg("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{BB:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Iu",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L,D){const S=L[0].dataInputs.find((E=>"rotationQuaternion"===E.name));if(!S)throw new Error("Rotation quaternion input not found");return D._connectionValues[S.uniqueId]&&(D._connectionValues[S.uniqueId].type="Quaternion"),L}},"math/matDecompose":{BB:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Iu"}}}},"math/quatConjugate":rg("FlowGraphConjugateBlock",["a"]),"math/quatMul":{BB:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L){var D;return(D=L[0]).config||(D.config={}),L[0].config.type="Quaternion",L}},"math/quatAngleBetween":rg("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{BB:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":rg("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":rg("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{BB:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L){var D;return(D=L[0]).config||(D.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract2x2":{BB:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{BB:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L){var D;return(D=L[0]).config||(D.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract3x3":{BB:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{BB:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L){var D;return(D=L[0]).config||(D.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract4x4":{BB:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{BB:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L,D){var S,u;(u=L[0]).config||(u.config={});const s=L[0].dataInputs[0];return L[0].config.valueType=(null===(S=D._connectionValues[s.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",L}},"math/and":{BB:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L,D){var S,u,s;(s=L[0]).config||(s.config={});const C=L[0].dataInputs[0],B=L[0].dataInputs[1];return L[0].config.valueType=(null===(S=D._connectionValues[C.uniqueId])||void 0===S?void 0:S.type)??(null===(u=D._connectionValues[B.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",L}},"math/or":{BB:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L,D){var S,u,s;(s=L[0]).config||(s.config={});const C=L[0].dataInputs[0],B=L[0].dataInputs[1];return L[0].config.valueType=(null===(S=D._connectionValues[C.uniqueId])||void 0===S?void 0:S.type)??(null===(u=D._connectionValues[B.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",L}},"math/xor":{BB:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,U,g,N,L,D){var S,u,s;(s=L[0]).config||(s.config={});const C=L[0].dataInputs[0],B=L[0].dataInputs[1];return L[0].config.valueType=(null===(S=D._connectionValues[C.uniqueId])||void 0===S?void 0:S.type)??(null===(u=D._connectionValues[B.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",L}},"math/asr":rg("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":rg("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":rg("FlowGraphLeadingZerosBlock"),"math/ctz":rg("FlowGraphTrailingZerosBlock"),"math/popcnt":rg("FlowGraphOneBitsCounterBlock"),"math/rad":rg("FlowGraphDegToRadBlock"),"math/deg":rg("FlowGraphRadToDegBlock"),"type/boolToInt":rg("FlowGraphBooleanToInt"),"type/boolToFloat":rg("FlowGraphBooleanToFloat"),"type/intToBool":rg("FlowGraphIntToBoolean"),"type/intToFloat":rg("FlowGraphIntToFloat"),"type/floatToInt":rg("FlowGraphFloatToInt"),"type/floatToBool":rg("FlowGraphFloatToBoolean"),"flow/sequence":{BB:["FlowGraphSequenceBlock"],extraProcessor(E,U,g,N,L){const D=L[0];return D.config||(D.config={}),D.config.outputSignalCount=Object.keys(E.flows||[]).length,D.signalOutputs.forEach(((E,U)=>{E.name="out_"+U})),L}},"flow/branch":{BB:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{BB:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(E){if(E.configuration&&E.configuration.cases){const U=E.configuration.cases.value;if(!U.every((E=>"number"===typeof E&&/^-?\d+$/.test(E.toString()))))return I.d.Warn("Switch cases should be integers. Using empty array instead."),E.configuration.cases.value=[],{valid:!0};const g=new Set(U);E.configuration.cases.value=Array.from(g)}return{valid:!0}},extraProcessor(E,U,g,N,L){if("flow/switch"!==U.op||!E.flows||0===Object.keys(E.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return L[0].signalOutputs.forEach((E=>{"default"!==E.name&&(E.name="out_"+E.name)})),L}},"flow/while":{BB:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{BB:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(E,U,g,N,L){const D=L[0];return D.config||(D.config={}),D.config.incrementIndexWhenLoopDone=!0,L}},"flow/doN":{BB:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{BB:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(E,U,g,N,L){if("flow/multiGate"!==U.op||!E.flows||0===Object.keys(E.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const D=L[0];return D.config||(D.config={}),D.config.outputSignalCount=Object.keys(E.flows).length,D.signalOutputs.forEach(((E,U)=>{E.name="out_"+U})),L}},"flow/waitAll":{BB:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(E){var U,g;return"number"!==typeof(null===(U=E.configuration)||void 0===U||null===(g=U.inputFlows)||void 0===g?void 0:g.value[0])&&(E.configuration=E.configuration||{inputFlows:{value:[0]}},E.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{BB:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{BB:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{BB:["FlowGraphCancelDelayBlock"]},"variable/get":{BB:["FlowGraphGetVariableBlock"],validation(E){var U,g;return null!==(U=E.configuration)&&void 0!==U&&null!==(g=U.variable)&&void 0!==g&&g.value?{valid:!0}:(I.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(E,U)=>[U.getVariableName(E[0])]}}},"variable/set":{BB:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(E,U)=>[U.getVariableName(E[0])]}}},"variable/setMultiple":{BB:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(E,U)=>[E[0].map((E=>U.getVariableName(E)))]}},extraProcessor:(E,U,g,N,L)=>(L[0].dataInputs.forEach((E=>{E.name=N.getVariableName(+E.name)})),L)},"variable/interpolate":{BB:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(E,U)=>[U.getVariableName(E[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:E=>!0===E[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",og:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",og:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",og:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",og:"FlowGraphPlayAnimationBlock"},out:{name:"out",og:"FlowGraphPlayAnimationBlock"},done:{name:"done",og:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(E,U,g,N,L){var D,S,u;const s=L[0],C=null===(D=E.configuration)||void 0===D?void 0:D.variable.value[0];if("number"!==typeof C)throw I.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const B=N.arrays.staticVariables[C];"undefined"===typeof s.config.animationType.value&&(N.arrays.staticVariables,s.config.animationType.value=(0,eg.I)(B.type));const P=L[4];return P.config||(P.config={}),(S=P.config).variable||(S.variable={}),P.config.variable.value=N.getVariableName(C),(u=L[3]).config||(u.config={}),L}},"pointer/get":{BB:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",og:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",og:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,U,g,N,L)=>(L.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className&&(E.config||(E.config={}),E.config.outputValue=!0)})),L)},"pointer/set":{BB:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",og:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",og:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,U,g,N,L)=>(L.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className&&(E.config||(E.config={}),E.config.outputValue=!0)})),L)},"pointer/interpolate":{BB:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",og:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",og:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",og:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",og:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",og:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",og:"FlowGraphPlayAnimationBlock"},out:{name:"out",og:"FlowGraphPlayAnimationBlock"},done:{name:"done",og:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,U,g,N,L)=>(L.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className?(U.config||(U.config={}),U.config.outputValue=!0):"FlowGraphInterpolationBlock"===U.className&&(U.config||(U.config={}),Object.keys(E.values||[]).forEach((g=>{var L;const D=null===(L=E.values)||void 0===L?void 0:L[g];if("value"===g&&D){const E=D.type;void 0!==E&&(U.config.animationType=N.arrays.types[E].flowGraphType)}})))})),L)},"animation/start":{BB:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",og:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(E,U)=>[E[0]*U._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(E,U)=>[E[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,U,g,N,L,D,S){const u=L[L.length-1];return u.config||(u.config={}),u.config.glTF=S,L}},"animation/stop":{BB:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",og:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,U,g,N,L,D,S){const u=L[L.length-1];return u.config||(u.config={}),u.config.glTF=S,L}},"animation/stopAt":{BB:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",og:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(E,U)=>[E[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,U,g,N,L,D,S){const u=L[L.length-1];return u.config||(u.config={}),u.config.glTF=S,L}},"math/switch":{BB:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(E){if(E.configuration&&E.configuration.cases){const U=E.configuration.cases.value;if(!U.every((E=>"number"===typeof E&&/^-?\d+$/.test(E.toString()))))return I.d.Warn("Switch cases should be integers. Using empty array instead."),E.configuration.cases.value=[],{valid:!0};const g=new Set(U);E.configuration.cases.value=Array.from(g)}return{valid:!0}},extraProcessor(E,U,g,N,L){const D=L[0];return D.dataInputs.forEach((E=>{"default"!==E.name&&"case"!==E.name&&(E.name="in_"+E.name)})),D.config||(D.config={}),D.config.treatCasesAsIntegers=!0,L}},"debug/log":{BB:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function rg(E){let U=arguments.length>2?arguments[2]:void 0;return{BB:[E],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((E,U)=>(E[U]={name:U},E)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(E,g,N,L,D){var S;if(U){(S=D[0]).config||(S.config={}),D[0].config.preventIntegerFloatArithmetic=!0;let U=-1;Object.keys(E.values||{}).find((g=>{var N;return void 0!==(null===(N=E.values)||void 0===N?void 0:N[g].type)&&(U=E.values[g].type,!0)})),-1!==U&&(D[0].config.type=L.arrays.types[U].flowGraphType)}return D},validation:E=>U?jg(E):{valid:!0}}}function jg(E){if(E.values){const U=Object.keys(E.values).map((U=>E.values[U].type)).filter((E=>void 0!==E));if(!U.every((E=>E===U[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}cg["math/compose"]=cg["math/matCompose"],cg["math/decompose"]=cg["math/matDecompose"];var Zg=g(12296);const Ag={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"dU",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class wg{constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=E,this._gltf=U,this._animationTargetFps=g,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const E of this._interactivityGraph.types)this._types.push(Ag[E.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const E of this._interactivityGraph.declarations){const U=Tg(E);if(!U)throw I.d.Error(["No mapping found for declaration",E]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:U,fullOperationName:E.extension?E.op+":"+E.extension:E.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const E of this._interactivityGraph.variables){const U=this._parseVariable(E);this._staticVariables.push(U)}}_parseVariable(E,U){const g=this._types[E.type];if(!g)throw I.d.Error(["No type found for variable",E]),new Error("Error parsing variables");if(E.value&&E.value.length!==g.length)throw I.d.Error(["Invalid value length for variable",E,g]),new Error("Error parsing variables");const N=E.value||[];if(!N.length)switch(g.flowGraphType){case"boolean":N.push(!1);break;case"FlowGraphInteger":N.push(0);break;case"number":N.push(NaN);break;case"Vector2":N.push(NaN,NaN);break;case"dU":N.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":N.fill(NaN,0,4);break;case"Matrix":N.fill(NaN,0,16);break;case"Matrix3D":N.fill(NaN,0,9)}return"number"===g.elementType&&"string"===typeof N[0]&&(N[0]=parseFloat(N[0])),{type:g.flowGraphType,value:U?U(N,this):N}}_parseEvents(){if(this._interactivityGraph.events)for(const E of this._interactivityGraph.events){const U={eventId:E.id||"internalEvent_"+this._internalEventsCounter++};E.values&&(U.eventData=Object.keys(E.values).map((U=>{var g;const N=null===(g=E.values)||void 0===g?void 0:g[U];if(!N)throw I.d.Error(["No value found for event key",U]),new Error("Error parsing events");const L=this._types[N.type];if(!L)throw I.d.Error(["No type found for event value",N]),new Error("Error parsing events");const D="undefined"!==typeof N.value?this._parseVariable(N):void 0;return{id:U,type:L.flowGraphType,eventData:!0,value:D}}))),this._events.push(U)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const U of this._interactivityGraph.nodes){if("number"!==typeof U.declaration)throw I.d.Error(["No declaration found for node",U]),new Error("Error parsing nodes");const g=this._mappings[U.declaration];if(!g)throw I.d.Error(["No mapping found for node",U]),new Error("Error parsing nodes");if(g.flowGraphMapping.validation){const N=g.flowGraphMapping.validation(U,this._interactivityGraph,this._gltf);var E;if(!N.valid)throw new Error(`Error validating interactivity node ${null===(E=this._interactivityGraph.declarations)||void 0===E?void 0:E[U.declaration].op} - ${N.error}`)}const N=[];for(const E of g.flowGraphMapping.BB){const L=this._getEmptyBlock(E,g.fullOperationName);this._parseNodeConfiguration(U,L,g.flowGraphMapping,E),N.push(L)}this._nodes.push({BB:N,fullOperationName:g.fullOperationName})}}_getEmptyBlock(E,U){return{uniqueId:(0,Zg.e)(),className:E,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:U,metadata:{}}}_parseNodeConfiguration(E,U,g,N){const L=U.config;if(E.configuration){const U=Object.keys(E.configuration);for(const u of U){var D,S;const U=null===(D=E.configuration)||void 0===D?void 0:D[u];if(!U)throw I.d.Error(["No value found for node configuration",u]),new Error("Error parsing node configuration");const s=null===(S=g.configuration)||void 0===S?void 0:S[u];if(s&&s.og?s.og===N:0===g.BB.indexOf(N)){const E=(null===s||void 0===s?void 0:s.name)||u;U&&"undefined"!==typeof U.value||"undefined"===typeof(null===s||void 0===s?void 0:s.defaultValue)?U.value.length>=0?L[E]={value:1===U.value.length?U.value[0]:U.value}:I.d.Warn(["Invalid value for node configuration",U]):L[E]={value:s.defaultValue},s&&s.dataTransformer&&(L[E].value=s.dataTransformer([L[E].value],this)[0])}}}}_parseNodeConnections(E){for(let Y=0;Y<this._nodes.length;Y++){var U;const t=null===(U=this._interactivityGraph.nodes)||void 0===U?void 0:U[Y];if(!t)throw I.d.Error(["No node found for interactivity node",this._nodes[Y]]),new Error("Error parsing node connections");const G=this._nodes[Y],b=this._mappings[t.declaration];if(!b)throw I.d.Error(["No mapping found for node",t]),new Error("Error parsing node connections");const T=t.flows||{},v=Object.keys(T).sort();for(const E of v){var g,N,L,D;const U=T[E],C=null===(g=b.flowGraphMapping.outputs)||void 0===g||null===(N=g.flows)||void 0===N?void 0:N[E],B=(null===C||void 0===C?void 0:C.name)||E,P=this._createNewSocketConnection(B,!0);(C&&C.og&&G.BB.find((E=>E.className===C.og))||G.BB[0]).signalOutputs.push(P);const F=U.node,f=this._nodes[F];if(!f)throw I.d.Error(["No node found for input node id",F]),new Error("Error parsing node connections");const d=bg(f.fullOperationName);if(!d)throw I.d.Error(["No mapping found for input node",f]),new Error("Error parsing node connections");let y=null===(L=d.inputs)||void 0===L||null===(D=L.flows)||void 0===D?void 0:D[U.socket||"in"],h=!1;if(!y)for(const E in null===(S=d.inputs)||void 0===S?void 0:S.flows){var S,u,s;if(E.startsWith("[")&&E.endsWith("]"))h=!0,y=null===(u=d.inputs)||void 0===u||null===(s=u.flows)||void 0===s?void 0:s[E]}const V=y?h?y.name.replace("$1",U.socket||""):y.name:U.socket||"in",e=y&&y.og&&f.BB.find((E=>E.className===y.og))||f.BB[0];let x=e.signalInputs.find((E=>E.name===V));x||(x=this._createNewSocketConnection(V),e.signalInputs.push(x)),x.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(x.uniqueId)}const o=t.values||{},c=Object.keys(o);for(const U of c){var C,B;const g=o[U];let N=null===(C=b.flowGraphMapping.inputs)||void 0===C||null===(B=C.values)||void 0===B?void 0:B[U],L=!1;if(!N)for(const E in null===(P=b.flowGraphMapping.inputs)||void 0===P?void 0:P.values){var P,F,f;if(E.startsWith("[")&&E.endsWith("]"))L=!0,N=null===(F=b.flowGraphMapping.inputs)||void 0===F||null===(f=F.values)||void 0===f?void 0:f[E]}const D=N?L?N.name.replace("$1",U):N.name:U,S=this._createNewSocketConnection(D);if((N&&N.og&&G.BB.find((E=>E.className===N.og))||G.BB[0]).dataInputs.push(S),void 0!==g.value){const U=this._parseVariable(g,N&&N.dataTransformer);E._connectionValues[S.uniqueId]=U}else{if("undefined"===typeof g.node)throw I.d.Error(["Invalid value for value connection",g]),new Error("Error parsing node connections");{var d,y,h;const E=g.node,U=g.socket||"value",N=this._nodes[E];if(!N)throw I.d.Error(["No node found for output socket reference",g]),new Error("Error parsing node connections");const L=bg(N.fullOperationName);if(!L)throw I.d.Error(["No mapping found for output socket reference",g]),new Error("Error parsing node connections");let D=null===(d=L.outputs)||void 0===d||null===(y=d.values)||void 0===y?void 0:y[U],u=!1;if(!D)for(const g in null===(V=L.outputs)||void 0===V?void 0:V.values){var V,e,x;if(g.startsWith("[")&&g.endsWith("]"))u=!0,D=null===(e=L.outputs)||void 0===e||null===(x=e.values)||void 0===x?void 0:x[g]}const s=D?u?D.name.replace("$1",U):null===(h=D)||void 0===h?void 0:h.name:U,C=D&&D.og&&N.BB.find((E=>E.className===D.og))||N.BB[0];let B=C.dataOutputs.find((E=>E.name===s));B||(B=this._createNewSocketConnection(s,!0),C.dataOutputs.push(B)),S.connectedPointIds.push(B.uniqueId),B.connectedPointIds.push(S.uniqueId)}}}if(b.flowGraphMapping.interBlockConnectors)for(const E of b.flowGraphMapping.interBlockConnectors){const U=E.input,g=E.output,N=E.isVariable;this._connectFlowGraphNodes(U,g,G.BB[E.inputBlockIndex],G.BB[E.outputBlockIndex],N)}if(b.flowGraphMapping.extraProcessor){var l;const U=null===(l=this._interactivityGraph.declarations)||void 0===l?void 0:l[t.declaration];if(!U)throw I.d.Error(["No declaration found for extra processor",t]),new Error("Error parsing node connections");G.BB=b.flowGraphMapping.extraProcessor(t,U,b.flowGraphMapping,this,G.BB,E,this._gltf)}}}_createNewSocketConnection(E,U){return{uniqueId:(0,Zg.e)(),name:E,_connectionType:U?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(E,U,g,N,L){const D=L?g.dataInputs:g.signalInputs,S=L?N.dataOutputs:N.signalOutputs,u=D.find((U=>U.name===E))||this._createNewSocketConnection(E),s=S.find((E=>E.name===U))||this._createNewSocketConnection(U,!0);D.find((U=>U.name===E))||D.push(u),S.find((E=>E.name===U))||S.push(s),u.connectedPointIds.push(s.uniqueId),s.connectedPointIds.push(u.uniqueId)}getVariableName(E){return"staticVariable_"+E}serializeToFlowGraph(){const E={uniqueId:(0,Zg.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(E);for(let U=0;U<this._staticVariables.length;U++){const g=this._staticVariables[U];E._userVariables[this.getVariableName(U)]=g}return{rightHanded:!0,allBlocks:this._nodes.reduce(((E,U)=>E.concat(U.BB)),[]),executionContexts:[E]}}}const ag="KHR_interactivity";class Jg{constructor(E){this._loader=E,this.name=ag,this.enabled=this._loader.isExtensionUsed(ag),this._pathConverter=(0,q.j)(this._loader.Zg),E._skipStartAnimationStep=!0;const U=E.babylonScene;U&&function(E){(0,q.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!E.activeCamera)return new L.Quaternion(NaN,NaN,NaN,NaN);const U=L.Quaternion.FromRotationMatrix(E.activeCamera.getWorldMatrix()).normalize();return E.useRightHandedSystem||(U.w*=-1,U.x*=-1),U},type:"Quaternion",getTarget:()=>E.activeCamera}),(0,q.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!E.activeCamera)return new L.dU(NaN,NaN,NaN);const U=E.activeCamera.getWorldMatrix().getTranslation();return E.useRightHandedSystem||(U.x*=-1),U},type:"dU",getTarget:()=>E.activeCamera}),(0,q.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:E=>{var U;return(null===(U=E._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)??!1},type:"boolean",getTarget:E=>E._babylonAnimationGroup}),(0,q.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:E=>{var U;return((null===(U=E._babylonAnimationGroup)||void 0===U?void 0:U.from)??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,q.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:E=>{var U;return((null===(U=E._babylonAnimationGroup)||void 0===U?void 0:U.to)??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,q.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:E=>{var U;return((null===(U=E._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,q.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:E=>{var U;return((null===(U=E._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup})}(U)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var E;if(!this._loader.babylonScene||!this._pathConverter)return;const U=this._loader.babylonScene,g=null===(E=this._loader.Zg.extensions)||void 0===E?void 0:E.KHR_interactivity;if(!g)return;const N=new dg.d({yU:U});N.dispatchEventsSynchronously=!1;const L=g.graphs.map((E=>new wg(E,this._loader.Zg,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(L.map((async E=>await Yg(E,{coordinator:N,pathConverter:this._pathConverter})))),N.start()}}var qg;qg=async()=>(await Promise.resolve().then(g.bind(g,14108))).FlowGraphGLTFDataProvider,Ig[`${ag}/${"FlowGraphGLTFDataProvider"}`]=qg,J(ag),a(ag,!0,(E=>new Jg(E)));const Mg="KHR_node_visibility";(0,q.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:E=>{const U=E._babylonTransformNode;return!U||void 0===U.isVisible||U.isVisible},set:(E,U)=>{var g,N;null===(g=U._primitiveBabylonMeshes)||void 0===g||g.forEach((E=>{E.inheritVisibility=!0})),U._babylonTransformNode&&(U._babylonTransformNode.isVisible=E),null===(N=U._primitiveBabylonMeshes)||void 0===N||N.forEach((U=>{U.isVisible=E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class mN{constructor(E){this.name=Mg,this._loader=E,this.enabled=E.isExtensionUsed(Mg)}async onReady(){var E;null===(E=this._loader.Zg.nodes)||void 0===E||E.forEach((E=>{var U,g,N,L;(null===(U=E._primitiveBabylonMeshes)||void 0===U||U.forEach((E=>{E.inheritVisibility=!0})),null!==(g=E.extensions)&&void 0!==g&&g.KHR_node_visibility)&&(!1===(null===(N=E.extensions)||void 0===N?void 0:N.KHR_node_visibility.visible)&&(E._babylonTransformNode&&(E._babylonTransformNode.isVisible=!1),null===(L=E._primitiveBabylonMeshes)||void 0===L||L.forEach((E=>{E.isVisible=!1}))))}))}dispose(){this._loader=null}}J(Mg),a(Mg,!0,(E=>new mN(E)));const Wg="KHR_node_selectability";vg("event/onSelect",Wg,{BB:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",og:"FlowGraphGetVariableBlock",dataTransformer:E=>["pickedMesh_"+E[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",og:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,U,g,N,L,D,S){var u,s,C,B,P,F;const f=L[L.length-1];f.config=f.config||{},f.config.glTF=S;const d=null===(u=E.configuration)||void 0===u||null===(s=u.nodeIndex)||void 0===s?void 0:s.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const I="pickedMesh_"+d;return L[1].config.variable=I,D._userVariables[I]={className:"Mesh",id:null===S||void 0===S||null===(C=S.nodes)||void 0===C||null===(B=C[d]._babylonTransformNode)||void 0===B?void 0:B.id,uniqueId:null===S||void 0===S||null===(P=S.nodes)||void 0===P||null===(F=P[d]._babylonTransformNode)||void 0===F?void 0:F.uniqueId},L}}),(0,q.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:E=>{const U=E._babylonTransformNode;return!U||void 0===U.Zs||U.Zs},set:(E,U)=>{var g;null===(g=U._primitiveBabylonMeshes)||void 0===g||g.forEach((U=>{U.Zs=E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"Zs"],type:"boolean"});class Og{constructor(E){this.name=Wg,this._loader=E,this.enabled=E.isExtensionUsed(Wg)}async onReady(){var E;null===(E=this._loader.Zg.nodes)||void 0===E||E.forEach((E=>{var U,g,N;null!==(U=E.extensions)&&void 0!==U&&U.KHR_node_selectability&&!1===(null===(g=E.extensions)||void 0===g?void 0:g.KHR_node_selectability.selectable)&&(null===(N=E._babylonTransformNode)||void 0===N||N.getChildMeshes().forEach((E=>{E.Zs=!1})))}))}dispose(){this._loader=null}}J(Wg),a(Wg,!0,(E=>new Og(E)));const Qg="KHR_node_hoverability",Rg="targetMeshPointerOver_";vg("event/onHoverIn",Qg,{BB:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",og:"FlowGraphGetVariableBlock",dataTransformer:E=>[Rg+E[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",og:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,U,g,N,L,D,S){var u,s,C,B,P,F;const f=L[L.length-1];f.config=f.config||{},f.config.glTF=S;const d=null===(u=E.configuration)||void 0===u||null===(s=u.nodeIndex)||void 0===s?void 0:s.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const I=Rg+d;return L[1].config.variable=I,D._userVariables[I]={className:"Mesh",id:null===S||void 0===S||null===(C=S.nodes)||void 0===C||null===(B=C[d]._babylonTransformNode)||void 0===B?void 0:B.id,uniqueId:null===S||void 0===S||null===(P=S.nodes)||void 0===P||null===(F=P[d]._babylonTransformNode)||void 0===F?void 0:F.uniqueId},L}});const ng="targetMeshPointerOut_";vg("event/onHoverOut",Qg,{BB:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",og:"FlowGraphGetVariableBlock",dataTransformer:E=>[ng+E[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",og:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,U,g,N,L,D,S){var u,s,C,B,P,F;const f=L[L.length-1];f.config=f.config||{},f.config.glTF=S;const d=null===(u=E.configuration)||void 0===u||null===(s=u.nodeIndex)||void 0===s?void 0:s.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const I=ng+d;return L[1].config.variable=I,D._userVariables[I]={className:"Mesh",id:null===S||void 0===S||null===(C=S.nodes)||void 0===C||null===(B=C[d]._babylonTransformNode)||void 0===B?void 0:B.id,uniqueId:null===S||void 0===S||null===(P=S.nodes)||void 0===P||null===(F=P[d]._babylonTransformNode)||void 0===F?void 0:F.uniqueId},L}}),(0,q.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:E=>{const U=E._babylonTransformNode;return!U||void 0===U.pointerOverDisableMeshTesting||U.pointerOverDisableMeshTesting},set:(E,U)=>{var g;null===(g=U._primitiveBabylonMeshes)||void 0===g||g.forEach((U=>{U.pointerOverDisableMeshTesting=!E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class kg{constructor(E){this.name=Qg,this._loader=E,this.enabled=E.isExtensionUsed(Qg)}async onReady(){var E;null===(E=this._loader.Zg.nodes)||void 0===E||E.forEach((E=>{var U,g,N;null!==(U=E.extensions)&&void 0!==U&&U.KHR_node_hoverability&&!1===(null===(g=E.extensions)||void 0===g?void 0:g.KHR_node_hoverability.hoverable)&&(null===(N=E._babylonTransformNode)||void 0===N||N.getChildMeshes().forEach((E=>{E.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}J(Qg),a(Qg,!0,(E=>new kg(E)));const zg="ExtrasAsMetadata";class ig{_assignExtras(E,U){if(U.extras&&Object.keys(U.extras).length>0){const g=E.metadata=E.metadata||{};(g.Zg=g.Zg||{}).extras=U.extras}}constructor(E){this.name=zg,this.enabled=!0,this._loader=E}dispose(){this._loader=null}loadNodeAsync(E,U,g){return this._loader.loadNodeAsync(E,U,(E=>{this._assignExtras(E,U),g(E)}))}loadCameraAsync(E,U,g){return this._loader.loadCameraAsync(E,U,(E=>{this._assignExtras(E,U),g(E)}))}createMaterial(E,U,g){const N=this._loader.createMaterial(E,U,g);return this._assignExtras(N,U),N}}J(zg),a(zg,!1,(E=>new ig(E)));g(14108)},13981:(E,U,g)=>{"use strict";g.d(U,{d:()=>j,e:()=>b,f:()=>G,h:()=>T});var N=g(12174),L=g(12165),D=g(13612),S=g(12774),u=g(12750),s=g(12760),C=g(12186),B=g(12205),P=g(12771),F=g(12874),f=g(12781),d=g(12370);class I{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.RP=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.GF=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(E){this._environmentTexture=E}getNodes(){let E=[];E=E.concat(this.meshes),E=E.concat(this.lights),E=E.concat(this.cameras),E=E.concat(this.transformNodes);for(const U of this.skeletons)E=E.concat(U.bones);return E}}class y extends I{}class h{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const E=this.rootNodes;for(const N of E)N.dispose();E.length=0;const U=this.skeletons;for(const N of U)N.dispose();U.length=0;const g=this.animationGroups;for(const N of g)N.dispose();g.length=0}}class V extends I{constructor(E){super(),this._wasAddedToScene=!1,(E=E||B.b.LastCreatedScene)&&(this.yU=E,this.proceduralTextures=[],E.hg.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=E.getEngine().onContextRestoredObservable.add((()=>{for(const E of this.geometries)E._rebuild();for(const E of this.meshes)E._rebuild();for(const E of this.RP)E.rebuild();for(const E of this.textures)E._rebuild()})))}_topologicalSort(E){const U=new Map;for(const S of E)U.set(S.uniqueId,S);const g={dependsOn:new Map,dependedBy:new Map};for(const S of E){const E=S.uniqueId;g.dependsOn.set(E,new Set),g.dependedBy.set(E,new Set)}for(const S of E){const E=S.uniqueId,N=g.dependsOn.get(E);if(S instanceof P.b){const L=S.sourceMesh;U.has(L.uniqueId)&&(N.add(L.uniqueId),g.dependedBy.get(L.uniqueId).add(E))}const L=g.dependedBy.get(E);for(const D of S.getDescendants()){const N=D.uniqueId;if(U.has(N)){L.add(N);g.dependsOn.get(N).add(E)}}}const N=[],L=[];for(const S of E){const E=S.uniqueId;0===g.dependsOn.get(E).size&&(L.push(S),U.delete(E))}const D=L;for(;D.length>0;){const E=D.shift();N.push(E);const L=g.dependedBy.get(E.uniqueId);for(const N of Array.from(L.values())){const L=g.dependsOn.get(N);L.delete(E.uniqueId),0===L.size&&U.get(N)&&(D.push(U.get(N)),U.delete(N))}}return U.size>0&&(C.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),U.forEach((E=>{C.d.Error(E.name)}))),N}_addNodeAndDescendantsToList(E,U,g,N){if(g&&(!N||N(g))&&!U.has(g.uniqueId)){E.push(g),U.add(g.uniqueId);for(const L of g.getDescendants(!0))this._addNodeAndDescendantsToList(E,U,L,N)}}_isNodeInContainer(E){return E instanceof s.b&&-1!==this.meshes.indexOf(E)||(E instanceof u.c&&-1!==this.transformNodes.indexOf(E)||(E instanceof F.c&&-1!==this.lights.indexOf(E)||E instanceof f.d&&-1!==this.cameras.indexOf(E)))}_isValidHierarchy(){for(const E of this.meshes)if(E.parent&&!this._isNodeInContainer(E.parent))return C.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.transformNodes)if(E.parent&&!this._isNodeInContainer(E.parent))return C.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.lights)if(E.parent&&!this._isNodeInContainer(E.parent))return C.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.cameras)if(E.parent&&!this._isNodeInContainer(E.parent))return C.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const N={},D={},u=new h,s=[],C=[],B={doNotInstantiate:!0,...g},P=[],F=new Set;for(const L of this.transformNodes)null===L.parent&&this._addNodeAndDescendantsToList(P,F,L,B.predicate);for(const L of this.meshes)null===L.parent&&this._addNodeAndDescendantsToList(P,F,L,B.predicate);const f=this._topologicalSort(P),d=(g,L)=>{if(((U,g)=>{if(N[U.uniqueId]=g.uniqueId,D[g.uniqueId]=g,E&&(g.name=E(U.name)),g instanceof S.e){const E=g;if(E.morphTargetManager){const g=U.morphTargetManager;E.morphTargetManager=g.clone();for(let U=0;U<g.numTargets;U++){const L=g.getTarget(U),S=E.morphTargetManager.getTarget(U);N[L.uniqueId]=S.uniqueId,D[S.uniqueId]=S}}}})(g,L),g.parent){const E=N[g.parent.uniqueId],U=D[E];L.parent=U||g.parent}if(L.position&&g.position&&L.position.D(g.position),L.rotationQuaternion&&g.rotationQuaternion&&L.rotationQuaternion.D(g.rotationQuaternion),L.rotation&&g.rotation&&L.rotation.D(g.rotation),L.Iu&&g.Iu&&L.Iu.D(g.Iu),L.material){const S=L;if(S.material)if(U){const U=g.material;if(-1===C.indexOf(U)){let g=U.clone(E?E(U.name):"Clone of "+U.name);if(C.push(U),N[U.uniqueId]=g.uniqueId,D[g.uniqueId]=g,"MultiMaterial"===U.getClassName()){const L=U;for(const U of L.Vu)U&&(g=U.clone(E?E(U.name):"Clone of "+U.name),C.push(U),N[U.uniqueId]=g.uniqueId,D[g.uniqueId]=g);L.Vu=L.Vu.map((E=>E&&D[N[E.uniqueId]]))}}"InstancedMesh"!==S.getClassName()&&(S.material=D[N[U.uniqueId]])}else"MultiMaterial"===S.material.getClassName()?-1===this.yU.multiMaterials.indexOf(S.material)&&this.yU.addMultiMaterial(S.material):-1===this.yU.materials.indexOf(S.material)&&this.yU.addMaterial(S.material)}null===L.parent&&u.rootNodes.push(L)};for(const L of f)if("InstancedMesh"===L.getClassName()){const E=L,U=E.sourceMesh,g=N[U.uniqueId];d(E,("number"===typeof g?D[g]:U).createInstance(E.name))}else{let E=!0;"Df"===L.getClassName()||"Node"===L.getClassName()||L.skeleton||!L.getTotalVertices||0===L.getTotalVertices()?E=!1:B.doNotInstantiate&&(E="function"===typeof B.doNotInstantiate?!B.doNotInstantiate(L):!B.doNotInstantiate);const U=E?L.createInstance(`instance of ${L.name}`):L.clone(`Clone of ${L.name}`,null,!0);if(!U)throw new Error(`Could not clone or instantiate node on Asset Container ${L.name}`);d(L,U)}for(const L of this.skeletons){if(B.predicate&&!B.predicate(L))continue;const U=L.clone(E?E(L.name):"Clone of "+L.name);for(const E of this.meshes)if(E.skeleton===L&&!E.isAnInstance){const g=D[N[E.uniqueId]];if(!g||g.isAnInstance)continue;if(g.skeleton=U,-1!==s.indexOf(U))continue;s.push(U);for(const E of U.bones)E._linkedTransformNode&&(E._linkedTransformNode=D[N[E._linkedTransformNode.uniqueId]])}u.skeletons.push(U)}for(const L of this.animationGroups){if(B.predicate&&!B.predicate(L))continue;const U=L.clone(E?E(L.name):"Clone of "+L.name,(E=>D[N[E.uniqueId]]||E));u.animationGroups.push(U)}return u}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.yU.environmentTexture=this.environmentTexture);for(const E of this.yU._serializableComponents)E.addFromContainer(this);this.yU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=[];for(const g of this.cameras)E&&!E(g)||(this.yU.addCamera(g),U.push(g));for(const g of this.lights)E&&!E(g)||(this.yU.addLight(g),U.push(g));for(const g of this.meshes)E&&!E(g)||(this.yU.KC(g),U.push(g));for(const g of this.skeletons)E&&!E(g)||this.yU.addSkeleton(g);for(const g of this.animations)E&&!E(g)||this.yU.addAnimation(g);for(const g of this.animationGroups)E&&!E(g)||this.yU.addAnimationGroup(g);for(const g of this.multiMaterials)E&&!E(g)||this.yU.addMultiMaterial(g);for(const g of this.materials)E&&!E(g)||this.yU.addMaterial(g);for(const g of this.morphTargetManagers)E&&!E(g)||this.yU.addMorphTargetManager(g);for(const g of this.geometries)E&&!E(g)||this.yU.addGeometry(g);for(const g of this.transformNodes)E&&!E(g)||(this.yU.addTransformNode(g),U.push(g));for(const g of this.actionManagers)E&&!E(g)||this.yU.addActionManager(g);for(const g of this.textures)E&&!E(g)||this.yU.addTexture(g);for(const g of this.reflectionProbes)E&&!E(g)||this.yU.addReflectionProbe(g);for(const g of U)g.parent&&-1===this.yU.getNodes().indexOf(g.parent)&&(g.setParent?g.setParent(null):g.parent=null)}removeAllFromScene(){this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.yU.environmentTexture&&(this.yU.environmentTexture=null);for(const E of this.yU._serializableComponents)E.removeFromContainer(this)}removeFromScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const U of this.cameras)E&&!E(U)||this.yU.removeCamera(U);for(const U of this.lights)E&&!E(U)||this.yU.removeLight(U);for(const U of this.meshes)E&&!E(U)||this.yU.HC(U,!0);for(const U of this.skeletons)E&&!E(U)||this.yU.removeSkeleton(U);for(const U of this.animations)E&&!E(U)||this.yU.removeAnimation(U);for(const U of this.animationGroups)E&&!E(U)||this.yU.removeAnimationGroup(U);for(const U of this.multiMaterials)E&&!E(U)||this.yU.removeMultiMaterial(U);for(const U of this.materials)E&&!E(U)||this.yU.removeMaterial(U);for(const U of this.morphTargetManagers)E&&!E(U)||this.yU.removeMorphTargetManager(U);for(const U of this.geometries)E&&!E(U)||this.yU.removeGeometry(U);for(const U of this.transformNodes)E&&!E(U)||this.yU.removeTransformNode(U);for(const U of this.actionManagers)E&&!E(U)||this.yU.removeActionManager(U);for(const U of this.textures)E&&!E(U)||this.yU.removeTexture(U);for(const U of this.reflectionProbes)E&&!E(U)||this.yU.removeReflectionProbe(U)}dispose(){const E=this.cameras.slice(0);for(const f of E)f.dispose();this.cameras.length=0;const U=this.lights.slice(0);for(const f of U)f.dispose();this.lights.length=0;const g=this.meshes.slice(0);for(const f of g)f.dispose();this.meshes.length=0;const N=this.skeletons.slice(0);for(const f of N)f.dispose();this.skeletons.length=0;const L=this.animationGroups.slice(0);for(const f of L)f.dispose();this.animationGroups.length=0;const D=this.multiMaterials.slice(0);for(const f of D)f.dispose();this.multiMaterials.length=0;const S=this.materials.slice(0);for(const f of S)f.dispose();this.materials.length=0;const u=this.geometries.slice(0);for(const f of u)f.dispose();this.geometries.length=0;const s=this.transformNodes.slice(0);for(const f of s)f.dispose();this.transformNodes.length=0;const C=this.actionManagers.slice(0);for(const f of C)f.dispose();this.actionManagers.length=0;const B=this.textures.slice(0);for(const f of B)f.dispose();this.textures.length=0;const P=this.reflectionProbes.slice(0);for(const f of P)f.dispose();this.reflectionProbes.length=0;const F=this.morphTargetManagers.slice(0);for(const f of F)f.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const f of this.yU._serializableComponents)f.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.yU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(E,U,g){if(E&&U)for(const N of E){let E=!0;if(g)for(const U of g)if(N===U){E=!1;break}E&&(U.push(N),N._parentContainer=this)}}moveAllFromScene(E){this._wasAddedToScene=!1,void 0===E&&(E=new y);for(const U in this)Object.prototype.hasOwnProperty.call(this,U)&&(this[U]=this[U]||("_environmentTexture"===U?null:[]),this._moveAssets(this.yU[U],this[U],E[U]));this.environmentTexture=this.yU.environmentTexture,this.removeAllFromScene()}createRootMesh(){const E=new S.e("assetContainerRootMesh",this.yU);for(const U of this.meshes)U.parent||E.addChild(U);return this.meshes.unshift(E),E}mergeAnimationsTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.b.LastCreatedScene,U=arguments.length>1?arguments[1]:void 0,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!E)return C.d.Error("No scene available to merge animations to"),[];const N=g||(U=>{let g=null;const N=U.animations.length?U.animations[0].targetProperty:"",L=U.name.split(".").join("").split("_primitive")[0];switch(N){case"position":case"rotationQuaternion":g=E.getTransformNodeByName(U.name)||E.getTransformNodeByName(L);break;case"influence":g=E.getMorphTargetByName(U.name)||E.getMorphTargetByName(L);break;default:g=E.getNodeByName(U.name)||E.getNodeByName(L)}return g}),L=this.getNodes();for(const u of L){const E=N(u);if(null!==E){for(const U of u.animations){const g=E.animations.filter((E=>E.targetProperty===U.targetProperty));for(const U of g){const g=E.animations.indexOf(U,0);g>-1&&E.animations.splice(g,1)}}E.animations=E.animations.concat(u.animations)}}const D=[],S=this.animationGroups.slice();for(const u of S){D.push(u.clone(u.name,N));for(const E of u.animatables)E.stop()}for(const u of U){const U=N(u.target);U&&(E.beginAnimation(U,u.fromFrame,u.toFrame,u.loopAnimation,u.speedRatio,u.onAnimationEnd?u.onAnimationEnd:void 0,void 0,!0,void 0,u.onAnimationLoop?u.onAnimationLoop:void 0),E.stopAnimation(u.target))}return D}populateRootNodes(){this.rootNodes.length=0;for(const E of this.meshes)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.transformNodes)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.lights)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.cameras)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)}addAllAssetsToContainer(E){if(!E)return;const U=[],g=new Set;for(U.push(E);U.length>0;){const E=U.pop();if(E instanceof S.e?(E.XL&&-1===this.geometries.indexOf(E.XL)&&this.geometries.push(E.XL),this.meshes.push(E)):E instanceof P.b?this.meshes.push(E):E instanceof u.c?this.transformNodes.push(E):E instanceof F.c?this.lights.push(E):E instanceof f.d&&this.cameras.push(E),E instanceof s.b){if(E.material&&-1===this.materials.indexOf(E.material)){this.materials.push(E.material);for(const U of E.material.getActiveTextures())-1===this.textures.indexOf(U)&&this.textures.push(U)}E.skeleton&&-1===this.skeletons.indexOf(E.skeleton)&&this.skeletons.push(E.skeleton),E.morphTargetManager&&-1===this.morphTargetManagers.indexOf(E.morphTargetManager)&&this.morphTargetManagers.push(E.morphTargetManager)}for(const N of E.getChildren())g.has(N)||U.push(N);g.add(E)}this.populateRootNodes()}_getByTags(E,U,g){if(void 0===U)return E;const N=[];for(const L in E){const D=E[L];d.c&&d.c.MatchesQuery(D,U)&&(!g||g(D))&&N.push(D)}return N}getMeshesByTags(E,U){return this._getByTags(this.meshes,E,U)}getCamerasByTags(E,U){return this._getByTags(this.cameras,E,U)}getLightsByTags(E,U){return this._getByTags(this.lights,E,U)}getMaterialsByTags(E,U){return this._getByTags(this.materials,E,U).concat(this._getByTags(this.multiMaterials,E,U))}getTransformNodesByTags(E,U){return this._getByTags(this.transformNodes,E,U)}}var e=g(12221);class x{constructor(E){this.byteOffset=0,this.buffer=E}async loadAsync(E){const U=await this.buffer.readAsync(this.byteOffset,E);this._dataView=new DataView(U.buffer,U.byteOffset,U.byteLength),this._dataByteOffset=0}readUint32(){const E=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,E}readUint8Array(E){const U=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,E);return this._dataByteOffset+=E,this.byteOffset+=E,U}readString(E){return(0,e.h)(this.readUint8Array(E))}skipBytes(E){this._dataByteOffset+=E,this.byteOffset+=E}}var l=g(13983);const Y="Z2xURg",t={name:"Zg",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:E=>-1!==E.indexOf("asset")&&-1!==E.indexOf("version")||E.startsWith("data:base64,"+Y)||E.startsWith("data:;base64,"+Y)||E.startsWith("data:application/octet-stream;base64,"+Y)||E.startsWith("data:model/gltf-binary;base64,"+Y)};var G,b,T,v=g(12210),o=g(12212);function c(E,U,g){try{return Promise.resolve(new Uint8Array(E,U,g))}catch(N){return Promise.reject(N)}}!function(E){E[E.AUTO=0]="AUTO",E[E.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(G||(G={})),function(E){E[E.NONE=0]="NONE",E[E.FIRST=1]="FIRST",E[E.ALL=2]="ALL"}(b||(b={})),function(E){E[E.LOADING=0]="LOADING",E[E.READY=1]="READY",E[E.COMPLETE=2]="COMPLETE"}(T||(T={}));class r{constructor(){this.coordinateSystemMode=G.AUTO,this.animationStartMode=b.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=E=>Promise.resolve(E),this.extensionOptions={}}D(E){E&&(this.onParsed=E.onParsed,this.coordinateSystemMode=E.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=E.animationStartMode??this.animationStartMode,this.loadNodeAnimations=E.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=E.loadSkins??this.loadSkins,this.loadMorphTargets=E.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=E.compileMaterials??this.compileMaterials,this.useClipPlane=E.useClipPlane??this.useClipPlane,this.compileShadowGenerators=E.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=E.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=E.useRangeRequests??this.useRangeRequests,this.createInstances=E.createInstances??this.createInstances,this.alwaysComputeBoundingBox=E.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=E.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=E.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=E.skipMaterials??this.skipMaterials,this.useSRGBBuffers=E.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=E.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=E.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=E.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=E.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=E.customRootNode,this.onMeshLoaded=E.onMeshLoaded,this.onSkinLoaded=E.onSkinLoaded,this.onTextureLoaded=E.onTextureLoaded,this.onMaterialLoaded=E.onMaterialLoaded,this.onCameraLoaded=E.onCameraLoaded,this.extensionOptions=E.extensionOptions??this.extensionOptions)}}class j extends r{constructor(E){super(),this.onParsedObservable=new N.b,this.onMeshLoadedObservable=new N.b,this.onSkinLoadedObservable=new N.b,this.onTextureLoadedObservable=new N.b,this.onMaterialLoadedObservable=new N.b,this.onCameraLoadedObservable=new N.b,this.onCompleteObservable=new N.b,this.onErrorObservable=new N.b,this.hg=new N.b,this.onExtensionLoadedObservable=new N.b,this.validate=!1,this.onValidatedObservable=new N.b,this._loader=null,this._state=null,this._requests=new Array,this.name=t.name,this.extensions=t.extensions,this.onLoaderStateChangedObservable=new N.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.D(E)}set onParsed(E){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),E&&(this._onParsedObserver=this.onParsedObservable.add(E))}set onMeshLoaded(E){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),E&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(E))}set onSkinLoaded(E){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),E&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((U=>E(U.node,U.skinnedNode))))}set onTextureLoaded(E){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),E&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(E))}set onMaterialLoaded(E){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),E&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(E))}set onCameraLoaded(E){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),E&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(E))}set onComplete(E){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(E)}set onError(E){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(E)}set onDispose(E){this._onDisposeObserver&&this.hg.remove(this._onDisposeObserver),this._onDisposeObserver=this.hg.add(E)}set onExtensionLoaded(E){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(E)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(E){this._loggingEnabled!==E&&(this._loggingEnabled=E,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(E){this._capturePerformanceCounters!==E&&(this._capturePerformanceCounters=E,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(E){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(E)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const E of this._requests)E.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=E=>Promise.resolve(E),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.hg.notifyObservers(void 0),this.hg.clear()}loadFile(E,U,g,D,S,u,s,B){if(ArrayBuffer.isView(U))return this._loadBinary(E,U,g,D,s,B),null;this._progressCallback=S;const P=U.name||L.Tools.GetFilename(U);if(u){if(this.useRangeRequests){this.validate&&C.d.Warn("glTF validation is not supported when range requests are enabled");const g={abort:()=>{},onCompleteObservable:new N.b},L={readAsync:(g,N)=>new Promise(((L,D)=>{this._loadFile(E,U,(E=>{L(new Uint8Array(E))}),!0,(E=>{D(E)}),(E=>{E.setRequestHeader("Range",`bytes=${g}-${g+N-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new x(L)).then((E=>{g.onCompleteObservable.notifyObservers(g),D(E)}),s?E=>s(void 0,E):void 0),g}return this._loadFile(E,U,(U=>{this._validate(E,new Uint8Array(U,0,U.byteLength),g,P),this._unpackBinaryAsync(new x({readAsync:(E,g)=>c(U,E,g),byteLength:U.byteLength})).then((E=>{D(E)}),s?E=>s(void 0,E):void 0)}),!0,s)}return this._loadFile(E,U,(U=>{try{this._validate(E,U,g,P),D({json:this._parseJson(U)})}catch{s&&s()}}),!1,s)}_loadBinary(E,U,g,N,L,D){this._validate(E,new Uint8Array(U.buffer,U.byteOffset,U.byteLength),g,D),this._unpackBinaryAsync(new x({readAsync:(E,g)=>function(E,U,g){try{if(U<0||U>=E.byteLength)throw new RangeError("Offset is out of range.");if(U+g>E.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(E.buffer,E.byteOffset+U,g))}catch(N){return Promise.reject(N)}}(U,E,g),byteLength:U.byteLength})).then((E=>{N(E)}),L?E=>L(void 0,E):void 0)}importMeshAsync(E,U,g,N,L,D){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(g),this.onParsedObservable.clear(),this._log(`Loading ${D||""}`),this._loader=this._getLoader(g),this._loader.importMeshAsync(E,U,null,g,N,L,D))))}loadAsync(E,U,g,N,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(U),this._loader.loadAsync(E,U,g,N,L))))}loadAssetContainerAsync(E,U,g,N,L){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(U);const D=new V(E),S=[];this.onMaterialLoadedObservable.add((E=>{S.push(E)}));const u=[];this.onTextureLoadedObservable.add((E=>{u.push(E)}));const s=[];this.onCameraLoadedObservable.add((E=>{s.push(E)}));const C=[];return this.onMeshLoadedObservable.add((E=>{E.morphTargetManager&&C.push(E.morphTargetManager)})),this._loader.importMeshAsync(null,E,D,U,g,N,L).then((E=>(Array.prototype.push.apply(D.geometries,E.geometries),Array.prototype.push.apply(D.meshes,E.meshes),Array.prototype.push.apply(D.RP,E.RP),Array.prototype.push.apply(D.skeletons,E.skeletons),Array.prototype.push.apply(D.animationGroups,E.animationGroups),Array.prototype.push.apply(D.materials,S),Array.prototype.push.apply(D.textures,u),Array.prototype.push.apply(D.lights,E.lights),Array.prototype.push.apply(D.transformNodes,E.transformNodes),Array.prototype.push.apply(D.cameras,s),Array.prototype.push.apply(D.morphTargetManagers,C),D)))}))}canDirectLoad(E){return t.canDirectLoad(E)}directLoad(E,U){if(U.startsWith("base64,"+Y)||U.startsWith(";base64,"+Y)||U.startsWith("application/octet-stream;base64,"+Y)||U.startsWith("model/gltf-binary;base64,"+Y)){const g=(0,v.b)(U);return this._validate(E,new Uint8Array(g,0,g.byteLength)),this._unpackBinaryAsync(new x({readAsync:(E,U)=>c(g,E,U),byteLength:g.byteLength}))}return this._validate(E,U),Promise.resolve({json:this._parseJson(U)})}createPlugin(E){return new j(E[t.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((E,U)=>{this.onCompleteObservable.addOnce((()=>{E()})),this.onErrorObservable.addOnce((E=>{U(E)}))}))}_setState(E){this._state!==E&&(this._state=E,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(T[this._state]))}_loadFile(E,U,g,N,L,D){const S=E._loadFile(U,g,(E=>{this._onProgress(E,S)}),!0,N,L,D);return S.onCompleteObservable.add((()=>{S._lengthComputable=!0,S._total=S._loaded})),this._requests.push(S),S}_onProgress(E,U){if(!this._progressCallback)return;U._lengthComputable=E.lengthComputable,U._loaded=E.loaded,U._total=E.total;let g=!0,N=0,L=0;for(const D of this._requests){if(void 0===D._lengthComputable||void 0===D._loaded||void 0===D._total)return;g=g&&D._lengthComputable,N+=D._loaded,L+=D._total}this._progressCallback({lengthComputable:g,loaded:N,total:g?L:0})}_validate(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),l.d.ValidateAsync(U,g,N,(U=>this.preprocessUrlAsync(g+U).then((U=>E._loadFileAsync(U,void 0,!0,!0).then((E=>new Uint8Array(E,0,E.byteLength))))))).then((E=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(E),this.onValidatedObservable.clear()}),(E=>{this._endPerformanceCounter("Validate JSON"),L.Tools.Warn(`Failed to validate: ${E.message}`),this.onValidatedObservable.clear()})))}_getLoader(E){const U=E.json.asset||{};this._log(`Asset version: ${U.version}`),U.minVersion&&this._log(`Asset minimum version: ${U.minVersion}`),U.generator&&this._log(`Asset generator: ${U.generator}`);const g=j._parseVersion(U.version);if(!g)throw new Error("Invalid version: "+U.version);if(void 0!==U.minVersion){const E=j._parseVersion(U.minVersion);if(!E)throw new Error("Invalid minimum version: "+U.minVersion);if(j._compareVersion(E,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+U.minVersion)}const N={1:j._CreateGLTF1Loader,2:j._CreateGLTF2Loader}[g.major];if(!N)throw new Error("Unsupported version: "+U.version);return N(this)}_parseJson(E){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${E.length}`);const U=JSON.parse(E);return this._endPerformanceCounter("Parse JSON"),U}_unpackBinaryAsync(E){return this._startPerformanceCounter("Unpack Binary"),E.loadAsync(20).then((()=>{const U=E.readUint32();if(1179937895!==U)throw new o.h("Unexpected magic: "+U,o.f.GLTFLoaderUnexpectedMagicError);const g=E.readUint32();this.loggingEnabled&&this._log(`Binary version: ${g}`);const N=E.readUint32();let L;switch(this.useRangeRequests||N===E.buffer.byteLength||C.d.Warn(`Length in header does not match actual data length: ${N} != ${E.buffer.byteLength}`),g){case 1:L=this._unpackBinaryV1Async(E,N);break;case 2:L=this._unpackBinaryV2Async(E,N);break;default:throw new Error("Unsupported version: "+g)}return this._endPerformanceCounter("Unpack Binary"),L}))}_unpackBinaryV1Async(E,U){const g=E.readUint32(),N=E.readUint32();if(0!==N)throw new Error(`Unexpected content format: ${N}`);const L=U-E.byteOffset,D={json:this._parseJson(E.readString(g)),bin:null};if(0!==L){const U=E.byteOffset;D.bin={readAsync:(g,N)=>E.buffer.readAsync(U+g,N),byteLength:L}}return Promise.resolve(D)}_unpackBinaryV2Async(E,U){const g=1313821514,N=5130562,L=E.readUint32();if(E.readUint32()!==g)throw new Error("First chunk format is not JSON");return E.byteOffset+L===U?E.loadAsync(L).then((()=>({json:this._parseJson(E.readString(L)),bin:null}))):E.loadAsync(L+8).then((()=>{const D={json:this._parseJson(E.readString(L)),bin:null},S=()=>{const L=E.readUint32();switch(E.readUint32()){case g:throw new Error("Unexpected JSON chunk");case N:{const U=E.byteOffset;D.bin={readAsync:(g,N)=>E.buffer.readAsync(U+g,N),byteLength:L},E.skipBytes(L);break}default:E.skipBytes(L)}return E.byteOffset!==U?E.loadAsync(8).then(S):Promise.resolve(D)};return S()}))}static _parseVersion(E){if("1.0"===E||"1.0.1"===E)return{major:1,minor:0};const U=(E+"").match(/^(\d+)\.(\d+)/);return U?{major:parseInt(U[1]),minor:parseInt(U[2])}:null}static _compareVersion(E,U){return E.major>U.major?1:E.major<U.major?-1:E.minor>U.minor?1:E.minor<U.minor?-1:0}_logOpen(E){this._log(E),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(E){const U=j._logSpaces.substring(0,2*this._logIndentLevel);C.d.Log(`${U}${E}`)}_logDisabled(E){}_startPerformanceCounterEnabled(E){L.Tools.StartPerformanceCounter(E)}_startPerformanceCounterDisabled(E){}_endPerformanceCounterEnabled(E){L.Tools.EndPerformanceCounter(E)}_endPerformanceCounterDisabled(E){}}j.IncrementalLoading=!0,j.HomogeneousCoordinates=!1,j._logSpaces="                                ",(0,D.b)(new j)},13983:(E,U,g)=>{"use strict";g.d(U,{d:()=>S});var N=g(12165);function L(E,U,g,N){const L={externalResourceFunction:N};return g&&(L.uri="file:"===U?g:U+g),ArrayBuffer.isView(E)?GLTFValidator.validateBytes(E,L):GLTFValidator.validateString(E,L)}function D(){const E=[];onmessage=U=>{const g=U.data;switch(g.id){case"init":importScripts(g.url);break;case"validate":L(g.data,g.rootUrl,g.fileName,(U=>new Promise(((g,N)=>{const L=E.length;E.push({resolve:g,reject:N}),postMessage({id:"getExternalResource",index:L,uri:U})})))).then((E=>{postMessage({id:"validate.resolve",value:E})}),(E=>{postMessage({id:"validate.reject",reason:E})}));break;case"getExternalResource.resolve":E[g.index].resolve(g.value);break;case"getExternalResource.reject":E[g.index].reject(g.reason)}}}class S{static ValidateAsync(E,U,g,S){return"function"===typeof Worker?new Promise(((u,s)=>{const C=`${L}(${D})()`,B=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),P=new Worker(B),F=E=>{P.removeEventListener("error",F),P.removeEventListener("message",f),s(E)},f=E=>{const U=E.data;switch(U.id){case"getExternalResource":S(U.uri).then((E=>{P.postMessage({id:"getExternalResource.resolve",index:U.index,value:E},[E.buffer])}),(E=>{P.postMessage({id:"getExternalResource.reject",index:U.index,reason:E})}));break;case"validate.resolve":P.removeEventListener("error",F),P.removeEventListener("message",f),u(U.value),P.terminate();break;case"validate.reject":P.removeEventListener("error",F),P.removeEventListener("message",f),s(U.reason),P.terminate()}};if(P.addEventListener("error",F),P.addEventListener("message",f),P.postMessage({id:"init",url:N.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(E)){const N=E.slice();P.postMessage({id:"validate",data:N,rootUrl:U,fileName:g},[N.buffer])}else P.postMessage({id:"validate",data:E,rootUrl:U,fileName:g})})):(this._LoadScriptPromise||(this._LoadScriptPromise=N.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>L(E,U,g,S))))}}S.Configuration={url:`${N.Tools._DefaultCdnUrl}/gltf_validator.js`}},14578:(E,U,g)=>{"use strict";g.d(U,{d:()=>t});var N=g(12320),L=g(12322),D=g(12367),S=g(12334),u=g(12721),s=g(12652),C=g(12407),B=g(12573),P=g(12292),F=g(12250);g(13731),g(13646),g(13659),g(13651),g(13666),g(13672),g(13674);const f="imageProcessingCompatibility",d="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";F.e.IncludesShadersStore[f]||(F.e.IncludesShadersStore[f]=d);const I="skyPixelShader",y="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";F.e.ShadersStore[I]||(F.e.ShadersStore[I]=y);g(13741),g(13680),g(13682),g(13696),g(13689);const h="skyVertexShader",V="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";F.e.ShadersStore[h]||(F.e.ShadersStore[h]=V);var e=g(12646),x=g(12699),l=g(12693);class Y extends u.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class t extends s.e{constructor(E,U){super(E,U),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new S.dU(0,100,0),this.useSunPosition=!1,this.cameraOffset=S.dU.Zero(),this.up=S.dU.Up(),this.dithering=!1,this._cameraPosition=S.dU.Zero(),this._skyOrientation=new S.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(E,U){const g=U._drawWrapper;if(this.isFrozen&&g.effect&&g._wasPreviouslyReady)return!0;U.materialDefines||(U.materialDefines=new Y);const N=U.materialDefines,L=this.tE();if(this._isReadyForSubMesh(U))return!0;if((0,l.Q)(E,L,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,N),(0,l.G)(E,N,!0,!1),N.IMAGEPROCESSINGPOSTPROCESS!==L.imageProcessingConfiguration.applyByPostProcess&&N.markAsMiscDirty(),N.DITHER!==this.dithering&&N.markAsMiscDirty(),N.isDirty){N.markAsProcessed(),L.resetCachedMaterial();const E=new e.b;N.FOG&&E.addFallback(1,"FOG"),N.IMAGEPROCESSINGPOSTPROCESS=L.imageProcessingConfiguration.applyByPostProcess,N.DITHER=this.dithering;const g=[C.f.PositionKind];N.VERTEXCOLOR&&g.push(C.f.ColorKind);const D="sky",S=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,x.d)(S);const u=N.toString();U.setEffect(L.getEngine().createEffect(D,g,S,[],u,E,this.onCompiled,this.onError),N,this._materialContext)}return!(!U.effect||!U.effect.isReady())&&(N._renderId=L.getRenderId(),g._wasPreviouslyReady=!0,!0)}bindForSubMesh(E,U,g){const N=this.tE(),L=g.materialDefines;if(!L)return;const D=g.effect;if(!D)return;this._activeEffect=D,this.bindOnlyWorldMatrix(E),this._activeEffect.setMatrix("viewProjection",N.getTransformMatrix()),this._mustRebind(N,D,g)&&((0,x.e)(D,this,N),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,l.k)(L,D,N)),N.fogEnabled&&U.applyFog&&N.fogMode!==B.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",N.getViewMatrix()),(0,l.f)(N,U,this._activeEffect);const u=N.activeCamera;if(u){const E=u.getWorldMatrix();this._cameraPosition.x=E.m[12],this._cameraPosition.y=E.m[13],this._cameraPosition.z=E.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const E=Math.PI*(this.inclination-.5),U=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(U)*Math.cos(E),this.sunPosition.y=this.distance*Math.sin(-E),this.sunPosition.z=this.distance*Math.sin(U)*Math.cos(E),S.Quaternion.FromUnitVectorsToRef(S.dU.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(U,this._activeEffect,g)}getAnimatables(){return[]}dispose(E){super.dispose(E)}clone(E){return D.b.Clone((()=>new t(E,this.tE())),this)}serialize(){const E=super.serialize();return E.customType="BABYLON.SkyMaterial",E}getClassName(){return"SkyMaterial"}static Parse(E,U,g){return D.b.Parse((()=>new t(E.name,U)),E,U,g)}}(0,N.e)([(0,L.E)()],t.prototype,"luminance",void 0),(0,N.e)([(0,L.E)()],t.prototype,"turbidity",void 0),(0,N.e)([(0,L.E)()],t.prototype,"rayleigh",void 0),(0,N.e)([(0,L.E)()],t.prototype,"mieCoefficient",void 0),(0,N.e)([(0,L.E)()],t.prototype,"mieDirectionalG",void 0),(0,N.e)([(0,L.E)()],t.prototype,"distance",void 0),(0,N.e)([(0,L.E)()],t.prototype,"inclination",void 0),(0,N.e)([(0,L.E)()],t.prototype,"azimuth",void 0),(0,N.e)([(0,L.D)()],t.prototype,"sunPosition",void 0),(0,N.e)([(0,L.E)()],t.prototype,"useSunPosition",void 0),(0,N.e)([(0,L.D)()],t.prototype,"cameraOffset",void 0),(0,N.e)([(0,L.D)()],t.prototype,"up",void 0),(0,N.e)([(0,L.E)()],t.prototype,"dithering",void 0),(0,P.f)("BABYLON.SkyMaterial",t)},13021:(E,U,g)=>{"use strict";function N(E,U){U.headers=E.headers||{},U.statusMessage=E.statusText,U.statusCode=E.status,U.data=E.response}function L(E,U,g){return new Promise((function(L,D){g=g||{};var S,u,s,C=new XMLHttpRequest,B=g.body,P=g.headers||{};for(S in g.timeout&&(C.timeout=g.timeout),C.ontimeout=C.onerror=function(E){E.timeout="timeout"==E.type,D(E)},C.open(E,U.href||U),C.onload=function(){for(s=C.getAllResponseHeaders().trim().split(/[\r\n]+/),N(C,C);u=s.shift();)u=u.split(": "),C.headers[u.shift().toLowerCase()]=u.join(": ");if((u=C.headers["content-type"])&&~u.indexOf("application/json"))try{C.data=JSON.parse(C.data,g.reviver)}catch(E){return N(C,E),D(E)}(C.status>=400?D:L)(C)},typeof FormData<"u"&&B instanceof FormData||B&&"object"==typeof B&&(P["content-type"]="application/json",B=JSON.stringify(B)),C.withCredentials=!!g.withCredentials,P)C.setRequestHeader(S,P[S]);C.send(B)}))}g.r(U),g.d(U,{del:()=>s,get:()=>D,patch:()=>u,post:()=>S,put:()=>C,send:()=>L});var D=L.bind(L,"GET"),S=L.bind(L,"POST"),u=L.bind(L,"PATCH"),s=L.bind(L,"DELETE"),C=L.bind(L,"PUT")},14687:(E,U,g)=>{"use strict";g.d(U,{e:()=>P});const N=.5*(Math.sqrt(3)-1),L=(3-Math.sqrt(3))/6,D=1/3,S=1/6,u=(Math.sqrt(5)-1)/4,s=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),B=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const P=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const U="function"==typeof E?E:function(E){let U=0,g=0,N=0,L=1;const D=function(){let E=4022871197;return function(U){U=U.toString();for(let g=0;g<U.length;g++){E+=U.charCodeAt(g);let N=.02519603282416938*E;E=N>>>0,N-=E,N*=E,E=N>>>0,N-=E,E+=4294967296*N}return 2.3283064365386963e-10*(E>>>0)}}();U=D(" "),g=D(" "),N=D(" "),U-=D(E),U<0&&(U+=1);g-=D(E),g<0&&(g+=1);N-=D(E),N<0&&(N+=1);return function(){const E=2091639*U+2.3283064365386963e-10*L;return U=g,g=N,N=E-(L=0|E)}}(E);this.p=function(E){const U=new Uint8Array(256);for(let g=0;g<256;g++)U[g]=g;for(let g=0;g<255;g++){const N=g+~~(E()*(256-g)),L=U[g];U[g]=U[N],U[N]=L}return U}(U),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let g=0;g<512;g++)this.perm[g]=this.p[255&g],this.permMod12[g]=this.perm[g]%12}noise2D(E,U){const g=this.permMod12,D=this.perm;let S=0,u=0,s=0;const B=(E+U)*N,P=Math.floor(E+B),F=Math.floor(U+B),f=(P+F)*L,d=E-(P-f),I=U-(F-f);let y,h;d>I?(y=1,h=0):(y=0,h=1);const V=d-y+L,e=I-h+L,x=d-1+2*L,l=I-1+2*L,Y=255&P,t=255&F;let G=.5-d*d-I*I;if(G>=0){const E=3*g[Y+D[t]];G*=G,S=G*G*(C[E]*d+C[E+1]*I)}let b=.5-V*V-e*e;if(b>=0){const E=3*g[Y+y+D[t+h]];b*=b,u=b*b*(C[E]*V+C[E+1]*e)}let T=.5-x*x-l*l;if(T>=0){const E=3*g[Y+1+D[t+1]];T*=T,s=T*T*(C[E]*x+C[E+1]*l)}return 70*(S+u+s)}noise3D(E,U,g){const N=this.permMod12,L=this.perm;let u,s,B,P;const F=(E+U+g)*D,f=Math.floor(E+F),d=Math.floor(U+F),I=Math.floor(g+F),y=(f+d+I)*S,h=E-(f-y),V=U-(d-y),e=g-(I-y);let x,l,Y,t,G,b;h>=V?V>=e?(x=1,l=0,Y=0,t=1,G=1,b=0):h>=e?(x=1,l=0,Y=0,t=1,G=0,b=1):(x=0,l=0,Y=1,t=1,G=0,b=1):V<e?(x=0,l=0,Y=1,t=0,G=1,b=1):h<e?(x=0,l=1,Y=0,t=0,G=1,b=1):(x=0,l=1,Y=0,t=1,G=1,b=0);const T=h-x+S,v=V-l+S,o=e-Y+S,c=h-t+2*S,r=V-G+2*S,j=e-b+2*S,Z=h-1+.5,A=V-1+.5,w=e-1+.5,a=255&f,J=255&d,q=255&I;let M=.6-h*h-V*V-e*e;if(M<0)u=0;else{const E=3*N[a+L[J+L[q]]];M*=M,u=M*M*(C[E]*h+C[E+1]*V+C[E+2]*e)}let mE=.6-T*T-v*v-o*o;if(mE<0)s=0;else{const E=3*N[a+x+L[J+l+L[q+Y]]];mE*=mE,s=mE*mE*(C[E]*T+C[E+1]*v+C[E+2]*o)}let W=.6-c*c-r*r-j*j;if(W<0)B=0;else{const E=3*N[a+t+L[J+G+L[q+b]]];W*=W,B=W*W*(C[E]*c+C[E+1]*r+C[E+2]*j)}let O=.6-Z*Z-A*A-w*w;if(O<0)P=0;else{const E=3*N[a+1+L[J+1+L[q+1]]];O*=O,P=O*O*(C[E]*Z+C[E+1]*A+C[E+2]*w)}return 32*(u+s+B+P)}noise4D(E,U,g,N){const L=this.perm;let D,S,C,P,F;const f=(E+U+g+N)*u,d=Math.floor(E+f),I=Math.floor(U+f),y=Math.floor(g+f),h=Math.floor(N+f),V=(d+I+y+h)*s,e=E-(d-V),x=U-(I-V),l=g-(y-V),Y=N-(h-V);let t=0,G=0,b=0,T=0;e>x?t++:G++,e>l?t++:b++,e>Y?t++:T++,x>l?G++:b++,x>Y?G++:T++,l>Y?b++:T++;const v=t>=3?1:0,o=G>=3?1:0,c=b>=3?1:0,r=T>=3?1:0,j=t>=2?1:0,Z=G>=2?1:0,A=b>=2?1:0,w=T>=2?1:0,a=t>=1?1:0,J=G>=1?1:0,q=b>=1?1:0,M=T>=1?1:0,mE=e-v+s,W=x-o+s,O=l-c+s,Q=Y-r+s,R=e-j+2*s,n=x-Z+2*s,k=l-A+2*s,z=Y-w+2*s,i=e-a+3*s,p=x-J+3*s,H=l-q+3*s,K=Y-M+3*s,X=e-1+4*s,EE=x-1+4*s,UE=l-1+4*s,gE=Y-1+4*s,NE=255&d,LE=255&I,DE=255&y,SE=255&h;let uE=.6-e*e-x*x-l*l-Y*Y;if(uE<0)D=0;else{const E=L[NE+L[LE+L[DE+L[SE]]]]%32*4;uE*=uE,D=uE*uE*(B[E]*e+B[E+1]*x+B[E+2]*l+B[E+3]*Y)}let sE=.6-mE*mE-W*W-O*O-Q*Q;if(sE<0)S=0;else{const E=L[NE+v+L[LE+o+L[DE+c+L[SE+r]]]]%32*4;sE*=sE,S=sE*sE*(B[E]*mE+B[E+1]*W+B[E+2]*O+B[E+3]*Q)}let CE=.6-R*R-n*n-k*k-z*z;if(CE<0)C=0;else{const E=L[NE+j+L[LE+Z+L[DE+A+L[SE+w]]]]%32*4;CE*=CE,C=CE*CE*(B[E]*R+B[E+1]*n+B[E+2]*k+B[E+3]*z)}let BE=.6-i*i-p*p-H*H-K*K;if(BE<0)P=0;else{const E=L[NE+a+L[LE+J+L[DE+q+L[SE+M]]]]%32*4;BE*=BE,P=BE*BE*(B[E]*i+B[E+1]*p+B[E+2]*H+B[E+3]*K)}let PE=.6-X*X-EE*EE-UE*UE-gE*gE;if(PE<0)F=0;else{const E=L[NE+1+L[LE+1+L[DE+1+L[SE+1]]]]%32*4;PE*=PE,F=PE*PE*(B[E]*X+B[E+1]*EE+B[E+2]*UE+B[E+3]*gE)}return 27*(D+S+C+P+F)}}}}]);