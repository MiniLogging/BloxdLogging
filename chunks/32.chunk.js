/*! For license information please see 6vj9d.32.e19d5916.chunk.js.LICENSE.txt */
(self.u4k1rqylno=self.u4k1rqylno||[]).push([[32],{13707:(e,E,H)=>{"use strict";var N=H(13716),u=H(13719),z=H(13721);H.g.__TYPEDARRAY_POOL||(H.g.__TYPEDARRAY_POOL={UINT8:u([32,0]),UINT16:u([32,0]),UINT32:u([32,0]),INT8:u([32,0]),INT16:u([32,0]),INT32:u([32,0]),FLOAT:u([32,0]),DOUBLE:u([32,0]),DATA:u([32,0]),UINT8C:u([32,0]),BUFFER:u([32,0])});var P="undefined"!==typeof Uint8ClampedArray,M=H.g.__TYPEDARRAY_POOL;M.UINT8C||(M.UINT8C=u([32,0])),M.BUFFER||(M.BUFFER=u([32,0]));var D=M.DATA,A=M.BUFFER;function C(e){if(e){var E=e.length||e.byteLength,H=N.log2(E);D[H].push(e)}}function i(e){e=N.nextPow2(e);var E=N.log2(e),H=D[E];return H.length>0?H.pop():new ArrayBuffer(e)}function V(e){return new Uint8Array(i(e),0,e)}function U(e){return new Uint16Array(i(2*e),0,e)}function j(e){return new Uint32Array(i(4*e),0,e)}function F(e){return new Int8Array(i(e),0,e)}function h(e){return new Int16Array(i(2*e),0,e)}function S(e){return new Int32Array(i(4*e),0,e)}function X(e){return new Float32Array(i(4*e),0,e)}function a(e){return new Float64Array(i(8*e),0,e)}function W(e){return P?new Uint8ClampedArray(i(e),0,e):V(e)}function r(e){return new DataView(i(e),0,e)}E.free=function(e){if(z(e))A[N.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var E=e.length||e.byteLength,H=0|N.log2(E);D[H].push(e)}},E.freeUint8=E.freeUint16=E.freeUint32=E.freeInt8=E.freeInt16=E.freeInt32=E.freeFloat32=E.freeFloat=E.freeFloat64=E.freeDouble=E.freeUint8Clamped=E.freeDataView=function(e){C(e.buffer)},E.freeArrayBuffer=C,E.freeBuffer=function(e){A[N.log2(e.length)].push(e)},E.malloc=function(e,E){if(void 0===E||"arraybuffer"===E)return i(e);switch(E){case"uint8":return V(e);case"uint16":return U(e);case"uint32":return j(e);case"int8":return F(e);case"int16":return h(e);case"int32":return S(e);case"float":case"float32":return X(e);case"double":case"float64":return a(e);case"uint8_clamped":return W(e);case"buffer":throw"Buffer not supported";case"data":case"dataview":return r(e);default:return null}return null},E.mallocArrayBuffer=i,E.mallocUint8=V,E.mallocUint16=U,E.mallocUint32=j,E.mallocInt8=F,E.mallocInt16=h,E.mallocInt32=S,E.mallocFloat32=E.mallocFloat=X,E.mallocFloat64=E.mallocDouble=a,E.mallocUint8Clamped=W,E.mallocDataView=r,E.clearCache=function(){for(var e=0;e<32;++e)M.UINT8[e].length=0,M.UINT16[e].length=0,M.UINT32[e].length=0,M.INT8[e].length=0,M.INT16[e].length=0,M.INT32[e].length=0,M.FLOAT[e].length=0,M.DOUBLE[e].length=0,M.UINT8C[e].length=0,D[e].length=0,A[e].length=0}},13786:(e,E,H)=>{e.exports=u;var N=H(12537);function u(e,E){if(!(this instanceof u))return new u(e,E);var H=N.create();N.add(H,e,E),this.base=N.min(N.create(),e,H),this.ZA=N.clone(E),this.max=N.max(N.create(),e,H),this.mag=N.length(this.ZA)}var z=u.prototype;z.width=function(){return this.ZA[0]},z.height=function(){return this.ZA[1]},z.depth=function(){return this.ZA[2]},z.x0=function(){return this.base[0]},z.y0=function(){return this.base[1]},z.z0=function(){return this.base[2]},z.x1=function(){return this.max[0]},z.y1=function(){return this.max[1]},z.z1=function(){return this.max[2]},z.translate=function(e){return N.add(this.max,this.max,e),N.add(this.base,this.base,e),this},z.setPosition=function(e){return N.add(this.max,e,this.ZA),N.k(this.base,e),this},z.expand=function(e){var E=N.create(),H=N.create();return N.max(E,e.max,this.max),N.min(H,e.base,this.base),N.FE(E,E,H),new u(H,E)},z.intersects=function(e){return!(e.base[0]>this.max[0])&&(!(e.base[1]>this.max[1])&&(!(e.base[2]>this.max[2])&&(!(e.max[0]<this.base[0])&&(!(e.max[1]<this.base[1])&&!(e.max[2]<this.base[2])))))},z.touches=function(e){var E=this.union(e);return null!==E&&(0==E.width()||0==E.height()||0==E.depth())},z.union=function(e){if(!this.intersects(e))return null;var E=Math.max(e.base[0],this.base[0]),H=Math.max(e.base[1],this.base[1]),N=Math.max(e.base[2],this.base[2]);return new u([E,H,N],[Math.min(e.max[0],this.max[0])-E,Math.min(e.max[1],this.max[1])-H,Math.min(e.max[2],this.max[2])-N])}},13716:(e,E)=>{"use strict";function H(e){var E=32;return(e&=-e)&&E--,65535&e&&(E-=16),16711935&e&&(E-=8),252645135&e&&(E-=4),858993459&e&&(E-=2),1431655765&e&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(e){return(e>0)-(e<0)},E.abs=function(e){var E=e>>31;return(e^E)-E},E.min=function(e,E){return E^(e^E)&-(e<E)},E.max=function(e,E){return e^(e^E)&-(e<E)},E.isPow2=function(e){return!(e&e-1)&&!!e},E.log2=function(e){var E,H;return E=(e>65535)<<4,E|=H=((e>>>=E)>255)<<3,E|=H=((e>>>=H)>15)<<2,(E|=H=((e>>>=H)>3)<<1)|(e>>>=H)>>1},E.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},E.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},E.countTrailingZeros=H,E.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},E.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},E.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var N=new Array(256);!function(e){for(var E=0;E<256;++E){var H=E,N=E,u=7;for(H>>>=1;H;H>>>=1)N<<=1,N|=1&H,--u;e[E]=N<<u&255}}(N),E.reverse=function(e){return N[255&e]<<24|N[e>>>8&255]<<16|N[e>>>16&255]<<8|N[e>>>24&255]},E.interleave2=function(e,E){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(e,E){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>E&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},E.interleave3=function(e,E,H){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},E.deinterleave3=function(e,E){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>E&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},E.nextCombination=function(e){var E=e|e-1;return E+1|(~E&-~E)-1>>>H(e)+1}},13703:(e,E,H)=>{"use strict";e.exports=function(e,E,H){switch(arguments.length){case 1:return N=[],A(u=e,u,C,!0),N;case 2:return"function"===typeof E?A(e,e,E,!0):function(e,E){return N=[],A(e,E,C,!1),N}(e,E);case 3:return A(e,E,H,!1);default:throw new Error("box-intersect: Invalid arguments")}var u};var N,u=H(13707),z=H(13726),P=H(13737);function M(e,E){for(var H=0;H<e;++H)if(!(E[H]<=E[H+e]))return!0;return!1}function D(e,E,H,N){for(var u=0,z=0,P=0,D=e.length;P<D;++P){var A=e[P];if(!M(E,A)){for(var C=0;C<2*E;++C)H[u++]=A[C];N[z++]=P}}return z}function A(e,E,H,N){var M=e.length,A=E.length;if(!(M<=0||A<=0)){var C=e[0].length>>>1;if(!(C<=0)){var i,V=u.mallocDouble(2*C*M),U=u.mallocInt32(M);if((M=D(e,C,V,U))>0){if(1===C&&N)z.init(M),i=z.sweepComplete(C,H,0,M,V,U,0,M,V,U);else{var j=u.mallocDouble(2*C*A),F=u.mallocInt32(A);(A=D(E,C,j,F))>0&&(z.init(M+A),i=1===C?z.sweepBipartite(C,H,0,M,V,U,0,A,j,F):P(C,H,N,M,V,U,A,j,F),u.free(j),u.free(F))}u.free(V),u.free(U)}return i}}}function C(e,E){N.push([e,E])}},13741:(e,E)=>{"use strict";var H="d",N="ax",u="fp",z="es",P="rs",M="re",D="rb",A="bs",C="be",i="bb",V=[H,N,"vv",P,M,D,"ri",A,C,i,"bi"];function U(e){var E="bruteForce"+(e?"Full":"Partial"),N=[],P=V.slice();e||P.splice(3,0,u);var M=["function "+E+"("+P.join()+"){"];function D(E,u){var P=function(e,E,N){var u="bruteForce"+(e?"Red":"Blue")+(E?"Flip":"")+(N?"Full":""),P=["function ",u,"(",V.join(),"){","var ",z,"=2*",H,";"],M="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",D="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(N?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return e?P.push(M,"Q",":",D):P.push(D,"Q",":",M),N?P.push("if(y1<x0||x1<y0)continue;"):E?P.push("if(y0<=x0||x1<y0)continue;"):P.push("if(y0<x0||x1<y0)continue;"),P.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),E?P.push("yi,xi"):P.push("xi,yi"),P.push(");if(rv!==void 0)return rv;}}}"),{name:u,code:P.join("")}}(E,u,e);N.push(P.code),M.push("return "+P.name+"("+V.join()+");")}M.push("if(re-rs>be-bs){"),e?(D(!0,!1),M.push("}else{"),D(!1,!1)):(M.push("if(fp){"),D(!0,!0),M.push("}else{"),D(!0,!1),M.push("}}else{if(fp){"),D(!1,!0),M.push("}else{"),D(!1,!1),M.push("}")),M.push("}}return "+E);var A=N.join("")+M.join("");return new Function(A)()}E.partial=U(!1),E.full=U(!0)},13737:(e,E,H)=>{"use strict";e.exports=function(e,E,H,z,C,o,y,b,K){!function(e,E){var H=8*u.log2(E+1)*(e+1)|0,z=u.nextPow2(W*H);Y.length<z&&(N.free(Y),Y=N.mallocInt32(z));var P=u.nextPow2(r*H);f.length<P&&(N.free(f),f=N.mallocDouble(P))}(e,z+y);var l,O=0,v=2*e;w(O++,0,0,z,0,y,H?16:0,-1/0,1/0),H||w(O++,0,0,y,0,z,1,-1/0,1/0);for(;O>0;){var R=(O-=1)*W,T=Y[R],L=Y[R+1],d=Y[R+2],G=Y[R+3],me=Y[R+4],Q=Y[R+5],Z=O*r,k=f[Z],J=f[Z+1],B=1&Q,I=!!(16&Q),t=C,q=o,c=b,n=K;if(B&&(t=b,q=K,c=C,n=o),!(2&Q&&L>=(d=h(e,T,L,d,t,q,J)))&&!(4&Q&&(L=S(e,T,L,d,t,q,k))>=d)){var g=d-L,x=me-G;if(I){if(e*g*(g+x)<U){if(void 0!==(l=D.scanComplete(e,T,E,L,d,t,q,G,me,c,n)))return l;continue}}else{if(e*Math.min(g,x)<i){if(void 0!==(l=P(e,T,E,B,L,d,t,q,G,me,c,n)))return l;continue}if(e*g*x<V){if(void 0!==(l=D.scanBipartite(e,T,E,B,L,d,t,q,G,me,c,n)))return l;continue}}var ee=j(e,T,L,d,t,q,k,J);if(L<ee)if(e*(ee-L)<i){if(void 0!==(l=M(e,T+1,E,L,ee,t,q,G,me,c,n)))return l}else if(T===e-2){if(void 0!==(l=B?D.sweepBipartite(e,E,G,me,c,n,L,ee,t,q):D.sweepBipartite(e,E,L,ee,t,q,G,me,c,n)))return l}else w(O++,T+1,L,ee,G,me,B,-1/0,1/0),w(O++,T+1,G,me,L,ee,1^B,-1/0,1/0);if(ee<d){var Ee=A(e,T,G,me,c,n),He=c[v*Ee+T],Ne=F(e,T,Ee,me,c,n,He);if(Ne<me&&w(O++,T,ee,d,Ne,me,(4|B)+(I?16:0),He,J),G<Ee&&w(O++,T,ee,d,G,Ee,(2|B)+(I?16:0),k,He),Ee+1===Ne){if(void 0!==(l=I?p(e,T,E,ee,d,t,q,Ee,c,n[Ee]):s(e,T,E,B,ee,d,t,q,Ee,c,n[Ee])))return l}else if(Ee<Ne){var ue;if(I){if(ee<(ue=X(e,T,ee,d,t,q,He))){var ze=F(e,T,ee,ue,t,q,He);if(T===e-2){if(ee<ze&&void 0!==(l=D.sweepComplete(e,E,ee,ze,t,q,Ee,Ne,c,n)))return l;if(ze<ue&&void 0!==(l=D.sweepBipartite(e,E,ze,ue,t,q,Ee,Ne,c,n)))return l}else ee<ze&&w(O++,T+1,ee,ze,Ee,Ne,16,-1/0,1/0),ze<ue&&(w(O++,T+1,ze,ue,Ee,Ne,0,-1/0,1/0),w(O++,T+1,Ee,Ne,ze,ue,1,-1/0,1/0))}}else ee<(ue=B?a(e,T,ee,d,t,q,He):X(e,T,ee,d,t,q,He))&&(T===e-2?l=B?D.sweepBipartite(e,E,Ee,Ne,c,n,ee,ue,t,q):D.sweepBipartite(e,E,ee,ue,t,q,Ee,Ne,c,n):(w(O++,T+1,ee,ue,Ee,Ne,B,-1/0,1/0),w(O++,T+1,Ee,Ne,ee,ue,1^B,-1/0,1/0)))}}}}};var N=H(13707),u=H(13716),z=H(13741),P=z.partial,M=z.full,D=H(13726),A=H(13746),C=H(13753),i=128,V=1<<22,U=1<<22,j=C("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),F=C("lo===p0",["p0"]),h=C("lo<p0",["p0"]),S=C("hi<=p0",["p0"]),X=C("lo<=p0&&p0<=hi",["p0"]),a=C("lo<p0&&p0<=hi",["p0"]),W=6,r=2,Y=N.mallocInt32(1024),f=N.mallocDouble(1024);function w(e,E,H,N,u,z,P,M,D){var A=W*e;Y[A]=E,Y[A+1]=H,Y[A+2]=N,Y[A+3]=u,Y[A+4]=z,Y[A+5]=P;var C=r*e;f[C]=M,f[C+1]=D}function s(e,E,H,N,u,z,P,M,D,A,C){var i=2*e,V=D*i,U=A[V+E];e:for(var j=u,F=u*i;j<z;++j,F+=i){var h=P[F+E],S=P[F+E+e];if(!(U<h||S<U)&&(!N||U!==h)){for(var X,a=M[j],W=E+1;W<e;++W){h=P[F+W],S=P[F+W+e];var r=A[V+W],Y=A[V+W+e];if(S<r||Y<h)continue e}if(void 0!==(X=N?H(C,a):H(a,C)))return X}}}function p(e,E,H,N,u,z,P,M,D,A){var C=2*e,i=M*C,V=D[i+E];e:for(var U=N,j=N*C;U<u;++U,j+=C){var F=P[U];if(F!==A){var h=z[j+E],S=z[j+E+e];if(!(V<h||S<V)){for(var X=E+1;X<e;++X){h=z[j+X],S=z[j+X+e];var a=D[i+X],W=D[i+X+e];if(S<a||W<h)continue e}var r=H(F,A);if(void 0!==r)return r}}}}},13746:(e,E,H)=>{"use strict";e.exports=function(e,E,H,P,M,D){if(P<=H+1)return H;var A=H,C=P,i=P+H>>>1,V=2*e,U=i,j=M[V*i+E];for(;A<C;){if(C-A<u){z(e,E,A,C,M,D),j=M[V*i+E];break}var F=C-A,h=Math.random()*F+A|0,S=M[V*h+E],X=Math.random()*F+A|0,a=M[V*X+E],W=Math.random()*F+A|0,r=M[V*W+E];S<=a?r>=a?(U=X,j=a):S>=r?(U=h,j=S):(U=W,j=r):a>=r?(U=X,j=a):r>=S?(U=h,j=S):(U=W,j=r);for(var Y=V*(C-1),f=V*U,w=0;w<V;++w,++Y,++f){var s=M[Y];M[Y]=M[f],M[f]=s}var p=D[C-1];D[C-1]=D[U],D[U]=p;for(Y=V*(C-1),f=V*(U=N(e,E,A,C-1,M,D,j)),w=0;w<V;++w,++Y,++f){s=M[Y];M[Y]=M[f],M[f]=s}p=D[C-1];if(D[C-1]=D[U],D[U]=p,i<U){for(C=U-1;A<C&&M[V*(C-1)+E]===j;)C-=1;C+=1}else{if(!(U<i))break;for(A=U+1;A<C&&M[V*A+E]===j;)A+=1}}return N(e,E,H,i,M,D,M[V*i+E])};var N=H(13753)("lo<p0",["p0"]),u=8;function z(e,E,H,N,u,z){for(var P=2*e,M=P*(H+1)+E,D=H+1;D<N;++D,M+=P)for(var A=u[M],C=D,i=P*(D-1);C>H&&u[i+E]>A;--C,i-=P){for(var V=i,U=i+P,j=0;j<P;++j,++V,++U){var F=u[V];u[V]=u[U],u[U]=F}var h=z[C];z[C]=z[C-1],z[C-1]=h}}},13753:e=>{"use strict";e.exports=function(e,H){var N="abcdef".split("").concat(H),u=[];e.indexOf("lo")>=0&&u.push("lo=e[k+n]");e.indexOf("hi")>=0&&u.push("hi=e[k+o]");return N.push(E.replace("_",u.join()).replace("$",e)),Function.apply(void 0,N)};var E="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13729:e=>{"use strict";e.exports=function(e,N){N<=4*E?H(0,N-1,e):A(0,N-1,e)};var E=32;function H(e,E,H){for(var N=2*(e+1),u=e+1;u<=E;++u){for(var z=H[N++],P=H[N++],M=u,D=N-2;M-- >e;){var A=H[D-2],C=H[D-1];if(A<z)break;if(A===z&&C<P)break;H[D]=A,H[D+1]=C,D-=2}H[D]=z,H[D+1]=P}}function N(e,E,H){E*=2;var N=H[e*=2],u=H[e+1];H[e]=H[E],H[e+1]=H[E+1],H[E]=N,H[E+1]=u}function u(e,E,H){E*=2,H[e*=2]=H[E],H[e+1]=H[E+1]}function z(e,E,H,N){E*=2,H*=2;var u=N[e*=2],z=N[e+1];N[e]=N[E],N[e+1]=N[E+1],N[E]=N[H],N[E+1]=N[H+1],N[H]=u,N[H+1]=z}function P(e,E,H,N,u){E*=2,u[e*=2]=u[E],u[E]=H,u[e+1]=u[E+1],u[E+1]=N}function M(e,E,H){E*=2;var N=H[e*=2],u=H[E];return!(N<u)&&(N!==u||H[e+1]>H[E+1])}function D(e,E,H,N){var u=N[e*=2];return u<E||u===E&&N[e+1]<H}function A(e,C,i){var V=(C-e+1)/6|0,U=e+V,j=C-V,F=e+C>>1,h=F-V,S=F+V,X=U,a=h,W=F,r=S,Y=j,f=e+1,w=C-1,s=0;M(X,a,i)&&(s=X,X=a,a=s),M(r,Y,i)&&(s=r,r=Y,Y=s),M(X,W,i)&&(s=X,X=W,W=s),M(a,W,i)&&(s=a,a=W,W=s),M(X,r,i)&&(s=X,X=r,r=s),M(W,r,i)&&(s=W,W=r,r=s),M(a,Y,i)&&(s=a,a=Y,Y=s),M(a,W,i)&&(s=a,a=W,W=s),M(r,Y,i)&&(s=r,r=Y,Y=s);for(var p=i[2*a],o=i[2*a+1],y=i[2*r],b=i[2*r+1],K=2*X,l=2*W,O=2*Y,v=2*U,R=2*F,T=2*j,L=0;L<2;++L){var d=i[K+L],G=i[l+L],me=i[O+L];i[v+L]=d,i[R+L]=G,i[T+L]=me}u(h,e,i),u(S,C,i);for(var Q=f;Q<=w;++Q)if(D(Q,p,o,i))Q!==f&&N(Q,f,i),++f;else if(!D(Q,y,b,i))for(;;){if(D(w,y,b,i)){D(w,p,o,i)?(z(Q,f,w,i),++f,--w):(N(Q,w,i),--w);break}if(--w<Q)break}P(e,f-1,p,o,i),P(C,w+1,y,b,i),f-2-e<=E?H(e,f-2,i):A(e,f-2,i),C-(w+2)<=E?H(w+2,C,i):A(w+2,C,i),w-f<=E?H(f,w,i):A(f,w,i)}},13726:(e,E,H)=>{"use strict";e.exports={init:function(e){var E=u.nextPow2(e);D.length<E&&(N.free(D),D=N.mallocInt32(E));A.length<E&&(N.free(A),A=N.mallocInt32(E));C.length<E&&(N.free(C),C=N.mallocInt32(E));i.length<E&&(N.free(i),i=N.mallocInt32(E));V.length<E&&(N.free(V),V=N.mallocInt32(E));U.length<E&&(N.free(U),U=N.mallocInt32(E));var H=8*E;j.length<H&&(N.free(j),j=N.mallocDouble(H))},sweepBipartite:function(e,E,H,N,u,M,V,U,S,X){for(var a=0,W=2*e,r=e-1,Y=W-1,f=H;f<N;++f){var w=M[f],s=W*f;j[a++]=u[s+r],j[a++]=-(w+1),j[a++]=u[s+Y],j[a++]=w}for(f=V;f<U;++f){w=X[f]+P;var p=W*f;j[a++]=S[p+r],j[a++]=-w,j[a++]=S[p+Y],j[a++]=w}var o=a>>>1;z(j,o);var y=0,b=0;for(f=0;f<o;++f){var K=0|j[2*f+1];if(K>=P)F(C,i,b--,K=K-P|0);else if(K>=0)F(D,A,y--,K);else if(K<=-P){K=-K-P|0;for(var l=0;l<y;++l){if(void 0!==(O=E(D[l],K)))return O}h(C,i,b++,K)}else{K=-K-1|0;for(l=0;l<b;++l){var O;if(void 0!==(O=E(K,C[l])))return O}h(D,A,y++,K)}}},sweepComplete:function(e,E,H,N,u,P,M,S,X,a){for(var W=0,r=2*e,Y=e-1,f=r-1,w=H;w<N;++w){var s=P[w]+1<<1,p=r*w;j[W++]=u[p+Y],j[W++]=-s,j[W++]=u[p+f],j[W++]=s}for(w=M;w<S;++w){s=a[w]+1<<1;var o=r*w;j[W++]=X[o+Y],j[W++]=1|-s,j[W++]=X[o+f],j[W++]=1|s}var y=W>>>1;z(j,y);var b=0,K=0,l=0;for(w=0;w<y;++w){var O=0|j[2*w+1],v=1&O;if(w<y-1&&O>>1===j[2*w+3]>>1&&(v=2,w+=1),O<0){for(var R=-(O>>1)-1,T=0;T<l;++T){if(void 0!==(L=E(V[T],R)))return L}if(0!==v)for(T=0;T<b;++T){if(void 0!==(L=E(D[T],R)))return L}if(1!==v)for(T=0;T<K;++T){var L;if(void 0!==(L=E(C[T],R)))return L}0===v?h(D,A,b++,R):1===v?h(C,i,K++,R):2===v&&h(V,U,l++,R)}else{R=(O>>1)-1;0===v?F(D,A,b--,R):1===v?F(C,i,K--,R):2===v&&F(V,U,l--,R)}}},scanBipartite:function(e,E,H,N,u,M,C,i,V,U,S,X){var a=0,W=2*e,r=E,Y=E+e,f=1,w=1;N?w=P:f=P;for(var s=u;s<M;++s){var p=s+f,o=W*s;j[a++]=C[o+r],j[a++]=-p,j[a++]=C[o+Y],j[a++]=p}for(s=V;s<U;++s){p=s+w;var y=W*s;j[a++]=S[y+r],j[a++]=-p}var b=a>>>1;z(j,b);var K=0;for(s=0;s<b;++s){var l=0|j[2*s+1];if(l<0){var O=!1;if((p=-l)>=P?(O=!N,p-=P):(O=!!N,p-=1),O)h(D,A,K++,p);else{var v=X[p],R=W*p,T=S[R+E+1],L=S[R+E+1+e];e:for(var d=0;d<K;++d){var G=D[d],me=W*G;if(!(L<C[me+E+1]||C[me+E+1+e]<T)){for(var Q=E+2;Q<e;++Q)if(S[R+Q+e]<C[me+Q]||C[me+Q+e]<S[R+Q])continue e;var Z,k=i[G];if(void 0!==(Z=N?H(v,k):H(k,v)))return Z}}}}else F(D,A,K--,l-f)}},scanComplete:function(e,E,H,N,u,M,A,C,i,V,U){for(var F=0,h=2*e,S=E,X=E+e,a=N;a<u;++a){var W=a+P,r=h*a;j[F++]=M[r+S],j[F++]=-W,j[F++]=M[r+X],j[F++]=W}for(a=C;a<i;++a){W=a+1;var Y=h*a;j[F++]=V[Y+S],j[F++]=-W}var f=F>>>1;z(j,f);var w=0;for(a=0;a<f;++a){var s=0|j[2*a+1];if(s<0){if((W=-s)>=P)D[w++]=W-P;else{var p=U[W-=1],o=h*W,y=V[o+E+1],b=V[o+E+1+e];e:for(var K=0;K<w;++K){var l=D[K],O=A[l];if(O===p)break;var v=h*l;if(!(b<M[v+E+1]||M[v+E+1+e]<y)){for(var R=E+2;R<e;++R)if(V[o+R+e]<M[v+R]||M[v+R+e]<V[o+R])continue e;var T=H(O,p);if(void 0!==T)return T}}}}else{for(W=s-P,K=w-1;K>=0;--K)if(D[K]===W){for(R=K+1;R<w;++R)D[R-1]=D[R];break}--w}}}};var N=H(13707),u=H(13716),z=H(13729),P=1<<28,M=1024,D=N.mallocInt32(M),A=N.mallocInt32(M),C=N.mallocInt32(M),i=N.mallocInt32(M),V=N.mallocInt32(M),U=N.mallocInt32(M),j=N.mallocDouble(8192);function F(e,E,H,N){var u=E[N],z=e[H-1];e[u]=z,E[z]=u}function h(e,E,H,N){e[H]=N,E[N]=H}},13719:e=>{"use strict";function E(e,H,N){var u=0|e[N];if(u<=0)return[];var z,P=new Array(u);if(N===e.length-1)for(z=0;z<u;++z)P[z]=H;else for(z=0;z<u;++z)P[z]=E(e,H,N+1);return P}e.exports=function(e,H){switch("undefined"===typeof H&&(H=0),typeof e){case"number":if(e>0)return function(e,E){var H,N;for(H=new Array(e),N=0;N<e;++N)H[N]=E;return H}(0|e,H);break;case"object":if("number"===typeof e.length)return E(e,H,0)}return[]}},13669:(e,E,H)=>{e.exports=function(){var e=this;this.components={},this.comps=this.components;var E=this.components,H=1,u={},z=[],P=[],M={timeout:!1,removals:[],multiComps:[]};function D(e,H){var N=E[H],z=u[H],P=z.hash[e];P&&(z.remove(e),N.mz&&(N.multi?(P.forEach((E=>{E&&N.mz(e,E)})),P.length=0):N.mz(e,P)),M.removals.push(z),A())}function A(){M.timeout||(M.timeout=!0,setTimeout(C,1))}function C(){M.timeout=!1,i()}function i(){M.multiComps.length&&function(e){for(var E=0;E<e.length;E++){var{entID:H,data:N}=e[E],u=N.hash[H];if(u){for(var z=0;z<u.length;z++)u[z]||(u.splice(z,1),z--);0===u.length&&(N.remove(H),M.removals.push(N))}}e.length=0}(M.multiComps),M.removals.length&&function(e){for(var E=0;E<e.length;E++){e[E].flush()}e.length=0}(M.removals)}this.ui=u,this._systems=z,this._renderSystems=P,this.BA=function(E){var N=H++;return Array.isArray(E)&&E.forEach((E=>e.yD(N,E))),N},this.deleteEntity=function(E){return Object.keys(u).forEach((e=>{u[e].hash[E]&&D(E,e)})),e},this.MC=function(e){if(!e)throw new Error("Missing component definition");var H=e.name;if(!H)throw new Error("Component definition must have a name property.");if("string"!==typeof H)throw new Error("Component name must be a string.");if(""===H)throw new Error("Component name must be a non-empty string.");if(u[H])throw new Error(`Component ${H} already exists.`);var M={};return M.name=H,M.multi=!!e.multi,M.order=isNaN(e.order)?99:e.order,M.stateConstructor=e.stateConstructor||null,M.state=e.state||{},M.pM=e.pM||null,M.mz=e.mz||null,M.system=e.system||null,M.OM=e.OM||null,E[H]=M,u[H]=new N,u[H]._pendingMultiCleanup=!1,u[H]._multiCleanupIDs=M.multi?[]:null,M.system&&(z.push(H),z.sort(((e,H)=>E[e].order-E[H].order))),M.OM&&(P.push(H),P.sort(((e,H)=>E[e].order-E[H].order))),H},this.overwriteComponent=function(e,H){var N=E[e];if(!N)throw new Error(`Unknown component: ${e}`);if(!H)throw new Error("Missing component definition");if(N.name!==H.name)throw new Error("Overwriting component must use the same name property.");var M={};M.name=e,M.multi=!!H.multi,M.order=isNaN(H.order)?99:H.order,M.state=H.state||{},M.pM=H.pM||null,M.mz=H.mz||null,M.system=H.system||null,M.OM=H.OM||null,E[e]=M,u[e]._pendingMultiCleanup=!1,u[e]._multiCleanupIDs=M.multi?[]:null;var D=z.indexOf(e);M.system&&D<0&&z.push(e),!M.system&&D>=0&&z.splice(D,1),z.sort(((e,H)=>E[e].order-E[H].order));var A=P.indexOf(e);M.OM&&A<0&&P.push(e),!M.OM&&A>=0&&P.splice(A,1),P.sort(((e,H)=>E[e].order-E[H].order));var C=M.state;return this.pA(e).forEach((e=>{for(var E in C)E in e||(e[E]=C[E]);M.pM&&M.pM(e.KM,e)})),e},this.deleteComponent=function(H){var N=u[H];if(!N)throw new Error(`Unknown component: ${H}`);N.flush(),N.list.forEach((e=>{e&&D(e.KM||e[0].KM,H)}));var M=z.indexOf(H),A=P.indexOf(H);return M>-1&&z.splice(M,1),A>-1&&P.splice(A,1),u[H].dispose(),delete u[H],delete E[H],e},this.yD=function(e,H,N){var z,P=E[H],M=u[H];if(!M)throw new Error(`Unknown component: ${H}.`);if(M.hash[e]&&!P.multi)throw new Error(`Entity ${e} already has component: ${H}.`);if(P.stateConstructor){if(!(z=new P.stateConstructor).hasOwnProperty("KM"))throw new Error(`Component ${P.name} stateConstructor type does not have property __id`)}else z=Object.assign({},{KM:e},P.state,N);if(z.KM=e,P.multi){var D=M.hash[e];D||(D=[],M.add(e,D)),D.push(z)}else M.add(e,z);return P.pM&&P.pM(e,z),this},this.GD=function(e,E){var H=u[E];if(!H)throw new Error(`Unknown component: ${E}.`);return!!H.hash[e]},this.OD=function(E,H){if(!u[H])throw new Error(`Unknown component: ${H}.`);return D(E,H),e},this.getState=function(e,E){var H=u[E];if(!H)throw new Error(`Unknown component: ${E}.`);return H.hash[e]},this.pA=function(e){var E=u[e];if(!E)throw new Error(`Unknown component: ${e}.`);return i(),E.list},this.nV=function(e){if(!u[e])throw new Error(`Unknown component: ${e}.`);var E=u[e].hash;return e=>E[e]},this.eU=function(e){if(!u[e])throw new Error(`Unknown component: ${e}.`);var E=u[e].hash;return e=>!!E[e]},this.BP=function(H){i();for(var N=0;N<z.length;N++){var P=z[N],M=E[P],D=u[P];M.system(H,D.list),i()}return e},this.render=function(H){i();for(var N=0;N<P.length;N++){var z=P[N],M=E[z],D=u[z];M.OM(H,D.list),i()}return e},this.removeMultiComponent=function(H,N,z){var P=E[N],D=u[N];if(!D)throw new Error(`Unknown component: ${N}.`);if(!P.multi)throw new Error("removeMultiComponent called on non-multi component");return function(e,E,H,N){var u=H.hash[e];if(u){var z=u[N];z&&(u[N]=null,E.mz&&E.mz(e,z),M.multiComps.push({entID:e,data:H}),A())}}(H,P,D,z),e}};var N=H(13677)},13677:e=>{function E(e,E){var H=e._map[E];if(delete e.hash[E],delete e._map[E],H===e.list.length-1)e.list.pop();else{var N=e.list.pop();if(e.list[H]=N,null===N||null===N[0]){var u=e.list.length;for(var z in e._map)if(e._map[z]===u)return void(e._map[z]=H)}else{var P=N.KM||N[0].KM;e._map[P]=H}}}e.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(e,E){if("number"===typeof this._map[e]){var H=this._map[e];this.hash[e]=E,this.list[H]=E}else this._map[e]=this.list.length,this.hash[e]=E,this.list.push(E)}remove(e){var E=this._map[e];this.hash[e]=null,this.list[E]=null,this._pendingRemovals.push(e)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var e=0;e<this._pendingRemovals.length;e++){var H=this._pendingRemovals[e];null===this.hash[H]&&E(this,H)}this._pendingRemovals.length=0}}},13633:e=>{"use strict";var E,H="object"===typeof Reflect?Reflect:null,N=function(e,E,H){return Function.prototype.apply.call(e,E,H)};E=H&&"function"===typeof H.ownKeys?H.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var u=Number.isNaN||function(e){return e!==e};function z(){z.init.call(this)}e.exports=z,e.exports.once=function(e,E){return new Promise((function(H,N){function u(H){e.removeListener(E,z),N(H)}function z(){"function"===typeof e.removeListener&&e.removeListener("error",u),H([].slice.call(arguments))}F(e,E,z,{once:!0}),"error"!==E&&function(e,E,H){"function"===typeof e.on&&F(e,"error",E,H)}(e,u,{once:!0})}))},z.EventEmitter=z,z.prototype._events=void 0,z.prototype._eventsCount=0,z.prototype._maxListeners=void 0;var P=10;function M(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function D(e){return void 0===e._maxListeners?z.defaultMaxListeners:e._maxListeners}function A(e,E,H,N){var u,z,P,A;if(M(H),void 0===(z=e._events)?(z=e._events=Object.create(null),e._eventsCount=0):(void 0!==z.newListener&&(e.emit("newListener",E,H.listener?H.listener:H),z=e._events),P=z[E]),void 0===P)P=z[E]=H,++e._eventsCount;else if("function"===typeof P?P=z[E]=N?[H,P]:[P,H]:N?P.unshift(H):P.push(H),(u=D(e))>0&&P.length>u&&!P.warned){P.warned=!0;var C=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");C.name="MaxListenersExceededWarning",C.NE=e,C.type=E,C.count=P.length,A=C,console&&console.warn&&console.warn(A)}return e}function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function i(e,E,H){var N={fired:!1,wrapFn:void 0,target:e,type:E,listener:H},u=C.bind(N);return u.listener=H,N.wrapFn=u,u}function V(e,E,H){var N=e._events;if(void 0===N)return[];var u=N[E];return void 0===u?[]:"function"===typeof u?H?[u.listener||u]:[u]:H?function(e){for(var E=new Array(e.length),H=0;H<E.length;++H)E[H]=e[H].listener||e[H];return E}(u):j(u,u.length)}function U(e){var E=this._events;if(void 0!==E){var H=E[e];if("function"===typeof H)return 1;if(void 0!==H)return H.length}return 0}function j(e,E){for(var H=new Array(E),N=0;N<E;++N)H[N]=e[N];return H}function F(e,E,H,N){if("function"===typeof e.on)N.once?e.once(E,H):e.on(E,H);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(E,(function u(z){N.once&&e.removeEventListener(E,u),H(z)}))}}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return P},set:function(e){if("number"!==typeof e||e<0||u(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");P=e}}),z.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},z.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||u(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},z.prototype.getMaxListeners=function(){return D(this)},z.prototype.emit=function(e){for(var E=[],H=1;H<arguments.length;H++)E.push(arguments[H]);var u="error"===e,z=this._events;if(void 0!==z)u=u&&void 0===z.error;else if(!u)return!1;if(u){var P;if(E.length>0&&(P=E[0]),P instanceof Error)throw P;var M=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw M.context=P,M}var D=z[e];if(void 0===D)return!1;if("function"===typeof D)N(D,this,E);else{var A=D.length,C=j(D,A);for(H=0;H<A;++H)N(C[H],this,E)}return!0},z.prototype.addListener=function(e,E){return A(this,e,E,!1)},z.prototype.on=z.prototype.addListener,z.prototype.prependListener=function(e,E){return A(this,e,E,!0)},z.prototype.once=function(e,E){return M(E),this.on(e,i(this,e,E)),this},z.prototype.prependOnceListener=function(e,E){return M(E),this.prependListener(e,i(this,e,E)),this},z.prototype.removeListener=function(e,E){var H,N,u,z,P;if(M(E),void 0===(N=this._events))return this;if(void 0===(H=N[e]))return this;if(H===E||H.listener===E)0===--this._eventsCount?this._events=Object.create(null):(delete N[e],N.removeListener&&this.emit("removeListener",e,H.listener||E));else if("function"!==typeof H){for(u=-1,z=H.length-1;z>=0;z--)if(H[z]===E||H[z].listener===E){P=H[z].listener,u=z;break}if(u<0)return this;0===u?H.shift():function(e,E){for(;E+1<e.length;E++)e[E]=e[E+1];e.pop()}(H,u),1===H.length&&(N[e]=H[0]),void 0!==N.removeListener&&this.emit("removeListener",e,P||E)}return this},z.prototype.off=z.prototype.removeListener,z.prototype.uE=function(e){var E,H,N;if(void 0===(H=this._events))return this;if(void 0===H.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==H[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete H[e]),this;if(0===arguments.length){var u,z=Object.keys(H);for(N=0;N<z.length;++N)"removeListener"!==(u=z[N])&&this.uE(u);return this.uE("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(E=H[e]))this.removeListener(e,E);else if(void 0!==E)for(N=E.length-1;N>=0;N--)this.removeListener(e,E[N]);return this},z.prototype.listeners=function(e){return V(this,e,!0)},z.prototype.rawListeners=function(e){return V(this,e,!1)},z.listenerCount=function(e,E){return"function"===typeof e.listenerCount?e.listenerCount(E):U.call(e,E)},z.prototype.listenerCount=U,z.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},13922:e=>{"use strict";e.exports=function(e,E,H,N,u,z){var P=+E[0],M=+E[1],D=+E[2],A=+H[0],C=+H[1],i=+H[2],V=Math.sqrt(A*A+C*C+i*i);if(0===V)throw new Error("Can't raycast along a zero vector");return function(e,E,H,N,u,z,P,M,D,A){for(var C=0,i=Math.floor,V=0|i(E),U=0|i(H),j=0|i(N),F=u>0?1:-1,h=z>0?1:-1,S=P>0?1:-1,X=Math.abs(1/u),a=Math.abs(1/z),W=Math.abs(1/P),r=X<1/0?X*(F>0?V+1-E:E-V):1/0,Y=a<1/0?a*(h>0?U+1-H:H-U):1/0,f=W<1/0?W*(S>0?j+1-N:N-j):1/0,w=-1;C<=M;){var s=e(V,U,j);if(s)return D&&(D[0]=E+C*u,D[1]=H+C*z,D[2]=N+C*P),A&&(A[0]=A[1]=A[2]=0,0===w&&(A[0]=-F),1===w&&(A[1]=-h),2===w&&(A[2]=-S)),s;r<Y?r<f?(V+=F,C=r,r+=X,w=0):(j+=S,C=f,f+=W,w=2):Y<f?(U+=h,C=Y,Y+=a,w=1):(j+=S,C=f,f+=W,w=2)}return D&&(D[0]=E+C*u,D[1]=H+C*z,D[2]=N+C*P),A&&(A[0]=A[1]=A[2]=0),0}(e,P,M,D,A/=V,C/=V,i/=V,N="undefined"===typeof N?64:+N,u,z)}},13951:(e,E,H)=>{"use strict";H.d(E,{b:()=>z});var N=H(13633);function u(){this.gi=!1,this.stopPropagation=!1,this.xi=!1,this.disabled=!1}class z{constructor(e,E){this.version="0.7.0";var H=Object.assign({},new u,E||{});this.element=e||document,this.gi=!!H.gi,this.stopPropagation=!!H.stopPropagation,this.xi=!!H.xi,this.disabled=!!H.disabled,this.filterEvents=(e,E)=>!0,this.down=new N.EventEmitter,this.up=new N.EventEmitter,this.state={},this.WA={dx:0,dy:0,QV:0,aA:0,ZV:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?M(this):document.addEventListener("DOMContentLoaded",(e=>{M(this)}),{once:!0})}bind(e){for(var E=arguments.length,H=new Array(E>1?E-1:0),N=1;N<E;N++)H[N-1]=arguments[N];H.forEach((E=>{var H=this._keyBindmap[E]||[];H.includes(e)||(H.push(e),this._keyBindmap[E]=H)})),this.state[e]=!!this.state[e],this.pressCount[e]=this.pressCount[e]||0,this.releaseCount[e]=this.releaseCount[e]||0}unbind(e){for(var E in this._keyBindmap){var H=this._keyBindmap[E],N=H.indexOf(e);N>-1&&H.splice(N,1)}}getBindings(){var e={};for(var E in this._keyBindmap){this._keyBindmap[E].forEach((H=>{e[H]=e[H]||[],e[H].push(E)}))}return e}BP(){P(this.WA),P(this.pressCount),P(this.releaseCount)}}function P(e){for(var E in e)e[E]=0}function M(e){window.addEventListener("keydown",j.bind(null,e,!0),!1),window.addEventListener("keyup",j.bind(null,e,!1),!1);var E={passive:!0};e.element.addEventListener("touchstart",i.bind(void 0,e),{passive:!1}),e.element.addEventListener("touchend",U.bind(void 0,e),E),e.element.addEventListener("mousedown",F.bind(null,e,!0),E),window.document.addEventListener("mouseup",F.bind(null,e,!1),E),e.element.addEventListener("touchmove",h.bind(null,e),E),e.element.addEventListener("mousemove",h.bind(null,e),E),window.PointerEvent,e.element.addEventListener("wheel",S.bind(null,e),E),e.element.addEventListener("contextmenu",X.bind(null,e),!1),window.addEventListener("blur",a.bind(null,e),!1)}var D=0,A=0,C=null;function i(e,E){E.preventDefault(),V(E)}function V(e){let E=!1;for(let H=0;H<e.touches.length;++H)if(e.touches[H].identifier===C){E=!0;break}if(!E){const E=e.changedTouches[0];D=E.clientX,A=E.clientY,C=E.identifier}}function U(e,E){for(var H=E.changedTouches,N=0;N<H.length;++N)H[N].identifier===C&&(C=null)}function j(e,E,H){W(H.code,E,e,H)}function F(e,E,H){if("pointerId"in H)if(E){if(null!==e._touches.currID)return;e._touches.currID=H.pointerId}else{if(e._touches.currID!==H.pointerId)return;e._touches.currID=null}return W("Mouse"+("button"in H?H.button+1:1),E,e,H),!1}function h(e,E){var H=E.movementX||E.mozMovementX||0,N=E.movementY||E.mozMovementY||0;if(E.touches&&0===(H|N)){var u=function(e){V(e);for(let E=0;E<e.changedTouches.length;++E)if(e.changedTouches[E].identifier==C){const H=e.changedTouches[E],N=[H.clientX-D,H.clientY-A];return D=H.clientX,A=H.clientY,N}return console.error(`Did not find touch id ${C}`),[0,0]}(E);H=u[0],N=u[1]}e.WA.dx+=H,e.WA.dy+=N}function S(e,E){var H=1;switch(E.deltaMode){case 0:H=1;break;case 1:H=12;break;case 2:H=e.element.clientHeight||window.innerHeight}e.WA.QV+=(E.deltaX||0)*H,e.WA.aA+=(E.deltaY||0)*H,e.WA.ZV+=(E.deltaZ||0)*H}function X(e,E){if(!e.xi)return E.preventDefault(),!1}function a(e){for(var E in e._keyStates)e._keyStates[E]&&(/^Mouse\d/.test(E)||W(E,!1,e,{code:E,note:"wsar5r0p5w",preventDefault:()=>{},stopPropagation:()=>{}}))}function W(e,E,H,N){var u=H._keyBindmap[e];u&&(r(H._keyStates[e],E)&&(H._keyStates[e]=E,u.forEach((e=>{(!H.filterEvents||H.filterEvents(N,e))&&function(e,E,H,N){var u=E?H.pressCount:H.releaseCount;u[e]=(u[e]||0)+1;var z=H._bindPressCount[e]||0;(z+=E?1:-1)<0&&(z=0);H._bindPressCount[e]=z;var P=H.state[e];if(r(P,z)){H.state[e]=z>0;var M=E?H.down:H.up;H.disabled||M.emit(e,N)}}(e,E,H,N)}))),"button"in N||(H.gi&&!N.defaultPrevented&&N.preventDefault(),H.stopPropagation&&N.stopPropagation()))}function r(e,E){return e?!E:E}},12596:e=>{e.exports=function(e,E,H){return e[0]=E[0]+H[0],e[1]=E[1]+H[1],e[2]=E[2]+H[2],e}},12558:(e,E,H)=>{e.exports=function(e,E){var H=N(e[0],e[1],e[2]),P=N(E[0],E[1],E[2]);u(H,H),u(P,P);var M=z(H,P);return M>1?0:Math.acos(M)};var N=H(12560),u=H(12566),z=H(12569)},12660:e=>{e.exports=function(e,E){return e[0]=Math.ceil(E[0]),e[1]=Math.ceil(E[1]),e[2]=Math.ceil(E[2]),e}},12553:e=>{e.exports=function(e){var E=new Float32Array(3);return E[0]=e[0],E[1]=e[1],E[2]=e[2],E}},12572:e=>{e.exports=function(e,E){return e[0]=E[0],e[1]=E[1],e[2]=E[2],e}},12545:e=>{e.exports=function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}},12732:e=>{e.exports=function(e,E,H){var N=E[0],u=E[1],z=E[2],P=H[0],M=H[1],D=H[2];return e[0]=u*D-z*M,e[1]=z*P-N*D,e[2]=N*M-u*P,e}},12686:(e,E,H)=>{e.exports=H(12679)},12679:e=>{e.exports=function(e,E){var H=E[0]-e[0],N=E[1]-e[1],u=E[2]-e[2];return Math.sqrt(H*H+N*N+u*u)}},12634:(e,E,H)=>{e.exports=H(12626)},12626:e=>{e.exports=function(e,E,H){return e[0]=E[0]/H[0],e[1]=E[1]/H[1],e[2]=E[2]/H[2],e}},12569:e=>{e.exports=function(e,E){return e[0]*E[0]+e[1]*E[1]+e[2]*E[2]}},12543:e=>{e.exports=1e-6},12587:(e,E,H)=>{e.exports=function(e,E){var H=e[0],u=e[1],z=e[2],P=E[0],M=E[1],D=E[2];return Math.abs(H-P)<=N*Math.max(1,Math.abs(H),Math.abs(P))&&Math.abs(u-M)<=N*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(z-D)<=N*Math.max(1,Math.abs(z),Math.abs(D))};var N=H(12543)},12590:e=>{e.exports=function(e,E){return e[0]===E[0]&&e[1]===E[1]&&e[2]===E[2]}},12653:e=>{e.exports=function(e,E){return e[0]=Math.floor(E[0]),e[1]=Math.floor(E[1]),e[2]=Math.floor(E[2]),e}},12781:(e,E,H)=>{e.exports=function(e,E,H,u,z,P){var M,D;E||(E=3);H||(H=0);D=u?Math.min(u*E+H,e.length):e.length;for(M=H;M<D;M+=E)N[0]=e[M],N[1]=e[M+1],N[2]=e[M+2],z(N,N,P),e[M]=N[0],e[M+1]=N[1],e[M+2]=N[2];return e};var N=H(12545)()},12560:e=>{e.exports=function(e,E,H){var N=new Float32Array(3);return N[0]=e,N[1]=E,N[2]=H,N}},12537:(e,E,H)=>{e.exports={EPSILON:H(12543),create:H(12545),clone:H(12553),angle:H(12558),TP:H(12560),k:H(12572),set:H(12579),equals:H(12587),exactEquals:H(12590),add:H(12596),FE:H(12605),sub:H(12613),multiply:H(12615),mul:H(12623),divide:H(12626),div:H(12634),min:H(12643),max:H(12646),floor:H(12653),ceil:H(12660),round:H(12665),scale:H(12672),LP:H(12677),distance:H(12679),i:H(12686),squaredDistance:H(12692),sqrDist:H(12696),length:H(12704),len:H(12711),squaredLength:H(12716),dP:H(12718),negate:H(12722),inverse:H(12726),normalize:H(12566),dot:H(12569),cross:H(12732),OP:H(12737),random:H(12741),transformMat4:H(12750),transformMat3:H(12756),transformQuat:H(12760),GP:H(12762),mM:H(12768),QP:H(12777),forEach:H(12781)}},12726:e=>{e.exports=function(e,E){return e[0]=1/E[0],e[1]=1/E[1],e[2]=1/E[2],e}},12711:(e,E,H)=>{e.exports=H(12704)},12704:e=>{e.exports=function(e){var E=e[0],H=e[1],N=e[2];return Math.sqrt(E*E+H*H+N*N)}},12737:e=>{e.exports=function(e,E,H,N){var u=E[0],z=E[1],P=E[2];return e[0]=u+N*(H[0]-u),e[1]=z+N*(H[1]-z),e[2]=P+N*(H[2]-P),e}},12646:e=>{e.exports=function(e,E,H){return e[0]=Math.max(E[0],H[0]),e[1]=Math.max(E[1],H[1]),e[2]=Math.max(E[2],H[2]),e}},12643:e=>{e.exports=function(e,E,H){return e[0]=Math.min(E[0],H[0]),e[1]=Math.min(E[1],H[1]),e[2]=Math.min(E[2],H[2]),e}},12623:(e,E,H)=>{e.exports=H(12615)},12615:e=>{e.exports=function(e,E,H){return e[0]=E[0]*H[0],e[1]=E[1]*H[1],e[2]=E[2]*H[2],e}},12722:e=>{e.exports=function(e,E){return e[0]=-E[0],e[1]=-E[1],e[2]=-E[2],e}},12566:e=>{e.exports=function(e,E){var H=E[0],N=E[1],u=E[2],z=H*H+N*N+u*u;z>0&&(z=1/Math.sqrt(z),e[0]=E[0]*z,e[1]=E[1]*z,e[2]=E[2]*z);return e}},12741:e=>{e.exports=function(e,E){E=E||1;var H=2*Math.random()*Math.PI,N=2*Math.random()-1,u=Math.sqrt(1-N*N)*E;return e[0]=Math.cos(H)*u,e[1]=Math.sin(H)*u,e[2]=N*E,e}},12762:e=>{e.exports=function(e,E,H,N){var u=H[1],z=H[2],P=E[1]-u,M=E[2]-z,D=Math.sin(N),A=Math.cos(N);return e[0]=E[0],e[1]=u+P*A-M*D,e[2]=z+P*D+M*A,e}},12768:e=>{e.exports=function(e,E,H,N){var u=H[0],z=H[2],P=E[0]-u,M=E[2]-z,D=Math.sin(N),A=Math.cos(N);return e[0]=u+M*D+P*A,e[1]=E[1],e[2]=z+M*A-P*D,e}},12777:e=>{e.exports=function(e,E,H,N){var u=H[0],z=H[1],P=E[0]-u,M=E[1]-z,D=Math.sin(N),A=Math.cos(N);return e[0]=u+P*A-M*D,e[1]=z+P*D+M*A,e[2]=E[2],e}},12665:e=>{e.exports=function(e,E){return e[0]=Math.round(E[0]),e[1]=Math.round(E[1]),e[2]=Math.round(E[2]),e}},12672:e=>{e.exports=function(e,E,H){return e[0]=E[0]*H,e[1]=E[1]*H,e[2]=E[2]*H,e}},12677:e=>{e.exports=function(e,E,H,N){return e[0]=E[0]+H[0]*N,e[1]=E[1]+H[1]*N,e[2]=E[2]+H[2]*N,e}},12579:e=>{e.exports=function(e,E,H,N){return e[0]=E,e[1]=H,e[2]=N,e}},12696:(e,E,H)=>{e.exports=H(12692)},12718:(e,E,H)=>{e.exports=H(12716)},12692:e=>{e.exports=function(e,E){var H=E[0]-e[0],N=E[1]-e[1],u=E[2]-e[2];return H*H+N*N+u*u}},12716:e=>{e.exports=function(e){var E=e[0],H=e[1],N=e[2];return E*E+H*H+N*N}},12613:(e,E,H)=>{e.exports=H(12605)},12605:e=>{e.exports=function(e,E,H){return e[0]=E[0]-H[0],e[1]=E[1]-H[1],e[2]=E[2]-H[2],e}},12756:e=>{e.exports=function(e,E,H){var N=E[0],u=E[1],z=E[2];return e[0]=N*H[0]+u*H[3]+z*H[6],e[1]=N*H[1]+u*H[4]+z*H[7],e[2]=N*H[2]+u*H[5]+z*H[8],e}},12750:e=>{e.exports=function(e,E,H){var N=E[0],u=E[1],z=E[2],P=H[3]*N+H[7]*u+H[11]*z+H[15];return P=P||1,e[0]=(H[0]*N+H[4]*u+H[8]*z+H[12])/P,e[1]=(H[1]*N+H[5]*u+H[9]*z+H[13])/P,e[2]=(H[2]*N+H[6]*u+H[10]*z+H[14])/P,e}},12760:e=>{e.exports=function(e,E,H){var N=E[0],u=E[1],z=E[2],P=H[0],M=H[1],D=H[2],A=H[3],C=A*N+M*z-D*u,i=A*u+D*N-P*z,V=A*z+P*u-M*N,U=-P*N-M*u-D*z;return e[0]=C*A+U*-P+i*-D-V*-M,e[1]=i*A+U*-M+V*-P-C*-D,e[2]=V*A+U*-D+C*-M-i*-P,e}},13659:e=>{"use strict";e.exports=function(e){for(var E=new Array(e),H=0;H<e;++H)E[H]=H;return E}},13721:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},13930:(e,E,H)=>{"use strict";H.d(E,{c:()=>N});class N{constructor(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.oC=!1,this.yC=!1,this.sC=30,this.pC=0,this.LC=!1,this.fullscreen=!1,this.KC=function(e){},this.lC=function(){},this.RC=function(){},this.pz=function(){},this.OC=function(e){},this.onFullscreenChanged=function(e){},A((()=>{!function(e,E){e._nowObject=performance||Date,e._lastTick=0,e._renderAccum=0,e._rt=0,e._frameCB=M.bind(null,e),requestAnimationFrame(e._frameCB),E>0&&(e._intervalCB=P.bind(null,e),e._interval=setInterval(e._intervalCB,Math.max(E,1e3/e.sC/2)))}(this,E),function(e,E){if(!E)return;var H=!1,N=!1;document.addEventListener("pointerlockchange",(N=>{H=document.pointerLockElement===E,e.OC(H)})),document.addEventListener("fullscreenchange",(H=>{N=document.fullscreenElement===E,e.onFullscreenChanged(N)})),Object.defineProperty(e,"LC",{get:()=>H,set:e=>{e&&!H?D(E):H&&!e&&function(e){e.exitPointerLock&&e.exitPointerLock()}(document)}}),Object.defineProperty(e,"fullscreen",{get:()=>N,set:e=>{e&&!N?E.requestFullscreen():N&&!e&&document.exitFullscreen()}}),E.addEventListener("click",(u=>{e.oC&&!H&&D(E),e.yC&&!N&&E.requestFullscreen()}));var u=()=>e.pz();if(window.ResizeObserver){new ResizeObserver(u).observe(E)}else window.addEventListener("resize",u)}(this,e),this.RC()}))}}var u=3,z=20;function P(e){for(var E=1e3/e.sC,H=e._nowObject.now()+z,N=0;e._nowObject.now()>=e._lastTick+E&&e._nowObject.now()<H&&++N<=u;)e.KC(E),e._lastTick+=E;var P=5*(E+5),M=e._nowObject.now();if(M-e._lastTick>P)for(;M>=e._lastTick+E;)e._lastTick+=E}function M(e){requestAnimationFrame(e._frameCB),P(e);var E=e._nowObject.now(),H=E-e._rt;if(e._rt=E,e.pC>0){e._renderAccum+=H;var N=1e3/e.pC;if(e._renderAccum<N)return;e._renderAccum=Math.min(e._renderAccum-N,N)}var u=1e3/e.sC,z=(E-e._lastTick)/u;e.lC(H,z,u)}function D(e){e.requestPointerLock&&e.requestPointerLock()}var A=e=>{if("loading"===document.readyState){var E=()=>{document.removeEventListener("readystatechange",E),e()};document.addEventListener("readystatechange",E)}else setTimeout(e,1)}},13651:(e,E,H)=>{var N=H(13659),u=H(13661),z="undefined"!==typeof Float64Array;function P(e,E){return e[0]-E[0]}function M(){var e,E=this.stride,H=new Array(E.length);for(e=0;e<H.length;++e)H[e]=[Math.abs(E[e]),e];H.sort(P);var N=new Array(H.length);for(e=0;e<N.length;++e)N[e]=H[e][1];return N}function D(e,E){var H=["View",E,"d",e].join("");E<0&&(H="View_Nil"+e);var u="generic"===e;if(-1===E){var z="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(z)()}if(0===E){z="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",z)(A[e][0])}z=["'use strict'"];var P=N(E),D=P.map((function(e){return"i"+e})),C="this.offset+"+P.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),i=P.map((function(e){return"b"+e})).join(","),V=P.map((function(e){return"c"+e})).join(",");z.push("function "+H+"(a,"+i+","+V+",d){this.data=a","this.shape=["+i+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+e+"'","proto.dimension="+E),z.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+P.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===E?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),E<4?(z.push("function "+H+"_order(){"),2===E?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+H+"_set("+D.join(",")+",v){"),u?z.push("return this.data.set("+C+",v)}"):z.push("return this.data["+C+"]=v}"),z.push("proto.get=function "+H+"_get("+D.join(",")+"){"),u?z.push("return this.data.get("+C+")}"):z.push("return this.data["+C+"]}"),z.push("proto.index=function "+H+"_index(",D.join(),"){return "+C+"}"),z.push("proto.hi=function "+H+"_hi("+D.join(",")+"){return new "+H+"(this.data,"+P.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+P.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var U=P.map((function(e){return"a"+e+"=this.shape["+e+"]"})),j=P.map((function(e){return"c"+e+"=this.stride["+e+"]"}));z.push("proto.lo=function "+H+"_lo("+D.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+j.join(","));for(var F=0;F<E;++F)z.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");z.push("return new "+H+"(this.data,"+P.map((function(e){return"a"+e})).join(",")+","+P.map((function(e){return"c"+e})).join(",")+",b)}"),z.push("proto.step=function "+H+"_step("+D.join(",")+"){var "+P.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+P.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<E;++F)z.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");z.push("return new "+H+"(this.data,"+P.map((function(e){return"a"+e})).join(",")+","+P.map((function(e){return"b"+e})).join(",")+",c)}");var h=new Array(E),S=new Array(E);for(F=0;F<E;++F)h[F]="a[i"+F+"]",S[F]="b[i"+F+"]";z.push("proto.transpose=function "+H+"_transpose("+D+"){"+D.map((function(e,E){return e+"=("+e+"===undefined?"+E+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+h.join(",")+","+S.join(",")+",this.offset)}"),z.push("proto.pick=function "+H+"_pick("+D+"){var a=[],b=[],c=this.offset");for(F=0;F<E;++F)z.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+P.map((function(e){return"shape["+e+"]"})).join(",")+","+P.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(A[e],M)}var A={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,E,H,N){if(void 0===e)return(0,A.array[0])([]);"number"===typeof e&&(e=[e]),void 0===E&&(E=[e.length]);var P=E.length;if(void 0===H){H=new Array(P);for(var M=P-1,C=1;M>=0;--M)H[M]=C,C*=E[M]}if(void 0===N){N=0;for(M=0;M<P;++M)H[M]<0&&(N-=(E[M]-1)*H[M])}for(var i=function(e){if(u(e))return"buffer";if(z)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),V=A[i];V.length<=P+1;)V.push(D(i,V.length-1));return(0,V[P+1])(e,E,H,N)}},13661:e=>{function E(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(E(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&E(e.slice(0,0))}(e)||!!e._isBuffer)}},13791:e=>{"use strict";var E=[],H=[],N=[],u=[],z=[],P=[],M=[],D=[],A=[],C=[],i=[],V=[];e.exports=function(e,U,j,F,h,S){for(var X=M,a=A,W=C,r=V,Y=0;Y<3;Y++)X[Y]=+j[Y],W[Y]=+U.max[Y],a[Y]=+U.base[Y];S||(S=1e-10);var f=function(e,M,A,C,V,U){var j=E,F=H,h=N,S=u,X=z,a=P,W=D,r=Math.floor,Y=0,f=0,w=0,s=0,p=0;if(o(),0===w)return 0;for(s=K();f<=w;){if(y(s)&&b())return Y;s=K()}for(Y+=w,p=0;p<3;p++)C[p]+=A[p],V[p]+=A[p];return Y;function o(){if(f=0,0!==(w=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2])))for(var e=0;e<3;e++){var E=A[e]>=0;S[e]=E?1:-1;var H=E?V[e]:C[e];j[e]=E?C[e]:V[e],F[e]=l(H,S[e]),h[e]=O(j[e],S[e]),W[e]=A[e]/w,X[e]=Math.abs(1/W[e]);var N=E?F[e]+1-H:H-F[e];a[e]=X[e]<1/0?X[e]*N:1/0}}function y(E){for(var H=S[0],N=0===E?F[0]:h[0],u=F[0]+H,z=S[1],P=1===E?F[1]:h[1],M=F[1]+z,D=S[2],A=2===E?F[2]:h[2],C=F[2]+D,i=N;i!=u;i+=H)for(var V=P;V!=M;V+=z)for(var U=A;U!=C;U+=D)if(e(i,V,U))return!0;return!1}function b(){Y+=f;var e=S[s],E=f/w,H=i;for(p=0;p<3;p++){var N=A[p]*E;C[p]+=N,V[p]+=N,H[p]=A[p]-N}if(e>0?V[s]=Math.round(V[s]):C[s]=Math.round(C[s]),M(Y,s,e,H))return!0;for(p=0;p<3;p++)A[p]=H[p];return o(),0===w}function K(){var e=a[0]<a[1]?a[0]<a[2]?0:2:a[1]<a[2]?1:2,E=a[e]-f;for(f=a[e],F[e]+=S[e],a[e]+=X[e],p=0;p<3;p++)j[p]+=E*W[p],h[p]=O(j[p],S[p]);return e}function l(e,E){return r(e-E*U)}function O(e,E){return r(e+E*U)}}(e,F,X,a,W,S);if(!h){for(Y=0;Y<3;Y++)r[Y]=j[Y]>0?W[Y]-U.max[Y]:a[Y]-U.base[Y];U.translate(r)}return f}},13959:(e,E,H)=>{"use strict";H.d(E,{e:()=>i});var N=H(13786),u=H(12537);class z{constructor(e,E,H,z,P,M,D){this.sA=new N(e.base,e.ZA),this.TN=E,this.friction=H,this.restitution=z,this.sP=P,this.DU=M,this.pP=!!D,this.QA=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.qU=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.EA=u.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=u.create(),this._impulses=u.create(),this._sleepFrameCount=10}loadFromCopy(e){u.k(this.sA.base,e.sA.base),u.k(this.sA.ZA,e.sA.ZA),u.k(this.sA.max,e.sA.max),this.sA.mag=e.sA.mag,this.TN=e.TN,this.friction=e.friction,this.restitution=e.restitution,this.sP=e.sP,this.DU=e.DU,this.pP=e.pP,this.QA=e.QA,this.fluidDrag=e.fluidDrag,this.qU=e.qU,this.preventFallOffEdge=e.preventFallOffEdge,this.rolledBackLastTick=e.rolledBackLastTick,u.k(this.EA,e.EA),u.k(this.resting,e.resting),this.inFluid=e.inFluid,this._ratioInFluid=e._ratioInFluid,u.k(this._forces,e._forces),u.k(this._impulses,e._impulses),this._sleepFrameCount=e._sleepFrameCount}setPosition(e){P(e),u.FE(e,e,this.sA.base),this.sA.translate(e),this.uA()}tz(){return u.clone(this.sA.base)}applyForce(e){P(e),u.add(this._forces,this._forces,e),this.uA()}applyImpulse(e){P(e),u.add(this._impulses,this._impulses,e),this.uA()}uA(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var P=e=>{};var M=H(13786),D=H(12537),A=H(13791);function C(){this.QA=.1,this.fluidDrag=.4,this.lP=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function i(e,E,H){e=Object.assign(new C,e),this.gravity=e.gravity||[0,-10,0],this.QA=e.QA||.1,this.lP=e.lP||2,this.fluidDrag=e.fluidDrag||.4,this.minBounceImpulse=e.minBounceImpulse,this.bodies=[],this.KV=e.KV,this.testSolid=E,this.testFluid=H}i.prototype.FU=function(e,E,H,N,u,P){e=e||new M([0,0,0],[1,1,1]),"undefined"==typeof E&&(E=1),"undefined"==typeof H&&(H=1),"undefined"==typeof N&&(N=0),"undefined"==typeof u&&(u=1);var D=new z(e,E,H,N,u,P);return this.bodies.push(D),D},i.prototype.hU=function(e){var E=this.bodies.indexOf(e);E<0||(this.bodies.splice(E,1),e.sA=e.DU=null)};var V=D.create(),U=D.create(),j=D.create(),F=D.create(),h=D.create(),S=D.create(),X=D.create(),a=new M([0,0,0],[1,1,1]),W=new z(a,1,1,0,1,(()=>{}),!1);function r(e,E,H){return E=H,E*=1-(1-e.ratioInFluid)**2}i.prototype.BP=function(e){e/=1e3;var E=d(0,D.squaredLength(this.gravity));this.bodies.forEach((H=>function(e,E,H,N){D.k(h,E.resting),e.KV&&W.loadFromCopy(E);if(E.TN<=0)return D.set(E.EA,0,0,0),D.set(E._forces,0,0,0),void D.set(E._impulses,0,0,0);var u=N||0===E.sP;if(function(e,E,H,N){if(E._sleepFrameCount>0)return!1;if(N)return!0;var u=!1,z=.5*H*H*E.sP;return D.scale(L,e.gravity,z),A(e.testSolid,E.sA,L,(function(){return u=!0,!0}),!0),u}(e,E,H,u))return;E._sleepFrameCount--,function(e,E){var H=E.sA,N=Math.floor(H.base[0]),u=Math.floor(H.base[2]),z=Math.floor(H.base[1]),P=Math.floor(H.max[1]);if(!e.testFluid(N,z,u))return E.inFluid=!1,void(E.ratioInFluid=0);var M=1,A=z+1;for(;A<=P&&e.testFluid(N,A,u);)M++,A++;var C=(z+M-H.base[1])/H.ZA[1];C>1&&(C=1);var i=H.ZA[0]*H.ZA[1]*H.ZA[2]*C,V=f;D.scale(V,e.gravity,-e.lP*i*E.sP),E.applyForce(V),E.inFluid=!0,E.ratioInFluid=C}(e,E),me(E._forces),me(E._impulses),me(E.EA),me(E.resting),D.scale(V,E._forces,1/E.TN),D.LP(V,V,e.gravity,E.sP),D.scale(U,E._impulses,1/E.TN),D.LP(U,U,V,H),D.add(E.EA,E.EA,U),E.friction&&(w(e,0,E,U,H),w(e,1,E,U,H),w(e,2,E,U,H));var z=E.fluidDrag>=0?E.fluidDrag:e.fluidDrag,P=E.QA>=0?E.QA:e.QA,M=P,C=P;E.inFluid&&(M=r(E,M,E.fluidDragHoriz>=0?E.fluidDragHoriz:z),C=r(E,C,E.fluidDragVert>=0?E.fluidDragVert:z));M=Math.max(1-M*H/E.TN,0),C=Math.max(1-C*H/E.TN,0),D.set(Y,M,C,M),D.multiply(E.EA,E.EA,Y),D.scale(j,E.EA,H),D.set(E._forces,0,0,0),D.set(E._impulses,0,0,0),E.pP&&G(o,E.sA);D.k(S,j),D.set(X,0,0,0),E.preventFallOffEdge&&function(e,E,H,N){if(!E.resting[1]||H[1]>0)return;var u=v;G(u,E.sA);for(var z=0;z<3;z+=2){D.set(O,0,0,0),O[z]=H[z];var P=!0;(P=(P=(P=(P=P&&!T(e,u.base[0]+O[0]+1e-5,u.base[1],u.base[2]+O[2]+1e-5))&&!T(e,u.max[0]+O[0]-1e-5,u.base[1],u.base[2]+O[2]+1e-5))&&!T(e,u.base[0]+O[0]+1e-5,u.base[1],u.max[2]+O[2]-1e-5))&&!T(e,u.max[0]+O[0]-1e-5,u.base[1],u.max[2]+O[2]-1e-5))?(N[z]=H[z]>0?1:-1,H[z]=0):0===z&&(D.set(R,H[0],0,0),p(e,u,R,N,E.slideOnCollision))}}(e,E,j,X);p(e,E.sA,j,E.resting,E.slideOnCollision),E.pP&&function(e,E,H,N){if(E.resting[1]>=0&&!E.inFluid)return;var u=0!==E.resting[0],z=0!==E.resting[2];if(!u&&!z)return;var P=Math.abs(N[0]/N[2]),M=4;if(!u&&P>M)return;if(!z&&P<1/M)return;D.add(b,H.base,N);var C=e.testSolid;A(C,H,N,(function(e,E,H,N){if(1!==E)return!0;N[E]=0}));var i=H.base[1],V=E.inFluid?1.951:1.001,U=Math.floor(i+V)-i;D.set(K,0,U,0);var j=!1;if(A(C,H,K,(function(e,E,H,N){return j=!0,!0})),j)return;D.FE(l,b,H.base),l[1]=0,p(e,H,l,y,!0);var F=d(H.base[0],b[0]),h=d(H.base[2],b[2]);if(u&&!F&&(!h||!z))return;if(z&&(!F||!u)&&!h)return;var S=!0;if(S=S&&!T(e,H.base[0]+1e-5,H.base[1],H.base[2]+1e-5),S=S&&!T(e,H.max[0]-1e-5,H.base[1],H.base[2]+1e-5),S=S&&!T(e,H.base[0]+1e-5,H.base[1],H.max[2]-1e-5),S=S&&!T(e,H.max[0]-1e-5,H.base[1],H.max[2]-1e-5),S)return;G(E.sA,H),E.resting[0]=y[0],E.resting[2]=y[2],E.qU&&E.qU()}(e,E,o,S);for(var i=0;i<3;++i)E.resting[i]=E.resting[i]||X[i],F[i]=0,E.resting[i]&&(h[i]||(F[i]=-E.EA[i]),E.EA[i]=0);var a=D.length(F);a>.001&&(D.scale(F,F,E.TN),E.DU&&E.DU(F),E.restitution>0&&a>e.minBounceImpulse&&(D.scale(F,F,E.restitution),E.applyImpulse(F)));var s=D.squaredLength(E.EA);s>1e-5&&E.uA();e.KV&&e.KV(E)?(E.loadFromCopy(W),E.rolledBackLastTick=!0):E.rolledBackLastTick=!1}(this,H,e,E)))};var Y=D.create([0,0,0]);var f=D.create();function w(e,E,H,N,u){var z=H.resting[E],P=N[E];if(!H.alwaysApplyHorizFriction||1!==E){if(0===z)return;if(z*P<=0)return}D.k(s,H.EA),s[E]=0;var M=D.length(s);if(!d(M,0)){var A=Math.abs(H.friction*e.gravity[E]*u),C=M>A?(M-A)/M:0;H.EA[(E+1)%3]*=C,H.EA[(E+2)%3]*=C}}var s=D.create();function p(e,E,H,N,u){return D.set(N,0,0,0),A(e.testSolid,E,H,(function(e,E,H,z){N[E]=H,z[E]=0,u||(z[0]=0,z[1]=0,z[2]=0)}))}var o=new M([],[]),y=D.create(),b=D.create(),K=D.create(),l=D.create();var O=D.create(),v=new M([],[]),R=D.create();function T(e,E,H,N){return e.testSolid(Math.floor(E),Math.floor(H-1),Math.floor(N))}var L=D.create();function d(e,E){return Math.abs(e-E)<1e-5}function G(e,E){for(var H=0;H<3;H++)e.base[H]=E.base[H],e.max[H]=E.max[H],e.ZA[H]=E.ZA[H]}var me=function(e){}},12407:function(e,E){!function(e){"use strict";var E=function(e,H){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,E){e.__proto__=E}||function(e,E){for(var H in E)Object.prototype.hasOwnProperty.call(E,H)&&(e[H]=E[H])},E(e,H)};function H(e,H){if("function"!==typeof H&&null!==H)throw new TypeError("Class extends value "+String(H)+" is not a constructor or null");function N(){this.constructor=e}E(e,H),e.prototype=null===H?Object.create(H):(N.prototype=H.prototype,new N)}function N(e,E,H,N){var u,z=arguments.length,P=z<3?E:null===N?N=Object.getOwnPropertyDescriptor(E,H):N;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)P=Reflect.decorate(e,E,H,N);else for(var M=e.length-1;M>=0;M--)(u=e[M])&&(P=(z<3?u(P):z>3?u(E,H,P):u(E,H))||P);return z>3&&P&&Object.defineProperty(E,H,P),P}function u(e,E,H){if(H||2===arguments.length)for(var N,u=0,z=E.length;u<z;u++)!N&&u in E||(N||(N=Array.prototype.slice.call(E,0,u)),N[u]=E[u]);return e.concat(N||Array.prototype.slice.call(E))}var z,P=255,M=213;e.OPERATION=void 0,(z=e.OPERATION||(e.OPERATION={}))[z.ADD=128]="ADD",z[z.REPLACE=0]="REPLACE",z[z.DELETE=64]="DELETE",z[z.DELETE_AND_ADD=192]="DELETE_AND_ADD",z[z.TOUCH=1]="TOUCH",z[z.CLEAR=10]="CLEAR";var D=function(){function E(e,E,H){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(E,H)}return E.prototype.setParent=function(e,E,H){var N=this;if(this.indexes||(this.indexes=this.ref instanceof le?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=H,E)if(this.root=E,this.ref instanceof le){var u=this.ref._definition;for(var z in u.schema){var P=this.ref[z];if(P&&P.$changes){var M=u.indexes[z];P.$changes.setParent(this.ref,E,M)}}}else"object"===typeof this.ref&&this.ref.forEach((function(e,E){if(e instanceof le){var H=e.$changes,u=N.ref.$changes.indexes[E];H.setParent(N.ref,N.root,u)}}))},E.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},E.prototype.change=function(E,H){void 0===H&&(H=e.OPERATION.ADD);var N="number"===typeof E?E:this.indexes[E];this.assertValidIndex(N,E);var u=this.changes.get(N);u&&u.op!==e.OPERATION.DELETE&&u.op!==e.OPERATION.TOUCH||this.changes.set(N,{op:u&&u.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:H,index:N}),this.allChanges.add(N),this.changed=!0,this.touchParents()},E.prototype.touch=function(E){var H="number"===typeof E?E:this.indexes[E];this.assertValidIndex(H,E),this.changes.has(H)||this.changes.set(H,{op:e.OPERATION.TOUCH,index:H}),this.allChanges.add(H),this.touchParents()},E.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},E.prototype.getType=function(e){if(this.ref._definition)return(E=this.ref._definition).schema[E.fieldsByIndex[e]];var E,H=(E=this.parent._definition).schema[E.fieldsByIndex[this.parentIndex]];return Object.values(H)[0]},E.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},E.prototype.getValue=function(e){return this.ref.getByIndex(e)},E.prototype.delete=function(E){var H="number"===typeof E?E:this.indexes[E];if(void 0!==H){var N=this.getValue(H);this.changes.set(H,{op:e.OPERATION.DELETE,index:H}),this.allChanges.delete(H),delete this.caches[H],N&&N.$changes&&(N.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(E," (").concat(H,")"))},E.prototype.discard=function(E,H){var N=this;void 0===E&&(E=!1),void 0===H&&(H=!1),this.ref instanceof le||this.changes.forEach((function(E){if(E.op===e.OPERATION.DELETE){var H=N.ref.getIndex(E.index);delete N.indexes[H]}})),this.changes.clear(),this.changed=E,H&&this.allChanges.clear(),this.currentCustomOperation=0},E.prototype.discardAll=function(){var e=this;this.changes.forEach((function(E){var H=e.getValue(E.index);H&&H.$changes&&H.$changes.discardAll()})),this.discard()},E.prototype.cache=function(e,E){this.caches[e]=E},E.prototype.clone=function(){return new E(this.ref,this.parent,this.root)},E.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},E.prototype.assertValidIndex=function(e,E){if(void 0===e)throw new Error('ChangeTree: missing index for field "'.concat(E,'"'))},E}();function A(e,E,H,N){return e[E]||(e[E]=[]),e[E].push(H),null===N||void 0===N||N.forEach((function(e,E){return H(e,E)})),function(){return i(e[E],e[E].indexOf(H))}}function C(E){var H=this,N="string"!==typeof this.$changes.getType();this.$items.forEach((function(u,z){E.push({refId:H.$changes.refId,op:e.OPERATION.DELETE,field:z,value:void 0,previousValue:u}),N&&H.$changes.root.removeRef(u.$changes.refId)}))}function i(e,E){if(-1===E||E>=e.length)return!1;for(var H=e.length-1,N=E;N<H;N++)e[N]=e[N+1];return e.length=H,!0}var V=function(e,E){var H=e.toString(),N=E.toString();return H<N?-1:H>N?1:0};function U(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,E){return"symbol"===typeof E||isNaN(E)?e[E]:e.at(E)},set:function(e,E,H){if("symbol"===typeof E||isNaN(E))e[E]=H;else{var N=Array.from(e.$items.keys()),u=parseInt(N[E]||E);void 0===H||null===H?e.deleteAt(u):e.setAt(u,H)}return!0},deleteProperty:function(e,E){return"number"===typeof E?e.deleteAt(E):delete e[E],!0}})}var j=function(){function E(){for(var e=[],E=0;E<arguments.length;E++)e[E]=arguments[E];this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return E.prototype.pM=function(E,H){return void 0===H&&(H=!0),A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,E,H?this.$items:void 0)},E.prototype.mz=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,E)},E.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(E.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),E.prototype.push=function(){for(var e,E=this,H=[],N=0;N<arguments.length;N++)H[N]=arguments[N];return H.forEach((function(H){e=E.$refId++,E.setAt(e,H)})),e},E.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var E=this.$items.get(e);return this.$items.delete(e),E}},E.prototype.at=function(e){var E=Array.from(this.$items.keys())[e];return this.$items.get(E)},E.prototype.setAt=function(E,H){var N,u;if(void 0!==H&&null!==H){if(this.$items.get(E)!==H){void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,E);var z=null!==(u=null===(N=this.$changes.indexes[E])||void 0===N?void 0:N.op)&&void 0!==u?u:e.OPERATION.ADD;this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,H),this.$changes.change(E,z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},E.prototype.deleteAt=function(e){var E=Array.from(this.$items.keys())[e];return void 0!==E&&this.$deleteAt(E)},E.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&C.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.concat=function(){for(var e,H=[],N=0;N<arguments.length;N++)H[N]=arguments[N];return new(E.bind.apply(E,u([void 0],(e=Array.from(this.$items.values())).concat.apply(e,H),!1)))},E.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},E.prototype.reverse=function(){var e=this,E=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(H,N){e.setAt(E[N],H)})),this},E.prototype.shift=function(){var e=Array.from(this.$items.keys()).shift();if(void 0!==e){var E=this.$items.get(e);return this.$deleteAt(e),E}},E.prototype.slice=function(e,H){var N=new E;return N.push.apply(N,Array.from(this.$items.values()).slice(e,H)),N},E.prototype.sort=function(e){var E=this;void 0===e&&(e=V);var H=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach((function(e,N){E.setAt(H[N],e)})),this},E.prototype.splice=function(e,E){void 0===E&&(E=this.length-e);for(var H=Array.from(this.$items.keys()),N=[],u=e;u<e+E;u++)N.push(this.$items.get(H[u])),this.$deleteAt(H[u]);return N},E.prototype.unshift=function(){for(var e=this,E=[],H=0;H<arguments.length;H++)E[H]=arguments[H];var N=this.length,u=E.length,z=Array.from(this.$items.values());return E.forEach((function(E,H){e.setAt(H,E)})),z.forEach((function(E,H){e.setAt(u+H,E)})),N+u},E.prototype.indexOf=function(e,E){return Array.from(this.$items.values()).indexOf(e,E)},E.prototype.lastIndexOf=function(e,E){return void 0===E&&(E=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,E)},E.prototype.every=function(e,E){return Array.from(this.$items.values()).every(e,E)},E.prototype.some=function(e,E){return Array.from(this.$items.values()).some(e,E)},E.prototype.forEach=function(e,E){Array.from(this.$items.values()).forEach(e,E)},E.prototype.map=function(e,E){return Array.from(this.$items.values()).map(e,E)},E.prototype.filter=function(e,E){return Array.from(this.$items.values()).filter(e,E)},E.prototype.reduce=function(e,E){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},E.prototype.reduceRight=function(e,E){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},E.prototype.find=function(e,E){return Array.from(this.$items.values()).find(e,E)},E.prototype.findIndex=function(e,E){return Array.from(this.$items.values()).findIndex(e,E)},E.prototype.fill=function(e,E,H){throw new Error("ArraySchema#fill() not implemented")},E.prototype.copyWithin=function(e,E,H){throw new Error("ArraySchema#copyWithin() not implemented")},E.prototype.toString=function(){return this.$items.toString()},E.prototype.toLocaleString=function(){return this.$items.toLocaleString()},E.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},E.prototype.includes=function(e,E){return Array.from(this.$items.values()).includes(e,E)},E.prototype.flatMap=function(e,E){throw new Error("ArraySchema#flatMap() is not supported.")},E.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},E.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},E.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},E.prototype.setIndex=function(e,E){this.$indexes.set(e,E)},E.prototype.getIndex=function(e){return this.$indexes.get(e)},E.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},E.prototype.deleteByIndex=function(e){var E=this.$indexes.get(e);this.$items.delete(E),this.$indexes.delete(e)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"===typeof e.toJSON?e.toJSON():e}))},E.prototype.clone=function(e){return e?new(E.bind.apply(E,u([void 0],Array.from(this.$items.values()),!1))):new(E.bind.apply(E,u([void 0],this.map((function(e){return e.$changes?e.clone():e})),!1)))},E}();function F(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,E){return"symbol"!==typeof E&&"undefined"===typeof e[E]?e.get(E):e[E]},set:function(e,E,H){return"symbol"!==typeof E&&-1===E.indexOf("$")&&"pM"!==E&&"mz"!==E&&"onChange"!==E?e.set(E,H):e[E]=H,!0},deleteProperty:function(e,E){return e.delete(E),!0}})}var h=function(){function E(e){var H=this;if(this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof E)e.forEach((function(e,E){return H.set(E,e)}));else for(var N in e)this.set(N,e[N])}return E.prototype.pM=function(E,H){return void 0===H&&(H=!0),A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,E,H?this.$items:void 0)},E.prototype.mz=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,E)},E.is=function(e){return void 0!==e.map},E.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(E.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.set=function(E,H){if(void 0===H||null===H)throw new Error("MapSchema#set('".concat(E,"', ").concat(H,"): trying to set ").concat(H," value on '").concat(E,"'."));E=E.toString();var N="undefined"!==typeof this.$changes.indexes[E],u=N?this.$changes.indexes[E]:this.$refId++,z=N?e.OPERATION.REPLACE:e.OPERATION.ADD,P=void 0!==H.$changes;if(P&&H.$changes.setParent(this,this.$changes.root,u),N){if(!P&&this.$items.get(E)===H)return;P&&this.$items.get(E)!==H&&(z=e.OPERATION.ADD)}else this.$changes.indexes[E]=u,this.$indexes.set(u,E);return this.$items.set(E,H),this.$changes.change(E,z),this},E.prototype.get=function(e){return this.$items.get(e)},E.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&C.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(e){return this.$items.has(e)},E.prototype.forEach=function(e){this.$items.forEach(e)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(e,E){this.$indexes.set(e,E)},E.prototype.getIndex=function(e){return this.$indexes.get(e)},E.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},E.prototype.deleteByIndex=function(e){var E=this.$indexes.get(e);this.$items.delete(E),this.$indexes.delete(e)},E.prototype.toJSON=function(){var e={};return this.forEach((function(E,H){e[H]="function"===typeof E.toJSON?E.toJSON():E})),e},E.prototype.clone=function(e){var H;return e?H=Object.assign(new E,this):(H=new E,this.forEach((function(e,E){e.$changes?H.set(E,e.clone()):H.set(E,e)}))),H},E}(),S={};function X(e,E){S[e]=E}function a(e){return S[e]}var W=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(E){var H=new e;return H.schema=Object.assign({},E&&E.schema||{}),H.indexes=Object.assign({},E&&E.indexes||{}),H.fieldsByIndex=Object.assign({},E&&E.fieldsByIndex||{}),H.descriptors=Object.assign({},E&&E.descriptors||{}),H.deprecated=Object.assign({},E&&E.deprecated||{}),H},e.prototype.addField=function(e,E){var H=this.getNextFieldIndex();this.fieldsByIndex[H]=e,this.indexes[e]=H,this.schema[e]=Array.isArray(E)?{array:E[0]}:E},e.prototype.hasField=function(e){return void 0!==this.indexes[e]},e.prototype.addFilter=function(e,E){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=E,this.indexesWithFilters.push(this.indexes[e]),!0},e.prototype.addChildrenFilter=function(e,E){var H=this.indexes[e],N=this.schema[e];if(a(Object.keys(N)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[H]=E,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}();function r(e){return e._context&&e._context.useFilters}var Y=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,E){void 0===E&&(E=this.schemas.size),e._definition=W.create(e._definition),e._typeid=E,this.types[E]=e,this.schemas.set(e,E)},e.create=function(E){return void 0===E&&(E={}),function(H){return E.context||(E.context=new e),w(H,E)}},e}(),f=new Y;function w(e,E){return void 0===E&&(E={}),function(H,N){var z=E.context||f,P=H.constructor;if(P._context=z,!e)throw new Error("".concat(P.name,': @type() reference provided for "').concat(N,"\" is undefined. Make sure you don't have any circular dependencies."));z.has(P)||z.add(P);var M=P._definition;if(M.addField(N,e),M.descriptors[N]){if(M.deprecated[N])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(N,"' definition on '").concat(P.name,"'.\nCheck @type() annotation"))}catch(S){var D=S.stack.split("\n")[4].trim();throw new Error("".concat(S.message," ").concat(D))}}var A=j.is(e),C=!A&&h.is(e);if("string"!==typeof e&&!le.is(e)){var i=Object.values(e)[0];"string"===typeof i||z.has(i)||z.add(i)}if(E.manual)M.descriptors[N]={enumerable:!0,configurable:!0,writable:!0};else{var V="_".concat(N);M.descriptors[V]={enumerable:!1,configurable:!1,writable:!0},M.descriptors[N]={get:function(){return this[V]},set:function(e){e!==this[V]&&(void 0!==e&&null!==e?(!A||e instanceof j||(e=new(j.bind.apply(j,u([void 0],e,!1)))),!C||e instanceof h||(e=new h(e)),void 0===e.$proxy&&(C?e=F(e):A&&(e=U(e))),this.$changes.change(N),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[N])):this[V]&&this.$changes.delete(N),this[V]=e)},enumerable:!0,configurable:!0}}}}function s(e){return function(E,H){var N=E.constructor;N._definition.addFilter(H,e)&&(N._context.useFilters=!0)}}function p(e){return function(E,H){var N=E.constructor;N._definition.addChildrenFilter(H,e)&&(N._context.useFilters=!0)}}function o(e){return void 0===e&&(e=!0),function(E,H){var N=E.constructor._definition;N.deprecated[H]=!0,e&&(N.descriptors[H]={get:function(){throw new Error("".concat(H," is deprecated."))},set:function(e){},enumerable:!1,configurable:!0})}}function y(e,E,H){for(var N in void 0===H&&(H={}),H.context||(H.context=e._context||H.context||f),E)w(E[N],H)(e.prototype,N);return e}function b(e){for(var E=0,H=0,N=0,u=e.length;N<u;N++)(E=e.charCodeAt(N))<128?H+=1:E<2048?H+=2:E<55296||E>=57344?H+=3:(N++,H+=4);return H}function K(e,E,H){for(var N=0,u=0,z=H.length;u<z;u++)(N=H.charCodeAt(u))<128?e[E++]=N:N<2048?(e[E++]=192|N>>6,e[E++]=128|63&N):N<55296||N>=57344?(e[E++]=224|N>>12,e[E++]=128|N>>6&63,e[E++]=128|63&N):(u++,N=65536+((1023&N)<<10|1023&H.charCodeAt(u)),e[E++]=240|N>>18,e[E++]=128|N>>12&63,e[E++]=128|N>>6&63,e[E++]=128|63&N)}function l(e,E){e.push(255&E)}function O(e,E){e.push(255&E)}function v(e,E){e.push(255&E),e.push(E>>8&255)}function R(e,E){e.push(255&E),e.push(E>>8&255)}function T(e,E){e.push(255&E),e.push(E>>8&255),e.push(E>>16&255),e.push(E>>24&255)}function L(e,E){var H=E>>24,N=E>>16,u=E>>8,z=E;e.push(255&z),e.push(255&u),e.push(255&N),e.push(255&H)}function d(e,E){var H=Math.floor(E/Math.pow(2,32));L(e,E>>>0),L(e,H)}function G(e,E){var H=E/Math.pow(2,32)|0;L(e,E>>>0),L(e,H)}function me(e,E){B(e,E)}function Q(e,E){I(e,E)}var Z=new Int32Array(2),k=new Float32Array(Z.buffer),J=new Float64Array(Z.buffer);function B(e,E){k[0]=E,T(e,Z[0])}function I(e,E){J[0]=E,T(e,Z[0]),T(e,Z[1])}function t(e,E){return O(e,E?1:0)}function q(e,E){E||(E="");var H=b(E),N=0;if(H<32)e.push(160|H),N=1;else if(H<256)e.push(217),O(e,H),N=2;else if(H<65536)e.push(218),R(e,H),N=3;else{if(!(H<4294967296))throw new Error("String too long");e.push(219),L(e,H),N=5}return K(e,e.length,E),N+H}function c(e,E){return isNaN(E)?c(e,0):isFinite(E)?E!==(0|E)?(e.push(203),I(e,E),9):E>=0?E<128?(O(e,E),1):E<256?(e.push(204),O(e,E),2):E<65536?(e.push(205),R(e,E),3):E<4294967296?(e.push(206),L(e,E),5):(e.push(207),G(e,E),9):E>=-32?(e.push(224|E+32),1):E>=-128?(e.push(208),l(e,E),2):E>=-32768?(e.push(209),v(e,E),3):E>=-2147483648?(e.push(210),T(e,E),5):(e.push(211),d(e,E),9):c(e,E>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var n=Object.freeze({__proto__:null,utf8Write:K,int8:l,uint8:O,int16:v,uint16:R,int32:T,uint32:L,int64:d,uint64:G,float32:me,float64:Q,writeFloat32:B,writeFloat64:I,boolean:t,string:q,number:c});function g(e,E,H){for(var N="",u=0,z=E,P=E+H;z<P;z++){var M=e[z];0!==(128&M)?192!==(224&M)?224!==(240&M)?240!==(248&M)?console.error("Invalid byte "+M.toString(16)):(u=(7&M)<<18|(63&e[++z])<<12|(63&e[++z])<<6|63&e[++z])>=65536?(u-=65536,N+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):N+=String.fromCharCode(u):N+=String.fromCharCode((15&M)<<12|(63&e[++z])<<6|63&e[++z]):N+=String.fromCharCode((31&M)<<6|63&e[++z]):N+=String.fromCharCode(M)}return N}function x(e,E){return ee(e,E)<<24>>24}function ee(e,E){return e[E.offset++]}function Ee(e,E){return He(e,E)<<16>>16}function He(e,E){return e[E.offset++]|e[E.offset++]<<8}function Ne(e,E){return e[E.offset++]|e[E.offset++]<<8|e[E.offset++]<<16|e[E.offset++]<<24}function ue(e,E){return Ne(e,E)>>>0}function ze(e,E){return Ve(e,E)}function Pe(e,E){return Ue(e,E)}function Me(e,E){var H=ue(e,E);return Ne(e,E)*Math.pow(2,32)+H}function De(e,E){var H=ue(e,E);return ue(e,E)*Math.pow(2,32)+H}var Ae=new Int32Array(2),Ce=new Float32Array(Ae.buffer),ie=new Float64Array(Ae.buffer);function Ve(e,E){return Ae[0]=Ne(e,E),Ce[0]}function Ue(e,E){return Ae[0]=Ne(e,E),Ae[1]=Ne(e,E),ie[0]}function je(e,E){return ee(e,E)>0}function Fe(e,E){var H,N=e[E.offset++];N<192?H=31&N:217===N?H=ee(e,E):218===N?H=He(e,E):219===N&&(H=ue(e,E));var u=g(e,E.offset,H);return E.offset+=H,u}function he(e,E){var H=e[E.offset];return H<192&&H>160||217===H||218===H||219===H}function Se(e,E){var H=e[E.offset++];return H<128?H:202===H?Ve(e,E):203===H?Ue(e,E):204===H?ee(e,E):205===H?He(e,E):206===H?ue(e,E):207===H?De(e,E):208===H?x(e,E):209===H?Ee(e,E):210===H?Ne(e,E):211===H?Me(e,E):H>223?-1*(255-H+1):void 0}function Xe(e,E){var H=e[E.offset];return H<128||H>=202&&H<=211}function ae(e,E){return e[E.offset]<160}function We(e,E){return e[E.offset-1]===P&&(e[E.offset]<128||e[E.offset]>=202&&e[E.offset]<=211)}var re=Object.freeze({__proto__:null,int8:x,uint8:ee,int16:Ee,uint16:He,int32:Ne,uint32:ue,float32:ze,float64:Pe,int64:Me,uint64:De,readFloat32:Ve,readFloat64:Ue,boolean:je,string:Fe,stringCheck:he,number:Se,numberCheck:Xe,arrayCheck:ae,switchStructureCheck:We}),Ye=function(){function E(e){var E=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return E.add(e)}))}return E.prototype.pM=function(E,H){return void 0===H&&(H=!0),A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,E,H?this.$items:void 0)},E.prototype.mz=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,E)},E.is=function(e){return void 0!==e.collection},E.prototype.add=function(e){var E=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,E),this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,e),this.$changes.change(E),E},E.prototype.at=function(e){var E=Array.from(this.$items.keys())[e];return this.$items.get(E)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(e){for(var E,H,N=this.$items.entries();(H=N.next())&&!H.done;)if(e===H.value[1]){E=H.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&C.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(e){return Array.from(this.$items.values()).some((function(E){return E===e}))},E.prototype.forEach=function(e){var E=this;this.$items.forEach((function(H,N,u){return e(H,N,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(e,E){this.$indexes.set(e,E)},E.prototype.getIndex=function(e){return this.$indexes.get(e)},E.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},E.prototype.deleteByIndex=function(e){var E=this.$indexes.get(e);this.$items.delete(E),this.$indexes.delete(e)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var e=[];return this.forEach((function(E,H){e.push("function"===typeof E.toJSON?E.toJSON():E)})),e},E.prototype.clone=function(e){var H;return e?H=Object.assign(new E,this):(H=new E,this.forEach((function(e){e.$changes?H.add(e.clone()):H.add(e)}))),H},E}(),fe=function(){function E(e){var E=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return E.add(e)}))}return E.prototype.pM=function(E,H){return void 0===H&&(H=!0),A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,E,H?this.$items:void 0)},E.prototype.mz=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,E)},E.is=function(e){return void 0!==e.set},E.prototype.add=function(E){var H,N;if(this.has(E))return!1;var u=this.$refId++;void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,u);var z=null!==(N=null===(H=this.$changes.indexes[u])||void 0===H?void 0:H.op)&&void 0!==N?N:e.OPERATION.ADD;return this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,E),this.$changes.change(u,z),u},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(e){for(var E,H,N=this.$items.entries();(H=N.next())&&!H.done;)if(e===H.value[1]){E=H.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&C.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(e){for(var E,H=this.$items.values(),N=!1;(E=H.next())&&!E.done;)if(e===E.value){N=!0;break}return N},E.prototype.forEach=function(e){var E=this;this.$items.forEach((function(H,N,u){return e(H,N,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(e,E){this.$indexes.set(e,E)},E.prototype.getIndex=function(e){return this.$indexes.get(e)},E.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},E.prototype.deleteByIndex=function(e){var E=this.$indexes.get(e);this.$items.delete(E),this.$indexes.delete(e)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var e=[];return this.forEach((function(E,H){e.push("function"===typeof E.toJSON?E.toJSON():E)})),e},E.prototype.clone=function(e){var H;return e?H=Object.assign(new E,this):(H=new E,this.forEach((function(e){e.$changes?H.add(e.clone()):H.add(e)}))),H},E}(),we=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},e.get=function(E){return void 0===E.$filterState&&(E.$filterState=new e),E.$filterState},e}(),se=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,E,H){void 0===H&&(H=!0),this.refs.set(e,E),H&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(E){if(!(e.refCounts[E]>0)){var H=e.refs.get(E);if(H instanceof le)for(var N in H._definition.schema)"string"!==typeof H._definition.schema[N]&&H[N]&&H[N].$changes&&e.removeRef(H[N].$changes.refId);else{var u=H.$changes.parent._definition,z=u.schema[u.fieldsByIndex[H.$changes.parentIndex]];"function"===typeof Object.values(z)[0]&&Array.from(H.values()).forEach((function(E){return e.removeRef(E.$changes.refId)}))}e.refs.delete(E),delete e.refCounts[E]}})),this.deletedRefs.clear()},e}(),pe=function(e){function E(){return null!==e&&e.apply(this,arguments)||this}return H(E,e),E}(Error);function oe(e,E,H,N){var u,z=!1;switch(E){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":u="number",isNaN(e)&&console.log('trying to encode "NaN" in '.concat(H.constructor.name,"#").concat(N));break;case"string":u="string",z=!0;break;case"boolean":return}if(typeof e!==u&&(!z||z&&null!==e)){var P="'".concat(JSON.stringify(e),"'").concat(e&&e.constructor&&" (".concat(e.constructor.name,")")||"");throw new pe("a '".concat(u,"' was expected, but ").concat(P," was provided in ").concat(H.constructor.name,"#").concat(N))}}function ye(e,E,H,N){if(!(e instanceof E))throw new pe("a '".concat(E.name,"' was expected, but '").concat(e.constructor.name,"' was provided in ").concat(H.constructor.name,"#").concat(N))}function be(e,E,H,N,u){oe(H,e,N,u);var z=n[e];if(!z)throw new pe("a '".concat(e,"' was expected, but ").concat(H," was provided in ").concat(N.constructor.name,"#").concat(u));z(E,H)}function Ke(e,E,H){return re[e](E,H)}var le=function(){function E(){for(var e=[],E=0;E<arguments.length;E++)e[E]=arguments[E];Object.defineProperties(this,{$changes:{value:new D(this,void 0,new se),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var H=this._definition.descriptors;H&&Object.defineProperties(this,H),e[0]&&this.assign(e[0])}return E.onError=function(e){console.error(e)},E.is=function(e){return e._definition&&void 0!==e._definition.schema},E.prototype.onChange=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,E)},E.prototype.mz=function(E){return A(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,E)},E.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(E.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),E.prototype.setDirty=function(e,E){this.$changes.change(e,E)},E.prototype.listen=function(e,E,H){var N=this;return void 0===H&&(H=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(E),H&&void 0!==this[e]&&E(this[e],void 0),function(){return i(N.$callbacks[e],N.$callbacks[e].indexOf(E))}},E.prototype.decode=function(H,N,u){var z;void 0===N&&(N={offset:0}),void 0===u&&(u=this);var M=[],D=this.$changes.root,A=H.length,C=0;for(D.refs.set(C,this);N.offset<A;){var i=H[N.offset++];if(i!=P){var V=u.$changes,U=void 0!==u._definition,F=U?i>>6<<6:i;if(F!==e.OPERATION.CLEAR){var S=U?i%(F||255):Se(H,N),X=U?u._definition.fieldsByIndex[S]:"",W=V.getType(S),r=void 0,Y=void 0,f=void 0;if(U?Y=u["_".concat(X)]:(Y=u.getByIndex(S),(F&e.OPERATION.ADD)===e.OPERATION.ADD?(f=u instanceof h?Fe(H,N):S,u.setIndex(S,f)):f=u.getIndex(S)),(F&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(F!==e.OPERATION.DELETE_AND_ADD&&u.deleteByIndex(S),Y&&Y.$changes&&D.removeRef(Y.$changes.refId),r=null),void 0!==X){if(F===e.OPERATION.DELETE);else if(E.is(W)){var w=Se(H,N);if(r=D.refs.get(w),F!==e.OPERATION.REPLACE){var s=this.getSchemaType(H,N,W);r||((r=this.createTypeInstance(s)).$changes.refId=w,Y&&(r.$callbacks=Y.$callbacks,Y.$changes.refId&&w!==Y.$changes.refId&&D.removeRef(Y.$changes.refId))),D.addRef(w,r,r!==Y)}}else if("string"===typeof W)r=Ke(W,H,N);else{var p=a(Object.keys(W)[0]),o=Se(H,N),y=D.refs.has(o)?Y||D.refs.get(o):new p.constructor;if((r=y.clone(!0)).$changes.refId=o,Y&&(r.$callbacks=Y.$callbacks,Y.$changes.refId&&o!==Y.$changes.refId)){D.removeRef(Y.$changes.refId);for(var b=Y.entries(),K=void 0;(K=b.next())&&!K.done;){var l=(z=K.value)[0],O=z[1];M.push({refId:o,op:e.OPERATION.DELETE,field:l,value:void 0,previousValue:O})}}D.addRef(o,r,y!==Y)}if(null!==r&&void 0!==r)if(r.$changes&&r.$changes.setParent(V.ref,V.root,S),u instanceof E)u[X]=r;else if(u instanceof h)l=f,u.$items.set(l,r),u.$changes.allChanges.add(S);else if(u instanceof j)u.setAt(S,r);else if(u instanceof Ye){var v=u.add(r);u.setIndex(S,v)}else u instanceof fe&&!1!==(v=u.add(r))&&u.setIndex(S,v);Y!==r&&M.push({refId:C,op:F,field:X,dynamicIndex:f,value:r,previousValue:Y})}else{console.warn("@colyseus/schema: definition mismatch");for(var R={offset:N.offset};N.offset<A&&(!We(H,N)||(R.offset=N.offset+1,!D.refs.has(Se(H,R))));)N.offset++}}else u.clear(M)}else{C=Se(H,N);var T=D.refs.get(C);if(!T)throw new Error('"refId" not found: '.concat(C));u=T}}return this._triggerChanges(M),D.garbageCollectDeletedRefs(),M},E.prototype.encode=function(H,N,u){void 0===H&&(H=!1),void 0===N&&(N=[]),void 0===u&&(u=!1);for(var z=this.$changes,M=new WeakSet,D=[z],A=1,C=0;C<A;C++){var i=D[C],V=i.ref,U=V instanceof E;i.ensureRefId(),M.add(i),i!==z&&(i.changed||H)&&(O(N,P),c(N,i.refId));for(var j=H?Array.from(i.allChanges):Array.from(i.changes.values()),F=0,S=j.length;F<S;F++){var X=H?{op:e.OPERATION.ADD,index:j[F]}:j[F],W=X.index,r=U?V._definition.fieldsByIndex&&V._definition.fieldsByIndex[W]:W,Y=N.length;if(X.op!==e.OPERATION.TOUCH)if(U)O(N,W|X.op);else{if(O(N,X.op),X.op===e.OPERATION.CLEAR)continue;c(N,W)}if(U||(X.op&e.OPERATION.ADD)!=e.OPERATION.ADD||V instanceof h&&q(N,i.ref.$indexes.get(W)),X.op!==e.OPERATION.DELETE){var f=i.getType(W),w=i.getValue(W);if(w&&w.$changes&&!M.has(w.$changes)&&(D.push(w.$changes),w.$changes.ensureRefId(),A++),X.op!==e.OPERATION.TOUCH){if(E.is(f))ye(w,f,V,r),c(N,w.$changes.refId),(X.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(N,f,w.constructor);else if("string"===typeof f)be(f,N,w,V,r);else{var s=a(Object.keys(f)[0]);ye(V["_".concat(r)],s.constructor,V,r),c(N,w.$changes.refId)}u&&i.cache(W,N.slice(Y))}}}H||u||i.discard()}return N},E.prototype.encodeAll=function(e){return this.encode(!0,[],e)},E.prototype.applyFilters=function(H,N){var u,z;void 0===N&&(N=!1);for(var M=this,D=new Set,A=we.get(H),C=[this.$changes],i=1,V=[],U=function(U){var j=C[U];if(D.has(j.refId))return"continue";var F=j.ref,S=F instanceof E;O(V,P),c(V,j.refId);var X=A.refIds.has(j),a=N||!X;A.addRefId(j);var W=A.containerIndexes.get(j),r=a?Array.from(j.allChanges):Array.from(j.changes.values());!N&&S&&F._definition.indexesWithFilters&&F._definition.indexesWithFilters.forEach((function(E){!W.has(E)&&j.allChanges.has(E)&&(a?r.push(E):r.push({op:e.OPERATION.ADD,index:E}))}));for(var Y=0,f=r.length;Y<f;Y++){var w=a?{op:e.OPERATION.ADD,index:r[Y]}:r[Y];if(w.op!==e.OPERATION.CLEAR){var s=w.index;if(w.op!==e.OPERATION.DELETE){var p=j.getValue(s),o=j.getType(s);if(S){if((y=F._definition.filters&&F._definition.filters[s])&&!y.call(F,H,p,M)){p&&p.$changes&&D.add(p.$changes.refId);continue}}else{var y,b=j.parent;if((y=j.getChildrenFilter())&&!y.call(b,H,F.$indexes.get(s),p,M)){p&&p.$changes&&D.add(p.$changes.refId);continue}}if(p.$changes&&(C.push(p.$changes),i++),w.op!==e.OPERATION.TOUCH)if(w.op===e.OPERATION.ADD||S)V.push.apply(V,null!==(u=j.caches[s])&&void 0!==u?u:[]),W.add(s);else if(W.has(s))V.push.apply(V,null!==(z=j.caches[s])&&void 0!==z?z:[]);else{if(W.add(s),O(V,e.OPERATION.ADD),c(V,s),F instanceof h){var K=j.ref.$indexes.get(s);q(V,K)}p.$changes?c(V,p.$changes.refId):n[o](V,p)}else p.$changes&&!S&&(O(V,e.OPERATION.ADD),c(V,s),F instanceof h&&(K=j.ref.$indexes.get(s),q(V,K)),c(V,p.$changes.refId))}else S?O(V,w.op|s):(O(V,w.op),c(V,s))}else O(V,w.op)}},j=0;j<i;j++)U(j);return V},E.prototype.clone=function(){var e,E=new this.constructor,H=this._definition.schema;for(var N in H)"object"===typeof this[N]&&"function"===typeof(null===(e=this[N])||void 0===e?void 0:e.clone)?E[N]=this[N].clone():E[N]=this[N];return E},E.prototype.toJSON=function(){var e=this._definition.schema,E=this._definition.deprecated,H={};for(var N in e)E[N]||null===this[N]||"undefined"===typeof this[N]||(H[N]="function"===typeof this[N].toJSON?this[N].toJSON():this["_".concat(N)]);return H},E.prototype.discardAllChanges=function(){this.$changes.discardAll()},E.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},E.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},E.prototype.tryEncodeTypeId=function(e,E,H){E._typeid!==H._typeid&&(O(e,M),c(e,H._typeid))},E.prototype.getSchemaType=function(e,E,H){var N;return e[E.offset]===M&&(E.offset++,N=this.constructor._context.get(Se(e,E))),N||H},E.prototype.createTypeInstance=function(e){var E=new e;return E.$changes.root=this.$changes.root,E},E.prototype._triggerChanges=function(H){for(var N,u,z,P,M,D,A,C,i,V=new Set,U=this.$changes.root.refs,j=function(j){var F=H[j],h=F.refId,S=U.get(h),X=S.$callbacks;if((F.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&F.previousValue instanceof E&&(null===(u=null===(N=F.previousValue.$callbacks)||void 0===N?void 0:N[e.OPERATION.DELETE])||void 0===u||u.forEach((function(e){return e()}))),!X)return"continue";if(S instanceof E){if(!V.has(h))try{null===(z=null===X||void 0===X?void 0:X[e.OPERATION.REPLACE])||void 0===z||z.forEach((function(e){return e()}))}catch(a){E.onError(a)}try{X.hasOwnProperty(F.field)&&(null===(P=X[F.field])||void 0===P||P.forEach((function(e){return e(F.value,F.previousValue)})))}catch(a){E.onError(a)}}else F.op===e.OPERATION.ADD&&void 0===F.previousValue?null===(M=X[e.OPERATION.ADD])||void 0===M||M.forEach((function(e){var E;return e(F.value,null!==(E=F.dynamicIndex)&&void 0!==E?E:F.field)})):F.op===e.OPERATION.DELETE?void 0!==F.previousValue&&(null===(D=X[e.OPERATION.DELETE])||void 0===D||D.forEach((function(e){var E;return e(F.previousValue,null!==(E=F.dynamicIndex)&&void 0!==E?E:F.field)}))):F.op===e.OPERATION.DELETE_AND_ADD&&(void 0!==F.previousValue&&(null===(A=X[e.OPERATION.DELETE])||void 0===A||A.forEach((function(e){var E;return e(F.previousValue,null!==(E=F.dynamicIndex)&&void 0!==E?E:F.field)}))),null===(C=X[e.OPERATION.ADD])||void 0===C||C.forEach((function(e){var E;return e(F.value,null!==(E=F.dynamicIndex)&&void 0!==E?E:F.field)}))),F.value!==F.previousValue&&(null===(i=X[e.OPERATION.REPLACE])||void 0===i||i.forEach((function(e){var E;return e(F.value,null!==(E=F.dynamicIndex)&&void 0!==E?E:F.field)})));V.add(h)},F=0;F<H.length;F++)j(F)},E._definition=W.create(),E}();function Oe(e){for(var E=[e.$changes],H=1,N={},u=N,z=function(e){var H=E[e];H.changes.forEach((function(e){var E=H.ref,N=e.index,z=E._definition?E._definition.fieldsByIndex[N]:E.$indexes.get(N);u[z]=H.getValue(N)}))},P=0;P<H;P++)z(P);return N}var ve={context:new Y},Re=function(e){function E(){return null!==e&&e.apply(this,arguments)||this}return H(E,e),N([w("string",ve)],E.prototype,"name",void 0),N([w("string",ve)],E.prototype,"type",void 0),N([w("number",ve)],E.prototype,"referencedType",void 0),E}(le),Te=function(e){function E(){var E=null!==e&&e.apply(this,arguments)||this;return E.fields=new j,E}return H(E,e),N([w("number",ve)],E.prototype,"id",void 0),N([w([Re],ve)],E.prototype,"fields",void 0),E}(le),Le=function(e){function E(){var E=null!==e&&e.apply(this,arguments)||this;return E.types=new j,E}return H(E,e),E.encode=function(e){var H=e.constructor,N=new E;N.rootType=H._typeid;var u=function(e,E){for(var H in E){var u=new Re;u.name=H;var z=void 0;if("string"===typeof E[H])z=E[H];else{var P=E[H],M=void 0;le.is(P)?(z="ref",M=E[H]):"string"===typeof P[z=Object.keys(P)[0]]?z+=":"+P[z]:M=P[z],u.referencedType=M?M._typeid:-1}u.type=z,e.fields.push(u)}N.types.push(e)},z=H._context.types;for(var P in z){var M=new Te;M.id=Number(P),u(M,z[P]._definition.schema)}return N.encodeAll()},E.decode=function(e,N){var u=new Y,z=new E;z.decode(e,N);var P=z.types.reduce((function(e,E){var N=function(e){function E(){return null!==e&&e.apply(this,arguments)||this}return H(E,e),E}(le),z=E.id;return e[z]=N,u.add(N,z),e}),{});z.types.forEach((function(e){var E=P[e.id];e.fields.forEach((function(e){var H;if(void 0!==e.referencedType){var N=e.type,z=P[e.referencedType];if(!z){var M=e.type.split(":");N=M[0],z=M[1]}"ref"===N?w(z,{context:u})(E.prototype,e.name):w(((H={})[N]=z,H),{context:u})(E.prototype,e.name)}else w(e.type,{context:u})(E.prototype,e.name)}))}));var M=P[z.rootType],D=new M;for(var A in M._definition.schema){var C=M._definition.schema[A];"string"!==typeof C&&(D[A]="function"===typeof C?new C:new(a(Object.keys(C)[0]).constructor))}return D},N([w([Te],ve)],E.prototype,"types",void 0),N([w("number",ve)],E.prototype,"rootType",void 0),E}(le);X("map",{constructor:h}),X("array",{constructor:j}),X("set",{constructor:fe}),X("collection",{constructor:Ye}),e.ArraySchema=j,e.CollectionSchema=Ye,e.Context=Y,e.MapSchema=h,e.Reflection=Le,e.ReflectionField=Re,e.ReflectionType=Te,e.Schema=le,e.SchemaDefinition=W,e.SetSchema=fe,e.decode=re,e.defineTypes=y,e.deprecated=o,e.dumpChanges=Oe,e.encode=n,e.filter=s,e.filterChildren=p,e.hasFilter=r,e.registerType=X,e.type=w,Object.defineProperty(e,"__esModule",{value:!0})}(E)},13831:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13828:(e,E,H)=>{var N=H(13831),u=H(13839),z=Object.hasOwnProperty,P=Object.create(null);for(var M in N)z.call(N,M)&&(P[N[M]]=M);var D=e.exports={to:{},get:{}};function A(e,E,H){return Math.min(Math.max(E,e),H)}function C(e){var E=Math.round(e).toString(16).toUpperCase();return E.length<2?"0"+E:E}D.get=function(e){var E,H;switch(e.substring(0,3).toLowerCase()){case"hsl":E=D.get.hsl(e),H="hsl";break;case"hwb":E=D.get.hwb(e),H="hwb";break;default:E=D.get.rgb(e),H="rgb"}return E?{model:H,value:E}:null},D.get.rgb=function(e){if(!e)return null;var E,H,u,P=[0,0,0,1];if(E=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(u=E[2],E=E[1],H=0;H<3;H++){var M=2*H;P[H]=parseInt(E.slice(M,M+2),16)}u&&(P[3]=parseInt(u,16)/255)}else if(E=e.match(/^#([a-f0-9]{3,4})$/i)){for(u=(E=E[1])[3],H=0;H<3;H++)P[H]=parseInt(E[H]+E[H],16);u&&(P[3]=parseInt(u+u,16)/255)}else if(E=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(H=0;H<3;H++)P[H]=parseInt(E[H+1],0);E[4]&&(E[5]?P[3]=.01*parseFloat(E[4]):P[3]=parseFloat(E[4]))}else{if(!(E=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(E=e.match(/^(\w+)$/))?"transparent"===E[1]?[0,0,0,0]:z.call(N,E[1])?((P=N[E[1]])[3]=1,P):null:null;for(H=0;H<3;H++)P[H]=Math.round(2.55*parseFloat(E[H+1]));E[4]&&(E[5]?P[3]=.01*parseFloat(E[4]):P[3]=parseFloat(E[4]))}for(H=0;H<3;H++)P[H]=A(P[H],0,255);return P[3]=A(P[3],0,1),P},D.get.hsl=function(e){if(!e)return null;var E=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var H=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,A(parseFloat(E[2]),0,100),A(parseFloat(E[3]),0,100),A(isNaN(H)?1:H,0,1)]}return null},D.get.hwb=function(e){if(!e)return null;var E=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var H=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,A(parseFloat(E[2]),0,100),A(parseFloat(E[3]),0,100),A(isNaN(H)?1:H,0,1)]}return null},D.to.hex=function(){var e=u(arguments);return"#"+C(e[0])+C(e[1])+C(e[2])+(e[3]<1?C(Math.round(255*e[3])):"")},D.to.rgb=function(){var e=u(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},D.to.rgb.percent=function(){var e=u(arguments),E=Math.round(e[0]/255*100),H=Math.round(e[1]/255*100),N=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+E+"%, "+H+"%, "+N+"%)":"rgba("+E+"%, "+H+"%, "+N+"%, "+e[3]+")"},D.to.hsl=function(){var e=u(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},D.to.hwb=function(){var e=u(arguments),E="";return e.length>=4&&1!==e[3]&&(E=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+E+")"},D.to.keyword=function(e){return P[e.slice(0,3)]}},13819:(e,E,H)=>{const N=H(13828),u=H(13849),z=["keyword","gray","hex"],P={};for(const U of Object.keys(u))P[[...u[U].labels].sort().join("")]=U;const M={};function D(e,E){if(!(this instanceof D))return new D(e,E);if(E&&E in z&&(E=null),E&&!(E in u))throw new Error("Unknown model: "+E);let H,A;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof D)this.model=e.model,this.color=[...e.color],this.valpha=e.valpha;else if("string"===typeof e){const E=N.get(e);if(null===E)throw new Error("Unable to parse color from string: "+e);this.model=E.model,A=u[this.model].channels,this.color=E.value.slice(0,A),this.valpha="number"===typeof E.value[A]?E.value[A]:1}else if(e.length>0){this.model=E||"rgb",A=u[this.model].channels;const H=Array.prototype.slice.call(e,0,A);this.color=V(H,A),this.valpha="number"===typeof e[A]?e[A]:1}else if("number"===typeof e)this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;const E=Object.keys(e);"alpha"in e&&(E.splice(E.indexOf("alpha"),1),this.valpha="number"===typeof e.alpha?e.alpha:0);const N=E.sort().join("");if(!(N in P))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=P[N];const{labels:z}=u[this.model],M=[];for(H=0;H<z.length;H++)M.push(e[z[H]]);this.color=V(M)}if(M[this.model])for(A=u[this.model].channels,H=0;H<A;H++){const e=M[this.model][H];e&&(this.color[H]=e(this.color[H]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}D.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(e){let E=this.model in N.to?this:this.rgb();E=E.round("number"===typeof e?e:1);const H=1===E.valpha?E.color:[...E.color,this.valpha];return N.to[E.model](H)},percentString(e){const E=this.rgb().round("number"===typeof e?e:1),H=1===E.valpha?E.color:[...E.color,this.valpha];return N.to.rgb.percent(H)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const e={},{channels:E}=u[this.model],{labels:H}=u[this.model];for(let N=0;N<E;N++)e[H[N]]=this.color[N];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray(){const e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject(){const e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round(e){return e=Math.max(e||0,0),new D([...this.color.map(A(e)),this.valpha],this.model)},alpha(e){return void 0!==e?new D([...this.color,Math.max(0,Math.min(1,e))],this.model):this.valpha},red:C("rgb",0,i(255)),green:C("rgb",1,i(255)),blue:C("rgb",2,i(255)),hue:C(["hsl","hsv","hsl","hwb","hcg"],0,(e=>(e%360+360)%360)),saturationl:C("hsl",1,i(100)),lightness:C("hsl",2,i(100)),saturationv:C("hsv",1,i(100)),value:C("hsv",2,i(100)),chroma:C("hcg",1,i(100)),gray:C("hcg",2,i(100)),white:C("hwb",1,i(100)),wblack:C("hwb",2,i(100)),cyan:C("cmyk",0,i(100)),magenta:C("cmyk",1,i(100)),yellow:C("cmyk",2,i(100)),black:C("cmyk",3,i(100)),x:C("xyz",0,i(95.047)),y:C("xyz",1,i(100)),z:C("xyz",2,i(108.833)),l:C("lab",0,i(100)),a:C("lab",1),b:C("lab",2),keyword(e){return void 0!==e?new D(e):u[this.model].keyword(this.color)},hex(e){return void 0!==e?new D(e):N.to.hex(this.rgb().round().color)},hexa(e){if(void 0!==e)return new D(e);const E=this.rgb().round().color;let H=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===H.length&&(H="0"+H),N.to.hex(E)+H},rgbNumber(){const e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity(){const e=this.rgb().color,E=[];for(const[H,N]of e.entries()){const e=N/255;E[H]=e<=.04045?e/12.92:((e+.055)/1.055)**2.4}return.2126*E[0]+.7152*E[1]+.0722*E[2]},contrast(e){const E=this.luminosity(),H=e.luminosity();return E>H?(E+.05)/(H+.05):(H+.05)/(E+.05)},level(e){const E=this.contrast(e);return E>=7?"AAA":E>=4.5?"AA":""},isDark(){const e=this.rgb().color;return(2126*e[0]+7152*e[1]+722*e[2])/1e4<128},isLight(){return!this.isDark()},negate(){const e=this.rgb();for(let E=0;E<3;E++)e.color[E]=255-e.color[E];return e},lighten(e){const E=this.hsl();return E.color[2]+=E.color[2]*e,E},darken(e){const E=this.hsl();return E.color[2]-=E.color[2]*e,E},saturate(e){const E=this.hsl();return E.color[1]+=E.color[1]*e,E},desaturate(e){const E=this.hsl();return E.color[1]-=E.color[1]*e,E},whiten(e){const E=this.hwb();return E.color[1]+=E.color[1]*e,E},blacken(e){const E=this.hwb();return E.color[2]+=E.color[2]*e,E},grayscale(){const e=this.rgb().color,E=.3*e[0]+.59*e[1]+.11*e[2];return D.rgb(E,E,E)},fade(e){return this.alpha(this.valpha-this.valpha*e)},opaquer(e){return this.alpha(this.valpha+this.valpha*e)},rotate(e){const E=this.hsl();let H=E.color[0];return H=(H+e)%360,H=H<0?360+H:H,E.color[0]=H,E},mix(e,E){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);const H=e.rgb(),N=this.rgb(),u=void 0===E?.5:E,z=2*u-1,P=H.alpha()-N.alpha(),M=((z*P===-1?z:(z+P)/(1+z*P))+1)/2,A=1-M;return D.rgb(M*H.red()+A*N.red(),M*H.green()+A*N.green(),M*H.blue()+A*N.blue(),H.alpha()*u+N.alpha()*(1-u))}};for(const U of Object.keys(u)){if(z.includes(U))continue;const{channels:e}=u[U];D.prototype[U]=function(){if(this.model===U)return new D(this);for(var e=arguments.length,E=new Array(e),H=0;H<e;H++)E[H]=arguments[H];return E.length>0?new D(E,U):new D([...(N=u[this.model][U].raw(this.color),Array.isArray(N)?N:[N]),this.valpha],U);var N},D[U]=function(){for(var E=arguments.length,H=new Array(E),N=0;N<E;N++)H[N]=arguments[N];let u=H[0];return"number"===typeof u&&(u=V(H,e)),new D(u,U)}}function A(e){return function(E){return function(e,E){return Number(e.toFixed(E))}(E,e)}}function C(e,E,H){e=Array.isArray(e)?e:[e];for(const N of e)(M[N]||(M[N]=[]))[E]=H;return e=e[0],function(N){let u;return void 0!==N?(H&&(N=H(N)),u=this[e](),u.color[E]=N,u):(u=this[e]().color[E],H&&(u=H(u)),u)}}function i(e){return function(E){return Math.max(0,Math.min(e,E))}}function V(e,E){for(let H=0;H<E;H++)"number"!==typeof e[H]&&(e[H]=0);return e}e.exports=D},13851:(e,E,H)=>{const N=H(13857),u={};for(const P of Object.keys(N))u[N[P]]=P;const z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=z;for(const P of Object.keys(z)){if(!("channels"in z[P]))throw new Error("missing channels property: "+P);if(!("labels"in z[P]))throw new Error("missing channel labels property: "+P);if(z[P].labels.length!==z[P].channels)throw new Error("channel and label counts mismatch: "+P);const{channels:e,labels:E}=z[P];delete z[P].channels,delete z[P].labels,Object.defineProperty(z[P],"channels",{value:e}),Object.defineProperty(z[P],"labels",{value:E})}z.rgb.hsl=function(e){const E=e[0]/255,H=e[1]/255,N=e[2]/255,u=Math.min(E,H,N),z=Math.max(E,H,N),P=z-u;let M,D;z===u?M=0:E===z?M=(H-N)/P:H===z?M=2+(N-E)/P:N===z&&(M=4+(E-H)/P),M=Math.min(60*M,360),M<0&&(M+=360);const A=(u+z)/2;return D=z===u?0:A<=.5?P/(z+u):P/(2-z-u),[M,100*D,100*A]},z.rgb.hsv=function(e){let E,H,N,u,z;const P=e[0]/255,M=e[1]/255,D=e[2]/255,A=Math.max(P,M,D),C=A-Math.min(P,M,D),i=function(e){return(A-e)/6/C+.5};return 0===C?(u=0,z=0):(z=C/A,E=i(P),H=i(M),N=i(D),P===A?u=N-H:M===A?u=1/3+E-N:D===A&&(u=2/3+H-E),u<0?u+=1:u>1&&(u-=1)),[360*u,100*z,100*A]},z.rgb.hwb=function(e){const E=e[0],H=e[1];let N=e[2];const u=z.rgb.hsl(e)[0],P=1/255*Math.min(E,Math.min(H,N));return N=1-1/255*Math.max(E,Math.max(H,N)),[u,100*P,100*N]},z.rgb.cmyk=function(e){const E=e[0]/255,H=e[1]/255,N=e[2]/255,u=Math.min(1-E,1-H,1-N);return[100*((1-E-u)/(1-u)||0),100*((1-H-u)/(1-u)||0),100*((1-N-u)/(1-u)||0),100*u]},z.rgb.keyword=function(e){const E=u[e];if(E)return E;let H,z=1/0;for(const u of Object.keys(N)){const E=N[u],D=(M=E,((P=e)[0]-M[0])**2+(P[1]-M[1])**2+(P[2]-M[2])**2);D<z&&(z=D,H=u)}var P,M;return H},z.keyword.rgb=function(e){return N[e]},z.rgb.xyz=function(e){let E=e[0]/255,H=e[1]/255,N=e[2]/255;E=E>.04045?((E+.055)/1.055)**2.4:E/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,N=N>.04045?((N+.055)/1.055)**2.4:N/12.92;return[100*(.4124*E+.3576*H+.1805*N),100*(.2126*E+.7152*H+.0722*N),100*(.0193*E+.1192*H+.9505*N)]},z.rgb.lab=function(e){const E=z.rgb.xyz(e);let H=E[0],N=E[1],u=E[2];H/=95.047,N/=100,u/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,N=N>.008856?N**(1/3):7.787*N+16/116,u=u>.008856?u**(1/3):7.787*u+16/116;return[116*N-16,500*(H-N),200*(N-u)]},z.hsl.rgb=function(e){const E=e[0]/360,H=e[1]/100,N=e[2]/100;let u,z,P;if(0===H)return P=255*N,[P,P,P];u=N<.5?N*(1+H):N+H-N*H;const M=2*N-u,D=[0,0,0];for(let A=0;A<3;A++)z=E+1/3*-(A-1),z<0&&z++,z>1&&z--,P=6*z<1?M+6*(u-M)*z:2*z<1?u:3*z<2?M+(u-M)*(2/3-z)*6:M,D[A]=255*P;return D},z.hsl.hsv=function(e){const E=e[0];let H=e[1]/100,N=e[2]/100,u=H;const z=Math.max(N,.01);N*=2,H*=N<=1?N:2-N,u*=z<=1?z:2-z;return[E,100*(0===N?2*u/(z+u):2*H/(N+H)),100*((N+H)/2)]},z.hsv.rgb=function(e){const E=e[0]/60,H=e[1]/100;let N=e[2]/100;const u=Math.floor(E)%6,z=E-Math.floor(E),P=255*N*(1-H),M=255*N*(1-H*z),D=255*N*(1-H*(1-z));switch(N*=255,u){case 0:return[N,D,P];case 1:return[M,N,P];case 2:return[P,N,D];case 3:return[P,M,N];case 4:return[D,P,N];case 5:return[N,P,M]}},z.hsv.hsl=function(e){const E=e[0],H=e[1]/100,N=e[2]/100,u=Math.max(N,.01);let z,P;P=(2-H)*N;const M=(2-H)*u;return z=H*u,z/=M<=1?M:2-M,z=z||0,P/=2,[E,100*z,100*P]},z.hwb.rgb=function(e){const E=e[0]/360;let H=e[1]/100,N=e[2]/100;const u=H+N;let z;u>1&&(H/=u,N/=u);const P=Math.floor(6*E),M=1-N;z=6*E-P,0!==(1&P)&&(z=1-z);const D=H+z*(M-H);let A,C,i;switch(P){default:case 6:case 0:A=M,C=D,i=H;break;case 1:A=D,C=M,i=H;break;case 2:A=H,C=M,i=D;break;case 3:A=H,C=D,i=M;break;case 4:A=D,C=H,i=M;break;case 5:A=M,C=H,i=D}return[255*A,255*C,255*i]},z.cmyk.rgb=function(e){const E=e[0]/100,H=e[1]/100,N=e[2]/100,u=e[3]/100;return[255*(1-Math.min(1,E*(1-u)+u)),255*(1-Math.min(1,H*(1-u)+u)),255*(1-Math.min(1,N*(1-u)+u))]},z.xyz.rgb=function(e){const E=e[0]/100,H=e[1]/100,N=e[2]/100;let u,z,P;return u=3.2406*E+-1.5372*H+-.4986*N,z=-.9689*E+1.8758*H+.0415*N,P=.0557*E+-.204*H+1.057*N,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,P=P>.0031308?1.055*P**(1/2.4)-.055:12.92*P,u=Math.min(Math.max(0,u),1),z=Math.min(Math.max(0,z),1),P=Math.min(Math.max(0,P),1),[255*u,255*z,255*P]},z.xyz.lab=function(e){let E=e[0],H=e[1],N=e[2];E/=95.047,H/=100,N/=108.883,E=E>.008856?E**(1/3):7.787*E+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*H-16,500*(E-H),200*(H-N)]},z.lab.xyz=function(e){let E,H,N;H=(e[0]+16)/116,E=e[1]/500+H,N=H-e[2]/200;const u=H**3,z=E**3,P=N**3;return H=u>.008856?u:(H-16/116)/7.787,E=z>.008856?z:(E-16/116)/7.787,N=P>.008856?P:(N-16/116)/7.787,E*=95.047,H*=100,N*=108.883,[E,H,N]},z.lab.lch=function(e){const E=e[0],H=e[1],N=e[2];let u;u=360*Math.atan2(N,H)/2/Math.PI,u<0&&(u+=360);return[E,Math.sqrt(H*H+N*N),u]},z.lch.lab=function(e){const E=e[0],H=e[1],N=e[2]/360*2*Math.PI;return[E,H*Math.cos(N),H*Math.sin(N)]},z.rgb.ansi16=function(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[H,N,u]=e;let P=null===E?z.rgb.hsv(e)[2]:E;if(P=Math.round(P/50),0===P)return 30;let M=30+(Math.round(u/255)<<2|Math.round(N/255)<<1|Math.round(H/255));return 2===P&&(M+=60),M},z.hsv.ansi16=function(e){return z.rgb.ansi16(z.hsv.rgb(e),e[2])},z.rgb.ansi256=function(e){const E=e[0],H=e[1],N=e[2];if(E===H&&H===N)return E<8?16:E>248?231:Math.round((E-8)/247*24)+232;return 16+36*Math.round(E/255*5)+6*Math.round(H/255*5)+Math.round(N/255*5)},z.ansi16.rgb=function(e){let E=e%10;if(0===E||7===E)return e>50&&(E+=3.5),E=E/10.5*255,[E,E,E];const H=.5*(1+~~(e>50));return[(1&E)*H*255,(E>>1&1)*H*255,(E>>2&1)*H*255]},z.ansi256.rgb=function(e){if(e>=232){const E=10*(e-232)+8;return[E,E,E]}let E;e-=16;return[Math.floor(e/36)/5*255,Math.floor((E=e%36)/6)/5*255,E%6/5*255]},z.rgb.hex=function(e){const E=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(E.length)+E},z.hex.rgb=function(e){const E=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!E)return[0,0,0];let H=E[0];3===E[0].length&&(H=H.split("").map((e=>e+e)).join(""));const N=parseInt(H,16);return[N>>16&255,N>>8&255,255&N]},z.rgb.hcg=function(e){const E=e[0]/255,H=e[1]/255,N=e[2]/255,u=Math.max(Math.max(E,H),N),z=Math.min(Math.min(E,H),N),P=u-z;let M,D;return M=P<1?z/(1-P):0,D=P<=0?0:u===E?(H-N)/P%6:u===H?2+(N-E)/P:4+(E-H)/P,D/=6,D%=1,[360*D,100*P,100*M]},z.hsl.hcg=function(e){const E=e[1]/100,H=e[2]/100,N=H<.5?2*E*H:2*E*(1-H);let u=0;return N<1&&(u=(H-.5*N)/(1-N)),[e[0],100*N,100*u]},z.hsv.hcg=function(e){const E=e[1]/100,H=e[2]/100,N=E*H;let u=0;return N<1&&(u=(H-N)/(1-N)),[e[0],100*N,100*u]},z.hcg.rgb=function(e){const E=e[0]/360,H=e[1]/100,N=e[2]/100;if(0===H)return[255*N,255*N,255*N];const u=[0,0,0],z=E%1*6,P=z%1,M=1-P;let D=0;switch(Math.floor(z)){case 0:u[0]=1,u[1]=P,u[2]=0;break;case 1:u[0]=M,u[1]=1,u[2]=0;break;case 2:u[0]=0,u[1]=1,u[2]=P;break;case 3:u[0]=0,u[1]=M,u[2]=1;break;case 4:u[0]=P,u[1]=0,u[2]=1;break;default:u[0]=1,u[1]=0,u[2]=M}return D=(1-H)*N,[255*(H*u[0]+D),255*(H*u[1]+D),255*(H*u[2]+D)]},z.hcg.hsv=function(e){const E=e[1]/100,H=E+e[2]/100*(1-E);let N=0;return H>0&&(N=E/H),[e[0],100*N,100*H]},z.hcg.hsl=function(e){const E=e[1]/100,H=e[2]/100*(1-E)+.5*E;let N=0;return H>0&&H<.5?N=E/(2*H):H>=.5&&H<1&&(N=E/(2*(1-H))),[e[0],100*N,100*H]},z.hcg.hwb=function(e){const E=e[1]/100,H=E+e[2]/100*(1-E);return[e[0],100*(H-E),100*(1-H)]},z.hwb.hcg=function(e){const E=e[1]/100,H=1-e[2]/100,N=H-E;let u=0;return N<1&&(u=(H-N)/(1-N)),[e[0],100*N,100*u]},z.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},z.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},z.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},z.gray.hsl=function(e){return[0,0,e[0]]},z.gray.hsv=z.gray.hsl,z.gray.hwb=function(e){return[0,100,e[0]]},z.gray.cmyk=function(e){return[0,0,0,e[0]]},z.gray.lab=function(e){return[e[0],0,0]},z.gray.hex=function(e){const E=255&Math.round(e[0]/100*255),H=((E<<16)+(E<<8)+E).toString(16).toUpperCase();return"000000".substring(H.length)+H},z.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},13849:(e,E,H)=>{const N=H(13851),u=H(13866),z={};Object.keys(N).forEach((e=>{z[e]={},Object.defineProperty(z[e],"channels",{value:N[e].channels}),Object.defineProperty(z[e],"labels",{value:N[e].labels});const E=u(e);Object.keys(E).forEach((H=>{const N=E[H];z[e][H]=function(e){const E=function(){for(var E=arguments.length,H=new Array(E),N=0;N<E;N++)H[N]=arguments[N];const u=H[0];if(void 0===u||null===u)return u;u.length>1&&(H=u);const z=e(H);if("object"===typeof z)for(let e=z.length,P=0;P<e;P++)z[P]=Math.round(z[P]);return z};return"conversion"in e&&(E.conversion=e.conversion),E}(N),z[e][H].raw=function(e){const E=function(){for(var E=arguments.length,H=new Array(E),N=0;N<E;N++)H[N]=arguments[N];const u=H[0];return void 0===u||null===u?u:(u.length>1&&(H=u),e(H))};return"conversion"in e&&(E.conversion=e.conversion),E}(N)}))})),e.exports=z},13866:(e,E,H)=>{const N=H(13851);function u(e){const E=function(){const e={},E=Object.keys(N);for(let H=E.length,N=0;N<H;N++)e[E[N]]={distance:-1,parent:null};return e}(),H=[e];for(E[e].distance=0;H.length;){const e=H.pop(),u=Object.keys(N[e]);for(let N=u.length,z=0;z<N;z++){const N=u[z],P=E[N];-1===P.distance&&(P.distance=E[e].distance+1,P.parent=e,H.unshift(N))}}return E}function z(e,E){return function(H){return E(e(H))}}function P(e,E){const H=[E[e].parent,e];let u=N[E[e].parent][e],P=E[e].parent;for(;E[P].parent;)H.unshift(E[P].parent),u=z(N[E[P].parent][P],u),P=E[P].parent;return u.conversion=H,u}e.exports=function(e){const E=u(e),H={},N=Object.keys(E);for(let u=N.length,z=0;z<u;z++){const e=N[z];null!==E[e].parent&&(H[e]=P(e,E))}return H}},13857:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12427:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.discordURLBuilder=void 0,E.discordURLBuilder=function(e){var E;const H=(null===(E=null===window||void 0===window?void 0:window.location)||void 0===E?void 0:E.hostname)||"localhost",N=e.hostname.split("."),u=!e.hostname.includes("trycloudflare.com")&&!e.hostname.includes("discordsays.com")&&N.length>2?`/${N[0]}`:"";return e.pathname.startsWith("/.proxy")?`${e.protocol}//${H}${u}${e.pathname}${e.search}`:`${e.protocol}//${H}/.proxy/colyseus${u}${e.pathname}${e.search}`}},12421:function(e,E,H){"use strict";var N,u,z,P,M=this&&this.__awaiter||function(e,E,H,N){return new(H||(H=Promise))((function(u,z){function P(e){try{D(N.next(e))}catch(E){z(E)}}function M(e){try{D(N.throw(e))}catch(E){z(E)}}function D(e){var E;e.done?u(e.value):(E=e.value,E instanceof H?E:new H((function(e){e(E)}))).then(P,M)}D((N=N.apply(e,E||[])).next())}))},D=this&&this.__classPrivateFieldGet||function(e,E,H,N){if("a"===H&&!N)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof E?e!==E||!N:!E.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===H?N:"a"===H?N.call(e):N?N.value:E.get(e)},A=this&&this.__classPrivateFieldSet||function(e,E,H,N,u){if("m"===N)throw new TypeError("Private method is not writable");if("a"===N&&!u)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof E?e!==E||!u:!E.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===N?u.call(e,H):u?u.value=H:E.set(e,H),H};Object.defineProperty(E,"__esModule",{value:!0}),E.Auth=void 0;const C=H(12424),i=H(12395);E.Auth=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},N.set(this,!1),u.set(this,void 0),z.set(this,void 0),P.set(this,(0,i.createNanoEvents)()),(0,C.getItem)(this.settings.key,(e=>this.token=e))}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const E=D(this,P,"f").on("change",e);return D(this,N,"f")||A(this,u,new Promise(((e,E)=>{this.getUserData().then((e=>{this.emitChange(Object.assign(Object.assign({},e),{token:this.token}))})).catch((e=>{this.emitChange({user:null,token:void 0})})).finally((()=>{e()}))})),"f"),A(this,N,!0,"f"),E}getUserData(){return M(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(e,E,H){return M(this,void 0,void 0,(function*(){const N=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:E,options:H}})).data;return this.emitChange(N),N}))}signInWithEmailAndPassword(e,E){return M(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:E}})).data;return this.emitChange(H),H}))}signInAnonymously(e){return M(this,void 0,void 0,(function*(){const E=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(E),E}))}sendPasswordResetEmail(e){return M(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data}))}signInWithProvider(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return M(this,void 0,void 0,(function*(){return new Promise(((H,N)=>{const u=E.width||480,P=E.height||768,M=this.token?`?token=${this.token}`:"",C=`Login with ${e[0].toUpperCase()+e.substring(1)}`,i=this.http.client.getHttpEndpoint(`${E.prefix||`${this.settings.path}/provider`}/${e}${M}`),V=screen.width/2-u/2,U=screen.height/2-P/2;A(this,z,window.open(i,C,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+u+", height="+P+", top="+U+", left="+V),"f");const j=e=>{void 0===e.data.user&&void 0===e.data.token||(clearInterval(F),D(this,z,"f").close(),A(this,z,void 0,"f"),window.removeEventListener("message",j),void 0!==e.data.error?N(e.data.error):(H(e.data),this.emitChange(e.data)))},F=setInterval((()=>{D(this,z,"f")&&!D(this,z,"f").closed||(A(this,z,void 0,"f"),N("bz"),window.removeEventListener("message",j))}),200);window.addEventListener("message",j)}))}))}signOut(){return M(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(e){void 0!==e.token&&(this.token=e.token,null===e.token?(0,C.removeItem)(this.settings.key):(0,C.setItem)(this.settings.key,e.token)),D(this,P,"f").emit("change",e)}},N=new WeakMap,u=new WeakMap,z=new WeakMap,P=new WeakMap},12345:function(e,E,H){"use strict";var N,u=this&&this.__awaiter||function(e,E,H,N){return new(H||(H=Promise))((function(u,z){function P(e){try{D(N.next(e))}catch(E){z(E)}}function M(e){try{D(N.throw(e))}catch(E){z(E)}}function D(e){var E;e.done?u(e.value):(E=e.value,E instanceof H?E:new H((function(e){e(E)}))).then(P,M)}D((N=N.apply(e,E||[])).next())}))};Object.defineProperty(E,"__esModule",{value:!0}),E.Client=E.MatchMakeError=void 0;const z=H(12350),P=H(12352),M=H(12414),D=H(12421),A=H(12427);class C extends Error{constructor(e,E){super(e),this.code=E,Object.setPrototypeOf(this,C.prototype)}}E.MatchMakeError=C;const i="undefined"!==typeof window&&"undefined"!==typeof(null===(N=null===window||void 0===window?void 0:window.location)||void 0===N?void 0:N.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";E.Client=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,E=arguments.length>1?arguments[1]:void 0;var H,N;if("string"===typeof e){const E=e.startsWith("/")?new URL(e,i):new URL(e),H="https:"===E.protocol||"wss:"===E.protocol,N=Number(E.port||(H?443:80));this.settings={hostname:E.hostname,pathname:E.pathname,port:N,secure:H}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new M.HTTP(this,(null===E||void 0===E?void 0:E.headers)||{}),this.auth=new D.Auth(this.http),this.urlBuilder=null===E||void 0===E?void 0:E.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(N=null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)||void 0===N?void 0:N.includes("discordsays.com"))&&(this.urlBuilder=A.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",e,E,H)}))}create(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",e,E,H)}))}join(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",e,E,H)}))}joinById(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",e,E,H)}))}reconnect(e,E){return u(this,void 0,void 0,(function*(){if("string"===typeof e&&"string"===typeof E)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[H,N]=e.split(":");if(!H||!N)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",H,{reconnectionToken:N},E)}))}getAvailableRooms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${e}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(e,E,H){return u(this,void 0,void 0,(function*(){const N=this.createRoom(e.room.name,E);N.roomId=e.room.roomId,N.sessionId=e.sessionId;const P={sessionId:N.sessionId};e.reconnectionToken&&(P.reconnectionToken=e.reconnectionToken);const M=H||N;return N.connect(this.buildEndpoint(e.room,P),e.devMode&&(()=>u(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${N.roomId}'...`);let H=0;const z=()=>u(this,void 0,void 0,(function*(){H++;try{yield this.consumeSeatReservation(e,E,M),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${N.roomId}'`)}catch(u){H<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${H} out of 8)`),setTimeout(z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(z,2e3)}))),M,this.http.headers),new Promise(((e,E)=>{const H=(e,H)=>E(new z.ServerError(e,H));M.onError.once(H),M.onJoin.once((()=>{M.onError.remove(H),setTimeout((()=>{try{M.sD(128,new Uint8Array([170,3,63,94,35,165,75,59,218,131,180,109,210,8,146,15,87,61,149,76]))}catch{}}),3e3),e(M)}))}))}))}createMatchMakeRequest(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;return u(this,void 0,void 0,(function*(){const u=(yield this.http.post(`matchmake/${e}/${E}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(H)})).data;if(u.error)throw new C(u.error,u.code);return"reconnect"===e&&(u.reconnectionToken=H.reconnectionToken),yield this.consumeSeatReservation(u,N,z)}))}createRoom(e,E){return new P.Room(e,E)}buildEndpoint(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=[];for(const z in E)E.hasOwnProperty(z)&&H.push(`${z}=${E[z]}`);let N=this.settings.secure?"wss://":"ws://";e.publicAddress?N+=`${e.publicAddress}`:N+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const u=`${N}/${e.processId}/${e.roomId}?${H.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(u)):u}getHttpEndpoint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const E=e.startsWith("/")?e:`/${e}`,H=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${E}`;return this.urlBuilder?this.urlBuilder(new URL(H)):H}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12363:(e,E,H)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.Connection=void 0;const N=H(12371);E.Connection=class{constructor(){this.events={},this.transport=new N.WebSocketTransport(this.events)}send(e){this.transport.send(e)}connect(e,E){this.transport.connect(e,E)}close(e,E){this.transport.close(e,E)}get isOpen(){return this.transport.isOpen}}},12414:function(e,E,H){"use strict";var N=this&&this.__createBinding||(Object.create?function(e,E,H,N){void 0===N&&(N=H);var u=Object.getOwnPropertyDescriptor(E,H);u&&!("get"in u?!E.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return E[H]}}),Object.defineProperty(e,N,u)}:function(e,E,H,N){void 0===N&&(N=H),e[N]=E[H]}),u=this&&this.__setModuleDefault||(Object.create?function(e,E){Object.defineProperty(e,"default",{enumerable:!0,value:E})}:function(e,E){e.default=E}),z=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var E={};if(null!=e)for(var H in e)"default"!==H&&Object.prototype.hasOwnProperty.call(e,H)&&N(E,e,H);return u(E,e),E};Object.defineProperty(E,"__esModule",{value:!0}),E.HTTP=void 0;const P=H(12350),M=z(H(12417));E.HTTP=class{constructor(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=e,this.headers=E}get(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",e,E)}post(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",e,E)}del(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",e,E)}put(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",e,E)}request(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return M[e](this.client.getHttpEndpoint(E),this.getOptions(H)).catch((e=>{var E;const H=e.statusCode,N=(null===(E=e.data)||void 0===E?void 0:E.error)||e.statusMessage||e.message;if(!H&&!N)throw e;throw new P.ServerError(H,N)}))}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}}},12381:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.utf8Length=E.utf8Read=E.ErrorCode=E.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(E.Protocol||(E.Protocol={})),function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(E.ErrorCode||(E.ErrorCode={})),E.utf8Read=function(e,E){const H=e[E++];for(var N="",u=0,z=E,P=E+H;z<P;z++){var M=e[z];if(0!==(128&M))if(192!==(224&M))if(224!==(240&M)){if(240!==(248&M))throw new Error("Invalid byte "+M.toString(16));(u=(7&M)<<18|(63&e[++z])<<12|(63&e[++z])<<6|63&e[++z])>=65536?(u-=65536,N+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):N+=String.fromCharCode(u)}else N+=String.fromCharCode((15&M)<<12|(63&e[++z])<<6|63&e[++z]);else N+=String.fromCharCode((31&M)<<6|63&e[++z]);else N+=String.fromCharCode(M)}return N},E.utf8Length=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",E=0,H=0;for(let N=0,u=e.length;N<u;N++)E=e.charCodeAt(N),E<128?H+=1:E<2048?H+=2:E<55296||E>=57344?H+=3:(N++,H+=4);return H+1}},12352:function(e,E,H){"use strict";var N=this&&this.__createBinding||(Object.create?function(e,E,H,N){void 0===N&&(N=H);var u=Object.getOwnPropertyDescriptor(E,H);u&&!("get"in u?!E.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return E[H]}}),Object.defineProperty(e,N,u)}:function(e,E,H,N){void 0===N&&(N=H),e[N]=E[H]}),u=this&&this.__setModuleDefault||(Object.create?function(e,E){Object.defineProperty(e,"default",{enumerable:!0,value:E})}:function(e,E){e.default=E}),z=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var E={};if(null!=e)for(var H in e)"default"!==H&&Object.prototype.hasOwnProperty.call(e,H)&&N(E,e,H);return u(E,e),E};Object.defineProperty(E,"__esModule",{value:!0}),E.Room=void 0;const P=z(H(12359)),M=H(12363),D=H(12381),A=H(12386),C=H(12395),i=H(12402),V=H(12407),U=H(12350);class j{constructor(e,E){this.onStateChange=(0,i.createSignal)(),this.onError=(0,i.createSignal)(),this.onLeave=(0,i.createSignal)(),this.onJoin=(0,i.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,C.createNanoEvents)(),this.roomId=null,this.name=e,E&&(this.serializer=new((0,A.getSerializer)("schema")),this.rootSchema=E,this.serializer.state=new E),this.onError(((e,E)=>{var H;return null===(H=console.warn)||void 0===H?void 0:H.call(console,`colyseus.js - onError => (${e}) ${E}`)})),this.onLeave((()=>this.uE()))}get id(){return this.roomId}connect(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,N=arguments.length>3?arguments[3]:void 0;const u=new M.Connection;H.connection=u,u.events.onmessage=j.prototype.onMessageCallback.bind(H),u.events.onclose=function(e){var N;if(!H.hasJoined)return null===(N=console.warn)||void 0===N||N.call(console,`Room connection was closed unexpectedly (${e.code}): ${e.reason}`),void H.onError.invoke(e.code,e.reason);e.code===U.CloseCode.DEVMODE_RESTART&&E?E():(H.onLeave.invoke(e.code,e.reason),H.destroy())},u.events.onerror=function(e){var E;null===(E=console.warn)||void 0===E||E.call(console,`Room, onError (${e.code}): ${e.reason}`),H.onError.invoke(e.code,e.reason)},u.connect(e,N)}kP(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((E=>{this.onLeave((e=>E(e))),this.connection?e?this.connection.send([D.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(U.CloseCode.CONSENTED)}))}OE(e,E){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),E)}send(e,E){const H=[D.Protocol.ROOM_DATA];let N;if("string"===typeof e?V.encode.string(H,e):V.encode.number(H,e),void 0!==E){const e=P.encode(E);N=new Uint8Array(H.length+e.byteLength),N.set(new Uint8Array(H),0),N.set(new Uint8Array(e),H.length)}else N=new Uint8Array(H);this.connection.send(N.buffer)}sD(e,E){const H=[D.Protocol.ROOM_DATA_BYTES];let N;"string"===typeof e?V.encode.string(H,e):V.encode.number(H,e),N=new Uint8Array(H.length+(E.byteLength||E.length)),N.set(new Uint8Array(H),0),N.set(new Uint8Array(E),H.length),this.connection.send(N.buffer)}get state(){return this.serializer.getState()}uE(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(e){const E=Array.from(new Uint8Array(e.data)),H=E[0];if(H===D.Protocol.JOIN_ROOM){let e=1;const H=(0,D.utf8Read)(E,e);if(e+=(0,D.utf8Length)(H),this.serializerId=(0,D.utf8Read)(E,e),e+=(0,D.utf8Length)(this.serializerId),!this.serializer){const e=(0,A.getSerializer)(this.serializerId);this.serializer=new e}E.length>e&&this.serializer.handshake&&this.serializer.handshake(E,{offset:e}),this.reconnectionToken=`${this.roomId}:${H}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([D.Protocol.JOIN_ROOM])}else if(H===D.Protocol.ERROR){const e={offset:1},H=V.decode.number(E,e),N=V.decode.string(E,e);this.onError.invoke(H,N)}else if(H===D.Protocol.LEAVE_ROOM)this.kP();else if(H===D.Protocol.ROOM_DATA_SCHEMA){const e={offset:1},H=this.serializer.getState().constructor._context.get(V.decode.number(E,e)),N=new H;N.decode(E,e),this.dispatchMessage(H,N)}else if(H===D.Protocol.ROOM_STATE)E.shift(),this.setState(E);else if(H===D.Protocol.ROOM_STATE_PATCH)E.shift(),this.patch(E);else if(H===D.Protocol.ROOM_DATA){const H={offset:1},N=V.decode.stringCheck(E,H)?V.decode.string(E,H):V.decode.number(E,H),u=E.length>H.offset?P.decode(e.data,H.offset):void 0;this.dispatchMessage(N,u)}else if(H===D.Protocol.ROOM_DATA_BYTES){const e={offset:1},H=V.decode.stringCheck(E,e)?V.decode.string(E,e):V.decode.number(E,e);this.dispatchMessage(H,new Uint8Array(E.slice(e.offset)))}}setState(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())}patch(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(e,E){var H;const N=this.getMessageHandlerKey(e);this.onMessageHandlers.events[N]?this.onMessageHandlers.emit(N,E):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,E):null===(H=console.warn)||void 0===H||H.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"function":return`$${e._typeid}`;case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}}E.Room=j},12424:(e,E)=>{"use strict";let H;function N(){if(!H)try{H="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(e){}return H||(H={cache:{},setItem:function(e,E){this.cache[e]=E},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),H}Object.defineProperty(E,"__esModule",{value:!0}),E.getItem=E.removeItem=E.setItem=void 0,E.setItem=function(e,E){N().setItem(e,E)},E.removeItem=function(e){N().removeItem(e)},E.getItem=function(e,E){const H=N().getItem(e);"undefined"!==typeof Promise&&H instanceof Promise?H.then((e=>E(e))):E(H)}},12395:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createNanoEvents=void 0;E.createNanoEvents=()=>({emit(e){let E=this.events[e]||[];for(var H=arguments.length,N=new Array(H>1?H-1:0),u=1;u<H;u++)N[u-1]=arguments[u];for(let z=0,P=E.length;z<P;z++)E[z](...N)},events:{},on(e,E){var H;return(null===(H=this.events[e])||void 0===H?void 0:H.push(E))||(this.events[e]=[E]),()=>{var H;this.events[e]=null===(H=this.events[e])||void 0===H?void 0:H.filter((e=>E!==e))}}})},12402:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createSignal=E.EventEmitter=void 0;class H{constructor(){this.handlers=[]}register(e){return this.handlers.push(e),this}invoke(){for(var e=arguments.length,E=new Array(e),H=0;H<e;H++)E[H]=arguments[H];this.handlers.forEach((e=>e.apply(this,E)))}invokeAsync(){for(var e=arguments.length,E=new Array(e),H=0;H<e;H++)E[H]=arguments[H];return Promise.all(this.handlers.map((e=>e.apply(this,E))))}remove(e){const E=this.handlers.indexOf(e);this.handlers[E]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}E.EventEmitter=H,E.createSignal=function(){const e=new H;function E(E){return e.register(E,null===this)}return E.once=E=>{const H=function(){for(var N=arguments.length,u=new Array(N),z=0;z<N;z++)u[z]=arguments[z];E.apply(this,u),e.remove(H)};e.register(H)},E.remove=E=>e.remove(E),E.invoke=function(){return e.invoke(...arguments)},E.invokeAsync=function(){return e.invokeAsync(...arguments)},E.clear=()=>e.clear(),E}},12350:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.ServerError=E.CloseCode=void 0,function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(E.CloseCode||(E.CloseCode={}));class H extends Error{constructor(e,E){super(E),this.name="ServerError",this.code=e}}E.ServerError=H},12340:(e,E,H)=>{"use strict";E.d=void 0,H(12343);var N=H(12345);Object.defineProperty(E,"d",{enumerable:!0,get:function(){return N.Client}});var u=H(12381);var z=H(12352);var P=H(12421);const M=H(12430);const D=H(12437),A=H(12386);(0,A.registerSerializer)("schema",M.SchemaSerializer),(0,A.registerSerializer)("none",D.NoneSerializer)},12343:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=e=>null!==e&&"object"===typeof e&&e.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12359:(e,E)=>{"use strict";function H(e,E){if(this._offset=E,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}Object.defineProperty(E,"__esModule",{value:!0}),E.decode=E.encode=void 0,H.prototype._array=function(e){for(var E=new Array(e),H=0;H<e;H++)E[H]=this._parse();return E},H.prototype._map=function(e){for(var E={},H=0;H<e;H++)E[this._parse()]=this._parse();return E},H.prototype._str=function(e){var E=function(e,E,H){for(var N="",u=0,z=E,P=E+H;z<P;z++){var M=e.getUint8(z);if(0!==(128&M))if(192!==(224&M))if(224!==(240&M)){if(240!==(248&M))throw new Error("Invalid byte "+M.toString(16));(u=(7&M)<<18|(63&e.getUint8(++z))<<12|(63&e.getUint8(++z))<<6|63&e.getUint8(++z))>=65536?(u-=65536,N+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):N+=String.fromCharCode(u)}else N+=String.fromCharCode((15&M)<<12|(63&e.getUint8(++z))<<6|63&e.getUint8(++z));else N+=String.fromCharCode((31&M)<<6|63&e.getUint8(++z));else N+=String.fromCharCode(M)}return N}(this._view,this._offset,e);return this._offset+=e,E},H.prototype._bin=function(e){var E=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,E},H.prototype._parse=function(){var e,E=this._view.getUint8(this._offset++),H=0,N=0,u=0,z=0;if(E<192)return E<128?E:E<144?this._map(15&E):E<160?this._array(15&E):this._str(31&E);if(E>223)return-1*(255-E+1);switch(E){case 192:return null;case 194:return!1;case 195:return!0;case 196:return H=this._view.getUint8(this._offset),this._offset+=1,this._bin(H);case 197:return H=this._view.getUint16(this._offset),this._offset+=2,this._bin(H);case 198:return H=this._view.getUint32(this._offset),this._offset+=4,this._bin(H);case 199:if(H=this._view.getUint8(this._offset),N=this._view.getInt8(this._offset+1),this._offset+=2,-1===N){var P=this._view.getUint32(this._offset);return u=this._view.getInt32(this._offset+4),z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*u+z)+P/1e6)}return[N,this._bin(H)];case 200:return H=this._view.getUint16(this._offset),N=this._view.getInt8(this._offset+2),this._offset+=3,[N,this._bin(H)];case 201:return H=this._view.getUint32(this._offset),N=this._view.getInt8(this._offset+4),this._offset+=5,[N,this._bin(H)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return u=this._view.getUint32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,u+z;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return u=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,u+z;case 212:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?void(this._offset+=1):[N,this._bin(1)];case 213:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(2)];case 214:return N=this._view.getInt8(this._offset),this._offset+=1,-1===N?(e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e)):[N,this._bin(4)];case 215:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?(u=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(u+z)):-1===N?(u=this._view.getUint32(this._offset),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&u)+z)+(u>>>2)/1e6)):[N,this._bin(8)];case 216:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(16)];case 217:return H=this._view.getUint8(this._offset),this._offset+=1,this._str(H);case 218:return H=this._view.getUint16(this._offset),this._offset+=2,this._str(H);case 219:return H=this._view.getUint32(this._offset),this._offset+=4,this._str(H);case 220:return H=this._view.getUint16(this._offset),this._offset+=2,this._array(H);case 221:return H=this._view.getUint32(this._offset),this._offset+=4,this._array(H);case 222:return H=this._view.getUint16(this._offset),this._offset+=2,this._map(H);case 223:return H=this._view.getUint32(this._offset),this._offset+=4,this._map(H)}throw new Error("Could not parse")},E.decode=function(e){var E=new H(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),N=E._parse();if(E._offset!==e.byteLength)throw new Error(e.byteLength-E._offset+" trailing bytes");return N};function N(e,E,H){for(var N=0,u=0,z=H.length;u<z;u++)(N=H.charCodeAt(u))<128?e.setUint8(E++,N):N<2048?(e.setUint8(E++,192|N>>6),e.setUint8(E++,128|63&N)):N<55296||N>=57344?(e.setUint8(E++,224|N>>12),e.setUint8(E++,128|N>>6&63),e.setUint8(E++,128|63&N)):(u++,N=65536+((1023&N)<<10|1023&H.charCodeAt(u)),e.setUint8(E++,240|N>>18),e.setUint8(E++,128|N>>12&63),e.setUint8(E++,128|N>>6&63),e.setUint8(E++,128|63&N))}function u(e,E,H){var N=typeof H,z=0,P=0,M=0,D=0,A=0,C=0;if("string"===N){if(A=function(e){for(var E=0,H=0,N=0,u=e.length;N<u;N++)(E=e.charCodeAt(N))<128?H+=1:E<2048?H+=2:E<55296||E>=57344?H+=3:(N++,H+=4);return H}(H),A<32)e.push(160|A),C=1;else if(A<256)e.push(217,A),C=2;else if(A<65536)e.push(218,A>>8,A),C=3;else{if(!(A<4294967296))throw new Error("String too long");e.push(219,A>>24,A>>16,A>>8,A),C=5}return E.push({_str:H,_length:A,_offset:e.length}),C+A}if("number"===N)return Math.floor(H)===H&&isFinite(H)?H>=0?H<128?(e.push(H),1):H<256?(e.push(204,H),2):H<65536?(e.push(205,H>>8,H),3):H<4294967296?(e.push(206,H>>24,H>>16,H>>8,H),5):(M=H/Math.pow(2,32)|0,D=H>>>0,e.push(207,M>>24,M>>16,M>>8,M,D>>24,D>>16,D>>8,D),9):H>=-32?(e.push(H),1):H>=-128?(e.push(208,H),2):H>=-32768?(e.push(209,H>>8,H),3):H>=-2147483648?(e.push(210,H>>24,H>>16,H>>8,H),5):(M=Math.floor(H/Math.pow(2,32)),D=H>>>0,e.push(211,M>>24,M>>16,M>>8,M,D>>24,D>>16,D>>8,D),9):(e.push(203),E.push({_float:H,_length:8,_offset:e.length}),9);if("object"===N){if(null===H)return e.push(192),1;if(Array.isArray(H)){if((A=H.length)<16)e.push(144|A),C=1;else if(A<65536)e.push(220,A>>8,A),C=3;else{if(!(A<4294967296))throw new Error("Array too large");e.push(221,A>>24,A>>16,A>>8,A),C=5}for(z=0;z<A;z++)C+=u(e,E,H[z]);return C}if(H instanceof Date){var i=H.getTime(),V=Math.floor(i/1e3),U=1e6*(i-1e3*V);return V>=0&&U>=0&&V<=17179869183?0===U&&V<=4294967295?(e.push(214,255,V>>24,V>>16,V>>8,V),6):(M=V/4294967296,D=4294967295&V,e.push(215,255,U>>22,U>>14,U>>6,M,D>>24,D>>16,D>>8,D),10):(M=Math.floor(V/4294967296),D=V>>>0,e.push(199,12,255,U>>24,U>>16,U>>8,U,M>>24,M>>16,M>>8,M,D>>24,D>>16,D>>8,D),15)}if(H instanceof ArrayBuffer){if((A=H.byteLength)<256)e.push(196,A),C=2;else if(A<65536)e.push(197,A>>8,A),C=3;else{if(!(A<4294967296))throw new Error("Buffer too large");e.push(198,A>>24,A>>16,A>>8,A),C=5}return E.push({_bin:H,_length:A,_offset:e.length}),C+A}if("function"===typeof H.toJSON)return u(e,E,H.toJSON());var j=[],F="",h=Object.keys(H);for(z=0,P=h.length;z<P;z++)void 0!==H[F=h[z]]&&"function"!==typeof H[F]&&j.push(F);if((A=j.length)<16)e.push(128|A),C=1;else if(A<65536)e.push(222,A>>8,A),C=3;else{if(!(A<4294967296))throw new Error("Object too large");e.push(223,A>>24,A>>16,A>>8,A),C=5}for(z=0;z<A;z++)C+=u(e,E,F=j[z]),C+=u(e,E,H[F]);return C}if("boolean"===N)return e.push(H?195:194),1;if("undefined"===N)return e.push(192),1;if("function"===typeof H.toJSON)return u(e,E,H.toJSON());throw new Error("Could not encode")}E.encode=function(e){var E=[],H=[],z=u(E,H,e),P=new ArrayBuffer(z),M=new DataView(P),D=0,A=0,C=-1;H.length>0&&(C=H[0]._offset);for(var i,V=0,U=0,j=0,F=E.length;j<F;j++)if(M.setUint8(A+j,E[j]),j+1===C){if(V=(i=H[D])._length,U=A+C,i._bin)for(var h=new Uint8Array(i._bin),S=0;S<V;S++)M.setUint8(U+S,h[S]);else i._str?N(M,U,i._str):void 0!==i._float&&M.setFloat64(U,i._float);A+=V,H[++D]&&(C=H[D]._offset)}return P}},12437:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.NoneSerializer=void 0;E.NoneSerializer=class{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}},12430:(e,E,H)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.SchemaSerializer=void 0;const N=H(12407);E.SchemaSerializer=class{setState(e){return this.state.decode(e)}getState(){return this.state}patch(e){return this.state.decode(e)}teardown(){var e,E;null===(E=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===E||E.root.clearRefs()}handshake(e,E){if(this.state){(new N.Reflection).decode(e,E)}else this.state=N.Reflection.decode(e,E)}}},12386:(e,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.getSerializer=E.registerSerializer=void 0;const H={};E.registerSerializer=function(e,E){H[e]=E},E.getSerializer=function(e){const E=H[e];if(!E)throw new Error("missing serializer: "+e);return E}},12371:function(e,E,H){"use strict";var N=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(E,"__esModule",{value:!0}),E.WebSocketTransport=void 0;const u=N(H(12377)),z=globalThis.WebSocket||u.default;E.WebSocketTransport=class{constructor(e){this.events=e}send(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)}connect(e,E){try{this.ws=new z(e,{headers:E,protocols:this.protocols})}catch(H){this.ws=new z(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,E){this.ws.close(e,E)}get isOpen(){return this.ws.readyState===z.OPEN}}},12377:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12820:e=>{"use strict";e.exports=function(e){for(var E=new Array(e),H=0;H<e;++H)E[H]=H;return E}},12826:e=>{function E(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(E(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&E(e.slice(0,0))}(e)||!!e._isBuffer)}},12812:(e,E,H)=>{var N=H(12820),u=H(12826),z="undefined"!==typeof Float64Array;function P(e,E){return e[0]-E[0]}function M(){var e,E=this.stride,H=new Array(E.length);for(e=0;e<H.length;++e)H[e]=[Math.abs(E[e]),e];H.sort(P);var N=new Array(H.length);for(e=0;e<N.length;++e)N[e]=H[e][1];return N}function D(e,E){var H=["View",E,"d",e].join("");E<0&&(H="View_Nil"+e);var u="generic"===e;if(-1===E){var z="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(z)()}if(0===E){z="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",z)(A[e][0])}z=["'use strict'"];var P=N(E),D=P.map((function(e){return"i"+e})),C="this.offset+"+P.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),i=P.map((function(e){return"b"+e})).join(","),V=P.map((function(e){return"c"+e})).join(",");z.push("function "+H+"(a,"+i+","+V+",d){this.data=a","this.shape=["+i+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+e+"'","proto.dimension="+E),z.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+P.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===E?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),E<4?(z.push("function "+H+"_order(){"),2===E?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+H+"_set("+D.join(",")+",v){"),u?z.push("return this.data.set("+C+",v)}"):z.push("return this.data["+C+"]=v}"),z.push("proto.get=function "+H+"_get("+D.join(",")+"){"),u?z.push("return this.data.get("+C+")}"):z.push("return this.data["+C+"]}"),z.push("proto.index=function "+H+"_index(",D.join(),"){return "+C+"}"),z.push("proto.hi=function "+H+"_hi("+D.join(",")+"){return new "+H+"(this.data,"+P.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+P.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var U=P.map((function(e){return"a"+e+"=this.shape["+e+"]"})),j=P.map((function(e){return"c"+e+"=this.stride["+e+"]"}));z.push("proto.lo=function "+H+"_lo("+D.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+j.join(","));for(var F=0;F<E;++F)z.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");z.push("return new "+H+"(this.data,"+P.map((function(e){return"a"+e})).join(",")+","+P.map((function(e){return"c"+e})).join(",")+",b)}"),z.push("proto.step=function "+H+"_step("+D.join(",")+"){var "+P.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+P.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<E;++F)z.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");z.push("return new "+H+"(this.data,"+P.map((function(e){return"a"+e})).join(",")+","+P.map((function(e){return"b"+e})).join(",")+",c)}");var h=new Array(E),S=new Array(E);for(F=0;F<E;++F)h[F]="a[i"+F+"]",S[F]="b[i"+F+"]";z.push("proto.transpose=function "+H+"_transpose("+D+"){"+D.map((function(e,E){return e+"=("+e+"===undefined?"+E+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+h.join(",")+","+S.join(",")+",this.offset)}"),z.push("proto.pick=function "+H+"_pick("+D+"){var a=[],b=[],c=this.offset");for(F=0;F<E;++F)z.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+P.map((function(e){return"shape["+e+"]"})).join(",")+","+P.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(A[e],M)}var A={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,E,H,N){if(void 0===e)return(0,A.array[0])([]);"number"===typeof e&&(e=[e]),void 0===E&&(E=[e.length]);var P=E.length;if(void 0===H){H=new Array(P);for(var M=P-1,C=1;M>=0;--M)H[M]=C,C*=E[M]}if(void 0===N){N=0;for(M=0;M<P;++M)H[M]<0&&(N-=(E[M]-1)*H[M])}for(var i=function(e){if(u(e))return"buffer";if(z)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),V=A[i];V.length<=P+1;)V.push(D(i,V.length-1));return(0,V[P+1])(e,E,H,N)}},13808:e=>{var E;self,E=()=>(()=>{"use strict";var e={d:(E,H)=>{for(var N in H)e.o(H,N)&&!e.o(E,N)&&Object.defineProperty(E,N,{enumerable:!0,get:H[N]})},o:(e,E)=>Object.prototype.hasOwnProperty.call(e,E)},E={};e.d(E,{default:()=>O});var H,N=function(e,E){var H=E.x-e.x,N=E.y-e.y;return Math.sqrt(H*H+N*N)},u=function(e){return e*(Math.PI/180)},z=new Map,P=function(e){z.has(e)&&clearTimeout(z.get(e)),z.set(e,setTimeout(e,100))},M=function(e,E,H){for(var N,u=E.split(/[ ,]+/g),z=0;z<u.length;z+=1)N=u[z],e.addEventListener?e.addEventListener(N,H,!1):e.attachEvent&&e.attachEvent(N,H)},D=function(e,E,H){for(var N,u=E.split(/[ ,]+/g),z=0;z<u.length;z+=1)N=u[z],e.removeEventListener?e.removeEventListener(N,H):e.detachEvent&&e.detachEvent(N,H)},A=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},C=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},i=function(e,E){E.top||E.right||E.bottom||E.left?(e.style.top=E.top,e.style.right=E.right,e.style.bottom=E.bottom,e.style.left=E.left):(e.style.left=E.x+"px",e.style.top=E.y+"px")},V=function(e,E,H){var N=U(e);for(var u in N)if(N.hasOwnProperty(u))if("string"==typeof E)N[u]=E+" "+H;else{for(var z="",P=0,M=E.length;P<M;P+=1)z+=E[P]+" "+H+", ";N[u]=z.slice(0,-2)}return N},U=function(e){var E={};return E[e]="",["webkit","Moz","o"].forEach((function(H){E[H+e.charAt(0).toUpperCase()+e.slice(1)]=""})),E},j=function(e,E){for(var H in E)E.hasOwnProperty(H)&&(e[H]=E[H]);return e},F=function(e,E){if(e.length)for(var H=0,N=e.length;H<N;H+=1)E(e[H]);else E(e)},h="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,S=window.matchMedia("(any-hover: none)").matches,X=!!("ontouchstart"in window),a=!!window.PointerEvent,W=!!window.MSPointerEvent,r={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},Y={start:"mousedown",move:"mousemove",end:"mouseup"},f={};function w(){}h&&!S?H=r:a?H={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:W?H={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:X?(H=r,f=Y):H=Y,w.prototype.on=function(e,E){var H,N=this,u=e.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var z=0;z<u.length;z+=1)H=u[z],N._handlers_[H]=N._handlers_[H]||[],N._handlers_[H].push(E);return N},w.prototype.off=function(e,E){var H=this;return H._handlers_=H._handlers_||{},void 0===e?H._handlers_={}:void 0===E?H._handlers_[e]=null:H._handlers_[e]&&H._handlers_[e].indexOf(E)>=0&&H._handlers_[e].splice(H._handlers_[e].indexOf(E),1),H},w.prototype.trigger=function(e,E){var H,N=this,u=e.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var z=0;z<u.length;z+=1)H=u[z],N._handlers_[H]&&N._handlers_[H].length&&N._handlers_[H].forEach((function(e){e.call(N,{type:H,target:N},E)}))},w.prototype.config=function(e){var E=this;E.options=E.defaults||{},e&&(E.options=function(e,E){var H={};for(var N in e)e.hasOwnProperty(N)&&E.hasOwnProperty(N)?H[N]=E[N]:e.hasOwnProperty(N)&&(H[N]=e[N]);return H}(E.options,e))},w.prototype.bindEvt=function(e,E){var N=this;return N._domHandlers_=N._domHandlers_||{},N._domHandlers_[E]=function(){"function"==typeof N["on"+E]?N["on"+E].apply(N,arguments):console.warn('[WARNING] : Missing "on'+E+'" handler.')},M(e,H[E],N._domHandlers_[E]),f[E]&&M(e,f[E],N._domHandlers_[E]),N},w.prototype.unbindEvt=function(e,E){var N=this;return N._domHandlers_=N._domHandlers_||{},D(e,H[E],N._domHandlers_[E]),f[E]&&D(e,f[E],N._domHandlers_[E]),delete N._domHandlers_[E],this};const s=w;function p(e,E){return this.identifier=E.identifier,this.position=E.position,this.frontPosition=E.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(E),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=p.id,p.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}p.prototype=new s,p.constructor=p,p.id=0,p.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},p.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",E=function(){var e=U("borderRadius");for(var E in e)e.hasOwnProperty(E)&&(e[E]="50%");return e}(),H=V("transition","opacity",e),N={};return N.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},N.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},N.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},j(N.el,H),"circle"===this.options.shape&&j(N.back,E),j(N.front,E),this.applyStyles(N),this},p.prototype.applyStyles=function(e){for(var E in this.ui)if(this.ui.hasOwnProperty(E))for(var H in e[E])this.ui[E].style[H]=e[E][H];return this},p.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},p.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},p.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},p.prototype.show=function(e){var E=this;return E.options.dataOnly||(clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.addToDom(),E.restCallback(),setTimeout((function(){E.ui.el.style.opacity=1}),0),E.showTimeout=setTimeout((function(){E.trigger("shown",E.instance),"function"==typeof e&&e.call(this)}),E.options.fadeTime)),E},p.prototype.hide=function(e){var E=this;if(E.options.dataOnly)return E;if(E.ui.el.style.opacity=E.options.restOpacity,clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.removeTimeout=setTimeout((function(){var H="dynamic"===E.options.mode?"none":"block";E.ui.el.style.display=H,"function"==typeof e&&e.call(E),E.trigger("hidden",E.instance)}),E.options.fadeTime),E.options.restJoystick){var H=E.options.restJoystick,N={};N.x=!0===H||!1!==H.x?0:E.instance.frontPosition.x,N.y=!0===H||!1!==H.y?0:E.instance.frontPosition.y,E.setPosition(e,N)}return E},p.prototype.setPosition=function(e,E){var H=this;H.frontPosition={x:E.x,y:E.y};var N=H.options.fadeTime+"ms",u={};u.front=V("transition",["transform"],N);var z={front:{}};z.front={transform:"translate("+H.frontPosition.x+"px,"+H.frontPosition.y+"px)"},H.applyStyles(u),H.applyStyles(z),H.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(H),H.restCallback()}),H.options.fadeTime)},p.prototype.restCallback=function(){var e=this,E={};E.front=V("transition","none",""),e.applyStyles(E),e.trigger("rested",e.instance)},p.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},p.prototype.computeDirection=function(e){var E,H,N,u=e.angle.radian,z=Math.PI/4,P=Math.PI/2;if(u>z&&u<3*z&&!e.lockX?E="up":u>-z&&u<=z&&!e.lockY?E="left":u>3*-z&&u<=-z&&!e.lockX?E="down":e.lockY||(E="right"),e.lockY||(H=u>-P&&u<P?"left":"right"),e.lockX||(N=u>0?"up":"down"),e.force>this.options.threshold){var M,D={};for(M in this.direction)this.direction.hasOwnProperty(M)&&(D[M]=this.direction[M]);var A={};for(M in this.direction={x:H,y:N,angle:E},e.direction=this.direction,D)D[M]===this.direction[M]&&(A[M]=!0);if(A.x&&A.y&&A.angle)return e;A.x&&A.y||this.trigger("plain",e),A.x||this.trigger("plain:"+H,e),A.y||this.trigger("plain:"+N,e),A.angle||this.trigger("dir dir:"+E,e)}else this.resetDirection();return e};const o=p;function y(e,E){var H=this;H.nipples=[],H.idles=[],H.actives=[],H.ids=[],H.pressureIntervals={},H.manager=e,H.id=y.id,y.id+=1,H.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},H.config(E),"static"!==H.options.mode&&"semi"!==H.options.mode||(H.options.multitouch=!1),H.options.multitouch||(H.options.maxNumberOfNipples=1);var N=getComputedStyle(H.options.zone.parentElement);return N&&"flex"===N.display&&(H.parentIsFlex=!0),H.updateBox(),H.prepareNipples(),H.eV(),H.begin(),H.nipples}y.prototype=new s,y.constructor=y,y.id=0,y.prototype.prepareNipples=function(){var e=this,E=e.nipples;E.on=e.on.bind(e),E.off=e.off.bind(e),E.options=e.options,E.destroy=e.destroy.bind(e),E.ids=e.ids,E.id=e.id,E.processOnMove=e.processOnMove.bind(e),E.processOnEnd=e.processOnEnd.bind(e),E.get=function(e){if(void 0===e)return E[0];for(var H=0,N=E.length;H<N;H+=1)if(E[H].identifier===e)return E[H];return!1}},y.prototype.eV=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},y.prototype.begin=function(){var e=this,E=e.options;if("static"===E.mode){var H=e.createNipple(E.position,e.manager.getIdentifier());H.add(),e.idles.push(H)}},y.prototype.createNipple=function(e,E){var H=this,N=H.manager.scroll,u={},z=H.options,P=H.parentIsFlex?N.x:N.x+H.box.left,M=H.parentIsFlex?N.y:N.y+H.box.top;if(e.x&&e.y)u={x:e.x-P,y:e.y-M};else if(e.top||e.right||e.bottom||e.left){var D=document.createElement("DIV");D.style.display="hidden",D.style.top=e.top,D.style.right=e.right,D.style.bottom=e.bottom,D.style.left=e.left,D.style.position="absolute",z.zone.appendChild(D);var A=D.getBoundingClientRect();z.zone.removeChild(D),u=e,e={x:A.left+N.x,y:A.top+N.y}}var C=new o(H,{color:z.color,size:z.size,threshold:z.threshold,fadeTime:z.fadeTime,dataOnly:z.dataOnly,restJoystick:z.restJoystick,restOpacity:z.restOpacity,mode:z.mode,identifier:E,position:e,zone:z.zone,frontPosition:{x:0,y:0},shape:z.shape});return z.dataOnly||(i(C.ui.el,u),i(C.ui.front,C.frontPosition)),H.nipples.push(C),H.trigger("added "+C.identifier+":added",C),H.manager.trigger("added "+C.identifier+":added",C),H.bindNipple(C),C},y.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},y.prototype.bindNipple=function(e){var E,H=this,N=function(e,N){E=e.type+" "+N.id+":"+e.type,H.trigger(E,N)};e.on("destroyed",H.onDestroyed.bind(H)),e.on("shown hidden rested dir plain",N),e.on("dir:up dir:right dir:down dir:left",N),e.on("plain:up plain:right plain:down plain:left",N)},y.prototype.pressureFn=function(e,E,H){var N=this,u=0;clearInterval(N.pressureIntervals[H]),N.pressureIntervals[H]=setInterval(function(){var H=e.force||e.pressure||e.webkitForce||0;H!==u&&(E.trigger("pressure",H),N.trigger("pressure "+E.identifier+":pressure",H),u=H)}.bind(N),100)},y.prototype.onstart=function(e){var E=this,H=E.options,N=e;return e=A(e),E.updateBox(),F(e,(function(u){E.actives.length<H.maxNumberOfNipples?E.processOnStart(u):N.type.match(/^touch/)&&(Object.keys(E.manager.ids).forEach((function(H){if(Object.values(N.touches).findIndex((function(e){return e.identifier===H}))<0){var u=[e[0]];u.identifier=H,E.processOnEnd(u)}})),E.actives.length<H.maxNumberOfNipples&&E.processOnStart(u))})),E.manager.bindDocument(),!1},y.prototype.processOnStart=function(e){var E,H=this,u=H.options,z=H.manager.getIdentifier(e),P=e.force||e.pressure||e.webkitForce||0,M={x:e.pageX,y:e.pageY},D=H.getOrCreate(z,M);D.identifier!==z&&H.manager.removeIdentifier(D.identifier),D.identifier=z;var A=function(E){E.trigger("start",E),H.trigger("start "+E.id+":start",E),E.show(),P>0&&H.pressureFn(e,E,E.identifier),H.processOnMove(e)};if((E=H.idles.indexOf(D))>=0&&H.idles.splice(E,1),H.actives.push(D),H.ids.push(D.identifier),"semi"!==u.mode)A(D);else{if(!(N(M,D.position)<=u.catchDistance))return D.destroy(),void H.processOnStart(e);A(D)}return D},y.prototype.getOrCreate=function(e,E){var H,N=this,u=N.options;return/(semi|static)/.test(u.mode)?(H=N.idles[0])?(N.idles.splice(0,1),H):"semi"===u.mode?N.createNipple(E,e):(console.warn("Coudln't find the needed nipple."),!1):H=N.createNipple(E,e)},y.prototype.processOnMove=function(e){var E=this,H=E.options,z=E.manager.getIdentifier(e),P=E.nipples.get(z),M=E.manager.scroll;if(function(e){return isNaN(e.buttons)?0!==e.pressure:0!==e.buttons}(e)){if(!P)return console.error("Found zombie joystick with ID "+z),void E.manager.removeIdentifier(z);if(H.dynamicPage){var D=P.el.getBoundingClientRect();P.position={x:M.x+D.left,y:M.y+D.top}}P.identifier=z;var A=P.options.size/2,C={x:e.pageX,y:e.pageY};H.lockX&&(C.y=P.position.y),H.lockY&&(C.x=P.position.x);var i,V,U,j,F,h,S,X,a,W,r=N(C,P.position),Y=(i=C,U=(V=P.position).x-i.x,j=V.y-i.y,function(e){return e*(180/Math.PI)}(Math.atan2(j,U))),f=u(Y),w=r/A,s={distance:r,position:C};if("circle"===P.options.shape?(F=Math.min(r,A),S=P.position,X=F,W={x:0,y:0},a=u(a=Y),W.x=S.x-X*Math.cos(a),W.y=S.y-X*Math.sin(a),h=W):(h=function(e,E,H){return{x:Math.min(Math.max(e.x,E.x-H),E.x+H),y:Math.min(Math.max(e.y,E.y-H),E.y+H)}}(C,P.position,A),F=N(h,P.position)),H.follow){if(r>A){var p=C.x-h.x,o=C.y-h.y;P.position.x+=p,P.position.y+=o,P.el.style.top=P.position.y-(E.box.top+M.y)+"px",P.el.style.left=P.position.x-(E.box.left+M.x)+"px",r=N(C,P.position)}}else C=h,r=F;var y=C.x-P.position.x,b=C.y-P.position.y;P.frontPosition={x:y,y:b},H.dataOnly||(P.ui.front.style.transform="translate("+y+"px,"+b+"px)");var K={identifier:P.identifier,position:C,force:w,pressure:e.force||e.pressure||e.webkitForce||0,distance:r,angle:{radian:f,degree:Y},vector:{x:y/A,y:-b/A},raw:s,instance:P,lockX:H.lockX,lockY:H.lockY};(K=P.computeDirection(K)).angle={radian:u(180-Y),degree:180-Y},P.trigger("move",K),E.trigger("move "+P.id+":move",K)}else this.processOnEnd(e)},y.prototype.processOnEnd=function(e){var E=this,H=E.options,N=E.manager.getIdentifier(e),u=E.nipples.get(N),z=E.manager.removeIdentifier(u.identifier);u&&(H.dataOnly||u.hide((function(){"dynamic"===H.mode&&(u.trigger("removed",u),E.trigger("removed "+u.id+":removed",u),E.manager.trigger("removed "+u.id+":removed",u),u.destroy())})),clearInterval(E.pressureIntervals[u.identifier]),u.resetDirection(),u.trigger("end",u),E.trigger("end "+u.id+":end",u),E.ids.indexOf(u.identifier)>=0&&E.ids.splice(E.ids.indexOf(u.identifier),1),E.actives.indexOf(u)>=0&&E.actives.splice(E.actives.indexOf(u),1),/(semi|static)/.test(H.mode)?E.idles.push(u):E.nipples.indexOf(u)>=0&&E.nipples.splice(E.nipples.indexOf(u),1),E.manager.unbindDocument(),/(semi|static)/.test(H.mode)&&(E.manager.ids[z.id]=z.identifier))},y.prototype.onDestroyed=function(e,E){var H=this;H.nipples.indexOf(E)>=0&&H.nipples.splice(H.nipples.indexOf(E),1),H.actives.indexOf(E)>=0&&H.actives.splice(H.actives.indexOf(E),1),H.idles.indexOf(E)>=0&&H.idles.splice(H.idles.indexOf(E),1),H.ids.indexOf(E.identifier)>=0&&H.ids.splice(H.ids.indexOf(E.identifier),1),H.manager.removeIdentifier(E.identifier),H.manager.unbindDocument()},y.prototype.destroy=function(){var e=this;for(var E in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(E)&&clearInterval(e.pressureIntervals[E]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};const b=y;function K(e){var E=this;E.ids={},E.index=0,E.collections=[],E.scroll=C(),E.config(e),E.prepareCollections();var H=function(){var e;E.collections.forEach((function(H){H.forEach((function(H){e=H.el.getBoundingClientRect(),H.position={x:E.scroll.x+e.left,y:E.scroll.y+e.top}}))}))};M(window,"resize",(function(){P(H)}));var N=function(){E.scroll=C()};return M(window,"scroll",(function(){P(N)})),E.collections}K.prototype=new s,K.constructor=K,K.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(E){var H;return e.collections.every((function(e){return!(H=e.get(E))})),H}},K.prototype.create=function(e){return this.createCollection(e)},K.prototype.createCollection=function(e){var E=this,H=new b(E,e);return E.bindCollection(H),E.collections.push(H),H},K.prototype.bindCollection=function(e){var E,H=this,N=function(e,N){E=e.type+" "+N.id+":"+e.type,H.trigger(E,N)};e.on("destroyed",H.onDestroyed.bind(H)),e.on("shown hidden rested dir plain",N),e.on("dir:up dir:right dir:down dir:left",N),e.on("plain:up plain:right plain:down plain:left",N)},K.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},K.prototype.unbindDocument=function(e){var E=this;Object.keys(E.ids).length&&!0!==e||(E.unbindEvt(document,"move").unbindEvt(document,"end"),E.binded=!1)},K.prototype.getIdentifier=function(e){var E;return e?void 0===(E=void 0===e.identifier?e.pointerId:e.identifier)&&(E=this.latest||0):E=this.index,void 0===this.ids[E]&&(this.ids[E]=this.index,this.index+=1),this.latest=E,this.ids[E]},K.prototype.removeIdentifier=function(e){var E={};for(var H in this.ids)if(this.ids[H]===e){E.id=H,E.identifier=this.ids[H],delete this.ids[H];break}return E},K.prototype.onmove=function(e){return this.onAny("move",e),!1},K.prototype.onend=function(e){return this.onAny("end",e),!1},K.prototype.oncancel=function(e){return this.onAny("end",e),!1},K.prototype.onAny=function(e,E){var H,N=this,u="processOn"+e.charAt(0).toUpperCase()+e.slice(1);E=A(E);var z=function(e,E,H){H.ids.indexOf(E)>=0&&(H[u](e),e._found_=!0)};return F(E,(function(e){H=N.getIdentifier(e),F(N.collections,z.bind(null,e,H)),e._found_||N.removeIdentifier(H)})),!1},K.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},K.prototype.onDestroyed=function(e,E){var H=this;if(H.collections.indexOf(E)<0)return!1;H.collections.splice(H.collections.indexOf(E),1)};var l=new K;const O={create:function(e){return l.create(e)},factory:l};return E.default})(),e.exports=E()},12844:(e,E,H)=>{"use strict";const{Deflate:N,deflate:u,deflateRaw:z,gzip:P}=H(12849),{Inflate:M,inflate:D,inflateRaw:A,ungzip:C}=H(12896),i=H(12869);e.exports.Deflate=N,e.exports.deflate=u,e.exports.deflateRaw=z,e.exports.gzip=P,e.exports.Inflate=M,e.exports.inflate=D,e.exports.inflateRaw=A,e.exports.ungzip=C,e.exports.constants=i},12849:(e,E,H)=>{"use strict";const N=H(12852),u=H(12876),z=H(12880),P=H(12867),M=H(12888),D=Object.prototype.toString,{Z_NO_FLUSH:A,Z_SYNC_FLUSH:C,Z_FULL_FLUSH:i,Z_FINISH:V,Z_OK:U,Z_STREAM_END:j,Z_DEFAULT_COMPRESSION:F,Z_DEFAULT_STRATEGY:h,Z_DEFLATED:S}=H(12869);function X(e){this.options=u.assign({level:F,method:S,de:16384,windowBits:15,memLevel:8,strategy:h},e||{});let E=this.options;E.raw&&E.windowBits>0?E.windowBits=-E.windowBits:E.gzip&&E.windowBits>0&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.AE="",this.ended=!1,this.chunks=[],this.strm=new M,this.strm.avail_out=0;let H=N.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(H!==U)throw new Error(P[H]);if(E.header&&N.deflateSetHeader(this.strm,E.header),E.dictionary){let e;if(e="string"===typeof E.dictionary?z.string2buf(E.dictionary):"[object ArrayBuffer]"===D.call(E.dictionary)?new Uint8Array(E.dictionary):E.dictionary,H=N.deflateSetDictionary(this.strm,e),H!==U)throw new Error(P[H]);this._dict_set=!0}}function a(e,E){const H=new X(E);if(H.push(e,!0),H.err)throw H.AE||P[H.err];return H.result}X.prototype.push=function(e,E){const H=this.strm,u=this.options.de;let P,M;if(this.ended)return!1;for(M=E===~~E?E:!0===E?V:A,"string"===typeof e?H.input=z.string2buf(e):"[object ArrayBuffer]"===D.call(e)?H.input=new Uint8Array(e):H.input=e,H.next_in=0,H.avail_in=H.input.length;;)if(0===H.avail_out&&(H.output=new Uint8Array(u),H.next_out=0,H.avail_out=u),(M===C||M===i)&&H.avail_out<=6)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else{if(P=N.deflate(H,M),P===j)return H.next_out>0&&this.onData(H.output.subarray(0,H.next_out)),P=N.deflateEnd(this.strm),this.onEnd(P),this.ended=!0,P===U;if(0!==H.avail_out){if(M>0&&H.next_out>0)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else if(0===H.avail_in)break}else this.onData(H.output)}return!0},X.prototype.onData=function(e){this.chunks.push(e)},X.prototype.onEnd=function(e){e===U&&(this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.AE=this.strm.AE},e.exports.Deflate=X,e.exports.deflate=a,e.exports.deflateRaw=function(e,E){return(E=E||{}).raw=!0,a(e,E)},e.exports.gzip=function(e,E){return(E=E||{}).gzip=!0,a(e,E)},e.exports.constants=H(12869)},12896:(e,E,H)=>{"use strict";const N=H(12903),u=H(12876),z=H(12880),P=H(12867),M=H(12888),D=H(12911),A=Object.prototype.toString,{Z_NO_FLUSH:C,Z_FINISH:i,Z_OK:V,Z_STREAM_END:U,Z_NEED_DICT:j,Z_STREAM_ERROR:F,Z_DATA_ERROR:h,Z_MEM_ERROR:S}=H(12869);function X(e){this.options=u.assign({de:65536,windowBits:15,to:""},e||{});const E=this.options;E.raw&&E.windowBits>=0&&E.windowBits<16&&(E.windowBits=-E.windowBits,0===E.windowBits&&(E.windowBits=-15)),!(E.windowBits>=0&&E.windowBits<16)||e&&e.windowBits||(E.windowBits+=32),E.windowBits>15&&E.windowBits<48&&0===(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.AE="",this.ended=!1,this.chunks=[],this.strm=new M,this.strm.avail_out=0;let H=N.inflateInit2(this.strm,E.windowBits);if(H!==V)throw new Error(P[H]);if(this.header=new D,N.inflateGetHeader(this.strm,this.header),E.dictionary&&("string"===typeof E.dictionary?E.dictionary=z.string2buf(E.dictionary):"[object ArrayBuffer]"===A.call(E.dictionary)&&(E.dictionary=new Uint8Array(E.dictionary)),E.raw&&(H=N.inflateSetDictionary(this.strm,E.dictionary),H!==V)))throw new Error(P[H])}function a(e,E){const H=new X(E);if(H.push(e),H.err)throw H.AE||P[H.err];return H.result}X.prototype.push=function(e,E){const H=this.strm,u=this.options.de,P=this.options.dictionary;let M,D,X;if(this.ended)return!1;for(D=E===~~E?E:!0===E?i:C,"[object ArrayBuffer]"===A.call(e)?H.input=new Uint8Array(e):H.input=e,H.next_in=0,H.avail_in=H.input.length;;){for(0===H.avail_out&&(H.output=new Uint8Array(u),H.next_out=0,H.avail_out=u),M=N.inflate(H,D),M===j&&P&&(M=N.inflateSetDictionary(H,P),M===V?M=N.inflate(H,D):M===h&&(M=j));H.avail_in>0&&M===U&&H.state.wrap>0&&0!==e[H.next_in];)N.inflateReset(H),M=N.inflate(H,D);switch(M){case F:case h:case j:case S:return this.onEnd(M),this.ended=!0,!1}if(X=H.avail_out,H.next_out&&(0===H.avail_out||M===U))if("string"===this.options.to){let e=z.utf8border(H.output,H.next_out),E=H.next_out-e,N=z.buf2string(H.output,e);H.next_out=E,H.avail_out=u-E,E&&H.output.set(H.output.subarray(e,e+E),0),this.onData(N)}else this.onData(H.output.length===H.next_out?H.output:H.output.subarray(0,H.next_out));if(M!==V||0!==X){if(M===U)return M=N.inflateEnd(this.strm),this.onEnd(M),this.ended=!0,!0;if(0===H.avail_in)break}}return!0},X.prototype.onData=function(e){this.chunks.push(e)},X.prototype.onEnd=function(e){e===V&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.AE=this.strm.AE},e.exports.Inflate=X,e.exports.inflate=a,e.exports.inflateRaw=function(e,E){return(E=E||{}).raw=!0,a(e,E)},e.exports.ungzip=a,e.exports.constants=H(12869)},12876:e=>{"use strict";const E=(e,E)=>Object.prototype.hasOwnProperty.call(e,E);e.exports.assign=function(e){const H=Array.prototype.slice.call(arguments,1);for(;H.length;){const N=H.shift();if(N){if("object"!==typeof N)throw new TypeError(N+"must be non-object");for(const H in N)E(N,H)&&(e[H]=N[H])}}return e},e.exports.flattenChunks=e=>{let E=0;for(let N=0,u=e.length;N<u;N++)E+=e[N].length;const H=new Uint8Array(E);for(let N=0,u=0,z=e.length;N<z;N++){let E=e[N];H.set(E,u),u+=E.length}return H}},12880:e=>{"use strict";let E=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(N){E=!1}const H=new Uint8Array(256);for(let u=0;u<256;u++)H[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;H[254]=H[254]=1,e.exports.string2buf=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let E,H,N,u,z,P=e.length,M=0;for(u=0;u<P;u++)H=e.charCodeAt(u),55296===(64512&H)&&u+1<P&&(N=e.charCodeAt(u+1),56320===(64512&N)&&(H=65536+(H-55296<<10)+(N-56320),u++)),M+=H<128?1:H<2048?2:H<65536?3:4;for(E=new Uint8Array(M),z=0,u=0;z<M;u++)H=e.charCodeAt(u),55296===(64512&H)&&u+1<P&&(N=e.charCodeAt(u+1),56320===(64512&N)&&(H=65536+(H-55296<<10)+(N-56320),u++)),H<128?E[z++]=H:H<2048?(E[z++]=192|H>>>6,E[z++]=128|63&H):H<65536?(E[z++]=224|H>>>12,E[z++]=128|H>>>6&63,E[z++]=128|63&H):(E[z++]=240|H>>>18,E[z++]=128|H>>>12&63,E[z++]=128|H>>>6&63,E[z++]=128|63&H);return E};e.exports.buf2string=(e,N)=>{const u=N||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,N));let z,P;const M=new Array(2*u);for(P=0,z=0;z<u;){let E=e[z++];if(E<128){M[P++]=E;continue}let N=H[E];if(N>4)M[P++]=65533,z+=N-1;else{for(E&=2===N?31:3===N?15:7;N>1&&z<u;)E=E<<6|63&e[z++],N--;N>1?M[P++]=65533:E<65536?M[P++]=E:(E-=65536,M[P++]=55296|E>>10&1023,M[P++]=56320|1023&E)}}return((e,H)=>{if(H<65534&&e.subarray&&E)return String.fromCharCode.apply(null,e.length===H?e:e.subarray(0,H));let N="";for(let E=0;E<H;E++)N+=String.fromCharCode(e[E]);return N})(M,P)},e.exports.utf8border=(e,E)=>{(E=E||e.length)>e.length&&(E=e.length);let N=E-1;for(;N>=0&&128===(192&e[N]);)N--;return N<0||0===N?E:N+H[e[N]]>E?N:E}},12858:e=>{"use strict";e.exports=(e,E,H,N)=>{let u=65535&e,z=e>>>16&65535,P=0;for(;0!==H;){P=H>2e3?2e3:H,H-=P;do{u=u+E[N++]|0,z=z+u|0}while(--P);u%=65521,z%=65521}return u|z<<16}},12869:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12862:e=>{"use strict";const E=new Uint32Array((()=>{let e,E=[];for(var H=0;H<256;H++){e=H;for(var N=0;N<8;N++)e=1&e?3988292384^e>>>1:e>>>1;E[H]=e}return E})());e.exports=(e,H,N,u)=>{const z=E,P=u+N;e^=-1;for(let E=u;E<P;E++)e=e>>>8^z[255&(e^H[E])];return~e}},12852:(e,E,H)=>{"use strict";const{_tr_init:N,_tr_stored_block:u,_tr_flush_block:z,_tr_tally:P,_tr_align:M}=H(12854),D=H(12858),A=H(12862),C=H(12867),{Z_NO_FLUSH:i,Z_PARTIAL_FLUSH:V,Z_FULL_FLUSH:U,Z_FINISH:j,Z_BLOCK:F,Z_OK:h,Z_STREAM_END:S,Z_STREAM_ERROR:X,Z_DATA_ERROR:a,Z_BUF_ERROR:W,Z_DEFAULT_COMPRESSION:r,Z_FILTERED:Y,Z_HUFFMAN_ONLY:f,Z_RLE:w,Z_FIXED:s,Z_DEFAULT_STRATEGY:p,Z_UNKNOWN:o,Z_DEFLATED:y}=H(12869),b=258,K=262,l=103,O=113,v=666,R=(e,E)=>(e.AE=C[E],E),T=e=>(e<<1)-(e>4?9:0),L=e=>{let E=e.length;for(;--E>=0;)e[E]=0};let d=(e,E,H)=>(E<<e.hash_shift^H)&e.hash_mask;const G=e=>{const E=e.state;let H=E.pending;H>e.avail_out&&(H=e.avail_out),0!==H&&(e.output.set(E.pending_buf.subarray(E.pending_out,E.pending_out+H),e.next_out),e.next_out+=H,E.pending_out+=H,e.total_out+=H,e.avail_out-=H,E.pending-=H,0===E.pending&&(E.pending_out=0))},me=(e,E)=>{z(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,E),e.block_start=e.strstart,G(e.strm)},Q=(e,E)=>{e.pending_buf[e.pending++]=E},Z=(e,E)=>{e.pending_buf[e.pending++]=E>>>8&255,e.pending_buf[e.pending++]=255&E},k=(e,E,H,N)=>{let u=e.avail_in;return u>N&&(u=N),0===u?0:(e.avail_in-=u,E.set(e.input.subarray(e.next_in,e.next_in+u),H),1===e.state.wrap?e.adler=D(e.adler,E,u,H):2===e.state.wrap&&(e.adler=A(e.adler,E,u,H)),e.next_in+=u,e.total_in+=u,u)},J=(e,E)=>{let H,N,u=e.max_chain_length,z=e.strstart,P=e.prev_length,M=e.nice_match;const D=e.strstart>e.w_size-K?e.strstart-(e.w_size-K):0,A=e.window,C=e.w_mask,i=e.prev,V=e.strstart+b;let U=A[z+P-1],j=A[z+P];e.prev_length>=e.good_match&&(u>>=2),M>e.lookahead&&(M=e.lookahead);do{if(H=E,A[H+P]===j&&A[H+P-1]===U&&A[H]===A[z]&&A[++H]===A[z+1]){z+=2,H++;do{}while(A[++z]===A[++H]&&A[++z]===A[++H]&&A[++z]===A[++H]&&A[++z]===A[++H]&&A[++z]===A[++H]&&A[++z]===A[++H]&&A[++z]===A[++H]&&A[++z]===A[++H]&&z<V);if(N=b-(V-z),z=V-b,N>P){if(e.match_start=E,P=N,N>=M)break;U=A[z+P-1],j=A[z+P]}}}while((E=i[E&C])>D&&0!==--u);return P<=e.lookahead?P:e.lookahead},B=e=>{const E=e.w_size;let H,N,u,z,P;do{if(z=e.window_size-e.lookahead-e.strstart,e.strstart>=E+(E-K)){e.window.set(e.window.subarray(E,E+E),0),e.match_start-=E,e.strstart-=E,e.block_start-=E,N=e.hash_size,H=N;do{u=e.head[--H],e.head[H]=u>=E?u-E:0}while(--N);N=E,H=N;do{u=e.prev[--H],e.prev[H]=u>=E?u-E:0}while(--N);z+=E}if(0===e.strm.avail_in)break;if(N=k(e.strm,e.window,e.strstart+e.lookahead,z),e.lookahead+=N,e.lookahead+e.insert>=3)for(P=e.strstart-e.insert,e.ins_h=e.window[P],e.ins_h=d(e,e.ins_h,e.window[P+1]);e.insert&&(e.ins_h=d(e,e.ins_h,e.window[P+3-1]),e.prev[P&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=P,P++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<K&&0!==e.strm.avail_in)},I=(e,E)=>{let H,N;for(;;){if(e.lookahead<K){if(B(e),e.lookahead<K&&E===i)return 1;if(0===e.lookahead)break}if(H=0,e.lookahead>=3&&(e.ins_h=d(e,e.ins_h,e.window[e.strstart+3-1]),H=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==H&&e.strstart-H<=e.w_size-K&&(e.match_length=J(e,H)),e.match_length>=3)if(N=P(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=d(e,e.ins_h,e.window[e.strstart+3-1]),H=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=d(e,e.ins_h,e.window[e.strstart+1]);else N=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(N&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,E===j?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2},t=(e,E)=>{let H,N,u;for(;;){if(e.lookahead<K){if(B(e),e.lookahead<K&&E===i)return 1;if(0===e.lookahead)break}if(H=0,e.lookahead>=3&&(e.ins_h=d(e,e.ins_h,e.window[e.strstart+3-1]),H=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==H&&e.prev_length<e.max_lazy_match&&e.strstart-H<=e.w_size-K&&(e.match_length=J(e,H),e.match_length<=5&&(e.strategy===Y||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){u=e.strstart+e.lookahead-3,N=P(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=u&&(e.ins_h=d(e,e.ins_h,e.window[e.strstart+3-1]),H=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,N&&(me(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(N=P(e,0,e.window[e.strstart-1]),N&&me(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(N=P(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,E===j?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2};function q(e,E,H,N,u){this.good_length=e,this.max_lazy=E,this.nice_length=H,this.max_chain=N,this.func=u}const c=[new q(0,0,0,0,((e,E)=>{let H=65535;for(H>e.pending_buf_size-5&&(H=e.pending_buf_size-5);;){if(e.lookahead<=1){if(B(e),0===e.lookahead&&E===i)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const N=e.block_start+H;if((0===e.strstart||e.strstart>=N)&&(e.lookahead=e.strstart-N,e.strstart=N,me(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-K&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,E===j?(me(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(me(e,!1),e.strm.avail_out),1)})),new q(4,4,8,4,I),new q(4,5,16,8,I),new q(4,6,32,32,I),new q(4,4,16,16,t),new q(8,16,32,32,t),new q(8,16,128,128,t),new q(8,32,128,256,t),new q(32,128,258,1024,t),new q(32,258,258,4096,t)];function n(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),L(this.dyn_ltree),L(this.dyn_dtree),L(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),L(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),L(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const g=e=>{if(!e||!e.state)return R(e,X);e.total_in=e.total_out=0,e.data_type=o;const E=e.state;return E.pending=0,E.pending_out=0,E.wrap<0&&(E.wrap=-E.wrap),E.status=E.wrap?42:O,e.adler=2===E.wrap?0:1,E.last_flush=i,N(E),h},x=e=>{const E=g(e);var H;return E===h&&((H=e.state).window_size=2*H.w_size,L(H.head),H.max_lazy_match=c[H.level].max_lazy,H.good_match=c[H.level].good_length,H.nice_match=c[H.level].nice_length,H.max_chain_length=c[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=2,H.match_available=0,H.ins_h=0),E},ee=(e,E,H,N,u,z)=>{if(!e)return X;let P=1;if(E===r&&(E=6),N<0?(P=0,N=-N):N>15&&(P=2,N-=16),u<1||u>9||H!==y||N<8||N>15||E<0||E>9||z<0||z>s)return R(e,X);8===N&&(N=9);const M=new n;return e.state=M,M.strm=e,M.wrap=P,M.gzhead=null,M.w_bits=N,M.w_size=1<<M.w_bits,M.w_mask=M.w_size-1,M.hash_bits=u+7,M.hash_size=1<<M.hash_bits,M.hash_mask=M.hash_size-1,M.hash_shift=~~((M.hash_bits+3-1)/3),M.window=new Uint8Array(2*M.w_size),M.head=new Uint16Array(M.hash_size),M.prev=new Uint16Array(M.w_size),M.lit_bufsize=1<<u+6,M.pending_buf_size=4*M.lit_bufsize,M.pending_buf=new Uint8Array(M.pending_buf_size),M.d_buf=1*M.lit_bufsize,M.l_buf=3*M.lit_bufsize,M.level=E,M.strategy=z,M.method=H,x(e)};e.exports.deflateInit=(e,E)=>ee(e,E,y,15,8,p),e.exports.deflateInit2=ee,e.exports.deflateReset=x,e.exports.deflateResetKeep=g,e.exports.deflateSetHeader=(e,E)=>e&&e.state?2!==e.state.wrap?X:(e.state.gzhead=E,h):X,e.exports.deflate=(e,E)=>{let H,N;if(!e||!e.state||E>F||E<0)return e?R(e,X):X;const z=e.state;if(!e.output||!e.input&&0!==e.avail_in||z.status===v&&E!==j)return R(e,0===e.avail_out?W:X);z.strm=e;const D=z.last_flush;if(z.last_flush=E,42===z.status)if(2===z.wrap)e.adler=0,Q(z,31),Q(z,139),Q(z,8),z.gzhead?(Q(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),Q(z,255&z.gzhead.time),Q(z,z.gzhead.time>>8&255),Q(z,z.gzhead.time>>16&255),Q(z,z.gzhead.time>>24&255),Q(z,9===z.level?2:z.strategy>=f||z.level<2?4:0),Q(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(Q(z,255&z.gzhead.extra.length),Q(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(e.adler=A(e.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(Q(z,0),Q(z,0),Q(z,0),Q(z,0),Q(z,0),Q(z,9===z.level?2:z.strategy>=f||z.level<2?4:0),Q(z,3),z.status=O);else{let E=y+(z.w_bits-8<<4)<<8,H=-1;H=z.strategy>=f||z.level<2?0:z.level<6?1:6===z.level?2:3,E|=H<<6,0!==z.strstart&&(E|=32),E+=31-E%31,z.status=O,Z(z,E),0!==z.strstart&&(Z(z,e.adler>>>16),Z(z,65535&e.adler)),e.adler=1}if(69===z.status)if(z.gzhead.extra){for(H=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>H&&(e.adler=A(e.adler,z.pending_buf,z.pending-H,H)),G(e),H=z.pending,z.pending!==z.pending_buf_size));)Q(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>H&&(e.adler=A(e.adler,z.pending_buf,z.pending-H,H)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(73===z.status)if(z.gzhead.name){H=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>H&&(e.adler=A(e.adler,z.pending_buf,z.pending-H,H)),G(e),H=z.pending,z.pending===z.pending_buf_size)){N=1;break}N=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,Q(z,N)}while(0!==N);z.gzhead.hcrc&&z.pending>H&&(e.adler=A(e.adler,z.pending_buf,z.pending-H,H)),0===N&&(z.gzindex=0,z.status=91)}else z.status=91;if(91===z.status)if(z.gzhead.comment){H=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>H&&(e.adler=A(e.adler,z.pending_buf,z.pending-H,H)),G(e),H=z.pending,z.pending===z.pending_buf_size)){N=1;break}N=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,Q(z,N)}while(0!==N);z.gzhead.hcrc&&z.pending>H&&(e.adler=A(e.adler,z.pending_buf,z.pending-H,H)),0===N&&(z.status=l)}else z.status=l;if(z.status===l&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&G(e),z.pending+2<=z.pending_buf_size&&(Q(z,255&e.adler),Q(z,e.adler>>8&255),e.adler=0,z.status=O)):z.status=O),0!==z.pending){if(G(e),0===e.avail_out)return z.last_flush=-1,h}else if(0===e.avail_in&&T(E)<=T(D)&&E!==j)return R(e,W);if(z.status===v&&0!==e.avail_in)return R(e,W);if(0!==e.avail_in||0!==z.lookahead||E!==i&&z.status!==v){let H=z.strategy===f?((e,E)=>{let H;for(;;){if(0===e.lookahead&&(B(e),0===e.lookahead)){if(E===i)return 1;break}if(e.match_length=0,H=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,H&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,E===j?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2})(z,E):z.strategy===w?((e,E)=>{let H,N,u,z;const M=e.window;for(;;){if(e.lookahead<=b){if(B(e),e.lookahead<=b&&E===i)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(u=e.strstart-1,N=M[u],N===M[++u]&&N===M[++u]&&N===M[++u])){z=e.strstart+b;do{}while(N===M[++u]&&N===M[++u]&&N===M[++u]&&N===M[++u]&&N===M[++u]&&N===M[++u]&&N===M[++u]&&N===M[++u]&&u<z);e.match_length=b-(z-u),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(H=P(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(H=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),H&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,E===j?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2})(z,E):c[z.level].func(z,E);if(3!==H&&4!==H||(z.status=v),1===H||3===H)return 0===e.avail_out&&(z.last_flush=-1),h;if(2===H&&(E===V?M(z):E!==F&&(u(z,0,0,!1),E===U&&(L(z.head),0===z.lookahead&&(z.strstart=0,z.block_start=0,z.insert=0))),G(e),0===e.avail_out))return z.last_flush=-1,h}return E!==j?h:z.wrap<=0?S:(2===z.wrap?(Q(z,255&e.adler),Q(z,e.adler>>8&255),Q(z,e.adler>>16&255),Q(z,e.adler>>24&255),Q(z,255&e.total_in),Q(z,e.total_in>>8&255),Q(z,e.total_in>>16&255),Q(z,e.total_in>>24&255)):(Z(z,e.adler>>>16),Z(z,65535&e.adler)),G(e),z.wrap>0&&(z.wrap=-z.wrap),0!==z.pending?h:S)},e.exports.deflateEnd=e=>{if(!e||!e.state)return X;const E=e.state.status;return 42!==E&&69!==E&&73!==E&&91!==E&&E!==l&&E!==O&&E!==v?R(e,X):(e.state=null,E===O?R(e,a):h)},e.exports.deflateSetDictionary=(e,E)=>{let H=E.length;if(!e||!e.state)return X;const N=e.state,u=N.wrap;if(2===u||1===u&&42!==N.status||N.lookahead)return X;if(1===u&&(e.adler=D(e.adler,E,H,0)),N.wrap=0,H>=N.w_size){0===u&&(L(N.head),N.strstart=0,N.block_start=0,N.insert=0);let e=new Uint8Array(N.w_size);e.set(E.subarray(H-N.w_size,H),0),E=e,H=N.w_size}const z=e.avail_in,P=e.next_in,M=e.input;for(e.avail_in=H,e.next_in=0,e.input=E,B(N);N.lookahead>=3;){let e=N.strstart,E=N.lookahead-2;do{N.ins_h=d(N,N.ins_h,N.window[e+3-1]),N.prev[e&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=e,e++}while(--E);N.strstart=e,N.lookahead=2,B(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=2,N.match_available=0,e.next_in=P,e.input=M,e.avail_in=z,N.wrap=u,h},e.exports.deflateInfo="pako deflate (from Nodeca project)"},12911:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12905:e=>{"use strict";e.exports=function(e,E){let H,N,u,z,P,M,D,A,C,i,V,U,j,F,h,S,X,a,W,r,Y,f,w,s;const p=e.state;H=e.next_in,w=e.input,N=H+(e.avail_in-5),u=e.next_out,s=e.output,z=u-(E-e.avail_out),P=u+(e.avail_out-257),M=p.dmax,D=p.wsize,A=p.whave,C=p.wnext,i=p.window,V=p.hold,U=p.bits,j=p.lencode,F=p.distcode,h=(1<<p.lenbits)-1,S=(1<<p.distbits)-1;e:do{U<15&&(V+=w[H++]<<U,U+=8,V+=w[H++]<<U,U+=8),X=j[V&h];E:for(;;){if(a=X>>>24,V>>>=a,U-=a,a=X>>>16&255,0===a)s[u++]=65535&X;else{if(!(16&a)){if(0===(64&a)){X=j[(65535&X)+(V&(1<<a)-1)];continue E}if(32&a){p.mode=12;break e}e.AE="invalid literal/length code",p.mode=30;break e}W=65535&X,a&=15,a&&(U<a&&(V+=w[H++]<<U,U+=8),W+=V&(1<<a)-1,V>>>=a,U-=a),U<15&&(V+=w[H++]<<U,U+=8,V+=w[H++]<<U,U+=8),X=F[V&S];H:for(;;){if(a=X>>>24,V>>>=a,U-=a,a=X>>>16&255,!(16&a)){if(0===(64&a)){X=F[(65535&X)+(V&(1<<a)-1)];continue H}e.AE="invalid distance code",p.mode=30;break e}if(r=65535&X,a&=15,U<a&&(V+=w[H++]<<U,U+=8,U<a&&(V+=w[H++]<<U,U+=8)),r+=V&(1<<a)-1,r>M){e.AE="invalid distance too far back",p.mode=30;break e}if(V>>>=a,U-=a,a=u-z,r>a){if(a=r-a,a>A&&p.sane){e.AE="invalid distance too far back",p.mode=30;break e}if(Y=0,f=i,0===C){if(Y+=D-a,a<W){W-=a;do{s[u++]=i[Y++]}while(--a);Y=u-r,f=s}}else if(C<a){if(Y+=D+C-a,a-=C,a<W){W-=a;do{s[u++]=i[Y++]}while(--a);if(Y=0,C<W){a=C,W-=a;do{s[u++]=i[Y++]}while(--a);Y=u-r,f=s}}}else if(Y+=C-a,a<W){W-=a;do{s[u++]=i[Y++]}while(--a);Y=u-r,f=s}for(;W>2;)s[u++]=f[Y++],s[u++]=f[Y++],s[u++]=f[Y++],W-=3;W&&(s[u++]=f[Y++],W>1&&(s[u++]=f[Y++]))}else{Y=u-r;do{s[u++]=s[Y++],s[u++]=s[Y++],s[u++]=s[Y++],W-=3}while(W>2);W&&(s[u++]=s[Y++],W>1&&(s[u++]=s[Y++]))}break}}break}}while(H<N&&u<P);W=U>>3,H-=W,U-=W<<3,V&=(1<<U)-1,e.next_in=H,e.next_out=u,e.avail_in=H<N?N-H+5:5-(H-N),e.avail_out=u<P?P-u+257:257-(u-P),p.hold=V,p.bits=U}},12903:(e,E,H)=>{"use strict";const N=H(12858),u=H(12862),z=H(12905),P=H(12907),{Z_FINISH:M,Z_BLOCK:D,Z_TREES:A,Z_OK:C,Z_STREAM_END:i,Z_NEED_DICT:V,Z_STREAM_ERROR:U,Z_DATA_ERROR:j,Z_MEM_ERROR:F,Z_BUF_ERROR:h,Z_DEFLATED:S}=H(12869),X=12,a=30,W=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Y=e=>{if(!e||!e.state)return U;const E=e.state;return e.total_in=e.total_out=E.total=0,e.AE="",E.wrap&&(e.adler=1&E.wrap),E.mode=1,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new Int32Array(852),E.distcode=E.distdyn=new Int32Array(592),E.sane=1,E.back=-1,C},f=e=>{if(!e||!e.state)return U;const E=e.state;return E.wsize=0,E.whave=0,E.wnext=0,Y(e)},w=(e,E)=>{let H;if(!e||!e.state)return U;const N=e.state;return E<0?(H=0,E=-E):(H=1+(E>>4),E<48&&(E&=15)),E&&(E<8||E>15)?U:(null!==N.window&&N.wbits!==E&&(N.window=null),N.wrap=H,N.wbits=E,f(e))},s=(e,E)=>{if(!e)return U;const H=new r;e.state=H,H.window=null;const N=w(e,E);return N!==C&&(e.state=null),N};let p,o,y=!0;const b=e=>{if(y){p=new Int32Array(512),o=new Int32Array(32);let E=0;for(;E<144;)e.lens[E++]=8;for(;E<256;)e.lens[E++]=9;for(;E<280;)e.lens[E++]=7;for(;E<288;)e.lens[E++]=8;for(P(1,e.lens,0,288,p,0,e.work,{bits:9}),E=0;E<32;)e.lens[E++]=5;P(2,e.lens,0,32,o,0,e.work,{bits:5}),y=!1}e.lencode=p,e.lenbits=9,e.distcode=o,e.distbits=5},K=(e,E,H,N)=>{let u;const z=e.state;return null===z.window&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new Uint8Array(z.wsize)),N>=z.wsize?(z.window.set(E.subarray(H-z.wsize,H),0),z.wnext=0,z.whave=z.wsize):(u=z.wsize-z.wnext,u>N&&(u=N),z.window.set(E.subarray(H-N,H-N+u),z.wnext),(N-=u)?(z.window.set(E.subarray(H-N,H),0),z.wnext=N,z.whave=z.wsize):(z.wnext+=u,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=u))),0};e.exports.inflateReset=f,e.exports.inflateReset2=w,e.exports.inflateResetKeep=Y,e.exports.inflateInit=e=>s(e,15),e.exports.inflateInit2=s,e.exports.inflate=(e,E)=>{let H,r,Y,f,w,s,p,o,y,l,O,v,R,T,L,d,G,me,Q,Z,k,J,B=0;const I=new Uint8Array(4);let t,q;const c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return U;H=e.state,H.mode===X&&(H.mode=13),w=e.next_out,Y=e.output,p=e.avail_out,f=e.next_in,r=e.input,s=e.avail_in,o=H.hold,y=H.bits,l=s,O=p,J=C;e:for(;;)switch(H.mode){case 1:if(0===H.wrap){H.mode=13;break}for(;y<16;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(2&H.wrap&&35615===o){H.check=0,I[0]=255&o,I[1]=o>>>8&255,H.check=u(H.check,I,2,0),o=0,y=0,H.mode=2;break}if(H.flags=0,H.head&&(H.head.done=!1),!(1&H.wrap)||(((255&o)<<8)+(o>>8))%31){e.AE="incorrect header check",H.mode=a;break}if((15&o)!==S){e.AE="unknown compression method",H.mode=a;break}if(o>>>=4,y-=4,k=8+(15&o),0===H.wbits)H.wbits=k;else if(k>H.wbits){e.AE="invalid window size",H.mode=a;break}H.dmax=1<<H.wbits,e.adler=H.check=1,H.mode=512&o?10:X,o=0,y=0;break;case 2:for(;y<16;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(H.flags=o,(255&H.flags)!==S){e.AE="unknown compression method",H.mode=a;break}if(57344&H.flags){e.AE="unknown header flags set",H.mode=a;break}H.head&&(H.head.text=o>>8&1),512&H.flags&&(I[0]=255&o,I[1]=o>>>8&255,H.check=u(H.check,I,2,0)),o=0,y=0,H.mode=3;case 3:for(;y<32;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}H.head&&(H.head.time=o),512&H.flags&&(I[0]=255&o,I[1]=o>>>8&255,I[2]=o>>>16&255,I[3]=o>>>24&255,H.check=u(H.check,I,4,0)),o=0,y=0,H.mode=4;case 4:for(;y<16;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}H.head&&(H.head.xflags=255&o,H.head.os=o>>8),512&H.flags&&(I[0]=255&o,I[1]=o>>>8&255,H.check=u(H.check,I,2,0)),o=0,y=0,H.mode=5;case 5:if(1024&H.flags){for(;y<16;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}H.length=o,H.head&&(H.head.extra_len=o),512&H.flags&&(I[0]=255&o,I[1]=o>>>8&255,H.check=u(H.check,I,2,0)),o=0,y=0}else H.head&&(H.head.extra=null);H.mode=6;case 6:if(1024&H.flags&&(v=H.length,v>s&&(v=s),v&&(H.head&&(k=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Uint8Array(H.head.extra_len)),H.head.extra.set(r.subarray(f,f+v),k)),512&H.flags&&(H.check=u(H.check,r,v,f)),s-=v,f+=v,H.length-=v),H.length))break e;H.length=0,H.mode=7;case 7:if(2048&H.flags){if(0===s)break e;v=0;do{k=r[f+v++],H.head&&k&&H.length<65536&&(H.head.name+=String.fromCharCode(k))}while(k&&v<s);if(512&H.flags&&(H.check=u(H.check,r,v,f)),s-=v,f+=v,k)break e}else H.head&&(H.head.name=null);H.length=0,H.mode=8;case 8:if(4096&H.flags){if(0===s)break e;v=0;do{k=r[f+v++],H.head&&k&&H.length<65536&&(H.head.comment+=String.fromCharCode(k))}while(k&&v<s);if(512&H.flags&&(H.check=u(H.check,r,v,f)),s-=v,f+=v,k)break e}else H.head&&(H.head.comment=null);H.mode=9;case 9:if(512&H.flags){for(;y<16;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(o!==(65535&H.check)){e.AE="header crc mismatch",H.mode=a;break}o=0,y=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),e.adler=H.check=0,H.mode=X;break;case 10:for(;y<32;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}e.adler=H.check=W(o),o=0,y=0,H.mode=11;case 11:if(0===H.havedict)return e.next_out=w,e.avail_out=p,e.next_in=f,e.avail_in=s,H.hold=o,H.bits=y,V;e.adler=H.check=1,H.mode=X;case X:if(E===D||E===A)break e;case 13:if(H.last){o>>>=7&y,y-=7&y,H.mode=27;break}for(;y<3;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}switch(H.last=1&o,o>>>=1,y-=1,3&o){case 0:H.mode=14;break;case 1:if(b(H),H.mode=20,E===A){o>>>=2,y-=2;break e}break;case 2:H.mode=17;break;case 3:e.AE="invalid block type",H.mode=a}o>>>=2,y-=2;break;case 14:for(o>>>=7&y,y-=7&y;y<32;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if((65535&o)!==(o>>>16^65535)){e.AE="invalid stored block lengths",H.mode=a;break}if(H.length=65535&o,o=0,y=0,H.mode=15,E===A)break e;case 15:H.mode=16;case 16:if(v=H.length,v){if(v>s&&(v=s),v>p&&(v=p),0===v)break e;Y.set(r.subarray(f,f+v),w),s-=v,f+=v,p-=v,w+=v,H.length-=v;break}H.mode=X;break;case 17:for(;y<14;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(H.nlen=257+(31&o),o>>>=5,y-=5,H.ndist=1+(31&o),o>>>=5,y-=5,H.ncode=4+(15&o),o>>>=4,y-=4,H.nlen>286||H.ndist>30){e.AE="too many length or distance symbols",H.mode=a;break}H.have=0,H.mode=18;case 18:for(;H.have<H.ncode;){for(;y<3;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}H.lens[c[H.have++]]=7&o,o>>>=3,y-=3}for(;H.have<19;)H.lens[c[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,t={bits:H.lenbits},J=P(0,H.lens,0,19,H.lencode,0,H.work,t),H.lenbits=t.bits,J){e.AE="invalid code lengths set",H.mode=a;break}H.have=0,H.mode=19;case 19:for(;H.have<H.nlen+H.ndist;){for(;B=H.lencode[o&(1<<H.lenbits)-1],L=B>>>24,d=B>>>16&255,G=65535&B,!(L<=y);){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(G<16)o>>>=L,y-=L,H.lens[H.have++]=G;else{if(16===G){for(q=L+2;y<q;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(o>>>=L,y-=L,0===H.have){e.AE="invalid bit length repeat",H.mode=a;break}k=H.lens[H.have-1],v=3+(3&o),o>>>=2,y-=2}else if(17===G){for(q=L+3;y<q;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}o>>>=L,y-=L,k=0,v=3+(7&o),o>>>=3,y-=3}else{for(q=L+7;y<q;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}o>>>=L,y-=L,k=0,v=11+(127&o),o>>>=7,y-=7}if(H.have+v>H.nlen+H.ndist){e.AE="invalid bit length repeat",H.mode=a;break}for(;v--;)H.lens[H.have++]=k}}if(H.mode===a)break;if(0===H.lens[256]){e.AE="invalid code -- missing end-of-block",H.mode=a;break}if(H.lenbits=9,t={bits:H.lenbits},J=P(1,H.lens,0,H.nlen,H.lencode,0,H.work,t),H.lenbits=t.bits,J){e.AE="invalid literal/lengths set",H.mode=a;break}if(H.distbits=6,H.distcode=H.distdyn,t={bits:H.distbits},J=P(2,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,t),H.distbits=t.bits,J){e.AE="invalid distances set",H.mode=a;break}if(H.mode=20,E===A)break e;case 20:H.mode=21;case 21:if(s>=6&&p>=258){e.next_out=w,e.avail_out=p,e.next_in=f,e.avail_in=s,H.hold=o,H.bits=y,z(e,O),w=e.next_out,Y=e.output,p=e.avail_out,f=e.next_in,r=e.input,s=e.avail_in,o=H.hold,y=H.bits,H.mode===X&&(H.back=-1);break}for(H.back=0;B=H.lencode[o&(1<<H.lenbits)-1],L=B>>>24,d=B>>>16&255,G=65535&B,!(L<=y);){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(d&&0===(240&d)){for(me=L,Q=d,Z=G;B=H.lencode[Z+((o&(1<<me+Q)-1)>>me)],L=B>>>24,d=B>>>16&255,G=65535&B,!(me+L<=y);){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}o>>>=me,y-=me,H.back+=me}if(o>>>=L,y-=L,H.back+=L,H.length=G,0===d){H.mode=26;break}if(32&d){H.back=-1,H.mode=X;break}if(64&d){e.AE="invalid literal/length code",H.mode=a;break}H.extra=15&d,H.mode=22;case 22:if(H.extra){for(q=H.extra;y<q;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}H.length+=o&(1<<H.extra)-1,o>>>=H.extra,y-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=23;case 23:for(;B=H.distcode[o&(1<<H.distbits)-1],L=B>>>24,d=B>>>16&255,G=65535&B,!(L<=y);){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(0===(240&d)){for(me=L,Q=d,Z=G;B=H.distcode[Z+((o&(1<<me+Q)-1)>>me)],L=B>>>24,d=B>>>16&255,G=65535&B,!(me+L<=y);){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}o>>>=me,y-=me,H.back+=me}if(o>>>=L,y-=L,H.back+=L,64&d){e.AE="invalid distance code",H.mode=a;break}H.offset=G,H.extra=15&d,H.mode=24;case 24:if(H.extra){for(q=H.extra;y<q;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}H.offset+=o&(1<<H.extra)-1,o>>>=H.extra,y-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){e.AE="invalid distance too far back",H.mode=a;break}H.mode=25;case 25:if(0===p)break e;if(v=O-p,H.offset>v){if(v=H.offset-v,v>H.whave&&H.sane){e.AE="invalid distance too far back",H.mode=a;break}v>H.wnext?(v-=H.wnext,R=H.wsize-v):R=H.wnext-v,v>H.length&&(v=H.length),T=H.window}else T=Y,R=w-H.offset,v=H.length;v>p&&(v=p),p-=v,H.length-=v;do{Y[w++]=T[R++]}while(--v);0===H.length&&(H.mode=21);break;case 26:if(0===p)break e;Y[w++]=H.length,p--,H.mode=21;break;case 27:if(H.wrap){for(;y<32;){if(0===s)break e;s--,o|=r[f++]<<y,y+=8}if(O-=p,e.total_out+=O,H.total+=O,O&&(e.adler=H.check=H.flags?u(H.check,Y,O,w-O):N(H.check,Y,O,w-O)),O=p,(H.flags?o:W(o))!==H.check){e.AE="incorrect data check",H.mode=a;break}o=0,y=0}H.mode=28;case 28:if(H.wrap&&H.flags){for(;y<32;){if(0===s)break e;s--,o+=r[f++]<<y,y+=8}if(o!==(4294967295&H.total)){e.AE="incorrect length check",H.mode=a;break}o=0,y=0}H.mode=29;case 29:J=i;break e;case a:J=j;break e;case 31:return F;default:return U}return e.next_out=w,e.avail_out=p,e.next_in=f,e.avail_in=s,H.hold=o,H.bits=y,(H.wsize||O!==e.avail_out&&H.mode<a&&(H.mode<27||E!==M))&&K(e,e.output,e.next_out,O-e.avail_out)?(H.mode=31,F):(l-=e.avail_in,O-=e.avail_out,e.total_in+=l,e.total_out+=O,H.total+=O,H.wrap&&O&&(e.adler=H.check=H.flags?u(H.check,Y,O,e.next_out-O):N(H.check,Y,O,e.next_out-O)),e.data_type=H.bits+(H.last?64:0)+(H.mode===X?128:0)+(20===H.mode||15===H.mode?256:0),(0===l&&0===O||E===M)&&J===C&&(J=h),J)},e.exports.inflateEnd=e=>{if(!e||!e.state)return U;let E=e.state;return E.window&&(E.window=null),e.state=null,C},e.exports.inflateGetHeader=(e,E)=>{if(!e||!e.state)return U;const H=e.state;return 0===(2&H.wrap)?U:(H.head=E,E.done=!1,C)},e.exports.inflateSetDictionary=(e,E)=>{const H=E.length;let u,z,P;return e&&e.state?(u=e.state,0!==u.wrap&&11!==u.mode?U:11===u.mode&&(z=1,z=N(z,E,H,0),z!==u.check)?j:(P=K(e,E,H,H),P?(u.mode=31,F):(u.havedict=1,C))):U},e.exports.inflateInfo="pako inflate (from Nodeca project)"},12907:e=>{"use strict";const E=15,H=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),N=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),u=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,P,M,D,A,C,i,V)=>{const U=V.bits;let j,F,h,S,X,a,W=0,r=0,Y=0,f=0,w=0,s=0,p=0,o=0,y=0,b=0,K=null,l=0;const O=new Uint16Array(16),v=new Uint16Array(16);let R,T,L,d=null,G=0;for(W=0;W<=E;W++)O[W]=0;for(r=0;r<D;r++)O[P[M+r]]++;for(w=U,f=E;f>=1&&0===O[f];f--);if(w>f&&(w=f),0===f)return A[C++]=20971520,A[C++]=20971520,V.bits=1,0;for(Y=1;Y<f&&0===O[Y];Y++);for(w<Y&&(w=Y),o=1,W=1;W<=E;W++)if(o<<=1,o-=O[W],o<0)return-1;if(o>0&&(0===e||1!==f))return-1;for(v[1]=0,W=1;W<E;W++)v[W+1]=v[W]+O[W];for(r=0;r<D;r++)0!==P[M+r]&&(i[v[P[M+r]]++]=r);if(0===e?(K=d=i,a=19):1===e?(K=H,l-=257,d=N,G-=257,a=256):(K=u,d=z,a=-1),b=0,r=0,W=Y,X=C,s=w,p=0,h=-1,y=1<<w,S=y-1,1===e&&y>852||2===e&&y>592)return 1;for(;;){R=W-p,i[r]<a?(T=0,L=i[r]):i[r]>a?(T=d[G+i[r]],L=K[l+i[r]]):(T=96,L=0),j=1<<W-p,F=1<<s,Y=F;do{F-=j,A[X+(b>>p)+F]=R<<24|T<<16|L}while(0!==F);for(j=1<<W-1;b&j;)j>>=1;if(0!==j?(b&=j-1,b+=j):b=0,r++,0===--O[W]){if(W===f)break;W=P[M+i[r]]}if(W>w&&(b&S)!==h){for(0===p&&(p=w),X+=Y,s=W-p,o=1<<s;s+p<f&&(o-=O[s+p],!(o<=0));)s++,o<<=1;if(y+=1<<s,1===e&&y>852||2===e&&y>592)return 1;h=b&S,A[h]=w<<24|s<<16|X-C}}return 0!==b&&(A[X+b]=W-p<<24|64<<16),V.bits=w,0}},12867:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12854:e=>{"use strict";function E(e){let E=e.length;for(;--E>=0;)e[E]=0}const H=256,N=286,u=30,z=15,P=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),M=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),D=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C=new Array(576);E(C);const i=new Array(60);E(i);const V=new Array(512);E(V);const U=new Array(256);E(U);const j=new Array(29);E(j);const F=new Array(u);function h(e,E,H,N,u){this.static_tree=e,this.extra_bits=E,this.extra_base=H,this.elems=N,this.max_length=u,this.has_stree=e&&e.length}let S,X,a;function W(e,E){this.dyn_tree=e,this.max_code=0,this.stat_desc=E}E(F);const r=e=>e<256?V[e]:V[256+(e>>>7)],Y=(e,E)=>{e.pending_buf[e.pending++]=255&E,e.pending_buf[e.pending++]=E>>>8&255},f=(e,E,H)=>{e.bi_valid>16-H?(e.bi_buf|=E<<e.bi_valid&65535,Y(e,e.bi_buf),e.bi_buf=E>>16-e.bi_valid,e.bi_valid+=H-16):(e.bi_buf|=E<<e.bi_valid&65535,e.bi_valid+=H)},w=(e,E,H)=>{f(e,H[2*E],H[2*E+1])},s=(e,E)=>{let H=0;do{H|=1&e,e>>>=1,H<<=1}while(--E>0);return H>>>1},p=(e,E,H)=>{const N=new Array(16);let u,P,M=0;for(u=1;u<=z;u++)N[u]=M=M+H[u-1]<<1;for(P=0;P<=E;P++){let E=e[2*P+1];0!==E&&(e[2*P]=s(N[E]++,E))}},o=e=>{let E;for(E=0;E<N;E++)e.dyn_ltree[2*E]=0;for(E=0;E<u;E++)e.dyn_dtree[2*E]=0;for(E=0;E<19;E++)e.bl_tree[2*E]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},y=e=>{e.bi_valid>8?Y(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},b=(e,E,H,N)=>{const u=2*E,z=2*H;return e[u]<e[z]||e[u]===e[z]&&N[E]<=N[H]},K=(e,E,H)=>{const N=e.heap[H];let u=H<<1;for(;u<=e.heap_len&&(u<e.heap_len&&b(E,e.heap[u+1],e.heap[u],e.depth)&&u++,!b(E,N,e.heap[u],e.depth));)e.heap[H]=e.heap[u],H=u,u<<=1;e.heap[H]=N},l=(e,E,N)=>{let u,z,D,A,C=0;if(0!==e.last_lit)do{u=e.pending_buf[e.d_buf+2*C]<<8|e.pending_buf[e.d_buf+2*C+1],z=e.pending_buf[e.l_buf+C],C++,0===u?w(e,z,E):(D=U[z],w(e,D+H+1,E),A=P[D],0!==A&&(z-=j[D],f(e,z,A)),u--,D=r(u),w(e,D,N),A=M[D],0!==A&&(u-=F[D],f(e,u,A)))}while(C<e.last_lit);w(e,256,E)},O=(e,E)=>{const H=E.dyn_tree,N=E.stat_desc.static_tree,u=E.stat_desc.has_stree,P=E.stat_desc.elems;let M,D,A,C=-1;for(e.heap_len=0,e.heap_max=573,M=0;M<P;M++)0!==H[2*M]?(e.heap[++e.heap_len]=C=M,e.depth[M]=0):H[2*M+1]=0;for(;e.heap_len<2;)A=e.heap[++e.heap_len]=C<2?++C:0,H[2*A]=1,e.depth[A]=0,e.opt_len--,u&&(e.static_len-=N[2*A+1]);for(E.max_code=C,M=e.heap_len>>1;M>=1;M--)K(e,H,M);A=P;do{M=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,H,1),D=e.heap[1],e.heap[--e.heap_max]=M,e.heap[--e.heap_max]=D,H[2*A]=H[2*M]+H[2*D],e.depth[A]=(e.depth[M]>=e.depth[D]?e.depth[M]:e.depth[D])+1,H[2*M+1]=H[2*D+1]=A,e.heap[1]=A++,K(e,H,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,E)=>{const H=E.dyn_tree,N=E.max_code,u=E.stat_desc.static_tree,P=E.stat_desc.has_stree,M=E.stat_desc.extra_bits,D=E.stat_desc.extra_base,A=E.stat_desc.max_length;let C,i,V,U,j,F,h=0;for(U=0;U<=z;U++)e.bl_count[U]=0;for(H[2*e.heap[e.heap_max]+1]=0,C=e.heap_max+1;C<573;C++)i=e.heap[C],U=H[2*H[2*i+1]+1]+1,U>A&&(U=A,h++),H[2*i+1]=U,i>N||(e.bl_count[U]++,j=0,i>=D&&(j=M[i-D]),F=H[2*i],e.opt_len+=F*(U+j),P&&(e.static_len+=F*(u[2*i+1]+j)));if(0!==h){do{for(U=A-1;0===e.bl_count[U];)U--;e.bl_count[U]--,e.bl_count[U+1]+=2,e.bl_count[A]--,h-=2}while(h>0);for(U=A;0!==U;U--)for(i=e.bl_count[U];0!==i;)V=e.heap[--C],V>N||(H[2*V+1]!==U&&(e.opt_len+=(U-H[2*V+1])*H[2*V],H[2*V+1]=U),i--)}})(e,E),p(H,C,e.bl_count)},v=(e,E,H)=>{let N,u,z=-1,P=E[1],M=0,D=7,A=4;for(0===P&&(D=138,A=3),E[2*(H+1)+1]=65535,N=0;N<=H;N++)u=P,P=E[2*(N+1)+1],++M<D&&u===P||(M<A?e.bl_tree[2*u]+=M:0!==u?(u!==z&&e.bl_tree[2*u]++,e.bl_tree[32]++):M<=10?e.bl_tree[34]++:e.bl_tree[36]++,M=0,z=u,0===P?(D=138,A=3):u===P?(D=6,A=3):(D=7,A=4))},R=(e,E,H)=>{let N,u,z=-1,P=E[1],M=0,D=7,A=4;for(0===P&&(D=138,A=3),N=0;N<=H;N++)if(u=P,P=E[2*(N+1)+1],!(++M<D&&u===P)){if(M<A)do{w(e,u,e.bl_tree)}while(0!==--M);else 0!==u?(u!==z&&(w(e,u,e.bl_tree),M--),w(e,16,e.bl_tree),f(e,M-3,2)):M<=10?(w(e,17,e.bl_tree),f(e,M-3,3)):(w(e,18,e.bl_tree),f(e,M-11,7));M=0,z=u,0===P?(D=138,A=3):u===P?(D=6,A=3):(D=7,A=4)}};let T=!1;const L=(e,E,H,N)=>{f(e,0+(N?1:0),3),((e,E,H,N)=>{y(e),N&&(Y(e,H),Y(e,~H)),e.pending_buf.set(e.window.subarray(E,E+H),e.pending),e.pending+=H})(e,E,H,!0)};e.exports._tr_init=e=>{T||((()=>{let e,E,H,A,W;const r=new Array(16);for(H=0,A=0;A<28;A++)for(j[A]=H,e=0;e<1<<P[A];e++)U[H++]=A;for(U[H-1]=A,W=0,A=0;A<16;A++)for(F[A]=W,e=0;e<1<<M[A];e++)V[W++]=A;for(W>>=7;A<u;A++)for(F[A]=W<<7,e=0;e<1<<M[A]-7;e++)V[256+W++]=A;for(E=0;E<=z;E++)r[E]=0;for(e=0;e<=143;)C[2*e+1]=8,e++,r[8]++;for(;e<=255;)C[2*e+1]=9,e++,r[9]++;for(;e<=279;)C[2*e+1]=7,e++,r[7]++;for(;e<=287;)C[2*e+1]=8,e++,r[8]++;for(p(C,287,r),e=0;e<u;e++)i[2*e+1]=5,i[2*e]=s(e,5);S=new h(C,P,257,N,z),X=new h(i,M,0,u,z),a=new h(new Array(0),D,0,19,7)})(),T=!0),e.l_desc=new W(e.dyn_ltree,S),e.d_desc=new W(e.dyn_dtree,X),e.bl_desc=new W(e.bl_tree,a),e.bi_buf=0,e.bi_valid=0,o(e)},e.exports._tr_stored_block=L,e.exports._tr_flush_block=(e,E,N,u)=>{let z,P,M=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let E,N=4093624447;for(E=0;E<=31;E++,N>>>=1)if(1&N&&0!==e.dyn_ltree[2*E])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(E=32;E<H;E++)if(0!==e.dyn_ltree[2*E])return 1;return 0})(e)),O(e,e.l_desc),O(e,e.d_desc),M=(e=>{let E;for(v(e,e.dyn_ltree,e.l_desc.max_code),v(e,e.dyn_dtree,e.d_desc.max_code),O(e,e.bl_desc),E=18;E>=3&&0===e.bl_tree[2*A[E]+1];E--);return e.opt_len+=3*(E+1)+5+5+4,E})(e),z=e.opt_len+3+7>>>3,P=e.static_len+3+7>>>3,P<=z&&(z=P)):z=P=N+5,N+4<=z&&-1!==E?L(e,E,N,u):4===e.strategy||P===z?(f(e,2+(u?1:0),3),l(e,C,i)):(f(e,4+(u?1:0),3),((e,E,H,N)=>{let u;for(f(e,E-257,5),f(e,H-1,5),f(e,N-4,4),u=0;u<N;u++)f(e,e.bl_tree[2*A[u]+1],3);R(e,e.dyn_ltree,E-1),R(e,e.dyn_dtree,H-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,M+1),l(e,e.dyn_ltree,e.dyn_dtree)),o(e),u&&y(e)},e.exports._tr_tally=(e,E,N)=>(e.pending_buf[e.d_buf+2*e.last_lit]=E>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&E,e.pending_buf[e.l_buf+e.last_lit]=255&N,e.last_lit++,0===E?e.dyn_ltree[2*N]++:(e.matches++,E--,e.dyn_ltree[2*(U[N]+H+1)]++,e.dyn_dtree[2*r(E)]++),e.last_lit===e.lit_bufsize-1),e.exports._tr_align=e=>{f(e,2,3),w(e,256,C),(e=>{16===e.bi_valid?(Y(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},12888:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.AE="",this.state=null,this.data_type=2,this.adler=0}},12524:e=>{function E(e,E,H){for(var N=e.length,u=-1/0,z=1/0,P=0;P<N;P++){var M=(H[0][P]-e[P])/E[P],D=(H[1][P]-e[P])/E[P];if(M>D){var A=M;M=D,D=A}if(D<u||M>z)return 1/0;M>u&&(u=M),D<z&&(z=D)}return u>z?1/0:u}e.exports=function(e,H,N,u){var z=E(H,N,u);if(z===1/0)e=null;else{e=e||[];for(var P=0;P<H.length;P++)e[P]=H[P]+N[P]*z}return e},e.exports.distance=E},13885:(e,E,H)=>{"use strict";H.d(E,{b:()=>P});var N=H(24);const u=N.useLayoutEffect;const z=function(e){var E=(0,N.useRef)(e);return u((function(){E.current=e})),E};var P=function(e){var E=z(e);(0,N.PE)((function(){var e=function(e){var H;if(null!=E.current&&(H=E.current(e)),e.defaultPrevented&&(e.returnValue=""),"string"===typeof H)return e.returnValue=H,H};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}}),[])}},13839:(e,E,H)=>{"use strict";var N=H(13843),u=Array.prototype.concat,z=Array.prototype.slice,P=e.exports=function(e){for(var E=[],H=0,P=e.length;H<P;H++){var M=e[H];N(M)?E=u.call(E,z.call(M)):E.push(M)}return E};P.wrap=function(e){return function(){return e(P(arguments))}}},13843:e=>{e.exports=function(e){return!(!e||"string"===typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},12797:(e,E,H)=>{var N=H(12804);function u(e){for(var E,H,u=0,z=e.length,P=0;P<e.length;){for(E=e[P],H=0;P<z&&e[P]===E;)++P,++H;u+=N.log2(H)/7|0,u+=N.log2(E>>>0)/7|0,u+=2}return u}E.size=u,E.encode=function(e,E){E||(E=new Uint8Array(u(e)));for(var H,N,z=0,P=E.length,M=0;M<e.length;){for(H=e[M],N=0;M<e.length&&e[M]===H;)++M,++N;for(;z<P&&N>=128;)E[z++]=128+(127&N),N>>>=7;if(z>=P)throw new Error("RLE buffer overflow");for(E[z++]=N,H>>>=0;z<P&&H>=128;)E[z++]=128+(127&H),H>>>=7;if(z>=P)throw new Error("RLE buffer overflow");E[z++]=H}return E},E.decode=function(e,E){for(var H,N,u,z,P=E.length,M=e.length,D=0,A=0;A<M;){for(H=0,N=0;A<M&&e[A]>=128;)H+=(127&e[A++])<<N,N+=7;if(H+=e[A++]<<N,A>=M)throw new Error("RLE buffer underrun");if(D+H>P)throw new Error("Chunk buffer overflow");for(u=0,N=0;A<M&&e[A]>=128;)u+=(127&e[A++])<<N,N+=7;if(A>=M)throw new Error("RLE buffer underrun");for(u+=e[A++]<<N,z=0;z<H;++z)E[D++]=u}return E}},12804:(e,E)=>{"use strict";function H(e){var E=32;return(e&=-e)&&E--,65535&e&&(E-=16),16711935&e&&(E-=8),252645135&e&&(E-=4),858993459&e&&(E-=2),1431655765&e&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(e){return(e>0)-(e<0)},E.abs=function(e){var E=e>>31;return(e^E)-E},E.min=function(e,E){return E^(e^E)&-(e<E)},E.max=function(e,E){return e^(e^E)&-(e<E)},E.isPow2=function(e){return!(e&e-1)&&!!e},E.log2=function(e){var E,H;return E=(e>65535)<<4,E|=H=((e>>>=E)>255)<<3,E|=H=((e>>>=H)>15)<<2,(E|=H=((e>>>=H)>3)<<1)|(e>>>=H)>>1},E.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},E.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},E.countTrailingZeros=H,E.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},E.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},E.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var N=new Array(256);!function(e){for(var E=0;E<256;++E){var H=E,N=E,u=7;for(H>>>=1;H;H>>>=1)N<<=1,N|=1&H,--u;e[E]=N<<u&255}}(N),E.reverse=function(e){return N[255&e]<<24|N[e>>>8&255]<<16|N[e>>>16&255]<<8|N[e>>>24&255]},E.interleave2=function(e,E){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(e,E){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>E&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},E.interleave3=function(e,E,H){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},E.deinterleave3=function(e,E){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>E&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},E.nextCombination=function(e){var E=e|e-1;return E+1|(~E&-~E)-1>>>H(e)+1}},12836:e=>{"use strict";e.exports=function(e,E,H,N){var u=self||window;try{try{var z;try{z=new u.Blob([e])}catch(A){(z=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(e),z=z.getBlob()}var P=u.URL||u.webkitURL,M=P.createObjectURL(z),D=new u[E](M,H);return P.revokeObjectURL(M),D}catch(A){return new u[E]("data:application/javascript,".concat(encodeURIComponent(e)),H)}}catch(A){if(!N)throw Error("Inline worker is not supported");return new u[E](N,H)}}},12503:(e,E,H)=>{"use strict";function N(e,E,H,N,u){var z={};return Object.keys(N).forEach((function(e){z[e]=N[e]})),z.enumerable=!!z.enumerable,z.configurable=!!z.configurable,("value"in z||z.initializer)&&(z.writable=!0),z=H.slice().reverse().reduce((function(H,N){return N(e,E,H)||H}),z),u&&void 0!==z.initializer&&(z.value=z.initializer?z.initializer.call(u):void 0,z.initializer=void 0),void 0===z.initializer&&(Object.defineProperty(e,E,z),z=null),z}H.d(E,{b:()=>N})},12499:(e,E,H)=>{"use strict";function N(e,E,H,N){H&&Object.defineProperty(e,E,{enumerable:H.enumerable,configurable:H.configurable,writable:H.writable,value:H.initializer?H.initializer.call(N):void 0})}H.d(E,{e:()=>N})},13877:(e,E,H)=>{"use strict";H.d(E,{b:()=>P,c:()=>i,f:()=>M,g:()=>z,i:()=>D,l:()=>u,n:()=>A,o:()=>C});var N=H(11940);class u{constructor(){this._easingMode=u.EASINGMODE_EASEIN}setEasingMode(e){const E=Math.min(Math.max(e,0),2);this._easingMode=E}getEasingMode(){return this._easingMode}easeInCore(e){throw new Error("You must implement this method")}ease(e){switch(this._easingMode){case u.EASINGMODE_EASEIN:return this.easeInCore(e);case u.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)}}u.EASINGMODE_EASEIN=0,u.EASINGMODE_EASEOUT=1,u.EASINGMODE_EASEINOUT=2;class z extends u{easeInCore(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)}}class P extends u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=e}easeInCore(e){const E=Math.max(0,this.amplitude);return Math.pow(e,3)-e*E*Math.sin(3.141592653589793*e)}}class M extends u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=e,this.bounciness=E}easeInCore(e){const E=Math.max(0,this.bounces);let H=this.bounciness;H<=1&&(H=1.001);const N=Math.pow(H,E),u=1-H,z=(1-N)/u+.5*N,P=e*z,M=Math.log(-P*(1-H)+1)/Math.log(H),D=Math.floor(M),A=D+1,C=(1-Math.pow(H,D))/(u*z),i=.5*(C+(1-Math.pow(H,A))/(u*z)),V=e-i,U=i-C;return-Math.pow(1/H,E-D)/(U*U)*(V-U)*(V+U)}}class D extends u{easeInCore(e){return e*e*e}}class A extends u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=e,this.springiness=E}easeInCore(e){let E;const H=Math.max(0,this.oscillations),N=Math.max(0,this.springiness);return E=0==N?e:(Math.exp(N*e)-1)/(Math.exp(N)-1),E*Math.sin((6.283185307179586*H+1.5707963267948966)*e)}}class C extends u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}}class i extends u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=e,this.y1=E,this.x2=H,this.y2=N}easeInCore(e){return N.b.Interpolate(e,this.x1,this.y1,this.x2,this.y2)}}},13334:(e,E,H)=>{"use strict";H.d(E,{b:()=>P});var N=H(11738),u=H(11753),z=H(12136);class P extends z.e{get _matrix(){return this._compose(),this.FV}set _matrix(e){(e.updateFlag!==this.FV.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.FV.P(e),this._markAsDirtyAndDecompose())}constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(e,E.fe(),!1),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=E,this.FV=(null===u||void 0===u?void 0:u.clone())??N.Matrix.Identity(),this._restMatrix=z??this.FV.clone(),this._bindMatrix=P??this.FV.clone(),this._index=M,this._absoluteMatrix=new N.Matrix,this._absoluteBindMatrix=new N.Matrix,this._absoluteInverseBindMatrix=new N.Matrix,this._finalMatrix=new N.Matrix,E.bones.push(this),this.setParent(H,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(e){this.setParent(e)}setParent(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),E&&this._updateAbsoluteBindMatrices(),this.vA()}}getLocalMatrix(){return this._compose(),this.FV}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(e){this._restMatrix.P(e)}setRestPose(e){this.setRestMatrix(e)}getBindPose(){return this.getBindMatrix()}setBindMatrix(e){this.MM(e)}setBindPose(e){this.setBindMatrix(e)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const e=N.TmpVectors.jE[0],E=N.TmpVectors.Quaternion[0],H=N.TmpVectors.jE[1];this.getRestMatrix().decompose(e,E,H),this._linkedTransformNode.position.P(H),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??N.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.P(E),this._linkedTransformNode.UM.P(e)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.GM}set position(e){this._decompose(),this.GM.P(e),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(e){this.setRotation(e)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(e){this.setRotationQuaternion(e)}get UM(){return this.getScale()}set UM(e){this.setScale(e)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=N.jE.Zero(),this._localRotation=N.Quaternion.Zero(),this.GM=N.jE.Zero()),this.FV.decompose(this._localScaling,this._localRotation,this.GM))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,N.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.GM,this.FV)):this._needToCompose=!1)}MM(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.P(e),E&&this._updateAbsoluteBindMatrices(),H?this._matrix=e:this.vA()}_updateAbsoluteBindMatrices(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.P(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),E)for(let H=0;H<this.children.length;H++)this.children[H]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}vA(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.vA(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.vA(),this._needToDecompose=!0}_updatePosition(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this.getLocalMatrix();if(0==E)u?(z.addAtIndex(12,e.x),z.addAtIndex(13,e.y),z.addAtIndex(14,e.z)):z.setTranslationFromFloats(e.x,e.y,e.z);else{let E=null;H&&(E=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=P._TmpMats[0],D=P._TmpVecs[0];this.parent?H&&E?(M.P(this.parent.getAbsoluteMatrix()),M.multiplyToRef(E,M)):M.P(this.parent.getAbsoluteMatrix()):N.Matrix.IdentityToRef(M),u&&M.setTranslationFromFloats(0,0,0),M.invert(),N.jE.TransformCoordinatesToRef(e,M,D),u?(z.addAtIndex(12,D.x),z.addAtIndex(13,D.y),z.addAtIndex(14,D.z)):z.setTranslationFromFloats(D.x,D.y,D.z)}this._markAsDirtyAndDecompose()}translate(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(e,E,H,!0)}setPosition(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(e,E,H,!1)}setAbsolutePosition(e,E){this.setPosition(e,1,E)}scale(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.getLocalMatrix(),M=P._TmpMats[0];N.Matrix.ScalingToRef(e,E,H,M),M.multiplyToRef(z,z),M.invert();for(const N of this.children){const u=N.getLocalMatrix();u.multiplyToRef(M,u),u.multiplyAtIndex(12,e),u.multiplyAtIndex(13,E),u.multiplyAtIndex(14,H),N._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),u)for(const N of this.children)N.scale(e,E,H,u)}setScale(e){this._decompose(),this._localScaling.P(e),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(e){this._decompose(),e.P(this._localScaling)}setYawPitchRoll(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4?arguments[4]:void 0;if(0===u){const M=P._TmpQuat;return N.Quaternion.RotationYawPitchRollToRef(e,E,H,M),void this.setRotationQuaternion(M,u,z)}const M=P._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(M,z))return;const D=P._TmpMats[1];N.Matrix.RotationYawPitchRollToRef(e,E,H,D),M.multiplyToRef(D,D),this._rotateWithMatrix(D,u,z)}rotate(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;const z=P._TmpMats[0];z.setTranslationFromFloats(0,0,0),N.Matrix.RotationAxisToRef(e,E,z),this._rotateWithMatrix(z,H,u)}setAxisAngle(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;if(0===H){const z=P._TmpQuat;return N.Quaternion.RotationAxisToRef(e,E,z),void this.setRotationQuaternion(z,H,u)}const z=P._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,u))return;const M=P._TmpMats[1];N.Matrix.RotationAxisToRef(e,E,M),z.multiplyToRef(M,M),this._rotateWithMatrix(M,H,u)}setRotation(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(e.y,e.x,e.z,E,H)}setRotationQuaternion(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===E)return this._decompose(),this._localRotation.P(e),void this._markAsDirtyAndCompose();const u=P._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,H))return;const z=P._TmpMats[1];N.Matrix.FromQuaternionToRef(e,z),u.multiplyToRef(z,z),this._rotateWithMatrix(z,E,H)}setRotationMatrix(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===E){const u=P._TmpQuat;return N.Quaternion.FromRotationMatrixToRef(e,u),void this.setRotationQuaternion(u,E,H)}const u=P._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,H))return;const z=P._TmpMats[1];z.P(e),u.multiplyToRef(e,z),this._rotateWithMatrix(z,E,H)}_rotateWithMatrix(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const N=this.getLocalMatrix(),u=N.m[12],z=N.m[13],M=N.m[14],D=this.getParent(),A=P._TmpMats[3],C=P._TmpMats[4];D&&1==E?(H?(A.P(H.getWorldMatrix()),D.getAbsoluteMatrix().multiplyToRef(A,A)):A.P(D.getAbsoluteMatrix()),C.P(A),C.invert(),N.multiplyToRef(A,N),N.multiplyToRef(e,N),N.multiplyToRef(C,N)):1==E&&H?(A.P(H.getWorldMatrix()),C.P(A),C.invert(),N.multiplyToRef(A,N),N.multiplyToRef(e,N),N.multiplyToRef(C,N)):N.multiplyToRef(e,N),N.setTranslationFromFloats(u,z,M),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(e,E){const H=P._TmpMats[2];return e.P(this.getAbsoluteMatrix()),E?(e.multiplyToRef(E.getWorldMatrix(),e),N.Matrix.ScalingToRef(E.UM.x,E.UM.y,E.UM.z,H)):N.Matrix.IdentityToRef(H),e.invert(),!isNaN(e.m[0])&&(H.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(H,e),!0)}tz(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=N.jE.Zero();return this.getPositionToRef(e,E,H),H}getPositionToRef(){let e=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const e=this.getLocalMatrix();E.x=e.m[12],E.y=e.m[13],E.z=e.m[14]}else{let H=null;e&&(H=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let N=P._TmpMats[0];e&&H?(N.P(this.getAbsoluteMatrix()),N.multiplyToRef(H,N)):N=this.getAbsoluteMatrix(),E.x=N.m[12],E.y=N.m[13],E.z=N.m[14]}}getAbsolutePosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=N.jE.Zero();return this.getPositionToRef(1,e,E),E}getAbsolutePositionToRef(e,E){this.getPositionToRef(1,e,E)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.FV.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.P(this.FV);const e=this._skeleton.getPoseMatrix();e&&this._absoluteMatrix.multiplyToRef(e,this._absoluteMatrix)}const e=this.children,E=e.length;for(let H=0;H<E;H++)e[H].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}UD(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=N.jE.Zero();return this.getDirectionToRef(e,E,H),H}getDirectionToRef(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,u=null;E&&(u=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=P._TmpMats[0];z.P(this.getAbsoluteMatrix()),E&&u&&z.multiplyToRef(u,z),N.jE.TransformNormalToRef(e,z,H),H.normalize()}getRotation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=N.jE.Zero();return this.getRotationToRef(e,E,H),H}getRotationToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const N=P._TmpQuat;this.getRotationQuaternionToRef(e,E,N),N.toEulerAnglesToRef(H)}getRotationQuaternion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=N.Quaternion.Identity();return this.getRotationQuaternionToRef(e,E,H),H}getRotationQuaternionToRef(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),E.P(this._localRotation);else{const H=P._TmpMats[0],N=this.getAbsoluteMatrix();e?N.multiplyToRef(e.getWorldMatrix(),H):H.P(N),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.decompose(void 0,E,void 0)}}getRotationMatrix(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1?arguments[1]:void 0;const H=N.Matrix.Identity();return this.getRotationMatrixToRef(e,E,H),H}getRotationMatrixToRef(){let e=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(E);else{const H=P._TmpMats[0],N=this.getAbsoluteMatrix();e?N.multiplyToRef(e.getWorldMatrix(),H):H.P(N),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.getRotationMatrixToRef(E)}}getAbsolutePositionFromLocal(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=N.jE.Zero();return this.getAbsolutePositionFromLocalToRef(e,E,H),H}getAbsolutePositionFromLocalToRef(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,u=null;E&&(u=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=P._TmpMats[0];z.P(this.getAbsoluteMatrix()),E&&u&&z.multiplyToRef(u,z),N.jE.TransformCoordinatesToRef(e,z,H)}getLocalPositionFromAbsolute(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=N.jE.Zero();return this.getLocalPositionFromAbsoluteToRef(e,E,H),H}getLocalPositionFromAbsoluteToRef(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,u=null;E&&(u=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=P._TmpMats[0];z.P(this.getAbsoluteMatrix()),E&&u&&z.multiplyToRef(u,z),z.invert(),N.jE.TransformCoordinatesToRef(e,z,H)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const e=this._skeleton.bones.indexOf(this);if(-1!==e&&this._skeleton.bones.splice(e,1),this._parentNode&&this._parentNode.children){const e=this._parentNode.children,E=e.indexOf(this);-1!==E&&e.splice(E,1)}super.dispose()}}P._TmpVecs=(0,u.d)(2,N.jE.Zero),P._TmpQuat=N.Quaternion.Identity(),P._TmpMats=(0,u.d)(5,N.Matrix.Identity)},13873:(e,E,H)=>{"use strict";H.d(E,{b:()=>O});var N=H(11717),u=H(11723),z=H(11541),P=H(11738),M=H(11756),D=H(12136),A=H(12165),C=H(12e3),i=H(11559),V=H(11746);class U{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(e){this._idleRotationSpeed=e}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(e){this._idleRotationWaitTime=e}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(e){this._attachedCamera=e;const E=this._attachedCamera.fe();this._onPrePointerObservableObserver=E.onPrePointerObservable.add((e=>{e.type!==C.d.POINTERDOWN?e.type===C.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const e=i.d.Now;let E=0;null!=this._lastFrameTime&&(E=e-this._lastFrameTime),this._lastFrameTime=e,this._applyUserInteraction();const H=e-this._lastInteractionTime-this._idleRotationWaitTime,N=Math.max(Math.min(H/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*N,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(E/1e3))}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.fe();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(e){this._lastInteractionTime=e??i.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=i.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var j=H(13877),F=H(12235);class h{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const E=this._attachedCamera;E&&(e?this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((e=>{if(e&&(e.DM(!0),e.getBoundingInfo)){const E=e.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*E,this.upperRadiusTransitionRange=.05*E}})):this._onMeshTargetChangedObserver&&E.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(e){if(!this._attachedCamera)return;this._radiusBounceTransition||(h.EasingFunction.setEasingMode(h.EasingMode),this._radiusBounceTransition=F.b.CreateAnimation("radius",F.b.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const E=F.b.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.fe(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));E&&this._animatables.push(E)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}h.EasingFunction=new j.b(.3),h.EasingMode=j.l.EASINGMODE_EASEOUT;class S{constructor(){this.onTargetFramingAnimationEndObservable=new z.d,this._mode=S.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(e){this._mode=e}get mode(){return this._mode}set radiusScale(e){this._radiusScale=e}get radiusScale(){return this._radiusScale}set positionScale(e){this._positionScale=e}get positionScale(){return this._positionScale}set defaultElevation(e){this._defaultElevation=e}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(e){this._elevationReturnTime=e}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(e){this._framingTime=e}get framingTime(){return this._framingTime}init(){}attach(e){this._attachedCamera=e;const E=this._attachedCamera.fe();S.EasingFunction.setEasingMode(S.EasingMode),this._onPrePointerObservableObserver=E.onPrePointerObservable.add((e=>{e.type!==C.d.POINTERDOWN?e.type===C.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add((e=>{e&&e.getBoundingInfo&&this.zoomOnMesh(e,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.fe();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.DM(!0);const N=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(N.minimumWorld,N.maximumWorld,E,H)}zoomOnMeshHierarchy(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.DM(!0);const N=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(N.min,N.max,E,H)}zoomOnMeshesHierarchy(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new P.jE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new P.jE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let z=0;z<e.length;z++){const E=e[z].getHierarchyBoundingVectors(!0);P.jE.CheckExtends(E.min,N,u),P.jE.CheckExtends(E.max,N,u)}this.zoomOnBoundingInfo(N,u,E,H)}zoomOnBoundingInfo(e,E){let H,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const z=e.y,M=z+(E.y-z)*this._positionScale,D=E.FE(e).scale(.5);if(!isFinite(M))return!1;if(N)H=new P.jE(0,M,0);else{const E=e.add(D);H=new P.jE(E.x,M,E.z)}this._vectorTransition||(this._vectorTransition=F.b.CreateAnimation("target",F.b.ANIMATIONTYPE_VECTOR3,60,S.EasingFunction)),this._betaIsAnimating=!0;let A=F.b.TransitionTo("target",H,this._attachedCamera,this._attachedCamera.fe(),60,this._vectorTransition,this._framingTime);A&&this._animatables.push(A);let C=0;if(this._mode===S.FitFrustumSidesMode){const H=this._calculateLowerRadiusFromModelBoundingSphere(e,E);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=D.length()+this._attachedCamera.PM),C=H}else this._mode===S.IgnoreBoundsSizeMode&&(C=this._calculateLowerRadiusFromModelBoundingSphere(e,E),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.PM));if(this.autoCorrectCameraLimitsAndSensibility){const H=E.FE(e).length();this._attachedCamera.panningSensibility=5e3/H,this._attachedCamera.wheelPrecision=100/C}return this._radiusTransition||(this._radiusTransition=F.b.CreateAnimation("radius",F.b.ANIMATIONTYPE_FLOAT,60,S.EasingFunction)),A=F.b.TransitionTo("radius",C,this._attachedCamera,this._attachedCamera.fe(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),u&&u(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),A&&this._animatables.push(A),!0}_calculateLowerRadiusFromModelBoundingSphere(e,E){const H=this._attachedCamera;if(!H)return 0;let N=H._calculateLowerRadiusFromModelBoundingSphere(e,E,this._radiusScale);return H.lowerRadiusLimit&&this._mode===S.IgnoreBoundsSizeMode&&(N=N<H.lowerRadiusLimit?H.lowerRadiusLimit:N),H.upperRadiusLimit&&(N=N>H.upperRadiusLimit?H.upperRadiusLimit:N),N}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const e=i.d.Now-this._lastInteractionTime,E=.5*Math.PI-this._defaultElevation,H=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>H&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.b.CreateAnimation("beta",F.b.ANIMATIONTYPE_FLOAT,60,S.EasingFunction));const e=F.b.TransitionTo("beta",E,this._attachedCamera,this._attachedCamera.fe(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));e&&this._animatables.push(e)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=i.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}S.EasingFunction=new j.o,S.EasingMode=j.l.EASINGMODE_EASEINOUT,S.IgnoreBoundsSizeMode=0,S.FitFrustumSidesMode=1;var X=H(12168),a=H(12199),W=H(13329),r=H(11532);class Y{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(e){e=r.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),H=E.getInputElement();let N=0,u=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=z=>{var P,M;const D=z.event,A="touch"===D.pointerType;if(z.type!==C.d.POINTERMOVE&&-1===this.buttons.indexOf(D.button))return;const i=D.target;if(this._altKey=D.altKey,this._ctrlKey=D.ctrlKey,this._metaKey=D.metaKey,this._shiftKey=D.shiftKey,this._buttonsPressed=D.buttons,E.isPointerLock){const e=D.movementX,E=D.movementY;this.onTouch(null,e,E),this._pointA=null,this._pointB=null}else{if(z.type!==C.d.POINTERDOWN&&z.type!==C.d.POINTERDOUBLETAP&&A&&(null===(P=this._pointA)||void 0===P?void 0:P.pointerId)!==D.pointerId&&(null===(M=this._pointB)||void 0===M?void 0:M.pointerId)!==D.pointerId)return;if(z.type!==C.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!A)if(z.type===C.d.POINTERDOUBLETAP)this.onDoubleTap(D.pointerType);else if(z.type!==C.d.POINTERUP||this._currentMousePointerIdDown!==D.pointerId&&!A){if(z.type===C.d.POINTERMOVE)if(e||D.preventDefault(),this._pointA&&null===this._pointB){const e=D.clientX-this._pointA.x,E=D.clientY-this._pointA.y;this._pointA.x=D.clientX,this._pointA.y=D.clientY,this.onTouch(this._pointA,e,E)}else if(this._pointA&&this._pointB){const e=this._pointA.pointerId===D.pointerId?this._pointA:this._pointB;e.x=D.clientX,e.y=D.clientY;const E=this._pointA.x-this._pointB.x,H=this._pointA.y-this._pointB.y,P=E*E+H*H,M={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:D.pointerId,type:z.type};this.onMultiTouch(this._pointA,this._pointB,N,P,u,M),u=M,N=P}}else{try{null===i||void 0===i||i.releasePointerCapture(D.pointerId)}catch(V){}A||(this._pointB=null),E._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==D.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==D.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==N||u)&&(this.onMultiTouch(this._pointA,this._pointB,N,0,u,null),N=0,u=null),this._currentMousePointerIdDown=-1,this.onButtonUp(D),e||D.preventDefault()}else{try{null===i||void 0===i||i.setPointerCapture(D.pointerId)}catch(V){}if(null===this._pointA)this._pointA={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType};else{if(null!==this._pointB)return;this._pointB={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}}-1!==this._currentMousePointerIdDown||A||(this._currentMousePointerIdDown=D.pointerId),this.onButtonDown(D),e||(D.preventDefault(),H&&H.focus())}}},this._observer=this.camera.fe()._inputManager._addCameraPointerObserver(this._pointerInput,C.d.POINTERDOWN|C.d.POINTERUP|C.d.POINTERMOVE|C.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,N=0,u=null,this.onLostFocus()},this._contextMenuBind=e=>this.onContextMenu(e),H&&H.addEventListener("contextmenu",this._contextMenuBind,!1);const z=this.camera.fe().getEngine().getHostWindow();z&&r.Tools.RegisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}wi(){if(this._onLostFocus){const e=this.camera.fe().getEngine().getHostWindow();e&&r.Tools.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.fe()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.fe().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(e){}onTouch(e,E,H){}onMultiTouch(e,E,H,N,u,z){}onContextMenu(e){e.preventDefault()}onButtonDown(e){}onButtonUp(e){}onLostFocus(){}}(0,N.e)([(0,u.S)()],Y.prototype,"buttons",void 0);class f extends Y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(e,E){if(0!==this.panningSensibility&&e&&E){const H=E.x-e.x,N=E.y-e.y;this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility}}_computePinchZoom(e,E){const H=this.camera.radius||f.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=H*Math.sqrt(e)/Math.sqrt(E):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(E-e)*H*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(E-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(e,E,H){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-E/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility):(this.camera.inertialAlphaOffset-=E/this.angularSensibilityX,this.camera.inertialBetaOffset-=H/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(e,E,H,N,u,z){0===H&&null===u||0===N&&null===z||(this.multiTouchPanAndZoom?(this._computePinchZoom(H,N),this._computeMultiTouchPanning(u,z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(N)-Math.sqrt(H))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(H,N),this._isPinching=!0):this._computeMultiTouchPanning(u,z)):this.multiTouchPanning?this._computeMultiTouchPanning(u,z):this.pinchZoom&&this._computePinchZoom(H,N))}onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}f.MinimumRadiusForPinch=.001,(0,N.e)([(0,u.S)()],f.prototype,"buttons",void 0),(0,N.e)([(0,u.S)()],f.prototype,"angularSensibilityX",void 0),(0,N.e)([(0,u.S)()],f.prototype,"angularSensibilityY",void 0),(0,N.e)([(0,u.S)()],f.prototype,"pinchPrecision",void 0),(0,N.e)([(0,u.S)()],f.prototype,"pinchDeltaPercentage",void 0),(0,N.e)([(0,u.S)()],f.prototype,"useNaturalPinchZoom",void 0),(0,N.e)([(0,u.S)()],f.prototype,"pinchZoom",void 0),(0,N.e)([(0,u.S)()],f.prototype,"panningSensibility",void 0),(0,N.e)([(0,u.S)()],f.prototype,"multiTouchPanning",void 0),(0,N.e)([(0,u.S)()],f.prototype,"multiTouchPanAndZoom",void 0),W.b.ArcRotateCameraPointersInput=f;var w=H(12002);class s{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(e){e=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.fe(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const H=E.event;if(!H.metaKey)if(E.type===w.d.KEYDOWN){if(this._ctrlPressed=H.ctrlKey,this._altPressed=H.altKey,-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),H.preventDefault&&(e||H.preventDefault())}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){const E=this._keys.indexOf(H.keyCode);E>=0&&this._keys.splice(E,1),H.preventDefault&&(e||H.preventDefault())}})))}wi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let E=0;E<this._keys.length;E++){const H=this._keys[E];-1!==this.keysLeft.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(H)&&e.useInputToRestoreState&&e.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,N.e)([(0,u.S)()],s.prototype,"keysUp",void 0),(0,N.e)([(0,u.S)()],s.prototype,"keysDown",void 0),(0,N.e)([(0,u.S)()],s.prototype,"keysLeft",void 0),(0,N.e)([(0,u.S)()],s.prototype,"keysRight",void 0),(0,N.e)([(0,u.S)()],s.prototype,"keysReset",void 0),(0,N.e)([(0,u.S)()],s.prototype,"panningSensibility",void 0),(0,N.e)([(0,u.S)()],s.prototype,"zoomingSensibility",void 0),(0,N.e)([(0,u.S)()],s.prototype,"useAltToZoom",void 0),(0,N.e)([(0,u.S)()],s.prototype,"angularSpeed",void 0),W.b.ArcRotateCameraKeyboardMoveInput=s;var p=H(11796),o=H(12011);class y{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new P.jE(0,0,0),this._globalOffset=new P.jE(0,0,0),this._inertialPanning=P.jE.Zero()}_computeDeltaFromMouseWheelLegacyEvent(e,E){let H=0;const N=.01*e*this.wheelDeltaPercentage*E;return H=e>0?N/(1+this.wheelDeltaPercentage):N*(1+this.wheelDeltaPercentage),H}attachControl(e){e=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==C.d.POINTERWHEEL)return;const H=E.event;let N=0;const u=H.deltaMode===o.d.DOM_DELTA_LINE?40:1,z=-H.deltaY*u;if(this.customComputeDeltaFromMouseWheel)N=this.customComputeDeltaFromMouseWheel(z,this,H);else if(this.wheelDeltaPercentage){if(N=this._computeDeltaFromMouseWheelLegacyEvent(z,this.camera.radius),N>0){let e=this.camera.radius,E=this.camera.inertialRadiusOffset+N;for(let H=0;H<20&&!(e<=E)&&!(Math.abs(E*this.camera.inertia)<.001);H++)e-=E,E*=this.camera.inertia;e=(0,M.Clamp)(e,0,Number.MAX_VALUE),N=this._computeDeltaFromMouseWheelLegacyEvent(z,e)}}else N=z/(40*this.wheelPrecision);N&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(N)):this.camera.inertialRadiusOffset+=N),H.preventDefault&&(e||H.preventDefault())},this._observer=this.camera.fe()._inputManager._addCameraPointerObserver(this._wheel,C.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.jM(0)}wi(){this._observer&&(this.camera.fe()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const e=this.camera,E=e.target.FE(e.position);this._hitPlane=p.b.FromPositionAndNormal(e.target,E)}_getPosition(){const e=this.camera,E=e.fe(),H=E.createPickingRay(E.pointerX,E.pointerY,P.Matrix.Identity(),e,!1);0===e.targetScreenOffset.x&&0===e.targetScreenOffset.y||(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=P.jE.TransformNormal(this._viewOffset,e._cameraTransformMatrix),H.origin.addInPlace(this._globalOffset));let N=0;return this._hitPlane&&(N=H.intersectsPlane(this._hitPlane)??0),H.origin.addInPlace(H.direction.scaleInPlace(N))}_zoomToMouse(e){const E=this.camera,H=1-E.inertia;if(E.lowerRadiusLimit){const N=E.lowerRadiusLimit??0;E.radius-(E.inertialRadiusOffset+e)/H<N&&(e=(E.radius-N)*H-E.inertialRadiusOffset)}if(E.upperRadiusLimit){const N=E.upperRadiusLimit??0;E.radius-(E.inertialRadiusOffset+e)/H>N&&(e=(E.radius-N)*H-E.inertialRadiusOffset)}const N=e/H/E.radius,u=this._getPosition(),z=P.TmpVectors.jE[6];u.subtractToRef(E.target,z),z.scaleInPlace(N),z.scaleInPlace(H),this._inertialPanning.addInPlace(z),E.inertialRadiusOffset+=e}_zeroIfClose(e){Math.abs(e.x)<V.d&&(e.x=0),Math.abs(e.y)<V.d&&(e.y=0),Math.abs(e.z)<V.d&&(e.z=0)}}(0,N.e)([(0,u.S)()],y.prototype,"wheelPrecision",void 0),(0,N.e)([(0,u.S)()],y.prototype,"zoomToMouseLocation",void 0),(0,N.e)([(0,u.S)()],y.prototype,"wheelDeltaPercentage",void 0),W.b.ArcRotateCameraMouseWheelInput=y;class b extends W.c{constructor(e){super(e)}addMouseWheel(){return this.add(new y),this}addPointers(){return this.add(new f),this}addKeyboard(){return this.add(new s),this}}var K=H(11690);function l(e,E){return isNaN(e)?E:e}D.e.AddNodeConstructor("ArcRotateCamera",((e,E)=>()=>new O(e,0,0,1,P.jE.Zero(),E)));class O extends a.d{get target(){return this._target}set target(e){this.setTarget(e)}get targetHost(){return this._targetHost}set targetHost(e){e&&this.setTarget(e)}getTarget(){return this.target}get position(){return this._position}set position(e){this.setPosition(e)}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new P.Matrix,this._upToYMatrix=new P.Matrix,this._upVector=P.jE.Zero()),e.normalize(),this._upVector.P(e),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){P.Matrix.RotationAlignToRef(P.jE.UpReadOnly,this._upVector,this._yToUpMatrix),P.Matrix.RotationAlignToRef(this._upVector,P.jE.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}set angularSensibilityX(e){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityX=e)}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}set angularSensibilityY(e){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityY=e)}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}set pinchPrecision(e){const E=this.inputs.attached.pointers;E&&(E.pinchPrecision=e)}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}set pinchDeltaPercentage(e){const E=this.inputs.attached.pointers;E&&(E.pinchDeltaPercentage=e)}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom}set useNaturalPinchZoom(e){const E=this.inputs.attached.pointers;E&&(E.useNaturalPinchZoom=e)}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}set panningSensibility(e){const E=this.inputs.attached.pointers;E&&(E.panningSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const E=this.inputs.attached.keyboard;E&&(E.keysUp=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const E=this.inputs.attached.keyboard;E&&(E.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const E=this.inputs.attached.keyboard;E&&(E.keysRight=e)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}set wheelPrecision(e){const E=this.inputs.attached.mousewheel;E&&(E.wheelPrecision=e)}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation}set zoomToMouseLocation(e){const E=this.inputs.attached.mousewheel;E&&(E.zoomToMouseLocation=e)}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}set wheelDeltaPercentage(e){const E=this.inputs.attached.mousewheel;E&&(E.wheelDeltaPercentage=e)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new h,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new S,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new U,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(e,E,H,N,u,M){var D;let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(e,P.jE.Zero(),M,A),D=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=P.jE.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=P.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new P.Matrix,this.panningAxis=new P.jE(1,1,0),this._transformedDirection=new P.jE,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new z.d,this.checkCollisions=!1,this.collisionRadius=new P.jE(.5,.5,.5),this._previousPosition=P.jE.Zero(),this._collisionVelocity=P.jE.Zero(),this._newPosition=P.jE.Zero(),this._computationVector=P.jE.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new P.jE(NaN,NaN,NaN),this._goalTargetScreenOffset=new P.Vector2(NaN,NaN),this._onCollisionPositionChange=function(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H?(D.setPosition(E),D.DU&&D.DU(H)):D._previousPosition.P(D._position);const N=Math.cos(D.alpha),u=Math.sin(D.alpha),z=Math.cos(D.beta);let P=Math.sin(D.beta);0===P&&(P=1e-4);const M=D._getTargetPosition();D._computationVector.VM(D.radius*N*P,D.radius*z,D.radius*u*P),M.addToRef(D._computationVector,D._newPosition),D._position.P(D._newPosition);let A=D.upVector;D.allowUpsideDown&&D.beta<0&&(A=A.clone(),A=A.negate()),D._computeViewMatrix(D._position,M,A),D._viewMatrix.addAtIndex(12,D.targetScreenOffset.x),D._viewMatrix.addAtIndex(13,D.targetScreenOffset.y),D._collisionTriggered=!1},this._target=P.jE.Zero(),u&&this.setTarget(u),this.alpha=E,this.beta=H,this.radius=N,this.getViewMatrix(),this.inputs=new b(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new P.jE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=P.Vector2.Zero()}_updateCache(e){e||super._updateCache(),this._cache._target.P(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.P(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.P(e)}const e=this._getLockedTargetPosition();return e||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=z?this._currentInterpolationFactor=z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=l(e,this._goalAlpha),this._goalBeta=l(E,this._goalBeta),this._goalRadius=l(H,this._goalRadius),this._goalTarget.set(l(N.x,this._goalTarget.x),l(N.y,this._goalTarget.y),l(N.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(l(u.x,this._goalTargetScreenOffset.x),l(u.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,M.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,M.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,M.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,M.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(e,E){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const u=arguments;E=r.Tools.BackCompatCameraNoPreventDefault(u),this._useCtrlForPanning=H,this._panningMouseButton=N,"boolean"===typeof u[0]&&(u.length>1&&(this._useCtrlForPanning=u[1]),u.length>2&&(this._panningMouseButton=u[2])),this.inputs.attachElement(E),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}wi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let e=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){e=!0;const E=this.invertRotation?-1:1,H=this._calculateHandednessMultiplier();let N=this.inertialAlphaOffset*H;this.beta<0&&(N*=-1),this.alpha+=N*E,this.beta+=this.inertialBetaOffset*E,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){e=!0;const E=new P.jE(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),E.multiplyInPlace(this.panningAxis),P.jE.TransformNormalToRef(E,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const e=this.upVector,E=P.jE.CrossToRef(this._transformedDirection,e,this._transformedDirection);P.jE.CrossToRef(e,E,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);P.jE.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.P(this._transformedDirection)}else{if(this.parent){const e=P.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.transposeToRef(e),P.jE.TransformCoordinatesToRef(this._transformedDirection,e,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.d&&(this.inertialPanningY=0)}if(e)this.stopInterpolation();else if(this._isInterpolating){let e=!1;const E=this._scene.getEngine().getDeltaTime()/1e3,H=1-Math.pow(2,-E/this._currentInterpolationFactor),N=l(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const E=P.TmpVectors.jE[0].set(l(this._goalTarget.x,this._target.x),l(this._goalTarget.y,this._target.y),l(this._goalTarget.z,this._target.z));P.jE.LerpToRef(this.target,E,H,this._target),10*P.jE.Distance(this.target,E)/N<V.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.P(E),this.setTarget(this.target,!1,!0,!0)):e=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const E=P.Quaternion.RotationAlphaBetaGammaToRef(l(this._goalAlpha,this.alpha),l(this._goalBeta,this.beta),0,P.TmpVectors.Quaternion[0]),N=P.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,P.TmpVectors.Quaternion[1]),u=P.Quaternion.SlerpToRef(N,E,H,P.TmpVectors.Quaternion[2]);u.normalize();const z=u.toAlphaBetaGammaToRef(P.TmpVectors.jE[0]);if(this.alpha=z.x,this.beta=z.y,u.isApprox(E,V.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const e=E.toAlphaBetaGammaToRef(P.TmpVectors.jE[0]);this.alpha=e.x,this.beta=e.y}else e=!0}if(isNaN(this._goalRadius)||(this.radius+=(N-this.radius)*H,Math.abs(N/this.radius-1)<V.d?(this._goalRadius=NaN,this.radius=N):e=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const E=P.TmpVectors.Vector2[0].set(l(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),l(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));P.Vector2.LerpToRef(this.targetScreenOffset,E,H,this.targetScreenOffset),P.Vector2.Distance(this.targetScreenOffset,E)<V.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.P(E)):e=!0}this._isInterpolating=e}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||P.jE.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const e=this.alpha;var E,H;this.alpha=function(e){let E=Math.PI/2;return 0===e.x&&0===e.z||(E=Math.acos(e.x/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)))),e.z<0&&(E=2*Math.PI-E),E}(this._computationVector),this.beta=(E=this._computationVector.y,H=this.radius,Math.acos(E/H));const N=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*N*Math.PI,this._checkLimits()}setPosition(e){this._position.equals(e)||(this._position.P(e),this.rebuildAnglesAndRadius())}setTarget(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(N=this.overrideCloneAlphaBetaRadius??N,e.DM)E&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.DM(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const E=e,N=this._getTargetPosition();if(N&&!H&&N.equals(E))return;this._targetHost=null,this._target=E,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}N||this.rebuildAnglesAndRadius()}_getViewMatrix(){const e=Math.cos(this.alpha),E=Math.sin(this.alpha),H=Math.cos(this.beta);let N=Math.sin(this.beta);0===N&&(N=1e-4),0===this.radius&&(this.radius=1e-4);const u=this._getTargetPosition();if(this._computationVector.VM(this.radius*e*N,this.radius*H,this.radius*E*N),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||P.jE.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),u.addToRef(this._computationVector,this._newPosition),this.fe().collisionsEnabled&&this.checkCollisions){const e=this.fe().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,e.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.P(this._newPosition);let e=this.upVector;this.allowUpsideDown&&N<0&&(e=e.negate()),this._computeViewMatrix(this._position,u,e),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.P(u),this._viewMatrix}zoomOn(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e||this.fe().meshes;const H=A.c.MinMax(e);let N=this._calculateLowerRadiusFromModelBoundingSphere(H.min,H.max);if(N=Math.max(Math.min(N,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=N*this.zoomOnFactor,this.mode===X.c.ORTHOGRAPHIC_CAMERA){const e=this.fe().getEngine().getAspectRatio(this),E=N*this.zoomOnFactor/2;this.orthoLeft=-E*e,this.orthoRight=E*e,this.orthoBottom=-E,this.orthoTop=E}this.focusOn({min:H.min,max:H.max,distance:N},E)}focusOn(e){let E,H,N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e.min){const N=e||this.fe().meshes;E=A.c.MinMax(N),H=P.jE.Distance(E.min,E.max)}else{E=e,H=e.distance}this._target=A.c.Center(E),N||(this.maxZ=2*H)}createRigCamera(e,E){let H=0;switch(this.cameraRigMode){case X.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.c.RIG_MODE_VR:H=this._cameraRigParams.stereoHalfAngle*(0===E?1:-1);break;case X.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H=this._cameraRigParams.stereoHalfAngle*(0===E?-1:1)}const N=new O(e,this.alpha+H,this.beta,this.radius,this._target,this.fe());return N._cameraRigParams={},N.isRigCamera=!0,N.rigParent=this,N.upVector=this.upVector,N.mode=this.mode,N.orthoLeft=this.orthoLeft,N.orthoRight=this.orthoRight,N.orthoBottom=this.orthoBottom,N.orthoTop=this.orthoTop,N}_updateRigCameras(){const e=this._rigCameras[0],E=this._rigCameras[1];switch(e.beta=E.beta=this.beta,this.cameraRigMode){case X.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.c.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case X.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const N=P.jE.Distance(e,E),u=this.fe().getEngine().getAspectRatio(this),z=Math.tan(this.fov/2),M=z*u,D=.5*N*H,A=D*Math.sqrt(1+1/(M*M)),C=D*Math.sqrt(1+1/(z*z));return Math.max(A,C)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,N.e)([(0,u.S)()],O.prototype,"alpha",void 0),(0,N.e)([(0,u.S)()],O.prototype,"beta",void 0),(0,N.e)([(0,u.S)()],O.prototype,"radius",void 0),(0,N.e)([(0,u.S)()],O.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,N.e)([(0,u.P)("target")],O.prototype,"_target",void 0),(0,N.e)([(0,u.A)("targetHost")],O.prototype,"_targetHost",void 0),(0,N.e)([(0,u.S)()],O.prototype,"inertialAlphaOffset",void 0),(0,N.e)([(0,u.S)()],O.prototype,"inertialBetaOffset",void 0),(0,N.e)([(0,u.S)()],O.prototype,"inertialRadiusOffset",void 0),(0,N.e)([(0,u.S)()],O.prototype,"lowerAlphaLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"upperAlphaLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"lowerBetaLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"upperBetaLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"lowerRadiusLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"upperRadiusLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"lowerTargetYLimit",void 0),(0,N.e)([(0,u.S)()],O.prototype,"inertialPanningX",void 0),(0,N.e)([(0,u.S)()],O.prototype,"inertialPanningY",void 0),(0,N.e)([(0,u.S)()],O.prototype,"pinchToPanMaxDistance",void 0),(0,N.e)([(0,u.S)()],O.prototype,"panningDistanceLimit",void 0),(0,N.e)([(0,u.P)()],O.prototype,"panningOriginTarget",void 0),(0,N.e)([(0,u.S)()],O.prototype,"panningInertia",void 0),(0,N.e)([(0,u.S)()],O.prototype,"zoomToMouseLocation",null),(0,N.e)([(0,u.S)()],O.prototype,"zoomOnFactor",void 0),(0,N.e)([(0,u.L)()],O.prototype,"targetScreenOffset",void 0),(0,N.e)([(0,u.S)()],O.prototype,"allowUpsideDown",void 0),(0,N.e)([(0,u.S)()],O.prototype,"useInputToRestoreState",void 0),(0,N.e)([(0,u.S)()],O.prototype,"restoreStateInterpolationFactor",void 0),(0,K.g)("BABYLON.ArcRotateCamera",O)},13329:(e,E,H)=>{"use strict";H.d(E,{b:()=>P,c:()=>M});var N=H(11548),u=H(11776),z=H(12168),P={};class M{constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){const E=e.getSimpleName();this.attached[E]?N.d.Warn("camera input of type "+E+" already exists on camera"):(this.attached[E]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}remove(e){for(const E in this.attached){const H=this.attached[E];if(H===e)return H.wi(),H.camera=null,delete this.attached[E],void this.rebuildInputCheck()}}removeByType(e){for(const E in this.attached){const H=this.attached[E];H.getClassName()===e&&(H.wi(),H.camera=null,delete this.attached[E],this.rebuildInputCheck())}}_addCheckInputs(e){const E=this.checkInputs;return()=>{E(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}attachElement(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){e=!z.c.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e;for(const E in this.attached)this.attached[E].attachControl(e)}}detachElement(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const E in this.attached)this.attached[E].wi(),e&&(this.attached[E].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const E=this.attached[e];E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){const E={};for(const H in this.attached){const e=this.attached[H],N=u.d.Serialize(e);E[e.getClassName()]=N}e.inputsmgr=E}parse(e){const E=e.inputsmgr;if(E){this.clear();for(const e in E){const H=P[e];if(H){const N=E[e],z=u.d.Parse((()=>new H),N,null);this.add(z)}}}else for(const H in this.attached){const E=P[this.attached[H].getClassName()];if(E){const N=u.d.Parse((()=>new E),e,null);this.remove(this.attached[H]),this.add(N)}}}}},13324:(e,E,H)=>{"use strict";H.d(E,{d:()=>Y});var N=H(11717),u=H(11723),z=H(11738),P=H(12199),M=H(13329),D=H(12002),A=H(11532);class C{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(e){e=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.fe(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const H=E.event;if(!H.metaKey)if(E.type===D.d.KEYDOWN){if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),e||H.preventDefault()}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){const E=this._keys.indexOf(H.keyCode);E>=0&&this._keys.splice(E,1),e||H.preventDefault()}})))}wi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let E=0;E<this._keys.length;E++){const H=this._keys[E],N=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(H)?e._localDirection.VM(-N,0,0):-1!==this.keysUp.indexOf(H)?e._localDirection.VM(0,0,N):-1!==this.keysRight.indexOf(H)?e._localDirection.VM(N,0,0):-1!==this.keysDown.indexOf(H)?e._localDirection.VM(0,0,-N):-1!==this.keysUpward.indexOf(H)?e._localDirection.VM(0,N,0):-1!==this.keysDownward.indexOf(H)?e._localDirection.VM(0,-N,0):-1!==this.keysRotateLeft.indexOf(H)?(e._localDirection.VM(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(H)?(e._localDirection.VM(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(H)?(e._localDirection.VM(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(H)&&(e._localDirection.VM(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.fe().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),z.jE.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}}(0,N.e)([(0,u.S)()],C.prototype,"keysUp",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysUpward",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysDown",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysDownward",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysLeft",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysRight",void 0),(0,N.e)([(0,u.S)()],C.prototype,"rotationSpeed",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysRotateLeft",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysRotateRight",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysRotateUp",void 0),(0,N.e)([(0,u.S)()],C.prototype,"keysRotateDown",void 0),M.b.FreeCameraKeyboardMoveInput=C;var i=H(11541),V=H(12e3);class U{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new i.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(e){e=A.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),H=E.getInputElement();this._pointerInput||(this._pointerInput=N=>{const u=N.event,z="touch"===u.pointerType;if(!this.touchEnabled&&z)return;if(N.type!==V.d.POINTERMOVE&&-1===this.buttons.indexOf(u.button))return;const P=u.target;if(N.type===V.d.POINTERDOWN){if(z&&-1!==this._activePointerId||!z&&-1!==this._currentActiveButton)return;this._activePointerId=u.pointerId;try{null===P||void 0===P||P.setPointerCapture(u.pointerId)}catch(M){}-1===this._currentActiveButton&&(this._currentActiveButton=u.button),this._previousPosition={x:u.clientX,y:u.clientY},e||(u.preventDefault(),H&&H.focus()),E.isPointerLock&&this._onMouseMove&&this._onMouseMove(N.event)}else if(N.type===V.d.POINTERUP){if(z&&this._activePointerId!==u.pointerId||!z&&this._currentActiveButton!==u.button)return;try{null===P||void 0===P||P.releasePointerCapture(u.pointerId)}catch(M){}this._currentActiveButton=-1,this._previousPosition=null,e||u.preventDefault(),this._activePointerId=-1}else if(N.type===V.d.POINTERMOVE&&(this._activePointerId===u.pointerId||!z))if(E.isPointerLock&&this._onMouseMove)this._onMouseMove(N.event);else if(this._previousPosition){const E=this.camera._calculateHandednessMultiplier(),H=(u.clientX-this._previousPosition.x)*E,N=u.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=H/this.angularSensibility,this.camera.cameraRotation.x+=N/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:H,offsetY:N}),this._previousPosition={x:u.clientX,y:u.clientY},e||u.preventDefault()}}),this._onMouseMove=H=>{if(!E.isPointerLock)return;const N=this.camera._calculateHandednessMultiplier(),u=H.movementX*N;this.camera.cameraRotation.y+=u/this.angularSensibility;const z=H.movementY;this.camera.cameraRotation.x+=z/this.angularSensibility,this._previousPosition=null,e||H.preventDefault()},this._observer=this.camera.fe()._inputManager._addCameraPointerObserver(this._pointerInput,V.d.POINTERDOWN|V.d.POINTERUP|V.d.POINTERMOVE),H&&(this._contextMenuBind=e=>this.onContextMenu(e),H.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}wi(){if(this._observer){if(this.camera.fe()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,N.e)([(0,u.S)()],U.prototype,"buttons",void 0),(0,N.e)([(0,u.S)()],U.prototype,"angularSensibility",void 0),M.b.FreeCameraMouseInput=U;var j,F=H(12011);class h{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new i.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(e){e=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==V.d.POINTERWHEEL)return;const H=E.event,N=H.deltaMode===F.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*N*H.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*N*H.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*N*H.deltaZ/this._normalize,H.preventDefault&&(e||H.preventDefault())},this._observer=this.camera.fe()._inputManager._addCameraPointerObserver(this._wheel,V.d.POINTERWHEEL)}wi(){this._observer&&(this.camera.fe()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,N.e)([(0,u.S)()],h.prototype,"wheelPrecisionX",void 0),(0,N.e)([(0,u.S)()],h.prototype,"wheelPrecisionY",void 0),(0,N.e)([(0,u.S)()],h.prototype,"wheelPrecisionZ",void 0),function(e){e[e.MoveRelative=0]="MoveRelative",e[e.RotateRelative=1]="RotateRelative",e[e.MoveScene=2]="MoveScene"}(j||(j={}));class S extends h{constructor(){super(...arguments),this._moveRelative=z.jE.Zero(),this._rotateRelative=z.jE.Zero(),this._moveScene=z.jE.Zero(),this._wheelXAction=j.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=j.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==j.MoveRelative||(this._wheelXAction=j.MoveRelative,this._wheelXActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==j.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==j.MoveRelative||(this._wheelYAction=j.MoveRelative,this._wheelYActionCoordinate=e)}get wheelYMoveRelative(){return this._wheelYAction!==j.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==j.MoveRelative||(this._wheelZAction=j.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==j.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==j.RotateRelative||(this._wheelXAction=j.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==j.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==j.RotateRelative||(this._wheelYAction=j.RotateRelative,this._wheelYActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==j.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==j.RotateRelative||(this._wheelZAction=j.RotateRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==j.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(e){null===e&&this._wheelXAction!==j.MoveScene||(this._wheelXAction=j.MoveScene,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==j.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==j.MoveScene||(this._wheelYAction=j.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==j.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(e){null===e&&this._wheelZAction!==j.MoveScene||(this._wheelZAction=j.MoveScene,this._wheelZActionCoordinate=e)}get wheelZMoveScene(){return this._wheelZAction!==j.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.jM(0),this._rotateRelative.jM(0),this._moveScene.jM(0),this._updateCamera(),this.camera.fe().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=z.Matrix.Zero();this.camera.getViewMatrix().invertToRef(e);const E=z.jE.Zero();z.jE.TransformNormalToRef(this._moveRelative,e,E),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(E),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,E,H){if(0===e)return;if(null===E||null===H)return;let N=null;switch(E){case j.MoveRelative:N=this._moveRelative;break;case j.RotateRelative:N=this._rotateRelative;break;case j.MoveScene:N=this._moveScene}switch(H){case 0:N.set(e,0,0);break;case 1:N.set(0,e,0);break;case 2:N.set(0,0,e)}}}(0,N.e)([(0,u.S)()],S.prototype,"wheelXMoveRelative",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelYMoveRelative",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelZMoveRelative",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelXRotateRelative",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelYRotateRelative",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelZRotateRelative",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelXMoveScene",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelYMoveScene",null),(0,N.e)([(0,u.S)()],S.prototype,"wheelZMoveScene",null),M.b.FreeCameraMouseWheelInput=S;class X{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=A.Tools.IsSafari()}attachControl(e){e=A.Tools.BackCompatCameraNoPreventDefault(arguments);let E=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=H=>{const N=H.event,u="mouse"===N.pointerType||this._isSafari&&"undefined"===typeof N.pointerType;if(this.allowMouse||!u)if(H.type===V.d.POINTERDOWN){if(e||N.preventDefault(),this._pointerPressed.push(N.pointerId),1!==this._pointerPressed.length)return;E={x:N.clientX,y:N.clientY}}else if(H.type===V.d.POINTERUP){e||N.preventDefault();const H=this._pointerPressed.indexOf(N.pointerId);if(-1===H)return;if(this._pointerPressed.splice(H,1),0!=H)return;E=null,this._offsetX=null,this._offsetY=null}else if(H.type===V.d.POINTERMOVE){if(e||N.preventDefault(),!E)return;if(0!=this._pointerPressed.indexOf(N.pointerId))return;this._offsetX=N.clientX-E.x,this._offsetY=-(N.clientY-E.y)}}),this._observer=this.camera.fe()._inputManager._addCameraPointerObserver(this._pointerInput,V.d.POINTERDOWN|V.d.POINTERUP|V.d.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}wi(){if(this._pointerInput){if(this._observer&&(this.camera.fe()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,E=e._calculateHandednessMultiplier();e.cameraRotation.y=E*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const E=e._computeLocalCameraSpeed(),H=new z.jE(0,0,0!==this.touchMoveSensibility?E*this._offsetY/this.touchMoveSensibility:0);z.Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(z.jE.TransformCoordinates(H,e._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,N.e)([(0,u.S)()],X.prototype,"touchAngularSensibility",void 0),(0,N.e)([(0,u.S)()],X.prototype,"touchMoveSensibility",void 0),M.b.FreeCameraTouchInput=X;class a extends M.c{constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new C),this}addMouse(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new U(e),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new S,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new X),this}clear(){super.clear(),this._mouseInput=null}}var W=H(11690),r=H(11618);class Y extends P.d{get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set angularSensibility(e){const E=this.inputs.attached.mouse;E&&(E.angularSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const E=this.inputs.attached.keyboard;E&&(E.keysUp=e)}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUpward(e){const E=this.inputs.attached.keyboard;E&&(E.keysUpward=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const E=this.inputs.attached.keyboard;E&&(E.keysDown=e)}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set keysDownward(e){const E=this.inputs.attached.keyboard;E&&(E.keysDownward=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const E=this.inputs.attached.keyboard;E&&(E.keysRight=e)}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}set keysRotateLeft(e){const E=this.inputs.attached.keyboard;E&&(E.keysRotateLeft=e)}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysRotateRight(e){const E=this.inputs.attached.keyboard;E&&(E.keysRotateRight=e)}get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}set keysRotateUp(e){const E=this.inputs.attached.keyboard;E&&(E.keysRotateUp=e)}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}set keysRotateDown(e){const E=this.inputs.attached.keyboard;E&&(E.keysRotateDown=e)}constructor(e,E,H){var N;super(e,E,H,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),N=this,this.ellipsoid=new z.jE(.5,1,.5),this.ellipsoidOffset=new z.jE(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=z.jE.Zero(),this._diffPosition=z.jE.Zero(),this._newPosition=z.jE.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N._newPosition.P(E),N._newPosition.subtractToRef(N._oldPosition,N._diffPosition),N._diffPosition.length()>r.c.CollisionsEpsilon&&(N.position.addToRef(N._diffPosition,N._deferredPositionUpdate),N._deferOnly?N._deferredUpdated=!0:N.position.P(N._deferredPositionUpdate),N.DU&&H&&N.DU(H))},this.inputs=new a(this),this.inputs.addKeyboard().addMouse()}attachControl(e,E){E=A.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(E)}wi(){this.inputs.detachElement(),this.cameraDirection=new z.jE(0,0,0),this.cameraRotation=new z.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}_collideWithWorld(e){let E;E=this.parent?z.jE.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,E.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const H=this.fe().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let N=e;this.applyGravity&&(N=e.add(this.fe().gravity)),H.getNewPosition(this._oldPosition,N,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=z.jE.Zero(),this._transformedDirection=z.jE.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(e){this._needMoveForGravity=e}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.fe().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fi"}}(0,N.e)([(0,u.P)()],Y.prototype,"ellipsoid",void 0),(0,N.e)([(0,u.P)()],Y.prototype,"ellipsoidOffset",void 0),(0,N.e)([(0,u.S)()],Y.prototype,"checkCollisions",void 0),(0,N.e)([(0,u.S)()],Y.prototype,"applyGravity",void 0),(0,W.g)("BABYLON.FreeCamera",Y)},13933:(e,E,H)=>{"use strict";H.d(E,{d:()=>z});var N=H(11831),u=H(13941);class z{constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=H,this.mi=[],this._maxBlockCapacity=E||64,this._selectionContent=new N.c(1024),this._creationFunc=e}update(e,E,H){u.d._CreateBlocks(e,E,H,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}tA(e){for(let E=0;E<this.PC.length;E++){this.PC[E].addEntry(e)}}IA(e){for(let E=0;E<this.PC.length;E++){this.PC[E].removeEntry(e)}}select(e,E){this._selectionContent.reset();for(let H=0;H<this.PC.length;H++){this.PC[H].select(e,this._selectionContent,E)}return E?this._selectionContent.concat(this.mi):this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}intersects(e,E,H){this._selectionContent.reset();for(let N=0;N<this.PC.length;N++){this.PC[N].intersects(e,E,this._selectionContent,H)}return H?this._selectionContent.concat(this.mi):this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}intersectsRay(e){this._selectionContent.reset();for(let E=0;E<this.PC.length;E++){this.PC[E].intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}}z.CreationFuncForMeshes=(e,E)=>{const H=e.getBoundingInfo();!e.isBlocked&&H.boundingBox.intersectsMinMax(E.BC,E.IC)&&E.entries.push(e)},z.CreationFuncForSubMeshes=(e,E)=>{e.getBoundingInfo().boundingBox.intersectsMinMax(E.BC,E.IC)&&E.entries.push(e)}},13941:(e,E,H)=>{"use strict";H.d(E,{d:()=>z});var N=H(11738),u=H(12063);class z{constructor(e,E,H,N,u,z){this.entries=[],this.tC=new Array,this._capacity=H,this._depth=N,this._maxDepth=u,this._creationFunc=z,this._minPoint=e,this._maxPoint=E,this.tC.push(e.clone()),this.tC.push(E.clone()),this.tC.push(e.clone()),this.tC[2].x=E.x,this.tC.push(e.clone()),this.tC[3].y=E.y,this.tC.push(e.clone()),this.tC[4].z=E.z,this.tC.push(E.clone()),this.tC[5].z=e.z,this.tC.push(E.clone()),this.tC[6].x=e.x,this.tC.push(E.clone()),this.tC[7].y=e.y}get fM(){return this._capacity}get BC(){return this._minPoint}get IC(){return this._maxPoint}addEntry(e){if(this.PC)for(let E=0;E<this.PC.length;E++){this.PC[E].addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.fM&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(e){if(this.PC){for(let E=0;E<this.PC.length;E++){this.PC[E].removeEntry(e)}return}const E=this.entries.indexOf(e);E>-1&&this.entries.splice(E,1)}addEntries(e){for(let E=0;E<e.length;E++){const H=e[E];this.addEntry(H)}}select(e,E,H){if(u.b.IsInFrustum(this.tC,e)){if(this.PC){for(let N=0;N<this.PC.length;N++){this.PC[N].select(e,E,H)}return}H?E.concat(this.entries):E.concatWithNoDuplicate(this.entries)}}intersects(e,E,H,N){if(u.b.IntersectsSphere(this._minPoint,this._maxPoint,e,E)){if(this.PC){for(let u=0;u<this.PC.length;u++){this.PC[u].intersects(e,E,H,N)}return}N?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersectsRay(e,E){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.PC){for(let H=0;H<this.PC.length;H++){this.PC[H].intersectsRay(e,E)}return}E.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(e,E,H,u,P,M,D,A){D.PC=new Array;const C=new N.jE((E.x-e.x)/2,(E.y-e.y)/2,(E.z-e.z)/2);for(let N=0;N<2;N++)for(let E=0;E<2;E++)for(let i=0;i<2;i++){const V=e.add(C.multiplyByFloats(N,E,i)),U=e.add(C.multiplyByFloats(N+1,E+1,i+1)),j=new z(V,U,u,P+1,M,A);j.addEntries(H),D.PC.push(j)}}}},13944:(e,E,H)=>{"use strict";H.d(E,{e:()=>C});var N=H(11967),u=H(11738),z=H(12140),P=H(13112),M=H(11991),D=H(13933),A=H(11579);N.c.prototype.createOrUpdateSelectionOctree=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,H=this._getComponent(M.c.NAME_OCTREE);H||(H=new C(this),this.o(H)),this.dC||(this.dC=new D.d(D.d.CreationFuncForMeshes,e,E));const N=this.getWorldExtends();return this.dC.update(N.min,N.max,this.meshes),this.dC},Object.defineProperty(N.c.prototype,"selectionOctree",{get:function(){return this.dC},enumerable:!0,configurable:!0}),z.d.prototype.createOrUpdateSubmeshesOctree=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const H=this.fe();let N=H._getComponent(M.c.NAME_OCTREE);N||(N=new C(H),H.o(N)),this._submeshesOctree||(this._submeshesOctree=new D.d(D.d.CreationFuncForSubMeshes,e,E)),this.DM(!0);const u=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(u.minimumWorld,u.maximumWorld,this.NM),this._submeshesOctree};class C{constructor(e){this.name=M.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new P.e(u.jE.Zero(),new u.jE(1,1,1)),(e=e||A.d.LastCreatedScene)&&(this.hE=e,this.hE.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.hE.getActiveSubMeshCandidates=e=>this.getActiveSubMeshCandidates(e),this.hE.getCollidingSubMeshCandidates=(e,E)=>this.getCollidingSubMeshCandidates(e,E),this.hE.getIntersectingSubMeshCandidates=(e,E)=>this.getIntersectingSubMeshCandidates(e,E))}register(){this.hE.onMeshRemovedObservable.add((e=>{const E=this.hE.selectionOctree;if(void 0!==E&&null!==E){const H=E.mi.indexOf(e);-1!==H&&E.mi.splice(H,1)}})),this.hE.onMeshImportedObservable.add((e=>{const E=this.hE.selectionOctree;void 0!==E&&null!==E&&E.tA(e)}))}getActiveMeshCandidates(){var e;return(null===(e=this.hE.dC)||void 0===e?void 0:e.select(this.hE.frustumPlanes))||this.hE._getDefaultMeshCandidates()}getActiveSubMeshCandidates(e){if(e._submeshesOctree&&e.useOctreeForRenderingSelection){return e._submeshesOctree.select(this.hE.frustumPlanes)}return this.hE._getDefaultSubMeshCandidates(e)}getIntersectingSubMeshCandidates(e,E){if(e._submeshesOctree&&e.useOctreeForPicking){P.e.TransformToRef(E,e.getWorldMatrix(),this._tempRay);return e._submeshesOctree.intersectsRay(this._tempRay)}return this.hE._getDefaultSubMeshCandidates(e)}getCollidingSubMeshCandidates(e,E){if(e._submeshesOctree&&e.useOctreeForCollisions){const H=E._velocityWorldLength+Math.max(E._radius.x,E._radius.y,E._radius.z);return e._submeshesOctree.intersects(E._basePointWorld,H)}return this.hE._getDefaultSubMeshCandidates(e)}rebuild(){}dispose(){}}},13112:(e,E,H)=>{"use strict";H.d(E,{e:()=>U});var N=H(11967),u=H(12168),z=H(11746),P=H(11738),M=H(11753),D=H(12053),A=H(11989),C=H(11579),i=H(12018);const V={internalPickerForMesh:void 0};class U{constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.d;this.origin=e,this.direction=E,this.length=H,this.epsilon=N}clone(){return new U(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const N=U._TmpVector3[0].VM(e.x-H,e.y-H,e.z-H),u=U._TmpVector3[1].VM(E.x+H,E.y+H,E.z+H);let z,P,M,D,A=0,C=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<N.x||this.origin.x>u.x)return!1}else if(z=1/this.direction.x,P=(N.x-this.origin.x)*z,M=(u.x-this.origin.x)*z,M===-1/0&&(M=1/0),P>M&&(D=P,P=M,M=D),A=Math.max(P,A),C=Math.min(M,C),A>C)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<N.y||this.origin.y>u.y)return!1}else if(z=1/this.direction.y,P=(N.y-this.origin.y)*z,M=(u.y-this.origin.y)*z,M===-1/0&&(M=1/0),P>M&&(D=P,P=M,M=D),A=Math.max(P,A),C=Math.min(M,C),A>C)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<N.z||this.origin.z>u.z)return!1}else if(z=1/this.direction.z,P=(N.z-this.origin.z)*z,M=(u.z-this.origin.z)*z,M===-1/0&&(M=1/0),P>M&&(D=P,P=M,M=D),A=Math.max(P,A),C=Math.min(M,C),A>C)return!1;return!0}intersectsBox(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(e.minimum,e.maximum,E)}intersectsSphere(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=e.center.x-this.origin.x,N=e.center.y-this.origin.y,u=e.center.z-this.origin.z,z=H*H+N*N+u*u,P=e.radius+E,M=P*P;if(z<=M)return!0;const D=H*this.direction.x+N*this.direction.y+u*this.direction.z;if(D<0)return!1;return z-D*D<=M}intersectsTriangle(e,E,H){const N=U._TmpVector3[0],u=U._TmpVector3[1],z=U._TmpVector3[2],M=U._TmpVector3[3],A=U._TmpVector3[4];E.subtractToRef(e,N),H.subtractToRef(e,u),P.jE.CrossToRef(this.direction,u,z);const C=P.jE.Dot(N,z);if(0===C)return null;const i=1/C;this.origin.subtractToRef(e,M);const V=P.jE.Dot(M,z)*i;if(V<-this.epsilon||V>1+this.epsilon)return null;P.jE.CrossToRef(M,N,A);const j=P.jE.Dot(this.direction,A)*i;if(j<-this.epsilon||V+j>1+this.epsilon)return null;const F=P.jE.Dot(u,A)*i;return F>this.length?null:new D.b(1-V-j,V,F)}intersectsPlane(e){let E;const H=P.jE.Dot(e.normal,this.direction);if(Math.abs(H)<9.99999997475243e-7)return null;{const N=P.jE.Dot(e.normal,this.origin);return E=(-e.d-N)/H,E<0?E<-9.99999997475243e-7?null:0:E}}intersectsAxis(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(e){case"y":{const e=(this.origin.y-E)/this.direction.y;return e>0?null:new P.jE(this.origin.x+this.direction.x*-e,E,this.origin.z+this.direction.z*-e)}case"x":{const e=(this.origin.x-E)/this.direction.x;return e>0?null:new P.jE(E,this.origin.y+this.direction.y*-e,this.origin.z+this.direction.z*-e)}case"z":{const e=(this.origin.z-E)/this.direction.z;return e>0?null:new P.jE(this.origin.x+this.direction.x*-e,this.origin.y+this.direction.y*-e,E)}default:return null}}intersectsMesh(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const M=P.TmpVectors.Matrix[0];return e.getWorldMatrix().invertToRef(M),this._tmpRay?U.TransformToRef(this,M,this._tmpRay):this._tmpRay=U.Transform(this,M),e.intersects(this._tmpRay,E,H,N,u,z)}intersectsMeshes(e,E,H){H?H.length=0:H=[];for(let N=0;N<e.length;N++){const u=this.intersectsMesh(e[N],E);u.hit&&H.push(u)}return H.sort(this._comparePickingInfo),H}_comparePickingInfo(e,E){return e.distance<E.distance?-1:e.distance>E.distance?1:0}intersectionSegment(e,E,H){const N=this.origin,u=P.TmpVectors.jE[0],z=P.TmpVectors.jE[1],M=P.TmpVectors.jE[2],D=P.TmpVectors.jE[3];E.subtractToRef(e,u),this.direction.scaleToRef(U._Rayl,M),N.addToRef(M,z),e.subtractToRef(N,D);const A=P.jE.Dot(u,u),C=P.jE.Dot(u,M),i=P.jE.Dot(M,M),V=P.jE.Dot(u,D),j=P.jE.Dot(M,D),F=A*i-C*C;let h,S,X=F,a=F;F<U._Smallnum?(h=0,X=1,S=j,a=i):(h=C*j-i*V,S=A*j-C*V,h<0?(h=0,S=j,a=i):h>X&&(h=X,S=j+C,a=i)),S<0?(S=0,-V<0?h=0:-V>A?h=X:(h=-V,X=A)):S>a&&(S=a,-V+C<0?h=0:-V+C>A?h=X:(h=-V+C,X=A));const W=Math.abs(h)<U._Smallnum?0:h/X,r=Math.abs(S)<U._Smallnum?0:S/a,Y=P.TmpVectors.jE[4];M.scaleToRef(r,Y);const f=P.TmpVectors.jE[5];u.scaleToRef(W,f),f.addInPlace(D);const w=P.TmpVectors.jE[6];f.subtractToRef(Y,w);return r>0&&r<=this.length&&w.lengthSquared()<H*H?f.length():-1}update(e,E,H,N,u,z,M){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){U._RayDistant||(U._RayDistant=U.Zero()),U._RayDistant.unprojectRayToRef(e,E,H,N,P.Matrix.IdentityReadOnly,z,M);const D=P.TmpVectors.Matrix[0];u.invertToRef(D),U.TransformToRef(U._RayDistant,D,this)}else this.unprojectRayToRef(e,E,H,N,u,z,M);return this}static Zero(){return new U(P.jE.Zero(),P.jE.Zero())}static CreateNew(e,E,H,N,u,z,P){return U.Zero().update(e,E,H,N,u,z,P)}static CreateNewFromTo(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.Matrix.IdentityReadOnly;const N=new U(new P.jE(0,0,0),new P.jE(0,0,0));return U.CreateFromToToRef(e,E,N,H)}static CreateFromToToRef(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.Matrix.IdentityReadOnly;H.origin.P(e);const u=E.subtractToRef(e,H.direction),z=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z);return H.length=z,H.direction.normalize(),U.TransformToRef(H,N,H)}static Transform(e,E){const H=new U(new P.jE(0,0,0),new P.jE(0,0,0));return U.TransformToRef(e,E,H),H}static TransformToRef(e,E,H){P.jE.TransformCoordinatesToRef(e.origin,E,H.origin),P.jE.TransformNormalToRef(e.direction,E,H.direction),H.length=e.length,H.epsilon=e.epsilon;const N=H.direction,u=N.length();if(0!==u&&1!==u){const e=1/u;N.x*=e,N.y*=e,N.z*=e,H.length*=u}return H}unprojectRayToRef(e,E,H,N,u,z,M){const D=P.TmpVectors.Matrix[0];u.multiplyToRef(z,D),D.multiplyToRef(M,D),D.invert();const A=C.d.LastCreatedEngine,i=P.TmpVectors.jE[0];i.x=e/H*2-1,i.y=-(E/N*2-1),i.z=null!==A&&void 0!==A&&A.IP?1:null!==A&&void 0!==A&&A.isNDCHalfZRange?0:-1;const V=P.TmpVectors.jE[1].VM(i.x,i.y,1-1e-8),U=P.TmpVectors.jE[2],j=P.TmpVectors.jE[3];P.jE._UnprojectFromInvertedMatrixToRef(i,D,U),P.jE._UnprojectFromInvertedMatrixToRef(V,D,j),this.origin.P(U),j.subtractToRef(U,this.direction),this.direction.normalize()}}function j(e,E,H,N,u){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const P=U.Zero();return F(e,E,H,N,P,u,z),P}function F(e,E,H,N,u,z){let M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const A=e.getEngine();if(!z&&!(z=e.activeCamera))return e;const C=z.viewport,i=A.getRenderHeight(),{x:V,y:U,width:j,height:F}=C.toGlobal(A.getRenderWidth(),i),h=1/A.getHardwareScalingLevel();return E=E*h-V,H=H*h-(i-U-F),u.update(E,H,j,F,N||P.Matrix.IdentityReadOnly,M?P.Matrix.IdentityReadOnly:z.getViewMatrix(),z.getProjectionMatrix(),D),e}function h(e,E,H,N,u){if(!A.b)return e;const z=e.getEngine();if(!u&&!(u=e.activeCamera))throw new Error("Active camera not set");const M=u.viewport,D=z.getRenderHeight(),{x:C,y:i,width:V,height:U}=M.toGlobal(z.getRenderWidth(),D),j=P.Matrix.Identity(),F=1/z.getHardwareScalingLevel();return E=E*F-C,H=H*F-(D-i-U),N.update(E,H,V,U,j,j,u.getProjectionMatrix()),e}function S(e,E,H,N,u,z,P,M){const D=E(N,H.enableDistantPicking),A=H.intersects(D,u,P,z,N,M);return A&&A.hit?!u&&null!=e&&A.distance>=e.distance?null:A:null}function X(e,E,H,N,u,z){let M=null;const D=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),C=e.cameraToUseForPointers||e.activeCamera,i=V.internalPickerForMesh||S;for(let A=0;A<e.meshes.length;A++){const V=e.meshes[A];if(H){if(!H(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.KD)continue;const U=D&&V.isWorldMatrixCameraDependent(),j=V.DM(U,C);if(V.hasThinInstances&&V.CA){const e=i(M,E,V,j,!0,!0,z);if(e){if(u)return e;const D=P.TmpVectors.Matrix[1],A=V.thinInstanceGetWorldMatrices();for(let e=0;e<A.length;e++){if(H&&!H(V,e))continue;A[e].multiplyToRef(j,D);const P=i(M,E,V,D,N,u,z,!0);if(P&&(M=P,M.thinInstanceIndex=e,N))return M}}}else{const e=i(M,E,V,j,N,u,z);if(e&&(M=e,N))return M}}return M||new A.b}function a(e,E,H,N){if(!A.b)return null;const u=[],z=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),M=e.cameraToUseForPointers||e.activeCamera,D=V.internalPickerForMesh||S;for(let A=0;A<e.meshes.length;A++){const C=e.meshes[A];if(H){if(!H(C,-1))continue}else if(!C.isEnabled()||!C.isVisible||!C.KD)continue;const i=z&&C.isWorldMatrixCameraDependent(),V=C.DM(i,M);if(C.hasThinInstances&&C.CA){if(D(null,E,C,V,!0,!0,N)){const e=P.TmpVectors.Matrix[1],z=C.thinInstanceGetWorldMatrices();for(let P=0;P<z.length;P++){if(H&&!H(C,P))continue;z[P].multiplyToRef(V,e);const M=D(null,E,C,e,!1,!1,N,!0);M&&(M.thinInstanceIndex=P,u.push(M))}}}else{const e=D(null,E,C,V,!1,!1,N);e&&u.push(e)}}return u}function W(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,N=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;N||(N=e.getWorldMatrix()),E.length=H,u?E.origin.P(u):E.origin.P(e.position);const z=P.TmpVectors.jE[2];z.set(0,0,e._scene.useRightHandedSystem?-1:1);const M=P.TmpVectors.jE[3];return P.jE.TransformNormalToRef(z,N,M),P.jE.NormalizeToRef(M,E.direction),E}var r,Y;U._TmpVector3=(0,M.d)(6,P.jE.Zero),U._RayDistant=U.Zero(),U._Smallnum=1e-8,U._Rayl=1e9,r=N.c,(Y=u.c)&&(Y.prototype.getForwardRay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,E=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;return W(this,new U(P.jE.Zero(),P.jE.Zero(),e),e,E,H)},Y.prototype.getForwardRayToRef=function(e){return W(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),r&&(i.c._IsPickingAvailable=!0,r.prototype.createPickingRay=function(e,E,H,N){return j(this,e,E,H,N,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),N.c.prototype.createPickingRayToRef=function(e,E,H,N,u){return F(this,e,E,H,N,u,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},N.c.prototype.createPickingRayInCameraSpace=function(e,E,H){return function(e,E,H,N){const u=U.Zero();return h(e,E,H,u,N),u}(this,e,E,H)},N.c.prototype.createPickingRayInCameraSpaceToRef=function(e,E,H,N){return h(this,e,E,H,N)},N.c.prototype.pickWithBoundingInfo=function(e,E,H,N,u){return function(e,E,H,N,u,z){if(!A.b)return null;const M=X(e,(N=>(e._tempPickingRay||(e._tempPickingRay=U.Zero()),F(e,E,H,N,e._tempPickingRay,z||null),e._tempPickingRay)),N,u,!0);return M&&(M.ray=j(e,E,H,P.Matrix.Identity(),z||null)),M}(this,e,E,H,N,u)},N.c.prototype.iH=function(e,E,H,N,u,z){return function(e,E,H,N,u,z,M){const D=X(e,((N,u)=>(e._tempPickingRay||(e._tempPickingRay=U.Zero()),F(e,E,H,N,e._tempPickingRay,z||null,!1,u),e._tempPickingRay)),N,u,!1,M);return D&&(D.ray=j(e,E,H,P.Matrix.Identity(),z||null)),D}(this,e,E,H,N,u,z)},N.c.prototype.pickWithRay=function(e,E,H,N){return function(e,E,H,N,u){const z=X(e,(H=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=P.Matrix.Identity()),H.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=U.Zero()),U.TransformToRef(E,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform)),H,N,!1,u);return z&&(z.ray=E),z}(this,e,E,H,N)},N.c.prototype.multiPick=function(e,E,H,N,u){return function(e,E,H,N,u,z){return a(e,(N=>j(e,E,H,N,u||null)),N,z)}(this,e,E,H,N,u)},N.c.prototype.multiPickWithRay=function(e,E,H){return function(e,E,H,N){return a(e,(H=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=P.Matrix.Identity()),H.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=U.Zero()),U.TransformToRef(E,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform)),H,N)}(this,e,E,H)}},13375:(e,E,H)=>{"use strict";var N=H(11660),u=H(11548),z=H(11587),P=H(11693),M=H(11618),D=H(11674);M.c.prototype._partialLoadFile=function(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(e,(e=>{H[E]=e,H._internalCount++,6===H._internalCount&&N(H)}),void 0,void 0,!0,((e,E)=>{u&&e&&u(e.status+" "+e.statusText,E)}))},M.c.prototype._cascadeLoadFiles=function(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const u=[];u._internalCount=0;for(let z=0;z<6;z++)this._partialLoadFile(H[z],z,u,E,N)},M.c.prototype._cascadeLoadImgs=function(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5?arguments[5]:void 0;const P=[];P._internalCount=0;for(let M=0;M<6;M++)this._partialLoadImg(N[M],M,P,e,E,H,u,z)},M.c.prototype._partialLoadImg=function(e,E,H,N,u,M){let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7?arguments[7]:void 0;const C=(0,P.e)();(0,z.w)(e,(e=>{H[E]=e,H._internalCount++,N&&N.removePendingData(C),6===H._internalCount&&M&&M(u,H)}),((e,E)=>{N&&N.removePendingData(C),D&&D(e,E)}),N?N.offlineProvider:null,A),N&&N.addPendingData(C)},M.c.prototype.createCubeTextureBase=function(e,E,H,z){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,j=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,S=arguments.length>14&&void 0!==arguments[14]&&arguments[14],X=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const a=j||new N.e(this,7);a.isCube=!0,a.url=e,a.generateMipMaps=!z,a._lodGenerationScale=V,a._lodGenerationOffset=U,a._useSRGBBuffer=!!S&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!z),a!==j&&(a.label=e.substring(0,60)),this._doNotHandleContextLost||(a._extension=C,a._files=H,a._buffer=X);const W=e;this._transformTextureUrl&&!j&&(e=this._transformTextureUrl(e));const r=C??function(e){const E=e.split("?")[0],H=E.lastIndexOf(".");return H>-1?E.substring(H).toLowerCase():""}(e),Y=(0,D.c)(r),f=(e,E)=>{a.dispose(),M?M(e,E):e&&u.d.Warn(e)},w=(N,M)=>{e===W?N&&f(N.status+" "+N.statusText,M):(u.d.Warn(`Failed to load ${e}, falling back to the ${W}`),this.createCubeTextureBase(W,E,H,!!z,P,f,A,C,i,V,U,a,F,h,S,X))};if(Y)Y.then((N=>{const u=e=>{F&&F(a,e),N.loadCubeData(e,a,i,P,((e,E)=>{f(e,E)}))};X?u(X):H&&6===H.length?N.supportCascades?this._cascadeLoadFiles(E,(e=>u(e.map((e=>new Uint8Array(e))))),H,f):f("Textures type does not support cascades."):this._loadFile(e,(e=>u(new Uint8Array(e))),void 0,void 0,!0,w)}));else{if(!H||0===H.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(E,a,((e,E)=>{h&&h(e,E)}),H,f)}return this._internalTexturesCache.push(a),a}},13946:(e,E,H)=>{"use strict";H(11548);var N=H(11862);H(11660),H(11822),H(11651),H(11913),H(11873);N.b},13407:(e,E,H)=>{"use strict";H.d(E,{b:()=>u});var N=H(11690);class u{constructor(e){this.value=this._toInt(e)}_toInt(e){return 0|e}add(e){return new u(this.value+e.value)}FE(e){return new u(this.value-e.value)}multiply(e){return new u(Math.imul(this.value,e.value))}divide(e){return new u(this.value/e.value)}getClassName(){return u.ClassName}equals(e){return this.value===e.value}static FromValue(e){return new u(e)}toString(){return this.value.toString()}}u.ClassName="FlowGraphInteger",(0,N.g)("FlowGraphInteger",u)},13421:(e,E,H)=>{"use strict";H.d(E,{b:()=>u,d:()=>z});var N=H(11738);class u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.gP=e}get m(){return this.gP}transformVector(e){return this.transformVectorToRef(e,new N.Vector2)}transformVectorToRef(e,E){return E.x=e.x*this.gP[0]+e.y*this.gP[1],E.y=e.x*this.gP[2]+e.y*this.gP[3],E}uM(){return this.toArray()}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<4;E++)e[E]=this.gP[E];return e}VH(e){for(let E=0;E<4;E++)this.gP[E]=e[E];return this}multiplyToRef(e,E){const H=e.gP,N=this.gP,u=E.gP;return u[0]=H[0]*N[0]+H[1]*N[2],u[1]=H[0]*N[1]+H[1]*N[3],u[2]=H[2]*N[0]+H[3]*N[2],u[3]=H[2]*N[1]+H[3]*N[3],E}multiply(e){return this.multiplyToRef(e,new u)}divideToRef(e,E){const H=this.gP,N=e.gP,u=E.gP;return u[0]=H[0]/N[0],u[1]=H[1]/N[1],u[2]=H[2]/N[2],u[3]=H[3]/N[3],E}divide(e){return this.divideToRef(e,new u)}addToRef(e,E){const H=this.gP,N=e.m,u=E.m;return u[0]=H[0]+N[0],u[1]=H[1]+N[1],u[2]=H[2]+N[2],u[3]=H[3]+N[3],E}add(e){return this.addToRef(e,new u)}subtractToRef(e,E){const H=this.gP,N=e.m,u=E.m;return u[0]=H[0]-N[0],u[1]=H[1]-N[1],u[2]=H[2]-N[2],u[3]=H[3]-N[3],E}FE(e){return this.subtractToRef(e,new u)}transpose(){const e=this.gP;return new u([e[0],e[2],e[1],e[3]])}determinant(){const e=this.gP;return e[0]*e[3]-e[1]*e[2]}inverse(){const e=this.determinant();if(0===e)throw new Error("Matrix is not invertible");const E=this.gP,H=1/e;return new u([E[3]*H,-E[1]*H,-E[2]*H,E[0]*H])}equals(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.gP,N=e.m;return 0===E?H[0]===N[0]&&H[1]===N[1]&&H[2]===N[2]&&H[3]===N[3]:Math.abs(H[0]-N[0])<E&&Math.abs(H[1]-N[1])<E&&Math.abs(H[2]-N[2])<E&&Math.abs(H[3]-N[3])<E}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.gP.join(", ")})`}}class z{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.gP=e}get m(){return this.gP}transformVector(e){return this.transformVectorToRef(e,new N.jE)}transformVectorToRef(e,E){const H=this.gP;return E.x=e.x*H[0]+e.y*H[1]+e.z*H[2],E.y=e.x*H[3]+e.y*H[4]+e.z*H[5],E.z=e.x*H[6]+e.y*H[7]+e.z*H[8],E}multiplyToRef(e,E){const H=e.gP,N=this.gP,u=E.m;return u[0]=H[0]*N[0]+H[1]*N[3]+H[2]*N[6],u[1]=H[0]*N[1]+H[1]*N[4]+H[2]*N[7],u[2]=H[0]*N[2]+H[1]*N[5]+H[2]*N[8],u[3]=H[3]*N[0]+H[4]*N[3]+H[5]*N[6],u[4]=H[3]*N[1]+H[4]*N[4]+H[5]*N[7],u[5]=H[3]*N[2]+H[4]*N[5]+H[5]*N[8],u[6]=H[6]*N[0]+H[7]*N[3]+H[8]*N[6],u[7]=H[6]*N[1]+H[7]*N[4]+H[8]*N[7],u[8]=H[6]*N[2]+H[7]*N[5]+H[8]*N[8],E}multiply(e){return this.multiplyToRef(e,new z)}divideToRef(e,E){const H=this.gP,N=e.m,u=E.m;return u[0]=H[0]/N[0],u[1]=H[1]/N[1],u[2]=H[2]/N[2],u[3]=H[3]/N[3],u[4]=H[4]/N[4],u[5]=H[5]/N[5],u[6]=H[6]/N[6],u[7]=H[7]/N[7],u[8]=H[8]/N[8],E}divide(e){return this.divideToRef(e,new z)}addToRef(e,E){const H=this.gP,N=e.m,u=E.m;return u[0]=H[0]+N[0],u[1]=H[1]+N[1],u[2]=H[2]+N[2],u[3]=H[3]+N[3],u[4]=H[4]+N[4],u[5]=H[5]+N[5],u[6]=H[6]+N[6],u[7]=H[7]+N[7],u[8]=H[8]+N[8],E}add(e){return this.addToRef(e,new z)}subtractToRef(e,E){const H=this.gP,N=e.m,u=E.m;return u[0]=H[0]-N[0],u[1]=H[1]-N[1],u[2]=H[2]-N[2],u[3]=H[3]-N[3],u[4]=H[4]-N[4],u[5]=H[5]-N[5],u[6]=H[6]-N[6],u[7]=H[7]-N[7],u[8]=H[8]-N[8],E}FE(e){return this.subtractToRef(e,new z)}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<9;E++)e[E]=this.gP[E];return e}uM(){return this.toArray()}VH(e){for(let E=0;E<9;E++)this.gP[E]=e[E];return this}transpose(){const e=this.gP;return new z([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]])}determinant(){const e=this.gP;return e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6])}inverse(){const e=this.determinant();if(0===e)throw new Error("Matrix is not invertible");const E=this.gP,H=1/e;return new z([(E[4]*E[8]-E[5]*E[7])*H,(E[2]*E[7]-E[1]*E[8])*H,(E[1]*E[5]-E[2]*E[4])*H,(E[5]*E[6]-E[3]*E[8])*H,(E[0]*E[8]-E[2]*E[6])*H,(E[2]*E[3]-E[0]*E[5])*H,(E[3]*E[7]-E[4]*E[6])*H,(E[1]*E[6]-E[0]*E[7])*H,(E[0]*E[4]-E[1]*E[3])*H])}equals(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.gP,N=e.m;return 0===E?H[0]===N[0]&&H[1]===N[1]&&H[2]===N[2]&&H[3]===N[3]&&H[4]===N[4]&&H[5]===N[5]&&H[6]===N[6]&&H[7]===N[7]&&H[8]===N[8]:Math.abs(H[0]-N[0])<E&&Math.abs(H[1]-N[1])<E&&Math.abs(H[2]-N[2])<E&&Math.abs(H[3]-N[3])<E&&Math.abs(H[4]-N[4])<E&&Math.abs(H[5]-N[5])<E&&Math.abs(H[6]-N[6])<E&&Math.abs(H[7]-N[7])<E&&Math.abs(H[8]-N[8])<E}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.gP.join(", ")})`}}},13430:(e,E,H)=>{"use strict";var N;function u(e,E,H,N){switch(E){case"Animation":return N?e.animations.find((e=>e.uniqueId===H))??null:e.animations[H]??null;case"AnimationGroup":return N?e.animationGroups.find((e=>e.uniqueId===H))??null:e.animationGroups[H]??null;case"Mesh":return N?e.meshes.find((e=>e.uniqueId===H))??null:e.meshes[H]??null;case"Material":return N?e.materials.find((e=>e.uniqueId===H))??null:e.materials[H]??null;case"HC":return N?e.cameras.find((e=>e.uniqueId===H))??null:e.cameras[H]??null;case"Light":return N?e.lights.find((e=>e.uniqueId===H))??null:e.lights[H]??null;default:return null}}H.d(E,{d:()=>u}),function(e){e.Animation="Animation",e.AnimationGroup="AnimationGroup",e.Mesh="Mesh",e.Material="Material",e.HC="HC",e.Light="Light"}(N||(N={}))},13467:(e,E,H)=>{"use strict";H.d(E,{b:()=>u});var N=H(13475);class u extends N.d{constructor(e,E){if(super(e),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),E)for(const H of E)this._eventsSignalOutputs[H]=this._registerSignalOutput(H+"Event")}_executeOnTick(e){}_startPendingTasks(e){e._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(e),this._resetAfterCanceled(e)),this._preparePendingTasks(e),e._addPendingBlock(this),this.out._activateSignal(e),e._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(e){e._deleteExecutionVariable(this,"_initialized"),e._removePendingBlock(this)}}},13441:(e,E,H)=>{"use strict";H.d(E,{b:()=>A});var N=H(11693),u=H(11690),z=H(13448),P=H(11541),M=H(13404);class D extends z.b{constructor(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:N.defaultValue,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(e,E,H),this.richType=N,this._defaultValue=u,this._optional=z,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new P.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(e){this._isDisabled!==e&&(this._isDisabled=e,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(e,E){E._getConnectionValue(this)!==e&&(E._setConnectionValue(this,e),this.onValueChangedObservable.notifyObservers(e))}resetToDefaultValue(e){e._setConnectionValue(this,this._defaultValue)}connectTo(e){this._isDisabled||super.connectTo(e)}_getValueOrDefault(e){const E=e._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(E):E}getValue(e){if(1===this.connectionType){e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(e);const E=this._getValueOrDefault(e);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}const E=this.isConnected()?this._connectedPoint[0].getValue(e):this._getValueOrDefault(e);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(e),e.richType={},this.richType.serialize(e.richType),e.optional=this._optional,(0,M.f)("defaultValue",this._defaultValue,e)}}(0,u.g)("FlowGraphDataConnection",D);class A{constructor(e){var E;this.config=e,this.uniqueId=(0,N.e)(),this.name=(null===(E=this.config)||void 0===E?void 0:E.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(e){}registerDataInput(e,E,H){const N=new D(e,0,this,E,H);return this.dataInputs.push(N),N}registerDataOutput(e,E,H){const N=new D(e,1,this,E,H);return this.dataOutputs.push(N),N}getDataInput(e){return this.dataInputs.find((E=>E.name===e))}getDataOutput(e){return this.dataOutputs.find((E=>E.name===e))}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.f;if(e.uniqueId=this.uniqueId,e.config={},this.config){const H=this.config,N=Object.keys(H);for(const u of N)E(u,H[u],e.config)}e.dataInputs=[],e.dataOutputs=[],e.className=this.getClassName();for(const H of this.dataInputs){const E={};H.serialize(E),e.dataInputs.push(E)}for(const H of this.dataOutputs){const E={};H.serialize(E),e.dataOutputs.push(E)}}deserialize(e){}_log(e,E,H){var N;null===(N=e.logger)||void 0===N||N.addLogItem({action:E,UH:H,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13448:(e,E,H)=>{"use strict";H.d(E,{b:()=>z});var N,u=H(11693);!function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(N||(N={}));class z{constructor(e,E,H){this._ownerBlock=H,this._connectedPoint=[],this.uniqueId=(0,u.e)(),this.connectedPointIds=[],this.name=e,this._connectionType=E}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(e){if(this._connectionType===e._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||e._isSingularConnection()&&e._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(e),e._connectedPoint.push(this)}disconnectFrom(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this._connectedPoint.indexOf(e),N=e._connectedPoint.indexOf(this);-1!==H&&-1!==N&&(E&&this._connectedPoint.splice(H,1),e._connectedPoint.splice(N,1))}disconnectFromAll(){for(const e of this._connectedPoint)this.disconnectFrom(e,!1);this._connectedPoint.length=0}dispose(){for(const e of this._connectedPoint)this.disconnectFrom(e)}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.uniqueId=this.uniqueId,e.name=this.name,e._connectionType=this._connectionType,e.connectedPointIds=[],e.className=this.getClassName();for(const E of this._connectedPoint)e.connectedPointIds.push(E.uniqueId)}getClassName(){return"FGConnection"}deserialize(e){this.uniqueId=e.uniqueId,this.name=e.name,this._connectionType=e._connectionType,this.connectedPointIds=e.connectedPointIds}}},13395:(e,E,H)=>{"use strict";H.d(E,{c:()=>a});var N,u=H(11541),z=H(11717),P=H(11723),M=H(11693),D=H(13404),A=H(13430),C=H(11548);!function(e){e.ExecuteBlock="ExecuteBlock",e.ExecuteEvent="ExecuteEvent",e.TriggerConnection="TriggerConnection",e.ContextVariableSet="ContextVariableSet",e.GlobalVariableSet="GlobalVariableSet",e.GlobalVariableDelete="GlobalVariableDelete",e.GlobalVariableGet="GlobalVariableGet",e.AddConnection="AddConnection",e.GetConnectionValue="GetConnectionValue",e.SetConnectionValue="SetConnectionValue",e.ActivateSignal="ActivateSignal",e.ContextVariableGet="ContextVariableGet"}(N||(N={}));class i{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(e){if(e.time||(e.time=Date.now()),this.log.push(e),this.logToConsole){var E;const H=null===(E=e.UH)||void 0===E?void 0:E.value;"object"===typeof H&&H.getClassName?C.d.Log(`[FGLog] ${e.className}:${e.uniqueId.split("-")[0]} ${e.action} - ${JSON.stringify(H.getClassName())}: ${H.toString()}`):C.d.Log(`[FGLog] ${e.className}:${e.uniqueId.split("-")[0]} ${e.action} - ${JSON.stringify(e.UH)}`)}}getItemsOfType(e){return this.log.filter((E=>E.action===e))}}class V{get enableLogging(){return this._enableLogging}set enableLogging(e){this._enableLogging!==e&&(this._enableLogging=e,this._enableLogging?(this.logger=new i,this.logger.logToConsole=!0):this.logger=null)}constructor(e){this.uniqueId=(0,M.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new u.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=e,this.assetsContext=e.assetsContext??e.hE}hasVariable(e){return e in this._userVariables}setVariable(e,E){var H;this._userVariables[e]=E,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",UH:{name:e,value:E}})}getAsset(e,E){return(0,A.d)(this.assetsContext,e,E)}getVariable(e){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",UH:{name:e,value:this._userVariables[e]}}),this._userVariables[e]}get userVariables(){return this._userVariables}fe(){return this._configuration.hE}_getUniqueIdPrefixedName(e,E){return`${e.uniqueId}_${E}`}_getGlobalContextVariable(e,E){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",UH:{name:e,defaultValue:E,possibleValue:this._globalContextVariables[e]}}),this._hasGlobalContextVariable(e)?this._globalContextVariables[e]:E}_setGlobalContextVariable(e,E){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",UH:{name:e,value:E}}),this._globalContextVariables[e]=E}_deleteGlobalContextVariable(e){var E;null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",UH:{name:e}}),delete this._globalContextVariables[e]}_hasGlobalContextVariable(e){return e in this._globalContextVariables}_setExecutionVariable(e,E,H){this._executionVariables[this._getUniqueIdPrefixedName(e,E)]=H}_getExecutionVariable(e,E,H){return this._hasExecutionVariable(e,E)?this._executionVariables[this._getUniqueIdPrefixedName(e,E)]:H}_deleteExecutionVariable(e,E){delete this._executionVariables[this._getUniqueIdPrefixedName(e,E)]}_hasExecutionVariable(e,E){return this._getUniqueIdPrefixedName(e,E)in this._executionVariables}_hasConnectionValue(e){return e.uniqueId in this._connectionValues}_setConnectionValue(e,E){var H;this._connectionValues[e.uniqueId]=E,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",UH:{connectionPointId:e.uniqueId,value:E}})}_setConnectionValueByKey(e,E){this._connectionValues[e]=E}_getConnectionValue(e){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",UH:{connectionPointId:e.uniqueId,value:this._connectionValues[e.uniqueId]}}),this._connectionValues[e.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(e){this._pendingBlocks.includes(e)||(this._pendingBlocks.push(e),this._pendingBlocks.sort(((e,E)=>e.priority-E.priority)))}_removePendingBlock(e){const E=this._pendingBlocks.indexOf(e);-1!==E&&this._pendingBlocks.splice(E,1)}_clearPendingBlocks(){for(const e of this._pendingBlocks)e._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(e){var E;this.onNodeExecutedObservable.notifyObservers(e),null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:e.getClassName(),uniqueId:e.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(e){this._setGlobalContextVariable("timeSinceStart",e.timeSinceStart),this._setGlobalContextVariable("deltaTime",e.deltaTime);for(const H of this._pendingBlocks){var E;null===(E=H._executeOnTick)||void 0===E||E.call(H,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.f;e.uniqueId=this.uniqueId,e._userVariables={};for(const N in this._userVariables)E(N,this._userVariables[N],e._userVariables);e._connectionValues={};for(const N in this._connectionValues)E(N,this._connectionValues[N],e._connectionValues);var H;this.assetsContext!==this.fe()&&(e._assetsContext={meshes:this.assetsContext.meshes.map((e=>e.id)),materials:this.assetsContext.materials.map((e=>e.id)),textures:this.assetsContext.textures.map((e=>e.name)),animations:this.assetsContext.animations.map((e=>e.name)),lights:this.assetsContext.lights.map((e=>e.id)),cameras:this.assetsContext.cameras.map((e=>e.id)),pV:null===(H=this.assetsContext.pV)||void 0===H?void 0:H.map((e=>e.name)),skeletons:this.assetsContext.skeletons.map((e=>e.id)),Ii:this.assetsContext.Ii.map((e=>e.name)),geometries:this.assetsContext.geometries.map((e=>e.id)),multiMaterials:this.assetsContext.multiMaterials.map((e=>e.id)),transformNodes:this.assetsContext.transformNodes.map((e=>e.id))})}getClassName(){return"FlowGraphContext"}}(0,z.e)([(0,P.S)()],V.prototype,"uniqueId",void 0);var U=H(13432),j=H(12e3);class F{constructor(e){this.onEventTriggeredObservable=new u.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=e,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.cP.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const e=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",UH:{timeSinceStart:this._startingTime,deltaTime:e}}),this._startingTime+=e})),this._meshPickedObserver=this._scene.onPointerObservable.add((e=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",UH:e})}),j.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((e=>{const E=e.pointerId,H=e.mesh,N=this._pointerUnderMeshState[E];!N&&H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",UH:{pointerId:E,mesh:H}}):N&&!H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",UH:{pointerId:E,mesh:N}}):N&&H&&N!==H&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",UH:{pointerId:E,mesh:N,over:H}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",UH:{pointerId:E,mesh:H,out:N}})),this._pointerUnderMeshState[E]=H}),j.d.POINTERMOVE)}dispose(){var e,E,H,N,u;null===(e=this._sceneDisposeObserver)||void 0===e||e.remove(),null===(E=this._sceneReadyObserver)||void 0===E||E.remove(),null===(H=this._sceneOnBeforeRenderObserver)||void 0===H||H.remove(),null===(N=this._meshPickedObserver)||void 0===N||N.remove(),null===(u=this._meshUnderPointerObserver)||void 0===u||u.remove(),this.onEventTriggeredObservable.clear()}}var h,S=H(13457);!function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started"}(h||(h={}));class X{get state(){return this._state}set state(e){this._state=e,this.onStateChangedObservable.notifyObservers(e)}constructor(e){this.onStateChangedObservable=new u.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=e.hE,this._sceneEventCoordinator=new F(this._scene),this._coordinator=e.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((e=>{for(const E of this._executionContexts){const H=this._getContextualOrder(e.type,E);for(const N of H)if(!N._executeEvent(E,e.UH))break}switch(e.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const E of this._executionContexts)E._notifyOnTick(e.UH);break;case"SceneDispose":this.dispose()}}))}createContext(){const e=new V({hE:this._scene,coordinator:this._coordinator});return this._executionContexts.push(e),e}getContext(e){return this._executionContexts[e]}addEventBlock(e){if("PointerOver"!==e.type&&"PointerOut"!==e.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==e.type&&this._eventBlocks[e.type].push(e),1===this.state)for(const E of this._executionContexts)e._startPendingTasks(E);else this.onStateChangedObservable.addOnce((E=>{if(1===E)for(const H of this._executionContexts)e._startPendingTasks(H)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((e=>{1===e&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const e of this._executionContexts)for(const E in this._eventBlocks){const H=this._getContextualOrder(E,e);for(const E of H)E._startPendingTasks(e)}}_getContextualOrder(e,E){const H=this._eventBlocks[e].sort(((e,E)=>E.initPriority-e.initPriority));if("MeshPick"===e){const e=[];for(const N of H){const u=N.asset.getValue(E);let z=0;for(;z<H.length;z++){const e=H[z].asset.getValue(E);if(u&&e&&(0,S.o)(u,e))break}e.splice(z,0,N)}return e}return H}dispose(){var e;if(0!==this.state){this.state=0;for(const e of this._executionContexts)e._clearPendingBlocks();this._executionContexts.length=0;for(const e in this._eventBlocks)this._eventBlocks[e].length=0;null===(e=this._eventObserver)||void 0===e||e.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(e){const E=[],H=new Set;for(const N in this._eventBlocks)for(const e of this._eventBlocks[N])E.push(e),H.add(e.uniqueId);for(;E.length>0;){const N=E.pop();e(N);for(const e of N.dataInputs)for(const N of e._connectedPoint)H.has(N._ownerBlock.uniqueId)||(E.push(N._ownerBlock),H.add(N._ownerBlock.uniqueId));if(N instanceof U.b)for(const e of N.signalOutputs)for(const N of e._connectedPoint)H.has(N._ownerBlock.uniqueId)||(E.push(N._ownerBlock),H.add(N._ownerBlock.uniqueId))}}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;e.allBlocks=[],this.visitAllBlocks((E=>{const H={};E.serialize(H),e.allBlocks.push(H)})),e.executionContexts=[];for(const H of this._executionContexts){const N={};H.serialize(N,E),e.executionContexts.push(N)}}}class a{constructor(e){this.config=e,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.hE.cP.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.hE.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const e=this._executeOnNextFrame.slice(0);if(e.length)for(const E of e){this.notifyCustomEvent(E.id,E.data,!1);const e=this._executeOnNextFrame.findIndex((e=>e.uniqueId===E.uniqueId));-1!==e&&this._executeOnNextFrame.splice(e,1)}}));(a.SceneCoordinators.get(this.config.hE)??[]).push(this)}createGraph(){const e=new X({hE:this.config.hE,coordinator:this});return this._flowGraphs.push(e),e}removeGraph(e){const E=this._flowGraphs.indexOf(e);-1!==E&&(e.dispose(),this._flowGraphs.splice(E,1))}start(){for(const e of this._flowGraphs)e.start()}dispose(){var e,E;for(const u of this._flowGraphs)u.dispose();this._flowGraphs.length=0,null===(e=this._disposeObserver)||void 0===e||e.remove(),null===(E=this._onBeforeRenderObserver)||void 0===E||E.remove();const H=a.SceneCoordinators.get(this.config.hE)??[],N=H.indexOf(this);-1!==N&&H.splice(N,1)}serialize(e,E){e._flowGraphs=[];for(const H of this._flowGraphs){const N={};H.serialize(N,E),e._flowGraphs.push(N)}e.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(e){let E=this._customEventsMap.get(e);return E||(E=new u.d,this._customEventsMap.set(e,E)),E}notifyCustomEvent(e,E){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:e,data:E,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(e)){const E=this._eventExecutionCounter.get(e);if(this._eventExecutionCounter.set(e,E+1),E>=a.MaxEventTypeExecutionPerFrame)return void(E===a.MaxEventTypeExecutionPerFrame&&C.d.Warn(`FlowGraphCoordinator: Too many executions of event "${e}".`))}else this._eventExecutionCounter.set(e,1);const H=this._customEventsMap.get(e);H&&H.notifyObservers(E)}}a.MaxEventsPerType=30,a.MaxEventTypeExecutionPerFrame=30,a.SceneCoordinators=new Map},13464:(e,E,H)=>{"use strict";H.d(E,{b:()=>u});var N=H(13467);class u extends N.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(e){e._notifyExecuteNode(this),this.done._activateSignal(e)}}},13432:(e,E,H)=>{"use strict";H.d(E,{b:()=>M});var N=H(13441),u=H(13448),z=H(11690);class P extends u.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(e){super.connectTo(e),this._connectedPoint.sort(((e,E)=>E.priority-e.priority))}_activateSignal(e){var E;if(null===(E=e.logger)||void 0===E||E.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,UH:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(e,this),e._increaseExecutionId();else for(const H of this._connectedPoint)H._activateSignal(e)}}(0,z.g)("FlowGraphSignalConnection",P);class M extends N.b{constructor(e){super(e),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(e){const E=new P(e,0,this);return this.signalInputs.push(E),E}_registerSignalOutput(e){const E=new P(e,1,this);return this.signalOutputs.push(E),E}_unregisterSignalInput(e){const E=this.signalInputs.findIndex((E=>E.name===e));-1!==E&&(this.signalInputs[E].dispose(),this.signalInputs.splice(E,1))}_unregisterSignalOutput(e){const E=this.signalOutputs.findIndex((E=>E.name===e));-1!==E&&(this.signalOutputs[E].dispose(),this.signalOutputs.splice(E,1))}_reportError(e,E){this.error.UH="string"===typeof E?new Error(E):E,this.error._activateSignal(e)}getSignalInput(e){return this.signalInputs.find((E=>E.name===e))}getSignalOutput(e){return this.signalOutputs.find((E=>E.name===e))}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(e),e.signalInputs=[],e.signalOutputs=[];for(const E of this.signalInputs){const H={};E.serialize(H),e.signalInputs.push(H)}for(const E of this.signalOutputs){const H={};E.serialize(H),e.signalOutputs.push(H)}}deserialize(e){for(let E=0;E<e.signalInputs.length;E++){const H=this.getSignalInput(e.signalInputs[E].name);if(!H)throw new Error("Could not find signal input with name "+e.signalInputs[E].name+" in block "+e.className);H.deserialize(e.signalInputs[E])}for(let E=0;E<e.signalOutputs.length;E++){const H=this.getSignalOutput(e.signalOutputs[E].name);if(!H)throw new Error("Could not find signal output with name "+e.signalOutputs[E].name+" in block "+e.className);H.deserialize(e.signalOutputs[E])}}getClassName(){return"FlowGraphExecutionBlock"}}},13475:(e,E,H)=>{"use strict";H.d(E,{d:()=>u});var N=H(13432);class u extends N.b{constructor(e){super(e),this.out=this._registerSignalOutput("out")}}},13415:(e,E,H)=>{"use strict";H.d(E,{D:()=>U,E:()=>j,F:()=>F,G:()=>s,K:()=>p,N:()=>w,P:()=>f,b:()=>A,f:()=>V,h:()=>Y,l:()=>h,p:()=>S,r:()=>X,t:()=>i,x:()=>r,z:()=>C});var N,u=H(11738),z=H(11789),P=H(13407),M=H(13421);!function(e){e.Any="any",e.String="string",e.Number="number",e.Boolean="boolean",e.Object="object",e.Integer="FlowGraphInteger",e.Vector2="Vector2",e.jE="jE",e.Vector4="Vector4",e.Quaternion="Quaternion",e.Matrix="Matrix",e.Matrix2D="Matrix2D",e.Matrix3D="Matrix3D",e.XE="XE",e.FM="FM"}(N||(N={}));class D{constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=e,this.defaultValue=E,this.animationType=H}serialize(e){e.typeName=this.typeName,e.defaultValue=this.defaultValue}}const A=new D("any",void 0),C=new D("string",""),i=new D("number",0,0),V=new D("boolean",!1),U=new D("Vector2",u.Vector2.Zero(),5),j=new D("jE",u.jE.Zero(),1),F=new D("Vector4",u.Vector4.Zero()),h=new D("Matrix",u.Matrix.Identity(),3),S=new D("Matrix2D",new M.b),X=new D("Matrix3D",new M.d),a=new D("XE",z.XE.Black(),4),W=new D("FM",new z.FM(0,0,0,0),7),r=new D("Quaternion",u.Quaternion.Identity(),2);r.typeTransformer=e=>{if(e.getClassName){if("Vector4"===e.getClassName())return u.Quaternion.aE(e.uM());if("jE"===e.getClassName())return u.Quaternion.FromEulerVector(e);if("Matrix"===e.getClassName())return u.Quaternion.FromRotationMatrix(e)}return e};const Y=new D("FlowGraphInteger",new P.b(0),0);function f(e){const E=e;switch(typeof e){case"string":return C;case"number":return i;case"boolean":return V;case"object":if(E.getClassName)switch(E.getClassName()){case"Vector2":return U;case"jE":return j;case"Vector4":return F;case"Matrix":return h;case"XE":return a;case"FM":return W;case"Quaternion":return r;case"FlowGraphInteger":return Y;case"Matrix2D":return S;case"Matrix3D":return X}return A;default:return A}}function w(e){switch(e){case"string":return C;case"number":return i;case"boolean":return V;case"Vector2":return U;case"jE":return j;case"Vector4":return F;case"Matrix":return h;case"XE":return a;case"FM":return W;case"Quaternion":return r;case"FlowGraphInteger":return Y;case"Matrix2D":return S;case"Matrix3D":return X;default:return A}}function s(e){switch(e){case"number":default:return 0;case"Vector2":return 5;case"jE":return 1;case"Matrix":return 3;case"XE":return 4;case"FM":return 7;case"Quaternion":return 2}}function p(e){switch(e){case 0:return i;case 5:return U;case 1:return j;case 3:return h;case 4:return a;case 7:return W;case 2:return r;default:return A}}},13404:(e,E,H)=>{"use strict";H.d(E,{c:()=>C,f:()=>A,h:()=>i});var N=H(11789),u=H(11738),z=H(13407),P=H(13415),M=H(13421);function D(e){return"Vector2"===e||"jE"===e||"Vector4"===e||"Quaternion"===e||"XE"===e||"FM"===e}function A(e,E,H){var N;const u=(null===E||void 0===E||null===(N=E.getClassName)||void 0===N?void 0:N.call(E))??"";if(D(u)||function(e){return"Matrix"===e||"Matrix2D"===e||"Matrix3D"===e}(u))H[e]={value:E.uM(),className:u};else if("FlowGraphInteger"===u)H[e]={value:E.value,className:u};else if(u&&(E.id||E.name))H[e]={id:E.id,name:E.name,className:u};else{if("object"===typeof E)throw new Error(`Could not serialize value ${E}`);H[e]=E}}function C(e,E,H,A){const i=E[e];let V;const U=(null===i||void 0===i?void 0:i.type)??(null===i||void 0===i?void 0:i.className);if(function(e){return"Mesh"===e||"AbstractMesh"===e||"GroundMesh"===e||"InstanceMesh"===e||"LinesMesh"===e||"GoldbergMesh"===e||"GreasedLineMesh"===e||"TrailMesh"===e}(U)){let e=A.meshes.filter((e=>i.id?e.id===i.id:e.name===i.name));0===e.length&&(e=A.transformNodes.filter((e=>i.id?e.id===i.id:e.name===i.name))),V=i.uniqueId?e.find((e=>e.uniqueId===i.uniqueId)):e[0]}else if(D(U))V=function(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===e)return u.Vector2.aE(E);if("jE"===e)return H&&(E[2]*=-1),u.jE.aE(E);if("Vector4"===e)return u.Vector4.aE(E);if("Quaternion"===e)return H&&(E[2]*=-1,E[3]*=-1),u.Quaternion.aE(E);if("XE"===e)return new N.XE(E[0],E[1],E[2]);if("FM"===e)return new N.FM(E[0],E[1],E[2],E[3]);throw new Error(`Unknown vector class name ${e}`)}(U,i.value);else if(function(e){return"AnimationGroup"===e}(U)){const e=A.animationGroups.filter((e=>e.name===i.name));V=1===e.length?e[0]:e.find((e=>e.uniqueId===i.uniqueId))}else V="Matrix"===U?u.Matrix.aE(i.value):"Matrix2D"===U?new M.b(i.value):"Matrix3D"===U?new M.d(i.value):"FlowGraphInteger"===U?z.b.FromValue(i.value):"number"===U||"string"===U||"boolean"===U?i.value[0]:i&&void 0!==i.value?i.value:Array.isArray(i)?i.reduce(((e,E)=>E.eventData?(e[E.id]={type:(0,P.N)(E.type)},"undefined"!==typeof E.value&&(e[E.id].value=C("value",E,H,A)),e):e),{}):i;return V}function i(e){return"FlowGraphJsonPointerParserBlock"===e}},13457:(e,E,H)=>{"use strict";function N(e,E){return!(!e.parent||e.parent!==E&&!N(e.parent,E))}function u(e){if(e.getClassName)return e.getClassName()}function z(e,E){return e===E&&("Vector2"===e||"jE"===e||"Vector4"===e||"Quaternion"===e)}function P(e,E){return e===E&&("Matrix"===e||"Matrix2D"===e||"Matrix3D"===e)}function M(e,E){return"FlowGraphInteger"===e&&"FlowGraphInteger"===E}function D(e,E){const H="number"===typeof e||"number"===typeof(null===e||void 0===e?void 0:e.value);return H&&!E?!isNaN(A(e)):H}function A(e){return"number"===typeof e?e:e.value}H.d(E,{b:()=>M,f:()=>P,h:()=>z,l:()=>u,o:()=>N,s:()=>A,v:()=>D})},12829:(e,E,H)=>{"use strict";H.r(E),H.d(E,{SceneInstrumentation:()=>z});var N=H(11532),u=H(11944);class z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(e){e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.hE.onBeforeActiveMeshesEvaluationObservable.add((()=>{N.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.hE.onAfterActiveMeshesEvaluationObservable.add((()=>{N.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.hE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.hE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(e){e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.hE.onBeforeRenderTargetsRenderObservable.add((()=>{N.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.hE.onAfterRenderTargetsRenderObservable.add((()=>{N.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.hE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.hE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(e){e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.hE.onBeforeParticlesRenderingObservable.add((()=>{N.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.hE.onAfterParticlesRenderingObservable.add((()=>{N.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.hE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.hE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(e){e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.hE.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.hE.onBeforeSpritesRenderingObservable.add((()=>{N.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.hE.onAfterSpritesRenderingObservable.add((()=>{N.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.hE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.hE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(e){e!==this._capturePhysicsTime&&this.hE.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.hE.onBeforePhysicsObservable.add((()=>{N.Tools.StartPerformanceCounter("bi"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.hE.onAfterPhysicsObservable.add((()=>{N.Tools.EndPerformanceCounter("bi"),this._physicsTime.endMonitoring()}))):(this.hE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.hE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(e){e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.hE.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.hE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(e){this._captureFrameTime=e}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(e){this._captureInterFrameTime=e}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(e){e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.hE.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),N.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.hE.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),N.Tools.EndPerformanceCounter("Main render")}))):(this.hE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.hE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(e){e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.hE.onBeforeCameraRenderObservable.add((e=>{this._cameraRenderTime.beginMonitoring(),N.Tools.StartPerformanceCounter(`Rendering camera ${e.name}`)})),this._onAfterCameraRenderObserver=this.hE.onAfterCameraRenderObservable.add((e=>{this._cameraRenderTime.endMonitoring(!1),N.Tools.EndPerformanceCounter(`Rendering camera ${e.name}`)}))):(this.hE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.hE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.hE.getEngine()._drawCalls}constructor(e){this.hE=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new u.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new u.b,this._captureFrameTime=!1,this._frameTime=new u.b,this._captureRenderTime=!1,this._renderTime=new u.b,this._captureInterFrameTime=!1,this._interFrameTime=new u.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new u.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new u.b,this._capturePhysicsTime=!1,this._physicsTime=new u.b,this._captureAnimationsTime=!1,this._animationsTime=new u.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new u.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(N.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.hE.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=e.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(N.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qP(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qP(),this._captureParticlesRenderTime&&this._particlesRenderTime.qP(),this._captureSpritesRenderTime&&this._spritesRenderTime.qP(),this._captureRenderTime&&this._renderTime.qP(),this._captureCameraRenderTime&&this._cameraRenderTime.qP()}))}dispose(){this._disposed||(this.hE.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.hE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.hE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.hE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.hE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.hE.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.hE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.hE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.hE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.hE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.hE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.hE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.hE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.hE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.hE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.hE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.hE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.hE=null,this._disposed=!0)}}},13392:(e,E,H)=>{"use strict";H.d(E,{b:()=>C});var N=H(11717),u=H(11723),z=H(11738),P=H(12136),M=H(12256),D=H(12330),A=H(11690);P.e.AddNodeConstructor("Light_Type_1",((e,E)=>()=>new C(e,z.jE.Zero(),E)));class C extends D.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(e){this._orthoLeft=e}get orthoRight(){return this._orthoRight}set orthoRight(e){this._orthoRight=e}get orthoTop(){return this._orthoTop}set orthoTop(e){this._orthoTop=e}get orthoBottom(){return this._orthoBottom}set orthoBottom(e){this._orthoBottom=e}constructor(e,E,H){super(e,H),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=E.scale(-1),this.direction=E}getClassName(){return"Lj"}getTypeID(){return M.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(e,E,H){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,E,H)}_setDefaultFixedFrustumShadowProjectionMatrix(e){const E=this.fe().activeCamera;E&&z.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:E.PM,void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,e,this.fe().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(e,E,H){const N=this.fe().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const e=z.jE.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let N=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let P=0;P<H.length;P++){const M=H[P];if(!M)continue;const D=M.getBoundingInfo().boundingBox;for(let H=0;H<D.vectorsWorld.length;H++)z.jE.TransformCoordinatesToRef(D.vectorsWorld[H],E,e),e.x<this._orthoLeft&&(this._orthoLeft=e.x),e.y<this._orthoBottom&&(this._orthoBottom=e.y),e.x>this._orthoRight&&(this._orthoRight=e.x),e.y>this._orthoTop&&(this._orthoTop=e.y),this.autoCalcShadowZBounds&&(e.z<N&&(N=e.z),e.z>u&&(u=e.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=N,this._shadowMaxZ=u)}const u=this._orthoRight-this._orthoLeft,P=this._orthoTop-this._orthoBottom,M=void 0!==this.shadowMinZ?this.shadowMinZ:(null===N||void 0===N?void 0:N.PM)||0,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===N||void 0===N?void 0:N.maxZ)||1e4,A=this.fe().getEngine().IP;z.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-P*this.shadowOrthoScale,this._orthoTop+P*this.shadowOrthoScale,A?D:M,A?M:D,e,this.fe().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,E){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,E),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,E),this)}transferToNodeMaterialEffect(e,E){return this.computeTransformedInformation()?(e.setFloat3(E,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(E,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(e){const E=this._scene.getEngine();return!E.IP&&E.isNDCHalfZRange?0:1}getDepthMaxZ(e){const E=this._scene.getEngine();return E.IP&&E.isNDCHalfZRange?0:1}prepareLightSpecificDefines(e,E){e["DIRLIGHT"+E]=!0}}(0,N.e)([(0,u.S)()],C.prototype,"shadowFrustumSize",null),(0,N.e)([(0,u.S)()],C.prototype,"shadowOrthoScale",null),(0,N.e)([(0,u.S)()],C.prototype,"autoUpdateExtends",void 0),(0,N.e)([(0,u.S)()],C.prototype,"autoCalcShadowZBounds",void 0),(0,N.e)([(0,u.S)("orthoLeft")],C.prototype,"_orthoLeft",void 0),(0,N.e)([(0,u.S)("orthoRight")],C.prototype,"_orthoRight",void 0),(0,N.e)([(0,u.S)("orthoTop")],C.prototype,"_orthoTop",void 0),(0,N.e)([(0,u.S)("orthoBottom")],C.prototype,"_orthoBottom",void 0),(0,A.g)("BABYLON.DirectionalLight",C)},13879:(e,E,H)=>{"use strict";H.d(E,{b:()=>C});var N=H(11717),u=H(11723),z=H(11738),P=H(11789),M=H(12136),D=H(12256),A=H(11690);M.e.AddNodeConstructor("Light_Type_3",((e,E)=>()=>new C(e,z.jE.Zero(),E)));class C extends D.b{constructor(e,E,H){super(e,H),this.groundColor=new P.XE(0,0,0),this.direction=E||z.jE.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"dj"}setDirectionToTarget(e){return this.direction=z.jE.Normalize(e.FE(z.jE.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(e,E){const H=z.jE.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",H.x,H.y,H.z,0,E),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.XM),E),this}transferToNodeMaterialEffect(e,E){const H=z.jE.Normalize(this.direction);return e.setFloat3(E,H.x,H.y,H.z),this}DM(){return this._worldMatrix||(this._worldMatrix=z.Matrix.Identity()),this._worldMatrix}getTypeID(){return D.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(e,E){e["HEMILIGHT"+E]=!0}}(0,N.e)([(0,u.n)()],C.prototype,"groundColor",void 0),(0,N.e)([(0,u.P)()],C.prototype,"direction",void 0),(0,A.g)("BABYLON.HemisphericLight",C)},13354:(e,E,H)=>{"use strict";H.d(E,{e:()=>i});var N=H(11717),u=H(11723),z=H(11738),P=H(12136),M=H(12256),D=H(12330),A=H(11712),C=H(11690);P.e.AddNodeConstructor("Light_Type_2",((e,E)=>()=>new i(e,z.jE.Zero(),z.jE.Zero(),0,0,E)));class i extends D.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(e){this._iesProfileTexture!==e&&(this._iesProfileTexture=e,this._iesProfileTexture&&i._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(e){this._innerAngle=e,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(e){this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(i._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):i._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(e){return void 0!==e.onGeneratedObservable}static _IsTexture(e){return void 0!==e.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(e){this._projectionTextureProjectionLightMatrix=e,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(e,E,H,N,u,P){super(e,P),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=z.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=z.jE.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=z.jE.Zero(),this._projectionTextureViewLightMatrix=z.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=z.Matrix.Zero(),this._projectionTextureScalingMatrix=z.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=E,this.direction=H,this.angle=N,this.exponent=u}getClassName(){return"SpotLight"}getTypeID(){return M.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(e){super._setDirection(e),this._projectionTextureViewLightDirty=!0}_setPosition(e){super._setPosition(e),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(e,E,H){const N=this.fe().activeCamera;if(!N)return;this._shadowAngleScale=this._shadowAngleScale||1;const u=this._shadowAngleScale*this._angle,P=void 0!==this.shadowMinZ?this.shadowMinZ:N.PM,M=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,D=this.fe().getEngine().IP;z.Matrix.PerspectiveFovLHToRef(u,1,D?M:P,D?P:M,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,D)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),z.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const e=this.projectionTextureLightFar,E=this.projectionTextureLightNear,H=e/(e-E),N=-H*E,u=1/Math.tan(this._angle/2);z.Matrix.FromValuesToRef(u/1,0,0,0,0,u,0,0,0,0,H,1,0,0,N,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof A.b){const e=this._projectionTexture.uScale/2,E=this._projectionTexture.vScale/2;z.Matrix.FromValuesToRef(e,0,0,0,0,E,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(e,E){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+E,this._projectionTextureMatrix),e.setTexture("projectionLightTexture"+E,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&e.setTexture("iesLightTexture"+E,this._iesProfileTexture),this}transferToEffect(e,E){let H;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,E),H=z.jE.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,E),H=z.jE.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",H.x,H.y,H.z,this._cosHalfAngle,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,E),this}transferToNodeMaterialEffect(e,E){let H;return H=this.computeTransformedInformation()?z.jE.Normalize(this.transformedDirection):z.jE.Normalize(this.direction),this.fe().useRightHandedSystem?e.setFloat3(E,-H.x,-H.y,-H.z):e.setFloat3(E,H.x,H.y,H.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(e){const E=this._scene.getEngine(),H=void 0!==this.shadowMinZ?this.shadowMinZ:(null===e||void 0===e?void 0:e.PM)??0;return E.IP&&E.isNDCHalfZRange?H:this._scene.getEngine().isNDCHalfZRange?0:H}getDepthMaxZ(e){const E=this._scene.getEngine(),H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===e||void 0===e?void 0:e.maxZ)??1e4;return E.IP&&E.isNDCHalfZRange?0:H}prepareLightSpecificDefines(e,E){e["SPOTLIGHT"+E]=!0,e["PROJECTEDLIGHTTEXTURE"+E]=!(!this.projectionTexture||!this.projectionTexture.isReady()),e["IESLIGHTTEXTURE"+E]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,N.e)([(0,u.S)()],i.prototype,"angle",null),(0,N.e)([(0,u.S)()],i.prototype,"innerAngle",null),(0,N.e)([(0,u.S)()],i.prototype,"shadowAngleScale",null),(0,N.e)([(0,u.S)()],i.prototype,"exponent",void 0),(0,N.e)([(0,u.S)()],i.prototype,"projectionTextureLightNear",null),(0,N.e)([(0,u.S)()],i.prototype,"projectionTextureLightFar",null),(0,N.e)([(0,u.S)()],i.prototype,"projectionTextureUpDirection",null),(0,N.e)([(0,u.H)("projectedLightTexture")],i.prototype,"_projectionTexture",void 0),(0,C.g)("BABYLON.SpotLight",i)},13103:(e,E,H)=>{"use strict";H.d(E,{c:()=>P,e:()=>z,g:()=>M});const N={},u={};function z(e,E){N[e]=E}function P(e,E){u[e]=E}function M(e){return u[e]?u[e]:null}},12997:(e,E,H)=>{"use strict";H.d(E,{e:()=>f,h:()=>R});var N,u=H(11532),z=H(11541),P=H(11967),M=H(11579),D=H(11548),A=H(12181),C=H(11587),i=H(11593),V=H(11693),U=H(11618),j=H(11571);!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(N||(N={}));const F=new z.d,h={};let S=!1;function X(){return h[".babylon"]}function a(e,E){const H=h[e];return H||(D.d.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),E?X():void 0)}function W(e,E,H){let N="Unable to load from "+(e.rawData?"binary data":e.url);return E?N+=`: ${E}`:H&&(N+=`: ${H}`),N}async function r(e,E,H,N,u,z,P,M,D){var A;const i="data:"===(V=e.url).substring(0,5)?V.substring(5):null;var V;if(e.rawData&&!P)throw"When using ArrayBufferView to load data the file extension must be provided.";const S=i||P?"":function(e){const E=e.indexOf("?");-1!==E&&(e=e.substring(0,E));const H=e.lastIndexOf(".");return e.substring(H,e.length).toLowerCase()}(e.url);let W=P?a(P,!0):i?function(e){for(const E in h){const H=h[E].plugin;if(H.canDirectLoad&&H.canDirectLoad(e))return h[E]}return X()}(e.url):a(S,!1);if(!W&&S){if(e.url&&!e.url.startsWith("blob:")){const E=await async function(e,E){const H=E.method||"GET";return await new Promise(((N,u)=>{const z=new j.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const e={};if(E.responseHeaders)for(const H of E.responseHeaders)e[H]=z.getResponseHeader(H)||"";N({response:z.response,headerValues:e})}else u(`Unable to fetch data from ${e}. Error code: ${z.status}`)})),z.open(H,e),z.send()}))}(e.url,{method:"HEAD",responseHeaders:["Content-Type"]}),H=E.headerValues?E.headerValues["Content-Type"]:"";H&&(W=function(e){for(const E in h){const H=h[E];if(H.mimeType===e)return H}}(H))}W||(W=X())}if(!W)throw new Error(`No plugin or fallback for ${P??e.url}`);if(!1===(null===D||void 0===D||null===(A=D[W.plugin.name])||void 0===A?void 0:A.enabled))throw new Error(`The '${W.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(e.rawData&&!W.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(e=>{if(W.plugin.createPlugin){const E=W.plugin.createPlugin(D??{});return E instanceof Promise?(E.then(e).catch((e=>{u("Error instantiating plugin.",e)})),null):(e(E),E)}return e(W.plugin),W.plugin})((D=>{var A;if(!D)throw`The loader plugin corresponding to the '${P}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(F.notifyObservers(D),i&&(D.canDirectLoad&&D.canDirectLoad(e.url)||!(0,C.n)(e.url))){if(D.directLoad){const e=D.directLoad(E,i);e instanceof Promise?e.then((e=>{H(D,e)})).catch((e=>{u("Error in directLoad of _loadData: "+e,e)})):H(D,e)}else H(D,i);return}const V=W.isBinary,j=(e,N)=>{E.A?u("Scene has been disposed"):H(D,e,N)};let h=null,S=!1;null===(A=D.cP)||void 0===A||A.add((()=>{S=!0,h&&(h.abort(),h=null),z()}));const X=()=>{if(S)return;const H=(e,E)=>{u(null===e||void 0===e?void 0:e.statusText,E)};if(!D.loadFile&&e.rawData)throw"Plugin does not support loading ArrayBufferView.";h=D.loadFile?D.loadFile(E,e.rawData||e.file||e.url,e.rootUrl,j,N,V,H,M):E._loadFile(e.file||e.url,j,N,!0,V,H)},a=E.getEngine();let r=a.enableOfflineSupport;if(r){let H=!1;for(const N of E.disableOfflineSupportExceptionRules)if(N.test(e.url)){H=!0;break}r=!H}r&&U.c.OfflineProviderFactory?E.offlineProvider=U.c.OfflineProviderFactory(e.url,X,a.disableManifestCheck):X()}))}function Y(e,E){let H,N,z=null,P=null;if(E)if(E.name)H=`file:${E.name}`,N=E.name,z=E;else if(ArrayBuffer.isView(E))H="",N=(0,V.e)(),P=E;else if(E.startsWith("data:"))H=E,N="";else if(e){const z=E;if("/"===z.substring(0,1))return u.Tools.Error("Wrong sceneFilename parameter"),null;H=e+z,N=z}else H=E,N=u.Tools.GetFilename(E),e=u.Tools.GetFolderPath(E);else H=e,N=u.Tools.GetFilename(e),e=u.Tools.GetFolderPath(e);return{url:H,rootUrl:e,name:N,file:z,rawData:P}}function f(e){if("string"===typeof e.extensions){const E=e.extensions;h[E.toLowerCase()]={plugin:e,isBinary:!1}}else{const E=e.extensions,H=Object.keys(E);for(const N of H)h[N.toLowerCase()]={plugin:e,isBinary:E[N].isBinary,mimeType:E[N].mimeType}}}async function w(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.d.LastCreatedScene,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!N)return D.d.Error("No scene available to import mesh to"),null;const U=Y(E,H);if(!U)return null;const j={};N.addPendingData(j);const F=()=>{N.removePendingData(j)},h=(e,E)=>{const H=W(U,e,E);P?P(N,H,new i.j(H,i.h.SceneLoaderError,E)):D.d.Error(H),F()},S=z?e=>{try{z(e)}catch(E){h("Error in onProgress callback: "+E,E)}}:void 0,X=(e,E,H,z,P,M,D,A)=>{if(N.importedMeshesFiles.push(U.url),u)try{u(e,E,H,z,P,M,D,A)}catch(C){h("Error in onSuccess callback: "+C,C)}N.removePendingData(j)};return await r(U,N,((E,H,u)=>{if(E.rewriteRootURL&&(U.rootUrl=E.rewriteRootURL(U.rootUrl,u)),E.importMesh){const u=[],z=[],P=[];if(!E.importMesh(e,N,H,U.rootUrl,u,z,P,h))return;N.loadingPluginName=E.name,X(u,z,P,[],[],[],[],[])}else{E.importMeshAsync(e,N,H,U.rootUrl,S,U.name).then((e=>{N.loadingPluginName=E.name,X(e.meshes,e.Ii,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights,e.spriteManagers)})).catch((e=>{h(e.message,e)}))}}),S,h,F,A,C,V)}async function s(e,E,H,N,u,z,P,M){return await new Promise(((D,A)=>{try{w(e,E,H,N,((e,E,H,N,u,z,P,M)=>{D({meshes:e,Ii:E,skeletons:H,animationGroups:N,transformNodes:u,geometries:z,lights:P,spriteManagers:M})}),u,((e,E,H)=>{A(H||new Error(E))}),z,P,M).catch(A)}catch(i){A(i)}}))}async function p(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.d.LastCreatedEngine,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};H?await y(e,E,new P.c(H),N,z,D,A,C,i):u.Tools.Error("No engine available")}async function o(e,E,H,N,u,z,P){return await new Promise(((M,D)=>{p(e,E,H,(e=>{M(e)}),N,((e,E,H)=>{D(H||new Error(E))}),u,z,P)}))}async function y(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.d.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return D.d.Error("No scene available to append to"),null;const U=Y(e,E);if(!U)return null;const j={};H.addPendingData(j);const F=()=>{H.removePendingData(j)};A.d.ShowLoadingScreen&&!S&&(S=!0,H.getEngine().displayLoadingUI(),H.executeWhenReady((()=>{H.getEngine().hideLoadingUI(),S=!1})));const h=(e,E)=>{const N=W(U,e,E);z?z(H,N,new i.j(N,i.h.SceneLoaderError,E)):D.d.Error(N),F()},X=u?e=>{try{u(e)}catch(E){h("Error in onProgress callback",E)}}:void 0,a=()=>{if(N)try{N(H)}catch(e){h("Error in onSuccess callback",e)}H.removePendingData(j)};return await r(U,H,((e,E)=>{if(e.load){if(!e.load(H,E,U.rootUrl,h))return;H.loadingPluginName=e.name,a()}else{e.loadAsync(H,E,U.rootUrl,X,U.name).then((()=>{H.loadingPluginName=e.name,a()})).catch((e=>{h(e.message,e)}))}}),X,h,F,P,C,V)}async function b(e,E,H,N,u,z,P){return await new Promise(((M,D)=>{try{y(e,E,H,(e=>{M(e)}),N,((e,E,H)=>{D(H||new Error(E))}),u,z,P).catch(D)}catch(i){D(i)}}))}async function K(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.d.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return D.d.Error("No scene available to load asset container to"),null;const V=Y(e,E);if(!V)return null;const U={};H.addPendingData(U);const j=()=>{H.removePendingData(U)},F=(e,E)=>{const N=W(V,e,E);z?z(H,N,new i.j(N,i.h.SceneLoaderError,E)):D.d.Error(N),j()},h=u?e=>{try{u(e)}catch(E){F("Error in onProgress callback",E)}}:void 0,S=e=>{if(N)try{N(e)}catch(E){F("Error in onSuccess callback",E)}H.removePendingData(U)};return await r(V,H,((e,E)=>{if(e.loadAssetContainer){const N=e.loadAssetContainer(H,E,V.rootUrl,F);if(!N)return;N.populateRootNodes(),H.loadingPluginName=e.name,S(N)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(H,E,V.rootUrl,h,V.name).then((E=>{E.populateRootNodes(),H.loadingPluginName=e.name,S(E)})).catch((e=>{F(e.message,e)}))}else F("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),h,F,j,P,A,C)}async function l(e,E,H,N,u,z,P){return await new Promise(((M,D)=>{try{K(e,E,H,(e=>{M(e)}),N,((e,E,H)=>{D(H||new Error(E))}),u,z,P).catch(D)}catch(i){D(i)}}))}async function O(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.d.LastCreatedScene,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!H)return void D.d.Error("No scene available to load animations to");if(N){for(const N of H.animatables)N.reset();H.stopAllAnimations();const e=H.animationGroups.slice();for(const H of e)H.dispose();const E=H.getNodes();for(const H of E)H.animations&&(H.animations=[])}else switch(u){case 0:const e=H.animationGroups.slice();for(const E of e)E.dispose();break;case 1:for(const E of H.animationGroups)E.stop();break;case 2:for(const E of H.animationGroups)E.reset(),E.restart();break;case 3:break;default:return void D.d.Error("Unknown animation group loading mode value '"+u+"'")}const j=H.animatables.length;await K(e,E,H,(e=>{e.mergeAnimationsTo(H,H.animatables.slice(j),z),e.dispose(),H.onAnimationFileImportedObservable.notifyObservers(H),P&&P(H)}),A,C,i,V,U)}async function v(e,E,H,N,u,z,P,M,D,A){return await new Promise(((C,V)=>{try{O(e,E,H,N,u,z,(e=>{C(e)}),P,((e,E,H)=>{V(H||new Error(E))}),M,D,A).catch(V)}catch(i){V(i)}}))}class R{static get ForceFullSceneLoadingForIncremental(){return A.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){A.d.ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return A.d.ShowLoadingScreen}static set ShowLoadingScreen(e){A.d.ShowLoadingScreen=e}static get loggingLevel(){return A.d.loggingLevel}static set loggingLevel(e){A.d.loggingLevel=e}static get CleanBoneMatrixWeights(){return A.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){A.d.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return X()}static GetPluginForExtension(e){var E;return null===(E=a(e,!0))||void 0===E?void 0:E.plugin}static IsPluginForExtensionAvailable(e){return function(e){return!!h[e]}(e)}static RegisterPlugin(e){f(e)}static ImportMesh(e,E,H,N,u,z,P,D,A){w(e,E,H,N,u,z,P,D,A).catch((e=>null===P||void 0===P?void 0:P(M.d.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async ImportMeshAsync(e,E,H,N,u,z,P){return await s(e,E,H,N,u,z,P)}static Load(e,E,H,N,u,z,P,D){p(e,E,H,N,u,z,P,D).catch((e=>null===z||void 0===z?void 0:z(M.d.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async LoadAsync(e,E,H,N,u,z){return await o(e,E,H,N,u,z)}static Append(e,E,H,N,u,z,P,D){y(e,E,H,N,u,z,P,D).catch((e=>null===z||void 0===z?void 0:z(H??M.d.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async AppendAsync(e,E,H,N,u,z){return await b(e,E,H,N,u,z)}static LoadAssetContainer(e,E,H,N,u,z,P,D){K(e,E,H,N,u,z,P,D).catch((e=>null===z||void 0===z?void 0:z(H??M.d.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async LoadAssetContainerAsync(e,E,H,N,u,z){return await l(e,E,H,N,u,z)}static ImportAnimations(e,E,H,N,u,z,P,D,A,C,i){O(e,E,H,N,u,z,P,D,A,C,i).catch((e=>null===A||void 0===A?void 0:A(H??M.d.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async ImportAnimationsAsync(e,E,H,N,u,z,P,M,D,A,C){return await v(e,E,H,N,u,z,M,A,C)}}R.NO_LOGGING=0,R.MINIMAL_LOGGING=1,R.SUMMARY_LOGGING=2,R.DETAILED_LOGGING=3,R.OnPluginActivatedObservable=F},13369:(e,E,H)=>{"use strict";H.d(E,{b:()=>V});var N=H(11717),u=H(11723),z=H(11532),P=H(11738),M=H(11765),D=H(11712),A=H(11690),C=H(11541),i=H(11776);H(13375);class V extends M.c{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const E=this.fe();E&&E.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(P.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,E,H){let N="";for(const u of e)N+=u;return new V(N,E,null,H,e)}static CreateFromPrefilteredData(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=E.useDelayedTextureLoading;E.useDelayedTextureLoading=!1;const z=new V(e,E,null,!1,null,null,null,void 0,!0,H,N);return E.useDelayedTextureLoading=u,z}constructor(e,E){var H;let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,V=arguments.length>8&&void 0!==arguments[8]&&arguments[8],U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,S=arguments.length>13?arguments[13]:void 0,X=arguments.length>14?arguments[14]:void 0;super(E),this.onLoadObservable=new C.d,this.boundingBoxPosition=P.jE.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new P.Matrix,this._buffer=null,this.name=e,this.url=e,this._noMipmap=u,this.zM=!1,this.isCube=!0,this._textureMatrix=P.Matrix.Identity(),this.coordinatesMode=D.b.CUBIC_MODE;let a=null,W=null;null===N||Array.isArray(N)?(this._noMipmap=u,this._format=i,this._createPolynomials=j,a=N,this._loaderOptions=S,this._useSRGBBuffer=X,this._lodScale=F,this._lodOffset=h):(a=N.extensions??null,this._noMipmap=N.noMipmap??!1,z=N.files??null,W=N.buffer??null,this._format=N.format??5,V=N.prefiltered??!1,U=N.forcedExtension??null,this._createPolynomials=N.createPolynomials??!1,this._lodScale=N.lodScale??.8,this._lodOffset=N.lodOffset??0,this._loaderOptions=N.loaderOptions,this._useSRGBBuffer=N.useSRGBBuffer,M=N.I??null,A=N.onError??null),(e||z)&&this.updateURL(e,U,M,V,A,a,null===(H=this.fe())||void 0===H?void 0:H.useDelayedTextureLoading,z,W)}getClassName(){return"CubeTexture"}updateURL(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,E&&(this._forcedExtension=E);const A=e.lastIndexOf("."),C=E||(A>-1?e.substring(A).toLowerCase():""),i=0===C.indexOf(".dds"),V=0===C.indexOf(".env"),U=0===C.indexOf(".basis");if(V?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=N,N&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),M)this._files=M;else if(U||V||i||z||(z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,z){for(let E=0;E<z.length;E++)this._files.push(e+z[E]);this._extensions=z}this._buffer=D,P?(this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=u):this._loadTexture(H,u)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){var E,H;if(e.updateFlag===this._textureMatrix.updateFlag)return;e.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(H=this.fe())||void 0===H||H.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))));if(this._textureMatrix=e,null===(E=this.fe())||void 0===E||!E.useRightHandedSystem)return;const N=P.TmpVectors.jE[0],u=P.TmpVectors.Quaternion[0],z=P.TmpVectors.jE[1];this._textureMatrix.decompose(N,u,z),u.z*=-1,u.w*=-1,P.Matrix.ComposeToRef(N,u,z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var e;return null!==(e=this.fe())&&void 0!==e&&e.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this.fe(),N=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const u=()=>{var E;(this.onLoadObservable.notifyObservers(this),N)&&(N.dispose(),null===(E=this.fe())||void 0===E||E.markAllMaterialsAsDirty(1));e&&e()},P=(e,H)=>{this._loadingError=!0,this._errorObject={message:e,exception:H},E&&E(e,H),D.b.OnTextureLoadErrorObservable.notifyObservers(this)};var M;this._texture?this._texture.isReady?z.Tools.SetImmediate((()=>u())):this._texture.onLoadedObservable.add((()=>u())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,H,this._lodScale,this._lodOffset,e,P,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,H,this._files,this._noMipmap,e,P,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(M=this._texture)||void 0===M||M.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(e,E,H){const N=i.d.Parse((()=>{let N=!1;return e.prefiltered&&(N=e.prefiltered),new V(H+(e.url??e.name),E,e.extensions,!1,e.files||null,null,null,void 0,N,e.forcedExtension)}),e,E);if(e.boundingBoxPosition&&(N.boundingBoxPosition=P.jE.aE(e.boundingBoxPosition)),e.boundingBoxSize&&(N.boundingBoxSize=P.jE.aE(e.boundingBoxSize)),e.animations)for(let u=0;u<e.animations.length;u++){const E=e.animations[u],H=(0,A.e)("BABYLON.Animation");H&&N.animations.push(H.Parse(E))}return N}clone(){let e=0;const E=i.d.Clone((()=>{const E=new V(this.url,this.fe()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=E.uniqueId,E}),this);return E.uniqueId=e,E}}(0,N.e)([(0,u.S)()],V.prototype,"url",void 0),(0,N.e)([(0,u.P)()],V.prototype,"boundingBoxPosition",void 0),(0,N.e)([(0,u.P)()],V.prototype,"boundingBoxSize",null),(0,N.e)([(0,u.S)("rotationY")],V.prototype,"rotationY",null),(0,N.e)([(0,u.S)("files")],V.prototype,"_files",void 0),(0,N.e)([(0,u.S)("forcedExtension")],V.prototype,"_forcedExtension",void 0),(0,N.e)([(0,u.S)("extensions")],V.prototype,"_extensions",void 0),(0,N.e)([(0,u.x)("textureMatrix")],V.prototype,"_textureMatrix",void 0),(0,N.e)([(0,u.x)("textureMatrixRefraction")],V.prototype,"_textureMatrixRefraction",void 0),D.b._CubeTextureParser=V.Parse,(0,A.g)("BABYLON.CubeTexture",V)},13893:(e,E,H)=>{"use strict";H.d(E,{b:()=>D});var N=H(11548),u=H(11712),z=H(11697),P=H(11868),M=H(11660);P.ThinEngine.prototype.createDynamicTexture=function(e,E,H,N){const u=new M.e(this,4);return u.baseWidth=e,u.baseHeight=E,H&&(e=this.needPOTTextures?(0,z.g)(e,this._caps.maxTextureSize):e,E=this.needPOTTextures?(0,z.g)(E,this._caps.maxTextureSize):E),u.width=e,u.height=E,u.isReady=!1,u.generateMipMaps=H,u.samplingMode=N,this.updateTextureSamplingMode(N,u),this._internalTexturesCache.push(u),u},P.ThinEngine.prototype.updateDynamicTexture=function(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!e)return;const P=this._gl,M=P.TEXTURE_2D,D=this._bindTextureDirectly(M,e,!0,z);this._unpackFlipY(void 0===H?e.invertY:H),N&&P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const A=this._getWebGLTextureType(e.type),C=this._getInternalFormat(u||e.format),i=this._getRGBABufferInternalSizedFormat(e.type,C);P.texImage2D(M,0,i,C,A,E),e.generateMipMaps&&P.generateMipmap(M),D||this._bindTextureDirectly(M,null),N&&P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),u&&(e.format=u),e._dynamicTextureSource=E,e._premulAlpha=N,e.invertY=H||!1,e.isReady=!0};class D extends u.b{constructor(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,M=arguments.length>6?arguments[6]:void 0;const D=!H||H._isScene;super(null,D?H:null===H||void 0===H?void 0:H.hE,D?!N:H,M,z,void 0,void 0,void 0,void 0,P),this.name=e,this.wrapU=u.b.CLAMP_ADDRESSMODE,this.wrapV=u.b.CLAMP_ADDRESSMODE,this._generateMipMaps=N;const A=this._getEngine();if(!A)return;if(E.getContext)this._canvas=E,this._ownCanvas=!1,this._texture=A.createDynamicTexture(this._canvas.width,this._canvas.height,N,z);else{this._canvas=A.createCanvas(1,1),this._ownCanvas=!0;const e=E;e.width||0===e.width?this._texture=A.createDynamicTexture(e.width,e.height,N,z):this._texture=A.createDynamicTexture(E,E,N,z)}const C=this.getSize();this._canvas.width!==C.width&&(this._canvas.width=C.width),this._canvas.height!==C.height&&(this._canvas.height=C.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}scale(e){const E=this.getSize();E.width*=e,E.height*=e,this._recreate(E)}scaleTo(e,E){const H=this.getSize();H.width=e,H.height=E,this._recreate(H)}getContext(){return this._context}clear(e){const E=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,E.width,E.height)}update(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,E,this._format||void 0,void 0,H)}drawText(e,E,H,N,u,z,P){let M=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const D=this.getSize();if(z&&(this._context.fillStyle=z,this._context.fillRect(0,0,D.width,D.height)),this._context.font=N,null===E||void 0===E){const H=this._context.measureText(e);E=(D.width-H.width)/2}if(null===H||void 0===H){const e=parseInt(N.replace(/\D/g,""));H=D.height/2+e/3.65}this._context.fillStyle=u||"",this._context.fillText(e,E,H),M&&this.update(P)}dispose(){var e,E;(super.dispose(),this._ownCanvas)&&(null===(e=this._canvas)||void 0===e||null===(E=e.remove)||void 0===E||E.call(e));this._canvas=null,this._context=null}clone(){const e=this.fe();if(!e)return this;const E=this.getSize(),H=new D(this.name,E,e,this._generateMipMaps);return H.zM=this.zM,H.level=this.level,H.wrapU=this.wrapU,H.wrapV=this.wrapV,H}serialize(){const e=this.fe();e&&!e.isReady()&&N.d.Warn("The scene must be ready before serializing the dynamic texture");const E=super.serialize();return D._IsCanvasElement(this._canvas)&&(E.base64String=this._canvas.toDataURL()),E.invertY=this._invertY,E.samplingMode=this.samplingMode,E}static _IsCanvasElement(e){return void 0!==e.toDataURL}_rebuild(){this.update()}}},13285:(e,E,H)=>{"use strict";H.d(E,{d:()=>u});var N=H(11712);class u extends N.b{get depth(){return this._depth}constructor(e,E,H,u,z,P){let M=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:N.b.TRILINEAR_SAMPLINGMODE,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10?arguments[10]:void 0;super(null,P,!M,D),this.format=z,this._texture=P.getEngine().createRawTexture2DArray(e,E,H,u,z,M,D,A,null,C,i),this._depth=u,this.is2DArray=!0}update(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(e,E,H,N,z){return new u(e,E,H,N,5,z,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13117:(e,E,H)=>{"use strict";H.d(E,{d:()=>M,e:()=>D,f:()=>z,j:()=>P});var N=H(11756),u=H(11738);function z(e,E){return`{X: ${e.x.toFixed(E)} Y: ${e.y.toFixed(E)}}`}function P(e,E){return`{X: ${e._x.toFixed(E)} Y: ${e._y.toFixed(E)} Z: ${e._z.toFixed(E)}}`}function M(e,E){return 2*Math.acos((0,N.Clamp)(u.Quaternion.Dot(e,E)))}function D(e,E){const H=new u.Quaternion;return function(e,E,H){const z=u.jE.Cross(e,E),P=Math.acos((0,N.Clamp)(u.jE.Dot(e,E),-1,1));u.Quaternion.RotationAxisToRef(z,P,H)}(e,E,H),H}},12944:(e,E,H)=>{"use strict";H.d(E,{c:()=>A});var N=H(11738),u=H(11789),z=H(12165),P=H(12147),M=H(11800);H(12947);function D(e){let E=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const H=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],z=[];let D=[];const A=e.width||e.size||1,C=e.height||e.size||1,i=e.depth||e.size||1,V=e.wrap||!1;let U=void 0===e.topBaseAt?1:e.topBaseAt,j=void 0===e.bottomBaseAt?0:e.bottomBaseAt;U=(U+4)%4,j=(j+4)%4;let F=[2,0,3,1][U],h=[2,0,1,3][j],S=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(V){E=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],S=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],H=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const N=[17,18,19,16],u=[22,23,20,21];for(;F>0;)e.unshift(e.pop()),N.unshift(N.pop()),F--;for(;h>0;)H.unshift(H.pop()),u.unshift(u.pop()),h--;e=e.flat(),H=H.flat(),S=S.concat(e).concat(H),E.push(N[0],N[2],N[3],N[0],N[1],N[2]),E.push(u[0],u[2],u[3],u[0],u[1],u[2])}const X=[A/2,C/2,i/2];D=S.reduce(((e,E,H)=>e.concat(E*X[H%3])),[]);const a=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,W=e.faceUV||new Array(6),r=e.faceColors,Y=[];for(let P=0;P<6;P++)void 0===W[P]&&(W[P]=new N.Vector4(0,0,1,1)),r&&void 0===r[P]&&(r[P]=new u.FM(1,1,1,1));for(let N=0;N<6;N++)if(z.push(W[N].z,M.c?1-W[N].w:W[N].w),z.push(W[N].x,M.c?1-W[N].w:W[N].w),z.push(W[N].x,M.c?1-W[N].y:W[N].y),z.push(W[N].z,M.c?1-W[N].y:W[N].y),r)for(let e=0;e<4;e++)Y.push(r[N].r,r[N].g,r[N].b,r[N].a);P.d._ComputeSides(a,D,E,H,z,e.frontUVs,e.backUVs);const f=new P.d;if(f.indices=E,f.se=D,f.pe=H,f.ye=z,r){const e=a===P.d.DOUBLESIDE?Y.concat(Y):Y;f.oe=e}return f}function A(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new z.c(e,H);E.sideOrientation=z.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return D(E).Ke(N,E.updatable),N}P.d.CreateBox=D,z.c.CreateBox=function(e,E){return A(e,{size:E,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13106:(e,E,H)=>{"use strict";H.d(E,{d:()=>M});var N=H(12165),u=H(12147),z=H(11800);function P(e){const E=[],H=[],N=[],P=[],M=e.radius||.5,D=e.tessellation||64,A=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,C=0===e.sideOrientation?0:e.sideOrientation||u.d.DEFAULTSIDE;E.push(0,0,0),P.push(.5,.5);const i=2*Math.PI*A,V=1===A?i/D:i/(D-1);let U=0;for(let u=0;u<D;u++){const e=Math.cos(U),H=Math.sin(U),N=(e+1)/2,u=(1-H)/2;E.push(M*e,M*H,0),P.push(N,z.c?1-u:u),U+=V}1===A&&(E.push(E[3],E[4],E[5]),P.push(P[2],z.c?1-P[3]:P[3]));const j=E.length/3;for(let u=1;u<j-1;u++)H.push(u+1,0,u);u.d.ComputeNormals(E,H,N),u.d._ComputeSides(C,E,H,N,P,e.frontUVs,e.backUVs);const F=new u.d;return F.indices=H,F.se=E,F.pe=N,F.ye=P,F}function M(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new N.c(e,H);E.sideOrientation=N.c._GetDefaultSideOrientation(E.sideOrientation),u._originalBuilderSideOrientation=E.sideOrientation;return P(E).Ke(u,E.updatable),u}u.d.CreateDisc=P,N.c.CreateDisc=function(e,E,H){return M(e,{radius:E,tessellation:H,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12947:(e,E,H)=>{"use strict";H.d(E,{e:()=>h,b:()=>X,f:()=>S});var N=H(11738),u=H(11789),z=H(12165),P=H(12147),M=H(11818);z.c._GroundMeshParser=(e,E)=>D.Parse(e,E);class D extends z.c{constructor(e,E){super(e,E),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const H=this;H.createOrUpdateSubmeshesOctree&&H.createOrUpdateSubmeshesOctree(E)}getHeightAtCoordinates(e,E){const H=this.getWorldMatrix(),u=N.TmpVectors.Matrix[5];H.invertToRef(u);const z=N.TmpVectors.jE[8];if(N.jE.TransformCoordinatesFromFloatsToRef(e,0,E,u,z),e=z.x,E=z.z,e<this._minX||e>=this._maxX||E<=this._minZ||E>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const P=this._getFacetAt(e,E),M=-(P.x*e+P.z*E+P.w)/P.y;return N.jE.TransformCoordinatesFromFloatsToRef(0,M,0,H,z),z.y}getNormalAtCoordinates(e,E){const H=new N.jE(0,1,0);return this.getNormalAtCoordinatesToRef(e,E,H),H}getNormalAtCoordinatesToRef(e,E,H){const u=this.getWorldMatrix(),z=N.TmpVectors.Matrix[5];u.invertToRef(z);const P=N.TmpVectors.jE[8];if(N.jE.TransformCoordinatesFromFloatsToRef(e,0,E,z,P),e=P.x,E=P.z,e<this._minX||e>this._maxX||E<this._minZ||E>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const M=this._getFacetAt(e,E);return N.jE.TransformNormalFromFloatsToRef(M.x,M.y,M.z,u,H),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,E){const H=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),N=Math.floor(-(E+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),u=this._heightQuads[N*this._subdivisionsX+H];let z;return z=E<u.slope.x*e+u.slope.y?u.facet1:u.facet2,z}_initHeightQuads(){const e=this._subdivisionsX,E=this._subdivisionsY;this._heightQuads=[];for(let H=0;H<E;H++)for(let E=0;E<e;E++){const u={slope:N.Vector2.Zero(),facet1:new N.Vector4(0,0,0,0),facet2:new N.Vector4(0,0,0,0)};this._heightQuads[H*e+E]=u}return this}_computeHeightQuads(){const e=this.getVerticesData(M.g.PositionKind);if(!e)return this;const E=N.TmpVectors.jE[3],H=N.TmpVectors.jE[2],u=N.TmpVectors.jE[1],z=N.TmpVectors.jE[0],P=N.TmpVectors.jE[4],D=N.TmpVectors.jE[5],A=N.TmpVectors.jE[6],C=N.TmpVectors.jE[7],i=N.TmpVectors.jE[8];let V=0,U=0,j=0,F=0,h=0,S=0,X=0;const a=this._subdivisionsX,W=this._subdivisionsY;for(let M=0;M<W;M++)for(let W=0;W<a;W++){V=3*W,U=M*(a+1)*3,j=(M+1)*(a+1)*3,E.x=e[U+V],E.y=e[U+V+1],E.z=e[U+V+2],H.x=e[U+V+3],H.y=e[U+V+4],H.z=e[U+V+5],u.x=e[j+V],u.y=e[j+V+1],u.z=e[j+V+2],z.x=e[j+V+3],z.y=e[j+V+4],z.z=e[j+V+5],F=(z.z-E.z)/(z.x-E.x),h=E.z-F*E.x,H.subtractToRef(E,P),u.subtractToRef(E,D),z.subtractToRef(E,A),N.jE.CrossToRef(A,D,C),N.jE.CrossToRef(P,A,i),C.normalize(),i.normalize(),S=-(C.x*E.x+C.y*E.y+C.z*E.z),X=-(i.x*H.x+i.y*H.y+i.z*H.z);const r=this._heightQuads[M*a+W];r.slope.VM(F,h),r.facet1.VM(C.x,C.y,C.z,S),r.facet2.VM(i.x,i.y,i.z,X)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.PM=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,E){const H=new D(e.name,E);return H._subdivisionsX=e.subdivisionsX||1,H._subdivisionsY=e.subdivisionsY||1,H._minX=e.minX,H._maxX=e.maxX,H._minZ=e.PM,H._maxZ=e.maxZ,H._width=e.width,H._height=e.height,H}}var A=H(11532),C=H(11579),i=H(11746),V=H(11800);function U(e){const E=[],H=[],u=[],z=[];let M,D;const A=e.width||e.size||1,C=e.height||e.size||1,i=0|(e.subdivisionsX||e.subdivisions||1),U=0|(e.subdivisionsY||e.subdivisions||1);for(M=0;M<=U;M++)for(D=0;D<=i;D++){const e=new N.jE(D*A/i-A/2,0,(U-M)*C/U-C/2),E=new N.jE(0,1,0);H.push(e.x,e.y,e.z),u.push(E.x,E.y,E.z),z.push(D/i,V.c?M/U:1-M/U)}for(M=0;M<U;M++)for(D=0;D<i;D++)E.push(D+1+(M+1)*(i+1)),E.push(D+1+M*(i+1)),E.push(D+M*(i+1)),E.push(D+(M+1)*(i+1)),E.push(D+1+(M+1)*(i+1)),E.push(D+M*(i+1));const j=new P.d;return j.indices=E,j.se=H,j.pe=u,j.ye=z,j}function j(e){const E=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,H=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,u=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,z=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,M=e.subdivisions||{w:1,h:1},D=e.precision||{w:1,h:1},A=[],C=[],i=[],V=[];let U,j,F,h;M.h=M.h<1?1:M.h,M.w=M.w<1?1:M.w,D.w=D.w<1?1:D.w,D.h=D.h<1?1:D.h;const S=(u-E)/M.w,X=(z-H)/M.h;function a(e,E,H,u){const z=C.length/3,P=D.w+1;for(U=0;U<D.h;U++)for(j=0;j<D.w;j++){const e=[z+j+U*P,z+(j+1)+U*P,z+(j+1)+(U+1)*P,z+j+(U+1)*P];A.push(e[1]),A.push(e[2]),A.push(e[3]),A.push(e[0]),A.push(e[1]),A.push(e[3])}const M=N.jE.Zero(),F=new N.jE(0,1,0);for(U=0;U<=D.h;U++)for(M.z=U*(u-E)/D.h+E,j=0;j<=D.w;j++)M.x=j*(H-e)/D.w+e,M.y=0,C.push(M.x,M.y,M.z),i.push(F.x,F.y,F.z),V.push(j/D.w,U/D.h)}for(F=0;F<M.h;F++)for(h=0;h<M.w;h++)a(E+h*S,H+F*X,E+(h+1)*S,H+(F+1)*X);const W=new P.d;return W.indices=A,W.se=C,W.pe=i,W.ye=V,W}function F(e){const E=[],H=[],z=[],M=[];let D,A;const C=e.colorFilter||new u.XE(.3,.59,.11),V=e.alphaFilter||0;let U=!1;if(e.minHeight>e.maxHeight){U=!0;const E=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=E}for(D=0;D<=e.subdivisions;D++)for(A=0;A<=e.subdivisions;A++){const E=new N.jE(A*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-D)*e.height/e.subdivisions-e.height/2),u=4*(((E.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(E.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let P=e.buffer[u]/255,j=e.buffer[u+1]/255,F=e.buffer[u+2]/255;const h=e.buffer[u+3]/255;U&&(P=1-P,j=1-j,F=1-F);const S=P*C.r+j*C.g+F*C.b;E.y=h>=V?e.minHeight+(e.maxHeight-e.minHeight)*S:e.minHeight-i.d,e.heightBuffer&&(e.heightBuffer[D*(e.subdivisions+1)+A]=E.y),H.push(E.x,E.y,E.z),z.push(0,0,0),M.push(A/e.subdivisions,1-D/e.subdivisions)}for(D=0;D<e.subdivisions;D++)for(A=0;A<e.subdivisions;A++){const N=A+1+(D+1)*(e.subdivisions+1),u=A+1+D*(e.subdivisions+1),z=A+D*(e.subdivisions+1),P=A+(D+1)*(e.subdivisions+1),M=H[3*N+1]>=e.minHeight,C=H[3*u+1]>=e.minHeight,i=H[3*z+1]>=e.minHeight;M&&C&&i&&(E.push(N),E.push(u),E.push(z));H[3*P+1]>=e.minHeight&&M&&i&&(E.push(P),E.push(N),E.push(z))}P.d.ComputeNormals(H,E,z);const j=new P.d;return j.indices=E,j.se=H,j.pe=z,j.ye=M,j}function h(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=new D(e,arguments.length>2?arguments[2]:void 0);H._setReady(!1),H._subdivisionsX=E.subdivisionsX||E.subdivisions||1,H._subdivisionsY=E.subdivisionsY||E.subdivisions||1,H._width=E.width||1,H._height=E.height||1,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ;return U(E).Ke(H,E.updatable),H._setReady(!0),H}function S(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new z.c(e,H);return j(E).Ke(N,E.updatable),N}function X(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=H.width||10,P=H.height||10,M=H.subdivisions||1,i=H.minHeight||0,V=H.maxHeight||1,U=H.colorFilter||new u.XE(.3,.59,.11),j=H.alphaFilter||0,h=H.updatable,S=H.onReady;N=N||C.d.LastCreatedScene;const X=new D(e,N);let a;X._subdivisionsX=M,X._subdivisionsY=M,X._width=z,X._height=P,X._maxX=X._width/2,X._maxZ=X._height/2,X._minX=-X._maxX,X._minZ=-X._maxZ,X._setReady(!1),H.passHeightBufferInCallback&&(a=new Float32Array((M+1)*(M+1)));const W=(e,E,H)=>{F({width:z,height:P,subdivisions:M,minHeight:i,maxHeight:V,colorFilter:U,buffer:e,bufferWidth:E,bufferHeight:H,alphaFilter:j,heightBuffer:a}).Ke(X,h),S&&S(X,a),X._setReady(!0)};if("string"===typeof E){const e=e=>{var E;const H=e.width,u=e.height;if(N.A)return;const z=null===(E=N)||void 0===E?void 0:E.getEngine().resizeImageBitmap(e,H,u);W(z,H,u)};A.Tools.LoadImage(E,e,H.onError?H.onError:()=>{},N.offlineProvider)}else W(E.data,E.width,E.height);return X}P.d.CreateGround=U,P.d.CreateTiledGround=j,P.d.CreateGroundFromHeightMap=F,z.c.CreateGround=(e,E,H,N,u,z)=>h(e,{width:E,height:H,subdivisions:N,updatable:z},u),z.c.CreateTiledGround=(e,E,H,N,u,z,P,M,D)=>S(e,{xmin:E,zmin:H,xmax:N,zmax:u,subdivisions:z,precision:P,updatable:D},M),z.c.CreateGroundFromHeightMap=(e,E,H,N,u,z,P,M,D,A,C)=>X(e,E,{width:H,height:N,subdivisions:u,minHeight:z,maxHeight:P,updatable:D,onReady:A,alphaFilter:C},M)},13603:(e,E,H)=>{"use strict";H.d(E,{e:()=>U,h:()=>i,i:()=>V});var N=H(11738),u=H(12165),z=H(12147),P=H(12265),M=H(11818),D=H(11548);function A(e){const E=[],H=[],N=e.lines,u=e.oe,P=[];let M=0;for(let z=0;z<N.length;z++){const e=N[z];for(let N=0;N<e.length;N++){const{x:D,y:A,z:C}=e[N];if(H.push(D,A,C),u){const e=u[z],{r:E,g:H,b:M,a:D}=e[N];P.push(E,H,M,D)}N>0&&(E.push(M-1),E.push(M)),M++}}const D=new z.d;return D.indices=E,D.se=H,u&&(D.oe=P),D}function C(e){const E=e.dashSize||3,H=e.gapSize||1,u=e.dashNb||200,P=e.points,M=[],D=[],A=N.jE.Zero();let C=0,i=0,V=0,U=0,j=0,F=0,h=0;for(h=0;h<P.length-1;h++)P[h+1].subtractToRef(P[h],A),C+=A.length();for(V=C/u,U=E*V/(E+H),h=0;h<P.length-1;h++){P[h+1].subtractToRef(P[h],A),i=Math.floor(A.length()/V),A.normalize();for(let e=0;e<i;e++)j=V*e,M.push(P[h].x+j*A.x,P[h].y+j*A.y,P[h].z+j*A.z),M.push(P[h].x+(j+U)*A.x,P[h].y+(j+U)*A.y,P[h].z+(j+U)*A.z),D.push(F,F+1),F+=2}const S=new z.d;return S.se=M,S.indices=D,S}function i(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=E.instance,u=E.lines,z=E.oe;if(N){const e=N.getVerticesData(M.g.PositionKind);let E,H;z&&(E=N.getVerticesData(M.g.ColorKind));let P=0,D=0;for(let N=0;N<u.length;N++){const M=u[N];for(let u=0;u<M.length;u++)e[P]=M[u].x,e[P+1]=M[u].y,e[P+2]=M[u].z,z&&E&&(H=z[N],E[D]=H[u].r,E[D+1]=H[u].g,E[D+2]=H[u].b,E[D+3]=H[u].a,D+=4),P+=3}return N.updateVerticesData(M.g.PositionKind,e,!1,!1),z&&E&&N.updateVerticesData(M.g.ColorKind,E,!1,!1),N.refreshBoundingInfo(),N}const D=!!z,C=new P.d(e,H,null,void 0,void 0,D,E.useVertexAlpha,E.material);return A(E).Ke(C,E.updatable),C}function V(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=E.oe?[E.oe]:null;return i(e,{lines:[E.points],updatable:E.updatable,instance:E.instance,oe:N,useVertexAlpha:E.useVertexAlpha,material:E.material},H)}function U(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.points,M=E.instance,A=E.gapSize||1,i=E.dashSize||3;if(M){const e=e=>{const E=N.jE.Zero(),H=e.length/6;let u=0,P=0,D=0,A=0,C=0,i=0,V=0,U=0;for(V=0;V<z.length-1;V++)z[V+1].subtractToRef(z[V],E),u+=E.length();D=u/H;const j=M._creationDataStorage.dashSize;for(A=j*D/(j+M._creationDataStorage.gapSize),V=0;V<z.length-1;V++)for(z[V+1].subtractToRef(z[V],E),P=Math.floor(E.length()/D),E.normalize(),U=0;U<P&&i<e.length;)C=D*U,e[i]=z[V].x+C*E.x,e[i+1]=z[V].y+C*E.y,e[i+2]=z[V].z+C*E.z,e[i+3]=z[V].x+(C+A)*E.x,e[i+4]=z[V].y+(C+A)*E.y,e[i+5]=z[V].z+(C+A)*E.z,i+=6,U++;for(;i<e.length;)e[i]=z[V].x,e[i+1]=z[V].y,e[i+2]=z[V].z,i+=3};return(E.dashNb||E.dashSize||E.gapSize||E.useVertexAlpha||E.material)&&D.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),M.updateMeshPositions(e,!1),M}const V=new P.d(e,H,null,void 0,void 0,void 0,E.useVertexAlpha,E.material);return C(E).Ke(V,E.updatable),V._creationDataStorage=new u.d,V._creationDataStorage.dashSize=i,V._creationDataStorage.gapSize=A,V}z.d.CreateLineSystem=A,z.d.CreateDashedLines=C,u.c.AA=function(e,E){return V(e,{points:E,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},u.c.CreateDashedLines=function(e,E,H,N,u){return U(e,{points:E,dashSize:H,gapSize:N,dashNb:u,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13004:(e,E,H)=>{"use strict";H.d(E,{c:()=>M,e:()=>D});var N=H(12165),u=H(12147),z=H(11800);function P(e){const E=[],H=[],N=[],P=[],M=void 0!==e.width?e.width:void 0!==e.size?e.size:1,D=void 0!==e.height?e.height:void 0!==e.size?e.size:1,A=0===e.sideOrientation?0:e.sideOrientation||u.d.DEFAULTSIDE,C=M/2,i=D/2;H.push(-C,-i,0),N.push(0,0,-1),P.push(0,z.c?1:0),H.push(C,-i,0),N.push(0,0,-1),P.push(1,z.c?1:0),H.push(C,i,0),N.push(0,0,-1),P.push(1,z.c?0:1),H.push(-C,i,0),N.push(0,0,-1),P.push(0,z.c?0:1),E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),u.d._ComputeSides(A,H,E,N,P,e.frontUVs,e.backUVs);const V=new u.d;return V.indices=E,V.se=H,V.pe=N,V.ye=P,V}function M(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new N.c(e,H);E.sideOrientation=N.c._GetDefaultSideOrientation(E.sideOrientation),u._originalBuilderSideOrientation=E.sideOrientation;return P(E).Ke(u,E.updatable),E.sourcePlane&&(u.translate(E.sourcePlane.normal,-E.sourcePlane.d),u.setDirection(E.sourcePlane.normal.scale(-1))),u}const D={VA:M};u.d.VA=P,N.c.VA=(e,E,H,N,u)=>M(e,{size:E,width:E,height:E,sideOrientation:u,updatable:N},H)},13097:(e,E,H)=>{"use strict";H.d(E,{e:()=>D});var N=H(11738),u=H(12165),z=H(12147),P=H(11800);function M(e){const E=0|(e.segments||32),H=e.diameterX||e.diameter||1,u=e.diameterY||e.diameter||1,M=e.diameterZ||e.diameter||1,D=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,A=e.slice&&e.slice<=0?1:e.slice||1,C=0===e.sideOrientation?0:e.sideOrientation||z.d.DEFAULTSIDE,i=!!e.dedupTopBottomIndices,V=new N.jE(H/2,u/2,M/2),U=2+E,j=2*U,F=[],h=[],S=[],X=[];for(let z=0;z<=U;z++){const e=z/U,E=e*Math.PI*A;for(let H=0;H<=j;H++){const u=H/j,z=u*Math.PI*2*D,M=N.Matrix.RotationZ(-E),A=N.Matrix.RotationY(z),C=N.jE.TransformCoordinates(N.jE.Up(),M),i=N.jE.TransformCoordinates(C,A),U=i.multiply(V),F=i.divide(V).normalize();h.push(U.x,U.y,U.z),S.push(F.x,F.y,F.z),X.push(u,P.c?1-e:e)}if(z>0){const e=h.length/3;for(let E=e-2*(j+1);E+j+2<e;E++)i?(z>1&&(F.push(E),F.push(E+1),F.push(E+j+1)),(z<U||A<1)&&(F.push(E+j+1),F.push(E+1),F.push(E+j+2))):(F.push(E),F.push(E+1),F.push(E+j+1),F.push(E+j+1),F.push(E+1),F.push(E+j+2))}}z.d._ComputeSides(C,h,F,S,X,e.frontUVs,e.backUVs);const a=new z.d;return a.indices=F,a.se=h,a.pe=S,a.ye=X,a}function D(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return M(E).Ke(N,E.updatable),N}z.d.CreateSphere=M,u.c.CreateSphere=(e,E,H,N,u,z)=>D(e,{segments:E,diameterX:H,diameterY:H,diameterZ:H,sideOrientation:z,updatable:u},N)},13907:(e,E,H)=>{"use strict";H.d(E,{e:()=>M});var N=H(12292),u=H(13383),z=H(12313),P=H(12147);class M{static get Configuration(){return{get decoder(){return u.d.DefaultConfiguration},set decoder(e){u.d.DefaultConfiguration=e}}}static set Configuration(e){u.d.DefaultConfiguration=e.decoder}static get DecoderAvailable(){return(0,N.k)(u.d.DefaultConfiguration)}static get Default(){return M._Default??(M._Default=new M),M._Default}static ResetDefault(e){M._Default&&(e||M._Default.dispose(),M._Default=null)}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.DefaultNumWorkers;const E="number"===typeof e?{...u.d.DefaultConfiguration,numWorkers:e}:{...u.d.DefaultConfiguration,...e};this._decoder=new u.d(E)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(e,E,H){return this._decoder.decodeMeshToMeshDataAsync(e,E,H)}async decodeMeshToGeometryAsync(e,E,H,N){return await this._decoder.decodeMeshToGeometryAsync(e,E,H,N)}async _decodeMeshToGeometryForGltfAsync(e,E,H,N,u,z){return await this._decoder._decodeMeshToGeometryForGltfAsync(e,E,H,N,u,z)}async decodeMeshAsync(e,E){const H=await this._decoder.decodeMeshToMeshDataAsync(e,E),N=new P.d;H.indices&&(N.indices=H.indices);for(const u of H.attributes){const e=z.c.GetFloatData(u.data,u.size,z.c.GetDataType(u.data),u.byteOffset,u.byteStride,u.normalized,H.totalVertices);N.set(e,u.kind)}return N}}M.DefaultNumWorkers=(0,N.i)(),M._Default=null},13383:(e,E,H)=>{"use strict";H.d(E,{d:()=>A});var N=H(12292),u=H(11532),z=H(12176),P=H(12313),M=H(11548),D=H(12307);class A extends N.e{static get DefaultAvailable(){return(0,N.k)(A.DefaultConfiguration)}static get Default(){return A._Default??(A._Default=new A),A._Default}static ResetDefault(e){A._Default&&(e||A._Default.dispose(),A._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(e,E){return{module:await(E||DracoDecoderModule)({wasmBinary:e})}}_getWorkerContent(){return`${D.d}(${D.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.DefaultConfiguration)}decodeMeshToMeshDataAsync(e,E,H){const N=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e.buffer,e.byteOffset,e.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async e=>await new Promise(((u,z)=>{e.push(((e,P)=>{let D=null;const A=[],C=E=>{e.removeEventListener("error",C),e.removeEventListener("message",i),z(E),P()},i=E=>{const N=E.data;switch(N.id){case"indices":D=N.data;break;case"attribute":A.push({kind:N.kind,data:N.data,size:N.size,byteOffset:N.byteOffset,byteStride:N.byteStride,normalized:(z=N.kind,V=N.normalized,H&&void 0!==H[z]?(V!==H[z]&&M.d.Warn(`Normalized flag from Draco data (${V}) does not match normalized flag from glTF accessor (${H[z]}). Using flag from glTF accessor.`),H[z]):V)});break;case"decodeMeshDone":e.removeEventListener("error",C),e.removeEventListener("message",i),u({indices:D,attributes:A,totalVertices:N.totalVertices}),P()}var z,V};e.addEventListener("error",C),e.addEventListener("message",i);const V=N.slice();e.postMessage({id:"decodeMesh",dataView:V,attributes:E},[V.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((e=>{let H=null;const u=[],z=(0,D.d)(e.module,N,E,(e=>{H=e}),((e,E,H,N,z,P)=>{u.push({kind:e,data:E,size:H,byteOffset:N,byteStride:z,normalized:P})}));return{indices:H,attributes:u,totalVertices:z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(e,E,H,N){const u=await this.decodeMeshToMeshDataAsync(H,N),M=new z.e(e,E);u.indices&&M.setIndices(u.indices);for(const z of u.attributes)M.setVerticesBuffer(new P.c(E.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),u.totalVertices);return M}async _decodeMeshToGeometryForGltfAsync(e,E,H,N,u,M){const D=await this.decodeMeshToMeshDataAsync(H,N,u),A=new z.e(e,E);M&&(A._boundingInfo=M,A.useBoundingInfoFromGeometry=!0),D.indices&&A.setIndices(D.indices);for(const z of D.attributes)A.setVerticesBuffer(new P.c(E.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),D.totalVertices);return A}}A.DefaultConfiguration={wasmUrl:`${u.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${u.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${u.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},A._Default=null},13598:(e,E,H)=>{"use strict";H.d(E,{d:()=>Me});var N=H(11738),u=H(12165),z=H(11818),P=H(12147),M=H(11800);function D(e){let E=e.pathArray;const H=e.closeArray||!1,N=e.closePath||!1,u=e.invertUV||!1,D=Math.floor(E[0].length/2);let A=e.offset||D;A=A>D?D:Math.floor(A);const C=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,i=e.ye,V=e.oe,U=[],j=[],F=[],h=[],S=[],X=[],a=[],W=[];let r;const Y=[],f=[];let w,s,p;if(E.length<2){const e=[],H=[];for(s=0;s<E[0].length-A;s++)e.push(E[0][s]),H.push(E[0][s+A]);E=[e,H]}let o=0;const y=N?1:0,b=H?1:0;let K,l,O,v,R,T;for(r=E[0].length,w=0;w<E.length+b;w++){for(a[w]=0,S[w]=[0],K=w===E.length?E[0]:E[w],l=K.length,r=r<l?r:l,p=0;p<l;)U.push(K[p].x,K[p].y,K[p].z),p>0&&(O=K[p].FE(K[p-1]).length(),v=O+a[w],S[w].push(v),a[w]=v),p++;N&&(p--,U.push(K[0].x,K[0].y,K[0].z),O=K[p].FE(K[0]).length(),v=O+a[w],S[w].push(v),a[w]=v),Y[w]=l+y,f[w]=o,o+=l+y}let L,d,G=null,me=null;for(s=0;s<r+y;s++)for(W[s]=0,X[s]=[0],w=0;w<E.length-1+b;w++)R=E[w],T=w===E.length-1?E[0]:E[w+1],s===r?(G=R[0],me=T[0]):(G=R[s],me=T[s]),O=me.FE(G).length(),v=O+W[s],X[s].push(v),W[s]=v;if(i)for(w=0;w<i.length;w++)h.push(i[w].x,M.c?1-i[w].y:i[w].y);else for(w=0;w<E.length+b;w++)for(s=0;s<r+y;s++)L=0!=a[w]?S[w][s]/a[w]:0,d=0!=W[s]?X[s][w]/W[s]:0,u?h.push(d,L):h.push(L,M.c?1-d:d);w=0;let Q=0,Z=Y[w]-1,k=Y[w+1]-1,J=Z<k?Z:k,B=f[1]-f[0];const I=Y.length-1;for(;Q<=J&&w<I;)j.push(Q,Q+B,Q+1),j.push(Q+B+1,Q+1,Q+B),Q+=1,Q===J&&(w++,B=f[w+1]-f[w],Z=Y[w]-1,k=Y[w+1]-1,Q=f[w],J=Z<k?Z+Q:k+Q);if(P.d.ComputeNormals(U,j,F),N){let e=0,H=0;for(w=0;w<E.length;w++){e=3*f[w],H=w+1<E.length?3*(f[w+1]-1):F.length-3,F[e]=.5*(F[e]+F[H]),F[e+1]=.5*(F[e+1]+F[H+1]),F[e+2]=.5*(F[e+2]+F[H+2]);const N=Math.sqrt(F[e]*F[e]+F[e+1]*F[e+1]+F[e+2]*F[e+2]);F[e]/=N,F[e+1]/=N,F[e+2]/=N,F[H]=F[e],F[H+1]=F[e+1],F[H+2]=F[e+2]}}if(H){let e=3*f[0],H=3*f[E.length];for(s=0;s<r+y;s++){F[e]=.5*(F[e]+F[H]),F[e+1]=.5*(F[e+1]+F[H+1]),F[e+2]=.5*(F[e+2]+F[H+2]);const E=Math.sqrt(F[e]*F[e]+F[e+1]*F[e+1]+F[e+2]*F[e+2]);F[e]/=E,F[e+1]/=E,F[e+2]/=E,F[H]=F[e],F[H+1]=F[e+1],F[H+2]=F[e+2],e+=3,H+=3}}P.d._ComputeSides(C,U,j,F,h,e.frontUVs,e.backUVs);let t=null;if(V){t=new Float32Array(4*V.length);for(let e=0;e<V.length;e++)t[4*e]=V[e].r,t[4*e+1]=V[e].g,t[4*e+2]=V[e].b,t[4*e+3]=V[e].a}const q=new P.d,c=new Float32Array(U),n=new Float32Array(F),g=new Float32Array(h);return q.indices=j,q.se=c,q.pe=n,q.ye=g,t&&q.set(t,z.g.ColorKind),N&&(q._idx=f),q}function A(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=E.pathArray,C=E.closeArray,i=E.closePath,V=u.c._GetDefaultSideOrientation(E.sideOrientation),U=E.instance,j=E.updatable;if(U){const e=N.TmpVectors.jE[0].jM(Number.MAX_VALUE),H=N.TmpVectors.jE[1].jM(-Number.MAX_VALUE),D=E=>{let N=A[0].length;const z=U;let P=0;const M=z._originalBuilderSideOrientation===u.c.DOUBLESIDE?2:1;for(let u=1;u<=M;++u)for(let M=0;M<A.length;++M){const u=A[M],D=u.length;N=N<D?N:D;for(let z=0;z<N;++z){const N=u[z];E[P]=N.x,E[P+1]=N.y,E[P+2]=N.z,e.minimizeInPlaceFromFloats(N.x,N.y,N.z),H.maximizeInPlaceFromFloats(N.x,N.y,N.z),P+=3}if(z._creationDataStorage&&z._creationDataStorage.closePath){const e=u[0];E[P]=e.x,E[P+1]=e.y,E[P+2]=e.z,P+=3}}},C=U.getVerticesData(z.g.PositionKind);if(D(C),U.hasBoundingInfo?U.getBoundingInfo().reConstruct(e,H,U._worldMatrix):U.buildBoundingInfo(e,H,U._worldMatrix),U.updateVerticesData(z.g.PositionKind,C,!1,!1),E.oe){const e=U.getVerticesData(z.g.ColorKind);for(let H=0,N=0;H<E.oe.length;H++,N+=4){const u=E.oe[H];e[N]=u.r,e[N+1]=u.g,e[N+2]=u.b,e[N+3]=u.a}U.updateVerticesData(z.g.ColorKind,e,!1,!1)}if(E.ye){const e=U.getVerticesData(z.g.UVKind);for(let H=0;H<E.ye.length;H++)e[2*H]=E.ye[H].x,e[2*H+1]=M.c?1-E.ye[H].y:E.ye[H].y;U.updateVerticesData(z.g.UVKind,e,!1,!1)}if(!U.areNormalsFrozen||U.isFacetDataEnabled){const e=U.CM(),E=U.getVerticesData(z.g.NormalKind),H=U.isFacetDataEnabled?U.getFacetDataParameters():null;if(P.d.ComputeNormals(C,e,E,H),U._creationDataStorage&&U._creationDataStorage.closePath){let e=0,H=0;for(let N=0;N<A.length;N++)e=3*U._creationDataStorage.idx[N],H=N+1<A.length?3*(U._creationDataStorage.idx[N+1]-1):E.length-3,E[e]=.5*(E[e]+E[H]),E[e+1]=.5*(E[e+1]+E[H+1]),E[e+2]=.5*(E[e+2]+E[H+2]),E[H]=E[e],E[H+1]=E[e+1],E[H+2]=E[e+2]}U.areNormalsFrozen||U.updateVerticesData(z.g.NormalKind,E,!1,!1)}return U}{const N=new u.c(e,H);N._originalBuilderSideOrientation=V,N._creationDataStorage=new u.d;const z=D(E);return i&&(N._creationDataStorage.idx=z._idx),N._creationDataStorage.closePath=i,N._creationDataStorage.closeArray=C,z.Ke(N,j),N}}P.d.CreateRibbon=D,u.c.CreateRibbon=function(e,E){return A(e,{pathArray:E,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var C=H(13106),i=H(12944),V=H(11789);function U(e){const E=e.pattern||u.c.NO_FLIP,H=e.tileWidth||e.tileSize||1,N=e.tileHeight||e.tileSize||1,z=e.alignHorizontal||0,M=e.alignVertical||0,D=e.width||e.size||1,A=Math.floor(D/H);let C=D-A*H;const i=e.height||e.size||1,V=Math.floor(i/N);let U=i-V*N;const j=H*A/2,F=N*V/2;let h=0,S=0,X=0,a=0,W=0,r=0;if(C>0||U>0){switch(X=-j,a=-F,W=j,r=F,z){case u.c.CENTER:C/=2,X-=C,W+=C;break;case u.c.LEFT:W+=C,h=-C/2;break;case u.c.RIGHT:X-=C,h=C/2}switch(M){case u.c.CENTER:U/=2,a-=U,r+=U;break;case u.c.BOTTOM:r+=U,S=-U/2;break;case u.c.TOP:a-=U,S=U/2}}const Y=[],f=[],w=[];w[0]=[0,0,1,0,1,1,0,1],w[1]=[0,0,1,0,1,1,0,1],E!==u.c.ROTATE_TILE&&E!==u.c.ROTATE_ROW||(w[1]=[1,1,0,1,0,0,1,0]),E!==u.c.FLIP_TILE&&E!==u.c.FLIP_ROW||(w[1]=[1,0,0,0,0,1,1,1]),E!==u.c.FLIP_N_ROTATE_TILE&&E!==u.c.FLIP_N_ROTATE_ROW||(w[1]=[0,1,1,1,1,0,0,0]);let s=[];const p=[],o=[];let y=0;for(let P=0;P<V;P++)for(let e=0;e<A;e++)Y.push(e*H-j+h,P*N-F+S,0),Y.push((e+1)*H-j+h,P*N-F+S,0),Y.push((e+1)*H-j+h,(P+1)*N-F+S,0),Y.push(e*H-j+h,(P+1)*N-F+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),s=E===u.c.FLIP_TILE||E===u.c.ROTATE_TILE||E===u.c.FLIP_N_ROTATE_TILE?s.concat(w[(e%2+P%2)%2]):E===u.c.FLIP_ROW||E===u.c.ROTATE_ROW||E===u.c.FLIP_N_ROTATE_ROW?s.concat(w[P%2]):s.concat(w[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),y+=4;if(C>0||U>0){const e=U>0&&(M===u.c.CENTER||M===u.c.TOP),P=U>0&&(M===u.c.CENTER||M===u.c.BOTTOM),D=C>0&&(z===u.c.CENTER||z===u.c.RIGHT),i=C>0&&(z===u.c.CENTER||z===u.c.LEFT);let w,b,K,l,O=[];if(e&&D&&(Y.push(X+h,a+S,0),Y.push(-j+h,a+S,0),Y.push(-j+h,a+U+S,0),Y.push(X+h,a+U+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,w=1-C/H,b=1-U/N,K=1,l=1,O=[w,b,K,b,K,l,w,l],E===u.c.ROTATE_ROW&&(O=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),E===u.c.FLIP_ROW&&(O=[1-w,b,1-K,b,1-K,l,1-w,l]),E===u.c.FLIP_N_ROTATE_ROW&&(O=[w,1-b,K,1-b,K,1-l,w,1-l]),s=s.concat(O),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&i&&(Y.push(j+h,a+S,0),Y.push(W+h,a+S,0),Y.push(W+h,a+U+S,0),Y.push(j+h,a+U+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,w=0,b=1-U/N,K=C/H,l=1,O=[w,b,K,b,K,l,w,l],(E===u.c.ROTATE_ROW||E===u.c.ROTATE_TILE&&A%2===0)&&(O=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),(E===u.c.FLIP_ROW||E===u.c.FLIP_TILE&&A%2===0)&&(O=[1-w,b,1-K,b,1-K,l,1-w,l]),(E===u.c.FLIP_N_ROTATE_ROW||E===u.c.FLIP_N_ROTATE_TILE&&A%2===0)&&(O=[w,1-b,K,1-b,K,1-l,w,1-l]),s=s.concat(O),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),P&&D&&(Y.push(X+h,F+S,0),Y.push(-j+h,F+S,0),Y.push(-j+h,r+S,0),Y.push(X+h,r+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,w=1-C/H,b=0,K=1,l=U/N,O=[w,b,K,b,K,l,w,l],(E===u.c.ROTATE_ROW&&V%2===1||E===u.c.ROTATE_TILE&&V%1===0)&&(O=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),(E===u.c.FLIP_ROW&&V%2===1||E===u.c.FLIP_TILE&&V%2===0)&&(O=[1-w,b,1-K,b,1-K,l,1-w,l]),(E===u.c.FLIP_N_ROTATE_ROW&&V%2===1||E===u.c.FLIP_N_ROTATE_TILE&&V%2===0)&&(O=[w,1-b,K,1-b,K,1-l,w,1-l]),s=s.concat(O),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),P&&i&&(Y.push(j+h,F+S,0),Y.push(W+h,F+S,0),Y.push(W+h,r+S,0),Y.push(j+h,r+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,w=0,b=0,K=C/H,l=U/N,O=[w,b,K,b,K,l,w,l],(E===u.c.ROTATE_ROW&&V%2===1||E===u.c.ROTATE_TILE&&(V+A)%2===1)&&(O=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),(E===u.c.FLIP_ROW&&V%2===1||E===u.c.FLIP_TILE&&(V+A)%2===1)&&(O=[1-w,b,1-K,b,1-K,l,1-w,l]),(E===u.c.FLIP_N_ROTATE_ROW&&V%2===1||E===u.c.FLIP_N_ROTATE_TILE&&(V+A)%2===1)&&(O=[w,1-b,K,1-b,K,1-l,w,1-l]),s=s.concat(O),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];w=0,b=1-U/N,K=1,l=1,e[0]=[w,b,K,b,K,l,w,l],e[1]=[w,b,K,b,K,l,w,l],E!==u.c.ROTATE_TILE&&E!==u.c.ROTATE_ROW||(e[1]=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),E!==u.c.FLIP_TILE&&E!==u.c.FLIP_ROW||(e[1]=[1-w,b,1-K,b,1-K,l,1-w,l]),E!==u.c.FLIP_N_ROTATE_TILE&&E!==u.c.FLIP_N_ROTATE_ROW||(e[1]=[w,1-b,K,1-b,K,1-l,w,1-l]);for(let N=0;N<A;N++)Y.push(N*H-j+h,a+S,0),Y.push((N+1)*H-j+h,a+S,0),Y.push((N+1)*H-j+h,a+U+S,0),Y.push(N*H-j+h,a+U+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,s=E===u.c.FLIP_TILE||E===u.c.ROTATE_TILE||E===u.c.FLIP_N_ROTATE_TILE?s.concat(e[(N+1)%2]):E===u.c.FLIP_ROW||E===u.c.ROTATE_ROW||E===u.c.FLIP_N_ROTATE_ROW?s.concat(e[1]):s.concat(e[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const e=[];w=0,b=0,K=1,l=U/N,e[0]=[w,b,K,b,K,l,w,l],e[1]=[w,b,K,b,K,l,w,l],E!==u.c.ROTATE_TILE&&E!==u.c.ROTATE_ROW||(e[1]=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),E!==u.c.FLIP_TILE&&E!==u.c.FLIP_ROW||(e[1]=[1-w,b,1-K,b,1-K,l,1-w,l]),E!==u.c.FLIP_N_ROTATE_TILE&&E!==u.c.FLIP_N_ROTATE_ROW||(e[1]=[w,1-b,K,1-b,K,1-l,w,1-l]);for(let N=0;N<A;N++)Y.push(N*H-j+h,r-U+S,0),Y.push((N+1)*H-j+h,r-U+S,0),Y.push((N+1)*H-j+h,r+S,0),Y.push(N*H-j+h,r+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,s=E===u.c.FLIP_TILE||E===u.c.ROTATE_TILE||E===u.c.FLIP_N_ROTATE_TILE?s.concat(e[(N+V)%2]):E===u.c.FLIP_ROW||E===u.c.ROTATE_ROW||E===u.c.FLIP_N_ROTATE_ROW?s.concat(e[V%2]):s.concat(e[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(D){const e=[];w=1-C/H,b=0,K=1,l=1,e[0]=[w,b,K,b,K,l,w,l],e[1]=[w,b,K,b,K,l,w,l],E!==u.c.ROTATE_TILE&&E!==u.c.ROTATE_ROW||(e[1]=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),E!==u.c.FLIP_TILE&&E!==u.c.FLIP_ROW||(e[1]=[1-w,b,1-K,b,1-K,l,1-w,l]),E!==u.c.FLIP_N_ROTATE_TILE&&E!==u.c.FLIP_N_ROTATE_ROW||(e[1]=[w,1-b,K,1-b,K,1-l,w,1-l]);for(let H=0;H<V;H++)Y.push(X+h,H*N-F+S,0),Y.push(X+C+h,H*N-F+S,0),Y.push(X+C+h,(H+1)*N-F+S,0),Y.push(X+h,(H+1)*N-F+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,s=E===u.c.FLIP_TILE||E===u.c.ROTATE_TILE||E===u.c.FLIP_N_ROTATE_TILE?s.concat(e[(H+1)%2]):E===u.c.FLIP_ROW||E===u.c.ROTATE_ROW||E===u.c.FLIP_N_ROTATE_ROW?s.concat(e[H%2]):s.concat(e[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(i){const e=[];w=0,b=0,K=C/N,l=1,e[0]=[w,b,K,b,K,l,w,l],e[1]=[w,b,K,b,K,l,w,l],E!==u.c.ROTATE_TILE&&E!==u.c.ROTATE_ROW||(e[1]=[1-w,1-b,1-K,1-b,1-K,1-l,1-w,1-l]),E!==u.c.FLIP_TILE&&E!==u.c.FLIP_ROW||(e[1]=[1-w,b,1-K,b,1-K,l,1-w,l]),E!==u.c.FLIP_N_ROTATE_TILE&&E!==u.c.FLIP_N_ROTATE_ROW||(e[1]=[w,1-b,K,1-b,K,1-l,w,1-l]);for(let H=0;H<V;H++)Y.push(W-C+h,H*N-F+S,0),Y.push(W+h,H*N-F+S,0),Y.push(W+h,(H+1)*N-F+S,0),Y.push(W-C+h,(H+1)*N-F+S,0),o.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,s=E===u.c.FLIP_TILE||E===u.c.ROTATE_TILE||E===u.c.FLIP_N_ROTATE_TILE?s.concat(e[(H+A)%2]):E===u.c.FLIP_ROW||E===u.c.ROTATE_ROW||E===u.c.FLIP_N_ROTATE_ROW?s.concat(e[H%2]):s.concat(e[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const b=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE;P.d._ComputeSides(b,Y,o,f,s,e.frontUVs,e.backUVs);const K=new P.d;K.indices=o,K.se=Y,K.pe=f,K.ye=s;const l=b===P.d.DOUBLESIDE?p.concat(p):p;return K.oe=l,K}function j(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return U(E).Ke(N,E.updatable),N}function F(e){const E=e.faceUV||new Array(6),H=e.faceColors,z=e.pattern||u.c.NO_FLIP,D=e.width||e.size||1,A=e.height||e.size||1,C=e.depth||e.size||1,i=e.tileWidth||e.tileSize||1,j=e.tileHeight||e.tileSize||1,F=e.alignHorizontal||0,h=e.alignVertical||0,S=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE;for(let u=0;u<6;u++)void 0===E[u]&&(E[u]=new N.Vector4(0,0,1,1)),H&&void 0===H[u]&&(H[u]=new V.FM(1,1,1,1));const X=D/2,a=A/2,W=C/2,r=[];for(let N=0;N<2;N++)r[N]=U({pattern:z,tileWidth:i,tileHeight:j,width:D,height:A,alignVertical:h,alignHorizontal:F,sideOrientation:S});for(let N=2;N<4;N++)r[N]=U({pattern:z,tileWidth:i,tileHeight:j,width:C,height:A,alignVertical:h,alignHorizontal:F,sideOrientation:S});let Y=h;h===u.c.BOTTOM?Y=u.c.TOP:h===u.c.TOP&&(Y=u.c.BOTTOM);for(let N=4;N<6;N++)r[N]=U({pattern:z,tileWidth:i,tileHeight:j,width:D,height:C,alignVertical:Y,alignHorizontal:F,sideOrientation:S});let f=[],w=[],s=[],p=[];const o=[],y=[],b=[],K=[];let l=0,O=0;for(let u=0;u<6;u++){const e=r[u].se.length;y[u]=[],b[u]=[];for(let E=0;E<e/3;E++)y[u].push(new N.jE(r[u].se[3*E],r[u].se[3*E+1],r[u].se[3*E+2])),b[u].push(new N.jE(r[u].pe[3*E],r[u].pe[3*E+1],r[u].pe[3*E+2]));l=r[u].ye.length,K[u]=[];for(let H=0;H<l;H+=2)K[u][H]=E[u].x+(E[u].z-E[u].x)*r[u].ye[H],K[u][H+1]=E[u].y+(E[u].w-E[u].y)*r[u].ye[H+1],M.c&&(K[u][H+1]=1-K[u][H+1]);if(s=s.concat(K[u]),p=p.concat(r[u].indices.map((e=>e+O))),O+=y[u].length,H)for(let E=0;E<4;E++)o.push(H[u].r,H[u].g,H[u].b,H[u].a)}const v=new N.jE(0,0,W),R=N.Matrix.RotationY(Math.PI);f=y[0].map((e=>N.jE.TransformNormal(e,R).add(v))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[]),w=b[0].map((e=>N.jE.TransformNormal(e,R))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[]),f=f.concat(y[1].map((e=>e.FE(v))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[])),w=w.concat(b[1].map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[]));const T=new N.jE(X,0,0),L=N.Matrix.RotationY(-Math.PI/2);f=f.concat(y[2].map((e=>N.jE.TransformNormal(e,L).add(T))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[])),w=w.concat(b[2].map((e=>N.jE.TransformNormal(e,L))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[]));const d=N.Matrix.RotationY(Math.PI/2);f=f.concat(y[3].map((e=>N.jE.TransformNormal(e,d).FE(T))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[])),w=w.concat(b[3].map((e=>N.jE.TransformNormal(e,d))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[]));const G=new N.jE(0,a,0),me=N.Matrix.RotationX(Math.PI/2);f=f.concat(y[4].map((e=>N.jE.TransformNormal(e,me).add(G))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[])),w=w.concat(b[4].map((e=>N.jE.TransformNormal(e,me))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[]));const Q=N.Matrix.RotationX(-Math.PI/2);f=f.concat(y[5].map((e=>N.jE.TransformNormal(e,Q).FE(G))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[])),w=w.concat(b[5].map((e=>N.jE.TransformNormal(e,Q))).map((e=>[e.x,e.y,e.z])).reduce(((e,E)=>e.concat(E)),[])),P.d._ComputeSides(S,f,p,w,s);const Z=new P.d;if(Z.indices=p,Z.se=f,Z.pe=w,Z.ye=s,H){const e=S===P.d.DOUBLESIDE?o.concat(o):o;Z.oe=e}return Z}function h(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return F(E).Ke(N,E.updatable),N}P.d.CreateTiledPlane=U;P.d.CreateTiledBox=F;var S=H(13097),X=H(11967),a=H(11935);function W(e){const E=e.height||2;let H=0===e.diameterTop?0:e.diameterTop||e.diameter||1,z=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;H=H||1e-5,z=z||1e-5;const D=0|(e.tessellation||24),A=0|(e.subdivisions||1),C=!!e.hasRings,i=!!e.enclose,U=0===e.cap?0:e.cap||u.c.CAP_ALL,j=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,F=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,h=e.faceUV||new Array(3),S=e.faceColors,X=2+(1+(1!==j&&i?2:0))*(C?A:1);let W;for(W=0;W<X;W++)S&&void 0===S[W]&&(S[W]=new V.FM(1,1,1,1));for(W=0;W<X;W++)h&&void 0===h[W]&&(h[W]=new N.Vector4(0,0,1,1));const r=[],Y=[],f=[],w=[],s=[],p=2*Math.PI*j/D;let o,y,b;const K=(z-H)/2/E,l=N.jE.Zero(),O=N.jE.Zero(),v=N.jE.Zero(),R=N.jE.Zero(),T=N.jE.Zero(),L=a.e.Y;let d,G,me,Q=1,Z=1,k=0,J=0;for(d=0;d<=A;d++)for(y=d/A,b=(y*(H-z)+z)/2,Q=C&&0!==d&&d!==A?2:1,me=0;me<Q;me++){for(C&&(Z+=me),i&&(Z+=2*me),G=0;G<=D;G++)o=G*p,l.x=Math.cos(-o)*b,l.y=-E/2+y*E,l.z=Math.sin(-o)*b,0===H&&d===A?(O.x=f[f.length-3*(D+1)],O.y=f[f.length-3*(D+1)+1],O.z=f[f.length-3*(D+1)+2]):(O.x=l.x,O.z=l.z,O.y=Math.sqrt(O.x*O.x+O.z*O.z)*K,O.normalize()),0===G&&(v.P(l),R.P(O)),Y.push(l.x,l.y,l.z),f.push(O.x,O.y,O.z),J=C?k!==Z?h[Z].y:h[Z].w:h[Z].y+(h[Z].w-h[Z].y)*y,w.push(h[Z].x+(h[Z].z-h[Z].x)*G/D,M.c?1-J:J),S&&s.push(S[Z].r,S[Z].g,S[Z].b,S[Z].a);1!==j&&i&&(Y.push(l.x,l.y,l.z),Y.push(0,l.y,0),Y.push(0,l.y,0),Y.push(v.x,v.y,v.z),N.jE.CrossToRef(L,O,T),T.normalize(),f.push(T.x,T.y,T.z,T.x,T.y,T.z),N.jE.CrossToRef(R,L,T),T.normalize(),f.push(T.x,T.y,T.z,T.x,T.y,T.z),J=C?k!==Z?h[Z+1].y:h[Z+1].w:h[Z+1].y+(h[Z+1].w-h[Z+1].y)*y,w.push(h[Z+1].x,M.c?1-J:J),w.push(h[Z+1].z,M.c?1-J:J),J=C?k!==Z?h[Z+2].y:h[Z+2].w:h[Z+2].y+(h[Z+2].w-h[Z+2].y)*y,w.push(h[Z+2].x,M.c?1-J:J),w.push(h[Z+2].z,M.c?1-J:J),S&&(s.push(S[Z+1].r,S[Z+1].g,S[Z+1].b,S[Z+1].a),s.push(S[Z+1].r,S[Z+1].g,S[Z+1].b,S[Z+1].a),s.push(S[Z+2].r,S[Z+2].g,S[Z+2].b,S[Z+2].a),s.push(S[Z+2].r,S[Z+2].g,S[Z+2].b,S[Z+2].a))),k!==Z&&(k=Z)}const B=1!==j&&i?D+4:D;for(d=0,Z=0;Z<A;Z++){let e=0,E=0,H=0,N=0;for(G=0;G<D;G++)e=d*(B+1)+G,E=(d+1)*(B+1)+G,H=d*(B+1)+(G+1),N=(d+1)*(B+1)+(G+1),r.push(e,E,H),r.push(N,H,E);1!==j&&i&&(r.push(e+2,E+2,H+2),r.push(N+2,H+2,E+2),r.push(e+4,E+4,H+4),r.push(N+4,H+4,E+4)),d=C?d+2:d+1}const I=e=>{const u=e?H/2:z/2;if(0===u)return;let P,A,C;const i=e?h[X-1]:h[0];let V=null;S&&(V=e?S[X-1]:S[0]);const U=Y.length/3,F=e?E/2:-E/2,a=new N.jE(0,F,0);Y.push(a.x,a.y,a.z),f.push(0,e?1:-1,0);const W=i.y+.5*(i.w-i.y);w.push(i.x+.5*(i.z-i.x),M.c?1-W:W),V&&s.push(V.r,V.g,V.b,V.a);const p=new N.Vector2(.5,.5);for(C=0;C<=D;C++){P=2*Math.PI*C*j/D;const E=Math.cos(-P),H=Math.sin(-P);A=new N.jE(E*u,F,H*u);const z=new N.Vector2(E*p.x+.5,H*p.y+.5);Y.push(A.x,A.y,A.z),f.push(0,e?1:-1,0);const U=i.y+(i.w-i.y)*z.y;w.push(i.x+(i.z-i.x)*z.x,M.c?1-U:U),V&&s.push(V.r,V.g,V.b,V.a)}for(C=0;C<D;C++)e?(r.push(U),r.push(U+(C+2)),r.push(U+(C+1))):(r.push(U),r.push(U+(C+1)),r.push(U+(C+2)))};U!==u.c.CAP_START&&U!==u.c.CAP_ALL||I(!1),U!==u.c.CAP_END&&U!==u.c.CAP_ALL||I(!0),P.d._ComputeSides(F,Y,r,f,w,e.frontUVs,e.backUVs);const t=new P.d;return t.indices=r,t.se=Y,t.pe=f,t.ye=w,S&&(t.oe=s),t}function r(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return W(E).Ke(N,E.updatable),N}function Y(e){const E=[],H=[],u=[],z=[],D=e.diameter||1,A=e.thickness||.5,C=0|(e.tessellation||16),i=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,V=C+1;for(let P=0;P<=C;P++){const e=P/C,i=P*Math.PI*2/C-Math.PI/2,U=N.Matrix.Translation(D/2,0,0).multiply(N.Matrix.RotationY(i));for(let D=0;D<=C;D++){const i=1-D/C,j=D*Math.PI*2/C+Math.PI,F=Math.cos(j),h=Math.sin(j);let S=new N.jE(F,h,0),X=S.scale(A/2);const a=new N.Vector2(e,i);X=N.jE.TransformCoordinates(X,U),S=N.jE.TransformNormal(S,U),H.push(X.x,X.y,X.z),u.push(S.x,S.y,S.z),z.push(a.x,M.c?1-a.y:a.y);const W=(P+1)%V,r=(D+1)%V;E.push(P*V+D),E.push(P*V+r),E.push(W*V+D),E.push(P*V+r),E.push(W*V+r),E.push(W*V+D)}}P.d._ComputeSides(i,H,E,u,z,e.frontUVs,e.backUVs);const U=new P.d;return U.indices=E,U.se=H,U.pe=u,U.ye=z,U}function f(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return Y(E).Ke(N,E.updatable),N}P.d.CreateCylinder=W,u.c.CreateCylinder=(e,E,H,N,z,P,M,D,A)=>{void 0!==M&&M instanceof X.c||(void 0!==M&&(A=D||u.c.DEFAULTSIDE,D=M),M=P,P=1);return r(e,{height:E,diameterTop:H,diameterBottom:N,tessellation:z,subdivisions:P,sideOrientation:A,updatable:D},M)};function w(e){const E=[],H=[],u=[],z=[],D=e.radius||2,A=e.tube||.5,C=e.radialSegments||32,i=e.tubularSegments||32,V=e.p||2,U=e.q||3,j=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,F=e=>{const E=Math.cos(e),H=Math.sin(e),u=U/V*e,z=Math.cos(u),P=D*(2+z)*.5*E,M=D*(2+z)*H*.5,A=D*Math.sin(u)*.5;return new N.jE(P,M,A)};let h,S;for(h=0;h<=C;h++){const e=h%C/C*2*V*Math.PI,E=F(e),u=F(e+.01),P=u.FE(E);let D=u.add(E);const U=N.jE.Cross(P,D);for(D=N.jE.Cross(U,P),U.normalize(),D.normalize(),S=0;S<i;S++){const e=S%i/i*2*Math.PI,N=-A*Math.cos(e),u=A*Math.sin(e);H.push(E.x+N*D.x+u*U.x),H.push(E.y+N*D.y+u*U.y),H.push(E.z+N*D.z+u*U.z),z.push(h/C),z.push(M.c?1-S/i:S/i)}}for(h=0;h<C;h++)for(S=0;S<i;S++){const e=(S+1)%i,H=h*i+S,N=(h+1)*i+S,u=(h+1)*i+e,z=h*i+e;E.push(z),E.push(N),E.push(H),E.push(z),E.push(u),E.push(N)}P.d.ComputeNormals(H,E,u),P.d._ComputeSides(j,H,E,u,z,e.frontUVs,e.backUVs);const X=new P.d;return X.indices=E,X.se=H,X.pe=u,X.ye=z,X}function s(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return w(E).Ke(N,E.updatable),N}P.d.CreateTorus=Y,u.c.CreateTorus=(e,E,H,N,u,z,P)=>f(e,{diameter:E,thickness:H,tessellation:N,sideOrientation:P,updatable:z},u);P.d.CreateTorusKnot=w,u.c.CreateTorusKnot=(e,E,H,N,u,z,P,M,D,A)=>s(e,{radius:E,tube:H,radialSegments:N,tubularSegments:u,p:z,q:P,sideOrientation:A,updatable:D},M);var p=H(13603),o=H(12280),y=H(11940);function b(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=E.path,z=E.shape,P=E.scale||1,M=E.rotation||0,D=0===E.cap?0:E.cap||u.c.NO_CAP,A=E.updatable,C=u.c._GetDefaultSideOrientation(E.sideOrientation),i=E.instance||null,V=E.invertUV||!1,U=E.closeShape||!1,j=E.closePath||!1,F=E.capFunction||null;return l(e,z,N,P,M,null,null,j,U,D,!1,H,!!A,C,i,V,E.frontUVs||null,E.backUVs||null,E.firstNormal||null,!!E.adjustFrame,F)}function K(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=E.path,z=E.shape,P=E.scaleFunction||(()=>1),M=E.rotationFunction||(()=>0),D=E.closePath||E.ribbonCloseArray||!1,A=E.closeShape||E.ribbonClosePath||!1,C=0===E.cap?0:E.cap||u.c.NO_CAP,i=E.updatable,V=E.firstNormal||null,U=E.adjustFrame||!1,j=u.c._GetDefaultSideOrientation(E.sideOrientation),F=E.instance,h=E.invertUV||!1,S=E.capFunction||null;return l(e,z,N,null,null,P,M,D,A,C,!0,H,!!i,j,F||null,h,E.frontUVs||null,E.backUVs||null,V,U,S||null)}function l(e,E,H,z,P,M,D,C,i,V,U,j,F,h,S,X,a,W,r,Y,f){const w=(e,E,H,z,P,M,D,A,C,i,V)=>{const U=H.getTangents(),j=H.getNormals(),F=H.getBinormals(),h=H.getDistances();if(V)for(let u=0;u<U.length;u++)if(0==U[u].x&&0==U[u].y&&0==U[u].z&&U[u].P(U[u-1]),0==j[u].x&&0==j[u].y&&0==j[u].z&&j[u].P(j[u-1]),0==F[u].x&&0==F[u].y&&0==F[u].z&&F[u].P(F[u-1]),u>0){let e=U[u-1];N.jE.Dot(e,U[u])<0&&U[u].scaleInPlace(-1),e=j[u-1],N.jE.Dot(e,j[u])<0&&j[u].scaleInPlace(-1),e=F[u-1],N.jE.Dot(e,F[u])<0&&F[u].scaleInPlace(-1)}let S=0;const X=i&&A?A:()=>null!==M?M:0,a=i&&D?D:()=>null!==P?P:1;let W=C===u.c.NO_CAP||C===u.c.CAP_END?0:2;const r=N.TmpVectors.Matrix[0];for(let u=0;u<E.length;u++){const H=[],P=X(u,h[u]),M=a(u,h[u]);N.Matrix.RotationAxisToRef(U[u],S,r);for(let z=0;z<e.length;z++){const P=U[u].scale(e[z].z).add(j[u].scale(e[z].x)).add(F[u].scale(e[z].y)),D=N.jE.Zero();N.jE.TransformCoordinatesToRef(P,r,D),D.scaleInPlace(M).addInPlace(E[u]),H[z]=D}z[W]=H,S+=P,W++}const Y=f||(e=>{const E=Array(),H=N.jE.Zero();let u;for(u=0;u<e.length;u++)H.addInPlace(e[u]);for(H.scaleInPlace(1/e.length),u=0;u<e.length;u++)E.push(H);return E});switch(C){case u.c.NO_CAP:break;case u.c.CAP_START:z[0]=Y(z[2]),z[1]=z[2];break;case u.c.CAP_END:z[W]=z[W-1],z[W+1]=Y(z[W-1]);break;case u.c.CAP_ALL:z[0]=Y(z[2]),z[1]=z[2],z[W]=z[W-1],z[W+1]=Y(z[W-1])}return z};let s,p;if(S){const e=S._creationDataStorage;return s=r?e.path3D.update(H,r):e.path3D.update(H),p=w(E,H,e.path3D,e.pathArray,z,P,M,D,e.cap,U,Y),S=A("",{pathArray:p,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:S},j||void 0)}s=r?new y.h(H,r):new y.h(H);p=w(E,H,s,new Array,z,P,M,D,V=V<0||V>3?0:V,U,Y);const o=A(e,{pathArray:p,closeArray:C,closePath:i,updatable:F,sideOrientation:h,invertUV:X,frontUVs:a||void 0,backUVs:W||void 0},j);return o._creationDataStorage.pathArray=p,o._creationDataStorage.path3D=s,o._creationDataStorage.cap=V,o}function O(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.arc?E.arc<=0||E.arc>1?1:E.arc:1,P=void 0===E.closed||E.closed,M=E.shape,D=E.radius||1,C=E.tessellation||64,i=E.clip||0,V=E.updatable,U=u.c._GetDefaultSideOrientation(E.sideOrientation),j=E.cap||u.c.NO_CAP,F=2*Math.PI,h=[],S=E.invertUV||!1;let X=0,a=0;const W=F/C*z;let r,Y;for(X=0;X<=C-i;X++){for(Y=[],j!=u.c.CAP_START&&j!=u.c.CAP_ALL||(Y.push(new N.jE(0,M[0].y,0)),Y.push(new N.jE(Math.cos(X*W)*M[0].x*D,M[0].y,Math.sin(X*W)*M[0].x*D))),a=0;a<M.length;a++)r=new N.jE(Math.cos(X*W)*M[a].x*D,M[a].y,Math.sin(X*W)*M[a].x*D),Y.push(r);j!=u.c.CAP_END&&j!=u.c.CAP_ALL||(Y.push(new N.jE(Math.cos(X*W)*M[M.length-1].x*D,M[M.length-1].y,Math.sin(X*W)*M[M.length-1].x*D)),Y.push(new N.jE(0,M[M.length-1].y,0))),h.push(Y)}return A(e,{pathArray:h,closeArray:P,sideOrientation:U,updatable:V,invertUV:S,frontUVs:E.frontUVs,backUVs:E.backUVs},H)}u.c.ExtrudeShape=function(e,E,H,N,z,P){let M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,C=arguments.length>9?arguments[9]:void 0;return b(e,{shape:E,path:H,scale:N,rotation:z,cap:0===P?0:P||u.c.NO_CAP,sideOrientation:A,instance:C,updatable:D},M)},u.c.ExtrudeShapeCustom=(e,E,H,N,z,P,M,D,A,C,i,V)=>K(e,{shape:E,path:H,scaleFunction:N,rotationFunction:z,ribbonCloseArray:P,ribbonClosePath:M,cap:0===D?0:D||u.c.NO_CAP,sideOrientation:i,instance:V,updatable:C},A);u.c.CreateLathe=(e,E,H,N,u,z,P)=>O(e,{shape:E,radius:H,tessellation:N,sideOrientation:P,updatable:z},u);var v=H(13004),R=H(12947);function T(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.path;let P=E.instance,M=1;void 0!==E.radius?M=E.radius:P&&(M=P._creationDataStorage.radius);const D=E.tessellation||64,C=E.radiusFunction||null;let i=E.cap||u.c.NO_CAP;const V=E.invertUV||!1,U=E.updatable,j=u.c._GetDefaultSideOrientation(E.sideOrientation);E.arc=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1;const F=(e,E,H,z,P,M,D,A)=>{const C=E.getTangents(),i=E.getNormals(),V=E.getDistances(),U=2*Math.PI/P*A,j=M||(()=>z);let F,h,S,X;const a=N.TmpVectors.Matrix[0];let W=D===u.c.NO_CAP||D===u.c.CAP_END?0:2;for(let u=0;u<e.length;u++){h=j(u,V[u]),F=Array(),S=i[u];for(let E=0;E<P;E++)N.Matrix.RotationAxisToRef(C[u],U*E,a),X=F[E]?F[E]:N.jE.Zero(),N.jE.TransformCoordinatesToRef(S,a,X),X.scaleInPlace(h).addInPlace(e[u]),F[E]=X;H[W]=F,W++}const r=(E,H)=>{const N=Array();for(let u=0;u<E;u++)N.push(e[H]);return N};switch(D){case u.c.NO_CAP:break;case u.c.CAP_START:H[0]=r(P,0),H[1]=H[2].slice(0);break;case u.c.CAP_END:H[W]=H[W-1].slice(0),H[W+1]=r(P,e.length-1);break;case u.c.CAP_ALL:H[0]=r(P,0),H[1]=H[2].slice(0),H[W]=H[W-1].slice(0),H[W+1]=r(P,e.length-1)}return H};let h,S;if(P){const e=P._creationDataStorage,H=E.arc||e.arc;return h=e.path3D.update(z),S=F(z,h,e.pathArray,M,e.tessellation,C,e.cap,H),P=A("",{pathArray:S,instance:P}),e.path3D=h,e.pathArray=S,e.arc=H,e.radius=M,P}h=new y.h(z);i=i<0||i>3?0:i,S=F(z,h,new Array,M,D,C,i,E.arc);const X=A(e,{pathArray:S,closePath:!0,closeArray:!1,updatable:U,sideOrientation:j,invertUV:V,frontUVs:E.frontUVs,backUVs:E.backUVs},H);return X._creationDataStorage.pathArray=S,X._creationDataStorage.path3D=h,X._creationDataStorage.tessellation=D,X._creationDataStorage.cap=i,X._creationDataStorage.arc=E.arc,X._creationDataStorage.radius=M,X}function L(e){const E=[];E[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},E[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},E[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},E[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},E[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},E[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},E[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},E[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},E[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},E[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},E[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},E[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},E[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},E[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},E[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const H=e.type&&(e.type<0||e.type>=E.length)?0:e.type||0,u=e.size,z=e.sizeX||u||1,D=e.sizeY||u||1,A=e.sizeZ||u||1,C=e.custom||E[H],i=C.face.length,U=e.faceUV||new Array(i),j=e.faceColors,F=void 0===e.flat||e.flat,h=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,S=[],X=[],a=[],W=[],r=[];let Y=0,f=0;const w=[];let s,p,o,y,b,K,l=0,O=0;if(F)for(O=0;O<i;O++)j&&void 0===j[O]&&(j[O]=new V.FM(1,1,1,1)),U&&void 0===U[O]&&(U[O]=new N.Vector4(0,0,1,1));if(F)for(O=0;O<i;O++){const e=C.face[O].length;for(o=2*Math.PI/e,y=.5*Math.tan(o/2),b=.5,l=0;l<e;l++)S.push(C.vertex[C.face[O][l]][0]*z,C.vertex[C.face[O][l]][1]*D,C.vertex[C.face[O][l]][2]*A),w.push(Y),Y++,s=U[O].x+(U[O].z-U[O].x)*(.5+y),p=U[O].y+(U[O].w-U[O].y)*(b-.5),W.push(s,M.c?1-p:p),K=y*Math.cos(o)-b*Math.sin(o),b=y*Math.sin(o)+b*Math.cos(o),y=K,j&&r.push(j[O].r,j[O].g,j[O].b,j[O].a);for(l=0;l<e-2;l++)X.push(w[0+f],w[l+2+f],w[l+1+f]);f+=e}else{for(l=0;l<C.vertex.length;l++)S.push(C.vertex[l][0]*z,C.vertex[l][1]*D,C.vertex[l][2]*A),W.push(0,M.c?1:0);for(O=0;O<i;O++)for(l=0;l<C.face[O].length-2;l++)X.push(C.face[O][0],C.face[O][l+2],C.face[O][l+1])}P.d.ComputeNormals(S,X,a),P.d._ComputeSides(h,S,X,a,W,e.frontUVs,e.backUVs);const v=new P.d;return v.se=S,v.indices=X,v.pe=a,v.ye=W,j&&F&&(v.oe=r),v}function d(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return L(E).Ke(N,E.updatable),N}u.c.CreateTube=(e,E,H,N,u,z,P,M,D,A)=>T(e,{path:E,radius:H,tessellation:N,radiusFunction:u,arc:1,cap:z,updatable:M,sideOrientation:D,instance:A},P);function G(e){const E=e.sideOrientation||P.d.DEFAULTSIDE,H=e.radius||1,u=void 0===e.flat||e.flat,z=0|(e.subdivisions||4),D=e.radiusX||H,A=e.radiusY||H,C=e.radiusZ||H,i=(1+Math.sqrt(5))/2,V=[-1,i,-0,1,i,0,-1,-i,0,1,-i,0,0,-1,-i,0,1,-i,0,-1,i,0,1,i,i,0,1,i,0,-1,-i,0,1,-i,0,-1],U=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],j=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],F=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],h=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],S=[],X=[],a=[],W=[];let r=0;const Y=new Array(3),f=new Array(3);let w;for(w=0;w<3;w++)Y[w]=N.jE.Zero(),f[w]=N.Vector2.Zero();for(let P=0;P<20;P++){for(w=0;w<3;w++){const e=U[3*P+w];Y[w].VM(V[3*j[e]],V[3*j[e]+1],V[3*j[e]+2]),Y[w].normalize(),f[w].VM(.134765625*F[2*e]+.05859375+-.0390625*h[P],.2333984375*F[2*e+1]+.025390625+.01953125*h[P])}const e=(e,E,H,P)=>{const i=N.jE.Lerp(Y[0],Y[2],E/z),V=N.jE.Lerp(Y[1],Y[2],E/z),U=z===E?Y[2]:N.jE.Lerp(i,V,e/(z-E));let j;if(U.normalize(),u){const e=N.jE.Lerp(Y[0],Y[2],P/z),E=N.jE.Lerp(Y[1],Y[2],P/z);j=N.jE.Lerp(e,E,H/(z-P))}else j=new N.jE(U.x,U.y,U.z);j.x/=D,j.y/=A,j.z/=C,j.normalize();const F=N.Vector2.Lerp(f[0],f[2],E/z),h=N.Vector2.Lerp(f[1],f[2],E/z),w=z===E?f[2]:N.Vector2.Lerp(F,h,e/(z-E));X.push(U.x*D,U.y*A,U.z*C),a.push(j.x,j.y,j.z),W.push(w.x,M.c?1-w.y:w.y),S.push(r),r++};for(let E=0;E<z;E++)for(let H=0;H+E<z;H++)e(H,E,H+1/3,E+1/3),e(H+1,E,H+1/3,E+1/3),e(H,E+1,H+1/3,E+1/3),H+E+1<z&&(e(H+1,E,H+2/3,E+2/3),e(H+1,E+1,H+2/3,E+2/3),e(H,E+1,H+2/3,E+2/3))}P.d._ComputeSides(E,X,S,a,W,e.frontUVs,e.backUVs);const s=new P.d;return s.indices=S,s.se=X,s.pe=a,s.ye=W,s}function me(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new u.c(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),N._originalBuilderSideOrientation=E.sideOrientation;return G(E).Ke(N,E.updatable),N}P.d.CreatePolyhedron=L,u.c.CreatePolyhedron=(e,E,H)=>d(e,E,H);P.d.CreateIcoSphere=G,u.c.CreateIcoSphere=(e,E,H)=>me(e,E,H);var Q=H(11756);const Z=new N.jE(1,0,0),k=new N.jE(-1,0,0),J=new N.jE(0,1,0),B=new N.jE(0,-1,0),I=new N.jE(0,0,1),t=new N.jE(0,0,-1);class q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.jE.Zero(),E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.jE.Up(),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.Vector2.Zero(),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=e,this.normal=E,this.uv=H,this.vertexIdx=u,this.vertexIdxForBones=z,this.localPositionOverride=P,this.localNormalOverride=M,this.matrixIndicesOverride=D,this.matrixWeightsOverride=A}clone(){var e,E,H,N;return new q(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(e=this.localPositionOverride)||void 0===e?void 0:e.slice(),null===(E=this.localNormalOverride)||void 0===E?void 0:E.slice(),null===(H=this.matrixIndicesOverride)||void 0===H?void 0:H.slice(),null===(N=this.matrixWeightsOverride)||void 0===N?void 0:N.slice())}}function c(e,E,H){var D,A,C,i,V;const U=!!E.skeleton,j=!(null===(D=E.morphTargetManager)||void 0===D||!D.numTargets),F=H.localMode||U,h=E.CM(),S=U||j?E.yM(!0,!0):E.getVerticesData(z.g.PositionKind),X=U||j?E.getNormalsData(!0,!0):E.getVerticesData(z.g.NormalKind),a=F?U?E.getVerticesData(z.g.PositionKind):S:null,W=F?U?E.getVerticesData(z.g.NormalKind):X:null,r=E.getVerticesData(z.g.UVKind),Y=U?E.getVerticesData(z.g.MatricesIndicesKind):null,f=U?E.getVerticesData(z.g.MatricesWeightsKind):null,w=U?E.getVerticesData(z.g.MatricesIndicesExtraKind):null,s=U?E.getVerticesData(z.g.MatricesWeightsExtraKind):null,p=H.position||N.jE.Zero();let o=H.normal||N.jE.Up();const y=H.size||N.jE.One(),b=H.angle||0;if(!o){const e=new N.jE(0,0,1),H=E.fe().activeCamera,u=N.jE.TransformCoordinates(e,H.getWorldMatrix());o=H.globalPosition.FE(u)}const K=-Math.atan2(o.z,o.x)-Math.PI/2,l=Math.sqrt(o.x*o.x+o.z*o.z),O=Math.atan2(o.y,l),v=new P.d;v.indices=[],v.se=[],v.pe=[],v.ye=[],v.matricesIndices=U?[]:null,v.matricesWeights=U?[]:null,v.matricesIndicesExtra=w?[]:null,v.matricesWeightsExtra=s?[]:null;let R=0;const T=(e,E)=>{const u=new q;if(!h||!S||!X)return u;const z=h[e];if(u.vertexIdx=3*z,u.vertexIdxForBones=4*z,u.position=new N.jE(S[3*z],S[3*z+1],S[3*z+2]),N.jE.TransformCoordinatesToRef(u.position,E,u.position),u.normal=new N.jE(X[3*z],X[3*z+1],X[3*z+2]),N.jE.TransformNormalToRef(u.normal,E,u.normal),H.captureUVS&&r){const e=r[2*z+1];u.uv=new N.Vector2(r[2*z],M.c?1-e:e)}return u},L=[0,0,0,0],d=(e,E)=>{if(0===e.length)return e;const H=.5*Math.abs(N.jE.Dot(y,E)),u=(e,E,H,N)=>{for(let u=0;u<N;++u)if(e[H+u]===E)return H+u;return-1},z=(e,z)=>{const P=N.jE.GetClipFactor(e.position,z.position,E,H);let M=L,D=L;if(Y&&f){const E=e.matrixIndicesOverride?0:e.vertexIdxForBones,H=e.matrixIndicesOverride??Y,N=e.matrixWeightsOverride??f,A=z.matrixIndicesOverride?0:z.vertexIdxForBones,C=z.matrixIndicesOverride??Y,i=z.matrixWeightsOverride??f;M=[0,0,0,0],D=[0,0,0,0];let V=0;for(let e=0;e<4;++e)if(N[E+e]>0){const z=u(C,H[E+e],A,4);M[V]=H[E+e],D[V]=(0,Q.Lerp)(N[E+e],z>=0?i[z]:0,P),V++}for(let e=0;e<4&&V<4;++e){const N=C[A+e];-1===u(H,N,E,4)&&(M[V]=N,D[V]=(0,Q.Lerp)(0,i[A+e],P),V++)}const U=D[0]+D[1]+D[2]+D[3];D[0]/=U,D[1]/=U,D[2]/=U,D[3]/=U}const A=e.localPositionOverride?e.localPositionOverride[0]:(null===a||void 0===a?void 0:a[e.vertexIdx])??0,C=e.localPositionOverride?e.localPositionOverride[1]:(null===a||void 0===a?void 0:a[e.vertexIdx+1])??0,i=e.localPositionOverride?e.localPositionOverride[2]:(null===a||void 0===a?void 0:a[e.vertexIdx+2])??0,V=z.localPositionOverride?z.localPositionOverride[0]:(null===a||void 0===a?void 0:a[z.vertexIdx])??0,U=z.localPositionOverride?z.localPositionOverride[1]:(null===a||void 0===a?void 0:a[z.vertexIdx+1])??0,j=z.localPositionOverride?z.localPositionOverride[2]:(null===a||void 0===a?void 0:a[z.vertexIdx+2])??0,F=e.localNormalOverride?e.localNormalOverride[0]:(null===W||void 0===W?void 0:W[e.vertexIdx])??0,h=e.localNormalOverride?e.localNormalOverride[1]:(null===W||void 0===W?void 0:W[e.vertexIdx+1])??0,S=e.localNormalOverride?e.localNormalOverride[2]:(null===W||void 0===W?void 0:W[e.vertexIdx+2])??0,X=F+((z.localNormalOverride?z.localNormalOverride[0]:(null===W||void 0===W?void 0:W[z.vertexIdx])??0)-F)*P,r=h+((z.localNormalOverride?z.localNormalOverride[1]:(null===W||void 0===W?void 0:W[z.vertexIdx+1])??0)-h)*P,w=S+((z.localNormalOverride?z.localNormalOverride[2]:(null===W||void 0===W?void 0:W[z.vertexIdx+2])??0)-S)*P,s=Math.sqrt(X*X+r*r+w*w);return new q(N.jE.Lerp(e.position,z.position,P),N.jE.Lerp(e.normal,z.normal,P).normalize(),N.Vector2.Lerp(e.uv,z.uv,P),-1,-1,a?[A+(V-A)*P,C+(U-C)*P,i+(j-i)*P]:null,W?[X/s,r/s,w/s]:null,M,D)};let P=null;e.length>3&&(P=[]);for(let M=0;M<e.length;M+=3){let u=0,D=null,A=null,C=null,i=null;const V=N.jE.Dot(e[M].position,E)-H>0,U=N.jE.Dot(e[M+1].position,E)-H>0,j=N.jE.Dot(e[M+2].position,E)-H>0;switch(u=(V?1:0)+(U?1:0)+(j?1:0),u){case 0:e.length>3?(P.push(e[M]),P.push(e[M+1]),P.push(e[M+2])):P=e;break;case 1:if(P=P??new Array,V&&(D=e[M+1],A=e[M+2],C=z(e[M],D),i=z(e[M],A)),U){D=e[M],A=e[M+2],C=z(e[M+1],D),i=z(e[M+1],A),P.push(C),P.push(A.clone()),P.push(D.clone()),P.push(A.clone()),P.push(C.clone()),P.push(i);break}j&&(D=e[M],A=e[M+1],C=z(e[M+2],D),i=z(e[M+2],A)),D&&A&&C&&i&&(P.push(D.clone()),P.push(A.clone()),P.push(C),P.push(i),P.push(C.clone()),P.push(A.clone()));break;case 2:P=P??new Array,V||(D=e[M].clone(),A=z(D,e[M+1]),C=z(D,e[M+2]),P.push(D),P.push(A),P.push(C)),U||(D=e[M+1].clone(),A=z(D,e[M+2]),C=z(D,e[M]),P.push(D),P.push(A),P.push(C)),j||(D=e[M+2].clone(),A=z(D,e[M]),C=z(D,e[M+1]),P.push(D),P.push(A),P.push(C))}}return P},G=E instanceof u.c?E:null,me=null===G||void 0===G?void 0:G._thinInstanceDataStorage.matrixData,c=(null===G||void 0===G?void 0:G.SM)||1,n=N.TmpVectors.Matrix[0];n.P(N.Matrix.IdentityReadOnly);for(let u=0;u<c;++u){if(null!==G&&void 0!==G&&G.hasThinInstances&&me){const e=16*u;n.setRowFromFloats(0,me[e+0],me[e+1],me[e+2],me[e+3]),n.setRowFromFloats(1,me[e+4],me[e+5],me[e+6],me[e+7]),n.setRowFromFloats(2,me[e+8],me[e+9],me[e+10],me[e+11]),n.setRowFromFloats(3,me[e+12],me[e+13],me[e+14],me[e+15])}const e=N.Matrix.RotationYawPitchRoll(K,O,b).multiply(N.Matrix.Translation(p.x,p.y,p.z)),z=N.Matrix.Invert(e),P=E.getWorldMatrix(),D=n.multiply(P).multiply(z),A=new Array(3);for(let E=0;E<h.length;E+=3){let e=A;if(e[0]=T(E,D),e[1]=T(E+1,D),e[2]=T(E+2,D),!(H.cullBackFaces&&-e[0].normal.z<=0&&-e[1].normal.z<=0&&-e[2].normal.z<=0)&&(e=d(e,Z),e&&(e=d(e,k),e&&(e=d(e,J),e&&(e=d(e,B),e&&(e=d(e,I),e&&(e=d(e,t),e)))))))for(let E=0;E<e.length;E++){const N=e[E];if(v.indices.push(R),F?(N.localPositionOverride?(v.se[3*R]=N.localPositionOverride[0],v.se[3*R+1]=N.localPositionOverride[1],v.se[3*R+2]=N.localPositionOverride[2]):a&&(v.se[3*R]=a[N.vertexIdx],v.se[3*R+1]=a[N.vertexIdx+1],v.se[3*R+2]=a[N.vertexIdx+2]),N.localNormalOverride?(v.pe[3*R]=N.localNormalOverride[0],v.pe[3*R+1]=N.localNormalOverride[1],v.pe[3*R+2]=N.localNormalOverride[2]):W&&(v.pe[3*R]=W[N.vertexIdx],v.pe[3*R+1]=W[N.vertexIdx+1],v.pe[3*R+2]=W[N.vertexIdx+2])):(N.position.toArray(v.se,3*R),N.normal.toArray(v.pe,3*R)),v.matricesIndices&&v.matricesWeights&&(N.matrixIndicesOverride?(v.matricesIndices[4*R]=N.matrixIndicesOverride[0],v.matricesIndices[4*R+1]=N.matrixIndicesOverride[1],v.matricesIndices[4*R+2]=N.matrixIndicesOverride[2],v.matricesIndices[4*R+3]=N.matrixIndicesOverride[3]):(Y&&(v.matricesIndices[4*R]=Y[N.vertexIdxForBones],v.matricesIndices[4*R+1]=Y[N.vertexIdxForBones+1],v.matricesIndices[4*R+2]=Y[N.vertexIdxForBones+2],v.matricesIndices[4*R+3]=Y[N.vertexIdxForBones+3]),w&&v.matricesIndicesExtra&&(v.matricesIndicesExtra[4*R]=w[N.vertexIdxForBones],v.matricesIndicesExtra[4*R+1]=w[N.vertexIdxForBones+1],v.matricesIndicesExtra[4*R+2]=w[N.vertexIdxForBones+2],v.matricesIndicesExtra[4*R+3]=w[N.vertexIdxForBones+3])),N.matrixWeightsOverride?(v.matricesWeights[4*R]=N.matrixWeightsOverride[0],v.matricesWeights[4*R+1]=N.matrixWeightsOverride[1],v.matricesWeights[4*R+2]=N.matrixWeightsOverride[2],v.matricesWeights[4*R+3]=N.matrixWeightsOverride[3]):(f&&(v.matricesWeights[4*R]=f[N.vertexIdxForBones],v.matricesWeights[4*R+1]=f[N.vertexIdxForBones+1],v.matricesWeights[4*R+2]=f[N.vertexIdxForBones+2],v.matricesWeights[4*R+3]=f[N.vertexIdxForBones+3]),s&&v.matricesWeightsExtra&&(v.matricesWeightsExtra[4*R]=s[N.vertexIdxForBones],v.matricesWeightsExtra[4*R+1]=s[N.vertexIdxForBones+1],v.matricesWeightsExtra[4*R+2]=s[N.vertexIdxForBones+2],v.matricesWeightsExtra[4*R+3]=s[N.vertexIdxForBones+3]))),H.captureUVS)N.uv.toArray(v.ye,2*R);else{v.ye.push(.5+N.position.x/y.x);const e=.5+N.position.y/y.y;v.ye.push(M.c?1-e:e)}R++}}}0===v.indices.length&&(v.indices=null),0===v.se.length&&(v.se=null),0===v.pe.length&&(v.pe=null),0===v.ye.length&&(v.ye=null),0===(null===(A=v.matricesIndices)||void 0===A?void 0:A.length)&&(v.matricesIndices=null),0===(null===(C=v.matricesWeights)||void 0===C?void 0:C.length)&&(v.matricesWeights=null),0===(null===(i=v.matricesIndicesExtra)||void 0===i?void 0:i.length)&&(v.matricesIndicesExtra=null),0===(null===(V=v.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(v.matricesWeightsExtra=null);const g=new u.c(e,E.fe());return v.Ke(g),F?(g.skeleton=E.skeleton,g.parent=E):(g.position=p.clone(),g.rotation=new N.jE(O,K,b)),g.DM(!0),g.refreshBoundingInfo(!0,!0),g}function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const E=0|Math.max(e.subdivisions?e.subdivisions:2,1),H=0|Math.max(e.tessellation?e.tessellation:16,3),u=Math.max(e.height?e.height:1,0),z=Math.max(e.radius?e.radius:.25,0),D=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),A=H,C=E,i=Math.max(e.radiusTop?e.radiusTop:z,0),V=Math.max(e.radiusBottom?e.radiusBottom:z,0),U=u-(i+V),j=2*Math.PI,F=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:D,1),h=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:D,1),S=Math.acos((V-i)/u);let X=[];const a=[],W=[],r=[];let Y=0;const f=[],w=.5*U,s=.5*Math.PI;let p,o;const y=N.jE.Zero(),b=N.jE.Zero(),K=Math.cos(S),l=Math.sin(S),O=new N.Vector2(i*l,w+i*K).FE(new N.Vector2(V*l,V*K-w)).length(),v=i*S+O+V*(s-S);let R=0;for(o=0;o<=F;o++){const e=[],E=s-S*(o/F);R+=i*S/F;const H=Math.cos(E),N=Math.sin(E),u=H*i;for(p=0;p<=A;p++){const E=p/A,z=E*j+0,P=Math.sin(z),D=Math.cos(z);b.x=u*P,b.y=w+N*i,b.z=u*D,a.push(b.x,b.y,b.z),y.set(H*P,N,H*D),W.push(y.x,y.y,y.z),r.push(E,M.c?R/v:1-R/v),e.push(Y),Y++}f.push(e)}const T=u-i-V+K*i-K*V,L=l*(V-i)/T;for(o=1;o<=C;o++){const e=[];R+=O/C;const E=l*(o*(V-i)/C+i);for(p=0;p<=A;p++){const H=p/A,N=H*j+0,u=Math.sin(N),z=Math.cos(N);b.x=E*u,b.y=w+K*i-o*T/C,b.z=E*z,a.push(b.x,b.y,b.z),y.set(u,L,z).normalize(),W.push(y.x,y.y,y.z),r.push(H,M.c?R/v:1-R/v),e.push(Y),Y++}f.push(e)}for(o=1;o<=h;o++){const e=[],E=s-S-(Math.PI-S)*(o/h);R+=V*S/h;const H=Math.cos(E),N=Math.sin(E),u=H*V;for(p=0;p<=A;p++){const E=p/A,z=E*j+0,P=Math.sin(z),D=Math.cos(z);b.x=u*P,b.y=N*V-w,b.z=u*D,a.push(b.x,b.y,b.z),y.set(H*P,N,H*D),W.push(y.x,y.y,y.z),r.push(E,M.c?R/v:1-R/v),e.push(Y),Y++}f.push(e)}for(p=0;p<A;p++)for(o=0;o<F+C+h;o++){const e=f[o][p],E=f[o+1][p],H=f[o+1][p+1],N=f[o][p+1];X.push(e),X.push(E),X.push(N),X.push(E),X.push(H),X.push(N)}if(X=X.reverse(),e.orientation&&!e.orientation.equals(N.jE.Up())){const E=new N.Matrix;e.orientation.clone().scale(.5*Math.PI).cross(N.jE.Up()).toQuaternion().toRotationMatrix(E);const H=N.jE.Zero();for(let e=0;e<a.length;e+=3)H.set(a[e],a[e+1],a[e+2]),N.jE.TransformCoordinatesToRef(H.clone(),E,H),a[e]=H.x,a[e+1]=H.y,a[e+2]=H.z}const d=new P.d;return d.se=a,d.pe=W,d.ye=r,d.indices=X,d}function g(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:N.jE.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new u.c(e,H);return n(E).Ke(z,E.updatable),z}u.c.CreateDecal=(e,E,H,N,u,z)=>c(e,E,{position:H,normal:N,size:u,angle:z});u.c.CreateCapsule=(e,E,H)=>g(e,E,H),P.d.CreateCapsule=n;var x=H(11548),ee=H(11746);class Ee{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=E,e!==Math.floor(e)&&(e=Math.floor(e),x.d.Warn("x is not an integer, floor(x) used")),E!==Math.floor(E)&&(E=Math.floor(E),x.d.Warn("y is not an integer, floor(y) used"))}clone(){return new Ee(this.x,this.y)}rotate60About(e){const E=this.x;return this.x=e.x+e.y-this.y,this.y=E+this.y-e.x,this}rotateNeg60About(e){const E=this.x;return this.x=E+this.y-e.y,this.y=e.x+e.y-E,this}rotate120(e,E){e!==Math.floor(e)&&(e=Math.floor(e),x.d.Warn("m not an integer only floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),x.d.Warn("n not an integer only floor(n) used"));const H=this.x;return this.x=e-H-this.y,this.y=E+H,this}rotateNeg120(e,E){e!==Math.floor(e)&&(e=Math.floor(e),x.d.Warn("m is not an integer, floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),x.d.Warn("n is not an integer,   floor(n) used"));const H=this.x;return this.x=this.y-E,this.y=e+E-H-this.y,this}toCartesianOrigin(e,E){const H=N.jE.Zero();return H.x=e.x+2*this.x*E+this.y*E,H.y=e.y+Math.sqrt(3)*this.y*E,H}static Zero(){return new Ee(0,0)}}class He{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Ne("icosahedron","Regular",[[0,ee.g,-1],[-ee.g,1,0],[-1,0,-ee.g],[1,0,-ee.g],[ee.g,1,0],[0,ee.g,1],[-1,0,ee.g],[-ee.g,-1,0],[0,-ee.g,-1],[ee.g,-1,0],[1,0,ee.g],[0,-ee.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const E={},H=this.m,N=this.n;let u,z,P,M,D,A=H,C=1,i=0;0!==N&&(A=(0,Q.HighestCommonFactor)(H,N)),C=H/A,i=N/A;const V=Ee.Zero(),U=new Ee(H,N),j=new Ee(-N,H+N),F=Ee.Zero(),h=Ee.Zero(),S=Ee.Zero();let X,a,W,r,Y=[];const f=[],w=this.vertByDist,s=(H,N,u,z)=>{X=H+"|"+u,a=N+"|"+z,X in E||a in E?X in E&&!(a in E)?E[a]=E[X]:a in E&&!(X in E)&&(E[X]=E[a]):(E[X]=e,E[a]=e,e++),w[u][0]>2?f[E[X]]=[-w[u][0],w[u][1],E[X]]:f[E[X]]=[Y[w[u][0]],w[u][1],E[X]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let p=0;p<20;p++){if(Y=this.IDATA.face[p],P=Y[2],M=Y[1],D=Y[0],W=V.x+"|"+V.y,X=p+"|"+W,X in E||(E[X]=P,f[P]=[Y[w[W][0]],w[W][1]]),W=U.x+"|"+U.y,X=p+"|"+W,X in E||(E[X]=M,f[M]=[Y[w[W][0]],w[W][1]]),W=j.x+"|"+j.y,X=p+"|"+W,X in E||(E[X]=D,f[D]=[Y[w[W][0]],w[W][1]]),u=this.IDATA.edgematch[p][0],z=this.IDATA.edgematch[p][1],"B"===z)for(let e=1;e<A;e++)h.x=H-e*(C+i),h.y=N+e*C,S.x=-e*i,S.y=e*(C+i),W=h.x+"|"+h.y,r=S.x+"|"+S.y,s(p,u,W,r);if("O"===z)for(let e=1;e<A;e++)S.x=-e*i,S.y=e*(C+i),F.x=e*C,F.y=e*i,W=S.x+"|"+S.y,r=F.x+"|"+F.y,s(p,u,W,r);if(u=this.IDATA.edgematch[p][2],z=this.IDATA.edgematch[p][3],z&&"A"===z)for(let e=1;e<A;e++)F.x=e*C,F.y=e*i,h.x=H-(A-e)*(C+i),h.y=N+(A-e)*C,W=F.x+"|"+F.y,r=h.x+"|"+h.y,s(p,u,W,r);for(let H=0;H<this.vertices.length;H++)W=this.vertices[H].x+"|"+this.vertices[H].y,X=p+"|"+W,X in E||(E[X]=e++,w[W][0]>2?f[E[X]]=[-w[W][0],w[W][1],E[X]]:f[E[X]]=[Y[w[W][0]],w[W][1],E[X]])}this.closestTo=f,this.vecToidx=E}calcCoeffs(){const e=this.m,E=this.n,H=Math.sqrt(3)/3,N=e*e+E*E+e*E;this.coau=(e+E)/N,this.cobu=-E/N,this.coav=-H*(e-E)/N,this.cobv=H*(2*e+E)/N}createInnerFacets(){const e=this.m,E=this.n;for(let H=0;H<E+e+1;H++)for(let e=this.min[H];e<this.max[H]+1;e++)e<this.max[H]&&e<this.max[H+1]+1&&this.innerFacets.push(["|"+e+"|"+H,"|"+e+"|"+(H+1),"|"+(e+1)+"|"+H]),H>0&&e<this.max[H-1]&&e+1<this.max[H]+1&&this.innerFacets.push(["|"+e+"|"+H,"|"+(e+1)+"|"+H,"|"+(e+1)+"|"+(H-1)])}edgeVecsABOB(){const e=this.m,E=this.n,H=new Ee(-E,e+E);for(let N=1;N<e+E;N++){const e=new Ee(this.min[N],N),E=new Ee(this.min[N-1],N-1),u=new Ee(this.min[N+1],N+1),z=e.clone(),P=E.clone(),M=u.clone();z.rotate60About(H),P.rotate60About(H),M.rotate60About(H);const D=new Ee(this.max[z.y],z.y),A=new Ee(this.max[z.y-1],z.y-1),C=new Ee(this.max[z.y-1]-1,z.y-1);z.x===D.x&&z.y===D.y||(z.x!==A.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,A,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,C,D])):z.y===M.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,E,A]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,A,u])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,E,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,A,D])))}}mapABOBtoOBOA(){const e=new Ee(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const H=[];for(let N=0;N<3;N++)e.x=this.isoVecsABOB[E][N].x,e.y=this.isoVecsABOB[E][N].y,0===this.vertexTypes[E][N]&&e.rotateNeg120(this.m,this.n),H.push(e.clone());this.isoVecsOBOA.push(H)}}mapABOBtoBAOA(){const e=new Ee(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const H=[];for(let N=0;N<3;N++)e.x=this.isoVecsABOB[E][N].x,e.y=this.isoVecsABOB[E][N].y,1===this.vertexTypes[E][N]&&e.rotate120(this.m,this.n),H.push(e.clone());this.isoVecsBAOA.push(H)}}MapToFace(e,E){const H=this.IDATA.face[e],u=H[2],z=H[1],P=H[0],M=N.jE.aE(this.IDATA.vertex[u]),D=N.jE.aE(this.IDATA.vertex[z]),A=N.jE.aE(this.IDATA.vertex[P]),C=D.FE(M),i=A.FE(M),V=C.scale(this.coau).add(i.scale(this.cobu)),U=C.scale(this.coav).add(i.scale(this.cobv)),j=[];let F,h=N.TmpVectors.jE[0];for(let N=0;N<this.cartesian.length;N++)h=V.scale(this.cartesian[N].x).add(U.scale(this.cartesian[N].y)).add(M),j[N]=[h.x,h.y,h.z],F=e+"|"+this.vertices[N].x+"|"+this.vertices[N].y,E.vertex[this.vecToidx[F]]=[h.x,h.y,h.z]}build(e,E){const H=[],N=Ee.Zero(),u=new Ee(e,E),z=new Ee(-E,e+E);H.push(N,u,z);for(let W=E;W<e+1;W++)for(let E=0;E<e+1-W;E++)H.push(new Ee(E,W));if(E>0){const N=(0,Q.HighestCommonFactor)(e,E),u=e/N,z=E/N;for(let M=1;M<N;M++)H.push(new Ee(M*u,M*z)),H.push(new Ee(-M*z,M*(u+z))),H.push(new Ee(e-M*(u+z),E+M*u));const P=e/E;for(let M=1;M<E;M++)for(let N=0;N<M*P;N++)H.push(new Ee(N,M)),H.push(new Ee(N,M).rotate120(e,E)),H.push(new Ee(N,M).rotateNeg120(e,E))}H.sort(((e,E)=>e.x-E.x)),H.sort(((e,E)=>e.y-E.y));const P=new Array(e+E+1),M=new Array(e+E+1);for(let W=0;W<P.length;W++)P[W]=1/0,M[W]=-1/0;let D=0,A=0;const C=H.length;for(let W=0;W<C;W++)A=H[W].x,D=H[W].y,P[D]=Math.min(A,P[D]),M[D]=Math.max(A,M[D]);const i=(H,N)=>{const u=H.clone();return"A"===N&&u.rotateNeg120(e,E),"B"===N&&u.rotate120(e,E),u.x<0?u.y:u.x+u.y},V=[],U=[],j=[],F=[],h={},S=[];let X=-1,a=-1;for(let W=0;W<C;W++)V[W]=H[W].toCartesianOrigin(new Ee(0,0),.5),U[W]=i(H[W],"O"),j[W]=i(H[W],"A"),F[W]=i(H[W],"B"),U[W]===j[W]&&j[W]===F[W]?(X=3,a=U[W]):U[W]===j[W]?(X=4,a=U[W]):j[W]===F[W]?(X=5,a=j[W]):F[W]===U[W]&&(X=6,a=U[W]),U[W]<j[W]&&U[W]<F[W]&&(X=2,a=U[W]),j[W]<U[W]&&j[W]<F[W]&&(X=1,a=j[W]),F[W]<j[W]&&F[W]<U[W]&&(X=0,a=F[W]),S.push([X,a,H[W].x,H[W].y]);S.sort(((e,E)=>e[2]-E[2])),S.sort(((e,E)=>e[3]-E[3])),S.sort(((e,E)=>e[1]-E[1])),S.sort(((e,E)=>e[0]-E[0]));for(let W=0;W<S.length;W++)h[S[W][2]+"|"+S[W][3]]=[S[W][0],S[W][1],W];return this.m=e,this.n=E,this.vertices=H,this.vertByDist=h,this.cartesian=V,this.min=P,this.max=M,this}}class Ne{constructor(e,E,H,N){this.name=e,this.category=E,this.vertex=H,this.face=N}}class ue extends Ne{innerToData(e,E){for(let H=0;H<E.innerFacets.length;H++)this.face.push(E.innerFacets[H].map((H=>E.vecToidx[e+H])))}mapABOBtoDATA(e,E){const H=E.IDATA.edgematch[e][0];for(let N=0;N<E.isoVecsABOB.length;N++){const u=[];for(let z=0;z<3;z++)0===E.vertexTypes[N][z]?u.push(e+"|"+E.isoVecsABOB[N][z].x+"|"+E.isoVecsABOB[N][z].y):u.push(H+"|"+E.isoVecsABOB[N][z].x+"|"+E.isoVecsABOB[N][z].y);this.face.push([E.vecToidx[u[0]],E.vecToidx[u[1]],E.vecToidx[u[2]]])}}mapOBOAtoDATA(e,E){const H=E.IDATA.edgematch[e][0];for(let N=0;N<E.isoVecsOBOA.length;N++){const u=[];for(let z=0;z<3;z++)1===E.vertexTypes[N][z]?u.push(e+"|"+E.isoVecsOBOA[N][z].x+"|"+E.isoVecsOBOA[N][z].y):u.push(H+"|"+E.isoVecsOBOA[N][z].x+"|"+E.isoVecsOBOA[N][z].y);this.face.push([E.vecToidx[u[0]],E.vecToidx[u[1]],E.vecToidx[u[2]]])}}mapBAOAtoDATA(e,E){const H=E.IDATA.edgematch[e][2];for(let N=0;N<E.isoVecsBAOA.length;N++){const u=[];for(let z=0;z<3;z++)1===E.vertexTypes[N][z]?u.push(e+"|"+E.isoVecsBAOA[N][z].x+"|"+E.isoVecsBAOA[N][z].y):u.push(H+"|"+E.isoVecsBAOA[N][z].x+"|"+E.isoVecsBAOA[N][z].y);this.face.push([E.vecToidx[u[0]],E.vecToidx[u[1]],E.vecToidx[u[2]]])}}orderData(e){const E=[];for(let z=0;z<13;z++)E[z]=[];const H=e.closestTo;for(let z=0;z<H.length;z++)H[z][0]>-1?H[z][1]>0&&E[H[z][0]].push([z,H[z][1]]):E[12].push([z,H[z][0]]);const N=[];for(let z=0;z<12;z++)N[z]=z;let u=12;for(let z=0;z<12;z++){E[z].sort(((e,E)=>e[1]-E[1]));for(let e=0;e<E[z].length;e++)N[E[z][e][0]]=u++}for(let z=0;z<E[12].length;z++)N[E[12][z][0]]=u++;for(let z=0;z<this.vertex.length;z++)this.vertex[z].push(N[z]);this.vertex.sort(((e,E)=>e[3]-E[3]));for(let z=0;z<this.vertex.length;z++)this.vertex[z].pop();for(let z=0;z<this.face.length;z++)for(let e=0;e<this.face[z].length;e++)this.face[z][e]=N[this.face[z][e]];this.sharedNodes=E[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,E){const H=[],N=[];let u=E.pop();N.push(u);let z=this.face[u].indexOf(e);z=(z+2)%3;let P=this.face[u][z];H.push(P);let M=0;for(;E.length>0;)u=E[M],this.face[u].indexOf(P)>-1?(z=(this.face[u].indexOf(P)+1)%3,P=this.face[u][z],H.push(P),N.push(u),E.splice(M,1),M=0):M++;return this.adjacentFaces.push(H),N}toGoldbergPolyhedronData(){const e=new Ne("GeoDual","Goldberg",[],[]);e.name="GD dual";const E=this.vertex.length,H=new Array(E);for(let D=0;D<E;D++)H[D]=[];for(let D=0;D<this.face.length;D++)for(let e=0;e<3;e++)H[this.face[D][e]].push(D);let N=0,u=0,z=0,P=[],M=[];this.adjacentFaces=[];for(let D=0;D<H.length;D++){e.face[D]=this.setOrder(D,H[D].concat([]));for(const E of H[D]){N=0,u=0,z=0,P=this.face[E];for(let e=0;e<3;e++)M=this.vertex[P[e]],N+=M[0],u+=M[1],z+=M[2];e.vertex[E]=[N/3,u/3,z/3]}}return e}static BuildGeodesicData(e){const E=new ue("Geodesic-m-n","Geodesic",[[0,ee.g,-1],[-ee.g,1,0],[-1,0,-ee.g],[1,0,-ee.g],[ee.g,1,0],[0,ee.g,1],[-1,0,ee.g],[-ee.g,-1,0],[0,-ee.g,-1],[ee.g,-1,0],[1,0,ee.g],[0,-ee.g,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let H=0;H<e.IDATA.face.length;H++)e.MapToFace(H,E),E.innerToData(H,e),"B"===e.IDATA.edgematch[H][1]&&E.mapABOBtoDATA(H,e),"O"===e.IDATA.edgematch[H][1]&&E.mapOBOAtoDATA(H,e),"A"===e.IDATA.edgematch[H][3]&&E.mapBAOAtoDATA(H,e);E.orderData(e);return E.vertex=E.vertex.map((function(e){const E=e[0],H=e[1],N=e[2],u=Math.sqrt(E*E+H*H+N*N);return e[0]*=1/u,e[1]*=1/u,e[2]*=1/u,e})),E}}u.c._GoldbergMeshParser=(e,E)=>ze.Parse(e,E);class ze extends u.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,E){return void 0===E?(e>this.goldbergData.nbUnsharedFaces-1&&(x.d.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(x.d.Warn("Last pole used"),e=11),E>this.goldbergData.nbFacesAtPole-1&&(x.d.Warn("Maximum number of faces at a pole used"),E=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+E)}_changeGoldbergFaceColors(e){for(let H=0;H<e.length;H++){const E=e[H][0],N=e[H][1],u=e[H][2];for(let e=E;e<N+1;e++)this.goldbergData.faceColors[e]=u}const E=[];for(let H=0;H<12;H++)for(let e=0;e<5;e++)E.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);for(let H=12;H<this.goldbergData.faceColors.length;H++)for(let e=0;e<6;e++)E.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);return E}setGoldbergFaceColors(e){const E=this._changeGoldbergFaceColors(e);this.Re(z.g.ColorKind,E)}updateGoldbergFaceColors(e){const E=this._changeGoldbergFaceColors(e);this.updateVerticesData(z.g.ColorKind,E)}_changeGoldbergFaceUVs(e){const E=this.getVerticesData(z.g.UVKind);for(let H=0;H<e.length;H++){const N=e[H][0],u=e[H][1],z=e[H][2],P=e[H][3],M=e[H][4],D=[],A=[];let C,i;for(let e=0;e<5;e++)C=z.x+P*Math.cos(M+e*Math.PI/2.5),i=z.y+P*Math.sin(M+e*Math.PI/2.5),C<0&&(C=0),C>1&&(C=1),D.push(C,i);for(let e=0;e<6;e++)C=z.x+P*Math.cos(M+e*Math.PI/3),i=z.y+P*Math.sin(M+e*Math.PI/3),C<0&&(C=0),C>1&&(C=1),A.push(C,i);for(let e=N;e<Math.min(12,u+1);e++)for(let H=0;H<5;H++)E[10*e+2*H]=D[2*H],E[10*e+2*H+1]=D[2*H+1];for(let e=Math.max(12,N);e<u+1;e++)for(let H=0;H<6;H++)E[12*e-24+2*H]=A[2*H],E[12*e-23+2*H]=A[2*H+1]}return E}setGoldbergFaceUVs(e){const E=this._changeGoldbergFaceUVs(e);this.Re(z.g.UVKind,E)}updateGoldbergFaceUVs(e){const E=this._changeGoldbergFaceUVs(e);this.updateVerticesData(z.g.UVKind,E)}placeOnGoldbergFaceAt(e,E,H){const u=N.jE.RotationFromAxis(this.goldbergData.faceXaxis[E],this.goldbergData.faceYaxis[E],this.goldbergData.faceZaxis[E]);e.rotation=u,e.position=this.goldbergData.faceCenters[E].add(this.goldbergData.faceXaxis[E].scale(H.x)).add(this.goldbergData.faceYaxis[E].scale(H.y)).add(this.goldbergData.faceZaxis[E].scale(H.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const E={};if(E.adjacentFaces=this.goldbergData.adjacentFaces,E.nbSharedFaces=this.goldbergData.nbSharedFaces,E.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,E.nbFaces=this.goldbergData.nbFaces,E.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){E.faceColors=[];for(const e of this.goldbergData.faceColors)E.faceColors.push(e.uM())}if(this.goldbergData.faceCenters){E.faceCenters=[];for(const e of this.goldbergData.faceCenters)E.faceCenters.push(e.uM())}if(this.goldbergData.faceZaxis){E.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)E.faceZaxis.push(e.uM())}if(this.goldbergData.faceYaxis){E.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)E.faceYaxis.push(e.uM())}if(this.goldbergData.faceXaxis){E.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)E.faceXaxis.push(e.uM())}e.goldbergData=E}static Parse(e,E){const H=e.goldbergData;H.faceColors=H.faceColors.map((e=>V.FM.aE(e))),H.faceCenters=H.faceCenters.map((e=>N.jE.aE(e))),H.faceZaxis=H.faceZaxis.map((e=>N.jE.aE(e))),H.faceXaxis=H.faceXaxis.map((e=>N.jE.aE(e))),H.faceYaxis=H.faceYaxis.map((e=>N.jE.aE(e)));const u=new ze(e.name,E);return u.goldbergData=H,u}}var Pe=H(12274);const Me={CreateBox:i.c,CreateTiledBox:h,CreateSphere:S.e,CreateDisc:C.d,CreateIcoSphere:me,CreateRibbon:A,CreateCylinder:r,CreateTorus:f,CreateTorusKnot:s,CreateLineSystem:p.h,AA:p.i,CreateDashedLines:p.e,ExtrudeShape:b,ExtrudeShapeCustom:K,CreateLathe:O,CreateTiledPlane:j,VA:v.c,CreateGround:R.e,CreateTiledGround:R.f,CreateGroundFromHeightMap:R.b,CreatePolygon:o.b,ExtrudePolygon:o.e,CreateTube:T,CreatePolyhedron:d,CreateGeodesic:function(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=E.m||1;N!==Math.floor(N)&&(N=Math.floor(N),x.d.Warn("m not an integer only floor(m) used"));let u=E.n||0;if(u!==Math.floor(u)&&(u=Math.floor(u),x.d.Warn("n not an integer only floor(n) used")),u>N){const e=u;u=N,N=e,x.d.Warn("n > m therefore m and n swapped")}const z=new He;return z.build(N,u),d(e,{custom:ue.BuildGeodesicData(z),size:E.size,sizeX:E.sizeX,sizeY:E.sizeY,sizeZ:E.sizeZ,faceUV:E.faceUV,faceColors:E.faceColors,flat:E.flat,updatable:E.updatable,sideOrientation:E.sideOrientation,frontUVs:E.frontUVs,backUVs:E.backUVs},H)},CreateGoldberg:function(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.size,D=E.sizeX||z||1,A=E.sizeY||z||1,C=E.sizeZ||z||1;let i=E.m||1;i!==Math.floor(i)&&(i=Math.floor(i),x.d.Warn("m not an integer only floor(m) used"));let U=E.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),x.d.Warn("n not an integer only floor(n) used")),U>i){const e=U;U=i,i=e,x.d.Warn("n > m therefore m and n swapped")}const j=new He;j.build(i,U);const F=ue.BuildGeodesicData(j),h=F.toGoldbergPolyhedronData(),S=new ze(e,H);E.sideOrientation=u.c._GetDefaultSideOrientation(E.sideOrientation),S._originalBuilderSideOrientation=E.sideOrientation;(function(e,E){const H=e.size,u=e.sizeX||H||1,z=e.sizeY||H||1,D=e.sizeZ||H||1,A=0===e.sideOrientation?0:e.sideOrientation||P.d.DEFAULTSIDE,C=[],i=[],V=[],U=[];let j=1/0,F=-1/0,h=1/0,S=-1/0;for(let N=0;N<E.vertex.length;N++)j=Math.min(j,E.vertex[N][0]*u),F=Math.max(F,E.vertex[N][0]*u),h=Math.min(h,E.vertex[N][1]*z),S=Math.max(S,E.vertex[N][1]*z);let X=0;for(let P=0;P<E.face.length;P++){const e=E.face[P],H=N.jE.aE(E.vertex[e[0]]),A=N.jE.aE(E.vertex[e[2]]),a=N.jE.aE(E.vertex[e[1]]),W=A.FE(H),r=a.FE(H),Y=N.jE.Cross(r,W).normalize();for(let N=0;N<e.length;N++){V.push(Y.x,Y.y,Y.z);const H=E.vertex[e[N]];C.push(H[0]*u,H[1]*z,H[2]*D);const P=(H[1]*z-h)/(S-h);U.push((H[0]*u-j)/(F-j),M.c?1-P:P)}for(let E=0;E<e.length-2;E++)i.push(X,X+E+2,X+E+1);X+=e.length}P.d._ComputeSides(A,C,i,V,U);const a=new P.d;return a.se=C,a.indices=i,a.pe=V,a.ye=U,a})(E,h).Ke(S,E.updatable),S.goldbergData.nbSharedFaces=F.sharedNodes,S.goldbergData.nbUnsharedFaces=F.poleNodes,S.goldbergData.adjacentFaces=F.adjacentFaces,S.goldbergData.nbFaces=S.goldbergData.nbSharedFaces+S.goldbergData.nbUnsharedFaces,S.goldbergData.nbFacesAtPole=(S.goldbergData.nbUnsharedFaces-12)/12;for(let u=0;u<F.vertex.length;u++)S.goldbergData.faceCenters.push(N.jE.aE(F.vertex[u])),S.goldbergData.faceCenters[u].x*=D,S.goldbergData.faceCenters[u].y*=A,S.goldbergData.faceCenters[u].z*=C,S.goldbergData.faceColors.push(new V.FM(1,1,1,1));for(let u=0;u<h.face.length;u++){const e=h.face[u],E=N.jE.aE(h.vertex[e[0]]),H=N.jE.aE(h.vertex[e[2]]),z=N.jE.aE(h.vertex[e[1]]),P=H.FE(E),M=z.FE(E),D=N.jE.Cross(M,P).normalize(),A=N.jE.Cross(M,D).normalize();S.goldbergData.faceXaxis.push(M.normalize()),S.goldbergData.faceYaxis.push(D),S.goldbergData.faceZaxis.push(A)}return S},CreateDecal:c,CreateCapsule:g,CreateText:Pe.g}},13016:(e,E,H)=>{"use strict";H.d(E,{d:()=>ME});var N=H(11738),u=H(12103);class z extends u.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var P=H(11789),M=(H(11902),H(11690));class D{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(e){this._targetStopDuration!==e&&(this._targetStopDuration=e)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(e){this._animationSheetEnabled!==e&&(this._animationSheetEnabled=e)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.fe().getEngine().getCaps().fragmentDepthSupported}fe(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(e){switch(e){case D.BLENDMODE_MULTIPLYADD:return;case D.BLENDMODE_ADD:e=1;break;case D.BLENDMODE_ONEONE:e=6;break;case D.BLENDMODE_STANDARD:e=2;break;case D.BLENDMODE_MULTIPLY:e=4;break;case D.BLENDMODE_SUBTRACT:e=3}this._engine.setAlphaMode(e)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:N.jE.Zero()}set direction1(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:N.jE.Zero()}set direction2(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:N.jE.Zero()}set minEmitBox(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:N.jE.Zero()}set maxEmitBox(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)}get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e)}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(!e&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=e)}_reset(){}_removeGradientAndTexture(e,E,H){if(!E)return this;let N=0;for(const u of E){if(u.gradient===e){E.splice(N,1);break}N++}return H&&H.dispose(),this}constructor(e){this.animations=[],this.renderingGroupId=0,this.NE=N.jE.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new N.jE(10,10,10),this.onAnimationEnd=null,this.blendMode=D.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new N.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.PA=new N.jE(0,0,0),this._useLogarithmicDepth=!1,this.gravity=N.jE.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new P.FM(1,1,1,1),this.color2=new P.FM(1,1,1,1),this.colorDead=new P.FM(0,0,0,1),this.textureMask=new P.FM(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new z,this.id=e,this.name=e}createPointEmitter(e,E){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new N.jE(0,1,0),arguments.length>2&&void 0!==arguments[2]||new N.jE(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new N.jE(0,1,0),arguments.length>4&&void 0!==arguments[4]||new N.jE(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new N.jE(0,1,0),arguments.length>3&&void 0!==arguments[3]||new N.jE(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(e,E,H,N){throw new Error("Method not implemented.")}}D.BLENDMODE_ONEONE=0,D.BLENDMODE_STANDARD=1,D.BLENDMODE_ADD=2,D.BLENDMODE_MULTIPLY=3,D.BLENDMODE_MULTIPLYADD=4,D.BLENDMODE_SUBTRACT=-1,(0,M.g)("BABYLON.BaseParticleSystem",D);var A=H(11756),C=H(11552);class i{constructor(){this.direction1=new N.jE(0,1,0),this.direction2=new N.jE(0,1,0),this.minEmitBox=new N.jE(-.5,-.5,-.5),this.maxEmitBox=new N.jE(.5,.5,.5)}startDirectionFunction(e,E,H,u){const z=(0,A.RandomRange)(this.direction1.x,this.direction2.x),P=(0,A.RandomRange)(this.direction1.y,this.direction2.y),M=(0,A.RandomRange)(this.direction1.z,this.direction2.z);if(u)return E.x=z,E.y=P,void(E.z=M);N.jE.TransformNormalFromFloatsToRef(z,P,M,e,E)}startPositionFunction(e,E,H,u){const z=(0,A.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),P=(0,A.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),M=(0,A.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(u)return E.x=z,E.y=P,void(E.z=M);N.jE.TransformCoordinatesFromFloatsToRef(z,P,M,e,E)}clone(){const e=new i;return C.e.DeepCopy(this,e),e}applyToShader(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2),e.setVector3("minEmitBox",this.minEmitBox),e.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(e){e.addUniform("direction1",3),e.addUniform("direction2",3),e.addUniform("minEmitBox",3),e.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.direction1=this.direction1.uM(),e.direction2=this.direction2.uM(),e.minEmitBox=this.minEmitBox.uM(),e.maxEmitBox=this.maxEmitBox.uM(),e}parse(e){N.jE.FromArrayToRef(e.direction1,0,this.direction1),N.jE.FromArrayToRef(e.direction2,0,this.direction2),N.jE.FromArrayToRef(e.minEmitBox,0,this.minEmitBox),N.jE.FromArrayToRef(e.maxEmitBox,0,this.maxEmitBox)}}class V{get radius(){return this._radius}set radius(e){this._radius=e,this._buildHeight()}get angle(){return this._angle}set angle(e){this._angle=e,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=H,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=E,this.radius=e}startDirectionFunction(e,E,H,u){u?N.TmpVectors.jE[0].P(H.GM).normalize():H.position.subtractToRef(e.getTranslation(),N.TmpVectors.jE[0]).normalize();const z=(0,A.RandomRange)(0,this.directionRandomizer),P=(0,A.RandomRange)(0,this.directionRandomizer),M=(0,A.RandomRange)(0,this.directionRandomizer);E.x=N.TmpVectors.jE[0].x+z,E.y=N.TmpVectors.jE[0].y+P,E.z=N.TmpVectors.jE[0].z+M,E.normalize()}startPositionFunction(e,E,H,u){const z=(0,A.RandomRange)(0,2*Math.PI);let P;this.emitFromSpawnPointOnly?P=1e-4:(P=(0,A.RandomRange)(0,this.heightRange),P=1-P*P);let M=this._radius-(0,A.RandomRange)(0,this._radius*this.radiusRange);M*=P;const D=M*Math.sin(z),C=M*Math.cos(z),i=P*this._height;if(u)return E.x=D,E.y=i,void(E.z=C);N.jE.TransformCoordinatesFromFloatsToRef(D,i,C,e,E)}clone(){const e=new V(this._radius,this._angle,this.directionRandomizer);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat2("radius",this._radius,this.radiusRange),e.setFloat("coneAngle",this._angle),e.setFloat2("height",this._height,this.heightRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",2),e.addUniform("coneAngle",1),e.addUniform("height",2),e.addUniform("directionRandomizer",1)}getEffectDefines(){let e="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(e+="\n#define CONEEMITTERSPAWNPOINT"),e}getClassName(){return"ConeParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this._radius,e.angle=this._angle,e.directionRandomizer=this.directionRandomizer,e.radiusRange=this.radiusRange,e.heightRange=this.heightRange,e.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,e}parse(e){this.radius=e.radius,this.angle=e.angle,this.directionRandomizer=e.directionRandomizer,this.radiusRange=void 0!==e.radiusRange?e.radiusRange:1,this.heightRange=void 0!==e.radiusRange?e.heightRange:1,this.emitFromSpawnPointOnly=void 0!==e.emitFromSpawnPointOnly&&e.emitFromSpawnPointOnly}}class U extends V{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0);super(e,E),this.direction1=H,this.direction2=u}startDirectionFunction(e,E){const H=(0,A.RandomRange)(this.direction1.x,this.direction2.x),u=(0,A.RandomRange)(this.direction1.y,this.direction2.y),z=(0,A.RandomRange)(this.direction1.z,this.direction2.z);N.jE.TransformNormalFromFloatsToRef(H,u,z,e,E)}clone(){const e=new U(this.radius,this.angle,this.direction1,this.direction2);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const e=super.serialize();return e.direction1=this.direction1.uM(),e.direction2=this.direction2.uM(),e}parse(e){super.parse(e),this.direction1.P(e.direction1),this.direction2.P(e.direction2)}}class j{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=e,this.height=E,this.radiusRange=H,this.directionRandomizer=u,this._tempVector=N.jE.Zero()}startDirectionFunction(e,E,H,u,z){H.position.subtractToRef(e.getTranslation(),this._tempVector),this._tempVector.normalize(),N.jE.TransformNormalToRef(this._tempVector,z,this._tempVector);const P=(0,A.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let M=Math.atan2(this._tempVector.x,this._tempVector.z);M+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=P,this._tempVector.x=Math.sin(M),this._tempVector.z=Math.cos(M),this._tempVector.normalize(),u?E.P(this._tempVector):N.jE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,e,E)}startPositionFunction(e,E,H,u){const z=(0,A.RandomRange)(-this.height/2,this.height/2),P=(0,A.RandomRange)(0,2*Math.PI),M=(0,A.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),D=Math.sqrt(M)*this.radius,C=D*Math.cos(P),i=D*Math.sin(P);u?E.VM(C,z,i):N.jE.TransformCoordinatesFromFloatsToRef(C,z,i,e,E)}clone(){const e=new j(this.radius,this.directionRandomizer);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("height",1),e.addUniform("radiusRange",1),e.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this.radius,e.height=this.height,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e}parse(e){this.radius=e.radius,this.height=e.height,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer}}class F extends j{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.jE(0,1,0);super(e,E,H),this.direction1=u,this.direction2=z}startDirectionFunction(e,E,H,u){const z=(0,A.RandomRange)(this.direction1.x,this.direction2.x),P=(0,A.RandomRange)(this.direction1.y,this.direction2.y),M=(0,A.RandomRange)(this.direction1.z,this.direction2.z);u?E.VM(z,P,M):N.jE.TransformNormalFromFloatsToRef(z,P,M,e,E)}clone(){const e=new F(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("height",1),e.addUniform("radiusRange",1),e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const e=super.serialize();return e.direction1=this.direction1.uM(),e.direction2=this.direction2.uM(),e}parse(e){super.parse(e),N.jE.FromArrayToRef(e.direction1,0,this.direction1),N.jE.FromArrayToRef(e.direction2,0,this.direction2)}}class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.radiusRange=E,this.directionRandomizer=H}startDirectionFunction(e,E,H,u){const z=H.position.FE(e.getTranslation()).normalize(),P=(0,A.RandomRange)(0,this.directionRandomizer),M=(0,A.RandomRange)(0,this.directionRandomizer),D=(0,A.RandomRange)(0,this.directionRandomizer);z.x+=P,z.y+=M,z.z+=D,z.normalize(),u?E.P(z):N.jE.TransformNormalFromFloatsToRef(z.x,z.y,z.z,e,E)}startPositionFunction(e,E,H,u){const z=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),P=(0,A.RandomRange)(0,1),M=(0,A.RandomRange)(0,2*Math.PI),D=Math.acos(2*P-1),C=z*Math.cos(M)*Math.sin(D),i=z*Math.cos(D),V=z*Math.sin(M)*Math.sin(D);u?E.VM(C,Math.abs(i),V):N.jE.TransformCoordinatesFromFloatsToRef(C,Math.abs(i),V,e,E)}clone(){const e=new h(this.radius,this.directionRandomizer);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e}parse(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer}}class S{constructor(){this.direction1=new N.jE(0,1,0),this.direction2=new N.jE(0,1,0)}startDirectionFunction(e,E,H,u){const z=(0,A.RandomRange)(this.direction1.x,this.direction2.x),P=(0,A.RandomRange)(this.direction1.y,this.direction2.y),M=(0,A.RandomRange)(this.direction1.z,this.direction2.z);u?E.VM(z,P,M):N.jE.TransformNormalFromFloatsToRef(z,P,M,e,E)}startPositionFunction(e,E,H,u){u?E.VM(0,0,0):N.jE.TransformCoordinatesFromFloatsToRef(0,0,0,e,E)}clone(){const e=new S;return C.e.DeepCopy(this,e),e}applyToShader(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.direction1=this.direction1.uM(),e.direction2=this.direction2.uM(),e}parse(e){N.jE.FromArrayToRef(e.direction1,0,this.direction1),N.jE.FromArrayToRef(e.direction2,0,this.direction2)}}class X{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.radiusRange=E,this.directionRandomizer=H}startDirectionFunction(e,E,H,u){const z=H.position.FE(e.getTranslation()).normalize(),P=(0,A.RandomRange)(0,this.directionRandomizer),M=(0,A.RandomRange)(0,this.directionRandomizer),D=(0,A.RandomRange)(0,this.directionRandomizer);z.x+=P,z.y+=M,z.z+=D,z.normalize(),u?E.P(z):N.jE.TransformNormalFromFloatsToRef(z.x,z.y,z.z,e,E)}startPositionFunction(e,E,H,u){const z=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),P=(0,A.RandomRange)(0,1),M=(0,A.RandomRange)(0,2*Math.PI),D=Math.acos(2*P-1),C=z*Math.cos(M)*Math.sin(D),i=z*Math.cos(D),V=z*Math.sin(M)*Math.sin(D);u?E.VM(C,i,V):N.jE.TransformCoordinatesFromFloatsToRef(C,i,V,e,E)}clone(){const e=new X(this.radius,this.directionRandomizer);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e}parse(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer}}class a extends X{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.jE(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0);super(e),this.direction1=E,this.direction2=H}startDirectionFunction(e,E){const H=(0,A.RandomRange)(this.direction1.x,this.direction2.x),u=(0,A.RandomRange)(this.direction1.y,this.direction2.y),z=(0,A.RandomRange)(this.direction1.z,this.direction2.z);N.jE.TransformNormalFromFloatsToRef(H,u,z,e,E)}clone(){const e=new a(this.radius,this.direction1,this.direction2);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const e=super.serialize();return e.direction1=this.direction1.uM(),e.direction2=this.direction2.uM(),e}parse(e){super.parse(e),this.direction1.P(e.direction1),this.direction2.P(e.direction2)}}class W{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(e,E,H,u){const z=N.TmpVectors.jE[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,H,z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,H,z);const e=N.TmpVectors.jE[1];z.subtractToRef(H.position,e),e.scaleToRef(1/H.lifeTime,z)}else z.set(0,0,0);u?E.P(z):N.jE.TransformNormalToRef(z,e,E)}startPositionFunction(e,E,H,u){const z=N.TmpVectors.jE[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,H,z):z.set(0,0,0),u?E.P(z):N.jE.TransformCoordinatesToRef(z,e,E)}clone(){const e=new W;return C.e.DeepCopy(this,e),e}applyToShader(e){}buildUniformLayout(e){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.particlePositionGenerator=this.particlePositionGenerator,e.particleDestinationGenerator=this.particleDestinationGenerator,e}parse(e){e.particlePositionGenerator&&(this.particlePositionGenerator=e.particlePositionGenerator),e.particleDestinationGenerator&&(this.particleDestinationGenerator=e.particleDestinationGenerator)}}var r=H(11818);class Y{get mesh(){return this._mesh}set mesh(e){this._mesh!==e&&(this._mesh=e,e?(this._indices=e.CM(),this._positions=e.getVerticesData(r.g.PositionKind),this._normals=e.getVerticesData(r.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=N.jE.Zero(),this._mesh=null,this.direction1=new N.jE(0,1,0),this.direction2=new N.jE(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=e}startDirectionFunction(e,E,H,u){if(this.useMeshNormalsForDirection&&this._normals)return void N.jE.TransformNormalToRef(this._storedNormal,e,E);const z=(0,A.RandomRange)(this.direction1.x,this.direction2.x),P=(0,A.RandomRange)(this.direction1.y,this.direction2.y),M=(0,A.RandomRange)(this.direction1.z,this.direction2.z);u?E.VM(z,P,M):N.jE.TransformNormalFromFloatsToRef(z,P,M,e,E)}startPositionFunction(e,E,H,u){if(!this._indices||!this._positions)return;const z=3*(Math.random()*(this._indices.length/3)|0),P=Math.random(),M=Math.random()*(1-P),D=1-P-M,A=this._indices[z],C=this._indices[z+1],i=this._indices[z+2],V=N.TmpVectors.jE[0],U=N.TmpVectors.jE[1],j=N.TmpVectors.jE[2],F=N.TmpVectors.jE[3];N.jE.FromArrayToRef(this._positions,3*A,V),N.jE.FromArrayToRef(this._positions,3*C,U),N.jE.FromArrayToRef(this._positions,3*i,j),F.x=P*V.x+M*U.x+D*j.x,F.y=P*V.y+M*U.y+D*j.y,F.z=P*V.z+M*U.z+D*j.z,u?E.VM(F.x,F.y,F.z):N.jE.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,e,E),this.useMeshNormalsForDirection&&this._normals&&(N.jE.FromArrayToRef(this._normals,3*A,V),N.jE.FromArrayToRef(this._normals,3*C,U),N.jE.FromArrayToRef(this._normals,3*i,j),this._storedNormal.x=P*V.x+M*U.x+D*j.x,this._storedNormal.y=P*V.y+M*U.y+D*j.y,this._storedNormal.z=P*V.z+M*U.z+D*j.z)}clone(){const e=new Y(this.mesh);return C.e.DeepCopy(this,e),e}applyToShader(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var e;const E={};return E.type=this.getClassName(),E.direction1=this.direction1.uM(),E.direction2=this.direction2.uM(),E.meshId=null===(e=this.mesh)||void 0===e?void 0:e.id,E.useMeshNormalsForDirection=this.useMeshNormalsForDirection,E}parse(e,E){N.jE.FromArrayToRef(e.direction1,0,this.direction1),N.jE.FromArrayToRef(e.direction2,0,this.direction2),e.meshId&&E&&(this.mesh=E.getLastMeshById(e.meshId)),this.useMeshNormalsForDirection=e.useMeshNormalsForDirection}}class f{_isUbo(e){return void 0!==e.addUniform}constructor(e){this._isUbo(e)?(this.setMatrix3x3=e.updateMatrix3x3.bind(e),this.setMatrix2x2=e.updateMatrix2x2.bind(e),this.setFloat=e.updateFloat.bind(e),this.setFloat2=e.updateFloat2.bind(e),this.setFloat3=e.updateFloat3.bind(e),this.setFloat4=e.updateFloat4.bind(e),this.setFloatArray=e.updateFloatArray.bind(e),this.setArray=e.updateArray.bind(e),this.setIntArray=e.updateIntArray.bind(e),this.setMatrix=e.MM.bind(e),this.setMatrices=e.updateMatrices.bind(e),this.setVector3=e.updateVector3.bind(e),this.setVector4=e.updateVector4.bind(e),this.setColor3=e.updateColor3.bind(e),this.setColor4=e.updateColor4.bind(e),this.setDirectColor4=e.updateDirectColor4.bind(e),this.setInt=e.updateInt.bind(e),this.setInt2=e.updateInt2.bind(e),this.setInt3=e.updateInt3.bind(e),this.setInt4=e.updateInt4.bind(e)):(this.setMatrix3x3=e.setMatrix3x3.bind(e),this.setMatrix2x2=e.setMatrix2x2.bind(e),this.setFloat=e.setFloat.bind(e),this.setFloat2=e.setFloat2.bind(e),this.setFloat3=e.setFloat3.bind(e),this.setFloat4=e.setFloat4.bind(e),this.setFloatArray=e.setFloatArray.bind(e),this.setArray=e.setArray.bind(e),this.setIntArray=e.setIntArray.bind(e),this.setMatrix=e.setMatrix.bind(e),this.setMatrices=e.setMatrices.bind(e),this.setVector3=e.setVector3.bind(e),this.setVector4=e.setVector4.bind(e),this.setColor3=e.setColor3.bind(e),this.setColor4=e.setColor4.bind(e),this.setDirectColor4=e.setDirectColor4.bind(e),this.setInt=e.setInt.bind(e),this.setInt2=e.setInt2.bind(e),this.setInt3=e.setInt3.bind(e),this.setInt4=e.setInt4.bind(e))}}var w=H(11633);const s="gpuUpdateParticlesPixelShader",p="#version 300 es\nvoid main() {discard;}\n";w.d.ShadersStore[s]||(w.d.ShadersStore[s]=p);const o="gpuUpdateParticlesVertexShader",y="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";w.d.ShadersStore[o]||(w.d.ShadersStore[o]=y);(0,M.g)("BABYLON.WebGL2ParticleSystem",class{constructor(e,E){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=e,this._engine=E,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var e;return(null===(e=this._updateEffect)||void 0===e?void 0:e.isReady())??!1}createUpdateBuffer(e){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof W&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=e,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new f(this._updateEffect)}createVertexBuffers(e,E){this._updateVAO.push(this._createUpdateVAO(e)),this._renderVAO.push(this._engine.recordVertexArrayObject(E,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=E}createParticleBuffer(e){return e}bindDrawBuffers(e,E,H){H?this._engine.bindBuffers(this._renderVertexBuffers,H,E):this._engine.bindVertexArrayObject(this._renderVAO[e],null)}preUpdateParticleBuffer(){const e=this._engine;if(this._engine.enableEffect(this._updateEffect),!e.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(e,E,H){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[e],null);const N=this._engine;N.bindTransformFeedbackBuffer(E.getBuffer()),N.setRasterizerState(!1),N.beginTransformFeedback(!0),N.drawArraysType(3,0,H),N.endTransformFeedback(),N.setRasterizerState(!0),N.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);this._updateVAO.length=0;for(let e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO.length=0}_createUpdateVAO(e){const E={};E.position=e.createVertexBuffer("position",0,3);let H=3;E.age=e.createVertexBuffer("age",H,1),H+=1,E.size=e.createVertexBuffer("size",H,3),H+=3,E.life=e.createVertexBuffer("life",H,1),H+=1,E.seed=e.createVertexBuffer("seed",H,4),H+=4,E.direction=e.createVertexBuffer("direction",H,3),H+=3,this._parent.particleEmitterType instanceof W&&(E.initialPosition=e.createVertexBuffer("initialPosition",H,3),H+=3),this._parent._colorGradientsTexture||(E.color=e.createVertexBuffer("color",H,4),H+=4),this._parent._isBillboardBased||(E.initialDirection=e.createVertexBuffer("initialDirection",H,3),H+=3),this._parent.noiseTexture&&(E.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",H,3),H+=3,E.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",H,3),H+=3),this._parent._angularSpeedGradientsTexture?(E.angle=e.createVertexBuffer("angle",H,1),H+=1):(E.angle=e.createVertexBuffer("angle",H,2),H+=2),this._parent._isAnimationSheetEnabled&&(E.cellIndex=e.createVertexBuffer("cellIndex",H,1),H+=1,this._parent.spriteRandomStartCell&&(E.cellStartOffset=e.createVertexBuffer("cellStartOffset",H,1),H+=1));const N=this._engine.recordVertexArrayObject(E,null,this._updateEffect);return this._engine.bindArrayBuffer(null),N}});class b{constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3?arguments[3]:void 0;this._engine=e,this._label=N,this._engine._storageBuffers.push(this),this._create(E,H)}_create(e,E){this._bufferSize=e,this._creationFlags=E,this._buffer=this._engine.createStorageBuffer(e,E,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(e,E,H){this._buffer&&this._engine.updateStorageBuffer(this._buffer,e,E,H)}async read(e,E,H,N){return await this._engine.readFromStorageBuffer(this._buffer,e,E,H,N)}dispose(){const e=this._engine._storageBuffers,E=e.indexOf(this);-1!==E&&(e[E]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var K=H(11717),l=H(11723),O=H(11776),v=H(11712),R=H(12026),T=H(11548),L=H(11669),d=H(11944);class G{constructor(){this._gpuTimeInFrameId=-1,this.counter=new d.b}_addDuration(e,E){e<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==e?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(E,!1),this._gpuTimeInFrameId=e):this.counter.addCount(E,!1))}}var me=H(11611);class Q{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=e,this._engine=E,this.uniqueId=R.b.UniqueId,E.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new G),this._engine.getCaps().supportComputeShaders?N.bindingsMapping?(this._context=E.createComputeContext(),this._shaderPath=H,this._options={bindingsMapping:{},defines:[],...N}):T.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):T.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(e,E){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=this._bindings[e];this._bindings[e]={type:H?0:4,object:E,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!N||N.object!==E||N.type!==this._bindings[e].type)}setStorageTexture(e,E){const H=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==E),this._bindings[e]={type:1,object:E,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setExternalTexture(e,E){const H=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==E),this._bindings[e]={type:6,object:E,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setVideoTexture(e,E){return!!E.externalTexture&&(this.setExternalTexture(e,E.externalTexture),!0)}setUniformBuffer(e,E){const H=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==E),this._bindings[e]={type:Q._BufferIsDataBuffer(E)?7:2,object:E,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setStorageBuffer(e,E){const H=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==E),this._bindings[e]={type:Q._BufferIsDataBuffer(E)?7:3,object:E,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setTextureSampler(e,E){const H=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!H||!E.compareSampler(H.object)),this._bindings[e]={type:5,object:E,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}isReady(){let e=this._effect;for(const u in this._bindings){const e=this._bindings[u],E=e.type,H=e.object;switch(E){case 0:case 4:case 1:if(!H.isReady())return!1;break;case 6:if(!H.isReady())return!1;break}}const E=[],H=this._shaderPath;if(this._options.defines)for(let u=0;u<this._options.defines.length;u++)E.push(this._options.defines[u]);const N=E.join("\n");return this._cachedDefines!==N&&(this._cachedDefines=N,e=this._engine.createComputeEffect(H,{defines:N,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=e),!!e.isReady()}dispatch(e,E,H){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,e,E,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const H=Q._BufferIsDataBuffer(e)?e:e.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,H,E,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const E in this._bindings){const H=this._bindings[E];if(!this._options.bindingsMapping[E])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+E+"'");switch(H.type){case 0:{const N=this._samplers[E],u=H.object;var e;if(!N||!u._texture||!N.compareSampler(u._texture))this._samplers[E]=(new L.b).setParameters(u.wrapU,u.wrapV,u.wrapR,u.anisotropicFilteringLevel,u._texture.samplingMode,null===(e=u._texture)||void 0===e?void 0:e._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const e=H.object;e.getBuffer()!==H.buffer&&(H.buffer=e.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((u=>{(0,me.f)((()=>this.dispatch(e,E,H)),u,void 0,N)}))}serialize(){const e=O.d.Serialize(this);e.options=this._options,e.shaderPath=this._shaderPath,e.eV={},e.textures={};for(const E in this._bindings){const H=this._bindings[E],N=H.object;switch(H.type){case 0:case 4:case 1:{const u=N.serialize();u&&(e.textures[E]=u,e.eV[E]={type:H.type});break}}}return e}static Parse(e,E,H){const N=O.d.Parse((()=>new Q(e.name,E.getEngine(),e.shaderPath,e.options)),e,E,H);for(const u in e.textures){const z=e.eV[u],P=v.b.Parse(e.textures[u],E,H);0===z.type?N.setTexture(u,P):4===z.type?N.setTexture(u,P,!1):N.setStorageTexture(u,P)}return N}static _BufferIsDataBuffer(e){return void 0!==e.underlyingResource}}(0,K.e)([(0,l.S)()],Q.prototype,"name",void 0),(0,K.e)([(0,l.S)()],Q.prototype,"fastMode",void 0),(0,M.g)("BABYLON.ComputeShader",Q);var Z=H(11986);const k="gpuUpdateParticlesComputeShader",J="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";w.d.ShadersStoreWGSL[k]||(w.d.ShadersStoreWGSL[k]=J);(0,M.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(e,E){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=e,this._engine=E}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var e;return(null===(e=this._updateComputeShader)||void 0===e?void 0:e.isReady())??!1}createUpdateBuffer(e){var E;const H={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(H.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(H.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(H.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(H.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(H.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(H.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(H.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new Q("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:H,defines:e.split("\n")}),null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=new Z.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new f(this._simParamsComputeShader)}createVertexBuffers(e,E){this._renderVertexBuffers.push(E)}createParticleBuffer(e){const E=new b(this._engine,4*e.length,11,"ComputeShaderParticleSystemBuffer");return E.update(e),this._bufferComputeShader.push(E),E.getBuffer()}bindDrawBuffers(e,E,H){this._engine.bindBuffers(this._renderVertexBuffers[e],H,E)}preUpdateParticleBuffer(){}updateParticleBuffer(e,E,H){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[e]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^e]),this._updateComputeShader.dispatch(Math.ceil(H/64))}releaseBuffers(){var e;for(let E=0;E<this._bufferComputeShader.length;++E)this._bufferComputeShader[E].dispose();this._bufferComputeShader.length=0,null===(e=this._simParamsComputeShader)||void 0===e||e.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class B{constructor(e,E,H){this.gradient=e,this.color1=E,this.color2=H}getColorToRef(e){this.color2?P.FM.LerpToRef(this.color1,this.color2,Math.random(),e):e.P(this.color1)}}class I{constructor(e,E){this.gradient=e,this.color=E}}class t{constructor(e,E,H){this.gradient=e,this.factor1=E,this.factor2=H}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class q{static GetCurrentGradient(e,E,H){if(E[0].gradient>e)return void H(E[0],E[0],1);for(let u=0;u<E.length-1;u++){const N=E[u],z=E[u+1];if(e>=N.gradient&&e<=z.gradient){return void H(N,z,(e-N.gradient)/(z.gradient-N.gradient))}}const N=E.length-1;H(E[N],E[N],1)}}var c=H(11541),n=H(12192),g=H(11579);class x{constructor(e){this.particleSystem=e,this.position=N.jE.Zero(),this.direction=N.jE.Zero(),this.color=new P.FM(0,0,0,0),this.colorStep=new P.FM(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new N.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new P.FM(0,0,0,0),this._currentColor2=new P.FM(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=x._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let e=this.age,E=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===E?(E=1,e=this._randomCellOffset):e+=this._randomCellOffset);const H=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let N;N=this._initialSpriteCellLoop?(0,A.Clamp)(e*E%this.lifeTime/this.lifeTime):(0,A.Clamp)(e*E/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+N*H|0}_inheritParticleInfoToSubEmitter(e){if(e.particleSystem.NE.position){const E=e.particleSystem.NE;if(E.position.P(this.position),e.inheritDirection){const e=N.TmpVectors.jE[0];this.direction.normalizeToRef(e),E.setDirection(e,0,Math.PI/2)}}else{e.particleSystem.NE.P(this.position)}this.direction.scaleToRef(e.inheritedVelocityAmount/2,N.TmpVectors.jE[0]),e.particleSystem._inheritedVelocityOffset.P(N.TmpVectors.jE[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const e of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(e)}_reset(){this.age=0,this.id=x._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(e){e.position.P(this.position),this._initialDirection?e._initialDirection?e._initialDirection.P(this._initialDirection):e._initialDirection=this._initialDirection.clone():e._initialDirection=null,e.direction.P(this.direction),this.GM&&(e.GM?e.GM.P(this.GM):e.GM=this.GM.clone()),e.color.P(this.color),e.colorStep.P(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e._randomCellOffset=this._randomCellOffset,e.size=this.size,e.scale.P(this.scale),e.angle=this.angle,e.angularSpeed=this.angularSpeed,e.particleSystem=this.particleSystem,e.cellIndex=this.cellIndex,e.id=this.id,e._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(e._currentColorGradient=this._currentColorGradient,e._currentColor1.P(this._currentColor1),e._currentColor2.P(this._currentColor2)),this._currentSizeGradient&&(e._currentSizeGradient=this._currentSizeGradient,e._currentSize1=this._currentSize1,e._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(e._currentAngularSpeedGradient=this._currentAngularSpeedGradient,e._currentAngularSpeed1=this._currentAngularSpeed1,e._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(e._currentVelocityGradient=this._currentVelocityGradient,e._currentVelocity1=this._currentVelocity1,e._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(e._currentLimitVelocityGradient=this._currentLimitVelocityGradient,e._currentLimitVelocity1=this._currentLimitVelocity1,e._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(e._currentDragGradient=this._currentDragGradient,e._currentDrag1=this._currentDrag1,e._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(e._initialStartSpriteCellId=this._initialStartSpriteCellId,e._initialEndSpriteCellId=this._initialEndSpriteCellId,e._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(e.remapData&&this.remapData?e.remapData.P(this.remapData):e.remapData=new N.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.P(this._randomNoiseCoordinates1),e._randomNoiseCoordinates2.P(this._randomNoiseCoordinates2)):(e._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),e._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}x._Count=0;var ee=H(11851),Ee=(H(11899),H(12085)),He=H(12080),Ne=H(11979);function ue(e,E){const H=(0,A.RandomRange)(0,1);P.FM.LerpToRef(E.color1,E.color2,H,e.color),E.colorDead.subtractToRef(e.color,E._colorDiff),E._colorDiff.scaleToRef(1/e.lifeTime,e.colorStep)}function ze(e,E){e._currentColorGradient=E._colorGradients[0],e._currentColorGradient.getColorToRef(e.color),e._currentColor1.P(e.color),E._colorGradients.length>1?E._colorGradients[1].getColorToRef(e._currentColor2):e._currentColor2.P(e.color)}function Pe(e,E){const H=E._colorGradients;q.GetCurrentGradient(E._ratio,H,((E,H,N)=>{E!==e._currentColorGradient&&(e._currentColor1.P(e._currentColor2),H.getColorToRef(e._currentColor2),e._currentColorGradient=E),P.FM.LerpToRef(e._currentColor1,e._currentColor2,N,e.color)}))}function Me(e,E){e.colorStep.scaleToRef(E._scaledUpdateSpeed,E._scaledColorStep),e.color.addInPlace(E._scaledColorStep),e.color.a<0&&(e.color.a=0)}function De(e,E){q.GetCurrentGradient(E._ratio,E._angularSpeedGradients,((E,H,N)=>{E!==e._currentAngularSpeedGradient&&(e._currentAngularSpeed1=e._currentAngularSpeed2,e._currentAngularSpeed2=H.getFactor(),e._currentAngularSpeedGradient=E),e.angularSpeed=(0,A.Lerp)(e._currentAngularSpeed1,e._currentAngularSpeed2,N)}))}function Ae(e,E){e.angle+=e.angularSpeed*E._scaledUpdateSpeed}function Ce(e,E){E.particleEmitterType.startDirectionFunction(E._emitterWorldMatrix,e.direction,e,E.isLocal,E._emitterInverseWorldMatrix)}function ie(e,E){E.startDirectionFunction(E._emitterWorldMatrix,e.direction,e,E.isLocal)}function Ve(e,E){e._currentVelocityGradient=E._velocityGradients[0],e._currentVelocity1=e._currentVelocityGradient.getFactor(),E._velocityGradients.length>1?e._currentVelocity2=E._velocityGradients[1].getFactor():e._currentVelocity2=e._currentVelocity1}function Ue(e,E){e._currentLimitVelocityGradient=E._limitVelocityGradients[0],e._currentLimitVelocity1=e._currentLimitVelocityGradient.getFactor(),E._limitVelocityGradients.length>1?e._currentLimitVelocity2=E._limitVelocityGradients[1].getFactor():e._currentLimitVelocity2=e._currentLimitVelocity1}function je(e,E){q.GetCurrentGradient(E._ratio,E._velocityGradients,((H,N,u)=>{H!==e._currentVelocityGradient&&(e._currentVelocity1=e._currentVelocity2,e._currentVelocity2=N.getFactor(),e._currentVelocityGradient=H),E._directionScale*=(0,A.Lerp)(e._currentVelocity1,e._currentVelocity2,u)}))}function Fe(e,E){q.GetCurrentGradient(E._ratio,E._limitVelocityGradients,((H,N,u)=>{H!==e._currentLimitVelocityGradient&&(e._currentLimitVelocity1=e._currentLimitVelocity2,e._currentLimitVelocity2=N.getFactor(),e._currentLimitVelocityGradient=H);const z=(0,A.Lerp)(e._currentLimitVelocity1,e._currentLimitVelocity2,u);e.direction.length()>z&&e.direction.scaleInPlace(E.limitVelocityDamping)}))}function he(e,E){e.direction.scaleToRef(E._directionScale,E._scaledDirection)}function Se(e,E){E.particleEmitterType.startPositionFunction(E._emitterWorldMatrix,e.position,e,E.isLocal)}function Xe(e,E){E.startPositionFunction(E._emitterWorldMatrix,e.position,e,E.isLocal)}function ae(e,E){e.GM?e.GM.P(e.position):e.GM=e.position.clone(),N.jE.TransformCoordinatesToRef(e.GM,E._emitterWorldMatrix,e.position)}function We(e,E){E.isLocal&&e.GM?(e.GM.addInPlace(E._scaledDirection),N.jE.TransformCoordinatesToRef(e.GM,E._emitterWorldMatrix,e.position)):e.position.addInPlace(E._scaledDirection)}function re(e,E){e._currentDragGradient=E._dragGradients[0],e._currentDrag1=e._currentDragGradient.getFactor(),E._dragGradients.length>1?e._currentDrag2=E._dragGradients[1].getFactor():e._currentDrag2=e._currentDrag1}function Ye(e,E){q.GetCurrentGradient(E._ratio,E._dragGradients,((H,N,u)=>{H!==e._currentDragGradient&&(e._currentDrag1=e._currentDrag2,e._currentDrag2=N.getFactor(),e._currentDragGradient=H);const z=(0,A.Lerp)(e._currentDrag1,e._currentDrag2,u);E._scaledDirection.scaleInPlace(1-z)}))}function fe(e,E){e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.VM(Math.random(),Math.random(),Math.random()),e._randomNoiseCoordinates2.VM(Math.random(),Math.random(),Math.random())):(e._randomNoiseCoordinates1=new N.jE(Math.random(),Math.random(),Math.random()),e._randomNoiseCoordinates2=new N.jE(Math.random(),Math.random(),Math.random()))}function we(e,E){const H=E._noiseTextureData,u=E._noiseTextureSize;if(H&&u&&e._randomNoiseCoordinates1){const z=E._fetchR(e._randomNoiseCoordinates1.x,e._randomNoiseCoordinates1.y,u.width,u.height,H),P=E._fetchR(e._randomNoiseCoordinates1.z,e._randomNoiseCoordinates2.x,u.width,u.height,H),M=E._fetchR(e._randomNoiseCoordinates2.y,e._randomNoiseCoordinates2.z,u.width,u.height,H),D=N.TmpVectors.jE[0],A=N.TmpVectors.jE[1];D.VM((2*z-1)*E.noiseStrength.x,(2*P-1)*E.noiseStrength.y,(2*M-1)*E.noiseStrength.z),D.scaleToRef(E._tempScaledUpdateSpeed,A),e.direction.addInPlace(A)}}function se(e,E){E.gravity.scaleToRef(E._tempScaledUpdateSpeed,E._scaledGravity),e.direction.addInPlace(E._scaledGravity)}function pe(e,E){e.size=(0,A.RandomRange)(E.minSize,E.maxSize),e.scale.VM((0,A.RandomRange)(E.minScaleX,E.maxScaleX),(0,A.RandomRange)(E.minScaleY,E.maxScaleY))}function oe(e,E){e._currentSizeGradient=E._sizeGradients[0],e._currentSize1=e._currentSizeGradient.getFactor(),e.size=e._currentSize1,E._sizeGradients.length>1?e._currentSize2=E._sizeGradients[1].getFactor():e._currentSize2=e._currentSize1,e.scale.VM((0,A.RandomRange)(E.minScaleX,E.maxScaleX),(0,A.RandomRange)(E.minScaleY,E.maxScaleY))}function ye(e,E){const H=E._actualFrame/E.targetStopDuration;q.GetCurrentGradient(H,E._startSizeGradients,((H,N,u)=>{H!==E._currentStartSizeGradient&&(E._currentStartSize1=E._currentStartSize2,E._currentStartSize2=N.getFactor(),E._currentStartSizeGradient=H);const z=(0,A.Lerp)(E._currentStartSize1,E._currentStartSize2,u);e.scale.scaleInPlace(z)}))}function be(e,E){q.GetCurrentGradient(E._ratio,E._sizeGradients,((E,H,N)=>{E!==e._currentSizeGradient&&(e._currentSize1=e._currentSize2,e._currentSize2=H.getFactor(),e._currentSizeGradient=E),e.size=(0,A.Lerp)(e._currentSize1,e._currentSize2,N)}))}function Ke(e,E){e.remapData=new N.Vector4(0,1,0,1)}function le(e,E){E._colorRemapGradients&&E._colorRemapGradients.length>0&&q.GetCurrentGradient(E._ratio,E._colorRemapGradients,((E,H,N)=>{const u=(0,A.Lerp)(E.factor1,H.factor1,N),z=(0,A.Lerp)(E.factor2,H.factor2,N);e.remapData.x=u,e.remapData.y=z-u})),E._alphaRemapGradients&&E._alphaRemapGradients.length>0&&q.GetCurrentGradient(E._ratio,E._alphaRemapGradients,((E,H,N)=>{const u=(0,A.Lerp)(E.factor1,H.factor1,N),z=(0,A.Lerp)(E.factor2,H.factor2,N);e.remapData.z=u,e.remapData.w=z-u}))}function Oe(e,E){const H=(0,A.Clamp)(E._actualFrame/E.targetStopDuration);q.GetCurrentGradient(H,E._lifeTimeGradients,((E,N)=>{const u=E,z=N,P=u.getFactor(),M=z.getFactor(),D=(H-u.gradient)/(z.gradient-u.gradient);e.lifeTime=(0,A.Lerp)(P,M,D)})),E._emitPower=(0,A.RandomRange)(E.minEmitPower,E.maxEmitPower)}function ve(e,E){e.lifeTime=(0,A.RandomRange)(E.minLifeTime,E.maxLifeTime),E._emitPower=(0,A.RandomRange)(E.minEmitPower,E.maxEmitPower)}function Re(e,E){0===E._emitPower?(e._initialDirection?e._initialDirection.P(e.direction):e._initialDirection=e.direction.clone(),e.direction.set(0,0,0)):(e._initialDirection=null,e.direction.scaleInPlace(E._emitPower)),e.direction.addInPlace(E._inheritedVelocityOffset)}function Te(e,E){e.angularSpeed=(0,A.RandomRange)(E.minAngularSpeed,E.maxAngularSpeed),e.angle=(0,A.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function Le(e,E){e._currentAngularSpeedGradient=E._angularSpeedGradients[0],e.angularSpeed=e._currentAngularSpeedGradient.getFactor(),e._currentAngularSpeed1=e.angularSpeed,E._angularSpeedGradients.length>1?e._currentAngularSpeed2=E._angularSpeedGradients[1].getFactor():e._currentAngularSpeed2=e._currentAngularSpeed1,e.angle=(0,A.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function de(e,E){e._initialStartSpriteCellId=E.startSpriteCellID,e._initialEndSpriteCellId=E.endSpriteCellID,e._initialSpriteCellLoop=E.spriteCellLoop}function Ge(e,E){e.previousItem=E.previousItem,e.nextItem=E,E.previousItem&&(E.previousItem.nextItem=e),E.previousItem=e}function mE(e,E){e.previousItem=E,e.nextItem=E.nextItem,E.nextItem&&(E.nextItem.previousItem=e),E.nextItem=e}function Qe(e,E){let H=E;for(;H.nextItem;)H=H.nextItem;e.previousItem=H,e.nextItem=H.nextItem,H.nextItem=e}function Ze(e){e.previousItem&&(e.previousItem.nextItem=e.nextItem),e.nextItem&&(e.nextItem.previousItem=e.previousItem)}class ke extends D{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(e){this._startDirectionFunction!==e&&(this._startDirectionFunction=e,this._directionProcessing.process=e?ie:Ce)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(e){this._startPositionFunction!==e&&(this._startPositionFunction=e,this._positionCreation.process=e?Xe:Se)}set onDispose(e){this._onDisposeObserver&&this.cP.remove(this._onDisposeObserver),this._onDisposeObserver=this.cP.add(e)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect(),e?(this._rampCreation={process:Ke,previousItem:null,nextItem:null},mE(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:le,previousItem:null,nextItem:null},mE(this._remapGradientProcessing,this._gravityProcessing)):(Ze(this._rampCreation),Ze(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(e){this._isLocal!==e&&(this._isLocal=e,e?(this._isLocalCreation={process:ae,previousItem:null,nextItem:null},mE(this._isLocalCreation,this._positionCreation)):Ze(this._isLocalCreation))}get particles(){return this.qi}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(e){this._animationSheetEnabled!==e&&(this._animationSheetEnabled=e,e?(this._sheetCreation={process:de,previousItem:null,nextItem:null},mE(this._sheetCreation,this._colorCreation)):Ze(this._sheetCreation),this._reset())}getActiveCount(){return this.qi.length}getClassName(){return"ei"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var e;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(e=this._customWrappers[E])||void 0===e?void 0:e.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[e]??this._customWrappers[0]}setCustomEffect(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new ee.d(this._engine),this._customWrappers[E].effect=e,this._customWrappers[E].drawContext&&(this._customWrappers[E].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new c.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(e){if(this.noiseTexture!==e){if(this._noiseTexture=e,!e)return Ze(this._noiseCreation),void Ze(this._noiseProcessing);this._noiseCreation={process:fe,previousItem:null,nextItem:null},mE(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:we,previousItem:null,nextItem:null},mE(this._noiseProcessing,this._positionProcessing)}}constructor(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(e),this._emitterInverseWorldMatrix=N.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new N.jE,this.cP=new c.d,this.onStoppedObservable=new c.d,this.onStartedObservable=new c.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.qi=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new P.FM(0,0,0,0),this._colorDiff=new P.FM(0,0,0,0),this._scaledDirection=N.jE.Zero(),this._scaledGravity=N.jE.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=e=>{},this.recycleParticle=e=>{const E=this.qi.pop();E!==e&&E.copyTo(e),this._stockParticles.push(E)},this._createParticle=()=>{let e;return 0!==this._stockParticles.length?(e=this._stockParticles.pop(),e._reset()):e=new x(this),this._prepareParticle(e),e},this.paused=!1,this._shadersLoaded=!1,this._capacity=E,this._epsilon=M,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=N.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||g.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ii.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:ve,previousItem:null,nextItem:null},this._positionCreation={process:Se,previousItem:null,nextItem:null},mE(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Ce,previousItem:null,nextItem:null},mE(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Re,previousItem:null,nextItem:null},mE(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:pe,previousItem:null,nextItem:null},mE(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Te,previousItem:null,nextItem:null},mE(this._angleCreation,this._sizeCreation),this._colorCreation={process:ue,previousItem:null,nextItem:null},mE(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,D||(this._colorProcessing={process:Me,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ae,previousItem:null,nextItem:null},mE(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:he,previousItem:null,nextItem:null},mE(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:We,previousItem:null,nextItem:null},mE(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:se,previousItem:null,nextItem:null},mE(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ee.d(this._engine)},this._customWrappers[0].effect=u,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new i,this.updateFunction=e=>{var E;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(E=this.noiseTexture.getContent())||void 0===E||E.then((e=>{this._noiseTextureData=e})));const H=e===this.qi;for(let N=0;N<e.length;N++){const E=e[N];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const u=E.age;if(E.age+=this._tempScaledUpdateSpeed,E.age>E.lifeTime){const e=E.age-u,H=E.lifeTime-u;this._tempScaledUpdateSpeed=H*this._tempScaledUpdateSpeed/e,E.age=E.lifeTime}this._ratio=E.age/E.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let z=this._updateQueueStart;for(;z;)z.process(E,this),z=z.nextItem;if(this._isAnimationSheetEnabled&&!D&&E.updateCellIndex(),E._inheritParticleInfoToSubEmitters(),E.age>=E.lifeTime){if(this._emitFromParticle(E),E._attachedSubEmitters){for(const e of E._attachedSubEmitters)e.particleSystem.disposeOnStop=!0,e.particleSystem.stop();E._attachedSubEmitters=null}this.recycleParticle(E),H&&N--}else;}}}serialize(e){throw new Error("Method not implemented.")}clone(e,E){throw new Error("Method not implemented.")}_addFactorGradient(e,E,H,N){const u=new t(E,H,N);e.push(u),e.sort(((e,E)=>e.gradient<E.gradient?-1:e.gradient>E.gradient?1:0))}_removeFactorGradient(e,E){if(!e)return;let H=0;for(const N of e){if(N.gradient===E){e.splice(H,1);break}H++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Oe:this._lifeTimeCreation.process=ve}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ye,previousItem:null,nextItem:null},mE(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Ze(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(e){this.targetStopDuration!==e&&(this._targetStopDuration=e,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(e,E,H){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,E,H),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this._syncLifeTimeCreation(),this}addSizeGradient(e,E,H){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=oe,this._sizeGradientProcessing={process:be,previousItem:null,nextItem:null},Ge(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,e,E,H),this}removeSizeGradient(e){var E;return this._removeFactorGradient(this._sizeGradients,e),0===(null===(E=this._sizeGradients)||void 0===E?void 0:E.length)&&(Ze(this._sizeGradientProcessing),this._sizeCreation.process=pe),this}addColorRemapGradient(e,E,H){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,E,H),this}removeColorRemapGradient(e){return this._removeFactorGradient(this._colorRemapGradients,e),this}addAlphaRemapGradient(e,E,H){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,E,H),this}removeAlphaRemapGradient(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this}addAngularSpeedGradient(e,E,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Le,this._angularSpeedGradientProcessing={process:De,previousItem:null,nextItem:null},Ge(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,e,E,H),this}removeAngularSpeedGradient(e){var E;return this._removeFactorGradient(this._angularSpeedGradients,e),0===(null===(E=this._angularSpeedGradients)||void 0===E?void 0:E.length)&&(this._angleCreation.process=Te,Ze(this._angularSpeedGradientProcessing)),this}addVelocityGradient(e,E,H){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Ve,previousItem:null,nextItem:null},mE(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:je,previousItem:null,nextItem:null},Ge(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,e,E,H),this}removeVelocityGradient(e){var E;return this._removeFactorGradient(this._velocityGradients,e),0===(null===(E=this._velocityGradients)||void 0===E?void 0:E.length)&&(Ze(this._velocityCreation),Ze(this._velocityGradientProcessing)),this}addLimitVelocityGradient(e,E,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Ue,previousItem:null,nextItem:null},mE(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Fe,previousItem:null,nextItem:null},mE(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,e,E,H),this}removeLimitVelocityGradient(e){var E;return this._removeFactorGradient(this._limitVelocityGradients,e),0===(null===(E=this._limitVelocityGradients)||void 0===E?void 0:E.length)&&(Ze(this._limitVelocityCreation),Ze(this._limitVelocityGradientProcessing)),this}addDragGradient(e,E,H){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:re,previousItem:null,nextItem:null},Ge(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Ye,previousItem:null,nextItem:null},Ge(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,e,E,H),this}removeDragGradient(e){var E;return this._removeFactorGradient(this._dragGradients,e),0===(null===(E=this._dragGradients)||void 0===E?void 0:E.length)&&(Ze(this._dragCreation),Ze(this._dragGradientProcessing)),this}addEmitRateGradient(e,E,H){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,E,H),this}removeEmitRateGradient(e){return this._removeFactorGradient(this._emitRateGradients,e),this}addStartSizeGradient(e,E,H){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,E,H),this._syncStartSizeCreation(),this}removeStartSizeGradient(e){return this._removeFactorGradient(this._startSizeGradients,e),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const e=new Uint8Array(4*this._rawTextureWidth),E=P.TmpColors.XE[0];for(let H=0;H<this._rawTextureWidth;H++){const N=H/this._rawTextureWidth;q.GetCurrentGradient(N,this._rampGradients,((N,u,z)=>{P.XE.LerpToRef(N.color,u.color,z,E),e[4*H]=255*E.r,e[4*H+1]=255*E.g,e[4*H+2]=255*E.b,e[4*H+3]=255}))}this._rampGradientsTexture=n.e.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((e,E)=>e.gradient<E.gradient?-1:e.gradient>E.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(e,E){this._rampGradients||(this._rampGradients=[]);const H=new I(e,E);return this._rampGradients.push(H),this._syncRampGradientTexture(),this}removeRampGradient(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(e,E,H){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ze,this._colorProcessing.process=Pe);const N=new B(e,E,H);return this._colorGradients.push(N),this._colorGradients.sort(((e,E)=>e.gradient<E.gradient?-1:e.gradient>E.gradient?1:0)),this}removeColorGradient(e){if(!this._colorGradients)return this;let E=0;for(const H of this._colorGradients){if(H.gradient===e){this._colorGradients.splice(E,1);break}E++}return 0===this._colorGradients.length&&(this._colorCreation.process=ue,this._colorProcessing.process=Me),this}resetDrawCache(){if(this._drawWrappers){for(const e of this._drawWrappers)if(e)for(const E of e)null===E||void 0===E||E.dispose();this._drawWrappers=[]}}_fetchR(e,E,H,N,u){return u[4*(((e=.5*Math.abs(e)+.5)*H%H|0)+((E=.5*Math.abs(E)+.5)*N%N|0)*H)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const e=this._engine,E=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*E),this._vertexBuffer=new r.c(e,this._vertexData,!0,E);let H=0;const N=this._vertexBuffer.createVertexBuffer(r.g.PositionKind,H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.g.PositionKind]=N,H+=3;const u=this._vertexBuffer.createVertexBuffer(r.g.ColorKind,H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.g.ColorKind]=u,H+=4;const z=this._vertexBuffer.createVertexBuffer("angle",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=z,H+=1;const P=this._vertexBuffer.createVertexBuffer("size",H,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=P,H+=2,this._isAnimationSheetEnabled){const e=this._vertexBuffer.createVertexBuffer("cellIndex",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=e,H+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const e=this._vertexBuffer.createVertexBuffer("direction",H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=e,H+=3}if(this._useRampGradients){const e=this._vertexBuffer.createVertexBuffer("remapData",H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=e,H+=4}let M;if(this._useInstancing){const E=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new r.c(e,E,!1,2),M=this._spriteBuffer.createVertexBuffer("offset",0,2)}else M=this._vertexBuffer.createVertexBuffer("offset",H,2,this._vertexBufferSize,this._useInstancing),H+=2;this._vertexBuffers.offset=M,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const e=[],E=[];let H=0;for(let N=0;N<this._capacity;N++)e.push(H),e.push(H+1),e.push(H+2),e.push(H),e.push(H+2),e.push(H+3),E.push(H,H+1,H+1,H+2,H+2,H+3,H+3,H,H,H+3),H+=4;this._indexBuffer=this._engine.createIndexBuffer(e),this._linesIndexBuffer=this._engine.createIndexBuffer(E)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout((()=>{this.start(0)}),e);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var E;-1!==(null===(E=this.NE)||void 0===E?void 0:E.getClassName().indexOf("Mesh"))&&this.NE.DM(!0);const e=this.noiseTexture;if(e&&e.onGeneratedObservable)e.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),e.render()}))}));else for(let E=0;E<this.preWarmCycles;E++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(e))}_postStop(e){}reset(){this._stockParticles.length=0,this.qi.length=0}_appendParticleVertex(e,E,H,u){let z=e*this._vertexBufferSize;if(this._vertexData[z++]=E.position.x+this.PA.x,this._vertexData[z++]=E.position.y+this.PA.y,this._vertexData[z++]=E.position.z+this.PA.z,this._vertexData[z++]=E.color.r,this._vertexData[z++]=E.color.g,this._vertexData[z++]=E.color.b,this._vertexData[z++]=E.color.a,this._vertexData[z++]=E.angle,this._vertexData[z++]=E.scale.x*E.size,this._vertexData[z++]=E.scale.y*E.size,this._isAnimationSheetEnabled&&(this._vertexData[z++]=E.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[z++]=E.direction.x,this._vertexData[z++]=E.direction.y,this._vertexData[z++]=E.direction.z);else if(E._initialDirection){let e=E._initialDirection;this.isLocal&&(N.jE.TransformNormalToRef(e,this._emitterWorldMatrix,N.TmpVectors.jE[0]),e=N.TmpVectors.jE[0]),0===e.x&&0===e.z&&(e.x=.001),this._vertexData[z++]=e.x,this._vertexData[z++]=e.y,this._vertexData[z++]=e.z}else{let e=E.direction;this.isLocal&&(N.jE.TransformNormalToRef(e,this._emitterWorldMatrix,N.TmpVectors.jE[0]),e=N.TmpVectors.jE[0]),0===e.x&&0===e.z&&(e.x=.001),this._vertexData[z++]=e.x,this._vertexData[z++]=e.y,this._vertexData[z++]=e.z}this._useRampGradients&&E.remapData&&(this._vertexData[z++]=E.remapData.x,this._vertexData[z++]=E.remapData.y,this._vertexData[z++]=E.remapData.z,this._vertexData[z++]=E.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===H?H=this._epsilon:1===H&&(H=1-this._epsilon),0===u?u=this._epsilon:1===u&&(u=1-this._epsilon)),this._vertexData[z++]=H,this._vertexData[z++]=u)}_prepareParticle(e){}_createNewOnes(e){let E;for(let H=0;H<e&&this.qi.length!==this._capacity;H++){E=this._createParticle(),this.qi.push(E);let e=this._createQueueStart;for(;e;)e.process(E,this),e=e.nextItem;E._inheritParticleInfoToSubEmitters()}}_update(e){if(this._alive=this.qi.length>0,this.NE.position){const e=this.NE;this._emitterWorldMatrix=e.getWorldMatrix()}else{const e=this.NE;this._emitterWorldMatrix=N.Matrix.Translation(e.x,e.y,e.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.qi),this._createNewOnes(e)}static _GetAttributeNamesOrOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=[r.g.PositionKind,r.g.ColorKind,"angle","offset","size"];return e&&N.push("cellIndex"),E||N.push("direction"),H&&N.push("remapData"),N}static _GetEffectCreationOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Ee.d)(N),e&&N.push("particlesInfos"),E&&N.push("logarithmicDepthConstant"),H&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(e,E){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ee.j)(this,this._scene,e),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&e.push("#define FOG")),this._isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&e.push("#define LOGARITHMICDEPTH"),E===D.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&e.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case 2:e.push("#define BILLBOARDY");break;case 8:case 9:e.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&e.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:e.push("#define BILLBOARDMODE_ALL")}H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(e,E,H){E.push(...ke._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),e.push(...ke._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Ne.f)(e,this._imageProcessingConfigurationDefines),(0,Ne.d)(H,this._imageProcessingConfigurationDefines))}_getWrapper(e){const E=this._getCustomDrawWrapper(e);if(null!==E&&void 0!==E&&E.effect)return E;const H=[];this.fillDefines(H,e);const N=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let u=this._drawWrappers[N];u||(u=this._drawWrappers[N]=[]);let z=u[e];z||(z=new ee.d(this._engine),z.drawContext&&(z.drawContext.useInstancing=this._useInstancing),u[e]=z);const P=H.join("\n");if(z.defines!==P){const e=[],E=[],H=[];this.fillUniformsAttributesAndSamplerNames(E,e,H),z.setEffect(this._engine.createEffect("particles",e,E,H,P,void 0,void 0,void 0,void 0,this._shaderLanguage),P)}return z}animate(){var e;let E,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!H&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(H?this.preWarmStepOffset:(null===(e=this._scene)||void 0===e?void 0:e.getAnimationRatio())||1),this.manualEmitCount>-1)E=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let e=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const E=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(E,this._emitRateGradients,((E,H,N)=>{E!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=H.getFactor(),this._currentEmitRateGradient=E),e=(0,A.Lerp)(this._currentEmitRate1,this._currentEmitRate2,N)}))}E=e*this._scaledUpdateSpeed|0,this._newPartsExcess+=e*this._scaledUpdateSpeed-E}if(this._newPartsExcess>1&&(E+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?E=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(E),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!H){let e=0;for(let E=0;E<this.qi.length;E++){const H=this.qi[E];this._appendParticleVertices(e,H),e+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.qi.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(e,E){this._appendParticleVertex(e++,E,0,0),this._useInstancing||(this._appendParticleVertex(e++,E,1,0),this._appendParticleVertex(e++,E,1,1),this._appendParticleVertex(e++,E,0,1))}rebuild(){var e;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(e=this._spriteBuffer)||void 0===e||e._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!ke.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(H.bind(H,13187)),Promise.resolve().then(H.bind(H,13143))])):await Promise.all([Promise.resolve().then(H.bind(H,13132)),Promise.resolve().then(H.bind(H,13120))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.NE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==D.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(D.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(D.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(e){const E=this._getWrapper(e),H=E.effect,u=this._engine;u.enableEffect(E);const z=this.defaultViewMatrix??this._scene.getViewMatrix();if(H.setTexture("diffuseSampler",this.particleTexture),H.setMatrix("view",z),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const e=this.particleTexture.getBaseSize();H.setFloat3("particlesInfos",this.spriteCellWidth/e.width,this.spriteCellHeight/e.height,this.spriteCellWidth/e.width)}if(H.setVector2("translationPivot",this.translationPivot),H.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const e=this._scene.activeCamera;H.setVector3("eyePosition",e.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),H.setTexture("rampSampler",this._rampGradientsTexture));const P=H.defines;var M,D,A,C,i,V;(this._scene&&((0,Ee.f)(H,this,this._scene),this.applyFog&&(0,He.d)(this._scene,void 0,H)),P.indexOf("#define BILLBOARDMODE_ALL")>=0&&(z.invertToRef(N.TmpVectors.Matrix[0]),H.setMatrix("invView",N.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?u.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,H):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,H)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?u.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBuffer:this._indexBuffer,H):u.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null,H);(this.useLogarithmicDepth&&this._scene&&(0,He.j)(P,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(e),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),this._useInstancing)?null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?u.drawElementsType(6,0,10,this.qi.length):u.drawArraysType(7,0,4,this.qi.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?u.drawElementsType(1,0,10*this.qi.length):u.drawElementsType(0,0,6*this.qi.length);return this.qi.length}render(){if(!this.isReady()||!this.qi.length)return 0;const e=this._engine;e.setState&&(e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0));let E=0;return E=this.blendMode===D.BLENDMODE_MULTIPLYADD?this._render(D.BLENDMODE_MULTIPLY)+this._render(D.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),E}_onDispose(){}dispose(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(E,H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const e=this._scene.Ii.indexOf(this);e>-1&&this._scene.Ii.splice(e,1),this._scene._activeParticleSystems.dispose()}this.cP.notifyObservers(this),this.cP.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}ke.ForceGLSL=!1;var Je,Be=H(11565);!function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(Je||(Je={}));class Ie{constructor(e){if(this.particleSystem=e,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!e.NE||!e.NE.dispose){const E=(0,M.e)("BABYLON.AbstractMesh");e.NE=new E("SubemitterSystemEmitter",e.fe()),e._disposeEmitterOnDispose=!0}}clone(){let e=this.particleSystem.NE;if(e){if(e instanceof N.jE)e=e.clone();else if(-1!==e.getClassName().indexOf("Mesh")){e=new((0,M.e)("BABYLON.Mesh"))("",e.fe()),e.isVisible=!1}}else e=new N.jE;const E=new Ie(this.particleSystem.clone(this.particleSystem.name,e));return E.particleSystem.name+="Clone",E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem._disposeEmitterOnDispose=!0,E.particleSystem.disposeOnStop=!0,E}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem=this.particleSystem.serialize(e),E}static _ParseParticleSystem(e,E,H){throw(0,Be.b)("ParseParticle")}static Parse(e,E,H){const N=e.particleSystem,u=new Ie(Ie._ParseParticleSystem(N,E,H,!0));return u.type=e.type,u.inheritDirection=e.inheritDirection,u.inheritedVelocityAmount=e.inheritedVelocityAmount,u.particleSystem._isSubEmitter=!0,u}dispose(){this.particleSystem.dispose()}}var te=H(11618);function qe(e,E){const H=new S;return H.direction1=e,H.direction2=E,H}function ce(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ne(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ge(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.jE(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0);return new a(e,E,H)}function xe(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function eE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.jE(0,1,0);return new F(e,E,H,u,z)}function EE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new V(e,E)}function HE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0);return new U(e,E,H,u)}const NE=N.jE.Zero(),uE=N.jE.Zero(),zE=N.jE.Zero();class PE{constructor(){this.strength=0,this.position=N.jE.Zero()}_processParticle(e,E){this.position.subtractToRef(e.position,NE);const H=NE.lengthSquared()+1;NE.normalize().scaleToRef(this.strength/H,uE),uE.scaleToRef(E._tempScaledUpdateSpeed,zE),e.direction.addInPlace(zE)}serialize(){return{position:this.position.uM(),strength:this.strength}}}class ME extends ke{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=e=>{if(!this._subEmitters||0===this._subEmitters.length)return;const E=Math.floor(Math.random()*this._subEmitters.length);for(const H of this._subEmitters[E])if(1===H.type){const E=H.clone();e._inheritParticleInfoToSubEmitter(E),E.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(E.particleSystem),E.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(e,E){const H=qe(e,E);return this.particleEmitterType=H,H}get flowMap(){return this._flowMap}set flowMap(e){this._flowMap!==e&&(this._flowMap=e,this._flowMapUpdate&&(Ze(this._flowMapUpdate),this._flowMapUpdate=null),e&&(this._flowMapUpdate={process:e=>{var E;const H=null===(E=this.fe())||void 0===E?void 0:E.getTransformMatrix();this._flowMap._processParticle(e,this.flowMapStrength*this._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null},mE(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(e){this._attractors.push(e),1===this._attractors.length&&(this._attractorUpdate={process:e=>{for(const E of this._attractors)E._processParticle(e,this)},previousItem:null,nextItem:null},mE(this._attractorUpdate,this._directionProcessing))}removeAttractor(e){const E=this._attractors.indexOf(e);-1!==E&&this._attractors.splice(E,1),0===this._attractors.length&&Ze(this._attractorUpdate)}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(e)}createHemisphericEmitter(){const e=ce(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createSphereEmitter(){const e=ne(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createDirectedSphereEmitter(){const e=ge(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.jE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0));return this.particleEmitterType=e,e}createCylinderEmitter(){const e=xe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=e,e}createDirectedCylinderEmitter(){const e=eE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.jE(0,1,0));return this.particleEmitterType=e,e}createConeEmitter(){const e=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=e,e}createDirectedConeEmitter(){const e=HE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0));return this.particleEmitterType=e,e}createBoxEmitter(e,E,H,N){const u=new i;return this.particleEmitterType=u,this.direction1=e,this.direction2=E,this.minEmitBox=H,this.maxEmitBox=N,u}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const e of this.subEmitters)e instanceof ME?this._subEmitters.push([new Ie(e)]):e instanceof Ie?this._subEmitters.push([e]):e instanceof Array&&this._subEmitters.push(e)}_stopSubEmitters(){if(this.activeSubSystems){for(const e of this.activeSubSystems)e.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const e=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==e&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(e){e&&this._stopSubEmitters()}_prepareParticle(e){if(this._subEmitters&&this._subEmitters.length>0){const E=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];e._attachedSubEmitters=[];for(const H of E)if(0===H.type){const E=H.clone();e._attachedSubEmitters.push(E),E.particleSystem.start()}}}_onDispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),e&&this.particles)for(const H of this.particles)if(H._attachedSubEmitters)for(let e=H._attachedSubEmitters.length-1;e>=0;e-=1)H._attachedSubEmitters[e].dispose();if(E&&this.activeSubSystems)for(let H=this.activeSubSystems.length-1;H>=0;H-=1)this.activeSubSystems[H].dispose();if(this._subEmitters&&this._subEmitters.length){for(let e=0;e<this._subEmitters.length;e++)for(const E of this._subEmitters[e])E.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.NE&&this.NE.dispose&&this.NE.dispose(!0)}static _Parse(e,E,H,u){let z;z=H instanceof te.c?null:H;const D=(0,M.e)("BABYLON.Texture");if(D&&z&&(e.texture?E.particleTexture=D.Parse(e.texture,z,u):e.textureName&&(E.particleTexture=new D(u+e.textureName,z,!1,void 0===e.invertY||e.invertY),E.particleTexture.name=e.textureName)),e.emitterId||0===e.emitterId||void 0!==e.NE?e.emitterId&&z?E.NE=z.getLastMeshById(e.emitterId):E.NE=N.jE.aE(e.NE):E.NE=N.jE.Zero(),E.isLocal=!!e.isLocal,void 0!==e.renderingGroupId&&(E.renderingGroupId=e.renderingGroupId),void 0!==e.isBillboardBased&&(E.isBillboardBased=e.isBillboardBased),void 0!==e.billboardMode&&(E.billboardMode=e.billboardMode),void 0!==e.useLogarithmicDepth&&(E.useLogarithmicDepth=e.useLogarithmicDepth),e.animations){for(let H=0;H<e.animations.length;H++){const N=e.animations[H],u=(0,M.e)("BABYLON.Animation");u&&E.animations.push(u.Parse(N))}E.beginAnimationOnStart=e.beginAnimationOnStart,E.beginAnimationFrom=e.beginAnimationFrom,E.beginAnimationTo=e.beginAnimationTo,E.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&z&&z.beginAnimation(E,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),E.startDelay=0|e.startDelay,E.minAngularSpeed=e.minAngularSpeed,E.maxAngularSpeed=e.maxAngularSpeed,E.minSize=e.minSize,E.maxSize=e.maxSize,e.minScaleX&&(E.minScaleX=e.minScaleX,E.maxScaleX=e.maxScaleX,E.minScaleY=e.minScaleY,E.maxScaleY=e.maxScaleY),void 0!==e.preWarmCycles&&(E.preWarmCycles=e.preWarmCycles,E.preWarmStepOffset=e.preWarmStepOffset),void 0!==e.minInitialRotation&&(E.minInitialRotation=e.minInitialRotation,E.maxInitialRotation=e.maxInitialRotation),E.minLifeTime=e.minLifeTime,E.maxLifeTime=e.maxLifeTime,E.minEmitPower=e.minEmitPower,E.maxEmitPower=e.maxEmitPower,E.emitRate=e.emitRate,E.gravity=N.jE.aE(e.gravity),e.noiseStrength&&(E.noiseStrength=N.jE.aE(e.noiseStrength)),E.color1=P.FM.aE(e.color1),E.color2=P.FM.aE(e.color2),E.colorDead=P.FM.aE(e.colorDead),E.updateSpeed=e.updateSpeed,E.targetStopDuration=e.targetStopDuration,E.blendMode=e.blendMode,e.colorGradients)for(const N of e.colorGradients)E.addColorGradient(N.gradient,P.FM.aE(N.color1),N.color2?P.FM.aE(N.color2):void 0);if(e.rampGradients){for(const H of e.rampGradients)E.addRampGradient(H.gradient,P.XE.aE(H.color));E.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(const N of e.colorRemapGradients)E.addColorRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.alphaRemapGradients)for(const N of e.alphaRemapGradients)E.addAlphaRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.sizeGradients)for(const N of e.sizeGradients)E.addSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.angularSpeedGradients)for(const N of e.angularSpeedGradients)E.addAngularSpeedGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.velocityGradients)for(const N of e.velocityGradients)E.addVelocityGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.dragGradients)for(const N of e.dragGradients)E.addDragGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.emitRateGradients)for(const N of e.emitRateGradients)E.addEmitRateGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.startSizeGradients)for(const N of e.startSizeGradients)E.addStartSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.lifeTimeGradients)for(const N of e.lifeTimeGradients)E.addLifeTimeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(e.limitVelocityGradients){for(const H of e.limitVelocityGradients)E.addLimitVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);E.limitVelocityDamping=e.limitVelocityDamping}if(e.noiseTexture&&z){const H=(0,M.e)("BABYLON.ProceduralTexture");E.noiseTexture=H.Parse(e.noiseTexture,z,u)}let A;if(e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":A=new X;break;case"SphereDirectedParticleEmitter":A=new a;break;case"ConeEmitter":case"ConeParticleEmitter":A=new V;break;case"ConeDirectedParticleEmitter":A=new U;break;case"CylinderParticleEmitter":A=new j;break;case"CylinderDirectedParticleEmitter":A=new F;break;case"HemisphericParticleEmitter":A=new h;break;case"PointParticleEmitter":A=new S;break;case"MeshParticleEmitter":A=new Y;break;case"CustomParticleEmitter":A=new W;break;default:A=new i}A.parse(e.particleEmitterType,z)}else A=new i,A.parse(e,z);E.particleEmitterType=A,E.startSpriteCellID=e.startSpriteCellID,E.endSpriteCellID=e.endSpriteCellID,E.spriteCellLoop=e.spriteCellLoop??!0,E.spriteCellWidth=e.spriteCellWidth,E.spriteCellHeight=e.spriteCellHeight,E.spriteCellChangeSpeed=e.spriteCellChangeSpeed,E.spriteRandomStartCell=e.spriteRandomStartCell,E.disposeOnStop=e.disposeOnStop??!1,E.manualEmitCount=e.manualEmitCount??-1}static Parse(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const M=e.name;let D,A,C=null,i=null;if(E instanceof te.c?D=E:(A=E,D=A.getEngine()),e.customShader&&D.createEffectForParticles){i=e.customShader;const E=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";C=D.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,E)}const V=new ME(M,z||e.fM,E,C,e.isAnimationSheetEnabled);if(V.customShader=i,V._rootUrl=H,e.id&&(V.id=e.id),e.subEmitters){V.subEmitters=[];for(const N of e.subEmitters){const e=[];for(const u of N)e.push(Ie.Parse(u,E,H));V.subEmitters.push(e)}}if(e.attractors)for(const P of e.attractors){const e=new PE;e.position=N.jE.aE(P.position),e.strength=P.strength,V.addAttractor(e)}return ME._Parse(e,V,E,H),e.textureMask&&(V.textureMask=P.FM.aE(e.textureMask)),e.PA&&(V.PA=N.jE.aE(e.PA)),e.preventAutoStart&&(V.preventAutoStart=e.preventAutoStart),u||V.preventAutoStart||V.start(),V}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};if(ME._Serialize(E,this,e),E.textureMask=this.textureMask.uM(),E.customShader=this.customShader,E.preventAutoStart=this.preventAutoStart,E.PA=this.PA.uM(),this.subEmitters){E.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const H of this._subEmitters){const N=[];for(const E of H)N.push(E.serialize(e));E.subEmitters.push(N)}}if(this._attractors&&this._attractors.length){E.attractors=[];for(const e of this._attractors)E.attractors.push(e.serialize())}return E}static _Serialize(e,E,H){if(e.name=E.name,e.id=E.id,e.fM=E.getCapacity(),e.disposeOnStop=E.disposeOnStop,e.manualEmitCount=E.manualEmitCount,E.NE.position){const H=E.NE;e.emitterId=H.id}else{const H=E.NE;e.NE=H.uM()}E.particleEmitterType&&(e.particleEmitterType=E.particleEmitterType.serialize()),E.particleTexture&&(H?e.texture=E.particleTexture.serialize():(e.textureName=E.particleTexture.name,e.invertY=!!E.particleTexture._invertY)),e.isLocal=E.isLocal,O.d.AppendSerializedAnimations(E,e),e.beginAnimationOnStart=E.beginAnimationOnStart,e.beginAnimationFrom=E.beginAnimationFrom,e.beginAnimationTo=E.beginAnimationTo,e.beginAnimationLoop=E.beginAnimationLoop,e.startDelay=E.startDelay,e.renderingGroupId=E.renderingGroupId,e.isBillboardBased=E.isBillboardBased,e.billboardMode=E.billboardMode,e.minAngularSpeed=E.minAngularSpeed,e.maxAngularSpeed=E.maxAngularSpeed,e.minSize=E.minSize,e.maxSize=E.maxSize,e.minScaleX=E.minScaleX,e.maxScaleX=E.maxScaleX,e.minScaleY=E.minScaleY,e.maxScaleY=E.maxScaleY,e.minEmitPower=E.minEmitPower,e.maxEmitPower=E.maxEmitPower,e.minLifeTime=E.minLifeTime,e.maxLifeTime=E.maxLifeTime,e.emitRate=E.emitRate,e.gravity=E.gravity.uM(),e.noiseStrength=E.noiseStrength.uM(),e.color1=E.color1.uM(),e.color2=E.color2.uM(),e.colorDead=E.colorDead.uM(),e.updateSpeed=E.updateSpeed,e.targetStopDuration=E.targetStopDuration,e.blendMode=E.blendMode,e.preWarmCycles=E.preWarmCycles,e.preWarmStepOffset=E.preWarmStepOffset,e.minInitialRotation=E.minInitialRotation,e.maxInitialRotation=E.maxInitialRotation,e.startSpriteCellID=E.startSpriteCellID,e.spriteCellLoop=E.spriteCellLoop,e.endSpriteCellID=E.endSpriteCellID,e.spriteCellChangeSpeed=E.spriteCellChangeSpeed,e.spriteCellWidth=E.spriteCellWidth,e.spriteCellHeight=E.spriteCellHeight,e.spriteRandomStartCell=E.spriteRandomStartCell,e.isAnimationSheetEnabled=E.isAnimationSheetEnabled,e.useLogarithmicDepth=E.useLogarithmicDepth;const N=E.getColorGradients();if(N){e.colorGradients=[];for(const E of N){const H={gradient:E.gradient,color1:E.color1.uM()};E.color2?H.color2=E.color2.uM():H.color2=E.color1.uM(),e.colorGradients.push(H)}}const u=E.getRampGradients();if(u){e.rampGradients=[];for(const E of u){const H={gradient:E.gradient,color:E.color.uM()};e.rampGradients.push(H)}e.useRampGradients=E.useRampGradients}const z=E.getColorRemapGradients();if(z){e.colorRemapGradients=[];for(const E of z){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.colorRemapGradients.push(H)}}const P=E.getAlphaRemapGradients();if(P){e.alphaRemapGradients=[];for(const E of P){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.alphaRemapGradients.push(H)}}const M=E.getSizeGradients();if(M){e.sizeGradients=[];for(const E of M){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.sizeGradients.push(H)}}const D=E.getAngularSpeedGradients();if(D){e.angularSpeedGradients=[];for(const E of D){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.angularSpeedGradients.push(H)}}const A=E.getVelocityGradients();if(A){e.velocityGradients=[];for(const E of A){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.velocityGradients.push(H)}}const C=E.getDragGradients();if(C){e.dragGradients=[];for(const E of C){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.dragGradients.push(H)}}const i=E.getEmitRateGradients();if(i){e.emitRateGradients=[];for(const E of i){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.emitRateGradients.push(H)}}const V=E.getStartSizeGradients();if(V){e.startSizeGradients=[];for(const E of V){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.startSizeGradients.push(H)}}const U=E.getLifeTimeGradients();if(U){e.lifeTimeGradients=[];for(const E of U){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.lifeTimeGradients.push(H)}}const j=E.getLimitVelocityGradients();if(j){e.limitVelocityGradients=[];for(const E of j){const H={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?H.factor2=E.factor2:H.factor2=E.factor1,e.limitVelocityGradients.push(H)}e.limitVelocityDamping=E.limitVelocityDamping}E.noiseTexture&&(e.noiseTexture=E.noiseTexture.serialize())}clone(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let u=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){u=this.customShader;const e=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",E=z.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,e);N[0]?N[0].effect=E:this.setCustomEffect(E,0)}const P=this.serialize(H),M=ME.Parse(P,this._scene||this._engine,this._rootUrl);return M.name=e,M.customShader=u,M._customWrappers=N,void 0===E&&(E=this.NE),this.noiseTexture&&(M.noiseTexture=this.noiseTexture.clone()),M.NE=E,this.preventAutoStart||M.start(),M}}ME.BILLBOARDMODE_Y=2,ME.BILLBOARDMODE_ALL=7,ME.BILLBOARDMODE_STRETCHED=8,ME.BILLBOARDMODE_STRETCHED_LOCAL=9,Ie._ParseParticleSystem=ME.Parse;var DE=H(11970),AE=H(11967),CE=H(11862);CE.b.prototype.createTransformFeedback=function(){const e=this._gl.createTransformFeedback();if(!e)throw new Error("Unable to create Transform Feedback");return e},CE.b.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},CE.b.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},CE.b.prototype.beginTransformFeedback=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},CE.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},CE.b.prototype.setTranformFeedbackVaryings=function(e,E){this._gl.transformFeedbackVaryings(e,E,this._gl.INTERLEAVED_ATTRIBS)},CE.b.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)},CE.b.prototype.readTransformFeedbackBuffer=function(e){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e)};const iE="clipPlaneFragmentDeclaration2",VE="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";w.d.IncludesShadersStore[iE]||(w.d.IncludesShadersStore[iE]=VE);H(13025),H(13030),H(13032),H(13039),H(13048),H(13051),H(13056),H(13061);const UE="gpuRenderParticlesPixelShader",jE="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";w.d.ShadersStore[UE]||(w.d.ShadersStore[UE]=jE);const FE="clipPlaneVertexDeclaration2",hE="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";w.d.IncludesShadersStore[FE]||(w.d.IncludesShadersStore[FE]=hE);H(13067),H(13072),H(13081),H(13088);const SE="gpuRenderParticlesVertexShader",XE="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";w.d.ShadersStore[SE]||(w.d.ShadersStore[SE]=XE);class aE extends D{static get IsSupported(){if(!g.d.LastCreatedEngine)return!1;const e=g.d.LastCreatedEngine.getCaps();return e.supportTransformFeedbacks||e.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(e){this._maxActiveParticleCount=Math.min(e,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(e){this.maxActiveParticleCount=e}createPointEmitter(e,E){const H=qe(e,E);return this.particleEmitterType=H,H}createHemisphericEmitter(){const e=ce(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createSphereEmitter(){const e=ne(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createDirectedSphereEmitter(){const e=ge(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.jE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0));return this.particleEmitterType=e,e}createCylinderEmitter(){const e=xe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=e,e}createDirectedCylinderEmitter(){const e=eE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.jE(0,1,0));return this.particleEmitterType=e,e}createConeEmitter(){const e=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=e,e}createDirectedConeEmitter(){const e=HE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.jE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.jE(0,1,0));return this.particleEmitterType=e,e}createBoxEmitter(e,E,H,N){const u=new i;return this.particleEmitterType=u,this.direction1=e,this.direction2=E,this.minEmitBox=H,this.maxEmitBox=N,u}get flowMap(){return this._flowMap}set flowMap(e){this._flowMap!==e&&(this._flowMap=e)}isReady(){if(!this.NE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ME.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ME.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ME.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout((()=>{this.start(0)}),e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var e;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(e=this._customWrappers[E])||void 0===e?void 0:e.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[e]??this._customWrappers[0]}setCustomEffect(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new ee.d(this._engine),this._customWrappers[E].effect=e}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new c.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(e,E,H){return super._removeGradientAndTexture(e,E,H),this._releaseBuffers(),this}addColorGradient(e,E){this._colorGradients||(this._colorGradients=[]);const H=new B(e,E);return this._colorGradients.push(H),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(e&&this._colorGradients.sort(((e,E)=>e.gradient<E.gradient?-1:e.gradient>E.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const E in this._drawWrappers){var e;null===(e=this._drawWrappers[E].drawContext)||void 0===e||e.reset()}}_addFactorGradient(e,E,H){const N=new t(E,H);e.push(N),this._releaseBuffers()}addSizeGradient(e,E){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,E),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(e,E){if(!e)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&e.sort(((e,E)=>e.gradient<E.gradient?-1:e.gradient>E.gradient?1:0));const H=this;H[E]&&(H[E].dispose(),H[E]=null)}addAngularSpeedGradient(e,E){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,E),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(e,E){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,E),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(e,E){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,E),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(e,E){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,E),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(e){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(e),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.cP=new c.d,this.onStoppedObservable=new c.d,this.onStartedObservable=new c.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=N.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||g.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ii.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,M.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,M.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,M.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,M.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ee.d(this._engine)},this._customWrappers[0].effect=u,this._drawWrappers={0:new ee.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(E=E??{}).randomTextureSize||delete E.randomTextureSize;const P={fM:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...E},D=E;isFinite(D)&&(P.fM=D),this._capacity=P.fM,this._maxActiveParticleCount=P.fM,this._currentActiveCount=0,this._isAnimationSheetEnabled=z,this.particleEmitterType=new i;const A=Math.min(this._engine.getCaps().maxTextureSize,P.randomTextureSize);let C=[];for(let N=0;N<A;++N)C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random());this._randomTexture=new n.e(new Float32Array(C),A,1,5,H,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,C=[];for(let N=0;N<A;++N)C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random());this._randomTexture2=new n.e(new Float32Array(C),A,1,5,H,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=A}_reset(){this._releaseBuffers()}_createVertexBuffers(e,E,H){const N={};N.position=E.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let u=3;N.age=E.createVertexBuffer("age",u,1,this._attributesStrideSize,!0),u+=1,N.size=E.createVertexBuffer("size",u,3,this._attributesStrideSize,!0),u+=3,N.life=E.createVertexBuffer("life",u,1,this._attributesStrideSize,!0),u+=1,u+=4,this.billboardMode===ME.BILLBOARDMODE_STRETCHED&&(N.direction=E.createVertexBuffer("direction",u,3,this._attributesStrideSize,!0)),u+=3,this._platform.alignDataInBuffer&&(u+=1),this.particleEmitterType instanceof W&&(u+=3,this._platform.alignDataInBuffer&&(u+=1)),this._colorGradientsTexture||(N.color=E.createVertexBuffer("color",u,4,this._attributesStrideSize,!0),u+=4),this._isBillboardBased||(N.initialDirection=E.createVertexBuffer("initialDirection",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),this.noiseTexture&&(N.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1),N.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),N.angle=E.createVertexBuffer("angle",u,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?u++:u+=2,this._isAnimationSheetEnabled&&(N.cellIndex=E.createVertexBuffer("cellIndex",u,1,this._attributesStrideSize,!0),u+=1,this.spriteRandomStartCell&&(N.cellStartOffset=E.createVertexBuffer("cellStartOffset",u,1,this._attributesStrideSize,!0),u+=1)),N.offset=H.createVertexBuffer("offset",0,2),N.uv=H.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(N),this._platform.createVertexBuffers(e,N),this.resetDrawCache()}_initialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!e)return;const E=this._engine,H=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof W&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const u=this.particleEmitterType instanceof W,z=N.TmpVectors.jE[0];let P=0;for(let N=0;N<this._capacity;N++)if(H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),u?(this.particleEmitterType.particleDestinationGenerator(N,null,z),H.push(z.x),H.push(z.y),H.push(z.z)):(H.push(0),H.push(0),H.push(0)),this._platform.alignDataInBuffer&&H.push(0),P+=16,u&&(this.particleEmitterType.particlePositionGenerator(N,null,z),H.push(z.x),H.push(z.y),H.push(z.z),this._platform.alignDataInBuffer&&H.push(0),P+=4),this._colorGradientsTexture||(H.push(0),H.push(0),H.push(0),H.push(0),P+=4),this.isBillboardBased||(H.push(0),H.push(0),H.push(0),this._platform.alignDataInBuffer&&H.push(0),P+=4),this.noiseTexture&&(H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),P+=8),H.push(0),P+=1,this._angularSpeedGradientsTexture||(H.push(0),P+=1),this._isAnimationSheetEnabled&&(H.push(0),P+=1,this.spriteRandomStartCell&&(H.push(0),P+=1)),this._platform.alignDataInBuffer){let e=3-(P+3&3);for(P+=e;e-- >0;)H.push(0)}const M=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),D=this._platform.createParticleBuffer(H),A=this._platform.createParticleBuffer(H);this._buffer0=new r.c(E,D,!1,this._attributesStrideSize),this._buffer1=new r.c(E,A,!1,this._attributesStrideSize),this._spriteBuffer=new r.c(E,M,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(e+="\n#define BILLBOARD"),this._colorGradientsTexture&&(e+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(e+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(e+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(e+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(e+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(e+="\n#define DRAGGRADIENTS"),this._flowMap&&(e+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(e+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(e+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(e+="\n#define NOISE"),this.isLocal&&(e+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===e||(this._cachedUpdateDefines=e,this._updateBuffer=this._platform.createUpdateBuffer(e)),this._platform.isUpdateBufferReady()}_getWrapper(e){const E=this._getCustomDrawWrapper(e);if(null!==E&&void 0!==E&&E.effect)return E;const H=[];this.fillDefines(H,e);let N=this._drawWrappers[e];N||(N=new ee.d(this._engine),N.drawContext&&(N.drawContext.useInstancing=!0),this._drawWrappers[e]=N);const u=H.join("\n");if(N.defines!==u){const e=[],E=[],H=[];this.fillUniformsAttributesAndSamplerNames(E,e,H),N.setEffect(this._engine.createEffect("gpuRenderParticles",e,E,H,u),u)}return N}static _GetAttributeNamesOrOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=[r.g.PositionKind,"age","life","size","angle"];return e||u.push(r.g.ColorKind),E&&u.push("cellIndex"),H||u.push("initialDirection"),N&&u.push("direction"),u.push("offset",r.g.UVKind),u}static _GetEffectCreationOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["emitterWM","PA","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Ee.d)(N),e&&N.push("sheetInfos"),E&&N.push("logarithmicDepthConstant"),H&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ee.j)(this,this._scene,e),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==AE.c.FOGMODE_NONE&&e.push("#define FOG")),E===ME.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this.isLocal&&e.push("#define LOCAL"),this.useLogarithmicDepth&&e.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case ME.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case ME.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case ME.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&e.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(e,E,H){E.push(...aE._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ME.BILLBOARDMODE_STRETCHED)),e.push(...aE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(DE.b.PrepareUniforms(e,this._imageProcessingConfigurationDefines),DE.b.PrepareSamplers(H,this._imageProcessingConfigurationDefines))}animate(){var e;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(E?this.preWarmStepOffset:(null===(e=this._scene)||void 0===e?void 0:e.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(e,E){const H=this[E];if(!e||!e.length||H)return;const N=new Float32Array(this._rawTextureWidth);for(let u=0;u<this._rawTextureWidth;u++){const E=u/this._rawTextureWidth;q.GetCurrentGradient(E,e,((e,E,H)=>{N[u]=(0,A.Lerp)(e.factor1,E.factor1,H)}))}this[E]=n.e.CreateRTexture(N,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[E].name=E.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const e=new Uint8Array(4*this._rawTextureWidth),E=P.TmpColors.FM[0];for(let H=0;H<this._rawTextureWidth;H++){const N=H/this._rawTextureWidth;q.GetCurrentGradient(N,this._colorGradients,((N,u,z)=>{P.FM.LerpToRef(N.color1,u.color1,z,E),e[4*H]=255*E.r,e[4*H+1]=255*E.g,e[4*H+2]=255*E.b,e[4*H+3]=255*E.a}))}this._colorGradientsTexture=n.e.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(e,E){var H,u,z,P;const M=this._getWrapper(e),D=M.effect;this._engine.enableEffect(M);const A=(null===(H=this._scene)||void 0===H?void 0:H.getViewMatrix())||N.Matrix.IdentityReadOnly;if(D.setMatrix("view",A),D.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),D.setTexture("diffuseSampler",this.particleTexture),D.setVector2("translationPivot",this.translationPivot),D.setVector3("PA",this.PA),this.isLocal&&D.setMatrix("emitterWM",E),this._colorGradientsTexture?D.setTexture("colorGradientSampler",this._colorGradientsTexture):D.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const e=this.particleTexture.getBaseSize();D.setFloat3("sheetInfos",this.spriteCellWidth/e.width,this.spriteCellHeight/e.height,e.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const e=this._scene.activeCamera;D.setVector3("eyePosition",e.globalPosition)}const C=D.defines;if(this._scene&&((0,Ee.f)(D,this,this._scene),this.applyFog&&(0,He.d)(this._scene,void 0,D)),C.indexOf("#define BILLBOARDMODE_ALL")>=0){const e=A.clone();e.invert(),D.setMatrix("invView",e)}return this.useLogarithmicDepth&&this._scene&&(0,He.j)(C,D,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),this._setEngineBasedOnBlendMode(e),this._platform.bindDrawBuffers(this._targetIndex,D,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(P=this._scene)&&void 0!==P&&P.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(e){if(!this.NE||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!e)if(this.NE.position){e=this.NE.getWorldMatrix()}else{const E=this.NE;e=N.TmpVectors.Matrix[0],N.Matrix.TranslationToRef(E.x,E.y,E.z,e)}const E=this._engine,H=E.getDepthWrite();if(E.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const e=this.fe();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",e.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",e),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const u=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=u,E.setDepthWrite(H)}render(){let e,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!E&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let e=0;e<this.preWarmCycles;e++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const e=0|this._accumulatedCount;this._accumulatedCount-=e,this._currentActiveCount+=e}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.NE.position){e=this.NE.getWorldMatrix()}else{const E=this.NE;e=N.TmpVectors.Matrix[0],N.Matrix.TranslationToRef(E.x,E.y,E.z,e)}const u=this._engine;this.updateInAnimate||this._update(e);let z=0;return E||H||(u.setState(!1),this.forceDepthWrite&&u.setDepthWrite(!0),z=this.blendMode===ME.BLENDMODE_MULTIPLYADD?this._render(ME.BLENDMODE_MULTIPLY,e)+this._render(ME.BLENDMODE_ADD,e):this._render(this.blendMode,e),this._engine.setAlphaMode(0)),z}rebuild(){const e=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(e,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,e()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const E in this._drawWrappers){this._drawWrappers[E].dispose()}if(this._drawWrappers={},this._scene){const e=this._scene.Ii.indexOf(this);e>-1&&this._scene.Ii.splice(e,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let E=0;E<this._renderVertexBuffers.length;++E){const e=this._renderVertexBuffers[E];for(const E in e)e[E].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.cP.notifyObservers(this),this.cP.clear()}clone(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let u=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){u=this.customShader;const e=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";N[0]=z.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,e,void 0,void 0,void 0,this)}const P=this.serialize(H),M=aE.Parse(P,this._scene||this._engine,this._rootUrl);return M.name=e,M.customShader=u,M._customWrappers=N,void 0===E&&(E=this.NE),this.noiseTexture&&(M.noiseTexture=this.noiseTexture.clone()),M.NE=E,M}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return ME._Serialize(E,this,e),E.activeParticleCount=this.activeParticleCount,E.randomTextureSize=this._randomTextureSize,E.customShader=this.customShader,E}static Parse(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;const z=e.name;let P,M;E instanceof te.c?P=E:(M=E,P=M.getEngine());const D=new aE(z,{fM:u||e.fM,randomTextureSize:e.randomTextureSize},E,null,e.isAnimationSheetEnabled);if(D._rootUrl=H,e.customShader&&P.createEffectForParticles){const E=e.customShader,H=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",N=P.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,H,void 0,void 0,void 0,D);D.setCustomEffect(N,0),D.customShader=E}return e.id&&(D.id=e.id),e.activeParticleCount&&(D.activeParticleCount=e.activeParticleCount),ME._Parse(e,D,E,H),e.preventAutoStart&&(D.preventAutoStart=e.preventAutoStart),N||D.preventAutoStart||D.start(),D}}var WE=H(11532),rE=H(13097),YE=H(12094);class fE{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(e){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const E of this.systems)E.NE=e;this._emitterNode=e}setEmitterAsSphere(e,E,H){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:e,renderingGroupId:E};const N=(0,rE.e)("emitterSphere",{diameter:e.diameter,segments:e.segments},H);N.renderingGroupId=E;const u=new YE.SE("emitterSphereMaterial",H);u.emissiveColor=e.color,N.material=u;for(const z of this.systems)z.NE=N;this._emitterNode=N}start(e){for(const E of this.systems)e&&(E.NE=e),E.start()}dispose(){for(const e of this.systems)e.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={systems:[]};for(const H of this.systems)E.systems.push(H.serialize(e));return this._emitterNode&&(E.NE=this._emitterCreationOptions),E}static Parse(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;const u=new fE,z=this.BaseAssetsUrl+"/textures/";E=E||g.d.LastCreatedScene;for(const P of e.systems)u.systems.push(H?aE.Parse(P,E,z,!0,N):ME.Parse(P,E,z,!0,N));if(e.NE){const H=e.NE.options;if("Sphere"===e.NE.kind)u.setEmitterAsSphere({diameter:H.diameter,segments:H.segments,color:P.XE.aE(H.color)},e.NE.renderingGroupId,E)}return u}}fE.BaseAssetsUrl="https://assets.babylonjs.com/particles";var wE=H(11571);class sE{static CreateDefault(e){let E,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,N=arguments.length>2?arguments[2]:void 0;E=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new aE("default system",{fM:H},N):new ME("default system",H,N),E.NE=e;const u=WE.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return E.particleTexture=new v.b(u,E.fe()),E.createConeEmitter(.1,Math.PI/4),E.color1=new P.FM(1,1,1,1),E.color2=new P.FM(1,1,1,1),E.colorDead=new P.FM(1,1,1,0),E.minSize=.1,E.maxSize=.1,E.minEmitPower=2,E.maxEmitPower=2,E.updateSpeed=1/60,E.emitRate=30,E}static CreateAsync(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;E||(E=g.d.LastCreatedScene);const u={};return E.addPendingData(u),new Promise(((z,P)=>{if(H&&!aE.IsSupported)return E.removePendingData(u),P("Particle system with GPU is not supported.");WE.Tools.LoadFile(`${sE.BaseAssetsUrl}/systems/${e}.json`,(e=>{E.removePendingData(u);const P=JSON.parse(e.toString());return z(fE.Parse(P,E,H,N))}),void 0,void 0,void 0,(()=>(E.removePendingData(u),P(`An error occurred with the creation of your particle system. Check if your type '${e}' exists.`))))}))}static ExportSet(e){const E=new fE;for(const H of e)E.systems.push(H);return E}static ParseFromFileAsync(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",z=arguments.length>5?arguments[5]:void 0;return new Promise(((P,M)=>{const D=new wE.b;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const E=JSON.parse(D.responseText);let M;M=N?aE.Parse(E,H,u,!1,z):ME.Parse(E,H,u,!1,z),e&&(M.name=e),P(M)}else M("Unable to load the particle system")})),D.open("GET",E),D.send()}))}static ParseFromSnippetAsync(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",u=arguments.length>4?arguments[4]:void 0;if("_BLANK"===e){const e=this.CreateDefault(null);return e.start(),Promise.resolve(e)}return new Promise(((z,P)=>{const M=new wE.b;M.addEventListener("readystatechange",(()=>{if(4==M.readyState)if(200==M.status){const P=JSON.parse(JSON.parse(M.responseText).jsonPayload),D=JSON.parse(P.particleSystem);let A;A=H?aE.Parse(D,E,N,!1,u):ME.Parse(D,E,N,!1,u),A.snippetId=e,z(A)}else P("Unable to load the snippet "+e)})),M.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),M.send()}))}}sE.BaseAssetsUrl=fE.BaseAssetsUrl,sE.SnippetUrl="https://snippet.babylonjs.com",sE.CreateFromSnippetAsync=sE.ParseFromSnippetAsync;var pE=H(12165),oE=H(11991),yE=H(13103);(0,yE.e)(oE.c.NAME_PARTICLESYSTEM,((e,E,H,N)=>{const u=(0,yE.g)(oE.c.NAME_PARTICLESYSTEM);if(u&&void 0!==e.Ii&&null!==e.Ii)for(let z=0,P=e.Ii.length;z<P;z++){const P=e.Ii[z];H.Ii.push(u(P,E,N))}})),(0,yE.c)(oE.c.NAME_PARTICLESYSTEM,((e,E,H)=>{if(e.activeParticleCount){return aE.Parse(e,E,H)}return ME.Parse(e,E,H)})),te.c.prototype.createEffectForParticles=function(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,M=arguments.length>6?arguments[6]:void 0,D=arguments.length>7?arguments[7]:void 0,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=arguments.length>9?arguments[9]:void 0,i=[],V=[];const U=[];return D?D.fillUniformsAttributesAndSamplerNames(V,i,U):(i=ME._GetAttributeNamesOrOptions(),V=ME._GetEffectCreationOptions()),-1===u.indexOf(" BILLBOARD")&&(u+="\n#define BILLBOARD\n"),null!==D&&void 0!==D&&D.isAnimationSheetEnabled&&-1===u.indexOf(" ANIMATESHEET")&&(u+="\n#define ANIMATESHEET\n"),-1===N.indexOf("diffuseSampler")&&N.push("diffuseSampler"),this.createEffect({vertex:C??(null===D||void 0===D?void 0:D.vertexShaderName)??"particles",fragmentElement:e},i,V.concat(E),U.concat(N),u,z,P,M,void 0,A,(async()=>{0===A?await Promise.resolve().then(H.bind(H,13132)):await Promise.resolve().then(H.bind(H,13187))}))},pE.c.prototype.getEmittedParticleSystems=function(){const e=[];for(let E=0;E<this.fe().Ii.length;E++){const H=this.fe().Ii[E];H.NE===this&&e.push(H)}return e},pE.c.prototype.getHierarchyEmittedParticleSystems=function(){const e=[],E=this.getDescendants();E.push(this);for(let H=0;H<this.fe().Ii.length;H++){const N=this.fe().Ii[H],u=N.NE;u.position&&-1!==E.indexOf(u)&&e.push(N)}return e};H(12057),H(12069),H(12140);H(12147),H(13106),H(11935),H(12051),H(12190);H(11932);var bE;H(13112),H(11765);!function(e){e[e.Color=2]="Color",e[e.UV=1]="UV",e[e.Random=0]="Random",e[e.Stated=3]="Stated"}(bE||(bE={}));var KE=H(11952);const lE=new N.jE(0,0,0),OE=new N.jE(0,0,0),vE=new N.jE(0,0,0);class RE{constructor(e,E,H){this.width=e,this.height=E,this.data=H}processFlowable(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;if(!H)return;H instanceof N.Matrix?N.jE.TransformCoordinatesToRef(e.position,H,vE):(vE.x=H.x,vE.y=H.y,vE.z=H.z);const u=.5*vE.x+.5,z=1-(.5*vE.y+.5),P=Math.floor(u*this.width),M=Math.floor(z*this.height);if(P<0||P>=this.width||M<0||M>=this.height)return;const D=4*(M*this.width+P),A=this.data[D]/255*2-1,C=this.data[D+1]/255*2-1,i=this.data[D+2]/255*2-1,V=this.data[D+3]/255;lE.set(A,C,i),lE.scaleToRef(E*V,OE),e.direction.addInPlace(OE)}_processParticle(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;this.processFlowable(e,E,H)}static async FromUrlAsync(e){return await new Promise(((E,H)=>{const N=document.createElement("canvas"),u=N.getContext("2d");let z=null;const P=new Image;P.crossOrigin="anonymous",P.src=e,P.onerror=E=>{H(new Error(`Failed to load image: ${e} : ${E}`))},P.onload=()=>{N.width=P.width,N.height=P.height,u.drawImage(P,0,0),z=u.getImageData(0,0,N.width,N.height),E(new RE(N.width,N.height,z.data))}}))}static async ExtractFromTextureAsync(e){return await new Promise(((E,H)=>{if(!e.isReady())return void e.onLoadObservable.addOnce((async()=>{try{const H=await this.ExtractFromTextureAsync(e);E(H)}catch(N){H(N)}}));const N=e.getSize();KE.i.GetTextureDataAsync(e,N.width,N.height).then((e=>{E(new RE(N.width,N.height,new Uint8ClampedArray(e)))})).catch(H)}))}}var TE,LE,dE,GE,mH,QE,ZE,kE,JE;!function(e){e[e.Int=1]="Int",e[e.Float=2]="Float",e[e.Vector2=4]="Vector2",e[e.jE=8]="jE",e[e.Matrix=16]="Matrix",e[e.Particle=32]="Particle",e[e.Texture=64]="Texture",e[e.FM=128]="FM",e[e.FloatGradient=256]="FloatGradient",e[e.Vector2Gradient=512]="Vector2Gradient",e[e.Vector3Gradient=1024]="Vector3Gradient",e[e.Color4Gradient=2048]="Color4Gradient",e[e.System=4096]="System",e[e.AutoDetect=8192]="AutoDetect",e[e.BasedOnInput=16384]="BasedOnInput",e[e.Undefined=32768]="Undefined",e[e.All=65535]="All"}(TE||(TE={})),function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.HierarchyIssue=2]="HierarchyIssue"}(LE||(LE={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(dE||(dE={}));class BE{get direction(){return this._direction}get type(){if(this._type===TE.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===TE.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(e){this._type=e}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(e,E,H){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=TE.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new c.d,this.onDisconnectionObservable=new c.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=E,this.name=e,this._direction=H}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(e){var E;return this.isConnected?null!==(E=this._connectedPoint)&&void 0!==E&&E._storedFunction?this._connectedPoint._storedFunction(e):this._connectedPoint._storedValue:this.value}canConnectTo(e){return 0===this.checkCompatibilityState(e)}checkCompatibilityState(e){const E=this._ownerBlock,H=e.ownerBlock;if(this.type!==e.type&&e.innerType!==TE.AutoDetect)return e.acceptedConnectionPointTypes&&-1!==e.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(e.excludedConnectionPointTypes&&-1!==e.excludedConnectionPointTypes.indexOf(this.type))return 1;let N=H,u=E;return 0===this.direction&&(N=E,u=H),N.isAnAncestorOf(u)?2:0}connectTo(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(e))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${e.ownerBlock.name}".${e.name}`;return this._endpoints.push(e),e._connectedPoint=this,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const E=this._endpoints.indexOf(e);return-1===E||(this._endpoints.splice(E,1),e._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(e){let E=1;for(;E<TE.All;)e&E||this.excludedConnectionPointTypes.push(E),E<<=1}serialize(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E={};return E.name=this.name,E.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.uM?(E.valueType="BABYLON."+this.value.getClassName(),E.value=this.value.uM()):(E.valueType="number",E.value=this.value)),e&&this.connectedPoint&&(E.inputName=this.name,E.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,E.targetConnectionName=this.connectedPoint.name,E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),E}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class IE{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(e){this._name=e}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(e){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new c.d,this.cP=new c.d,this.onInputChangedObservable=new c.d,this.visibleOnFrame=!1,this._name=e,this.uniqueId=R.b.UniqueId}_inputRename(e){return e}_outputRename(e){return e}isAnAncestorOf(e){for(const E of this._outputs)if(E.hasEndpoints)for(const H of E.endpoints){if(H.ownerBlock===e)return!0;if(H.ownerBlock.isAnAncestorOf(e))return!0}return!1}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const E of this._outputs)if(E.hasEndpoints)for(const H of E.endpoints)if(H.ownerBlock.isAnAncestorOfType(e))return!0;return!1}getInputByName(e){const E=this._inputs.filter((E=>E.name===e));return E.length?E[0]:null}_linkConnectionTypes(e,E){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[E]._acceptedConnectionPointType=this._inputs[e]:(this._inputs[e]._linkedConnectionSource=this._inputs[E],this._inputs[e]._isMainLinkSource=!0),this._inputs[E]._linkedConnectionSource=this._inputs[e]}registerInput(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;const P=new BE(e,this,0);return P.type=E,P.isOptional=H,P.defaultValue=N,P.value=N,P.valueMin=u,P.valueMax=z,this._inputs.push(P),this.onInputChangedObservable.notifyObservers(P),this}registerOutput(e,E,H){return(H=H??new BE(e,this,1)).type=E,this._outputs.push(H),this}_build(e){}_customBuildStep(e){}build(e){if(this._buildId===e.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((e=>e.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=e.buildId;for(const E of this._inputs){if(!E.connectedPoint){E.isOptional||e.notConnectedNonOptionalInputs.push(E);continue}const H=E.connectedPoint.ownerBlock;H&&H!==this&&!H.isSystem&&H.build(e)}return this._customBuildStep(e),e.verbose&&T.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(e),this.onBuildObservable.notifyObservers(this),!1}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.visibleOnFrame=this.visibleOnFrame,e.inputs=[],e.outputs=[];for(const E of this.inputs)e.inputs.push(E.serialize());for(const E of this.outputs)e.outputs.push(E.serialize(!1));return e}_deserialize(e){this._name=e.name,this.comments=e.comments,this.visibleOnFrame=!!e.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_deserializePortDisplayNamesAndExposedOnFrame(e){const E=e.inputs,H=e.outputs;if(E)for(const N of E){const e=this.inputs.find((e=>e.name===N.name));if(!e)return;if(N.displayName&&(e.displayName=N.displayName),N.isExposedOnFrame&&(e.isExposedOnFrame=N.isExposedOnFrame,e.exposedPortPosition=N.exposedPortPosition),void 0!==N.value&&null!==N.value)if("number"===N.valueType)e.value=N.value;else{const E=(0,M.e)(N.valueType);E&&(e.value=E.aE(N.value))}}if(H)for(let N=0;N<H.length;N++){const e=H[N];e.displayName&&(this.outputs[N].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[N].isExposedOnFrame=e.isExposedOnFrame,this.outputs[N].exposedPortPosition=e.exposedPortPosition)}}clone(){const e=this.serialize(),E=(0,M.e)(e.customType);if(E){const H=new E;return H._deserialize(e),H}return null}dispose(){this.cP.notifyObservers(this),this.cP.clear();for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function tE(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",N=arguments.length>3?arguments[3]:void 0;return(u,z)=>{let P=u._propStore;P||(P=[],u._propStore=P),P.push({propertyName:z,displayName:e,type:E,groupName:H,options:N??{},className:u.getClassName()})}}(0,K.e)([(0,l.S)("comment")],IE.prototype,"comments",void 0),function(e){e[e.Boolean=0]="Boolean",e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=3]="Vector2",e[e.List=4]="List",e[e.FM=5]="FM",e[e.SamplingMode=6]="SamplingMode",e[e.TextureFormat=7]="TextureFormat",e[e.TextureType=8]="TextureType"}(GE||(GE={})),function(e){e[e.None=0]="None",e[e.Position=1]="Position",e[e.Direction=2]="Direction",e[e.Age=3]="Age",e[e.Lifetime=4]="Lifetime",e[e.Color=5]="Color",e[e.ScaledDirection=6]="ScaledDirection",e[e.Scale=7]="Scale",e[e.AgeGradient=8]="AgeGradient",e[e.Angle=9]="Angle",e[e.SpriteCellIndex=16]="SpriteCellIndex",e[e.SpriteCellStart=17]="SpriteCellStart",e[e.SpriteCellEnd=18]="SpriteCellEnd"}(mH||(mH={})),function(e){e[e.None=0]="None",e[e.Time=1]="Time",e[e.Delta=2]="Delta",e[e.Emitter=3]="Emitter"}(QE||(QE={}));class qE{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let e="";for(const E of this.notConnectedNonOptionalInputs)e+=`input ${E.name} from block ${E.ownerBlock.name}[${E.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(e)throw"Build of Node Particle System Set failed:\n"+e}adapt(e,E){const H=e.getConnectedValue(this)||0;if(e.type===E)return H;switch(E){case TE.Vector2:return new N.Vector2(H,H);case TE.jE:return new N.jE(H,H,H);case TE.FM:return new P.FM(H,H,H,H)}return null}getContextualValue(e){if(!this.particleContext||!this.systemContext)return null;switch(e){case mH.Position:return this.particleContext.position;case mH.Direction:return this.particleContext.direction;case mH.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case mH.Color:return this.particleContext.color;case mH.Age:return this.particleContext.age;case mH.Lifetime:return this.particleContext.lifeTime;case mH.Angle:return this.particleContext.angle;case mH.Scale:return this.particleContext.scale;case mH.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case mH.SpriteCellEnd:return this.systemContext.endSpriteCellID;case mH.SpriteCellIndex:return this.particleContext.cellIndex;case mH.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.NE.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.NE.absolutePosition:this.systemContext.NE:null}getSystemValue(e){if(!this.particleContext||!this.systemContext)return null;switch(e){case QE.Time:return this.systemContext._actualFrame;case QE.Delta:return this.systemContext._scaledUpdateSpeed;case QE.Emitter:if(this.isEmitterTransformNode){return this.systemContext.NE.absolutePosition}return this.systemContext.NE}return null}}function cE(e,E,H){const N=new qE;N.hE=E;const u=e.createSystem(N);return u.canStart=()=>!0,u.NE=H.clone(),u.disposeOnStop=!0,u.start(),u}class nE extends IE{constructor(e){super(e),this.blendMode=D.BLENDMODE_ONEONE,this.fM=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",TE.Particle),this.registerInput("texture",TE.Texture),this.registerInput("onStart",TE.System,!0),this.registerInput("onEnd",TE.System,!0),this.registerOutput("system",TE.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(e){e.fM=this.fM,e.buildId=this._buildId++,this.build(e);const E=this.particle.getConnectedValue(e);return E.particleTexture=this.texture.getConnectedValue(e),E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.name=this.name,E._nodeGenerated=!0,E._targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,this.system._storedValue=this,E.canStart=()=>!this.doNoStart,E.onStartedObservable.add((H=>{const N=this.onStart.getConnectedValue(e);N&&H.onStartedObservable.addOnce((()=>{e.systemContext=E;const H=cE(N,e.hE,e.emitterPosition);this.cP.addOnce((()=>{H.dispose()}))}));const u=this.onEnd.getConnectedValue(e);u&&H.onStoppedObservable.addOnce((()=>{e.systemContext=E;const H=cE(u,e.hE,e.emitterPosition);this.cP.addOnce((()=>{H.dispose()}))}))})),this.cP.addOnce((()=>{E.dispose()})),E}serialize(){const e=super.serialize();return e.fM=this.fM,e.emitRate=this.emitRate,e.blendMode=this.blendMode,e.doNoStart=this.doNoStart,e.targetStopDuration=this.targetStopDuration,e.startDelay=this.startDelay,e}_deserialize(e){super._deserialize(e),this.fM=e.fM,this.emitRate=e.emitRate,this.doNoStart=!!e.doNoStart,void 0!==e.blendMode&&(this.blendMode=e.blendMode),void 0!==e.targetStopDuration&&(this.targetStopDuration=e.targetStopDuration),void 0!==e.startDelay&&(this.startDelay=e.startDelay)}}(0,K.e)([tE("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:D.BLENDMODE_ONEONE},{label:"Standard",value:D.BLENDMODE_STANDARD},{label:"Add",value:D.BLENDMODE_ADD},{label:"Multiply",value:D.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:D.BLENDMODE_MULTIPLYADD}]})],nE.prototype,"blendMode",void 0),(0,K.e)([tE("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],nE.prototype,"fM",void 0),(0,K.e)([tE("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nE.prototype,"emitRate",void 0),(0,K.e)([tE("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nE.prototype,"targetStopDuration",void 0),(0,K.e)([tE("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nE.prototype,"startDelay",void 0),(0,K.e)([tE("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nE.prototype,"doNoStart",void 0),(0,M.g)("BABYLON.SystemBlock",nE);class gE extends IE{get type(){if(this._type===TE.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=TE.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=TE.Vector2,this._type;case"jE":return this._type=TE.jE,this._type;case"FM":return this._type=TE.FM,this._type;case"Matrix":return this._type=TE.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===mH.None&&this._systemSource!==QE.None}get systemSource(){return this._systemSource}set systemSource(e){if(this._systemSource=e,e!==QE.None){switch(this._contextualSource=mH.None,this._type=TE.Float,e){case QE.Time:case QE.Delta:this._type=TE.Float;break;case QE.Emitter:this._type=TE.jE}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==mH.None}get contextualValue(){return this._contextualSource}set contextualValue(e){if(this._contextualSource=e,e!==mH.None){switch(this._systemSource=QE.None,e){case mH.Scale:this._type=TE.Vector2;break;case mH.Position:case mH.Direction:case mH.ScaledDirection:this._type=TE.jE;break;case mH.Color:this._type=TE.FM;break;case mH.Age:case mH.Lifetime:case mH.Angle:case mH.AgeGradient:this._type=TE.Float;break;case mH.SpriteCellEnd:case mH.SpriteCellStart:case mH.SpriteCellIndex:this._type=TE.Int}this.output&&(this.output.type=this._type)}}constructor(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:TE.AutoDetect;super(e),this._type=TE.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new c.d,this._systemSource=QE.None,this._contextualSource=mH.None,this._type=E,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",E)}get value(){return this._storedValue}set value(e){this.type===TE.Float&&this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e)),this._storedValue=e,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(e){this._valueCallback=e}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case TE.Int:case TE.Float:this.value=0;break;case TE.Vector2:this.value=N.Vector2.Zero();break;case TE.jE:this.value=N.jE.Zero();break;case TE.FM:this.value=new P.FM(1,1,1,1);break;case TE.Matrix:this.value=N.Matrix.Identity()}}_build(e){super._build(e),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=e=>e.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=e=>e.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const e=super.serialize();return e.type=this.type,e.contextualValue=this.contextualValue,e.systemSource=this.systemSource,e.min=this.min,e.max=this.max,e.groupInInspector=this.groupInInspector,e.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.uM?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.uM()):(e.valueType="number",e.value=this._storedValue)),e}_deserialize(e){if(super._deserialize(e),this._type=e.type,this.contextualValue=e.contextualValue,this.systemSource=e.systemSource||QE.None,this.min=e.min||0,this.max=e.max||0,this.groupInInspector=e.groupInInspector||"",void 0!==e.displayInInspector&&(this.displayInInspector=e.displayInInspector),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const E=(0,M.e)(e.valueType);E&&(this._storedValue=E.aE(e.value))}}}(0,M.g)("BABYLON.ParticleInputBlock",gE);class xE extends IE{get url(){return this._url}set url(e){this._url!==e&&(this._cachedData=null,this._url=e,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(e){this._textureDataUrl!==e&&(this._cachedData=null,this._textureDataUrl=e,this._url="",this._sourceTexture=null)}set sourceTexture(e){this._sourceTexture!==e&&(this._cachedData=null,this._sourceTexture=e,this._url="",this._textureDataUrl="")}constructor(e){super(e),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",TE.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const e=this.texture._storedValue;return await new Promise(((E,H)=>{if(!e.isReady())return void e.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),E(this._cachedData)}catch(e){H(e)}}));const N=e.getSize();KE.i.GetTextureDataAsync(e,N.width,N.height).then((H=>{this._cachedData={width:N.width,height:N.height,data:new Uint8ClampedArray(H)},e.dispose(),E(this._cachedData)})).catch(H)}))}_build(e){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new v.b(this._textureDataUrl,e.hE):this.texture._storedValue=new v.b(this._url,e.hE):this.texture._storedValue=null}serialize(){const e=super.serialize();return e.url=this.url,e.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(e.textureDataUrl=this.textureDataUrl),e}_deserialize(e){super._deserialize(e),this.url=e.url,this.serializedCachedData=!!e.serializedCachedData,e.textureDataUrl&&(this.textureDataUrl=e.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,M.g)("BABYLON.ParticleTextureSourceBlock",xE);class eH extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("position",TE.jE),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(e){const E=this.particle.getConnectedValue(e);if(this.output._storedValue=E,!this.position.isConnected)return;const H={process:H=>{e.particleContext=H,e.systemContext=E,H.position.P(this.position.getConnectedValue(e))},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H}}(0,M.g)("BABYLON.UpdatePositionBlock",eH),function(e){e[e.Add=0]="Add",e[e.Subtract=1]="Subtract",e[e.Multiply=2]="Multiply",e[e.Divide=3]="Divide",e[e.Max=4]="Max",e[e.Min=5]="Min"}(ZE||(ZE={}));class EH extends IE{constructor(e){super(e),this.operation=ZE.Add,this.registerInput("left",TE.AutoDetect),this.registerInput("right",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this.output._typeConnectionSource=this.left;const E=[TE.Matrix,TE.Particle,TE.Texture,TE.System,TE.FloatGradient,TE.Color4Gradient,TE.Vector2Gradient,TE.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...E),this.right.excludedConnectionPointTypes.push(...E),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(e){let E;const H=this.left,u=this.right;if(!H.isConnected||!u.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const z=H.type===TE.Float||H.type===TE.Int,M=u.type===TE.Float||u.type===TE.Int,D=z&&M;switch(this.operation){case ZE.Add:E=D?e=>H.getConnectedValue(e)+u.getConnectedValue(e):z?e=>e.adapt(H,u.type).add(u.getConnectedValue(e)):e=>H.getConnectedValue(e).add(e.adapt(u,H.type));break;case ZE.Subtract:E=D?e=>H.getConnectedValue(e)-u.getConnectedValue(e):z?e=>e.adapt(H,u.type).FE(u.getConnectedValue(e)):e=>H.getConnectedValue(e).FE(e.adapt(u,H.type));break;case ZE.Multiply:E=D?e=>H.getConnectedValue(e)*u.getConnectedValue(e):z?e=>e.adapt(H,u.type).multiply(u.getConnectedValue(e)):e=>H.getConnectedValue(e).multiply(e.adapt(u,H.type));break;case ZE.Divide:E=D?e=>H.getConnectedValue(e)/u.getConnectedValue(e):z?e=>e.adapt(H,u.type).divide(u.getConnectedValue(e)):e=>H.getConnectedValue(e).divide(e.adapt(u,H.type));break;case ZE.Min:if(D)E=e=>Math.min(H.getConnectedValue(e),u.getConnectedValue(e));else{const[e,M]=z?[u,H]:[H,u];switch(e.type){case TE.Vector2:E=E=>N.Vector2.Minimize(e.getConnectedValue(E),E.adapt(M,e.type));break;case TE.jE:E=E=>N.jE.Minimize(e.getConnectedValue(E),E.adapt(M,e.type));break;case TE.FM:E=E=>{const H=e.getConnectedValue(E),{r:N,g:u,b:z,a:D}=E.adapt(M,e.type);return new P.FM(Math.min(H.r,N),Math.min(H.g,u),Math.min(H.b,z),Math.min(H.a,D))}}}break;case ZE.Max:if(!D){const[e,M]=z?[u,H]:[H,u];switch(e.type){case TE.Vector2:E=E=>N.Vector2.Maximize(e.getConnectedValue(E),E.adapt(M,e.type));break;case TE.jE:E=E=>N.jE.Maximize(e.getConnectedValue(E),E.adapt(M,e.type));break;case TE.FM:E=E=>{const H=e.getConnectedValue(E),{r:N,g:u,b:z,a:D}=E.adapt(M,e.type);return new P.FM(Math.max(H.r,N),Math.min(H.g,u),Math.min(H.b,z),Math.min(H.a,D))}}break}E=e=>Math.max(H.getConnectedValue(e),u.getConnectedValue(e))}this.output._storedFunction=e=>H.type===TE.Int?0|E(e):E(e)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===TE.Int||this.left.type===TE.Float&&this.right.type!==TE.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[e,E]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[TE.Int,TE.Float],E.isConnected&&(e.acceptedConnectionPointTypes.push(E.type),E.type!==TE.Int&&E.type!==TE.Float||e.acceptedConnectionPointTypes.push(TE.Vector2,TE.jE,TE.FM))}dispose(){super.dispose();for(const e of this._connectionObservers)e.remove();this._connectionObservers.length=0}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.operation=e.operation}}(0,K.e)([tE("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ZE.Add},{label:"Subtract",value:ZE.Subtract},{label:"Multiply",value:ZE.Multiply},{label:"Divide",value:ZE.Divide},{label:"Max",value:ZE.Max},{label:"Min",value:ZE.Min}]})],EH.prototype,"operation",void 0),(0,M.g)("BABYLON.ParticleMathBlock",EH);class HH extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("direction1",TE.jE,!0,new N.jE(0,1,0)),this.registerInput("direction2",TE.jE,!0,new N.jE(0,1,0)),this.registerInput("minEmitBox",TE.jE,!0,new N.jE(-.5,-.5,-.5)),this.registerInput("maxEmitBox",TE.jE,!0,new N.jE(.5,.5,.5)),this.registerOutput("output",TE.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(e){const E=this.particle.getConnectedValue(e);E._directionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.direction1.getConnectedValue(e),z=this.direction2.getConnectedValue(e),P=(0,A.RandomRange)(u.x,z.x),M=(0,A.RandomRange)(u.y,z.y),D=(0,A.RandomRange)(u.z,z.z);e.isEmitterTransformNode?N.jE.TransformNormalFromFloatsToRef(P,M,D,e.emitterWorldMatrix,H.direction):H.direction.VM(P,M,D)},E._positionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.minEmitBox.getConnectedValue(e),z=this.maxEmitBox.getConnectedValue(e),P=(0,A.RandomRange)(u.x,z.x),M=(0,A.RandomRange)(u.y,z.y),D=(0,A.RandomRange)(u.z,z.z);e.isEmitterTransformNode?N.jE.TransformCoordinatesFromFloatsToRef(P,M,D,e.emitterWorldMatrix,H.position):(H.position.VM(P,M,D),H.position.addInPlace(e.emitterPosition))},this.output._storedValue=E}}(0,M.g)("BABYLON.BoxShapeBlock",HH);class NH extends IE{constructor(e){super(e),this.registerInput("emitPower",TE.Float,!0,1),this.registerInput("lifeTime",TE.Float,!0,1),this.registerInput("color",TE.FM,!0,new P.FM(1,1,1,1)),this.registerInput("scale",TE.Vector2,!0,new N.Vector2(1,1)),this.registerInput("angle",TE.Float,!0,0),this.registerOutput("particle",TE.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(e){const E=new ME(this.name,e.fM,e.hE,null,!1,void 0,!0);E.particleEmitterType=new S,E._lifeTimeCreation.process=(E,H)=>{e.particleContext=E,E.lifeTime=this.lifeTime.getConnectedValue(e),H._emitPower=this.emitPower.getConnectedValue(e)},E._colorCreation.process=E=>{e.particleContext=E,E.color.P(this.color.getConnectedValue(e))},E._sizeCreation.process=E=>{e.particleContext=E,E.size=1,E.scale.P(this.scale.getConnectedValue(e))},E._angleCreation.process=E=>{e.particleContext=E,E.angle=this.angle.getConnectedValue(e)},this.particle._storedValue=E}}(0,M.g)("BABYLON.CreateParticleBlock",NH);class uH{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const e=[];for(const E of this.attachedBlocks)E.isInput&&e.push(E);return e}constructor(e){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new c.d,this.name=e}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(e)&&this.attachedBlocks.push(e);for(const H of e.inputs){const N=H.connectedPoint;if(N){const H=N.ownerBlock;H!==e&&this._initializeBlock(H,E)}}}async buildAsync(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((H=>{const N=new fE;for(const e of this._systemBlocks)this._initializeBlock(e);for(const u of this.systemBlocks){const H=new qE;H.buildId=this._buildId++,H.hE=e,H.verbose=E;const z=u.createSystem(H);H.emitErrors(),N.systems.push(z)}this.onBuildObservable.notifyObservers(this),H(N)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const e=new nE("Particle system"),E=new eH("Update position");E.output.connectTo(e.particle);const H=new gE("Position");H.contextualValue=mH.Position;const N=new gE("Scaled direction");N.contextualValue=mH.ScaledDirection;const u=new EH("Add");u.operation=ZE.Add,H.output.connectTo(u.left),N.output.connectTo(u.right),u.output.connectTo(E.position);const z=new NH("Create particle"),P=new HH("Box shape");z.particle.connectTo(P.particle),P.output.connectTo(E.particle);const M=new xE("Texture");M.texture.connectTo(e.texture),M.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(e)}removeBlock(e){const E=this.attachedBlocks.indexOf(e);if(E>-1&&this.attachedBlocks.splice(E,1),e.isSystem){const E=this._systemBlocks.indexOf(e);E>-1&&this._systemBlocks.splice(E,1)}}parseSerializedObject(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E||this.clear();const H={};for(const N of e.PC){const e=(0,M.e)(N.customType);if(e){const E=new e;E._deserialize(N),H[N.id]=E,this.attachedBlocks.push(E),E.isSystem&&this._systemBlocks.push(E)}}for(const N of this.attachedBlocks)if(N.isTeleportOut){const e=N,E=e._tempEntryPointUniqueId;if(E){const N=H[E];N&&N.attachToEndpoint(e)}}for(let N=0;N<e.PC.length;N++){const u=e.PC[N],z=H[u.id];z&&(z.inputs.length&&u.inputs.some((e=>e.targetConnectionName))&&!E||this._restoreConnections(z,e,H))}if(e.locations||e.editorData&&e.editorData.locations){const N=e.locations||e.editorData.locations;for(const e of N)H[e.ZH]&&(e.ZH=H[e.ZH].uniqueId);E&&this.editorData&&this.editorData.locations&&N.concat(this.editorData.locations),e.locations?this.editorData={locations:N}:(this.editorData=e.editorData,this.editorData.locations=N);const u=[];for(const e in H)u[e]=H[e].uniqueId;this.editorData.map=u}this.comment=e.comment}_restoreConnections(e,E,H){for(const N of e.outputs)for(const u of E.PC){const z=H[u.id];if(z)for(const P of u.inputs)if(H[P.targetBlockId]!==e||P.targetConnectionName!==N.name);else{const e=z.getInputByName(P.inputName);if(!e||e.isConnected)continue;N.connectTo(e,!0),this._restoreConnections(z,E,H)}}}serialize(e){const E=e?{}:O.d.Serialize(this);E.editorData=JSON.parse(JSON.stringify(this.editorData));let H=[];e?H=e:E.customType="BABYLON.NodeParticleSystemSet",E.PC=[];for(const N of H)E.PC.push(N.serialize());if(!e)for(const N of this.attachedBlocks)-1===H.indexOf(N)&&E.PC.push(N.serialize());return E}dispose(){for(const e of this.attachedBlocks)e.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(e){const E=new uH(e);return E.setToDefault(),E}static Parse(e){const E=O.d.Parse((()=>new uH(e.name)),e,null);return E.parseSerializedObject(e),E}static ParseFromSnippetAsync(e,E){return"_BLANK"===e?Promise.resolve(uH.CreateDefault("blank")):new Promise(((H,N)=>{const u=new wE.b;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const P=JSON.parse(JSON.parse(u.responseText).jsonPayload),M=JSON.parse(P.nodeParticle);E||(E=O.d.Parse((()=>new uH(e)),M,null)),E.parseSerializedObject(M),E.snippetId=e;try{H(E)}catch(z){N(z)}}else N("Unable to load the snippet "+e)})),u.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),u.send()}))}}uH.EditorURL=`${WE.Tools._DefaultCdnUrl}/v${te.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,uH.SnippetUrl="https://snippet.babylonjs.com",(0,K.e)([(0,l.S)()],uH.prototype,"name",void 0),(0,K.e)([(0,l.S)("comment")],uH.prototype,"comment",void 0),function(e){e[e.None=0]="None",e[e.PerParticle=1]="PerParticle",e[e.PerSystem=2]="PerSystem"}(kE||(kE={}));class zH extends IE{constructor(e){super(e),this._currentLockId=-2,this.lockMode=kE.PerParticle,this.registerInput("min",TE.AutoDetect,!0,0),this.registerInput("max",TE.AutoDetect,!0,1),this.registerOutput("output",TE.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(TE.Float|TE.Int|TE.Vector2|TE.jE|TE.FM),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(TE.Float|TE.Int|TE.Vector2|TE.jE|TE.FM),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=TE.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let e=null;switch(this._currentLockId=-2,this.min.type){case TE.AutoDetect:case TE.Int:case TE.Float:e=e=>{const E=this.min.getConnectedValue(e)||0,H=this.max.getConnectedValue(e)||1;return E+Math.random()*(H-E)};break;case TE.Vector2:e=e=>{const E=this.min.getConnectedValue(e)||N.Vector2.Zero(),H=this.max.getConnectedValue(e)||N.Vector2.One();return new N.Vector2(E.x+Math.random()*(H.x-E.x),E.y+Math.random()*(H.y-E.y))};break;case TE.jE:e=e=>{const E=this.min.getConnectedValue(e)||N.jE.Zero(),H=this.max.getConnectedValue(e)||N.jE.One();return new N.jE(E.x+Math.random()*(H.x-E.x),E.y+Math.random()*(H.y-E.y),E.z+Math.random()*(H.z-E.z))};break;case TE.FM:e=e=>{const E=this.min.getConnectedValue(e)||new P.FM(0,0,0,0),H=this.max.getConnectedValue(e)||new P.FM(1,1,1,1);return new P.FM(E.x+Math.random()*(H.x-E.x),E.y+Math.random()*(H.y-E.y),E.z+Math.random()*(H.z-E.z),E.w+Math.random()*(H.w-E.w))}}this.output._storedFunction=E=>{var H;let N=0;switch(this.lockMode){case kE.PerParticle:N=(null===(H=E.particleContext)||void 0===H?void 0:H.id)||-1;break;case kE.PerSystem:N=E.buildId||0}return this._currentLockId!==N&&(this.lockMode!==kE.None&&(this._currentLockId=N),this.output._storedValue=e(E)),this.output._storedValue}}serialize(){const e=super.serialize();return e.lockMode=this.lockMode,e}_deserialize(e){super._deserialize(e),this.lockMode=e.lockMode}}(0,K.e)([tE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:kE.None},{label:"Per particle",value:kE.PerParticle},{label:"Per system",value:kE.PerSystem}]})],zH.prototype,"lockMode",void 0),(0,M.g)("BABYLON.ParticleRandomBlock",zH);class PH extends IE{constructor(e){super(e),this._currentLockId=-2,this.lockMode=kE.PerParticle,this.registerInput("min",TE.AutoDetect),this.registerInput("max",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const E=[TE.Matrix,TE.Particle,TE.Texture,TE.System,TE.FloatGradient,TE.Color4Gradient,TE.Vector2Gradient,TE.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...E),this.max.excludedConnectionPointTypes.push(...E)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let e=null;switch(this._currentLockId=-2,this.min.type){case TE.Float:case TE.Int:e=e=>{const E=this.min.getConnectedValue(e),H=this.max.getConnectedValue(e);return Math.random()*(H-E)+E};break;case TE.Vector2:e=e=>{const E=this.min.getConnectedValue(e),H=this.max.getConnectedValue(e);return new N.Vector2(Math.random()*(H.x-E.x)+E.x,Math.random()*(H.y-E.y)+E.y)};break;case TE.jE:e=e=>{const E=this.min.getConnectedValue(e),H=this.max.getConnectedValue(e);return new N.jE(Math.random()*(H.x-E.x)+E.x,Math.random()*(H.y-E.y)+E.y,Math.random()*(H.z-E.z)+E.z)};break;case TE.FM:e=e=>{const E=this.min.getConnectedValue(e),H=this.max.getConnectedValue(e);return new P.FM(Math.random()*(H.r-E.r)+E.r,Math.random()*(H.g-E.g)+E.g,Math.random()*(H.b-E.b)+E.b,Math.random()*(H.a-E.a)+E.a)}}this.output._storedFunction=E=>{var H;let N=0;switch(this.lockMode){case kE.PerParticle:N=(null===(H=E.particleContext)||void 0===H?void 0:H.id)||-1;break;case kE.PerSystem:N=E.buildId||0}return this._currentLockId!==N&&(this.lockMode!==kE.None&&(this._currentLockId=N),this.output._storedValue=e(E)),this.output._storedValue}}serialize(){const e=super.serialize();return e.lockMode=this.lockMode,e}_deserialize(e){super._deserialize(e),void 0!==e.lockMode&&(this.lockMode=e.lockMode)}}(0,K.e)([tE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:kE.None},{label:"Per particle",value:kE.PerParticle},{label:"Per system",value:kE.PerSystem}]})],PH.prototype,"lockMode",void 0),(0,M.g)("BABYLON.RandomRangeBlock",PH);(0,M.g)("BABYLON.ParticleLerpBlock",class extends IE{constructor(e){super(e),this.registerInput("left",TE.AutoDetect),this.registerInput("right",TE.AutoDetect),this.registerInput("gradient",TE.Float,!0,0,0,1),this.registerOutput("output",TE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(TE.Float|TE.Int|TE.Vector2|TE.jE|TE.FM)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const e=(e,E,H)=>(1-e)*E+e*H;this.output._storedFunction=E=>{const H=this.left.getConnectedValue(E),u=this.right.getConnectedValue(E),z=this.gradient.getConnectedValue(E);switch(this.left.type){case TE.Int:case TE.Float:return e(z,H,u);case TE.Vector2:return new N.Vector2(e(z,H.x,u.x),e(z,H.y,u.y));case TE.jE:return new N.jE(e(z,H.x,u.x),e(z,H.y,u.y),e(z,H.z,u.z));case TE.FM:return new P.FM(e(z,H.r,u.r),e(z,H.g,u.g),e(z,H.b,u.b),e(z,H.a,u.a))}return 0}}});(0,M.g)("BABYLON.UpdateDirectionBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("direction",TE.jE),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(e){const E=this.particle.getConnectedValue(e);if(this.output._storedValue=E,!this.direction.isConnected)return;const H={process:H=>{e.particleContext=H,e.systemContext=E,H.direction.P(this.direction.getConnectedValue(e))},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H}});(0,M.g)("BABYLON.UpdateColorBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("color",TE.FM),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(e){const E=this.particle.getConnectedValue(e);if(this.output._storedValue=E,!this.color.isConnected)return;const H={process:H=>{e.particleContext=H,e.systemContext=E,H.color.P(this.color.getConnectedValue(e))},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H}});(0,M.g)("BABYLON.UpdateScaleBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("scale",TE.Vector2),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(e){const E=this.particle.getConnectedValue(e);if(this.output._storedValue=E,!this.scale.isConnected)return;const H={process:H=>{e.particleContext=H,e.systemContext=E,H.scale.P(this.scale.getConnectedValue(e))},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H}});(0,M.g)("BABYLON.UpdateAngleBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("angle",TE.Float),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(e){const E=this.particle.getConnectedValue(e);if(this.output._storedValue=E,!this.angle.isConnected)return;const H={process:H=>{e.particleContext=H,e.systemContext=E,H.angle=this.angle.getConnectedValue(e)},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H}});(0,M.g)("BABYLON.BasicPositionUpdateBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(e){const E=this.particle.getConnectedValue(e),H={process:H=>{e.particleContext=H,e.systemContext=E,H.direction.scaleToRef(E._directionScale,E._scaledDirection),H.position.addInPlace(E._scaledDirection)},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H,this.output._storedValue=E}});(0,M.g)("BABYLON.BasicSpriteUpdateBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(e){const E=this.particle.getConnectedValue(e),H={process:H=>{e.particleContext=H,e.systemContext=E,H.updateCellIndex()},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H,this.output._storedValue=E}});(0,M.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("cellIndex",TE.Int),this.registerOutput("output",TE.Particle),this.cellIndex.acceptedConnectionPointTypes=[TE.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(e){const E=this.particle.getConnectedValue(e);if(this.output._storedValue=E,!this.cellIndex.isConnected)return;const H={process:H=>{e.particleContext=H,e.systemContext=E,H.cellIndex=Math.floor(this.cellIndex.getConnectedValue(e))},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H}});class MH extends IE{constructor(e){super(e),this.strength=1,this.registerInput("particle",TE.Particle),this.registerInput("flowMap",TE.Texture),this.registerOutput("output",TE.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(e){var E;const H=this.particle.getConnectedValue(e),N=e.hE;let u;(null===(E=this.flowMap.connectedPoint)||void 0===E?void 0:E.ownerBlock).extractTextureContentAsync().then((e=>{e&&(u=new RE(e.width,e.height,e.data))}));const z={process:e=>{const E=N.getTransformMatrix();u&&u._processParticle(e,this.strength*H._tempScaledUpdateSpeed,E)},previousItem:null,nextItem:null};H._updateQueueStart?Qe(z,H._updateQueueStart):H._updateQueueStart=z,this.output._storedValue=H}serialize(){const e=super.serialize();return e.strength=this.strength,e}_deserialize(e){super._deserialize(e),this.strength=e.strength}}(0,K.e)([tE("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MH.prototype,"strength",void 0),(0,M.g)("BABYLON.UpdateFlowMapBlock",MH);(0,M.g)("BABYLON.SphereShapeBlock",class extends IE{constructor(e){super(e),this.registerInput("input",TE.Particle),this.registerInput("radius",TE.Float,!0,1),this.registerInput("radiusRange",TE.Float,!0,1,0,1),this.registerInput("directionRandomizer",TE.Float,!0,0,0,1),this.registerOutput("output",TE.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(e){const E=this.input.getConnectedValue(e);E._directionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.directionRandomizer.getConnectedValue(e),z=H.position.FE(e.emitterPosition).normalize(),P=(0,A.RandomRange)(0,u),M=(0,A.RandomRange)(0,u),D=(0,A.RandomRange)(0,u);z.x+=P,z.y+=M,z.z+=D,z.normalize(),e.isEmitterTransformNode?N.jE.TransformNormalFromFloatsToRef(P,M,D,e.emitterWorldMatrix,H.direction):H.direction.VM(P,M,D)},E._positionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.radius.getConnectedValue(e),z=this.radiusRange.getConnectedValue(e),P=u-(0,A.RandomRange)(0,u*z),M=(0,A.RandomRange)(0,1),D=(0,A.RandomRange)(0,2*Math.PI),C=Math.acos(2*M-1),i=P*Math.cos(D)*Math.sin(C),V=P*Math.cos(C),U=P*Math.sin(D)*Math.sin(C);e.isEmitterTransformNode?N.jE.TransformCoordinatesFromFloatsToRef(i,V,U,e.emitterWorldMatrix,H.position):(H.position.VM(i,V,U),H.position.addInPlace(e.emitterPosition))},this.output._storedValue=E}});(0,M.g)("BABYLON.PointShapeBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("direction1",TE.jE,!0,new N.jE(0,1,0)),this.registerInput("direction2",TE.jE,!0,new N.jE(0,1,0)),this.registerOutput("output",TE.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(e){const E=this.particle.getConnectedValue(e);E._directionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.direction1.getConnectedValue(e),z=this.direction2.getConnectedValue(e),P=(0,A.RandomRange)(u.x,z.x),M=(0,A.RandomRange)(u.y,z.y),D=(0,A.RandomRange)(u.z,z.z);e.isEmitterTransformNode?N.jE.TransformNormalFromFloatsToRef(P,M,D,e.emitterWorldMatrix,H.direction):H.direction.VM(P,M,D)},E._positionCreation.process=H=>{e.systemContext=E,e.isEmitterTransformNode?N.jE.TransformCoordinatesFromFloatsToRef(0,0,0,e.emitterWorldMatrix,H.position):H.position.P(e.emitterPosition)},this.output._storedValue=E}});(0,M.g)("BABYLON.CustomShapeBlock",class extends IE{constructor(e){super(e),this.registerInput("particle",TE.Particle),this.registerInput("position",TE.jE,!0,new N.jE(0,0,0)),this.registerInput("direction",TE.jE,!0,new N.jE(0,1,0)),this.registerOutput("output",TE.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(e){const E=this.particle.getConnectedValue(e);E._directionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.direction.getConnectedValue(e);e.isEmitterTransformNode?N.jE.TransformNormalToRef(u,e.emitterWorldMatrix,H.direction):H.direction.P(u)},E._positionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.position.getConnectedValue(e);e.isEmitterTransformNode?N.jE.TransformCoordinatesToRef(u,e.emitterWorldMatrix,H.position):(H.position.P(u),H.position.addInPlace(e.emitterPosition))},this.output._storedValue=E}});(0,M.g)("BABYLON.CylinderShapeBlock",class extends IE{constructor(e){super(e),this._tempVector=N.jE.Zero(),this.registerInput("particle",TE.Particle),this.registerInput("radius",TE.Float,!0,1),this.registerInput("height",TE.Float,!0,1,0),this.registerInput("radiusRange",TE.Float,!0,1,0,1),this.registerInput("directionRandomizer",TE.Float,!0,0,0,1),this.registerOutput("output",TE.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(e){const E=this.particle.getConnectedValue(e);E._directionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.directionRandomizer.getConnectedValue(e);H.position.subtractToRef(e.emitterPosition,this._tempVector),this._tempVector.normalize(),e.isEmitterTransformNode&&N.jE.TransformNormalToRef(this._tempVector,e.emitterInverseWorldMatrix,this._tempVector);const z=(0,A.RandomRange)(-u/2,u/2);let P=Math.atan2(this._tempVector.x,this._tempVector.z);P+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*u,this._tempVector.y=z,this._tempVector.x=Math.sin(P),this._tempVector.z=Math.cos(P),this._tempVector.normalize(),e.isEmitterTransformNode?N.jE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,e.emitterWorldMatrix,H.direction):H.direction.P(this._tempVector)},E._positionCreation.process=H=>{e.particleContext=H,e.systemContext=E;const u=this.height.getConnectedValue(e),z=this.radiusRange.getConnectedValue(e),P=this.radius.getConnectedValue(e),M=(0,A.RandomRange)(-u/2,u/2),D=(0,A.RandomRange)(0,2*Math.PI),C=(0,A.RandomRange)((1-z)*(1-z),1),i=Math.sqrt(C)*P,V=i*Math.cos(D),U=i*Math.sin(D);e.isEmitterTransformNode?N.jE.TransformCoordinatesFromFloatsToRef(V,M,U,e.emitterWorldMatrix,H.position):(H.position.VM(V,M,U),H.position.addInPlace(e.emitterPosition))},this.output._storedValue=E}});class DH extends IE{constructor(e){super(e),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",TE.Particle),this.registerOutput("output",TE.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){super._build(e);const E=this.particle.getConnectedValue(e);E._isAnimationSheetEnabled=!0,E.spriteCellWidth=this.width,E.spriteCellHeight=this.height,E.startSpriteCellID=this.start,E.endSpriteCellID=this.end,E.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=E}serialize(){const e=super.serialize();return e.width=this.width,e.height=this.height,e.start=this.start,e.end=this.end,e.randomStartCell=this.randomStartCell,e}_deserialize(e){super._deserialize(e),this.width=e.width,this.height=e.height,this.start=e.start,this.end=e.end,this.randomStartCell=e.randomStartCell}}(0,K.e)([tE("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DH.prototype,"start",void 0),(0,K.e)([tE("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DH.prototype,"end",void 0),(0,K.e)([tE("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DH.prototype,"width",void 0),(0,K.e)([tE("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DH.prototype,"height",void 0),(0,K.e)([tE("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],DH.prototype,"loop",void 0),(0,K.e)([tE("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],DH.prototype,"randomStartCell",void 0),(0,M.g)("BABYLON.SetupSpriteSheetBlock",DH);class AH extends IE{constructor(e){super(e),this.reference=0,this.registerInput("value",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=e=>{switch(e){case TE.Float:return TE.FloatGradient;case TE.Vector2:return TE.Vector2Gradient;case TE.jE:return TE.Vector3Gradient;case TE.FM:return TE.Color4Gradient}return e},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(TE.Float|TE.Vector2|TE.jE|TE.FM)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=e=>null}serialize(){const e=super.serialize();return e.reference=this.reference,e}_deserialize(e){super._deserialize(e),this.reference=e.reference}}(0,K.e)([tE("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],AH.prototype,"reference",void 0),(0,M.g)("BABYLON.ParticleGradientValueBlock",AH);(0,M.g)("BABYLON.ParticleGradientBlock",class extends IE{constructor(e){super(e),this._entryCount=1,this.registerInput("gradient",TE.Float,!0,1,0,1),this.registerInput("value0",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=e=>{switch(e){case TE.FloatGradient:return TE.Float;case TE.Vector2Gradient:return TE.Vector2;case TE.Vector3Gradient:return TE.jE;case TE.Color4Gradient:return TE.FM}return e},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(TE.FloatGradient|TE.Vector2Gradient|TE.Vector3Gradient|TE.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(e){this._inputs[e].onConnectionObservable.add((()=>{this._entryCount>e||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),TE.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const e=[];for(let H=1;H<this._inputs.length;H++){var E;if(this._inputs[H].isConnected)e.push(null===(E=this._inputs[H].connectedPoint)||void 0===E?void 0:E.ownerBlock)}e.sort(((e,E)=>e.reference-E.reference)),this.output._storedFunction=E=>{const H=this.gradient.getConnectedValue(E);if(1===e.length)return e[0].value.getConnectedValue(E);let u=null;for(let z=e.length-1;z>=0;z--){const M=e[z];if(M.reference<=H){const e=M.value.getConnectedValue(E);if(u){const z=u.value.getConnectedValue(E),D=u.reference,C=M.reference,i=Math.max(0,Math.min(1,(H-C)/(D-C)));switch(this.output.type){case TE.Float:return(0,A.Lerp)(e,z,i);case TE.Vector2:return N.Vector2.Lerp(e,z,i);case TE.jE:return N.jE.Lerp(e,z,i);case TE.FM:return P.FM.Lerp(e,z,i)}}return e}u=M}return 0}}});(0,M.g)("BABYLON.ParticleConverterBlock",class extends IE{constructor(e){super(e),this.registerInput("color ",TE.FM,!0),this.registerInput("xyz ",TE.jE,!0),this.registerInput("xy ",TE.Vector2,!0),this.registerInput("zw ",TE.Vector2,!0),this.registerInput("x ",TE.Float,!0),this.registerInput("y ",TE.Float,!0),this.registerInput("z ",TE.Float,!0),this.registerInput("w ",TE.Float,!0),this.registerOutput("color",TE.FM),this.registerOutput("xyz",TE.jE),this.registerOutput("xy",TE.Vector2),this.registerOutput("zw",TE.Vector2),this.registerOutput("x",TE.Float),this.registerOutput("y",TE.Float),this.registerOutput("z",TE.Float),this.registerOutput("w",TE.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(e){return"color "===e?"colorIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":"x "===e?"xIn":"y "===e?"yIn":"z "===e?"zIn":"w "===e?"wIn":e}_outputRename(e){switch(e){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return e}}_build(e){super._build(e);const E=this.xIn,H=this.yIn,u=this.zIn,z=this.wIn,M=this.xyIn,D=this.zwIn,A=this.xyzIn,C=this.colorIn,i=this.colorOut,V=this.xyzOut,U=this.xyOut,j=this.zwOut,F=this.xOut,h=this.yOut,S=this.zOut,X=this.wOut,a=e=>{if(C.isConnected)return C.getConnectedValue(e);let N=0,i=0,V=0,U=0;if(E.isConnected&&(N=E.getConnectedValue(e)),H.isConnected&&(i=H.getConnectedValue(e)),u.isConnected&&(V=u.getConnectedValue(e)),z.isConnected&&(U=z.getConnectedValue(e)),M.isConnected){const E=M.getConnectedValue(e);E&&(N=E.x,i=E.y)}if(D.isConnected){const E=D.getConnectedValue(e);E&&(V=E.x,U=E.y)}if(A.isConnected){const E=A.getConnectedValue(e);E&&(N=E.x,i=E.y,V=E.z)}return new P.FM(N,i,V,U)};i._storedFunction=e=>a(e),V._storedFunction=e=>{const E=a(e);return new N.jE(E.r,E.g,E.b)},U._storedFunction=e=>{const E=a(e);return new N.Vector2(E.r,E.g)},j._storedFunction=e=>{const E=a(e);return new N.Vector2(E.b,E.a)},F._storedFunction=e=>a(e).r,h._storedFunction=e=>a(e).g,S._storedFunction=e=>a(e).b,X._storedFunction=e=>a(e).a}}),function(e){e[e.Cos=0]="Cos",e[e.Sin=1]="Sin",e[e.Abs=2]="Abs",e[e.Exp=3]="Exp",e[e.Exp2=4]="Exp2",e[e.Round=5]="Round",e[e.Floor=6]="Floor",e[e.Ceiling=7]="Ceiling",e[e.Sqrt=8]="Sqrt",e[e.Log=9]="Log",e[e.Tan=10]="Tan",e[e.ArcTan=11]="ArcTan",e[e.ArcCos=12]="ArcCos",e[e.ArcSin=13]="ArcSin",e[e.Sign=14]="Sign",e[e.Negate=15]="Negate",e[e.OneMinus=16]="OneMinus",e[e.Reciprocal=17]="Reciprocal",e[e.ToDegrees=18]="ToDegrees",e[e.ToRadians=19]="ToRadians",e[e.Fract=20]="Fract"}(JE||(JE={}));class CH extends IE{constructor(e){super(e),this.operation=JE.Cos,this.registerInput("input",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(TE.Float|TE.Int|TE.Vector2|TE.jE|TE.FM)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){super._build(e);let E=null;switch(this.operation){case JE.Cos:E=e=>Math.cos(e);break;case JE.Sin:E=e=>Math.sin(e);break;case JE.Abs:E=e=>Math.abs(e);break;case JE.Exp:E=e=>Math.exp(e);break;case JE.Exp2:E=e=>Math.pow(2,e);break;case JE.Round:E=e=>Math.round(e);break;case JE.Floor:E=e=>Math.floor(e);break;case JE.Ceiling:E=e=>Math.ceil(e);break;case JE.Sqrt:E=e=>Math.sqrt(e);break;case JE.Log:E=e=>Math.log(e);break;case JE.Tan:E=e=>Math.tan(e);break;case JE.ArcTan:E=e=>Math.atan(e);break;case JE.ArcCos:E=e=>Math.acos(e);break;case JE.ArcSin:E=e=>Math.asin(e);break;case JE.Sign:E=e=>Math.sign(e);break;case JE.Negate:E=e=>-e;break;case JE.OneMinus:E=e=>1-e;break;case JE.Reciprocal:E=e=>1/e;break;case JE.ToRadians:E=e=>e*Math.PI/180;break;case JE.ToDegrees:E=e=>180*e/Math.PI;break;case JE.Fract:E=e=>e>=0?e-Math.floor(e):e-Math.ceil(e)}if(!E)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case TE.Int:case TE.Float:this.output._storedFunction=e=>{const H=this.input.getConnectedValue(e);return E(H)};break;case TE.Vector2:this.output._storedFunction=e=>{const H=this.input.getConnectedValue(e);return new N.Vector2(E(H.x),E(H.y))};break;case TE.jE:this.output._storedFunction=e=>{const H=this.input.getConnectedValue(e);return new N.jE(E(H.x),E(H.y),E(H.z))};break;case TE.FM:this.output._storedFunction=e=>{const H=this.input.getConnectedValue(e);return new P.FM(E(H.r),E(H.g),E(H.b),E(H.a))}}return this}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.operation=e.operation}}(0,K.e)([tE("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:JE.Cos},{label:"Sin",value:JE.Sin},{label:"Abs",value:JE.Abs},{label:"Exp",value:JE.Exp},{label:"Exp2",value:JE.Exp2},{label:"Round",value:JE.Round},{label:"Floor",value:JE.Floor},{label:"Ceiling",value:JE.Ceiling},{label:"Sqrt",value:JE.Sqrt},{label:"Log",value:JE.Log},{label:"Tan",value:JE.Tan},{label:"ArcTan",value:JE.ArcTan},{label:"ArcCos",value:JE.ArcCos},{label:"ArcSin",value:JE.ArcSin},{label:"Sign",value:JE.Sign},{label:"Negate",value:JE.Negate},{label:"OneMinus",value:JE.OneMinus},{label:"Reciprocal",value:JE.Reciprocal},{label:"ToDegrees",value:JE.ToDegrees},{label:"ToRadians",value:JE.ToRadians},{label:"Fract",value:JE.Fract}]})],CH.prototype,"operation",void 0),(0,M.g)("BABYLON.ParticleTrigonometryBlock",CH);var iH,VH=H(13117);class UH extends IE{constructor(e){super(e),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(TE.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(TE.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(TE.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(TE.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(TE.System),this._inputs[0].excludedConnectionPointTypes.push(TE.Particle),this._inputs[0].excludedConnectionPointTypes.push(TE.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const E=e=>{const E=this.input.getConnectedValue(e);if(this.log.length>=this.stackSize)return E;if(null===E||void 0===E)return this.log.push(["null",""]),E;switch(this.input.type){case TE.Vector2:this.log.push([(0,VH.f)(E,4),E.toString()]);break;case TE.jE:this.log.push([(0,VH.j)(E,4),E.toString()]);break;case TE.FM:this.log.push([`{R: ${E.r.toFixed(4)} G: ${E.g.toFixed(4)} B: ${E.b.toFixed(4)} A: ${E.a.toFixed(4)}}`,E.toString()]);break;default:this.log.push([E.toString(),E.toString()])}return E};this.output.isConnected?this.output._storedFunction=E:this.output._storedValue=E(e)}serialize(){const e=super.serialize();return e.stackSize=this.stackSize,e}_deserialize(e){super._deserialize(e),this.stackSize=e.stackSize}}(0,K.e)([tE("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],UH.prototype,"stackSize",void 0),(0,M.g)("BABYLON.ParticleDebugBlock",UH);(0,M.g)("BABYLON.ParticleElbowBlock",class extends IE{constructor(e){super(e),this.registerInput("input",TE.AutoDetect),this.registerOutput("output",TE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){super._build(e);const E=this._outputs[0],H=this._inputs[0];E._storedFunction=e=>H.getConnectedValue(e)}});(0,M.g)("BABYLON.ParticleTeleportInBlock",class extends IE{get endpoints(){return this._endpoints}constructor(e){super(e),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",TE.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const E of this.endpoints)if(E.isAnAncestorOfType(e))return!0;return!1}isAnAncestorOf(e){for(const E of this.endpoints){if(E===e)return!0;if(E.isAnAncestorOf(e))return!0}return!1}attachToEndpoint(e){e.detach(),this._endpoints.push(e),e._entryPoint=this,e._outputs[0]._typeConnectionSource=this._inputs[0],e._tempEntryPointUniqueId=null,e.name="> "+this.name}detachFromEndpoint(e){const E=this._endpoints.indexOf(e);-1!==E&&(this._endpoints.splice(E,1),e._outputs[0]._typeConnectionSource=null,e._entryPoint=null)}_build(){for(const e of this._endpoints)e.output._storedFunction=e=>this.input.getConnectedValue(e)}});(0,M.g)("BABYLON.ParticleTeleportOutBlock",class extends IE{constructor(e){super(e),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",TE.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(e){this.entryPoint&&this.entryPoint.build(e)}clone(){const e=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(e),e}serialize(){var e;const E=super.serialize();return E.entryPoint=(null===(e=this.entryPoint)||void 0===e?void 0:e.uniqueId)??"",E}_deserialize(e){super._deserialize(e),this._tempEntryPointUniqueId=e.entryPoint}}),function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.LessThan=2]="LessThan",e[e.GreaterThan=3]="GreaterThan",e[e.LessOrEqual=4]="LessOrEqual",e[e.GreaterOrEqual=5]="GreaterOrEqual",e[e.Xor=6]="Xor",e[e.Or=7]="Or",e[e.And=8]="And"}(iH||(iH={}));class jH extends IE{constructor(e){super(e),this.test=iH.Equal,this.epsilon=0,this.registerInput("left",TE.Float),this.registerInput("right",TE.Float,!0,0),this.registerInput("ifTrue",TE.AutoDetect,!0,1),this.registerInput("ifFalse",TE.AutoDetect,!0,0),this.registerOutput("output",TE.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=TE.Float,this._inputs[0].acceptedConnectionPointTypes.push(TE.Int),this._inputs[1].acceptedConnectionPointTypes.push(TE.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const e=e=>{const E=this.left.getConnectedValue(e),H=this.right.getConnectedValue(e);let N=!1;switch(this.test){case iH.Equal:N=(0,A.WithinEpsilon)(E,H,this.epsilon);break;case iH.NotEqual:N=!(0,A.WithinEpsilon)(E,H,this.epsilon);break;case iH.LessThan:N=E<H+this.epsilon;break;case iH.GreaterThan:N=E>H-this.epsilon;break;case iH.LessOrEqual:N=E<=H+this.epsilon;break;case iH.GreaterOrEqual:N=E>=H-this.epsilon;break;case iH.Xor:N=!!E&&!H||!E&&!!H;break;case iH.Or:N=!!E||!!H;break;case iH.And:N=!!E&&!!H}return N};this.output._storedFunction=E=>e(E)?this.ifTrue.getConnectedValue(E):this.ifFalse.getConnectedValue(E)}serialize(){const e=super.serialize();return e.test=this.test,e.epsilon=this.epsilon,e}_deserialize(e){super._deserialize(e),this.test=e.test,void 0!==e.epsilon&&(this.epsilon=e.epsilon)}}(0,K.e)([tE("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:iH.Equal},{label:"NotEqual",value:iH.NotEqual},{label:"LessThan",value:iH.LessThan},{label:"GreaterThan",value:iH.GreaterThan},{label:"LessOrEqual",value:iH.LessOrEqual},{label:"GreaterOrEqual",value:iH.GreaterOrEqual},{label:"Xor",value:iH.Xor},{label:"Or",value:iH.Or},{label:"And",value:iH.And}]})],jH.prototype,"test",void 0),(0,K.e)([tE("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jH.prototype,"epsilon",void 0),(0,M.g)("BABYLON.ParticleConditionBlock",jH);class FH extends IE{constructor(e){super(e),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",TE.Particle),this.registerInput("condition",TE.Float,!0,0),this.registerInput("system",TE.System),this.registerOutput("output",TE.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(e){this._triggerCount=0;const E=this.input.getConnectedValue(e),H={process:H=>{if(e.particleContext=H,e.systemContext=E,0!==this.condition.getConnectedValue(e)&&(0===this.limit||this._triggerCount<this.limit)){const N=(new Date).getTime();if(this._previousOne&&N-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=N;const u=this.system.getConnectedValue(e);if(u){const N=cE(u,e.hE,H.position);N.cP.addOnce((()=>{this._triggerCount--})),E.cP.addOnce((()=>{N.dispose()}))}}},previousItem:null,nextItem:null};E._updateQueueStart?Qe(H,E._updateQueueStart):E._updateQueueStart=H,this.output._storedValue=E}serialize(){const e=super.serialize();return e.limit=this.limit,e.delay=this.delay,e}_deserialize(e){super._deserialize(e),void 0!==e.limit&&(this.limit=e.limit),void 0!==e.delay&&(this.delay=e.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,K.e)([tE("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FH.prototype,"limit",void 0),(0,K.e)([tE("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FH.prototype,"delay",void 0),(0,M.g)("BABYLON.ParticleTriggerBlock",FH);H(13120),H(13132),H(13143),H(13187)},13177:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13145:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13197:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneVertex",z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13192:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13185:(e,E,H)=>{"use strict";var N=H(11633);const u="fogFragment",z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13169:(e,E,H)=>{"use strict";var N=H(11633);const u="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13202:(e,E,H)=>{"use strict";var N=H(11633);const u="fogVertex",z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13194:(e,E,H)=>{"use strict";var N=H(11633);const u="fogVertexDeclaration",z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13160:(e,E,H)=>{"use strict";var N=H(11633);const u="helperFunctions",z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13153:(e,E,H)=>{"use strict";var N=H(11633);const u="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13167:(e,E,H)=>{"use strict";var N=H(11633);const u="imageProcessingFunctions",z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13156:(e,E,H)=>{"use strict";var N=H(11633);const u="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13179:(e,E,H)=>{"use strict";var N=H(11633);const u="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13210:(e,E,H)=>{"use strict";var N=H(11633);const u="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";N.d.IncludesShadersStoreWGSL[u]||(N.d.IncludesShadersStoreWGSL[u]=z)},13143:(e,E,H)=>{"use strict";H.r(E),H.d(E,{particlesPixelShaderWGSL:()=>P});var N=H(11633);H(13145),H(13153),H(13156),H(13160),H(13167),H(13169),H(13177),H(13179),H(13185);const u="particlesPixelShader",z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.d.ShadersStoreWGSL[u]||(N.d.ShadersStoreWGSL[u]=z);const P={name:u,shader:z}},13187:(e,E,H)=>{"use strict";H.r(E),H.d(E,{particlesVertexShaderWGSL:()=>P});var N=H(11633);H(13192),H(13194),H(13156),H(13197),H(13202),H(13210);const u="particlesVertexShader",z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.d.ShadersStoreWGSL[u]||(N.d.ShadersStoreWGSL[u]=z);const P={name:u,shader:z}},13051:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13129:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13072:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneVertex",z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13138:(e,E,H)=>{"use strict";var N=H(11633);const u="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13061:(e,E,H)=>{"use strict";var N=H(11633);const u="fogFragment",z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13048:(e,E,H)=>{"use strict";var N=H(11633);const u="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13081:(e,E,H)=>{"use strict";var N=H(11633);const u="fogVertex",z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13067:(e,E,H)=>{"use strict";var N=H(11633);const u="fogVertexDeclaration",z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13032:(e,E,H)=>{"use strict";var N=H(11633);const u="helperFunctions",z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13025:(e,E,H)=>{"use strict";var N=H(11633);const u="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13039:(e,E,H)=>{"use strict";var N=H(11633);const u="imageProcessingFunctions",z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13030:(e,E,H)=>{"use strict";var N=H(11633);const u="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13056:(e,E,H)=>{"use strict";var N=H(11633);const u="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13088:(e,E,H)=>{"use strict";var N=H(11633);const u="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";N.d.IncludesShadersStore[u]||(N.d.IncludesShadersStore[u]=z)},13120:(e,E,H)=>{"use strict";H.r(E),H.d(E,{particlesPixelShader:()=>P});var N=H(11633);H(13129),H(13025),H(13030),H(13032),H(13039),H(13048),H(13051),H(13056),H(13061);const u="particlesPixelShader",z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.d.ShadersStore[u]||(N.d.ShadersStore[u]=z);const P={name:u,shader:z}},13132:(e,E,H)=>{"use strict";H.r(E),H.d(E,{particlesVertexShader:()=>P});var N=H(11633);H(13138),H(13067),H(13030),H(13072),H(13081),H(13088);const u="particlesVertexShader",z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.d.ShadersStore[u]||(N.d.ShadersStore[u]=z);const P={name:u,shader:z}},13480:(e,E,H)=>{"use strict";H.r(E),H.d(E,{FlowGraphGLTFDataProvider:()=>z});var N=H(13441),u=H(13415);class z extends N.b{constructor(e){var E,H;super();const N=e.glTF,z=(null===(E=N.animations)||void 0===E?void 0:E.map((e=>e._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",u.b,z);const P=(null===(H=N.nodes)||void 0===H?void 0:H.map((e=>e._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",u.b,P)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13349:(e,E,H)=>{"use strict";H.d(E,{e:()=>h,h:()=>j,l:()=>U,m:()=>F});var N=H(11738),u=H(12194),z=H(11789),P=H(13354);const M=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class D{constructor(e,E){this._gltf=e,this._infoTree=E}convert(e){let E,H=this._gltf,N=this._infoTree;if(!e.startsWith("/"))throw new Error("Path must start with a /");const u=e.split("/");if(u.shift(),u[u.length-1].includes(".length")){const e=u[u.length-1].split(".");u.pop(),u.push(...e)}let z=!1;for(const D of u){const u="length"===D;if(u&&!N.__array__)throw new Error(`Path ${e} is invalid`);if(N.__ignoreObjectTree__&&(z=!0),N.__array__&&!u)N=N.__array__;else if(N=N[D],!N)throw new Error(`Path ${e} is invalid`);if(!z)if(void 0===H){if(!M.find((E=>E.regex.test(e))))throw new Error(`Path ${e} is invalid`)}else if(!u){var P;H=null===(P=H)||void 0===P?void 0:P[D]}(N.__target__||u)&&(E=H)}return{object:E,info:N}}}function A(e,E,H,N){const u=C(e,E);return N?u[H][N]:u[H]}function C(e,E,H){var N,z;return null===(N=e._data)||void 0===N||null===(z=N[(null===H||void 0===H?void 0:H.fillMode)??u.d.MATERIAL_TriangleFillMode])||void 0===z?void 0:z.babylonMaterial}function i(e,E){return{offset:{componentsCount:2,type:"Vector2",get:(H,u,z)=>{const P=A(H,z,e,E);return new N.Vector2(null===P||void 0===P?void 0:P.uOffset,null===P||void 0===P?void 0:P.vOffset)},getTarget:C,set:(H,N,u,z)=>{const P=A(N,z,e,E);P.uOffset=H.x,P.vOffset=H.y},getPropertyName:[()=>`${e}${E?"."+E:""}.uOffset`,()=>`${e}${E?"."+E:""}.vOffset`]},rotation:{type:"number",get:(H,N,u)=>{var z;return null===(z=A(H,u,e,E))||void 0===z?void 0:z.wAng},getTarget:C,set:(H,N,u,z)=>A(N,z,e,E).wAng=H,getPropertyName:[()=>`${e}${E?"."+E:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(H,u,z)=>{const P=A(H,z,e,E);return new N.Vector2(null===P||void 0===P?void 0:P.uScale,null===P||void 0===P?void 0:P.vScale)},getTarget:C,set:(H,N,u,z)=>{const P=A(N,z,e,E);P.uScale=H.x,P.vScale=H.y},getPropertyName:[()=>`${e}${E?"."+E:""}.uScale`,()=>`${e}${E?"."+E:""}.vScale`]}}}const V={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:e=>{var E,H;return new N.Vector2((null===(E=e._babylonCamera)||void 0===E?void 0:E.orthoLeft)??0,(null===(H=e._babylonCamera)||void 0===H?void 0:H.orthoRight)??0)},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.orthoLeft=e.x,E._babylonCamera.orthoRight=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:e=>{var E,H;return new N.Vector2((null===(E=e._babylonCamera)||void 0===E?void 0:E.orthoBottom)??0,(null===(H=e._babylonCamera)||void 0===H?void 0:H.orthoTop)??0)},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.orthoBottom=e.x,E._babylonCamera.orthoTop=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:e=>{var E;return null===(E=e._babylonCamera)||void 0===E?void 0:E.maxZ},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>{var E;return null===(E=e._babylonCamera)||void 0===E?void 0:E.PM},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.PM=e)},getTarget:e=>e,getPropertyName:[()=>"PM"]}},perspective:{aspectRatio:{type:"number",get:e=>{var E;return null===(E=e._babylonCamera)||void 0===E?void 0:E.getEngine().getAspectRatio(e._babylonCamera)},getTarget:e=>e,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:e=>{var E;return null===(E=e._babylonCamera)||void 0===E?void 0:E.fov},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.fov=e)},getTarget:e=>e,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:e=>{var E;return null===(E=e._babylonCamera)||void 0===E?void 0:E.maxZ},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>{var E;return null===(E=e._babylonCamera)||void 0===E?void 0:E.PM},set:(e,E)=>{E._babylonCamera&&(E._babylonCamera.PM=e)},getTarget:e=>e,getPropertyName:[()=>"PM"]}}}},nodes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"jE",get:e=>{var E;return null===(E=e._babylonTransformNode)||void 0===E?void 0:E.position},set:(e,E)=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.position.P(e)},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:e=>{var E;return null===(E=e._babylonTransformNode)||void 0===E?void 0:E.rotationQuaternion},set:(e,E)=>{var H,N;return null===(H=E._babylonTransformNode)||void 0===H||null===(N=H.rotationQuaternion)||void 0===N?void 0:N.P(e)},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"jE",get:e=>{var E;return null===(E=e._babylonTransformNode)||void 0===E?void 0:E.UM},set:(e,E)=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.UM.P(e)},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"UM"]},weights:{length:{type:"number",get:e=>e._numMorphTargets,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(e,E)=>{var H,N;return void 0!==E?null===(H=e._primitiveBabylonMeshes)||void 0===H||null===(N=H[0].morphTargetManager)||void 0===N?void 0:N.getTarget(E).influence:void 0},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(e,E)=>[0],getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:e=>{var E,H,u;return N.Matrix.Compose(null===(E=e._babylonTransformNode)||void 0===E?void 0:E.UM,null===(H=e._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion,null===(u=e._babylonTransformNode)||void 0===u?void 0:u.position)},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:e=>{var E,H,u,z;const P=N.Matrix.Identity();let M=e.parent;for(;M&&M.parent;)M=M.parent;const D=(null===(E=e._babylonTransformNode)||void 0===E?void 0:E.position._isDirty)||(null===(H=e._babylonTransformNode)||void 0===H||null===(u=H.rotationQuaternion)||void 0===u?void 0:u._isDirty)||(null===(z=e._babylonTransformNode)||void 0===z?void 0:z.UM._isDirty);if(M){var A;const E=null===(A=M._babylonTransformNode)||void 0===A?void 0:A.DM(!0).invert();var C,i;if(E)null===(C=e._babylonTransformNode)||void 0===C||null===(i=C.DM(D))||void 0===i||i.multiplyToRef(E,P)}else e._babylonTransformNode&&P.P(e._babylonTransformNode.DM(D));return P},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:e=>{var E,H;return null===(E=e._babylonTransformNode)||void 0===E||null===(H=E.getChildren((e=>e instanceof P.e),!0)[0])||void 0===H?void 0:H.XM},getTarget:e=>{var E;return null===(E=e._babylonTransformNode)||void 0===E?void 0:E.getChildren((e=>e instanceof P.e),!0)[0]},set:(e,E)=>{if(E._babylonTransformNode){const H=E._babylonTransformNode.getChildren((e=>e instanceof P.e),!0)[0];H&&(H.XM=e)}}},color:{type:"XE",get:e=>{var E,H;return null===(E=e._babylonTransformNode)||void 0===E||null===(H=E.getChildren((e=>e instanceof P.e),!0)[0])||void 0===H?void 0:H.aM},getTarget:e=>{var E;return null===(E=e._babylonTransformNode)||void 0===E?void 0:E.getChildren((e=>e instanceof P.e),!0)[0]},set:(e,E)=>{if(E._babylonTransformNode){const H=E._babylonTransformNode.getChildren((e=>e instanceof P.e),!0)[0];H&&(H.aM=e)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"XE",get:(e,E,H)=>C(e,E,H).emissiveColor,set:(e,E,H,N)=>C(E,H,N).emissiveColor.P(e),getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:i("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(e,E,H)=>{var N;return null===(N=A(e,H,"bumpTexture"))||void 0===N?void 0:N.level},set:(e,E,H,N)=>{const u=A(E,N,"bumpTexture");u&&(u.level=e)},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:i("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(e,E,H)=>C(e,E,H).ambientTextureStrength,set:(e,E,H,N)=>{const u=C(E,H,N);u&&(u.ambientTextureStrength=e)},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:i("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"FM",get:(e,E,H)=>{const N=C(e,E,H);return z.FM.FromColor3(N.albedoColor,N.alpha)},set:(e,E,H,N)=>{const u=C(E,H,N);u.albedoColor.set(e.r,e.g,e.b),u.alpha=e.a},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:i("albedoTexture")}},metallicFactor:{type:"number",get:(e,E,H)=>C(e,E,H).metallic,set:(e,E,H,N)=>{const u=C(E,H,N);u&&(u.metallic=e)},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(e,E,H)=>C(e,E,H).roughness,set:(e,E,H,N)=>{const u=C(E,H,N);u&&(u.roughness=e)},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:i("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(e,E,H)=>C(e,E,H).anisotropy.XM,set:(e,E,H,N)=>{C(E,H,N).anisotropy.XM=e},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(e,E,H)=>C(e,E,H).anisotropy.angle,set:(e,E,H,N)=>{C(E,H,N).anisotropy.angle=e},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:i("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(e,E,H)=>C(e,E,H).clearCoat.XM,set:(e,E,H,N)=>{C(E,H,N).clearCoat.XM=e},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(e,E,H)=>C(e,E,H).clearCoat.roughness,set:(e,E,H,N)=>{C(E,H,N).clearCoat.roughness=e},getTarget:(e,E,H)=>C(e,E,H),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:i("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(e,E,H)=>{var N;return null===(N=C(e,E,H).clearCoat.bumpTexture)||void 0===N?void 0:N.level},getTarget:C,set:(e,E,H,N)=>C(E,H,N).clearCoat.bumpTexture.level=e},extensions:{KHR_texture_transform:i("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:i("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(e,E,H)=>C(e,E,H).subSurface.dispersion,getTarget:C,set:(e,E,H,N)=>C(E,H,N).subSurface.dispersion=e}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(e,E,H)=>C(e,E,H).emissiveIntensity,getTarget:C,set:(e,E,H,N)=>C(E,H,N).emissiveIntensity=e}},KHR_materials_ior:{ior:{type:"number",get:(e,E,H)=>C(e,E,H).indexOfRefraction,getTarget:C,set:(e,E,H,N)=>C(E,H,N).indexOfRefraction=e}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(e,E,H)=>C(e,E,H).iridescence.XM,getTarget:C,set:(e,E,H,N)=>C(E,H,N).iridescence.XM=e},iridescenceIor:{type:"number",get:(e,E,H)=>C(e,E,H).iridescence.indexOfRefraction,getTarget:C,set:(e,E,H,N)=>C(E,H,N).iridescence.indexOfRefraction=e},iridescenceTexture:{extensions:{KHR_texture_transform:i("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(e,E,H)=>C(e,E,H).iridescence.maximumThickness,getTarget:C,set:(e,E,H,N)=>C(E,H,N).iridescence.maximumThickness=e},iridescenceThicknessMinimum:{type:"number",get:(e,E,H)=>C(e,E,H).iridescence.minimumThickness,getTarget:C,set:(e,E,H,N)=>C(E,H,N).iridescence.minimumThickness=e},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:i("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"XE",get:(e,E,H)=>C(e,E,H).sheen.color,getTarget:C,set:(e,E,H,N)=>C(E,H,N).sheen.color.P(e)},sheenColorTexture:{extensions:{KHR_texture_transform:i("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(e,E,H)=>C(e,E,H).sheen.XM,getTarget:C,set:(e,E,H,N)=>C(E,H,N).sheen.XM=e},sheenRoughnessTexture:{extensions:{KHR_texture_transform:i("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(e,E,H)=>C(e,E,H).metallicF0Factor,getTarget:C,set:(e,E,H,N)=>C(E,H,N).metallicF0Factor=e,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"XE",get:(e,E,H)=>C(e,E,H).metallicReflectanceColor,getTarget:C,set:(e,E,H,N)=>C(E,H,N).metallicReflectanceColor.P(e),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:i("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:i("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(e,E,H)=>C(e,E,H).subSurface.refractionIntensity,getTarget:C,set:(e,E,H,N)=>C(E,H,N).subSurface.refractionIntensity=e,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:i("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(e,E,H)=>C(e,E,H).subSurface.translucencyIntensity,getTarget:C,set:(e,E,H,N)=>C(E,H,N).subSurface.translucencyIntensity=e},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:i("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"XE",get:(e,E,H)=>C(e,E,H).subSurface.translucencyColor,getTarget:C,set:(e,E,H,N)=>{var u;return e&&(null===(u=C(E,H,N).subSurface.translucencyColor)||void 0===u?void 0:u.P(e))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:i("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"XE",get:(e,E,H)=>C(e,E,H).subSurface.tintColor,getTarget:C,set:(e,E,H,N)=>C(E,H,N).subSurface.tintColor.P(e)},attenuationDistance:{type:"number",get:(e,E,H)=>C(e,E,H).subSurface.tintColorAtDistance,getTarget:C,set:(e,E,H,N)=>C(E,H,N).subSurface.tintColorAtDistance=e},thicknessFactor:{type:"number",get:(e,E,H)=>C(e,E,H).subSurface.maximumThickness,getTarget:C,set:(e,E,H,N)=>C(E,H,N).subSurface.maximumThickness=e},thicknessTexture:{extensions:{KHR_texture_transform:i("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonLight)),getPropertyName:[e=>"length"]},__array__:{__target__:!0,color:{type:"XE",get:e=>{var E;return null===(E=e._babylonLight)||void 0===E?void 0:E.aM},set:(e,E)=>{var H;return null===(H=E._babylonLight)||void 0===H?void 0:H.aM.P(e)},getTarget:e=>e._babylonLight,getPropertyName:[e=>"diffuse"]},XM:{type:"number",get:e=>{var E;return null===(E=e._babylonLight)||void 0===E?void 0:E.XM},set:(e,E)=>E._babylonLight?E._babylonLight.XM=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"intensity"]},range:{type:"number",get:e=>{var E;return null===(E=e._babylonLight)||void 0===E?void 0:E.range},set:(e,E)=>E._babylonLight?E._babylonLight.range=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"range"]},spot:{innerConeAngle:{type:"number",get:e=>{var E;return null===(E=e._babylonLight)||void 0===E?void 0:E.innerAngle},set:(e,E)=>E._babylonLight?E._babylonLight.innerAngle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"innerConeAngle"]},outerConeAngle:{type:"number",get:e=>{var E;return null===(E=e._babylonLight)||void 0===E?void 0:E.angle},set:(e,E)=>E._babylonLight?E._babylonLight.angle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonLight)),getPropertyName:[e=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonTexture)),getPropertyName:[e=>"length"]},__array__:{__target__:!0,XM:{type:"number",get:e=>{var E;return null===(E=e._babylonTexture)||void 0===E?void 0:E.level},set:(e,E)=>{E._babylonTexture&&(E._babylonTexture.level=e)},getTarget:e=>e._babylonTexture},rotation:{type:"Quaternion",get:e=>{var E;return e._babylonTexture&&N.Quaternion.FromRotationMatrix(null===(E=e._babylonTexture)||void 0===E?void 0:E.getReflectionTextureMatrix())},set:(e,E)=>{var H;E._babylonTexture&&(null!==(H=E._babylonTexture.fe())&&void 0!==H&&H.useRightHandedSystem||(e=N.Quaternion.Inverse(e)),N.Matrix.FromQuaternionToRef(e,E._babylonTexture.getReflectionTextureMatrix()))},getTarget:e=>e._babylonTexture}}}}},animations:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>{var E;return null===(E=e.primitives[0]._instanceData)||void 0===E?void 0:E.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function U(e){return new D(e,V)}function j(e){const E=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let H=V;for(const N of E)N&&(H=H[N]);if(H&&H.type&&H.get)return H}function F(e,E){const H=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let N=V;for(const u of H)u&&(N=N[u]);N&&N.type&&N.get&&(N.interpolation=E)}function h(e,E){const H=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let N=V;for(const u of H)if(u){if(!N[u]){if("?"===u){N.__ignoreObjectTree__=!0;continue}N[u]={},"__array__"===u&&(N[u].__target__=!0)}N=N[u]}Object.assign(N,E)}},13359:(e,E,H)=>{"use strict";H.r(E),H.d(E,{AnimationPropertyInfo:()=>A,TransformNodeAnimationPropertyInfo:()=>C,WeightAnimationPropertyInfo:()=>i,getQuaternion:()=>M,getVector3:()=>P,getWeights:()=>D});var N=H(12235),u=H(11738),z=H(13349);function P(e,E,H,N){return u.jE.aE(E,H).scaleInPlace(N)}function M(e,E,H,N){return u.Quaternion.aE(E,H).scaleInPlace(N)}function D(e,E,H,N){const u=new Array(e._numMorphTargets);for(let z=0;z<u.length;z++)u[z]=E[H++]*N;return u}class A{constructor(e,E,H,N){this.type=e,this.name=E,this.getValue=H,this.getStride=N}_buildAnimation(e,E,H){const u=new N.b(e,this.name,E,this.type);return u.setKeys(H),u}}class C extends A{buildAnimations(e,E,H,N){const u=[];return u.push({babylonAnimatable:e._babylonTransformNode,babylonAnimation:this._buildAnimation(E,H,N)}),u}}class i extends A{buildAnimations(e,E,H,u){const z=[];if(e._numMorphTargets)for(let P=0;P<e._numMorphTargets;P++){const M=new N.b(`${E}_${P}`,this.name,H,this.type);if(M.setKeys(u.map((e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[P]:void 0,value:e.value[P],outTangent:e.outTangent?e.outTangent[P]:void 0,interpolation:e.interpolation})))),e._primitiveBabylonMeshes)for(const E of e._primitiveBabylonMeshes)if(E.morphTargetManager){const e=E.morphTargetManager.getTarget(P),H=M.clone();e.animations.push(H),z.push({babylonAnimatable:e,babylonAnimation:H})}}return z}}(0,z.m)("/nodes/{}/translation",[new C(N.b.ANIMATIONTYPE_VECTOR3,"position",P,(()=>3))]),(0,z.m)("/nodes/{}/rotation",[new C(N.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",M,(()=>4))]),(0,z.m)("/nodes/{}/scale",[new C(N.b.ANIMATIONTYPE_VECTOR3,"UM",P,(()=>3))]),(0,z.m)("/nodes/{}/weights",[new i(N.b.ANIMATIONTYPE_FLOAT,"influence",D,(e=>e._numMorphTargets))])},13320:(e,E,H)=>{"use strict";class N{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((e,E)=>{this._resolve=e,this._reject=E}))}}var u=H(11738),z=H(11789),P=H(11532),M=H(12168),D=H(13324),A=H(13334),C=H(11541),i=H(12192),V=H(12235),U=H(12242),j=H(11579),F=H(11548),h=H(11552);class S{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(e,E,H){this.name=e,this.id=E,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=u.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new C.d,this.bones=[],this._scene=H||j.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const N=this._scene.getEngine().getCaps();this._canUseTextureForBones=N.textureFloat&&N.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((e=>!e.getParent()))}getTransformMatrices(e){if(this.needInitialSkinMatrix){if(!e)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return e._bonesTransformMatrices||this.prepare(!0),e._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(e){return this.needInitialSkinMatrix&&e._transformMatrixTexture?e._transformMatrixTexture:this._transformMatrixTexture}fe(){return this._scene}toString(e){let E=`Name: ${this.name}, nBones: ${this.bones.length}`;if(E+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,e){E+=", Ranges: {";let e=!0;for(const H in this._ranges)e&&(E+=", ",e=!1),E+=H;E+="}"}return E}getBoneIndexByName(e){for(let E=0,H=this.bones.length;E<H;E++)if(this.bones[E].name===e)return E;return-1}createAnimationRange(e,E,H){if(!this._ranges[e]){this._ranges[e]=new U.d(e,E,H);for(let N=0,u=this.bones.length;N<u;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].createRange(e,E,H)}}deleteAnimationRange(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let H=0,N=this.bones.length;H<N;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].deleteRange(e,E);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}getAnimationRanges(){const e=[];let E;for(E in this._ranges)e.push(this._ranges[E]);return e}copyAnimationRange(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[E]||!e.getAnimationRange(E))return!1;let N=!0;const u=this._getHighestAnimationFrame()+1,z={},P=e.bones;let M,D;for(D=0,M=P.length;D<M;D++)z[P[D].name]=P[D];this.bones.length!==P.length&&(F.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${P.length}`),N=!1);const A=H&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(D=0,M=this.bones.length;D<M;D++){const e=this.bones[D].name,P=z[e];P?N=N&&this.bones[D].copyAnimationRange(P,E,u,H,A):(F.d.Warn("copyAnimationRange: not same rig, missing source bone "+e),N=!1)}const C=e.getAnimationRange(E);return C&&(this._ranges[E]=new U.d(E,C.from+u,C.to+u)),N}returnToRest(){for(const e of this.bones)-1!==e._index&&e.returnToRest()}_getHighestAnimationFrame(){let e=0;for(let E=0,H=this.bones.length;E<H;E++)if(this.bones[E].animations[0]){const H=this.bones[E].animations[0].getHighestFrame();e<H&&(e=H)}return e}beginAnimation(e,E,H,N){const u=this.getAnimationRange(e);return u?this._scene.beginAnimation(this,u.from,u.to,E,H,N):null}static MakeAnimationAdditive(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const N=e.getAnimationRange(H);if(!N)return null;const u=e._scene.getAllAnimatablesByTarget(e);let z=null;for(let M=0;M<u.length;M++){const e=u[M];if(e.fromFrame===(null===N||void 0===N?void 0:N.from)&&e.toFrame===(null===N||void 0===N?void 0:N.to)){z=e;break}}const P=e.getAnimatables();for(let M=0;M<P.length;M++){const e=P[M].animations;if(e)for(let N=0;N<e.length;N++)V.b.MakeAnimationAdditive(e[N],E,H)}return z&&(z.isAdditive=!0),e}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(e){this._meshesWithPoseMatrix.push(e)}_unregisterMeshWithPoseMatrix(e){const E=this._meshesWithPoseMatrix.indexOf(e);E>-1&&this._meshesWithPoseMatrix.splice(E,1)}_computeTransformMatrices(e,E){this.onBeforeComputeObservable.notifyObservers(this);for(let H=0;H<this.bones.length;H++){const N=this.bones[H];N._childUpdateId++;const u=N.getParent();if(u?N.getLocalMatrix().multiplyToRef(u.getFinalMatrix(),N.getFinalMatrix()):E?N.getLocalMatrix().multiplyToRef(E,N.getFinalMatrix()):N.getFinalMatrix().P(N.getLocalMatrix()),-1!==N._index){const E=null===N._index?H:N._index;N.getAbsoluteInverseBindMatrix().multiplyToArray(N.getFinalMatrix(),e,16*E)}}this._identity.copyToArray(e,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const e=this.fe().getRenderId();if(this._currentRenderId===e)return;this._currentRenderId=e}if(this._numBonesWithLinkedTransformNode>0)for(const e of this.bones)if(e._linkedTransformNode){const E=e._linkedTransformNode;e.position=E.position,E.rotationQuaternion?e.rotationQuaternion=E.rotationQuaternion:e.rotation=E.rotation,e.UM=E.UM}if(this.needInitialSkinMatrix)for(const e of this._meshesWithPoseMatrix){const E=e.getPoseMatrix();let H=this._isDirty;if(e._bonesTransformMatrices&&e._bonesTransformMatrices.length===16*(this.bones.length+1)||(e._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),H=!0),H){if(this._synchronizedWithMesh!==e){this._synchronizedWithMesh=e;for(const e of this.bones)if(!e.getParent()){e.getBindMatrix().multiplyToRef(E,u.TmpVectors.Matrix[1]),e._updateAbsoluteBindMatrices(u.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const E=4*(this.bones.length+1);e._transformMatrixTexture&&e._transformMatrixTexture.getSize().width===E||(e._transformMatrixTexture&&e._transformMatrixTexture.dispose(),e._transformMatrixTexture=i.e.CreateRGBATexture(e._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(e._bonesTransformMatrices,E),this.isUsingTextureForMatrices&&e._transformMatrixTexture&&e._transformMatrixTexture.update(e._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=i.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables}clone(e,E){const H=new S(e,E||e,this._scene);H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let N=0;N<this.bones.length;N++){const e=this.bones[N];let E=null;const u=e.getParent();if(u){const e=this.bones.indexOf(u);E=H.bones[e]}const z=new A.b(e.name,H,E,e.getBindMatrix().clone(),e.getRestMatrix().clone());z._index=e._index,e._linkedTransformNode&&z.linkTransformNode(e._linkedTransformNode),h.e.DeepCopy(e.animations,z.animations)}if(this._ranges){H._ranges={};for(const e in this._ranges){const E=this._ranges[e];E&&(H._ranges[e]=E.clone())}}return this._isDirty=!0,H.prepare(!0),H}enableBlending(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const E of this.bones)for(const H of E.animations)H.enableBlending=!0,H.blendingSpeed=e}dispose(){if(this._meshesWithPoseMatrix.length=0,this.fe().stopAnimation(this),this.fe().removeSkeleton(this),this._parentContainer){const e=this._parentContainer.skeletons.indexOf(this);e>-1&&this._parentContainer.skeletons.splice(e,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.uM()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){var E;const N=this.bones[H],u=N.getParent(),z={parentBoneIndex:u?this.bones.indexOf(u):-1,index:N.getIndex(),name:N.name,id:N.id,matrix:N.getBindMatrix().uM(),rest:N.getRestMatrix().uM(),linkedTransformNodeId:null===(E=N.getTransformNode())||void 0===E?void 0:E.id};e.bones.push(z),N.length&&(z.length=N.length),N.metadata&&(z.metadata=N.metadata),N.animations&&N.animations.length>0&&(z.animation=N.animations[0].serialize()),e.ranges=[];for(const E in this._ranges){const H=this._ranges[E];if(!H)continue;const N={};N.name=E,N.from=H.from,N.to=H.to,e.ranges.push(N)}}return e}static Parse(e,E){const H=new S(e.name,e.id,E);let N;for(e.dimensionsAtRest&&(H.dimensionsAtRest=u.jE.aE(e.dimensionsAtRest)),H.needInitialSkinMatrix=e.needInitialSkinMatrix,N=0;N<e.bones.length;N++){const E=e.bones[N],z=e.bones[N].index;let P=null;E.parentBoneIndex>-1&&(P=H.bones[E.parentBoneIndex]);const M=E.rest?u.Matrix.aE(E.rest):null,D=new A.b(E.name,H,P,u.Matrix.aE(E.matrix),M,null,z);void 0!==E.id&&null!==E.id&&(D.id=E.id),E.length&&(D.length=E.length),E.metadata&&(D.metadata=E.metadata),E.animation&&D.animations.push(V.b.Parse(E.animation)),void 0!==E.linkedTransformNodeId&&null!==E.linkedTransformNodeId&&(H._hasWaitingData=!0,D._waitingTransformNodeId=E.linkedTransformNodeId)}if(e.ranges)for(N=0;N<e.ranges.length;N++){const E=e.ranges[N];H.createAnimationRange(E.name,E.from,E.to)}return H}computeAbsoluteMatrices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||e)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(e)}getPoseMatrix(){let e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e}sortBones(){const e=[],E=new Array(this.bones.length);for(let H=0;H<this.bones.length;H++)this._sortBones(H,e,E);this.bones=e}_sortBones(e,E,H){if(H[e])return;H[e]=!0;const N=this.bones[e];if(!N)return;void 0===N._index&&(N._index=e);const u=N.getParent();u&&this._sortBones(this.bones.indexOf(u),E,H),E.push(N)}setCurrentPoseAsRest(){for(const e of this.bones)e.setCurrentPoseAsRest()}}var X=H(12047),a=H(12207),W=H(11712),r=H(12133),Y=H(11818),f=H(12176),w=H(12140),s=H(12165),p=H(12250),o=H(11831),y=H(13285);class b{set areUpdatesFrozen(e){e?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new o.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,e||(e=j.d.LastCreatedScene),this._scene=e,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const e=this._scene.getEngine().getCaps();this._canUseTextureForTargets=e.canUseGLVertexID&&e.textureFloat&&e.maxVertexTextureImageUnits>0&&e.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return b.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?b.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(e){this._numMaxInfluencers!==e&&(this._numMaxInfluencers=e,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(e){this._useTextureToStoreTargets!==e&&(this._useTextureToStoreTargets=e,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var e;return b.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(e=this._scene)&&void 0!==e&&e.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(e){return this._activeTargets.data[e]}getTarget(e){return this._targets[e]}getTargetByName(e){for(const E of this._targets)if(E.name===e)return E;return null}addTarget(e){this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((e=>{this.areUpdatesFrozen&&e&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(e){const E=this._targets.indexOf(e);E>=0&&(this._targets.splice(E,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(E,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(E,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(e)}_bind(e){e.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),e.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),e.setTexture("morphTargets",this._targetStoreTexture),e.setInt("morphTargetCount",this.numInfluencers)}clone(){const e=new b(this._scene);for(const E of this._targets)e.addTarget(E.clone());return e.enablePositionMorphing=this.enablePositionMorphing,e.enableNormalMorphing=this.enableNormalMorphing,e.enableTangentMorphing=this.enableTangentMorphing,e.enableUVMorphing=this.enableUVMorphing,e.enableUV2Morphing=this.enableUV2Morphing,e.enableColorMorphing=this.enableColorMorphing,e}serialize(){const e={};e.id=this.uniqueId,e.targets=[];for(const E of this._targets)e.targets.push(E.serialize());return e}_syncActiveTargets(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const E=!!this._targetStoreTexture,H=this.isUsingTextureForTargets;(this._mustSynchronize||E!==H)&&(this._mustSynchronize=!1,this.synchronize());let N=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let u=-1;for(const z of this._targets)if(u++,0!==z.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=b.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(z),this._morphTargetTextureIndices[N]=u,this._tempInfluences[N++]=z.influence}this._morphTargetTextureIndices.length!==N&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,N)),this._influences&&this._influences.length===N||(this._influences=new Float32Array(N));for(let z=0;z<N;z++)this._influences[z]=this._tempInfluences[z];if(e&&this._scene)for(const z of this._scene.meshes)z.morphTargetManager===this&&(H?z._markSubMeshesAsAttributesDirty():z._syncGeometryWithMorphTargetManager())}synchronize(){var e;if(!this._scene||this.areUpdatesFrozen)return;const E=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(e=this._targetStoreTexture)||void 0===e||e.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>E.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const H of this._targets){this._supportsPositions=this._supportsPositions&&H.hasPositions,this._supportsNormals=this._supportsNormals&&H.hasNormals,this._supportsTangents=this._supportsTangents&&H.hasTangents,this._supportsUVs=this._supportsUVs&&H.hasUVs,this._supportsUV2s=this._supportsUV2s&&H.hasUV2s,this._supportsColors=this._supportsColors&&H.hasColors;const e=H.vertexCount;if(0===this._vertexCount)this._vertexCount=e;else if(this._vertexCount!==e)return void F.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${H.name}": ${e}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const e=E.getCaps().maxTextureSize;this._textureWidth>e&&(this._textureHeight=Math.ceil(this._textureWidth/e),this._textureWidth=e);const H=this._targets.length,N=new Float32Array(H*this._textureWidth*this._textureHeight*4);let u=0;for(let E=0;E<H;E++){const e=this._targets[E],H=e.getPositions(),z=e.getNormals(),P=e.getUVs(),M=e.getTangents(),D=e.getUV2s(),A=e.getColors();u=E*this._textureWidth*this._textureHeight*4;for(let E=0;E<this._vertexCount;E++)this._supportsPositions&&H&&(N[u]=H[3*E],N[u+1]=H[3*E+1],N[u+2]=H[3*E+2],u+=4),this._supportsNormals&&z&&(N[u]=z[3*E],N[u+1]=z[3*E+1],N[u+2]=z[3*E+2],u+=4),this._supportsUVs&&P&&(N[u]=P[2*E],N[u+1]=P[2*E+1],u+=4),this._supportsTangents&&M&&(N[u]=M[3*E],N[u+1]=M[3*E+1],N[u+2]=M[3*E+2],u+=4),this._supportsUV2s&&D&&(N[u]=D[2*E],N[u+1]=D[2*E+1],u+=4),this._supportsColors&&A&&(N[u]=A[4*E],N[u+1]=A[4*E+1],N[u+2]=A[4*E+2],N[u+3]=A[4*E+3],u+=4)}this._targetStoreTexture=y.d.CreateRGBATexture(N,this._textureWidth,this._textureHeight,H,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const H of this._scene.meshes)H.morphTargetManager===this&&H._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const e=this._parentContainer.morphTargetManagers.indexOf(this);e>-1&&this._parentContainer.morphTargetManagers.splice(e,1),this._parentContainer=null}for(const e of this._targets)this._scene.stopAnimation(e)}}static Parse(e,E){const H=new b(E);for(const N of e.targets)H.addTarget(p.d.Parse(N,E));return H}}b.EnableTextureStorage=!0,b.MaxActiveMorphTargetsInVertexAttributeMode=8,b.ConstantTargetCountForTextureMode=0;var K=H(13340),l=H(11587),O=H(12057);const v=new Map,R=v;function T(e,E,H){L(e)&&F.d.Warn(`Extension with the name '${e}' already exists`),v.set(e,{isGLTFExtension:E,factory:H})}function L(e){return v.delete(e)}var d=H(13349),G=H(12322),me=H(11824);class Q{static Get(e,E,H){if(!E||void 0==H||!E[H])throw new Error(`${e}: Failed to find index (${H})`);return E[H]}static TryGet(e,E){return e&&void 0!=E&&e[E]?e[E]:null}static Assign(e){if(e)for(let E=0;E<e.length;E++)e[E].index=E}}function Z(e){if(e.min&&e.max){const E=e.min,H=e.max,N=u.TmpVectors.jE[0].VM(E[0],E[1],E[2]),z=u.TmpVectors.jE[1].VM(H[0],H[1],H[2]);if(e.normalized&&5126!==e.componentType){let E=1;switch(e.componentType){case 5120:E=127;break;case 5121:E=255;break;case 5122:E=32767;break;case 5123:E=65535}const H=1/E;N.scaleInPlace(H),z.scaleInPlace(H)}return new O.b(N,z)}return null}class k{static RegisterExtension(e,E){T(e,!1,E)}static UnregisterExtension(e){return L(e)}get eM(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((e=>e.dispose&&e.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(e,E,H,N,u,z){let P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=E,this._assetContainer=H,this._loadData(N);let z=null;if(e){const E={};if(this._gltf.nodes)for(const e of this._gltf.nodes)e.name&&(E[e.name]=e.index);z=(e instanceof Array?e:[e]).map((e=>{const H=E[e];if(void 0===H)throw new Error(`Failed to find node '${e}'`);return H}))}return await this._loadAsync(u,P,z,(()=>({meshes:this._getMeshes(),Ii:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=e,this._loadData(E),await this._loadAsync(H,u,null,(()=>{}))}async _loadAsync(e,E,H,N){return await Promise.resolve().then((async()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&E?e:`${e}${Date.now()}/`,this._fileName=E,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const u=`${K.j[K.j.LOADING]} => ${K.j[K.j.READY]}`,z=`${K.j[K.j.LOADING]} => ${K.j[K.j.COMPLETE]}`;this._parent._startPerformanceCounter(u),this._parent._startPerformanceCounter(z),this._parent._setState(K.j.LOADING),this._extensionsOnLoading();const M=new Array;if(!this.parent.loadOnlyMaterials)if(H)M.push(this.loadSceneAsync("/nodes",{nodes:H,index:-1}));else if(void 0!=this._gltf.hE||this._gltf.scenes&&this._gltf.scenes[0]){const e=Q.Get("/scene",this._gltf.scenes,this._gltf.hE||0);M.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){const E=this._gltf.materials[e],H="/materials/"+e,N=X.e.TriangleFillMode;M.push(this._loadMaterialAsync(H,E,null,N,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&M.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&M.push(this._compileShadowGeneratorsAsync());const D=Promise.all(M).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.LM(!0);for(const e of this._babylonScene.materials){const E=e;void 0!==E.maxSimultaneousLights&&(E.maxSimultaneousLights=Math.max(E.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(K.j.READY),this._skipStartAnimationStep||this._startAnimations(),N()}));return await D.then((e=>(this._parent._endPerformanceCounter(u),P.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(z),this._parent._setState(K.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()}))})),e)))})).catch((e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e}))}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const E=this._gltf.buffers;if(E&&E[0]&&!E[0].uri){const H=E[0];(H.byteLength<e.bin.byteLength-3||H.byteLength>e.bin.byteLength)&&F.d.Warn(`Binary buffer length (${H.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else F.d.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const H of this._gltf.nodes)if(H.children)for(const E of H.children)e[E]=H.index;const E=this._createRootNode();for(const H of this._gltf.nodes){const N=e[H.index];H.parent=void 0===N?E:this._gltf.nodes[N]}}}async _loadExtensionsAsync(){const e=[];if(R.forEach(((E,H)=>{var N;!1===(null===(N=this.parent.extensionOptions[H])||void 0===N?void 0:N.enabled)?E.isGLTFExtension&&this.isExtensionUsed(H)&&F.d.Warn(`Extension ${H} is used but has been explicitly disabled.`):E.isGLTFExtension&&!this.isExtensionUsed(H)||e.push((async()=>{const e=await E.factory(this);return e.name!==H&&F.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${e.name} !== ${H}`),this._parent.onExtensionLoadedObservable.notifyObservers(e),e})())})),this._extensions.push(...await Promise.all(e)),this._extensions.sort(((e,E)=>(e.order||Number.MAX_VALUE)-(E.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const H of this._gltf.extensionsRequired){if(!this._extensions.some((e=>e.name===H&&e.enabled))){var E;if(!1===(null===(E=this.parent.extensionOptions[H])||void 0===E?void 0:E.enabled))throw new Error(`Required extension ${H} is disabled`);throw new Error(`Required extension ${H} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new s.c("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.LM(!1);const E={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case K.i.AUTO:this._babylonScene.useRightHandedSystem||(E.rotation=[0,1,0,0],E.scale=[1,1,-1],k._LoadTransform(E,this._rootBabylonMesh));break;case K.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(e),E}loadSceneAsync(e,E){const H=this._extensionsLoadSceneAsync(e,E);if(H)return H;const N=new Array;if(this.logOpen(`${e} ${E.name||""}`),E.nodes)for(const u of E.nodes){const E=Q.Get(`${e}/nodes/${u}`,this._gltf.nodes,u);N.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(e=>{e.parent=this._rootBabylonMesh})))}for(const u of this._postSceneLoadActions)u();return N.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(N).then((()=>{}))}_forEachPrimitive(e,E){if(e._primitiveBabylonMeshes)for(const H of e._primitiveBabylonMeshes)E(H)}_getGeometries(){const e=[],E=this._gltf.nodes;if(E)for(const H of E)this._forEachPrimitive(H,(E=>{const H=E.AM;H&&-1===e.indexOf(H)&&e.push(H)}));return e}_getMeshes(){const e=[];this._rootBabylonMesh instanceof w.d&&e.push(this._rootBabylonMesh);const E=this._gltf.nodes;if(E)for(const H of E)this._forEachPrimitive(H,(E=>{e.push(E)}));return e}_getTransformNodes(){const e=[],E=this._gltf.nodes;if(E)for(const H of E)H._babylonTransformNode&&"ji"===H._babylonTransformNode.getClassName()&&e.push(H._babylonTransformNode),H._babylonTransformNodeForSkin&&e.push(H._babylonTransformNodeForSkin);return e}_getSkeletons(){const e=[],E=this._gltf.skins;if(E)for(const H of E)H._data&&e.push(H._data.babylonSkeleton);return e}_getAnimationGroups(){const e=[],E=this._gltf.animations;if(E)for(const H of E)H._babylonAnimationGroup&&e.push(H._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case K.g.NONE:break;case K.g.FIRST:{const e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case K.g.ALL:{const e=this._getAnimationGroups();for(const E of e)E.start(!0);break}default:return void F.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadNodeAsync(e,E,H);if(N)return N;if(E._babylonTransformNode)throw new Error(`${e}: Invalid recursive node hierarchy`);const u=new Array;this.logOpen(`${e} ${E.name||""}`);const z=N=>{if(k.AddPointerMetadata(N,e),k._LoadTransform(E,N),void 0!=E.camera){const H=Q.Get(`${e}/camera`,this._gltf.cameras,E.camera);u.push(this.loadCameraAsync(`/cameras/${H.index}`,H,(e=>{e.parent=N,this._babylonScene.useRightHandedSystem||(N.UM.x=-1)})))}if(E.children)for(const H of E.children){const E=Q.Get(`${e}/children/${H}`,this._gltf.nodes,H);u.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(e=>{e.parent=N})))}H(N)},P=void 0!=E.mesh,M=this._parent.loadSkins&&void 0!=E.skin;if(!P||M){const e=E.name||`node${E.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new r.d(e,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==E.mesh?E._babylonTransformNode=H:E._babylonTransformNodeForSkin=H,z(H)}if(P)if(M){const H=Q.Get(`${e}/mesh`,this._gltf.meshes,E.mesh);u.push(this._loadMeshAsync(`/meshes/${H.index}`,E,H,(H=>{const N=E._babylonTransformNodeForSkin;H.metadata=(0,G.d)(N.metadata,H.metadata||{});const z=Q.Get(`${e}/skin`,this._gltf.skins,E.skin);u.push(this._loadSkinAsync(`/skins/${z.index}`,E,z,(e=>{this._forEachPrimitive(E,(E=>{E.skeleton=e})),this._postSceneLoadActions.push((()=>{if(void 0!=z.skeleton){const e=Q.Get(`/skins/${z.index}/skeleton`,this._gltf.nodes,z.skeleton).parent;E.index===e.index?H.parent=N.parent:H.parent=e._babylonTransformNode}else H.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:N,skinnedNode:H})}))})))})))}else{const H=Q.Get(`${e}/mesh`,this._gltf.meshes,E.mesh);u.push(this._loadMeshAsync(`/meshes/${H.index}`,E,H,z))}return this.logClose(),Promise.all(u).then((()=>(this._forEachPrimitive(E,(e=>{const E=e;!E.isAnInstance&&E.AM&&E.AM.useBoundingInfoFromGeometry?e.Oe():e.refreshBoundingInfo(!0,!0)})),E._babylonTransformNode)))}_loadMeshAsync(e,E,H,N){const u=H.primitives;if(!u||!u.length)throw new Error(`${e}: Primitives are missing`);void 0==u[0].index&&Q.Assign(u);const z=new Array;this.logOpen(`${e} ${H.name||""}`);const P=E.name||`node${E.index}`;if(1===u.length){const N=H.primitives[0];z.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${N.index}`,P,E,H,N,(e=>{E._babylonTransformNode=e,E._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,E._babylonTransformNode=new r.d(P,this._babylonScene),E._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._primitiveBabylonMeshes=[];for(const N of u)z.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${N.index}`,`${P}_primitive${N.index}`,E,H,N,(e=>{e.parent=E._babylonTransformNode,E._primitiveBabylonMeshes.push(e)})))}return N(E._babylonTransformNode),this.logClose(),Promise.all(z).then((()=>E._babylonTransformNode))}_loadMeshPrimitiveAsync(e,E,H,N,u,z){const P=this._extensionsLoadMeshPrimitiveAsync(e,E,H,N,u,z);if(P)return P;this.logOpen(`${e}`);const M=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==H.skin&&!N.primitives[0].targets;let D,A;if(M&&u._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,D=u._instanceData.babylonSourceMesh.createInstance(E),D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A=u._instanceData.promise;else{const z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new s.c(E,this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.sideOrientation=this._babylonScene.useRightHandedSystem?X.e.CounterClockWiseSideOrientation:X.e.ClockWiseSideOrientation,this._createMorphTargets(e,H,N,u,P),z.push(this._loadVertexDataAsync(e,u,P).then((async E=>await this._loadMorphTargetsAsync(e,u,P,E).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,E.Ke(P),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const C=k._GetDrawMode(e,u.mode);if(void 0==u.material){let e=this._defaultBabylonMaterialData[C];e||(e=this._createDefaultMaterial("__GLTFLoader._default",C),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[C]=e),P.material=e}else if(!this.parent.skipMaterials){const E=Q.Get(`${e}/material`,this._gltf.materials,u.material);z.push(this._loadMaterialAsync(`/materials/${E.index}`,E,P,C,(e=>{P.material=e})))}A=Promise.all(z),M&&(u._instanceData={babylonSourceMesh:P,promise:A}),D=P}return k.AddPointerMetadata(D,e),this._parent.onMeshLoadedObservable.notifyObservers(D),z(D),this.logClose(),A.then((()=>D))}_loadVertexDataAsync(e,E,H){const N=this._extensionsLoadVertexDataAsync(e,E,H);if(N)return N;const u=E.attributes;if(!u)throw new Error(`${e}: Attributes are missing`);const z=new Array,P=new f.e(H.name,this._babylonScene);if(void 0==E.indices)H.isUnIndexed=!0;else{const H=Q.Get(`${e}/indices`,this._gltf.accessors,E.indices);z.push(this._loadIndicesAccessorAsync(`/accessors/${H.index}`,H).then((e=>{P.setIndices(e)})))}const M=(E,N,M)=>{if(void 0==u[E])return;H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(N)&&H._delayInfo.push(N);const D=Q.Get(`${e}/attributes/${E}`,this._gltf.accessors,u[E]);z.push(this._loadVertexAccessorAsync(`/accessors/${D.index}`,D,N).then((e=>{if(e.getKind()===Y.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!H.skeleton){const e=Z(D);e&&(P._boundingInfo=e,P.useBoundingInfoFromGeometry=!0)}P.setVerticesBuffer(e,D.count)}))),N==Y.g.MatricesIndicesExtraKind&&(H.numBoneInfluencers=8),M&&M(D)};return M("POSITION",Y.g.PositionKind),M("NORMAL",Y.g.NormalKind),M("TANGENT",Y.g.TangentKind),M("TEXCOORD_0",Y.g.UVKind),M("TEXCOORD_1",Y.g.UV2Kind),M("TEXCOORD_2",Y.g.UV3Kind),M("TEXCOORD_3",Y.g.UV4Kind),M("TEXCOORD_4",Y.g.UV5Kind),M("TEXCOORD_5",Y.g.UV6Kind),M("JOINTS_0",Y.g.MatricesIndicesKind),M("WEIGHTS_0",Y.g.MatricesWeightsKind),M("JOINTS_1",Y.g.MatricesIndicesExtraKind),M("WEIGHTS_1",Y.g.MatricesWeightsExtraKind),M("COLOR_0",Y.g.ColorKind,(e=>{"VEC4"===e.type&&(H.hasVertexAlpha=!0)})),Promise.all(z).then((()=>P))}_createMorphTargets(e,E,H,N,u){if(!N.targets||!this._parent.loadMorphTargets)return;if(void 0==E._numMorphTargets)E._numMorphTargets=N.targets.length;else if(N.targets.length!==E._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const z=H.extras?H.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,u.morphTargetManager=new b(this._babylonScene),u.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.morphTargetManager.areUpdatesFrozen=!0;for(let P=0;P<N.targets.length;P++){const e=E.weights?E.weights[P]:H.weights?H.weights[P]:0,N=z?z[P]:`morphTarget${P}`;u.morphTargetManager.addTarget(new p.d(N,e,u.fe()))}}_loadMorphTargetsAsync(e,E,H,N){if(!E.targets||!this._parent.loadMorphTargets)return Promise.resolve();const u=new Array,z=H.morphTargetManager;for(let P=0;P<z.numTargets;P++){const H=z.getTarget(P);u.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${P}`,N,E.targets[P],H))}return Promise.all(u).then((()=>{z.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(e,E,H,N){const u=new Array,z=(N,z,P)=>{if(void 0==H[N])return;const M=E.getVertexBuffer(z);if(!M)return;const D=Q.Get(`${e}/${N}`,this._gltf.accessors,H[N]);u.push(this._loadFloatAccessorAsync(`/accessors/${D.index}`,D).then((e=>{P(M,e)})))};return z("POSITION",Y.g.PositionKind,((e,E)=>{const H=new Float32Array(E.length);e.forEach(E.length,((e,N)=>{H[N]=E[N]+e})),N.setPositions(H)})),z("NORMAL",Y.g.NormalKind,((e,E)=>{const H=new Float32Array(E.length);e.forEach(H.length,((e,N)=>{H[N]=E[N]+e})),N.setNormals(H)})),z("TANGENT",Y.g.TangentKind,((e,E)=>{const H=new Float32Array(E.length/3*4);let u=0;e.forEach(E.length/3*4,((e,N)=>{(N+1)%4!==0&&(H[u]=E[u]+e,u++)})),N.setTangents(H)})),z("TEXCOORD_0",Y.g.UVKind,((e,E)=>{const H=new Float32Array(E.length);e.forEach(E.length,((e,N)=>{H[N]=E[N]+e})),N.setUVs(H)})),z("TEXCOORD_1",Y.g.UV2Kind,((e,E)=>{const H=new Float32Array(E.length);e.forEach(E.length,((e,N)=>{H[N]=E[N]+e})),N.setUV2s(H)})),z("COLOR_0",Y.g.ColorKind,((E,H)=>{let u=null;const z=E.getSize();if(3===z){u=new Float32Array(H.length/3*4),E.forEach(H.length,((e,E)=>{const N=Math.floor(E/3),z=E%3;u[4*N+z]=H[3*N+z]+e}));for(let e=0;e<H.length/3;++e)u[4*e+3]=1}else{if(4!==z)throw new Error(`${e}: Invalid number of components (${z}) for COLOR_0 attribute`);u=new Float32Array(H.length),E.forEach(H.length,((e,E)=>{u[E]=H[E]+e}))}N.setColors(u)})),await Promise.all(u).then((()=>{}))}static _LoadTransform(e,E){if(void 0!=e.skin)return;let H=u.jE.Zero(),N=u.Quaternion.Identity(),z=u.jE.One();if(e.matrix){u.Matrix.aE(e.matrix).decompose(z,N,H)}else e.translation&&(H=u.jE.aE(e.translation)),e.rotation&&(N=u.Quaternion.aE(e.rotation)),e.scale&&(z=u.jE.aE(e.scale));E.position=H,E.rotationQuaternion=N,E.UM=z}_loadSkinAsync(e,E,H,N){if(!this._parent.loadSkins)return Promise.resolve();const u=this._extensionsLoadSkinAsync(e,E,H);if(u)return u;if(H._data)return N(H._data.babylonSkeleton),H._data.promise;const z=`skeleton${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new S(H.name||z,z,this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,H,P);const M=this._loadSkinInverseBindMatricesDataAsync(e,H).then((e=>{this._updateBoneMatrices(P,e)}));return H._data={babylonSkeleton:P,promise:M},N(P),M}_loadBones(e,E,H){if(void 0==E.skeleton||this._parent.alwaysComputeSkeletonRootNode){const H=this._findSkeletonRootNode(`${e}/joints`,E.joints);if(H)if(void 0===E.skeleton)E.skeleton=H.index;else{const N=(e,E)=>{for(;E.parent;E=E.parent)if(E.parent===e)return!0;return!1},u=Q.Get(`${e}/skeleton`,this._gltf.nodes,E.skeleton);u===H||N(u,H)||(F.d.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),E.skeleton=H.index)}else F.d.Warn(`${e}: Failed to find common root`)}const N={};for(const u of E.joints){const z=Q.Get(`${e}/joints/${u}`,this._gltf.nodes,u);this._loadBone(z,E,H,N)}}_findSkeletonRootNode(e,E){if(0===E.length)return null;const H={};for(const u of E){const E=[];let N=Q.Get(`${e}/${u}`,this._gltf.nodes,u);for(;-1!==N.index;)E.unshift(N),N=N.parent;H[u]=E}let N=null;for(let u=0;;++u){let e=H[E[0]];if(u>=e.length)return N;const z=e[u];for(let P=1;P<E.length;++P)if(e=H[E[P]],u>=e.length||z!==e[u])return N;N=z}}_loadBone(e,E,H,N){e._isJoint=!0;let u=N[e.index];if(u)return u;let z=null;e.index!==E.skeleton&&(e.parent&&-1!==e.parent.index?z=this._loadBone(e.parent,E,H,N):void 0!==E.skeleton&&F.d.Warn(`/skins/${E.index}/skeleton: Skeleton node is not a common root`));const P=E.joints.indexOf(e.index);return u=new A.b(e.name||`joint${e.index}`,H,z,this._getNodeMatrix(e),null,null,P),N[e.index]=u,this._postSceneLoadActions.push((()=>{u.linkTransformNode(e._babylonTransformNode)})),u}_loadSkinInverseBindMatricesDataAsync(e,E){if(void 0==E.inverseBindMatrices)return Promise.resolve(null);const H=Q.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,E.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${H.index}`,H)}_updateBoneMatrices(e,E){for(const H of e.bones){const e=u.Matrix.Identity(),N=H._index;E&&-1!==N&&(u.Matrix.FromArrayToRef(E,16*N,e),e.invertToRef(e));const z=H.getParent();z&&e.multiplyToRef(z.getAbsoluteInverseBindMatrix(),e),H.MM(e,!1,!1),H._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(e){return e.matrix?u.Matrix.aE(e.matrix):u.Matrix.Compose(e.scale?u.jE.aE(e.scale):u.jE.One(),e.rotation?u.Quaternion.aE(e.rotation):u.Quaternion.Identity(),e.translation?u.jE.aE(e.translation):u.jE.Zero())}loadCameraAsync(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadCameraAsync(e,E,H);if(N)return N;const z=new Array;this.logOpen(`${e} ${E.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new D.d(E.name||`camera${E.index}`,u.jE.Zero(),this._babylonScene,!1);switch(P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonCamera=P,P.setTarget(new u.jE(0,0,-1)),E.type){case"perspective":{const H=E.perspective;if(!H)throw new Error(`${e}: Camera perspective properties are missing`);P.fov=H.yfov,P.PM=H.znear,P.maxZ=H.zfar||0;break}case"orthographic":if(!E.orthographic)throw new Error(`${e}: Camera orthographic properties are missing`);P.mode=M.c.ORTHOGRAPHIC_CAMERA,P.orthoLeft=-E.orthographic.xmag,P.orthoRight=E.orthographic.xmag,P.orthoBottom=-E.orthographic.ymag,P.orthoTop=E.orthographic.ymag,P.PM=E.orthographic.znear,P.maxZ=E.orthographic.zfar;break;default:throw new Error(`${e}: Invalid camera type (${E.type})`)}return k.AddPointerMetadata(P,e),this._parent.onCameraLoadedObservable.notifyObservers(P),H(P),this.logClose(),Promise.all(z).then((()=>P))}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const E=new Array;for(let H=0;H<e.length;H++){const N=e[H];E.push(this.loadAnimationAsync(`/animations/${N.index}`,N).then((e=>{0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(E).then((()=>{}))}loadAnimationAsync(e,E){const N=this._extensionsLoadAnimationAsync(e,E);return N||H.e(78).then(H.bind(H,14837)).then((H=>{let{AnimationGroup:N}=H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new N(E.name||`animation${E.index}`,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonAnimationGroup=u;const z=new Array;Q.Assign(E.channels),Q.Assign(E.samplers);for(const P of E.channels)z.push(this._loadAnimationChannelAsync(`${e}/channels/${P.index}`,e,E,P,((e,E)=>{e.animations=e.animations||[],e.animations.push(E),u.addTargetedAnimation(E,e)})));return Promise.all(z).then((()=>(u.normalize(0),u)))}))}async _loadAnimationChannelAsync(e,E,N,u,z){const P=this._extensionsLoadAnimationChannelAsync(e,E,N,u,z);if(P)return await P;if(void 0==u.target.node)return await Promise.resolve();const M=Q.Get(`${e}/target/node`,this._gltf.nodes,u.target.node),D=u.target.path,A="weights"===D;if(A&&!M._numMorphTargets||!A&&!M._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!A&&!M._isJoint)return await Promise.resolve();let C;switch(await Promise.resolve().then(H.bind(H,13359)),D){case"translation":var i;C=null===(i=(0,d.h)("/nodes/{}/translation"))||void 0===i?void 0:i.interpolation;break;case"rotation":var V;C=null===(V=(0,d.h)("/nodes/{}/rotation"))||void 0===V?void 0:V.interpolation;break;case"scale":var U;C=null===(U=(0,d.h)("/nodes/{}/scale"))||void 0===U?void 0:U.interpolation;break;case"weights":var j;C=null===(j=(0,d.h)("/nodes/{}/weights"))||void 0===j?void 0:j.interpolation;break;default:throw new Error(`${e}/target/path: Invalid value (${u.target.path})`)}if(!C)throw new Error(`${e}/target/path: Could not find interpolation properties for target path (${u.target.path})`);const F={object:M,info:C};return await this._loadAnimationChannelFromTargetInfoAsync(e,E,N,u,F,z)}_loadAnimationChannelFromTargetInfoAsync(e,E,H,N,u,z){const P=this.parent.targetFps,M=1/P,D=Q.Get(`${e}/sampler`,H.samplers,N.sampler);return this._loadAnimationSamplerAsync(`${E}/samplers/${N.sampler}`,D).then((e=>{let E=0;const D=u.object,A=u.info;for(const u of A){const A=u.getStride(D),C=e.input,i=e.output,V=new Array(C.length);let U=0;switch(e.interpolation){case"STEP":for(let e=0;e<C.length;e++){const E=u.getValue(D,i,U,1);U+=A,V[e]={frame:C[e]*P,value:E,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<C.length;e++){const E=u.getValue(D,i,U,M);U+=A;const H=u.getValue(D,i,U,1);U+=A;const N=u.getValue(D,i,U,M);U+=A,V[e]={frame:C[e]*P,inTangent:E,value:H,outTangent:N}}break;case"LINEAR":for(let e=0;e<C.length;e++){const E=u.getValue(D,i,U,1);U+=A,V[e]={frame:C[e]*P,value:E}}}if(U>0){const e=`${H.name||`animation${H.index}`}_channel${N.index}_${E}`,M=u.buildAnimations(D,e,P,V);for(const H of M)E++,z(H.babylonAnimatable,H.babylonAnimation)}}}))}_loadAnimationSamplerAsync(e,E){if(E._data)return E._data;const H=E.interpolation||"LINEAR";switch(H){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${E.interpolation})`)}const N=Q.Get(`${e}/input`,this._gltf.accessors,E.input),u=Q.Get(`${e}/output`,this._gltf.accessors,E.output);return E._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${N.index}`,N),this._loadFloatAccessorAsync(`/accessors/${u.index}`,u)]).then((e=>{let[E,N]=e;return{input:E,interpolation:H,output:N}})),E._data}loadBufferAsync(e,E,H,N){const u=this._extensionsLoadBufferAsync(e,E,H,N);if(u)return u;if(!E._data)if(E.uri)E._data=this.loadUriAsync(`${e}/uri`,E,E.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);E._data=this._bin.readAsync(0,E.byteLength)}return E._data.then((E=>{try{return new Uint8Array(E.buffer,E.byteOffset+H,N)}catch(u){throw new Error(`${e}: ${u.message}`)}}))}loadBufferViewAsync(e,E){const H=this._extensionsLoadBufferViewAsync(e,E);if(H)return H;if(E._data)return E._data;const N=Q.Get(`${e}/buffer`,this._gltf.buffers,E.buffer);return E._data=this.loadBufferAsync(`/buffers/${N.index}`,N,E.byteOffset||0,E.byteLength),E._data}_loadAccessorAsync(e,E,H){if(E._data)return E._data;const N=k._GetNumComponents(e,E.type),u=N*Y.g.GetTypeByteLength(E.componentType),z=N*E.count;if(void 0==E.bufferView)E._data=Promise.resolve(new H(z));else{const P=Q.Get(`${e}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((M=>{if(5126!==E.componentType||E.normalized||P.byteStride&&P.byteStride!==u){const e=new H(z);return Y.g.ForEach(M,E.byteOffset||0,P.byteStride||u,N,E.componentType,e.length,E.normalized||!1,((E,H)=>{e[H]=E})),e}return k._GetTypedArray(e,E.componentType,M,E.byteOffset,z)}))}if(E.sparse){const z=E.sparse;E._data=E._data.then((P=>{const M=P,D=Q.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,z.indices.bufferView),A=Q.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${D.index}`,D),this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)]).then((P=>{let[D,A]=P;const C=k._GetTypedArray(`${e}/sparse/indices`,z.indices.componentType,D,z.indices.byteOffset,z.count),i=N*z.count;let V;if(5126!==E.componentType||E.normalized){const P=k._GetTypedArray(`${e}/sparse/values`,E.componentType,A,z.values.byteOffset,i);V=new H(i),Y.g.ForEach(P,0,u,N,E.componentType,V.length,E.normalized||!1,((e,E)=>{V[E]=e}))}else V=k._GetTypedArray(`${e}/sparse/values`,E.componentType,A,z.values.byteOffset,i);let U=0;for(let e=0;e<C.length;e++){let E=C[e]*N;for(let e=0;e<N;e++)M[E++]=V[U++]}return M}))}))}return E._data}_loadFloatAccessorAsync(e,E){return this._loadAccessorAsync(e,E,Float32Array)}_loadIndicesAccessorAsync(e,E){if("SCALAR"!==E.type)throw new Error(`${e}/type: Invalid value ${E.type}`);if(5121!==E.componentType&&5123!==E.componentType&&5125!==E.componentType)throw new Error(`${e}/componentType: Invalid value ${E.componentType}`);if(E._data)return E._data;if(E.sparse){const H=k._GetTypedArrayConstructor(`${e}/componentType`,E.componentType);E._data=this._loadAccessorAsync(e,E,H)}else{const H=Q.Get(`${e}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>k._GetTypedArray(e,E.componentType,H,E.byteOffset,E.count)))}return E._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const E=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>new Y.c(E,e,!1))),e._babylonBuffer}_loadVertexAccessorAsync(e,E,H){var N;if(null!==(N=E._babylonVertexBuffer)&&void 0!==N&&N[H])return E._babylonVertexBuffer[H];E._babylonVertexBuffer||(E._babylonVertexBuffer={});const u=this._babylonScene.getEngine();if(E.sparse||void 0==E.bufferView)E._babylonVertexBuffer[H]=this._loadFloatAccessorAsync(e,E).then((e=>new Y.g(u,e,H,!1)));else{const N=Q.Get(`${e}/bufferView`,this._gltf.bufferViews,E.bufferView);E._babylonVertexBuffer[H]=this._loadVertexBufferViewAsync(N).then((z=>{const P=k._GetNumComponents(e,E.type);return new Y.g(u,z,H,!1,void 0,N.byteStride,void 0,E.byteOffset,P,E.componentType,E.normalized,!0,void 0,!0)}))}return E._babylonVertexBuffer[H]}_loadMaterialMetallicRoughnessPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return E&&(E.baseColorFactor?(H.albedoColor=z.XE.aE(E.baseColorFactor),H.alpha=E.baseColorFactor[3]):H.albedoColor=z.XE.White(),H.metallic=void 0==E.metallicFactor?1:E.metallicFactor,H.roughness=void 0==E.roughnessFactor?1:E.roughnessFactor,E.baseColorTexture&&N.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,E.baseColorTexture,(e=>{e.name=`${H.name} (Base Color)`,H.albedoTexture=e}))),E.metallicRoughnessTexture&&(E.metallicRoughnessTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,E.metallicRoughnessTexture,(e=>{e.name=`${H.name} (Metallic Roughness)`,H.metallicTexture=e}))),H.useMetallnessFromMetallicTextureBlue=!0,H.useRoughnessFromMetallicTextureGreen=!0,H.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(N).then((()=>{}))}_loadMaterialAsync(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const z=this._extensionsLoadMaterialAsync(e,E,H,N,u);if(z)return z;E._data=E._data||{};let P=E._data[N];if(!P){this.logOpen(`${e} ${E.name||""}`);const H=this.createMaterial(e,E,N);P={babylonMaterial:H,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,E,H)},E._data[N]=P,k.AddPointerMetadata(H,e),this._parent.onMaterialLoadedObservable.notifyObservers(H),this.logClose()}return H&&(P.babylonMeshes.push(H),H.cP.addOnce((()=>{const e=P.babylonMeshes.indexOf(H);-1!==e&&P.babylonMeshes.splice(e,1)}))),u(P.babylonMaterial),P.promise.then((()=>P.babylonMaterial))}_createDefaultMaterial(e,E){this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new a.b(e,this._babylonScene);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.fillMode=E,H.enableSpecularAntiAliasing=!0,H.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,H.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,H.transparencyMode=a.b.PBRMATERIAL_OPAQUE,H.metallic=1,H.roughness=1,H}createMaterial(e,E,H){const N=this._extensionsCreateMaterial(e,E,H);if(N)return N;const u=E.name||`material${E.index}`;return this._createDefaultMaterial(u,H)}loadMaterialPropertiesAsync(e,E,H){const N=this._extensionsLoadMaterialPropertiesAsync(e,E,H);if(N)return N;const u=new Array;return u.push(this.loadMaterialBasePropertiesAsync(e,E,H)),E.pbrMetallicRoughness&&u.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,E.pbrMetallicRoughness,H)),this.loadMaterialAlphaProperties(e,E,H),Promise.all(u).then((()=>{}))}loadMaterialBasePropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return H.emissiveColor=E.emissiveFactor?z.XE.aE(E.emissiveFactor):new z.XE(0,0,0),E.doubleSided&&(H.iM=!1,H.twoSidedLighting=!0),E.normalTexture&&(E.normalTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${e}/normalTexture`,E.normalTexture,(e=>{e.name=`${H.name} (Normal)`,H.bumpTexture=e}))),H.invertNormalMapX=!this._babylonScene.useRightHandedSystem,H.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=E.normalTexture.scale&&H.bumpTexture&&(H.bumpTexture.level=E.normalTexture.scale),H.forceIrradianceInFragment=!0),E.occlusionTexture&&(E.occlusionTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,E.occlusionTexture,(e=>{e.name=`${H.name} (Occlusion)`,H.ambientTexture=e}))),H.useAmbientInGrayScale=!0,void 0!=E.occlusionTexture.strength&&(H.ambientTextureStrength=E.occlusionTexture.strength)),E.emissiveTexture&&N.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,E.emissiveTexture,(e=>{e.name=`${H.name} (Emissive)`,H.emissiveTexture=e}))),Promise.all(N).then((()=>{}))}loadMaterialAlphaProperties(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);switch(E.alphaMode||"OPAQUE"){case"OPAQUE":H.transparencyMode=a.b.PBRMATERIAL_OPAQUE,H.alpha=1;break;case"MASK":H.transparencyMode=a.b.PBRMATERIAL_ALPHATEST,H.alphaCutOff=void 0==E.alphaCutoff?.5:E.alphaCutoff,H.albedoTexture&&(H.albedoTexture.zM=!0);break;case"BLEND":H.transparencyMode=a.b.PBRMATERIAL_ALPHABLEND,H.albedoTexture&&(H.albedoTexture.zM=!0,H.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${e}/alphaMode: Invalid value (${E.alphaMode})`)}}loadTextureInfoAsync(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureInfoAsync(e,E,H);if(N)return N;if(this.logOpen(`${e}`),E.texCoord>=6)throw new Error(`${e}/texCoord: Invalid value (${E.texCoord})`);const u=Q.Get(`${e}/index`,this._gltf.textures,E.index);u._textureInfo=E;const z=this._loadTextureAsync(`/textures/${E.index}`,u,(N=>{N.coordinatesIndex=E.texCoord||0,k.AddPointerMetadata(N,e),this._parent.onTextureLoadedObservable.notifyObservers(N),H(N)}));return this.logClose(),z}_loadTextureAsync(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureAsync(e,E,H);if(N)return N;this.logOpen(`${e} ${E.name||""}`);const u=void 0==E.sampler?k.DefaultSampler:Q.Get(`${e}/sampler`,this._gltf.samplers,E.sampler),z=Q.Get(`${e}/source`,this._gltf.images,E.source),P=this._createTextureAsync(e,u,z,H,void 0,!E._textureInfo.nonColorData);return this.logClose(),P}_createTextureAsync(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},z=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;const M=this._loadSampler(`/samplers/${E.index}`,E),D=new Array,A=new N;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C={noMipmap:M.noMipMaps,invertY:!1,samplingMode:M.samplingMode,I:()=>{this._disposed||A.resolve()},onError:(E,H)=>{this._disposed||A.reject(new Error(`${e}: ${H&&H.message?H.message:E||"Failed to load texture"}`))},mimeType:H.mimeType??(0,l.l)(H.uri??""),loaderOptions:z,useSRGBBuffer:!!P&&this._parent.useSRGBBuffers},i=new W.b(null,this._babylonScene,C);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D.push(A.promise),D.push(this.loadImageAsync(`/images/${H.index}`,H).then((e=>{const E=H.uri||`${this._fileName}#image${H.index}`,N=`data:${this._uniqueRootUrl}${E}`;i.updateURL(N,e);const u=i.getInternalTexture();u&&(u.label=H.name)}))),i.wrapU=M.wrapU,i.wrapV=M.wrapV,u(i),this._parent.useGltfTextureNames&&(i.name=H.name||H.uri||`image${H.index}`),Promise.all(D).then((()=>i))}_loadSampler(e,E){return E._data||(E._data={noMipMaps:9728===E.minFilter||9729===E.minFilter,samplingMode:k._GetTextureSamplingMode(e,E),wrapU:k._GetTextureWrapMode(`${e}/wrapS`,E.wrapS),wrapV:k._GetTextureWrapMode(`${e}/wrapT`,E.wrapT)}),E._data}loadImageAsync(e,E){if(!E._data){if(this.logOpen(`${e} ${E.name||""}`),E.uri)E._data=this.loadUriAsync(`${e}/uri`,E,E.uri);else{const H=Q.Get(`${e}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}this.logClose()}return E._data}loadUriAsync(e,E,H){const N=this._extensionsLoadUriAsync(e,E,H);if(N)return N;if(!k._ValidateUri(H))throw new Error(`${e}: '${H}' is invalid`);if((0,l.n)(H)){const E=new Uint8Array((0,l.e)(H));return this.log(`${e}: Decoded ${H.substring(0,64)}... (${E.length} bytes)`),Promise.resolve(E)}return this.log(`${e}: Loading ${H}`),this._parent.preprocessUrlAsync(this._rootUrl+H).then((E=>new Promise(((N,u)=>{this._parent._loadFile(this._babylonScene,E,(E=>{this._disposed||(this.log(`${e}: Loaded ${H} (${E.byteLength} bytes)`),N(new Uint8Array(E)))}),!0,(E=>{u(new l.q(`${e}: Failed to load '${H}'${E?": "+E.status+" "+E.statusText:""}`,E))}))}))))}static AddPointerMetadata(e,E){e.metadata=e.metadata||{};const H=e._internalMetadata=e._internalMetadata||{},N=H.eM=H.eM||{};(N.pointers=N.pointers||[]).push(E)}static _GetTextureWrapMode(e,E){switch(E=void 0==E?10497:E){case 33071:return W.b.CLAMP_ADDRESSMODE;case 33648:return W.b.MIRROR_ADDRESSMODE;case 10497:return W.b.WRAP_ADDRESSMODE;default:return F.d.Warn(`${e}: Invalid value (${E})`),W.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,E){const H=void 0==E.magFilter?9729:E.magFilter,N=void 0==E.minFilter?9987:E.minFilter;if(9729===H)switch(N){case 9728:return W.b.LINEAR_NEAREST;case 9729:return W.b.LINEAR_LINEAR;case 9984:return W.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return W.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return W.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return W.b.LINEAR_LINEAR_MIPLINEAR;default:return F.d.Warn(`${e}/minFilter: Invalid value (${N})`),W.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==H&&F.d.Warn(`${e}/magFilter: Invalid value (${H})`),N){case 9728:return W.b.NEAREST_NEAREST;case 9729:return W.b.NEAREST_LINEAR;case 9984:return W.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return W.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return W.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return W.b.NEAREST_LINEAR_MIPLINEAR;default:return F.d.Warn(`${e}/minFilter: Invalid value (${N})`),W.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,E){try{return(0,me.o)(E)}catch(H){throw new Error(`${e}: ${H.message}`)}}static _GetTypedArray(e,E,H,N,u){const z=H.buffer;N=H.byteOffset+(N||0);const P=k._GetTypedArrayConstructor(`${e}/componentType`,E),M=Y.g.GetTypeByteLength(E);return N%M!==0?(F.d.Warn(`${e}: Copying buffer as byte offset (${N}) is not a multiple of component type byte length (${M})`),new P(z.slice(N,N+u*M),0)):new P(z,N,u)}static _GetNumComponents(e,E){switch(E){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${E})`)}static _ValidateUri(e){return P.Tools.IsBase64(e)||-1===e.indexOf("..")}static _GetDrawMode(e,E){switch(void 0==E&&(E=4),E){case 0:return X.e.PointListDrawMode;case 1:return X.e.LineListDrawMode;case 2:return X.e.LineLoopDrawMode;case 3:return X.e.LineStripDrawMode;case 4:return X.e.TriangleFillMode;case 5:return X.e.TriangleStripDrawMode;case 6:return X.e.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${E})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials)for(const E of this._gltf.materials)if(E._data)for(const H in E._data){const N=E._data[H];for(const E of N.babylonMeshes){E.DM(!0);const H=N.babylonMaterial;e.push(H.forceCompilationAsync(E)),e.push(H.forceCompilationAsync(E,{useInstances:!0})),this._parent.useClipPlane&&(e.push(H.forceCompilationAsync(E,{clipPlane:!0})),e.push(H.forceCompilationAsync(E,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,E=this._babylonScene.lights;for(const H of E){const E=H.getShadowGenerator();E&&e.push(E.forceCompilationAsync())}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(e){for(const E of this._extensions)E.enabled&&e(E)}_applyExtensions(e,E,H){for(const N of this._extensions)if(N.enabled){const u=`${N.name}.${E}`,z=e;z._activeLoaderExtensionFunctions=z._activeLoaderExtensionFunctions||{};const P=z._activeLoaderExtensionFunctions;if(!P[u]){P[u]=!0;try{const e=H(N);if(e)return e}finally{delete P[u]}}}return null}_extensionsOnLoading(){this._forEachExtensions((e=>e.onLoading&&e.onLoading()))}_extensionsOnReady(){this._forEachExtensions((e=>e.onReady&&e.onReady()))}_extensionsLoadSceneAsync(e,E){return this._applyExtensions(E,"loadScene",(H=>H.loadSceneAsync&&H.loadSceneAsync(e,E)))}_extensionsLoadNodeAsync(e,E,H){return this._applyExtensions(E,"loadNode",(N=>N.loadNodeAsync&&N.loadNodeAsync(e,E,H)))}_extensionsLoadCameraAsync(e,E,H){return this._applyExtensions(E,"loadCamera",(N=>N.loadCameraAsync&&N.loadCameraAsync(e,E,H)))}_extensionsLoadVertexDataAsync(e,E,H){return this._applyExtensions(E,"loadVertexData",(N=>N._loadVertexDataAsync&&N._loadVertexDataAsync(e,E,H)))}_extensionsLoadMeshPrimitiveAsync(e,E,H,N,u,z){return this._applyExtensions(u,"loadMeshPrimitive",(P=>P._loadMeshPrimitiveAsync&&P._loadMeshPrimitiveAsync(e,E,H,N,u,z)))}_extensionsLoadMaterialAsync(e,E,H,N,u){return this._applyExtensions(E,"loadMaterial",(z=>z._loadMaterialAsync&&z._loadMaterialAsync(e,E,H,N,u)))}_extensionsCreateMaterial(e,E,H){return this._applyExtensions(E,"createMaterial",(N=>N.createMaterial&&N.createMaterial(e,E,H)))}_extensionsLoadMaterialPropertiesAsync(e,E,H){return this._applyExtensions(E,"loadMaterialProperties",(N=>N.loadMaterialPropertiesAsync&&N.loadMaterialPropertiesAsync(e,E,H)))}_extensionsLoadTextureInfoAsync(e,E,H){return this._applyExtensions(E,"loadTextureInfo",(N=>N.loadTextureInfoAsync&&N.loadTextureInfoAsync(e,E,H)))}_extensionsLoadTextureAsync(e,E,H){return this._applyExtensions(E,"loadTexture",(N=>N._loadTextureAsync&&N._loadTextureAsync(e,E,H)))}_extensionsLoadAnimationAsync(e,E){return this._applyExtensions(E,"loadAnimation",(H=>H.loadAnimationAsync&&H.loadAnimationAsync(e,E)))}_extensionsLoadAnimationChannelAsync(e,E,H,N,u){return this._applyExtensions(H,"loadAnimationChannel",(z=>z._loadAnimationChannelAsync&&z._loadAnimationChannelAsync(e,E,H,N,u)))}_extensionsLoadSkinAsync(e,E,H){return this._applyExtensions(H,"loadSkin",(N=>N._loadSkinAsync&&N._loadSkinAsync(e,E,H)))}_extensionsLoadUriAsync(e,E,H){return this._applyExtensions(E,"loadUri",(N=>N._loadUriAsync&&N._loadUriAsync(e,E,H)))}_extensionsLoadBufferViewAsync(e,E){return this._applyExtensions(E,"loadBufferView",(H=>H.loadBufferViewAsync&&H.loadBufferViewAsync(e,E)))}_extensionsLoadBufferAsync(e,E,H,N){return this._applyExtensions(E,"loadBuffer",(u=>u.loadBufferAsync&&u.loadBufferAsync(e,E,H,N)))}static LoadExtensionAsync(e,E,H,N){if(!E.extensions)return null;const u=E.extensions[H];return u?N(`${e}/extensions/${H}`,u):null}static LoadExtraAsync(e,E,H,N){if(!E.extras)return null;const u=E.extras[H];return u?N(`${e}/extras/${H}`,u):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}k.DefaultSampler={index:-1},K.e._CreateGLTF2Loader=e=>new k(e);var J=H(13359),B=H(11924),I=H(11776),t=H(13365),q=H(13369);class c extends q.b{constructor(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",e),this._texture=e.getEngine().createRawCubeTexture(E,H,N,u,z,P,M,D)}update(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,e,E,H,N,u)}updateRGBDAsync(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,t.k)(this._texture,e,E,H,N).then((()=>{}))}clone(){return I.d.Clone((()=>{const e=this.fe(),E=this._texture,H=new c(e,E._bufferViewArray,E.width,E.format,E.type,E.generateMipMaps,E.invertY,E.samplingMode,E._compression);return 13===E.source&&H.updateRGBDAsync(E._bufferViewArrayArray,E._sphericalPolynomial,E._lodGenerationScale,E._lodGenerationOffset),H}),this)}}const n="EXT_lights_image_based";class g{constructor(e){this.name=n,this._loader=e,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.eM.extensions;if(e&&e[this.name]){const E=e[this.name];this._lights=E.lights}}loadSceneAsync(e,E){return k.LoadExtensionAsync(e,E,this.name,(async(H,N)=>{this._loader._allMaterialsDirtyRequired=!0;const u=new Array;u.push(this._loader.loadSceneAsync(e,E)),this._loader.logOpen(`${H}`);const z=Q.Get(`${H}/light`,this._lights,N.nz);return u.push(this._loadLightAsync(`/extensions/${this.name}/lights/${N.nz}`,z).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),await Promise.all(u).then((()=>{}))}))}_loadLightAsync(e,E){if(!E._loaded){const H=new Array;this._loader.logOpen(`${e}`);const N=new Array(E.specularImages.length);for(let u=0;u<E.specularImages.length;u++){const z=E.specularImages[u];N[u]=new Array(z.length);for(let E=0;E<z.length;E++){const P=`${e}/specularImages/${u}/${E}`;this._loader.logOpen(`${P}`);const M=z[E],D=Q.Get(P,this._loader.eM.images,M);H.push(this._loader.loadImageAsync(`/images/${M}`,D).then((e=>{N[u][E]=e}))),this._loader.logClose()}}this._loader.logClose(),E._loaded=Promise.all(H).then((async()=>{const H=new c(this._loader.babylonScene,null,E.specularImageSize);if(H.name=E.name||"environment",E._babylonTexture=H,void 0!=E.XM&&(H.level=E.XM),E.rotation){let e=u.Quaternion.aE(E.rotation);this._loader.babylonScene.useRightHandedSystem||(e=u.Quaternion.Inverse(e)),u.Matrix.FromQuaternionToRef(e,H.getReflectionTextureMatrix())}if(!E.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const z=B.b.aE(E.irradianceCoefficients);z.scaleInPlace(E.XM),z.convertIrradianceToLambertianRadiance();const P=B.f.FromHarmonics(z),M=(N.length-1)/Math.log2(E.specularImageSize);return await H.updateRGBDAsync(N,P,M)}))}return E._loaded.then((()=>E._babylonTexture))}}L(n),T(n,!0,(e=>new g(e)));H(12288);const x="EXT_mesh_gpu_instancing";class ee{constructor(e){this.name=x,this._loader=e,this.enabled=this._loader.isExtensionUsed(x)}dispose(){this._loader=null}loadNodeAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(e,N)=>{this._loader._disableInstancedMesh++;const z=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,H);if(this._loader._disableInstancedMesh--,!E._primitiveBabylonMeshes)return await z;const P=new Array;let M=0;const D=E=>{if(void 0==N.attributes[E])return void P.push(Promise.resolve(null));const H=Q.Get(`${e}/attributes/${E}`,this._loader.eM.accessors,N.attributes[E]);if(P.push(this._loader._loadFloatAccessorAsync(`/accessors/${H.bufferView}`,H)),0===M)M=H.count;else if(M!==H.count)throw new Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return D("TRANSLATION"),D("ROTATION"),D("SCALE"),await z.then((async e=>{const[H,N,z]=await Promise.all(P),D=new Float32Array(16*M);u.TmpVectors.jE[0].VM(0,0,0),u.TmpVectors.Quaternion[0].VM(0,0,0,1),u.TmpVectors.jE[1].VM(1,1,1);for(let E=0;E<M;++E)H&&u.jE.FromArrayToRef(H,3*E,u.TmpVectors.jE[0]),N&&u.Quaternion.FromArrayToRef(N,4*E,u.TmpVectors.Quaternion[0]),z&&u.jE.FromArrayToRef(z,3*E,u.TmpVectors.jE[1]),u.Matrix.ComposeToRef(u.TmpVectors.jE[1],u.TmpVectors.Quaternion[0],u.TmpVectors.jE[0],u.TmpVectors.Matrix[0]),u.TmpVectors.Matrix[0].copyToArray(D,16*E);for(const u of E._primitiveBabylonMeshes)u.Di("matrix",D,16,!0);return e}))}))}}L(x),T(x,!0,(e=>new ee(e)));let Ee=0,He=null;class Ne{static get Default(){return Ne._Default||(Ne._Default=new Ne),Ne._Default}constructor(){const e=Ne.Configuration.decoder;this._decoderModulePromise=P.Tools.LoadBabylonScriptAsync(e.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(e,E,H,N,u){await this._decoderModulePromise,0===Ee&&(MeshoptDecoder.useWorkers(1),Ee=1);const z=await MeshoptDecoder.decodeGltfBufferAsync(E,H,e,N,u);return null!==He&&clearTimeout(He),He=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Ee=0,He=null}),1e3),z}}Ne.Configuration={decoder:{url:`${P.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Ne._Default=null;const ue="EXT_meshopt_compression";class ze{constructor(e){this.name=ue,this.enabled=e.isExtensionUsed(ue),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,E){return k.LoadExtensionAsync(e,E,this.name,(async(H,N)=>{const u=E;if(u._meshOptData)return await u._meshOptData;const z=Q.Get(`${e}/buffer`,this._loader.eM.buffers,N.buffer);return u._meshOptData=this._loader.loadBufferAsync(`/buffers/${z.index}`,z,N.byteOffset||0,N.byteLength).then((async e=>await Ne.Default.decodeGltfBufferAsync(e,N.count,N.byteStride,N.mode,N.filter))),await u._meshOptData}))}}L(ue),T(ue,!0,(e=>new ze(e)));const Pe="EXT_texture_webp";class Me{constructor(e){this.name=Pe,this._loader=e,this.enabled=e.isExtensionUsed(Pe)}dispose(){this._loader=null}_loadTextureAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=void 0==E.sampler?k.DefaultSampler:Q.Get(`${e}/sampler`,this._loader.eM.samplers,E.sampler),P=Q.Get(`${N}/source`,this._loader.eM.images,u.source);return await this._loader._createTextureAsync(e,z,P,(e=>{H(e)}),void 0,!E._textureInfo.nonColorData)}))}}L(Pe),T(Pe,!0,(e=>new Me(e)));const De="EXT_texture_avif";class Ae{constructor(e){this.name=De,this._loader=e,this.enabled=e.isExtensionUsed(De)}dispose(){this._loader=null}_loadTextureAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=void 0==E.sampler?k.DefaultSampler:Q.Get(`${e}/sampler`,this._loader.eM.samplers,E.sampler),P=Q.Get(`${N}/source`,this._loader.eM.images,u.source);return await this._loader._createTextureAsync(e,z,P,(e=>{H(e)}),void 0,!E._textureInfo.nonColorData)}))}}L(De),T(De,!0,(e=>new Ae(e)));var Ce=H(13354),ie=H(12256);const Ve="EXT_lights_ies";class Ue{constructor(e){this.name=Ve,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ve)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.eM.extensions;if(e&&e[this.name]){const E=e[this.name];this._lights=E.lights,Q.Assign(this._lights)}}loadNodeAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,P)=>{let M,D;this._loader._allMaterialsDirtyRequired=!0;const A=await this._loader.loadNodeAsync(e,E,(e=>{D=Q.Get(N,this._lights,P.nz);const E=D.name||e.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,M=new Ce.e(E,u.jE.Zero(),u.jE.Backward(),0,1,this._loader.babylonScene),M.angle=Math.PI/2,M.innerAngle=0,M._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,D._babylonLight=M,M.falloffType=ie.b.FALLOFF_GLTF,M.aM=P.color?z.XE.aE(P.color):z.XE.White(),M.XM=P.multiplier||1,M.range=Number.MAX_VALUE,M.parent=e,this._loader._babylonLights.push(M),k.AddPointerMetadata(M,N),H(e)}));let C;if(D.uri)C=await this._loader.loadUriAsync(e,D,D.uri);else{const E=Q.Get(`${e}/bufferView`,this._loader.eM.bufferViews,D.bufferView);C=await this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E)}return M.iesProfileTexture=new W.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,C,!0,void 0,void 0,void 0,void 0,".ies"),A}))}}L(Ve),T(Ve,!0,(e=>new Ue(e)));var je=H(13383);const Fe="KHR_draco_mesh_compression";class he{constructor(e){this.name=Fe,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=je.d.DefaultAvailable&&this._loader.isExtensionUsed(Fe)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{if(void 0!=E.mode&&4!==E.mode&&5!==E.mode)throw new Error(`${e}: Unsupported mode ${E.mode}`);const z={},P={},M=(e,N)=>{const M=u.attributes[e];if(void 0!=M&&(H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(N)&&H._delayInfo.push(N),z[N]=M,this.useNormalizedFlagFromAccessor)){const H=Q.TryGet(this._loader.eM.accessors,E.attributes[e]);H&&(P[N]=H.normalized||!1)}};M("POSITION",Y.g.PositionKind),M("NORMAL",Y.g.NormalKind),M("TANGENT",Y.g.TangentKind),M("TEXCOORD_0",Y.g.UVKind),M("TEXCOORD_1",Y.g.UV2Kind),M("TEXCOORD_2",Y.g.UV3Kind),M("TEXCOORD_3",Y.g.UV4Kind),M("TEXCOORD_4",Y.g.UV5Kind),M("TEXCOORD_5",Y.g.UV6Kind),M("JOINTS_0",Y.g.MatricesIndicesKind),M("WEIGHTS_0",Y.g.MatricesWeightsKind),M("COLOR_0",Y.g.ColorKind);const D=Q.Get(N,this._loader.eM.bufferViews,u.bufferView);return D._dracoBabylonGeometry||(D._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((async N=>{const u=this.dracoDecoder||je.d.Default,M=Q.TryGet(this._loader.eM.accessors,E.attributes.POSITION),D=this._loader.parent.alwaysComputeBoundingBox||H.skeleton||!M?null:Z(M);return await u._decodeMeshToGeometryForGltfAsync(H.name,this._loader.babylonScene,N,z,P,D).catch((E=>{throw new Error(`${e}: ${E.message}`)}))}))),await D._dracoBabylonGeometry}))}}L(Fe),T(Fe,!0,(e=>new he(e)));var Se=H(13392),Xe=H(11717),ae=H(11723),We=H(12136),re=H(12330),Ye=H(11690);We.e.AddNodeConstructor("Light_Type_0",((e,E)=>()=>new fe(e,u.jE.Zero(),E)));class fe extends re.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(e){const E=this.needCube();if(this._direction=e,this.needCube()!==E&&this._shadowGenerators){const e=this._shadowGenerators.values();for(let E=e.next();!0!==E.done;E=e.next()){E.value.recreateShadowMap()}}}constructor(e,E,H){super(e,H),this._shadowAngle=Math.PI/2,this.position=E}getClassName(){return"PointLight"}getTypeID(){return ie.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new u.jE(1,0,0);case 1:return new u.jE(-1,0,0);case 2:return new u.jE(0,-1,0);case 3:return new u.jE(0,1,0);case 4:return new u.jE(0,0,1);case 5:return new u.jE(0,0,-1)}return u.jE.Zero()}_setDefaultShadowProjectionMatrix(e,E,H){const N=this.fe().activeCamera;if(!N)return;const z=void 0!==this.shadowMinZ?this.shadowMinZ:N.PM,P=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,M=this.fe().getEngine().IP;u.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,M?P:z,M?z:P,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,M)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,E){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,E):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,E),this}transferToNodeMaterialEffect(e,E){return this.computeTransformedInformation()?e.setFloat3(E,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(E,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(e,E){e["POINTLIGHT"+E]=!0}}(0,Xe.e)([(0,ae.S)()],fe.prototype,"shadowAngle",null),(0,Ye.g)("BABYLON.PointLight",fe);const we="KHR_lights_punctual";class se{constructor(e){this.name=we,this._loader=e,this.enabled=this._loader.isExtensionUsed(we)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.eM.extensions;if(e&&e[this.name]){const E=e[this.name];this._lights=E.lights,Q.Assign(this._lights)}}loadNodeAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,P)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(e,E,(e=>{let E;const M=Q.Get(N,this._lights,P.nz),D=M.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,M.type){case"directional":{const e=new Se.b(D,u.jE.Backward(),this._loader.babylonScene);e.position.jM(0),E=e;break}case"point":E=new fe(D,u.jE.Zero(),this._loader.babylonScene);break;case"spot":{const e=new Ce.e(D,u.jE.Zero(),u.jE.Backward(),0,1,this._loader.babylonScene);e.angle=2*(M.spot&&M.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(M.spot&&M.spot.innerConeAngle||0),E=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${N}: Invalid light type (${M.type})`)}E._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,M._babylonLight=E,E.falloffType=ie.b.FALLOFF_GLTF,E.aM=M.color?z.XE.aE(M.color):z.XE.White(),E.XM=void 0==M.XM?1:M.XM,E.range=void 0==M.range?Number.MAX_VALUE:M.range,E.parent=e,this._loader._babylonLights.push(E),k.AddPointerMetadata(E,N),H(e)})))))}}L(we),T(we,!0,(e=>new se(e)));const pe="KHR_materials_pbrSpecularGlossiness";class oe{constructor(e){this.name=pe,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(pe)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialBasePropertiesAsync(e,E,H)),z.push(this._loadSpecularGlossinessPropertiesAsync(N,u,H)),this._loader.loadMaterialAlphaProperties(e,E,H),await Promise.all(z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return H.metallic=null,H.roughness=null,E.diffuseFactor?(H.albedoColor=z.XE.aE(E.diffuseFactor),H.alpha=E.diffuseFactor[3]):H.albedoColor=z.XE.White(),H.reflectivityColor=E.specularFactor?z.XE.aE(E.specularFactor):z.XE.White(),H.microSurface=void 0==E.glossinessFactor?1:E.glossinessFactor,E.diffuseTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,E.diffuseTexture,(e=>{e.name=`${H.name} (Diffuse)`,H.albedoTexture=e}))),E.specularGlossinessTexture&&(N.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,E.specularGlossinessTexture,(e=>{e.name=`${H.name} (Specular Glossiness)`,H.reflectivityTexture=e,H.reflectivityTexture.zM=!0}))),H.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(N).then((()=>{}))}}L(pe),T(pe,!0,(e=>new oe(e)));const ye="KHR_materials_unlit";class be{constructor(e){this.name=ye,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(ye)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async()=>await this._loadUnlitPropertiesAsync(e,E,H)))}_loadUnlitPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;H.unlit=!0;const u=E.pbrMetallicRoughness;return u&&(u.baseColorFactor?(H.albedoColor=z.XE.aE(u.baseColorFactor),H.alpha=u.baseColorFactor[3]):H.albedoColor=z.XE.White(),u.baseColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,u.baseColorTexture,(e=>{e.name=`${H.name} (Base Color)`,H.albedoTexture=e})))),E.doubleSided&&(H.iM=!1,H.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,E,H),Promise.all(N).then((()=>{}))}}L(ye),T(ye,!0,(e=>new be(e)));const Ke="KHR_materials_clearcoat";class le{constructor(e){this.name=Ke,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ke)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadClearCoatPropertiesAsync(N,u,H)),await Promise.all(z)}))}_loadClearCoatPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return H.clearCoat.isEnabled=!0,H.clearCoat.useRoughnessFromMainTexture=!1,H.clearCoat.remapF0OnInterfaceChange=!1,void 0!=E.clearcoatFactor?H.clearCoat.XM=E.clearcoatFactor:H.clearCoat.XM=0,E.clearcoatTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,E.clearcoatTexture,(e=>{e.name=`${H.name} (ClearCoat)`,H.clearCoat.texture=e}))),void 0!=E.clearcoatRoughnessFactor?H.clearCoat.roughness=E.clearcoatRoughnessFactor:H.clearCoat.roughness=0,E.clearcoatRoughnessTexture&&(E.clearcoatRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,E.clearcoatRoughnessTexture,(e=>{e.name=`${H.name} (ClearCoat Roughness)`,H.clearCoat.textureRoughness=e})))),E.clearcoatNormalTexture&&(E.clearcoatNormalTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,E.clearcoatNormalTexture,(e=>{e.name=`${H.name} (ClearCoat Normal)`,H.clearCoat.bumpTexture=e}))),H.invertNormalMapX=!H.fe().useRightHandedSystem,H.invertNormalMapY=H.fe().useRightHandedSystem,void 0!=E.clearcoatNormalTexture.scale&&(H.clearCoat.bumpTexture.level=E.clearcoatNormalTexture.scale)),Promise.all(N).then((()=>{}))}}L(Ke),T(Ke,!0,(e=>new le(e)));const Oe="KHR_materials_iridescence";class ve{constructor(e){this.name=Oe,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(Oe)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadIridescencePropertiesAsync(N,u,H)),await Promise.all(z).then((()=>{}))}))}_loadIridescencePropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return H.iridescence.isEnabled=!0,H.iridescence.XM=E.iridescenceFactor??0,H.iridescence.indexOfRefraction=E.iridescenceIor??E.iridescenceIOR??1.3,H.iridescence.minimumThickness=E.iridescenceThicknessMinimum??100,H.iridescence.maximumThickness=E.iridescenceThicknessMaximum??400,E.iridescenceTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,E.iridescenceTexture,(e=>{e.name=`${H.name} (Iridescence)`,H.iridescence.texture=e}))),E.iridescenceThicknessTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,E.iridescenceThicknessTexture,(e=>{e.name=`${H.name} (Iridescence Thickness)`,H.iridescence.thicknessTexture=e}))),Promise.all(N).then((()=>{}))}}L(Oe),T(Oe,!0,(e=>new ve(e)));const Re="KHR_materials_anisotropy";class Te{constructor(e){this.name=Re,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(Re)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadIridescencePropertiesAsync(N,u,H)),await Promise.all(z)}))}async _loadIridescencePropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;H.anisotropy.isEnabled=!0,H.anisotropy.XM=E.anisotropyStrength??0,H.anisotropy.angle=E.anisotropyRotation??0,E.anisotropyTexture&&(E.anisotropyTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,E.anisotropyTexture,(e=>{e.name=`${H.name} (Anisotropy Intensity)`,H.anisotropy.texture=e})))),await Promise.all(N)}}L(Re),T(Re,!0,(e=>new Te(e)));const Le="KHR_materials_emissive_strength";class de{constructor(e){this.name=Le,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(Le)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>await this._loader.loadMaterialPropertiesAsync(e,E,H).then((()=>{this._loadEmissiveProperties(N,u,H)}))))}_loadEmissiveProperties(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);void 0!==E.emissiveStrength&&(H.emissiveIntensity=E.emissiveStrength)}}L(Le),T(Le,!0,(e=>new de(e)));const Ge="KHR_materials_sheen";class mE{constructor(e){this.name=Ge,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ge)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadSheenPropertiesAsync(N,u,H)),await Promise.all(z).then((()=>{}))}))}_loadSheenPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return H.sheen.isEnabled=!0,H.sheen.XM=1,void 0!=E.sheenColorFactor?H.sheen.color=z.XE.aE(E.sheenColorFactor):H.sheen.color=z.XE.Black(),E.sheenColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,E.sheenColorTexture,(e=>{e.name=`${H.name} (Sheen Color)`,H.sheen.texture=e}))),void 0!==E.sheenRoughnessFactor?H.sheen.roughness=E.sheenRoughnessFactor:H.sheen.roughness=0,E.sheenRoughnessTexture&&(E.sheenRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,E.sheenRoughnessTexture,(e=>{e.name=`${H.name} (Sheen Roughness)`,H.sheen.textureRoughness=e})))),H.sheen.albedoScaling=!0,H.sheen.useRoughnessFromMainTexture=!1,Promise.all(N).then((()=>{}))}}L(Ge),T(Ge,!0,(e=>new mE(e)));var Qe=H(12194);const Ze="KHR_materials_specular";class ke{constructor(e){this.name=Ze,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ze)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;if(z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadSpecularPropertiesAsync(N,u,H)),u.extensions&&u.extensions.EXT_materials_specular_edge_color&&H instanceof a.b){u.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(H.brdf.dielectricSpecularModel=Qe.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,H.brdf.conductorSpecularModel=Qe.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(z).then((()=>{}))}))}_loadSpecularPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return void 0!==E.specularFactor&&(H.metallicF0Factor=E.specularFactor),void 0!==E.specularColorFactor&&(H.metallicReflectanceColor=z.XE.aE(E.specularColorFactor)),E.specularTexture&&(E.specularTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,E.specularTexture,(e=>{e.name=`${H.name} (Specular)`,H.metallicReflectanceTexture=e,H.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),E.specularColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,E.specularColorTexture,(e=>{e.name=`${H.name} (Specular Color)`,H.reflectanceTexture=e}))),Promise.all(N).then((()=>{}))}}L(Ze),T(Ze,!0,(e=>new ke(e)));const Je="KHR_materials_ior";class Be{constructor(e){this.name=Je,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(Je)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadIorPropertiesAsync(N,u,H)),await Promise.all(z).then((()=>{}))}))}_loadIorPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);return void 0!==E.ior?H.indexOfRefraction=E.ior:H.indexOfRefraction=Be._DEFAULT_IOR,Promise.resolve()}}Be._DEFAULT_IOR=1.5,L(Je),T(Je,!0,(e=>new Be(e)));const Ie="KHR_materials_variants";class te{constructor(e){this.name=Ie,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ie)}dispose(){this._loader=null}static GetAvailableVariants(e){const E=this._GetExtensionMetadata(e);return E?Object.keys(E.variants):[]}getAvailableVariants(e){return te.GetAvailableVariants(e)}static SelectVariant(e,E){const H=this._GetExtensionMetadata(e);if(!H)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Ie} extension`);const N=e=>{const E=H.variants[e];if(E)for(const H of E)H.mesh.material=H.material};if(E instanceof Array)for(const u of E)N(u);else N(E);H.lastSelected=E}selectVariant(e,E){te.SelectVariant(e,E)}static Reset(e){const E=this._GetExtensionMetadata(e);if(!E)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Ie} extension`);for(const H of E.original)H.mesh.material=H.material;E.lastSelected=null}reset(e){te.Reset(e)}static GetLastSelectedVariant(e){const E=this._GetExtensionMetadata(e);if(!E)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Ie} extension`);return E.lastSelected}getLastSelectedVariant(e){return te.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){var E,H;return(null===e||void 0===e||null===(E=e._internalMetadata)||void 0===E||null===(H=E.eM)||void 0===H?void 0:H[Ie])||null}onLoading(){const e=this._loader.eM.extensions;if(e&&e[this.name]){const E=e[this.name];this._variants=E.variants}}onReady(){const e=this._loader.rootBabylonMesh;if(e){var E;const H=this._loader.parent.extensionOptions[Ie];null!==H&&void 0!==H&&H.defaultVariant&&te.SelectVariant(e,H.defaultVariant),null===H||void 0===H||null===(E=H.onLoaded)||void 0===E||E.call(H,{get variants(){return te.GetAvailableVariants(e)},get selectedVariant(){const E=te.GetLastSelectedVariant(e);return E?Array.isArray(E)?E[0]:E:te.GetAvailableVariants(e)[0]},set selectedVariant(E){te.SelectVariant(e,E)}})}}_loadMeshPrimitiveAsync(e,E,H,N,u,z){return k.LoadExtensionAsync(e,u,this.name,(async(P,M)=>{const D=new Array;return D.push(this._loader._loadMeshPrimitiveAsync(e,E,H,N,u,(E=>{if(z(E),E instanceof s.c){const H=k._GetDrawMode(e,u.mode),N=this._loader.rootBabylonMesh,z=N?N._internalMetadata=N._internalMetadata||{}:{},A=z.eM=z.eM||{},C=A[Ie]=A[Ie]||{lastSelected:null,original:[],variants:{}};C.original.push({mesh:E,material:E.material});for(let e=0;e<M.mappings.length;++e){const u=M.mappings[e],z=Q.Get(`${P}/mappings/${e}/material`,this._loader.eM.materials,u.material);D.push(this._loader._loadMaterialAsync(`#/materials/${u.material}`,z,E,H,(e=>{for(let H=0;H<u.variants.length;++H){const z=u.variants[H],P=Q.Get(`/extensions/${Ie}/variants/${z}`,this._variants,z);C.variants[P.name]=C.variants[P.name]||[],C.variants[P.name].push({mesh:E,material:e}),E.onClonedObservable.add((e=>{const H=e;let u=null,z=H;do{if(z=z.parent,!z)return;u=te._GetExtensionMetadata(z)}while(null===u);if(N&&u===te._GetExtensionMetadata(N)){z._internalMetadata={};for(const e in N._internalMetadata)z._internalMetadata[e]=N._internalMetadata[e];z._internalMetadata.eM=[];for(const e in N._internalMetadata.eM)z._internalMetadata.eM[e]=N._internalMetadata.eM[e];z._internalMetadata.eM[Ie]={lastSelected:null,original:[],variants:{}};for(const e of u.original)z._internalMetadata.eM[Ie].original.push({mesh:e.mesh,material:e.material});for(const e in u.variants)if(Object.prototype.hasOwnProperty.call(u.variants,e)){z._internalMetadata.eM[Ie].variants[e]=[];for(const E of u.variants[e])z._internalMetadata.eM[Ie].variants[e].push({mesh:E.mesh,material:E.material})}u=z._internalMetadata.eM[Ie]}for(const N of u.original)N.mesh===E&&(N.mesh=H);for(const N of u.variants[P.name])N.mesh===E&&(N.mesh=H)}))}})))}}}))),await Promise.all(D).then((e=>{let[E]=e;return E}))}))}}L(Ie),T(Ie,!0,(e=>new te(e)));var qe=H(11807);class ce{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Qe.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,E){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...ce._GetDefaultOptions(),...e},this._scene=E,this._scene._transmissionHelper=this,this.onErrorObservable=new C.d,this._scene.cP.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter((E=>this._options[E]!==e[E])).length)return;const E={...this._options,...e},H=this._options;this._options=E,E.renderSize===H.renderSize&&E.renderTargetTextureType===H.renderTargetTextureType&&E.generateMipmaps===H.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=E.samples,this._opaqueRenderTarget.lodGenerationScale=E.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=E.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(e){return!!e&&!!(e instanceof a.b&&e.subSurface.isRefractionEnabled)}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),P.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)}))}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let E=this._transparentMeshesCache.indexOf(e);-1!==E&&this._transparentMeshesCache.splice(E,1),E=this._opaqueMeshesCache.indexOf(e),-1!==E&&this._opaqueMeshesCache.splice(E,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){const E=this._transparentMeshesCache.indexOf(e),H=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof a.b&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==H?(this._opaqueMeshesCache.splice(H,1),this._transparentMeshesCache.push(e)):-1===E&&this._transparentMeshesCache.push(e)):-1!==E?(this._transparentMeshesCache.splice(E,1),this._opaqueMeshesCache.push(e)):-1===H&&this._opaqueMeshesCache.push(e)}_isRenderTargetValid(){var e;return null!==(null===(e=this._opaqueRenderTarget)||void 0===e?void 0:e.getInternalTexture())}_setupRenderTargets(){var e;let E;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new qe.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(e=this._options.clearColor)||void 0===e?void 0:e.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((e=>{E=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?e.clearColor.P(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(e.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=E}));for(const H of this._transparentMeshesCache)this._shouldRenderAsTransmission(H.material)&&(H.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ne="KHR_materials_transmission";class ge{constructor(e){this.name=ne,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(ne),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadTransparentPropertiesAsync(N,E,H,u)),await Promise.all(z).then((()=>{}))}))}_loadTransparentPropertiesAsync(e,E,H,N){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const u=H;if(u.subSurface.isRefractionEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.useAlbedoToTintRefraction=!0,void 0===N.transmissionFactor)return u.subSurface.refractionIntensity=0,u.subSurface.isRefractionEnabled=!1,Promise.resolve();{var z;u.subSurface.refractionIntensity=N.transmissionFactor;const e=u.fe();if(u.subSurface.refractionIntensity&&!e._transmissionHelper)new ce({},u.fe());else if(u.subSurface.refractionIntensity&&(null===(z=e._transmissionHelper)||void 0===z||!z._isRenderTargetValid())){var P;null===(P=e._transmissionHelper)||void 0===P||P._setupRenderTargets()}}return u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,N.transmissionTexture?(N.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,N.transmissionTexture,void 0).then((e=>{e.name=`${H.name} (Transmission)`,u.subSurface.refractionIntensityTexture=e,u.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}L(ne),T(ne,!0,(e=>new ge(e)));const xe="KHR_materials_diffuse_transmission";class eE{constructor(e){this.name=xe,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(xe),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadTranslucentPropertiesAsync(N,E,H,u)),await Promise.all(z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(e,E,H,N){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const u=H;if(u.subSurface.isTranslucencyEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,u.subSurface.useAlbedoToTintTranslucency=!1,void 0===N.diffuseTransmissionFactor)return u.subSurface.translucencyIntensity=0,u.subSurface.isTranslucencyEnabled=!1,Promise.resolve();u.subSurface.translucencyIntensity=N.diffuseTransmissionFactor;const P=new Array;return u.subSurface.useGltfStyleTextures=!0,N.diffuseTransmissionTexture&&(N.diffuseTransmissionTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,N.diffuseTransmissionTexture).then((e=>{e.name=`${H.name} (Diffuse Transmission)`,u.subSurface.translucencyIntensityTexture=e})))),void 0!==N.diffuseTransmissionColorFactor?u.subSurface.translucencyColor=z.XE.aE(N.diffuseTransmissionColorFactor):u.subSurface.translucencyColor=z.XE.White(),N.diffuseTransmissionColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,N.diffuseTransmissionColorTexture).then((e=>{e.name=`${H.name} (Diffuse Transmission Color)`,u.subSurface.translucencyColorTexture=e}))),Promise.all(P).then((()=>{}))}}L(xe),T(xe,!0,(e=>new eE(e)));const EE="KHR_materials_volume";class HE{constructor(e){this.name=EE,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(EE),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadVolumePropertiesAsync(N,E,H,u)),await Promise.all(z).then((()=>{}))}))}_loadVolumePropertiesAsync(e,E,H,N){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);if(!H.subSurface.isRefractionEnabled&&!H.subSurface.isTranslucencyEnabled||!N.thicknessFactor)return Promise.resolve();H.subSurface.volumeIndexOfRefraction=H.indexOfRefraction;const u=void 0!==N.attenuationDistance?N.attenuationDistance:Number.MAX_VALUE;return H.subSurface.tintColorAtDistance=u,void 0!==N.attenuationColor&&3==N.attenuationColor.length&&H.subSurface.tintColor.VM(N.attenuationColor[0],N.attenuationColor[1],N.attenuationColor[2]),H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=N.thicknessFactor,H.subSurface.useThicknessAsDepth=!0,N.thicknessTexture?(N.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,N.thicknessTexture).then((e=>{e.name=`${H.name} (Thickness)`,H.subSurface.thicknessTexture=e,H.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}L(EE),T(EE,!0,(e=>new HE(e)));const NE="KHR_materials_dispersion";class uE{constructor(e){this.name=NE,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(NE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadDispersionPropertiesAsync(N,E,H,u)),await Promise.all(z).then((()=>{}))}))}_loadDispersionPropertiesAsync(e,E,H,N){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);return H.subSurface.isRefractionEnabled&&N.dispersion?(H.subSurface.isDispersionEnabled=!0,H.subSurface.dispersion=N.dispersion,Promise.resolve()):Promise.resolve()}}L(NE),T(NE,!0,(e=>new uE(e)));const zE="EXT_materials_diffuse_roughness";class PE{constructor(e){this.name=zE,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(zE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(e,E,H)),z.push(this._loadDiffuseRoughnessPropertiesAsync(N,u,H)),await Promise.all(z).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(e,E,H){if(!(H instanceof a.b))throw new Error(`${e}: Material type not supported`);const N=new Array;return H.brdf.baseDiffuseModel=Qe.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=E.diffuseRoughnessFactor?H.baseDiffuseRoughness=E.diffuseRoughnessFactor:H.baseDiffuseRoughness=0,E.diffuseRoughnessTexture&&N.push(this._loader.loadTextureInfoAsync(`${e}/diffuseRoughnessTexture`,E.diffuseRoughnessTexture,(e=>{e.name=`${H.name} (Diffuse Roughness)`,H.baseDiffuseRoughnessTexture=e}))),Promise.all(N).then((()=>{}))}}L(zE),T(zE,!0,(e=>new PE(e)));const ME="KHR_mesh_quantization";class DE{constructor(e){this.name=ME,this.enabled=e.isExtensionUsed(ME)}dispose(){}}L(ME),T(ME,!0,(e=>new DE(e)));const AE="KHR_texture_basisu";class CE{constructor(e){this.name=AE,this._loader=e,this.enabled=e.isExtensionUsed(AE)}dispose(){this._loader=null}_loadTextureAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>{const z=void 0==E.sampler?k.DefaultSampler:Q.Get(`${e}/sampler`,this._loader.eM.samplers,E.sampler),P=Q.Get(`${N}/source`,this._loader.eM.images,u.source);return await this._loader._createTextureAsync(e,z,P,(e=>{H(e)}),E._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!E._textureInfo.nonColorData)}))}}L(AE),T(AE,!0,(e=>new CE(e)));const iE="KHR_texture_transform";class VE{constructor(e){this.name=iE,this._loader=e,this.enabled=this._loader.isExtensionUsed(iE)}dispose(){this._loader=null}loadTextureInfoAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(N,u)=>await this._loader.loadTextureInfoAsync(e,E,(e=>{if(!(e instanceof W.b))throw new Error(`${N}: Texture type not supported`);u.offset&&(e.uOffset=u.offset[0],e.vOffset=u.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,u.rotation&&(e.wAng=-u.rotation),u.scale&&(e.uScale=u.scale[0],e.vScale=u.scale[1]),void 0!=u.texCoord&&(e.coordinatesIndex=u.texCoord),H(e)}))))}}L(iE),T(iE,!0,(e=>new VE(e)));const UE="KHR_xmp_json_ld";class jE{constructor(e){this.name=UE,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(UE)}dispose(){this._loader=null}onLoading(){var e,E,H;if(null===this._loader.rootBabylonMesh)return;const N=null===(e=this._loader.eM.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld,u=null===(E=this._loader.eM.asset)||void 0===E||null===(H=E.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld;if(N&&u){const e=+u.packet;N.packets&&e<N.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=N.packets[e])}}}function FE(e,E,H,N){return z.XE.aE(E,H).scale(N)}function hE(e,E,H,N){return E[H]*N}function SE(e,E,H,N){return-E[H]*N}function XE(e,E,H,N){return E[H+1]*N}function aE(e,E,H,N){return E[H]*N*2}function WE(e){return{scale:[new YE(V.b.ANIMATIONTYPE_FLOAT,`${e}.uScale`,hE,(()=>2)),new YE(V.b.ANIMATIONTYPE_FLOAT,`${e}.vScale`,XE,(()=>2))],offset:[new YE(V.b.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,hE,(()=>2)),new YE(V.b.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,XE,(()=>2))],rotation:[new YE(V.b.ANIMATIONTYPE_FLOAT,`${e}.wAng`,SE,(()=>1))]}}L(UE),T(UE,!0,(e=>new jE(e)));class rE extends J.AnimationPropertyInfo{buildAnimations(e,E,H,N){return[{babylonAnimatable:e._babylonCamera,babylonAnimation:this._buildAnimation(E,H,N)}]}}class YE extends J.AnimationPropertyInfo{buildAnimations(e,E,H,N){const u=[];for(const z in e._data)u.push({babylonAnimatable:e._data[z].babylonMaterial,babylonAnimation:this._buildAnimation(E,H,N)});return u}}class fE extends J.AnimationPropertyInfo{buildAnimations(e,E,H,N){return[{babylonAnimatable:e._babylonLight,babylonAnimation:this._buildAnimation(E,H,N)}]}}(0,d.m)("/cameras/{}/orthographic/xmag",[new rE(V.b.ANIMATIONTYPE_FLOAT,"orthoLeft",SE,(()=>1)),new rE(V.b.ANIMATIONTYPE_FLOAT,"orthoRight",XE,(()=>1))]),(0,d.m)("/cameras/{}/orthographic/ymag",[new rE(V.b.ANIMATIONTYPE_FLOAT,"orthoBottom",SE,(()=>1)),new rE(V.b.ANIMATIONTYPE_FLOAT,"orthoTop",XE,(()=>1))]),(0,d.m)("/cameras/{}/orthographic/zfar",[new rE(V.b.ANIMATIONTYPE_FLOAT,"maxZ",hE,(()=>1))]),(0,d.m)("/cameras/{}/orthographic/znear",[new rE(V.b.ANIMATIONTYPE_FLOAT,"PM",hE,(()=>1))]),(0,d.m)("/cameras/{}/perspective/yfov",[new rE(V.b.ANIMATIONTYPE_FLOAT,"fov",hE,(()=>1))]),(0,d.m)("/cameras/{}/perspective/zfar",[new rE(V.b.ANIMATIONTYPE_FLOAT,"maxZ",hE,(()=>1))]),(0,d.m)("/cameras/{}/perspective/znear",[new rE(V.b.ANIMATIONTYPE_FLOAT,"PM",hE,(()=>1))]),(0,d.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new YE(V.b.ANIMATIONTYPE_COLOR3,"albedoColor",FE,(()=>4)),new YE(V.b.ANIMATIONTYPE_FLOAT,"alpha",(function(e,E,H,N){return E[H+3]*N}),(()=>4))]),(0,d.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"metallic",hE,(()=>1))]),(0,d.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"roughness",hE,(()=>1))]);const wE=WE("albedoTexture");(0,d.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",wE.scale),(0,d.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",wE.offset),(0,d.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",wE.rotation);const sE=WE("metallicTexture");(0,d.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",sE.scale),(0,d.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",sE.offset),(0,d.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",sE.rotation),(0,d.m)("/materials/{}/emissiveFactor",[new YE(V.b.ANIMATIONTYPE_COLOR3,"emissiveColor",FE,(()=>3))]);const pE=WE("bumpTexture");(0,d.m)("/materials/{}/normalTexture/scale",[new YE(V.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",hE,(()=>1))]),(0,d.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",pE.scale),(0,d.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",pE.offset),(0,d.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",pE.rotation),(0,d.m)("/materials/{}/occlusionTexture/strength",[new YE(V.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",hE,(()=>1))]);const oE=WE("ambientTexture");(0,d.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",oE.scale),(0,d.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",oE.offset),(0,d.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",oE.rotation);const yE=WE("emissiveTexture");(0,d.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",yE.scale),(0,d.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",yE.offset),(0,d.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",yE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new YE(V.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new YE(V.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",hE,(()=>1))]);const bE=WE("anisotropy.texture");(0,d.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",bE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",bE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",bE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",hE,(()=>1))]);const KE=WE("clearCoat.texture");(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",KE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",KE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",KE.rotation);const lE=WE("clearCoat.bumpTexture");(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new YE(V.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",lE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",lE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",lE.rotation);const OE=WE("clearCoat.textureRoughness");(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",OE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",OE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",OE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new YE(V.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new YE(V.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new YE(V.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new YE(V.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",hE,(()=>1))]);const vE=WE("iridescence.texture");(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",vE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",vE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",vE.rotation);const RE=WE("iridescence.thicknessTexture");(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",RE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",RE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",RE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new YE(V.b.ANIMATIONTYPE_COLOR3,"sheen.color",FE,(()=>3))]),(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",hE,(()=>1))]);const TE=WE("sheen.texture");(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",TE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",TE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",TE.rotation);const LE=WE("sheen.textureRoughness");(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",LE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",LE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",LE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new YE(V.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",FE,(()=>3))]);const dE=WE("metallicReflectanceTexture");(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",dE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",dE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",dE.rotation);const GE=WE("reflectanceTexture");(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",GE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",GE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",GE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",hE,(()=>1))]);const mH=WE("subSurface.refractionIntensityTexture");(0,d.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",mH.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",mH.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",mH.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new YE(V.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",FE,(()=>3))]),(0,d.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new YE(V.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",hE,(()=>1))]),(0,d.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",hE,(()=>1))]);const QE=WE("subSurface.thicknessTexture");(0,d.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",QE.scale),(0,d.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",QE.offset),(0,d.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",QE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new YE(V.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",hE,(()=>1))]);const ZE=WE("subSurface.translucencyIntensityTexture");(0,d.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ZE.scale),(0,d.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ZE.offset),(0,d.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ZE.rotation),(0,d.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new YE(V.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",FE,(()=>3))]);const kE=WE("subSurface.translucencyColorTexture");(0,d.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",kE.scale),(0,d.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",kE.offset),(0,d.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",kE.rotation),(0,d.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new fE(V.b.ANIMATIONTYPE_COLOR3,"diffuse",FE,(()=>3))]),(0,d.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new fE(V.b.ANIMATIONTYPE_FLOAT,"intensity",hE,(()=>1))]),(0,d.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new fE(V.b.ANIMATIONTYPE_FLOAT,"range",hE,(()=>1))]),(0,d.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new fE(V.b.ANIMATIONTYPE_FLOAT,"innerAngle",aE,(()=>1))]),(0,d.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new fE(V.b.ANIMATIONTYPE_FLOAT,"angle",aE,(()=>1))]),(0,d.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new fE(V.b.ANIMATIONTYPE_COLOR3,"diffuse",FE,(()=>3))]),(0,d.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new fE(V.b.ANIMATIONTYPE_FLOAT,"intensity",hE,(()=>1))]);const JE="KHR_animation_pointer";class BE{constructor(e){this.name=JE,this._loader=e,this._pathToObjectConverter=(0,d.l)(this._loader.eM)}get enabled(){return this._loader.isExtensionUsed(JE)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(e,E,H,N,u){var z;const P=null===(z=N.target.extensions)||void 0===z?void 0:z.KHR_animation_pointer;if(!P||!this._pathToObjectConverter)return null;"pointer"!==N.target.path&&F.d.Warn(`${e}/target/path: Value (${N.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=N.target.node&&F.d.Warn(`${e}/target/node: Value (${N.target.node}) must not be present when using the ${this.name} extension`);const M=`${e}/extensions/${this.name}`,D=P.pointer;if(!D)throw new Error(`${M}: Pointer is missing`);try{const z=this._pathToObjectConverter.convert(D);if(!z.info.interpolation)throw new Error(`${M}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,E,H,N,{object:z.object,info:z.info.interpolation},u)}catch(A){return F.d.Warn(`${M}/pointer: Invalid pointer (${D}) skipped`),null}}}L(JE),T(JE,!0,(e=>new BE(e)));class IE{constructor(e,E,H){this.frame=e,this.action=E,this.onlyOnce=H,this.isDone=!1}_clone(){return new IE(this.frame,this.action,this.onlyOnce)}}var tE=H(11565),qE=H(11618),cE=H(11611);class nE{get loop(){return this._loop}set loop(e){e!==this._loop&&(this._loop=e,this.updateOptions({loop:e}))}get currentTime(){var e;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(e=qE.c.audioEngine)&&void 0!==e&&e.audioContext&&(this.isPlaying||this.isPaused)){const e=this.isPaused?0:qE.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+e}return 0}get spatialSound(){return this._spatialSound}set spatialSound(e){if(e==this._spatialSound)return;const E=this.isPlaying;this.pause(),e?(this._spatialSound=e,this._updateSpatialParameters()):this._disableSpatialSound(),E&&this.play()}constructor(e,E,H){var N;let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new C.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=u.jE.Zero(),this._localDirection=new u.jE(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=e,H=H||j.d.LastCreatedScene)if(this._scene=H,nE._SceneComponentInitialization(H),this._readyToPlayCallback=z,this._customAttenuationFunction=(e,E,H,N,u)=>E<H?e*(1-E/H):0,M&&(this.autoplay=M.autoplay||!1,this._loop=M.loop||!1,void 0!==M.volume&&(this._volume=M.volume),this._spatialSound=M.spatialSound??!1,this.maxDistance=M.maxDistance??100,this.useCustomAttenuation=M.useCustomAttenuation??!1,this.rolloffFactor=M.rolloffFactor||1,this.refDistance=M.refDistance||1,this.distanceModel=M.distanceModel||"linear",this._playbackRate=M.playbackRate||1,this._streaming=M.streaming??!1,this._length=M.length,this._offset=M.offset),null!==(N=qE.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&qE.c.audioEngine.audioContext){this._soundGain=qE.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let e=!0;if(E)try{"string"===typeof E?(this._urlType="String",this._url=E):E instanceof ArrayBuffer?this._urlType="ArrayBuffer":E instanceof HTMLMediaElement?this._urlType="MediaElement":E instanceof MediaStream?this._urlType="MediaStream":E instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(E)&&(this._urlType="Array");let H=[],N=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=qE.c.audioEngine.audioContext.createMediaElementSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=qE.c.audioEngine.audioContext.createMediaStreamSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":E.byteLength>0&&(N=!0,this._soundLoaded(E));break;case"AudioBuffer":this._audioBufferLoaded(E);break;case"String":H.push(E);case"Array":0===H.length&&(H=E);for(let e=0;e<H.length;e++){const E=H[e];if(N=M&&M.skipCodecCheck||-1!==E.indexOf(".mp3",E.length-4)&&qE.c.audioEngine.isMP3supported||-1!==E.indexOf(".ogg",E.length-4)&&qE.c.audioEngine.isOGGsupported||-1!==E.indexOf(".wav",E.length-4)||-1!==E.indexOf(".m4a",E.length-4)||-1!==E.indexOf(".mp4",E.length-4)||-1!==E.indexOf("blob:"),N){this._streaming?(this._htmlAudioElement=new Audio(E),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,P.Tools.SetCorsBehavior(E,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(E,(e=>{this._soundLoaded(e)}),void 0,!0,!0,(e=>{e&&F.d.Error("XHR "+e.status+" error on: "+E+"."),F.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:e=!1}e?N||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):F.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(D){F.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),qE.c.audioEngine&&!qE.c.audioEngine.WarnedWebAudioUnsupported&&(F.d.Error("Web Audio is not supported by your browser."),qE.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var e;null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(e){var E;null!==(E=qE.c.audioEngine)&&void 0!==E&&E.audioContext&&(this._audioBuffer=e,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(e){var E;null!==(E=qE.c.audioEngine)&&void 0!==E&&E.audioContext&&qE.c.audioEngine.audioContext.decodeAudioData(e,(e=>{this._audioBufferLoaded(e)}),(e=>{F.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+e)}))}setAudioBuffer(e){var E;null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)}updateOptions(e){e&&(this.loop=e.loop??this.loop,this.maxDistance=e.maxDistance??this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor??this.rolloffFactor,this.refDistance=e.refDistance??this.refDistance,this.distanceModel=e.distanceModel??this.distanceModel,this._playbackRate=e.playbackRate??this._playbackRate,this._length=e.length??void 0,this.spatialSound=e.spatialSound??this._spatialSound,this._setOffset(e.offset??void 0),this.setVolume(e.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var e;null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&qE.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??qE.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var e;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(e=this._soundPanner)||void 0===e||e.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var e;null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(e){var E;null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)}setDirectionalCone(e,E,H){E<e?F.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=E,this._coneOuterGain=H,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(e){if(e!=this._coneInnerAngle){var E;if(this._coneOuterAngle<e)return void F.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(e){if(e!=this._coneOuterAngle){var E;if(e<this._coneInnerAngle)return void F.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(e){var E;e.equals(this._position)||(this._position.P(e),null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(e){var E;this._localDirection=e,null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const e=this._connectedTransformNode.getWorldMatrix(),E=u.jE.TransformNormal(this._localDirection,e);E.normalize(),this._soundPanner.orientationX.value=E.x,this._soundPanner.orientationY.value=E.y,this._soundPanner.orientationZ.value=E.z}updateDistanceFromListener(){var e;if(null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const e=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.FE(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(e){this._customAttenuationFunction=e}play(e,E,H){var N;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(N=qE.c.audioEngine)&&void 0!==N&&N.audioContext)try{var u,z;this._clearTimeoutsAndObservers();let N=e?(null===(u=qE.c.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+e:null===(z=qE.c.audioEngine)||void 0===z?void 0:z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=qE.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const e=()=>{var H;if(null!==(H=qE.c.audioEngine)&&void 0!==H&&H.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=E??0;const H=this._htmlAudioElement.play();void 0!==H&&H.catch((()=>{var E,H;(null===(E=qE.c.audioEngine)||void 0===E||E.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(H=qE.c.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{e()})))}))}else{var N;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(N=qE.c.audioEngine)||void 0===N?void 0:N.onAudioUnlockedObservable.addOnce((()=>{e()}))}};e()}}else{var P;const u=()=>{var u;if(null!==(u=qE.c.audioEngine)&&void 0!==u&&u.audioContext){var z;if(H=H||this._length,void 0!==E&&this._setOffset(E),this._soundSource){const e=this._soundSource;e.onended=()=>{e.disconnect()}}if(this._soundSource=null===(z=qE.c.audioEngine)||void 0===z?void 0:z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var P;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==E&&(this._soundSource.loopStart=E),void 0!==H&&(this._soundSource.loopEnd=(0|E)+H),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},N=e?(null===(P=qE.c.audioEngine)||void 0===P?void 0:P.audioContext.currentTime)+e:qE.c.audioEngine.audioContext.currentTime;const u=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(N,u,this.loop?void 0:H)}}};"suspended"===(null===(P=qE.c.audioEngine)||void 0===P?void 0:P.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var e;"suspended"===(null===(e=qE.c.audioEngine)||void 0===e?void 0:e.audioContext.state)?(qE.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=qE.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{u()})))):u()}),500):u()}this._startTime=N,this.isPlaying=!0,this.isPaused=!1}catch(M){F.d.Error("Error while trying to play audio: "+this.name+", "+M.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(e){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1}else if(null!==(E=qE.c.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource){const E=e?qE.c.audioEngine.audioContext.currentTime+e:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(E)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var e;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var E;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(E=this._streamingSource)||void 0===E||E.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(e=qE.c.audioEngine)&&void 0!==e&&e.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=qE.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(e,E){var H;null!==(H=qE.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._soundGain&&(E&&qE.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(qE.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,qE.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,qE.c.audioEngine.audioContext.currentTime+E)):this._soundGain.gain.value=e),this._volume=e}setPlaybackRate(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(e){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=e=>this._onRegisterAfterWorldMatrixUpdate(e),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(e){var E;if(e.getBoundingInfo){const E=e.getBoundingInfo();this.setPosition(E.boundingSphere.centerWorld)}else this.setPosition(e.absolutePosition);null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const e=()=>{(0,cE.f)((()=>this._isReadyToPlay),(()=>{H._audioBuffer=this.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,this._offset,this._length)}),void 0,300)},E={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},H=new nE(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,E);return this.useCustomAttenuation&&H.setAttenuationFunction(this._customAttenuationFunction),H.setPosition(this._position),H.setPlaybackRate(this._playbackRate),e(),H}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const e={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.uM(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.uM(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e}static Parse(e,E,H,N){const z=e.name;let P;P=e.url?H+e.url:H+z;const M={autoplay:e.autoplay,loop:e.loop,volume:e.volume,spatialSound:e.spatialSound,maxDistance:e.maxDistance,rolloffFactor:e.rolloffFactor,refDistance:e.refDistance,distanceModel:e.distanceModel,playbackRate:e.playbackRate};let D;if(N){const e=()=>{(0,cE.f)((()=>N._isReadyToPlay),(()=>{D._audioBuffer=N.getAudioBuffer(),D._isReadyToPlay=!0,D.autoplay&&D.play(0,D._offset,D._length)}),void 0,300)};D=new nE(z,new ArrayBuffer(0),E,null,M),e()}else D=new nE(z,P,E,(()=>{E.removePendingData(D)}),M),E.addPendingData(D);if(e.position){const E=u.jE.aE(e.position);D.setPosition(E)}if(e.isDirectional&&(D.setDirectionalCone(e.coneInnerAngle||360,e.coneOuterAngle||360,e.coneOuterGain||0),e.localDirectionToMesh)){const E=u.jE.aE(e.localDirectionToMesh);D.setLocalDirectionToMesh(E)}if(e.connectedMeshId){const H=E.getMeshById(e.connectedMeshId);H&&D.attachToMesh(H)}return e.metadata&&(D.metadata=e.metadata),D}_setOffset(e){this._offset!==e&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=e)}_clearTimeoutsAndObservers(){var e;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(e=qE.c.audioEngine)||void 0===e||e.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}nE._SceneComponentInitialization=e=>{throw(0,tE.b)("AudioSceneComponent")},(0,Ye.g)("BABYLON.Sound",nE);class gE{constructor(e,E,H){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],E.length!==H.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=H;let N=0;for(const z of H)N+=z;const u=N>0?1/N:0;for(let z=0;z<this._weights.length;z++)this._weights[z]*=u;this._sounds=E;for(const z of this._sounds)z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e)return void F.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e;for(const E of this._sounds)E.directionalConeInnerAngle=e}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle)return void F.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e;for(const E of this._sounds)E.directionalConeOuterAngle=e}}get volume(){return this._volume}set volume(e){if(e!==this._volume)for(const E of this._sounds)E.setVolume(e)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(e){if(!this.isPaused){this.stop();const e=Math.random();let E=0;for(let H=0;H<this._weights.length;H++)if(E+=this._weights[H],e<=E){this._currentIndex=H;break}}const E=this._sounds[this._currentIndex??0];E.isReady()?E.play(0,this.isPaused?void 0:e):E.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class xE{constructor(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(e=e||j.d.LastCreatedScene)&&(this._scene=e,this.soundCollection=[],this._options=E,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var e;null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&qE.c.audioEngine.audioContext&&(this._outputAudioNode=qE.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(qE.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(qE.c.audioEngine&&qE.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(e){var E;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&e.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.removeSound(e):this._scene.soundTracks&&this._scene.soundTracks[e.soundTrackId].removeSound(e)),this.soundCollection.push(e),e.soundTrackId=this.id}removeSound(e){const E=this.soundCollection.indexOf(e);-1!==E&&this.soundCollection.splice(E,1)}setVolume(e){var E;null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=e)}switchPanningModelToHRTF(){var e;if(null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var e;if(null!==(e=qE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToEqualPower()}connectToAnalyser(e){var E;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,null!==(E=qE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,qE.c.audioEngine.masterGain))}}var eH=H(11991),EH=H(11967),HH=H(11546);qE.c.AudioEngineFactory=(e,E,H)=>new NH(e,E,H);class NH{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new C.d,this.onAudioLockedObservable=new C.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,HH.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const N=document.createElement("audio");this._hostElement=e,this._audioContext=E,this._audioDestination=H;try{N&&N.canPlayType&&(N.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||N.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(u){}try{N&&N.canPlayType&&N.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(u){}}lock(){this._triggerSuspendedState()}unlock(){var e,E;if("running"===(null===(e=this._audioContext)||void 0===e?void 0:e.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(E=this._audioContext)||void 0===E||E.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{F.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var e;null===(e=this._audioContext)||void 0===e||e.addEventListener("statechange",(()=>{var e;this.unlocked&&"running"!==(null===(e=this._audioContext)||void 0===e?void 0:e.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var e;return null!==(e=this._audioContext)&&void 0!==e&&e.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(e){this.canUseWebAudio=!1,F.d.Error("Web Audio: "+e.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(e){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",E=document.createElement("style");E.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(E),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var e;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(e=this._audioContext)||void 0===e||e.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var uH=H(11559);(0,H(13103).e)(eH.c.NAME_AUDIO,((e,E,H,N)=>{let u,z=[];if(H.pV=H.pV||[],void 0!==e.pV&&null!==e.pV)for(let M=0,D=e.pV.length;M<D;M++){var P;const D=e.pV[M];null!==(P=qE.c.audioEngine)&&void 0!==P&&P.canUseWebAudio?(D.url||(D.url=D.name),z[D.url]?H.pV.push(nE.Parse(D,E,N,z[D.url])):(u=nE.Parse(D,E,N),z[D.url]=u,H.pV.push(u))):H.pV.push(new nE(D.name,null,E))}z=[]})),Object.defineProperty(EH.c.prototype,"mainSoundTrack",{get:function(){let e=this._getComponent(eH.c.NAME_AUDIO);return e||(e=new zH(this),this.o(e)),this._mainSoundTrack||(this._mainSoundTrack=new xE(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),EH.c.prototype.getSoundByName=function(e){let E;for(E=0;E<this.mainSoundTrack.soundCollection.length;E++)if(this.mainSoundTrack.soundCollection[E].name===e)return this.mainSoundTrack.soundCollection[E];if(this.soundTracks)for(let H=0;H<this.soundTracks.length;H++)for(E=0;E<this.soundTracks[H].soundCollection.length;E++)if(this.soundTracks[H].soundCollection[E].name===e)return this.soundTracks[H].soundCollection[E];return null},Object.defineProperty(EH.c.prototype,"audioEnabled",{get:function(){let e=this._getComponent(eH.c.NAME_AUDIO);return e||(e=new zH(this),this.o(e)),e.audioEnabled},set:function(e){let E=this._getComponent(eH.c.NAME_AUDIO);E||(E=new zH(this),this.o(E)),e?E.enableAudio():E.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(EH.c.prototype,"headphone",{get:function(){let e=this._getComponent(eH.c.NAME_AUDIO);return e||(e=new zH(this),this.o(e)),e.headphone},set:function(e){let E=this._getComponent(eH.c.NAME_AUDIO);E||(E=new zH(this),this.o(E)),e?E.switchAudioModeForHeadphones():E.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(EH.c.prototype,"audioListenerPositionProvider",{get:function(){let e=this._getComponent(eH.c.NAME_AUDIO);return e||(e=new zH(this),this.o(e)),e.audioListenerPositionProvider},set:function(e){let E=this._getComponent(eH.c.NAME_AUDIO);if(E||(E=new zH(this),this.o(E)),e&&"function"!==typeof e)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");E.audioListenerPositionProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(EH.c.prototype,"audioListenerRotationProvider",{get:function(){let e=this._getComponent(eH.c.NAME_AUDIO);return e||(e=new zH(this),this.o(e)),e.audioListenerRotationProvider},set:function(e){let E=this._getComponent(eH.c.NAME_AUDIO);if(E||(E=new zH(this),this.o(E)),e&&"function"!==typeof e)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");E.audioListenerRotationProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(EH.c.prototype,"audioPositioningRefreshRate",{get:function(){let e=this._getComponent(eH.c.NAME_AUDIO);return e||(e=new zH(this),this.o(e)),e.audioPositioningRefreshRate},set:function(e){let E=this._getComponent(eH.c.NAME_AUDIO);E||(E=new zH(this),this.o(E)),E.audioPositioningRefreshRate=e},enumerable:!0,configurable:!0});class zH{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(e){this.name=eH.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new u.jE,this._cachedCameraPosition=new u.jE,this._lastCheck=0,this._invertMatrixTemp=new u.Matrix,this._cameraDirectionTemp=new u.jE,(e=e||j.d.LastCreatedScene)&&(this.hE=e,e.soundTracks=[],e.pV=[])}register(){this.hE._afterRenderStage.registerStep(eH.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(e){if(e.pV=[],this.hE.soundTracks)for(let E=0;E<this.hE.soundTracks.length;E++){const H=this.hE.soundTracks[E];for(let E=0;E<H.soundCollection.length;E++)e.pV.push(H.soundCollection[E].serialize())}}addFromContainer(e){if(e.pV)for(const E of e.pV)E.play(),E.autoplay=!0,this.hE.mainSoundTrack.addSound(E)}removeFromContainer(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.pV)for(const H of e.pV)H.stop(),H.autoplay=!1,this.hE.mainSoundTrack.removeSound(H),E&&H.dispose()}dispose(){const e=this.hE;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(let E=0;E<e.soundTracks.length;E++)e.soundTracks[E].dispose()}disableAudio(){const e=this.hE;let E;for(this._audioEnabled=!1,qE.c.audioEngine&&qE.c.audioEngine.audioContext&&qE.c.audioEngine.audioContext.suspend(),E=0;E<e.mainSoundTrack.soundCollection.length;E++)e.mainSoundTrack.soundCollection[E].pause();if(e.soundTracks)for(E=0;E<e.soundTracks.length;E++)for(let H=0;H<e.soundTracks[E].soundCollection.length;H++)e.soundTracks[E].soundCollection[H].pause()}enableAudio(){const e=this.hE;let E;for(this._audioEnabled=!0,qE.c.audioEngine&&qE.c.audioEngine.audioContext&&qE.c.audioEngine.audioContext.resume(),E=0;E<e.mainSoundTrack.soundCollection.length;E++)e.mainSoundTrack.soundCollection[E].isPaused&&e.mainSoundTrack.soundCollection[E].play();if(e.soundTracks)for(E=0;E<e.soundTracks.length;E++)for(let H=0;H<e.soundTracks[E].soundCollection.length;H++)e.soundTracks[E].soundCollection[H].isPaused&&e.soundTracks[E].soundCollection[H].play()}switchAudioModeForHeadphones(){const e=this.hE;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(let E=0;E<e.soundTracks.length;E++)e.soundTracks[E].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const e=this.hE;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(let E=0;E<e.soundTracks.length;E++)e.soundTracks[E].switchPanningModelToEqualPower()}_afterRender(){const e=uH.d.Now;if(this._lastCheck&&e-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=e;const E=this.hE;if(!this._audioEnabled||!E._mainSoundTrack||!E.soundTracks||0===E._mainSoundTrack.soundCollection.length&&1===E.soundTracks.length)return;const H=qE.c.audioEngine;if(H&&H.audioContext){let e,N=E.activeCamera;if(E.activeCameras&&E.activeCameras.length>0&&(N=E.activeCameras[0]),this.audioListenerPositionProvider){const e=this.audioListenerPositionProvider();H.audioContext.listener.setPosition(e.x||0,e.y||0,e.z||0)}else N?this._cachedCameraPosition.equals(N.globalPosition)||(this._cachedCameraPosition.P(N.globalPosition),H.audioContext.listener.setPosition(N.globalPosition.x,N.globalPosition.y,N.globalPosition.z)):H.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const e=this.audioListenerRotationProvider();H.audioContext.listener.setOrientation(e.x||0,e.y||0,e.z||0,0,1,0)}else N?(N.rigCameras&&N.rigCameras.length>0&&(N=N.rigCameras[0]),N.getViewMatrix().invertToRef(this._invertMatrixTemp),u.jE.TransformNormalToRef(zH._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.P(this._cameraDirectionTemp),H.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):H.audioContext.listener.setOrientation(0,0,0,0,1,0);for(e=0;e<E.mainSoundTrack.soundCollection.length;e++){const H=E.mainSoundTrack.soundCollection[e];H.useCustomAttenuation&&H.updateDistanceFromListener()}if(E.soundTracks)for(e=0;e<E.soundTracks.length;e++)for(let H=0;H<E.soundTracks[e].soundCollection.length;H++){const N=E.soundTracks[e].soundCollection[H];N.useCustomAttenuation&&N.updateDistanceFromListener()}}}}zH._CameraDirection=new u.jE(0,0,-1),nE._SceneComponentInitialization=e=>{let E=e._getComponent(eH.c.NAME_AUDIO);E||(E=new zH(e),e.o(E))};const PH="MSFT_audio_emitter";class MH{constructor(e){this.name=PH,this._loader=e,this.enabled=this._loader.isExtensionUsed(PH)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const e=this._loader.eM.extensions;if(e&&e[this.name]){const E=e[this.name];this._clips=E.clips,this._emitters=E.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(e,E){return k.LoadExtensionAsync(e,E,this.name,(async(H,N)=>{const u=new Array;u.push(this._loader.loadSceneAsync(e,E));for(const e of N.emitters){const E=Q.Get(`${H}/emitters`,this._emitters,e);if(void 0!=E.refDistance||void 0!=E.maxDistance||void 0!=E.rolloffFactor||void 0!=E.distanceModel||void 0!=E.innerAngle||void 0!=E.outerAngle)throw new Error(`${H}: Direction or Distance properties are not allowed on emitters attached to a scene`);u.push(this._loadEmitterAsync(`${H}/emitters/${E.index}`,E))}await Promise.all(u)}))}loadNodeAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(e,N)=>{const z=new Array,M=await this._loader.loadNodeAsync(e,E,(E=>{for(const H of N.emitters){const N=Q.Get(`${e}/emitters`,this._emitters,H);z.push(this._loadEmitterAsync(`${e}/emitters/${N.index}`,N).then((()=>{for(const e of N._babylonSounds)e.attachToMesh(E),void 0==N.innerAngle&&void 0==N.outerAngle||(e.setLocalDirectionToMesh(u.jE.Forward()),e.setDirectionalCone(2*P.Tools.ToDegrees(void 0==N.innerAngle?Math.PI:N.innerAngle),2*P.Tools.ToDegrees(void 0==N.outerAngle?Math.PI:N.outerAngle),0))})))}H(E)}));return await Promise.all(z),M}))}loadAnimationAsync(e,E){return k.LoadExtensionAsync(e,E,this.name,(async(H,N)=>{const u=await this._loader.loadAnimationAsync(e,E),z=new Array;Q.Assign(N.events);for(const P of N.events)z.push(this._loadAnimationEventAsync(`${H}/events/${P.index}`,e,E,P,u));return await Promise.all(z),u}))}_loadClipAsync(e,E){if(E._objectURL)return E._objectURL;let H;if(E.uri)H=this._loader.loadUriAsync(e,E,E.uri);else{const N=Q.Get(`${e}/bufferView`,this._loader.eM.bufferViews,E.bufferView);H=this._loader.loadBufferViewAsync(`/bufferViews/${N.index}`,N)}return E._objectURL=H.then((e=>URL.createObjectURL(new Blob([e],{type:E.mimeType})))),E._objectURL}_loadEmitterAsync(e,E){if(E._babylonSounds=E._babylonSounds||[],!E._babylonData){const e=new Array,H=E.name||`emitter${E.index}`,N={loop:!1,autoplay:!1,volume:void 0==E.volume?1:E.volume};for(let z=0;z<E.clips.length;z++){const u=`/extensions/${this.name}/clips`,P=Q.Get(u,this._clips,E.clips[z].clip);e.push(this._loadClipAsync(`${u}/${E.clips[z].clip}`,P).then((e=>{const u=E._babylonSounds[z]=new nE(H,e,this._loader.babylonScene,null,N);u.refDistance=E.refDistance||1,u.maxDistance=E.maxDistance||256,u.rolloffFactor=E.rolloffFactor||1,u.distanceModel=E.distanceModel||"exponential"})))}const u=Promise.all(e).then((()=>{const e=E.clips.map((e=>e.weight||1)),H=new gE(E.loop||!1,E._babylonSounds,e);E.innerAngle&&(H.directionalConeInnerAngle=2*P.Tools.ToDegrees(E.innerAngle)),E.outerAngle&&(H.directionalConeOuterAngle=2*P.Tools.ToDegrees(E.outerAngle)),E.volume&&(H.volume=E.volume),E._babylonData.sound=H}));E._babylonData={loaded:u}}return E._babylonData.loaded}_getEventAction(e,E,H,N,u){switch(H){case"play":return e=>{const H=(u||0)+(e-N);E.play(H)};case"stop":return()=>{E.stop()};case"pause":return()=>{E.pause()};default:throw new Error(`${e}: Unsupported action ${H}`)}}_loadAnimationEventAsync(e,E,H,N,u){if(0==u.targetedAnimations.length)return Promise.resolve();const z=u.targetedAnimations[0],P=N.NE,M=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,P);return this._loadEmitterAsync(e,M).then((()=>{const E=M._babylonData.sound;if(E){const H=new IE(N.time,this._getEventAction(e,E,N.action,N.time,N.startOffset));z.animation.addEvent(H),u.onAnimationGroupEndObservable.add((()=>{E.stop()})),u.onAnimationGroupPauseObservable.add((()=>{E.pause()}))}}))}}L(PH),T(PH,!0,(e=>new MH(e)));const DH="MSFT_lod";class AH{constructor(e){var E;this.name=DH,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new C.d,this.onMaterialLODsLoadedObservable=new C.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=(null===(E=this._loader.parent.extensionOptions[DH])||void 0===E?void 0:E.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(DH)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const E=Promise.all(this._nodePromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())}));this._loader._completePromises.push(E)}for(let e=0;e<this._materialPromiseLODs.length;e++){const E=Promise.all(this._materialPromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())}));this._loader._completePromises.push(E)}}loadSceneAsync(e,E){const H=this._loader.loadSceneAsync(e,E);return this._loadBufferLOD(this._bufferLODs,0),H}loadNodeAsync(e,E,H){return k.LoadExtensionAsync(e,E,this.name,(async(e,u)=>{let z;const P=this._getLODs(e,E,this._loader.eM.nodes,u.ids);this._loader.logOpen(`${e}`);for(let E=0;E<P.length;E++){const e=P[E];0!==E&&(this._nodeIndexLOD=E,this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new N);const u=e=>{H(e),e.LM(!1)},M=this._loader.loadNodeAsync(`/nodes/${e.index}`,e,u).then((e=>{if(0!==E){const e=P[E-1];e._babylonTransformNode&&(this._disposeTransformNode(e._babylonTransformNode),delete e._babylonTransformNode)}return e.LM(!0),e}));this._nodePromiseLODs[E]=this._nodePromiseLODs[E]||[],0===E?z=M:(this._nodeIndexLOD=null,this._nodePromiseLODs[E].push(M))}return this._loader.logClose(),await z}))}_loadMaterialAsync(e,E,H,N,u){return this._nodeIndexLOD?null:k.LoadExtensionAsync(e,E,this.name,(async(e,z)=>{let P;const M=this._getLODs(e,E,this._loader.eM.materials,z.ids);this._loader.logOpen(`${e}`);for(let E=0;E<M.length;E++){const e=M[E];0!==E&&(this._materialIndexLOD=E);const z=this._loader._loadMaterialAsync(`/materials/${e.index}`,e,H,N,(e=>{0===E&&u(e)})).then((e=>{if(0!==E){u(e);const H=M[E-1]._data;H[N]&&(this._disposeMaterials([H[N].babylonMaterial]),delete H[N])}return e}));this._materialPromiseLODs[E]=this._materialPromiseLODs[E]||[],0===E?P=z:(this._materialIndexLOD=null,this._materialPromiseLODs[E].push(z))}return this._loader.logClose(),await P}))}_loadUriAsync(e,E,H){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const u=this._nodeIndexLOD-1;return this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new N,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(e,E,H)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const u=this._materialIndexLOD-1;return this._materialSignalLODs[u]=this._materialSignalLODs[u]||new N,this._materialSignalLODs[u].promise.then((async()=>await this._loader.loadUriAsync(e,E,H)))}return null}loadBufferAsync(e,E,H,u){if(this._loader.parent.useRangeRequests&&!E.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const E=async(e,E)=>{const z=H,P=z+u-1;let M=e[E];return M?(M.start=Math.min(M.start,z),M.end=Math.max(M.end,P)):(M={start:z,end:P,loaded:new N},e[E]=M),await M.loaded.promise.then((e=>new Uint8Array(e.buffer,e.byteOffset+H-M.start,u)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?E(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?E(this._materialBufferLODs,this._materialIndexLOD):E(this._bufferLODs,0)}return null}_loadBufferLOD(e,E){const H=e[E];H&&(this._loader.log(`Loading buffer range [${H.start}-${H.end}]`),this._loader.bin.readAsync(H.start,H.end-H.start+1).then((e=>{H.loaded.resolve(e)}),(e=>{H.loaded.reject(e)})))}_getLODs(e,E,H,N){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const u=[];for(let z=N.length-1;z>=0;z--)if(u.push(Q.Get(`${e}/ids/${N[z]}`,H,N[z])),u.length===this.maxLODsToLoad)return u;return u.push(E),u}_disposeTransformNode(e){const E=[],H=e.material;H&&E.push(H);for(const u of e.getChildMeshes())u.material&&E.push(u.material);e.dispose();const N=E.filter((e=>this._loader.babylonScene.meshes.every((E=>E.material!=e))));this._disposeMaterials(N)}_disposeMaterials(e){const E={};for(const H of e){for(const e of H.getActiveTextures())E[e.uniqueId]=e;H.dispose()}for(const H in E)for(const e of this._loader.babylonScene.materials)e.hasTexture(E[H])&&delete E[H];for(const H in E)E[H].dispose()}}L(DH),T(DH,!0,(e=>new AH(e)));const CH="MSFT_minecraftMesh";class iH{constructor(e){this.name=CH,this._loader=e,this.enabled=this._loader.isExtensionUsed(CH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtraAsync(e,E,this.name,(async(N,u)=>{if(u){if(!(H instanceof a.b))throw new Error(`${N}: Material type not supported`);const u=this._loader.loadMaterialPropertiesAsync(e,E,H);return H.needAlphaBlending()&&(H.forceDepthWrite=!0,H.separateCullingPass=!0),H.iM=H.forceDepthWrite,H.twoSidedLighting=!0,await u}}))}}L(CH),T(CH,!0,(e=>new iH(e)));const VH="MSFT_sRGBFactors";class UH{constructor(e){this.name=VH,this._loader=e,this.enabled=this._loader.isExtensionUsed(VH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,E,H){return k.LoadExtraAsync(e,E,this.name,(async(N,u)=>{if(u){if(!(H instanceof a.b))throw new Error(`${N}: Material type not supported`);const u=this._loader.loadMaterialPropertiesAsync(e,E,H),z=H.fe().getEngine().useExactSrgbConversions;return H.albedoTexture||H.albedoColor.toLinearSpaceToRef(H.albedoColor,z),H.reflectivityTexture||H.reflectivityColor.toLinearSpaceToRef(H.reflectivityColor,z),await u}}))}}L(VH),T(VH,!0,(e=>new UH(e)));var jH=H(13395);const FH={};var hH=H(13464),SH=H(13432),XH=H(13404),aH=H(13415);function WH(e,E){for(const H of e)for(const e of H.dataOutputs)if(e.uniqueId===E)return e;throw new Error("Could not find data out connection with unique id "+E)}function rH(e,E){for(const H of e)if(H instanceof SH.b)for(const e of H.signalInputs)if(e.uniqueId===E)return e;throw new Error("Could not find signal in connection with unique id "+E)}async function YH(e,E){const N=await Promise.all(e.allBlocks.map((async e=>{const E=function(e){switch(e){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([H.e(78),H.e(79)]).then(H.bind(H,14840))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await H.e(80).then(H.bind(H,14848))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await H.e(81).then(H.bind(H,14852))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await H.e(82).then(H.bind(H,14855))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await H.e(83).then(H.bind(H,14858))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await H.e(84).then(H.bind(H,14865))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await H.e(85).then(H.bind(H,14873))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await H.e(86).then(H.bind(H,14875))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await H.e(87).then(H.bind(H,14880))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await H.e(90).then(H.bind(H,14911))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await H.e(90).then(H.bind(H,14911))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await H.e(90).then(H.bind(H,14911))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await H.e(90).then(H.bind(H,14911))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await H.e(95).then(H.bind(H,14918))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await H.e(96).then(H.bind(H,14922))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await H.e(97).then(H.bind(H,14925))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await H.e(98).then(H.bind(H,14933))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await H.e(99).then(H.bind(H,14937))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await H.e(100).then(H.bind(H,14944))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await H.e(101).then(H.bind(H,14953))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await H.e(102).then(H.bind(H,14958))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await H.e(103).then(H.bind(H,14962))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await H.e(104).then(H.bind(H,14971))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await H.e(105).then(H.bind(H,14976))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await H.e(106).then(H.bind(H,14978))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await H.e(107).then(H.bind(H,14984))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await H.e(108).then(H.bind(H,14989))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await H.e(109).then(H.bind(H,14993))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await H.e(110).then(H.bind(H,15002))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await H.e(111).then(H.bind(H,15009))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await H.e(112).then(H.bind(H,15013))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await H.e(113).then(H.bind(H,15021))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await H.e(92).then(H.bind(H,15025))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await H.e(114).then(H.bind(H,15029))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await H.e(115).then(H.bind(H,15033))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await H.e(116).then(H.bind(H,15040))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await H.e(93).then(H.bind(H,15049))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await H.e(88).then(H.bind(H,14887))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await H.e(94).then(H.bind(H,15055))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await H.e(89).then(H.bind(H,14906))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await H.e(90).then(H.bind(H,14911))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await H.e(90).then(H.bind(H,14911))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await H.e(91).then(H.bind(H,15064))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await H.e(91).then(H.bind(H,15064))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await H.e(91).then(H.bind(H,15064))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await H.e(91).then(H.bind(H,15064))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await H.e(91).then(H.bind(H,15064))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await H.e(91).then(H.bind(H,15064))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await H.e(117).then(H.bind(H,15069))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await H.e(118).then(H.bind(H,15075))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await H.e(119).then(H.bind(H,15078))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await H.e(120).then(H.bind(H,15082))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await H.e(121).then(H.bind(H,15091))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await H.e(122).then(H.bind(H,15097))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await H.e(123).then(H.bind(H,15106))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await H.e(124).then(H.bind(H,15110))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await H.e(125).then(H.bind(H,15114))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await H.e(126).then(H.bind(H,15119))).FlowGraphDataSwitchBlock;default:if(FH[e])return FH[e];throw new Error(`Unknown block name ${e}`)}}(e.className);return await E()})));return function(e,E,H){const N=E.coordinator.createGraph(),u=[],z=E.valueParseFunction??XH.c;for(let P=0;P<e.allBlocks.length;P++){const M=wH(e.allBlocks[P],{hE:E.coordinator.config.hE,pathConverter:E.pathConverter,assetsContainer:E.coordinator.config.hE,valueParseFunction:z},H[P]);u.push(M),M instanceof hH.b&&N.addEventBlock(M)}for(const P of u){for(const e of P.dataInputs)for(const E of e.connectedPointIds){const H=WH(u,E);e.connectTo(H)}if(P instanceof SH.b)for(const e of P.signalOutputs)for(const E of e.connectedPointIds){const H=rH(u,E);e.connectTo(H)}}for(const P of e.executionContexts)fH(P,{graph:N,valueParseFunction:z},e.rightHanded);return N}(e,E,N)}function fH(e,E,H){const N=E.graph.createContext();e.enableLogging&&(N.enableLogging=!0),N.treatDataAsRightHanded=H||!1;const u=E.valueParseFunction??XH.c;N.uniqueId=e.uniqueId;const z=N.fe();if(e._assetsContext){var P,M,D,A,C,i,V,U,j,F;const E=e._assetsContext,H={meshes:null===(P=E.meshes)||void 0===P?void 0:P.map((e=>z.getMeshById(e))),lights:null===(M=E.lights)||void 0===M?void 0:M.map((e=>z.getLightByName(e))),cameras:null===(D=E.cameras)||void 0===D?void 0:D.map((e=>z.getCameraByName(e))),materials:null===(A=E.materials)||void 0===A?void 0:A.map((e=>z.getMaterialById(e))),textures:null===(C=E.textures)||void 0===C?void 0:C.map((e=>z.getTextureByName(e))),animations:null===(i=E.animations)||void 0===i?void 0:i.map((e=>z.animations.find((E=>E.name===e)))),skeletons:null===(V=E.skeletons)||void 0===V?void 0:V.map((e=>z.getSkeletonByName(e))),Ii:null===(U=E.Ii)||void 0===U?void 0:U.map((e=>z.getParticleSystemById(e))),animationGroups:null===(j=E.animationGroups)||void 0===j?void 0:j.map((e=>z.getAnimationGroupByName(e))),transformNodes:null===(F=E.transformNodes)||void 0===F?void 0:F.map((e=>z.getTransformNodeById(e))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],pV:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};N.assetsContext=H}for(const h in e._userVariables){const E=u(h,e._userVariables,N.assetsContext,z);N.userVariables[h]=E}for(const h in e._connectionValues){const E=u(h,e._connectionValues,N.assetsContext,z);N._setConnectionValueByKey(h,E)}return N}function wH(e,E,H){const N={},u=E.valueParseFunction??XH.c;if(e.config)for(const P in e.config)N[P]=u(P,e.config,E.assetsContainer||E.hE,E.hE);if((0,XH.h)(e.className)){if(!E.pathConverter)throw new Error("Path converter is required for this block");N.pathConverter=E.pathConverter}const z=new H(N);z.uniqueId=e.uniqueId;for(let P=0;P<e.dataInputs.length;P++){const E=z.getDataInput(e.dataInputs[P].name);if(!E)throw new Error("Could not find data input with name "+e.dataInputs[P].name+" in block "+e.className);E.deserialize(e.dataInputs[P])}for(let P=0;P<e.dataOutputs.length;P++){const E=z.getDataOutput(e.dataOutputs[P].name);if(!E)throw new Error("Could not find data output with name "+e.dataOutputs[P].name+" in block "+e.className);E.deserialize(e.dataOutputs[P])}return z.metadata=e.metadata,z.deserialize&&z.deserialize(e),z}function sH(e){const[E,H]=e.split(":");return pH({op:E,extension:H})}function pH(e){var E;let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=e.extension?null===(E=yH[e.extension])||void 0===E?void 0:E[e.op]:bH[e.op];if(!N&&(F.d.Warn(`No mapping found for operation ${e.op} and extension ${e.extension||"KHR_interactivity"}`),H)){const E={},H={flows:{}};if(e.inputValueSockets){E.values={};for(const H in e.inputValueSockets)E.values[H]={name:H}}return e.outputValueSockets&&(H.values={},Object.keys(e.outputValueSockets).forEach((e=>{H.values[e]={name:e}}))),{PC:[],inputs:E,outputs:H}}return N}function oH(e,E,H){yH[E]||(yH[E]={}),yH[E][e]=H}const yH={BABYLON:{"flow/log":{PC:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},bH={"event/onStart":{PC:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{PC:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{PC:["FlowGraphSendCustomEventBlock"],extraProcessor(e,E,H,N,u){if("event/send"!==E.op||!e.configuration||1!==Object.keys(e.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=e.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const P=N.arrays.events[z],M=u[0];return M.config||(M.config={}),M.config.eventId=P.eventId,M.config.eventData=P.eventData,u}},"event/receive":{PC:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(e,E){var H;if(!e.configuration)return F.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const N=e.configuration.event;if(!N)return F.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const u=N.value[0];if("number"!==typeof u)return F.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(H=E.events)||void 0===H?void 0:H[u])?{valid:!0}:(F.d.Error(`Event with id ${u} not found`),{valid:!1,error:`Event with id ${u} not found`})},extraProcessor(e,E,H,N,u){if("event/receive"!==E.op||!e.configuration||1!==Object.keys(e.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=e.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const P=N.arrays.events[z],M=u[0];return M.config||(M.config={}),M.config.eventId=P.eventId,M.config.eventData=P.eventData,u}},"math/e":KH("FlowGraphEBlock"),"math/pi":KH("FlowGraphPIBlock"),"math/inf":KH("FlowGraphInfBlock"),"math/nan":KH("FlowGraphNaNBlock"),"math/abs":KH("FlowGraphAbsBlock"),"math/sign":KH("FlowGraphSignBlock"),"math/trunc":KH("FlowGraphTruncBlock"),"math/floor":KH("FlowGraphFloorBlock"),"math/ceil":KH("FlowGraphCeilBlock"),"math/round":{PC:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u){var z;return(z=u[0]).config||(z.config={}),u[0].config.roundHalfAwayFromZero=!0,u}},"math/fract":KH("FlowGraphFractBlock"),"math/neg":KH("FlowGraphNegationBlock"),"math/add":KH("FlowGraphAddBlock",["a","b"],!0),"math/sub":KH("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{PC:["FlowGraphMultiplyBlock"],extraProcessor(e,E,H,N,u){var z;(z=u[0]).config||(z.config={}),u[0].config.useMatrixPerComponent=!0,u[0].config.preventIntegerFloatArithmetic=!0;let P=-1;return Object.keys(e.values||{}).find((E=>{var H;return void 0!==(null===(H=e.values)||void 0===H?void 0:H[E].type)&&(P=e.values[E].type,!0)})),-1!==P&&(u[0].config.type=N.arrays.types[P].flowGraphType),u},validation:e=>e.values?lH(e):{valid:!0}},"math/div":KH("FlowGraphDivideBlock",["a","b"],!0),"math/rem":KH("FlowGraphModuloBlock",["a","b"]),"math/min":KH("FlowGraphMinBlock",["a","b"]),"math/max":KH("FlowGraphMaxBlock",["a","b"]),"math/clamp":KH("FlowGraphClampBlock",["a","b","c"]),"math/saturate":KH("FlowGraphSaturateBlock"),"math/mix":KH("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":KH("FlowGraphEqualityBlock",["a","b"]),"math/lt":KH("FlowGraphLessThanBlock",["a","b"]),"math/le":KH("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":KH("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":KH("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":KH("FlowGraphIsNaNBlock"),"math/isinf":KH("FlowGraphIsInfBlock"),"math/select":{PC:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{PC:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":KH("FlowGraphSinBlock"),"math/cos":KH("FlowGraphCosBlock"),"math/tan":KH("FlowGraphTanBlock"),"math/asin":KH("FlowGraphASinBlock"),"math/acos":KH("FlowGraphACosBlock"),"math/atan":KH("FlowGraphATanBlock"),"math/atan2":KH("FlowGraphATan2Block",["a","b"]),"math/sinh":KH("FlowGraphSinhBlock"),"math/cosh":KH("FlowGraphCoshBlock"),"math/tanh":KH("FlowGraphTanhBlock"),"math/asinh":KH("FlowGraphASinhBlock"),"math/acosh":KH("FlowGraphACoshBlock"),"math/atanh":KH("FlowGraphATanhBlock"),"math/exp":KH("FlowGraphExponentialBlock"),"math/log":KH("FlowGraphLogBlock"),"math/log2":KH("FlowGraphLog2Block"),"math/log10":KH("FlowGraphLog10Block"),"math/sqrt":KH("FlowGraphSquareRootBlock"),"math/cbrt":KH("FlowGraphCubeRootBlock"),"math/pow":KH("FlowGraphPowerBlock",["a","b"]),"math/length":KH("FlowGraphLengthBlock"),"math/normalize":KH("FlowGraphNormalizeBlock"),"math/dot":KH("FlowGraphDotBlock",["a","b"]),"math/cross":KH("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":KH("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":KH("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{PC:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{PC:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{PC:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{PC:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{PC:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{PC:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{PC:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":KH("FlowGraphTransposeBlock"),"math/determinant":KH("FlowGraphDeterminantBlock"),"math/inverse":KH("FlowGraphInvertMatrixBlock"),"math/matmul":KH("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{PC:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"UM",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u,z){const P=u[0].dataInputs.find((e=>"rotationQuaternion"===e.name));if(!P)throw new Error("Rotation quaternion input not found");return z._connectionValues[P.uniqueId]&&(z._connectionValues[P.uniqueId].type="Quaternion"),u}},"math/matDecompose":{PC:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"UM"}}}},"math/quatConjugate":KH("FlowGraphConjugateBlock",["a"]),"math/quatMul":{PC:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u){var z;return(z=u[0]).config||(z.config={}),u[0].config.type="Quaternion",u}},"math/quatAngleBetween":KH("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{PC:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":KH("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":KH("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{PC:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u){var z;return(z=u[0]).config||(z.config={}),u[0].config.inputIsColumnMajor=!0,u}},"math/extract2x2":{PC:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{PC:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u){var z;return(z=u[0]).config||(z.config={}),u[0].config.inputIsColumnMajor=!0,u}},"math/extract3x3":{PC:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{PC:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u){var z;return(z=u[0]).config||(z.config={}),u[0].config.inputIsColumnMajor=!0,u}},"math/extract4x4":{PC:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{PC:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u,z){var P,M;(M=u[0]).config||(M.config={});const D=u[0].dataInputs[0];return u[0].config.valueType=(null===(P=z._connectionValues[D.uniqueId])||void 0===P?void 0:P.type)??"FlowGraphInteger",u}},"math/and":{PC:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u,z){var P,M,D;(D=u[0]).config||(D.config={});const A=u[0].dataInputs[0],C=u[0].dataInputs[1];return u[0].config.valueType=(null===(P=z._connectionValues[A.uniqueId])||void 0===P?void 0:P.type)??(null===(M=z._connectionValues[C.uniqueId])||void 0===M?void 0:M.type)??"FlowGraphInteger",u}},"math/or":{PC:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u,z){var P,M,D;(D=u[0]).config||(D.config={});const A=u[0].dataInputs[0],C=u[0].dataInputs[1];return u[0].config.valueType=(null===(P=z._connectionValues[A.uniqueId])||void 0===P?void 0:P.type)??(null===(M=z._connectionValues[C.uniqueId])||void 0===M?void 0:M.type)??"FlowGraphInteger",u}},"math/xor":{PC:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,E,H,N,u,z){var P,M,D;(D=u[0]).config||(D.config={});const A=u[0].dataInputs[0],C=u[0].dataInputs[1];return u[0].config.valueType=(null===(P=z._connectionValues[A.uniqueId])||void 0===P?void 0:P.type)??(null===(M=z._connectionValues[C.uniqueId])||void 0===M?void 0:M.type)??"FlowGraphInteger",u}},"math/asr":KH("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":KH("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":KH("FlowGraphLeadingZerosBlock"),"math/ctz":KH("FlowGraphTrailingZerosBlock"),"math/popcnt":KH("FlowGraphOneBitsCounterBlock"),"math/rad":KH("FlowGraphDegToRadBlock"),"math/deg":KH("FlowGraphRadToDegBlock"),"type/boolToInt":KH("FlowGraphBooleanToInt"),"type/boolToFloat":KH("FlowGraphBooleanToFloat"),"type/intToBool":KH("FlowGraphIntToBoolean"),"type/intToFloat":KH("FlowGraphIntToFloat"),"type/floatToInt":KH("FlowGraphFloatToInt"),"type/floatToBool":KH("FlowGraphFloatToBoolean"),"flow/sequence":{PC:["FlowGraphSequenceBlock"],extraProcessor(e,E,H,N,u){const z=u[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(e.flows||[]).length,z.signalOutputs.forEach(((e,E)=>{e.name="out_"+E})),u}},"flow/branch":{PC:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{PC:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(e){if(e.configuration&&e.configuration.cases){const E=e.configuration.cases.value;if(!E.every((e=>"number"===typeof e&&/^-?\d+$/.test(e.toString()))))return F.d.Warn("Switch cases should be integers. Using empty array instead."),e.configuration.cases.value=[],{valid:!0};const H=new Set(E);e.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(e,E,H,N,u){if("flow/switch"!==E.op||!e.flows||0===Object.keys(e.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return u[0].signalOutputs.forEach((e=>{"default"!==e.name&&(e.name="out_"+e.name)})),u}},"flow/while":{PC:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{PC:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(e,E,H,N,u){const z=u[0];return z.config||(z.config={}),z.config.incrementIndexWhenLoopDone=!0,u}},"flow/doN":{PC:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{PC:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(e,E,H,N,u){if("flow/multiGate"!==E.op||!e.flows||0===Object.keys(e.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const z=u[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(e.flows).length,z.signalOutputs.forEach(((e,E)=>{e.name="out_"+E})),u}},"flow/waitAll":{PC:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(e){var E,H;return"number"!==typeof(null===(E=e.configuration)||void 0===E||null===(H=E.inputFlows)||void 0===H?void 0:H.value[0])&&(e.configuration=e.configuration||{inputFlows:{value:[0]}},e.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{PC:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{PC:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{PC:["FlowGraphCancelDelayBlock"]},"variable/get":{PC:["FlowGraphGetVariableBlock"],validation(e){var E,H;return null!==(E=e.configuration)&&void 0!==E&&null!==(H=E.variable)&&void 0!==H&&H.value?{valid:!0}:(F.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,E)=>[E.getVariableName(e[0])]}}},"variable/set":{PC:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,E)=>[E.getVariableName(e[0])]}}},"variable/setMultiple":{PC:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(e,E)=>[e[0].map((e=>E.getVariableName(e)))]}},extraProcessor:(e,E,H,N,u)=>(u[0].dataInputs.forEach((e=>{e.name=N.getVariableName(+e.name)})),u)},"variable/interpolate":{PC:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(e,E)=>[E.getVariableName(e[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:e=>!0===e[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",aH:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",aH:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",aH:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",aH:"FlowGraphPlayAnimationBlock"},out:{name:"out",aH:"FlowGraphPlayAnimationBlock"},done:{name:"done",aH:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(e,E,H,N,u){var z,P,M;const D=u[0],A=null===(z=e.configuration)||void 0===z?void 0:z.variable.value[0];if("number"!==typeof A)throw F.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const C=N.arrays.staticVariables[A];"undefined"===typeof D.config.animationType.value&&(N.arrays.staticVariables,D.config.animationType.value=(0,aH.G)(C.type));const i=u[4];return i.config||(i.config={}),(P=i.config).variable||(P.variable={}),i.config.variable.value=N.getVariableName(A),(M=u[3]).config||(M.config={}),u}},"pointer/get":{PC:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",aH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",aH:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,E,H,N,u)=>(u.forEach((e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)})),u)},"pointer/set":{PC:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",aH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",aH:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,E,H,N,u)=>(u.forEach((e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)})),u)},"pointer/interpolate":{PC:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",aH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",aH:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",aH:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",aH:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",aH:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",aH:"FlowGraphPlayAnimationBlock"},out:{name:"out",aH:"FlowGraphPlayAnimationBlock"},done:{name:"done",aH:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,E,H,N,u)=>(u.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className?(E.config||(E.config={}),E.config.outputValue=!0):"FlowGraphInterpolationBlock"===E.className&&(E.config||(E.config={}),Object.keys(e.values||[]).forEach((H=>{var u;const z=null===(u=e.values)||void 0===u?void 0:u[H];if("value"===H&&z){const e=z.type;void 0!==e&&(E.config.animationType=N.arrays.types[e].flowGraphType)}})))})),u)},"animation/start":{PC:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",aH:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(e,E)=>[e[0]*E._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(e,E)=>[e[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,E,H,N,u,z,P){const M=u[u.length-1];return M.config||(M.config={}),M.config.glTF=P,u}},"animation/stop":{PC:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",aH:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,E,H,N,u,z,P){const M=u[u.length-1];return M.config||(M.config={}),M.config.glTF=P,u}},"animation/stopAt":{PC:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",aH:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(e,E)=>[e[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,E,H,N,u,z,P){const M=u[u.length-1];return M.config||(M.config={}),M.config.glTF=P,u}},"math/switch":{PC:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(e){if(e.configuration&&e.configuration.cases){const E=e.configuration.cases.value;if(!E.every((e=>"number"===typeof e&&/^-?\d+$/.test(e.toString()))))return F.d.Warn("Switch cases should be integers. Using empty array instead."),e.configuration.cases.value=[],{valid:!0};const H=new Set(E);e.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(e,E,H,N,u){const z=u[0];return z.dataInputs.forEach((e=>{"default"!==e.name&&"case"!==e.name&&(e.name="in_"+e.name)})),z.config||(z.config={}),z.config.treatCasesAsIntegers=!0,u}},"debug/log":{PC:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function KH(e){let E=arguments.length>2?arguments[2]:void 0;return{PC:[e],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((e,E)=>(e[E]={name:E},e)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(e,H,N,u,z){var P;if(E){(P=z[0]).config||(P.config={}),z[0].config.preventIntegerFloatArithmetic=!0;let E=-1;Object.keys(e.values||{}).find((H=>{var N;return void 0!==(null===(N=e.values)||void 0===N?void 0:N[H].type)&&(E=e.values[H].type,!0)})),-1!==E&&(z[0].config.type=u.arrays.types[E].flowGraphType)}return z},validation:e=>E?lH(e):{valid:!0}}}function lH(e){if(e.values){const E=Object.keys(e.values).map((E=>e.values[E].type)).filter((e=>void 0!==e));if(!E.every((e=>e===E[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}bH["math/compose"]=bH["math/matCompose"],bH["math/decompose"]=bH["math/matDecompose"];var OH=H(11693);const vH={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"jE",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class RH{constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=e,this._gltf=E,this._animationTargetFps=H,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const e of this._interactivityGraph.types)this._types.push(vH[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const e of this._interactivityGraph.declarations){const E=pH(e);if(!E)throw F.d.Error(["No mapping found for declaration",e]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:E,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const e of this._interactivityGraph.variables){const E=this._parseVariable(e);this._staticVariables.push(E)}}_parseVariable(e,E){const H=this._types[e.type];if(!H)throw F.d.Error(["No type found for variable",e]),new Error("Error parsing variables");if(e.value&&e.value.length!==H.length)throw F.d.Error(["Invalid value length for variable",e,H]),new Error("Error parsing variables");const N=e.value||[];if(!N.length)switch(H.flowGraphType){case"boolean":N.push(!1);break;case"FlowGraphInteger":N.push(0);break;case"number":N.push(NaN);break;case"Vector2":N.push(NaN,NaN);break;case"jE":N.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":N.fill(NaN,0,4);break;case"Matrix":N.fill(NaN,0,16);break;case"Matrix3D":N.fill(NaN,0,9)}return"number"===H.elementType&&"string"===typeof N[0]&&(N[0]=parseFloat(N[0])),{type:H.flowGraphType,value:E?E(N,this):N}}_parseEvents(){if(this._interactivityGraph.events)for(const e of this._interactivityGraph.events){const E={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(E.eventData=Object.keys(e.values).map((E=>{var H;const N=null===(H=e.values)||void 0===H?void 0:H[E];if(!N)throw F.d.Error(["No value found for event key",E]),new Error("Error parsing events");const u=this._types[N.type];if(!u)throw F.d.Error(["No type found for event value",N]),new Error("Error parsing events");const z="undefined"!==typeof N.value?this._parseVariable(N):void 0;return{id:E,type:u.flowGraphType,eventData:!0,value:z}}))),this._events.push(E)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const E of this._interactivityGraph.nodes){if("number"!==typeof E.declaration)throw F.d.Error(["No declaration found for node",E]),new Error("Error parsing nodes");const H=this._mappings[E.declaration];if(!H)throw F.d.Error(["No mapping found for node",E]),new Error("Error parsing nodes");if(H.flowGraphMapping.validation){const N=H.flowGraphMapping.validation(E,this._interactivityGraph,this._gltf);var e;if(!N.valid)throw new Error(`Error validating interactivity node ${null===(e=this._interactivityGraph.declarations)||void 0===e?void 0:e[E.declaration].op} - ${N.error}`)}const N=[];for(const e of H.flowGraphMapping.PC){const u=this._getEmptyBlock(e,H.fullOperationName);this._parseNodeConfiguration(E,u,H.flowGraphMapping,e),N.push(u)}this._nodes.push({PC:N,fullOperationName:H.fullOperationName})}}_getEmptyBlock(e,E){return{uniqueId:(0,OH.e)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:E,metadata:{}}}_parseNodeConfiguration(e,E,H,N){const u=E.config;if(e.configuration){const E=Object.keys(e.configuration);for(const M of E){var z,P;const E=null===(z=e.configuration)||void 0===z?void 0:z[M];if(!E)throw F.d.Error(["No value found for node configuration",M]),new Error("Error parsing node configuration");const D=null===(P=H.configuration)||void 0===P?void 0:P[M];if(D&&D.aH?D.aH===N:0===H.PC.indexOf(N)){const e=(null===D||void 0===D?void 0:D.name)||M;E&&"undefined"!==typeof E.value||"undefined"===typeof(null===D||void 0===D?void 0:D.defaultValue)?E.value.length>=0?u[e]={value:1===E.value.length?E.value[0]:E.value}:F.d.Warn(["Invalid value for node configuration",E]):u[e]={value:D.defaultValue},D&&D.dataTransformer&&(u[e].value=D.dataTransformer([u[e].value],this)[0])}}}}_parseNodeConnections(e){for(let Y=0;Y<this._nodes.length;Y++){var E;const f=null===(E=this._interactivityGraph.nodes)||void 0===E?void 0:E[Y];if(!f)throw F.d.Error(["No node found for interactivity node",this._nodes[Y]]),new Error("Error parsing node connections");const w=this._nodes[Y],s=this._mappings[f.declaration];if(!s)throw F.d.Error(["No mapping found for node",f]),new Error("Error parsing node connections");const p=f.flows||{},o=Object.keys(p).sort();for(const e of o){var H,N,u,z;const E=p[e],A=null===(H=s.flowGraphMapping.outputs)||void 0===H||null===(N=H.flows)||void 0===N?void 0:N[e],C=(null===A||void 0===A?void 0:A.name)||e,i=this._createNewSocketConnection(C,!0);(A&&A.aH&&w.PC.find((e=>e.className===A.aH))||w.PC[0]).signalOutputs.push(i);const V=E.node,U=this._nodes[V];if(!U)throw F.d.Error(["No node found for input node id",V]),new Error("Error parsing node connections");const j=sH(U.fullOperationName);if(!j)throw F.d.Error(["No mapping found for input node",U]),new Error("Error parsing node connections");let h=null===(u=j.inputs)||void 0===u||null===(z=u.flows)||void 0===z?void 0:z[E.socket||"in"],S=!1;if(!h)for(const e in null===(P=j.inputs)||void 0===P?void 0:P.flows){var P,M,D;if(e.startsWith("[")&&e.endsWith("]"))S=!0,h=null===(M=j.inputs)||void 0===M||null===(D=M.flows)||void 0===D?void 0:D[e]}const X=h?S?h.name.replace("$1",E.socket||""):h.name:E.socket||"in",a=h&&h.aH&&U.PC.find((e=>e.className===h.aH))||U.PC[0];let W=a.signalInputs.find((e=>e.name===X));W||(W=this._createNewSocketConnection(X),a.signalInputs.push(W)),W.connectedPointIds.push(i.uniqueId),i.connectedPointIds.push(W.uniqueId)}const y=f.values||{},b=Object.keys(y);for(const E of b){var A,C;const H=y[E];let N=null===(A=s.flowGraphMapping.inputs)||void 0===A||null===(C=A.values)||void 0===C?void 0:C[E],u=!1;if(!N)for(const e in null===(i=s.flowGraphMapping.inputs)||void 0===i?void 0:i.values){var i,V,U;if(e.startsWith("[")&&e.endsWith("]"))u=!0,N=null===(V=s.flowGraphMapping.inputs)||void 0===V||null===(U=V.values)||void 0===U?void 0:U[e]}const z=N?u?N.name.replace("$1",E):N.name:E,P=this._createNewSocketConnection(z);if((N&&N.aH&&w.PC.find((e=>e.className===N.aH))||w.PC[0]).dataInputs.push(P),void 0!==H.value){const E=this._parseVariable(H,N&&N.dataTransformer);e._connectionValues[P.uniqueId]=E}else{if("undefined"===typeof H.node)throw F.d.Error(["Invalid value for value connection",H]),new Error("Error parsing node connections");{var j,h,S;const e=H.node,E=H.socket||"value",N=this._nodes[e];if(!N)throw F.d.Error(["No node found for output socket reference",H]),new Error("Error parsing node connections");const u=sH(N.fullOperationName);if(!u)throw F.d.Error(["No mapping found for output socket reference",H]),new Error("Error parsing node connections");let z=null===(j=u.outputs)||void 0===j||null===(h=j.values)||void 0===h?void 0:h[E],M=!1;if(!z)for(const H in null===(X=u.outputs)||void 0===X?void 0:X.values){var X,a,W;if(H.startsWith("[")&&H.endsWith("]"))M=!0,z=null===(a=u.outputs)||void 0===a||null===(W=a.values)||void 0===W?void 0:W[H]}const D=z?M?z.name.replace("$1",E):null===(S=z)||void 0===S?void 0:S.name:E,A=z&&z.aH&&N.PC.find((e=>e.className===z.aH))||N.PC[0];let C=A.dataOutputs.find((e=>e.name===D));C||(C=this._createNewSocketConnection(D,!0),A.dataOutputs.push(C)),P.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(P.uniqueId)}}}if(s.flowGraphMapping.interBlockConnectors)for(const e of s.flowGraphMapping.interBlockConnectors){const E=e.input,H=e.output,N=e.isVariable;this._connectFlowGraphNodes(E,H,w.PC[e.inputBlockIndex],w.PC[e.outputBlockIndex],N)}if(s.flowGraphMapping.extraProcessor){var r;const E=null===(r=this._interactivityGraph.declarations)||void 0===r?void 0:r[f.declaration];if(!E)throw F.d.Error(["No declaration found for extra processor",f]),new Error("Error parsing node connections");w.PC=s.flowGraphMapping.extraProcessor(f,E,s.flowGraphMapping,this,w.PC,e,this._gltf)}}}_createNewSocketConnection(e,E){return{uniqueId:(0,OH.e)(),name:e,_connectionType:E?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(e,E,H,N,u){const z=u?H.dataInputs:H.signalInputs,P=u?N.dataOutputs:N.signalOutputs,M=z.find((E=>E.name===e))||this._createNewSocketConnection(e),D=P.find((e=>e.name===E))||this._createNewSocketConnection(E,!0);z.find((E=>E.name===e))||z.push(M),P.find((e=>e.name===E))||P.push(D),M.connectedPointIds.push(D.uniqueId),D.connectedPointIds.push(M.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){const e={uniqueId:(0,OH.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let E=0;E<this._staticVariables.length;E++){const H=this._staticVariables[E];e._userVariables[this.getVariableName(E)]=H}return{rightHanded:!0,allBlocks:this._nodes.reduce(((e,E)=>e.concat(E.PC)),[]),executionContexts:[e]}}}const TH="KHR_interactivity";class LH{constructor(e){this._loader=e,this.name=TH,this.enabled=this._loader.isExtensionUsed(TH),this._pathConverter=(0,d.l)(this._loader.eM),e._skipStartAnimationStep=!0;const E=e.babylonScene;E&&function(e){(0,d.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!e.activeCamera)return new u.Quaternion(NaN,NaN,NaN,NaN);const E=u.Quaternion.FromRotationMatrix(e.activeCamera.getWorldMatrix()).normalize();return e.useRightHandedSystem||(E.w*=-1,E.x*=-1),E},type:"Quaternion",getTarget:()=>e.activeCamera}),(0,d.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!e.activeCamera)return new u.jE(NaN,NaN,NaN);const E=e.activeCamera.getWorldMatrix().getTranslation();return e.useRightHandedSystem||(E.x*=-1),E},type:"jE",getTarget:()=>e.activeCamera}),(0,d.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>{var E;return(null===(E=e._babylonAnimationGroup)||void 0===E?void 0:E.isPlaying)??!1},type:"boolean",getTarget:e=>e._babylonAnimationGroup}),(0,d.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>{var E;return((null===(E=e._babylonAnimationGroup)||void 0===E?void 0:E.from)??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,d.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>{var E;return((null===(E=e._babylonAnimationGroup)||void 0===E?void 0:E.to)??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,d.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>{var E;return((null===(E=e._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,d.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>{var E;return((null===(E=e._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup})}(E)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var e;if(!this._loader.babylonScene||!this._pathConverter)return;const E=this._loader.babylonScene,H=null===(e=this._loader.eM.extensions)||void 0===e?void 0:e.KHR_interactivity;if(!H)return;const N=new jH.c({hE:E});N.dispatchEventsSynchronously=!1;const u=H.graphs.map((e=>new RH(e,this._loader.eM,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(u.map((async e=>await YH(e,{coordinator:N,pathConverter:this._pathConverter})))),N.start()}}var dH;dH=async()=>(await Promise.resolve().then(H.bind(H,13480))).FlowGraphGLTFDataProvider,FH[`${TH}/${"FlowGraphGLTFDataProvider"}`]=dH,L(TH),T(TH,!0,(e=>new LH(e)));const GH="KHR_node_visibility";(0,d.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:e=>{const E=e._babylonTransformNode;return!E||void 0===E.isVisible||E.isVisible},set:(e,E)=>{var H,N;null===(H=E._primitiveBabylonMeshes)||void 0===H||H.forEach((e=>{e.inheritVisibility=!0})),E._babylonTransformNode&&(E._babylonTransformNode.isVisible=e),null===(N=E._primitiveBabylonMeshes)||void 0===N||N.forEach((E=>{E.isVisible=e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class mN{constructor(e){this.name=GH,this._loader=e,this.enabled=e.isExtensionUsed(GH)}async onReady(){var e;null===(e=this._loader.eM.nodes)||void 0===e||e.forEach((e=>{var E,H,N,u;(null===(E=e._primitiveBabylonMeshes)||void 0===E||E.forEach((e=>{e.inheritVisibility=!0})),null!==(H=e.extensions)&&void 0!==H&&H.KHR_node_visibility)&&(!1===(null===(N=e.extensions)||void 0===N?void 0:N.KHR_node_visibility.visible)&&(e._babylonTransformNode&&(e._babylonTransformNode.isVisible=!1),null===(u=e._primitiveBabylonMeshes)||void 0===u||u.forEach((e=>{e.isVisible=!1}))))}))}dispose(){this._loader=null}}L(GH),T(GH,!0,(e=>new mN(e)));const QH="KHR_node_selectability";oH("event/onSelect",QH,{PC:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aH:"FlowGraphGetVariableBlock",dataTransformer:e=>["pickedMesh_"+e[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",aH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,E,H,N,u,z,P){var M,D,A,C,i,V;const U=u[u.length-1];U.config=U.config||{},U.config.glTF=P;const j=null===(M=e.configuration)||void 0===M||null===(D=M.nodeIndex)||void 0===D?void 0:D.value[0];if(void 0===j||"number"!==typeof j)throw new Error("nodeIndex not found in configuration");const F="pickedMesh_"+j;return u[1].config.variable=F,z._userVariables[F]={className:"Mesh",id:null===P||void 0===P||null===(A=P.nodes)||void 0===A||null===(C=A[j]._babylonTransformNode)||void 0===C?void 0:C.id,uniqueId:null===P||void 0===P||null===(i=P.nodes)||void 0===i||null===(V=i[j]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},u}}),(0,d.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:e=>{const E=e._babylonTransformNode;return!E||void 0===E.KD||E.KD},set:(e,E)=>{var H;null===(H=E._primitiveBabylonMeshes)||void 0===H||H.forEach((E=>{E.KD=e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"KD"],type:"boolean"});class ZH{constructor(e){this.name=QH,this._loader=e,this.enabled=e.isExtensionUsed(QH)}async onReady(){var e;null===(e=this._loader.eM.nodes)||void 0===e||e.forEach((e=>{var E,H,N;null!==(E=e.extensions)&&void 0!==E&&E.KHR_node_selectability&&!1===(null===(H=e.extensions)||void 0===H?void 0:H.KHR_node_selectability.selectable)&&(null===(N=e._babylonTransformNode)||void 0===N||N.getChildMeshes().forEach((e=>{e.KD=!1})))}))}dispose(){this._loader=null}}L(QH),T(QH,!0,(e=>new ZH(e)));const kH="KHR_node_hoverability",JH="targetMeshPointerOver_";oH("event/onHoverIn",kH,{PC:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aH:"FlowGraphGetVariableBlock",dataTransformer:e=>[JH+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",aH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,E,H,N,u,z,P){var M,D,A,C,i,V;const U=u[u.length-1];U.config=U.config||{},U.config.glTF=P;const j=null===(M=e.configuration)||void 0===M||null===(D=M.nodeIndex)||void 0===D?void 0:D.value[0];if(void 0===j||"number"!==typeof j)throw new Error("nodeIndex not found in configuration");const F=JH+j;return u[1].config.variable=F,z._userVariables[F]={className:"Mesh",id:null===P||void 0===P||null===(A=P.nodes)||void 0===A||null===(C=A[j]._babylonTransformNode)||void 0===C?void 0:C.id,uniqueId:null===P||void 0===P||null===(i=P.nodes)||void 0===i||null===(V=i[j]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},u}});const BH="targetMeshPointerOut_";oH("event/onHoverOut",kH,{PC:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aH:"FlowGraphGetVariableBlock",dataTransformer:e=>[BH+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",aH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,E,H,N,u,z,P){var M,D,A,C,i,V;const U=u[u.length-1];U.config=U.config||{},U.config.glTF=P;const j=null===(M=e.configuration)||void 0===M||null===(D=M.nodeIndex)||void 0===D?void 0:D.value[0];if(void 0===j||"number"!==typeof j)throw new Error("nodeIndex not found in configuration");const F=BH+j;return u[1].config.variable=F,z._userVariables[F]={className:"Mesh",id:null===P||void 0===P||null===(A=P.nodes)||void 0===A||null===(C=A[j]._babylonTransformNode)||void 0===C?void 0:C.id,uniqueId:null===P||void 0===P||null===(i=P.nodes)||void 0===i||null===(V=i[j]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},u}}),(0,d.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:e=>{const E=e._babylonTransformNode;return!E||void 0===E.pointerOverDisableMeshTesting||E.pointerOverDisableMeshTesting},set:(e,E)=>{var H;null===(H=E._primitiveBabylonMeshes)||void 0===H||H.forEach((E=>{E.pointerOverDisableMeshTesting=!e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class IH{constructor(e){this.name=kH,this._loader=e,this.enabled=e.isExtensionUsed(kH)}async onReady(){var e;null===(e=this._loader.eM.nodes)||void 0===e||e.forEach((e=>{var E,H,N;null!==(E=e.extensions)&&void 0!==E&&E.KHR_node_hoverability&&!1===(null===(H=e.extensions)||void 0===H?void 0:H.KHR_node_hoverability.hoverable)&&(null===(N=e._babylonTransformNode)||void 0===N||N.getChildMeshes().forEach((e=>{e.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}L(kH),T(kH,!0,(e=>new IH(e)));const tH="ExtrasAsMetadata";class qH{_assignExtras(e,E){if(E.extras&&Object.keys(E.extras).length>0){const H=e.metadata=e.metadata||{};(H.eM=H.eM||{}).extras=E.extras}}constructor(e){this.name=tH,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,E,H){return this._loader.loadNodeAsync(e,E,(e=>{this._assignExtras(e,E),H(e)}))}loadCameraAsync(e,E,H){return this._loader.loadCameraAsync(e,E,(e=>{this._assignExtras(e,E),H(e)}))}createMaterial(e,E,H){const N=this._loader.createMaterial(e,E,H);return this._assignExtras(N,E),N}}L(tH),T(tH,!1,(e=>new qH(e)));H(13480)},13340:(e,E,H)=>{"use strict";H.d(E,{e:()=>l,g:()=>s,i:()=>w,j:()=>p});var N=H(11541),u=H(11532),z=H(12997),P=H(12165),M=H(12133),D=H(12140),A=H(11548),C=H(11579),i=H(12161),V=H(12256),U=H(12168),j=H(11780);class F{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ii=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.pV=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=[];e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes);for(const E of this.skeletons)e=e.concat(E.bones);return e}}class h extends F{}class S{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const e=this.rootNodes;for(const N of e)N.dispose();e.length=0;const E=this.skeletons;for(const N of E)N.dispose();E.length=0;const H=this.animationGroups;for(const N of H)N.dispose();H.length=0}}class X extends F{constructor(e){super(),this._wasAddedToScene=!1,(e=e||C.d.LastCreatedScene)&&(this.hE=e,this.proceduralTextures=[],e.cP.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();for(const e of this.Ii)e.rebuild();for(const e of this.textures)e._rebuild()})))}_topologicalSort(e){const E=new Map;for(const P of e)E.set(P.uniqueId,P);const H={dependsOn:new Map,dependedBy:new Map};for(const P of e){const e=P.uniqueId;H.dependsOn.set(e,new Set),H.dependedBy.set(e,new Set)}for(const P of e){const e=P.uniqueId,N=H.dependsOn.get(e);if(P instanceof i.b){const u=P.sourceMesh;E.has(u.uniqueId)&&(N.add(u.uniqueId),H.dependedBy.get(u.uniqueId).add(e))}const u=H.dependedBy.get(e);for(const z of P.getDescendants()){const N=z.uniqueId;if(E.has(N)){u.add(N);H.dependsOn.get(N).add(e)}}}const N=[],u=[];for(const P of e){const e=P.uniqueId;0===H.dependsOn.get(e).size&&(u.push(P),E.delete(e))}const z=u;for(;z.length>0;){const e=z.shift();N.push(e);const u=H.dependedBy.get(e.uniqueId);for(const N of Array.from(u.values())){const u=H.dependsOn.get(N);u.delete(e.uniqueId),0===u.size&&E.get(N)&&(z.push(E.get(N)),E.delete(N))}}return E.size>0&&(A.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),E.forEach((e=>{A.d.Error(e.name)}))),N}_addNodeAndDescendantsToList(e,E,H,N){if(H&&(!N||N(H))&&!E.has(H.uniqueId)){e.push(H),E.add(H.uniqueId);for(const u of H.getDescendants(!0))this._addNodeAndDescendantsToList(e,E,u,N)}}_isNodeInContainer(e){return e instanceof D.d&&-1!==this.meshes.indexOf(e)||(e instanceof M.d&&-1!==this.transformNodes.indexOf(e)||(e instanceof V.b&&-1!==this.lights.indexOf(e)||e instanceof U.c&&-1!==this.cameras.indexOf(e)))}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return A.d.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return A.d.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return A.d.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return A.d.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||u.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const N={},z={},M=new S,D=[],A=[],C={doNotInstantiate:!0,...H},i=[],V=new Set;for(const u of this.transformNodes)null===u.parent&&this._addNodeAndDescendantsToList(i,V,u,C.predicate);for(const u of this.meshes)null===u.parent&&this._addNodeAndDescendantsToList(i,V,u,C.predicate);const U=this._topologicalSort(i),j=(H,u)=>{if(((E,H)=>{if(N[E.uniqueId]=H.uniqueId,z[H.uniqueId]=H,e&&(H.name=e(E.name)),H instanceof P.c){const e=H;if(e.morphTargetManager){const H=E.morphTargetManager;e.morphTargetManager=H.clone();for(let E=0;E<H.numTargets;E++){const u=H.getTarget(E),P=e.morphTargetManager.getTarget(E);N[u.uniqueId]=P.uniqueId,z[P.uniqueId]=P}}}})(H,u),H.parent){const e=N[H.parent.uniqueId],E=z[e];u.parent=E||H.parent}if(u.position&&H.position&&u.position.P(H.position),u.rotationQuaternion&&H.rotationQuaternion&&u.rotationQuaternion.P(H.rotationQuaternion),u.rotation&&H.rotation&&u.rotation.P(H.rotation),u.UM&&H.UM&&u.UM.P(H.UM),u.material){const P=u;if(P.material)if(E){const E=H.material;if(-1===A.indexOf(E)){let H=E.clone(e?e(E.name):"Clone of "+E.name);if(A.push(E),N[E.uniqueId]=H.uniqueId,z[H.uniqueId]=H,"MultiMaterial"===E.getClassName()){const u=E;for(const E of u.hM)E&&(H=E.clone(e?e(E.name):"Clone of "+E.name),A.push(E),N[E.uniqueId]=H.uniqueId,z[H.uniqueId]=H);u.hM=u.hM.map((e=>e&&z[N[e.uniqueId]]))}}"InstancedMesh"!==P.getClassName()&&(P.material=z[N[E.uniqueId]])}else"MultiMaterial"===P.material.getClassName()?-1===this.hE.multiMaterials.indexOf(P.material)&&this.hE.addMultiMaterial(P.material):-1===this.hE.materials.indexOf(P.material)&&this.hE.addMaterial(P.material)}null===u.parent&&M.rootNodes.push(u)};for(const u of U)if("InstancedMesh"===u.getClassName()){const e=u,E=e.sourceMesh,H=N[E.uniqueId];j(e,("number"===typeof H?z[H]:E).createInstance(e.name))}else{let e=!0;"ji"===u.getClassName()||"Node"===u.getClassName()||u.skeleton||!u.getTotalVertices||0===u.getTotalVertices()?e=!1:C.doNotInstantiate&&(e="function"===typeof C.doNotInstantiate?!C.doNotInstantiate(u):!C.doNotInstantiate);const E=e?u.createInstance(`instance of ${u.name}`):u.clone(`Clone of ${u.name}`,null,!0);if(!E)throw new Error(`Could not clone or instantiate node on Asset Container ${u.name}`);j(u,E)}for(const u of this.skeletons){if(C.predicate&&!C.predicate(u))continue;const E=u.clone(e?e(u.name):"Clone of "+u.name);for(const e of this.meshes)if(e.skeleton===u&&!e.isAnInstance){const H=z[N[e.uniqueId]];if(!H||H.isAnInstance)continue;if(H.skeleton=E,-1!==D.indexOf(E))continue;D.push(E);for(const e of E.bones)e._linkedTransformNode&&(e._linkedTransformNode=z[N[e._linkedTransformNode.uniqueId]])}M.skeletons.push(E)}for(const u of this.animationGroups){if(C.predicate&&!C.predicate(u))continue;const E=u.clone(e?e(u.name):"Clone of "+u.name,(e=>z[N[e.uniqueId]]||e));M.animationGroups.push(E)}return M}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||u.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.hE.environmentTexture=this.environmentTexture);for(const e of this.hE._serializableComponents)e.addFromContainer(this);this.hE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=[];for(const H of this.cameras)e&&!e(H)||(this.hE.addCamera(H),E.push(H));for(const H of this.lights)e&&!e(H)||(this.hE.addLight(H),E.push(H));for(const H of this.meshes)e&&!e(H)||(this.hE.tA(H),E.push(H));for(const H of this.skeletons)e&&!e(H)||this.hE.addSkeleton(H);for(const H of this.animations)e&&!e(H)||this.hE.addAnimation(H);for(const H of this.animationGroups)e&&!e(H)||this.hE.addAnimationGroup(H);for(const H of this.multiMaterials)e&&!e(H)||this.hE.addMultiMaterial(H);for(const H of this.materials)e&&!e(H)||this.hE.addMaterial(H);for(const H of this.morphTargetManagers)e&&!e(H)||this.hE.addMorphTargetManager(H);for(const H of this.geometries)e&&!e(H)||this.hE.addGeometry(H);for(const H of this.transformNodes)e&&!e(H)||(this.hE.addTransformNode(H),E.push(H));for(const H of this.actionManagers)e&&!e(H)||this.hE.addActionManager(H);for(const H of this.textures)e&&!e(H)||this.hE.addTexture(H);for(const H of this.reflectionProbes)e&&!e(H)||this.hE.addReflectionProbe(H);for(const H of E)H.parent&&-1===this.hE.getNodes().indexOf(H.parent)&&(H.setParent?H.setParent(null):H.parent=null)}removeAllFromScene(){this._isValidHierarchy()||u.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.hE.environmentTexture&&(this.hE.environmentTexture=null);for(const e of this.hE._serializableComponents)e.removeFromContainer(this)}removeFromScene(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const E of this.cameras)e&&!e(E)||this.hE.removeCamera(E);for(const E of this.lights)e&&!e(E)||this.hE.removeLight(E);for(const E of this.meshes)e&&!e(E)||this.hE.IA(E,!0);for(const E of this.skeletons)e&&!e(E)||this.hE.removeSkeleton(E);for(const E of this.animations)e&&!e(E)||this.hE.removeAnimation(E);for(const E of this.animationGroups)e&&!e(E)||this.hE.removeAnimationGroup(E);for(const E of this.multiMaterials)e&&!e(E)||this.hE.removeMultiMaterial(E);for(const E of this.materials)e&&!e(E)||this.hE.removeMaterial(E);for(const E of this.morphTargetManagers)e&&!e(E)||this.hE.removeMorphTargetManager(E);for(const E of this.geometries)e&&!e(E)||this.hE.removeGeometry(E);for(const E of this.transformNodes)e&&!e(E)||this.hE.removeTransformNode(E);for(const E of this.actionManagers)e&&!e(E)||this.hE.removeActionManager(E);for(const E of this.textures)e&&!e(E)||this.hE.removeTexture(E);for(const E of this.reflectionProbes)e&&!e(E)||this.hE.removeReflectionProbe(E)}dispose(){const e=this.cameras.slice(0);for(const U of e)U.dispose();this.cameras.length=0;const E=this.lights.slice(0);for(const U of E)U.dispose();this.lights.length=0;const H=this.meshes.slice(0);for(const U of H)U.dispose();this.meshes.length=0;const N=this.skeletons.slice(0);for(const U of N)U.dispose();this.skeletons.length=0;const u=this.animationGroups.slice(0);for(const U of u)U.dispose();this.animationGroups.length=0;const z=this.multiMaterials.slice(0);for(const U of z)U.dispose();this.multiMaterials.length=0;const P=this.materials.slice(0);for(const U of P)U.dispose();this.materials.length=0;const M=this.geometries.slice(0);for(const U of M)U.dispose();this.geometries.length=0;const D=this.transformNodes.slice(0);for(const U of D)U.dispose();this.transformNodes.length=0;const A=this.actionManagers.slice(0);for(const U of A)U.dispose();this.actionManagers.length=0;const C=this.textures.slice(0);for(const U of C)U.dispose();this.textures.length=0;const i=this.reflectionProbes.slice(0);for(const U of i)U.dispose();this.reflectionProbes.length=0;const V=this.morphTargetManagers.slice(0);for(const U of V)U.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const U of this.hE._serializableComponents)U.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.hE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(e,E,H){if(e&&E)for(const N of e){let e=!0;if(H)for(const E of H)if(N===E){e=!1;break}e&&(E.push(N),N._parentContainer=this)}}moveAllFromScene(e){this._wasAddedToScene=!1,void 0===e&&(e=new h);for(const E in this)Object.prototype.hasOwnProperty.call(this,E)&&(this[E]=this[E]||("_environmentTexture"===E?null:[]),this._moveAssets(this.hE[E],this[E],e[E]));this.environmentTexture=this.hE.environmentTexture,this.removeAllFromScene()}createRootMesh(){const e=new P.c("assetContainerRootMesh",this.hE);for(const E of this.meshes)E.parent||e.addChild(E);return this.meshes.unshift(e),e}mergeAnimationsTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.d.LastCreatedScene,E=arguments.length>1?arguments[1]:void 0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return A.d.Error("No scene available to merge animations to"),[];const N=H||(E=>{let H=null;const N=E.animations.length?E.animations[0].targetProperty:"",u=E.name.split(".").join("").split("_primitive")[0];switch(N){case"position":case"rotationQuaternion":H=e.getTransformNodeByName(E.name)||e.getTransformNodeByName(u);break;case"influence":H=e.getMorphTargetByName(E.name)||e.getMorphTargetByName(u);break;default:H=e.getNodeByName(E.name)||e.getNodeByName(u)}return H}),u=this.getNodes();for(const M of u){const e=N(M);if(null!==e){for(const E of M.animations){const H=e.animations.filter((e=>e.targetProperty===E.targetProperty));for(const E of H){const H=e.animations.indexOf(E,0);H>-1&&e.animations.splice(H,1)}}e.animations=e.animations.concat(M.animations)}}const z=[],P=this.animationGroups.slice();for(const M of P){z.push(M.clone(M.name,N));for(const e of M.animatables)e.stop()}for(const M of E){const E=N(M.target);E&&(e.beginAnimation(E,M.fromFrame,M.toFrame,M.loopAnimation,M.speedRatio,M.onAnimationEnd?M.onAnimationEnd:void 0,void 0,!0,void 0,M.onAnimationLoop?M.onAnimationLoop:void 0),e.stopAnimation(M.target))}return z}populateRootNodes(){this.rootNodes.length=0;for(const e of this.meshes)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.transformNodes)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.lights)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.cameras)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)}addAllAssetsToContainer(e){if(!e)return;const E=[],H=new Set;for(E.push(e);E.length>0;){const e=E.pop();if(e instanceof P.c?(e.AM&&-1===this.geometries.indexOf(e.AM)&&this.geometries.push(e.AM),this.meshes.push(e)):e instanceof i.b?this.meshes.push(e):e instanceof M.d?this.transformNodes.push(e):e instanceof V.b?this.lights.push(e):e instanceof U.c&&this.cameras.push(e),e instanceof D.d){if(e.material&&-1===this.materials.indexOf(e.material)){this.materials.push(e.material);for(const E of e.material.getActiveTextures())-1===this.textures.indexOf(E)&&this.textures.push(E)}e.skeleton&&-1===this.skeletons.indexOf(e.skeleton)&&this.skeletons.push(e.skeleton),e.morphTargetManager&&-1===this.morphTargetManagers.indexOf(e.morphTargetManager)&&this.morphTargetManagers.push(e.morphTargetManager)}for(const N of e.getChildren())H.has(N)||E.push(N);H.add(e)}this.populateRootNodes()}_getByTags(e,E,H){if(void 0===E)return e;const N=[];for(const u in e){const z=e[u];j.c&&j.c.MatchesQuery(z,E)&&(!H||H(z))&&N.push(z)}return N}getMeshesByTags(e,E){return this._getByTags(this.meshes,e,E)}getCamerasByTags(e,E){return this._getByTags(this.cameras,e,E)}getLightsByTags(e,E){return this._getByTags(this.lights,e,E)}getMaterialsByTags(e,E){return this._getByTags(this.materials,e,E).concat(this._getByTags(this.multiMaterials,e,E))}getTransformNodesByTags(e,E){return this._getByTags(this.transformNodes,e,E)}}var a=H(11598);class W{constructor(e){this.byteOffset=0,this.buffer=e}async loadAsync(e){const E=await this.buffer.readAsync(this.byteOffset,e);this._dataView=new DataView(E.buffer,E.byteOffset,E.byteLength),this._dataByteOffset=0}readUint32(){const e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e}readUint8Array(e){const E=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,E}readString(e){return(0,a.g)(this.readUint8Array(e))}skipBytes(e){this._dataByteOffset+=e,this.byteOffset+=e}}var r=H(13343);const Y="Z2xURg",f={name:"eM",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:e=>-1!==e.indexOf("asset")&&-1!==e.indexOf("version")||e.startsWith("data:base64,"+Y)||e.startsWith("data:;base64,"+Y)||e.startsWith("data:application/octet-stream;base64,"+Y)||e.startsWith("data:model/gltf-binary;base64,"+Y)};var w,s,p,o=H(11587),y=H(11593);function b(e,E,H){try{return Promise.resolve(new Uint8Array(e,E,H))}catch(N){return Promise.reject(N)}}!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(s||(s={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(p||(p={}));class K{constructor(){this.coordinateSystemMode=w.AUTO,this.animationStartMode=s.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}P(e){e&&(this.onParsed=e.onParsed,this.coordinateSystemMode=e.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=e.animationStartMode??this.animationStartMode,this.loadNodeAnimations=e.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=e.loadSkins??this.loadSkins,this.loadMorphTargets=e.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=e.compileMaterials??this.compileMaterials,this.useClipPlane=e.useClipPlane??this.useClipPlane,this.compileShadowGenerators=e.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=e.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=e.useRangeRequests??this.useRangeRequests,this.createInstances=e.createInstances??this.createInstances,this.alwaysComputeBoundingBox=e.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=e.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=e.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=e.skipMaterials??this.skipMaterials,this.useSRGBBuffers=e.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=e.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=e.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=e.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=e.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=e.customRootNode,this.onMeshLoaded=e.onMeshLoaded,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onCameraLoaded=e.onCameraLoaded,this.extensionOptions=e.extensionOptions??this.extensionOptions)}}class l extends K{constructor(e){super(),this.onParsedObservable=new N.d,this.onMeshLoadedObservable=new N.d,this.onSkinLoadedObservable=new N.d,this.onTextureLoadedObservable=new N.d,this.onMaterialLoadedObservable=new N.d,this.onCameraLoadedObservable=new N.d,this.onCompleteObservable=new N.d,this.onErrorObservable=new N.d,this.cP=new N.d,this.onExtensionLoadedObservable=new N.d,this.validate=!1,this.onValidatedObservable=new N.d,this._loader=null,this._state=null,this._requests=new Array,this.name=f.name,this.extensions=f.extensions,this.onLoaderStateChangedObservable=new N.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.P(e)}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),e&&(this._onParsedObserver=this.onParsedObservable.add(e))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),e&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e))}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),e&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((E=>e(E.node,E.skinnedNode))))}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),e&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e))}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),e&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e))}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),e&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.cP.remove(this._onDisposeObserver),this._onDisposeObserver=this.cP.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.cP.notifyObservers(void 0),this.cP.clear()}loadFile(e,E,H,z,P,M,D,C){if(ArrayBuffer.isView(E))return this._loadBinary(e,E,H,z,D,C),null;this._progressCallback=P;const i=E.name||u.Tools.GetFilename(E);if(M){if(this.useRangeRequests){this.validate&&A.d.Warn("glTF validation is not supported when range requests are enabled");const H={abort:()=>{},onCompleteObservable:new N.d},u={readAsync:(H,N)=>new Promise(((u,z)=>{this._loadFile(e,E,(e=>{u(new Uint8Array(e))}),!0,(e=>{z(e)}),(e=>{e.setRequestHeader("Range",`bytes=${H}-${H+N-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new W(u)).then((e=>{H.onCompleteObservable.notifyObservers(H),z(e)}),D?e=>D(void 0,e):void 0),H}return this._loadFile(e,E,(E=>{this._validate(e,new Uint8Array(E,0,E.byteLength),H,i),this._unpackBinaryAsync(new W({readAsync:(e,H)=>b(E,e,H),byteLength:E.byteLength})).then((e=>{z(e)}),D?e=>D(void 0,e):void 0)}),!0,D)}return this._loadFile(e,E,(E=>{try{this._validate(e,E,H,i),z({json:this._parseJson(E)})}catch{D&&D()}}),!1,D)}_loadBinary(e,E,H,N,u,z){this._validate(e,new Uint8Array(E.buffer,E.byteOffset,E.byteLength),H,z),this._unpackBinaryAsync(new W({readAsync:(e,H)=>function(e,E,H){try{if(E<0||E>=e.byteLength)throw new RangeError("Offset is out of range.");if(E+H>e.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+E,H))}catch(N){return Promise.reject(N)}}(E,e,H),byteLength:E.byteLength})).then((e=>{N(e)}),u?e=>u(void 0,e):void 0)}importMeshAsync(e,E,H,N,u,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(H),this._loader.importMeshAsync(e,E,null,H,N,u,z))))}loadAsync(e,E,H,N,u){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(E),this._loader.loadAsync(e,E,H,N,u))))}loadAssetContainerAsync(e,E,H,N,u){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(E);const z=new X(e),P=[];this.onMaterialLoadedObservable.add((e=>{P.push(e)}));const M=[];this.onTextureLoadedObservable.add((e=>{M.push(e)}));const D=[];this.onCameraLoadedObservable.add((e=>{D.push(e)}));const A=[];return this.onMeshLoadedObservable.add((e=>{e.morphTargetManager&&A.push(e.morphTargetManager)})),this._loader.importMeshAsync(null,e,z,E,H,N,u).then((e=>(Array.prototype.push.apply(z.geometries,e.geometries),Array.prototype.push.apply(z.meshes,e.meshes),Array.prototype.push.apply(z.Ii,e.Ii),Array.prototype.push.apply(z.skeletons,e.skeletons),Array.prototype.push.apply(z.animationGroups,e.animationGroups),Array.prototype.push.apply(z.materials,P),Array.prototype.push.apply(z.textures,M),Array.prototype.push.apply(z.lights,e.lights),Array.prototype.push.apply(z.transformNodes,e.transformNodes),Array.prototype.push.apply(z.cameras,D),Array.prototype.push.apply(z.morphTargetManagers,A),z)))}))}canDirectLoad(e){return f.canDirectLoad(e)}directLoad(e,E){if(E.startsWith("base64,"+Y)||E.startsWith(";base64,"+Y)||E.startsWith("application/octet-stream;base64,"+Y)||E.startsWith("model/gltf-binary;base64,"+Y)){const H=(0,o.e)(E);return this._validate(e,new Uint8Array(H,0,H.byteLength)),this._unpackBinaryAsync(new W({readAsync:(e,E)=>b(H,e,E),byteLength:H.byteLength}))}return this._validate(e,E),Promise.resolve({json:this._parseJson(E)})}createPlugin(e){return new l(e[f.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((e,E)=>{this.onCompleteObservable.addOnce((()=>{e()})),this.onErrorObservable.addOnce((e=>{E(e)}))}))}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(p[this._state]))}_loadFile(e,E,H,N,u,z){const P=e._loadFile(E,H,(e=>{this._onProgress(e,P)}),!0,N,u,z);return P.onCompleteObservable.add((()=>{P._lengthComputable=!0,P._total=P._loaded})),this._requests.push(P),P}_onProgress(e,E){if(!this._progressCallback)return;E._lengthComputable=e.lengthComputable,E._loaded=e.loaded,E._total=e.total;let H=!0,N=0,u=0;for(const z of this._requests){if(void 0===z._lengthComputable||void 0===z._loaded||void 0===z._total)return;H=H&&z._lengthComputable,N+=z._loaded,u+=z._total}this._progressCallback({lengthComputable:H,loaded:N,total:H?u:0})}_validate(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),r.c.ValidateAsync(E,H,N,(E=>this.preprocessUrlAsync(H+E).then((E=>e._loadFileAsync(E,void 0,!0,!0).then((e=>new Uint8Array(e,0,e.byteLength))))))).then((e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()}),(e=>{this._endPerformanceCounter("Validate JSON"),u.Tools.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()})))}_getLoader(e){const E=e.json.asset||{};this._log(`Asset version: ${E.version}`),E.minVersion&&this._log(`Asset minimum version: ${E.minVersion}`),E.generator&&this._log(`Asset generator: ${E.generator}`);const H=l._parseVersion(E.version);if(!H)throw new Error("Invalid version: "+E.version);if(void 0!==E.minVersion){const e=l._parseVersion(E.minVersion);if(!e)throw new Error("Invalid minimum version: "+E.minVersion);if(l._compareVersion(e,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+E.minVersion)}const N={1:l._CreateGLTF1Loader,2:l._CreateGLTF2Loader}[H.major];if(!N)throw new Error("Unsupported version: "+E.version);return N(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const E=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),E}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((()=>{const E=e.readUint32();if(1179937895!==E)throw new y.j("Unexpected magic: "+E,y.h.GLTFLoaderUnexpectedMagicError);const H=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${H}`);const N=e.readUint32();let u;switch(this.useRangeRequests||N===e.buffer.byteLength||A.d.Warn(`Length in header does not match actual data length: ${N} != ${e.buffer.byteLength}`),H){case 1:u=this._unpackBinaryV1Async(e,N);break;case 2:u=this._unpackBinaryV2Async(e,N);break;default:throw new Error("Unsupported version: "+H)}return this._endPerformanceCounter("Unpack Binary"),u}))}_unpackBinaryV1Async(e,E){const H=e.readUint32(),N=e.readUint32();if(0!==N)throw new Error(`Unexpected content format: ${N}`);const u=E-e.byteOffset,z={json:this._parseJson(e.readString(H)),bin:null};if(0!==u){const E=e.byteOffset;z.bin={readAsync:(H,N)=>e.buffer.readAsync(E+H,N),byteLength:u}}return Promise.resolve(z)}_unpackBinaryV2Async(e,E){const H=1313821514,N=5130562,u=e.readUint32();if(e.readUint32()!==H)throw new Error("First chunk format is not JSON");return e.byteOffset+u===E?e.loadAsync(u).then((()=>({json:this._parseJson(e.readString(u)),bin:null}))):e.loadAsync(u+8).then((()=>{const z={json:this._parseJson(e.readString(u)),bin:null},P=()=>{const u=e.readUint32();switch(e.readUint32()){case H:throw new Error("Unexpected JSON chunk");case N:{const E=e.byteOffset;z.bin={readAsync:(H,N)=>e.buffer.readAsync(E+H,N),byteLength:u},e.skipBytes(u);break}default:e.skipBytes(u)}return e.byteOffset!==E?e.loadAsync(8).then(P):Promise.resolve(z)};return P()}))}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};const E=(e+"").match(/^(\d+)\.(\d+)/);return E?{major:parseInt(E[1]),minor:parseInt(E[2])}:null}static _compareVersion(e,E){return e.major>E.major?1:e.major<E.major?-1:e.minor>E.minor?1:e.minor<E.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){const E=l._logSpaces.substring(0,2*this._logIndentLevel);A.d.Log(`${E}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){u.Tools.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){u.Tools.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}l.IncrementalLoading=!0,l.HomogeneousCoordinates=!1,l._logSpaces="                                ",(0,z.e)(new l)},13343:(e,E,H)=>{"use strict";H.d(E,{c:()=>P});var N=H(11532);function u(e,E,H,N){const u={externalResourceFunction:N};return H&&(u.uri="file:"===E?H:E+H),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,u):GLTFValidator.validateString(e,u)}function z(){const e=[];onmessage=E=>{const H=E.data;switch(H.id){case"init":importScripts(H.url);break;case"validate":u(H.data,H.rootUrl,H.fileName,(E=>new Promise(((H,N)=>{const u=e.length;e.push({resolve:H,reject:N}),postMessage({id:"getExternalResource",index:u,uri:E})})))).then((e=>{postMessage({id:"validate.resolve",value:e})}),(e=>{postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[H.index].resolve(H.value);break;case"getExternalResource.reject":e[H.index].reject(H.reason)}}}class P{static ValidateAsync(e,E,H,P){return"function"===typeof Worker?new Promise(((M,D)=>{const A=`${u}(${z})()`,C=URL.createObjectURL(new Blob([A],{type:"application/javascript"})),i=new Worker(C),V=e=>{i.removeEventListener("error",V),i.removeEventListener("message",U),D(e)},U=e=>{const E=e.data;switch(E.id){case"getExternalResource":P(E.uri).then((e=>{i.postMessage({id:"getExternalResource.resolve",index:E.index,value:e},[e.buffer])}),(e=>{i.postMessage({id:"getExternalResource.reject",index:E.index,reason:e})}));break;case"validate.resolve":i.removeEventListener("error",V),i.removeEventListener("message",U),M(E.value),i.terminate();break;case"validate.reject":i.removeEventListener("error",V),i.removeEventListener("message",U),D(E.reason),i.terminate()}};if(i.addEventListener("error",V),i.addEventListener("message",U),i.postMessage({id:"init",url:N.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){const N=e.slice();i.postMessage({id:"validate",data:N,rootUrl:E,fileName:H},[N.buffer])}else i.postMessage({id:"validate",data:e,rootUrl:E,fileName:H})})):(this._LoadScriptPromise||(this._LoadScriptPromise=N.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>u(e,E,H,P))))}}P.Configuration={url:`${N.Tools._DefaultCdnUrl}/gltf_validator.js`}},13898:(e,E,H)=>{"use strict";H.d(E,{b:()=>f});var N=H(11717),u=H(11723),z=H(11776),P=H(11738),M=H(12103),D=H(12045),A=H(11818),C=H(11967),i=H(11690),V=H(11633);H(13129),H(13030),H(13048),H(13032),H(13051),H(13056),H(13061);const U="imageProcessingCompatibility",j="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";V.d.IncludesShadersStore[U]||(V.d.IncludesShadersStore[U]=j);const F="skyPixelShader",h="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";V.d.ShadersStore[F]||(V.d.ShadersStore[F]=h);H(13138),H(13067),H(13072),H(13088),H(13081);const S="skyVertexShader",X="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";V.d.ShadersStore[S]||(V.d.ShadersStore[S]=X);var a=H(12042),W=H(12085),r=H(12080);class Y extends M.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class f extends D.e{constructor(e,E){super(e,E),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new P.jE(0,100,0),this.useSunPosition=!1,this.cameraOffset=P.jE.Zero(),this.up=P.jE.Up(),this.dithering=!1,this._cameraPosition=P.jE.Zero(),this._skyOrientation=new P.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,E){const H=E._drawWrapper;if(this.isFrozen&&H.effect&&H._wasPreviouslyReady)return!0;E.materialDefines||(E.materialDefines=new Y);const N=E.materialDefines,u=this.fe();if(this._isReadyForSubMesh(E))return!0;if((0,r.U)(e,u,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,N),(0,r.K)(e,N,!0,!1),N.IMAGEPROCESSINGPOSTPROCESS!==u.imageProcessingConfiguration.applyByPostProcess&&N.markAsMiscDirty(),N.DITHER!==this.dithering&&N.markAsMiscDirty(),N.isDirty){N.markAsProcessed(),u.resetCachedMaterial();const e=new a.d;N.FOG&&e.addFallback(1,"FOG"),N.IMAGEPROCESSINGPOSTPROCESS=u.imageProcessingConfiguration.applyByPostProcess,N.DITHER=this.dithering;const H=[A.g.PositionKind];N.VERTEXCOLOR&&H.push(A.g.ColorKind);const z="sky",P=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,W.d)(P);const M=N.toString();E.setEffect(u.getEngine().createEffect(z,H,P,[],M,e,this.onCompiled,this.onError),N,this._materialContext)}return!(!E.effect||!E.effect.isReady())&&(N._renderId=u.getRenderId(),H._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,E,H){const N=this.fe(),u=H.materialDefines;if(!u)return;const z=H.effect;if(!z)return;this._activeEffect=z,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",N.getTransformMatrix()),this._mustRebind(N,z,H)&&((0,W.f)(z,this,N),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,r.j)(u,z,N)),N.fogEnabled&&E.applyFog&&N.fogMode!==C.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",N.getViewMatrix()),(0,r.d)(N,E,this._activeEffect);const M=N.activeCamera;if(M){const e=M.getWorldMatrix();this._cameraPosition.x=e.m[12],this._cameraPosition.y=e.m[13],this._cameraPosition.z=e.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const e=Math.PI*(this.inclination-.5),E=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(E)*Math.cos(e),this.sunPosition.y=this.distance*Math.sin(-e),this.sunPosition.z=this.distance*Math.sin(E)*Math.cos(e),P.Quaternion.FromUnitVectorsToRef(P.jE.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(E,this._activeEffect,H)}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return z.d.Clone((()=>new f(e,this.fe())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.SkyMaterial",e}getClassName(){return"SkyMaterial"}static Parse(e,E,H){return z.d.Parse((()=>new f(e.name,E)),e,E,H)}}(0,N.e)([(0,u.S)()],f.prototype,"luminance",void 0),(0,N.e)([(0,u.S)()],f.prototype,"turbidity",void 0),(0,N.e)([(0,u.S)()],f.prototype,"rayleigh",void 0),(0,N.e)([(0,u.S)()],f.prototype,"mieCoefficient",void 0),(0,N.e)([(0,u.S)()],f.prototype,"mieDirectionalG",void 0),(0,N.e)([(0,u.S)()],f.prototype,"distance",void 0),(0,N.e)([(0,u.S)()],f.prototype,"inclination",void 0),(0,N.e)([(0,u.S)()],f.prototype,"azimuth",void 0),(0,N.e)([(0,u.P)()],f.prototype,"sunPosition",void 0),(0,N.e)([(0,u.S)()],f.prototype,"useSunPosition",void 0),(0,N.e)([(0,u.P)()],f.prototype,"cameraOffset",void 0),(0,N.e)([(0,u.P)()],f.prototype,"up",void 0),(0,N.e)([(0,u.S)()],f.prototype,"dithering",void 0),(0,i.g)("BABYLON.SkyMaterial",f)},12417:(e,E,H)=>{"use strict";function N(e,E){E.headers=e.headers||{},E.statusMessage=e.statusText,E.statusCode=e.status,E.data=e.response}function u(e,E,H){return new Promise((function(u,z){H=H||{};var P,M,D,A=new XMLHttpRequest,C=H.body,i=H.headers||{};for(P in H.timeout&&(A.timeout=H.timeout),A.ontimeout=A.onerror=function(e){e.timeout="timeout"==e.type,z(e)},A.open(e,E.href||E),A.onload=function(){for(D=A.getAllResponseHeaders().trim().split(/[\r\n]+/),N(A,A);M=D.shift();)M=M.split(": "),A.headers[M.shift().toLowerCase()]=M.join(": ");if((M=A.headers["content-type"])&&~M.indexOf("application/json"))try{A.data=JSON.parse(A.data,H.reviver)}catch(e){return N(A,e),z(e)}(A.status>=400?z:u)(A)},typeof FormData<"u"&&C instanceof FormData||C&&"object"==typeof C&&(i["content-type"]="application/json",C=JSON.stringify(C)),A.withCredentials=!!H.withCredentials,i)A.setRequestHeader(P,i[P]);A.send(C)}))}H.r(E),H.d(E,{del:()=>D,get:()=>z,patch:()=>M,post:()=>P,put:()=>A,send:()=>u});var z=u.bind(u,"GET"),P=u.bind(u,"POST"),M=u.bind(u,"PATCH"),D=u.bind(u,"DELETE"),A=u.bind(u,"PUT")},14005:(e,E,H)=>{"use strict";H.d(E,{c:()=>i});const N=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6,z=1/3,P=1/6,M=(Math.sqrt(5)-1)/4,D=(5-Math.sqrt(5))/20,A=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),C=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const i=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const E="function"==typeof e?e:function(e){let E=0,H=0,N=0,u=1;const z=function(){let e=4022871197;return function(E){E=E.toString();for(let H=0;H<E.length;H++){e+=E.charCodeAt(H);let N=.02519603282416938*e;e=N>>>0,N-=e,N*=e,e=N>>>0,N-=e,e+=4294967296*N}return 2.3283064365386963e-10*(e>>>0)}}();E=z(" "),H=z(" "),N=z(" "),E-=z(e),E<0&&(E+=1);H-=z(e),H<0&&(H+=1);N-=z(e),N<0&&(N+=1);return function(){const e=2091639*E+2.3283064365386963e-10*u;return E=H,H=N,N=e-(u=0|e)}}(e);this.p=function(e){const E=new Uint8Array(256);for(let H=0;H<256;H++)E[H]=H;for(let H=0;H<255;H++){const N=H+~~(e()*(256-H)),u=E[H];E[H]=E[N],E[N]=u}return E}(E),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let H=0;H<512;H++)this.perm[H]=this.p[255&H],this.permMod12[H]=this.perm[H]%12}noise2D(e,E){const H=this.permMod12,z=this.perm;let P=0,M=0,D=0;const C=(e+E)*N,i=Math.floor(e+C),V=Math.floor(E+C),U=(i+V)*u,j=e-(i-U),F=E-(V-U);let h,S;j>F?(h=1,S=0):(h=0,S=1);const X=j-h+u,a=F-S+u,W=j-1+2*u,r=F-1+2*u,Y=255&i,f=255&V;let w=.5-j*j-F*F;if(w>=0){const e=3*H[Y+z[f]];w*=w,P=w*w*(A[e]*j+A[e+1]*F)}let s=.5-X*X-a*a;if(s>=0){const e=3*H[Y+h+z[f+S]];s*=s,M=s*s*(A[e]*X+A[e+1]*a)}let p=.5-W*W-r*r;if(p>=0){const e=3*H[Y+1+z[f+1]];p*=p,D=p*p*(A[e]*W+A[e+1]*r)}return 70*(P+M+D)}noise3D(e,E,H){const N=this.permMod12,u=this.perm;let M,D,C,i;const V=(e+E+H)*z,U=Math.floor(e+V),j=Math.floor(E+V),F=Math.floor(H+V),h=(U+j+F)*P,S=e-(U-h),X=E-(j-h),a=H-(F-h);let W,r,Y,f,w,s;S>=X?X>=a?(W=1,r=0,Y=0,f=1,w=1,s=0):S>=a?(W=1,r=0,Y=0,f=1,w=0,s=1):(W=0,r=0,Y=1,f=1,w=0,s=1):X<a?(W=0,r=0,Y=1,f=0,w=1,s=1):S<a?(W=0,r=1,Y=0,f=0,w=1,s=1):(W=0,r=1,Y=0,f=1,w=1,s=0);const p=S-W+P,o=X-r+P,y=a-Y+P,b=S-f+2*P,K=X-w+2*P,l=a-s+2*P,O=S-1+.5,v=X-1+.5,R=a-1+.5,T=255&U,L=255&j,d=255&F;let G=.6-S*S-X*X-a*a;if(G<0)M=0;else{const e=3*N[T+u[L+u[d]]];G*=G,M=G*G*(A[e]*S+A[e+1]*X+A[e+2]*a)}let me=.6-p*p-o*o-y*y;if(me<0)D=0;else{const e=3*N[T+W+u[L+r+u[d+Y]]];me*=me,D=me*me*(A[e]*p+A[e+1]*o+A[e+2]*y)}let Q=.6-b*b-K*K-l*l;if(Q<0)C=0;else{const e=3*N[T+f+u[L+w+u[d+s]]];Q*=Q,C=Q*Q*(A[e]*b+A[e+1]*K+A[e+2]*l)}let Z=.6-O*O-v*v-R*R;if(Z<0)i=0;else{const e=3*N[T+1+u[L+1+u[d+1]]];Z*=Z,i=Z*Z*(A[e]*O+A[e+1]*v+A[e+2]*R)}return 32*(M+D+C+i)}noise4D(e,E,H,N){const u=this.perm;let z,P,A,i,V;const U=(e+E+H+N)*M,j=Math.floor(e+U),F=Math.floor(E+U),h=Math.floor(H+U),S=Math.floor(N+U),X=(j+F+h+S)*D,a=e-(j-X),W=E-(F-X),r=H-(h-X),Y=N-(S-X);let f=0,w=0,s=0,p=0;a>W?f++:w++,a>r?f++:s++,a>Y?f++:p++,W>r?w++:s++,W>Y?w++:p++,r>Y?s++:p++;const o=f>=3?1:0,y=w>=3?1:0,b=s>=3?1:0,K=p>=3?1:0,l=f>=2?1:0,O=w>=2?1:0,v=s>=2?1:0,R=p>=2?1:0,T=f>=1?1:0,L=w>=1?1:0,d=s>=1?1:0,G=p>=1?1:0,me=a-o+D,Q=W-y+D,Z=r-b+D,k=Y-K+D,J=a-l+2*D,B=W-O+2*D,I=r-v+2*D,t=Y-R+2*D,q=a-T+3*D,c=W-L+3*D,n=r-d+3*D,g=Y-G+3*D,x=a-1+4*D,ee=W-1+4*D,Ee=r-1+4*D,He=Y-1+4*D,Ne=255&j,ue=255&F,ze=255&h,Pe=255&S;let Me=.6-a*a-W*W-r*r-Y*Y;if(Me<0)z=0;else{const e=u[Ne+u[ue+u[ze+u[Pe]]]]%32*4;Me*=Me,z=Me*Me*(C[e]*a+C[e+1]*W+C[e+2]*r+C[e+3]*Y)}let De=.6-me*me-Q*Q-Z*Z-k*k;if(De<0)P=0;else{const e=u[Ne+o+u[ue+y+u[ze+b+u[Pe+K]]]]%32*4;De*=De,P=De*De*(C[e]*me+C[e+1]*Q+C[e+2]*Z+C[e+3]*k)}let Ae=.6-J*J-B*B-I*I-t*t;if(Ae<0)A=0;else{const e=u[Ne+l+u[ue+O+u[ze+v+u[Pe+R]]]]%32*4;Ae*=Ae,A=Ae*Ae*(C[e]*J+C[e+1]*B+C[e+2]*I+C[e+3]*t)}let Ce=.6-q*q-c*c-n*n-g*g;if(Ce<0)i=0;else{const e=u[Ne+T+u[ue+L+u[ze+d+u[Pe+G]]]]%32*4;Ce*=Ce,i=Ce*Ce*(C[e]*q+C[e+1]*c+C[e+2]*n+C[e+3]*g)}let ie=.6-x*x-ee*ee-Ee*Ee-He*He;if(ie<0)V=0;else{const e=u[Ne+1+u[ue+1+u[ze+1+u[Pe+1]]]]%32*4;ie*=ie,V=ie*ie*(C[e]*x+C[e+1]*ee+C[e+2]*Ee+C[e+3]*He)}return 27*(z+P+A+i+V)}}}}]);