/*! For license information please see rei6f.32.f304e435.chunk.js.LICENSE.txt */
(self.lfntwv94xlc=self.lfntwv94xlc||[]).push([[32],{13350:(m,S,h)=>{"use strict";var l=h(13355),M=h(13361),O=h(13366);h.g.__TYPEDARRAY_POOL||(h.g.__TYPEDARRAY_POOL={UINT8:M([32,0]),UINT16:M([32,0]),UINT32:M([32,0]),INT8:M([32,0]),INT16:M([32,0]),INT32:M([32,0]),FLOAT:M([32,0]),DOUBLE:M([32,0]),DATA:M([32,0]),UINT8C:M([32,0]),BUFFER:M([32,0])});var u="undefined"!==typeof Uint8ClampedArray,b=h.g.__TYPEDARRAY_POOL;b.UINT8C||(b.UINT8C=M([32,0])),b.BUFFER||(b.BUFFER=M([32,0]));var q=b.DATA,Y=b.BUFFER;function V(m){if(m){var S=m.length||m.byteLength,h=l.log2(S);q[h].push(m)}}function I(m){m=l.nextPow2(m);var S=l.log2(m),h=q[S];return h.length>0?h.pop():new ArrayBuffer(m)}function Z(m){return new Uint8Array(I(m),0,m)}function C(m){return new Uint16Array(I(2*m),0,m)}function B(m){return new Uint32Array(I(4*m),0,m)}function D(m){return new Int8Array(I(m),0,m)}function E(m){return new Int16Array(I(2*m),0,m)}function n(m){return new Int32Array(I(4*m),0,m)}function L(m){return new Float32Array(I(4*m),0,m)}function U(m){return new Float64Array(I(8*m),0,m)}function H(m){return u?new Uint8ClampedArray(I(m),0,m):Z(m)}function R(m){return new DataView(I(m),0,m)}S.free=function(m){if(O(m))Y[l.log2(m.length)].push(m);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(m)&&(m=m.buffer),!m)return;var S=m.length||m.byteLength,h=0|l.log2(S);q[h].push(m)}},S.freeUint8=S.freeUint16=S.freeUint32=S.freeInt8=S.freeInt16=S.freeInt32=S.freeFloat32=S.freeFloat=S.freeFloat64=S.freeDouble=S.freeUint8Clamped=S.freeDataView=function(m){V(m.buffer)},S.freeArrayBuffer=V,S.freeBuffer=function(m){Y[l.log2(m.length)].push(m)},S.malloc=function(m,S){if(void 0===S||"arraybuffer"===S)return I(m);switch(S){case"uint8":return Z(m);case"uint16":return C(m);case"uint32":return B(m);case"int8":return D(m);case"int16":return E(m);case"int32":return n(m);case"float":case"float32":return L(m);case"double":case"float64":return U(m);case"uint8_clamped":return H(m);case"buffer":throw"Buffer not supported";case"data":case"dataview":return R(m);default:return null}return null},S.mallocArrayBuffer=I,S.mallocUint8=Z,S.mallocUint16=C,S.mallocUint32=B,S.mallocInt8=D,S.mallocInt16=E,S.mallocInt32=n,S.mallocFloat32=S.mallocFloat=L,S.mallocFloat64=S.mallocDouble=U,S.mallocUint8Clamped=H,S.mallocDataView=R,S.clearCache=function(){for(var m=0;m<32;++m)b.UINT8[m].length=0,b.UINT16[m].length=0,b.UINT32[m].length=0,b.INT8[m].length=0,b.INT16[m].length=0,b.INT32[m].length=0,b.FLOAT[m].length=0,b.DOUBLE[m].length=0,b.UINT8C[m].length=0,q[m].length=0,Y[m].length=0}},13433:(m,S,h)=>{m.exports=M;var l=h(12155);function M(m,S){if(!(this instanceof M))return new M(m,S);var h=l.create();l.add(h,m,S),this.base=l.min(l.create(),m,h),this.HV=l.clone(S),this.max=l.max(l.create(),m,h),this.mag=l.length(this.HV)}var O=M.prototype;O.width=function(){return this.HV[0]},O.height=function(){return this.HV[1]},O.depth=function(){return this.HV[2]},O.x0=function(){return this.base[0]},O.y0=function(){return this.base[1]},O.z0=function(){return this.base[2]},O.x1=function(){return this.max[0]},O.y1=function(){return this.max[1]},O.z1=function(){return this.max[2]},O.translate=function(m){return l.add(this.max,this.max,m),l.add(this.base,this.base,m),this},O.setPosition=function(m){return l.add(this.max,m,this.HV),l.i(this.base,m),this},O.expand=function(m){var S=l.create(),h=l.create();return l.max(S,m.max,this.max),l.min(h,m.base,this.base),l.LS(S,S,h),new M(h,S)},O.intersects=function(m){return!(m.base[0]>this.max[0])&&(!(m.base[1]>this.max[1])&&(!(m.base[2]>this.max[2])&&(!(m.max[0]<this.base[0])&&(!(m.max[1]<this.base[1])&&!(m.max[2]<this.base[2])))))},O.touches=function(m){var S=this.union(m);return null!==S&&(0==S.width()||0==S.height()||0==S.depth())},O.union=function(m){if(!this.intersects(m))return null;var S=Math.max(m.base[0],this.base[0]),h=Math.max(m.base[1],this.base[1]),l=Math.max(m.base[2],this.base[2]);return new M([S,h,l],[Math.min(m.max[0],this.max[0])-S,Math.min(m.max[1],this.max[1])-h,Math.min(m.max[2],this.max[2])-l])}},13355:(m,S)=>{"use strict";function h(m){var S=32;return(m&=-m)&&S--,65535&m&&(S-=16),16711935&m&&(S-=8),252645135&m&&(S-=4),858993459&m&&(S-=2),1431655765&m&&(S-=1),S}S.INT_BITS=32,S.INT_MAX=2147483647,S.INT_MIN=-1<<31,S.sign=function(m){return(m>0)-(m<0)},S.abs=function(m){var S=m>>31;return(m^S)-S},S.min=function(m,S){return S^(m^S)&-(m<S)},S.max=function(m,S){return m^(m^S)&-(m<S)},S.isPow2=function(m){return!(m&m-1)&&!!m},S.log2=function(m){var S,h;return S=(m>65535)<<4,S|=h=((m>>>=S)>255)<<3,S|=h=((m>>>=h)>15)<<2,(S|=h=((m>>>=h)>3)<<1)|(m>>>=h)>>1},S.log10=function(m){return m>=1e9?9:m>=1e8?8:m>=1e7?7:m>=1e6?6:m>=1e5?5:m>=1e4?4:m>=1e3?3:m>=100?2:m>=10?1:0},S.popCount=function(m){return 16843009*((m=(858993459&(m-=m>>>1&1431655765))+(m>>>2&858993459))+(m>>>4)&252645135)>>>24},S.countTrailingZeros=h,S.nextPow2=function(m){return m+=0===m,--m,m|=m>>>1,m|=m>>>2,m|=m>>>4,m|=m>>>8,(m|=m>>>16)+1},S.prevPow2=function(m){return m|=m>>>1,m|=m>>>2,m|=m>>>4,m|=m>>>8,(m|=m>>>16)-(m>>>1)},S.parity=function(m){return m^=m>>>16,m^=m>>>8,m^=m>>>4,27030>>>(m&=15)&1};var l=new Array(256);!function(m){for(var S=0;S<256;++S){var h=S,l=S,M=7;for(h>>>=1;h;h>>>=1)l<<=1,l|=1&h,--M;m[S]=l<<M&255}}(l),S.reverse=function(m){return l[255&m]<<24|l[m>>>8&255]<<16|l[m>>>16&255]<<8|l[m>>>24&255]},S.interleave2=function(m,S){return(m=1431655765&((m=858993459&((m=252645135&((m=16711935&((m&=65535)|m<<8))|m<<4))|m<<2))|m<<1))|(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))<<1},S.deinterleave2=function(m,S){return(m=65535&((m=16711935&((m=252645135&((m=858993459&((m=m>>>S&1431655765)|m>>>1))|m>>>2))|m>>>4))|m>>>16))<<16>>16},S.interleave3=function(m,S,h){return m=1227133513&((m=3272356035&((m=251719695&((m=4278190335&((m&=1023)|m<<16))|m<<8))|m<<4))|m<<2),(m|=(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},S.deinterleave3=function(m,S){return(m=1023&((m=4278190335&((m=251719695&((m=3272356035&((m=m>>>S&1227133513)|m>>>2))|m>>>4))|m>>>8))|m>>>16))<<22>>22},S.nextCombination=function(m){var S=m|m-1;return S+1|(~S&-~S)-1>>>h(m)+1}},13348:(m,S,h)=>{"use strict";m.exports=function(m,S,h){switch(arguments.length){case 1:return l=[],Y(M=m,M,V,!0),l;case 2:return"function"===typeof S?Y(m,m,S,!0):function(m,S){return l=[],Y(m,S,V,!1),l}(m,S);case 3:return Y(m,S,h,!1);default:throw new Error("box-intersect: Invalid arguments")}var M};var l,M=h(13350),O=h(13370),u=h(13379);function b(m,S){for(var h=0;h<m;++h)if(!(S[h]<=S[h+m]))return!0;return!1}function q(m,S,h,l){for(var M=0,O=0,u=0,q=m.length;u<q;++u){var Y=m[u];if(!b(S,Y)){for(var V=0;V<2*S;++V)h[M++]=Y[V];l[O++]=u}}return O}function Y(m,S,h,l){var b=m.length,Y=S.length;if(!(b<=0||Y<=0)){var V=m[0].length>>>1;if(!(V<=0)){var I,Z=M.mallocDouble(2*V*b),C=M.mallocInt32(b);if((b=q(m,V,Z,C))>0){if(1===V&&l)O.init(b),I=O.sweepComplete(V,h,0,b,Z,C,0,b,Z,C);else{var B=M.mallocDouble(2*V*Y),D=M.mallocInt32(Y);(Y=q(S,V,B,D))>0&&(O.init(b+Y),I=1===V?O.sweepBipartite(V,h,0,b,Z,C,0,Y,B,D):u(V,h,l,b,Z,C,Y,B,D),M.free(B),M.free(D))}M.free(Z),M.free(C)}return I}}}function V(m,S){l.push([m,S])}},13382:(m,S)=>{"use strict";var h="d",l="ax",M="fp",O="es",u="rs",b="re",q="rb",Y="bs",V="be",I="bb",Z=[h,l,"vv",u,b,q,"ri",Y,V,I,"bi"];function C(m){var S="bruteForce"+(m?"Full":"Partial"),l=[],u=Z.slice();m||u.splice(3,0,M);var b=["function "+S+"("+u.join()+"){"];function q(S,M){var u=function(m,S,l){var M="bruteForce"+(m?"Red":"Blue")+(S?"Flip":"")+(l?"Full":""),u=["function ",M,"(",Z.join(),"){","var ",O,"=2*",h,";"],b="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",q="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(l?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return m?u.push(b,"Q",":",q):u.push(q,"Q",":",b),l?u.push("if(y1<x0||x1<y0)continue;"):S?u.push("if(y0<=x0||x1<y0)continue;"):u.push("if(y0<x0||x1<y0)continue;"),u.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),S?u.push("yi,xi"):u.push("xi,yi"),u.push(");if(rv!==void 0)return rv;}}}"),{name:M,code:u.join("")}}(S,M,m);l.push(u.code),b.push("return "+u.name+"("+Z.join()+");")}b.push("if(re-rs>be-bs){"),m?(q(!0,!1),b.push("}else{"),q(!1,!1)):(b.push("if(fp){"),q(!0,!0),b.push("}else{"),q(!0,!1),b.push("}}else{if(fp){"),q(!1,!0),b.push("}else{"),q(!1,!1),b.push("}")),b.push("}}return "+S);var Y=l.join("")+b.join("");return new Function(Y)()}S.partial=C(!1),S.full=C(!0)},13379:(m,S,h)=>{"use strict";m.exports=function(m,S,h,O,V,X,g,G,e){!function(m,S){var h=8*M.log2(S+1)*(m+1)|0,O=M.nextPow2(H*h);y.length<O&&(l.free(y),y=l.mallocInt32(O));var u=M.nextPow2(R*h);o.length<u&&(l.free(o),o=l.mallocDouble(u))}(m,O+g);var a,x=0,P=2*m;s(x++,0,0,O,0,g,h?16:0,-1/0,1/0),h||s(x++,0,0,g,0,O,1,-1/0,1/0);for(;x>0;){var d=(x-=1)*H,J=y[d],N=y[d+1],j=y[d+2],K=y[d+3],c=y[d+4],f=y[d+5],p=x*R,k=o[p],r=o[p+1],z=1&f,Q=!!(16&f),F=V,w=X,t=G,A=e;if(z&&(F=G,w=e,t=V,A=X),!(2&f&&N>=(j=E(m,J,N,j,F,w,r)))&&!(4&f&&(N=n(m,J,N,j,F,w,k))>=j)){var i=j-N,W=c-K;if(Q){if(m*i*(i+W)<C){if(void 0!==(a=q.scanComplete(m,J,S,N,j,F,w,K,c,t,A)))return a;continue}}else{if(m*Math.min(i,W)<I){if(void 0!==(a=u(m,J,S,z,N,j,F,w,K,c,t,A)))return a;continue}if(m*i*W<Z){if(void 0!==(a=q.scanBipartite(m,J,S,z,N,j,F,w,K,c,t,A)))return a;continue}}var mm=B(m,J,N,j,F,w,k,r);if(N<mm)if(m*(mm-N)<I){if(void 0!==(a=b(m,J+1,S,N,mm,F,w,K,c,t,A)))return a}else if(J===m-2){if(void 0!==(a=z?q.sweepBipartite(m,S,K,c,t,A,N,mm,F,w):q.sweepBipartite(m,S,N,mm,F,w,K,c,t,A)))return a}else s(x++,J+1,N,mm,K,c,z,-1/0,1/0),s(x++,J+1,K,c,N,mm,1^z,-1/0,1/0);if(mm<j){var Sm=Y(m,J,K,c,t,A),hm=t[P*Sm+J],lm=D(m,J,Sm,c,t,A,hm);if(lm<c&&s(x++,J,mm,j,lm,c,(4|z)+(Q?16:0),hm,r),K<Sm&&s(x++,J,mm,j,K,Sm,(2|z)+(Q?16:0),k,hm),Sm+1===lm){if(void 0!==(a=Q?T(m,J,S,mm,j,F,w,Sm,t,A[Sm]):v(m,J,S,z,mm,j,F,w,Sm,t,A[Sm])))return a}else if(Sm<lm){var Mm;if(Q){if(mm<(Mm=L(m,J,mm,j,F,w,hm))){var Om=D(m,J,mm,Mm,F,w,hm);if(J===m-2){if(mm<Om&&void 0!==(a=q.sweepComplete(m,S,mm,Om,F,w,Sm,lm,t,A)))return a;if(Om<Mm&&void 0!==(a=q.sweepBipartite(m,S,Om,Mm,F,w,Sm,lm,t,A)))return a}else mm<Om&&s(x++,J+1,mm,Om,Sm,lm,16,-1/0,1/0),Om<Mm&&(s(x++,J+1,Om,Mm,Sm,lm,0,-1/0,1/0),s(x++,J+1,Sm,lm,Om,Mm,1,-1/0,1/0))}}else mm<(Mm=z?U(m,J,mm,j,F,w,hm):L(m,J,mm,j,F,w,hm))&&(J===m-2?a=z?q.sweepBipartite(m,S,Sm,lm,t,A,mm,Mm,F,w):q.sweepBipartite(m,S,mm,Mm,F,w,Sm,lm,t,A):(s(x++,J+1,mm,Mm,Sm,lm,z,-1/0,1/0),s(x++,J+1,Sm,lm,mm,Mm,1^z,-1/0,1/0)))}}}}};var l=h(13350),M=h(13355),O=h(13382),u=O.partial,b=O.full,q=h(13370),Y=h(13385),V=h(13387),I=128,Z=1<<22,C=1<<22,B=V("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),D=V("lo===p0",["p0"]),E=V("lo<p0",["p0"]),n=V("hi<=p0",["p0"]),L=V("lo<=p0&&p0<=hi",["p0"]),U=V("lo<p0&&p0<=hi",["p0"]),H=6,R=2,y=l.mallocInt32(1024),o=l.mallocDouble(1024);function s(m,S,h,l,M,O,u,b,q){var Y=H*m;y[Y]=S,y[Y+1]=h,y[Y+2]=l,y[Y+3]=M,y[Y+4]=O,y[Y+5]=u;var V=R*m;o[V]=b,o[V+1]=q}function v(m,S,h,l,M,O,u,b,q,Y,V){var I=2*m,Z=q*I,C=Y[Z+S];m:for(var B=M,D=M*I;B<O;++B,D+=I){var E=u[D+S],n=u[D+S+m];if(!(C<E||n<C)&&(!l||C!==E)){for(var L,U=b[B],H=S+1;H<m;++H){E=u[D+H],n=u[D+H+m];var R=Y[Z+H],y=Y[Z+H+m];if(n<R||y<E)continue m}if(void 0!==(L=l?h(V,U):h(U,V)))return L}}}function T(m,S,h,l,M,O,u,b,q,Y){var V=2*m,I=b*V,Z=q[I+S];m:for(var C=l,B=l*V;C<M;++C,B+=V){var D=u[C];if(D!==Y){var E=O[B+S],n=O[B+S+m];if(!(Z<E||n<Z)){for(var L=S+1;L<m;++L){E=O[B+L],n=O[B+L+m];var U=q[I+L],H=q[I+L+m];if(n<U||H<E)continue m}var R=h(D,Y);if(void 0!==R)return R}}}}},13385:(m,S,h)=>{"use strict";m.exports=function(m,S,h,u,b,q){if(u<=h+1)return h;var Y=h,V=u,I=u+h>>>1,Z=2*m,C=I,B=b[Z*I+S];for(;Y<V;){if(V-Y<M){O(m,S,Y,V,b,q),B=b[Z*I+S];break}var D=V-Y,E=Math.random()*D+Y|0,n=b[Z*E+S],L=Math.random()*D+Y|0,U=b[Z*L+S],H=Math.random()*D+Y|0,R=b[Z*H+S];n<=U?R>=U?(C=L,B=U):n>=R?(C=E,B=n):(C=H,B=R):U>=R?(C=L,B=U):R>=n?(C=E,B=n):(C=H,B=R);for(var y=Z*(V-1),o=Z*C,s=0;s<Z;++s,++y,++o){var v=b[y];b[y]=b[o],b[o]=v}var T=q[V-1];q[V-1]=q[C],q[C]=T;for(y=Z*(V-1),o=Z*(C=l(m,S,Y,V-1,b,q,B)),s=0;s<Z;++s,++y,++o){v=b[y];b[y]=b[o],b[o]=v}T=q[V-1];if(q[V-1]=q[C],q[C]=T,I<C){for(V=C-1;Y<V&&b[Z*(V-1)+S]===B;)V-=1;V+=1}else{if(!(C<I))break;for(Y=C+1;Y<V&&b[Z*Y+S]===B;)Y+=1}}return l(m,S,h,I,b,q,b[Z*I+S])};var l=h(13387)("lo<p0",["p0"]),M=8;function O(m,S,h,l,M,O){for(var u=2*m,b=u*(h+1)+S,q=h+1;q<l;++q,b+=u)for(var Y=M[b],V=q,I=u*(q-1);V>h&&M[I+S]>Y;--V,I-=u){for(var Z=I,C=I+u,B=0;B<u;++B,++Z,++C){var D=M[Z];M[Z]=M[C],M[C]=D}var E=O[V];O[V]=O[V-1],O[V-1]=E}}},13387:m=>{"use strict";m.exports=function(m,h){var l="abcdef".split("").concat(h),M=[];m.indexOf("lo")>=0&&M.push("lo=e[k+n]");m.indexOf("hi")>=0&&M.push("hi=e[k+o]");return l.push(S.replace("_",M.join()).replace("$",m)),Function.apply(void 0,l)};var S="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13373:m=>{"use strict";m.exports=function(m,l){l<=4*S?h(0,l-1,m):Y(0,l-1,m)};var S=32;function h(m,S,h){for(var l=2*(m+1),M=m+1;M<=S;++M){for(var O=h[l++],u=h[l++],b=M,q=l-2;b-- >m;){var Y=h[q-2],V=h[q-1];if(Y<O)break;if(Y===O&&V<u)break;h[q]=Y,h[q+1]=V,q-=2}h[q]=O,h[q+1]=u}}function l(m,S,h){S*=2;var l=h[m*=2],M=h[m+1];h[m]=h[S],h[m+1]=h[S+1],h[S]=l,h[S+1]=M}function M(m,S,h){S*=2,h[m*=2]=h[S],h[m+1]=h[S+1]}function O(m,S,h,l){S*=2,h*=2;var M=l[m*=2],O=l[m+1];l[m]=l[S],l[m+1]=l[S+1],l[S]=l[h],l[S+1]=l[h+1],l[h]=M,l[h+1]=O}function u(m,S,h,l,M){S*=2,M[m*=2]=M[S],M[S]=h,M[m+1]=M[S+1],M[S+1]=l}function b(m,S,h){S*=2;var l=h[m*=2],M=h[S];return!(l<M)&&(l!==M||h[m+1]>h[S+1])}function q(m,S,h,l){var M=l[m*=2];return M<S||M===S&&l[m+1]<h}function Y(m,V,I){var Z=(V-m+1)/6|0,C=m+Z,B=V-Z,D=m+V>>1,E=D-Z,n=D+Z,L=C,U=E,H=D,R=n,y=B,o=m+1,s=V-1,v=0;b(L,U,I)&&(v=L,L=U,U=v),b(R,y,I)&&(v=R,R=y,y=v),b(L,H,I)&&(v=L,L=H,H=v),b(U,H,I)&&(v=U,U=H,H=v),b(L,R,I)&&(v=L,L=R,R=v),b(H,R,I)&&(v=H,H=R,R=v),b(U,y,I)&&(v=U,U=y,y=v),b(U,H,I)&&(v=U,U=H,H=v),b(R,y,I)&&(v=R,R=y,y=v);for(var T=I[2*U],X=I[2*U+1],g=I[2*R],G=I[2*R+1],e=2*L,a=2*H,x=2*y,P=2*C,d=2*D,J=2*B,N=0;N<2;++N){var j=I[e+N],K=I[a+N],c=I[x+N];I[P+N]=j,I[d+N]=K,I[J+N]=c}M(E,m,I),M(n,V,I);for(var f=o;f<=s;++f)if(q(f,T,X,I))f!==o&&l(f,o,I),++o;else if(!q(f,g,G,I))for(;;){if(q(s,g,G,I)){q(s,T,X,I)?(O(f,o,s,I),++o,--s):(l(f,s,I),--s);break}if(--s<f)break}u(m,o-1,T,X,I),u(V,s+1,g,G,I),o-2-m<=S?h(m,o-2,I):Y(m,o-2,I),V-(s+2)<=S?h(s+2,V,I):Y(s+2,V,I),s-o<=S?h(o,s,I):Y(o,s,I)}},13370:(m,S,h)=>{"use strict";m.exports={init:function(m){var S=M.nextPow2(m);q.length<S&&(l.free(q),q=l.mallocInt32(S));Y.length<S&&(l.free(Y),Y=l.mallocInt32(S));V.length<S&&(l.free(V),V=l.mallocInt32(S));I.length<S&&(l.free(I),I=l.mallocInt32(S));Z.length<S&&(l.free(Z),Z=l.mallocInt32(S));C.length<S&&(l.free(C),C=l.mallocInt32(S));var h=8*S;B.length<h&&(l.free(B),B=l.mallocDouble(h))},sweepBipartite:function(m,S,h,l,M,b,Z,C,n,L){for(var U=0,H=2*m,R=m-1,y=H-1,o=h;o<l;++o){var s=b[o],v=H*o;B[U++]=M[v+R],B[U++]=-(s+1),B[U++]=M[v+y],B[U++]=s}for(o=Z;o<C;++o){s=L[o]+u;var T=H*o;B[U++]=n[T+R],B[U++]=-s,B[U++]=n[T+y],B[U++]=s}var X=U>>>1;O(B,X);var g=0,G=0;for(o=0;o<X;++o){var e=0|B[2*o+1];if(e>=u)D(V,I,G--,e=e-u|0);else if(e>=0)D(q,Y,g--,e);else if(e<=-u){e=-e-u|0;for(var a=0;a<g;++a){if(void 0!==(x=S(q[a],e)))return x}E(V,I,G++,e)}else{e=-e-1|0;for(a=0;a<G;++a){var x;if(void 0!==(x=S(e,V[a])))return x}E(q,Y,g++,e)}}},sweepComplete:function(m,S,h,l,M,u,b,n,L,U){for(var H=0,R=2*m,y=m-1,o=R-1,s=h;s<l;++s){var v=u[s]+1<<1,T=R*s;B[H++]=M[T+y],B[H++]=-v,B[H++]=M[T+o],B[H++]=v}for(s=b;s<n;++s){v=U[s]+1<<1;var X=R*s;B[H++]=L[X+y],B[H++]=1|-v,B[H++]=L[X+o],B[H++]=1|v}var g=H>>>1;O(B,g);var G=0,e=0,a=0;for(s=0;s<g;++s){var x=0|B[2*s+1],P=1&x;if(s<g-1&&x>>1===B[2*s+3]>>1&&(P=2,s+=1),x<0){for(var d=-(x>>1)-1,J=0;J<a;++J){if(void 0!==(N=S(Z[J],d)))return N}if(0!==P)for(J=0;J<G;++J){if(void 0!==(N=S(q[J],d)))return N}if(1!==P)for(J=0;J<e;++J){var N;if(void 0!==(N=S(V[J],d)))return N}0===P?E(q,Y,G++,d):1===P?E(V,I,e++,d):2===P&&E(Z,C,a++,d)}else{d=(x>>1)-1;0===P?D(q,Y,G--,d):1===P?D(V,I,e--,d):2===P&&D(Z,C,a--,d)}}},scanBipartite:function(m,S,h,l,M,b,V,I,Z,C,n,L){var U=0,H=2*m,R=S,y=S+m,o=1,s=1;l?s=u:o=u;for(var v=M;v<b;++v){var T=v+o,X=H*v;B[U++]=V[X+R],B[U++]=-T,B[U++]=V[X+y],B[U++]=T}for(v=Z;v<C;++v){T=v+s;var g=H*v;B[U++]=n[g+R],B[U++]=-T}var G=U>>>1;O(B,G);var e=0;for(v=0;v<G;++v){var a=0|B[2*v+1];if(a<0){var x=!1;if((T=-a)>=u?(x=!l,T-=u):(x=!!l,T-=1),x)E(q,Y,e++,T);else{var P=L[T],d=H*T,J=n[d+S+1],N=n[d+S+1+m];m:for(var j=0;j<e;++j){var K=q[j],c=H*K;if(!(N<V[c+S+1]||V[c+S+1+m]<J)){for(var f=S+2;f<m;++f)if(n[d+f+m]<V[c+f]||V[c+f+m]<n[d+f])continue m;var p,k=I[K];if(void 0!==(p=l?h(P,k):h(k,P)))return p}}}}else D(q,Y,e--,a-o)}},scanComplete:function(m,S,h,l,M,b,Y,V,I,Z,C){for(var D=0,E=2*m,n=S,L=S+m,U=l;U<M;++U){var H=U+u,R=E*U;B[D++]=b[R+n],B[D++]=-H,B[D++]=b[R+L],B[D++]=H}for(U=V;U<I;++U){H=U+1;var y=E*U;B[D++]=Z[y+n],B[D++]=-H}var o=D>>>1;O(B,o);var s=0;for(U=0;U<o;++U){var v=0|B[2*U+1];if(v<0){if((H=-v)>=u)q[s++]=H-u;else{var T=C[H-=1],X=E*H,g=Z[X+S+1],G=Z[X+S+1+m];m:for(var e=0;e<s;++e){var a=q[e],x=Y[a];if(x===T)break;var P=E*a;if(!(G<b[P+S+1]||b[P+S+1+m]<g)){for(var d=S+2;d<m;++d)if(Z[X+d+m]<b[P+d]||b[P+d+m]<Z[X+d])continue m;var J=h(x,T);if(void 0!==J)return J}}}}else{for(H=v-u,e=s-1;e>=0;--e)if(q[e]===H){for(d=e+1;d<s;++d)q[d-1]=q[d];break}--s}}}};var l=h(13350),M=h(13355),O=h(13373),u=1<<28,b=1024,q=l.mallocInt32(b),Y=l.mallocInt32(b),V=l.mallocInt32(b),I=l.mallocInt32(b),Z=l.mallocInt32(b),C=l.mallocInt32(b),B=l.mallocDouble(8192);function D(m,S,h,l){var M=S[l],O=m[h-1];m[M]=O,S[O]=M}function E(m,S,h,l){m[h]=l,S[l]=h}},13361:m=>{"use strict";function S(m,h,l){var M=0|m[l];if(M<=0)return[];var O,u=new Array(M);if(l===m.length-1)for(O=0;O<M;++O)u[O]=h;else for(O=0;O<M;++O)u[O]=S(m,h,l+1);return u}m.exports=function(m,h){switch("undefined"===typeof h&&(h=0),typeof m){case"number":if(m>0)return function(m,S){var h,l;for(h=new Array(m),l=0;l<m;++l)h[l]=S;return h}(0|m,h);break;case"object":if("number"===typeof m.length)return S(m,h,0)}return[]}},13317:(m,S,h)=>{m.exports=function(){var m=this;this.components={},this.comps=this.components;var S=this.components,h=1,M={},O=[],u=[],b={timeout:!1,removals:[],multiComps:[]};function q(m,h){var l=S[h],O=M[h],u=O.hash[m];u&&(O.remove(m),l.mh&&(l.multi?(u.forEach((S=>{S&&l.mh(m,S)})),u.length=0):l.mh(m,u)),b.removals.push(O),Y())}function Y(){b.timeout||(b.timeout=!0,setTimeout(V,1))}function V(){b.timeout=!1,I()}function I(){b.multiComps.length&&function(m){for(var S=0;S<m.length;S++){var{entID:h,data:l}=m[S],M=l.hash[h];if(M){for(var O=0;O<M.length;O++)M[O]||(M.splice(O,1),O--);0===M.length&&(l.remove(h),b.removals.push(l))}}m.length=0}(b.multiComps),b.removals.length&&function(m){for(var S=0;S<m.length;S++){m[S].flush()}m.length=0}(b.removals)}this.JI=M,this._systems=O,this._renderSystems=u,this.oV=function(S){var l=h++;return Array.isArray(S)&&S.forEach((S=>m.uY(l,S))),l},this.deleteEntity=function(S){return Object.keys(M).forEach((m=>{M[m].hash[S]&&q(S,m)})),m},this.KV=function(m){if(!m)throw new Error("Missing component definition");var h=m.name;if(!h)throw new Error("Component definition must have a name property.");if("string"!==typeof h)throw new Error("Component name must be a string.");if(""===h)throw new Error("Component name must be a non-empty string.");if(M[h])throw new Error(`Component ${h} already exists.`);var b={};return b.name=h,b.multi=!!m.multi,b.order=isNaN(m.order)?99:m.order,b.stateConstructor=m.stateConstructor||null,b.state=m.state||{},b.Mq=m.Mq||null,b.mh=m.mh||null,b.system=m.system||null,b.Vq=m.Vq||null,S[h]=b,M[h]=new l,M[h]._pendingMultiCleanup=!1,M[h]._multiCleanupIDs=b.multi?[]:null,b.system&&(O.push(h),O.sort(((m,h)=>S[m].order-S[h].order))),b.Vq&&(u.push(h),u.sort(((m,h)=>S[m].order-S[h].order))),h},this.overwriteComponent=function(m,h){var l=S[m];if(!l)throw new Error(`Unknown component: ${m}`);if(!h)throw new Error("Missing component definition");if(l.name!==h.name)throw new Error("Overwriting component must use the same name property.");var b={};b.name=m,b.multi=!!h.multi,b.order=isNaN(h.order)?99:h.order,b.state=h.state||{},b.Mq=h.Mq||null,b.mh=h.mh||null,b.system=h.system||null,b.Vq=h.Vq||null,S[m]=b,M[m]._pendingMultiCleanup=!1,M[m]._multiCleanupIDs=b.multi?[]:null;var q=O.indexOf(m);b.system&&q<0&&O.push(m),!b.system&&q>=0&&O.splice(q,1),O.sort(((m,h)=>S[m].order-S[h].order));var Y=u.indexOf(m);b.Vq&&Y<0&&u.push(m),!b.Vq&&Y>=0&&u.splice(Y,1),u.sort(((m,h)=>S[m].order-S[h].order));var V=b.state;return this.OV(m).forEach((m=>{for(var S in V)S in m||(m[S]=V[S]);b.Mq&&b.Mq(m.qq,m)})),m},this.deleteComponent=function(h){var l=M[h];if(!l)throw new Error(`Unknown component: ${h}`);l.flush(),l.list.forEach((m=>{m&&q(m.qq||m[0].qq,h)}));var b=O.indexOf(h),Y=u.indexOf(h);return b>-1&&O.splice(b,1),Y>-1&&u.splice(Y,1),M[h].dispose(),delete M[h],delete S[h],m},this.uY=function(m,h,l){var O,u=S[h],b=M[h];if(!b)throw new Error(`Unknown component: ${h}.`);if(b.hash[m]&&!u.multi)throw new Error(`Entity ${m} already has component: ${h}.`);if(u.stateConstructor){if(!(O=new u.stateConstructor).hasOwnProperty("qq"))throw new Error(`Component ${u.name} stateConstructor type does not have property __id`)}else O=Object.assign({},{qq:m},u.state,l);if(O.qq=m,u.multi){var q=b.hash[m];q||(q=[],b.add(m,q)),q.push(O)}else b.add(m,O);return u.Mq&&u.Mq(m,O),this},this.EY=function(m,S){var h=M[S];if(!h)throw new Error(`Unknown component: ${S}.`);return!!h.hash[m]},this.VY=function(S,h){if(!M[h])throw new Error(`Unknown component: ${h}.`);return q(S,h),m},this.getState=function(m,S){var h=M[S];if(!h)throw new Error(`Unknown component: ${S}.`);return h.hash[m]},this.OV=function(m){var S=M[m];if(!S)throw new Error(`Unknown component: ${m}.`);return I(),S.list},this.sC=function(m){if(!M[m])throw new Error(`Unknown component: ${m}.`);var S=M[m].hash;return m=>S[m]},this.XC=function(m){if(!M[m])throw new Error(`Unknown component: ${m}.`);var S=M[m].hash;return m=>!!S[m]},this.wb=function(h){I();for(var l=0;l<O.length;l++){var u=O[l],b=S[u],q=M[u];b.system(h,q.list),I()}return m},this.render=function(h){I();for(var l=0;l<u.length;l++){var O=u[l],b=S[O],q=M[O];b.Vq(h,q.list),I()}return m},this.removeMultiComponent=function(h,l,O){var u=S[l],q=M[l];if(!q)throw new Error(`Unknown component: ${l}.`);if(!u.multi)throw new Error("removeMultiComponent called on non-multi component");return function(m,S,h,l){var M=h.hash[m];if(M){var O=M[l];O&&(M[l]=null,S.mh&&S.mh(m,O),b.multiComps.push({entID:m,data:h}),Y())}}(h,u,q,O),m}};var l=h(13324)},13324:m=>{function S(m,S){var h=m._map[S];if(delete m.hash[S],delete m._map[S],h===m.list.length-1)m.list.pop();else{var l=m.list.pop();if(m.list[h]=l,null===l||null===l[0]){var M=m.list.length;for(var O in m._map)if(m._map[O]===M)return void(m._map[O]=h)}else{var u=l.qq||l[0].qq;m._map[u]=h}}}m.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(m,S){if("number"===typeof this._map[m]){var h=this._map[m];this.hash[m]=S,this.list[h]=S}else this._map[m]=this.list.length,this.hash[m]=S,this.list.push(S)}remove(m){var S=this._map[m];this.hash[m]=null,this.list[S]=null,this._pendingRemovals.push(m)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var m=0;m<this._pendingRemovals.length;m++){var h=this._pendingRemovals[m];null===this.hash[h]&&S(this,h)}this._pendingRemovals.length=0}}},13272:m=>{"use strict";var S,h="object"===typeof Reflect?Reflect:null,l=function(m,S,h){return Function.prototype.apply.call(m,S,h)};S=h&&"function"===typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:function(m){return Object.getOwnPropertyNames(m)};var M=Number.isNaN||function(m){return m!==m};function O(){O.init.call(this)}m.exports=O,m.exports.once=function(m,S){return new Promise((function(h,l){function M(h){m.removeListener(S,O),l(h)}function O(){"function"===typeof m.removeListener&&m.removeListener("error",M),h([].slice.call(arguments))}D(m,S,O,{once:!0}),"error"!==S&&function(m,S,h){"function"===typeof m.on&&D(m,"error",S,h)}(m,M,{once:!0})}))},O.EventEmitter=O,O.prototype._events=void 0,O.prototype._eventsCount=0,O.prototype._maxListeners=void 0;var u=10;function b(m){if("function"!==typeof m)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}function q(m){return void 0===m._maxListeners?O.defaultMaxListeners:m._maxListeners}function Y(m,S,h,l){var M,O,u,Y;if(b(h),void 0===(O=m._events)?(O=m._events=Object.create(null),m._eventsCount=0):(void 0!==O.newListener&&(m.emit("newListener",S,h.listener?h.listener:h),O=m._events),u=O[S]),void 0===u)u=O[S]=h,++m._eventsCount;else if("function"===typeof u?u=O[S]=l?[h,u]:[u,h]:l?u.unshift(h):u.push(h),(M=q(m))>0&&u.length>M&&!u.warned){u.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.uS=m,V.type=S,V.count=u.length,Y=V,console&&console.warn&&console.warn(Y)}return m}function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function I(m,S,h){var l={fired:!1,wrapFn:void 0,target:m,type:S,listener:h},M=V.bind(l);return M.listener=h,l.wrapFn=M,M}function Z(m,S,h){var l=m._events;if(void 0===l)return[];var M=l[S];return void 0===M?[]:"function"===typeof M?h?[M.listener||M]:[M]:h?function(m){for(var S=new Array(m.length),h=0;h<S.length;++h)S[h]=m[h].listener||m[h];return S}(M):B(M,M.length)}function C(m){var S=this._events;if(void 0!==S){var h=S[m];if("function"===typeof h)return 1;if(void 0!==h)return h.length}return 0}function B(m,S){for(var h=new Array(S),l=0;l<S;++l)h[l]=m[l];return h}function D(m,S,h,l){if("function"===typeof m.on)l.once?m.once(S,h):m.on(S,h);else{if("function"!==typeof m.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m);m.addEventListener(S,(function M(O){l.once&&m.removeEventListener(S,M),h(O)}))}}Object.defineProperty(O,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(m){if("number"!==typeof m||m<0||M(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");u=m}}),O.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},O.prototype.setMaxListeners=function(m){if("number"!==typeof m||m<0||M(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this},O.prototype.getMaxListeners=function(){return q(this)},O.prototype.emit=function(m){for(var S=[],h=1;h<arguments.length;h++)S.push(arguments[h]);var M="error"===m,O=this._events;if(void 0!==O)M=M&&void 0===O.error;else if(!M)return!1;if(M){var u;if(S.length>0&&(u=S[0]),u instanceof Error)throw u;var b=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw b.context=u,b}var q=O[m];if(void 0===q)return!1;if("function"===typeof q)l(q,this,S);else{var Y=q.length,V=B(q,Y);for(h=0;h<Y;++h)l(V[h],this,S)}return!0},O.prototype.addListener=function(m,S){return Y(this,m,S,!1)},O.prototype.on=O.prototype.addListener,O.prototype.prependListener=function(m,S){return Y(this,m,S,!0)},O.prototype.once=function(m,S){return b(S),this.on(m,I(this,m,S)),this},O.prototype.prependOnceListener=function(m,S){return b(S),this.prependListener(m,I(this,m,S)),this},O.prototype.removeListener=function(m,S){var h,l,M,O,u;if(b(S),void 0===(l=this._events))return this;if(void 0===(h=l[m]))return this;if(h===S||h.listener===S)0===--this._eventsCount?this._events=Object.create(null):(delete l[m],l.removeListener&&this.emit("removeListener",m,h.listener||S));else if("function"!==typeof h){for(M=-1,O=h.length-1;O>=0;O--)if(h[O]===S||h[O].listener===S){u=h[O].listener,M=O;break}if(M<0)return this;0===M?h.shift():function(m,S){for(;S+1<m.length;S++)m[S]=m[S+1];m.pop()}(h,M),1===h.length&&(l[m]=h[0]),void 0!==l.removeListener&&this.emit("removeListener",m,u||S)}return this},O.prototype.off=O.prototype.removeListener,O.prototype.bS=function(m){var S,h,l;if(void 0===(h=this._events))return this;if(void 0===h.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==h[m]&&(0===--this._eventsCount?this._events=Object.create(null):delete h[m]),this;if(0===arguments.length){var M,O=Object.keys(h);for(l=0;l<O.length;++l)"removeListener"!==(M=O[l])&&this.bS(M);return this.bS("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(S=h[m]))this.removeListener(m,S);else if(void 0!==S)for(l=S.length-1;l>=0;l--)this.removeListener(m,S[l]);return this},O.prototype.listeners=function(m){return Z(this,m,!0)},O.prototype.rawListeners=function(m){return Z(this,m,!1)},O.listenerCount=function(m,S){return"function"===typeof m.listenerCount?m.listenerCount(S):C.call(m,S)},O.prototype.listenerCount=C,O.prototype.eventNames=function(){return this._eventsCount>0?S(this._events):[]}},13579:m=>{"use strict";m.exports=function(m,S,h,l,M,O){var u=+S[0],b=+S[1],q=+S[2],Y=+h[0],V=+h[1],I=+h[2],Z=Math.sqrt(Y*Y+V*V+I*I);if(0===Z)throw new Error("Can't raycast along a zero vector");return function(m,S,h,l,M,O,u,b,q,Y){for(var V=0,I=Math.floor,Z=0|I(S),C=0|I(h),B=0|I(l),D=M>0?1:-1,E=O>0?1:-1,n=u>0?1:-1,L=Math.abs(1/M),U=Math.abs(1/O),H=Math.abs(1/u),R=L<1/0?L*(D>0?Z+1-S:S-Z):1/0,y=U<1/0?U*(E>0?C+1-h:h-C):1/0,o=H<1/0?H*(n>0?B+1-l:l-B):1/0,s=-1;V<=b;){var v=m(Z,C,B);if(v)return q&&(q[0]=S+V*M,q[1]=h+V*O,q[2]=l+V*u),Y&&(Y[0]=Y[1]=Y[2]=0,0===s&&(Y[0]=-D),1===s&&(Y[1]=-E),2===s&&(Y[2]=-n)),v;R<y?R<o?(Z+=D,V=R,R+=L,s=0):(B+=n,V=o,o+=H,s=2):y<o?(C+=E,V=y,y+=U,s=1):(B+=n,V=o,o+=H,s=2)}return q&&(q[0]=S+V*M,q[1]=h+V*O,q[2]=l+V*u),Y&&(Y[0]=Y[1]=Y[2]=0),0}(m,u,b,q,Y/=Z,V/=Z,I/=Z,l="undefined"===typeof l?64:+l,M,O)}},13609:(m,S,h)=>{"use strict";h.d(S,{e:()=>O});var l=h(13272);function M(){this.sZ=!1,this.stopPropagation=!1,this.vZ=!1,this.disabled=!1}class O{constructor(m,S){this.version="0.7.0";var h=Object.assign({},new M,S||{});this.element=m||document,this.sZ=!!h.sZ,this.stopPropagation=!!h.stopPropagation,this.vZ=!!h.vZ,this.disabled=!!h.disabled,this.filterEvents=(m,S)=>!0,this.down=new l.EventEmitter,this.up=new l.EventEmitter,this.state={},this.WY={dx:0,dy:0,DC:0,iY:0,EC:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?b(this):document.addEventListener("DOMContentLoaded",(m=>{b(this)}),{once:!0})}bind(m){for(var S=arguments.length,h=new Array(S>1?S-1:0),l=1;l<S;l++)h[l-1]=arguments[l];h.forEach((S=>{var h=this._keyBindmap[S]||[];h.includes(m)||(h.push(m),this._keyBindmap[S]=h)})),this.state[m]=!!this.state[m],this.pressCount[m]=this.pressCount[m]||0,this.releaseCount[m]=this.releaseCount[m]||0}unbind(m){for(var S in this._keyBindmap){var h=this._keyBindmap[S],l=h.indexOf(m);l>-1&&h.splice(l,1)}}getBindings(){var m={};for(var S in this._keyBindmap){this._keyBindmap[S].forEach((h=>{m[h]=m[h]||[],m[h].push(S)}))}return m}wb(){u(this.WY),u(this.pressCount),u(this.releaseCount)}}function u(m){for(var S in m)m[S]=0}function b(m){window.addEventListener("keydown",B.bind(null,m,!0),!1),window.addEventListener("keyup",B.bind(null,m,!1),!1);var S={passive:!0};m.element.addEventListener("touchstart",I.bind(void 0,m),{passive:!1}),m.element.addEventListener("touchend",C.bind(void 0,m),S),m.element.addEventListener("mousedown",D.bind(null,m,!0),S),window.document.addEventListener("mouseup",D.bind(null,m,!1),S),m.element.addEventListener("touchmove",E.bind(null,m),S),m.element.addEventListener("mousemove",E.bind(null,m),S),window.PointerEvent,m.element.addEventListener("wheel",n.bind(null,m),S),m.element.addEventListener("contextmenu",L.bind(null,m),!1),window.addEventListener("blur",U.bind(null,m),!1)}var q=0,Y=0,V=null;function I(m,S){S.preventDefault(),Z(S)}function Z(m){let S=!1;for(let h=0;h<m.touches.length;++h)if(m.touches[h].identifier===V){S=!0;break}if(!S){const S=m.changedTouches[0];q=S.clientX,Y=S.clientY,V=S.identifier}}function C(m,S){for(var h=S.changedTouches,l=0;l<h.length;++l)h[l].identifier===V&&(V=null)}function B(m,S,h){H(h.code,S,m,h)}function D(m,S,h){if("pointerId"in h)if(S){if(null!==m._touches.currID)return;m._touches.currID=h.pointerId}else{if(m._touches.currID!==h.pointerId)return;m._touches.currID=null}return H("Mouse"+("button"in h?h.button+1:1),S,m,h),!1}function E(m,S){var h=S.movementX||S.mozMovementX||0,l=S.movementY||S.mozMovementY||0;if(S.touches&&0===(h|l)){var M=function(m){Z(m);for(let S=0;S<m.changedTouches.length;++S)if(m.changedTouches[S].identifier==V){const h=m.changedTouches[S],l=[h.clientX-q,h.clientY-Y];return q=h.clientX,Y=h.clientY,l}return console.error(`Did not find touch id ${V}`),[0,0]}(S);h=M[0],l=M[1]}m.WY.dx+=h,m.WY.dy+=l}function n(m,S){var h=1;switch(S.deltaMode){case 0:h=1;break;case 1:h=12;break;case 2:h=m.element.clientHeight||window.innerHeight}m.WY.DC+=(S.deltaX||0)*h,m.WY.iY+=(S.deltaY||0)*h,m.WY.EC+=(S.deltaZ||0)*h}function L(m,S){if(!m.vZ)return S.preventDefault(),!1}function U(m){for(var S in m._keyStates)m._keyStates[S]&&(/^Mouse\d/.test(S)||H(S,!1,m,{code:S,note:"si479bpmw2",preventDefault:()=>{},stopPropagation:()=>{}}))}function H(m,S,h,l){var M=h._keyBindmap[m];M&&(R(h._keyStates[m],S)&&(h._keyStates[m]=S,M.forEach((m=>{(!h.filterEvents||h.filterEvents(l,m))&&function(m,S,h,l){var M=S?h.pressCount:h.releaseCount;M[m]=(M[m]||0)+1;var O=h._bindPressCount[m]||0;(O+=S?1:-1)<0&&(O=0);h._bindPressCount[m]=O;var u=h.state[m];if(R(u,O)){h.state[m]=O>0;var b=S?h.down:h.up;h.disabled||b.emit(m,l)}}(m,S,h,l)}))),"button"in l||(h.sZ&&!l.defaultPrevented&&l.preventDefault(),h.stopPropagation&&l.stopPropagation()))}function R(m,S){return m?!S:S}},12219:m=>{m.exports=function(m,S,h){return m[0]=S[0]+h[0],m[1]=S[1]+h[1],m[2]=S[2]+h[2],m}},12175:(m,S,h)=>{m.exports=function(m,S){var h=l(m[0],m[1],m[2]),u=l(S[0],S[1],S[2]);M(h,h),M(u,u);var b=O(h,u);return b>1?0:Math.acos(b)};var l=h(12179),M=h(12183),O=h(12191)},12280:m=>{m.exports=function(m,S){return m[0]=Math.ceil(S[0]),m[1]=Math.ceil(S[1]),m[2]=Math.ceil(S[2]),m}},12170:m=>{m.exports=function(m){var S=new Float32Array(3);return S[0]=m[0],S[1]=m[1],S[2]=m[2],S}},12194:m=>{m.exports=function(m,S){return m[0]=S[0],m[1]=S[1],m[2]=S[2],m}},12166:m=>{m.exports=function(){var m=new Float32Array(3);return m[0]=0,m[1]=0,m[2]=0,m}},12366:m=>{m.exports=function(m,S,h){var l=S[0],M=S[1],O=S[2],u=h[0],b=h[1],q=h[2];return m[0]=M*q-O*b,m[1]=O*u-l*q,m[2]=l*b-M*u,m}},12314:(m,S,h)=>{m.exports=h(12307)},12307:m=>{m.exports=function(m,S){var h=S[0]-m[0],l=S[1]-m[1],M=S[2]-m[2];return Math.sqrt(h*h+l*l+M*M)}},12253:(m,S,h)=>{m.exports=h(12247)},12247:m=>{m.exports=function(m,S,h){return m[0]=S[0]/h[0],m[1]=S[1]/h[1],m[2]=S[2]/h[2],m}},12191:m=>{m.exports=function(m,S){return m[0]*S[0]+m[1]*S[1]+m[2]*S[2]}},12162:m=>{m.exports=1e-6},12209:(m,S,h)=>{m.exports=function(m,S){var h=m[0],M=m[1],O=m[2],u=S[0],b=S[1],q=S[2];return Math.abs(h-u)<=l*Math.max(1,Math.abs(h),Math.abs(u))&&Math.abs(M-b)<=l*Math.max(1,Math.abs(M),Math.abs(b))&&Math.abs(O-q)<=l*Math.max(1,Math.abs(O),Math.abs(q))};var l=h(12162)},12213:m=>{m.exports=function(m,S){return m[0]===S[0]&&m[1]===S[1]&&m[2]===S[2]}},12274:m=>{m.exports=function(m,S){return m[0]=Math.floor(S[0]),m[1]=Math.floor(S[1]),m[2]=Math.floor(S[2]),m}},12418:(m,S,h)=>{m.exports=function(m,S,h,M,O,u){var b,q;S||(S=3);h||(h=0);q=M?Math.min(M*S+h,m.length):m.length;for(b=h;b<q;b+=S)l[0]=m[b],l[1]=m[b+1],l[2]=m[b+2],O(l,l,u),m[b]=l[0],m[b+1]=l[1],m[b+2]=l[2];return m};var l=h(12166)()},12179:m=>{m.exports=function(m,S,h){var l=new Float32Array(3);return l[0]=m,l[1]=S,l[2]=h,l}},12155:(m,S,h)=>{m.exports={EPSILON:h(12162),create:h(12166),clone:h(12170),angle:h(12175),iu:h(12179),i:h(12194),set:h(12200),equals:h(12209),exactEquals:h(12213),add:h(12219),LS:h(12226),sub:h(12230),multiply:h(12233),mul:h(12239),divide:h(12247),div:h(12253),min:h(12259),max:h(12265),floor:h(12274),ceil:h(12280),round:h(12282),scale:h(12290),Wu:h(12299),distance:h(12307),j:h(12314),squaredDistance:h(12323),sqrDist:h(12328),length:h(12337),len:h(12345),squaredLength:h(12349),mb:h(12353),negate:h(12357),inverse:h(12360),normalize:h(12183),dot:h(12191),cross:h(12366),wu:h(12368),random:h(12372),transformMat4:h(12374),transformMat3:h(12382),transformQuat:h(12391),Ob:h(12394),Vb:h(12402),Cb:h(12411),forEach:h(12418)}},12360:m=>{m.exports=function(m,S){return m[0]=1/S[0],m[1]=1/S[1],m[2]=1/S[2],m}},12345:(m,S,h)=>{m.exports=h(12337)},12337:m=>{m.exports=function(m){var S=m[0],h=m[1],l=m[2];return Math.sqrt(S*S+h*h+l*l)}},12368:m=>{m.exports=function(m,S,h,l){var M=S[0],O=S[1],u=S[2];return m[0]=M+l*(h[0]-M),m[1]=O+l*(h[1]-O),m[2]=u+l*(h[2]-u),m}},12265:m=>{m.exports=function(m,S,h){return m[0]=Math.max(S[0],h[0]),m[1]=Math.max(S[1],h[1]),m[2]=Math.max(S[2],h[2]),m}},12259:m=>{m.exports=function(m,S,h){return m[0]=Math.min(S[0],h[0]),m[1]=Math.min(S[1],h[1]),m[2]=Math.min(S[2],h[2]),m}},12239:(m,S,h)=>{m.exports=h(12233)},12233:m=>{m.exports=function(m,S,h){return m[0]=S[0]*h[0],m[1]=S[1]*h[1],m[2]=S[2]*h[2],m}},12357:m=>{m.exports=function(m,S){return m[0]=-S[0],m[1]=-S[1],m[2]=-S[2],m}},12183:m=>{m.exports=function(m,S){var h=S[0],l=S[1],M=S[2],O=h*h+l*l+M*M;O>0&&(O=1/Math.sqrt(O),m[0]=S[0]*O,m[1]=S[1]*O,m[2]=S[2]*O);return m}},12372:m=>{m.exports=function(m,S){S=S||1;var h=2*Math.random()*Math.PI,l=2*Math.random()-1,M=Math.sqrt(1-l*l)*S;return m[0]=Math.cos(h)*M,m[1]=Math.sin(h)*M,m[2]=l*S,m}},12394:m=>{m.exports=function(m,S,h,l){var M=h[1],O=h[2],u=S[1]-M,b=S[2]-O,q=Math.sin(l),Y=Math.cos(l);return m[0]=S[0],m[1]=M+u*Y-b*q,m[2]=O+u*q+b*Y,m}},12402:m=>{m.exports=function(m,S,h,l){var M=h[0],O=h[2],u=S[0]-M,b=S[2]-O,q=Math.sin(l),Y=Math.cos(l);return m[0]=M+b*q+u*Y,m[1]=S[1],m[2]=O+b*Y-u*q,m}},12411:m=>{m.exports=function(m,S,h,l){var M=h[0],O=h[1],u=S[0]-M,b=S[1]-O,q=Math.sin(l),Y=Math.cos(l);return m[0]=M+u*Y-b*q,m[1]=O+u*q+b*Y,m[2]=S[2],m}},12282:m=>{m.exports=function(m,S){return m[0]=Math.round(S[0]),m[1]=Math.round(S[1]),m[2]=Math.round(S[2]),m}},12290:m=>{m.exports=function(m,S,h){return m[0]=S[0]*h,m[1]=S[1]*h,m[2]=S[2]*h,m}},12299:m=>{m.exports=function(m,S,h,l){return m[0]=S[0]+h[0]*l,m[1]=S[1]+h[1]*l,m[2]=S[2]+h[2]*l,m}},12200:m=>{m.exports=function(m,S,h,l){return m[0]=S,m[1]=h,m[2]=l,m}},12328:(m,S,h)=>{m.exports=h(12323)},12353:(m,S,h)=>{m.exports=h(12349)},12323:m=>{m.exports=function(m,S){var h=S[0]-m[0],l=S[1]-m[1],M=S[2]-m[2];return h*h+l*l+M*M}},12349:m=>{m.exports=function(m){var S=m[0],h=m[1],l=m[2];return S*S+h*h+l*l}},12230:(m,S,h)=>{m.exports=h(12226)},12226:m=>{m.exports=function(m,S,h){return m[0]=S[0]-h[0],m[1]=S[1]-h[1],m[2]=S[2]-h[2],m}},12382:m=>{m.exports=function(m,S,h){var l=S[0],M=S[1],O=S[2];return m[0]=l*h[0]+M*h[3]+O*h[6],m[1]=l*h[1]+M*h[4]+O*h[7],m[2]=l*h[2]+M*h[5]+O*h[8],m}},12374:m=>{m.exports=function(m,S,h){var l=S[0],M=S[1],O=S[2],u=h[3]*l+h[7]*M+h[11]*O+h[15];return u=u||1,m[0]=(h[0]*l+h[4]*M+h[8]*O+h[12])/u,m[1]=(h[1]*l+h[5]*M+h[9]*O+h[13])/u,m[2]=(h[2]*l+h[6]*M+h[10]*O+h[14])/u,m}},12391:m=>{m.exports=function(m,S,h){var l=S[0],M=S[1],O=S[2],u=h[0],b=h[1],q=h[2],Y=h[3],V=Y*l+b*O-q*M,I=Y*M+q*l-u*O,Z=Y*O+u*M-b*l,C=-u*l-b*M-q*O;return m[0]=V*Y+C*-u+I*-q-Z*-b,m[1]=I*Y+C*-b+Z*-u-V*-q,m[2]=Z*Y+C*-q+V*-b-I*-u,m}},13297:m=>{"use strict";m.exports=function(m){for(var S=new Array(m),h=0;h<m;++h)S[h]=h;return S}},13366:m=>{m.exports=function(m){return null!=m&&null!=m.constructor&&"function"===typeof m.constructor.isBuffer&&m.constructor.isBuffer(m)}},13583:(m,S,h)=>{"use strict";h.d(S,{d:()=>l});class l{constructor(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.uI=!1,this.bI=!1,this.MI=30,this.OI=0,this.DI=!1,this.fullscreen=!1,this.YI=function(m){},this.VI=function(){},this.CI=function(){},this.hh=function(){},this.II=function(m){},this.onFullscreenChanged=function(m){},Y((()=>{!function(m,S){m._nowObject=performance||Date,m._lastTick=0,m._renderAccum=0,m._rt=0,m._frameCB=b.bind(null,m),requestAnimationFrame(m._frameCB),S>0&&(m._intervalCB=u.bind(null,m),m._interval=setInterval(m._intervalCB,Math.max(S,1e3/m.MI/2)))}(this,S),function(m,S){if(!S)return;var h=!1,l=!1;document.addEventListener("pointerlockchange",(l=>{h=document.pointerLockElement===S,m.II(h)})),document.addEventListener("fullscreenchange",(h=>{l=document.fullscreenElement===S,m.onFullscreenChanged(l)})),Object.defineProperty(m,"DI",{get:()=>h,set:m=>{m&&!h?q(S):h&&!m&&function(m){m.exitPointerLock&&m.exitPointerLock()}(document)}}),Object.defineProperty(m,"fullscreen",{get:()=>l,set:m=>{m&&!l?S.requestFullscreen():l&&!m&&document.exitFullscreen()}}),S.addEventListener("click",(M=>{m.uI&&!h&&q(S),m.bI&&!l&&S.requestFullscreen()}));var M=()=>m.hh();if(window.ResizeObserver){new ResizeObserver(M).observe(S)}else window.addEventListener("resize",M)}(this,m),this.CI()}))}}var M=3,O=20;function u(m){for(var S=1e3/m.MI,h=m._nowObject.now()+O,l=0;m._nowObject.now()>=m._lastTick+S&&m._nowObject.now()<h&&++l<=M;)m.YI(S),m._lastTick+=S;var u=5*(S+5),b=m._nowObject.now();if(b-m._lastTick>u)for(;b>=m._lastTick+S;)m._lastTick+=S}function b(m){requestAnimationFrame(m._frameCB),u(m);var S=m._nowObject.now(),h=S-m._rt;if(m._rt=S,m.OI>0){m._renderAccum+=h;var l=1e3/m.OI;if(m._renderAccum<l)return;m._renderAccum=Math.min(m._renderAccum-l,l)}var M=1e3/m.MI,O=(S-m._lastTick)/M;m.VI(h,O,M)}function q(m){m.requestPointerLock&&m.requestPointerLock()}var Y=m=>{if("loading"===document.readyState){var S=()=>{document.removeEventListener("readystatechange",S),m()};document.addEventListener("readystatechange",S)}else setTimeout(m,1)}},13292:(m,S,h)=>{var l=h(13297),M=h(13303),O="undefined"!==typeof Float64Array;function u(m,S){return m[0]-S[0]}function b(){var m,S=this.stride,h=new Array(S.length);for(m=0;m<h.length;++m)h[m]=[Math.abs(S[m]),m];h.sort(u);var l=new Array(h.length);for(m=0;m<l.length;++m)l[m]=h[m][1];return l}function q(m,S){var h=["View",S,"d",m].join("");S<0&&(h="View_Nil"+m);var M="generic"===m;if(-1===S){var O="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+m+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(O)()}if(0===S){O="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+m+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(M?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(M?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",O)(Y[m][0])}O=["'use strict'"];var u=l(S),q=u.map((function(m){return"i"+m})),V="this.offset+"+u.map((function(m){return"this.stride["+m+"]*i"+m})).join("+"),I=u.map((function(m){return"b"+m})).join(","),Z=u.map((function(m){return"c"+m})).join(",");O.push("function "+h+"(a,"+I+","+Z+",d){this.data=a","this.shape=["+I+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+m+"'","proto.dimension="+S),O.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+u.map((function(m){return"this.shape["+m+"]"})).join("*"),"}})"),1===S?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),S<4?(O.push("function "+h+"_order(){"),2===S?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===S&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+h+"_set("+q.join(",")+",v){"),M?O.push("return this.data.set("+V+",v)}"):O.push("return this.data["+V+"]=v}"),O.push("proto.get=function "+h+"_get("+q.join(",")+"){"),M?O.push("return this.data.get("+V+")}"):O.push("return this.data["+V+"]}"),O.push("proto.index=function "+h+"_index(",q.join(),"){return "+V+"}"),O.push("proto.hi=function "+h+"_hi("+q.join(",")+"){return new "+h+"(this.data,"+u.map((function(m){return["(typeof i",m,"!=='number'||i",m,"<0)?this.shape[",m,"]:i",m,"|0"].join("")})).join(",")+","+u.map((function(m){return"this.stride["+m+"]"})).join(",")+",this.offset)}");var C=u.map((function(m){return"a"+m+"=this.shape["+m+"]"})),B=u.map((function(m){return"c"+m+"=this.stride["+m+"]"}));O.push("proto.lo=function "+h+"_lo("+q.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+B.join(","));for(var D=0;D<S;++D)O.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");O.push("return new "+h+"(this.data,"+u.map((function(m){return"a"+m})).join(",")+","+u.map((function(m){return"c"+m})).join(",")+",b)}"),O.push("proto.step=function "+h+"_step("+q.join(",")+"){var "+u.map((function(m){return"a"+m+"=this.shape["+m+"]"})).join(",")+","+u.map((function(m){return"b"+m+"=this.stride["+m+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<S;++D)O.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");O.push("return new "+h+"(this.data,"+u.map((function(m){return"a"+m})).join(",")+","+u.map((function(m){return"b"+m})).join(",")+",c)}");var E=new Array(S),n=new Array(S);for(D=0;D<S;++D)E[D]="a[i"+D+"]",n[D]="b[i"+D+"]";O.push("proto.transpose=function "+h+"_transpose("+q+"){"+q.map((function(m,S){return m+"=("+m+"===undefined?"+S+":"+m+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+E.join(",")+","+n.join(",")+",this.offset)}"),O.push("proto.pick=function "+h+"_pick("+q+"){var a=[],b=[],c=this.offset");for(D=0;D<S;++D)O.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+u.map((function(m){return"shape["+m+"]"})).join(",")+","+u.map((function(m){return"stride["+m+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(Y[m],b)}var Y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};m.exports=function(m,S,h,l){if(void 0===m)return(0,Y.array[0])([]);"number"===typeof m&&(m=[m]),void 0===S&&(S=[m.length]);var u=S.length;if(void 0===h){h=new Array(u);for(var b=u-1,V=1;b>=0;--b)h[b]=V,V*=S[b]}if(void 0===l){l=0;for(b=0;b<u;++b)h[b]<0&&(l-=(S[b]-1)*h[b])}for(var I=function(m){if(M(m))return"buffer";if(O)switch(Object.prototype.toString.call(m)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(m)?"array":"generic"}(m),Z=Y[I];Z.length<=u+1;)Z.push(q(I,Z.length-1));return(0,Z[u+1])(m,S,h,l)}},13303:m=>{function S(m){return!!m.constructor&&"function"===typeof m.constructor.isBuffer&&m.constructor.isBuffer(m)}m.exports=function(m){return null!=m&&(S(m)||function(m){return"function"===typeof m.readFloatLE&&"function"===typeof m.slice&&S(m.slice(0,0))}(m)||!!m._isBuffer)}},13437:m=>{"use strict";var S=[],h=[],l=[],M=[],O=[],u=[],b=[],q=[],Y=[],V=[],I=[],Z=[];m.exports=function(m,C,B,D,E,n){for(var L=b,U=Y,H=V,R=Z,y=0;y<3;y++)L[y]=+B[y],H[y]=+C.max[y],U[y]=+C.base[y];n||(n=1e-10);var o=function(m,b,Y,V,Z,C){var B=S,D=h,E=l,n=M,L=O,U=u,H=q,R=Math.floor,y=0,o=0,s=0,v=0,T=0;if(X(),0===s)return 0;for(v=e();o<=s;){if(g(v)&&G())return y;v=e()}for(y+=s,T=0;T<3;T++)V[T]+=Y[T],Z[T]+=Y[T];return y;function X(){if(o=0,0!==(s=Math.sqrt(Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2])))for(var m=0;m<3;m++){var S=Y[m]>=0;n[m]=S?1:-1;var h=S?Z[m]:V[m];B[m]=S?V[m]:Z[m],D[m]=a(h,n[m]),E[m]=x(B[m],n[m]),H[m]=Y[m]/s,L[m]=Math.abs(1/H[m]);var l=S?D[m]+1-h:h-D[m];U[m]=L[m]<1/0?L[m]*l:1/0}}function g(S){for(var h=n[0],l=0===S?D[0]:E[0],M=D[0]+h,O=n[1],u=1===S?D[1]:E[1],b=D[1]+O,q=n[2],Y=2===S?D[2]:E[2],V=D[2]+q,I=l;I!=M;I+=h)for(var Z=u;Z!=b;Z+=O)for(var C=Y;C!=V;C+=q)if(m(I,Z,C))return!0;return!1}function G(){y+=o;var m=n[v],S=o/s,h=I;for(T=0;T<3;T++){var l=Y[T]*S;V[T]+=l,Z[T]+=l,h[T]=Y[T]-l}if(m>0?Z[v]=Math.round(Z[v]):V[v]=Math.round(V[v]),b(y,v,m,h))return!0;for(T=0;T<3;T++)Y[T]=h[T];return X(),0===s}function e(){var m=U[0]<U[1]?U[0]<U[2]?0:2:U[1]<U[2]?1:2,S=U[m]-o;for(o=U[m],D[m]+=n[m],U[m]+=L[m],T=0;T<3;T++)B[T]+=S*H[T],E[T]=x(B[T],n[T]);return m}function a(m,S){return R(m-S*C)}function x(m,S){return R(m+S*C)}}(m,D,L,U,H,n);if(!E){for(y=0;y<3;y++)R[y]=B[y]>0?H[y]-C.max[y]:U[y]-C.base[y];C.translate(R)}return o}},13614:(m,S,h)=>{"use strict";h.d(S,{d:()=>I});var l=h(13433),M=h(12155);class O{constructor(m,S,h,O,u,b,q){this.MV=new l(m.base,m.HV),this.NM=S,this.friction=h,this.restitution=O,this.fu=u,this.JC=b,this.pu=!!q,this.UV=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.yB=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.aY=M.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=M.create(),this._impulses=M.create(),this._sleepFrameCount=10}loadFromCopy(m){M.i(this.MV.base,m.MV.base),M.i(this.MV.HV,m.MV.HV),M.i(this.MV.max,m.MV.max),this.MV.mag=m.MV.mag,this.NM=m.NM,this.friction=m.friction,this.restitution=m.restitution,this.fu=m.fu,this.JC=m.JC,this.pu=m.pu,this.UV=m.UV,this.fluidDrag=m.fluidDrag,this.yB=m.yB,this.preventFallOffEdge=m.preventFallOffEdge,this.rolledBackLastTick=m.rolledBackLastTick,M.i(this.aY,m.aY),M.i(this.resting,m.resting),this.inFluid=m.inFluid,this._ratioInFluid=m._ratioInFluid,M.i(this._forces,m._forces),M.i(this._impulses,m._impulses),this._sleepFrameCount=m._sleepFrameCount}setPosition(m){u(m),M.LS(m,m,this.MV.base),this.MV.translate(m),this.JY()}Ih(){return M.clone(this.MV.base)}applyForce(m){u(m),M.add(this._forces,this._forces,m),this.JY()}applyImpulse(m){u(m),M.add(this._impulses,this._impulses,m),this.JY()}JY(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var u=m=>{};var b=h(13433),q=h(12155),Y=h(13437);function V(){this.UV=.1,this.fluidDrag=.4,this.Fu=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function I(m,S,h){m=Object.assign(new V,m),this.gravity=m.gravity||[0,-10,0],this.UV=m.UV||.1,this.Fu=m.Fu||2,this.fluidDrag=m.fluidDrag||.4,this.minBounceImpulse=m.minBounceImpulse,this.bodies=[],this.OC=m.OC,this.testSolid=S,this.testFluid=h}I.prototype.kC=function(m,S,h,l,M,u){m=m||new b([0,0,0],[1,1,1]),"undefined"==typeof S&&(S=1),"undefined"==typeof h&&(h=1),"undefined"==typeof l&&(l=0),"undefined"==typeof M&&(M=1);var q=new O(m,S,h,l,M,u);return this.bodies.push(q),q},I.prototype.rC=function(m){var S=this.bodies.indexOf(m);S<0||(this.bodies.splice(S,1),m.MV=m.JC=null)};var Z=q.create(),C=q.create(),B=q.create(),D=q.create(),E=q.create(),n=q.create(),L=q.create(),U=new b([0,0,0],[1,1,1]),H=new O(U,1,1,0,1,(()=>{}),!1);function R(m,S,h){return S=h,S*=1-(1-m.ratioInFluid)**2}I.prototype.wb=function(m){m/=1e3;var S=j(0,q.squaredLength(this.gravity));this.bodies.forEach((h=>function(m,S,h,l){q.i(E,S.resting),m.OC&&H.loadFromCopy(S);if(S.NM<=0)return q.set(S.aY,0,0,0),q.set(S._forces,0,0,0),void q.set(S._impulses,0,0,0);var M=l||0===S.fu;if(function(m,S,h,l){if(S._sleepFrameCount>0)return!1;if(l)return!0;var M=!1,O=.5*h*h*S.fu;return q.scale(N,m.gravity,O),Y(m.testSolid,S.MV,N,(function(){return M=!0,!0}),!0),M}(m,S,h,M))return;S._sleepFrameCount--,function(m,S){var h=S.MV,l=Math.floor(h.base[0]),M=Math.floor(h.base[2]),O=Math.floor(h.base[1]),u=Math.floor(h.max[1]);if(!m.testFluid(l,O,M))return S.inFluid=!1,void(S.ratioInFluid=0);var b=1,Y=O+1;for(;Y<=u&&m.testFluid(l,Y,M);)b++,Y++;var V=(O+b-h.base[1])/h.HV[1];V>1&&(V=1);var I=h.HV[0]*h.HV[1]*h.HV[2]*V,Z=o;q.scale(Z,m.gravity,-m.Fu*I*S.fu),S.applyForce(Z),S.inFluid=!0,S.ratioInFluid=V}(m,S),c(S._forces),c(S._impulses),c(S.aY),c(S.resting),q.scale(Z,S._forces,1/S.NM),q.Wu(Z,Z,m.gravity,S.fu),q.scale(C,S._impulses,1/S.NM),q.Wu(C,C,Z,h),q.add(S.aY,S.aY,C),S.friction&&(s(m,0,S,C,h),s(m,1,S,C,h),s(m,2,S,C,h));var O=S.fluidDrag>=0?S.fluidDrag:m.fluidDrag,u=S.UV>=0?S.UV:m.UV,b=u,V=u;S.inFluid&&(b=R(S,b,S.fluidDragHoriz>=0?S.fluidDragHoriz:O),V=R(S,V,S.fluidDragVert>=0?S.fluidDragVert:O));b=Math.max(1-b*h/S.NM,0),V=Math.max(1-V*h/S.NM,0),q.set(y,b,V,b),q.multiply(S.aY,S.aY,y),q.scale(B,S.aY,h),q.set(S._forces,0,0,0),q.set(S._impulses,0,0,0),S.pu&&K(X,S.MV);q.i(n,B),q.set(L,0,0,0),S.preventFallOffEdge&&function(m,S,h,l){if(!S.resting[1]||h[1]>0)return;var M=P;K(M,S.MV);for(var O=0;O<3;O+=2){q.set(x,0,0,0),x[O]=h[O];var u=!0;(u=(u=(u=(u=u&&!J(m,M.base[0]+x[0]+1e-5,M.base[1],M.base[2]+x[2]+1e-5))&&!J(m,M.max[0]+x[0]-1e-5,M.base[1],M.base[2]+x[2]+1e-5))&&!J(m,M.base[0]+x[0]+1e-5,M.base[1],M.max[2]+x[2]-1e-5))&&!J(m,M.max[0]+x[0]-1e-5,M.base[1],M.max[2]+x[2]-1e-5))?(l[O]=h[O]>0?1:-1,h[O]=0):0===O&&(q.set(d,h[0],0,0),T(m,M,d,l,S.slideOnCollision))}}(m,S,B,L);T(m,S.MV,B,S.resting,S.slideOnCollision),S.pu&&function(m,S,h,l){if(S.resting[1]>=0&&!S.inFluid)return;var M=0!==S.resting[0],O=0!==S.resting[2];if(!M&&!O)return;var u=Math.abs(l[0]/l[2]),b=4;if(!M&&u>b)return;if(!O&&u<1/b)return;q.add(G,h.base,l);var V=m.testSolid;Y(V,h,l,(function(m,S,h,l){if(1!==S)return!0;l[S]=0}));var I=h.base[1],Z=S.inFluid?1.951:1.001,C=Math.floor(I+Z)-I;q.set(e,0,C,0);var B=!1;if(Y(V,h,e,(function(m,S,h,l){return B=!0,!0})),B)return;q.LS(a,G,h.base),a[1]=0,T(m,h,a,g,!0);var D=j(h.base[0],G[0]),E=j(h.base[2],G[2]);if(M&&!D&&(!E||!O))return;if(O&&(!D||!M)&&!E)return;var n=!0;if(n=n&&!J(m,h.base[0]+1e-5,h.base[1],h.base[2]+1e-5),n=n&&!J(m,h.max[0]-1e-5,h.base[1],h.base[2]+1e-5),n=n&&!J(m,h.base[0]+1e-5,h.base[1],h.max[2]-1e-5),n=n&&!J(m,h.max[0]-1e-5,h.base[1],h.max[2]-1e-5),n)return;K(S.MV,h),S.resting[0]=g[0],S.resting[2]=g[2],S.yB&&S.yB()}(m,S,X,n);for(var I=0;I<3;++I)S.resting[I]=S.resting[I]||L[I],D[I]=0,S.resting[I]&&(E[I]||(D[I]=-S.aY[I]),S.aY[I]=0);var U=q.length(D);U>.001&&(q.scale(D,D,S.NM),S.JC&&S.JC(D),S.restitution>0&&U>m.minBounceImpulse&&(q.scale(D,D,S.restitution),S.applyImpulse(D)));var v=q.squaredLength(S.aY);v>1e-5&&S.JY();m.OC&&m.OC(S)?(S.loadFromCopy(H),S.rolledBackLastTick=!0):S.rolledBackLastTick=!1}(this,h,m,S)))};var y=q.create([0,0,0]);var o=q.create();function s(m,S,h,l,M){var O=h.resting[S],u=l[S];if(!h.alwaysApplyHorizFriction||1!==S){if(0===O)return;if(O*u<=0)return}q.i(v,h.aY),v[S]=0;var b=q.length(v);if(!j(b,0)){var Y=Math.abs(h.friction*m.gravity[S]*M),V=b>Y?(b-Y)/b:0;h.aY[(S+1)%3]*=V,h.aY[(S+2)%3]*=V}}var v=q.create();function T(m,S,h,l,M){return q.set(l,0,0,0),Y(m.testSolid,S,h,(function(m,S,h,O){l[S]=h,O[S]=0,M||(O[0]=0,O[1]=0,O[2]=0)}))}var X=new b([],[]),g=q.create(),G=q.create(),e=q.create(),a=q.create();var x=q.create(),P=new b([],[]),d=q.create();function J(m,S,h,l){return m.testSolid(Math.floor(S),Math.floor(h-1),Math.floor(l))}var N=q.create();function j(m,S){return Math.abs(m-S)<1e-5}function K(m,S){for(var h=0;h<3;h++)m.base[h]=S.base[h],m.max[h]=S.max[h],m.HV[h]=S.HV[h]}var c=function(m){}},12009:function(m,S){!function(m){"use strict";var S=function(m,h){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,S){m.__proto__=S}||function(m,S){for(var h in S)Object.prototype.hasOwnProperty.call(S,h)&&(m[h]=S[h])},S(m,h)};function h(m,h){if("function"!==typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function l(){this.constructor=m}S(m,h),m.prototype=null===h?Object.create(h):(l.prototype=h.prototype,new l)}function l(m,S,h,l){var M,O=arguments.length,u=O<3?S:null===l?l=Object.getOwnPropertyDescriptor(S,h):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)u=Reflect.decorate(m,S,h,l);else for(var b=m.length-1;b>=0;b--)(M=m[b])&&(u=(O<3?M(u):O>3?M(S,h,u):M(S,h))||u);return O>3&&u&&Object.defineProperty(S,h,u),u}function M(m,S,h){if(h||2===arguments.length)for(var l,M=0,O=S.length;M<O;M++)!l&&M in S||(l||(l=Array.prototype.slice.call(S,0,M)),l[M]=S[M]);return m.concat(l||Array.prototype.slice.call(S))}var O,u=255,b=213;m.OPERATION=void 0,(O=m.OPERATION||(m.OPERATION={}))[O.ADD=128]="ADD",O[O.REPLACE=0]="REPLACE",O[O.DELETE=64]="DELETE",O[O.DELETE_AND_ADD=192]="DELETE_AND_ADD",O[O.TOUCH=1]="TOUCH",O[O.CLEAR=10]="CLEAR";var q=function(){function S(m,S,h){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=m,this.setParent(S,h)}return S.prototype.setParent=function(m,S,h){var l=this;if(this.indexes||(this.indexes=this.ref instanceof am?this.ref._definition.indexes:{}),this.parent=m,this.parentIndex=h,S)if(this.root=S,this.ref instanceof am){var M=this.ref._definition;for(var O in M.schema){var u=this.ref[O];if(u&&u.$changes){var b=M.indexes[O];u.$changes.setParent(this.ref,S,b)}}}else"object"===typeof this.ref&&this.ref.forEach((function(m,S){if(m instanceof am){var h=m.$changes,M=l.ref.$changes.indexes[S];h.setParent(l.ref,l.root,M)}}))},S.prototype.operation=function(m){this.changes.set(--this.currentCustomOperation,m)},S.prototype.change=function(S,h){void 0===h&&(h=m.OPERATION.ADD);var l="number"===typeof S?S:this.indexes[S];this.assertValidIndex(l,S);var M=this.changes.get(l);M&&M.op!==m.OPERATION.DELETE&&M.op!==m.OPERATION.TOUCH||this.changes.set(l,{op:M&&M.op===m.OPERATION.DELETE?m.OPERATION.DELETE_AND_ADD:h,index:l}),this.allChanges.add(l),this.changed=!0,this.touchParents()},S.prototype.touch=function(S){var h="number"===typeof S?S:this.indexes[S];this.assertValidIndex(h,S),this.changes.has(h)||this.changes.set(h,{op:m.OPERATION.TOUCH,index:h}),this.allChanges.add(h),this.touchParents()},S.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},S.prototype.getType=function(m){if(this.ref._definition)return(S=this.ref._definition).schema[S.fieldsByIndex[m]];var S,h=(S=this.parent._definition).schema[S.fieldsByIndex[this.parentIndex]];return Object.values(h)[0]},S.prototype.getChildrenFilter=function(){var m=this.parent._definition.childFilters;return m&&m[this.parentIndex]},S.prototype.getValue=function(m){return this.ref.getByIndex(m)},S.prototype.delete=function(S){var h="number"===typeof S?S:this.indexes[S];if(void 0!==h){var l=this.getValue(h);this.changes.set(h,{op:m.OPERATION.DELETE,index:h}),this.allChanges.delete(h),delete this.caches[h],l&&l.$changes&&(l.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(S," (").concat(h,")"))},S.prototype.discard=function(S,h){var l=this;void 0===S&&(S=!1),void 0===h&&(h=!1),this.ref instanceof am||this.changes.forEach((function(S){if(S.op===m.OPERATION.DELETE){var h=l.ref.getIndex(S.index);delete l.indexes[h]}})),this.changes.clear(),this.changed=S,h&&this.allChanges.clear(),this.currentCustomOperation=0},S.prototype.discardAll=function(){var m=this;this.changes.forEach((function(S){var h=m.getValue(S.index);h&&h.$changes&&h.$changes.discardAll()})),this.discard()},S.prototype.cache=function(m,S){this.caches[m]=S},S.prototype.clone=function(){return new S(this.ref,this.parent,this.root)},S.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},S.prototype.assertValidIndex=function(m,S){if(void 0===m)throw new Error('ChangeTree: missing index for field "'.concat(S,'"'))},S}();function Y(m,S,h,l){return m[S]||(m[S]=[]),m[S].push(h),null===l||void 0===l||l.forEach((function(m,S){return h(m,S)})),function(){return I(m[S],m[S].indexOf(h))}}function V(S){var h=this,l="string"!==typeof this.$changes.getType();this.$items.forEach((function(M,O){S.push({refId:h.$changes.refId,op:m.OPERATION.DELETE,field:O,value:void 0,previousValue:M}),l&&h.$changes.root.removeRef(M.$changes.refId)}))}function I(m,S){if(-1===S||S>=m.length)return!1;for(var h=m.length-1,l=S;l<h;l++)m[l]=m[l+1];return m.length=h,!0}var Z=function(m,S){var h=m.toString(),l=S.toString();return h<l?-1:h>l?1:0};function C(m){return m.$proxy=!0,m=new Proxy(m,{get:function(m,S){return"symbol"===typeof S||isNaN(S)?m[S]:m.at(S)},set:function(m,S,h){if("symbol"===typeof S||isNaN(S))m[S]=h;else{var l=Array.from(m.$items.keys()),M=parseInt(l[S]||S);void 0===h||null===h?m.deleteAt(M):m.setAt(M,h)}return!0},deleteProperty:function(m,S){return"number"===typeof S?m.deleteAt(S):delete m[S],!0}})}var B=function(){function S(){for(var m=[],S=0;S<arguments.length;S++)m[S]=arguments[S];this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,m)}return S.prototype.Mq=function(S,h){return void 0===h&&(h=!0),Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.ADD,S,h?this.$items:void 0)},S.prototype.mh=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.REPLACE,S)},S.is=function(m){return Array.isArray(m)||void 0!==m.array},Object.defineProperty(S.prototype,"length",{get:function(){return this.$items.size},set:function(m){0===m?this.clear():this.splice(m,this.length-m)},enumerable:!1,configurable:!0}),S.prototype.push=function(){for(var m,S=this,h=[],l=0;l<arguments.length;l++)h[l]=arguments[l];return h.forEach((function(h){m=S.$refId++,S.setAt(m,h)})),m},S.prototype.pop=function(){var m=Array.from(this.$indexes.values()).pop();if(void 0!==m){this.$changes.delete(m),this.$indexes.delete(m);var S=this.$items.get(m);return this.$items.delete(m),S}},S.prototype.at=function(m){var S=Array.from(this.$items.keys())[m];return this.$items.get(S)},S.prototype.setAt=function(S,h){var l,M;if(void 0!==h&&null!==h){if(this.$items.get(S)!==h){void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,S);var O=null!==(M=null===(l=this.$changes.indexes[S])||void 0===l?void 0:l.op)&&void 0!==M?M:m.OPERATION.ADD;this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,h),this.$changes.change(S,O)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},S.prototype.deleteAt=function(m){var S=Array.from(this.$items.keys())[m];return void 0!==S&&this.$deleteAt(S)},S.prototype.$deleteAt=function(m){return this.$changes.delete(m),this.$indexes.delete(m),this.$items.delete(m)},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:m.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.concat=function(){for(var m,h=[],l=0;l<arguments.length;l++)h[l]=arguments[l];return new(S.bind.apply(S,M([void 0],(m=Array.from(this.$items.values())).concat.apply(m,h),!1)))},S.prototype.join=function(m){return Array.from(this.$items.values()).join(m)},S.prototype.reverse=function(){var m=this,S=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(h,l){m.setAt(S[l],h)})),this},S.prototype.shift=function(){var m=Array.from(this.$items.keys()).shift();if(void 0!==m){var S=this.$items.get(m);return this.$deleteAt(m),S}},S.prototype.slice=function(m,h){var l=new S;return l.push.apply(l,Array.from(this.$items.values()).slice(m,h)),l},S.prototype.sort=function(m){var S=this;void 0===m&&(m=Z);var h=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(m).forEach((function(m,l){S.setAt(h[l],m)})),this},S.prototype.splice=function(m,S){void 0===S&&(S=this.length-m);for(var h=Array.from(this.$items.keys()),l=[],M=m;M<m+S;M++)l.push(this.$items.get(h[M])),this.$deleteAt(h[M]);return l},S.prototype.unshift=function(){for(var m=this,S=[],h=0;h<arguments.length;h++)S[h]=arguments[h];var l=this.length,M=S.length,O=Array.from(this.$items.values());return S.forEach((function(S,h){m.setAt(h,S)})),O.forEach((function(S,h){m.setAt(M+h,S)})),l+M},S.prototype.indexOf=function(m,S){return Array.from(this.$items.values()).indexOf(m,S)},S.prototype.lastIndexOf=function(m,S){return void 0===S&&(S=this.length-1),Array.from(this.$items.values()).lastIndexOf(m,S)},S.prototype.every=function(m,S){return Array.from(this.$items.values()).every(m,S)},S.prototype.some=function(m,S){return Array.from(this.$items.values()).some(m,S)},S.prototype.forEach=function(m,S){Array.from(this.$items.values()).forEach(m,S)},S.prototype.map=function(m,S){return Array.from(this.$items.values()).map(m,S)},S.prototype.filter=function(m,S){return Array.from(this.$items.values()).filter(m,S)},S.prototype.reduce=function(m,S){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},S.prototype.reduceRight=function(m,S){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},S.prototype.find=function(m,S){return Array.from(this.$items.values()).find(m,S)},S.prototype.findIndex=function(m,S){return Array.from(this.$items.values()).findIndex(m,S)},S.prototype.fill=function(m,S,h){throw new Error("ArraySchema#fill() not implemented")},S.prototype.copyWithin=function(m,S,h){throw new Error("ArraySchema#copyWithin() not implemented")},S.prototype.toString=function(){return this.$items.toString()},S.prototype.toLocaleString=function(){return this.$items.toLocaleString()},S.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(S,Symbol.species,{get:function(){return S},enumerable:!1,configurable:!0}),S.prototype.entries=function(){return this.$items.entries()},S.prototype.keys=function(){return this.$items.keys()},S.prototype.values=function(){return this.$items.values()},S.prototype.includes=function(m,S){return Array.from(this.$items.values()).includes(m,S)},S.prototype.flatMap=function(m,S){throw new Error("ArraySchema#flatMap() is not supported.")},S.prototype.flat=function(m){throw new Error("ArraySchema#flat() is not supported.")},S.prototype.findLast=function(){var m=Array.from(this.$items.values());return m.findLast.apply(m,arguments)},S.prototype.findLastIndex=function(){var m=Array.from(this.$items.values());return m.findLastIndex.apply(m,arguments)},S.prototype.setIndex=function(m,S){this.$indexes.set(m,S)},S.prototype.getIndex=function(m){return this.$indexes.get(m)},S.prototype.getByIndex=function(m){return this.$items.get(this.$indexes.get(m))},S.prototype.deleteByIndex=function(m){var S=this.$indexes.get(m);this.$items.delete(S),this.$indexes.delete(m)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){return this.toArray().map((function(m){return"function"===typeof m.toJSON?m.toJSON():m}))},S.prototype.clone=function(m){return m?new(S.bind.apply(S,M([void 0],Array.from(this.$items.values()),!1))):new(S.bind.apply(S,M([void 0],this.map((function(m){return m.$changes?m.clone():m})),!1)))},S}();function D(m){return m.$proxy=!0,m=new Proxy(m,{get:function(m,S){return"symbol"!==typeof S&&"undefined"===typeof m[S]?m.get(S):m[S]},set:function(m,S,h){return"symbol"!==typeof S&&-1===S.indexOf("$")&&"Mq"!==S&&"mh"!==S&&"onChange"!==S?m.set(S,h):m[S]=h,!0},deleteProperty:function(m,S){return m.delete(S),!0}})}var E=function(){function S(m){var h=this;if(this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,m)if(m instanceof Map||m instanceof S)m.forEach((function(m,S){return h.set(S,m)}));else for(var l in m)this.set(l,m[l])}return S.prototype.Mq=function(S,h){return void 0===h&&(h=!0),Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.ADD,S,h?this.$items:void 0)},S.prototype.mh=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.REPLACE,S)},S.is=function(m){return void 0!==m.map},S.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(S.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(S,Symbol.species,{get:function(){return S},enumerable:!1,configurable:!0}),S.prototype.set=function(S,h){if(void 0===h||null===h)throw new Error("MapSchema#set('".concat(S,"', ").concat(h,"): trying to set ").concat(h," value on '").concat(S,"'."));S=S.toString();var l="undefined"!==typeof this.$changes.indexes[S],M=l?this.$changes.indexes[S]:this.$refId++,O=l?m.OPERATION.REPLACE:m.OPERATION.ADD,u=void 0!==h.$changes;if(u&&h.$changes.setParent(this,this.$changes.root,M),l){if(!u&&this.$items.get(S)===h)return;u&&this.$items.get(S)!==h&&(O=m.OPERATION.ADD)}else this.$changes.indexes[S]=M,this.$indexes.set(M,S);return this.$items.set(S,h),this.$changes.change(S,O),this},S.prototype.get=function(m){return this.$items.get(m)},S.prototype.delete=function(m){return this.$changes.delete(m),this.$items.delete(m)},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:m.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(m){return this.$items.has(m)},S.prototype.forEach=function(m){this.$items.forEach(m)},S.prototype.entries=function(){return this.$items.entries()},S.prototype.keys=function(){return this.$items.keys()},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(m,S){this.$indexes.set(m,S)},S.prototype.getIndex=function(m){return this.$indexes.get(m)},S.prototype.getByIndex=function(m){return this.$items.get(this.$indexes.get(m))},S.prototype.deleteByIndex=function(m){var S=this.$indexes.get(m);this.$items.delete(S),this.$indexes.delete(m)},S.prototype.toJSON=function(){var m={};return this.forEach((function(S,h){m[h]="function"===typeof S.toJSON?S.toJSON():S})),m},S.prototype.clone=function(m){var h;return m?h=Object.assign(new S,this):(h=new S,this.forEach((function(m,S){m.$changes?h.set(S,m.clone()):h.set(S,m)}))),h},S}(),n={};function L(m,S){n[m]=S}function U(m){return n[m]}var H=function(){function m(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return m.create=function(S){var h=new m;return h.schema=Object.assign({},S&&S.schema||{}),h.indexes=Object.assign({},S&&S.indexes||{}),h.fieldsByIndex=Object.assign({},S&&S.fieldsByIndex||{}),h.descriptors=Object.assign({},S&&S.descriptors||{}),h.deprecated=Object.assign({},S&&S.deprecated||{}),h},m.prototype.addField=function(m,S){var h=this.getNextFieldIndex();this.fieldsByIndex[h]=m,this.indexes[m]=h,this.schema[m]=Array.isArray(S)?{array:S[0]}:S},m.prototype.hasField=function(m){return void 0!==this.indexes[m]},m.prototype.addFilter=function(m,S){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[m]]=S,this.indexesWithFilters.push(this.indexes[m]),!0},m.prototype.addChildrenFilter=function(m,S){var h=this.indexes[m],l=this.schema[m];if(U(Object.keys(l)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[h]=S,!0;console.warn("@filterChildren: field '".concat(m,"' can't have children. Ignoring filter."))},m.prototype.getChildrenFilter=function(m){return this.childFilters&&this.childFilters[this.indexes[m]]},m.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},m}();function R(m){return m._context&&m._context.useFilters}var y=function(){function m(){this.types={},this.schemas=new Map,this.useFilters=!1}return m.prototype.has=function(m){return this.schemas.has(m)},m.prototype.get=function(m){return this.types[m]},m.prototype.add=function(m,S){void 0===S&&(S=this.schemas.size),m._definition=H.create(m._definition),m._typeid=S,this.types[S]=m,this.schemas.set(m,S)},m.create=function(S){return void 0===S&&(S={}),function(h){return S.context||(S.context=new m),s(h,S)}},m}(),o=new y;function s(m,S){return void 0===S&&(S={}),function(h,l){var O=S.context||o,u=h.constructor;if(u._context=O,!m)throw new Error("".concat(u.name,': @type() reference provided for "').concat(l,"\" is undefined. Make sure you don't have any circular dependencies."));O.has(u)||O.add(u);var b=u._definition;if(b.addField(l,m),b.descriptors[l]){if(b.deprecated[l])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(l,"' definition on '").concat(u.name,"'.\nCheck @type() annotation"))}catch(n){var q=n.stack.split("\n")[4].trim();throw new Error("".concat(n.message," ").concat(q))}}var Y=B.is(m),V=!Y&&E.is(m);if("string"!==typeof m&&!am.is(m)){var I=Object.values(m)[0];"string"===typeof I||O.has(I)||O.add(I)}if(S.manual)b.descriptors[l]={enumerable:!0,configurable:!0,writable:!0};else{var Z="_".concat(l);b.descriptors[Z]={enumerable:!1,configurable:!1,writable:!0},b.descriptors[l]={get:function(){return this[Z]},set:function(m){m!==this[Z]&&(void 0!==m&&null!==m?(!Y||m instanceof B||(m=new(B.bind.apply(B,M([void 0],m,!1)))),!V||m instanceof E||(m=new E(m)),void 0===m.$proxy&&(V?m=D(m):Y&&(m=C(m))),this.$changes.change(l),m.$changes&&m.$changes.setParent(this,this.$changes.root,this._definition.indexes[l])):this[Z]&&this.$changes.delete(l),this[Z]=m)},enumerable:!0,configurable:!0}}}}function v(m){return function(S,h){var l=S.constructor;l._definition.addFilter(h,m)&&(l._context.useFilters=!0)}}function T(m){return function(S,h){var l=S.constructor;l._definition.addChildrenFilter(h,m)&&(l._context.useFilters=!0)}}function X(m){return void 0===m&&(m=!0),function(S,h){var l=S.constructor._definition;l.deprecated[h]=!0,m&&(l.descriptors[h]={get:function(){throw new Error("".concat(h," is deprecated."))},set:function(m){},enumerable:!1,configurable:!0})}}function g(m,S,h){for(var l in void 0===h&&(h={}),h.context||(h.context=m._context||h.context||o),S)s(S[l],h)(m.prototype,l);return m}function G(m){for(var S=0,h=0,l=0,M=m.length;l<M;l++)(S=m.charCodeAt(l))<128?h+=1:S<2048?h+=2:S<55296||S>=57344?h+=3:(l++,h+=4);return h}function e(m,S,h){for(var l=0,M=0,O=h.length;M<O;M++)(l=h.charCodeAt(M))<128?m[S++]=l:l<2048?(m[S++]=192|l>>6,m[S++]=128|63&l):l<55296||l>=57344?(m[S++]=224|l>>12,m[S++]=128|l>>6&63,m[S++]=128|63&l):(M++,l=65536+((1023&l)<<10|1023&h.charCodeAt(M)),m[S++]=240|l>>18,m[S++]=128|l>>12&63,m[S++]=128|l>>6&63,m[S++]=128|63&l)}function a(m,S){m.push(255&S)}function x(m,S){m.push(255&S)}function P(m,S){m.push(255&S),m.push(S>>8&255)}function d(m,S){m.push(255&S),m.push(S>>8&255)}function J(m,S){m.push(255&S),m.push(S>>8&255),m.push(S>>16&255),m.push(S>>24&255)}function N(m,S){var h=S>>24,l=S>>16,M=S>>8,O=S;m.push(255&O),m.push(255&M),m.push(255&l),m.push(255&h)}function j(m,S){var h=Math.floor(S/Math.pow(2,32));N(m,S>>>0),N(m,h)}function K(m,S){var h=S/Math.pow(2,32)|0;N(m,S>>>0),N(m,h)}function c(m,S){z(m,S)}function f(m,S){Q(m,S)}var p=new Int32Array(2),k=new Float32Array(p.buffer),r=new Float64Array(p.buffer);function z(m,S){k[0]=S,J(m,p[0])}function Q(m,S){r[0]=S,J(m,p[0]),J(m,p[1])}function F(m,S){return x(m,S?1:0)}function w(m,S){S||(S="");var h=G(S),l=0;if(h<32)m.push(160|h),l=1;else if(h<256)m.push(217),x(m,h),l=2;else if(h<65536)m.push(218),d(m,h),l=3;else{if(!(h<4294967296))throw new Error("String too long");m.push(219),N(m,h),l=5}return e(m,m.length,S),l+h}function t(m,S){return isNaN(S)?t(m,0):isFinite(S)?S!==(0|S)?(m.push(203),Q(m,S),9):S>=0?S<128?(x(m,S),1):S<256?(m.push(204),x(m,S),2):S<65536?(m.push(205),d(m,S),3):S<4294967296?(m.push(206),N(m,S),5):(m.push(207),K(m,S),9):S>=-32?(m.push(224|S+32),1):S>=-128?(m.push(208),a(m,S),2):S>=-32768?(m.push(209),P(m,S),3):S>=-2147483648?(m.push(210),J(m,S),5):(m.push(211),j(m,S),9):t(m,S>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var A=Object.freeze({__proto__:null,utf8Write:e,int8:a,uint8:x,int16:P,uint16:d,int32:J,uint32:N,int64:j,uint64:K,float32:c,float64:f,writeFloat32:z,writeFloat64:Q,boolean:F,string:w,number:t});function i(m,S,h){for(var l="",M=0,O=S,u=S+h;O<u;O++){var b=m[O];0!==(128&b)?192!==(224&b)?224!==(240&b)?240!==(248&b)?console.error("Invalid byte "+b.toString(16)):(M=(7&b)<<18|(63&m[++O])<<12|(63&m[++O])<<6|63&m[++O])>=65536?(M-=65536,l+=String.fromCharCode(55296+(M>>>10),56320+(1023&M))):l+=String.fromCharCode(M):l+=String.fromCharCode((15&b)<<12|(63&m[++O])<<6|63&m[++O]):l+=String.fromCharCode((31&b)<<6|63&m[++O]):l+=String.fromCharCode(b)}return l}function W(m,S){return mm(m,S)<<24>>24}function mm(m,S){return m[S.offset++]}function Sm(m,S){return hm(m,S)<<16>>16}function hm(m,S){return m[S.offset++]|m[S.offset++]<<8}function lm(m,S){return m[S.offset++]|m[S.offset++]<<8|m[S.offset++]<<16|m[S.offset++]<<24}function Mm(m,S){return lm(m,S)>>>0}function Om(m,S){return Zm(m,S)}function um(m,S){return Cm(m,S)}function bm(m,S){var h=Mm(m,S);return lm(m,S)*Math.pow(2,32)+h}function qm(m,S){var h=Mm(m,S);return Mm(m,S)*Math.pow(2,32)+h}var Ym=new Int32Array(2),Vm=new Float32Array(Ym.buffer),Im=new Float64Array(Ym.buffer);function Zm(m,S){return Ym[0]=lm(m,S),Vm[0]}function Cm(m,S){return Ym[0]=lm(m,S),Ym[1]=lm(m,S),Im[0]}function Bm(m,S){return mm(m,S)>0}function Dm(m,S){var h,l=m[S.offset++];l<192?h=31&l:217===l?h=mm(m,S):218===l?h=hm(m,S):219===l&&(h=Mm(m,S));var M=i(m,S.offset,h);return S.offset+=h,M}function Em(m,S){var h=m[S.offset];return h<192&&h>160||217===h||218===h||219===h}function nm(m,S){var h=m[S.offset++];return h<128?h:202===h?Zm(m,S):203===h?Cm(m,S):204===h?mm(m,S):205===h?hm(m,S):206===h?Mm(m,S):207===h?qm(m,S):208===h?W(m,S):209===h?Sm(m,S):210===h?lm(m,S):211===h?bm(m,S):h>223?-1*(255-h+1):void 0}function Lm(m,S){var h=m[S.offset];return h<128||h>=202&&h<=211}function Um(m,S){return m[S.offset]<160}function Hm(m,S){return m[S.offset-1]===u&&(m[S.offset]<128||m[S.offset]>=202&&m[S.offset]<=211)}var Rm=Object.freeze({__proto__:null,int8:W,uint8:mm,int16:Sm,uint16:hm,int32:lm,uint32:Mm,float32:Om,float64:um,int64:bm,uint64:qm,readFloat32:Zm,readFloat64:Cm,boolean:Bm,string:Dm,stringCheck:Em,number:nm,numberCheck:Lm,arrayCheck:Um,switchStructureCheck:Hm}),ym=function(){function S(m){var S=this;this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,m&&m.forEach((function(m){return S.add(m)}))}return S.prototype.Mq=function(S,h){return void 0===h&&(h=!0),Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.ADD,S,h?this.$items:void 0)},S.prototype.mh=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.REPLACE,S)},S.is=function(m){return void 0!==m.collection},S.prototype.add=function(m){var S=this.$refId++;return void 0!==m.$changes&&m.$changes.setParent(this,this.$changes.root,S),this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,m),this.$changes.change(S),S},S.prototype.at=function(m){var S=Array.from(this.$items.keys())[m];return this.$items.get(S)},S.prototype.entries=function(){return this.$items.entries()},S.prototype.delete=function(m){for(var S,h,l=this.$items.entries();(h=l.next())&&!h.done;)if(m===h.value[1]){S=h.value[0];break}return void 0!==S&&(this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S))},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:m.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(m){return Array.from(this.$items.values()).some((function(S){return S===m}))},S.prototype.forEach=function(m){var S=this;this.$items.forEach((function(h,l,M){return m(h,l,S)}))},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(m,S){this.$indexes.set(m,S)},S.prototype.getIndex=function(m){return this.$indexes.get(m)},S.prototype.getByIndex=function(m){return this.$items.get(this.$indexes.get(m))},S.prototype.deleteByIndex=function(m){var S=this.$indexes.get(m);this.$items.delete(S),this.$indexes.delete(m)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){var m=[];return this.forEach((function(S,h){m.push("function"===typeof S.toJSON?S.toJSON():S)})),m},S.prototype.clone=function(m){var h;return m?h=Object.assign(new S,this):(h=new S,this.forEach((function(m){m.$changes?h.add(m.clone()):h.add(m)}))),h},S}(),om=function(){function S(m){var S=this;this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,m&&m.forEach((function(m){return S.add(m)}))}return S.prototype.Mq=function(S,h){return void 0===h&&(h=!0),Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.ADD,S,h?this.$items:void 0)},S.prototype.mh=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.REPLACE,S)},S.is=function(m){return void 0!==m.set},S.prototype.add=function(S){var h,l;if(this.has(S))return!1;var M=this.$refId++;void 0!==S.$changes&&S.$changes.setParent(this,this.$changes.root,M);var O=null!==(l=null===(h=this.$changes.indexes[M])||void 0===h?void 0:h.op)&&void 0!==l?l:m.OPERATION.ADD;return this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,S),this.$changes.change(M,O),M},S.prototype.entries=function(){return this.$items.entries()},S.prototype.delete=function(m){for(var S,h,l=this.$items.entries();(h=l.next())&&!h.done;)if(m===h.value[1]){S=h.value[0];break}return void 0!==S&&(this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S))},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:m.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(m){for(var S,h=this.$items.values(),l=!1;(S=h.next())&&!S.done;)if(m===S.value){l=!0;break}return l},S.prototype.forEach=function(m){var S=this;this.$items.forEach((function(h,l,M){return m(h,l,S)}))},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(m,S){this.$indexes.set(m,S)},S.prototype.getIndex=function(m){return this.$indexes.get(m)},S.prototype.getByIndex=function(m){return this.$items.get(this.$indexes.get(m))},S.prototype.deleteByIndex=function(m){var S=this.$indexes.get(m);this.$items.delete(S),this.$indexes.delete(m)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){var m=[];return this.forEach((function(S,h){m.push("function"===typeof S.toJSON?S.toJSON():S)})),m},S.prototype.clone=function(m){var h;return m?h=Object.assign(new S,this):(h=new S,this.forEach((function(m){m.$changes?h.add(m.clone()):h.add(m)}))),h},S}(),sm=function(){function m(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return m.prototype.addRefId=function(m){this.refIds.has(m)||(this.refIds.add(m),this.containerIndexes.set(m,new Set))},m.get=function(S){return void 0===S.$filterState&&(S.$filterState=new m),S.$filterState},m}(),vm=function(){function m(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return m.prototype.getNextUniqueId=function(){return this.nextUniqueId++},m.prototype.addRef=function(m,S,h){void 0===h&&(h=!0),this.refs.set(m,S),h&&(this.refCounts[m]=(this.refCounts[m]||0)+1)},m.prototype.removeRef=function(m){this.refCounts[m]=this.refCounts[m]-1,this.deletedRefs.add(m)},m.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},m.prototype.garbageCollectDeletedRefs=function(){var m=this;this.deletedRefs.forEach((function(S){if(!(m.refCounts[S]>0)){var h=m.refs.get(S);if(h instanceof am)for(var l in h._definition.schema)"string"!==typeof h._definition.schema[l]&&h[l]&&h[l].$changes&&m.removeRef(h[l].$changes.refId);else{var M=h.$changes.parent._definition,O=M.schema[M.fieldsByIndex[h.$changes.parentIndex]];"function"===typeof Object.values(O)[0]&&Array.from(h.values()).forEach((function(S){return m.removeRef(S.$changes.refId)}))}m.refs.delete(S),delete m.refCounts[S]}})),this.deletedRefs.clear()},m}(),Tm=function(m){function S(){return null!==m&&m.apply(this,arguments)||this}return h(S,m),S}(Error);function Xm(m,S,h,l){var M,O=!1;switch(S){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":M="number",isNaN(m)&&console.log('trying to encode "NaN" in '.concat(h.constructor.name,"#").concat(l));break;case"string":M="string",O=!0;break;case"boolean":return}if(typeof m!==M&&(!O||O&&null!==m)){var u="'".concat(JSON.stringify(m),"'").concat(m&&m.constructor&&" (".concat(m.constructor.name,")")||"");throw new Tm("a '".concat(M,"' was expected, but ").concat(u," was provided in ").concat(h.constructor.name,"#").concat(l))}}function gm(m,S,h,l){if(!(m instanceof S))throw new Tm("a '".concat(S.name,"' was expected, but '").concat(m.constructor.name,"' was provided in ").concat(h.constructor.name,"#").concat(l))}function Gm(m,S,h,l,M){Xm(h,m,l,M);var O=A[m];if(!O)throw new Tm("a '".concat(m,"' was expected, but ").concat(h," was provided in ").concat(l.constructor.name,"#").concat(M));O(S,h)}function em(m,S,h){return Rm[m](S,h)}var am=function(){function S(){for(var m=[],S=0;S<arguments.length;S++)m[S]=arguments[S];Object.defineProperties(this,{$changes:{value:new q(this,void 0,new vm),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var h=this._definition.descriptors;h&&Object.defineProperties(this,h),m[0]&&this.assign(m[0])}return S.onError=function(m){console.error(m)},S.is=function(m){return m._definition&&void 0!==m._definition.schema},S.prototype.onChange=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.REPLACE,S)},S.prototype.mh=function(S){return Y(this.$callbacks||(this.$callbacks=[]),m.OPERATION.DELETE,S)},S.prototype.assign=function(m){return Object.assign(this,m),this},Object.defineProperty(S.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),S.prototype.setDirty=function(m,S){this.$changes.change(m,S)},S.prototype.listen=function(m,S,h){var l=this;return void 0===h&&(h=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[m]||(this.$callbacks[m]=[]),this.$callbacks[m].push(S),h&&void 0!==this[m]&&S(this[m],void 0),function(){return I(l.$callbacks[m],l.$callbacks[m].indexOf(S))}},S.prototype.decode=function(h,l,M){var O;void 0===l&&(l={offset:0}),void 0===M&&(M=this);var b=[],q=this.$changes.root,Y=h.length,V=0;for(q.refs.set(V,this);l.offset<Y;){var I=h[l.offset++];if(I!=u){var Z=M.$changes,C=void 0!==M._definition,D=C?I>>6<<6:I;if(D!==m.OPERATION.CLEAR){var n=C?I%(D||255):nm(h,l),L=C?M._definition.fieldsByIndex[n]:"",H=Z.getType(n),R=void 0,y=void 0,o=void 0;if(C?y=M["_".concat(L)]:(y=M.getByIndex(n),(D&m.OPERATION.ADD)===m.OPERATION.ADD?(o=M instanceof E?Dm(h,l):n,M.setIndex(n,o)):o=M.getIndex(n)),(D&m.OPERATION.DELETE)===m.OPERATION.DELETE&&(D!==m.OPERATION.DELETE_AND_ADD&&M.deleteByIndex(n),y&&y.$changes&&q.removeRef(y.$changes.refId),R=null),void 0!==L){if(D===m.OPERATION.DELETE);else if(S.is(H)){var s=nm(h,l);if(R=q.refs.get(s),D!==m.OPERATION.REPLACE){var v=this.getSchemaType(h,l,H);R||((R=this.createTypeInstance(v)).$changes.refId=s,y&&(R.$callbacks=y.$callbacks,y.$changes.refId&&s!==y.$changes.refId&&q.removeRef(y.$changes.refId))),q.addRef(s,R,R!==y)}}else if("string"===typeof H)R=em(H,h,l);else{var T=U(Object.keys(H)[0]),X=nm(h,l),g=q.refs.has(X)?y||q.refs.get(X):new T.constructor;if((R=g.clone(!0)).$changes.refId=X,y&&(R.$callbacks=y.$callbacks,y.$changes.refId&&X!==y.$changes.refId)){q.removeRef(y.$changes.refId);for(var G=y.entries(),e=void 0;(e=G.next())&&!e.done;){var a=(O=e.value)[0],x=O[1];b.push({refId:X,op:m.OPERATION.DELETE,field:a,value:void 0,previousValue:x})}}q.addRef(X,R,g!==y)}if(null!==R&&void 0!==R)if(R.$changes&&R.$changes.setParent(Z.ref,Z.root,n),M instanceof S)M[L]=R;else if(M instanceof E)a=o,M.$items.set(a,R),M.$changes.allChanges.add(n);else if(M instanceof B)M.setAt(n,R);else if(M instanceof ym){var P=M.add(R);M.setIndex(n,P)}else M instanceof om&&!1!==(P=M.add(R))&&M.setIndex(n,P);y!==R&&b.push({refId:V,op:D,field:L,dynamicIndex:o,value:R,previousValue:y})}else{console.warn("@colyseus/schema: definition mismatch");for(var d={offset:l.offset};l.offset<Y&&(!Hm(h,l)||(d.offset=l.offset+1,!q.refs.has(nm(h,d))));)l.offset++}}else M.clear(b)}else{V=nm(h,l);var J=q.refs.get(V);if(!J)throw new Error('"refId" not found: '.concat(V));M=J}}return this._triggerChanges(b),q.garbageCollectDeletedRefs(),b},S.prototype.encode=function(h,l,M){void 0===h&&(h=!1),void 0===l&&(l=[]),void 0===M&&(M=!1);for(var O=this.$changes,b=new WeakSet,q=[O],Y=1,V=0;V<Y;V++){var I=q[V],Z=I.ref,C=Z instanceof S;I.ensureRefId(),b.add(I),I!==O&&(I.changed||h)&&(x(l,u),t(l,I.refId));for(var B=h?Array.from(I.allChanges):Array.from(I.changes.values()),D=0,n=B.length;D<n;D++){var L=h?{op:m.OPERATION.ADD,index:B[D]}:B[D],H=L.index,R=C?Z._definition.fieldsByIndex&&Z._definition.fieldsByIndex[H]:H,y=l.length;if(L.op!==m.OPERATION.TOUCH)if(C)x(l,H|L.op);else{if(x(l,L.op),L.op===m.OPERATION.CLEAR)continue;t(l,H)}if(C||(L.op&m.OPERATION.ADD)!=m.OPERATION.ADD||Z instanceof E&&w(l,I.ref.$indexes.get(H)),L.op!==m.OPERATION.DELETE){var o=I.getType(H),s=I.getValue(H);if(s&&s.$changes&&!b.has(s.$changes)&&(q.push(s.$changes),s.$changes.ensureRefId(),Y++),L.op!==m.OPERATION.TOUCH){if(S.is(o))gm(s,o,Z,R),t(l,s.$changes.refId),(L.op&m.OPERATION.ADD)===m.OPERATION.ADD&&this.tryEncodeTypeId(l,o,s.constructor);else if("string"===typeof o)Gm(o,l,s,Z,R);else{var v=U(Object.keys(o)[0]);gm(Z["_".concat(R)],v.constructor,Z,R),t(l,s.$changes.refId)}M&&I.cache(H,l.slice(y))}}}h||M||I.discard()}return l},S.prototype.encodeAll=function(m){return this.encode(!0,[],m)},S.prototype.applyFilters=function(h,l){var M,O;void 0===l&&(l=!1);for(var b=this,q=new Set,Y=sm.get(h),V=[this.$changes],I=1,Z=[],C=function(C){var B=V[C];if(q.has(B.refId))return"continue";var D=B.ref,n=D instanceof S;x(Z,u),t(Z,B.refId);var L=Y.refIds.has(B),U=l||!L;Y.addRefId(B);var H=Y.containerIndexes.get(B),R=U?Array.from(B.allChanges):Array.from(B.changes.values());!l&&n&&D._definition.indexesWithFilters&&D._definition.indexesWithFilters.forEach((function(S){!H.has(S)&&B.allChanges.has(S)&&(U?R.push(S):R.push({op:m.OPERATION.ADD,index:S}))}));for(var y=0,o=R.length;y<o;y++){var s=U?{op:m.OPERATION.ADD,index:R[y]}:R[y];if(s.op!==m.OPERATION.CLEAR){var v=s.index;if(s.op!==m.OPERATION.DELETE){var T=B.getValue(v),X=B.getType(v);if(n){if((g=D._definition.filters&&D._definition.filters[v])&&!g.call(D,h,T,b)){T&&T.$changes&&q.add(T.$changes.refId);continue}}else{var g,G=B.parent;if((g=B.getChildrenFilter())&&!g.call(G,h,D.$indexes.get(v),T,b)){T&&T.$changes&&q.add(T.$changes.refId);continue}}if(T.$changes&&(V.push(T.$changes),I++),s.op!==m.OPERATION.TOUCH)if(s.op===m.OPERATION.ADD||n)Z.push.apply(Z,null!==(M=B.caches[v])&&void 0!==M?M:[]),H.add(v);else if(H.has(v))Z.push.apply(Z,null!==(O=B.caches[v])&&void 0!==O?O:[]);else{if(H.add(v),x(Z,m.OPERATION.ADD),t(Z,v),D instanceof E){var e=B.ref.$indexes.get(v);w(Z,e)}T.$changes?t(Z,T.$changes.refId):A[X](Z,T)}else T.$changes&&!n&&(x(Z,m.OPERATION.ADD),t(Z,v),D instanceof E&&(e=B.ref.$indexes.get(v),w(Z,e)),t(Z,T.$changes.refId))}else n?x(Z,s.op|v):(x(Z,s.op),t(Z,v))}else x(Z,s.op)}},B=0;B<I;B++)C(B);return Z},S.prototype.clone=function(){var m,S=new this.constructor,h=this._definition.schema;for(var l in h)"object"===typeof this[l]&&"function"===typeof(null===(m=this[l])||void 0===m?void 0:m.clone)?S[l]=this[l].clone():S[l]=this[l];return S},S.prototype.toJSON=function(){var m=this._definition.schema,S=this._definition.deprecated,h={};for(var l in m)S[l]||null===this[l]||"undefined"===typeof this[l]||(h[l]="function"===typeof this[l].toJSON?this[l].toJSON():this["_".concat(l)]);return h},S.prototype.discardAllChanges=function(){this.$changes.discardAll()},S.prototype.getByIndex=function(m){return this[this._definition.fieldsByIndex[m]]},S.prototype.deleteByIndex=function(m){this[this._definition.fieldsByIndex[m]]=void 0},S.prototype.tryEncodeTypeId=function(m,S,h){S._typeid!==h._typeid&&(x(m,b),t(m,h._typeid))},S.prototype.getSchemaType=function(m,S,h){var l;return m[S.offset]===b&&(S.offset++,l=this.constructor._context.get(nm(m,S))),l||h},S.prototype.createTypeInstance=function(m){var S=new m;return S.$changes.root=this.$changes.root,S},S.prototype._triggerChanges=function(h){for(var l,M,O,u,b,q,Y,V,I,Z=new Set,C=this.$changes.root.refs,B=function(B){var D=h[B],E=D.refId,n=C.get(E),L=n.$callbacks;if((D.op&m.OPERATION.DELETE)===m.OPERATION.DELETE&&D.previousValue instanceof S&&(null===(M=null===(l=D.previousValue.$callbacks)||void 0===l?void 0:l[m.OPERATION.DELETE])||void 0===M||M.forEach((function(m){return m()}))),!L)return"continue";if(n instanceof S){if(!Z.has(E))try{null===(O=null===L||void 0===L?void 0:L[m.OPERATION.REPLACE])||void 0===O||O.forEach((function(m){return m()}))}catch(U){S.onError(U)}try{L.hasOwnProperty(D.field)&&(null===(u=L[D.field])||void 0===u||u.forEach((function(m){return m(D.value,D.previousValue)})))}catch(U){S.onError(U)}}else D.op===m.OPERATION.ADD&&void 0===D.previousValue?null===(b=L[m.OPERATION.ADD])||void 0===b||b.forEach((function(m){var S;return m(D.value,null!==(S=D.dynamicIndex)&&void 0!==S?S:D.field)})):D.op===m.OPERATION.DELETE?void 0!==D.previousValue&&(null===(q=L[m.OPERATION.DELETE])||void 0===q||q.forEach((function(m){var S;return m(D.previousValue,null!==(S=D.dynamicIndex)&&void 0!==S?S:D.field)}))):D.op===m.OPERATION.DELETE_AND_ADD&&(void 0!==D.previousValue&&(null===(Y=L[m.OPERATION.DELETE])||void 0===Y||Y.forEach((function(m){var S;return m(D.previousValue,null!==(S=D.dynamicIndex)&&void 0!==S?S:D.field)}))),null===(V=L[m.OPERATION.ADD])||void 0===V||V.forEach((function(m){var S;return m(D.value,null!==(S=D.dynamicIndex)&&void 0!==S?S:D.field)}))),D.value!==D.previousValue&&(null===(I=L[m.OPERATION.REPLACE])||void 0===I||I.forEach((function(m){var S;return m(D.value,null!==(S=D.dynamicIndex)&&void 0!==S?S:D.field)})));Z.add(E)},D=0;D<h.length;D++)B(D)},S._definition=H.create(),S}();function xm(m){for(var S=[m.$changes],h=1,l={},M=l,O=function(m){var h=S[m];h.changes.forEach((function(m){var S=h.ref,l=m.index,O=S._definition?S._definition.fieldsByIndex[l]:S.$indexes.get(l);M[O]=h.getValue(l)}))},u=0;u<h;u++)O(u);return l}var Pm={context:new y},dm=function(m){function S(){return null!==m&&m.apply(this,arguments)||this}return h(S,m),l([s("string",Pm)],S.prototype,"name",void 0),l([s("string",Pm)],S.prototype,"type",void 0),l([s("number",Pm)],S.prototype,"referencedType",void 0),S}(am),Jm=function(m){function S(){var S=null!==m&&m.apply(this,arguments)||this;return S.fields=new B,S}return h(S,m),l([s("number",Pm)],S.prototype,"id",void 0),l([s([dm],Pm)],S.prototype,"fields",void 0),S}(am),Nm=function(m){function S(){var S=null!==m&&m.apply(this,arguments)||this;return S.types=new B,S}return h(S,m),S.encode=function(m){var h=m.constructor,l=new S;l.rootType=h._typeid;var M=function(m,S){for(var h in S){var M=new dm;M.name=h;var O=void 0;if("string"===typeof S[h])O=S[h];else{var u=S[h],b=void 0;am.is(u)?(O="ref",b=S[h]):"string"===typeof u[O=Object.keys(u)[0]]?O+=":"+u[O]:b=u[O],M.referencedType=b?b._typeid:-1}M.type=O,m.fields.push(M)}l.types.push(m)},O=h._context.types;for(var u in O){var b=new Jm;b.id=Number(u),M(b,O[u]._definition.schema)}return l.encodeAll()},S.decode=function(m,l){var M=new y,O=new S;O.decode(m,l);var u=O.types.reduce((function(m,S){var l=function(m){function S(){return null!==m&&m.apply(this,arguments)||this}return h(S,m),S}(am),O=S.id;return m[O]=l,M.add(l,O),m}),{});O.types.forEach((function(m){var S=u[m.id];m.fields.forEach((function(m){var h;if(void 0!==m.referencedType){var l=m.type,O=u[m.referencedType];if(!O){var b=m.type.split(":");l=b[0],O=b[1]}"ref"===l?s(O,{context:M})(S.prototype,m.name):s(((h={})[l]=O,h),{context:M})(S.prototype,m.name)}else s(m.type,{context:M})(S.prototype,m.name)}))}));var b=u[O.rootType],q=new b;for(var Y in b._definition.schema){var V=b._definition.schema[Y];"string"!==typeof V&&(q[Y]="function"===typeof V?new V:new(U(Object.keys(V)[0]).constructor))}return q},l([s([Jm],Pm)],S.prototype,"types",void 0),l([s("number",Pm)],S.prototype,"rootType",void 0),S}(am);L("map",{constructor:E}),L("array",{constructor:B}),L("set",{constructor:om}),L("collection",{constructor:ym}),m.ArraySchema=B,m.CollectionSchema=ym,m.Context=y,m.MapSchema=E,m.Reflection=Nm,m.ReflectionField=dm,m.ReflectionType=Jm,m.Schema=am,m.SchemaDefinition=H,m.SetSchema=om,m.decode=Rm,m.defineTypes=g,m.deprecated=X,m.dumpChanges=xm,m.encode=A,m.filter=v,m.filterChildren=T,m.hasFilter=R,m.registerType=L,m.type=s,Object.defineProperty(m,"__esModule",{value:!0})}(S)},13482:m=>{"use strict";m.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13474:(m,S,h)=>{var l=h(13482),M=h(13490),O=Object.hasOwnProperty,u=Object.create(null);for(var b in l)O.call(l,b)&&(u[l[b]]=b);var q=m.exports={to:{},get:{}};function Y(m,S,h){return Math.min(Math.max(S,m),h)}function V(m){var S=Math.round(m).toString(16).toUpperCase();return S.length<2?"0"+S:S}q.get=function(m){var S,h;switch(m.substring(0,3).toLowerCase()){case"hsl":S=q.get.hsl(m),h="hsl";break;case"hwb":S=q.get.hwb(m),h="hwb";break;default:S=q.get.rgb(m),h="rgb"}return S?{model:h,value:S}:null},q.get.rgb=function(m){if(!m)return null;var S,h,M,u=[0,0,0,1];if(S=m.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(M=S[2],S=S[1],h=0;h<3;h++){var b=2*h;u[h]=parseInt(S.slice(b,b+2),16)}M&&(u[3]=parseInt(M,16)/255)}else if(S=m.match(/^#([a-f0-9]{3,4})$/i)){for(M=(S=S[1])[3],h=0;h<3;h++)u[h]=parseInt(S[h]+S[h],16);M&&(u[3]=parseInt(M+M,16)/255)}else if(S=m.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(h=0;h<3;h++)u[h]=parseInt(S[h+1],0);S[4]&&(S[5]?u[3]=.01*parseFloat(S[4]):u[3]=parseFloat(S[4]))}else{if(!(S=m.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(S=m.match(/^(\w+)$/))?"transparent"===S[1]?[0,0,0,0]:O.call(l,S[1])?((u=l[S[1]])[3]=1,u):null:null;for(h=0;h<3;h++)u[h]=Math.round(2.55*parseFloat(S[h+1]));S[4]&&(S[5]?u[3]=.01*parseFloat(S[4]):u[3]=parseFloat(S[4]))}for(h=0;h<3;h++)u[h]=Y(u[h],0,255);return u[3]=Y(u[3],0,1),u},q.get.hsl=function(m){if(!m)return null;var S=m.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(S){var h=parseFloat(S[4]);return[(parseFloat(S[1])%360+360)%360,Y(parseFloat(S[2]),0,100),Y(parseFloat(S[3]),0,100),Y(isNaN(h)?1:h,0,1)]}return null},q.get.hwb=function(m){if(!m)return null;var S=m.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(S){var h=parseFloat(S[4]);return[(parseFloat(S[1])%360+360)%360,Y(parseFloat(S[2]),0,100),Y(parseFloat(S[3]),0,100),Y(isNaN(h)?1:h,0,1)]}return null},q.to.hex=function(){var m=M(arguments);return"#"+V(m[0])+V(m[1])+V(m[2])+(m[3]<1?V(Math.round(255*m[3])):"")},q.to.rgb=function(){var m=M(arguments);return m.length<4||1===m[3]?"rgb("+Math.round(m[0])+", "+Math.round(m[1])+", "+Math.round(m[2])+")":"rgba("+Math.round(m[0])+", "+Math.round(m[1])+", "+Math.round(m[2])+", "+m[3]+")"},q.to.rgb.percent=function(){var m=M(arguments),S=Math.round(m[0]/255*100),h=Math.round(m[1]/255*100),l=Math.round(m[2]/255*100);return m.length<4||1===m[3]?"rgb("+S+"%, "+h+"%, "+l+"%)":"rgba("+S+"%, "+h+"%, "+l+"%, "+m[3]+")"},q.to.hsl=function(){var m=M(arguments);return m.length<4||1===m[3]?"hsl("+m[0]+", "+m[1]+"%, "+m[2]+"%)":"hsla("+m[0]+", "+m[1]+"%, "+m[2]+"%, "+m[3]+")"},q.to.hwb=function(){var m=M(arguments),S="";return m.length>=4&&1!==m[3]&&(S=", "+m[3]),"hwb("+m[0]+", "+m[1]+"%, "+m[2]+"%"+S+")"},q.to.keyword=function(m){return u[m.slice(0,3)]}},13469:(m,S,h)=>{const l=h(13474),M=h(13503),O=["keyword","gray","hex"],u={};for(const C of Object.keys(M))u[[...M[C].labels].sort().join("")]=C;const b={};function q(m,S){if(!(this instanceof q))return new q(m,S);if(S&&S in O&&(S=null),S&&!(S in M))throw new Error("Unknown model: "+S);let h,Y;if(null==m)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(m instanceof q)this.model=m.model,this.color=[...m.color],this.valpha=m.valpha;else if("string"===typeof m){const S=l.get(m);if(null===S)throw new Error("Unable to parse color from string: "+m);this.model=S.model,Y=M[this.model].channels,this.color=S.value.slice(0,Y),this.valpha="number"===typeof S.value[Y]?S.value[Y]:1}else if(m.length>0){this.model=S||"rgb",Y=M[this.model].channels;const h=Array.prototype.slice.call(m,0,Y);this.color=Z(h,Y),this.valpha="number"===typeof m[Y]?m[Y]:1}else if("number"===typeof m)this.model="rgb",this.color=[m>>16&255,m>>8&255,255&m],this.valpha=1;else{this.valpha=1;const S=Object.keys(m);"alpha"in m&&(S.splice(S.indexOf("alpha"),1),this.valpha="number"===typeof m.alpha?m.alpha:0);const l=S.sort().join("");if(!(l in u))throw new Error("Unable to parse color from object: "+JSON.stringify(m));this.model=u[l];const{labels:O}=M[this.model],b=[];for(h=0;h<O.length;h++)b.push(m[O[h]]);this.color=Z(b)}if(b[this.model])for(Y=M[this.model].channels,h=0;h<Y;h++){const m=b[this.model][h];m&&(this.color[h]=m(this.color[h]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}q.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(m){let S=this.model in l.to?this:this.rgb();S=S.round("number"===typeof m?m:1);const h=1===S.valpha?S.color:[...S.color,this.valpha];return l.to[S.model](h)},percentString(m){const S=this.rgb().round("number"===typeof m?m:1),h=1===S.valpha?S.color:[...S.color,this.valpha];return l.to.rgb.percent(h)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const m={},{channels:S}=M[this.model],{labels:h}=M[this.model];for(let l=0;l<S;l++)m[h[l]]=this.color[l];return 1!==this.valpha&&(m.alpha=this.valpha),m},unitArray(){const m=this.rgb().color;return m[0]/=255,m[1]/=255,m[2]/=255,1!==this.valpha&&m.push(this.valpha),m},unitObject(){const m=this.rgb().object();return m.r/=255,m.g/=255,m.b/=255,1!==this.valpha&&(m.alpha=this.valpha),m},round(m){return m=Math.max(m||0,0),new q([...this.color.map(Y(m)),this.valpha],this.model)},alpha(m){return void 0!==m?new q([...this.color,Math.max(0,Math.min(1,m))],this.model):this.valpha},red:V("rgb",0,I(255)),green:V("rgb",1,I(255)),blue:V("rgb",2,I(255)),hue:V(["hsl","hsv","hsl","hwb","hcg"],0,(m=>(m%360+360)%360)),saturationl:V("hsl",1,I(100)),lightness:V("hsl",2,I(100)),saturationv:V("hsv",1,I(100)),value:V("hsv",2,I(100)),chroma:V("hcg",1,I(100)),gray:V("hcg",2,I(100)),white:V("hwb",1,I(100)),wblack:V("hwb",2,I(100)),cyan:V("cmyk",0,I(100)),magenta:V("cmyk",1,I(100)),yellow:V("cmyk",2,I(100)),black:V("cmyk",3,I(100)),x:V("xyz",0,I(95.047)),y:V("xyz",1,I(100)),z:V("xyz",2,I(108.833)),l:V("lab",0,I(100)),a:V("lab",1),b:V("lab",2),keyword(m){return void 0!==m?new q(m):M[this.model].keyword(this.color)},hex(m){return void 0!==m?new q(m):l.to.hex(this.rgb().round().color)},hexa(m){if(void 0!==m)return new q(m);const S=this.rgb().round().color;let h=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===h.length&&(h="0"+h),l.to.hex(S)+h},rgbNumber(){const m=this.rgb().color;return(255&m[0])<<16|(255&m[1])<<8|255&m[2]},luminosity(){const m=this.rgb().color,S=[];for(const[h,l]of m.entries()){const m=l/255;S[h]=m<=.04045?m/12.92:((m+.055)/1.055)**2.4}return.2126*S[0]+.7152*S[1]+.0722*S[2]},contrast(m){const S=this.luminosity(),h=m.luminosity();return S>h?(S+.05)/(h+.05):(h+.05)/(S+.05)},level(m){const S=this.contrast(m);return S>=7?"AAA":S>=4.5?"AA":""},isDark(){const m=this.rgb().color;return(2126*m[0]+7152*m[1]+722*m[2])/1e4<128},isLight(){return!this.isDark()},negate(){const m=this.rgb();for(let S=0;S<3;S++)m.color[S]=255-m.color[S];return m},lighten(m){const S=this.hsl();return S.color[2]+=S.color[2]*m,S},darken(m){const S=this.hsl();return S.color[2]-=S.color[2]*m,S},saturate(m){const S=this.hsl();return S.color[1]+=S.color[1]*m,S},desaturate(m){const S=this.hsl();return S.color[1]-=S.color[1]*m,S},whiten(m){const S=this.hwb();return S.color[1]+=S.color[1]*m,S},blacken(m){const S=this.hwb();return S.color[2]+=S.color[2]*m,S},grayscale(){const m=this.rgb().color,S=.3*m[0]+.59*m[1]+.11*m[2];return q.rgb(S,S,S)},fade(m){return this.alpha(this.valpha-this.valpha*m)},opaquer(m){return this.alpha(this.valpha+this.valpha*m)},rotate(m){const S=this.hsl();let h=S.color[0];return h=(h+m)%360,h=h<0?360+h:h,S.color[0]=h,S},mix(m,S){if(!m||!m.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof m);const h=m.rgb(),l=this.rgb(),M=void 0===S?.5:S,O=2*M-1,u=h.alpha()-l.alpha(),b=((O*u===-1?O:(O+u)/(1+O*u))+1)/2,Y=1-b;return q.rgb(b*h.red()+Y*l.red(),b*h.green()+Y*l.green(),b*h.blue()+Y*l.blue(),h.alpha()*M+l.alpha()*(1-M))}};for(const C of Object.keys(M)){if(O.includes(C))continue;const{channels:m}=M[C];q.prototype[C]=function(){if(this.model===C)return new q(this);for(var m=arguments.length,S=new Array(m),h=0;h<m;h++)S[h]=arguments[h];return S.length>0?new q(S,C):new q([...(l=M[this.model][C].raw(this.color),Array.isArray(l)?l:[l]),this.valpha],C);var l},q[C]=function(){for(var S=arguments.length,h=new Array(S),l=0;l<S;l++)h[l]=arguments[l];let M=h[0];return"number"===typeof M&&(M=Z(h,m)),new q(M,C)}}function Y(m){return function(S){return function(m,S){return Number(m.toFixed(S))}(S,m)}}function V(m,S,h){m=Array.isArray(m)?m:[m];for(const l of m)(b[l]||(b[l]=[]))[S]=h;return m=m[0],function(l){let M;return void 0!==l?(h&&(l=h(l)),M=this[m](),M.color[S]=l,M):(M=this[m]().color[S],h&&(M=h(M)),M)}}function I(m){return function(S){return Math.max(0,Math.min(m,S))}}function Z(m,S){for(let h=0;h<S;h++)"number"!==typeof m[h]&&(m[h]=0);return m}m.exports=q},13511:(m,S,h)=>{const l=h(13520),M={};for(const u of Object.keys(l))M[l[u]]=u;const O={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};m.exports=O;for(const u of Object.keys(O)){if(!("channels"in O[u]))throw new Error("missing channels property: "+u);if(!("labels"in O[u]))throw new Error("missing channel labels property: "+u);if(O[u].labels.length!==O[u].channels)throw new Error("channel and label counts mismatch: "+u);const{channels:m,labels:S}=O[u];delete O[u].channels,delete O[u].labels,Object.defineProperty(O[u],"channels",{value:m}),Object.defineProperty(O[u],"labels",{value:S})}O.rgb.hsl=function(m){const S=m[0]/255,h=m[1]/255,l=m[2]/255,M=Math.min(S,h,l),O=Math.max(S,h,l),u=O-M;let b,q;O===M?b=0:S===O?b=(h-l)/u:h===O?b=2+(l-S)/u:l===O&&(b=4+(S-h)/u),b=Math.min(60*b,360),b<0&&(b+=360);const Y=(M+O)/2;return q=O===M?0:Y<=.5?u/(O+M):u/(2-O-M),[b,100*q,100*Y]},O.rgb.hsv=function(m){let S,h,l,M,O;const u=m[0]/255,b=m[1]/255,q=m[2]/255,Y=Math.max(u,b,q),V=Y-Math.min(u,b,q),I=function(m){return(Y-m)/6/V+.5};return 0===V?(M=0,O=0):(O=V/Y,S=I(u),h=I(b),l=I(q),u===Y?M=l-h:b===Y?M=1/3+S-l:q===Y&&(M=2/3+h-S),M<0?M+=1:M>1&&(M-=1)),[360*M,100*O,100*Y]},O.rgb.hwb=function(m){const S=m[0],h=m[1];let l=m[2];const M=O.rgb.hsl(m)[0],u=1/255*Math.min(S,Math.min(h,l));return l=1-1/255*Math.max(S,Math.max(h,l)),[M,100*u,100*l]},O.rgb.cmyk=function(m){const S=m[0]/255,h=m[1]/255,l=m[2]/255,M=Math.min(1-S,1-h,1-l);return[100*((1-S-M)/(1-M)||0),100*((1-h-M)/(1-M)||0),100*((1-l-M)/(1-M)||0),100*M]},O.rgb.keyword=function(m){const S=M[m];if(S)return S;let h,O=1/0;for(const M of Object.keys(l)){const S=l[M],q=(b=S,((u=m)[0]-b[0])**2+(u[1]-b[1])**2+(u[2]-b[2])**2);q<O&&(O=q,h=M)}var u,b;return h},O.keyword.rgb=function(m){return l[m]},O.rgb.xyz=function(m){let S=m[0]/255,h=m[1]/255,l=m[2]/255;S=S>.04045?((S+.055)/1.055)**2.4:S/12.92,h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92;return[100*(.4124*S+.3576*h+.1805*l),100*(.2126*S+.7152*h+.0722*l),100*(.0193*S+.1192*h+.9505*l)]},O.rgb.lab=function(m){const S=O.rgb.xyz(m);let h=S[0],l=S[1],M=S[2];h/=95.047,l/=100,M/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,M=M>.008856?M**(1/3):7.787*M+16/116;return[116*l-16,500*(h-l),200*(l-M)]},O.hsl.rgb=function(m){const S=m[0]/360,h=m[1]/100,l=m[2]/100;let M,O,u;if(0===h)return u=255*l,[u,u,u];M=l<.5?l*(1+h):l+h-l*h;const b=2*l-M,q=[0,0,0];for(let Y=0;Y<3;Y++)O=S+1/3*-(Y-1),O<0&&O++,O>1&&O--,u=6*O<1?b+6*(M-b)*O:2*O<1?M:3*O<2?b+(M-b)*(2/3-O)*6:b,q[Y]=255*u;return q},O.hsl.hsv=function(m){const S=m[0];let h=m[1]/100,l=m[2]/100,M=h;const O=Math.max(l,.01);l*=2,h*=l<=1?l:2-l,M*=O<=1?O:2-O;return[S,100*(0===l?2*M/(O+M):2*h/(l+h)),100*((l+h)/2)]},O.hsv.rgb=function(m){const S=m[0]/60,h=m[1]/100;let l=m[2]/100;const M=Math.floor(S)%6,O=S-Math.floor(S),u=255*l*(1-h),b=255*l*(1-h*O),q=255*l*(1-h*(1-O));switch(l*=255,M){case 0:return[l,q,u];case 1:return[b,l,u];case 2:return[u,l,q];case 3:return[u,b,l];case 4:return[q,u,l];case 5:return[l,u,b]}},O.hsv.hsl=function(m){const S=m[0],h=m[1]/100,l=m[2]/100,M=Math.max(l,.01);let O,u;u=(2-h)*l;const b=(2-h)*M;return O=h*M,O/=b<=1?b:2-b,O=O||0,u/=2,[S,100*O,100*u]},O.hwb.rgb=function(m){const S=m[0]/360;let h=m[1]/100,l=m[2]/100;const M=h+l;let O;M>1&&(h/=M,l/=M);const u=Math.floor(6*S),b=1-l;O=6*S-u,0!==(1&u)&&(O=1-O);const q=h+O*(b-h);let Y,V,I;switch(u){default:case 6:case 0:Y=b,V=q,I=h;break;case 1:Y=q,V=b,I=h;break;case 2:Y=h,V=b,I=q;break;case 3:Y=h,V=q,I=b;break;case 4:Y=q,V=h,I=b;break;case 5:Y=b,V=h,I=q}return[255*Y,255*V,255*I]},O.cmyk.rgb=function(m){const S=m[0]/100,h=m[1]/100,l=m[2]/100,M=m[3]/100;return[255*(1-Math.min(1,S*(1-M)+M)),255*(1-Math.min(1,h*(1-M)+M)),255*(1-Math.min(1,l*(1-M)+M))]},O.xyz.rgb=function(m){const S=m[0]/100,h=m[1]/100,l=m[2]/100;let M,O,u;return M=3.2406*S+-1.5372*h+-.4986*l,O=-.9689*S+1.8758*h+.0415*l,u=.0557*S+-.204*h+1.057*l,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,M=Math.min(Math.max(0,M),1),O=Math.min(Math.max(0,O),1),u=Math.min(Math.max(0,u),1),[255*M,255*O,255*u]},O.xyz.lab=function(m){let S=m[0],h=m[1],l=m[2];S/=95.047,h/=100,l/=108.883,S=S>.008856?S**(1/3):7.787*S+16/116,h=h>.008856?h**(1/3):7.787*h+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;return[116*h-16,500*(S-h),200*(h-l)]},O.lab.xyz=function(m){let S,h,l;h=(m[0]+16)/116,S=m[1]/500+h,l=h-m[2]/200;const M=h**3,O=S**3,u=l**3;return h=M>.008856?M:(h-16/116)/7.787,S=O>.008856?O:(S-16/116)/7.787,l=u>.008856?u:(l-16/116)/7.787,S*=95.047,h*=100,l*=108.883,[S,h,l]},O.lab.lch=function(m){const S=m[0],h=m[1],l=m[2];let M;M=360*Math.atan2(l,h)/2/Math.PI,M<0&&(M+=360);return[S,Math.sqrt(h*h+l*l),M]},O.lch.lab=function(m){const S=m[0],h=m[1],l=m[2]/360*2*Math.PI;return[S,h*Math.cos(l),h*Math.sin(l)]},O.rgb.ansi16=function(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[h,l,M]=m;let u=null===S?O.rgb.hsv(m)[2]:S;if(u=Math.round(u/50),0===u)return 30;let b=30+(Math.round(M/255)<<2|Math.round(l/255)<<1|Math.round(h/255));return 2===u&&(b+=60),b},O.hsv.ansi16=function(m){return O.rgb.ansi16(O.hsv.rgb(m),m[2])},O.rgb.ansi256=function(m){const S=m[0],h=m[1],l=m[2];if(S===h&&h===l)return S<8?16:S>248?231:Math.round((S-8)/247*24)+232;return 16+36*Math.round(S/255*5)+6*Math.round(h/255*5)+Math.round(l/255*5)},O.ansi16.rgb=function(m){let S=m%10;if(0===S||7===S)return m>50&&(S+=3.5),S=S/10.5*255,[S,S,S];const h=.5*(1+~~(m>50));return[(1&S)*h*255,(S>>1&1)*h*255,(S>>2&1)*h*255]},O.ansi256.rgb=function(m){if(m>=232){const S=10*(m-232)+8;return[S,S,S]}let S;m-=16;return[Math.floor(m/36)/5*255,Math.floor((S=m%36)/6)/5*255,S%6/5*255]},O.rgb.hex=function(m){const S=(((255&Math.round(m[0]))<<16)+((255&Math.round(m[1]))<<8)+(255&Math.round(m[2]))).toString(16).toUpperCase();return"000000".substring(S.length)+S},O.hex.rgb=function(m){const S=m.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!S)return[0,0,0];let h=S[0];3===S[0].length&&(h=h.split("").map((m=>m+m)).join(""));const l=parseInt(h,16);return[l>>16&255,l>>8&255,255&l]},O.rgb.hcg=function(m){const S=m[0]/255,h=m[1]/255,l=m[2]/255,M=Math.max(Math.max(S,h),l),O=Math.min(Math.min(S,h),l),u=M-O;let b,q;return b=u<1?O/(1-u):0,q=u<=0?0:M===S?(h-l)/u%6:M===h?2+(l-S)/u:4+(S-h)/u,q/=6,q%=1,[360*q,100*u,100*b]},O.hsl.hcg=function(m){const S=m[1]/100,h=m[2]/100,l=h<.5?2*S*h:2*S*(1-h);let M=0;return l<1&&(M=(h-.5*l)/(1-l)),[m[0],100*l,100*M]},O.hsv.hcg=function(m){const S=m[1]/100,h=m[2]/100,l=S*h;let M=0;return l<1&&(M=(h-l)/(1-l)),[m[0],100*l,100*M]},O.hcg.rgb=function(m){const S=m[0]/360,h=m[1]/100,l=m[2]/100;if(0===h)return[255*l,255*l,255*l];const M=[0,0,0],O=S%1*6,u=O%1,b=1-u;let q=0;switch(Math.floor(O)){case 0:M[0]=1,M[1]=u,M[2]=0;break;case 1:M[0]=b,M[1]=1,M[2]=0;break;case 2:M[0]=0,M[1]=1,M[2]=u;break;case 3:M[0]=0,M[1]=b,M[2]=1;break;case 4:M[0]=u,M[1]=0,M[2]=1;break;default:M[0]=1,M[1]=0,M[2]=b}return q=(1-h)*l,[255*(h*M[0]+q),255*(h*M[1]+q),255*(h*M[2]+q)]},O.hcg.hsv=function(m){const S=m[1]/100,h=S+m[2]/100*(1-S);let l=0;return h>0&&(l=S/h),[m[0],100*l,100*h]},O.hcg.hsl=function(m){const S=m[1]/100,h=m[2]/100*(1-S)+.5*S;let l=0;return h>0&&h<.5?l=S/(2*h):h>=.5&&h<1&&(l=S/(2*(1-h))),[m[0],100*l,100*h]},O.hcg.hwb=function(m){const S=m[1]/100,h=S+m[2]/100*(1-S);return[m[0],100*(h-S),100*(1-h)]},O.hwb.hcg=function(m){const S=m[1]/100,h=1-m[2]/100,l=h-S;let M=0;return l<1&&(M=(h-l)/(1-l)),[m[0],100*l,100*M]},O.apple.rgb=function(m){return[m[0]/65535*255,m[1]/65535*255,m[2]/65535*255]},O.rgb.apple=function(m){return[m[0]/255*65535,m[1]/255*65535,m[2]/255*65535]},O.gray.rgb=function(m){return[m[0]/100*255,m[0]/100*255,m[0]/100*255]},O.gray.hsl=function(m){return[0,0,m[0]]},O.gray.hsv=O.gray.hsl,O.gray.hwb=function(m){return[0,100,m[0]]},O.gray.cmyk=function(m){return[0,0,0,m[0]]},O.gray.lab=function(m){return[m[0],0,0]},O.gray.hex=function(m){const S=255&Math.round(m[0]/100*255),h=((S<<16)+(S<<8)+S).toString(16).toUpperCase();return"000000".substring(h.length)+h},O.rgb.gray=function(m){return[(m[0]+m[1]+m[2])/3/255*100]}},13503:(m,S,h)=>{const l=h(13511),M=h(13525),O={};Object.keys(l).forEach((m=>{O[m]={},Object.defineProperty(O[m],"channels",{value:l[m].channels}),Object.defineProperty(O[m],"labels",{value:l[m].labels});const S=M(m);Object.keys(S).forEach((h=>{const l=S[h];O[m][h]=function(m){const S=function(){for(var S=arguments.length,h=new Array(S),l=0;l<S;l++)h[l]=arguments[l];const M=h[0];if(void 0===M||null===M)return M;M.length>1&&(h=M);const O=m(h);if("object"===typeof O)for(let m=O.length,u=0;u<m;u++)O[u]=Math.round(O[u]);return O};return"conversion"in m&&(S.conversion=m.conversion),S}(l),O[m][h].raw=function(m){const S=function(){for(var S=arguments.length,h=new Array(S),l=0;l<S;l++)h[l]=arguments[l];const M=h[0];return void 0===M||null===M?M:(M.length>1&&(h=M),m(h))};return"conversion"in m&&(S.conversion=m.conversion),S}(l)}))})),m.exports=O},13525:(m,S,h)=>{const l=h(13511);function M(m){const S=function(){const m={},S=Object.keys(l);for(let h=S.length,l=0;l<h;l++)m[S[l]]={distance:-1,parent:null};return m}(),h=[m];for(S[m].distance=0;h.length;){const m=h.pop(),M=Object.keys(l[m]);for(let l=M.length,O=0;O<l;O++){const l=M[O],u=S[l];-1===u.distance&&(u.distance=S[m].distance+1,u.parent=m,h.unshift(l))}}return S}function O(m,S){return function(h){return S(m(h))}}function u(m,S){const h=[S[m].parent,m];let M=l[S[m].parent][m],u=S[m].parent;for(;S[u].parent;)h.unshift(S[u].parent),M=O(l[S[u].parent][u],M),u=S[u].parent;return M.conversion=h,M}m.exports=function(m){const S=M(m),h={},l=Object.keys(S);for(let M=l.length,O=0;O<M;O++){const m=l[O];null!==S[m].parent&&(h[m]=u(m,S))}return h}},13520:m=>{"use strict";m.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12036:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.discordURLBuilder=void 0,S.discordURLBuilder=function(m){var S;const h=(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)||"localhost",l=m.hostname.split("."),M=!m.hostname.includes("trycloudflare.com")&&!m.hostname.includes("discordsays.com")&&l.length>2?`/${l[0]}`:"";return m.pathname.startsWith("/.proxy")?`${m.protocol}//${h}${M}${m.pathname}${m.search}`:`${m.protocol}//${h}/.proxy/colyseus${M}${m.pathname}${m.search}`}},12022:function(m,S,h){"use strict";var l,M,O,u,b=this&&this.__awaiter||function(m,S,h,l){return new(h||(h=Promise))((function(M,O){function u(m){try{q(l.next(m))}catch(S){O(S)}}function b(m){try{q(l.throw(m))}catch(S){O(S)}}function q(m){var S;m.done?M(m.value):(S=m.value,S instanceof h?S:new h((function(m){m(S)}))).then(u,b)}q((l=l.apply(m,S||[])).next())}))},q=this&&this.__classPrivateFieldGet||function(m,S,h,l){if("a"===h&&!l)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof S?m!==S||!l:!S.has(m))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===h?l:"a"===h?l.call(m):l?l.value:S.get(m)},Y=this&&this.__classPrivateFieldSet||function(m,S,h,l,M){if("m"===l)throw new TypeError("Private method is not writable");if("a"===l&&!M)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof S?m!==S||!M:!S.has(m))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===l?M.call(m,h):M?M.value=h:S.set(m,h),h};Object.defineProperty(S,"__esModule",{value:!0}),S.Auth=void 0;const V=h(12027),I=h(11997);S.Auth=class{constructor(m){this.http=m,this.settings={path:"/auth",key:"colyseus-auth-token"},l.set(this,!1),M.set(this,void 0),O.set(this,void 0),u.set(this,(0,I.createNanoEvents)()),(0,V.getItem)(this.settings.key,(m=>this.token=m))}set token(m){this.http.authToken=m}get token(){return this.http.authToken}onChange(m){const S=q(this,u,"f").on("change",m);return q(this,l,"f")||Y(this,M,new Promise(((m,S)=>{this.getUserData().then((m=>{this.emitChange(Object.assign(Object.assign({},m),{token:this.token}))})).catch((m=>{this.emitChange({user:null,token:void 0})})).finally((()=>{m()}))})),"f"),Y(this,l,!0,"f"),S}getUserData(){return b(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(m,S,h){return b(this,void 0,void 0,(function*(){const l=(yield this.http.post(`${this.settings.path}/register`,{body:{email:m,password:S,options:h}})).data;return this.emitChange(l),l}))}signInWithEmailAndPassword(m,S){return b(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/login`,{body:{email:m,password:S}})).data;return this.emitChange(h),h}))}signInAnonymously(m){return b(this,void 0,void 0,(function*(){const S=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:m}})).data;return this.emitChange(S),S}))}sendPasswordResetEmail(m){return b(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:m}})).data}))}signInWithProvider(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,void 0,void 0,(function*(){return new Promise(((h,l)=>{const M=S.width||480,u=S.height||768,b=this.token?`?token=${this.token}`:"",V=`Login with ${m[0].toUpperCase()+m.substring(1)}`,I=this.http.client.getHttpEndpoint(`${S.prefix||`${this.settings.path}/provider`}/${m}${b}`),Z=screen.width/2-M/2,C=screen.height/2-u/2;Y(this,O,window.open(I,V,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+M+", height="+u+", top="+C+", left="+Z),"f");const B=m=>{void 0===m.data.user&&void 0===m.data.token||(clearInterval(D),q(this,O,"f").close(),Y(this,O,void 0,"f"),window.removeEventListener("message",B),void 0!==m.data.error?l(m.data.error):(h(m.data),this.emitChange(m.data)))},D=setInterval((()=>{q(this,O,"f")&&!q(this,O,"f").closed||(Y(this,O,void 0,"f"),l("yO"),window.removeEventListener("message",B))}),200);window.addEventListener("message",B)}))}))}signOut(){return b(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(m){void 0!==m.token&&(this.token=m.token,null===m.token?(0,V.removeItem)(this.settings.key):(0,V.setItem)(this.settings.key,m.token)),q(this,u,"f").emit("change",m)}},l=new WeakMap,M=new WeakMap,O=new WeakMap,u=new WeakMap},11940:function(m,S,h){"use strict";var l,M=this&&this.__awaiter||function(m,S,h,l){return new(h||(h=Promise))((function(M,O){function u(m){try{q(l.next(m))}catch(S){O(S)}}function b(m){try{q(l.throw(m))}catch(S){O(S)}}function q(m){var S;m.done?M(m.value):(S=m.value,S instanceof h?S:new h((function(m){m(S)}))).then(u,b)}q((l=l.apply(m,S||[])).next())}))};Object.defineProperty(S,"__esModule",{value:!0}),S.Client=S.MatchMakeError=void 0;const O=h(11948),u=h(11957),b=h(12011),q=h(12022),Y=h(12036);class V extends Error{constructor(m,S){super(m),this.code=S,Object.setPrototypeOf(this,V.prototype)}}S.MatchMakeError=V;const I="undefined"!==typeof window&&"undefined"!==typeof(null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";S.Client=class{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,S=arguments.length>1?arguments[1]:void 0;var h,l;if("string"===typeof m){const S=m.startsWith("/")?new URL(m,I):new URL(m),h="https:"===S.protocol||"wss:"===S.protocol,l=Number(S.port||(h?443:80));this.settings={hostname:S.hostname,pathname:S.pathname,port:l,secure:h}}else void 0===m.port&&(m.port=m.secure?443:80),void 0===m.pathname&&(m.pathname=""),this.settings=m;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new b.HTTP(this,(null===S||void 0===S?void 0:S.headers)||{}),this.auth=new q.Auth(this.http),this.urlBuilder=null===S||void 0===S?void 0:S.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(l=null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||void 0===l?void 0:l.includes("discordsays.com"))&&(this.urlBuilder=Y.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return M(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",m,S,h)}))}create(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return M(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",m,S,h)}))}join(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return M(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",m,S,h)}))}joinById(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return M(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",m,S,h)}))}reconnect(m,S){return M(this,void 0,void 0,(function*(){if("string"===typeof m&&"string"===typeof S)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[h,l]=m.split(":");if(!h||!l)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",h,{reconnectionToken:l},S)}))}getAvailableRooms(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return M(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${m}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(m,S,h){return M(this,void 0,void 0,(function*(){const l=this.createRoom(m.room.name,S);l.roomId=m.room.roomId,l.sessionId=m.sessionId;const u={sessionId:l.sessionId};m.reconnectionToken&&(u.reconnectionToken=m.reconnectionToken);const b=h||l;return l.connect(this.buildEndpoint(m.room,u),m.devMode&&(()=>M(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${l.roomId}'...`);let h=0;const O=()=>M(this,void 0,void 0,(function*(){h++;try{yield this.consumeSeatReservation(m,S,b),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${l.roomId}'`)}catch(M){h<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${h} out of 8)`),setTimeout(O,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(O,2e3)}))),b,this.http.headers),new Promise(((m,S)=>{const h=(m,h)=>S(new O.ServerError(m,h));b.onError.once(h),b.onJoin.once((()=>{b.onError.remove(h),setTimeout((()=>{try{b.lY(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),m(b)}))}))}))}createMatchMakeRequest(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0;return M(this,void 0,void 0,(function*(){const M=(yield this.http.post(`matchmake/${m}/${S}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(h)})).data;if(M.error)throw new V(M.error,M.code);return"reconnect"===m&&(M.reconnectionToken=h.reconnectionToken),yield this.consumeSeatReservation(M,l,O)}))}createRoom(m,S){return new u.Room(m,S)}buildEndpoint(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=[];for(const O in S)S.hasOwnProperty(O)&&h.push(`${O}=${S[O]}`);let l=this.settings.secure?"wss://":"ws://";m.publicAddress?l+=`${m.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const M=`${l}/${m.processId}/${m.roomId}?${h.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(M)):M}getHttpEndpoint(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const S=m.startsWith("/")?m:`/${m}`,h=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${S}`;return this.urlBuilder?this.urlBuilder(new URL(h)):h}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11969:(m,S,h)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Connection=void 0;const l=h(11977);S.Connection=class{constructor(){this.events={},this.transport=new l.WebSocketTransport(this.events)}send(m){this.transport.send(m)}connect(m,S){this.transport.connect(m,S)}close(m,S){this.transport.close(m,S)}get isOpen(){return this.transport.isOpen}}},12011:function(m,S,h){"use strict";var l=this&&this.__createBinding||(Object.create?function(m,S,h,l){void 0===l&&(l=h);var M=Object.getOwnPropertyDescriptor(S,h);M&&!("get"in M?!S.__esModule:M.writable||M.configurable)||(M={enumerable:!0,get:function(){return S[h]}}),Object.defineProperty(m,l,M)}:function(m,S,h,l){void 0===l&&(l=h),m[l]=S[h]}),M=this&&this.__setModuleDefault||(Object.create?function(m,S){Object.defineProperty(m,"default",{enumerable:!0,value:S})}:function(m,S){m.default=S}),O=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var h in m)"default"!==h&&Object.prototype.hasOwnProperty.call(m,h)&&l(S,m,h);return M(S,m),S};Object.defineProperty(S,"__esModule",{value:!0}),S.HTTP=void 0;const u=h(11948),b=O(h(12016));S.HTTP=class{constructor(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=m,this.headers=S}get(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",m,S)}post(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",m,S)}del(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",m,S)}put(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",m,S)}request(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return b[m](this.client.getHttpEndpoint(S),this.getOptions(h)).catch((m=>{var S;const h=m.statusCode,l=(null===(S=m.data)||void 0===S?void 0:S.error)||m.statusMessage||m.message;if(!h&&!l)throw m;throw new u.ServerError(h,l)}))}getOptions(m){return m.headers=Object.assign({},this.headers,m.headers),this.authToken&&(m.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(m.withCredentials=!0),m}}},11985:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.utf8Length=S.utf8Read=S.ErrorCode=S.Protocol=void 0,function(m){m[m.HANDSHAKE=9]="HANDSHAKE",m[m.JOIN_ROOM=10]="JOIN_ROOM",m[m.ERROR=11]="ERROR",m[m.LEAVE_ROOM=12]="LEAVE_ROOM",m[m.ROOM_DATA=13]="ROOM_DATA",m[m.ROOM_STATE=14]="ROOM_STATE",m[m.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",m[m.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",m[m.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(S.Protocol||(S.Protocol={})),function(m){m[m.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",m[m.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",m[m.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",m[m.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",m[m.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",m[m.AUTH_FAILED=4215]="AUTH_FAILED",m[m.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(S.ErrorCode||(S.ErrorCode={})),S.utf8Read=function(m,S){const h=m[S++];for(var l="",M=0,O=S,u=S+h;O<u;O++){var b=m[O];if(0!==(128&b))if(192!==(224&b))if(224!==(240&b)){if(240!==(248&b))throw new Error("Invalid byte "+b.toString(16));(M=(7&b)<<18|(63&m[++O])<<12|(63&m[++O])<<6|63&m[++O])>=65536?(M-=65536,l+=String.fromCharCode(55296+(M>>>10),56320+(1023&M))):l+=String.fromCharCode(M)}else l+=String.fromCharCode((15&b)<<12|(63&m[++O])<<6|63&m[++O]);else l+=String.fromCharCode((31&b)<<6|63&m[++O]);else l+=String.fromCharCode(b)}return l},S.utf8Length=function(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",S=0,h=0;for(let l=0,M=m.length;l<M;l++)S=m.charCodeAt(l),S<128?h+=1:S<2048?h+=2:S<55296||S>=57344?h+=3:(l++,h+=4);return h+1}},11957:function(m,S,h){"use strict";var l=this&&this.__createBinding||(Object.create?function(m,S,h,l){void 0===l&&(l=h);var M=Object.getOwnPropertyDescriptor(S,h);M&&!("get"in M?!S.__esModule:M.writable||M.configurable)||(M={enumerable:!0,get:function(){return S[h]}}),Object.defineProperty(m,l,M)}:function(m,S,h,l){void 0===l&&(l=h),m[l]=S[h]}),M=this&&this.__setModuleDefault||(Object.create?function(m,S){Object.defineProperty(m,"default",{enumerable:!0,value:S})}:function(m,S){m.default=S}),O=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var h in m)"default"!==h&&Object.prototype.hasOwnProperty.call(m,h)&&l(S,m,h);return M(S,m),S};Object.defineProperty(S,"__esModule",{value:!0}),S.Room=void 0;const u=O(h(11964)),b=h(11969),q=h(11985),Y=h(11991),V=h(11997),I=h(12002),Z=h(12009),C=h(11948);class B{constructor(m,S){this.onStateChange=(0,I.createSignal)(),this.onError=(0,I.createSignal)(),this.onLeave=(0,I.createSignal)(),this.onJoin=(0,I.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,V.createNanoEvents)(),this.roomId=null,this.name=m,S&&(this.serializer=new((0,Y.getSerializer)("schema")),this.rootSchema=S,this.serializer.state=new S),this.onError(((m,S)=>{var h;return null===(h=console.warn)||void 0===h?void 0:h.call(console,`colyseus.js - onError => (${m}) ${S}`)})),this.onLeave((()=>this.bS()))}get id(){return this.roomId}connect(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,l=arguments.length>3?arguments[3]:void 0;const M=new b.Connection;h.connection=M,M.events.onmessage=B.prototype.onMessageCallback.bind(h),M.events.onclose=function(m){var l;if(!h.hasJoined)return null===(l=console.warn)||void 0===l||l.call(console,`Room connection was closed unexpectedly (${m.code}): ${m.reason}`),void h.onError.invoke(m.code,m.reason);m.code===C.CloseCode.DEVMODE_RESTART&&S?S():(h.onLeave.invoke(m.code,m.reason),h.destroy())},M.events.onerror=function(m){var S;null===(S=console.warn)||void 0===S||S.call(console,`Room, onError (${m.code}): ${m.reason}`),h.onError.invoke(m.code,m.reason)},M.connect(m,l)}ab(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((S=>{this.onLeave((m=>S(m))),this.connection?m?this.connection.send([q.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(C.CloseCode.CONSENTED)}))}JS(m,S){return this.onMessageHandlers.on(this.getMessageHandlerKey(m),S)}send(m,S){const h=[q.Protocol.ROOM_DATA];let l;if("string"===typeof m?Z.encode.string(h,m):Z.encode.number(h,m),void 0!==S){const m=u.encode(S);l=new Uint8Array(h.length+m.byteLength),l.set(new Uint8Array(h),0),l.set(new Uint8Array(m),h.length)}else l=new Uint8Array(h);this.connection.send(l.buffer)}lY(m,S){const h=[q.Protocol.ROOM_DATA_BYTES];let l;"string"===typeof m?Z.encode.string(h,m):Z.encode.number(h,m),l=new Uint8Array(h.length+(S.byteLength||S.length)),l.set(new Uint8Array(h),0),l.set(new Uint8Array(S),h.length),this.connection.send(l.buffer)}get state(){return this.serializer.getState()}bS(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(m){const S=Array.from(new Uint8Array(m.data)),h=S[0];if(h===q.Protocol.JOIN_ROOM){let m=1;const h=(0,q.utf8Read)(S,m);if(m+=(0,q.utf8Length)(h),this.serializerId=(0,q.utf8Read)(S,m),m+=(0,q.utf8Length)(this.serializerId),!this.serializer){const m=(0,Y.getSerializer)(this.serializerId);this.serializer=new m}S.length>m&&this.serializer.handshake&&this.serializer.handshake(S,{offset:m}),this.reconnectionToken=`${this.roomId}:${h}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([q.Protocol.JOIN_ROOM])}else if(h===q.Protocol.ERROR){const m={offset:1},h=Z.decode.number(S,m),l=Z.decode.string(S,m);this.onError.invoke(h,l)}else if(h===q.Protocol.LEAVE_ROOM)this.ab();else if(h===q.Protocol.ROOM_DATA_SCHEMA){const m={offset:1},h=this.serializer.getState().constructor._context.get(Z.decode.number(S,m)),l=new h;l.decode(S,m),this.dispatchMessage(h,l)}else if(h===q.Protocol.ROOM_STATE)S.shift(),this.setState(S);else if(h===q.Protocol.ROOM_STATE_PATCH)S.shift(),this.patch(S);else if(h===q.Protocol.ROOM_DATA){const h={offset:1},l=Z.decode.stringCheck(S,h)?Z.decode.string(S,h):Z.decode.number(S,h),M=S.length>h.offset?u.decode(m.data,h.offset):void 0;this.dispatchMessage(l,M)}else if(h===q.Protocol.ROOM_DATA_BYTES){const m={offset:1},h=Z.decode.stringCheck(S,m)?Z.decode.string(S,m):Z.decode.number(S,m);this.dispatchMessage(h,new Uint8Array(S.slice(m.offset)))}}setState(m){this.serializer.setState(m),this.onStateChange.invoke(this.serializer.getState())}patch(m){this.serializer.patch(m),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(m,S){var h;const l=this.getMessageHandlerKey(m);this.onMessageHandlers.events[l]?this.onMessageHandlers.emit(l,S):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",m,S):null===(h=console.warn)||void 0===h||h.call(console,`colyseus.js: onMessage() not registered for type '${m}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(m){switch(typeof m){case"function":return`$${m._typeid}`;case"string":return m;case"number":return`i${m}`;default:throw new Error("invalid message type.")}}}S.Room=B},12027:(m,S)=>{"use strict";let h;function l(){if(!h)try{h="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(m){}return h||(h={cache:{},setItem:function(m,S){this.cache[m]=S},getItem:function(m){this.cache[m]},removeItem:function(m){delete this.cache[m]}}),h}Object.defineProperty(S,"__esModule",{value:!0}),S.getItem=S.removeItem=S.setItem=void 0,S.setItem=function(m,S){l().setItem(m,S)},S.removeItem=function(m){l().removeItem(m)},S.getItem=function(m,S){const h=l().getItem(m);"undefined"!==typeof Promise&&h instanceof Promise?h.then((m=>S(m))):S(h)}},11997:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.createNanoEvents=void 0;S.createNanoEvents=()=>({emit(m){let S=this.events[m]||[];for(var h=arguments.length,l=new Array(h>1?h-1:0),M=1;M<h;M++)l[M-1]=arguments[M];for(let O=0,u=S.length;O<u;O++)S[O](...l)},events:{},on(m,S){var h;return(null===(h=this.events[m])||void 0===h?void 0:h.push(S))||(this.events[m]=[S]),()=>{var h;this.events[m]=null===(h=this.events[m])||void 0===h?void 0:h.filter((m=>S!==m))}}})},12002:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.createSignal=S.EventEmitter=void 0;class h{constructor(){this.handlers=[]}register(m){return this.handlers.push(m),this}invoke(){for(var m=arguments.length,S=new Array(m),h=0;h<m;h++)S[h]=arguments[h];this.handlers.forEach((m=>m.apply(this,S)))}invokeAsync(){for(var m=arguments.length,S=new Array(m),h=0;h<m;h++)S[h]=arguments[h];return Promise.all(this.handlers.map((m=>m.apply(this,S))))}remove(m){const S=this.handlers.indexOf(m);this.handlers[S]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}S.EventEmitter=h,S.createSignal=function(){const m=new h;function S(S){return m.register(S,null===this)}return S.once=S=>{const h=function(){for(var l=arguments.length,M=new Array(l),O=0;O<l;O++)M[O]=arguments[O];S.apply(this,M),m.remove(h)};m.register(h)},S.remove=S=>m.remove(S),S.invoke=function(){return m.invoke(...arguments)},S.invokeAsync=function(){return m.invokeAsync(...arguments)},S.clear=()=>m.clear(),S}},11948:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ServerError=S.CloseCode=void 0,function(m){m[m.CONSENTED=4e3]="CONSENTED",m[m.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(S.CloseCode||(S.CloseCode={}));class h extends Error{constructor(m,S){super(S),this.name="ServerError",this.code=m}}S.ServerError=h},11932:(m,S,h)=>{"use strict";S.b=void 0,h(11935);var l=h(11940);Object.defineProperty(S,"b",{enumerable:!0,get:function(){return l.Client}});var M=h(11985);var O=h(11957);var u=h(12022);const b=h(12045);const q=h(12054),Y=h(11991);(0,Y.registerSerializer)("schema",b.SchemaSerializer),(0,Y.registerSerializer)("none",q.NoneSerializer)},11935:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=m=>null!==m&&"object"===typeof m&&m.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11964:(m,S)=>{"use strict";function h(m,S){if(this._offset=S,m instanceof ArrayBuffer)this._buffer=m,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(m))throw new Error("Invalid argument");this._buffer=m.buffer,this._view=new DataView(this._buffer,m.byteOffset,m.byteLength)}}Object.defineProperty(S,"__esModule",{value:!0}),S.decode=S.encode=void 0,h.prototype._array=function(m){for(var S=new Array(m),h=0;h<m;h++)S[h]=this._parse();return S},h.prototype._map=function(m){for(var S={},h=0;h<m;h++)S[this._parse()]=this._parse();return S},h.prototype._str=function(m){var S=function(m,S,h){for(var l="",M=0,O=S,u=S+h;O<u;O++){var b=m.getUint8(O);if(0!==(128&b))if(192!==(224&b))if(224!==(240&b)){if(240!==(248&b))throw new Error("Invalid byte "+b.toString(16));(M=(7&b)<<18|(63&m.getUint8(++O))<<12|(63&m.getUint8(++O))<<6|63&m.getUint8(++O))>=65536?(M-=65536,l+=String.fromCharCode(55296+(M>>>10),56320+(1023&M))):l+=String.fromCharCode(M)}else l+=String.fromCharCode((15&b)<<12|(63&m.getUint8(++O))<<6|63&m.getUint8(++O));else l+=String.fromCharCode((31&b)<<6|63&m.getUint8(++O));else l+=String.fromCharCode(b)}return l}(this._view,this._offset,m);return this._offset+=m,S},h.prototype._bin=function(m){var S=this._buffer.slice(this._offset,this._offset+m);return this._offset+=m,S},h.prototype._parse=function(){var m,S=this._view.getUint8(this._offset++),h=0,l=0,M=0,O=0;if(S<192)return S<128?S:S<144?this._map(15&S):S<160?this._array(15&S):this._str(31&S);if(S>223)return-1*(255-S+1);switch(S){case 192:return null;case 194:return!1;case 195:return!0;case 196:return h=this._view.getUint8(this._offset),this._offset+=1,this._bin(h);case 197:return h=this._view.getUint16(this._offset),this._offset+=2,this._bin(h);case 198:return h=this._view.getUint32(this._offset),this._offset+=4,this._bin(h);case 199:if(h=this._view.getUint8(this._offset),l=this._view.getInt8(this._offset+1),this._offset+=2,-1===l){var u=this._view.getUint32(this._offset);return M=this._view.getInt32(this._offset+4),O=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*M+O)+u/1e6)}return[l,this._bin(h)];case 200:return h=this._view.getUint16(this._offset),l=this._view.getInt8(this._offset+2),this._offset+=3,[l,this._bin(h)];case 201:return h=this._view.getUint32(this._offset),l=this._view.getInt8(this._offset+4),this._offset+=5,[l,this._bin(h)];case 202:return m=this._view.getFloat32(this._offset),this._offset+=4,m;case 203:return m=this._view.getFloat64(this._offset),this._offset+=8,m;case 204:return m=this._view.getUint8(this._offset),this._offset+=1,m;case 205:return m=this._view.getUint16(this._offset),this._offset+=2,m;case 206:return m=this._view.getUint32(this._offset),this._offset+=4,m;case 207:return M=this._view.getUint32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,M+O;case 208:return m=this._view.getInt8(this._offset),this._offset+=1,m;case 209:return m=this._view.getInt16(this._offset),this._offset+=2,m;case 210:return m=this._view.getInt32(this._offset),this._offset+=4,m;case 211:return M=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,M+O;case 212:return l=this._view.getInt8(this._offset),this._offset+=1,0===l?void(this._offset+=1):[l,this._bin(1)];case 213:return l=this._view.getInt8(this._offset),this._offset+=1,[l,this._bin(2)];case 214:return l=this._view.getInt8(this._offset),this._offset+=1,-1===l?(m=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*m)):[l,this._bin(4)];case 215:return l=this._view.getInt8(this._offset),this._offset+=1,0===l?(M=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(M+O)):-1===l?(M=this._view.getUint32(this._offset),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&M)+O)+(M>>>2)/1e6)):[l,this._bin(8)];case 216:return l=this._view.getInt8(this._offset),this._offset+=1,[l,this._bin(16)];case 217:return h=this._view.getUint8(this._offset),this._offset+=1,this._str(h);case 218:return h=this._view.getUint16(this._offset),this._offset+=2,this._str(h);case 219:return h=this._view.getUint32(this._offset),this._offset+=4,this._str(h);case 220:return h=this._view.getUint16(this._offset),this._offset+=2,this._array(h);case 221:return h=this._view.getUint32(this._offset),this._offset+=4,this._array(h);case 222:return h=this._view.getUint16(this._offset),this._offset+=2,this._map(h);case 223:return h=this._view.getUint32(this._offset),this._offset+=4,this._map(h)}throw new Error("Could not parse")},S.decode=function(m){var S=new h(m,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),l=S._parse();if(S._offset!==m.byteLength)throw new Error(m.byteLength-S._offset+" trailing bytes");return l};function l(m,S,h){for(var l=0,M=0,O=h.length;M<O;M++)(l=h.charCodeAt(M))<128?m.setUint8(S++,l):l<2048?(m.setUint8(S++,192|l>>6),m.setUint8(S++,128|63&l)):l<55296||l>=57344?(m.setUint8(S++,224|l>>12),m.setUint8(S++,128|l>>6&63),m.setUint8(S++,128|63&l)):(M++,l=65536+((1023&l)<<10|1023&h.charCodeAt(M)),m.setUint8(S++,240|l>>18),m.setUint8(S++,128|l>>12&63),m.setUint8(S++,128|l>>6&63),m.setUint8(S++,128|63&l))}function M(m,S,h){var l=typeof h,O=0,u=0,b=0,q=0,Y=0,V=0;if("string"===l){if(Y=function(m){for(var S=0,h=0,l=0,M=m.length;l<M;l++)(S=m.charCodeAt(l))<128?h+=1:S<2048?h+=2:S<55296||S>=57344?h+=3:(l++,h+=4);return h}(h),Y<32)m.push(160|Y),V=1;else if(Y<256)m.push(217,Y),V=2;else if(Y<65536)m.push(218,Y>>8,Y),V=3;else{if(!(Y<4294967296))throw new Error("String too long");m.push(219,Y>>24,Y>>16,Y>>8,Y),V=5}return S.push({_str:h,_length:Y,_offset:m.length}),V+Y}if("number"===l)return Math.floor(h)===h&&isFinite(h)?h>=0?h<128?(m.push(h),1):h<256?(m.push(204,h),2):h<65536?(m.push(205,h>>8,h),3):h<4294967296?(m.push(206,h>>24,h>>16,h>>8,h),5):(b=h/Math.pow(2,32)|0,q=h>>>0,m.push(207,b>>24,b>>16,b>>8,b,q>>24,q>>16,q>>8,q),9):h>=-32?(m.push(h),1):h>=-128?(m.push(208,h),2):h>=-32768?(m.push(209,h>>8,h),3):h>=-2147483648?(m.push(210,h>>24,h>>16,h>>8,h),5):(b=Math.floor(h/Math.pow(2,32)),q=h>>>0,m.push(211,b>>24,b>>16,b>>8,b,q>>24,q>>16,q>>8,q),9):(m.push(203),S.push({_float:h,_length:8,_offset:m.length}),9);if("object"===l){if(null===h)return m.push(192),1;if(Array.isArray(h)){if((Y=h.length)<16)m.push(144|Y),V=1;else if(Y<65536)m.push(220,Y>>8,Y),V=3;else{if(!(Y<4294967296))throw new Error("Array too large");m.push(221,Y>>24,Y>>16,Y>>8,Y),V=5}for(O=0;O<Y;O++)V+=M(m,S,h[O]);return V}if(h instanceof Date){var I=h.getTime(),Z=Math.floor(I/1e3),C=1e6*(I-1e3*Z);return Z>=0&&C>=0&&Z<=17179869183?0===C&&Z<=4294967295?(m.push(214,255,Z>>24,Z>>16,Z>>8,Z),6):(b=Z/4294967296,q=4294967295&Z,m.push(215,255,C>>22,C>>14,C>>6,b,q>>24,q>>16,q>>8,q),10):(b=Math.floor(Z/4294967296),q=Z>>>0,m.push(199,12,255,C>>24,C>>16,C>>8,C,b>>24,b>>16,b>>8,b,q>>24,q>>16,q>>8,q),15)}if(h instanceof ArrayBuffer){if((Y=h.byteLength)<256)m.push(196,Y),V=2;else if(Y<65536)m.push(197,Y>>8,Y),V=3;else{if(!(Y<4294967296))throw new Error("Buffer too large");m.push(198,Y>>24,Y>>16,Y>>8,Y),V=5}return S.push({_bin:h,_length:Y,_offset:m.length}),V+Y}if("function"===typeof h.toJSON)return M(m,S,h.toJSON());var B=[],D="",E=Object.keys(h);for(O=0,u=E.length;O<u;O++)void 0!==h[D=E[O]]&&"function"!==typeof h[D]&&B.push(D);if((Y=B.length)<16)m.push(128|Y),V=1;else if(Y<65536)m.push(222,Y>>8,Y),V=3;else{if(!(Y<4294967296))throw new Error("Object too large");m.push(223,Y>>24,Y>>16,Y>>8,Y),V=5}for(O=0;O<Y;O++)V+=M(m,S,D=B[O]),V+=M(m,S,h[D]);return V}if("boolean"===l)return m.push(h?195:194),1;if("undefined"===l)return m.push(192),1;if("function"===typeof h.toJSON)return M(m,S,h.toJSON());throw new Error("Could not encode")}S.encode=function(m){var S=[],h=[],O=M(S,h,m),u=new ArrayBuffer(O),b=new DataView(u),q=0,Y=0,V=-1;h.length>0&&(V=h[0]._offset);for(var I,Z=0,C=0,B=0,D=S.length;B<D;B++)if(b.setUint8(Y+B,S[B]),B+1===V){if(Z=(I=h[q])._length,C=Y+V,I._bin)for(var E=new Uint8Array(I._bin),n=0;n<Z;n++)b.setUint8(C+n,E[n]);else I._str?l(b,C,I._str):void 0!==I._float&&b.setFloat64(C,I._float);Y+=Z,h[++q]&&(V=h[q]._offset)}return u}},12054:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.NoneSerializer=void 0;S.NoneSerializer=class{setState(m){}getState(){return null}patch(m){}teardown(){}handshake(m){}}},12045:(m,S,h)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.SchemaSerializer=void 0;const l=h(12009);S.SchemaSerializer=class{setState(m){return this.state.decode(m)}getState(){return this.state}patch(m){return this.state.decode(m)}teardown(){var m,S;null===(S=null===(m=this.state)||void 0===m?void 0:m.$changes)||void 0===S||S.root.clearRefs()}handshake(m,S){if(this.state){(new l.Reflection).decode(m,S)}else this.state=l.Reflection.decode(m,S)}}},11991:(m,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getSerializer=S.registerSerializer=void 0;const h={};S.registerSerializer=function(m,S){h[m]=S},S.getSerializer=function(m){const S=h[m];if(!S)throw new Error("missing serializer: "+m);return S}},11977:function(m,S,h){"use strict";var l=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(S,"__esModule",{value:!0}),S.WebSocketTransport=void 0;const M=l(h(11979)),O=globalThis.WebSocket||M.default;S.WebSocketTransport=class{constructor(m){this.events=m}send(m){m instanceof ArrayBuffer?this.ws.send(m):Array.isArray(m)&&this.ws.send(new Uint8Array(m).buffer)}connect(m,S){try{this.ws=new O(m,{headers:S,protocols:this.protocols})}catch(h){this.ws=new O(m,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(m,S){this.ws.close(m,S)}get isOpen(){return this.ws.readyState===O.OPEN}}},11979:m=>{"use strict";m.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12441:m=>{"use strict";m.exports=function(m){for(var S=new Array(m),h=0;h<m;++h)S[h]=h;return S}},12449:m=>{function S(m){return!!m.constructor&&"function"===typeof m.constructor.isBuffer&&m.constructor.isBuffer(m)}m.exports=function(m){return null!=m&&(S(m)||function(m){return"function"===typeof m.readFloatLE&&"function"===typeof m.slice&&S(m.slice(0,0))}(m)||!!m._isBuffer)}},12438:(m,S,h)=>{var l=h(12441),M=h(12449),O="undefined"!==typeof Float64Array;function u(m,S){return m[0]-S[0]}function b(){var m,S=this.stride,h=new Array(S.length);for(m=0;m<h.length;++m)h[m]=[Math.abs(S[m]),m];h.sort(u);var l=new Array(h.length);for(m=0;m<l.length;++m)l[m]=h[m][1];return l}function q(m,S){var h=["View",S,"d",m].join("");S<0&&(h="View_Nil"+m);var M="generic"===m;if(-1===S){var O="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+m+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(O)()}if(0===S){O="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+m+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(M?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(M?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",O)(Y[m][0])}O=["'use strict'"];var u=l(S),q=u.map((function(m){return"i"+m})),V="this.offset+"+u.map((function(m){return"this.stride["+m+"]*i"+m})).join("+"),I=u.map((function(m){return"b"+m})).join(","),Z=u.map((function(m){return"c"+m})).join(",");O.push("function "+h+"(a,"+I+","+Z+",d){this.data=a","this.shape=["+I+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+m+"'","proto.dimension="+S),O.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+u.map((function(m){return"this.shape["+m+"]"})).join("*"),"}})"),1===S?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),S<4?(O.push("function "+h+"_order(){"),2===S?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===S&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+h+"_set("+q.join(",")+",v){"),M?O.push("return this.data.set("+V+",v)}"):O.push("return this.data["+V+"]=v}"),O.push("proto.get=function "+h+"_get("+q.join(",")+"){"),M?O.push("return this.data.get("+V+")}"):O.push("return this.data["+V+"]}"),O.push("proto.index=function "+h+"_index(",q.join(),"){return "+V+"}"),O.push("proto.hi=function "+h+"_hi("+q.join(",")+"){return new "+h+"(this.data,"+u.map((function(m){return["(typeof i",m,"!=='number'||i",m,"<0)?this.shape[",m,"]:i",m,"|0"].join("")})).join(",")+","+u.map((function(m){return"this.stride["+m+"]"})).join(",")+",this.offset)}");var C=u.map((function(m){return"a"+m+"=this.shape["+m+"]"})),B=u.map((function(m){return"c"+m+"=this.stride["+m+"]"}));O.push("proto.lo=function "+h+"_lo("+q.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+B.join(","));for(var D=0;D<S;++D)O.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");O.push("return new "+h+"(this.data,"+u.map((function(m){return"a"+m})).join(",")+","+u.map((function(m){return"c"+m})).join(",")+",b)}"),O.push("proto.step=function "+h+"_step("+q.join(",")+"){var "+u.map((function(m){return"a"+m+"=this.shape["+m+"]"})).join(",")+","+u.map((function(m){return"b"+m+"=this.stride["+m+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<S;++D)O.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");O.push("return new "+h+"(this.data,"+u.map((function(m){return"a"+m})).join(",")+","+u.map((function(m){return"b"+m})).join(",")+",c)}");var E=new Array(S),n=new Array(S);for(D=0;D<S;++D)E[D]="a[i"+D+"]",n[D]="b[i"+D+"]";O.push("proto.transpose=function "+h+"_transpose("+q+"){"+q.map((function(m,S){return m+"=("+m+"===undefined?"+S+":"+m+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+E.join(",")+","+n.join(",")+",this.offset)}"),O.push("proto.pick=function "+h+"_pick("+q+"){var a=[],b=[],c=this.offset");for(D=0;D<S;++D)O.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+u.map((function(m){return"shape["+m+"]"})).join(",")+","+u.map((function(m){return"stride["+m+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(Y[m],b)}var Y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};m.exports=function(m,S,h,l){if(void 0===m)return(0,Y.array[0])([]);"number"===typeof m&&(m=[m]),void 0===S&&(S=[m.length]);var u=S.length;if(void 0===h){h=new Array(u);for(var b=u-1,V=1;b>=0;--b)h[b]=V,V*=S[b]}if(void 0===l){l=0;for(b=0;b<u;++b)h[b]<0&&(l-=(S[b]-1)*h[b])}for(var I=function(m){if(M(m))return"buffer";if(O)switch(Object.prototype.toString.call(m)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(m)?"array":"generic"}(m),Z=Y[I];Z.length<=u+1;)Z.push(q(I,Z.length-1));return(0,Z[u+1])(m,S,h,l)}},13450:m=>{var S;self,S=()=>(()=>{"use strict";var m={d:(S,h)=>{for(var l in h)m.o(h,l)&&!m.o(S,l)&&Object.defineProperty(S,l,{enumerable:!0,get:h[l]})},o:(m,S)=>Object.prototype.hasOwnProperty.call(m,S)},S={};m.d(S,{default:()=>x});var h,l=function(m,S){var h=S.x-m.x,l=S.y-m.y;return Math.sqrt(h*h+l*l)},M=function(m){return m*(Math.PI/180)},O=new Map,u=function(m){O.has(m)&&clearTimeout(O.get(m)),O.set(m,setTimeout(m,100))},b=function(m,S,h){for(var l,M=S.split(/[ ,]+/g),O=0;O<M.length;O+=1)l=M[O],m.addEventListener?m.addEventListener(l,h,!1):m.attachEvent&&m.attachEvent(l,h)},q=function(m,S,h){for(var l,M=S.split(/[ ,]+/g),O=0;O<M.length;O+=1)l=M[O],m.removeEventListener?m.removeEventListener(l,h):m.detachEvent&&m.detachEvent(l,h)},Y=function(m){return m.preventDefault(),m.type.match(/^touch/)?m.changedTouches:m},V=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},I=function(m,S){S.top||S.right||S.bottom||S.left?(m.style.top=S.top,m.style.right=S.right,m.style.bottom=S.bottom,m.style.left=S.left):(m.style.left=S.x+"px",m.style.top=S.y+"px")},Z=function(m,S,h){var l=C(m);for(var M in l)if(l.hasOwnProperty(M))if("string"==typeof S)l[M]=S+" "+h;else{for(var O="",u=0,b=S.length;u<b;u+=1)O+=S[u]+" "+h+", ";l[M]=O.slice(0,-2)}return l},C=function(m){var S={};return S[m]="",["webkit","Moz","o"].forEach((function(h){S[h+m.charAt(0).toUpperCase()+m.slice(1)]=""})),S},B=function(m,S){for(var h in S)S.hasOwnProperty(h)&&(m[h]=S[h]);return m},D=function(m,S){if(m.length)for(var h=0,l=m.length;h<l;h+=1)S(m[h]);else S(m)},E="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,n=window.matchMedia("(any-hover: none)").matches,L=!!("ontouchstart"in window),U=!!window.PointerEvent,H=!!window.MSPointerEvent,R={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},y={start:"mousedown",move:"mousemove",end:"mouseup"},o={};function s(){}E&&!n?h=R:U?h={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:H?h={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:L?(h=R,o=y):h=y,s.prototype.on=function(m,S){var h,l=this,M=m.split(/[ ,]+/g);l._handlers_=l._handlers_||{};for(var O=0;O<M.length;O+=1)h=M[O],l._handlers_[h]=l._handlers_[h]||[],l._handlers_[h].push(S);return l},s.prototype.off=function(m,S){var h=this;return h._handlers_=h._handlers_||{},void 0===m?h._handlers_={}:void 0===S?h._handlers_[m]=null:h._handlers_[m]&&h._handlers_[m].indexOf(S)>=0&&h._handlers_[m].splice(h._handlers_[m].indexOf(S),1),h},s.prototype.trigger=function(m,S){var h,l=this,M=m.split(/[ ,]+/g);l._handlers_=l._handlers_||{};for(var O=0;O<M.length;O+=1)h=M[O],l._handlers_[h]&&l._handlers_[h].length&&l._handlers_[h].forEach((function(m){m.call(l,{type:h,target:l},S)}))},s.prototype.config=function(m){var S=this;S.options=S.defaults||{},m&&(S.options=function(m,S){var h={};for(var l in m)m.hasOwnProperty(l)&&S.hasOwnProperty(l)?h[l]=S[l]:m.hasOwnProperty(l)&&(h[l]=m[l]);return h}(S.options,m))},s.prototype.bindEvt=function(m,S){var l=this;return l._domHandlers_=l._domHandlers_||{},l._domHandlers_[S]=function(){"function"==typeof l["on"+S]?l["on"+S].apply(l,arguments):console.warn('[WARNING] : Missing "on'+S+'" handler.')},b(m,h[S],l._domHandlers_[S]),o[S]&&b(m,o[S],l._domHandlers_[S]),l},s.prototype.unbindEvt=function(m,S){var l=this;return l._domHandlers_=l._domHandlers_||{},q(m,h[S],l._domHandlers_[S]),o[S]&&q(m,o[S],l._domHandlers_[S]),delete l._domHandlers_[S],this};const v=s;function T(m,S){return this.identifier=S.identifier,this.position=S.position,this.frontPosition=S.frontPosition,this.collection=m,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(S),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=T.id,T.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}T.prototype=new v,T.constructor=T,T.id=0,T.prototype.buildEl=function(m){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},T.prototype.stylize=function(){if(this.options.dataOnly)return this;var m=this.options.fadeTime+"ms",S=function(){var m=C("borderRadius");for(var S in m)m.hasOwnProperty(S)&&(m[S]="50%");return m}(),h=Z("transition","opacity",m),l={};return l.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},l.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},l.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},B(l.el,h),"circle"===this.options.shape&&B(l.back,S),B(l.front,S),this.applyStyles(l),this},T.prototype.applyStyles=function(m){for(var S in this.ui)if(this.ui.hasOwnProperty(S))for(var h in m[S])this.ui[S].style[h]=m[S][h];return this},T.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},T.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},T.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},T.prototype.show=function(m){var S=this;return S.options.dataOnly||(clearTimeout(S.removeTimeout),clearTimeout(S.showTimeout),clearTimeout(S.restTimeout),S.addToDom(),S.restCallback(),setTimeout((function(){S.ui.el.style.opacity=1}),0),S.showTimeout=setTimeout((function(){S.trigger("shown",S.instance),"function"==typeof m&&m.call(this)}),S.options.fadeTime)),S},T.prototype.hide=function(m){var S=this;if(S.options.dataOnly)return S;if(S.ui.el.style.opacity=S.options.restOpacity,clearTimeout(S.removeTimeout),clearTimeout(S.showTimeout),clearTimeout(S.restTimeout),S.removeTimeout=setTimeout((function(){var h="dynamic"===S.options.mode?"none":"block";S.ui.el.style.display=h,"function"==typeof m&&m.call(S),S.trigger("hidden",S.instance)}),S.options.fadeTime),S.options.restJoystick){var h=S.options.restJoystick,l={};l.x=!0===h||!1!==h.x?0:S.instance.frontPosition.x,l.y=!0===h||!1!==h.y?0:S.instance.frontPosition.y,S.setPosition(m,l)}return S},T.prototype.setPosition=function(m,S){var h=this;h.frontPosition={x:S.x,y:S.y};var l=h.options.fadeTime+"ms",M={};M.front=Z("transition",["transform"],l);var O={front:{}};O.front={transform:"translate("+h.frontPosition.x+"px,"+h.frontPosition.y+"px)"},h.applyStyles(M),h.applyStyles(O),h.restTimeout=setTimeout((function(){"function"==typeof m&&m.call(h),h.restCallback()}),h.options.fadeTime)},T.prototype.restCallback=function(){var m=this,S={};S.front=Z("transition","none",""),m.applyStyles(S),m.trigger("rested",m.instance)},T.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},T.prototype.computeDirection=function(m){var S,h,l,M=m.angle.radian,O=Math.PI/4,u=Math.PI/2;if(M>O&&M<3*O&&!m.lockX?S="up":M>-O&&M<=O&&!m.lockY?S="left":M>3*-O&&M<=-O&&!m.lockX?S="down":m.lockY||(S="right"),m.lockY||(h=M>-u&&M<u?"left":"right"),m.lockX||(l=M>0?"up":"down"),m.force>this.options.threshold){var b,q={};for(b in this.direction)this.direction.hasOwnProperty(b)&&(q[b]=this.direction[b]);var Y={};for(b in this.direction={x:h,y:l,angle:S},m.direction=this.direction,q)q[b]===this.direction[b]&&(Y[b]=!0);if(Y.x&&Y.y&&Y.angle)return m;Y.x&&Y.y||this.trigger("plain",m),Y.x||this.trigger("plain:"+h,m),Y.y||this.trigger("plain:"+l,m),Y.angle||this.trigger("dir dir:"+S,m)}else this.resetDirection();return m};const X=T;function g(m,S){var h=this;h.nipples=[],h.idles=[],h.actives=[],h.ids=[],h.pressureIntervals={},h.manager=m,h.id=g.id,g.id+=1,h.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},h.config(S),"static"!==h.options.mode&&"semi"!==h.options.mode||(h.options.multitouch=!1),h.options.multitouch||(h.options.maxNumberOfNipples=1);var l=getComputedStyle(h.options.zone.parentElement);return l&&"flex"===l.display&&(h.parentIsFlex=!0),h.updateBox(),h.prepareNipples(),h.TZ(),h.begin(),h.nipples}g.prototype=new v,g.constructor=g,g.id=0,g.prototype.prepareNipples=function(){var m=this,S=m.nipples;S.on=m.on.bind(m),S.off=m.off.bind(m),S.options=m.options,S.destroy=m.destroy.bind(m),S.ids=m.ids,S.id=m.id,S.processOnMove=m.processOnMove.bind(m),S.processOnEnd=m.processOnEnd.bind(m),S.get=function(m){if(void 0===m)return S[0];for(var h=0,l=S.length;h<l;h+=1)if(S[h].identifier===m)return S[h];return!1}},g.prototype.TZ=function(){var m=this;m.bindEvt(m.options.zone,"start"),m.options.zone.style.touchAction="none",m.options.zone.style.msTouchAction="none"},g.prototype.begin=function(){var m=this,S=m.options;if("static"===S.mode){var h=m.createNipple(S.position,m.manager.getIdentifier());h.add(),m.idles.push(h)}},g.prototype.createNipple=function(m,S){var h=this,l=h.manager.scroll,M={},O=h.options,u=h.parentIsFlex?l.x:l.x+h.box.left,b=h.parentIsFlex?l.y:l.y+h.box.top;if(m.x&&m.y)M={x:m.x-u,y:m.y-b};else if(m.top||m.right||m.bottom||m.left){var q=document.createElement("DIV");q.style.display="hidden",q.style.top=m.top,q.style.right=m.right,q.style.bottom=m.bottom,q.style.left=m.left,q.style.position="absolute",O.zone.appendChild(q);var Y=q.getBoundingClientRect();O.zone.removeChild(q),M=m,m={x:Y.left+l.x,y:Y.top+l.y}}var V=new X(h,{color:O.color,size:O.size,threshold:O.threshold,fadeTime:O.fadeTime,dataOnly:O.dataOnly,restJoystick:O.restJoystick,restOpacity:O.restOpacity,mode:O.mode,identifier:S,position:m,zone:O.zone,frontPosition:{x:0,y:0},shape:O.shape});return O.dataOnly||(I(V.ui.el,M),I(V.ui.front,V.frontPosition)),h.nipples.push(V),h.trigger("added "+V.identifier+":added",V),h.manager.trigger("added "+V.identifier+":added",V),h.bindNipple(V),V},g.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},g.prototype.bindNipple=function(m){var S,h=this,l=function(m,l){S=m.type+" "+l.id+":"+m.type,h.trigger(S,l)};m.on("destroyed",h.onDestroyed.bind(h)),m.on("shown hidden rested dir plain",l),m.on("dir:up dir:right dir:down dir:left",l),m.on("plain:up plain:right plain:down plain:left",l)},g.prototype.pressureFn=function(m,S,h){var l=this,M=0;clearInterval(l.pressureIntervals[h]),l.pressureIntervals[h]=setInterval(function(){var h=m.force||m.pressure||m.webkitForce||0;h!==M&&(S.trigger("pressure",h),l.trigger("pressure "+S.identifier+":pressure",h),M=h)}.bind(l),100)},g.prototype.onstart=function(m){var S=this,h=S.options,l=m;return m=Y(m),S.updateBox(),D(m,(function(M){S.actives.length<h.maxNumberOfNipples?S.processOnStart(M):l.type.match(/^touch/)&&(Object.keys(S.manager.ids).forEach((function(h){if(Object.values(l.touches).findIndex((function(m){return m.identifier===h}))<0){var M=[m[0]];M.identifier=h,S.processOnEnd(M)}})),S.actives.length<h.maxNumberOfNipples&&S.processOnStart(M))})),S.manager.bindDocument(),!1},g.prototype.processOnStart=function(m){var S,h=this,M=h.options,O=h.manager.getIdentifier(m),u=m.force||m.pressure||m.webkitForce||0,b={x:m.pageX,y:m.pageY},q=h.getOrCreate(O,b);q.identifier!==O&&h.manager.removeIdentifier(q.identifier),q.identifier=O;var Y=function(S){S.trigger("start",S),h.trigger("start "+S.id+":start",S),S.show(),u>0&&h.pressureFn(m,S,S.identifier),h.processOnMove(m)};if((S=h.idles.indexOf(q))>=0&&h.idles.splice(S,1),h.actives.push(q),h.ids.push(q.identifier),"semi"!==M.mode)Y(q);else{if(!(l(b,q.position)<=M.catchDistance))return q.destroy(),void h.processOnStart(m);Y(q)}return q},g.prototype.getOrCreate=function(m,S){var h,l=this,M=l.options;return/(semi|static)/.test(M.mode)?(h=l.idles[0])?(l.idles.splice(0,1),h):"semi"===M.mode?l.createNipple(S,m):(console.warn("Coudln't find the needed nipple."),!1):h=l.createNipple(S,m)},g.prototype.processOnMove=function(m){var S=this,h=S.options,O=S.manager.getIdentifier(m),u=S.nipples.get(O),b=S.manager.scroll;if(function(m){return isNaN(m.buttons)?0!==m.pressure:0!==m.buttons}(m)){if(!u)return console.error("Found zombie joystick with ID "+O),void S.manager.removeIdentifier(O);if(h.dynamicPage){var q=u.el.getBoundingClientRect();u.position={x:b.x+q.left,y:b.y+q.top}}u.identifier=O;var Y=u.options.size/2,V={x:m.pageX,y:m.pageY};h.lockX&&(V.y=u.position.y),h.lockY&&(V.x=u.position.x);var I,Z,C,B,D,E,n,L,U,H,R=l(V,u.position),y=(I=V,C=(Z=u.position).x-I.x,B=Z.y-I.y,function(m){return m*(180/Math.PI)}(Math.atan2(B,C))),o=M(y),s=R/Y,v={distance:R,position:V};if("circle"===u.options.shape?(D=Math.min(R,Y),n=u.position,L=D,H={x:0,y:0},U=M(U=y),H.x=n.x-L*Math.cos(U),H.y=n.y-L*Math.sin(U),E=H):(E=function(m,S,h){return{x:Math.min(Math.max(m.x,S.x-h),S.x+h),y:Math.min(Math.max(m.y,S.y-h),S.y+h)}}(V,u.position,Y),D=l(E,u.position)),h.follow){if(R>Y){var T=V.x-E.x,X=V.y-E.y;u.position.x+=T,u.position.y+=X,u.el.style.top=u.position.y-(S.box.top+b.y)+"px",u.el.style.left=u.position.x-(S.box.left+b.x)+"px",R=l(V,u.position)}}else V=E,R=D;var g=V.x-u.position.x,G=V.y-u.position.y;u.frontPosition={x:g,y:G},h.dataOnly||(u.ui.front.style.transform="translate("+g+"px,"+G+"px)");var e={identifier:u.identifier,position:V,force:s,pressure:m.force||m.pressure||m.webkitForce||0,distance:R,angle:{radian:o,degree:y},vector:{x:g/Y,y:-G/Y},raw:v,instance:u,lockX:h.lockX,lockY:h.lockY};(e=u.computeDirection(e)).angle={radian:M(180-y),degree:180-y},u.trigger("move",e),S.trigger("move "+u.id+":move",e)}else this.processOnEnd(m)},g.prototype.processOnEnd=function(m){var S=this,h=S.options,l=S.manager.getIdentifier(m),M=S.nipples.get(l),O=S.manager.removeIdentifier(M.identifier);M&&(h.dataOnly||M.hide((function(){"dynamic"===h.mode&&(M.trigger("removed",M),S.trigger("removed "+M.id+":removed",M),S.manager.trigger("removed "+M.id+":removed",M),M.destroy())})),clearInterval(S.pressureIntervals[M.identifier]),M.resetDirection(),M.trigger("end",M),S.trigger("end "+M.id+":end",M),S.ids.indexOf(M.identifier)>=0&&S.ids.splice(S.ids.indexOf(M.identifier),1),S.actives.indexOf(M)>=0&&S.actives.splice(S.actives.indexOf(M),1),/(semi|static)/.test(h.mode)?S.idles.push(M):S.nipples.indexOf(M)>=0&&S.nipples.splice(S.nipples.indexOf(M),1),S.manager.unbindDocument(),/(semi|static)/.test(h.mode)&&(S.manager.ids[O.id]=O.identifier))},g.prototype.onDestroyed=function(m,S){var h=this;h.nipples.indexOf(S)>=0&&h.nipples.splice(h.nipples.indexOf(S),1),h.actives.indexOf(S)>=0&&h.actives.splice(h.actives.indexOf(S),1),h.idles.indexOf(S)>=0&&h.idles.splice(h.idles.indexOf(S),1),h.ids.indexOf(S.identifier)>=0&&h.ids.splice(h.ids.indexOf(S.identifier),1),h.manager.removeIdentifier(S.identifier),h.manager.unbindDocument()},g.prototype.destroy=function(){var m=this;for(var S in m.unbindEvt(m.options.zone,"start"),m.nipples.forEach((function(m){m.destroy()})),m.pressureIntervals)m.pressureIntervals.hasOwnProperty(S)&&clearInterval(m.pressureIntervals[S]);m.trigger("destroyed",m.nipples),m.manager.unbindDocument(),m.off()};const G=g;function e(m){var S=this;S.ids={},S.index=0,S.collections=[],S.scroll=V(),S.config(m),S.prepareCollections();var h=function(){var m;S.collections.forEach((function(h){h.forEach((function(h){m=h.el.getBoundingClientRect(),h.position={x:S.scroll.x+m.left,y:S.scroll.y+m.top}}))}))};b(window,"resize",(function(){u(h)}));var l=function(){S.scroll=V()};return b(window,"scroll",(function(){u(l)})),S.collections}e.prototype=new v,e.constructor=e,e.prototype.prepareCollections=function(){var m=this;m.collections.create=m.create.bind(m),m.collections.on=m.on.bind(m),m.collections.off=m.off.bind(m),m.collections.destroy=m.destroy.bind(m),m.collections.get=function(S){var h;return m.collections.every((function(m){return!(h=m.get(S))})),h}},e.prototype.create=function(m){return this.createCollection(m)},e.prototype.createCollection=function(m){var S=this,h=new G(S,m);return S.bindCollection(h),S.collections.push(h),h},e.prototype.bindCollection=function(m){var S,h=this,l=function(m,l){S=m.type+" "+l.id+":"+m.type,h.trigger(S,l)};m.on("destroyed",h.onDestroyed.bind(h)),m.on("shown hidden rested dir plain",l),m.on("dir:up dir:right dir:down dir:left",l),m.on("plain:up plain:right plain:down plain:left",l)},e.prototype.bindDocument=function(){var m=this;m.binded||(m.bindEvt(document,"move").bindEvt(document,"end"),m.binded=!0)},e.prototype.unbindDocument=function(m){var S=this;Object.keys(S.ids).length&&!0!==m||(S.unbindEvt(document,"move").unbindEvt(document,"end"),S.binded=!1)},e.prototype.getIdentifier=function(m){var S;return m?void 0===(S=void 0===m.identifier?m.pointerId:m.identifier)&&(S=this.latest||0):S=this.index,void 0===this.ids[S]&&(this.ids[S]=this.index,this.index+=1),this.latest=S,this.ids[S]},e.prototype.removeIdentifier=function(m){var S={};for(var h in this.ids)if(this.ids[h]===m){S.id=h,S.identifier=this.ids[h],delete this.ids[h];break}return S},e.prototype.onmove=function(m){return this.onAny("move",m),!1},e.prototype.onend=function(m){return this.onAny("end",m),!1},e.prototype.oncancel=function(m){return this.onAny("end",m),!1},e.prototype.onAny=function(m,S){var h,l=this,M="processOn"+m.charAt(0).toUpperCase()+m.slice(1);S=Y(S);var O=function(m,S,h){h.ids.indexOf(S)>=0&&(h[M](m),m._found_=!0)};return D(S,(function(m){h=l.getIdentifier(m),D(l.collections,O.bind(null,m,h)),m._found_||l.removeIdentifier(h)})),!1},e.prototype.destroy=function(){var m=this;m.unbindDocument(!0),m.ids={},m.index=0,m.collections.forEach((function(m){m.destroy()})),m.off()},e.prototype.onDestroyed=function(m,S){var h=this;if(h.collections.indexOf(S)<0)return!1;h.collections.splice(h.collections.indexOf(S),1)};var a=new e;const x={create:function(m){return a.create(m)},factory:a};return S.default})(),m.exports=S()},12459:(m,S,h)=>{"use strict";const{Deflate:l,deflate:M,deflateRaw:O,gzip:u}=h(12462),{Inflate:b,inflate:q,inflateRaw:Y,ungzip:V}=h(12523),I=h(12498);m.exports.Deflate=l,m.exports.deflate=M,m.exports.deflateRaw=O,m.exports.gzip=u,m.exports.Inflate=b,m.exports.inflate=q,m.exports.inflateRaw=Y,m.exports.ungzip=V,m.exports.constants=I},12462:(m,S,h)=>{"use strict";const l=h(12465),M=h(12504),O=h(12509),u=h(12489),b=h(12518),q=Object.prototype.toString,{Z_NO_FLUSH:Y,Z_SYNC_FLUSH:V,Z_FULL_FLUSH:I,Z_FINISH:Z,Z_OK:C,Z_STREAM_END:B,Z_DEFAULT_COMPRESSION:D,Z_DEFAULT_STRATEGY:E,Z_DEFLATED:n}=h(12498);function L(m){this.options=M.assign({level:D,method:n,fm:16384,windowBits:15,memLevel:8,strategy:E},m||{});let S=this.options;S.raw&&S.windowBits>0?S.windowBits=-S.windowBits:S.gzip&&S.windowBits>0&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.ZS="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;let h=l.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(h!==C)throw new Error(u[h]);if(S.header&&l.deflateSetHeader(this.strm,S.header),S.dictionary){let m;if(m="string"===typeof S.dictionary?O.string2buf(S.dictionary):"[object ArrayBuffer]"===q.call(S.dictionary)?new Uint8Array(S.dictionary):S.dictionary,h=l.deflateSetDictionary(this.strm,m),h!==C)throw new Error(u[h]);this._dict_set=!0}}function U(m,S){const h=new L(S);if(h.push(m,!0),h.err)throw h.ZS||u[h.err];return h.result}L.prototype.push=function(m,S){const h=this.strm,M=this.options.fm;let u,b;if(this.ended)return!1;for(b=S===~~S?S:!0===S?Z:Y,"string"===typeof m?h.input=O.string2buf(m):"[object ArrayBuffer]"===q.call(m)?h.input=new Uint8Array(m):h.input=m,h.next_in=0,h.avail_in=h.input.length;;)if(0===h.avail_out&&(h.output=new Uint8Array(M),h.next_out=0,h.avail_out=M),(b===V||b===I)&&h.avail_out<=6)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else{if(u=l.deflate(h,b),u===B)return h.next_out>0&&this.onData(h.output.subarray(0,h.next_out)),u=l.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===C;if(0!==h.avail_out){if(b>0&&h.next_out>0)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else if(0===h.avail_in)break}else this.onData(h.output)}return!0},L.prototype.onData=function(m){this.chunks.push(m)},L.prototype.onEnd=function(m){m===C&&(this.result=M.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.ZS=this.strm.ZS},m.exports.Deflate=L,m.exports.deflate=U,m.exports.deflateRaw=function(m,S){return(S=S||{}).raw=!0,U(m,S)},m.exports.gzip=function(m,S){return(S=S||{}).gzip=!0,U(m,S)},m.exports.constants=h(12498)},12523:(m,S,h)=>{"use strict";const l=h(12531),M=h(12504),O=h(12509),u=h(12489),b=h(12518),q=h(12551),Y=Object.prototype.toString,{Z_NO_FLUSH:V,Z_FINISH:I,Z_OK:Z,Z_STREAM_END:C,Z_NEED_DICT:B,Z_STREAM_ERROR:D,Z_DATA_ERROR:E,Z_MEM_ERROR:n}=h(12498);function L(m){this.options=M.assign({fm:65536,windowBits:15,to:""},m||{});const S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,0===S.windowBits&&(S.windowBits=-15)),!(S.windowBits>=0&&S.windowBits<16)||m&&m.windowBits||(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&0===(15&S.windowBits)&&(S.windowBits|=15),this.err=0,this.ZS="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;let h=l.inflateInit2(this.strm,S.windowBits);if(h!==Z)throw new Error(u[h]);if(this.header=new q,l.inflateGetHeader(this.strm,this.header),S.dictionary&&("string"===typeof S.dictionary?S.dictionary=O.string2buf(S.dictionary):"[object ArrayBuffer]"===Y.call(S.dictionary)&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(h=l.inflateSetDictionary(this.strm,S.dictionary),h!==Z)))throw new Error(u[h])}function U(m,S){const h=new L(S);if(h.push(m),h.err)throw h.ZS||u[h.err];return h.result}L.prototype.push=function(m,S){const h=this.strm,M=this.options.fm,u=this.options.dictionary;let b,q,L;if(this.ended)return!1;for(q=S===~~S?S:!0===S?I:V,"[object ArrayBuffer]"===Y.call(m)?h.input=new Uint8Array(m):h.input=m,h.next_in=0,h.avail_in=h.input.length;;){for(0===h.avail_out&&(h.output=new Uint8Array(M),h.next_out=0,h.avail_out=M),b=l.inflate(h,q),b===B&&u&&(b=l.inflateSetDictionary(h,u),b===Z?b=l.inflate(h,q):b===E&&(b=B));h.avail_in>0&&b===C&&h.state.wrap>0&&0!==m[h.next_in];)l.inflateReset(h),b=l.inflate(h,q);switch(b){case D:case E:case B:case n:return this.onEnd(b),this.ended=!0,!1}if(L=h.avail_out,h.next_out&&(0===h.avail_out||b===C))if("string"===this.options.to){let m=O.utf8border(h.output,h.next_out),S=h.next_out-m,l=O.buf2string(h.output,m);h.next_out=S,h.avail_out=M-S,S&&h.output.set(h.output.subarray(m,m+S),0),this.onData(l)}else this.onData(h.output.length===h.next_out?h.output:h.output.subarray(0,h.next_out));if(b!==Z||0!==L){if(b===C)return b=l.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,!0;if(0===h.avail_in)break}}return!0},L.prototype.onData=function(m){this.chunks.push(m)},L.prototype.onEnd=function(m){m===Z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=M.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.ZS=this.strm.ZS},m.exports.Inflate=L,m.exports.inflate=U,m.exports.inflateRaw=function(m,S){return(S=S||{}).raw=!0,U(m,S)},m.exports.ungzip=U,m.exports.constants=h(12498)},12504:m=>{"use strict";const S=(m,S)=>Object.prototype.hasOwnProperty.call(m,S);m.exports.assign=function(m){const h=Array.prototype.slice.call(arguments,1);for(;h.length;){const l=h.shift();if(l){if("object"!==typeof l)throw new TypeError(l+"must be non-object");for(const h in l)S(l,h)&&(m[h]=l[h])}}return m},m.exports.flattenChunks=m=>{let S=0;for(let l=0,M=m.length;l<M;l++)S+=m[l].length;const h=new Uint8Array(S);for(let l=0,M=0,O=m.length;l<O;l++){let S=m[l];h.set(S,M),M+=S.length}return h}},12509:m=>{"use strict";let S=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){S=!1}const h=new Uint8Array(256);for(let M=0;M<256;M++)h[M]=M>=252?6:M>=248?5:M>=240?4:M>=224?3:M>=192?2:1;h[254]=h[254]=1,m.exports.string2buf=m=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(m);let S,h,l,M,O,u=m.length,b=0;for(M=0;M<u;M++)h=m.charCodeAt(M),55296===(64512&h)&&M+1<u&&(l=m.charCodeAt(M+1),56320===(64512&l)&&(h=65536+(h-55296<<10)+(l-56320),M++)),b+=h<128?1:h<2048?2:h<65536?3:4;for(S=new Uint8Array(b),O=0,M=0;O<b;M++)h=m.charCodeAt(M),55296===(64512&h)&&M+1<u&&(l=m.charCodeAt(M+1),56320===(64512&l)&&(h=65536+(h-55296<<10)+(l-56320),M++)),h<128?S[O++]=h:h<2048?(S[O++]=192|h>>>6,S[O++]=128|63&h):h<65536?(S[O++]=224|h>>>12,S[O++]=128|h>>>6&63,S[O++]=128|63&h):(S[O++]=240|h>>>18,S[O++]=128|h>>>12&63,S[O++]=128|h>>>6&63,S[O++]=128|63&h);return S};m.exports.buf2string=(m,l)=>{const M=l||m.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(m.subarray(0,l));let O,u;const b=new Array(2*M);for(u=0,O=0;O<M;){let S=m[O++];if(S<128){b[u++]=S;continue}let l=h[S];if(l>4)b[u++]=65533,O+=l-1;else{for(S&=2===l?31:3===l?15:7;l>1&&O<M;)S=S<<6|63&m[O++],l--;l>1?b[u++]=65533:S<65536?b[u++]=S:(S-=65536,b[u++]=55296|S>>10&1023,b[u++]=56320|1023&S)}}return((m,h)=>{if(h<65534&&m.subarray&&S)return String.fromCharCode.apply(null,m.length===h?m:m.subarray(0,h));let l="";for(let S=0;S<h;S++)l+=String.fromCharCode(m[S]);return l})(b,u)},m.exports.utf8border=(m,S)=>{(S=S||m.length)>m.length&&(S=m.length);let l=S-1;for(;l>=0&&128===(192&m[l]);)l--;return l<0||0===l?S:l+h[m[l]]>S?l:S}},12479:m=>{"use strict";m.exports=(m,S,h,l)=>{let M=65535&m,O=m>>>16&65535,u=0;for(;0!==h;){u=h>2e3?2e3:h,h-=u;do{M=M+S[l++]|0,O=O+M|0}while(--u);M%=65521,O%=65521}return M|O<<16}},12498:m=>{"use strict";m.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12485:m=>{"use strict";const S=new Uint32Array((()=>{let m,S=[];for(var h=0;h<256;h++){m=h;for(var l=0;l<8;l++)m=1&m?3988292384^m>>>1:m>>>1;S[h]=m}return S})());m.exports=(m,h,l,M)=>{const O=S,u=M+l;m^=-1;for(let S=M;S<u;S++)m=m>>>8^O[255&(m^h[S])];return~m}},12465:(m,S,h)=>{"use strict";const{_tr_init:l,_tr_stored_block:M,_tr_flush_block:O,_tr_tally:u,_tr_align:b}=h(12474),q=h(12479),Y=h(12485),V=h(12489),{Z_NO_FLUSH:I,Z_PARTIAL_FLUSH:Z,Z_FULL_FLUSH:C,Z_FINISH:B,Z_BLOCK:D,Z_OK:E,Z_STREAM_END:n,Z_STREAM_ERROR:L,Z_DATA_ERROR:U,Z_BUF_ERROR:H,Z_DEFAULT_COMPRESSION:R,Z_FILTERED:y,Z_HUFFMAN_ONLY:o,Z_RLE:s,Z_FIXED:v,Z_DEFAULT_STRATEGY:T,Z_UNKNOWN:X,Z_DEFLATED:g}=h(12498),G=258,e=262,a=103,x=113,P=666,d=(m,S)=>(m.ZS=V[S],S),J=m=>(m<<1)-(m>4?9:0),N=m=>{let S=m.length;for(;--S>=0;)m[S]=0};let j=(m,S,h)=>(S<<m.hash_shift^h)&m.hash_mask;const K=m=>{const S=m.state;let h=S.pending;h>m.avail_out&&(h=m.avail_out),0!==h&&(m.output.set(S.pending_buf.subarray(S.pending_out,S.pending_out+h),m.next_out),m.next_out+=h,S.pending_out+=h,m.total_out+=h,m.avail_out-=h,S.pending-=h,0===S.pending&&(S.pending_out=0))},c=(m,S)=>{O(m,m.block_start>=0?m.block_start:-1,m.strstart-m.block_start,S),m.block_start=m.strstart,K(m.strm)},f=(m,S)=>{m.pending_buf[m.pending++]=S},p=(m,S)=>{m.pending_buf[m.pending++]=S>>>8&255,m.pending_buf[m.pending++]=255&S},k=(m,S,h,l)=>{let M=m.avail_in;return M>l&&(M=l),0===M?0:(m.avail_in-=M,S.set(m.input.subarray(m.next_in,m.next_in+M),h),1===m.state.wrap?m.adler=q(m.adler,S,M,h):2===m.state.wrap&&(m.adler=Y(m.adler,S,M,h)),m.next_in+=M,m.total_in+=M,M)},r=(m,S)=>{let h,l,M=m.max_chain_length,O=m.strstart,u=m.prev_length,b=m.nice_match;const q=m.strstart>m.w_size-e?m.strstart-(m.w_size-e):0,Y=m.window,V=m.w_mask,I=m.prev,Z=m.strstart+G;let C=Y[O+u-1],B=Y[O+u];m.prev_length>=m.good_match&&(M>>=2),b>m.lookahead&&(b=m.lookahead);do{if(h=S,Y[h+u]===B&&Y[h+u-1]===C&&Y[h]===Y[O]&&Y[++h]===Y[O+1]){O+=2,h++;do{}while(Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&Y[++O]===Y[++h]&&O<Z);if(l=G-(Z-O),O=Z-G,l>u){if(m.match_start=S,u=l,l>=b)break;C=Y[O+u-1],B=Y[O+u]}}}while((S=I[S&V])>q&&0!==--M);return u<=m.lookahead?u:m.lookahead},z=m=>{const S=m.w_size;let h,l,M,O,u;do{if(O=m.window_size-m.lookahead-m.strstart,m.strstart>=S+(S-e)){m.window.set(m.window.subarray(S,S+S),0),m.match_start-=S,m.strstart-=S,m.block_start-=S,l=m.hash_size,h=l;do{M=m.head[--h],m.head[h]=M>=S?M-S:0}while(--l);l=S,h=l;do{M=m.prev[--h],m.prev[h]=M>=S?M-S:0}while(--l);O+=S}if(0===m.strm.avail_in)break;if(l=k(m.strm,m.window,m.strstart+m.lookahead,O),m.lookahead+=l,m.lookahead+m.insert>=3)for(u=m.strstart-m.insert,m.ins_h=m.window[u],m.ins_h=j(m,m.ins_h,m.window[u+1]);m.insert&&(m.ins_h=j(m,m.ins_h,m.window[u+3-1]),m.prev[u&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=u,u++,m.insert--,!(m.lookahead+m.insert<3)););}while(m.lookahead<e&&0!==m.strm.avail_in)},Q=(m,S)=>{let h,l;for(;;){if(m.lookahead<e){if(z(m),m.lookahead<e&&S===I)return 1;if(0===m.lookahead)break}if(h=0,m.lookahead>=3&&(m.ins_h=j(m,m.ins_h,m.window[m.strstart+3-1]),h=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),0!==h&&m.strstart-h<=m.w_size-e&&(m.match_length=r(m,h)),m.match_length>=3)if(l=u(m,m.strstart-m.match_start,m.match_length-3),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=3){m.match_length--;do{m.strstart++,m.ins_h=j(m,m.ins_h,m.window[m.strstart+3-1]),h=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart}while(0!==--m.match_length);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=j(m,m.ins_h,m.window[m.strstart+1]);else l=u(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(l&&(c(m,!1),0===m.strm.avail_out))return 1}return m.insert=m.strstart<2?m.strstart:2,S===B?(c(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(c(m,!1),0===m.strm.avail_out)?1:2},F=(m,S)=>{let h,l,M;for(;;){if(m.lookahead<e){if(z(m),m.lookahead<e&&S===I)return 1;if(0===m.lookahead)break}if(h=0,m.lookahead>=3&&(m.ins_h=j(m,m.ins_h,m.window[m.strstart+3-1]),h=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=2,0!==h&&m.prev_length<m.max_lazy_match&&m.strstart-h<=m.w_size-e&&(m.match_length=r(m,h),m.match_length<=5&&(m.strategy===y||3===m.match_length&&m.strstart-m.match_start>4096)&&(m.match_length=2)),m.prev_length>=3&&m.match_length<=m.prev_length){M=m.strstart+m.lookahead-3,l=u(m,m.strstart-1-m.prev_match,m.prev_length-3),m.lookahead-=m.prev_length-1,m.prev_length-=2;do{++m.strstart<=M&&(m.ins_h=j(m,m.ins_h,m.window[m.strstart+3-1]),h=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart)}while(0!==--m.prev_length);if(m.match_available=0,m.match_length=2,m.strstart++,l&&(c(m,!1),0===m.strm.avail_out))return 1}else if(m.match_available){if(l=u(m,0,m.window[m.strstart-1]),l&&c(m,!1),m.strstart++,m.lookahead--,0===m.strm.avail_out)return 1}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(l=u(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<2?m.strstart:2,S===B?(c(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(c(m,!1),0===m.strm.avail_out)?1:2};function w(m,S,h,l,M){this.good_length=m,this.max_lazy=S,this.nice_length=h,this.max_chain=l,this.func=M}const t=[new w(0,0,0,0,((m,S)=>{let h=65535;for(h>m.pending_buf_size-5&&(h=m.pending_buf_size-5);;){if(m.lookahead<=1){if(z(m),0===m.lookahead&&S===I)return 1;if(0===m.lookahead)break}m.strstart+=m.lookahead,m.lookahead=0;const l=m.block_start+h;if((0===m.strstart||m.strstart>=l)&&(m.lookahead=m.strstart-l,m.strstart=l,c(m,!1),0===m.strm.avail_out))return 1;if(m.strstart-m.block_start>=m.w_size-e&&(c(m,!1),0===m.strm.avail_out))return 1}return m.insert=0,S===B?(c(m,!0),0===m.strm.avail_out?3:4):(m.strstart>m.block_start&&(c(m,!1),m.strm.avail_out),1)})),new w(4,4,8,4,Q),new w(4,5,16,8,Q),new w(4,6,32,32,Q),new w(4,4,16,16,F),new w(8,16,32,32,F),new w(8,16,128,128,F),new w(8,32,128,256,F),new w(32,128,258,1024,F),new w(32,258,258,4096,F)];function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const i=m=>{if(!m||!m.state)return d(m,L);m.total_in=m.total_out=0,m.data_type=X;const S=m.state;return S.pending=0,S.pending_out=0,S.wrap<0&&(S.wrap=-S.wrap),S.status=S.wrap?42:x,m.adler=2===S.wrap?0:1,S.last_flush=I,l(S),E},W=m=>{const S=i(m);var h;return S===E&&((h=m.state).window_size=2*h.w_size,N(h.head),h.max_lazy_match=t[h.level].max_lazy,h.good_match=t[h.level].good_length,h.nice_match=t[h.level].nice_length,h.max_chain_length=t[h.level].max_chain,h.strstart=0,h.block_start=0,h.lookahead=0,h.insert=0,h.match_length=h.prev_length=2,h.match_available=0,h.ins_h=0),S},mm=(m,S,h,l,M,O)=>{if(!m)return L;let u=1;if(S===R&&(S=6),l<0?(u=0,l=-l):l>15&&(u=2,l-=16),M<1||M>9||h!==g||l<8||l>15||S<0||S>9||O<0||O>v)return d(m,L);8===l&&(l=9);const b=new A;return m.state=b,b.strm=m,b.wrap=u,b.gzhead=null,b.w_bits=l,b.w_size=1<<b.w_bits,b.w_mask=b.w_size-1,b.hash_bits=M+7,b.hash_size=1<<b.hash_bits,b.hash_mask=b.hash_size-1,b.hash_shift=~~((b.hash_bits+3-1)/3),b.window=new Uint8Array(2*b.w_size),b.head=new Uint16Array(b.hash_size),b.prev=new Uint16Array(b.w_size),b.lit_bufsize=1<<M+6,b.pending_buf_size=4*b.lit_bufsize,b.pending_buf=new Uint8Array(b.pending_buf_size),b.d_buf=1*b.lit_bufsize,b.l_buf=3*b.lit_bufsize,b.level=S,b.strategy=O,b.method=h,W(m)};m.exports.deflateInit=(m,S)=>mm(m,S,g,15,8,T),m.exports.deflateInit2=mm,m.exports.deflateReset=W,m.exports.deflateResetKeep=i,m.exports.deflateSetHeader=(m,S)=>m&&m.state?2!==m.state.wrap?L:(m.state.gzhead=S,E):L,m.exports.deflate=(m,S)=>{let h,l;if(!m||!m.state||S>D||S<0)return m?d(m,L):L;const O=m.state;if(!m.output||!m.input&&0!==m.avail_in||O.status===P&&S!==B)return d(m,0===m.avail_out?H:L);O.strm=m;const q=O.last_flush;if(O.last_flush=S,42===O.status)if(2===O.wrap)m.adler=0,f(O,31),f(O,139),f(O,8),O.gzhead?(f(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),f(O,255&O.gzhead.time),f(O,O.gzhead.time>>8&255),f(O,O.gzhead.time>>16&255),f(O,O.gzhead.time>>24&255),f(O,9===O.level?2:O.strategy>=o||O.level<2?4:0),f(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(f(O,255&O.gzhead.extra.length),f(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(m.adler=Y(m.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(f(O,0),f(O,0),f(O,0),f(O,0),f(O,0),f(O,9===O.level?2:O.strategy>=o||O.level<2?4:0),f(O,3),O.status=x);else{let S=g+(O.w_bits-8<<4)<<8,h=-1;h=O.strategy>=o||O.level<2?0:O.level<6?1:6===O.level?2:3,S|=h<<6,0!==O.strstart&&(S|=32),S+=31-S%31,O.status=x,p(O,S),0!==O.strstart&&(p(O,m.adler>>>16),p(O,65535&m.adler)),m.adler=1}if(69===O.status)if(O.gzhead.extra){for(h=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>h&&(m.adler=Y(m.adler,O.pending_buf,O.pending-h,h)),K(m),h=O.pending,O.pending!==O.pending_buf_size));)f(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>h&&(m.adler=Y(m.adler,O.pending_buf,O.pending-h,h)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(73===O.status)if(O.gzhead.name){h=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>h&&(m.adler=Y(m.adler,O.pending_buf,O.pending-h,h)),K(m),h=O.pending,O.pending===O.pending_buf_size)){l=1;break}l=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,f(O,l)}while(0!==l);O.gzhead.hcrc&&O.pending>h&&(m.adler=Y(m.adler,O.pending_buf,O.pending-h,h)),0===l&&(O.gzindex=0,O.status=91)}else O.status=91;if(91===O.status)if(O.gzhead.comment){h=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>h&&(m.adler=Y(m.adler,O.pending_buf,O.pending-h,h)),K(m),h=O.pending,O.pending===O.pending_buf_size)){l=1;break}l=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,f(O,l)}while(0!==l);O.gzhead.hcrc&&O.pending>h&&(m.adler=Y(m.adler,O.pending_buf,O.pending-h,h)),0===l&&(O.status=a)}else O.status=a;if(O.status===a&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&K(m),O.pending+2<=O.pending_buf_size&&(f(O,255&m.adler),f(O,m.adler>>8&255),m.adler=0,O.status=x)):O.status=x),0!==O.pending){if(K(m),0===m.avail_out)return O.last_flush=-1,E}else if(0===m.avail_in&&J(S)<=J(q)&&S!==B)return d(m,H);if(O.status===P&&0!==m.avail_in)return d(m,H);if(0!==m.avail_in||0!==O.lookahead||S!==I&&O.status!==P){let h=O.strategy===o?((m,S)=>{let h;for(;;){if(0===m.lookahead&&(z(m),0===m.lookahead)){if(S===I)return 1;break}if(m.match_length=0,h=u(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++,h&&(c(m,!1),0===m.strm.avail_out))return 1}return m.insert=0,S===B?(c(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(c(m,!1),0===m.strm.avail_out)?1:2})(O,S):O.strategy===s?((m,S)=>{let h,l,M,O;const b=m.window;for(;;){if(m.lookahead<=G){if(z(m),m.lookahead<=G&&S===I)return 1;if(0===m.lookahead)break}if(m.match_length=0,m.lookahead>=3&&m.strstart>0&&(M=m.strstart-1,l=b[M],l===b[++M]&&l===b[++M]&&l===b[++M])){O=m.strstart+G;do{}while(l===b[++M]&&l===b[++M]&&l===b[++M]&&l===b[++M]&&l===b[++M]&&l===b[++M]&&l===b[++M]&&l===b[++M]&&M<O);m.match_length=G-(O-M),m.match_length>m.lookahead&&(m.match_length=m.lookahead)}if(m.match_length>=3?(h=u(m,1,m.match_length-3),m.lookahead-=m.match_length,m.strstart+=m.match_length,m.match_length=0):(h=u(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++),h&&(c(m,!1),0===m.strm.avail_out))return 1}return m.insert=0,S===B?(c(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(c(m,!1),0===m.strm.avail_out)?1:2})(O,S):t[O.level].func(O,S);if(3!==h&&4!==h||(O.status=P),1===h||3===h)return 0===m.avail_out&&(O.last_flush=-1),E;if(2===h&&(S===Z?b(O):S!==D&&(M(O,0,0,!1),S===C&&(N(O.head),0===O.lookahead&&(O.strstart=0,O.block_start=0,O.insert=0))),K(m),0===m.avail_out))return O.last_flush=-1,E}return S!==B?E:O.wrap<=0?n:(2===O.wrap?(f(O,255&m.adler),f(O,m.adler>>8&255),f(O,m.adler>>16&255),f(O,m.adler>>24&255),f(O,255&m.total_in),f(O,m.total_in>>8&255),f(O,m.total_in>>16&255),f(O,m.total_in>>24&255)):(p(O,m.adler>>>16),p(O,65535&m.adler)),K(m),O.wrap>0&&(O.wrap=-O.wrap),0!==O.pending?E:n)},m.exports.deflateEnd=m=>{if(!m||!m.state)return L;const S=m.state.status;return 42!==S&&69!==S&&73!==S&&91!==S&&S!==a&&S!==x&&S!==P?d(m,L):(m.state=null,S===x?d(m,U):E)},m.exports.deflateSetDictionary=(m,S)=>{let h=S.length;if(!m||!m.state)return L;const l=m.state,M=l.wrap;if(2===M||1===M&&42!==l.status||l.lookahead)return L;if(1===M&&(m.adler=q(m.adler,S,h,0)),l.wrap=0,h>=l.w_size){0===M&&(N(l.head),l.strstart=0,l.block_start=0,l.insert=0);let m=new Uint8Array(l.w_size);m.set(S.subarray(h-l.w_size,h),0),S=m,h=l.w_size}const O=m.avail_in,u=m.next_in,b=m.input;for(m.avail_in=h,m.next_in=0,m.input=S,z(l);l.lookahead>=3;){let m=l.strstart,S=l.lookahead-2;do{l.ins_h=j(l,l.ins_h,l.window[m+3-1]),l.prev[m&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=m,m++}while(--S);l.strstart=m,l.lookahead=2,z(l)}return l.strstart+=l.lookahead,l.block_start=l.strstart,l.insert=l.lookahead,l.lookahead=0,l.match_length=l.prev_length=2,l.match_available=0,m.next_in=u,m.input=b,m.avail_in=O,l.wrap=M,E},m.exports.deflateInfo="pako deflate (from Nodeca project)"},12551:m=>{"use strict";m.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12539:m=>{"use strict";m.exports=function(m,S){let h,l,M,O,u,b,q,Y,V,I,Z,C,B,D,E,n,L,U,H,R,y,o,s,v;const T=m.state;h=m.next_in,s=m.input,l=h+(m.avail_in-5),M=m.next_out,v=m.output,O=M-(S-m.avail_out),u=M+(m.avail_out-257),b=T.dmax,q=T.wsize,Y=T.whave,V=T.wnext,I=T.window,Z=T.hold,C=T.bits,B=T.lencode,D=T.distcode,E=(1<<T.lenbits)-1,n=(1<<T.distbits)-1;m:do{C<15&&(Z+=s[h++]<<C,C+=8,Z+=s[h++]<<C,C+=8),L=B[Z&E];S:for(;;){if(U=L>>>24,Z>>>=U,C-=U,U=L>>>16&255,0===U)v[M++]=65535&L;else{if(!(16&U)){if(0===(64&U)){L=B[(65535&L)+(Z&(1<<U)-1)];continue S}if(32&U){T.mode=12;break m}m.ZS="invalid literal/length code",T.mode=30;break m}H=65535&L,U&=15,U&&(C<U&&(Z+=s[h++]<<C,C+=8),H+=Z&(1<<U)-1,Z>>>=U,C-=U),C<15&&(Z+=s[h++]<<C,C+=8,Z+=s[h++]<<C,C+=8),L=D[Z&n];h:for(;;){if(U=L>>>24,Z>>>=U,C-=U,U=L>>>16&255,!(16&U)){if(0===(64&U)){L=D[(65535&L)+(Z&(1<<U)-1)];continue h}m.ZS="invalid distance code",T.mode=30;break m}if(R=65535&L,U&=15,C<U&&(Z+=s[h++]<<C,C+=8,C<U&&(Z+=s[h++]<<C,C+=8)),R+=Z&(1<<U)-1,R>b){m.ZS="invalid distance too far back",T.mode=30;break m}if(Z>>>=U,C-=U,U=M-O,R>U){if(U=R-U,U>Y&&T.sane){m.ZS="invalid distance too far back",T.mode=30;break m}if(y=0,o=I,0===V){if(y+=q-U,U<H){H-=U;do{v[M++]=I[y++]}while(--U);y=M-R,o=v}}else if(V<U){if(y+=q+V-U,U-=V,U<H){H-=U;do{v[M++]=I[y++]}while(--U);if(y=0,V<H){U=V,H-=U;do{v[M++]=I[y++]}while(--U);y=M-R,o=v}}}else if(y+=V-U,U<H){H-=U;do{v[M++]=I[y++]}while(--U);y=M-R,o=v}for(;H>2;)v[M++]=o[y++],v[M++]=o[y++],v[M++]=o[y++],H-=3;H&&(v[M++]=o[y++],H>1&&(v[M++]=o[y++]))}else{y=M-R;do{v[M++]=v[y++],v[M++]=v[y++],v[M++]=v[y++],H-=3}while(H>2);H&&(v[M++]=v[y++],H>1&&(v[M++]=v[y++]))}break}}break}}while(h<l&&M<u);H=C>>3,h-=H,C-=H<<3,Z&=(1<<C)-1,m.next_in=h,m.next_out=M,m.avail_in=h<l?l-h+5:5-(h-l),m.avail_out=M<u?u-M+257:257-(M-u),T.hold=Z,T.bits=C}},12531:(m,S,h)=>{"use strict";const l=h(12479),M=h(12485),O=h(12539),u=h(12545),{Z_FINISH:b,Z_BLOCK:q,Z_TREES:Y,Z_OK:V,Z_STREAM_END:I,Z_NEED_DICT:Z,Z_STREAM_ERROR:C,Z_DATA_ERROR:B,Z_MEM_ERROR:D,Z_BUF_ERROR:E,Z_DEFLATED:n}=h(12498),L=12,U=30,H=m=>(m>>>24&255)+(m>>>8&65280)+((65280&m)<<8)+((255&m)<<24);function R(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const y=m=>{if(!m||!m.state)return C;const S=m.state;return m.total_in=m.total_out=S.total=0,m.ZS="",S.wrap&&(m.adler=1&S.wrap),S.mode=1,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new Int32Array(852),S.distcode=S.distdyn=new Int32Array(592),S.sane=1,S.back=-1,V},o=m=>{if(!m||!m.state)return C;const S=m.state;return S.wsize=0,S.whave=0,S.wnext=0,y(m)},s=(m,S)=>{let h;if(!m||!m.state)return C;const l=m.state;return S<0?(h=0,S=-S):(h=1+(S>>4),S<48&&(S&=15)),S&&(S<8||S>15)?C:(null!==l.window&&l.wbits!==S&&(l.window=null),l.wrap=h,l.wbits=S,o(m))},v=(m,S)=>{if(!m)return C;const h=new R;m.state=h,h.window=null;const l=s(m,S);return l!==V&&(m.state=null),l};let T,X,g=!0;const G=m=>{if(g){T=new Int32Array(512),X=new Int32Array(32);let S=0;for(;S<144;)m.lens[S++]=8;for(;S<256;)m.lens[S++]=9;for(;S<280;)m.lens[S++]=7;for(;S<288;)m.lens[S++]=8;for(u(1,m.lens,0,288,T,0,m.work,{bits:9}),S=0;S<32;)m.lens[S++]=5;u(2,m.lens,0,32,X,0,m.work,{bits:5}),g=!1}m.lencode=T,m.lenbits=9,m.distcode=X,m.distbits=5},e=(m,S,h,l)=>{let M;const O=m.state;return null===O.window&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new Uint8Array(O.wsize)),l>=O.wsize?(O.window.set(S.subarray(h-O.wsize,h),0),O.wnext=0,O.whave=O.wsize):(M=O.wsize-O.wnext,M>l&&(M=l),O.window.set(S.subarray(h-l,h-l+M),O.wnext),(l-=M)?(O.window.set(S.subarray(h-l,h),0),O.wnext=l,O.whave=O.wsize):(O.wnext+=M,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=M))),0};m.exports.inflateReset=o,m.exports.inflateReset2=s,m.exports.inflateResetKeep=y,m.exports.inflateInit=m=>v(m,15),m.exports.inflateInit2=v,m.exports.inflate=(m,S)=>{let h,R,y,o,s,v,T,X,g,a,x,P,d,J,N,j,K,c,f,p,k,r,z=0;const Q=new Uint8Array(4);let F,w;const t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!m||!m.state||!m.output||!m.input&&0!==m.avail_in)return C;h=m.state,h.mode===L&&(h.mode=13),s=m.next_out,y=m.output,T=m.avail_out,o=m.next_in,R=m.input,v=m.avail_in,X=h.hold,g=h.bits,a=v,x=T,r=V;m:for(;;)switch(h.mode){case 1:if(0===h.wrap){h.mode=13;break}for(;g<16;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(2&h.wrap&&35615===X){h.check=0,Q[0]=255&X,Q[1]=X>>>8&255,h.check=M(h.check,Q,2,0),X=0,g=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&X)<<8)+(X>>8))%31){m.ZS="incorrect header check",h.mode=U;break}if((15&X)!==n){m.ZS="unknown compression method",h.mode=U;break}if(X>>>=4,g-=4,k=8+(15&X),0===h.wbits)h.wbits=k;else if(k>h.wbits){m.ZS="invalid window size",h.mode=U;break}h.dmax=1<<h.wbits,m.adler=h.check=1,h.mode=512&X?10:L,X=0,g=0;break;case 2:for(;g<16;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(h.flags=X,(255&h.flags)!==n){m.ZS="unknown compression method",h.mode=U;break}if(57344&h.flags){m.ZS="unknown header flags set",h.mode=U;break}h.head&&(h.head.text=X>>8&1),512&h.flags&&(Q[0]=255&X,Q[1]=X>>>8&255,h.check=M(h.check,Q,2,0)),X=0,g=0,h.mode=3;case 3:for(;g<32;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}h.head&&(h.head.time=X),512&h.flags&&(Q[0]=255&X,Q[1]=X>>>8&255,Q[2]=X>>>16&255,Q[3]=X>>>24&255,h.check=M(h.check,Q,4,0)),X=0,g=0,h.mode=4;case 4:for(;g<16;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}h.head&&(h.head.xflags=255&X,h.head.os=X>>8),512&h.flags&&(Q[0]=255&X,Q[1]=X>>>8&255,h.check=M(h.check,Q,2,0)),X=0,g=0,h.mode=5;case 5:if(1024&h.flags){for(;g<16;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}h.length=X,h.head&&(h.head.extra_len=X),512&h.flags&&(Q[0]=255&X,Q[1]=X>>>8&255,h.check=M(h.check,Q,2,0)),X=0,g=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(P=h.length,P>v&&(P=v),P&&(h.head&&(k=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Uint8Array(h.head.extra_len)),h.head.extra.set(R.subarray(o,o+P),k)),512&h.flags&&(h.check=M(h.check,R,P,o)),v-=P,o+=P,h.length-=P),h.length))break m;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(0===v)break m;P=0;do{k=R[o+P++],h.head&&k&&h.length<65536&&(h.head.name+=String.fromCharCode(k))}while(k&&P<v);if(512&h.flags&&(h.check=M(h.check,R,P,o)),v-=P,o+=P,k)break m}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(0===v)break m;P=0;do{k=R[o+P++],h.head&&k&&h.length<65536&&(h.head.comment+=String.fromCharCode(k))}while(k&&P<v);if(512&h.flags&&(h.check=M(h.check,R,P,o)),v-=P,o+=P,k)break m}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;g<16;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(X!==(65535&h.check)){m.ZS="header crc mismatch",h.mode=U;break}X=0,g=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),m.adler=h.check=0,h.mode=L;break;case 10:for(;g<32;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}m.adler=h.check=H(X),X=0,g=0,h.mode=11;case 11:if(0===h.havedict)return m.next_out=s,m.avail_out=T,m.next_in=o,m.avail_in=v,h.hold=X,h.bits=g,Z;m.adler=h.check=1,h.mode=L;case L:if(S===q||S===Y)break m;case 13:if(h.last){X>>>=7&g,g-=7&g,h.mode=27;break}for(;g<3;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}switch(h.last=1&X,X>>>=1,g-=1,3&X){case 0:h.mode=14;break;case 1:if(G(h),h.mode=20,S===Y){X>>>=2,g-=2;break m}break;case 2:h.mode=17;break;case 3:m.ZS="invalid block type",h.mode=U}X>>>=2,g-=2;break;case 14:for(X>>>=7&g,g-=7&g;g<32;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if((65535&X)!==(X>>>16^65535)){m.ZS="invalid stored block lengths",h.mode=U;break}if(h.length=65535&X,X=0,g=0,h.mode=15,S===Y)break m;case 15:h.mode=16;case 16:if(P=h.length,P){if(P>v&&(P=v),P>T&&(P=T),0===P)break m;y.set(R.subarray(o,o+P),s),v-=P,o+=P,T-=P,s+=P,h.length-=P;break}h.mode=L;break;case 17:for(;g<14;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(h.nlen=257+(31&X),X>>>=5,g-=5,h.ndist=1+(31&X),X>>>=5,g-=5,h.ncode=4+(15&X),X>>>=4,g-=4,h.nlen>286||h.ndist>30){m.ZS="too many length or distance symbols",h.mode=U;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;g<3;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}h.lens[t[h.have++]]=7&X,X>>>=3,g-=3}for(;h.have<19;)h.lens[t[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,F={bits:h.lenbits},r=u(0,h.lens,0,19,h.lencode,0,h.work,F),h.lenbits=F.bits,r){m.ZS="invalid code lengths set",h.mode=U;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;z=h.lencode[X&(1<<h.lenbits)-1],N=z>>>24,j=z>>>16&255,K=65535&z,!(N<=g);){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(K<16)X>>>=N,g-=N,h.lens[h.have++]=K;else{if(16===K){for(w=N+2;g<w;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(X>>>=N,g-=N,0===h.have){m.ZS="invalid bit length repeat",h.mode=U;break}k=h.lens[h.have-1],P=3+(3&X),X>>>=2,g-=2}else if(17===K){for(w=N+3;g<w;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}X>>>=N,g-=N,k=0,P=3+(7&X),X>>>=3,g-=3}else{for(w=N+7;g<w;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}X>>>=N,g-=N,k=0,P=11+(127&X),X>>>=7,g-=7}if(h.have+P>h.nlen+h.ndist){m.ZS="invalid bit length repeat",h.mode=U;break}for(;P--;)h.lens[h.have++]=k}}if(h.mode===U)break;if(0===h.lens[256]){m.ZS="invalid code -- missing end-of-block",h.mode=U;break}if(h.lenbits=9,F={bits:h.lenbits},r=u(1,h.lens,0,h.nlen,h.lencode,0,h.work,F),h.lenbits=F.bits,r){m.ZS="invalid literal/lengths set",h.mode=U;break}if(h.distbits=6,h.distcode=h.distdyn,F={bits:h.distbits},r=u(2,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,F),h.distbits=F.bits,r){m.ZS="invalid distances set",h.mode=U;break}if(h.mode=20,S===Y)break m;case 20:h.mode=21;case 21:if(v>=6&&T>=258){m.next_out=s,m.avail_out=T,m.next_in=o,m.avail_in=v,h.hold=X,h.bits=g,O(m,x),s=m.next_out,y=m.output,T=m.avail_out,o=m.next_in,R=m.input,v=m.avail_in,X=h.hold,g=h.bits,h.mode===L&&(h.back=-1);break}for(h.back=0;z=h.lencode[X&(1<<h.lenbits)-1],N=z>>>24,j=z>>>16&255,K=65535&z,!(N<=g);){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(j&&0===(240&j)){for(c=N,f=j,p=K;z=h.lencode[p+((X&(1<<c+f)-1)>>c)],N=z>>>24,j=z>>>16&255,K=65535&z,!(c+N<=g);){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}X>>>=c,g-=c,h.back+=c}if(X>>>=N,g-=N,h.back+=N,h.length=K,0===j){h.mode=26;break}if(32&j){h.back=-1,h.mode=L;break}if(64&j){m.ZS="invalid literal/length code",h.mode=U;break}h.extra=15&j,h.mode=22;case 22:if(h.extra){for(w=h.extra;g<w;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}h.length+=X&(1<<h.extra)-1,X>>>=h.extra,g-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;z=h.distcode[X&(1<<h.distbits)-1],N=z>>>24,j=z>>>16&255,K=65535&z,!(N<=g);){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(0===(240&j)){for(c=N,f=j,p=K;z=h.distcode[p+((X&(1<<c+f)-1)>>c)],N=z>>>24,j=z>>>16&255,K=65535&z,!(c+N<=g);){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}X>>>=c,g-=c,h.back+=c}if(X>>>=N,g-=N,h.back+=N,64&j){m.ZS="invalid distance code",h.mode=U;break}h.offset=K,h.extra=15&j,h.mode=24;case 24:if(h.extra){for(w=h.extra;g<w;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}h.offset+=X&(1<<h.extra)-1,X>>>=h.extra,g-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){m.ZS="invalid distance too far back",h.mode=U;break}h.mode=25;case 25:if(0===T)break m;if(P=x-T,h.offset>P){if(P=h.offset-P,P>h.whave&&h.sane){m.ZS="invalid distance too far back",h.mode=U;break}P>h.wnext?(P-=h.wnext,d=h.wsize-P):d=h.wnext-P,P>h.length&&(P=h.length),J=h.window}else J=y,d=s-h.offset,P=h.length;P>T&&(P=T),T-=P,h.length-=P;do{y[s++]=J[d++]}while(--P);0===h.length&&(h.mode=21);break;case 26:if(0===T)break m;y[s++]=h.length,T--,h.mode=21;break;case 27:if(h.wrap){for(;g<32;){if(0===v)break m;v--,X|=R[o++]<<g,g+=8}if(x-=T,m.total_out+=x,h.total+=x,x&&(m.adler=h.check=h.flags?M(h.check,y,x,s-x):l(h.check,y,x,s-x)),x=T,(h.flags?X:H(X))!==h.check){m.ZS="incorrect data check",h.mode=U;break}X=0,g=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;g<32;){if(0===v)break m;v--,X+=R[o++]<<g,g+=8}if(X!==(4294967295&h.total)){m.ZS="incorrect length check",h.mode=U;break}X=0,g=0}h.mode=29;case 29:r=I;break m;case U:r=B;break m;case 31:return D;default:return C}return m.next_out=s,m.avail_out=T,m.next_in=o,m.avail_in=v,h.hold=X,h.bits=g,(h.wsize||x!==m.avail_out&&h.mode<U&&(h.mode<27||S!==b))&&e(m,m.output,m.next_out,x-m.avail_out)?(h.mode=31,D):(a-=m.avail_in,x-=m.avail_out,m.total_in+=a,m.total_out+=x,h.total+=x,h.wrap&&x&&(m.adler=h.check=h.flags?M(h.check,y,x,m.next_out-x):l(h.check,y,x,m.next_out-x)),m.data_type=h.bits+(h.last?64:0)+(h.mode===L?128:0)+(20===h.mode||15===h.mode?256:0),(0===a&&0===x||S===b)&&r===V&&(r=E),r)},m.exports.inflateEnd=m=>{if(!m||!m.state)return C;let S=m.state;return S.window&&(S.window=null),m.state=null,V},m.exports.inflateGetHeader=(m,S)=>{if(!m||!m.state)return C;const h=m.state;return 0===(2&h.wrap)?C:(h.head=S,S.done=!1,V)},m.exports.inflateSetDictionary=(m,S)=>{const h=S.length;let M,O,u;return m&&m.state?(M=m.state,0!==M.wrap&&11!==M.mode?C:11===M.mode&&(O=1,O=l(O,S,h,0),O!==M.check)?B:(u=e(m,S,h,h),u?(M.mode=31,D):(M.havedict=1,V))):C},m.exports.inflateInfo="pako inflate (from Nodeca project)"},12545:m=>{"use strict";const S=15,h=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),M=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),O=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);m.exports=(m,u,b,q,Y,V,I,Z)=>{const C=Z.bits;let B,D,E,n,L,U,H=0,R=0,y=0,o=0,s=0,v=0,T=0,X=0,g=0,G=0,e=null,a=0;const x=new Uint16Array(16),P=new Uint16Array(16);let d,J,N,j=null,K=0;for(H=0;H<=S;H++)x[H]=0;for(R=0;R<q;R++)x[u[b+R]]++;for(s=C,o=S;o>=1&&0===x[o];o--);if(s>o&&(s=o),0===o)return Y[V++]=20971520,Y[V++]=20971520,Z.bits=1,0;for(y=1;y<o&&0===x[y];y++);for(s<y&&(s=y),X=1,H=1;H<=S;H++)if(X<<=1,X-=x[H],X<0)return-1;if(X>0&&(0===m||1!==o))return-1;for(P[1]=0,H=1;H<S;H++)P[H+1]=P[H]+x[H];for(R=0;R<q;R++)0!==u[b+R]&&(I[P[u[b+R]]++]=R);if(0===m?(e=j=I,U=19):1===m?(e=h,a-=257,j=l,K-=257,U=256):(e=M,j=O,U=-1),G=0,R=0,H=y,L=V,v=s,T=0,E=-1,g=1<<s,n=g-1,1===m&&g>852||2===m&&g>592)return 1;for(;;){d=H-T,I[R]<U?(J=0,N=I[R]):I[R]>U?(J=j[K+I[R]],N=e[a+I[R]]):(J=96,N=0),B=1<<H-T,D=1<<v,y=D;do{D-=B,Y[L+(G>>T)+D]=d<<24|J<<16|N}while(0!==D);for(B=1<<H-1;G&B;)B>>=1;if(0!==B?(G&=B-1,G+=B):G=0,R++,0===--x[H]){if(H===o)break;H=u[b+I[R]]}if(H>s&&(G&n)!==E){for(0===T&&(T=s),L+=y,v=H-T,X=1<<v;v+T<o&&(X-=x[v+T],!(X<=0));)v++,X<<=1;if(g+=1<<v,1===m&&g>852||2===m&&g>592)return 1;E=G&n,Y[E]=s<<24|v<<16|L-V}}return 0!==G&&(Y[L+G]=H-T<<24|64<<16),Z.bits=s,0}},12489:m=>{"use strict";m.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12474:m=>{"use strict";function S(m){let S=m.length;for(;--S>=0;)m[S]=0}const h=256,l=286,M=30,O=15,u=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),b=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),q=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=new Array(576);S(V);const I=new Array(60);S(I);const Z=new Array(512);S(Z);const C=new Array(256);S(C);const B=new Array(29);S(B);const D=new Array(M);function E(m,S,h,l,M){this.static_tree=m,this.extra_bits=S,this.extra_base=h,this.elems=l,this.max_length=M,this.has_stree=m&&m.length}let n,L,U;function H(m,S){this.dyn_tree=m,this.max_code=0,this.stat_desc=S}S(D);const R=m=>m<256?Z[m]:Z[256+(m>>>7)],y=(m,S)=>{m.pending_buf[m.pending++]=255&S,m.pending_buf[m.pending++]=S>>>8&255},o=(m,S,h)=>{m.bi_valid>16-h?(m.bi_buf|=S<<m.bi_valid&65535,y(m,m.bi_buf),m.bi_buf=S>>16-m.bi_valid,m.bi_valid+=h-16):(m.bi_buf|=S<<m.bi_valid&65535,m.bi_valid+=h)},s=(m,S,h)=>{o(m,h[2*S],h[2*S+1])},v=(m,S)=>{let h=0;do{h|=1&m,m>>>=1,h<<=1}while(--S>0);return h>>>1},T=(m,S,h)=>{const l=new Array(16);let M,u,b=0;for(M=1;M<=O;M++)l[M]=b=b+h[M-1]<<1;for(u=0;u<=S;u++){let S=m[2*u+1];0!==S&&(m[2*u]=v(l[S]++,S))}},X=m=>{let S;for(S=0;S<l;S++)m.dyn_ltree[2*S]=0;for(S=0;S<M;S++)m.dyn_dtree[2*S]=0;for(S=0;S<19;S++)m.bl_tree[2*S]=0;m.dyn_ltree[512]=1,m.opt_len=m.static_len=0,m.last_lit=m.matches=0},g=m=>{m.bi_valid>8?y(m,m.bi_buf):m.bi_valid>0&&(m.pending_buf[m.pending++]=m.bi_buf),m.bi_buf=0,m.bi_valid=0},G=(m,S,h,l)=>{const M=2*S,O=2*h;return m[M]<m[O]||m[M]===m[O]&&l[S]<=l[h]},e=(m,S,h)=>{const l=m.heap[h];let M=h<<1;for(;M<=m.heap_len&&(M<m.heap_len&&G(S,m.heap[M+1],m.heap[M],m.depth)&&M++,!G(S,l,m.heap[M],m.depth));)m.heap[h]=m.heap[M],h=M,M<<=1;m.heap[h]=l},a=(m,S,l)=>{let M,O,q,Y,V=0;if(0!==m.last_lit)do{M=m.pending_buf[m.d_buf+2*V]<<8|m.pending_buf[m.d_buf+2*V+1],O=m.pending_buf[m.l_buf+V],V++,0===M?s(m,O,S):(q=C[O],s(m,q+h+1,S),Y=u[q],0!==Y&&(O-=B[q],o(m,O,Y)),M--,q=R(M),s(m,q,l),Y=b[q],0!==Y&&(M-=D[q],o(m,M,Y)))}while(V<m.last_lit);s(m,256,S)},x=(m,S)=>{const h=S.dyn_tree,l=S.stat_desc.static_tree,M=S.stat_desc.has_stree,u=S.stat_desc.elems;let b,q,Y,V=-1;for(m.heap_len=0,m.heap_max=573,b=0;b<u;b++)0!==h[2*b]?(m.heap[++m.heap_len]=V=b,m.depth[b]=0):h[2*b+1]=0;for(;m.heap_len<2;)Y=m.heap[++m.heap_len]=V<2?++V:0,h[2*Y]=1,m.depth[Y]=0,m.opt_len--,M&&(m.static_len-=l[2*Y+1]);for(S.max_code=V,b=m.heap_len>>1;b>=1;b--)e(m,h,b);Y=u;do{b=m.heap[1],m.heap[1]=m.heap[m.heap_len--],e(m,h,1),q=m.heap[1],m.heap[--m.heap_max]=b,m.heap[--m.heap_max]=q,h[2*Y]=h[2*b]+h[2*q],m.depth[Y]=(m.depth[b]>=m.depth[q]?m.depth[b]:m.depth[q])+1,h[2*b+1]=h[2*q+1]=Y,m.heap[1]=Y++,e(m,h,1)}while(m.heap_len>=2);m.heap[--m.heap_max]=m.heap[1],((m,S)=>{const h=S.dyn_tree,l=S.max_code,M=S.stat_desc.static_tree,u=S.stat_desc.has_stree,b=S.stat_desc.extra_bits,q=S.stat_desc.extra_base,Y=S.stat_desc.max_length;let V,I,Z,C,B,D,E=0;for(C=0;C<=O;C++)m.bl_count[C]=0;for(h[2*m.heap[m.heap_max]+1]=0,V=m.heap_max+1;V<573;V++)I=m.heap[V],C=h[2*h[2*I+1]+1]+1,C>Y&&(C=Y,E++),h[2*I+1]=C,I>l||(m.bl_count[C]++,B=0,I>=q&&(B=b[I-q]),D=h[2*I],m.opt_len+=D*(C+B),u&&(m.static_len+=D*(M[2*I+1]+B)));if(0!==E){do{for(C=Y-1;0===m.bl_count[C];)C--;m.bl_count[C]--,m.bl_count[C+1]+=2,m.bl_count[Y]--,E-=2}while(E>0);for(C=Y;0!==C;C--)for(I=m.bl_count[C];0!==I;)Z=m.heap[--V],Z>l||(h[2*Z+1]!==C&&(m.opt_len+=(C-h[2*Z+1])*h[2*Z],h[2*Z+1]=C),I--)}})(m,S),T(h,V,m.bl_count)},P=(m,S,h)=>{let l,M,O=-1,u=S[1],b=0,q=7,Y=4;for(0===u&&(q=138,Y=3),S[2*(h+1)+1]=65535,l=0;l<=h;l++)M=u,u=S[2*(l+1)+1],++b<q&&M===u||(b<Y?m.bl_tree[2*M]+=b:0!==M?(M!==O&&m.bl_tree[2*M]++,m.bl_tree[32]++):b<=10?m.bl_tree[34]++:m.bl_tree[36]++,b=0,O=M,0===u?(q=138,Y=3):M===u?(q=6,Y=3):(q=7,Y=4))},d=(m,S,h)=>{let l,M,O=-1,u=S[1],b=0,q=7,Y=4;for(0===u&&(q=138,Y=3),l=0;l<=h;l++)if(M=u,u=S[2*(l+1)+1],!(++b<q&&M===u)){if(b<Y)do{s(m,M,m.bl_tree)}while(0!==--b);else 0!==M?(M!==O&&(s(m,M,m.bl_tree),b--),s(m,16,m.bl_tree),o(m,b-3,2)):b<=10?(s(m,17,m.bl_tree),o(m,b-3,3)):(s(m,18,m.bl_tree),o(m,b-11,7));b=0,O=M,0===u?(q=138,Y=3):M===u?(q=6,Y=3):(q=7,Y=4)}};let J=!1;const N=(m,S,h,l)=>{o(m,0+(l?1:0),3),((m,S,h,l)=>{g(m),l&&(y(m,h),y(m,~h)),m.pending_buf.set(m.window.subarray(S,S+h),m.pending),m.pending+=h})(m,S,h,!0)};m.exports._tr_init=m=>{J||((()=>{let m,S,h,Y,H;const R=new Array(16);for(h=0,Y=0;Y<28;Y++)for(B[Y]=h,m=0;m<1<<u[Y];m++)C[h++]=Y;for(C[h-1]=Y,H=0,Y=0;Y<16;Y++)for(D[Y]=H,m=0;m<1<<b[Y];m++)Z[H++]=Y;for(H>>=7;Y<M;Y++)for(D[Y]=H<<7,m=0;m<1<<b[Y]-7;m++)Z[256+H++]=Y;for(S=0;S<=O;S++)R[S]=0;for(m=0;m<=143;)V[2*m+1]=8,m++,R[8]++;for(;m<=255;)V[2*m+1]=9,m++,R[9]++;for(;m<=279;)V[2*m+1]=7,m++,R[7]++;for(;m<=287;)V[2*m+1]=8,m++,R[8]++;for(T(V,287,R),m=0;m<M;m++)I[2*m+1]=5,I[2*m]=v(m,5);n=new E(V,u,257,l,O),L=new E(I,b,0,M,O),U=new E(new Array(0),q,0,19,7)})(),J=!0),m.l_desc=new H(m.dyn_ltree,n),m.d_desc=new H(m.dyn_dtree,L),m.bl_desc=new H(m.bl_tree,U),m.bi_buf=0,m.bi_valid=0,X(m)},m.exports._tr_stored_block=N,m.exports._tr_flush_block=(m,S,l,M)=>{let O,u,b=0;m.level>0?(2===m.strm.data_type&&(m.strm.data_type=(m=>{let S,l=4093624447;for(S=0;S<=31;S++,l>>>=1)if(1&l&&0!==m.dyn_ltree[2*S])return 0;if(0!==m.dyn_ltree[18]||0!==m.dyn_ltree[20]||0!==m.dyn_ltree[26])return 1;for(S=32;S<h;S++)if(0!==m.dyn_ltree[2*S])return 1;return 0})(m)),x(m,m.l_desc),x(m,m.d_desc),b=(m=>{let S;for(P(m,m.dyn_ltree,m.l_desc.max_code),P(m,m.dyn_dtree,m.d_desc.max_code),x(m,m.bl_desc),S=18;S>=3&&0===m.bl_tree[2*Y[S]+1];S--);return m.opt_len+=3*(S+1)+5+5+4,S})(m),O=m.opt_len+3+7>>>3,u=m.static_len+3+7>>>3,u<=O&&(O=u)):O=u=l+5,l+4<=O&&-1!==S?N(m,S,l,M):4===m.strategy||u===O?(o(m,2+(M?1:0),3),a(m,V,I)):(o(m,4+(M?1:0),3),((m,S,h,l)=>{let M;for(o(m,S-257,5),o(m,h-1,5),o(m,l-4,4),M=0;M<l;M++)o(m,m.bl_tree[2*Y[M]+1],3);d(m,m.dyn_ltree,S-1),d(m,m.dyn_dtree,h-1)})(m,m.l_desc.max_code+1,m.d_desc.max_code+1,b+1),a(m,m.dyn_ltree,m.dyn_dtree)),X(m),M&&g(m)},m.exports._tr_tally=(m,S,l)=>(m.pending_buf[m.d_buf+2*m.last_lit]=S>>>8&255,m.pending_buf[m.d_buf+2*m.last_lit+1]=255&S,m.pending_buf[m.l_buf+m.last_lit]=255&l,m.last_lit++,0===S?m.dyn_ltree[2*l]++:(m.matches++,S--,m.dyn_ltree[2*(C[l]+h+1)]++,m.dyn_dtree[2*R(S)]++),m.last_lit===m.lit_bufsize-1),m.exports._tr_align=m=>{o(m,2,3),s(m,256,V),(m=>{16===m.bi_valid?(y(m,m.bi_buf),m.bi_buf=0,m.bi_valid=0):m.bi_valid>=8&&(m.pending_buf[m.pending++]=255&m.bi_buf,m.bi_buf>>=8,m.bi_valid-=8)})(m)}},12518:m=>{"use strict";m.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.ZS="",this.state=null,this.data_type=2,this.adler=0}},12151:m=>{function S(m,S,h){for(var l=m.length,M=-1/0,O=1/0,u=0;u<l;u++){var b=(h[0][u]-m[u])/S[u],q=(h[1][u]-m[u])/S[u];if(b>q){var Y=b;b=q,q=Y}if(q<M||b>O)return 1/0;b>M&&(M=b),q<O&&(O=q)}return M>O?1/0:M}m.exports=function(m,h,l,M){var O=S(h,l,M);if(O===1/0)m=null;else{m=m||[];for(var u=0;u<h.length;u++)m[u]=h[u]+l[u]*O}return m},m.exports.distance=S},13554:(m,S,h)=>{"use strict";h.d(S,{d:()=>u});var l=h(37);const M=l.useLayoutEffect;const O=function(m){var S=(0,l.useRef)(m);return M((function(){S.current=m})),S};var u=function(m){var S=O(m);(0,l.YS)((function(){var m=function(m){var h;if(null!=S.current&&(h=S.current(m)),m.defaultPrevented&&(m.returnValue=""),"string"===typeof h)return m.returnValue=h,h};return window.addEventListener("beforeunload",m),function(){window.removeEventListener("beforeunload",m)}}),[])}},13490:(m,S,h)=>{"use strict";var l=h(13496),M=Array.prototype.concat,O=Array.prototype.slice,u=m.exports=function(m){for(var S=[],h=0,u=m.length;h<u;h++){var b=m[h];l(b)?S=M.call(S,O.call(b)):S.push(b)}return S};u.wrap=function(m){return function(){return m(u(arguments))}}},13496:m=>{m.exports=function(m){return!(!m||"string"===typeof m)&&(m instanceof Array||Array.isArray(m)||m.length>=0&&(m.splice instanceof Function||Object.getOwnPropertyDescriptor(m,m.length-1)&&"String"!==m.constructor.name))}},12434:(m,S,h)=>{var l=h(12436);function M(m){for(var S,h,M=0,O=m.length,u=0;u<m.length;){for(S=m[u],h=0;u<O&&m[u]===S;)++u,++h;M+=l.log2(h)/7|0,M+=l.log2(S>>>0)/7|0,M+=2}return M}S.size=M,S.encode=function(m,S){S||(S=new Uint8Array(M(m)));for(var h,l,O=0,u=S.length,b=0;b<m.length;){for(h=m[b],l=0;b<m.length&&m[b]===h;)++b,++l;for(;O<u&&l>=128;)S[O++]=128+(127&l),l>>>=7;if(O>=u)throw new Error("RLE buffer overflow");for(S[O++]=l,h>>>=0;O<u&&h>=128;)S[O++]=128+(127&h),h>>>=7;if(O>=u)throw new Error("RLE buffer overflow");S[O++]=h}return S},S.decode=function(m,S){for(var h,l,M,O,u=S.length,b=m.length,q=0,Y=0;Y<b;){for(h=0,l=0;Y<b&&m[Y]>=128;)h+=(127&m[Y++])<<l,l+=7;if(h+=m[Y++]<<l,Y>=b)throw new Error("RLE buffer underrun");if(q+h>u)throw new Error("Chunk buffer overflow");for(M=0,l=0;Y<b&&m[Y]>=128;)M+=(127&m[Y++])<<l,l+=7;if(Y>=b)throw new Error("RLE buffer underrun");for(M+=m[Y++]<<l,O=0;O<h;++O)S[q++]=M}return S}},12436:(m,S)=>{"use strict";function h(m){var S=32;return(m&=-m)&&S--,65535&m&&(S-=16),16711935&m&&(S-=8),252645135&m&&(S-=4),858993459&m&&(S-=2),1431655765&m&&(S-=1),S}S.INT_BITS=32,S.INT_MAX=2147483647,S.INT_MIN=-1<<31,S.sign=function(m){return(m>0)-(m<0)},S.abs=function(m){var S=m>>31;return(m^S)-S},S.min=function(m,S){return S^(m^S)&-(m<S)},S.max=function(m,S){return m^(m^S)&-(m<S)},S.isPow2=function(m){return!(m&m-1)&&!!m},S.log2=function(m){var S,h;return S=(m>65535)<<4,S|=h=((m>>>=S)>255)<<3,S|=h=((m>>>=h)>15)<<2,(S|=h=((m>>>=h)>3)<<1)|(m>>>=h)>>1},S.log10=function(m){return m>=1e9?9:m>=1e8?8:m>=1e7?7:m>=1e6?6:m>=1e5?5:m>=1e4?4:m>=1e3?3:m>=100?2:m>=10?1:0},S.popCount=function(m){return 16843009*((m=(858993459&(m-=m>>>1&1431655765))+(m>>>2&858993459))+(m>>>4)&252645135)>>>24},S.countTrailingZeros=h,S.nextPow2=function(m){return m+=0===m,--m,m|=m>>>1,m|=m>>>2,m|=m>>>4,m|=m>>>8,(m|=m>>>16)+1},S.prevPow2=function(m){return m|=m>>>1,m|=m>>>2,m|=m>>>4,m|=m>>>8,(m|=m>>>16)-(m>>>1)},S.parity=function(m){return m^=m>>>16,m^=m>>>8,m^=m>>>4,27030>>>(m&=15)&1};var l=new Array(256);!function(m){for(var S=0;S<256;++S){var h=S,l=S,M=7;for(h>>>=1;h;h>>>=1)l<<=1,l|=1&h,--M;m[S]=l<<M&255}}(l),S.reverse=function(m){return l[255&m]<<24|l[m>>>8&255]<<16|l[m>>>16&255]<<8|l[m>>>24&255]},S.interleave2=function(m,S){return(m=1431655765&((m=858993459&((m=252645135&((m=16711935&((m&=65535)|m<<8))|m<<4))|m<<2))|m<<1))|(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))<<1},S.deinterleave2=function(m,S){return(m=65535&((m=16711935&((m=252645135&((m=858993459&((m=m>>>S&1431655765)|m>>>1))|m>>>2))|m>>>4))|m>>>16))<<16>>16},S.interleave3=function(m,S,h){return m=1227133513&((m=3272356035&((m=251719695&((m=4278190335&((m&=1023)|m<<16))|m<<8))|m<<4))|m<<2),(m|=(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},S.deinterleave3=function(m,S){return(m=1023&((m=4278190335&((m=251719695&((m=3272356035&((m=m>>>S&1227133513)|m>>>2))|m>>>4))|m>>>8))|m>>>16))<<22>>22},S.nextCombination=function(m){var S=m|m-1;return S+1|(~S&-~S)-1>>>h(m)+1}},12457:m=>{"use strict";m.exports=function(m,S,h,l){var M=self||window;try{try{var O;try{O=new M.Blob([m])}catch(Y){(O=new(M.BlobBuilder||M.WebKitBlobBuilder||M.MozBlobBuilder||M.MSBlobBuilder)).append(m),O=O.getBlob()}var u=M.URL||M.webkitURL,b=u.createObjectURL(O),q=new M[S](b,h);return u.revokeObjectURL(b),q}catch(Y){return new M[S]("data:application/javascript,".concat(encodeURIComponent(m)),h)}}catch(Y){if(!l)throw Error("Inline worker is not supported");return new M[S](l,h)}}},12128:(m,S,h)=>{"use strict";function l(m,S,h,l,M){var O={};return Object.keys(l).forEach((function(m){O[m]=l[m]})),O.enumerable=!!O.enumerable,O.configurable=!!O.configurable,("value"in O||O.initializer)&&(O.writable=!0),O=h.slice().reverse().reduce((function(h,l){return l(m,S,h)||h}),O),M&&void 0!==O.initializer&&(O.value=O.initializer?O.initializer.call(M):void 0,O.initializer=void 0),void 0===O.initializer&&(Object.defineProperty(m,S,O),O=null),O}h.d(S,{b:()=>l})},12123:(m,S,h)=>{"use strict";function l(m,S,h,l){h&&Object.defineProperty(m,S,{enumerable:h.enumerable,configurable:h.configurable,writable:h.writable,value:h.initializer?h.initializer.call(l):void 0})}h.d(S,{c:()=>l})},13540:(m,S,h)=>{"use strict";h.d(S,{e:()=>u,f:()=>I,h:()=>b,j:()=>O,m:()=>q,q:()=>M,r:()=>Y,u:()=>V});var l=h(11541);class M{constructor(){this._easingMode=M.EASINGMODE_EASEIN}setEasingMode(m){const S=Math.min(Math.max(m,0),2);this._easingMode=S}getEasingMode(){return this._easingMode}easeInCore(m){throw new Error("You must implement this method")}ease(m){switch(this._easingMode){case M.EASINGMODE_EASEIN:return this.easeInCore(m);case M.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-m)}return m>=.5?.5*(1-this.easeInCore(2*(1-m)))+.5:.5*this.easeInCore(2*m)}}M.EASINGMODE_EASEIN=0,M.EASINGMODE_EASEOUT=1,M.EASINGMODE_EASEINOUT=2;class O extends M{easeInCore(m){return m=Math.max(0,Math.min(1,m)),1-Math.sqrt(1-m*m)}}class u extends M{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=m}easeInCore(m){const S=Math.max(0,this.amplitude);return Math.pow(m,3)-m*S*Math.sin(3.141592653589793*m)}}class b extends M{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=m,this.bounciness=S}easeInCore(m){const S=Math.max(0,this.bounces);let h=this.bounciness;h<=1&&(h=1.001);const l=Math.pow(h,S),M=1-h,O=(1-l)/M+.5*l,u=m*O,b=Math.log(-u*(1-h)+1)/Math.log(h),q=Math.floor(b),Y=q+1,V=(1-Math.pow(h,q))/(M*O),I=.5*(V+(1-Math.pow(h,Y))/(M*O)),Z=m-I,C=I-V;return-Math.pow(1/h,S-q)/(C*C)*(Z-C)*(Z+C)}}class q extends M{easeInCore(m){return m*m*m}}class Y extends M{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=m,this.springiness=S}easeInCore(m){let S;const h=Math.max(0,this.oscillations),l=Math.max(0,this.springiness);return S=0==l?m:(Math.exp(l*m)-1)/(Math.exp(l)-1),S*Math.sin((6.283185307179586*h+1.5707963267948966)*m)}}class V extends M{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=m}easeInCore(m){return this.exponent<=0?m:(Math.exp(this.exponent*m)-1)/(Math.exp(this.exponent)-1)}}class I extends M{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=m,this.y1=S,this.x2=h,this.y2=l}easeInCore(m){return l.c.Interpolate(m,this.x1,this.y1,this.x2,this.y2)}}},12981:(m,S,h)=>{"use strict";h.d(S,{d:()=>u});var l=h(11347),M=h(11356),O=h(11718);class u extends O.e{get _matrix(){return this._compose(),this.kZ}set _matrix(m){(m.updateFlag!==this.kZ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.kZ.l(m),this._markAsDirtyAndDecompose())}constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(m,S.sm(),!1),this.name=m,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=S,this.kZ=(null===M||void 0===M?void 0:M.clone())??l.Matrix.Identity(),this._restMatrix=O??this.kZ.clone(),this._bindMatrix=u??this.kZ.clone(),this._index=b,this._absoluteMatrix=new l.Matrix,this._absoluteBindMatrix=new l.Matrix,this._absoluteInverseBindMatrix=new l.Matrix,this._finalMatrix=new l.Matrix,S.bones.push(this),this.setParent(h,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(m){this.setParent(m)}setParent(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==m){if(this.parent){const m=this.parent.children.indexOf(this);-1!==m&&this.parent.children.splice(m,1)}this._parentNode=m,this.parent&&this.parent.children.push(this),S&&this._updateAbsoluteBindMatrices(),this.ZV()}}getLocalMatrix(){return this._compose(),this.kZ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(m){this._restMatrix.l(m)}setRestPose(m){this.setRestMatrix(m)}getBindPose(){return this.getBindMatrix()}setBindMatrix(m){this.lb(m)}setBindPose(m){this.setBindMatrix(m)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const m=l.TmpVectors.nS[0],S=l.TmpVectors.Quaternion[0],h=l.TmpVectors.nS[1];this.getRestMatrix().decompose(m,S,h),this._linkedTransformNode.position.l(h),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??l.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.l(S),this._linkedTransformNode.Ib.l(m)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(m){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=m,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Eq}set position(m){this._decompose(),this.Eq.l(m),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(m){this.setRotation(m)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(m){this.setRotationQuaternion(m)}get Ib(){return this.getScale()}set Ib(m){this.setScale(m)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=l.nS.Zero(),this._localRotation=l.Quaternion.Zero(),this.Eq=l.nS.Zero()),this.kZ.decompose(this._localScaling,this._localRotation,this.Eq))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,l.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Eq,this.kZ)):this._needToCompose=!1)}lb(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.l(m),S&&this._updateAbsoluteBindMatrices(),h?this._matrix=m:this.ZV()}_updateAbsoluteBindMatrices(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(m||(m=this._bindMatrix),this.parent?m.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.l(m),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),S)for(let h=0;h<this.children.length;h++)this.children[h]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ZV(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ZV(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ZV(),this._needToDecompose=!0}_updatePosition(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const O=this.getLocalMatrix();if(0==S)M?(O.addAtIndex(12,m.x),O.addAtIndex(13,m.y),O.addAtIndex(14,m.z)):O.setTranslationFromFloats(m.x,m.y,m.z);else{let S=null;h&&(S=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=u._TmpMats[0],q=u._TmpVecs[0];this.parent?h&&S?(b.l(this.parent.getAbsoluteMatrix()),b.multiplyToRef(S,b)):b.l(this.parent.getAbsoluteMatrix()):l.Matrix.IdentityToRef(b),M&&b.setTranslationFromFloats(0,0,0),b.invert(),l.nS.TransformCoordinatesToRef(m,b,q),M?(O.addAtIndex(12,q.x),O.addAtIndex(13,q.y),O.addAtIndex(14,q.z)):O.setTranslationFromFloats(q.x,q.y,q.z)}this._markAsDirtyAndDecompose()}translate(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(m,S,h,!0)}setPosition(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(m,S,h,!1)}setAbsolutePosition(m,S){this.setPosition(m,1,S)}scale(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const O=this.getLocalMatrix(),b=u._TmpMats[0];l.Matrix.ScalingToRef(m,S,h,b),b.multiplyToRef(O,O),b.invert();for(const l of this.children){const M=l.getLocalMatrix();M.multiplyToRef(b,M),M.multiplyAtIndex(12,m),M.multiplyAtIndex(13,S),M.multiplyAtIndex(14,h),l._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),M)for(const l of this.children)l.scale(m,S,h,M)}setScale(m){this._decompose(),this._localScaling.l(m),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(m){this._decompose(),m.l(this._localScaling)}setYawPitchRoll(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4?arguments[4]:void 0;if(0===M){const b=u._TmpQuat;return l.Quaternion.RotationYawPitchRollToRef(m,S,h,b),void this.setRotationQuaternion(b,M,O)}const b=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,O))return;const q=u._TmpMats[1];l.Matrix.RotationYawPitchRollToRef(m,S,h,q),b.multiplyToRef(q,q),this._rotateWithMatrix(q,M,O)}rotate(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,M=arguments.length>3?arguments[3]:void 0;const O=u._TmpMats[0];O.setTranslationFromFloats(0,0,0),l.Matrix.RotationAxisToRef(m,S,O),this._rotateWithMatrix(O,h,M)}setAxisAngle(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,M=arguments.length>3?arguments[3]:void 0;if(0===h){const O=u._TmpQuat;return l.Quaternion.RotationAxisToRef(m,S,O),void this.setRotationQuaternion(O,h,M)}const O=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,M))return;const b=u._TmpMats[1];l.Matrix.RotationAxisToRef(m,S,b),O.multiplyToRef(b,b),this._rotateWithMatrix(b,h,M)}setRotation(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(m.y,m.x,m.z,S,h)}setRotationQuaternion(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===S)return this._decompose(),this._localRotation.l(m),void this._markAsDirtyAndCompose();const M=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(M,h))return;const O=u._TmpMats[1];l.Matrix.FromQuaternionToRef(m,O),M.multiplyToRef(O,O),this._rotateWithMatrix(O,S,h)}setRotationMatrix(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===S){const M=u._TmpQuat;return l.Quaternion.FromRotationMatrixToRef(m,M),void this.setRotationQuaternion(M,S,h)}const M=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(M,h))return;const O=u._TmpMats[1];O.l(m),M.multiplyToRef(m,O),this._rotateWithMatrix(O,S,h)}_rotateWithMatrix(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const l=this.getLocalMatrix(),M=l.m[12],O=l.m[13],b=l.m[14],q=this.getParent(),Y=u._TmpMats[3],V=u._TmpMats[4];q&&1==S?(h?(Y.l(h.getWorldMatrix()),q.getAbsoluteMatrix().multiplyToRef(Y,Y)):Y.l(q.getAbsoluteMatrix()),V.l(Y),V.invert(),l.multiplyToRef(Y,l),l.multiplyToRef(m,l),l.multiplyToRef(V,l)):1==S&&h?(Y.l(h.getWorldMatrix()),V.l(Y),V.invert(),l.multiplyToRef(Y,l),l.multiplyToRef(m,l),l.multiplyToRef(V,l)):l.multiplyToRef(m,l),l.setTranslationFromFloats(M,O,b),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(m,S){const h=u._TmpMats[2];return m.l(this.getAbsoluteMatrix()),S?(m.multiplyToRef(S.getWorldMatrix(),m),l.Matrix.ScalingToRef(S.Ib.x,S.Ib.y,S.Ib.z,h)):l.Matrix.IdentityToRef(h),m.invert(),!isNaN(m.m[0])&&(h.multiplyAtIndex(0,this._scalingDeterminant),m.multiplyToRef(h,m),!0)}Ih(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=l.nS.Zero();return this.getPositionToRef(m,S,h),h}getPositionToRef(){let m=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const m=this.getLocalMatrix();S.x=m.m[12],S.y=m.m[13],S.z=m.m[14]}else{let h=null;m&&(h=m.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let l=u._TmpMats[0];m&&h?(l.l(this.getAbsoluteMatrix()),l.multiplyToRef(h,l)):l=this.getAbsoluteMatrix(),S.x=l.m[12],S.y=l.m[13],S.z=l.m[14]}}getAbsolutePosition(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const S=l.nS.Zero();return this.getPositionToRef(1,m,S),S}getAbsolutePositionToRef(m,S){this.getPositionToRef(1,m,S)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.kZ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.l(this.kZ);const m=this._skeleton.getPoseMatrix();m&&this._absoluteMatrix.multiplyToRef(m,this._absoluteMatrix)}const m=this.children,S=m.length;for(let h=0;h<S;h++)m[h].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}rq(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=l.nS.Zero();return this.getDirectionToRef(m,S,h),h}getDirectionToRef(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,M=null;S&&(M=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=u._TmpMats[0];O.l(this.getAbsoluteMatrix()),S&&M&&O.multiplyToRef(M,O),l.nS.TransformNormalToRef(m,O,h),h.normalize()}getRotation(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=l.nS.Zero();return this.getRotationToRef(m,S,h),h}getRotationToRef(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;const l=u._TmpQuat;this.getRotationQuaternionToRef(m,S,l),l.toEulerAnglesToRef(h)}getRotationQuaternion(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=l.Quaternion.Identity();return this.getRotationQuaternionToRef(m,S,h),h}getRotationQuaternionToRef(){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),S.l(this._localRotation);else{const h=u._TmpMats[0],l=this.getAbsoluteMatrix();m?l.multiplyToRef(m.getWorldMatrix(),h):h.l(l),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.decompose(void 0,S,void 0)}}getRotationMatrix(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1?arguments[1]:void 0;const h=l.Matrix.Identity();return this.getRotationMatrixToRef(m,S,h),h}getRotationMatrixToRef(){let m=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(S);else{const h=u._TmpMats[0],l=this.getAbsoluteMatrix();m?l.multiplyToRef(m.getWorldMatrix(),h):h.l(l),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.getRotationMatrixToRef(S)}}getAbsolutePositionFromLocal(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=l.nS.Zero();return this.getAbsolutePositionFromLocalToRef(m,S,h),h}getAbsolutePositionFromLocalToRef(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,M=null;S&&(M=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=u._TmpMats[0];O.l(this.getAbsoluteMatrix()),S&&M&&O.multiplyToRef(M,O),l.nS.TransformCoordinatesToRef(m,O,h)}getLocalPositionFromAbsolute(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=l.nS.Zero();return this.getLocalPositionFromAbsoluteToRef(m,S,h),h}getLocalPositionFromAbsoluteToRef(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,M=null;S&&(M=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=u._TmpMats[0];O.l(this.getAbsoluteMatrix()),S&&M&&O.multiplyToRef(M,O),O.invert(),l.nS.TransformCoordinatesToRef(m,O,h)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const m=this._skeleton.bones.indexOf(this);if(-1!==m&&this._skeleton.bones.splice(m,1),this._parentNode&&this._parentNode.children){const m=this._parentNode.children,S=m.indexOf(this);-1!==S&&m.splice(S,1)}super.dispose()}}u._TmpVecs=(0,M.e)(2,l.nS.Zero),u._TmpQuat=l.Quaternion.Identity(),u._TmpMats=(0,M.e)(5,l.Matrix.Identity)},13531:(m,S,h)=>{"use strict";h.d(S,{b:()=>x});var l=h(11327),M=h(11336),O=h(11161),u=h(11347),b=h(11359),q=h(11718),Y=h(11751),V=h(11592),I=h(11183),Z=h(11350);class C{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(m){this._zoomStopsAnimation=m}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(m){this._idleRotationSpeed=m}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(m){this._idleRotationWaitTime=m}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(m){this._idleRotationSpinupTime=m}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(m){this._attachedCamera=m;const S=this._attachedCamera.sm();this._onPrePointerObservableObserver=S.onPrePointerObservable.add((m=>{m.type!==V.b.POINTERDOWN?m.type===V.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=m.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const m=I.b.Now;let S=0;null!=this._lastFrameTime&&(S=m-this._lastFrameTime),this._lastFrameTime=m,this._applyUserInteraction();const h=m-this._lastInteractionTime-this._idleRotationWaitTime,l=Math.max(Math.min(h/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*l,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(S/1e3))}))}detach(){if(!this._attachedCamera)return;const m=this._attachedCamera.sm();this._onPrePointerObservableObserver&&m.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(m){this._lastInteractionTime=m??I.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let m=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(m=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?m:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=I.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var B=h(13540),D=h(11838);class E{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(m){if(this._autoTransitionRange===m)return;this._autoTransitionRange=m;const S=this._attachedCamera;S&&(m?this._onMeshTargetChangedObserver=S.onMeshTargetChangedObservable.add((m=>{if(m&&(m.Mb(!0),m.getBoundingInfo)){const S=m.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*S,this.upperRadiusTransitionRange=.05*S}})):this._onMeshTargetChangedObserver&&S.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(m){this._attachedCamera=m,this._onAfterCheckInputsObserver=m.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(m){return!!this._attachedCamera&&(this._attachedCamera.radius===m&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(m){if(!this._attachedCamera)return;this._radiusBounceTransition||(E.EasingFunction.setEasingMode(E.EasingMode),this._radiusBounceTransition=D.e.CreateAnimation("radius",D.e.ANIMATIONTYPE_FLOAT,60,E.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const S=D.e.TransitionTo("radius",this._attachedCamera.radius+m,this._attachedCamera,this._attachedCamera.sm(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));S&&this._animatables.push(S)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}E.EasingFunction=new B.e(.3),E.EasingMode=B.q.EASINGMODE_EASEOUT;class n{constructor(){this.onTargetFramingAnimationEndObservable=new O.e,this._mode=n.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(m){this._mode=m}get mode(){return this._mode}set radiusScale(m){this._radiusScale=m}get radiusScale(){return this._radiusScale}set positionScale(m){this._positionScale=m}get positionScale(){return this._positionScale}set defaultElevation(m){this._defaultElevation=m}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(m){this._elevationReturnTime=m}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(m){this._elevationReturnWaitTime=m}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(m){this._zoomStopsAnimation=m}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(m){this._framingTime=m}get framingTime(){return this._framingTime}init(){}attach(m){this._attachedCamera=m;const S=this._attachedCamera.sm();n.EasingFunction.setEasingMode(n.EasingMode),this._onPrePointerObservableObserver=S.onPrePointerObservable.add((m=>{m.type!==V.b.POINTERDOWN?m.type===V.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=m.onMeshTargetChangedObservable.add((m=>{m&&m.getBoundingInfo&&this.zoomOnMesh(m,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=m.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const m=this._attachedCamera.sm();this._onPrePointerObservableObserver&&m.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m.Mb(!0);const l=m.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(l.minimumWorld,l.maximumWorld,S,h)}zoomOnMeshHierarchy(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m.Mb(!0);const l=m.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(l.min,l.max,S,h)}zoomOnMeshesHierarchy(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new u.nS(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),M=new u.nS(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let O=0;O<m.length;O++){const S=m[O].getHierarchyBoundingVectors(!0);u.nS.CheckExtends(S.min,l,M),u.nS.CheckExtends(S.max,l,M)}this.zoomOnBoundingInfo(l,M,S,h)}zoomOnBoundingInfo(m,S){let h,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const O=m.y,b=O+(S.y-O)*this._positionScale,q=S.LS(m).scale(.5);if(!isFinite(b))return!1;if(l)h=new u.nS(0,b,0);else{const S=m.add(q);h=new u.nS(S.x,b,S.z)}this._vectorTransition||(this._vectorTransition=D.e.CreateAnimation("target",D.e.ANIMATIONTYPE_VECTOR3,60,n.EasingFunction)),this._betaIsAnimating=!0;let Y=D.e.TransitionTo("target",h,this._attachedCamera,this._attachedCamera.sm(),60,this._vectorTransition,this._framingTime);Y&&this._animatables.push(Y);let V=0;if(this._mode===n.FitFrustumSidesMode){const h=this._calculateLowerRadiusFromModelBoundingSphere(m,S);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=q.length()+this._attachedCamera.hb),V=h}else this._mode===n.IgnoreBoundsSizeMode&&(V=this._calculateLowerRadiusFromModelBoundingSphere(m,S),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.hb));if(this.autoCorrectCameraLimitsAndSensibility){const h=S.LS(m).length();this._attachedCamera.panningSensibility=5e3/h,this._attachedCamera.wheelPrecision=100/V}return this._radiusTransition||(this._radiusTransition=D.e.CreateAnimation("radius",D.e.ANIMATIONTYPE_FLOAT,60,n.EasingFunction)),Y=D.e.TransitionTo("radius",V,this._attachedCamera,this._attachedCamera.sm(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),M&&M(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Y&&this._animatables.push(Y),!0}_calculateLowerRadiusFromModelBoundingSphere(m,S){const h=this._attachedCamera;if(!h)return 0;let l=h._calculateLowerRadiusFromModelBoundingSphere(m,S,this._radiusScale);return h.lowerRadiusLimit&&this._mode===n.IgnoreBoundsSizeMode&&(l=l<h.lowerRadiusLimit?h.lowerRadiusLimit:l),h.upperRadiusLimit&&(l=l>h.upperRadiusLimit?h.upperRadiusLimit:l),l}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const m=I.b.Now-this._lastInteractionTime,S=.5*Math.PI-this._defaultElevation,h=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>h&&m>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=D.e.CreateAnimation("beta",D.e.ANIMATIONTYPE_FLOAT,60,n.EasingFunction));const m=D.e.TransitionTo("beta",S,this._attachedCamera,this._attachedCamera.sm(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));m&&this._animatables.push(m)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=I.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}n.EasingFunction=new B.u,n.EasingMode=B.q.EASINGMODE_EASEINOUT,n.IgnoreBoundsSizeMode=0,n.FitFrustumSidesMode=1;var L=h(11759),U=h(11791),H=h(12976),R=h(11156);class y{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(m){m=R.Tools.BackCompatCameraNoPreventDefault(arguments);const S=this.camera.getEngine(),h=S.getInputElement();let l=0,M=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=O=>{var u,b;const q=O.event,Y="touch"===q.pointerType;if(O.type!==V.b.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const I=q.target;if(this._altKey=q.altKey,this._ctrlKey=q.ctrlKey,this._metaKey=q.metaKey,this._shiftKey=q.shiftKey,this._buttonsPressed=q.buttons,S.isPointerLock){const m=q.movementX,S=q.movementY;this.onTouch(null,m,S),this._pointA=null,this._pointB=null}else{if(O.type!==V.b.POINTERDOWN&&O.type!==V.b.POINTERDOUBLETAP&&Y&&(null===(u=this._pointA)||void 0===u?void 0:u.pointerId)!==q.pointerId&&(null===(b=this._pointB)||void 0===b?void 0:b.pointerId)!==q.pointerId)return;if(O.type!==V.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!Y)if(O.type===V.b.POINTERDOUBLETAP)this.onDoubleTap(q.pointerType);else if(O.type!==V.b.POINTERUP||this._currentMousePointerIdDown!==q.pointerId&&!Y){if(O.type===V.b.POINTERMOVE)if(m||q.preventDefault(),this._pointA&&null===this._pointB){const m=q.clientX-this._pointA.x,S=q.clientY-this._pointA.y;this._pointA.x=q.clientX,this._pointA.y=q.clientY,this.onTouch(this._pointA,m,S)}else if(this._pointA&&this._pointB){const m=this._pointA.pointerId===q.pointerId?this._pointA:this._pointB;m.x=q.clientX,m.y=q.clientY;const S=this._pointA.x-this._pointB.x,h=this._pointA.y-this._pointB.y,u=S*S+h*h,b={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:q.pointerId,type:O.type};this.onMultiTouch(this._pointA,this._pointB,l,u,M,b),M=b,l=u}}else{try{null===I||void 0===I||I.releasePointerCapture(q.pointerId)}catch(Z){}Y||(this._pointB=null),S._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==q.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==q.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==l||M)&&(this.onMultiTouch(this._pointA,this._pointB,l,0,M,null),l=0,M=null),this._currentMousePointerIdDown=-1,this.onButtonUp(q),m||q.preventDefault()}else{try{null===I||void 0===I||I.setPointerCapture(q.pointerId)}catch(Z){}if(null===this._pointA)this._pointA={x:q.clientX,y:q.clientY,pointerId:q.pointerId,type:q.pointerType};else{if(null!==this._pointB)return;this._pointB={x:q.clientX,y:q.clientY,pointerId:q.pointerId,type:q.pointerType}}-1!==this._currentMousePointerIdDown||Y||(this._currentMousePointerIdDown=q.pointerId),this.onButtonDown(q),m||(q.preventDefault(),h&&h.focus())}}},this._observer=this.camera.sm()._inputManager._addCameraPointerObserver(this._pointerInput,V.b.POINTERDOWN|V.b.POINTERUP|V.b.POINTERMOVE|V.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,l=0,M=null,this.onLostFocus()},this._contextMenuBind=m=>this.onContextMenu(m),h&&h.addEventListener("contextmenu",this._contextMenuBind,!1);const O=this.camera.sm().getEngine().getHostWindow();O&&R.Tools.RegisterTopRootEvents(O,[{name:"blur",handler:this._onLostFocus}])}mZ(){if(this._onLostFocus){const m=this.camera.sm().getEngine().getHostWindow();m&&R.Tools.UnregisterTopRootEvents(m,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.sm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const m=this.camera.sm().getEngine().getInputElement();m&&m.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(m){}onTouch(m,S,h){}onMultiTouch(m,S,h,l,M,O){}onContextMenu(m){m.preventDefault()}onButtonDown(m){}onButtonUp(m){}onLostFocus(){}}(0,l.d)([(0,M.F)()],y.prototype,"buttons",void 0);class o extends y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(m,S){if(0!==this.panningSensibility&&m&&S){const h=S.x-m.x,l=S.y-m.y;this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility}}_computePinchZoom(m,S){const h=this.camera.radius||o.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=h*Math.sqrt(m)/Math.sqrt(S):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(S-m)*h*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(S-m)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(m,S,h){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-S/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility):(this.camera.inertialAlphaOffset-=S/this.angularSensibilityX,this.camera.inertialBetaOffset-=h/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(m,S,h,l,M,O){0===h&&null===M||0===l&&null===O||(this.multiTouchPanAndZoom?(this._computePinchZoom(h,l),this._computeMultiTouchPanning(M,O)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(l)-Math.sqrt(h))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(h,l),this._isPinching=!0):this._computeMultiTouchPanning(M,O)):this.multiTouchPanning?this._computeMultiTouchPanning(M,O):this.pinchZoom&&this._computePinchZoom(h,l))}onButtonDown(m){this._isPanClick=m.button===this.camera._panningMouseButton}onButtonUp(m){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}o.MinimumRadiusForPinch=.001,(0,l.d)([(0,M.F)()],o.prototype,"buttons",void 0),(0,l.d)([(0,M.F)()],o.prototype,"angularSensibilityX",void 0),(0,l.d)([(0,M.F)()],o.prototype,"angularSensibilityY",void 0),(0,l.d)([(0,M.F)()],o.prototype,"pinchPrecision",void 0),(0,l.d)([(0,M.F)()],o.prototype,"pinchDeltaPercentage",void 0),(0,l.d)([(0,M.F)()],o.prototype,"useNaturalPinchZoom",void 0),(0,l.d)([(0,M.F)()],o.prototype,"pinchZoom",void 0),(0,l.d)([(0,M.F)()],o.prototype,"panningSensibility",void 0),(0,l.d)([(0,M.F)()],o.prototype,"multiTouchPanning",void 0),(0,l.d)([(0,M.F)()],o.prototype,"multiTouchPanAndZoom",void 0),H.e.ArcRotateCameraPointersInput=o;var s=h(11594);class v{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(m){m=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sm(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((S=>{const h=S.event;if(!h.metaKey)if(S.type===s.c.KEYDOWN){if(this._ctrlPressed=h.ctrlKey,this._altPressed=h.altKey,-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),h.preventDefault&&(m||h.preventDefault())}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){const S=this._keys.indexOf(h.keyCode);S>=0&&this._keys.splice(S,1),h.preventDefault&&(m||h.preventDefault())}})))}mZ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const m=this.camera;for(let S=0;S<this._keys.length;S++){const h=this._keys[S];-1!==this.keysLeft.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?m.inertialPanningX-=1/this.panningSensibility:m.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?m.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?m.inertialRadiusOffset+=1/this.zoomingSensibility:m.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?m.inertialPanningX+=1/this.panningSensibility:m.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?m.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?m.inertialRadiusOffset-=1/this.zoomingSensibility:m.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(h)&&m.useInputToRestoreState&&m.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,l.d)([(0,M.F)()],v.prototype,"keysUp",void 0),(0,l.d)([(0,M.F)()],v.prototype,"keysDown",void 0),(0,l.d)([(0,M.F)()],v.prototype,"keysLeft",void 0),(0,l.d)([(0,M.F)()],v.prototype,"keysRight",void 0),(0,l.d)([(0,M.F)()],v.prototype,"keysReset",void 0),(0,l.d)([(0,M.F)()],v.prototype,"panningSensibility",void 0),(0,l.d)([(0,M.F)()],v.prototype,"zoomingSensibility",void 0),(0,l.d)([(0,M.F)()],v.prototype,"useAltToZoom",void 0),(0,l.d)([(0,M.F)()],v.prototype,"angularSpeed",void 0),H.e.ArcRotateCameraKeyboardMoveInput=v;var T=h(11392),X=h(11597);class g{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new u.nS(0,0,0),this._globalOffset=new u.nS(0,0,0),this._inertialPanning=u.nS.Zero()}_computeDeltaFromMouseWheelLegacyEvent(m,S){let h=0;const l=.01*m*this.wheelDeltaPercentage*S;return h=m>0?l/(1+this.wheelDeltaPercentage):l*(1+this.wheelDeltaPercentage),h}attachControl(m){m=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=S=>{if(S.type!==V.b.POINTERWHEEL)return;const h=S.event;let l=0;const M=h.deltaMode===X.d.DOM_DELTA_LINE?40:1,O=-h.deltaY*M;if(this.customComputeDeltaFromMouseWheel)l=this.customComputeDeltaFromMouseWheel(O,this,h);else if(this.wheelDeltaPercentage){if(l=this._computeDeltaFromMouseWheelLegacyEvent(O,this.camera.radius),l>0){let m=this.camera.radius,S=this.camera.inertialRadiusOffset+l;for(let h=0;h<20&&!(m<=S)&&!(Math.abs(S*this.camera.inertia)<.001);h++)m-=S,S*=this.camera.inertia;m=(0,b.Clamp)(m,0,Number.MAX_VALUE),l=this._computeDeltaFromMouseWheelLegacyEvent(O,m)}}else l=O/(40*this.wheelPrecision);l&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(l)):this.camera.inertialRadiusOffset+=l),h.preventDefault&&(m||h.preventDefault())},this._observer=this.camera.sm()._inputManager._addCameraPointerObserver(this._wheel,V.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Zb(0)}mZ(){this._observer&&(this.camera.sm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const m=this.camera;0+m.inertialAlphaOffset+m.inertialBetaOffset+m.inertialRadiusOffset&&(this._updateHitPlane(),m.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(m.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const m=this.camera,S=m.target.LS(m.position);this._hitPlane=T.e.FromPositionAndNormal(m.target,S)}_getPosition(){const m=this.camera,S=m.sm(),h=S.createPickingRay(S.pointerX,S.pointerY,u.Matrix.Identity(),m,!1);0===m.targetScreenOffset.x&&0===m.targetScreenOffset.y||(this._viewOffset.set(m.targetScreenOffset.x,m.targetScreenOffset.y,0),m.getViewMatrix().invertToRef(m._cameraTransformMatrix),this._globalOffset=u.nS.TransformNormal(this._viewOffset,m._cameraTransformMatrix),h.origin.addInPlace(this._globalOffset));let l=0;return this._hitPlane&&(l=h.intersectsPlane(this._hitPlane)??0),h.origin.addInPlace(h.direction.scaleInPlace(l))}_zoomToMouse(m){const S=this.camera,h=1-S.inertia;if(S.lowerRadiusLimit){const l=S.lowerRadiusLimit??0;S.radius-(S.inertialRadiusOffset+m)/h<l&&(m=(S.radius-l)*h-S.inertialRadiusOffset)}if(S.upperRadiusLimit){const l=S.upperRadiusLimit??0;S.radius-(S.inertialRadiusOffset+m)/h>l&&(m=(S.radius-l)*h-S.inertialRadiusOffset)}const l=m/h/S.radius,M=this._getPosition(),O=u.TmpVectors.nS[6];M.subtractToRef(S.target,O),O.scaleInPlace(l),O.scaleInPlace(h),this._inertialPanning.addInPlace(O),S.inertialRadiusOffset+=m}_zeroIfClose(m){Math.abs(m.x)<Z.d&&(m.x=0),Math.abs(m.y)<Z.d&&(m.y=0),Math.abs(m.z)<Z.d&&(m.z=0)}}(0,l.d)([(0,M.F)()],g.prototype,"wheelPrecision",void 0),(0,l.d)([(0,M.F)()],g.prototype,"zoomToMouseLocation",void 0),(0,l.d)([(0,M.F)()],g.prototype,"wheelDeltaPercentage",void 0),H.e.ArcRotateCameraMouseWheelInput=g;class G extends H.f{constructor(m){super(m)}addMouseWheel(){return this.add(new g),this}addPointers(){return this.add(new o),this}addKeyboard(){return this.add(new v),this}}var e=h(11293);function a(m,S){return isNaN(m)?S:m}q.e.AddNodeConstructor("ArcRotateCamera",((m,S)=>()=>new x(m,0,0,1,u.nS.Zero(),S)));class x extends U.c{get target(){return this._target}set target(m){this.setTarget(m)}get targetHost(){return this._targetHost}set targetHost(m){m&&this.setTarget(m)}getTarget(){return this.target}get position(){return this._position}set position(m){this.setPosition(m)}set upVector(m){this._upToYMatrix||(this._yToUpMatrix=new u.Matrix,this._upToYMatrix=new u.Matrix,this._upVector=u.nS.Zero()),m.normalize(),this._upVector.l(m),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){u.Matrix.RotationAlignToRef(u.nS.UpReadOnly,this._upVector,this._yToUpMatrix),u.Matrix.RotationAlignToRef(this._upVector,u.nS.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const m=this.inputs.attached.pointers;return m?m.angularSensibilityX:0}set angularSensibilityX(m){const S=this.inputs.attached.pointers;S&&(S.angularSensibilityX=m)}get angularSensibilityY(){const m=this.inputs.attached.pointers;return m?m.angularSensibilityY:0}set angularSensibilityY(m){const S=this.inputs.attached.pointers;S&&(S.angularSensibilityY=m)}get pinchPrecision(){const m=this.inputs.attached.pointers;return m?m.pinchPrecision:0}set pinchPrecision(m){const S=this.inputs.attached.pointers;S&&(S.pinchPrecision=m)}get pinchDeltaPercentage(){const m=this.inputs.attached.pointers;return m?m.pinchDeltaPercentage:0}set pinchDeltaPercentage(m){const S=this.inputs.attached.pointers;S&&(S.pinchDeltaPercentage=m)}get useNaturalPinchZoom(){const m=this.inputs.attached.pointers;return!!m&&m.useNaturalPinchZoom}set useNaturalPinchZoom(m){const S=this.inputs.attached.pointers;S&&(S.useNaturalPinchZoom=m)}get panningSensibility(){const m=this.inputs.attached.pointers;return m?m.panningSensibility:0}set panningSensibility(m){const S=this.inputs.attached.pointers;S&&(S.panningSensibility=m)}get keysUp(){const m=this.inputs.attached.keyboard;return m?m.keysUp:[]}set keysUp(m){const S=this.inputs.attached.keyboard;S&&(S.keysUp=m)}get keysDown(){const m=this.inputs.attached.keyboard;return m?m.keysDown:[]}set keysDown(m){const S=this.inputs.attached.keyboard;S&&(S.keysDown=m)}get keysLeft(){const m=this.inputs.attached.keyboard;return m?m.keysLeft:[]}set keysLeft(m){const S=this.inputs.attached.keyboard;S&&(S.keysLeft=m)}get keysRight(){const m=this.inputs.attached.keyboard;return m?m.keysRight:[]}set keysRight(m){const S=this.inputs.attached.keyboard;S&&(S.keysRight=m)}get wheelPrecision(){const m=this.inputs.attached.mousewheel;return m?m.wheelPrecision:0}set wheelPrecision(m){const S=this.inputs.attached.mousewheel;S&&(S.wheelPrecision=m)}get zoomToMouseLocation(){const m=this.inputs.attached.mousewheel;return!!m&&m.zoomToMouseLocation}set zoomToMouseLocation(m){const S=this.inputs.attached.mousewheel;S&&(S.zoomToMouseLocation=m)}get wheelDeltaPercentage(){const m=this.inputs.attached.mousewheel;return m?m.wheelDeltaPercentage:0}set wheelDeltaPercentage(m){const S=this.inputs.attached.mousewheel;S&&(S.wheelDeltaPercentage=m)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(m){m!==this.useBouncingBehavior&&(m?(this._bouncingBehavior=new E,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(m){m!==this.useFramingBehavior&&(m?(this._framingBehavior=new n,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(m){m!==this.useAutoRotationBehavior&&(m?(this._autoRotationBehavior=new C,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(m,S,h,l,M,b){var q;let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(m,u.nS.Zero(),b,Y),q=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=u.nS.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=u.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new u.Matrix,this.panningAxis=new u.nS(1,1,0),this._transformedDirection=new u.nS,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new O.e,this.checkCollisions=!1,this.collisionRadius=new u.nS(.5,.5,.5),this._previousPosition=u.nS.Zero(),this._collisionVelocity=u.nS.Zero(),this._newPosition=u.nS.Zero(),this._computationVector=u.nS.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new u.nS(NaN,NaN,NaN),this._goalTargetScreenOffset=new u.Vector2(NaN,NaN),this._onCollisionPositionChange=function(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h?(q.setPosition(S),q.JC&&q.JC(h)):q._previousPosition.l(q._position);const l=Math.cos(q.alpha),M=Math.sin(q.alpha),O=Math.cos(q.beta);let u=Math.sin(q.beta);0===u&&(u=1e-4);const b=q._getTargetPosition();q._computationVector.Yb(q.radius*l*u,q.radius*O,q.radius*M*u),b.addToRef(q._computationVector,q._newPosition),q._position.l(q._newPosition);let Y=q.upVector;q.allowUpsideDown&&q.beta<0&&(Y=Y.clone(),Y=Y.negate()),q._computeViewMatrix(q._position,b,Y),q._viewMatrix.addAtIndex(12,q.targetScreenOffset.x),q._viewMatrix.addAtIndex(13,q.targetScreenOffset.y),q._collisionTriggered=!1},this._target=u.nS.Zero(),M&&this.setTarget(M),this.alpha=S,this.beta=h,this.radius=l,this.getViewMatrix(),this.inputs=new G(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new u.nS(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=u.Vector2.Zero()}_updateCache(m){m||super._updateCache(),this._cache._target.l(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.l(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const m=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?m.addToRef(this._targetBoundingCenter,this._target):this._target.l(m)}const m=this._getLockedTargetPosition();return m||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,O=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=O?this._currentInterpolationFactor=O:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=a(m,this._goalAlpha),this._goalBeta=a(S,this._goalBeta),this._goalRadius=a(h,this._goalRadius),this._goalTarget.set(a(l.x,this._goalTarget.x),a(l.y,this._goalTarget.y),a(l.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(a(M.x,this._goalTargetScreenOffset.x),a(M.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,b.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,b.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,b.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,b.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(m,S){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const M=arguments;S=R.Tools.BackCompatCameraNoPreventDefault(M),this._useCtrlForPanning=h,this._panningMouseButton=l,"boolean"===typeof M[0]&&(M.length>1&&(this._useCtrlForPanning=M[1]),M.length>2&&(this._panningMouseButton=M[2])),this.inputs.attachElement(S),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}mZ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let m=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){m=!0;const S=this.invertRotation?-1:1,h=this._calculateHandednessMultiplier();let l=this.inertialAlphaOffset*h;this.beta<0&&(l*=-1),this.alpha+=l*S,this.beta+=this.inertialBetaOffset*S,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){m=!0;const S=new u.nS(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),S.multiplyInPlace(this.panningAxis),u.nS.TransformNormalToRef(S,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const m=this.upVector,S=u.nS.CrossToRef(this._transformedDirection,m,this._transformedDirection);u.nS.CrossToRef(m,S,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);u.nS.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.l(this._transformedDirection)}else{if(this.parent){const m=u.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(m),m.transposeToRef(m),u.nS.TransformCoordinatesToRef(this._transformedDirection,m,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.d&&(this.inertialPanningY=0)}if(m)this.stopInterpolation();else if(this._isInterpolating){let m=!1;const S=this._scene.getEngine().getDeltaTime()/1e3,h=1-Math.pow(2,-S/this._currentInterpolationFactor),l=a(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const S=u.TmpVectors.nS[0].set(a(this._goalTarget.x,this._target.x),a(this._goalTarget.y,this._target.y),a(this._goalTarget.z,this._target.z));u.nS.LerpToRef(this.target,S,h,this._target),10*u.nS.Distance(this.target,S)/l<Z.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.l(S),this.setTarget(this.target,!1,!0,!0)):m=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const S=u.Quaternion.RotationAlphaBetaGammaToRef(a(this._goalAlpha,this.alpha),a(this._goalBeta,this.beta),0,u.TmpVectors.Quaternion[0]),l=u.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,u.TmpVectors.Quaternion[1]),M=u.Quaternion.SlerpToRef(l,S,h,u.TmpVectors.Quaternion[2]);M.normalize();const O=M.toAlphaBetaGammaToRef(u.TmpVectors.nS[0]);if(this.alpha=O.x,this.beta=O.y,M.isApprox(S,Z.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const m=S.toAlphaBetaGammaToRef(u.TmpVectors.nS[0]);this.alpha=m.x,this.beta=m.y}else m=!0}if(isNaN(this._goalRadius)||(this.radius+=(l-this.radius)*h,Math.abs(l/this.radius-1)<Z.d?(this._goalRadius=NaN,this.radius=l):m=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const S=u.TmpVectors.Vector2[0].set(a(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),a(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));u.Vector2.LerpToRef(this.targetScreenOffset,S,h,this.targetScreenOffset),u.Vector2.Distance(this.targetScreenOffset,S)<Z.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.l(S)):m=!0}this._isInterpolating=m}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.nS.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const m=this.alpha;var S,h;this.alpha=function(m){let S=Math.PI/2;return 0===m.x&&0===m.z||(S=Math.acos(m.x/Math.sqrt(Math.pow(m.x,2)+Math.pow(m.z,2)))),m.z<0&&(S=2*Math.PI-S),S}(this._computationVector),this.beta=(S=this._computationVector.y,h=this.radius,Math.acos(S/h));const l=Math.round((m-this.alpha)/(2*Math.PI));this.alpha+=2*l*Math.PI,this._checkLimits()}setPosition(m){this._position.equals(m)||(this._position.l(m),this.rebuildAnglesAndRadius())}setTarget(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(l=this.overrideCloneAlphaBetaRadius??l,m.Mb)S&&m.getBoundingInfo?this._targetBoundingCenter=m.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,m.Mb(),this._targetHost=m,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const S=m,l=this._getTargetPosition();if(l&&!h&&l.equals(S))return;this._targetHost=null,this._target=S,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}l||this.rebuildAnglesAndRadius()}_getViewMatrix(){const m=Math.cos(this.alpha),S=Math.sin(this.alpha),h=Math.cos(this.beta);let l=Math.sin(this.beta);0===l&&(l=1e-4),0===this.radius&&(this.radius=1e-4);const M=this._getTargetPosition();if(this._computationVector.Yb(this.radius*m*l,this.radius*h,this.radius*S*l),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.nS.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),M.addToRef(this._computationVector,this._newPosition),this.sm().collisionsEnabled&&this.checkCollisions){const m=this.sm().collisionCoordinator;this._collider||(this._collider=m.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,m.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.l(this._newPosition);let m=this.upVector;this.allowUpsideDown&&l<0&&(m=m.negate()),this._computeViewMatrix(this._position,M,m),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.l(M),this._viewMatrix}zoomOn(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];m=m||this.sm().meshes;const h=Y.c.MinMax(m);let l=this._calculateLowerRadiusFromModelBoundingSphere(h.min,h.max);if(l=Math.max(Math.min(l,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=l*this.zoomOnFactor,this.mode===L.d.ORTHOGRAPHIC_CAMERA){const m=this.sm().getEngine().getAspectRatio(this),S=l*this.zoomOnFactor/2;this.orthoLeft=-S*m,this.orthoRight=S*m,this.orthoBottom=-S,this.orthoTop=S}this.focusOn({min:h.min,max:h.max,distance:l},S)}focusOn(m){let S,h,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===m.min){const l=m||this.sm().meshes;S=Y.c.MinMax(l),h=u.nS.Distance(S.min,S.max)}else{S=m,h=m.distance}this._target=Y.c.Center(S),l||(this.maxZ=2*h)}createRigCamera(m,S){let h=0;switch(this.cameraRigMode){case L.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.d.RIG_MODE_VR:h=this._cameraRigParams.stereoHalfAngle*(0===S?1:-1);break;case L.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h=this._cameraRigParams.stereoHalfAngle*(0===S?-1:1)}const l=new x(m,this.alpha+h,this.beta,this.radius,this._target,this.sm());return l._cameraRigParams={},l.isRigCamera=!0,l.rigParent=this,l.upVector=this.upVector,l.mode=this.mode,l.orthoLeft=this.orthoLeft,l.orthoRight=this.orthoRight,l.orthoBottom=this.orthoBottom,l.orthoTop=this.orthoTop,l}_updateRigCameras(){const m=this._rigCameras[0],S=this._rigCameras[1];switch(m.beta=S.beta=this.beta,this.cameraRigMode){case L.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.d.RIG_MODE_VR:m.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,S.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case L.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:m.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,S.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const l=u.nS.Distance(m,S),M=this.sm().getEngine().getAspectRatio(this),O=Math.tan(this.fov/2),b=O*M,q=.5*l*h,Y=q*Math.sqrt(1+1/(b*b)),V=q*Math.sqrt(1+1/(O*O));return Math.max(Y,V)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,l.d)([(0,M.F)()],x.prototype,"alpha",void 0),(0,l.d)([(0,M.F)()],x.prototype,"beta",void 0),(0,l.d)([(0,M.F)()],x.prototype,"radius",void 0),(0,l.d)([(0,M.F)()],x.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,l.d)([(0,M.B)("target")],x.prototype,"_target",void 0),(0,l.d)([(0,M.r)("targetHost")],x.prototype,"_targetHost",void 0),(0,l.d)([(0,M.F)()],x.prototype,"inertialAlphaOffset",void 0),(0,l.d)([(0,M.F)()],x.prototype,"inertialBetaOffset",void 0),(0,l.d)([(0,M.F)()],x.prototype,"inertialRadiusOffset",void 0),(0,l.d)([(0,M.F)()],x.prototype,"lowerAlphaLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"upperAlphaLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"lowerBetaLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"upperBetaLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"lowerRadiusLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"upperRadiusLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"lowerTargetYLimit",void 0),(0,l.d)([(0,M.F)()],x.prototype,"inertialPanningX",void 0),(0,l.d)([(0,M.F)()],x.prototype,"inertialPanningY",void 0),(0,l.d)([(0,M.F)()],x.prototype,"pinchToPanMaxDistance",void 0),(0,l.d)([(0,M.F)()],x.prototype,"panningDistanceLimit",void 0),(0,l.d)([(0,M.B)()],x.prototype,"panningOriginTarget",void 0),(0,l.d)([(0,M.F)()],x.prototype,"panningInertia",void 0),(0,l.d)([(0,M.F)()],x.prototype,"zoomToMouseLocation",null),(0,l.d)([(0,M.F)()],x.prototype,"zoomOnFactor",void 0),(0,l.d)([(0,M.y)()],x.prototype,"targetScreenOffset",void 0),(0,l.d)([(0,M.F)()],x.prototype,"allowUpsideDown",void 0),(0,l.d)([(0,M.F)()],x.prototype,"useInputToRestoreState",void 0),(0,l.d)([(0,M.F)()],x.prototype,"restoreStateInterpolationFactor",void 0),(0,e.e)("BABYLON.ArcRotateCamera",x)},12976:(m,S,h)=>{"use strict";h.d(S,{e:()=>u,f:()=>b});var l=h(11173),M=h(11377),O=h(11759),u={};class b{constructor(m){this.attachedToElement=!1,this.attached={},this.camera=m,this.checkInputs=()=>{}}add(m){const S=m.getSimpleName();this.attached[S]?l.e.Warn("camera input of type "+S+" already exists on camera"):(this.attached[S]=m,m.camera=this.camera,m.checkInputs&&(this.checkInputs=this._addCheckInputs(m.checkInputs.bind(m))),this.attachedToElement&&m.attachControl(this.noPreventDefault))}remove(m){for(const S in this.attached){const h=this.attached[S];if(h===m)return h.mZ(),h.camera=null,delete this.attached[S],void this.rebuildInputCheck()}}removeByType(m){for(const S in this.attached){const h=this.attached[S];h.getClassName()===m&&(h.mZ(),h.camera=null,delete this.attached[S],this.rebuildInputCheck())}}_addCheckInputs(m){const S=this.checkInputs;return()=>{S(),m()}}attachInput(m){this.attachedToElement&&m.attachControl(this.noPreventDefault)}attachElement(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){m=!O.d.ForceAttachControlToAlwaysPreventDefault&&m,this.attachedToElement=!0,this.noPreventDefault=m;for(const S in this.attached)this.attached[S].attachControl(m)}}detachElement(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const S in this.attached)this.attached[S].mZ(),m&&(this.attached[S].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const m in this.attached){const S=this.attached[m];S.checkInputs&&(this.checkInputs=this._addCheckInputs(S.checkInputs.bind(S)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(m){const S={};for(const h in this.attached){const m=this.attached[h],l=M.e.Serialize(m);S[m.getClassName()]=l}m.inputsmgr=S}parse(m){const S=m.inputsmgr;if(S){this.clear();for(const m in S){const h=u[m];if(h){const l=S[m],O=M.e.Parse((()=>new h),l,null);this.add(O)}}}else for(const h in this.attached){const S=u[this.attached[h].getClassName()];if(S){const l=M.e.Parse((()=>new S),m,null);this.remove(this.attached[h]),this.add(l)}}}}},12970:(m,S,h)=>{"use strict";h.d(S,{d:()=>y});var l=h(11327),M=h(11336),O=h(11347),u=h(11791),b=h(12976),q=h(11594),Y=h(11156);class V{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(m){m=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sm(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((S=>{const h=S.event;if(!h.metaKey)if(S.type===q.c.KEYDOWN){if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),m||h.preventDefault()}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){const S=this._keys.indexOf(h.keyCode);S>=0&&this._keys.splice(S,1),m||h.preventDefault()}})))}mZ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const m=this.camera;for(let S=0;S<this._keys.length;S++){const h=this._keys[S],l=m._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(h)?m._localDirection.Yb(-l,0,0):-1!==this.keysUp.indexOf(h)?m._localDirection.Yb(0,0,l):-1!==this.keysRight.indexOf(h)?m._localDirection.Yb(l,0,0):-1!==this.keysDown.indexOf(h)?m._localDirection.Yb(0,0,-l):-1!==this.keysUpward.indexOf(h)?m._localDirection.Yb(0,l,0):-1!==this.keysDownward.indexOf(h)?m._localDirection.Yb(0,-l,0):-1!==this.keysRotateLeft.indexOf(h)?(m._localDirection.Yb(0,0,0),m.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(h)?(m._localDirection.Yb(0,0,0),m.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(h)?(m._localDirection.Yb(0,0,0),m.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(h)&&(m._localDirection.Yb(0,0,0),m.cameraRotation.x+=this._getLocalRotation()),m.sm().useRightHandedSystem&&(m._localDirection.z*=-1),m.getViewMatrix().invertToRef(m._cameraTransformMatrix),O.nS.TransformNormalToRef(m._localDirection,m._cameraTransformMatrix,m._transformedDirection),m.cameraDirection.addInPlace(m._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const m=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*m}}(0,l.d)([(0,M.F)()],V.prototype,"keysUp",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysUpward",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysDown",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysDownward",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysLeft",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysRight",void 0),(0,l.d)([(0,M.F)()],V.prototype,"rotationSpeed",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysRotateLeft",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysRotateRight",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysRotateUp",void 0),(0,l.d)([(0,M.F)()],V.prototype,"keysRotateDown",void 0),b.e.FreeCameraKeyboardMoveInput=V;var I=h(11161),Z=h(11592);class C{constructor(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=m,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new I.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(m){m=Y.Tools.BackCompatCameraNoPreventDefault(arguments);const S=this.camera.getEngine(),h=S.getInputElement();this._pointerInput||(this._pointerInput=l=>{const M=l.event,O="touch"===M.pointerType;if(!this.touchEnabled&&O)return;if(l.type!==Z.b.POINTERMOVE&&-1===this.buttons.indexOf(M.button))return;const u=M.target;if(l.type===Z.b.POINTERDOWN){if(O&&-1!==this._activePointerId||!O&&-1!==this._currentActiveButton)return;this._activePointerId=M.pointerId;try{null===u||void 0===u||u.setPointerCapture(M.pointerId)}catch(b){}-1===this._currentActiveButton&&(this._currentActiveButton=M.button),this._previousPosition={x:M.clientX,y:M.clientY},m||(M.preventDefault(),h&&h.focus()),S.isPointerLock&&this._onMouseMove&&this._onMouseMove(l.event)}else if(l.type===Z.b.POINTERUP){if(O&&this._activePointerId!==M.pointerId||!O&&this._currentActiveButton!==M.button)return;try{null===u||void 0===u||u.releasePointerCapture(M.pointerId)}catch(b){}this._currentActiveButton=-1,this._previousPosition=null,m||M.preventDefault(),this._activePointerId=-1}else if(l.type===Z.b.POINTERMOVE&&(this._activePointerId===M.pointerId||!O))if(S.isPointerLock&&this._onMouseMove)this._onMouseMove(l.event);else if(this._previousPosition){const S=this.camera._calculateHandednessMultiplier(),h=(M.clientX-this._previousPosition.x)*S,l=M.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=h/this.angularSensibility,this.camera.cameraRotation.x+=l/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:h,offsetY:l}),this._previousPosition={x:M.clientX,y:M.clientY},m||M.preventDefault()}}),this._onMouseMove=h=>{if(!S.isPointerLock)return;const l=this.camera._calculateHandednessMultiplier(),M=h.movementX*l;this.camera.cameraRotation.y+=M/this.angularSensibility;const O=h.movementY;this.camera.cameraRotation.x+=O/this.angularSensibility,this._previousPosition=null,m||h.preventDefault()},this._observer=this.camera.sm()._inputManager._addCameraPointerObserver(this._pointerInput,Z.b.POINTERDOWN|Z.b.POINTERUP|Z.b.POINTERMOVE),h&&(this._contextMenuBind=m=>this.onContextMenu(m),h.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(m){m.preventDefault()}mZ(){if(this._observer){if(this.camera.sm()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const m=this.camera.getEngine().getInputElement();m&&m.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,l.d)([(0,M.F)()],C.prototype,"buttons",void 0),(0,l.d)([(0,M.F)()],C.prototype,"angularSensibility",void 0),b.e.FreeCameraMouseInput=C;var B,D=h(11597);class E{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new I.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(m){m=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=S=>{if(S.type!==Z.b.POINTERWHEEL)return;const h=S.event,l=h.deltaMode===D.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*l*h.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*l*h.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*l*h.deltaZ/this._normalize,h.preventDefault&&(m||h.preventDefault())},this._observer=this.camera.sm()._inputManager._addCameraPointerObserver(this._wheel,Z.b.POINTERWHEEL)}mZ(){this._observer&&(this.camera.sm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,l.d)([(0,M.F)()],E.prototype,"wheelPrecisionX",void 0),(0,l.d)([(0,M.F)()],E.prototype,"wheelPrecisionY",void 0),(0,l.d)([(0,M.F)()],E.prototype,"wheelPrecisionZ",void 0),function(m){m[m.MoveRelative=0]="MoveRelative",m[m.RotateRelative=1]="RotateRelative",m[m.MoveScene=2]="MoveScene"}(B||(B={}));class n extends E{constructor(){super(...arguments),this._moveRelative=O.nS.Zero(),this._rotateRelative=O.nS.Zero(),this._moveScene=O.nS.Zero(),this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(m){null===m&&this._wheelXAction!==B.MoveRelative||(this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=m)}get wheelXMoveRelative(){return this._wheelXAction!==B.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(m){null===m&&this._wheelYAction!==B.MoveRelative||(this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=m)}get wheelYMoveRelative(){return this._wheelYAction!==B.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(m){null===m&&this._wheelZAction!==B.MoveRelative||(this._wheelZAction=B.MoveRelative,this._wheelZActionCoordinate=m)}get wheelZMoveRelative(){return this._wheelZAction!==B.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(m){null===m&&this._wheelXAction!==B.RotateRelative||(this._wheelXAction=B.RotateRelative,this._wheelXActionCoordinate=m)}get wheelXRotateRelative(){return this._wheelXAction!==B.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(m){null===m&&this._wheelYAction!==B.RotateRelative||(this._wheelYAction=B.RotateRelative,this._wheelYActionCoordinate=m)}get wheelYRotateRelative(){return this._wheelYAction!==B.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(m){null===m&&this._wheelZAction!==B.RotateRelative||(this._wheelZAction=B.RotateRelative,this._wheelZActionCoordinate=m)}get wheelZRotateRelative(){return this._wheelZAction!==B.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(m){null===m&&this._wheelXAction!==B.MoveScene||(this._wheelXAction=B.MoveScene,this._wheelXActionCoordinate=m)}get wheelXMoveScene(){return this._wheelXAction!==B.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(m){null===m&&this._wheelYAction!==B.MoveScene||(this._wheelYAction=B.MoveScene,this._wheelYActionCoordinate=m)}get wheelYMoveScene(){return this._wheelYAction!==B.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(m){null===m&&this._wheelZAction!==B.MoveScene||(this._wheelZAction=B.MoveScene,this._wheelZActionCoordinate=m)}get wheelZMoveScene(){return this._wheelZAction!==B.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Zb(0),this._rotateRelative.Zb(0),this._moveScene.Zb(0),this._updateCamera(),this.camera.sm().useRightHandedSystem&&(this._moveRelative.z*=-1);const m=O.Matrix.Zero();this.camera.getViewMatrix().invertToRef(m);const S=O.nS.Zero();O.nS.TransformNormalToRef(this._moveRelative,m,S),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(S),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(m,S,h){if(0===m)return;if(null===S||null===h)return;let l=null;switch(S){case B.MoveRelative:l=this._moveRelative;break;case B.RotateRelative:l=this._rotateRelative;break;case B.MoveScene:l=this._moveScene}switch(h){case 0:l.set(m,0,0);break;case 1:l.set(0,m,0);break;case 2:l.set(0,0,m)}}}(0,l.d)([(0,M.F)()],n.prototype,"wheelXMoveRelative",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelYMoveRelative",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelZMoveRelative",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelXRotateRelative",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelYRotateRelative",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelZRotateRelative",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelXMoveScene",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelYMoveScene",null),(0,l.d)([(0,M.F)()],n.prototype,"wheelZMoveScene",null),b.e.FreeCameraMouseWheelInput=n;class L{constructor(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=m,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Y.Tools.IsSafari()}attachControl(m){m=Y.Tools.BackCompatCameraNoPreventDefault(arguments);let S=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=h=>{const l=h.event,M="mouse"===l.pointerType||this._isSafari&&"undefined"===typeof l.pointerType;if(this.allowMouse||!M)if(h.type===Z.b.POINTERDOWN){if(m||l.preventDefault(),this._pointerPressed.push(l.pointerId),1!==this._pointerPressed.length)return;S={x:l.clientX,y:l.clientY}}else if(h.type===Z.b.POINTERUP){m||l.preventDefault();const h=this._pointerPressed.indexOf(l.pointerId);if(-1===h)return;if(this._pointerPressed.splice(h,1),0!=h)return;S=null,this._offsetX=null,this._offsetY=null}else if(h.type===Z.b.POINTERMOVE){if(m||l.preventDefault(),!S)return;if(0!=this._pointerPressed.indexOf(l.pointerId))return;this._offsetX=l.clientX-S.x,this._offsetY=-(l.clientY-S.y)}}),this._observer=this.camera.sm()._inputManager._addCameraPointerObserver(this._pointerInput,Z.b.POINTERDOWN|Z.b.POINTERUP|Z.b.POINTERMOVE),this._onLostFocus){const m=this.camera.getEngine().getInputElement();m&&m.addEventListener("blur",this._onLostFocus)}}mZ(){if(this._pointerInput){if(this._observer&&(this.camera.sm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const m=this.camera.getEngine().getInputElement();m&&m.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const m=this.camera,S=m._calculateHandednessMultiplier();m.cameraRotation.y=S*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)m.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const S=m._computeLocalCameraSpeed(),h=new O.nS(0,0,0!==this.touchMoveSensibility?S*this._offsetY/this.touchMoveSensibility:0);O.Matrix.RotationYawPitchRollToRef(m.rotation.y,m.rotation.x,0,m._cameraRotationMatrix),m.cameraDirection.addInPlace(O.nS.TransformCoordinates(h,m._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,l.d)([(0,M.F)()],L.prototype,"touchAngularSensibility",void 0),(0,l.d)([(0,M.F)()],L.prototype,"touchMoveSensibility",void 0),b.e.FreeCameraTouchInput=L;class U extends b.f{constructor(m){super(m),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new V),this}addMouse(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new C(m),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new n,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new L),this}clear(){super.clear(),this._mouseInput=null}}var H=h(11293),R=h(11229);class y extends u.c{get angularSensibility(){const m=this.inputs.attached.mouse;return m?m.angularSensibility:0}set angularSensibility(m){const S=this.inputs.attached.mouse;S&&(S.angularSensibility=m)}get keysUp(){const m=this.inputs.attached.keyboard;return m?m.keysUp:[]}set keysUp(m){const S=this.inputs.attached.keyboard;S&&(S.keysUp=m)}get keysUpward(){const m=this.inputs.attached.keyboard;return m?m.keysUpward:[]}set keysUpward(m){const S=this.inputs.attached.keyboard;S&&(S.keysUpward=m)}get keysDown(){const m=this.inputs.attached.keyboard;return m?m.keysDown:[]}set keysDown(m){const S=this.inputs.attached.keyboard;S&&(S.keysDown=m)}get keysDownward(){const m=this.inputs.attached.keyboard;return m?m.keysDownward:[]}set keysDownward(m){const S=this.inputs.attached.keyboard;S&&(S.keysDownward=m)}get keysLeft(){const m=this.inputs.attached.keyboard;return m?m.keysLeft:[]}set keysLeft(m){const S=this.inputs.attached.keyboard;S&&(S.keysLeft=m)}get keysRight(){const m=this.inputs.attached.keyboard;return m?m.keysRight:[]}set keysRight(m){const S=this.inputs.attached.keyboard;S&&(S.keysRight=m)}get keysRotateLeft(){const m=this.inputs.attached.keyboard;return m?m.keysRotateLeft:[]}set keysRotateLeft(m){const S=this.inputs.attached.keyboard;S&&(S.keysRotateLeft=m)}get keysRotateRight(){const m=this.inputs.attached.keyboard;return m?m.keysRotateRight:[]}set keysRotateRight(m){const S=this.inputs.attached.keyboard;S&&(S.keysRotateRight=m)}get keysRotateUp(){const m=this.inputs.attached.keyboard;return m?m.keysRotateUp:[]}set keysRotateUp(m){const S=this.inputs.attached.keyboard;S&&(S.keysRotateUp=m)}get keysRotateDown(){const m=this.inputs.attached.keyboard;return m?m.keysRotateDown:[]}set keysRotateDown(m){const S=this.inputs.attached.keyboard;S&&(S.keysRotateDown=m)}constructor(m,S,h){var l;super(m,S,h,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),l=this,this.ellipsoid=new O.nS(.5,1,.5),this.ellipsoidOffset=new O.nS(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=O.nS.Zero(),this._diffPosition=O.nS.Zero(),this._newPosition=O.nS.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l._newPosition.l(S),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>R.b.CollisionsEpsilon&&(l.position.addToRef(l._diffPosition,l._deferredPositionUpdate),l._deferOnly?l._deferredUpdated=!0:l.position.l(l._deferredPositionUpdate),l.JC&&h&&l.JC(h))},this.inputs=new U(this),this.inputs.addKeyboard().addMouse()}attachControl(m,S){S=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(S)}mZ(){this.inputs.detachElement(),this.cameraDirection=new O.nS(0,0,0),this.cameraRotation=new O.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(m){this._collisionMask=isNaN(m)?-1:m}_collideWithWorld(m){let S;S=this.parent?O.nS.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,S.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const h=this.sm().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let l=m;this.applyGravity&&(l=m.add(this.sm().gravity)),h.getNewPosition(this._oldPosition,l,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=O.nS.Zero(),this._transformedDirection=O.nS.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(m){this._needMoveForGravity=m}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.sm().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"yb"}}(0,l.d)([(0,M.B)()],y.prototype,"ellipsoid",void 0),(0,l.d)([(0,M.B)()],y.prototype,"ellipsoidOffset",void 0),(0,l.d)([(0,M.F)()],y.prototype,"checkCollisions",void 0),(0,l.d)([(0,M.F)()],y.prototype,"applyGravity",void 0),(0,H.e)("BABYLON.FreeCamera",y)},13587:(m,S,h)=>{"use strict";h.d(S,{c:()=>O});var l=h(11434),M=h(13595);class O{constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=h,this.LI=[],this._maxBlockCapacity=S||64,this._selectionContent=new l.e(1024),this._creationFunc=m}update(m,S,h){M.c._CreateBlocks(m,S,h,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}vV(m){for(let S=0;S<this.jV.length;S++){this.jV[S].addEntry(m)}}sV(m){for(let S=0;S<this.jV.length;S++){this.jV[S].removeEntry(m)}}select(m,S){this._selectionContent.reset();for(let h=0;h<this.jV.length;h++){this.jV[h].select(m,this._selectionContent,S)}return S?this._selectionContent.concat(this.LI):this._selectionContent.concatWithNoDuplicate(this.LI),this._selectionContent}intersects(m,S,h){this._selectionContent.reset();for(let l=0;l<this.jV.length;l++){this.jV[l].intersects(m,S,this._selectionContent,h)}return h?this._selectionContent.concat(this.LI):this._selectionContent.concatWithNoDuplicate(this.LI),this._selectionContent}intersectsRay(m){this._selectionContent.reset();for(let S=0;S<this.jV.length;S++){this.jV[S].intersectsRay(m,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.LI),this._selectionContent}}O.CreationFuncForMeshes=(m,S)=>{const h=m.getBoundingInfo();!m.isBlocked&&h.boundingBox.intersectsMinMax(S.oI,S.sI)&&S.entries.push(m)},O.CreationFuncForSubMeshes=(m,S)=>{m.getBoundingInfo().boundingBox.intersectsMinMax(S.oI,S.sI)&&S.entries.push(m)}},13595:(m,S,h)=>{"use strict";h.d(S,{c:()=>O});var l=h(11347),M=h(11651);class O{constructor(m,S,h,l,M,O){this.entries=[],this.vI=new Array,this._capacity=h,this._depth=l,this._maxDepth=M,this._creationFunc=O,this._minPoint=m,this._maxPoint=S,this.vI.push(m.clone()),this.vI.push(S.clone()),this.vI.push(m.clone()),this.vI[2].x=S.x,this.vI.push(m.clone()),this.vI[3].y=S.y,this.vI.push(m.clone()),this.vI[4].z=S.z,this.vI.push(S.clone()),this.vI[5].z=m.z,this.vI.push(S.clone()),this.vI[6].x=m.x,this.vI.push(S.clone()),this.vI[7].y=m.y}get KS(){return this._capacity}get oI(){return this._minPoint}get sI(){return this._maxPoint}addEntry(m){if(this.jV)for(let S=0;S<this.jV.length;S++){this.jV[S].addEntry(m)}else this._creationFunc(m,this),this.entries.length>this.KS&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(m){if(this.jV){for(let S=0;S<this.jV.length;S++){this.jV[S].removeEntry(m)}return}const S=this.entries.indexOf(m);S>-1&&this.entries.splice(S,1)}addEntries(m){for(let S=0;S<m.length;S++){const h=m[S];this.addEntry(h)}}select(m,S,h){if(M.c.IsInFrustum(this.vI,m)){if(this.jV){for(let l=0;l<this.jV.length;l++){this.jV[l].select(m,S,h)}return}h?S.concat(this.entries):S.concatWithNoDuplicate(this.entries)}}intersects(m,S,h,l){if(M.c.IntersectsSphere(this._minPoint,this._maxPoint,m,S)){if(this.jV){for(let M=0;M<this.jV.length;M++){this.jV[M].intersects(m,S,h,l)}return}l?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersectsRay(m,S){if(m.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.jV){for(let h=0;h<this.jV.length;h++){this.jV[h].intersectsRay(m,S)}return}S.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){O._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(m,S,h,M,u,b,q,Y){q.jV=new Array;const V=new l.nS((S.x-m.x)/2,(S.y-m.y)/2,(S.z-m.z)/2);for(let l=0;l<2;l++)for(let S=0;S<2;S++)for(let I=0;I<2;I++){const Z=m.add(V.multiplyByFloats(l,S,I)),C=m.add(V.multiplyByFloats(l+1,S+1,I+1)),B=new O(Z,C,M,u+1,b,Y);B.addEntries(h),q.jV.push(B)}}}},13600:(m,S,h)=>{"use strict";h.d(S,{d:()=>V});var l=h(11567),M=h(11347),O=h(11726),u=h(12735),b=h(11590),q=h(13587),Y=h(11196);l.c.prototype.createOrUpdateSelectionOctree=function(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,h=this._getComponent(b.b.NAME_OCTREE);h||(h=new V(this),this.Hh(h)),this.EI||(this.EI=new q.c(q.c.CreationFuncForMeshes,m,S));const l=this.getWorldExtends();return this.EI.update(l.min,l.max,this.meshes),this.EI},Object.defineProperty(l.c.prototype,"selectionOctree",{get:function(){return this.EI},enumerable:!0,configurable:!0}),O.e.prototype.createOrUpdateSubmeshesOctree=function(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const h=this.sm();let l=h._getComponent(b.b.NAME_OCTREE);l||(l=new V(h),h.Hh(l)),this._submeshesOctree||(this._submeshesOctree=new q.c(q.c.CreationFuncForSubMeshes,m,S)),this.Mb(!0);const M=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(M.minimumWorld,M.maximumWorld,this.CM),this._submeshesOctree};class V{constructor(m){this.name=b.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new u.d(M.nS.Zero(),new M.nS(1,1,1)),(m=m||Y.d.LastCreatedScene)&&(this.US=m,this.US.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.US.getActiveSubMeshCandidates=m=>this.getActiveSubMeshCandidates(m),this.US.getCollidingSubMeshCandidates=(m,S)=>this.getCollidingSubMeshCandidates(m,S),this.US.getIntersectingSubMeshCandidates=(m,S)=>this.getIntersectingSubMeshCandidates(m,S))}register(){this.US.onMeshRemovedObservable.add((m=>{const S=this.US.selectionOctree;if(void 0!==S&&null!==S){const h=S.LI.indexOf(m);-1!==h&&S.LI.splice(h,1)}})),this.US.onMeshImportedObservable.add((m=>{const S=this.US.selectionOctree;void 0!==S&&null!==S&&S.vV(m)}))}getActiveMeshCandidates(){var m;return(null===(m=this.US.EI)||void 0===m?void 0:m.select(this.US.frustumPlanes))||this.US._getDefaultMeshCandidates()}getActiveSubMeshCandidates(m){if(m._submeshesOctree&&m.useOctreeForRenderingSelection){return m._submeshesOctree.select(this.US.frustumPlanes)}return this.US._getDefaultSubMeshCandidates(m)}getIntersectingSubMeshCandidates(m,S){if(m._submeshesOctree&&m.useOctreeForPicking){u.d.TransformToRef(S,m.getWorldMatrix(),this._tempRay);return m._submeshesOctree.intersectsRay(this._tempRay)}return this.US._getDefaultSubMeshCandidates(m)}getCollidingSubMeshCandidates(m,S){if(m._submeshesOctree&&m.useOctreeForCollisions){const h=S._velocityWorldLength+Math.max(S._radius.x,S._radius.y,S._radius.z);return m._submeshesOctree.intersects(S._basePointWorld,h)}return this.US._getDefaultSubMeshCandidates(m)}rebuild(){}dispose(){}}},12735:(m,S,h)=>{"use strict";h.d(S,{d:()=>C});var l=h(11567),M=h(11759),O=h(11350),u=h(11347),b=h(11356),q=h(11643),Y=h(11587),V=h(11196),I=h(11600);const Z={internalPickerForMesh:void 0};class C{constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.d;this.origin=m,this.direction=S,this.length=h,this.epsilon=l}clone(){return new C(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l=C._TmpVector3[0].Yb(m.x-h,m.y-h,m.z-h),M=C._TmpVector3[1].Yb(S.x+h,S.y+h,S.z+h);let O,u,b,q,Y=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<l.x||this.origin.x>M.x)return!1}else if(O=1/this.direction.x,u=(l.x-this.origin.x)*O,b=(M.x-this.origin.x)*O,b===-1/0&&(b=1/0),u>b&&(q=u,u=b,b=q),Y=Math.max(u,Y),V=Math.min(b,V),Y>V)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<l.y||this.origin.y>M.y)return!1}else if(O=1/this.direction.y,u=(l.y-this.origin.y)*O,b=(M.y-this.origin.y)*O,b===-1/0&&(b=1/0),u>b&&(q=u,u=b,b=q),Y=Math.max(u,Y),V=Math.min(b,V),Y>V)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<l.z||this.origin.z>M.z)return!1}else if(O=1/this.direction.z,u=(l.z-this.origin.z)*O,b=(M.z-this.origin.z)*O,b===-1/0&&(b=1/0),u>b&&(q=u,u=b,b=q),Y=Math.max(u,Y),V=Math.min(b,V),Y>V)return!1;return!0}intersectsBox(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(m.minimum,m.maximum,S)}intersectsSphere(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=m.center.x-this.origin.x,l=m.center.y-this.origin.y,M=m.center.z-this.origin.z,O=h*h+l*l+M*M,u=m.radius+S,b=u*u;if(O<=b)return!0;const q=h*this.direction.x+l*this.direction.y+M*this.direction.z;if(q<0)return!1;return O-q*q<=b}intersectsTriangle(m,S,h){const l=C._TmpVector3[0],M=C._TmpVector3[1],O=C._TmpVector3[2],b=C._TmpVector3[3],Y=C._TmpVector3[4];S.subtractToRef(m,l),h.subtractToRef(m,M),u.nS.CrossToRef(this.direction,M,O);const V=u.nS.Dot(l,O);if(0===V)return null;const I=1/V;this.origin.subtractToRef(m,b);const Z=u.nS.Dot(b,O)*I;if(Z<-this.epsilon||Z>1+this.epsilon)return null;u.nS.CrossToRef(b,l,Y);const B=u.nS.Dot(this.direction,Y)*I;if(B<-this.epsilon||Z+B>1+this.epsilon)return null;const D=u.nS.Dot(M,Y)*I;return D>this.length?null:new q.c(1-Z-B,Z,D)}intersectsPlane(m){let S;const h=u.nS.Dot(m.normal,this.direction);if(Math.abs(h)<9.99999997475243e-7)return null;{const l=u.nS.Dot(m.normal,this.origin);return S=(-m.d-l)/h,S<0?S<-9.99999997475243e-7?null:0:S}}intersectsAxis(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(m){case"y":{const m=(this.origin.y-S)/this.direction.y;return m>0?null:new u.nS(this.origin.x+this.direction.x*-m,S,this.origin.z+this.direction.z*-m)}case"x":{const m=(this.origin.x-S)/this.direction.x;return m>0?null:new u.nS(S,this.origin.y+this.direction.y*-m,this.origin.z+this.direction.z*-m)}case"z":{const m=(this.origin.z-S)/this.direction.z;return m>0?null:new u.nS(this.origin.x+this.direction.x*-m,this.origin.y+this.direction.y*-m,S)}default:return null}}intersectsMesh(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=u.TmpVectors.Matrix[0];return m.getWorldMatrix().invertToRef(b),this._tmpRay?C.TransformToRef(this,b,this._tmpRay):this._tmpRay=C.Transform(this,b),m.intersects(this._tmpRay,S,h,l,M,O)}intersectsMeshes(m,S,h){h?h.length=0:h=[];for(let l=0;l<m.length;l++){const M=this.intersectsMesh(m[l],S);M.hit&&h.push(M)}return h.sort(this._comparePickingInfo),h}_comparePickingInfo(m,S){return m.distance<S.distance?-1:m.distance>S.distance?1:0}intersectionSegment(m,S,h){const l=this.origin,M=u.TmpVectors.nS[0],O=u.TmpVectors.nS[1],b=u.TmpVectors.nS[2],q=u.TmpVectors.nS[3];S.subtractToRef(m,M),this.direction.scaleToRef(C._Rayl,b),l.addToRef(b,O),m.subtractToRef(l,q);const Y=u.nS.Dot(M,M),V=u.nS.Dot(M,b),I=u.nS.Dot(b,b),Z=u.nS.Dot(M,q),B=u.nS.Dot(b,q),D=Y*I-V*V;let E,n,L=D,U=D;D<C._Smallnum?(E=0,L=1,n=B,U=I):(E=V*B-I*Z,n=Y*B-V*Z,E<0?(E=0,n=B,U=I):E>L&&(E=L,n=B+V,U=I)),n<0?(n=0,-Z<0?E=0:-Z>Y?E=L:(E=-Z,L=Y)):n>U&&(n=U,-Z+V<0?E=0:-Z+V>Y?E=L:(E=-Z+V,L=Y));const H=Math.abs(E)<C._Smallnum?0:E/L,R=Math.abs(n)<C._Smallnum?0:n/U,y=u.TmpVectors.nS[4];b.scaleToRef(R,y);const o=u.TmpVectors.nS[5];M.scaleToRef(H,o),o.addInPlace(q);const s=u.TmpVectors.nS[6];o.subtractToRef(y,s);return R>0&&R<=this.length&&s.lengthSquared()<h*h?o.length():-1}update(m,S,h,l,M,O,b){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){C._RayDistant||(C._RayDistant=C.Zero()),C._RayDistant.unprojectRayToRef(m,S,h,l,u.Matrix.IdentityReadOnly,O,b);const q=u.TmpVectors.Matrix[0];M.invertToRef(q),C.TransformToRef(C._RayDistant,q,this)}else this.unprojectRayToRef(m,S,h,l,M,O,b);return this}static Zero(){return new C(u.nS.Zero(),u.nS.Zero())}static CreateNew(m,S,h,l,M,O,u){return C.Zero().update(m,S,h,l,M,O,u)}static CreateNewFromTo(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.Matrix.IdentityReadOnly;const l=new C(new u.nS(0,0,0),new u.nS(0,0,0));return C.CreateFromToToRef(m,S,l,h)}static CreateFromToToRef(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.Matrix.IdentityReadOnly;h.origin.l(m);const M=S.subtractToRef(m,h.direction),O=Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z);return h.length=O,h.direction.normalize(),C.TransformToRef(h,l,h)}static Transform(m,S){const h=new C(new u.nS(0,0,0),new u.nS(0,0,0));return C.TransformToRef(m,S,h),h}static TransformToRef(m,S,h){u.nS.TransformCoordinatesToRef(m.origin,S,h.origin),u.nS.TransformNormalToRef(m.direction,S,h.direction),h.length=m.length,h.epsilon=m.epsilon;const l=h.direction,M=l.length();if(0!==M&&1!==M){const m=1/M;l.x*=m,l.y*=m,l.z*=m,h.length*=M}return h}unprojectRayToRef(m,S,h,l,M,O,b){const q=u.TmpVectors.Matrix[0];M.multiplyToRef(O,q),q.multiplyToRef(b,q),q.invert();const Y=V.d.LastCreatedEngine,I=u.TmpVectors.nS[0];I.x=m/h*2-1,I.y=-(S/l*2-1),I.z=null!==Y&&void 0!==Y&&Y.useReverseDepthBuffer?1:null!==Y&&void 0!==Y&&Y.isNDCHalfZRange?0:-1;const Z=u.TmpVectors.nS[1].Yb(I.x,I.y,1-1e-8),C=u.TmpVectors.nS[2],B=u.TmpVectors.nS[3];u.nS._UnprojectFromInvertedMatrixToRef(I,q,C),u.nS._UnprojectFromInvertedMatrixToRef(Z,q,B),this.origin.l(C),B.subtractToRef(C,this.direction),this.direction.normalize()}}function B(m,S,h,l,M){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=C.Zero();return D(m,S,h,l,u,M,O),u}function D(m,S,h,l,M,O){let b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Y=m.getEngine();if(!O&&!(O=m.activeCamera))return m;const V=O.viewport,I=Y.getRenderHeight(),{x:Z,y:C,width:B,height:D}=V.toGlobal(Y.getRenderWidth(),I),E=1/Y.getHardwareScalingLevel();return S=S*E-Z,h=h*E-(I-C-D),M.update(S,h,B,D,l||u.Matrix.IdentityReadOnly,b?u.Matrix.IdentityReadOnly:O.getViewMatrix(),O.getProjectionMatrix(),q),m}function E(m,S,h,l,M){if(!Y.e)return m;const O=m.getEngine();if(!M&&!(M=m.activeCamera))throw new Error("Active camera not set");const b=M.viewport,q=O.getRenderHeight(),{x:V,y:I,width:Z,height:C}=b.toGlobal(O.getRenderWidth(),q),B=u.Matrix.Identity(),D=1/O.getHardwareScalingLevel();return S=S*D-V,h=h*D-(q-I-C),l.update(S,h,Z,C,B,B,M.getProjectionMatrix()),m}function n(m,S,h,l,M,O,u,b){const q=S(l,h.enableDistantPicking),Y=h.intersects(q,M,u,O,l,b);return Y&&Y.hit?!M&&null!=m&&Y.distance>=m.distance?null:Y:null}function L(m,S,h,l,M,O){let b=null;const q=!!(m.activeCameras&&m.activeCameras.length>1&&m.cameraToUseForPointers!==m.activeCamera),V=m.cameraToUseForPointers||m.activeCamera,I=Z.internalPickerForMesh||n;for(let Y=0;Y<m.meshes.length;Y++){const Z=m.meshes[Y];if(h){if(!h(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.qY)continue;const C=q&&Z.isWorldMatrixCameraDependent(),B=Z.Mb(C,V);if(Z.hasThinInstances&&Z.pY){const m=I(b,S,Z,B,!0,!0,O);if(m){if(M)return m;const q=u.TmpVectors.Matrix[1],Y=Z.thinInstanceGetWorldMatrices();for(let m=0;m<Y.length;m++){if(h&&!h(Z,m))continue;Y[m].multiplyToRef(B,q);const u=I(b,S,Z,q,l,M,O,!0);if(u&&(b=u,b.thinInstanceIndex=m,l))return b}}}else{const m=I(b,S,Z,B,l,M,O);if(m&&(b=m,l))return b}}return b||new Y.e}function U(m,S,h,l){if(!Y.e)return null;const M=[],O=!!(m.activeCameras&&m.activeCameras.length>1&&m.cameraToUseForPointers!==m.activeCamera),b=m.cameraToUseForPointers||m.activeCamera,q=Z.internalPickerForMesh||n;for(let Y=0;Y<m.meshes.length;Y++){const V=m.meshes[Y];if(h){if(!h(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.qY)continue;const I=O&&V.isWorldMatrixCameraDependent(),Z=V.Mb(I,b);if(V.hasThinInstances&&V.pY){if(q(null,S,V,Z,!0,!0,l)){const m=u.TmpVectors.Matrix[1],O=V.thinInstanceGetWorldMatrices();for(let u=0;u<O.length;u++){if(h&&!h(V,u))continue;O[u].multiplyToRef(Z,m);const b=q(null,S,V,m,!1,!1,l,!0);b&&(b.thinInstanceIndex=u,M.push(b))}}}else{const m=q(null,S,V,Z,!1,!1,l);m&&M.push(m)}}return M}function H(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l=arguments.length>3?arguments[3]:void 0,M=arguments.length>4?arguments[4]:void 0;l||(l=m.getWorldMatrix()),S.length=h,M?S.origin.l(M):S.origin.l(m.position);const O=u.TmpVectors.nS[2];O.set(0,0,m._scene.useRightHandedSystem?-1:1);const b=u.TmpVectors.nS[3];return u.nS.TransformNormalToRef(O,l,b),u.nS.NormalizeToRef(b,S.direction),S}var R,y;C._TmpVector3=(0,b.e)(6,u.nS.Zero),C._RayDistant=C.Zero(),C._Smallnum=1e-8,C._Rayl=1e9,R=l.c,(y=M.d)&&(y.prototype.getForwardRay=function(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,S=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return H(this,new C(u.nS.Zero(),u.nS.Zero(),m),m,S,h)},y.prototype.getForwardRayToRef=function(m){return H(this,m,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),R&&(I.e._IsPickingAvailable=!0,R.prototype.createPickingRay=function(m,S,h,l){return B(this,m,S,h,l,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),l.c.prototype.createPickingRayToRef=function(m,S,h,l,M){return D(this,m,S,h,l,M,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},l.c.prototype.createPickingRayInCameraSpace=function(m,S,h){return function(m,S,h,l){const M=C.Zero();return E(m,S,h,M,l),M}(this,m,S,h)},l.c.prototype.createPickingRayInCameraSpaceToRef=function(m,S,h,l){return E(this,m,S,h,l)},l.c.prototype.pickWithBoundingInfo=function(m,S,h,l,M){return function(m,S,h,l,M,O){if(!Y.e)return null;const b=L(m,(l=>(m._tempPickingRay||(m._tempPickingRay=C.Zero()),D(m,S,h,l,m._tempPickingRay,O||null),m._tempPickingRay)),l,M,!0);return b&&(b.ray=B(m,S,h,u.Matrix.Identity(),O||null)),b}(this,m,S,h,l,M)},l.c.prototype.Rh=function(m,S,h,l,M,O){return function(m,S,h,l,M,O,b){const q=L(m,((l,M)=>(m._tempPickingRay||(m._tempPickingRay=C.Zero()),D(m,S,h,l,m._tempPickingRay,O||null,!1,M),m._tempPickingRay)),l,M,!1,b);return q&&(q.ray=B(m,S,h,u.Matrix.Identity(),O||null)),q}(this,m,S,h,l,M,O)},l.c.prototype.pickWithRay=function(m,S,h,l){return function(m,S,h,l,M){const O=L(m,(h=>(m._pickWithRayInverseMatrix||(m._pickWithRayInverseMatrix=u.Matrix.Identity()),h.invertToRef(m._pickWithRayInverseMatrix),m._cachedRayForTransform||(m._cachedRayForTransform=C.Zero()),C.TransformToRef(S,m._pickWithRayInverseMatrix,m._cachedRayForTransform),m._cachedRayForTransform)),h,l,!1,M);return O&&(O.ray=S),O}(this,m,S,h,l)},l.c.prototype.multiPick=function(m,S,h,l,M){return function(m,S,h,l,M,O){return U(m,(l=>B(m,S,h,l,M||null)),l,O)}(this,m,S,h,l,M)},l.c.prototype.multiPickWithRay=function(m,S,h){return function(m,S,h,l){return U(m,(h=>(m._pickWithRayInverseMatrix||(m._pickWithRayInverseMatrix=u.Matrix.Identity()),h.invertToRef(m._pickWithRayInverseMatrix),m._cachedRayForTransform||(m._cachedRayForTransform=C.Zero()),C.TransformToRef(S,m._pickWithRayInverseMatrix,m._cachedRayForTransform),m._cachedRayForTransform)),h,l)}(this,m,S,h)}},13027:(m,S,h)=>{"use strict";var l=h(11262),M=h(11173),O=h(11205),u=h(11302),b=h(11229),q=h(11278);b.b.prototype._partialLoadFile=function(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(m,(m=>{h[S]=m,h._internalCount++,6===h._internalCount&&l(h)}),void 0,void 0,!0,((m,S)=>{M&&m&&M(m.status+" "+m.statusText,S)}))},b.b.prototype._cascadeLoadFiles=function(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const M=[];M._internalCount=0;for(let O=0;O<6;O++)this._partialLoadFile(h[O],O,M,S,l)},b.b.prototype._cascadeLoadImgs=function(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5?arguments[5]:void 0;const u=[];u._internalCount=0;for(let b=0;b<6;b++)this._partialLoadImg(l[b],b,u,m,S,h,M,O)},b.b.prototype._partialLoadImg=function(m,S,h,l,M,b){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7?arguments[7]:void 0;const V=(0,u.b)();(0,O.u)(m,(m=>{h[S]=m,h._internalCount++,l&&l.removePendingData(V),6===h._internalCount&&b&&b(M,h)}),((m,S)=>{l&&l.removePendingData(V),q&&q(m,S)}),l?l.offlineProvider:null,Y),l&&l.addPendingData(V)},b.b.prototype.createCubeTextureBase=function(m,S,h,O){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,D=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,E=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,n=arguments.length>14&&void 0!==arguments[14]&&arguments[14],L=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const U=B||new l.d(this,7);U.isCube=!0,U.url=m,U.generateMipMaps=!O,U._lodGenerationScale=Z,U._lodGenerationOffset=C,U._useSRGBBuffer=!!n&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!O),U!==B&&(U.label=m.substring(0,60)),this._doNotHandleContextLost||(U._extension=V,U._files=h,U._buffer=L);const H=m;this._transformTextureUrl&&!B&&(m=this._transformTextureUrl(m));const R=V??function(m){const S=m.split("?")[0],h=S.lastIndexOf(".");return h>-1?S.substring(h).toLowerCase():""}(m),y=(0,q.c)(R),o=(m,S)=>{U.dispose(),b?b(m,S):m&&M.e.Warn(m)},s=(l,b)=>{m===H?l&&o(l.status+" "+l.statusText,b):(M.e.Warn(`Failed to load ${m}, falling back to the ${H}`),this.createCubeTextureBase(H,S,h,!!O,u,o,Y,V,I,Z,C,U,D,E,n,L))};if(y)y.then((l=>{const M=m=>{D&&D(U,m),l.loadCubeData(m,U,I,u,((m,S)=>{o(m,S)}))};L?M(L):h&&6===h.length?l.supportCascades?this._cascadeLoadFiles(S,(m=>M(m.map((m=>new Uint8Array(m))))),h,o):o("Textures type does not support cascades."):this._loadFile(m,(m=>M(new Uint8Array(m))),void 0,void 0,!0,s)}));else{if(!h||0===h.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(S,U,((m,S)=>{E&&E(m,S)}),h,o)}return this._internalTexturesCache.push(U),U}},13605:(m,S,h)=>{"use strict";h(11173);var l=h(11456);h(11262),h(11414),h(11259),h(11510),h(11467);l.d},13056:(m,S,h)=>{"use strict";h.d(S,{b:()=>M});var l=h(11293);class M{constructor(m){this.value=this._toInt(m)}_toInt(m){return 0|m}add(m){return new M(this.value+m.value)}LS(m){return new M(this.value-m.value)}multiply(m){return new M(Math.imul(this.value,m.value))}divide(m){return new M(this.value/m.value)}getClassName(){return M.ClassName}equals(m){return this.value===m.value}static FromValue(m){return new M(m)}toString(){return this.value.toString()}}M.ClassName="FlowGraphInteger",(0,l.e)("FlowGraphInteger",M)},13065:(m,S,h)=>{"use strict";h.d(S,{d:()=>M,e:()=>O});var l=h(11347);class M{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ph=m}get m(){return this.ph}transformVector(m){return this.transformVectorToRef(m,new l.Vector2)}transformVectorToRef(m,S){return S.x=m.x*this.ph[0]+m.y*this.ph[1],S.y=m.x*this.ph[2]+m.y*this.ph[3],S}DM(){return this.toArray()}toArray(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let S=0;S<4;S++)m[S]=this.ph[S];return m}yh(m){for(let S=0;S<4;S++)this.ph[S]=m[S];return this}multiplyToRef(m,S){const h=m.ph,l=this.ph,M=S.ph;return M[0]=h[0]*l[0]+h[1]*l[2],M[1]=h[0]*l[1]+h[1]*l[3],M[2]=h[2]*l[0]+h[3]*l[2],M[3]=h[2]*l[1]+h[3]*l[3],S}multiply(m){return this.multiplyToRef(m,new M)}divideToRef(m,S){const h=this.ph,l=m.ph,M=S.ph;return M[0]=h[0]/l[0],M[1]=h[1]/l[1],M[2]=h[2]/l[2],M[3]=h[3]/l[3],S}divide(m){return this.divideToRef(m,new M)}addToRef(m,S){const h=this.ph,l=m.m,M=S.m;return M[0]=h[0]+l[0],M[1]=h[1]+l[1],M[2]=h[2]+l[2],M[3]=h[3]+l[3],S}add(m){return this.addToRef(m,new M)}subtractToRef(m,S){const h=this.ph,l=m.m,M=S.m;return M[0]=h[0]-l[0],M[1]=h[1]-l[1],M[2]=h[2]-l[2],M[3]=h[3]-l[3],S}LS(m){return this.subtractToRef(m,new M)}transpose(){const m=this.ph;return new M([m[0],m[2],m[1],m[3]])}determinant(){const m=this.ph;return m[0]*m[3]-m[1]*m[2]}inverse(){const m=this.determinant();if(0===m)throw new Error("Matrix is not invertible");const S=this.ph,h=1/m;return new M([S[3]*h,-S[1]*h,-S[2]*h,S[0]*h])}equals(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.ph,l=m.m;return 0===S?h[0]===l[0]&&h[1]===l[1]&&h[2]===l[2]&&h[3]===l[3]:Math.abs(h[0]-l[0])<S&&Math.abs(h[1]-l[1])<S&&Math.abs(h[2]-l[2])<S&&Math.abs(h[3]-l[3])<S}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ph.join(", ")})`}}class O{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ph=m}get m(){return this.ph}transformVector(m){return this.transformVectorToRef(m,new l.nS)}transformVectorToRef(m,S){const h=this.ph;return S.x=m.x*h[0]+m.y*h[1]+m.z*h[2],S.y=m.x*h[3]+m.y*h[4]+m.z*h[5],S.z=m.x*h[6]+m.y*h[7]+m.z*h[8],S}multiplyToRef(m,S){const h=m.ph,l=this.ph,M=S.m;return M[0]=h[0]*l[0]+h[1]*l[3]+h[2]*l[6],M[1]=h[0]*l[1]+h[1]*l[4]+h[2]*l[7],M[2]=h[0]*l[2]+h[1]*l[5]+h[2]*l[8],M[3]=h[3]*l[0]+h[4]*l[3]+h[5]*l[6],M[4]=h[3]*l[1]+h[4]*l[4]+h[5]*l[7],M[5]=h[3]*l[2]+h[4]*l[5]+h[5]*l[8],M[6]=h[6]*l[0]+h[7]*l[3]+h[8]*l[6],M[7]=h[6]*l[1]+h[7]*l[4]+h[8]*l[7],M[8]=h[6]*l[2]+h[7]*l[5]+h[8]*l[8],S}multiply(m){return this.multiplyToRef(m,new O)}divideToRef(m,S){const h=this.ph,l=m.m,M=S.m;return M[0]=h[0]/l[0],M[1]=h[1]/l[1],M[2]=h[2]/l[2],M[3]=h[3]/l[3],M[4]=h[4]/l[4],M[5]=h[5]/l[5],M[6]=h[6]/l[6],M[7]=h[7]/l[7],M[8]=h[8]/l[8],S}divide(m){return this.divideToRef(m,new O)}addToRef(m,S){const h=this.ph,l=m.m,M=S.m;return M[0]=h[0]+l[0],M[1]=h[1]+l[1],M[2]=h[2]+l[2],M[3]=h[3]+l[3],M[4]=h[4]+l[4],M[5]=h[5]+l[5],M[6]=h[6]+l[6],M[7]=h[7]+l[7],M[8]=h[8]+l[8],S}add(m){return this.addToRef(m,new O)}subtractToRef(m,S){const h=this.ph,l=m.m,M=S.m;return M[0]=h[0]-l[0],M[1]=h[1]-l[1],M[2]=h[2]-l[2],M[3]=h[3]-l[3],M[4]=h[4]-l[4],M[5]=h[5]-l[5],M[6]=h[6]-l[6],M[7]=h[7]-l[7],M[8]=h[8]-l[8],S}LS(m){return this.subtractToRef(m,new O)}toArray(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let S=0;S<9;S++)m[S]=this.ph[S];return m}DM(){return this.toArray()}yh(m){for(let S=0;S<9;S++)this.ph[S]=m[S];return this}transpose(){const m=this.ph;return new O([m[0],m[3],m[6],m[1],m[4],m[7],m[2],m[5],m[8]])}determinant(){const m=this.ph;return m[0]*(m[4]*m[8]-m[5]*m[7])-m[1]*(m[3]*m[8]-m[5]*m[6])+m[2]*(m[3]*m[7]-m[4]*m[6])}inverse(){const m=this.determinant();if(0===m)throw new Error("Matrix is not invertible");const S=this.ph,h=1/m;return new O([(S[4]*S[8]-S[5]*S[7])*h,(S[2]*S[7]-S[1]*S[8])*h,(S[1]*S[5]-S[2]*S[4])*h,(S[5]*S[6]-S[3]*S[8])*h,(S[0]*S[8]-S[2]*S[6])*h,(S[2]*S[3]-S[0]*S[5])*h,(S[3]*S[7]-S[4]*S[6])*h,(S[1]*S[6]-S[0]*S[7])*h,(S[0]*S[4]-S[1]*S[3])*h])}equals(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.ph,l=m.m;return 0===S?h[0]===l[0]&&h[1]===l[1]&&h[2]===l[2]&&h[3]===l[3]&&h[4]===l[4]&&h[5]===l[5]&&h[6]===l[6]&&h[7]===l[7]&&h[8]===l[8]:Math.abs(h[0]-l[0])<S&&Math.abs(h[1]-l[1])<S&&Math.abs(h[2]-l[2])<S&&Math.abs(h[3]-l[3])<S&&Math.abs(h[4]-l[4])<S&&Math.abs(h[5]-l[5])<S&&Math.abs(h[6]-l[6])<S&&Math.abs(h[7]-l[7])<S&&Math.abs(h[8]-l[8])<S}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ph.join(", ")})`}}},13068:(m,S,h)=>{"use strict";var l;function M(m,S,h,l){switch(S){case"Animation":return l?m.animations.find((m=>m.uniqueId===h))??null:m.animations[h]??null;case"AnimationGroup":return l?m.animationGroups.find((m=>m.uniqueId===h))??null:m.animationGroups[h]??null;case"Mesh":return l?m.meshes.find((m=>m.uniqueId===h))??null:m.meshes[h]??null;case"Material":return l?m.materials.find((m=>m.uniqueId===h))??null:m.materials[h]??null;case"PV":return l?m.cameras.find((m=>m.uniqueId===h))??null:m.cameras[h]??null;case"Light":return l?m.lights.find((m=>m.uniqueId===h))??null:m.lights[h]??null;default:return null}}h.d(S,{e:()=>M}),function(m){m.Animation="Animation",m.AnimationGroup="AnimationGroup",m.Mesh="Mesh",m.Material="Material",m.PV="PV",m.Light="Light"}(l||(l={}))},13100:(m,S,h)=>{"use strict";h.d(S,{e:()=>M});var l=h(13107);class M extends l.c{constructor(m,S){if(super(m),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),S)for(const h of S)this._eventsSignalOutputs[h]=this._registerSignalOutput(h+"Event")}_executeOnTick(m){}_startPendingTasks(m){m._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(m),this._resetAfterCanceled(m)),this._preparePendingTasks(m),m._addPendingBlock(this),this.out._activateSignal(m),m._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(m){m._deleteExecutionVariable(this,"_initialized"),m._removePendingBlock(this)}}},13074:(m,S,h)=>{"use strict";h.d(S,{d:()=>Y});var l=h(11302),M=h(11293),O=h(13081),u=h(11161),b=h(13047);class q extends O.d{constructor(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.defaultValue,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(m,S,h),this.richType=l,this._defaultValue=M,this._optional=O,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new u.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(m){this._isDisabled!==m&&(this._isDisabled=m,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(m,S){S._getConnectionValue(this)!==m&&(S._setConnectionValue(this,m),this.onValueChangedObservable.notifyObservers(m))}resetToDefaultValue(m){m._setConnectionValue(this,this._defaultValue)}connectTo(m){this._isDisabled||super.connectTo(m)}_getValueOrDefault(m){const S=m._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(S):S}getValue(m){if(1===this.connectionType){m._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(m);const S=this._getValueOrDefault(m);return this._lastValue=S,this.richType.typeTransformer?this.richType.typeTransformer(S):S}const S=this.isConnected()?this._connectedPoint[0].getValue(m):this._getValueOrDefault(m);return this._lastValue=S,this.richType.typeTransformer?this.richType.typeTransformer(S):S}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(m),m.richType={},this.richType.serialize(m.richType),m.optional=this._optional,(0,b.f)("defaultValue",this._defaultValue,m)}}(0,M.e)("FlowGraphDataConnection",q);class Y{constructor(m){var S;this.config=m,this.uniqueId=(0,l.b)(),this.name=(null===(S=this.config)||void 0===S?void 0:S.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(m){}registerDataInput(m,S,h){const l=new q(m,0,this,S,h);return this.dataInputs.push(l),l}registerDataOutput(m,S,h){const l=new q(m,1,this,S,h);return this.dataOutputs.push(l),l}getDataInput(m){return this.dataInputs.find((S=>S.name===m))}getDataOutput(m){return this.dataOutputs.find((S=>S.name===m))}serialize(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.f;if(m.uniqueId=this.uniqueId,m.config={},this.config){const h=this.config,l=Object.keys(h);for(const M of l)S(M,h[M],m.config)}m.dataInputs=[],m.dataOutputs=[],m.className=this.getClassName();for(const h of this.dataInputs){const S={};h.serialize(S),m.dataInputs.push(S)}for(const h of this.dataOutputs){const S={};h.serialize(S),m.dataOutputs.push(S)}}deserialize(m){}_log(m,S,h){var l;null===(l=m.logger)||void 0===l||l.addLogItem({action:S,oh:h,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13081:(m,S,h)=>{"use strict";h.d(S,{d:()=>O});var l,M=h(11302);!function(m){m[m.Input=0]="Input",m[m.Output=1]="Output"}(l||(l={}));class O{constructor(m,S,h){this._ownerBlock=h,this._connectedPoint=[],this.uniqueId=(0,M.b)(),this.connectedPointIds=[],this.name=m,this._connectionType=S}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(m){if(this._connectionType===m._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||m._isSingularConnection()&&m._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(m),m._connectedPoint.push(this)}disconnectFrom(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this._connectedPoint.indexOf(m),l=m._connectedPoint.indexOf(this);-1!==h&&-1!==l&&(S&&this._connectedPoint.splice(h,1),m._connectedPoint.splice(l,1))}disconnectFromAll(){for(const m of this._connectedPoint)this.disconnectFrom(m,!1);this._connectedPoint.length=0}dispose(){for(const m of this._connectedPoint)this.disconnectFrom(m)}serialize(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.uniqueId=this.uniqueId,m.name=this.name,m._connectionType=this._connectionType,m.connectedPointIds=[],m.className=this.getClassName();for(const S of this._connectedPoint)m.connectedPointIds.push(S.uniqueId)}getClassName(){return"FGConnection"}deserialize(m){this.uniqueId=m.uniqueId,this.name=m.name,this._connectionType=m._connectionType,this.connectedPointIds=m.connectedPointIds}}},13045:(m,S,h)=>{"use strict";h.d(S,{b:()=>U});var l,M=h(11161),O=h(11327),u=h(11336),b=h(11302),q=h(13047),Y=h(13068),V=h(11173);!function(m){m.ExecuteBlock="ExecuteBlock",m.ExecuteEvent="ExecuteEvent",m.TriggerConnection="TriggerConnection",m.ContextVariableSet="ContextVariableSet",m.GlobalVariableSet="GlobalVariableSet",m.GlobalVariableDelete="GlobalVariableDelete",m.GlobalVariableGet="GlobalVariableGet",m.AddConnection="AddConnection",m.GetConnectionValue="GetConnectionValue",m.SetConnectionValue="SetConnectionValue",m.ActivateSignal="ActivateSignal",m.ContextVariableGet="ContextVariableGet"}(l||(l={}));class I{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(m){if(m.time||(m.time=Date.now()),this.log.push(m),this.logToConsole){var S;const h=null===(S=m.oh)||void 0===S?void 0:S.value;"object"===typeof h&&h.getClassName?V.e.Log(`[FGLog] ${m.className}:${m.uniqueId.split("-")[0]} ${m.action} - ${JSON.stringify(h.getClassName())}: ${h.toString()}`):V.e.Log(`[FGLog] ${m.className}:${m.uniqueId.split("-")[0]} ${m.action} - ${JSON.stringify(m.oh)}`)}}getItemsOfType(m){return this.log.filter((S=>S.action===m))}}class Z{get enableLogging(){return this._enableLogging}set enableLogging(m){this._enableLogging!==m&&(this._enableLogging=m,this._enableLogging?(this.logger=new I,this.logger.logToConsole=!0):this.logger=null)}constructor(m){this.uniqueId=(0,b.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new M.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=m,this.assetsContext=m.assetsContext??m.US}hasVariable(m){return m in this._userVariables}setVariable(m,S){var h;this._userVariables[m]=S,null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",oh:{name:m,value:S}})}getAsset(m,S){return(0,Y.e)(this.assetsContext,m,S)}getVariable(m){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",oh:{name:m,value:this._userVariables[m]}}),this._userVariables[m]}get userVariables(){return this._userVariables}sm(){return this._configuration.US}_getUniqueIdPrefixedName(m,S){return`${m.uniqueId}_${S}`}_getGlobalContextVariable(m,S){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",oh:{name:m,defaultValue:S,possibleValue:this._globalContextVariables[m]}}),this._hasGlobalContextVariable(m)?this._globalContextVariables[m]:S}_setGlobalContextVariable(m,S){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",oh:{name:m,value:S}}),this._globalContextVariables[m]=S}_deleteGlobalContextVariable(m){var S;null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",oh:{name:m}}),delete this._globalContextVariables[m]}_hasGlobalContextVariable(m){return m in this._globalContextVariables}_setExecutionVariable(m,S,h){this._executionVariables[this._getUniqueIdPrefixedName(m,S)]=h}_getExecutionVariable(m,S,h){return this._hasExecutionVariable(m,S)?this._executionVariables[this._getUniqueIdPrefixedName(m,S)]:h}_deleteExecutionVariable(m,S){delete this._executionVariables[this._getUniqueIdPrefixedName(m,S)]}_hasExecutionVariable(m,S){return this._getUniqueIdPrefixedName(m,S)in this._executionVariables}_hasConnectionValue(m){return m.uniqueId in this._connectionValues}_setConnectionValue(m,S){var h;this._connectionValues[m.uniqueId]=S,null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",oh:{connectionPointId:m.uniqueId,value:S}})}_setConnectionValueByKey(m,S){this._connectionValues[m]=S}_getConnectionValue(m){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",oh:{connectionPointId:m.uniqueId,value:this._connectionValues[m.uniqueId]}}),this._connectionValues[m.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(m){this._pendingBlocks.includes(m)||(this._pendingBlocks.push(m),this._pendingBlocks.sort(((m,S)=>m.priority-S.priority)))}_removePendingBlock(m){const S=this._pendingBlocks.indexOf(m);-1!==S&&this._pendingBlocks.splice(S,1)}_clearPendingBlocks(){for(const m of this._pendingBlocks)m._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(m){var S;this.onNodeExecutedObservable.notifyObservers(m),null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:m.getClassName(),uniqueId:m.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(m){this._setGlobalContextVariable("timeSinceStart",m.timeSinceStart),this._setGlobalContextVariable("deltaTime",m.deltaTime);for(const h of this._pendingBlocks){var S;null===(S=h._executeOnTick)||void 0===S||S.call(h,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.f;m.uniqueId=this.uniqueId,m._userVariables={};for(const l in this._userVariables)S(l,this._userVariables[l],m._userVariables);m._connectionValues={};for(const l in this._connectionValues)S(l,this._connectionValues[l],m._connectionValues);var h;this.assetsContext!==this.sm()&&(m._assetsContext={meshes:this.assetsContext.meshes.map((m=>m.id)),materials:this.assetsContext.materials.map((m=>m.id)),textures:this.assetsContext.textures.map((m=>m.name)),animations:this.assetsContext.animations.map((m=>m.name)),lights:this.assetsContext.lights.map((m=>m.id)),cameras:this.assetsContext.cameras.map((m=>m.id)),SC:null===(h=this.assetsContext.SC)||void 0===h?void 0:h.map((m=>m.name)),skeletons:this.assetsContext.skeletons.map((m=>m.id)),UZ:this.assetsContext.UZ.map((m=>m.name)),geometries:this.assetsContext.geometries.map((m=>m.id)),multiMaterials:this.assetsContext.multiMaterials.map((m=>m.id)),transformNodes:this.assetsContext.transformNodes.map((m=>m.id))})}getClassName(){return"FlowGraphContext"}}(0,O.d)([(0,u.F)()],Z.prototype,"uniqueId",void 0);var C=h(13071),B=h(11592);class D{constructor(m){this.onEventTriggeredObservable=new M.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=m,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Jh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const m=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",oh:{timeSinceStart:this._startingTime,deltaTime:m}}),this._startingTime+=m})),this._meshPickedObserver=this._scene.onPointerObservable.add((m=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",oh:m})}),B.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((m=>{const S=m.pointerId,h=m.mesh,l=this._pointerUnderMeshState[S];!l&&h?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",oh:{pointerId:S,mesh:h}}):l&&!h?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",oh:{pointerId:S,mesh:l}}):l&&h&&l!==h&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",oh:{pointerId:S,mesh:l,over:h}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",oh:{pointerId:S,mesh:h,out:l}})),this._pointerUnderMeshState[S]=h}),B.b.POINTERMOVE)}dispose(){var m,S,h,l,M;null===(m=this._sceneDisposeObserver)||void 0===m||m.remove(),null===(S=this._sceneReadyObserver)||void 0===S||S.remove(),null===(h=this._sceneOnBeforeRenderObserver)||void 0===h||h.remove(),null===(l=this._meshPickedObserver)||void 0===l||l.remove(),null===(M=this._meshUnderPointerObserver)||void 0===M||M.remove(),this.onEventTriggeredObservable.clear()}}var E,n=h(13090);!function(m){m[m.Stopped=0]="Stopped",m[m.Started=1]="Started"}(E||(E={}));class L{get state(){return this._state}set state(m){this._state=m,this.onStateChangedObservable.notifyObservers(m)}constructor(m){this.onStateChangedObservable=new M.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=m.US,this._sceneEventCoordinator=new D(this._scene),this._coordinator=m.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((m=>{for(const S of this._executionContexts){const h=this._getContextualOrder(m.type,S);for(const l of h)if(!l._executeEvent(S,m.oh))break}switch(m.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const S of this._executionContexts)S._notifyOnTick(m.oh);break;case"SceneDispose":this.dispose()}}))}createContext(){const m=new Z({US:this._scene,coordinator:this._coordinator});return this._executionContexts.push(m),m}getContext(m){return this._executionContexts[m]}addEventBlock(m){if("PointerOver"!==m.type&&"PointerOut"!==m.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==m.type&&this._eventBlocks[m.type].push(m),1===this.state)for(const S of this._executionContexts)m._startPendingTasks(S);else this.onStateChangedObservable.addOnce((S=>{if(1===S)for(const h of this._executionContexts)m._startPendingTasks(h)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((m=>{1===m&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const m of this._executionContexts)for(const S in this._eventBlocks){const h=this._getContextualOrder(S,m);for(const S of h)S._startPendingTasks(m)}}_getContextualOrder(m,S){const h=this._eventBlocks[m].sort(((m,S)=>S.initPriority-m.initPriority));if("MeshPick"===m){const m=[];for(const l of h){const M=l.asset.getValue(S);let O=0;for(;O<h.length;O++){const m=h[O].asset.getValue(S);if(M&&m&&(0,n.n)(M,m))break}m.splice(O,0,l)}return m}return h}dispose(){var m;if(0!==this.state){this.state=0;for(const m of this._executionContexts)m._clearPendingBlocks();this._executionContexts.length=0;for(const m in this._eventBlocks)this._eventBlocks[m].length=0;null===(m=this._eventObserver)||void 0===m||m.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(m){const S=[],h=new Set;for(const l in this._eventBlocks)for(const m of this._eventBlocks[l])S.push(m),h.add(m.uniqueId);for(;S.length>0;){const l=S.pop();m(l);for(const m of l.dataInputs)for(const l of m._connectedPoint)h.has(l._ownerBlock.uniqueId)||(S.push(l._ownerBlock),h.add(l._ownerBlock.uniqueId));if(l instanceof C.e)for(const m of l.signalOutputs)for(const l of m._connectedPoint)h.has(l._ownerBlock.uniqueId)||(S.push(l._ownerBlock),h.add(l._ownerBlock.uniqueId))}}serialize(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1?arguments[1]:void 0;m.allBlocks=[],this.visitAllBlocks((S=>{const h={};S.serialize(h),m.allBlocks.push(h)})),m.executionContexts=[];for(const h of this._executionContexts){const l={};h.serialize(l,S),m.executionContexts.push(l)}}}class U{constructor(m){this.config=m,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.US.Jh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.US.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const m=this._executeOnNextFrame.slice(0);if(m.length)for(const S of m){this.notifyCustomEvent(S.id,S.data,!1);const m=this._executeOnNextFrame.findIndex((m=>m.uniqueId===S.uniqueId));-1!==m&&this._executeOnNextFrame.splice(m,1)}}));(U.SceneCoordinators.get(this.config.US)??[]).push(this)}createGraph(){const m=new L({US:this.config.US,coordinator:this});return this._flowGraphs.push(m),m}removeGraph(m){const S=this._flowGraphs.indexOf(m);-1!==S&&(m.dispose(),this._flowGraphs.splice(S,1))}start(){for(const m of this._flowGraphs)m.start()}dispose(){var m,S;for(const M of this._flowGraphs)M.dispose();this._flowGraphs.length=0,null===(m=this._disposeObserver)||void 0===m||m.remove(),null===(S=this._onBeforeRenderObserver)||void 0===S||S.remove();const h=U.SceneCoordinators.get(this.config.US)??[],l=h.indexOf(this);-1!==l&&h.splice(l,1)}serialize(m,S){m._flowGraphs=[];for(const h of this._flowGraphs){const l={};h.serialize(l,S),m._flowGraphs.push(l)}m.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(m){let S=this._customEventsMap.get(m);return S||(S=new M.e,this._customEventsMap.set(m,S)),S}notifyCustomEvent(m,S){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:m,data:S,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(m)){const S=this._eventExecutionCounter.get(m);if(this._eventExecutionCounter.set(m,S+1),S>=U.MaxEventTypeExecutionPerFrame)return void(S===U.MaxEventTypeExecutionPerFrame&&V.e.Warn(`FlowGraphCoordinator: Too many executions of event "${m}".`))}else this._eventExecutionCounter.set(m,1);const h=this._customEventsMap.get(m);h&&h.notifyObservers(S)}}U.MaxEventsPerType=30,U.MaxEventTypeExecutionPerFrame=30,U.SceneCoordinators=new Map},13094:(m,S,h)=>{"use strict";h.d(S,{b:()=>M});var l=h(13100);class M extends l.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(m){m._notifyExecuteNode(this),this.done._activateSignal(m)}}},13071:(m,S,h)=>{"use strict";h.d(S,{e:()=>b});var l=h(13074),M=h(13081),O=h(11293);class u extends M.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(m){super.connectTo(m),this._connectedPoint.sort(((m,S)=>S.priority-m.priority))}_activateSignal(m){var S;if(null===(S=m.logger)||void 0===S||S.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,oh:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)m._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(m,this),m._increaseExecutionId();else for(const h of this._connectedPoint)h._activateSignal(m)}}(0,O.e)("FlowGraphSignalConnection",u);class b extends l.d{constructor(m){super(m),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(m){const S=new u(m,0,this);return this.signalInputs.push(S),S}_registerSignalOutput(m){const S=new u(m,1,this);return this.signalOutputs.push(S),S}_unregisterSignalInput(m){const S=this.signalInputs.findIndex((S=>S.name===m));-1!==S&&(this.signalInputs[S].dispose(),this.signalInputs.splice(S,1))}_unregisterSignalOutput(m){const S=this.signalOutputs.findIndex((S=>S.name===m));-1!==S&&(this.signalOutputs[S].dispose(),this.signalOutputs.splice(S,1))}_reportError(m,S){this.error.oh="string"===typeof S?new Error(S):S,this.error._activateSignal(m)}getSignalInput(m){return this.signalInputs.find((S=>S.name===m))}getSignalOutput(m){return this.signalOutputs.find((S=>S.name===m))}serialize(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(m),m.signalInputs=[],m.signalOutputs=[];for(const S of this.signalInputs){const h={};S.serialize(h),m.signalInputs.push(h)}for(const S of this.signalOutputs){const h={};S.serialize(h),m.signalOutputs.push(h)}}deserialize(m){for(let S=0;S<m.signalInputs.length;S++){const h=this.getSignalInput(m.signalInputs[S].name);if(!h)throw new Error("Could not find signal input with name "+m.signalInputs[S].name+" in block "+m.className);h.deserialize(m.signalInputs[S])}for(let S=0;S<m.signalOutputs.length;S++){const h=this.getSignalOutput(m.signalOutputs[S].name);if(!h)throw new Error("Could not find signal output with name "+m.signalOutputs[S].name+" in block "+m.className);h.deserialize(m.signalOutputs[S])}}getClassName(){return"FlowGraphExecutionBlock"}}},13107:(m,S,h)=>{"use strict";h.d(S,{c:()=>M});var l=h(13071);class M extends l.e{constructor(m){super(m),this.out=this._registerSignalOutput("out")}}},13060:(m,S,h)=>{"use strict";h.d(S,{B:()=>D,D:()=>v,H:()=>T,J:()=>s,N:()=>o,b:()=>Y,e:()=>Z,f:()=>y,j:()=>E,m:()=>n,o:()=>L,p:()=>I,t:()=>R,v:()=>V,x:()=>C,y:()=>B});var l,M=h(11347),O=h(11387),u=h(13056),b=h(13065);!function(m){m.Any="any",m.String="string",m.Number="number",m.Boolean="boolean",m.Object="object",m.Integer="FlowGraphInteger",m.Vector2="Vector2",m.nS="nS",m.Vector4="Vector4",m.Quaternion="Quaternion",m.Matrix="Matrix",m.Matrix2D="Matrix2D",m.Matrix3D="Matrix3D",m.RS="RS",m.Bb="Bb"}(l||(l={}));class q{constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=m,this.defaultValue=S,this.animationType=h}serialize(m){m.typeName=this.typeName,m.defaultValue=this.defaultValue}}const Y=new q("any",void 0),V=new q("string",""),I=new q("number",0,0),Z=new q("boolean",!1),C=new q("Vector2",M.Vector2.Zero(),5),B=new q("nS",M.nS.Zero(),1),D=new q("Vector4",M.Vector4.Zero()),E=new q("Matrix",M.Matrix.Identity(),3),n=new q("Matrix2D",new b.d),L=new q("Matrix3D",new b.e),U=new q("RS",O.RS.Black(),4),H=new q("Bb",new O.Bb(0,0,0,0),7),R=new q("Quaternion",M.Quaternion.Identity(),2);R.typeTransformer=m=>{if(m.getClassName){if("Vector4"===m.getClassName())return M.Quaternion.yS(m.DM());if("nS"===m.getClassName())return M.Quaternion.FromEulerVector(m);if("Matrix"===m.getClassName())return M.Quaternion.FromRotationMatrix(m)}return m};const y=new q("FlowGraphInteger",new u.b(0),0);function o(m){const S=m;switch(typeof m){case"string":return V;case"number":return I;case"boolean":return Z;case"object":if(S.getClassName)switch(S.getClassName()){case"Vector2":return C;case"nS":return B;case"Vector4":return D;case"Matrix":return E;case"RS":return U;case"Bb":return H;case"Quaternion":return R;case"FlowGraphInteger":return y;case"Matrix2D":return n;case"Matrix3D":return L}return Y;default:return Y}}function s(m){switch(m){case"string":return V;case"number":return I;case"boolean":return Z;case"Vector2":return C;case"nS":return B;case"Vector4":return D;case"Matrix":return E;case"RS":return U;case"Bb":return H;case"Quaternion":return R;case"FlowGraphInteger":return y;case"Matrix2D":return n;case"Matrix3D":return L;default:return Y}}function v(m){switch(m){case"number":default:return 0;case"Vector2":return 5;case"nS":return 1;case"Matrix":return 3;case"RS":return 4;case"Bb":return 7;case"Quaternion":return 2}}function T(m){switch(m){case 0:return I;case 5:return C;case 1:return B;case 3:return E;case 4:return U;case 7:return H;case 2:return R;default:return Y}}},13047:(m,S,h)=>{"use strict";h.d(S,{d:()=>V,f:()=>Y,h:()=>I});var l=h(11387),M=h(11347),O=h(13056),u=h(13060),b=h(13065);function q(m){return"Vector2"===m||"nS"===m||"Vector4"===m||"Quaternion"===m||"RS"===m||"Bb"===m}function Y(m,S,h){var l;const M=(null===S||void 0===S||null===(l=S.getClassName)||void 0===l?void 0:l.call(S))??"";if(q(M)||function(m){return"Matrix"===m||"Matrix2D"===m||"Matrix3D"===m}(M))h[m]={value:S.DM(),className:M};else if("FlowGraphInteger"===M)h[m]={value:S.value,className:M};else if(M&&(S.id||S.name))h[m]={id:S.id,name:S.name,className:M};else{if("object"===typeof S)throw new Error(`Could not serialize value ${S}`);h[m]=S}}function V(m,S,h,Y){const I=S[m];let Z;const C=(null===I||void 0===I?void 0:I.type)??(null===I||void 0===I?void 0:I.className);if(function(m){return"Mesh"===m||"AbstractMesh"===m||"GroundMesh"===m||"InstanceMesh"===m||"LinesMesh"===m||"GoldbergMesh"===m||"GreasedLineMesh"===m||"TrailMesh"===m}(C)){let m=Y.meshes.filter((m=>I.id?m.id===I.id:m.name===I.name));0===m.length&&(m=Y.transformNodes.filter((m=>I.id?m.id===I.id:m.name===I.name))),Z=I.uniqueId?m.find((m=>m.uniqueId===I.uniqueId)):m[0]}else if(q(C))Z=function(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===m)return M.Vector2.yS(S);if("nS"===m)return h&&(S[2]*=-1),M.nS.yS(S);if("Vector4"===m)return M.Vector4.yS(S);if("Quaternion"===m)return h&&(S[2]*=-1,S[3]*=-1),M.Quaternion.yS(S);if("RS"===m)return new l.RS(S[0],S[1],S[2]);if("Bb"===m)return new l.Bb(S[0],S[1],S[2],S[3]);throw new Error(`Unknown vector class name ${m}`)}(C,I.value);else if(function(m){return"AnimationGroup"===m}(C)){const m=Y.animationGroups.filter((m=>m.name===I.name));Z=1===m.length?m[0]:m.find((m=>m.uniqueId===I.uniqueId))}else Z="Matrix"===C?M.Matrix.yS(I.value):"Matrix2D"===C?new b.d(I.value):"Matrix3D"===C?new b.e(I.value):"FlowGraphInteger"===C?O.b.FromValue(I.value):"number"===C||"string"===C||"boolean"===C?I.value[0]:I&&void 0!==I.value?I.value:Array.isArray(I)?I.reduce(((m,S)=>S.eventData?(m[S.id]={type:(0,u.J)(S.type)},"undefined"!==typeof S.value&&(m[S.id].value=V("value",S,h,Y)),m):m),{}):I;return Z}function I(m){return"FlowGraphJsonPointerParserBlock"===m}},13090:(m,S,h)=>{"use strict";function l(m,S){return!(!m.parent||m.parent!==S&&!l(m.parent,S))}function M(m){if(m.getClassName)return m.getClassName()}function O(m,S){return m===S&&("Vector2"===m||"nS"===m||"Vector4"===m||"Quaternion"===m)}function u(m,S){return m===S&&("Matrix"===m||"Matrix2D"===m||"Matrix3D"===m)}function b(m,S){return"FlowGraphInteger"===m&&"FlowGraphInteger"===S}function q(m,S){const h="number"===typeof m||"number"===typeof(null===m||void 0===m?void 0:m.value);return h&&!S?!isNaN(Y(m)):h}function Y(m){return"number"===typeof m?m:m.value}h.d(S,{e:()=>b,g:()=>u,h:()=>O,k:()=>M,n:()=>l,p:()=>Y,t:()=>q})},12454:(m,S,h)=>{"use strict";h.r(S),h.d(S,{SceneInstrumentation:()=>O});var l=h(11156),M=h(11547);class O{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(m){m!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=m,m?(this._onBeforeActiveMeshesEvaluationObserver=this.US.onBeforeActiveMeshesEvaluationObservable.add((()=>{l.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.US.onAfterActiveMeshesEvaluationObservable.add((()=>{l.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.US.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.US.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(m){m!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=m,m?(this._onBeforeRenderTargetsRenderObserver=this.US.onBeforeRenderTargetsRenderObservable.add((()=>{l.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.US.onAfterRenderTargetsRenderObservable.add((()=>{l.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.US.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.US.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(m){m!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=m,m?(this._onBeforeParticlesRenderingObserver=this.US.onBeforeParticlesRenderingObservable.add((()=>{l.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.US.onAfterParticlesRenderingObservable.add((()=>{l.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.US.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.US.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(m){m!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=m,this.US.spriteManagers&&(m?(this._onBeforeSpritesRenderingObserver=this.US.onBeforeSpritesRenderingObservable.add((()=>{l.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.US.onAfterSpritesRenderingObservable.add((()=>{l.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.US.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.US.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(m){m!==this._capturePhysicsTime&&this.US.onBeforePhysicsObservable&&(this._capturePhysicsTime=m,m?(this._onBeforePhysicsObserver=this.US.onBeforePhysicsObservable.add((()=>{l.Tools.StartPerformanceCounter("ob"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.US.onAfterPhysicsObservable.add((()=>{l.Tools.EndPerformanceCounter("ob"),this._physicsTime.endMonitoring()}))):(this.US.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.US.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(m){m!==this._captureAnimationsTime&&(this._captureAnimationsTime=m,m?this._onAfterAnimationsObserver=this.US.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.US.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(m){this._captureFrameTime=m}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(m){this._captureInterFrameTime=m}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(m){m!==this._captureRenderTime&&(this._captureRenderTime=m,m?(this._onBeforeDrawPhaseObserver=this.US.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),l.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.US.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),l.Tools.EndPerformanceCounter("Main render")}))):(this.US.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.US.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(m){m!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=m,m?(this._onBeforeCameraRenderObserver=this.US.onBeforeCameraRenderObservable.add((m=>{this._cameraRenderTime.beginMonitoring(),l.Tools.StartPerformanceCounter(`Rendering camera ${m.name}`)})),this._onAfterCameraRenderObserver=this.US.onAfterCameraRenderObservable.add((m=>{this._cameraRenderTime.endMonitoring(!1),l.Tools.EndPerformanceCounter(`Rendering camera ${m.name}`)}))):(this.US.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.US.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.US.getEngine()._drawCalls}constructor(m){this.US=m,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new M.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new M.e,this._captureFrameTime=!1,this._frameTime=new M.e,this._captureRenderTime=!1,this._renderTime=new M.e,this._captureInterFrameTime=!1,this._interFrameTime=new M.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new M.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new M.e,this._capturePhysicsTime=!1,this._physicsTime=new M.e,this._captureAnimationsTime=!1,this._animationsTime=new M.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new M.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=m.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(l.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.US.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=m.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(l.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.xh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.xh(),this._captureParticlesRenderTime&&this._particlesRenderTime.xh(),this._captureSpritesRenderTime&&this._spritesRenderTime.xh(),this._captureRenderTime&&this._renderTime.xh(),this._captureCameraRenderTime&&this._cameraRenderTime.xh()}))}dispose(){this._disposed||(this.US.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.US.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.US.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.US.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.US.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.US.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.US.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.US.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.US.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.US.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.US.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.US.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.US.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.US.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.US.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.US.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.US.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.US=null,this._disposed=!0)}}},13040:(m,S,h)=>{"use strict";h.d(S,{d:()=>V});var l=h(11327),M=h(11336),O=h(11347),u=h(11718),b=h(11855),q=h(11916),Y=h(11293);u.e.AddNodeConstructor("Light_Type_1",((m,S)=>()=>new V(m,O.nS.Zero(),S)));class V extends q.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(m){this._shadowFrustumSize=m,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(m){this._shadowOrthoScale=m,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(m){this._orthoLeft=m}get orthoRight(){return this._orthoRight}set orthoRight(m){this._orthoRight=m}get orthoTop(){return this._orthoTop}set orthoTop(m){this._orthoTop=m}get orthoBottom(){return this._orthoBottom}set orthoBottom(m){this._orthoBottom=m}constructor(m,S,h){super(m,h),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=S.scale(-1),this.direction=S}getClassName(){return"sb"}getTypeID(){return b.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(m,S,h){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(m):this._setDefaultAutoExtendShadowProjectionMatrix(m,S,h)}_setDefaultFixedFrustumShadowProjectionMatrix(m){const S=this.sm().activeCamera;S&&O.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:S.hb,void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,m,this.sm().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(m,S,h){const l=this.sm().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const m=O.nS.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let l=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let u=0;u<h.length;u++){const b=h[u];if(!b)continue;const q=b.getBoundingInfo().boundingBox;for(let h=0;h<q.vectorsWorld.length;h++)O.nS.TransformCoordinatesToRef(q.vectorsWorld[h],S,m),m.x<this._orthoLeft&&(this._orthoLeft=m.x),m.y<this._orthoBottom&&(this._orthoBottom=m.y),m.x>this._orthoRight&&(this._orthoRight=m.x),m.y>this._orthoTop&&(this._orthoTop=m.y),this.autoCalcShadowZBounds&&(m.z<l&&(l=m.z),m.z>M&&(M=m.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=l,this._shadowMaxZ=M)}const M=this._orthoRight-this._orthoLeft,u=this._orthoTop-this._orthoBottom,b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===l||void 0===l?void 0:l.hb)||0,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===l||void 0===l?void 0:l.maxZ)||1e4,Y=this.sm().getEngine().useReverseDepthBuffer;O.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-M*this.shadowOrthoScale,this._orthoRight+M*this.shadowOrthoScale,this._orthoBottom-u*this.shadowOrthoScale,this._orthoTop+u*this.shadowOrthoScale,Y?q:b,Y?b:q,m,this.sm().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(m,S){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,S),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,S),this)}transferToNodeMaterialEffect(m,S){return this.computeTransformedInformation()?(m.setFloat3(S,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(m.setFloat3(S,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(m){const S=this._scene.getEngine();return!S.useReverseDepthBuffer&&S.isNDCHalfZRange?0:1}getDepthMaxZ(m){const S=this._scene.getEngine();return S.useReverseDepthBuffer&&S.isNDCHalfZRange?0:1}prepareLightSpecificDefines(m,S){m["DIRLIGHT"+S]=!0}}(0,l.d)([(0,M.F)()],V.prototype,"shadowFrustumSize",null),(0,l.d)([(0,M.F)()],V.prototype,"shadowOrthoScale",null),(0,l.d)([(0,M.F)()],V.prototype,"autoUpdateExtends",void 0),(0,l.d)([(0,M.F)()],V.prototype,"autoCalcShadowZBounds",void 0),(0,l.d)([(0,M.F)("orthoLeft")],V.prototype,"_orthoLeft",void 0),(0,l.d)([(0,M.F)("orthoRight")],V.prototype,"_orthoRight",void 0),(0,l.d)([(0,M.F)("orthoTop")],V.prototype,"_orthoTop",void 0),(0,l.d)([(0,M.F)("orthoBottom")],V.prototype,"_orthoBottom",void 0),(0,Y.e)("BABYLON.DirectionalLight",V)},13545:(m,S,h)=>{"use strict";h.d(S,{e:()=>V});var l=h(11327),M=h(11336),O=h(11347),u=h(11387),b=h(11718),q=h(11855),Y=h(11293);b.e.AddNodeConstructor("Light_Type_3",((m,S)=>()=>new V(m,O.nS.Zero(),S)));class V extends q.b{constructor(m,S,h){super(m,h),this.groundColor=new u.RS(0,0,0),this.direction=S||O.nS.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Tb"}setDirectionToTarget(m){return this.direction=O.nS.Normalize(m.LS(O.nS.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(m,S){const h=O.nS.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",h.x,h.y,h.z,0,S),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.nb),S),this}transferToNodeMaterialEffect(m,S){const h=O.nS.Normalize(this.direction);return m.setFloat3(S,h.x,h.y,h.z),this}Mb(){return this._worldMatrix||(this._worldMatrix=O.Matrix.Identity()),this._worldMatrix}getTypeID(){return q.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(m,S){m["HEMILIGHT"+S]=!0}}(0,l.d)([(0,M.k)()],V.prototype,"groundColor",void 0),(0,l.d)([(0,M.B)()],V.prototype,"direction",void 0),(0,Y.e)("BABYLON.HemisphericLight",V)},13004:(m,S,h)=>{"use strict";h.d(S,{d:()=>I});var l=h(11327),M=h(11336),O=h(11347),u=h(11718),b=h(11855),q=h(11916),Y=h(11321),V=h(11293);u.e.AddNodeConstructor("Light_Type_2",((m,S)=>()=>new I(m,O.nS.Zero(),O.nS.Zero(),0,0,S)));class I extends q.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(m){this._iesProfileTexture!==m&&(this._iesProfileTexture=m,this._iesProfileTexture&&I._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(m){this._angle=m,this._cosHalfAngle=Math.cos(.5*m),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(m){this._innerAngle=m,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(m){this._shadowAngleScale=m,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(m){this._projectionTextureLightNear=m,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(m){this._projectionTextureLightFar=m,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(m){this._projectionTextureUpDirection=m,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(m){this._projectionTexture!==m&&(this._projectionTexture=m,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(I._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):I._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(m){return void 0!==m.onGeneratedObservable}static _IsTexture(m){return void 0!==m.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(m){this._projectionTextureProjectionLightMatrix=m,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(m,S,h,l,M,u){super(m,u),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=O.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=O.nS.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=O.nS.Zero(),this._projectionTextureViewLightMatrix=O.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=O.Matrix.Zero(),this._projectionTextureScalingMatrix=O.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=S,this.direction=h,this.angle=l,this.exponent=M}getClassName(){return"SpotLight"}getTypeID(){return b.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(m){super._setDirection(m),this._projectionTextureViewLightDirty=!0}_setPosition(m){super._setPosition(m),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(m,S,h){const l=this.sm().activeCamera;if(!l)return;this._shadowAngleScale=this._shadowAngleScale||1;const M=this._shadowAngleScale*this._angle,u=void 0!==this.shadowMinZ?this.shadowMinZ:l.hb,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,q=this.sm().getEngine().useReverseDepthBuffer;O.Matrix.PerspectiveFovLHToRef(M,1,q?b:u,q?u:b,m,!0,this._scene.getEngine().isNDCHalfZRange,void 0,q)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),O.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const m=this.projectionTextureLightFar,S=this.projectionTextureLightNear,h=m/(m-S),l=-h*S,M=1/Math.tan(this._angle/2);O.Matrix.FromValuesToRef(M/1,0,0,0,0,M,0,0,0,0,h,1,0,0,l,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Y.e){const m=this._projectionTexture.uScale/2,S=this._projectionTexture.vScale/2;O.Matrix.FromValuesToRef(m,0,0,0,0,S,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(m,S){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),m.setMatrix("textureProjectionMatrix"+S,this._projectionTextureMatrix),m.setTexture("projectionLightTexture"+S,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&m.setTexture("iesLightTexture"+S,this._iesProfileTexture),this}transferToEffect(m,S){let h;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,S),h=O.nS.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,S),h=O.nS.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",h.x,h.y,h.z,this._cosHalfAngle,S),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,S),this}transferToNodeMaterialEffect(m,S){let h;return h=this.computeTransformedInformation()?O.nS.Normalize(this.transformedDirection):O.nS.Normalize(this.direction),this.sm().useRightHandedSystem?m.setFloat3(S,-h.x,-h.y,-h.z):m.setFloat3(S,h.x,h.y,h.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(m){const S=this._scene.getEngine(),h=void 0!==this.shadowMinZ?this.shadowMinZ:(null===m||void 0===m?void 0:m.hb)??0;return S.useReverseDepthBuffer&&S.isNDCHalfZRange?h:this._scene.getEngine().isNDCHalfZRange?0:h}getDepthMaxZ(m){const S=this._scene.getEngine(),h=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===m||void 0===m?void 0:m.maxZ)??1e4;return S.useReverseDepthBuffer&&S.isNDCHalfZRange?0:h}prepareLightSpecificDefines(m,S){m["SPOTLIGHT"+S]=!0,m["PROJECTEDLIGHTTEXTURE"+S]=!(!this.projectionTexture||!this.projectionTexture.isReady()),m["IESLIGHTTEXTURE"+S]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,l.d)([(0,M.F)()],I.prototype,"angle",null),(0,l.d)([(0,M.F)()],I.prototype,"innerAngle",null),(0,l.d)([(0,M.F)()],I.prototype,"shadowAngleScale",null),(0,l.d)([(0,M.F)()],I.prototype,"exponent",void 0),(0,l.d)([(0,M.F)()],I.prototype,"projectionTextureLightNear",null),(0,l.d)([(0,M.F)()],I.prototype,"projectionTextureLightFar",null),(0,l.d)([(0,M.F)()],I.prototype,"projectionTextureUpDirection",null),(0,l.d)([(0,M.w)("projectedLightTexture")],I.prototype,"_projectionTexture",void 0),(0,V.e)("BABYLON.SpotLight",I)},12727:(m,S,h)=>{"use strict";h.d(S,{e:()=>u,h:()=>O,j:()=>b});const l={},M={};function O(m,S){l[m]=S}function u(m,S){M[m]=S}function b(m){return M[m]?M[m]:null}},12616:(m,S,h)=>{"use strict";h.d(S,{b:()=>o,f:()=>d});var l,M=h(11156),O=h(11161),u=h(11567),b=h(11196),q=h(11173),Y=h(11767),V=h(11205),I=h(11210),Z=h(11302),C=h(11229),B=h(11191);!function(m){m[m.Clean=0]="Clean",m[m.Stop=1]="Stop",m[m.Sync=2]="Sync",m[m.NoSync=3]="NoSync"}(l||(l={}));const D=new O.e,E={};let n=!1;function L(){return E[".babylon"]}function U(m,S){const h=E[m];return h||(q.e.Warn("Unable to find a plugin to load "+m+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),S?L():void 0)}function H(m,S,h){let l="Unable to load from "+(m.rawData?"binary data":m.url);return S?l+=`: ${S}`:h&&(l+=`: ${h}`),l}async function R(m,S,h,l,M,O,u,b,q){var Y;const I="data:"===(Z=m.url).substring(0,5)?Z.substring(5):null;var Z;if(m.rawData&&!u)throw"When using ArrayBufferView to load data the file extension must be provided.";const n=I||u?"":function(m){const S=m.indexOf("?");-1!==S&&(m=m.substring(0,S));const h=m.lastIndexOf(".");return m.substring(h,m.length).toLowerCase()}(m.url);let H=u?U(u,!0):I?function(m){for(const S in E){const h=E[S].plugin;if(h.canDirectLoad&&h.canDirectLoad(m))return E[S]}return L()}(m.url):U(n,!1);if(!H&&n){if(m.url&&!m.url.startsWith("blob:")){const S=await async function(m,S){const h=S.method||"GET";return await new Promise(((l,M)=>{const O=new B.b;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const m={};if(S.responseHeaders)for(const h of S.responseHeaders)m[h]=O.getResponseHeader(h)||"";l({response:O.response,headerValues:m})}else M(`Unable to fetch data from ${m}. Error code: ${O.status}`)})),O.open(h,m),O.send()}))}(m.url,{method:"HEAD",responseHeaders:["Content-Type"]}),h=S.headerValues?S.headerValues["Content-Type"]:"";h&&(H=function(m){for(const S in E){const h=E[S];if(h.mimeType===m)return h}}(h))}H||(H=L())}if(!H)throw new Error(`No plugin or fallback for ${u??m.url}`);if(!1===(null===q||void 0===q||null===(Y=q[H.plugin.name])||void 0===Y?void 0:Y.enabled))throw new Error(`The '${H.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(m.rawData&&!H.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(m=>{if(H.plugin.createPlugin){const S=H.plugin.createPlugin(q??{});return S instanceof Promise?(S.then(m).catch((m=>{M("Error instantiating plugin.",m)})),null):(m(S),S)}return m(H.plugin),H.plugin})((q=>{var Y;if(!q)throw`The loader plugin corresponding to the '${u}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(D.notifyObservers(q),I&&(q.canDirectLoad&&q.canDirectLoad(m.url)||!(0,V.k)(m.url))){if(q.directLoad){const m=q.directLoad(S,I);m instanceof Promise?m.then((m=>{h(q,m)})).catch((m=>{M("Error in directLoad of _loadData: "+m,m)})):h(q,m)}else h(q,I);return}const Z=H.isBinary,B=(m,l)=>{S.u?M("Scene has been disposed"):h(q,m,l)};let E=null,n=!1;null===(Y=q.Jh)||void 0===Y||Y.add((()=>{n=!0,E&&(E.abort(),E=null),O()}));const L=()=>{if(n)return;const h=(m,S)=>{M(null===m||void 0===m?void 0:m.statusText,S)};if(!q.loadFile&&m.rawData)throw"Plugin does not support loading ArrayBufferView.";E=q.loadFile?q.loadFile(S,m.rawData||m.file||m.url,m.rootUrl,B,l,Z,h,b):S._loadFile(m.file||m.url,B,l,!0,Z,h)},U=S.getEngine();let R=U.enableOfflineSupport;if(R){let h=!1;for(const l of S.disableOfflineSupportExceptionRules)if(l.test(m.url)){h=!0;break}R=!h}R&&C.b.OfflineProviderFactory?S.offlineProvider=C.b.OfflineProviderFactory(m.url,L,U.disableManifestCheck):L()}))}function y(m,S){let h,l,O=null,u=null;if(S)if(S.name)h=`file:${S.name}`,l=S.name,O=S;else if(ArrayBuffer.isView(S))h="",l=(0,Z.b)(),u=S;else if(S.startsWith("data:"))h=S,l="";else if(m){const O=S;if("/"===O.substring(0,1))return M.Tools.Error("Wrong sceneFilename parameter"),null;h=m+O,l=O}else h=S,l=M.Tools.GetFilename(S),m=M.Tools.GetFolderPath(S);else h=m,l=M.Tools.GetFilename(m),m=M.Tools.GetFolderPath(m);return{url:h,rootUrl:m,name:l,file:O,rawData:u}}function o(m){if("string"===typeof m.extensions){const S=m.extensions;E[S.toLowerCase()]={plugin:m,isBinary:!1}}else{const S=m.extensions,h=Object.keys(S);for(const l of h)E[l.toLowerCase()]={plugin:m,isBinary:S[l].isBinary,mimeType:S[l].mimeType}}}async function s(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.d.LastCreatedScene,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!l)return q.e.Error("No scene available to import mesh to"),null;const C=y(S,h);if(!C)return null;const B={};l.addPendingData(B);const D=()=>{l.removePendingData(B)},E=(m,S)=>{const h=H(C,m,S);u?u(l,h,new I.e(h,I.d.SceneLoaderError,S)):q.e.Error(h),D()},n=O?m=>{try{O(m)}catch(S){E("Error in onProgress callback: "+S,S)}}:void 0,L=(m,S,h,O,u,b,q,Y)=>{if(l.importedMeshesFiles.push(C.url),M)try{M(m,S,h,O,u,b,q,Y)}catch(V){E("Error in onSuccess callback: "+V,V)}l.removePendingData(B)};return await R(C,l,((S,h,M)=>{if(S.rewriteRootURL&&(C.rootUrl=S.rewriteRootURL(C.rootUrl,M)),S.importMesh){const M=[],O=[],u=[];if(!S.importMesh(m,l,h,C.rootUrl,M,O,u,E))return;l.loadingPluginName=S.name,L(M,O,u,[],[],[],[],[])}else{S.importMeshAsync(m,l,h,C.rootUrl,n,C.name).then((m=>{l.loadingPluginName=S.name,L(m.meshes,m.UZ,m.skeletons,m.animationGroups,m.transformNodes,m.geometries,m.lights,m.spriteManagers)})).catch((m=>{E(m.message,m)}))}}),n,E,D,Y,V,Z)}async function v(m,S,h,l,M,O,u,b){return await new Promise(((q,Y)=>{try{s(m,S,h,l,((m,S,h,l,M,O,u,b)=>{q({meshes:m,UZ:S,skeletons:h,animationGroups:l,transformNodes:M,geometries:O,lights:u,spriteManagers:b})}),M,((m,S,h)=>{Y(h||new Error(S))}),O,u,b).catch(Y)}catch(I){Y(I)}}))}async function T(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedEngine,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};h?await g(m,S,new u.c(h),l,O,q,Y,V,I):M.Tools.Error("No engine available")}async function X(m,S,h,l,M,O,u){return await new Promise(((b,q)=>{T(m,S,h,(m=>{b(m)}),l,((m,S,h)=>{q(h||new Error(S))}),M,O,u)}))}async function g(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedScene,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return q.e.Error("No scene available to append to"),null;const C=y(m,S);if(!C)return null;const B={};h.addPendingData(B);const D=()=>{h.removePendingData(B)};Y.e.ShowLoadingScreen&&!n&&(n=!0,h.getEngine().displayLoadingUI(),h.executeWhenReady((()=>{h.getEngine().hideLoadingUI(),n=!1})));const E=(m,S)=>{const l=H(C,m,S);O?O(h,l,new I.e(l,I.d.SceneLoaderError,S)):q.e.Error(l),D()},L=M?m=>{try{M(m)}catch(S){E("Error in onProgress callback",S)}}:void 0,U=()=>{if(l)try{l(h)}catch(m){E("Error in onSuccess callback",m)}h.removePendingData(B)};return await R(C,h,((m,S)=>{if(m.load){if(!m.load(h,S,C.rootUrl,E))return;h.loadingPluginName=m.name,U()}else{m.loadAsync(h,S,C.rootUrl,L,C.name).then((()=>{h.loadingPluginName=m.name,U()})).catch((m=>{E(m.message,m)}))}}),L,E,D,u,V,Z)}async function G(m,S,h,l,M,O,u){return await new Promise(((b,q)=>{try{g(m,S,h,(m=>{b(m)}),l,((m,S,h)=>{q(h||new Error(S))}),M,O,u).catch(q)}catch(I){q(I)}}))}async function e(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedScene,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return q.e.Error("No scene available to load asset container to"),null;const Z=y(m,S);if(!Z)return null;const C={};h.addPendingData(C);const B=()=>{h.removePendingData(C)},D=(m,S)=>{const l=H(Z,m,S);O?O(h,l,new I.e(l,I.d.SceneLoaderError,S)):q.e.Error(l),B()},E=M?m=>{try{M(m)}catch(S){D("Error in onProgress callback",S)}}:void 0,n=m=>{if(l)try{l(m)}catch(S){D("Error in onSuccess callback",S)}h.removePendingData(C)};return await R(Z,h,((m,S)=>{if(m.loadAssetContainer){const l=m.loadAssetContainer(h,S,Z.rootUrl,D);if(!l)return;l.populateRootNodes(),h.loadingPluginName=m.name,n(l)}else if(m.loadAssetContainerAsync){m.loadAssetContainerAsync(h,S,Z.rootUrl,E,Z.name).then((S=>{S.populateRootNodes(),h.loadingPluginName=m.name,n(S)})).catch((m=>{D(m.message,m)}))}else D("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),E,D,B,u,Y,V)}async function a(m,S,h,l,M,O,u){return await new Promise(((b,q)=>{try{e(m,S,h,(m=>{b(m)}),l,((m,S,h)=>{q(h||new Error(S))}),M,O,u).catch(q)}catch(I){q(I)}}))}async function x(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedScene,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!h)return void q.e.Error("No scene available to load animations to");if(l){for(const l of h.animatables)l.reset();h.stopAllAnimations();const m=h.animationGroups.slice();for(const h of m)h.dispose();const S=h.getNodes();for(const h of S)h.animations&&(h.animations=[])}else switch(M){case 0:const m=h.animationGroups.slice();for(const S of m)S.dispose();break;case 1:for(const S of h.animationGroups)S.stop();break;case 2:for(const S of h.animationGroups)S.reset(),S.restart();break;case 3:break;default:return void q.e.Error("Unknown animation group loading mode value '"+M+"'")}const B=h.animatables.length;await e(m,S,h,(m=>{m.mergeAnimationsTo(h,h.animatables.slice(B),O),m.dispose(),h.onAnimationFileImportedObservable.notifyObservers(h),u&&u(h)}),Y,V,I,Z,C)}async function P(m,S,h,l,M,O,u,b,q,Y){return await new Promise(((V,Z)=>{try{x(m,S,h,l,M,O,(m=>{V(m)}),u,((m,S,h)=>{Z(h||new Error(S))}),b,q,Y).catch(Z)}catch(I){Z(I)}}))}class d{static get ForceFullSceneLoadingForIncremental(){return Y.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(m){Y.e.ForceFullSceneLoadingForIncremental=m}static get ShowLoadingScreen(){return Y.e.ShowLoadingScreen}static set ShowLoadingScreen(m){Y.e.ShowLoadingScreen=m}static get loggingLevel(){return Y.e.loggingLevel}static set loggingLevel(m){Y.e.loggingLevel=m}static get CleanBoneMatrixWeights(){return Y.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(m){Y.e.CleanBoneMatrixWeights=m}static GetDefaultPlugin(){return L()}static GetPluginForExtension(m){var S;return null===(S=U(m,!0))||void 0===S?void 0:S.plugin}static IsPluginForExtensionAvailable(m){return function(m){return!!E[m]}(m)}static RegisterPlugin(m){o(m)}static ImportMesh(m,S,h,l,M,O,u,q,Y){s(m,S,h,l,M,O,u,q,Y).catch((m=>null===u||void 0===u?void 0:u(b.d.LastCreatedScene,null===m||void 0===m?void 0:m.message,m)))}static async ImportMeshAsync(m,S,h,l,M,O,u){return await v(m,S,h,l,M,O,u)}static Load(m,S,h,l,M,O,u,q){T(m,S,h,l,M,O,u,q).catch((m=>null===O||void 0===O?void 0:O(b.d.LastCreatedScene,null===m||void 0===m?void 0:m.message,m)))}static async LoadAsync(m,S,h,l,M,O){return await X(m,S,h,l,M,O)}static Append(m,S,h,l,M,O,u,q){g(m,S,h,l,M,O,u,q).catch((m=>null===O||void 0===O?void 0:O(h??b.d.LastCreatedScene,null===m||void 0===m?void 0:m.message,m)))}static async AppendAsync(m,S,h,l,M,O){return await G(m,S,h,l,M,O)}static LoadAssetContainer(m,S,h,l,M,O,u,q){e(m,S,h,l,M,O,u,q).catch((m=>null===O||void 0===O?void 0:O(h??b.d.LastCreatedScene,null===m||void 0===m?void 0:m.message,m)))}static async LoadAssetContainerAsync(m,S,h,l,M,O){return await a(m,S,h,l,M,O)}static ImportAnimations(m,S,h,l,M,O,u,q,Y,V,I){x(m,S,h,l,M,O,u,q,Y,V,I).catch((m=>null===Y||void 0===Y?void 0:Y(h??b.d.LastCreatedScene,null===m||void 0===m?void 0:m.message,m)))}static async ImportAnimationsAsync(m,S,h,l,M,O,u,b,q,Y,V){return await P(m,S,h,l,M,O,b,Y,V)}}d.NO_LOGGING=0,d.MINIMAL_LOGGING=1,d.SUMMARY_LOGGING=2,d.DETAILED_LOGGING=3,d.OnPluginActivatedObservable=D},13023:(m,S,h)=>{"use strict";h.d(S,{d:()=>Z});var l=h(11327),M=h(11336),O=h(11156),u=h(11347),b=h(11368),q=h(11321),Y=h(11293),V=h(11161),I=h(11377);h(13027);class Z extends b.c{set boundingBoxSize(m){if(this._boundingBoxSize&&this._boundingBoxSize.equals(m))return;this._boundingBoxSize=m;const S=this.sm();S&&S.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(m){this._rotationY=m,this.setReflectionTextureMatrix(u.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(m,S,h){let l="";for(const M of m)l+=M;return new Z(l,S,null,h,m)}static CreateFromPrefilteredData(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const M=S.useDelayedTextureLoading;S.useDelayedTextureLoading=!1;const O=new Z(m,S,null,!1,null,null,null,void 0,!0,h,l);return S.useDelayedTextureLoading=M,O}constructor(m,S){var h;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,n=arguments.length>13?arguments[13]:void 0,L=arguments.length>14?arguments[14]:void 0;super(S),this.onLoadObservable=new V.e,this.boundingBoxPosition=u.nS.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new u.Matrix,this._buffer=null,this.name=m,this.url=m,this._noMipmap=M,this.Sb=!1,this.isCube=!0,this._textureMatrix=u.Matrix.Identity(),this.coordinatesMode=q.e.CUBIC_MODE;let U=null,H=null;null===l||Array.isArray(l)?(this._noMipmap=M,this._format=I,this._createPolynomials=B,U=l,this._loaderOptions=n,this._useSRGBBuffer=L,this._lodScale=D,this._lodOffset=E):(U=l.extensions??null,this._noMipmap=l.noMipmap??!1,O=l.files??null,H=l.buffer??null,this._format=l.format??5,Z=l.prefiltered??!1,C=l.forcedExtension??null,this._createPolynomials=l.createPolynomials??!1,this._lodScale=l.lodScale??.8,this._lodOffset=l.lodOffset??0,this._loaderOptions=l.loaderOptions,this._useSRGBBuffer=l.useSRGBBuffer,b=l.t??null,Y=l.onError??null),(m||O)&&this.updateURL(m,C,b,Z,Y,U,null===(h=this.sm())||void 0===h?void 0:h.useDelayedTextureLoading,O,H)}getClassName(){return"CubeTexture"}updateURL(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=m),this.url=m,S&&(this._forcedExtension=S);const Y=m.lastIndexOf("."),V=S||(Y>-1?m.substring(Y).toLowerCase():""),I=0===V.indexOf(".dds"),Z=0===V.indexOf(".env"),C=0===V.indexOf(".basis");if(Z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=l,l&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),b)this._files=b;else if(C||Z||I||O||(O=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,O){for(let S=0;S<O.length;S++)this._files.push(m+O[S]);this._extensions=O}this._buffer=q,u?(this.delayLoadState=4,this._delayedOnLoad=h,this._delayedOnError=M):this._loadTexture(h,M)}delayLoad(m){4===this.delayLoadState&&(m&&(this._forcedExtension=m),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(m){var S,h;if(m.updateFlag===this._textureMatrix.updateFlag)return;m.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(h=this.sm())||void 0===h||h.markAllMaterialsAsDirty(1,(m=>-1!==m.getActiveTextures().indexOf(this))));if(this._textureMatrix=m,null===(S=this.sm())||void 0===S||!S.useRightHandedSystem)return;const l=u.TmpVectors.nS[0],M=u.TmpVectors.Quaternion[0],O=u.TmpVectors.nS[1];this._textureMatrix.decompose(l,M,O),M.z*=-1,M.w*=-1,u.Matrix.ComposeToRef(l,M,O,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var m;return null!==(m=this.sm())&&void 0!==m&&m.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this.sm(),l=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const M=()=>{var S;(this.onLoadObservable.notifyObservers(this),l)&&(l.dispose(),null===(S=this.sm())||void 0===S||S.markAllMaterialsAsDirty(1));m&&m()},u=(m,h)=>{this._loadingError=!0,this._errorObject={message:m,exception:h},S&&S(m,h),q.e.OnTextureLoadErrorObservable.notifyObservers(this)};var b;this._texture?this._texture.isReady?O.Tools.SetImmediate((()=>M())):this._texture.onLoadedObservable.add((()=>M())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,h,this._lodScale,this._lodOffset,m,u,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,h,this._files,this._noMipmap,m,u,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(b=this._texture)||void 0===b||b.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(m,S,h){const l=I.e.Parse((()=>{let l=!1;return m.prefiltered&&(l=m.prefiltered),new Z(h+(m.url??m.name),S,m.extensions,!1,m.files||null,null,null,void 0,l,m.forcedExtension)}),m,S);if(m.boundingBoxPosition&&(l.boundingBoxPosition=u.nS.yS(m.boundingBoxPosition)),m.boundingBoxSize&&(l.boundingBoxSize=u.nS.yS(m.boundingBoxSize)),m.animations)for(let M=0;M<m.animations.length;M++){const S=m.animations[M],h=(0,Y.d)("BABYLON.Animation");h&&l.animations.push(h.Parse(S))}return l}clone(){let m=0;const S=I.e.Clone((()=>{const S=new Z(this.url,this.sm()||this._getEngine(),this._extensions,this._noMipmap,this._files);return m=S.uniqueId,S}),this);return S.uniqueId=m,S}}(0,l.d)([(0,M.F)()],Z.prototype,"url",void 0),(0,l.d)([(0,M.B)()],Z.prototype,"boundingBoxPosition",void 0),(0,l.d)([(0,M.B)()],Z.prototype,"boundingBoxSize",null),(0,l.d)([(0,M.F)("rotationY")],Z.prototype,"rotationY",null),(0,l.d)([(0,M.F)("files")],Z.prototype,"_files",void 0),(0,l.d)([(0,M.F)("forcedExtension")],Z.prototype,"_forcedExtension",void 0),(0,l.d)([(0,M.F)("extensions")],Z.prototype,"_extensions",void 0),(0,l.d)([(0,M.p)("textureMatrix")],Z.prototype,"_textureMatrix",void 0),(0,l.d)([(0,M.p)("textureMatrixRefraction")],Z.prototype,"_textureMatrixRefraction",void 0),q.e._CubeTextureParser=Z.Parse,(0,Y.e)("BABYLON.CubeTexture",Z)},13562:(m,S,h)=>{"use strict";h.d(S,{b:()=>q});var l=h(11173),M=h(11321),O=h(11305),u=h(11463),b=h(11262);u.ThinEngine.prototype.createDynamicTexture=function(m,S,h,l){const M=new b.d(this,4);return M.baseWidth=m,M.baseHeight=S,h&&(m=this.needPOTTextures?(0,O.e)(m,this._caps.maxTextureSize):m,S=this.needPOTTextures?(0,O.e)(S,this._caps.maxTextureSize):S),M.width=m,M.height=S,M.isReady=!1,M.generateMipMaps=h,M.samplingMode=l,this.updateTextureSamplingMode(l,M),this._internalTexturesCache.push(M),M},u.ThinEngine.prototype.updateDynamicTexture=function(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!m)return;const u=this._gl,b=u.TEXTURE_2D,q=this._bindTextureDirectly(b,m,!0,O);this._unpackFlipY(void 0===h?m.invertY:h),l&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Y=this._getWebGLTextureType(m.type),V=this._getInternalFormat(M||m.format),I=this._getRGBABufferInternalSizedFormat(m.type,V);u.texImage2D(b,0,I,V,Y,S),m.generateMipMaps&&u.generateMipmap(b),q||this._bindTextureDirectly(b,null),l&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),M&&(m.format=M),m._dynamicTextureSource=S,m._premulAlpha=l,m.invertY=h||!1,m.isReady=!0};class q extends M.e{constructor(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,b=arguments.length>6?arguments[6]:void 0;const q=!h||h._isScene;super(null,q?h:null===h||void 0===h?void 0:h.US,q?!l:h,b,O,void 0,void 0,void 0,void 0,u),this.name=m,this.wrapU=M.e.CLAMP_ADDRESSMODE,this.wrapV=M.e.CLAMP_ADDRESSMODE,this._generateMipMaps=l;const Y=this._getEngine();if(!Y)return;if(S.getContext)this._canvas=S,this._ownCanvas=!1,this._texture=Y.createDynamicTexture(this._canvas.width,this._canvas.height,l,O);else{this._canvas=Y.createCanvas(1,1),this._ownCanvas=!0;const m=S;m.width||0===m.width?this._texture=Y.createDynamicTexture(m.width,m.height,l,O):this._texture=Y.createDynamicTexture(S,S,l,O)}const V=this.getSize();this._canvas.width!==V.width&&(this._canvas.width=V.width),this._canvas.height!==V.height&&(this._canvas.height=V.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(m){this._canvas.width=m.width,this._canvas.height=m.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(m.width,m.height,this._generateMipMaps,this.samplingMode)}scale(m){const S=this.getSize();S.width*=m,S.height*=m,this._recreate(S)}scaleTo(m,S){const h=this.getSize();h.width=m,h.height=S,this._recreate(h)}getContext(){return this._context}clear(m){const S=this.getSize();m&&(this._context.fillStyle=m),this._context.clearRect(0,0,S.width,S.height)}update(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===m||m,S,this._format||void 0,void 0,h)}drawText(m,S,h,l,M,O,u){let b=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const q=this.getSize();if(O&&(this._context.fillStyle=O,this._context.fillRect(0,0,q.width,q.height)),this._context.font=l,null===S||void 0===S){const h=this._context.measureText(m);S=(q.width-h.width)/2}if(null===h||void 0===h){const m=parseInt(l.replace(/\D/g,""));h=q.height/2+m/3.65}this._context.fillStyle=M||"",this._context.fillText(m,S,h),b&&this.update(u)}dispose(){var m,S;(super.dispose(),this._ownCanvas)&&(null===(m=this._canvas)||void 0===m||null===(S=m.remove)||void 0===S||S.call(m));this._canvas=null,this._context=null}clone(){const m=this.sm();if(!m)return this;const S=this.getSize(),h=new q(this.name,S,m,this._generateMipMaps);return h.Sb=this.Sb,h.level=this.level,h.wrapU=this.wrapU,h.wrapV=this.wrapV,h}serialize(){const m=this.sm();m&&!m.isReady()&&l.e.Warn("The scene must be ready before serializing the dynamic texture");const S=super.serialize();return q._IsCanvasElement(this._canvas)&&(S.base64String=this._canvas.toDataURL()),S.invertY=this._invertY,S.samplingMode=this.samplingMode,S}static _IsCanvasElement(m){return void 0!==m.toDataURL}_rebuild(){this.update()}}},12931:(m,S,h)=>{"use strict";h.d(S,{d:()=>M});var l=h(11321);class M extends l.e{get depth(){return this._depth}constructor(m,S,h,M,O,u){let b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:l.e.TRILINEAR_SAMPLINGMODE,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,I=arguments.length>10?arguments[10]:void 0;super(null,u,!b,q),this.format=O,this._texture=u.getEngine().createRawTexture2DArray(m,S,h,M,O,b,q,Y,null,V,I),this._depth=M,this.is2DArray=!0}update(m){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,m,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(m,S,h,l,O){return new M(m,S,h,l,5,O,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12740:(m,S,h)=>{"use strict";h.d(S,{d:()=>b,h:()=>q,i:()=>O,l:()=>u});var l=h(11359),M=h(11347);function O(m,S){return`{X: ${m.x.toFixed(S)} Y: ${m.y.toFixed(S)}}`}function u(m,S){return`{X: ${m._x.toFixed(S)} Y: ${m._y.toFixed(S)} Z: ${m._z.toFixed(S)}}`}function b(m,S){return 2*Math.acos((0,l.Clamp)(M.Quaternion.Dot(m,S)))}function q(m,S){const h=new M.Quaternion;return function(m,S,h){const O=M.nS.Cross(m,S),u=Math.acos((0,l.Clamp)(M.nS.Dot(m,S),-1,1));M.Quaternion.RotationAxisToRef(O,u,h)}(m,S,h),h}},12573:(m,S,h)=>{"use strict";h.d(S,{e:()=>Y});var l=h(11347),M=h(11387),O=h(11751),u=h(11734),b=h(11395);h(12579);function q(m){let S=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const h=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],O=[];let q=[];const Y=m.width||m.size||1,V=m.height||m.size||1,I=m.depth||m.size||1,Z=m.wrap||!1;let C=void 0===m.topBaseAt?1:m.topBaseAt,B=void 0===m.bottomBaseAt?0:m.bottomBaseAt;C=(C+4)%4,B=(B+4)%4;let D=[2,0,3,1][C],E=[2,0,1,3][B],n=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Z){S=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],n=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let m=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],h=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const l=[17,18,19,16],M=[22,23,20,21];for(;D>0;)m.unshift(m.pop()),l.unshift(l.pop()),D--;for(;E>0;)h.unshift(h.pop()),M.unshift(M.pop()),E--;m=m.flat(),h=h.flat(),n=n.concat(m).concat(h),S.push(l[0],l[2],l[3],l[0],l[1],l[2]),S.push(M[0],M[2],M[3],M[0],M[1],M[2])}const L=[Y/2,V/2,I/2];q=n.reduce(((m,S,h)=>m.concat(S*L[h%3])),[]);const U=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,H=m.faceUV||new Array(6),R=m.faceColors,y=[];for(let u=0;u<6;u++)void 0===H[u]&&(H[u]=new l.Vector4(0,0,1,1)),R&&void 0===R[u]&&(R[u]=new M.Bb(1,1,1,1));for(let l=0;l<6;l++)if(O.push(H[l].z,b.d?1-H[l].w:H[l].w),O.push(H[l].x,b.d?1-H[l].w:H[l].w),O.push(H[l].x,b.d?1-H[l].y:H[l].y),O.push(H[l].z,b.d?1-H[l].y:H[l].y),R)for(let m=0;m<4;m++)y.push(R[l].r,R[l].g,R[l].b,R[l].a);u.c._ComputeSides(U,q,S,h,O,m.frontUVs,m.backUVs);const o=new u.c;if(o.indices=S,o.Tm=q,o.Xm=h,o.Gm=O,R){const m=U===u.c.DOUBLESIDE?y.concat(y):y;o.gm=m}return o}function Y(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new O.c(m,h);S.sideOrientation=O.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return q(S).xm(l,S.updatable),l}u.c.CreateBox=q,O.c.CreateBox=function(m,S){return Y(m,{size:S,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12731:(m,S,h)=>{"use strict";h.d(S,{d:()=>b});var l=h(11751),M=h(11734),O=h(11395);function u(m){const S=[],h=[],l=[],u=[],b=m.radius||.5,q=m.tessellation||64,Y=m.arc&&(m.arc<=0||m.arc>1)?1:m.arc||1,V=0===m.sideOrientation?0:m.sideOrientation||M.c.DEFAULTSIDE;S.push(0,0,0),u.push(.5,.5);const I=2*Math.PI*Y,Z=1===Y?I/q:I/(q-1);let C=0;for(let M=0;M<q;M++){const m=Math.cos(C),h=Math.sin(C),l=(m+1)/2,M=(1-h)/2;S.push(b*m,b*h,0),u.push(l,O.d?1-M:M),C+=Z}1===Y&&(S.push(S[3],S[4],S[5]),u.push(u[2],O.d?1-u[3]:u[3]));const B=S.length/3;for(let M=1;M<B-1;M++)h.push(M+1,0,M);M.c.ComputeNormals(S,h,l),M.c._ComputeSides(V,S,h,l,u,m.frontUVs,m.backUVs);const D=new M.c;return D.indices=h,D.Tm=S,D.Xm=l,D.Gm=u,D}function b(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new l.c(m,h);S.sideOrientation=l.c._GetDefaultSideOrientation(S.sideOrientation),M._originalBuilderSideOrientation=S.sideOrientation;return u(S).xm(M,S.updatable),M}M.c.CreateDisc=u,l.c.CreateDisc=function(m,S,h){return b(m,{radius:S,tessellation:h,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12579:(m,S,h)=>{"use strict";h.d(S,{g:()=>E,c:()=>L,i:()=>n});var l=h(11347),M=h(11387),O=h(11751),u=h(11734),b=h(11410);O.c._GroundMeshParser=(m,S)=>q.Parse(m,S);class q extends O.c{constructor(m,S){super(m,S),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=m,this._subdivisionsY=m,this.subdivide(m);const h=this;h.createOrUpdateSubmeshesOctree&&h.createOrUpdateSubmeshesOctree(S)}getHeightAtCoordinates(m,S){const h=this.getWorldMatrix(),M=l.TmpVectors.Matrix[5];h.invertToRef(M);const O=l.TmpVectors.nS[8];if(l.nS.TransformCoordinatesFromFloatsToRef(m,0,S,M,O),m=O.x,S=O.z,m<this._minX||m>=this._maxX||S<=this._minZ||S>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(m,S),b=-(u.x*m+u.z*S+u.w)/u.y;return l.nS.TransformCoordinatesFromFloatsToRef(0,b,0,h,O),O.y}getNormalAtCoordinates(m,S){const h=new l.nS(0,1,0);return this.getNormalAtCoordinatesToRef(m,S,h),h}getNormalAtCoordinatesToRef(m,S,h){const M=this.getWorldMatrix(),O=l.TmpVectors.Matrix[5];M.invertToRef(O);const u=l.TmpVectors.nS[8];if(l.nS.TransformCoordinatesFromFloatsToRef(m,0,S,O,u),m=u.x,S=u.z,m<this._minX||m>this._maxX||S<this._minZ||S>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const b=this._getFacetAt(m,S);return l.nS.TransformNormalFromFloatsToRef(b.x,b.y,b.z,M,h),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(m,S){const h=Math.floor((m+this._maxX)*this._subdivisionsX/this._width),l=Math.floor(-(S+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),M=this._heightQuads[l*this._subdivisionsX+h];let O;return O=S<M.slope.x*m+M.slope.y?M.facet1:M.facet2,O}_initHeightQuads(){const m=this._subdivisionsX,S=this._subdivisionsY;this._heightQuads=[];for(let h=0;h<S;h++)for(let S=0;S<m;S++){const M={slope:l.Vector2.Zero(),facet1:new l.Vector4(0,0,0,0),facet2:new l.Vector4(0,0,0,0)};this._heightQuads[h*m+S]=M}return this}_computeHeightQuads(){const m=this.getVerticesData(b.f.PositionKind);if(!m)return this;const S=l.TmpVectors.nS[3],h=l.TmpVectors.nS[2],M=l.TmpVectors.nS[1],O=l.TmpVectors.nS[0],u=l.TmpVectors.nS[4],q=l.TmpVectors.nS[5],Y=l.TmpVectors.nS[6],V=l.TmpVectors.nS[7],I=l.TmpVectors.nS[8];let Z=0,C=0,B=0,D=0,E=0,n=0,L=0;const U=this._subdivisionsX,H=this._subdivisionsY;for(let b=0;b<H;b++)for(let H=0;H<U;H++){Z=3*H,C=b*(U+1)*3,B=(b+1)*(U+1)*3,S.x=m[C+Z],S.y=m[C+Z+1],S.z=m[C+Z+2],h.x=m[C+Z+3],h.y=m[C+Z+4],h.z=m[C+Z+5],M.x=m[B+Z],M.y=m[B+Z+1],M.z=m[B+Z+2],O.x=m[B+Z+3],O.y=m[B+Z+4],O.z=m[B+Z+5],D=(O.z-S.z)/(O.x-S.x),E=S.z-D*S.x,h.subtractToRef(S,u),M.subtractToRef(S,q),O.subtractToRef(S,Y),l.nS.CrossToRef(Y,q,V),l.nS.CrossToRef(u,Y,I),V.normalize(),I.normalize(),n=-(V.x*S.x+V.y*S.y+V.z*S.z),L=-(I.x*h.x+I.y*h.y+I.z*h.z);const R=this._heightQuads[b*U+H];R.slope.Yb(D,E),R.facet1.Yb(V.x,V.y,V.z,n),R.facet2.Yb(I.x,I.y,I.z,L)}return this}serialize(m){super.serialize(m),m.subdivisionsX=this._subdivisionsX,m.subdivisionsY=this._subdivisionsY,m.minX=this._minX,m.maxX=this._maxX,m.hb=this._minZ,m.maxZ=this._maxZ,m.width=this._width,m.height=this._height}static Parse(m,S){const h=new q(m.name,S);return h._subdivisionsX=m.subdivisionsX||1,h._subdivisionsY=m.subdivisionsY||1,h._minX=m.minX,h._maxX=m.maxX,h._minZ=m.hb,h._maxZ=m.maxZ,h._width=m.width,h._height=m.height,h}}var Y=h(11156),V=h(11196),I=h(11350),Z=h(11395);function C(m){const S=[],h=[],M=[],O=[];let b,q;const Y=m.width||m.size||1,V=m.height||m.size||1,I=0|(m.subdivisionsX||m.subdivisions||1),C=0|(m.subdivisionsY||m.subdivisions||1);for(b=0;b<=C;b++)for(q=0;q<=I;q++){const m=new l.nS(q*Y/I-Y/2,0,(C-b)*V/C-V/2),S=new l.nS(0,1,0);h.push(m.x,m.y,m.z),M.push(S.x,S.y,S.z),O.push(q/I,Z.d?b/C:1-b/C)}for(b=0;b<C;b++)for(q=0;q<I;q++)S.push(q+1+(b+1)*(I+1)),S.push(q+1+b*(I+1)),S.push(q+b*(I+1)),S.push(q+(b+1)*(I+1)),S.push(q+1+(b+1)*(I+1)),S.push(q+b*(I+1));const B=new u.c;return B.indices=S,B.Tm=h,B.Xm=M,B.Gm=O,B}function B(m){const S=void 0!==m.xmin&&null!==m.xmin?m.xmin:-1,h=void 0!==m.zmin&&null!==m.zmin?m.zmin:-1,M=void 0!==m.xmax&&null!==m.xmax?m.xmax:1,O=void 0!==m.zmax&&null!==m.zmax?m.zmax:1,b=m.subdivisions||{w:1,h:1},q=m.precision||{w:1,h:1},Y=[],V=[],I=[],Z=[];let C,B,D,E;b.h=b.h<1?1:b.h,b.w=b.w<1?1:b.w,q.w=q.w<1?1:q.w,q.h=q.h<1?1:q.h;const n=(M-S)/b.w,L=(O-h)/b.h;function U(m,S,h,M){const O=V.length/3,u=q.w+1;for(C=0;C<q.h;C++)for(B=0;B<q.w;B++){const m=[O+B+C*u,O+(B+1)+C*u,O+(B+1)+(C+1)*u,O+B+(C+1)*u];Y.push(m[1]),Y.push(m[2]),Y.push(m[3]),Y.push(m[0]),Y.push(m[1]),Y.push(m[3])}const b=l.nS.Zero(),D=new l.nS(0,1,0);for(C=0;C<=q.h;C++)for(b.z=C*(M-S)/q.h+S,B=0;B<=q.w;B++)b.x=B*(h-m)/q.w+m,b.y=0,V.push(b.x,b.y,b.z),I.push(D.x,D.y,D.z),Z.push(B/q.w,C/q.h)}for(D=0;D<b.h;D++)for(E=0;E<b.w;E++)U(S+E*n,h+D*L,S+(E+1)*n,h+(D+1)*L);const H=new u.c;return H.indices=Y,H.Tm=V,H.Xm=I,H.Gm=Z,H}function D(m){const S=[],h=[],O=[],b=[];let q,Y;const V=m.colorFilter||new M.RS(.3,.59,.11),Z=m.alphaFilter||0;let C=!1;if(m.minHeight>m.maxHeight){C=!0;const S=m.maxHeight;m.maxHeight=m.minHeight,m.minHeight=S}for(q=0;q<=m.subdivisions;q++)for(Y=0;Y<=m.subdivisions;Y++){const S=new l.nS(Y*m.width/m.subdivisions-m.width/2,0,(m.subdivisions-q)*m.height/m.subdivisions-m.height/2),M=4*(((S.x+m.width/2)/m.width*(m.bufferWidth-1)|0)+((1-(S.z+m.height/2)/m.height)*(m.bufferHeight-1)|0)*m.bufferWidth);let u=m.buffer[M]/255,B=m.buffer[M+1]/255,D=m.buffer[M+2]/255;const E=m.buffer[M+3]/255;C&&(u=1-u,B=1-B,D=1-D);const n=u*V.r+B*V.g+D*V.b;S.y=E>=Z?m.minHeight+(m.maxHeight-m.minHeight)*n:m.minHeight-I.d,m.heightBuffer&&(m.heightBuffer[q*(m.subdivisions+1)+Y]=S.y),h.push(S.x,S.y,S.z),O.push(0,0,0),b.push(Y/m.subdivisions,1-q/m.subdivisions)}for(q=0;q<m.subdivisions;q++)for(Y=0;Y<m.subdivisions;Y++){const l=Y+1+(q+1)*(m.subdivisions+1),M=Y+1+q*(m.subdivisions+1),O=Y+q*(m.subdivisions+1),u=Y+(q+1)*(m.subdivisions+1),b=h[3*l+1]>=m.minHeight,V=h[3*M+1]>=m.minHeight,I=h[3*O+1]>=m.minHeight;b&&V&&I&&(S.push(l),S.push(M),S.push(O));h[3*u+1]>=m.minHeight&&b&&I&&(S.push(u),S.push(l),S.push(O))}u.c.ComputeNormals(h,S,O);const B=new u.c;return B.indices=S,B.Tm=h,B.Xm=O,B.Gm=b,B}function E(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=new q(m,arguments.length>2?arguments[2]:void 0);h._setReady(!1),h._subdivisionsX=S.subdivisionsX||S.subdivisions||1,h._subdivisionsY=S.subdivisionsY||S.subdivisions||1,h._width=S.width||1,h._height=S.height||1,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ;return C(S).xm(h,S.updatable),h._setReady(!0),h}function n(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new O.c(m,h);return B(S).xm(l,S.updatable),l}function L(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=h.width||10,u=h.height||10,b=h.subdivisions||1,I=h.minHeight||0,Z=h.maxHeight||1,C=h.colorFilter||new M.RS(.3,.59,.11),B=h.alphaFilter||0,E=h.updatable,n=h.onReady;l=l||V.d.LastCreatedScene;const L=new q(m,l);let U;L._subdivisionsX=b,L._subdivisionsY=b,L._width=O,L._height=u,L._maxX=L._width/2,L._maxZ=L._height/2,L._minX=-L._maxX,L._minZ=-L._maxZ,L._setReady(!1),h.passHeightBufferInCallback&&(U=new Float32Array((b+1)*(b+1)));const H=(m,S,h)=>{D({width:O,height:u,subdivisions:b,minHeight:I,maxHeight:Z,colorFilter:C,buffer:m,bufferWidth:S,bufferHeight:h,alphaFilter:B,heightBuffer:U}).xm(L,E),n&&n(L,U),L._setReady(!0)};if("string"===typeof S){const m=m=>{var S;const h=m.width,M=m.height;if(l.u)return;const O=null===(S=l)||void 0===S?void 0:S.getEngine().resizeImageBitmap(m,h,M);H(O,h,M)};Y.Tools.LoadImage(S,m,h.onError?h.onError:()=>{},l.offlineProvider)}else H(S.data,S.width,S.height);return L}u.c.CreateGround=C,u.c.CreateTiledGround=B,u.c.CreateGroundFromHeightMap=D,O.c.CreateGround=(m,S,h,l,M,O)=>E(m,{width:S,height:h,subdivisions:l,updatable:O},M),O.c.CreateTiledGround=(m,S,h,l,M,O,u,b,q)=>n(m,{xmin:S,zmin:h,xmax:l,zmax:M,subdivisions:O,precision:u,updatable:q},b),O.c.CreateGroundFromHeightMap=(m,S,h,l,M,O,u,b,q,Y,V)=>L(m,S,{width:h,height:l,subdivisions:M,minHeight:O,maxHeight:u,updatable:q,onReady:Y,alphaFilter:V},b)},13242:(m,S,h)=>{"use strict";h.d(S,{b:()=>C,e:()=>I,h:()=>Z});var l=h(11347),M=h(11751),O=h(11734),u=h(11857),b=h(11410),q=h(11173);function Y(m){const S=[],h=[],l=m.lines,M=m.gm,u=[];let b=0;for(let O=0;O<l.length;O++){const m=l[O];for(let l=0;l<m.length;l++){const{x:q,y:Y,z:V}=m[l];if(h.push(q,Y,V),M){const m=M[O],{r:S,g:h,b:b,a:q}=m[l];u.push(S,h,b,q)}l>0&&(S.push(b-1),S.push(b)),b++}}const q=new O.c;return q.indices=S,q.Tm=h,M&&(q.gm=u),q}function V(m){const S=m.dashSize||3,h=m.gapSize||1,M=m.dashNb||200,u=m.points,b=[],q=[],Y=l.nS.Zero();let V=0,I=0,Z=0,C=0,B=0,D=0,E=0;for(E=0;E<u.length-1;E++)u[E+1].subtractToRef(u[E],Y),V+=Y.length();for(Z=V/M,C=S*Z/(S+h),E=0;E<u.length-1;E++){u[E+1].subtractToRef(u[E],Y),I=Math.floor(Y.length()/Z),Y.normalize();for(let m=0;m<I;m++)B=Z*m,b.push(u[E].x+B*Y.x,u[E].y+B*Y.y,u[E].z+B*Y.z),b.push(u[E].x+(B+C)*Y.x,u[E].y+(B+C)*Y.y,u[E].z+(B+C)*Y.z),q.push(D,D+1),D+=2}const n=new O.c;return n.Tm=b,n.indices=q,n}function I(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=S.instance,M=S.lines,O=S.gm;if(l){const m=l.getVerticesData(b.f.PositionKind);let S,h;O&&(S=l.getVerticesData(b.f.ColorKind));let u=0,q=0;for(let l=0;l<M.length;l++){const b=M[l];for(let M=0;M<b.length;M++)m[u]=b[M].x,m[u+1]=b[M].y,m[u+2]=b[M].z,O&&S&&(h=O[l],S[q]=h[M].r,S[q+1]=h[M].g,S[q+2]=h[M].b,S[q+3]=h[M].a,q+=4),u+=3}return l.updateVerticesData(b.f.PositionKind,m,!1,!1),O&&S&&l.updateVerticesData(b.f.ColorKind,S,!1,!1),l.refreshBoundingInfo(),l}const q=!!O,V=new u.c(m,h,null,void 0,void 0,q,S.useVertexAlpha,S.material);return Y(S).xm(V,S.updatable),V}function Z(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=S.gm?[S.gm]:null;return I(m,{lines:[S.points],updatable:S.updatable,instance:S.instance,gm:l,useVertexAlpha:S.useVertexAlpha,material:S.material},h)}function C(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=S.points,b=S.instance,Y=S.gapSize||1,I=S.dashSize||3;if(b){const m=m=>{const S=l.nS.Zero(),h=m.length/6;let M=0,u=0,q=0,Y=0,V=0,I=0,Z=0,C=0;for(Z=0;Z<O.length-1;Z++)O[Z+1].subtractToRef(O[Z],S),M+=S.length();q=M/h;const B=b._creationDataStorage.dashSize;for(Y=B*q/(B+b._creationDataStorage.gapSize),Z=0;Z<O.length-1;Z++)for(O[Z+1].subtractToRef(O[Z],S),u=Math.floor(S.length()/q),S.normalize(),C=0;C<u&&I<m.length;)V=q*C,m[I]=O[Z].x+V*S.x,m[I+1]=O[Z].y+V*S.y,m[I+2]=O[Z].z+V*S.z,m[I+3]=O[Z].x+(V+Y)*S.x,m[I+4]=O[Z].y+(V+Y)*S.y,m[I+5]=O[Z].z+(V+Y)*S.z,I+=6,C++;for(;I<m.length;)m[I]=O[Z].x,m[I+1]=O[Z].y,m[I+2]=O[Z].z,I+=3};return(S.dashNb||S.dashSize||S.gapSize||S.useVertexAlpha||S.material)&&q.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),b.updateMeshPositions(m,!1),b}const Z=new u.c(m,h,null,void 0,void 0,void 0,S.useVertexAlpha,S.material);return V(S).xm(Z,S.updatable),Z._creationDataStorage=new M.g,Z._creationDataStorage.dashSize=I,Z._creationDataStorage.gapSize=Y,Z}O.c.CreateLineSystem=Y,O.c.CreateDashedLines=V,M.c.fY=function(m,S){return Z(m,{points:S,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},M.c.CreateDashedLines=function(m,S,h,l,M){return C(m,{points:S,dashSize:h,gapSize:l,dashNb:M,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12622:(m,S,h)=>{"use strict";h.d(S,{d:()=>b,h:()=>q});var l=h(11751),M=h(11734),O=h(11395);function u(m){const S=[],h=[],l=[],u=[],b=void 0!==m.width?m.width:void 0!==m.size?m.size:1,q=void 0!==m.height?m.height:void 0!==m.size?m.size:1,Y=0===m.sideOrientation?0:m.sideOrientation||M.c.DEFAULTSIDE,V=b/2,I=q/2;h.push(-V,-I,0),l.push(0,0,-1),u.push(0,O.d?1:0),h.push(V,-I,0),l.push(0,0,-1),u.push(1,O.d?1:0),h.push(V,I,0),l.push(0,0,-1),u.push(1,O.d?0:1),h.push(-V,I,0),l.push(0,0,-1),u.push(0,O.d?0:1),S.push(0),S.push(1),S.push(2),S.push(0),S.push(2),S.push(3),M.c._ComputeSides(Y,h,S,l,u,m.frontUVs,m.backUVs);const Z=new M.c;return Z.indices=S,Z.Tm=h,Z.Xm=l,Z.Gm=u,Z}function b(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new l.c(m,h);S.sideOrientation=l.c._GetDefaultSideOrientation(S.sideOrientation),M._originalBuilderSideOrientation=S.sideOrientation;return u(S).xm(M,S.updatable),S.sourcePlane&&(M.translate(S.sourcePlane.normal,-S.sourcePlane.d),M.setDirection(S.sourcePlane.normal.scale(-1))),M}const q={rY:b};M.c.rY=u,l.c.rY=(m,S,h,l,M)=>b(m,{size:S,width:S,height:S,sideOrientation:M,updatable:l},h)},12721:(m,S,h)=>{"use strict";h.d(S,{c:()=>q});var l=h(11347),M=h(11751),O=h(11734),u=h(11395);function b(m){const S=0|(m.segments||32),h=m.diameterX||m.diameter||1,M=m.diameterY||m.diameter||1,b=m.diameterZ||m.diameter||1,q=m.arc&&(m.arc<=0||m.arc>1)?1:m.arc||1,Y=m.slice&&m.slice<=0?1:m.slice||1,V=0===m.sideOrientation?0:m.sideOrientation||O.c.DEFAULTSIDE,I=!!m.dedupTopBottomIndices,Z=new l.nS(h/2,M/2,b/2),C=2+S,B=2*C,D=[],E=[],n=[],L=[];for(let O=0;O<=C;O++){const m=O/C,S=m*Math.PI*Y;for(let h=0;h<=B;h++){const M=h/B,O=M*Math.PI*2*q,b=l.Matrix.RotationZ(-S),Y=l.Matrix.RotationY(O),V=l.nS.TransformCoordinates(l.nS.Up(),b),I=l.nS.TransformCoordinates(V,Y),C=I.multiply(Z),D=I.divide(Z).normalize();E.push(C.x,C.y,C.z),n.push(D.x,D.y,D.z),L.push(M,u.d?1-m:m)}if(O>0){const m=E.length/3;for(let S=m-2*(B+1);S+B+2<m;S++)I?(O>1&&(D.push(S),D.push(S+1),D.push(S+B+1)),(O<C||Y<1)&&(D.push(S+B+1),D.push(S+1),D.push(S+B+2))):(D.push(S),D.push(S+1),D.push(S+B+1),D.push(S+B+1),D.push(S+1),D.push(S+B+2))}}O.c._ComputeSides(V,E,D,n,L,m.frontUVs,m.backUVs);const U=new O.c;return U.indices=D,U.Tm=E,U.Xm=n,U.Gm=L,U}function q(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return b(S).xm(l,S.updatable),l}O.c.CreateSphere=b,M.c.CreateSphere=(m,S,h,l,M,O)=>q(m,{segments:S,diameterX:h,diameterY:h,diameterZ:h,sideOrientation:O,updatable:M},l)},13566:(m,S,h)=>{"use strict";h.d(S,{e:()=>b});var l=h(11886),M=h(13033),O=h(11907),u=h(11734);class b{static get Configuration(){return{get decoder(){return M.e.DefaultConfiguration},set decoder(m){M.e.DefaultConfiguration=m}}}static set Configuration(m){M.e.DefaultConfiguration=m.decoder}static get DecoderAvailable(){return(0,l.g)(M.e.DefaultConfiguration)}static get Default(){return b._Default??(b._Default=new b),b._Default}static ResetDefault(m){b._Default&&(m||b._Default.dispose(),b._Default=null)}constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.DefaultNumWorkers;const S="number"===typeof m?{...M.e.DefaultConfiguration,numWorkers:m}:{...M.e.DefaultConfiguration,...m};this._decoder=new M.e(S)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(m,S,h){return this._decoder.decodeMeshToMeshDataAsync(m,S,h)}async decodeMeshToGeometryAsync(m,S,h,l){return await this._decoder.decodeMeshToGeometryAsync(m,S,h,l)}async _decodeMeshToGeometryForGltfAsync(m,S,h,l,M,O){return await this._decoder._decodeMeshToGeometryForGltfAsync(m,S,h,l,M,O)}async decodeMeshAsync(m,S){const h=await this._decoder.decodeMeshToMeshDataAsync(m,S),l=new u.c;h.indices&&(l.indices=h.indices);for(const M of h.attributes){const m=O.c.GetFloatData(M.data,M.size,O.c.GetDataType(M.data),M.byteOffset,M.byteStride,M.normalized,h.totalVertices);l.set(m,M.kind)}return l}}b.DefaultNumWorkers=(0,l.f)(),b._Default=null},13033:(m,S,h)=>{"use strict";h.d(S,{e:()=>Y});var l=h(11886),M=h(11156),O=h(11763),u=h(11907),b=h(11173),q=h(11900);class Y extends l.c{static get DefaultAvailable(){return(0,l.g)(Y.DefaultConfiguration)}static get Default(){return Y._Default??(Y._Default=new Y),Y._Default}static ResetDefault(m){Y._Default&&(m||Y._Default.dispose(),Y._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(m,S){return{module:await(S||DracoDecoderModule)({wasmBinary:m})}}_getWorkerContent(){return`${q.d}(${q.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.DefaultConfiguration)}decodeMeshToMeshDataAsync(m,S,h){const l=m instanceof ArrayBuffer?new Int8Array(m):new Int8Array(m.buffer,m.byteOffset,m.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async m=>await new Promise(((M,O)=>{m.push(((m,u)=>{let q=null;const Y=[],V=S=>{m.removeEventListener("error",V),m.removeEventListener("message",I),O(S),u()},I=S=>{const l=S.data;switch(l.id){case"indices":q=l.data;break;case"attribute":Y.push({kind:l.kind,data:l.data,size:l.size,byteOffset:l.byteOffset,byteStride:l.byteStride,normalized:(O=l.kind,Z=l.normalized,h&&void 0!==h[O]?(Z!==h[O]&&b.e.Warn(`Normalized flag from Draco data (${Z}) does not match normalized flag from glTF accessor (${h[O]}). Using flag from glTF accessor.`),h[O]):Z)});break;case"decodeMeshDone":m.removeEventListener("error",V),m.removeEventListener("message",I),M({indices:q,attributes:Y,totalVertices:l.totalVertices}),u()}var O,Z};m.addEventListener("error",V),m.addEventListener("message",I);const Z=l.slice();m.postMessage({id:"decodeMesh",dataView:Z,attributes:S},[Z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((m=>{let h=null;const M=[],O=(0,q.d)(m.module,l,S,(m=>{h=m}),((m,S,h,l,O,u)=>{M.push({kind:m,data:S,size:h,byteOffset:l,byteStride:O,normalized:u})}));return{indices:h,attributes:M,totalVertices:O}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(m,S,h,l){const M=await this.decodeMeshToMeshDataAsync(h,l),b=new O.e(m,S);M.indices&&b.setIndices(M.indices);for(const O of M.attributes)b.setVerticesBuffer(new u.c(S.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),M.totalVertices);return b}async _decodeMeshToGeometryForGltfAsync(m,S,h,l,M,b){const q=await this.decodeMeshToMeshDataAsync(h,l,M),Y=new O.e(m,S);b&&(Y._boundingInfo=b,Y.useBoundingInfoFromGeometry=!0),q.indices&&Y.setIndices(q.indices);for(const O of q.attributes)Y.setVerticesBuffer(new u.c(S.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),q.totalVertices);return Y}}Y.DefaultConfiguration={wasmUrl:`${M.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${M.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${M.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},Y._Default=null},13238:(m,S,h)=>{"use strict";h.d(S,{b:()=>bm});var l=h(11347),M=h(11751),O=h(11410),u=h(11734),b=h(11395);function q(m){let S=m.pathArray;const h=m.closeArray||!1,l=m.closePath||!1,M=m.invertUV||!1,q=Math.floor(S[0].length/2);let Y=m.offset||q;Y=Y>q?q:Math.floor(Y);const V=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,I=m.Gm,Z=m.gm,C=[],B=[],D=[],E=[],n=[],L=[],U=[],H=[];let R;const y=[],o=[];let s,v,T;if(S.length<2){const m=[],h=[];for(v=0;v<S[0].length-Y;v++)m.push(S[0][v]),h.push(S[0][v+Y]);S=[m,h]}let X=0;const g=l?1:0,G=h?1:0;let e,a,x,P,d,J;for(R=S[0].length,s=0;s<S.length+G;s++){for(U[s]=0,n[s]=[0],e=s===S.length?S[0]:S[s],a=e.length,R=R<a?R:a,T=0;T<a;)C.push(e[T].x,e[T].y,e[T].z),T>0&&(x=e[T].LS(e[T-1]).length(),P=x+U[s],n[s].push(P),U[s]=P),T++;l&&(T--,C.push(e[0].x,e[0].y,e[0].z),x=e[T].LS(e[0]).length(),P=x+U[s],n[s].push(P),U[s]=P),y[s]=a+g,o[s]=X,X+=a+g}let N,j,K=null,c=null;for(v=0;v<R+g;v++)for(H[v]=0,L[v]=[0],s=0;s<S.length-1+G;s++)d=S[s],J=s===S.length-1?S[0]:S[s+1],v===R?(K=d[0],c=J[0]):(K=d[v],c=J[v]),x=c.LS(K).length(),P=x+H[v],L[v].push(P),H[v]=P;if(I)for(s=0;s<I.length;s++)E.push(I[s].x,b.d?1-I[s].y:I[s].y);else for(s=0;s<S.length+G;s++)for(v=0;v<R+g;v++)N=0!=U[s]?n[s][v]/U[s]:0,j=0!=H[v]?L[v][s]/H[v]:0,M?E.push(j,N):E.push(N,b.d?1-j:j);s=0;let f=0,p=y[s]-1,k=y[s+1]-1,r=p<k?p:k,z=o[1]-o[0];const Q=y.length-1;for(;f<=r&&s<Q;)B.push(f,f+z,f+1),B.push(f+z+1,f+1,f+z),f+=1,f===r&&(s++,z=o[s+1]-o[s],p=y[s]-1,k=y[s+1]-1,f=o[s],r=p<k?p+f:k+f);if(u.c.ComputeNormals(C,B,D),l){let m=0,h=0;for(s=0;s<S.length;s++){m=3*o[s],h=s+1<S.length?3*(o[s+1]-1):D.length-3,D[m]=.5*(D[m]+D[h]),D[m+1]=.5*(D[m+1]+D[h+1]),D[m+2]=.5*(D[m+2]+D[h+2]);const l=Math.sqrt(D[m]*D[m]+D[m+1]*D[m+1]+D[m+2]*D[m+2]);D[m]/=l,D[m+1]/=l,D[m+2]/=l,D[h]=D[m],D[h+1]=D[m+1],D[h+2]=D[m+2]}}if(h){let m=3*o[0],h=3*o[S.length];for(v=0;v<R+g;v++){D[m]=.5*(D[m]+D[h]),D[m+1]=.5*(D[m+1]+D[h+1]),D[m+2]=.5*(D[m+2]+D[h+2]);const S=Math.sqrt(D[m]*D[m]+D[m+1]*D[m+1]+D[m+2]*D[m+2]);D[m]/=S,D[m+1]/=S,D[m+2]/=S,D[h]=D[m],D[h+1]=D[m+1],D[h+2]=D[m+2],m+=3,h+=3}}u.c._ComputeSides(V,C,B,D,E,m.frontUVs,m.backUVs);let F=null;if(Z){F=new Float32Array(4*Z.length);for(let m=0;m<Z.length;m++)F[4*m]=Z[m].r,F[4*m+1]=Z[m].g,F[4*m+2]=Z[m].b,F[4*m+3]=Z[m].a}const w=new u.c,t=new Float32Array(C),A=new Float32Array(D),i=new Float32Array(E);return w.indices=B,w.Tm=t,w.Xm=A,w.Gm=i,F&&w.set(F,O.f.ColorKind),l&&(w._idx=o),w}function Y(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=S.pathArray,V=S.closeArray,I=S.closePath,Z=M.c._GetDefaultSideOrientation(S.sideOrientation),C=S.instance,B=S.updatable;if(C){const m=l.TmpVectors.nS[0].Zb(Number.MAX_VALUE),h=l.TmpVectors.nS[1].Zb(-Number.MAX_VALUE),q=S=>{let l=Y[0].length;const O=C;let u=0;const b=O._originalBuilderSideOrientation===M.c.DOUBLESIDE?2:1;for(let M=1;M<=b;++M)for(let b=0;b<Y.length;++b){const M=Y[b],q=M.length;l=l<q?l:q;for(let O=0;O<l;++O){const l=M[O];S[u]=l.x,S[u+1]=l.y,S[u+2]=l.z,m.minimizeInPlaceFromFloats(l.x,l.y,l.z),h.maximizeInPlaceFromFloats(l.x,l.y,l.z),u+=3}if(O._creationDataStorage&&O._creationDataStorage.closePath){const m=M[0];S[u]=m.x,S[u+1]=m.y,S[u+2]=m.z,u+=3}}},V=C.getVerticesData(O.f.PositionKind);if(q(V),C.hasBoundingInfo?C.getBoundingInfo().reConstruct(m,h,C._worldMatrix):C.buildBoundingInfo(m,h,C._worldMatrix),C.updateVerticesData(O.f.PositionKind,V,!1,!1),S.gm){const m=C.getVerticesData(O.f.ColorKind);for(let h=0,l=0;h<S.gm.length;h++,l+=4){const M=S.gm[h];m[l]=M.r,m[l+1]=M.g,m[l+2]=M.b,m[l+3]=M.a}C.updateVerticesData(O.f.ColorKind,m,!1,!1)}if(S.Gm){const m=C.getVerticesData(O.f.UVKind);for(let h=0;h<S.Gm.length;h++)m[2*h]=S.Gm[h].x,m[2*h+1]=b.d?1-S.Gm[h].y:S.Gm[h].y;C.updateVerticesData(O.f.UVKind,m,!1,!1)}if(!C.areNormalsFrozen||C.isFacetDataEnabled){const m=C.bb(),S=C.getVerticesData(O.f.NormalKind),h=C.isFacetDataEnabled?C.getFacetDataParameters():null;if(u.c.ComputeNormals(V,m,S,h),C._creationDataStorage&&C._creationDataStorage.closePath){let m=0,h=0;for(let l=0;l<Y.length;l++)m=3*C._creationDataStorage.idx[l],h=l+1<Y.length?3*(C._creationDataStorage.idx[l+1]-1):S.length-3,S[m]=.5*(S[m]+S[h]),S[m+1]=.5*(S[m+1]+S[h+1]),S[m+2]=.5*(S[m+2]+S[h+2]),S[h]=S[m],S[h+1]=S[m+1],S[h+2]=S[m+2]}C.areNormalsFrozen||C.updateVerticesData(O.f.NormalKind,S,!1,!1)}return C}{const l=new M.c(m,h);l._originalBuilderSideOrientation=Z,l._creationDataStorage=new M.g;const O=q(S);return I&&(l._creationDataStorage.idx=O._idx),l._creationDataStorage.closePath=I,l._creationDataStorage.closeArray=V,O.xm(l,B),l}}u.c.CreateRibbon=q,M.c.CreateRibbon=function(m,S){return Y(m,{pathArray:S,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var V=h(12731),I=h(12573),Z=h(11387);function C(m){const S=m.pattern||M.c.NO_FLIP,h=m.tileWidth||m.tileSize||1,l=m.tileHeight||m.tileSize||1,O=m.alignHorizontal||0,b=m.alignVertical||0,q=m.width||m.size||1,Y=Math.floor(q/h);let V=q-Y*h;const I=m.height||m.size||1,Z=Math.floor(I/l);let C=I-Z*l;const B=h*Y/2,D=l*Z/2;let E=0,n=0,L=0,U=0,H=0,R=0;if(V>0||C>0){switch(L=-B,U=-D,H=B,R=D,O){case M.c.CENTER:V/=2,L-=V,H+=V;break;case M.c.LEFT:H+=V,E=-V/2;break;case M.c.RIGHT:L-=V,E=V/2}switch(b){case M.c.CENTER:C/=2,U-=C,R+=C;break;case M.c.BOTTOM:R+=C,n=-C/2;break;case M.c.TOP:U-=C,n=C/2}}const y=[],o=[],s=[];s[0]=[0,0,1,0,1,1,0,1],s[1]=[0,0,1,0,1,1,0,1],S!==M.c.ROTATE_TILE&&S!==M.c.ROTATE_ROW||(s[1]=[1,1,0,1,0,0,1,0]),S!==M.c.FLIP_TILE&&S!==M.c.FLIP_ROW||(s[1]=[1,0,0,0,0,1,1,1]),S!==M.c.FLIP_N_ROTATE_TILE&&S!==M.c.FLIP_N_ROTATE_ROW||(s[1]=[0,1,1,1,1,0,0,0]);let v=[];const T=[],X=[];let g=0;for(let u=0;u<Z;u++)for(let m=0;m<Y;m++)y.push(m*h-B+E,u*l-D+n,0),y.push((m+1)*h-B+E,u*l-D+n,0),y.push((m+1)*h-B+E,(u+1)*l-D+n,0),y.push(m*h-B+E,(u+1)*l-D+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),v=S===M.c.FLIP_TILE||S===M.c.ROTATE_TILE||S===M.c.FLIP_N_ROTATE_TILE?v.concat(s[(m%2+u%2)%2]):S===M.c.FLIP_ROW||S===M.c.ROTATE_ROW||S===M.c.FLIP_N_ROTATE_ROW?v.concat(s[u%2]):v.concat(s[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),g+=4;if(V>0||C>0){const m=C>0&&(b===M.c.CENTER||b===M.c.TOP),u=C>0&&(b===M.c.CENTER||b===M.c.BOTTOM),q=V>0&&(O===M.c.CENTER||O===M.c.RIGHT),I=V>0&&(O===M.c.CENTER||O===M.c.LEFT);let s,G,e,a,x=[];if(m&&q&&(y.push(L+E,U+n,0),y.push(-B+E,U+n,0),y.push(-B+E,U+C+n,0),y.push(L+E,U+C+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,s=1-V/h,G=1-C/l,e=1,a=1,x=[s,G,e,G,e,a,s,a],S===M.c.ROTATE_ROW&&(x=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),S===M.c.FLIP_ROW&&(x=[1-s,G,1-e,G,1-e,a,1-s,a]),S===M.c.FLIP_N_ROTATE_ROW&&(x=[s,1-G,e,1-G,e,1-a,s,1-a]),v=v.concat(x),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&I&&(y.push(B+E,U+n,0),y.push(H+E,U+n,0),y.push(H+E,U+C+n,0),y.push(B+E,U+C+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,s=0,G=1-C/l,e=V/h,a=1,x=[s,G,e,G,e,a,s,a],(S===M.c.ROTATE_ROW||S===M.c.ROTATE_TILE&&Y%2===0)&&(x=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),(S===M.c.FLIP_ROW||S===M.c.FLIP_TILE&&Y%2===0)&&(x=[1-s,G,1-e,G,1-e,a,1-s,a]),(S===M.c.FLIP_N_ROTATE_ROW||S===M.c.FLIP_N_ROTATE_TILE&&Y%2===0)&&(x=[s,1-G,e,1-G,e,1-a,s,1-a]),v=v.concat(x),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&q&&(y.push(L+E,D+n,0),y.push(-B+E,D+n,0),y.push(-B+E,R+n,0),y.push(L+E,R+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,s=1-V/h,G=0,e=1,a=C/l,x=[s,G,e,G,e,a,s,a],(S===M.c.ROTATE_ROW&&Z%2===1||S===M.c.ROTATE_TILE&&Z%1===0)&&(x=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),(S===M.c.FLIP_ROW&&Z%2===1||S===M.c.FLIP_TILE&&Z%2===0)&&(x=[1-s,G,1-e,G,1-e,a,1-s,a]),(S===M.c.FLIP_N_ROTATE_ROW&&Z%2===1||S===M.c.FLIP_N_ROTATE_TILE&&Z%2===0)&&(x=[s,1-G,e,1-G,e,1-a,s,1-a]),v=v.concat(x),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&I&&(y.push(B+E,D+n,0),y.push(H+E,D+n,0),y.push(H+E,R+n,0),y.push(B+E,R+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,s=0,G=0,e=V/h,a=C/l,x=[s,G,e,G,e,a,s,a],(S===M.c.ROTATE_ROW&&Z%2===1||S===M.c.ROTATE_TILE&&(Z+Y)%2===1)&&(x=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),(S===M.c.FLIP_ROW&&Z%2===1||S===M.c.FLIP_TILE&&(Z+Y)%2===1)&&(x=[1-s,G,1-e,G,1-e,a,1-s,a]),(S===M.c.FLIP_N_ROTATE_ROW&&Z%2===1||S===M.c.FLIP_N_ROTATE_TILE&&(Z+Y)%2===1)&&(x=[s,1-G,e,1-G,e,1-a,s,1-a]),v=v.concat(x),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m){const m=[];s=0,G=1-C/l,e=1,a=1,m[0]=[s,G,e,G,e,a,s,a],m[1]=[s,G,e,G,e,a,s,a],S!==M.c.ROTATE_TILE&&S!==M.c.ROTATE_ROW||(m[1]=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),S!==M.c.FLIP_TILE&&S!==M.c.FLIP_ROW||(m[1]=[1-s,G,1-e,G,1-e,a,1-s,a]),S!==M.c.FLIP_N_ROTATE_TILE&&S!==M.c.FLIP_N_ROTATE_ROW||(m[1]=[s,1-G,e,1-G,e,1-a,s,1-a]);for(let l=0;l<Y;l++)y.push(l*h-B+E,U+n,0),y.push((l+1)*h-B+E,U+n,0),y.push((l+1)*h-B+E,U+C+n,0),y.push(l*h-B+E,U+C+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=S===M.c.FLIP_TILE||S===M.c.ROTATE_TILE||S===M.c.FLIP_N_ROTATE_TILE?v.concat(m[(l+1)%2]):S===M.c.FLIP_ROW||S===M.c.ROTATE_ROW||S===M.c.FLIP_N_ROTATE_ROW?v.concat(m[1]):v.concat(m[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const m=[];s=0,G=0,e=1,a=C/l,m[0]=[s,G,e,G,e,a,s,a],m[1]=[s,G,e,G,e,a,s,a],S!==M.c.ROTATE_TILE&&S!==M.c.ROTATE_ROW||(m[1]=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),S!==M.c.FLIP_TILE&&S!==M.c.FLIP_ROW||(m[1]=[1-s,G,1-e,G,1-e,a,1-s,a]),S!==M.c.FLIP_N_ROTATE_TILE&&S!==M.c.FLIP_N_ROTATE_ROW||(m[1]=[s,1-G,e,1-G,e,1-a,s,1-a]);for(let l=0;l<Y;l++)y.push(l*h-B+E,R-C+n,0),y.push((l+1)*h-B+E,R-C+n,0),y.push((l+1)*h-B+E,R+n,0),y.push(l*h-B+E,R+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=S===M.c.FLIP_TILE||S===M.c.ROTATE_TILE||S===M.c.FLIP_N_ROTATE_TILE?v.concat(m[(l+Z)%2]):S===M.c.FLIP_ROW||S===M.c.ROTATE_ROW||S===M.c.FLIP_N_ROTATE_ROW?v.concat(m[Z%2]):v.concat(m[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const m=[];s=1-V/h,G=0,e=1,a=1,m[0]=[s,G,e,G,e,a,s,a],m[1]=[s,G,e,G,e,a,s,a],S!==M.c.ROTATE_TILE&&S!==M.c.ROTATE_ROW||(m[1]=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),S!==M.c.FLIP_TILE&&S!==M.c.FLIP_ROW||(m[1]=[1-s,G,1-e,G,1-e,a,1-s,a]),S!==M.c.FLIP_N_ROTATE_TILE&&S!==M.c.FLIP_N_ROTATE_ROW||(m[1]=[s,1-G,e,1-G,e,1-a,s,1-a]);for(let h=0;h<Z;h++)y.push(L+E,h*l-D+n,0),y.push(L+V+E,h*l-D+n,0),y.push(L+V+E,(h+1)*l-D+n,0),y.push(L+E,(h+1)*l-D+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=S===M.c.FLIP_TILE||S===M.c.ROTATE_TILE||S===M.c.FLIP_N_ROTATE_TILE?v.concat(m[(h+1)%2]):S===M.c.FLIP_ROW||S===M.c.ROTATE_ROW||S===M.c.FLIP_N_ROTATE_ROW?v.concat(m[h%2]):v.concat(m[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(I){const m=[];s=0,G=0,e=V/l,a=1,m[0]=[s,G,e,G,e,a,s,a],m[1]=[s,G,e,G,e,a,s,a],S!==M.c.ROTATE_TILE&&S!==M.c.ROTATE_ROW||(m[1]=[1-s,1-G,1-e,1-G,1-e,1-a,1-s,1-a]),S!==M.c.FLIP_TILE&&S!==M.c.FLIP_ROW||(m[1]=[1-s,G,1-e,G,1-e,a,1-s,a]),S!==M.c.FLIP_N_ROTATE_TILE&&S!==M.c.FLIP_N_ROTATE_ROW||(m[1]=[s,1-G,e,1-G,e,1-a,s,1-a]);for(let h=0;h<Z;h++)y.push(H-V+E,h*l-D+n,0),y.push(H+E,h*l-D+n,0),y.push(H+E,(h+1)*l-D+n,0),y.push(H-V+E,(h+1)*l-D+n,0),X.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=S===M.c.FLIP_TILE||S===M.c.ROTATE_TILE||S===M.c.FLIP_N_ROTATE_TILE?v.concat(m[(h+Y)%2]):S===M.c.FLIP_ROW||S===M.c.ROTATE_ROW||S===M.c.FLIP_N_ROTATE_ROW?v.concat(m[h%2]):v.concat(m[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const G=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE;u.c._ComputeSides(G,y,X,o,v,m.frontUVs,m.backUVs);const e=new u.c;e.indices=X,e.Tm=y,e.Xm=o,e.Gm=v;const a=G===u.c.DOUBLESIDE?T.concat(T):T;return e.gm=a,e}function B(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return C(S).xm(l,S.updatable),l}function D(m){const S=m.faceUV||new Array(6),h=m.faceColors,O=m.pattern||M.c.NO_FLIP,q=m.width||m.size||1,Y=m.height||m.size||1,V=m.depth||m.size||1,I=m.tileWidth||m.tileSize||1,B=m.tileHeight||m.tileSize||1,D=m.alignHorizontal||0,E=m.alignVertical||0,n=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE;for(let M=0;M<6;M++)void 0===S[M]&&(S[M]=new l.Vector4(0,0,1,1)),h&&void 0===h[M]&&(h[M]=new Z.Bb(1,1,1,1));const L=q/2,U=Y/2,H=V/2,R=[];for(let l=0;l<2;l++)R[l]=C({pattern:O,tileWidth:I,tileHeight:B,width:q,height:Y,alignVertical:E,alignHorizontal:D,sideOrientation:n});for(let l=2;l<4;l++)R[l]=C({pattern:O,tileWidth:I,tileHeight:B,width:V,height:Y,alignVertical:E,alignHorizontal:D,sideOrientation:n});let y=E;E===M.c.BOTTOM?y=M.c.TOP:E===M.c.TOP&&(y=M.c.BOTTOM);for(let l=4;l<6;l++)R[l]=C({pattern:O,tileWidth:I,tileHeight:B,width:q,height:V,alignVertical:y,alignHorizontal:D,sideOrientation:n});let o=[],s=[],v=[],T=[];const X=[],g=[],G=[],e=[];let a=0,x=0;for(let M=0;M<6;M++){const m=R[M].Tm.length;g[M]=[],G[M]=[];for(let S=0;S<m/3;S++)g[M].push(new l.nS(R[M].Tm[3*S],R[M].Tm[3*S+1],R[M].Tm[3*S+2])),G[M].push(new l.nS(R[M].Xm[3*S],R[M].Xm[3*S+1],R[M].Xm[3*S+2]));a=R[M].Gm.length,e[M]=[];for(let h=0;h<a;h+=2)e[M][h]=S[M].x+(S[M].z-S[M].x)*R[M].Gm[h],e[M][h+1]=S[M].y+(S[M].w-S[M].y)*R[M].Gm[h+1],b.d&&(e[M][h+1]=1-e[M][h+1]);if(v=v.concat(e[M]),T=T.concat(R[M].indices.map((m=>m+x))),x+=g[M].length,h)for(let S=0;S<4;S++)X.push(h[M].r,h[M].g,h[M].b,h[M].a)}const P=new l.nS(0,0,H),d=l.Matrix.RotationY(Math.PI);o=g[0].map((m=>l.nS.TransformNormal(m,d).add(P))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[]),s=G[0].map((m=>l.nS.TransformNormal(m,d))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[]),o=o.concat(g[1].map((m=>m.LS(P))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[])),s=s.concat(G[1].map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[]));const J=new l.nS(L,0,0),N=l.Matrix.RotationY(-Math.PI/2);o=o.concat(g[2].map((m=>l.nS.TransformNormal(m,N).add(J))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[])),s=s.concat(G[2].map((m=>l.nS.TransformNormal(m,N))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[]));const j=l.Matrix.RotationY(Math.PI/2);o=o.concat(g[3].map((m=>l.nS.TransformNormal(m,j).LS(J))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[])),s=s.concat(G[3].map((m=>l.nS.TransformNormal(m,j))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[]));const K=new l.nS(0,U,0),c=l.Matrix.RotationX(Math.PI/2);o=o.concat(g[4].map((m=>l.nS.TransformNormal(m,c).add(K))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[])),s=s.concat(G[4].map((m=>l.nS.TransformNormal(m,c))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[]));const f=l.Matrix.RotationX(-Math.PI/2);o=o.concat(g[5].map((m=>l.nS.TransformNormal(m,f).LS(K))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[])),s=s.concat(G[5].map((m=>l.nS.TransformNormal(m,f))).map((m=>[m.x,m.y,m.z])).reduce(((m,S)=>m.concat(S)),[])),u.c._ComputeSides(n,o,T,s,v);const p=new u.c;if(p.indices=T,p.Tm=o,p.Xm=s,p.Gm=v,h){const m=n===u.c.DOUBLESIDE?X.concat(X):X;p.gm=m}return p}function E(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return D(S).xm(l,S.updatable),l}u.c.CreateTiledPlane=C;u.c.CreateTiledBox=D;var n=h(12721),L=h(11567),U=h(11532);function H(m){const S=m.height||2;let h=0===m.diameterTop?0:m.diameterTop||m.diameter||1,O=0===m.diameterBottom?0:m.diameterBottom||m.diameter||1;h=h||1e-5,O=O||1e-5;const q=0|(m.tessellation||24),Y=0|(m.subdivisions||1),V=!!m.hasRings,I=!!m.enclose,C=0===m.cap?0:m.cap||M.c.CAP_ALL,B=m.arc&&(m.arc<=0||m.arc>1)?1:m.arc||1,D=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,E=m.faceUV||new Array(3),n=m.faceColors,L=2+(1+(1!==B&&I?2:0))*(V?Y:1);let H;for(H=0;H<L;H++)n&&void 0===n[H]&&(n[H]=new Z.Bb(1,1,1,1));for(H=0;H<L;H++)E&&void 0===E[H]&&(E[H]=new l.Vector4(0,0,1,1));const R=[],y=[],o=[],s=[],v=[],T=2*Math.PI*B/q;let X,g,G;const e=(O-h)/2/S,a=l.nS.Zero(),x=l.nS.Zero(),P=l.nS.Zero(),d=l.nS.Zero(),J=l.nS.Zero(),N=U.c.Y;let j,K,c,f=1,p=1,k=0,r=0;for(j=0;j<=Y;j++)for(g=j/Y,G=(g*(h-O)+O)/2,f=V&&0!==j&&j!==Y?2:1,c=0;c<f;c++){for(V&&(p+=c),I&&(p+=2*c),K=0;K<=q;K++)X=K*T,a.x=Math.cos(-X)*G,a.y=-S/2+g*S,a.z=Math.sin(-X)*G,0===h&&j===Y?(x.x=o[o.length-3*(q+1)],x.y=o[o.length-3*(q+1)+1],x.z=o[o.length-3*(q+1)+2]):(x.x=a.x,x.z=a.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*e,x.normalize()),0===K&&(P.l(a),d.l(x)),y.push(a.x,a.y,a.z),o.push(x.x,x.y,x.z),r=V?k!==p?E[p].y:E[p].w:E[p].y+(E[p].w-E[p].y)*g,s.push(E[p].x+(E[p].z-E[p].x)*K/q,b.d?1-r:r),n&&v.push(n[p].r,n[p].g,n[p].b,n[p].a);1!==B&&I&&(y.push(a.x,a.y,a.z),y.push(0,a.y,0),y.push(0,a.y,0),y.push(P.x,P.y,P.z),l.nS.CrossToRef(N,x,J),J.normalize(),o.push(J.x,J.y,J.z,J.x,J.y,J.z),l.nS.CrossToRef(d,N,J),J.normalize(),o.push(J.x,J.y,J.z,J.x,J.y,J.z),r=V?k!==p?E[p+1].y:E[p+1].w:E[p+1].y+(E[p+1].w-E[p+1].y)*g,s.push(E[p+1].x,b.d?1-r:r),s.push(E[p+1].z,b.d?1-r:r),r=V?k!==p?E[p+2].y:E[p+2].w:E[p+2].y+(E[p+2].w-E[p+2].y)*g,s.push(E[p+2].x,b.d?1-r:r),s.push(E[p+2].z,b.d?1-r:r),n&&(v.push(n[p+1].r,n[p+1].g,n[p+1].b,n[p+1].a),v.push(n[p+1].r,n[p+1].g,n[p+1].b,n[p+1].a),v.push(n[p+2].r,n[p+2].g,n[p+2].b,n[p+2].a),v.push(n[p+2].r,n[p+2].g,n[p+2].b,n[p+2].a))),k!==p&&(k=p)}const z=1!==B&&I?q+4:q;for(j=0,p=0;p<Y;p++){let m=0,S=0,h=0,l=0;for(K=0;K<q;K++)m=j*(z+1)+K,S=(j+1)*(z+1)+K,h=j*(z+1)+(K+1),l=(j+1)*(z+1)+(K+1),R.push(m,S,h),R.push(l,h,S);1!==B&&I&&(R.push(m+2,S+2,h+2),R.push(l+2,h+2,S+2),R.push(m+4,S+4,h+4),R.push(l+4,h+4,S+4)),j=V?j+2:j+1}const Q=m=>{const M=m?h/2:O/2;if(0===M)return;let u,Y,V;const I=m?E[L-1]:E[0];let Z=null;n&&(Z=m?n[L-1]:n[0]);const C=y.length/3,D=m?S/2:-S/2,U=new l.nS(0,D,0);y.push(U.x,U.y,U.z),o.push(0,m?1:-1,0);const H=I.y+.5*(I.w-I.y);s.push(I.x+.5*(I.z-I.x),b.d?1-H:H),Z&&v.push(Z.r,Z.g,Z.b,Z.a);const T=new l.Vector2(.5,.5);for(V=0;V<=q;V++){u=2*Math.PI*V*B/q;const S=Math.cos(-u),h=Math.sin(-u);Y=new l.nS(S*M,D,h*M);const O=new l.Vector2(S*T.x+.5,h*T.y+.5);y.push(Y.x,Y.y,Y.z),o.push(0,m?1:-1,0);const C=I.y+(I.w-I.y)*O.y;s.push(I.x+(I.z-I.x)*O.x,b.d?1-C:C),Z&&v.push(Z.r,Z.g,Z.b,Z.a)}for(V=0;V<q;V++)m?(R.push(C),R.push(C+(V+2)),R.push(C+(V+1))):(R.push(C),R.push(C+(V+1)),R.push(C+(V+2)))};C!==M.c.CAP_START&&C!==M.c.CAP_ALL||Q(!1),C!==M.c.CAP_END&&C!==M.c.CAP_ALL||Q(!0),u.c._ComputeSides(D,y,R,o,s,m.frontUVs,m.backUVs);const F=new u.c;return F.indices=R,F.Tm=y,F.Xm=o,F.Gm=s,n&&(F.gm=v),F}function R(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return H(S).xm(l,S.updatable),l}function y(m){const S=[],h=[],M=[],O=[],q=m.diameter||1,Y=m.thickness||.5,V=0|(m.tessellation||16),I=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,Z=V+1;for(let u=0;u<=V;u++){const m=u/V,I=u*Math.PI*2/V-Math.PI/2,C=l.Matrix.Translation(q/2,0,0).multiply(l.Matrix.RotationY(I));for(let q=0;q<=V;q++){const I=1-q/V,B=q*Math.PI*2/V+Math.PI,D=Math.cos(B),E=Math.sin(B);let n=new l.nS(D,E,0),L=n.scale(Y/2);const U=new l.Vector2(m,I);L=l.nS.TransformCoordinates(L,C),n=l.nS.TransformNormal(n,C),h.push(L.x,L.y,L.z),M.push(n.x,n.y,n.z),O.push(U.x,b.d?1-U.y:U.y);const H=(u+1)%Z,R=(q+1)%Z;S.push(u*Z+q),S.push(u*Z+R),S.push(H*Z+q),S.push(u*Z+R),S.push(H*Z+R),S.push(H*Z+q)}}u.c._ComputeSides(I,h,S,M,O,m.frontUVs,m.backUVs);const C=new u.c;return C.indices=S,C.Tm=h,C.Xm=M,C.Gm=O,C}function o(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return y(S).xm(l,S.updatable),l}u.c.CreateCylinder=H,M.c.CreateCylinder=(m,S,h,l,O,u,b,q,Y)=>{void 0!==b&&b instanceof L.c||(void 0!==b&&(Y=q||M.c.DEFAULTSIDE,q=b),b=u,u=1);return R(m,{height:S,diameterTop:h,diameterBottom:l,tessellation:O,subdivisions:u,sideOrientation:Y,updatable:q},b)};function s(m){const S=[],h=[],M=[],O=[],q=m.radius||2,Y=m.tube||.5,V=m.radialSegments||32,I=m.tubularSegments||32,Z=m.p||2,C=m.q||3,B=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,D=m=>{const S=Math.cos(m),h=Math.sin(m),M=C/Z*m,O=Math.cos(M),u=q*(2+O)*.5*S,b=q*(2+O)*h*.5,Y=q*Math.sin(M)*.5;return new l.nS(u,b,Y)};let E,n;for(E=0;E<=V;E++){const m=E%V/V*2*Z*Math.PI,S=D(m),M=D(m+.01),u=M.LS(S);let q=M.add(S);const C=l.nS.Cross(u,q);for(q=l.nS.Cross(C,u),C.normalize(),q.normalize(),n=0;n<I;n++){const m=n%I/I*2*Math.PI,l=-Y*Math.cos(m),M=Y*Math.sin(m);h.push(S.x+l*q.x+M*C.x),h.push(S.y+l*q.y+M*C.y),h.push(S.z+l*q.z+M*C.z),O.push(E/V),O.push(b.d?1-n/I:n/I)}}for(E=0;E<V;E++)for(n=0;n<I;n++){const m=(n+1)%I,h=E*I+n,l=(E+1)*I+n,M=(E+1)*I+m,O=E*I+m;S.push(O),S.push(l),S.push(h),S.push(O),S.push(M),S.push(l)}u.c.ComputeNormals(h,S,M),u.c._ComputeSides(B,h,S,M,O,m.frontUVs,m.backUVs);const L=new u.c;return L.indices=S,L.Tm=h,L.Xm=M,L.Gm=O,L}function v(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return s(S).xm(l,S.updatable),l}u.c.CreateTorus=y,M.c.CreateTorus=(m,S,h,l,M,O,u)=>o(m,{diameter:S,thickness:h,tessellation:l,sideOrientation:u,updatable:O},M);u.c.CreateTorusKnot=s,M.c.CreateTorusKnot=(m,S,h,l,M,O,u,b,q,Y)=>v(m,{radius:S,tube:h,radialSegments:l,tubularSegments:M,p:O,q:u,sideOrientation:Y,updatable:q},b);var T=h(13242),X=h(11874),g=h(11541);function G(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=S.path,O=S.shape,u=S.scale||1,b=S.rotation||0,q=0===S.cap?0:S.cap||M.c.NO_CAP,Y=S.updatable,V=M.c._GetDefaultSideOrientation(S.sideOrientation),I=S.instance||null,Z=S.invertUV||!1,C=S.closeShape||!1,B=S.closePath||!1,D=S.capFunction||null;return a(m,O,l,u,b,null,null,B,C,q,!1,h,!!Y,V,I,Z,S.frontUVs||null,S.backUVs||null,S.firstNormal||null,!!S.adjustFrame,D)}function e(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=S.path,O=S.shape,u=S.scaleFunction||(()=>1),b=S.rotationFunction||(()=>0),q=S.closePath||S.ribbonCloseArray||!1,Y=S.closeShape||S.ribbonClosePath||!1,V=0===S.cap?0:S.cap||M.c.NO_CAP,I=S.updatable,Z=S.firstNormal||null,C=S.adjustFrame||!1,B=M.c._GetDefaultSideOrientation(S.sideOrientation),D=S.instance,E=S.invertUV||!1,n=S.capFunction||null;return a(m,O,l,null,null,u,b,q,Y,V,!0,h,!!I,B,D||null,E,S.frontUVs||null,S.backUVs||null,Z,C,n||null)}function a(m,S,h,O,u,b,q,V,I,Z,C,B,D,E,n,L,U,H,R,y,o){const s=(m,S,h,O,u,b,q,Y,V,I,Z)=>{const C=h.getTangents(),B=h.getNormals(),D=h.getBinormals(),E=h.getDistances();if(Z)for(let M=0;M<C.length;M++)if(0==C[M].x&&0==C[M].y&&0==C[M].z&&C[M].l(C[M-1]),0==B[M].x&&0==B[M].y&&0==B[M].z&&B[M].l(B[M-1]),0==D[M].x&&0==D[M].y&&0==D[M].z&&D[M].l(D[M-1]),M>0){let m=C[M-1];l.nS.Dot(m,C[M])<0&&C[M].scaleInPlace(-1),m=B[M-1],l.nS.Dot(m,B[M])<0&&B[M].scaleInPlace(-1),m=D[M-1],l.nS.Dot(m,D[M])<0&&D[M].scaleInPlace(-1)}let n=0;const L=I&&Y?Y:()=>null!==b?b:0,U=I&&q?q:()=>null!==u?u:1;let H=V===M.c.NO_CAP||V===M.c.CAP_END?0:2;const R=l.TmpVectors.Matrix[0];for(let M=0;M<S.length;M++){const h=[],u=L(M,E[M]),b=U(M,E[M]);l.Matrix.RotationAxisToRef(C[M],n,R);for(let O=0;O<m.length;O++){const u=C[M].scale(m[O].z).add(B[M].scale(m[O].x)).add(D[M].scale(m[O].y)),q=l.nS.Zero();l.nS.TransformCoordinatesToRef(u,R,q),q.scaleInPlace(b).addInPlace(S[M]),h[O]=q}O[H]=h,n+=u,H++}const y=o||(m=>{const S=Array(),h=l.nS.Zero();let M;for(M=0;M<m.length;M++)h.addInPlace(m[M]);for(h.scaleInPlace(1/m.length),M=0;M<m.length;M++)S.push(h);return S});switch(V){case M.c.NO_CAP:break;case M.c.CAP_START:O[0]=y(O[2]),O[1]=O[2];break;case M.c.CAP_END:O[H]=O[H-1],O[H+1]=y(O[H-1]);break;case M.c.CAP_ALL:O[0]=y(O[2]),O[1]=O[2],O[H]=O[H-1],O[H+1]=y(O[H-1])}return O};let v,T;if(n){const m=n._creationDataStorage;return v=R?m.path3D.update(h,R):m.path3D.update(h),T=s(S,h,m.path3D,m.pathArray,O,u,b,q,m.cap,C,y),n=Y("",{pathArray:T,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:n},B||void 0)}v=R?new g.k(h,R):new g.k(h);T=s(S,h,v,new Array,O,u,b,q,Z=Z<0||Z>3?0:Z,C,y);const X=Y(m,{pathArray:T,closeArray:V,closePath:I,updatable:D,sideOrientation:E,invertUV:L,frontUVs:U||void 0,backUVs:H||void 0},B);return X._creationDataStorage.pathArray=T,X._creationDataStorage.path3D=v,X._creationDataStorage.cap=Z,X}function x(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=S.arc?S.arc<=0||S.arc>1?1:S.arc:1,u=void 0===S.closed||S.closed,b=S.shape,q=S.radius||1,V=S.tessellation||64,I=S.clip||0,Z=S.updatable,C=M.c._GetDefaultSideOrientation(S.sideOrientation),B=S.cap||M.c.NO_CAP,D=2*Math.PI,E=[],n=S.invertUV||!1;let L=0,U=0;const H=D/V*O;let R,y;for(L=0;L<=V-I;L++){for(y=[],B!=M.c.CAP_START&&B!=M.c.CAP_ALL||(y.push(new l.nS(0,b[0].y,0)),y.push(new l.nS(Math.cos(L*H)*b[0].x*q,b[0].y,Math.sin(L*H)*b[0].x*q))),U=0;U<b.length;U++)R=new l.nS(Math.cos(L*H)*b[U].x*q,b[U].y,Math.sin(L*H)*b[U].x*q),y.push(R);B!=M.c.CAP_END&&B!=M.c.CAP_ALL||(y.push(new l.nS(Math.cos(L*H)*b[b.length-1].x*q,b[b.length-1].y,Math.sin(L*H)*b[b.length-1].x*q)),y.push(new l.nS(0,b[b.length-1].y,0))),E.push(y)}return Y(m,{pathArray:E,closeArray:u,sideOrientation:C,updatable:Z,invertUV:n,frontUVs:S.frontUVs,backUVs:S.backUVs},h)}M.c.ExtrudeShape=function(m,S,h,l,O,u){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8?arguments[8]:void 0,V=arguments.length>9?arguments[9]:void 0;return G(m,{shape:S,path:h,scale:l,rotation:O,cap:0===u?0:u||M.c.NO_CAP,sideOrientation:Y,instance:V,updatable:q},b)},M.c.ExtrudeShapeCustom=(m,S,h,l,O,u,b,q,Y,V,I,Z)=>e(m,{shape:S,path:h,scaleFunction:l,rotationFunction:O,ribbonCloseArray:u,ribbonClosePath:b,cap:0===q?0:q||M.c.NO_CAP,sideOrientation:I,instance:Z,updatable:V},Y);M.c.CreateLathe=(m,S,h,l,M,O,u)=>x(m,{shape:S,radius:h,tessellation:l,sideOrientation:u,updatable:O},M);var P=h(12622),d=h(12579);function J(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=S.path;let u=S.instance,b=1;void 0!==S.radius?b=S.radius:u&&(b=u._creationDataStorage.radius);const q=S.tessellation||64,V=S.radiusFunction||null;let I=S.cap||M.c.NO_CAP;const Z=S.invertUV||!1,C=S.updatable,B=M.c._GetDefaultSideOrientation(S.sideOrientation);S.arc=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1;const D=(m,S,h,O,u,b,q,Y)=>{const V=S.getTangents(),I=S.getNormals(),Z=S.getDistances(),C=2*Math.PI/u*Y,B=b||(()=>O);let D,E,n,L;const U=l.TmpVectors.Matrix[0];let H=q===M.c.NO_CAP||q===M.c.CAP_END?0:2;for(let M=0;M<m.length;M++){E=B(M,Z[M]),D=Array(),n=I[M];for(let S=0;S<u;S++)l.Matrix.RotationAxisToRef(V[M],C*S,U),L=D[S]?D[S]:l.nS.Zero(),l.nS.TransformCoordinatesToRef(n,U,L),L.scaleInPlace(E).addInPlace(m[M]),D[S]=L;h[H]=D,H++}const R=(S,h)=>{const l=Array();for(let M=0;M<S;M++)l.push(m[h]);return l};switch(q){case M.c.NO_CAP:break;case M.c.CAP_START:h[0]=R(u,0),h[1]=h[2].slice(0);break;case M.c.CAP_END:h[H]=h[H-1].slice(0),h[H+1]=R(u,m.length-1);break;case M.c.CAP_ALL:h[0]=R(u,0),h[1]=h[2].slice(0),h[H]=h[H-1].slice(0),h[H+1]=R(u,m.length-1)}return h};let E,n;if(u){const m=u._creationDataStorage,h=S.arc||m.arc;return E=m.path3D.update(O),n=D(O,E,m.pathArray,b,m.tessellation,V,m.cap,h),u=Y("",{pathArray:n,instance:u}),m.path3D=E,m.pathArray=n,m.arc=h,m.radius=b,u}E=new g.k(O);I=I<0||I>3?0:I,n=D(O,E,new Array,b,q,V,I,S.arc);const L=Y(m,{pathArray:n,closePath:!0,closeArray:!1,updatable:C,sideOrientation:B,invertUV:Z,frontUVs:S.frontUVs,backUVs:S.backUVs},h);return L._creationDataStorage.pathArray=n,L._creationDataStorage.path3D=E,L._creationDataStorage.tessellation=q,L._creationDataStorage.cap=I,L._creationDataStorage.arc=S.arc,L._creationDataStorage.radius=b,L}function N(m){const S=[];S[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},S[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},S[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},S[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},S[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},S[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},S[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},S[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},S[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},S[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},S[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},S[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},S[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},S[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},S[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const h=m.type&&(m.type<0||m.type>=S.length)?0:m.type||0,M=m.size,O=m.sizeX||M||1,q=m.sizeY||M||1,Y=m.sizeZ||M||1,V=m.custom||S[h],I=V.face.length,C=m.faceUV||new Array(I),B=m.faceColors,D=void 0===m.flat||m.flat,E=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,n=[],L=[],U=[],H=[],R=[];let y=0,o=0;const s=[];let v,T,X,g,G,e,a=0,x=0;if(D)for(x=0;x<I;x++)B&&void 0===B[x]&&(B[x]=new Z.Bb(1,1,1,1)),C&&void 0===C[x]&&(C[x]=new l.Vector4(0,0,1,1));if(D)for(x=0;x<I;x++){const m=V.face[x].length;for(X=2*Math.PI/m,g=.5*Math.tan(X/2),G=.5,a=0;a<m;a++)n.push(V.vertex[V.face[x][a]][0]*O,V.vertex[V.face[x][a]][1]*q,V.vertex[V.face[x][a]][2]*Y),s.push(y),y++,v=C[x].x+(C[x].z-C[x].x)*(.5+g),T=C[x].y+(C[x].w-C[x].y)*(G-.5),H.push(v,b.d?1-T:T),e=g*Math.cos(X)-G*Math.sin(X),G=g*Math.sin(X)+G*Math.cos(X),g=e,B&&R.push(B[x].r,B[x].g,B[x].b,B[x].a);for(a=0;a<m-2;a++)L.push(s[0+o],s[a+2+o],s[a+1+o]);o+=m}else{for(a=0;a<V.vertex.length;a++)n.push(V.vertex[a][0]*O,V.vertex[a][1]*q,V.vertex[a][2]*Y),H.push(0,b.d?1:0);for(x=0;x<I;x++)for(a=0;a<V.face[x].length-2;a++)L.push(V.face[x][0],V.face[x][a+2],V.face[x][a+1])}u.c.ComputeNormals(n,L,U),u.c._ComputeSides(E,n,L,U,H,m.frontUVs,m.backUVs);const P=new u.c;return P.Tm=n,P.indices=L,P.Xm=U,P.Gm=H,B&&D&&(P.gm=R),P}function j(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return N(S).xm(l,S.updatable),l}M.c.CreateTube=(m,S,h,l,M,O,u,b,q,Y)=>J(m,{path:S,radius:h,tessellation:l,radiusFunction:M,arc:1,cap:O,updatable:b,sideOrientation:q,instance:Y},u);function K(m){const S=m.sideOrientation||u.c.DEFAULTSIDE,h=m.radius||1,M=void 0===m.flat||m.flat,O=0|(m.subdivisions||4),q=m.radiusX||h,Y=m.radiusY||h,V=m.radiusZ||h,I=(1+Math.sqrt(5))/2,Z=[-1,I,-0,1,I,0,-1,-I,0,1,-I,0,0,-1,-I,0,1,-I,0,-1,I,0,1,I,I,0,1,I,0,-1,-I,0,1,-I,0,-1],C=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],B=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],D=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],E=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],n=[],L=[],U=[],H=[];let R=0;const y=new Array(3),o=new Array(3);let s;for(s=0;s<3;s++)y[s]=l.nS.Zero(),o[s]=l.Vector2.Zero();for(let u=0;u<20;u++){for(s=0;s<3;s++){const m=C[3*u+s];y[s].Yb(Z[3*B[m]],Z[3*B[m]+1],Z[3*B[m]+2]),y[s].normalize(),o[s].Yb(.134765625*D[2*m]+.05859375+-.0390625*E[u],.2333984375*D[2*m+1]+.025390625+.01953125*E[u])}const m=(m,S,h,u)=>{const I=l.nS.Lerp(y[0],y[2],S/O),Z=l.nS.Lerp(y[1],y[2],S/O),C=O===S?y[2]:l.nS.Lerp(I,Z,m/(O-S));let B;if(C.normalize(),M){const m=l.nS.Lerp(y[0],y[2],u/O),S=l.nS.Lerp(y[1],y[2],u/O);B=l.nS.Lerp(m,S,h/(O-u))}else B=new l.nS(C.x,C.y,C.z);B.x/=q,B.y/=Y,B.z/=V,B.normalize();const D=l.Vector2.Lerp(o[0],o[2],S/O),E=l.Vector2.Lerp(o[1],o[2],S/O),s=O===S?o[2]:l.Vector2.Lerp(D,E,m/(O-S));L.push(C.x*q,C.y*Y,C.z*V),U.push(B.x,B.y,B.z),H.push(s.x,b.d?1-s.y:s.y),n.push(R),R++};for(let S=0;S<O;S++)for(let h=0;h+S<O;h++)m(h,S,h+1/3,S+1/3),m(h+1,S,h+1/3,S+1/3),m(h,S+1,h+1/3,S+1/3),h+S+1<O&&(m(h+1,S,h+2/3,S+2/3),m(h+1,S+1,h+2/3,S+2/3),m(h,S+1,h+2/3,S+2/3))}u.c._ComputeSides(S,L,n,U,H,m.frontUVs,m.backUVs);const v=new u.c;return v.indices=n,v.Tm=L,v.Xm=U,v.Gm=H,v}function c(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),l._originalBuilderSideOrientation=S.sideOrientation;return K(S).xm(l,S.updatable),l}u.c.CreatePolyhedron=N,M.c.CreatePolyhedron=(m,S,h)=>j(m,S,h);u.c.CreateIcoSphere=K,M.c.CreateIcoSphere=(m,S,h)=>c(m,S,h);var f=h(11359);const p=new l.nS(1,0,0),k=new l.nS(-1,0,0),r=new l.nS(0,1,0),z=new l.nS(0,-1,0),Q=new l.nS(0,0,1),F=new l.nS(0,0,-1);class w{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.nS.Zero(),S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.nS.Up(),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Vector2.Zero(),M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=m,this.normal=S,this.uv=h,this.vertexIdx=M,this.vertexIdxForBones=O,this.localPositionOverride=u,this.localNormalOverride=b,this.matrixIndicesOverride=q,this.matrixWeightsOverride=Y}clone(){var m,S,h,l;return new w(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(m=this.localPositionOverride)||void 0===m?void 0:m.slice(),null===(S=this.localNormalOverride)||void 0===S?void 0:S.slice(),null===(h=this.matrixIndicesOverride)||void 0===h?void 0:h.slice(),null===(l=this.matrixWeightsOverride)||void 0===l?void 0:l.slice())}}function t(m,S,h){var q,Y,V,I,Z;const C=!!S.skeleton,B=!(null===(q=S.morphTargetManager)||void 0===q||!q.numTargets),D=h.localMode||C,E=S.bb(),n=C||B?S.uq(!0,!0):S.getVerticesData(O.f.PositionKind),L=C||B?S.getNormalsData(!0,!0):S.getVerticesData(O.f.NormalKind),U=D?C?S.getVerticesData(O.f.PositionKind):n:null,H=D?C?S.getVerticesData(O.f.NormalKind):L:null,R=S.getVerticesData(O.f.UVKind),y=C?S.getVerticesData(O.f.MatricesIndicesKind):null,o=C?S.getVerticesData(O.f.MatricesWeightsKind):null,s=C?S.getVerticesData(O.f.MatricesIndicesExtraKind):null,v=C?S.getVerticesData(O.f.MatricesWeightsExtraKind):null,T=h.position||l.nS.Zero();let X=h.normal||l.nS.Up();const g=h.size||l.nS.One(),G=h.angle||0;if(!X){const m=new l.nS(0,0,1),h=S.sm().activeCamera,M=l.nS.TransformCoordinates(m,h.getWorldMatrix());X=h.globalPosition.LS(M)}const e=-Math.atan2(X.z,X.x)-Math.PI/2,a=Math.sqrt(X.x*X.x+X.z*X.z),x=Math.atan2(X.y,a),P=new u.c;P.indices=[],P.Tm=[],P.Xm=[],P.Gm=[],P.matricesIndices=C?[]:null,P.matricesWeights=C?[]:null,P.matricesIndicesExtra=s?[]:null,P.matricesWeightsExtra=v?[]:null;let d=0;const J=(m,S)=>{const M=new w;if(!E||!n||!L)return M;const O=E[m];if(M.vertexIdx=3*O,M.vertexIdxForBones=4*O,M.position=new l.nS(n[3*O],n[3*O+1],n[3*O+2]),l.nS.TransformCoordinatesToRef(M.position,S,M.position),M.normal=new l.nS(L[3*O],L[3*O+1],L[3*O+2]),l.nS.TransformNormalToRef(M.normal,S,M.normal),h.captureUVS&&R){const m=R[2*O+1];M.uv=new l.Vector2(R[2*O],b.d?1-m:m)}return M},N=[0,0,0,0],j=(m,S)=>{if(0===m.length)return m;const h=.5*Math.abs(l.nS.Dot(g,S)),M=(m,S,h,l)=>{for(let M=0;M<l;++M)if(m[h+M]===S)return h+M;return-1},O=(m,O)=>{const u=l.nS.GetClipFactor(m.position,O.position,S,h);let b=N,q=N;if(y&&o){const S=m.matrixIndicesOverride?0:m.vertexIdxForBones,h=m.matrixIndicesOverride??y,l=m.matrixWeightsOverride??o,Y=O.matrixIndicesOverride?0:O.vertexIdxForBones,V=O.matrixIndicesOverride??y,I=O.matrixWeightsOverride??o;b=[0,0,0,0],q=[0,0,0,0];let Z=0;for(let m=0;m<4;++m)if(l[S+m]>0){const O=M(V,h[S+m],Y,4);b[Z]=h[S+m],q[Z]=(0,f.Lerp)(l[S+m],O>=0?I[O]:0,u),Z++}for(let m=0;m<4&&Z<4;++m){const l=V[Y+m];-1===M(h,l,S,4)&&(b[Z]=l,q[Z]=(0,f.Lerp)(0,I[Y+m],u),Z++)}const C=q[0]+q[1]+q[2]+q[3];q[0]/=C,q[1]/=C,q[2]/=C,q[3]/=C}const Y=m.localPositionOverride?m.localPositionOverride[0]:(null===U||void 0===U?void 0:U[m.vertexIdx])??0,V=m.localPositionOverride?m.localPositionOverride[1]:(null===U||void 0===U?void 0:U[m.vertexIdx+1])??0,I=m.localPositionOverride?m.localPositionOverride[2]:(null===U||void 0===U?void 0:U[m.vertexIdx+2])??0,Z=O.localPositionOverride?O.localPositionOverride[0]:(null===U||void 0===U?void 0:U[O.vertexIdx])??0,C=O.localPositionOverride?O.localPositionOverride[1]:(null===U||void 0===U?void 0:U[O.vertexIdx+1])??0,B=O.localPositionOverride?O.localPositionOverride[2]:(null===U||void 0===U?void 0:U[O.vertexIdx+2])??0,D=m.localNormalOverride?m.localNormalOverride[0]:(null===H||void 0===H?void 0:H[m.vertexIdx])??0,E=m.localNormalOverride?m.localNormalOverride[1]:(null===H||void 0===H?void 0:H[m.vertexIdx+1])??0,n=m.localNormalOverride?m.localNormalOverride[2]:(null===H||void 0===H?void 0:H[m.vertexIdx+2])??0,L=D+((O.localNormalOverride?O.localNormalOverride[0]:(null===H||void 0===H?void 0:H[O.vertexIdx])??0)-D)*u,R=E+((O.localNormalOverride?O.localNormalOverride[1]:(null===H||void 0===H?void 0:H[O.vertexIdx+1])??0)-E)*u,s=n+((O.localNormalOverride?O.localNormalOverride[2]:(null===H||void 0===H?void 0:H[O.vertexIdx+2])??0)-n)*u,v=Math.sqrt(L*L+R*R+s*s);return new w(l.nS.Lerp(m.position,O.position,u),l.nS.Lerp(m.normal,O.normal,u).normalize(),l.Vector2.Lerp(m.uv,O.uv,u),-1,-1,U?[Y+(Z-Y)*u,V+(C-V)*u,I+(B-I)*u]:null,H?[L/v,R/v,s/v]:null,b,q)};let u=null;m.length>3&&(u=[]);for(let b=0;b<m.length;b+=3){let M=0,q=null,Y=null,V=null,I=null;const Z=l.nS.Dot(m[b].position,S)-h>0,C=l.nS.Dot(m[b+1].position,S)-h>0,B=l.nS.Dot(m[b+2].position,S)-h>0;switch(M=(Z?1:0)+(C?1:0)+(B?1:0),M){case 0:m.length>3?(u.push(m[b]),u.push(m[b+1]),u.push(m[b+2])):u=m;break;case 1:if(u=u??new Array,Z&&(q=m[b+1],Y=m[b+2],V=O(m[b],q),I=O(m[b],Y)),C){q=m[b],Y=m[b+2],V=O(m[b+1],q),I=O(m[b+1],Y),u.push(V),u.push(Y.clone()),u.push(q.clone()),u.push(Y.clone()),u.push(V.clone()),u.push(I);break}B&&(q=m[b],Y=m[b+1],V=O(m[b+2],q),I=O(m[b+2],Y)),q&&Y&&V&&I&&(u.push(q.clone()),u.push(Y.clone()),u.push(V),u.push(I),u.push(V.clone()),u.push(Y.clone()));break;case 2:u=u??new Array,Z||(q=m[b].clone(),Y=O(q,m[b+1]),V=O(q,m[b+2]),u.push(q),u.push(Y),u.push(V)),C||(q=m[b+1].clone(),Y=O(q,m[b+2]),V=O(q,m[b]),u.push(q),u.push(Y),u.push(V)),B||(q=m[b+2].clone(),Y=O(q,m[b]),V=O(q,m[b+1]),u.push(q),u.push(Y),u.push(V))}}return u},K=S instanceof M.c?S:null,c=null===K||void 0===K?void 0:K._thinInstanceDataStorage.matrixData,t=(null===K||void 0===K?void 0:K.Eb)||1,A=l.TmpVectors.Matrix[0];A.l(l.Matrix.IdentityReadOnly);for(let M=0;M<t;++M){if(null!==K&&void 0!==K&&K.hasThinInstances&&c){const m=16*M;A.setRowFromFloats(0,c[m+0],c[m+1],c[m+2],c[m+3]),A.setRowFromFloats(1,c[m+4],c[m+5],c[m+6],c[m+7]),A.setRowFromFloats(2,c[m+8],c[m+9],c[m+10],c[m+11]),A.setRowFromFloats(3,c[m+12],c[m+13],c[m+14],c[m+15])}const m=l.Matrix.RotationYawPitchRoll(e,x,G).multiply(l.Matrix.Translation(T.x,T.y,T.z)),O=l.Matrix.Invert(m),u=S.getWorldMatrix(),q=A.multiply(u).multiply(O),Y=new Array(3);for(let S=0;S<E.length;S+=3){let m=Y;if(m[0]=J(S,q),m[1]=J(S+1,q),m[2]=J(S+2,q),!(h.cullBackFaces&&-m[0].normal.z<=0&&-m[1].normal.z<=0&&-m[2].normal.z<=0)&&(m=j(m,p),m&&(m=j(m,k),m&&(m=j(m,r),m&&(m=j(m,z),m&&(m=j(m,Q),m&&(m=j(m,F),m)))))))for(let S=0;S<m.length;S++){const l=m[S];if(P.indices.push(d),D?(l.localPositionOverride?(P.Tm[3*d]=l.localPositionOverride[0],P.Tm[3*d+1]=l.localPositionOverride[1],P.Tm[3*d+2]=l.localPositionOverride[2]):U&&(P.Tm[3*d]=U[l.vertexIdx],P.Tm[3*d+1]=U[l.vertexIdx+1],P.Tm[3*d+2]=U[l.vertexIdx+2]),l.localNormalOverride?(P.Xm[3*d]=l.localNormalOverride[0],P.Xm[3*d+1]=l.localNormalOverride[1],P.Xm[3*d+2]=l.localNormalOverride[2]):H&&(P.Xm[3*d]=H[l.vertexIdx],P.Xm[3*d+1]=H[l.vertexIdx+1],P.Xm[3*d+2]=H[l.vertexIdx+2])):(l.position.toArray(P.Tm,3*d),l.normal.toArray(P.Xm,3*d)),P.matricesIndices&&P.matricesWeights&&(l.matrixIndicesOverride?(P.matricesIndices[4*d]=l.matrixIndicesOverride[0],P.matricesIndices[4*d+1]=l.matrixIndicesOverride[1],P.matricesIndices[4*d+2]=l.matrixIndicesOverride[2],P.matricesIndices[4*d+3]=l.matrixIndicesOverride[3]):(y&&(P.matricesIndices[4*d]=y[l.vertexIdxForBones],P.matricesIndices[4*d+1]=y[l.vertexIdxForBones+1],P.matricesIndices[4*d+2]=y[l.vertexIdxForBones+2],P.matricesIndices[4*d+3]=y[l.vertexIdxForBones+3]),s&&P.matricesIndicesExtra&&(P.matricesIndicesExtra[4*d]=s[l.vertexIdxForBones],P.matricesIndicesExtra[4*d+1]=s[l.vertexIdxForBones+1],P.matricesIndicesExtra[4*d+2]=s[l.vertexIdxForBones+2],P.matricesIndicesExtra[4*d+3]=s[l.vertexIdxForBones+3])),l.matrixWeightsOverride?(P.matricesWeights[4*d]=l.matrixWeightsOverride[0],P.matricesWeights[4*d+1]=l.matrixWeightsOverride[1],P.matricesWeights[4*d+2]=l.matrixWeightsOverride[2],P.matricesWeights[4*d+3]=l.matrixWeightsOverride[3]):(o&&(P.matricesWeights[4*d]=o[l.vertexIdxForBones],P.matricesWeights[4*d+1]=o[l.vertexIdxForBones+1],P.matricesWeights[4*d+2]=o[l.vertexIdxForBones+2],P.matricesWeights[4*d+3]=o[l.vertexIdxForBones+3]),v&&P.matricesWeightsExtra&&(P.matricesWeightsExtra[4*d]=v[l.vertexIdxForBones],P.matricesWeightsExtra[4*d+1]=v[l.vertexIdxForBones+1],P.matricesWeightsExtra[4*d+2]=v[l.vertexIdxForBones+2],P.matricesWeightsExtra[4*d+3]=v[l.vertexIdxForBones+3]))),h.captureUVS)l.uv.toArray(P.Gm,2*d);else{P.Gm.push(.5+l.position.x/g.x);const m=.5+l.position.y/g.y;P.Gm.push(b.d?1-m:m)}d++}}}0===P.indices.length&&(P.indices=null),0===P.Tm.length&&(P.Tm=null),0===P.Xm.length&&(P.Xm=null),0===P.Gm.length&&(P.Gm=null),0===(null===(Y=P.matricesIndices)||void 0===Y?void 0:Y.length)&&(P.matricesIndices=null),0===(null===(V=P.matricesWeights)||void 0===V?void 0:V.length)&&(P.matricesWeights=null),0===(null===(I=P.matricesIndicesExtra)||void 0===I?void 0:I.length)&&(P.matricesIndicesExtra=null),0===(null===(Z=P.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(P.matricesWeightsExtra=null);const i=new M.c(m,S.sm());return P.xm(i),D?(i.skeleton=S.skeleton,i.parent=S):(i.position=T.clone(),i.rotation=new l.nS(x,e,G)),i.Mb(!0),i.refreshBoundingInfo(!0,!0),i}function A(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const S=0|Math.max(m.subdivisions?m.subdivisions:2,1),h=0|Math.max(m.tessellation?m.tessellation:16,3),M=Math.max(m.height?m.height:1,0),O=Math.max(m.radius?m.radius:.25,0),q=0|Math.max(m.capSubdivisions?m.capSubdivisions:6,1),Y=h,V=S,I=Math.max(m.radiusTop?m.radiusTop:O,0),Z=Math.max(m.radiusBottom?m.radiusBottom:O,0),C=M-(I+Z),B=2*Math.PI,D=Math.max(m.topCapSubdivisions?m.topCapSubdivisions:q,1),E=Math.max(m.bottomCapSubdivisions?m.bottomCapSubdivisions:q,1),n=Math.acos((Z-I)/M);let L=[];const U=[],H=[],R=[];let y=0;const o=[],s=.5*C,v=.5*Math.PI;let T,X;const g=l.nS.Zero(),G=l.nS.Zero(),e=Math.cos(n),a=Math.sin(n),x=new l.Vector2(I*a,s+I*e).LS(new l.Vector2(Z*a,Z*e-s)).length(),P=I*n+x+Z*(v-n);let d=0;for(X=0;X<=D;X++){const m=[],S=v-n*(X/D);d+=I*n/D;const h=Math.cos(S),l=Math.sin(S),M=h*I;for(T=0;T<=Y;T++){const S=T/Y,O=S*B+0,u=Math.sin(O),q=Math.cos(O);G.x=M*u,G.y=s+l*I,G.z=M*q,U.push(G.x,G.y,G.z),g.set(h*u,l,h*q),H.push(g.x,g.y,g.z),R.push(S,b.d?d/P:1-d/P),m.push(y),y++}o.push(m)}const J=M-I-Z+e*I-e*Z,N=a*(Z-I)/J;for(X=1;X<=V;X++){const m=[];d+=x/V;const S=a*(X*(Z-I)/V+I);for(T=0;T<=Y;T++){const h=T/Y,l=h*B+0,M=Math.sin(l),O=Math.cos(l);G.x=S*M,G.y=s+e*I-X*J/V,G.z=S*O,U.push(G.x,G.y,G.z),g.set(M,N,O).normalize(),H.push(g.x,g.y,g.z),R.push(h,b.d?d/P:1-d/P),m.push(y),y++}o.push(m)}for(X=1;X<=E;X++){const m=[],S=v-n-(Math.PI-n)*(X/E);d+=Z*n/E;const h=Math.cos(S),l=Math.sin(S),M=h*Z;for(T=0;T<=Y;T++){const S=T/Y,O=S*B+0,u=Math.sin(O),q=Math.cos(O);G.x=M*u,G.y=l*Z-s,G.z=M*q,U.push(G.x,G.y,G.z),g.set(h*u,l,h*q),H.push(g.x,g.y,g.z),R.push(S,b.d?d/P:1-d/P),m.push(y),y++}o.push(m)}for(T=0;T<Y;T++)for(X=0;X<D+V+E;X++){const m=o[X][T],S=o[X+1][T],h=o[X+1][T+1],l=o[X][T+1];L.push(m),L.push(S),L.push(l),L.push(S),L.push(h),L.push(l)}if(L=L.reverse(),m.orientation&&!m.orientation.equals(l.nS.Up())){const S=new l.Matrix;m.orientation.clone().scale(.5*Math.PI).cross(l.nS.Up()).toQuaternion().toRotationMatrix(S);const h=l.nS.Zero();for(let m=0;m<U.length;m+=3)h.set(U[m],U[m+1],U[m+2]),l.nS.TransformCoordinatesToRef(h.clone(),S,h),U[m]=h.x,U[m+1]=h.y,U[m+2]=h.z}const j=new u.c;return j.Tm=U,j.Xm=H,j.Gm=R,j.indices=L,j}function i(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:l.nS.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new M.c(m,h);return A(S).xm(O,S.updatable),O}M.c.CreateDecal=(m,S,h,l,M,O)=>t(m,S,{position:h,normal:l,size:M,angle:O});M.c.CreateCapsule=(m,S,h)=>i(m,S,h),u.c.CreateCapsule=A;var W=h(11173),mm=h(11350);class Sm{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=m,this.y=S,m!==Math.floor(m)&&(m=Math.floor(m),W.e.Warn("x is not an integer, floor(x) used")),S!==Math.floor(S)&&(S=Math.floor(S),W.e.Warn("y is not an integer, floor(y) used"))}clone(){return new Sm(this.x,this.y)}rotate60About(m){const S=this.x;return this.x=m.x+m.y-this.y,this.y=S+this.y-m.x,this}rotateNeg60About(m){const S=this.x;return this.x=S+this.y-m.y,this.y=m.x+m.y-S,this}rotate120(m,S){m!==Math.floor(m)&&(m=Math.floor(m),W.e.Warn("m not an integer only floor(m) used")),S!==Math.floor(S)&&(S=Math.floor(S),W.e.Warn("n not an integer only floor(n) used"));const h=this.x;return this.x=m-h-this.y,this.y=S+h,this}rotateNeg120(m,S){m!==Math.floor(m)&&(m=Math.floor(m),W.e.Warn("m is not an integer, floor(m) used")),S!==Math.floor(S)&&(S=Math.floor(S),W.e.Warn("n is not an integer,   floor(n) used"));const h=this.x;return this.x=this.y-S,this.y=m+S-h-this.y,this}toCartesianOrigin(m,S){const h=l.nS.Zero();return h.x=m.x+2*this.x*S+this.y*S,h.y=m.y+Math.sqrt(3)*this.y*S,h}static Zero(){return new Sm(0,0)}}class hm{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new lm("icosahedron","Regular",[[0,mm.f,-1],[-mm.f,1,0],[-1,0,-mm.f],[1,0,-mm.f],[mm.f,1,0],[0,mm.f,1],[-1,0,mm.f],[-mm.f,-1,0],[0,-mm.f,-1],[mm.f,-1,0],[1,0,mm.f],[0,-mm.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let m=12;const S={},h=this.m,l=this.n;let M,O,u,b,q,Y=h,V=1,I=0;0!==l&&(Y=(0,f.HighestCommonFactor)(h,l)),V=h/Y,I=l/Y;const Z=Sm.Zero(),C=new Sm(h,l),B=new Sm(-l,h+l),D=Sm.Zero(),E=Sm.Zero(),n=Sm.Zero();let L,U,H,R,y=[];const o=[],s=this.vertByDist,v=(h,l,M,O)=>{L=h+"|"+M,U=l+"|"+O,L in S||U in S?L in S&&!(U in S)?S[U]=S[L]:U in S&&!(L in S)&&(S[L]=S[U]):(S[L]=m,S[U]=m,m++),s[M][0]>2?o[S[L]]=[-s[M][0],s[M][1],S[L]]:o[S[L]]=[y[s[M][0]],s[M][1],S[L]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let T=0;T<20;T++){if(y=this.IDATA.face[T],u=y[2],b=y[1],q=y[0],H=Z.x+"|"+Z.y,L=T+"|"+H,L in S||(S[L]=u,o[u]=[y[s[H][0]],s[H][1]]),H=C.x+"|"+C.y,L=T+"|"+H,L in S||(S[L]=b,o[b]=[y[s[H][0]],s[H][1]]),H=B.x+"|"+B.y,L=T+"|"+H,L in S||(S[L]=q,o[q]=[y[s[H][0]],s[H][1]]),M=this.IDATA.edgematch[T][0],O=this.IDATA.edgematch[T][1],"B"===O)for(let m=1;m<Y;m++)E.x=h-m*(V+I),E.y=l+m*V,n.x=-m*I,n.y=m*(V+I),H=E.x+"|"+E.y,R=n.x+"|"+n.y,v(T,M,H,R);if("O"===O)for(let m=1;m<Y;m++)n.x=-m*I,n.y=m*(V+I),D.x=m*V,D.y=m*I,H=n.x+"|"+n.y,R=D.x+"|"+D.y,v(T,M,H,R);if(M=this.IDATA.edgematch[T][2],O=this.IDATA.edgematch[T][3],O&&"A"===O)for(let m=1;m<Y;m++)D.x=m*V,D.y=m*I,E.x=h-(Y-m)*(V+I),E.y=l+(Y-m)*V,H=D.x+"|"+D.y,R=E.x+"|"+E.y,v(T,M,H,R);for(let h=0;h<this.vertices.length;h++)H=this.vertices[h].x+"|"+this.vertices[h].y,L=T+"|"+H,L in S||(S[L]=m++,s[H][0]>2?o[S[L]]=[-s[H][0],s[H][1],S[L]]:o[S[L]]=[y[s[H][0]],s[H][1],S[L]])}this.closestTo=o,this.vecToidx=S}calcCoeffs(){const m=this.m,S=this.n,h=Math.sqrt(3)/3,l=m*m+S*S+m*S;this.coau=(m+S)/l,this.cobu=-S/l,this.coav=-h*(m-S)/l,this.cobv=h*(2*m+S)/l}createInnerFacets(){const m=this.m,S=this.n;for(let h=0;h<S+m+1;h++)for(let m=this.min[h];m<this.max[h]+1;m++)m<this.max[h]&&m<this.max[h+1]+1&&this.innerFacets.push(["|"+m+"|"+h,"|"+m+"|"+(h+1),"|"+(m+1)+"|"+h]),h>0&&m<this.max[h-1]&&m+1<this.max[h]+1&&this.innerFacets.push(["|"+m+"|"+h,"|"+(m+1)+"|"+h,"|"+(m+1)+"|"+(h-1)])}edgeVecsABOB(){const m=this.m,S=this.n,h=new Sm(-S,m+S);for(let l=1;l<m+S;l++){const m=new Sm(this.min[l],l),S=new Sm(this.min[l-1],l-1),M=new Sm(this.min[l+1],l+1),O=m.clone(),u=S.clone(),b=M.clone();O.rotate60About(h),u.rotate60About(h),b.rotate60About(h);const q=new Sm(this.max[O.y],O.y),Y=new Sm(this.max[O.y-1],O.y-1),V=new Sm(this.max[O.y-1]-1,O.y-1);O.x===q.x&&O.y===q.y||(O.x!==Y.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([m,Y,V]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([m,V,q])):O.y===b.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([m,S,Y]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([m,Y,M])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([m,S,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([m,Y,q])))}}mapABOBtoOBOA(){const m=new Sm(0,0);for(let S=0;S<this.isoVecsABOB.length;S++){const h=[];for(let l=0;l<3;l++)m.x=this.isoVecsABOB[S][l].x,m.y=this.isoVecsABOB[S][l].y,0===this.vertexTypes[S][l]&&m.rotateNeg120(this.m,this.n),h.push(m.clone());this.isoVecsOBOA.push(h)}}mapABOBtoBAOA(){const m=new Sm(0,0);for(let S=0;S<this.isoVecsABOB.length;S++){const h=[];for(let l=0;l<3;l++)m.x=this.isoVecsABOB[S][l].x,m.y=this.isoVecsABOB[S][l].y,1===this.vertexTypes[S][l]&&m.rotate120(this.m,this.n),h.push(m.clone());this.isoVecsBAOA.push(h)}}MapToFace(m,S){const h=this.IDATA.face[m],M=h[2],O=h[1],u=h[0],b=l.nS.yS(this.IDATA.vertex[M]),q=l.nS.yS(this.IDATA.vertex[O]),Y=l.nS.yS(this.IDATA.vertex[u]),V=q.LS(b),I=Y.LS(b),Z=V.scale(this.coau).add(I.scale(this.cobu)),C=V.scale(this.coav).add(I.scale(this.cobv)),B=[];let D,E=l.TmpVectors.nS[0];for(let l=0;l<this.cartesian.length;l++)E=Z.scale(this.cartesian[l].x).add(C.scale(this.cartesian[l].y)).add(b),B[l]=[E.x,E.y,E.z],D=m+"|"+this.vertices[l].x+"|"+this.vertices[l].y,S.vertex[this.vecToidx[D]]=[E.x,E.y,E.z]}build(m,S){const h=[],l=Sm.Zero(),M=new Sm(m,S),O=new Sm(-S,m+S);h.push(l,M,O);for(let H=S;H<m+1;H++)for(let S=0;S<m+1-H;S++)h.push(new Sm(S,H));if(S>0){const l=(0,f.HighestCommonFactor)(m,S),M=m/l,O=S/l;for(let b=1;b<l;b++)h.push(new Sm(b*M,b*O)),h.push(new Sm(-b*O,b*(M+O))),h.push(new Sm(m-b*(M+O),S+b*M));const u=m/S;for(let b=1;b<S;b++)for(let l=0;l<b*u;l++)h.push(new Sm(l,b)),h.push(new Sm(l,b).rotate120(m,S)),h.push(new Sm(l,b).rotateNeg120(m,S))}h.sort(((m,S)=>m.x-S.x)),h.sort(((m,S)=>m.y-S.y));const u=new Array(m+S+1),b=new Array(m+S+1);for(let H=0;H<u.length;H++)u[H]=1/0,b[H]=-1/0;let q=0,Y=0;const V=h.length;for(let H=0;H<V;H++)Y=h[H].x,q=h[H].y,u[q]=Math.min(Y,u[q]),b[q]=Math.max(Y,b[q]);const I=(h,l)=>{const M=h.clone();return"A"===l&&M.rotateNeg120(m,S),"B"===l&&M.rotate120(m,S),M.x<0?M.y:M.x+M.y},Z=[],C=[],B=[],D=[],E={},n=[];let L=-1,U=-1;for(let H=0;H<V;H++)Z[H]=h[H].toCartesianOrigin(new Sm(0,0),.5),C[H]=I(h[H],"O"),B[H]=I(h[H],"A"),D[H]=I(h[H],"B"),C[H]===B[H]&&B[H]===D[H]?(L=3,U=C[H]):C[H]===B[H]?(L=4,U=C[H]):B[H]===D[H]?(L=5,U=B[H]):D[H]===C[H]&&(L=6,U=C[H]),C[H]<B[H]&&C[H]<D[H]&&(L=2,U=C[H]),B[H]<C[H]&&B[H]<D[H]&&(L=1,U=B[H]),D[H]<B[H]&&D[H]<C[H]&&(L=0,U=D[H]),n.push([L,U,h[H].x,h[H].y]);n.sort(((m,S)=>m[2]-S[2])),n.sort(((m,S)=>m[3]-S[3])),n.sort(((m,S)=>m[1]-S[1])),n.sort(((m,S)=>m[0]-S[0]));for(let H=0;H<n.length;H++)E[n[H][2]+"|"+n[H][3]]=[n[H][0],n[H][1],H];return this.m=m,this.n=S,this.vertices=h,this.vertByDist=E,this.cartesian=Z,this.min=u,this.max=b,this}}class lm{constructor(m,S,h,l){this.name=m,this.category=S,this.vertex=h,this.face=l}}class Mm extends lm{innerToData(m,S){for(let h=0;h<S.innerFacets.length;h++)this.face.push(S.innerFacets[h].map((h=>S.vecToidx[m+h])))}mapABOBtoDATA(m,S){const h=S.IDATA.edgematch[m][0];for(let l=0;l<S.isoVecsABOB.length;l++){const M=[];for(let O=0;O<3;O++)0===S.vertexTypes[l][O]?M.push(m+"|"+S.isoVecsABOB[l][O].x+"|"+S.isoVecsABOB[l][O].y):M.push(h+"|"+S.isoVecsABOB[l][O].x+"|"+S.isoVecsABOB[l][O].y);this.face.push([S.vecToidx[M[0]],S.vecToidx[M[1]],S.vecToidx[M[2]]])}}mapOBOAtoDATA(m,S){const h=S.IDATA.edgematch[m][0];for(let l=0;l<S.isoVecsOBOA.length;l++){const M=[];for(let O=0;O<3;O++)1===S.vertexTypes[l][O]?M.push(m+"|"+S.isoVecsOBOA[l][O].x+"|"+S.isoVecsOBOA[l][O].y):M.push(h+"|"+S.isoVecsOBOA[l][O].x+"|"+S.isoVecsOBOA[l][O].y);this.face.push([S.vecToidx[M[0]],S.vecToidx[M[1]],S.vecToidx[M[2]]])}}mapBAOAtoDATA(m,S){const h=S.IDATA.edgematch[m][2];for(let l=0;l<S.isoVecsBAOA.length;l++){const M=[];for(let O=0;O<3;O++)1===S.vertexTypes[l][O]?M.push(m+"|"+S.isoVecsBAOA[l][O].x+"|"+S.isoVecsBAOA[l][O].y):M.push(h+"|"+S.isoVecsBAOA[l][O].x+"|"+S.isoVecsBAOA[l][O].y);this.face.push([S.vecToidx[M[0]],S.vecToidx[M[1]],S.vecToidx[M[2]]])}}orderData(m){const S=[];for(let O=0;O<13;O++)S[O]=[];const h=m.closestTo;for(let O=0;O<h.length;O++)h[O][0]>-1?h[O][1]>0&&S[h[O][0]].push([O,h[O][1]]):S[12].push([O,h[O][0]]);const l=[];for(let O=0;O<12;O++)l[O]=O;let M=12;for(let O=0;O<12;O++){S[O].sort(((m,S)=>m[1]-S[1]));for(let m=0;m<S[O].length;m++)l[S[O][m][0]]=M++}for(let O=0;O<S[12].length;O++)l[S[12][O][0]]=M++;for(let O=0;O<this.vertex.length;O++)this.vertex[O].push(l[O]);this.vertex.sort(((m,S)=>m[3]-S[3]));for(let O=0;O<this.vertex.length;O++)this.vertex[O].pop();for(let O=0;O<this.face.length;O++)for(let m=0;m<this.face[O].length;m++)this.face[O][m]=l[this.face[O][m]];this.sharedNodes=S[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(m,S){const h=[],l=[];let M=S.pop();l.push(M);let O=this.face[M].indexOf(m);O=(O+2)%3;let u=this.face[M][O];h.push(u);let b=0;for(;S.length>0;)M=S[b],this.face[M].indexOf(u)>-1?(O=(this.face[M].indexOf(u)+1)%3,u=this.face[M][O],h.push(u),l.push(M),S.splice(b,1),b=0):b++;return this.adjacentFaces.push(h),l}toGoldbergPolyhedronData(){const m=new lm("GeoDual","Goldberg",[],[]);m.name="GD dual";const S=this.vertex.length,h=new Array(S);for(let q=0;q<S;q++)h[q]=[];for(let q=0;q<this.face.length;q++)for(let m=0;m<3;m++)h[this.face[q][m]].push(q);let l=0,M=0,O=0,u=[],b=[];this.adjacentFaces=[];for(let q=0;q<h.length;q++){m.face[q]=this.setOrder(q,h[q].concat([]));for(const S of h[q]){l=0,M=0,O=0,u=this.face[S];for(let m=0;m<3;m++)b=this.vertex[u[m]],l+=b[0],M+=b[1],O+=b[2];m.vertex[S]=[l/3,M/3,O/3]}}return m}static BuildGeodesicData(m){const S=new Mm("Geodesic-m-n","Geodesic",[[0,mm.f,-1],[-mm.f,1,0],[-1,0,-mm.f],[1,0,-mm.f],[mm.f,1,0],[0,mm.f,1],[-1,0,mm.f],[-mm.f,-1,0],[0,-mm.f,-1],[mm.f,-1,0],[1,0,mm.f],[0,-mm.f,1]],[]);m.setIndices(),m.calcCoeffs(),m.createInnerFacets(),m.edgeVecsABOB(),m.mapABOBtoOBOA(),m.mapABOBtoBAOA();for(let h=0;h<m.IDATA.face.length;h++)m.MapToFace(h,S),S.innerToData(h,m),"B"===m.IDATA.edgematch[h][1]&&S.mapABOBtoDATA(h,m),"O"===m.IDATA.edgematch[h][1]&&S.mapOBOAtoDATA(h,m),"A"===m.IDATA.edgematch[h][3]&&S.mapBAOAtoDATA(h,m);S.orderData(m);return S.vertex=S.vertex.map((function(m){const S=m[0],h=m[1],l=m[2],M=Math.sqrt(S*S+h*h+l*l);return m[0]*=1/M,m[1]*=1/M,m[2]*=1/M,m})),S}}M.c._GoldbergMeshParser=(m,S)=>Om.Parse(m,S);class Om extends M.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(m,S){return void 0===S?(m>this.goldbergData.nbUnsharedFaces-1&&(W.e.Warn("Maximum number of unshared faces used"),m=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+m):(m>11&&(W.e.Warn("Last pole used"),m=11),S>this.goldbergData.nbFacesAtPole-1&&(W.e.Warn("Maximum number of faces at a pole used"),S=this.goldbergData.nbFacesAtPole-1),12+m*this.goldbergData.nbFacesAtPole+S)}_changeGoldbergFaceColors(m){for(let h=0;h<m.length;h++){const S=m[h][0],l=m[h][1],M=m[h][2];for(let m=S;m<l+1;m++)this.goldbergData.faceColors[m]=M}const S=[];for(let h=0;h<12;h++)for(let m=0;m<5;m++)S.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);for(let h=12;h<this.goldbergData.faceColors.length;h++)for(let m=0;m<6;m++)S.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);return S}setGoldbergFaceColors(m){const S=this._changeGoldbergFaceColors(m);this.Nm(O.f.ColorKind,S)}updateGoldbergFaceColors(m){const S=this._changeGoldbergFaceColors(m);this.updateVerticesData(O.f.ColorKind,S)}_changeGoldbergFaceUVs(m){const S=this.getVerticesData(O.f.UVKind);for(let h=0;h<m.length;h++){const l=m[h][0],M=m[h][1],O=m[h][2],u=m[h][3],b=m[h][4],q=[],Y=[];let V,I;for(let m=0;m<5;m++)V=O.x+u*Math.cos(b+m*Math.PI/2.5),I=O.y+u*Math.sin(b+m*Math.PI/2.5),V<0&&(V=0),V>1&&(V=1),q.push(V,I);for(let m=0;m<6;m++)V=O.x+u*Math.cos(b+m*Math.PI/3),I=O.y+u*Math.sin(b+m*Math.PI/3),V<0&&(V=0),V>1&&(V=1),Y.push(V,I);for(let m=l;m<Math.min(12,M+1);m++)for(let h=0;h<5;h++)S[10*m+2*h]=q[2*h],S[10*m+2*h+1]=q[2*h+1];for(let m=Math.max(12,l);m<M+1;m++)for(let h=0;h<6;h++)S[12*m-24+2*h]=Y[2*h],S[12*m-23+2*h]=Y[2*h+1]}return S}setGoldbergFaceUVs(m){const S=this._changeGoldbergFaceUVs(m);this.Nm(O.f.UVKind,S)}updateGoldbergFaceUVs(m){const S=this._changeGoldbergFaceUVs(m);this.updateVerticesData(O.f.UVKind,S)}placeOnGoldbergFaceAt(m,S,h){const M=l.nS.RotationFromAxis(this.goldbergData.faceXaxis[S],this.goldbergData.faceYaxis[S],this.goldbergData.faceZaxis[S]);m.rotation=M,m.position=this.goldbergData.faceCenters[S].add(this.goldbergData.faceXaxis[S].scale(h.x)).add(this.goldbergData.faceYaxis[S].scale(h.y)).add(this.goldbergData.faceZaxis[S].scale(h.z))}serialize(m){super.serialize(m),m.type="GoldbergMesh";const S={};if(S.adjacentFaces=this.goldbergData.adjacentFaces,S.nbSharedFaces=this.goldbergData.nbSharedFaces,S.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,S.nbFaces=this.goldbergData.nbFaces,S.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){S.faceColors=[];for(const m of this.goldbergData.faceColors)S.faceColors.push(m.DM())}if(this.goldbergData.faceCenters){S.faceCenters=[];for(const m of this.goldbergData.faceCenters)S.faceCenters.push(m.DM())}if(this.goldbergData.faceZaxis){S.faceZaxis=[];for(const m of this.goldbergData.faceZaxis)S.faceZaxis.push(m.DM())}if(this.goldbergData.faceYaxis){S.faceYaxis=[];for(const m of this.goldbergData.faceYaxis)S.faceYaxis.push(m.DM())}if(this.goldbergData.faceXaxis){S.faceXaxis=[];for(const m of this.goldbergData.faceXaxis)S.faceXaxis.push(m.DM())}m.goldbergData=S}static Parse(m,S){const h=m.goldbergData;h.faceColors=h.faceColors.map((m=>Z.Bb.yS(m))),h.faceCenters=h.faceCenters.map((m=>l.nS.yS(m))),h.faceZaxis=h.faceZaxis.map((m=>l.nS.yS(m))),h.faceXaxis=h.faceXaxis.map((m=>l.nS.yS(m))),h.faceYaxis=h.faceYaxis.map((m=>l.nS.yS(m)));const M=new Om(m.name,S);return M.goldbergData=h,M}}var um=h(11866);const bm={CreateBox:I.e,CreateTiledBox:E,CreateSphere:n.c,CreateDisc:V.d,CreateIcoSphere:c,CreateRibbon:Y,CreateCylinder:R,CreateTorus:o,CreateTorusKnot:v,CreateLineSystem:T.e,fY:T.h,CreateDashedLines:T.b,ExtrudeShape:G,ExtrudeShapeCustom:e,CreateLathe:x,CreateTiledPlane:B,rY:P.d,CreateGround:d.g,CreateTiledGround:d.i,CreateGroundFromHeightMap:d.c,CreatePolygon:X.d,ExtrudePolygon:X.h,CreateTube:J,CreatePolyhedron:j,CreateGeodesic:function(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=S.m||1;l!==Math.floor(l)&&(l=Math.floor(l),W.e.Warn("m not an integer only floor(m) used"));let M=S.n||0;if(M!==Math.floor(M)&&(M=Math.floor(M),W.e.Warn("n not an integer only floor(n) used")),M>l){const m=M;M=l,l=m,W.e.Warn("n > m therefore m and n swapped")}const O=new hm;return O.build(l,M),j(m,{custom:Mm.BuildGeodesicData(O),size:S.size,sizeX:S.sizeX,sizeY:S.sizeY,sizeZ:S.sizeZ,faceUV:S.faceUV,faceColors:S.faceColors,flat:S.flat,updatable:S.updatable,sideOrientation:S.sideOrientation,frontUVs:S.frontUVs,backUVs:S.backUVs},h)},CreateGoldberg:function(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=S.size,q=S.sizeX||O||1,Y=S.sizeY||O||1,V=S.sizeZ||O||1;let I=S.m||1;I!==Math.floor(I)&&(I=Math.floor(I),W.e.Warn("m not an integer only floor(m) used"));let C=S.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),W.e.Warn("n not an integer only floor(n) used")),C>I){const m=C;C=I,I=m,W.e.Warn("n > m therefore m and n swapped")}const B=new hm;B.build(I,C);const D=Mm.BuildGeodesicData(B),E=D.toGoldbergPolyhedronData(),n=new Om(m,h);S.sideOrientation=M.c._GetDefaultSideOrientation(S.sideOrientation),n._originalBuilderSideOrientation=S.sideOrientation;(function(m,S){const h=m.size,M=m.sizeX||h||1,O=m.sizeY||h||1,q=m.sizeZ||h||1,Y=0===m.sideOrientation?0:m.sideOrientation||u.c.DEFAULTSIDE,V=[],I=[],Z=[],C=[];let B=1/0,D=-1/0,E=1/0,n=-1/0;for(let l=0;l<S.vertex.length;l++)B=Math.min(B,S.vertex[l][0]*M),D=Math.max(D,S.vertex[l][0]*M),E=Math.min(E,S.vertex[l][1]*O),n=Math.max(n,S.vertex[l][1]*O);let L=0;for(let u=0;u<S.face.length;u++){const m=S.face[u],h=l.nS.yS(S.vertex[m[0]]),Y=l.nS.yS(S.vertex[m[2]]),U=l.nS.yS(S.vertex[m[1]]),H=Y.LS(h),R=U.LS(h),y=l.nS.Cross(R,H).normalize();for(let l=0;l<m.length;l++){Z.push(y.x,y.y,y.z);const h=S.vertex[m[l]];V.push(h[0]*M,h[1]*O,h[2]*q);const u=(h[1]*O-E)/(n-E);C.push((h[0]*M-B)/(D-B),b.d?1-u:u)}for(let S=0;S<m.length-2;S++)I.push(L,L+S+2,L+S+1);L+=m.length}u.c._ComputeSides(Y,V,I,Z,C);const U=new u.c;return U.Tm=V,U.indices=I,U.Xm=Z,U.Gm=C,U})(S,E).xm(n,S.updatable),n.goldbergData.nbSharedFaces=D.sharedNodes,n.goldbergData.nbUnsharedFaces=D.poleNodes,n.goldbergData.adjacentFaces=D.adjacentFaces,n.goldbergData.nbFaces=n.goldbergData.nbSharedFaces+n.goldbergData.nbUnsharedFaces,n.goldbergData.nbFacesAtPole=(n.goldbergData.nbUnsharedFaces-12)/12;for(let M=0;M<D.vertex.length;M++)n.goldbergData.faceCenters.push(l.nS.yS(D.vertex[M])),n.goldbergData.faceCenters[M].x*=q,n.goldbergData.faceCenters[M].y*=Y,n.goldbergData.faceCenters[M].z*=V,n.goldbergData.faceColors.push(new Z.Bb(1,1,1,1));for(let M=0;M<E.face.length;M++){const m=E.face[M],S=l.nS.yS(E.vertex[m[0]]),h=l.nS.yS(E.vertex[m[2]]),O=l.nS.yS(E.vertex[m[1]]),u=h.LS(S),b=O.LS(S),q=l.nS.Cross(b,u).normalize(),Y=l.nS.Cross(b,q).normalize();n.goldbergData.faceXaxis.push(b.normalize()),n.goldbergData.faceYaxis.push(q),n.goldbergData.faceZaxis.push(Y)}return n},CreateDecal:t,CreateCapsule:i,CreateText:um.c}},12641:(m,S,h)=>{"use strict";h.d(S,{e:()=>bS});var l=h(11347),M=h(11682);class O extends M.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var u=h(11387),b=(h(11500),h(11293));class q{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(m){this._targetStopDuration!==m&&(this._targetStopDuration=m)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(m){this._noiseTexture!==m&&(this._noiseTexture=m,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(m){this._animationSheetEnabled!==m&&(this._animationSheetEnabled=m)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(m){this._isAnimationSheetEnabled!=m&&(this._isAnimationSheetEnabled=m,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(m){this._useLogarithmicDepth=m&&this.sm().getEngine().getCaps().fragmentDepthSupported}sm(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(m){switch(m){case q.BLENDMODE_MULTIPLYADD:return;case q.BLENDMODE_ADD:m=1;break;case q.BLENDMODE_ONEONE:m=6;break;case q.BLENDMODE_STANDARD:m=2;break;case q.BLENDMODE_MULTIPLY:m=4;break;case q.BLENDMODE_SUBTRACT:m=3}this._engine.setAlphaMode(m)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:l.nS.Zero()}set direction1(m){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=m)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:l.nS.Zero()}set direction2(m){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=m)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:l.nS.Zero()}set minEmitBox(m){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=m)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:l.nS.Zero()}set maxEmitBox(m){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=m)}get billboardMode(){return this._billboardMode}set billboardMode(m){this._billboardMode!==m&&(this._billboardMode=m,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(m){this._isBillboardBased!==m&&(this._isBillboardBased=m,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(m){this._attachImageProcessingConfiguration(m)}_attachImageProcessingConfiguration(m){m!==this._imageProcessingConfiguration&&(!m&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=m)}_reset(){}_removeGradientAndTexture(m,S,h){if(!S)return this;let l=0;for(const M of S){if(M.gradient===m){S.splice(l,1);break}l++}return h&&h.dispose(),this}constructor(m){this.animations=[],this.renderingGroupId=0,this.uS=l.nS.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new l.nS(10,10,10),this.onAnimationEnd=null,this.blendMode=q.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new l.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.jY=new l.nS(0,0,0),this._useLogarithmicDepth=!1,this.gravity=l.nS.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new u.Bb(1,1,1,1),this.color2=new u.Bb(1,1,1,1),this.colorDead=new u.Bb(0,0,0,1),this.textureMask=new u.Bb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new O,this.id=m,this.name=m}createPointEmitter(m,S){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new l.nS(0,1,0),arguments.length>2&&void 0!==arguments[2]||new l.nS(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new l.nS(0,1,0),arguments.length>4&&void 0!==arguments[4]||new l.nS(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new l.nS(0,1,0),arguments.length>3&&void 0!==arguments[3]||new l.nS(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(m,S,h,l){throw new Error("Method not implemented.")}}q.BLENDMODE_ONEONE=0,q.BLENDMODE_STANDARD=1,q.BLENDMODE_ADD=2,q.BLENDMODE_MULTIPLY=3,q.BLENDMODE_MULTIPLYADD=4,q.BLENDMODE_SUBTRACT=-1,(0,b.e)("BABYLON.BaseParticleSystem",q);var Y=h(11359),V=h(11179);class I{constructor(){this.direction1=new l.nS(0,1,0),this.direction2=new l.nS(0,1,0),this.minEmitBox=new l.nS(-.5,-.5,-.5),this.maxEmitBox=new l.nS(.5,.5,.5)}startDirectionFunction(m,S,h,M){const O=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),b=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);if(M)return S.x=O,S.y=u,void(S.z=b);l.nS.TransformNormalFromFloatsToRef(O,u,b,m,S)}startPositionFunction(m,S,h,M){const O=(0,Y.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),u=(0,Y.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),b=(0,Y.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(M)return S.x=O,S.y=u,void(S.z=b);l.nS.TransformCoordinatesFromFloatsToRef(O,u,b,m,S)}clone(){const m=new I;return V.e.DeepCopy(this,m),m}applyToShader(m){m.setVector3("direction1",this.direction1),m.setVector3("direction2",this.direction2),m.setVector3("minEmitBox",this.minEmitBox),m.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(m){m.addUniform("direction1",3),m.addUniform("direction2",3),m.addUniform("minEmitBox",3),m.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.direction1=this.direction1.DM(),m.direction2=this.direction2.DM(),m.minEmitBox=this.minEmitBox.DM(),m.maxEmitBox=this.maxEmitBox.DM(),m}parse(m){l.nS.FromArrayToRef(m.direction1,0,this.direction1),l.nS.FromArrayToRef(m.direction2,0,this.direction2),l.nS.FromArrayToRef(m.minEmitBox,0,this.minEmitBox),l.nS.FromArrayToRef(m.maxEmitBox,0,this.maxEmitBox)}}class Z{get radius(){return this._radius}set radius(m){this._radius=m,this._buildHeight()}get angle(){return this._angle}set angle(m){this._angle=m,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=h,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=S,this.radius=m}startDirectionFunction(m,S,h,M){M?l.TmpVectors.nS[0].l(h.Eq).normalize():h.position.subtractToRef(m.getTranslation(),l.TmpVectors.nS[0]).normalize();const O=(0,Y.RandomRange)(0,this.directionRandomizer),u=(0,Y.RandomRange)(0,this.directionRandomizer),b=(0,Y.RandomRange)(0,this.directionRandomizer);S.x=l.TmpVectors.nS[0].x+O,S.y=l.TmpVectors.nS[0].y+u,S.z=l.TmpVectors.nS[0].z+b,S.normalize()}startPositionFunction(m,S,h,M){const O=(0,Y.RandomRange)(0,2*Math.PI);let u;this.emitFromSpawnPointOnly?u=1e-4:(u=(0,Y.RandomRange)(0,this.heightRange),u=1-u*u);let b=this._radius-(0,Y.RandomRange)(0,this._radius*this.radiusRange);b*=u;const q=b*Math.sin(O),V=b*Math.cos(O),I=u*this._height;if(M)return S.x=q,S.y=I,void(S.z=V);l.nS.TransformCoordinatesFromFloatsToRef(q,I,V,m,S)}clone(){const m=new Z(this._radius,this._angle,this.directionRandomizer);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat2("radius",this._radius,this.radiusRange),m.setFloat("coneAngle",this._angle),m.setFloat2("height",this._height,this.heightRange),m.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(m){m.addUniform("radius",2),m.addUniform("coneAngle",1),m.addUniform("height",2),m.addUniform("directionRandomizer",1)}getEffectDefines(){let m="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(m+="\n#define CONEEMITTERSPAWNPOINT"),m}getClassName(){return"ConeParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.radius=this._radius,m.angle=this._angle,m.directionRandomizer=this.directionRandomizer,m.radiusRange=this.radiusRange,m.heightRange=this.heightRange,m.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,m}parse(m){this.radius=m.radius,this.angle=m.angle,this.directionRandomizer=m.directionRandomizer,this.radiusRange=void 0!==m.radiusRange?m.radiusRange:1,this.heightRange=void 0!==m.radiusRange?m.heightRange:1,this.emitFromSpawnPointOnly=void 0!==m.emitFromSpawnPointOnly&&m.emitFromSpawnPointOnly}}class C extends Z{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0),M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0);super(m,S),this.direction1=h,this.direction2=M}startDirectionFunction(m,S){const h=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),M=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),O=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);l.nS.TransformNormalFromFloatsToRef(h,M,O,m,S)}clone(){const m=new C(this.radius,this.angle,this.direction1,this.direction2);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat("radius",this.radius),m.setFloat("radiusRange",this.radiusRange),m.setVector3("direction1",this.direction1),m.setVector3("direction2",this.direction2)}buildUniformLayout(m){m.addUniform("radius",1),m.addUniform("radiusRange",1),m.addUniform("direction1",3),m.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const m=super.serialize();return m.direction1=this.direction1.DM(),m.direction2=this.direction2.DM(),m}parse(m){super.parse(m),this.direction1.l(m.direction1),this.direction2.l(m.direction2)}}class B{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=m,this.height=S,this.radiusRange=h,this.directionRandomizer=M,this._tempVector=l.nS.Zero()}startDirectionFunction(m,S,h,M,O){h.position.subtractToRef(m.getTranslation(),this._tempVector),this._tempVector.normalize(),l.nS.TransformNormalToRef(this._tempVector,O,this._tempVector);const u=(0,Y.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let b=Math.atan2(this._tempVector.x,this._tempVector.z);b+=(0,Y.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=u,this._tempVector.x=Math.sin(b),this._tempVector.z=Math.cos(b),this._tempVector.normalize(),M?S.l(this._tempVector):l.nS.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,m,S)}startPositionFunction(m,S,h,M){const O=(0,Y.RandomRange)(-this.height/2,this.height/2),u=(0,Y.RandomRange)(0,2*Math.PI),b=(0,Y.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),q=Math.sqrt(b)*this.radius,V=q*Math.cos(u),I=q*Math.sin(u);M?S.Yb(V,O,I):l.nS.TransformCoordinatesFromFloatsToRef(V,O,I,m,S)}clone(){const m=new B(this.radius,this.directionRandomizer);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat("radius",this.radius),m.setFloat("height",this.height),m.setFloat("radiusRange",this.radiusRange),m.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(m){m.addUniform("radius",1),m.addUniform("height",1),m.addUniform("radiusRange",1),m.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.radius=this.radius,m.height=this.height,m.radiusRange=this.radiusRange,m.directionRandomizer=this.directionRandomizer,m}parse(m){this.radius=m.radius,this.height=m.height,this.radiusRange=m.radiusRange,this.directionRandomizer=m.directionRandomizer}}class D extends B{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.nS(0,1,0);super(m,S,h),this.direction1=M,this.direction2=O}startDirectionFunction(m,S,h,M){const O=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),b=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);M?S.Yb(O,u,b):l.nS.TransformNormalFromFloatsToRef(O,u,b,m,S)}clone(){const m=new D(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat("radius",this.radius),m.setFloat("height",this.height),m.setFloat("radiusRange",this.radiusRange),m.setVector3("direction1",this.direction1),m.setVector3("direction2",this.direction2)}buildUniformLayout(m){m.addUniform("radius",1),m.addUniform("height",1),m.addUniform("radiusRange",1),m.addUniform("direction1",3),m.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const m=super.serialize();return m.direction1=this.direction1.DM(),m.direction2=this.direction2.DM(),m}parse(m){super.parse(m),l.nS.FromArrayToRef(m.direction1,0,this.direction1),l.nS.FromArrayToRef(m.direction2,0,this.direction2)}}class E{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=m,this.radiusRange=S,this.directionRandomizer=h}startDirectionFunction(m,S,h,M){const O=h.position.LS(m.getTranslation()).normalize(),u=(0,Y.RandomRange)(0,this.directionRandomizer),b=(0,Y.RandomRange)(0,this.directionRandomizer),q=(0,Y.RandomRange)(0,this.directionRandomizer);O.x+=u,O.y+=b,O.z+=q,O.normalize(),M?S.l(O):l.nS.TransformNormalFromFloatsToRef(O.x,O.y,O.z,m,S)}startPositionFunction(m,S,h,M){const O=this.radius-(0,Y.RandomRange)(0,this.radius*this.radiusRange),u=(0,Y.RandomRange)(0,1),b=(0,Y.RandomRange)(0,2*Math.PI),q=Math.acos(2*u-1),V=O*Math.cos(b)*Math.sin(q),I=O*Math.cos(q),Z=O*Math.sin(b)*Math.sin(q);M?S.Yb(V,Math.abs(I),Z):l.nS.TransformCoordinatesFromFloatsToRef(V,Math.abs(I),Z,m,S)}clone(){const m=new E(this.radius,this.directionRandomizer);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat("radius",this.radius),m.setFloat("radiusRange",this.radiusRange),m.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(m){m.addUniform("radius",1),m.addUniform("radiusRange",1),m.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.radius=this.radius,m.radiusRange=this.radiusRange,m.directionRandomizer=this.directionRandomizer,m}parse(m){this.radius=m.radius,this.radiusRange=m.radiusRange,this.directionRandomizer=m.directionRandomizer}}class n{constructor(){this.direction1=new l.nS(0,1,0),this.direction2=new l.nS(0,1,0)}startDirectionFunction(m,S,h,M){const O=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),b=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);M?S.Yb(O,u,b):l.nS.TransformNormalFromFloatsToRef(O,u,b,m,S)}startPositionFunction(m,S,h,M){M?S.Yb(0,0,0):l.nS.TransformCoordinatesFromFloatsToRef(0,0,0,m,S)}clone(){const m=new n;return V.e.DeepCopy(this,m),m}applyToShader(m){m.setVector3("direction1",this.direction1),m.setVector3("direction2",this.direction2)}buildUniformLayout(m){m.addUniform("direction1",3),m.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.direction1=this.direction1.DM(),m.direction2=this.direction2.DM(),m}parse(m){l.nS.FromArrayToRef(m.direction1,0,this.direction1),l.nS.FromArrayToRef(m.direction2,0,this.direction2)}}class L{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=m,this.radiusRange=S,this.directionRandomizer=h}startDirectionFunction(m,S,h,M){const O=h.position.LS(m.getTranslation()).normalize(),u=(0,Y.RandomRange)(0,this.directionRandomizer),b=(0,Y.RandomRange)(0,this.directionRandomizer),q=(0,Y.RandomRange)(0,this.directionRandomizer);O.x+=u,O.y+=b,O.z+=q,O.normalize(),M?S.l(O):l.nS.TransformNormalFromFloatsToRef(O.x,O.y,O.z,m,S)}startPositionFunction(m,S,h,M){const O=this.radius-(0,Y.RandomRange)(0,this.radius*this.radiusRange),u=(0,Y.RandomRange)(0,1),b=(0,Y.RandomRange)(0,2*Math.PI),q=Math.acos(2*u-1),V=O*Math.cos(b)*Math.sin(q),I=O*Math.cos(q),Z=O*Math.sin(b)*Math.sin(q);M?S.Yb(V,I,Z):l.nS.TransformCoordinatesFromFloatsToRef(V,I,Z,m,S)}clone(){const m=new L(this.radius,this.directionRandomizer);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat("radius",this.radius),m.setFloat("radiusRange",this.radiusRange),m.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(m){m.addUniform("radius",1),m.addUniform("radiusRange",1),m.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.radius=this.radius,m.radiusRange=this.radiusRange,m.directionRandomizer=this.directionRandomizer,m}parse(m){this.radius=m.radius,this.radiusRange=m.radiusRange,this.directionRandomizer=m.directionRandomizer}}class U extends L{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.nS(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0);super(m),this.direction1=S,this.direction2=h}startDirectionFunction(m,S){const h=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),M=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),O=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);l.nS.TransformNormalFromFloatsToRef(h,M,O,m,S)}clone(){const m=new U(this.radius,this.direction1,this.direction2);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setFloat("radius",this.radius),m.setFloat("radiusRange",this.radiusRange),m.setVector3("direction1",this.direction1),m.setVector3("direction2",this.direction2)}buildUniformLayout(m){m.addUniform("radius",1),m.addUniform("radiusRange",1),m.addUniform("direction1",3),m.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const m=super.serialize();return m.direction1=this.direction1.DM(),m.direction2=this.direction2.DM(),m}parse(m){super.parse(m),this.direction1.l(m.direction1),this.direction2.l(m.direction2)}}class H{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(m,S,h,M){const O=l.TmpVectors.nS[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,h,O);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,h,O);const m=l.TmpVectors.nS[1];O.subtractToRef(h.position,m),m.scaleToRef(1/h.lifeTime,O)}else O.set(0,0,0);M?S.l(O):l.nS.TransformNormalToRef(O,m,S)}startPositionFunction(m,S,h,M){const O=l.TmpVectors.nS[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,h,O):O.set(0,0,0),M?S.l(O):l.nS.TransformCoordinatesToRef(O,m,S)}clone(){const m=new H;return V.e.DeepCopy(this,m),m}applyToShader(m){}buildUniformLayout(m){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const m={};return m.type=this.getClassName(),m.particlePositionGenerator=this.particlePositionGenerator,m.particleDestinationGenerator=this.particleDestinationGenerator,m}parse(m){m.particlePositionGenerator&&(this.particlePositionGenerator=m.particlePositionGenerator),m.particleDestinationGenerator&&(this.particleDestinationGenerator=m.particleDestinationGenerator)}}var R=h(11410);class y{get mesh(){return this._mesh}set mesh(m){this._mesh!==m&&(this._mesh=m,m?(this._indices=m.bb(),this._positions=m.getVerticesData(R.f.PositionKind),this._normals=m.getVerticesData(R.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=l.nS.Zero(),this._mesh=null,this.direction1=new l.nS(0,1,0),this.direction2=new l.nS(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=m}startDirectionFunction(m,S,h,M){if(this.useMeshNormalsForDirection&&this._normals)return void l.nS.TransformNormalToRef(this._storedNormal,m,S);const O=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),b=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);M?S.Yb(O,u,b):l.nS.TransformNormalFromFloatsToRef(O,u,b,m,S)}startPositionFunction(m,S,h,M){if(!this._indices||!this._positions)return;const O=3*(Math.random()*(this._indices.length/3)|0),u=Math.random(),b=Math.random()*(1-u),q=1-u-b,Y=this._indices[O],V=this._indices[O+1],I=this._indices[O+2],Z=l.TmpVectors.nS[0],C=l.TmpVectors.nS[1],B=l.TmpVectors.nS[2],D=l.TmpVectors.nS[3];l.nS.FromArrayToRef(this._positions,3*Y,Z),l.nS.FromArrayToRef(this._positions,3*V,C),l.nS.FromArrayToRef(this._positions,3*I,B),D.x=u*Z.x+b*C.x+q*B.x,D.y=u*Z.y+b*C.y+q*B.y,D.z=u*Z.z+b*C.z+q*B.z,M?S.Yb(D.x,D.y,D.z):l.nS.TransformCoordinatesFromFloatsToRef(D.x,D.y,D.z,m,S),this.useMeshNormalsForDirection&&this._normals&&(l.nS.FromArrayToRef(this._normals,3*Y,Z),l.nS.FromArrayToRef(this._normals,3*V,C),l.nS.FromArrayToRef(this._normals,3*I,B),this._storedNormal.x=u*Z.x+b*C.x+q*B.x,this._storedNormal.y=u*Z.y+b*C.y+q*B.y,this._storedNormal.z=u*Z.z+b*C.z+q*B.z)}clone(){const m=new y(this.mesh);return V.e.DeepCopy(this,m),m}applyToShader(m){m.setVector3("direction1",this.direction1),m.setVector3("direction2",this.direction2)}buildUniformLayout(m){m.addUniform("direction1",3),m.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var m;const S={};return S.type=this.getClassName(),S.direction1=this.direction1.DM(),S.direction2=this.direction2.DM(),S.meshId=null===(m=this.mesh)||void 0===m?void 0:m.id,S.useMeshNormalsForDirection=this.useMeshNormalsForDirection,S}parse(m,S){l.nS.FromArrayToRef(m.direction1,0,this.direction1),l.nS.FromArrayToRef(m.direction2,0,this.direction2),m.meshId&&S&&(this.mesh=S.getLastMeshById(m.meshId)),this.useMeshNormalsForDirection=m.useMeshNormalsForDirection}}class o{_isUbo(m){return void 0!==m.addUniform}constructor(m){this._isUbo(m)?(this.setMatrix3x3=m.updateMatrix3x3.bind(m),this.setMatrix2x2=m.updateMatrix2x2.bind(m),this.setFloat=m.updateFloat.bind(m),this.setFloat2=m.updateFloat2.bind(m),this.setFloat3=m.updateFloat3.bind(m),this.setFloat4=m.updateFloat4.bind(m),this.setFloatArray=m.updateFloatArray.bind(m),this.setArray=m.updateArray.bind(m),this.setIntArray=m.updateIntArray.bind(m),this.setMatrix=m.lb.bind(m),this.setMatrices=m.updateMatrices.bind(m),this.setVector3=m.updateVector3.bind(m),this.setVector4=m.updateVector4.bind(m),this.setColor3=m.updateColor3.bind(m),this.setColor4=m.updateColor4.bind(m),this.setDirectColor4=m.updateDirectColor4.bind(m),this.setInt=m.updateInt.bind(m),this.setInt2=m.updateInt2.bind(m),this.setInt3=m.updateInt3.bind(m),this.setInt4=m.updateInt4.bind(m)):(this.setMatrix3x3=m.setMatrix3x3.bind(m),this.setMatrix2x2=m.setMatrix2x2.bind(m),this.setFloat=m.setFloat.bind(m),this.setFloat2=m.setFloat2.bind(m),this.setFloat3=m.setFloat3.bind(m),this.setFloat4=m.setFloat4.bind(m),this.setFloatArray=m.setFloatArray.bind(m),this.setArray=m.setArray.bind(m),this.setIntArray=m.setIntArray.bind(m),this.setMatrix=m.setMatrix.bind(m),this.setMatrices=m.setMatrices.bind(m),this.setVector3=m.setVector3.bind(m),this.setVector4=m.setVector4.bind(m),this.setColor3=m.setColor3.bind(m),this.setColor4=m.setColor4.bind(m),this.setDirectColor4=m.setDirectColor4.bind(m),this.setInt=m.setInt.bind(m),this.setInt2=m.setInt2.bind(m),this.setInt3=m.setInt3.bind(m),this.setInt4=m.setInt4.bind(m))}}var s=h(11242);const v="gpuUpdateParticlesPixelShader",T="#version 300 es\nvoid main() {discard;}\n";s.b.ShadersStore[v]||(s.b.ShadersStore[v]=T);const X="gpuUpdateParticlesVertexShader",g="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";s.b.ShadersStore[X]||(s.b.ShadersStore[X]=g);(0,b.e)("BABYLON.WebGL2ParticleSystem",class{constructor(m,S){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=m,this._engine=S,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var m;return(null===(m=this._updateEffect)||void 0===m?void 0:m.isReady())??!1}createUpdateBuffer(m){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof H&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=m,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new o(this._updateEffect)}createVertexBuffers(m,S){this._updateVAO.push(this._createUpdateVAO(m)),this._renderVAO.push(this._engine.recordVertexArrayObject(S,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=S}createParticleBuffer(m){return m}bindDrawBuffers(m,S,h){h?this._engine.bindBuffers(this._renderVertexBuffers,h,S):this._engine.bindVertexArrayObject(this._renderVAO[m],null)}preUpdateParticleBuffer(){const m=this._engine;if(this._engine.enableEffect(this._updateEffect),!m.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(m,S,h){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[m],null);const l=this._engine;l.bindTransformFeedbackBuffer(S.getBuffer()),l.setRasterizerState(!1),l.beginTransformFeedback(!0),l.drawArraysType(3,0,h),l.endTransformFeedback(),l.setRasterizerState(!0),l.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let m=0;m<this._updateVAO.length;m++)this._engine.releaseVertexArrayObject(this._updateVAO[m]);this._updateVAO.length=0;for(let m=0;m<this._renderVAO.length;m++)this._engine.releaseVertexArrayObject(this._renderVAO[m]);this._renderVAO.length=0}_createUpdateVAO(m){const S={};S.position=m.createVertexBuffer("position",0,3);let h=3;S.age=m.createVertexBuffer("age",h,1),h+=1,S.size=m.createVertexBuffer("size",h,3),h+=3,S.life=m.createVertexBuffer("life",h,1),h+=1,S.seed=m.createVertexBuffer("seed",h,4),h+=4,S.direction=m.createVertexBuffer("direction",h,3),h+=3,this._parent.particleEmitterType instanceof H&&(S.initialPosition=m.createVertexBuffer("initialPosition",h,3),h+=3),this._parent._colorGradientsTexture||(S.color=m.createVertexBuffer("color",h,4),h+=4),this._parent._isBillboardBased||(S.initialDirection=m.createVertexBuffer("initialDirection",h,3),h+=3),this._parent.noiseTexture&&(S.noiseCoordinates1=m.createVertexBuffer("noiseCoordinates1",h,3),h+=3,S.noiseCoordinates2=m.createVertexBuffer("noiseCoordinates2",h,3),h+=3),this._parent._angularSpeedGradientsTexture?(S.angle=m.createVertexBuffer("angle",h,1),h+=1):(S.angle=m.createVertexBuffer("angle",h,2),h+=2),this._parent._isAnimationSheetEnabled&&(S.cellIndex=m.createVertexBuffer("cellIndex",h,1),h+=1,this._parent.spriteRandomStartCell&&(S.cellStartOffset=m.createVertexBuffer("cellStartOffset",h,1),h+=1));const l=this._engine.recordVertexArrayObject(S,null,this._updateEffect);return this._engine.bindArrayBuffer(null),l}});class G{constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,l=arguments.length>3?arguments[3]:void 0;this._engine=m,this._label=l,this._engine._storageBuffers.push(this),this._create(S,h)}_create(m,S){this._bufferSize=m,this._creationFlags=S,this._buffer=this._engine.createStorageBuffer(m,S,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(m,S,h){this._buffer&&this._engine.updateStorageBuffer(this._buffer,m,S,h)}async read(m,S,h,l){return await this._engine.readFromStorageBuffer(this._buffer,m,S,h,l)}dispose(){const m=this._engine._storageBuffers,S=m.indexOf(this);-1!==S&&(m[S]=m[m.length-1],m.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var e=h(11327),a=h(11336),x=h(11377),P=h(11321),d=h(11606),J=h(11173),N=h(11270),j=h(11547);class K{constructor(){this._gpuTimeInFrameId=-1,this.counter=new j.e}_addDuration(m,S){m<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==m?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(S,!1),this._gpuTimeInFrameId=m):this.counter.addCount(S,!1))}}var c=h(11226);class f{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=m,this._engine=S,this.uniqueId=d.e.UniqueId,S.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new K),this._engine.getCaps().supportComputeShaders?l.bindingsMapping?(this._context=S.createComputeContext(),this._shaderPath=h,this._options={bindingsMapping:{},defines:[],...l}):J.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):J.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(m,S){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=this._bindings[m];this._bindings[m]={type:h?0:4,object:S,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!l||l.object!==S||l.type!==this._bindings[m].type)}setStorageTexture(m,S){const h=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==S),this._bindings[m]={type:1,object:S,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setExternalTexture(m,S){const h=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==S),this._bindings[m]={type:6,object:S,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setVideoTexture(m,S){return!!S.externalTexture&&(this.setExternalTexture(m,S.externalTexture),!0)}setUniformBuffer(m,S){const h=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==S),this._bindings[m]={type:f._BufferIsDataBuffer(S)?7:2,object:S,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setStorageBuffer(m,S){const h=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==S),this._bindings[m]={type:f._BufferIsDataBuffer(S)?7:3,object:S,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setTextureSampler(m,S){const h=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!h||!S.compareSampler(h.object)),this._bindings[m]={type:5,object:S,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}isReady(){let m=this._effect;for(const M in this._bindings){const m=this._bindings[M],S=m.type,h=m.object;switch(S){case 0:case 4:case 1:if(!h.isReady())return!1;break;case 6:if(!h.isReady())return!1;break}}const S=[],h=this._shaderPath;if(this._options.defines)for(let M=0;M<this._options.defines.length;M++)S.push(this._options.defines[M]);const l=S.join("\n");return this._cachedDefines!==l&&(this._cachedDefines=l,m=this._engine.createComputeEffect(h,{defines:l,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=m),!!m.isReady()}dispatch(m,S,h){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,m,S,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const h=f._BufferIsDataBuffer(m)?m:m.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,h,S,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const S in this._bindings){const h=this._bindings[S];if(!this._options.bindingsMapping[S])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+S+"'");switch(h.type){case 0:{const l=this._samplers[S],M=h.object;var m;if(!l||!M._texture||!l.compareSampler(M._texture))this._samplers[S]=(new N.b).setParameters(M.wrapU,M.wrapV,M.wrapR,M.anisotropicFilteringLevel,M._texture.samplingMode,null===(m=M._texture)||void 0===m?void 0:m._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const m=h.object;m.getBuffer()!==h.buffer&&(h.buffer=m.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((M=>{(0,c.e)((()=>this.dispatch(m,S,h)),M,void 0,l)}))}serialize(){const m=x.e.Serialize(this);m.options=this._options,m.shaderPath=this._shaderPath,m.TZ={},m.textures={};for(const S in this._bindings){const h=this._bindings[S],l=h.object;switch(h.type){case 0:case 4:case 1:{const M=l.serialize();M&&(m.textures[S]=M,m.TZ[S]={type:h.type});break}}}return m}static Parse(m,S,h){const l=x.e.Parse((()=>new f(m.name,S.getEngine(),m.shaderPath,m.options)),m,S,h);for(const M in m.textures){const O=m.TZ[M],u=P.e.Parse(m.textures[M],S,h);0===O.type?l.setTexture(M,u):4===O.type?l.setTexture(M,u,!1):l.setStorageTexture(M,u)}return l}static _BufferIsDataBuffer(m){return void 0!==m.underlyingResource}}(0,e.d)([(0,a.F)()],f.prototype,"name",void 0),(0,e.d)([(0,a.F)()],f.prototype,"fastMode",void 0),(0,b.e)("BABYLON.ComputeShader",f);var p=h(11581);const k="gpuUpdateParticlesComputeShader",r="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";s.b.ShadersStoreWGSL[k]||(s.b.ShadersStoreWGSL[k]=r);(0,b.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(m,S){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=m,this._engine=S}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var m;return(null===(m=this._updateComputeShader)||void 0===m?void 0:m.isReady())??!1}createUpdateBuffer(m){var S;const h={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(h.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(h.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(h.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(h.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(h.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(h.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(h.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new f("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:h,defines:m.split("\n")}),null===(S=this._simParamsComputeShader)||void 0===S||S.dispose(),this._simParamsComputeShader=new p.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new o(this._simParamsComputeShader)}createVertexBuffers(m,S){this._renderVertexBuffers.push(S)}createParticleBuffer(m){const S=new G(this._engine,4*m.length,11,"ComputeShaderParticleSystemBuffer");return S.update(m),this._bufferComputeShader.push(S),S.getBuffer()}bindDrawBuffers(m,S,h){this._engine.bindBuffers(this._renderVertexBuffers[m],h,S)}preUpdateParticleBuffer(){}updateParticleBuffer(m,S,h){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[m]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^m]),this._updateComputeShader.dispatch(Math.ceil(h/64))}releaseBuffers(){var m;for(let S=0;S<this._bufferComputeShader.length;++S)this._bufferComputeShader[S].dispose();this._bufferComputeShader.length=0,null===(m=this._simParamsComputeShader)||void 0===m||m.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(m,S,h){this.gradient=m,this.color1=S,this.color2=h}getColorToRef(m){this.color2?u.Bb.LerpToRef(this.color1,this.color2,Math.random(),m):m.l(this.color1)}}class Q{constructor(m,S){this.gradient=m,this.color=S}}class F{constructor(m,S,h){this.gradient=m,this.factor1=S,this.factor2=h}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(m,S,h){if(S[0].gradient>m)return void h(S[0],S[0],1);for(let M=0;M<S.length-1;M++){const l=S[M],O=S[M+1];if(m>=l.gradient&&m<=O.gradient){return void h(l,O,(m-l.gradient)/(O.gradient-l.gradient))}}const l=S.length-1;h(S[l],S[l],1)}}var t=h(11161),A=h(11782),i=h(11196);class W{constructor(m){this.particleSystem=m,this.position=l.nS.Zero(),this.direction=l.nS.Zero(),this.color=new u.Bb(0,0,0,0),this.colorStep=new u.Bb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new l.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new u.Bb(0,0,0,0),this._currentColor2=new u.Bb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=W._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let m=this.age,S=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===S?(S=1,m=this._randomCellOffset):m+=this._randomCellOffset);const h=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let l;l=this._initialSpriteCellLoop?(0,Y.Clamp)(m*S%this.lifeTime/this.lifeTime):(0,Y.Clamp)(m*S/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+l*h|0}_inheritParticleInfoToSubEmitter(m){if(m.particleSystem.uS.position){const S=m.particleSystem.uS;if(S.position.l(this.position),m.inheritDirection){const m=l.TmpVectors.nS[0];this.direction.normalizeToRef(m),S.setDirection(m,0,Math.PI/2)}}else{m.particleSystem.uS.l(this.position)}this.direction.scaleToRef(m.inheritedVelocityAmount/2,l.TmpVectors.nS[0]),m.particleSystem._inheritedVelocityOffset.l(l.TmpVectors.nS[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const m of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(m)}_reset(){this.age=0,this.id=W._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(m){m.position.l(this.position),this._initialDirection?m._initialDirection?m._initialDirection.l(this._initialDirection):m._initialDirection=this._initialDirection.clone():m._initialDirection=null,m.direction.l(this.direction),this.Eq&&(m.Eq?m.Eq.l(this.Eq):m.Eq=this.Eq.clone()),m.color.l(this.color),m.colorStep.l(this.colorStep),m.lifeTime=this.lifeTime,m.age=this.age,m._randomCellOffset=this._randomCellOffset,m.size=this.size,m.scale.l(this.scale),m.angle=this.angle,m.angularSpeed=this.angularSpeed,m.particleSystem=this.particleSystem,m.cellIndex=this.cellIndex,m.id=this.id,m._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(m._currentColorGradient=this._currentColorGradient,m._currentColor1.l(this._currentColor1),m._currentColor2.l(this._currentColor2)),this._currentSizeGradient&&(m._currentSizeGradient=this._currentSizeGradient,m._currentSize1=this._currentSize1,m._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(m._currentAngularSpeedGradient=this._currentAngularSpeedGradient,m._currentAngularSpeed1=this._currentAngularSpeed1,m._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(m._currentVelocityGradient=this._currentVelocityGradient,m._currentVelocity1=this._currentVelocity1,m._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(m._currentLimitVelocityGradient=this._currentLimitVelocityGradient,m._currentLimitVelocity1=this._currentLimitVelocity1,m._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(m._currentDragGradient=this._currentDragGradient,m._currentDrag1=this._currentDrag1,m._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(m._initialStartSpriteCellId=this._initialStartSpriteCellId,m._initialEndSpriteCellId=this._initialEndSpriteCellId,m._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(m.remapData&&this.remapData?m.remapData.l(this.remapData):m.remapData=new l.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(m._randomNoiseCoordinates1?(m._randomNoiseCoordinates1.l(this._randomNoiseCoordinates1),m._randomNoiseCoordinates2.l(this._randomNoiseCoordinates2)):(m._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),m._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}W._Count=0;var mm=h(11450),Sm=(h(11491),h(11668)),hm=h(11663),lm=h(11578);function Mm(m,S){const h=(0,Y.RandomRange)(0,1);u.Bb.LerpToRef(S.color1,S.color2,h,m.color),S.colorDead.subtractToRef(m.color,S._colorDiff),S._colorDiff.scaleToRef(1/m.lifeTime,m.colorStep)}function Om(m,S){m._currentColorGradient=S._colorGradients[0],m._currentColorGradient.getColorToRef(m.color),m._currentColor1.l(m.color),S._colorGradients.length>1?S._colorGradients[1].getColorToRef(m._currentColor2):m._currentColor2.l(m.color)}function um(m,S){const h=S._colorGradients;w.GetCurrentGradient(S._ratio,h,((S,h,l)=>{S!==m._currentColorGradient&&(m._currentColor1.l(m._currentColor2),h.getColorToRef(m._currentColor2),m._currentColorGradient=S),u.Bb.LerpToRef(m._currentColor1,m._currentColor2,l,m.color)}))}function bm(m,S){m.colorStep.scaleToRef(S._scaledUpdateSpeed,S._scaledColorStep),m.color.addInPlace(S._scaledColorStep),m.color.a<0&&(m.color.a=0)}function qm(m,S){w.GetCurrentGradient(S._ratio,S._angularSpeedGradients,((S,h,l)=>{S!==m._currentAngularSpeedGradient&&(m._currentAngularSpeed1=m._currentAngularSpeed2,m._currentAngularSpeed2=h.getFactor(),m._currentAngularSpeedGradient=S),m.angularSpeed=(0,Y.Lerp)(m._currentAngularSpeed1,m._currentAngularSpeed2,l)}))}function Ym(m,S){m.angle+=m.angularSpeed*S._scaledUpdateSpeed}function Vm(m,S){S.particleEmitterType.startDirectionFunction(S._emitterWorldMatrix,m.direction,m,S.isLocal,S._emitterInverseWorldMatrix)}function Im(m,S){S.startDirectionFunction(S._emitterWorldMatrix,m.direction,m,S.isLocal)}function Zm(m,S){m._currentVelocityGradient=S._velocityGradients[0],m._currentVelocity1=m._currentVelocityGradient.getFactor(),S._velocityGradients.length>1?m._currentVelocity2=S._velocityGradients[1].getFactor():m._currentVelocity2=m._currentVelocity1}function Cm(m,S){m._currentLimitVelocityGradient=S._limitVelocityGradients[0],m._currentLimitVelocity1=m._currentLimitVelocityGradient.getFactor(),S._limitVelocityGradients.length>1?m._currentLimitVelocity2=S._limitVelocityGradients[1].getFactor():m._currentLimitVelocity2=m._currentLimitVelocity1}function Bm(m,S){w.GetCurrentGradient(S._ratio,S._velocityGradients,((h,l,M)=>{h!==m._currentVelocityGradient&&(m._currentVelocity1=m._currentVelocity2,m._currentVelocity2=l.getFactor(),m._currentVelocityGradient=h),S._directionScale*=(0,Y.Lerp)(m._currentVelocity1,m._currentVelocity2,M)}))}function Dm(m,S){w.GetCurrentGradient(S._ratio,S._limitVelocityGradients,((h,l,M)=>{h!==m._currentLimitVelocityGradient&&(m._currentLimitVelocity1=m._currentLimitVelocity2,m._currentLimitVelocity2=l.getFactor(),m._currentLimitVelocityGradient=h);const O=(0,Y.Lerp)(m._currentLimitVelocity1,m._currentLimitVelocity2,M);m.direction.length()>O&&m.direction.scaleInPlace(S.limitVelocityDamping)}))}function Em(m,S){m.direction.scaleToRef(S._directionScale,S._scaledDirection)}function nm(m,S){S.particleEmitterType.startPositionFunction(S._emitterWorldMatrix,m.position,m,S.isLocal)}function Lm(m,S){S.startPositionFunction(S._emitterWorldMatrix,m.position,m,S.isLocal)}function Um(m,S){m.Eq?m.Eq.l(m.position):m.Eq=m.position.clone(),l.nS.TransformCoordinatesToRef(m.Eq,S._emitterWorldMatrix,m.position)}function Hm(m,S){S.isLocal&&m.Eq?(m.Eq.addInPlace(S._scaledDirection),l.nS.TransformCoordinatesToRef(m.Eq,S._emitterWorldMatrix,m.position)):m.position.addInPlace(S._scaledDirection)}function Rm(m,S){m._currentDragGradient=S._dragGradients[0],m._currentDrag1=m._currentDragGradient.getFactor(),S._dragGradients.length>1?m._currentDrag2=S._dragGradients[1].getFactor():m._currentDrag2=m._currentDrag1}function ym(m,S){w.GetCurrentGradient(S._ratio,S._dragGradients,((h,l,M)=>{h!==m._currentDragGradient&&(m._currentDrag1=m._currentDrag2,m._currentDrag2=l.getFactor(),m._currentDragGradient=h);const O=(0,Y.Lerp)(m._currentDrag1,m._currentDrag2,M);S._scaledDirection.scaleInPlace(1-O)}))}function om(m,S){m._randomNoiseCoordinates1?(m._randomNoiseCoordinates1.Yb(Math.random(),Math.random(),Math.random()),m._randomNoiseCoordinates2.Yb(Math.random(),Math.random(),Math.random())):(m._randomNoiseCoordinates1=new l.nS(Math.random(),Math.random(),Math.random()),m._randomNoiseCoordinates2=new l.nS(Math.random(),Math.random(),Math.random()))}function sm(m,S){const h=S._noiseTextureData,M=S._noiseTextureSize;if(h&&M&&m._randomNoiseCoordinates1){const O=S._fetchR(m._randomNoiseCoordinates1.x,m._randomNoiseCoordinates1.y,M.width,M.height,h),u=S._fetchR(m._randomNoiseCoordinates1.z,m._randomNoiseCoordinates2.x,M.width,M.height,h),b=S._fetchR(m._randomNoiseCoordinates2.y,m._randomNoiseCoordinates2.z,M.width,M.height,h),q=l.TmpVectors.nS[0],Y=l.TmpVectors.nS[1];q.Yb((2*O-1)*S.noiseStrength.x,(2*u-1)*S.noiseStrength.y,(2*b-1)*S.noiseStrength.z),q.scaleToRef(S._tempScaledUpdateSpeed,Y),m.direction.addInPlace(Y)}}function vm(m,S){S.gravity.scaleToRef(S._tempScaledUpdateSpeed,S._scaledGravity),m.direction.addInPlace(S._scaledGravity)}function Tm(m,S){m.size=(0,Y.RandomRange)(S.minSize,S.maxSize),m.scale.Yb((0,Y.RandomRange)(S.minScaleX,S.maxScaleX),(0,Y.RandomRange)(S.minScaleY,S.maxScaleY))}function Xm(m,S){m._currentSizeGradient=S._sizeGradients[0],m._currentSize1=m._currentSizeGradient.getFactor(),m.size=m._currentSize1,S._sizeGradients.length>1?m._currentSize2=S._sizeGradients[1].getFactor():m._currentSize2=m._currentSize1,m.scale.Yb((0,Y.RandomRange)(S.minScaleX,S.maxScaleX),(0,Y.RandomRange)(S.minScaleY,S.maxScaleY))}function gm(m,S){const h=S._actualFrame/S.targetStopDuration;w.GetCurrentGradient(h,S._startSizeGradients,((h,l,M)=>{h!==S._currentStartSizeGradient&&(S._currentStartSize1=S._currentStartSize2,S._currentStartSize2=l.getFactor(),S._currentStartSizeGradient=h);const O=(0,Y.Lerp)(S._currentStartSize1,S._currentStartSize2,M);m.scale.scaleInPlace(O)}))}function Gm(m,S){w.GetCurrentGradient(S._ratio,S._sizeGradients,((S,h,l)=>{S!==m._currentSizeGradient&&(m._currentSize1=m._currentSize2,m._currentSize2=h.getFactor(),m._currentSizeGradient=S),m.size=(0,Y.Lerp)(m._currentSize1,m._currentSize2,l)}))}function em(m,S){m.remapData=new l.Vector4(0,1,0,1)}function am(m,S){S._colorRemapGradients&&S._colorRemapGradients.length>0&&w.GetCurrentGradient(S._ratio,S._colorRemapGradients,((S,h,l)=>{const M=(0,Y.Lerp)(S.factor1,h.factor1,l),O=(0,Y.Lerp)(S.factor2,h.factor2,l);m.remapData.x=M,m.remapData.y=O-M})),S._alphaRemapGradients&&S._alphaRemapGradients.length>0&&w.GetCurrentGradient(S._ratio,S._alphaRemapGradients,((S,h,l)=>{const M=(0,Y.Lerp)(S.factor1,h.factor1,l),O=(0,Y.Lerp)(S.factor2,h.factor2,l);m.remapData.z=M,m.remapData.w=O-M}))}function xm(m,S){const h=(0,Y.Clamp)(S._actualFrame/S.targetStopDuration);w.GetCurrentGradient(h,S._lifeTimeGradients,((S,l)=>{const M=S,O=l,u=M.getFactor(),b=O.getFactor(),q=(h-M.gradient)/(O.gradient-M.gradient);m.lifeTime=(0,Y.Lerp)(u,b,q)})),S._emitPower=(0,Y.RandomRange)(S.minEmitPower,S.maxEmitPower)}function Pm(m,S){m.lifeTime=(0,Y.RandomRange)(S.minLifeTime,S.maxLifeTime),S._emitPower=(0,Y.RandomRange)(S.minEmitPower,S.maxEmitPower)}function dm(m,S){0===S._emitPower?(m._initialDirection?m._initialDirection.l(m.direction):m._initialDirection=m.direction.clone(),m.direction.set(0,0,0)):(m._initialDirection=null,m.direction.scaleInPlace(S._emitPower)),m.direction.addInPlace(S._inheritedVelocityOffset)}function Jm(m,S){m.angularSpeed=(0,Y.RandomRange)(S.minAngularSpeed,S.maxAngularSpeed),m.angle=(0,Y.RandomRange)(S.minInitialRotation,S.maxInitialRotation)}function Nm(m,S){m._currentAngularSpeedGradient=S._angularSpeedGradients[0],m.angularSpeed=m._currentAngularSpeedGradient.getFactor(),m._currentAngularSpeed1=m.angularSpeed,S._angularSpeedGradients.length>1?m._currentAngularSpeed2=S._angularSpeedGradients[1].getFactor():m._currentAngularSpeed2=m._currentAngularSpeed1,m.angle=(0,Y.RandomRange)(S.minInitialRotation,S.maxInitialRotation)}function jm(m,S){m._initialStartSpriteCellId=S.startSpriteCellID,m._initialEndSpriteCellId=S.endSpriteCellID,m._initialSpriteCellLoop=S.spriteCellLoop}function Km(m,S){m.previousItem=S.previousItem,m.nextItem=S,S.previousItem&&(S.previousItem.nextItem=m),S.previousItem=m}function cm(m,S){m.previousItem=S,m.nextItem=S.nextItem,S.nextItem&&(S.nextItem.previousItem=m),S.nextItem=m}function fm(m,S){let h=S;for(;h.nextItem;)h=h.nextItem;m.previousItem=h,m.nextItem=h.nextItem,h.nextItem=m}function pm(m){m.previousItem&&(m.previousItem.nextItem=m.nextItem),m.nextItem&&(m.nextItem.previousItem=m.previousItem)}class km extends q{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(m){this._startDirectionFunction!==m&&(this._startDirectionFunction=m,this._directionProcessing.process=m?Im:Vm)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(m){this._startPositionFunction!==m&&(this._startPositionFunction=m,this._positionCreation.process=m?Lm:nm)}set onDispose(m){this._onDisposeObserver&&this.Jh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Jh.add(m)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(m){this._useRampGradients!==m&&(this._useRampGradients=m,this._resetEffect(),m?(this._rampCreation={process:em,previousItem:null,nextItem:null},cm(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:am,previousItem:null,nextItem:null},cm(this._remapGradientProcessing,this._gravityProcessing)):(pm(this._rampCreation),pm(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(m){this._isLocal!==m&&(this._isLocal=m,m?(this._isLocalCreation={process:Um,previousItem:null,nextItem:null},cm(this._isLocalCreation,this._positionCreation)):pm(this._isLocalCreation))}get particles(){return this.RZ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(m){this._animationSheetEnabled!==m&&(this._animationSheetEnabled=m,m?(this._sheetCreation={process:jm,previousItem:null,nextItem:null},cm(this._sheetCreation,this._colorCreation)):pm(this._sheetCreation),this._reset())}getActiveCount(){return this.RZ.length}getClassName(){return"Ub"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var m;let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(m=this._customWrappers[S])||void 0===m?void 0:m.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[m]??this._customWrappers[0]}setCustomEffect(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[S]=new mm.e(this._engine),this._customWrappers[S].effect=m,this._customWrappers[S].drawContext&&(this._customWrappers[S].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new t.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(m){if(this.noiseTexture!==m){if(this._noiseTexture=m,!m)return pm(this._noiseCreation),void pm(this._noiseProcessing);this._noiseCreation={process:om,previousItem:null,nextItem:null},cm(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:sm,previousItem:null,nextItem:null},cm(this._noiseProcessing,this._positionProcessing)}}constructor(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(m),this._emitterInverseWorldMatrix=l.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new l.nS,this.Jh=new t.e,this.onStoppedObservable=new t.e,this.onStartedObservable=new t.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.RZ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new u.Bb(0,0,0,0),this._colorDiff=new u.Bb(0,0,0,0),this._scaledDirection=l.nS.Zero(),this._scaledGravity=l.nS.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=m=>{},this.recycleParticle=m=>{const S=this.RZ.pop();S!==m&&S.copyTo(m),this._stockParticles.push(S)},this._createParticle=()=>{let m;return 0!==this._stockParticles.length?(m=this._stockParticles.pop(),m._reset()):m=new W(this),this._prepareParticle(m),m},this.paused=!1,this._shadersLoaded=!1,this._capacity=S,this._epsilon=b,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=l.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||i.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.UZ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Pm,previousItem:null,nextItem:null},this._positionCreation={process:nm,previousItem:null,nextItem:null},cm(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Vm,previousItem:null,nextItem:null},cm(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:dm,previousItem:null,nextItem:null},cm(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Tm,previousItem:null,nextItem:null},cm(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Jm,previousItem:null,nextItem:null},cm(this._angleCreation,this._sizeCreation),this._colorCreation={process:Mm,previousItem:null,nextItem:null},cm(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,q||(this._colorProcessing={process:bm,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ym,previousItem:null,nextItem:null},cm(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Em,previousItem:null,nextItem:null},cm(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Hm,previousItem:null,nextItem:null},cm(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:vm,previousItem:null,nextItem:null},cm(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=O,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new mm.e(this._engine)},this._customWrappers[0].effect=M,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new I,this.updateFunction=m=>{var S;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(S=this.noiseTexture.getContent())||void 0===S||S.then((m=>{this._noiseTextureData=m})));const h=m===this.RZ;for(let l=0;l<m.length;l++){const S=m[l];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const M=S.age;if(S.age+=this._tempScaledUpdateSpeed,S.age>S.lifeTime){const m=S.age-M,h=S.lifeTime-M;this._tempScaledUpdateSpeed=h*this._tempScaledUpdateSpeed/m,S.age=S.lifeTime}this._ratio=S.age/S.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let O=this._updateQueueStart;for(;O;)O.process(S,this),O=O.nextItem;if(this._isAnimationSheetEnabled&&!q&&S.updateCellIndex(),S._inheritParticleInfoToSubEmitters(),S.age>=S.lifeTime){if(this._emitFromParticle(S),S._attachedSubEmitters){for(const m of S._attachedSubEmitters)m.particleSystem.disposeOnStop=!0,m.particleSystem.stop();S._attachedSubEmitters=null}this.recycleParticle(S),h&&l--}else;}}}serialize(m){throw new Error("Method not implemented.")}clone(m,S){throw new Error("Method not implemented.")}_addFactorGradient(m,S,h,l){const M=new F(S,h,l);m.push(M),m.sort(((m,S)=>m.gradient<S.gradient?-1:m.gradient>S.gradient?1:0))}_removeFactorGradient(m,S){if(!m)return;let h=0;for(const l of m){if(l.gradient===S){m.splice(h,1);break}h++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=xm:this._lifeTimeCreation.process=Pm}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:gm,previousItem:null,nextItem:null},cm(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(pm(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(m){this.targetStopDuration!==m&&(this._targetStopDuration=m,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(m,S,h){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,m,S,h),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(m){return this._removeFactorGradient(this._lifeTimeGradients,m),this._syncLifeTimeCreation(),this}addSizeGradient(m,S,h){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Xm,this._sizeGradientProcessing={process:Gm,previousItem:null,nextItem:null},Km(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,m,S,h),this}removeSizeGradient(m){var S;return this._removeFactorGradient(this._sizeGradients,m),0===(null===(S=this._sizeGradients)||void 0===S?void 0:S.length)&&(pm(this._sizeGradientProcessing),this._sizeCreation.process=Tm),this}addColorRemapGradient(m,S,h){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,m,S,h),this}removeColorRemapGradient(m){return this._removeFactorGradient(this._colorRemapGradients,m),this}addAlphaRemapGradient(m,S,h){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,m,S,h),this}removeAlphaRemapGradient(m){return this._removeFactorGradient(this._alphaRemapGradients,m),this}addAngularSpeedGradient(m,S,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Nm,this._angularSpeedGradientProcessing={process:qm,previousItem:null,nextItem:null},Km(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,m,S,h),this}removeAngularSpeedGradient(m){var S;return this._removeFactorGradient(this._angularSpeedGradients,m),0===(null===(S=this._angularSpeedGradients)||void 0===S?void 0:S.length)&&(this._angleCreation.process=Jm,pm(this._angularSpeedGradientProcessing)),this}addVelocityGradient(m,S,h){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Zm,previousItem:null,nextItem:null},cm(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Bm,previousItem:null,nextItem:null},Km(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,m,S,h),this}removeVelocityGradient(m){var S;return this._removeFactorGradient(this._velocityGradients,m),0===(null===(S=this._velocityGradients)||void 0===S?void 0:S.length)&&(pm(this._velocityCreation),pm(this._velocityGradientProcessing)),this}addLimitVelocityGradient(m,S,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Cm,previousItem:null,nextItem:null},cm(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Dm,previousItem:null,nextItem:null},cm(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,m,S,h),this}removeLimitVelocityGradient(m){var S;return this._removeFactorGradient(this._limitVelocityGradients,m),0===(null===(S=this._limitVelocityGradients)||void 0===S?void 0:S.length)&&(pm(this._limitVelocityCreation),pm(this._limitVelocityGradientProcessing)),this}addDragGradient(m,S,h){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Rm,previousItem:null,nextItem:null},Km(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:ym,previousItem:null,nextItem:null},Km(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,m,S,h),this}removeDragGradient(m){var S;return this._removeFactorGradient(this._dragGradients,m),0===(null===(S=this._dragGradients)||void 0===S?void 0:S.length)&&(pm(this._dragCreation),pm(this._dragGradientProcessing)),this}addEmitRateGradient(m,S,h){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,m,S,h),this}removeEmitRateGradient(m){return this._removeFactorGradient(this._emitRateGradients,m),this}addStartSizeGradient(m,S,h){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,m,S,h),this._syncStartSizeCreation(),this}removeStartSizeGradient(m){return this._removeFactorGradient(this._startSizeGradients,m),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const m=new Uint8Array(4*this._rawTextureWidth),S=u.TmpColors.RS[0];for(let h=0;h<this._rawTextureWidth;h++){const l=h/this._rawTextureWidth;w.GetCurrentGradient(l,this._rampGradients,((l,M,O)=>{u.RS.LerpToRef(l.color,M.color,O,S),m[4*h]=255*S.r,m[4*h+1]=255*S.g,m[4*h+2]=255*S.b,m[4*h+3]=255}))}this._rampGradientsTexture=A.d.CreateRGBATexture(m,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((m,S)=>m.gradient<S.gradient?-1:m.gradient>S.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(m,S){this._rampGradients||(this._rampGradients=[]);const h=new Q(m,S);return this._rampGradients.push(h),this._syncRampGradientTexture(),this}removeRampGradient(m){return this._removeGradientAndTexture(m,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(m,S,h){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Om,this._colorProcessing.process=um);const l=new z(m,S,h);return this._colorGradients.push(l),this._colorGradients.sort(((m,S)=>m.gradient<S.gradient?-1:m.gradient>S.gradient?1:0)),this}removeColorGradient(m){if(!this._colorGradients)return this;let S=0;for(const h of this._colorGradients){if(h.gradient===m){this._colorGradients.splice(S,1);break}S++}return 0===this._colorGradients.length&&(this._colorCreation.process=Mm,this._colorProcessing.process=bm),this}resetDrawCache(){if(this._drawWrappers){for(const m of this._drawWrappers)if(m)for(const S of m)null===S||void 0===S||S.dispose();this._drawWrappers=[]}}_fetchR(m,S,h,l,M){return M[4*(((m=.5*Math.abs(m)+.5)*h%h|0)+((S=.5*Math.abs(S)+.5)*l%l|0)*h)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const m=this._engine,S=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*S),this._vertexBuffer=new R.b(m,this._vertexData,!0,S);let h=0;const l=this._vertexBuffer.createVertexBuffer(R.f.PositionKind,h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[R.f.PositionKind]=l,h+=3;const M=this._vertexBuffer.createVertexBuffer(R.f.ColorKind,h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[R.f.ColorKind]=M,h+=4;const O=this._vertexBuffer.createVertexBuffer("angle",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=O,h+=1;const u=this._vertexBuffer.createVertexBuffer("size",h,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=u,h+=2,this._isAnimationSheetEnabled){const m=this._vertexBuffer.createVertexBuffer("cellIndex",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=m,h+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const m=this._vertexBuffer.createVertexBuffer("direction",h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=m,h+=3}if(this._useRampGradients){const m=this._vertexBuffer.createVertexBuffer("remapData",h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=m,h+=4}let b;if(this._useInstancing){const S=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new R.b(m,S,!1,2),b=this._spriteBuffer.createVertexBuffer("offset",0,2)}else b=this._vertexBuffer.createVertexBuffer("offset",h,2,this._vertexBufferSize,this._useInstancing),h+=2;this._vertexBuffers.offset=b,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const m=[],S=[];let h=0;for(let l=0;l<this._capacity;l++)m.push(h),m.push(h+1),m.push(h+2),m.push(h),m.push(h+2),m.push(h+3),S.push(h,h+1,h+1,h+2,h+2,h+3,h+3,h,h,h+3),h+=4;this._indexBuffer=this._engine.createIndexBuffer(m),this._linesIndexBuffer=this._engine.createIndexBuffer(S)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(m)setTimeout((()=>{this.start(0)}),m);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var S;-1!==(null===(S=this.uS)||void 0===S?void 0:S.getClassName().indexOf("Mesh"))&&this.uS.Mb(!0);const m=this.noiseTexture;if(m&&m.onGeneratedObservable)m.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let S=0;S<this.preWarmCycles;S++)this.animate(!0),m.render()}))}));else for(let S=0;S<this.preWarmCycles;S++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(m))}_postStop(m){}reset(){this._stockParticles.length=0,this.RZ.length=0}_appendParticleVertex(m,S,h,M){let O=m*this._vertexBufferSize;if(this._vertexData[O++]=S.position.x+this.jY.x,this._vertexData[O++]=S.position.y+this.jY.y,this._vertexData[O++]=S.position.z+this.jY.z,this._vertexData[O++]=S.color.r,this._vertexData[O++]=S.color.g,this._vertexData[O++]=S.color.b,this._vertexData[O++]=S.color.a,this._vertexData[O++]=S.angle,this._vertexData[O++]=S.scale.x*S.size,this._vertexData[O++]=S.scale.y*S.size,this._isAnimationSheetEnabled&&(this._vertexData[O++]=S.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[O++]=S.direction.x,this._vertexData[O++]=S.direction.y,this._vertexData[O++]=S.direction.z);else if(S._initialDirection){let m=S._initialDirection;this.isLocal&&(l.nS.TransformNormalToRef(m,this._emitterWorldMatrix,l.TmpVectors.nS[0]),m=l.TmpVectors.nS[0]),0===m.x&&0===m.z&&(m.x=.001),this._vertexData[O++]=m.x,this._vertexData[O++]=m.y,this._vertexData[O++]=m.z}else{let m=S.direction;this.isLocal&&(l.nS.TransformNormalToRef(m,this._emitterWorldMatrix,l.TmpVectors.nS[0]),m=l.TmpVectors.nS[0]),0===m.x&&0===m.z&&(m.x=.001),this._vertexData[O++]=m.x,this._vertexData[O++]=m.y,this._vertexData[O++]=m.z}this._useRampGradients&&S.remapData&&(this._vertexData[O++]=S.remapData.x,this._vertexData[O++]=S.remapData.y,this._vertexData[O++]=S.remapData.z,this._vertexData[O++]=S.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===h?h=this._epsilon:1===h&&(h=1-this._epsilon),0===M?M=this._epsilon:1===M&&(M=1-this._epsilon)),this._vertexData[O++]=h,this._vertexData[O++]=M)}_prepareParticle(m){}_createNewOnes(m){let S;for(let h=0;h<m&&this.RZ.length!==this._capacity;h++){S=this._createParticle(),this.RZ.push(S);let m=this._createQueueStart;for(;m;)m.process(S,this),m=m.nextItem;S._inheritParticleInfoToSubEmitters()}}_update(m){if(this._alive=this.RZ.length>0,this.uS.position){const m=this.uS;this._emitterWorldMatrix=m.getWorldMatrix()}else{const m=this.uS;this._emitterWorldMatrix=l.Matrix.Translation(m.x,m.y,m.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.RZ),this._createNewOnes(m)}static _GetAttributeNamesOrOptions(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=[R.f.PositionKind,R.f.ColorKind,"angle","offset","size"];return m&&l.push("cellIndex"),S||l.push("direction"),h&&l.push("remapData"),l}static _GetEffectCreationOptions(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Sm.e)(l),m&&l.push("particlesInfos"),S&&l.push("logarithmicDepthConstant"),h&&(l.push("vFogInfos"),l.push("vFogColor")),l}fillDefines(m,S){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Sm.m)(this,this._scene,m),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&m.push("#define FOG")),this._isAnimationSheetEnabled&&m.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&m.push("#define LOGARITHMICDEPTH"),S===q.BLENDMODE_MULTIPLY&&m.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&m.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(m.push("#define BILLBOARD"),this.billboardMode){case 2:m.push("#define BILLBOARDY");break;case 8:case 9:m.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&m.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:m.push("#define BILLBOARDMODE_ALL")}h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),m.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(m,S,h){S.push(...km._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),m.push(...km._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,lm.f)(m,this._imageProcessingConfigurationDefines),(0,lm.d)(h,this._imageProcessingConfigurationDefines))}_getWrapper(m){const S=this._getCustomDrawWrapper(m);if(null!==S&&void 0!==S&&S.effect)return S;const h=[];this.fillDefines(h,m);const l=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let M=this._drawWrappers[l];M||(M=this._drawWrappers[l]=[]);let O=M[m];O||(O=new mm.e(this._engine),O.drawContext&&(O.drawContext.useInstancing=this._useInstancing),M[m]=O);const u=h.join("\n");if(O.defines!==u){const m=[],S=[],h=[];this.fillUniformsAttributesAndSamplerNames(S,m,h),O.setEffect(this._engine.createEffect("particles",m,S,h,u,void 0,void 0,void 0,void 0,this._shaderLanguage),u)}return O}animate(){var m;let S,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!h&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(h?this.preWarmStepOffset:(null===(m=this._scene)||void 0===m?void 0:m.getAnimationRatio())||1),this.manualEmitCount>-1)S=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let m=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const S=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(S,this._emitRateGradients,((S,h,l)=>{S!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=h.getFactor(),this._currentEmitRateGradient=S),m=(0,Y.Lerp)(this._currentEmitRate1,this._currentEmitRate2,l)}))}S=m*this._scaledUpdateSpeed|0,this._newPartsExcess+=m*this._scaledUpdateSpeed-S}if(this._newPartsExcess>1&&(S+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?S=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(S),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!h){let m=0;for(let S=0;S<this.RZ.length;S++){const h=this.RZ[S];this._appendParticleVertices(m,h),m+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.RZ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(m,S){this._appendParticleVertex(m++,S,0,0),this._useInstancing||(this._appendParticleVertex(m++,S,1,0),this._appendParticleVertex(m++,S,1,1),this._appendParticleVertex(m++,S,0,1))}rebuild(){var m;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(m=this._spriteBuffer)||void 0===m||m._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!km.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(h.bind(h,12812)),Promise.resolve().then(h.bind(h,12769))])):await Promise.all([Promise.resolve().then(h.bind(h,12757)),Promise.resolve().then(h.bind(h,12745))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.uS||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==q.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(q.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(q.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(m){const S=this._getWrapper(m),h=S.effect,M=this._engine;M.enableEffect(S);const O=this.defaultViewMatrix??this._scene.getViewMatrix();if(h.setTexture("diffuseSampler",this.particleTexture),h.setMatrix("view",O),h.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const m=this.particleTexture.getBaseSize();h.setFloat3("particlesInfos",this.spriteCellWidth/m.width,this.spriteCellHeight/m.height,this.spriteCellWidth/m.width)}if(h.setVector2("translationPivot",this.translationPivot),h.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const m=this._scene.activeCamera;h.setVector3("eyePosition",m.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),h.setTexture("rampSampler",this._rampGradientsTexture));const u=h.defines;var b,q,Y,V,I,Z;(this._scene&&((0,Sm.g)(h,this,this._scene),this.applyFog&&(0,hm.g)(this._scene,void 0,h)),u.indexOf("#define BILLBOARDMODE_ALL")>=0&&(O.invertToRef(l.TmpVectors.Matrix[0]),h.setMatrix("invView",l.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?M.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,h):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,h)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?M.bindBuffers(this._vertexBuffers,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBuffer:this._indexBuffer,h):M.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null,h);(this.useLogarithmicDepth&&this._scene&&(0,hm.j)(u,h,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(h),this._setEngineBasedOnBlendMode(m),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(h),this._useInstancing)?null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?M.drawElementsType(6,0,10,this.RZ.length):M.drawArraysType(7,0,4,this.RZ.length):null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?M.drawElementsType(1,0,10*this.RZ.length):M.drawElementsType(0,0,6*this.RZ.length);return this.RZ.length}render(){if(!this.isReady()||!this.RZ.length)return 0;const m=this._engine;m.setState&&(m.setState(!1),this.forceDepthWrite&&m.setDepthWrite(!0));let S=0;return S=this.blendMode===q.BLENDMODE_MULTIPLYADD?this._render(q.BLENDMODE_MULTIPLY)+this._render(q.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),S}_onDispose(){}dispose(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),m&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),m&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(S,h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const m=this._scene.UZ.indexOf(this);m>-1&&this._scene.UZ.splice(m,1),this._scene._activeParticleSystems.dispose()}this.Jh.notifyObservers(this),this.Jh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}km.ForceGLSL=!1;var rm,zm=h(11189);!function(m){m[m.ATTACHED=0]="ATTACHED",m[m.END=1]="END"}(rm||(rm={}));class Qm{constructor(m){if(this.particleSystem=m,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!m.uS||!m.uS.dispose){const S=(0,b.d)("BABYLON.AbstractMesh");m.uS=new S("SubemitterSystemEmitter",m.sm()),m._disposeEmitterOnDispose=!0}}clone(){let m=this.particleSystem.uS;if(m){if(m instanceof l.nS)m=m.clone();else if(-1!==m.getClassName().indexOf("Mesh")){m=new((0,b.d)("BABYLON.Mesh"))("",m.sm()),m.isVisible=!1}}else m=new l.nS;const S=new Qm(this.particleSystem.clone(this.particleSystem.name,m));return S.particleSystem.name+="Clone",S.type=this.type,S.inheritDirection=this.inheritDirection,S.inheritedVelocityAmount=this.inheritedVelocityAmount,S.particleSystem._disposeEmitterOnDispose=!0,S.particleSystem.disposeOnStop=!0,S}serialize(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};return S.type=this.type,S.inheritDirection=this.inheritDirection,S.inheritedVelocityAmount=this.inheritedVelocityAmount,S.particleSystem=this.particleSystem.serialize(m),S}static _ParseParticleSystem(m,S,h){throw(0,zm.c)("ParseParticle")}static Parse(m,S,h){const l=m.particleSystem,M=new Qm(Qm._ParseParticleSystem(l,S,h,!0));return M.type=m.type,M.inheritDirection=m.inheritDirection,M.inheritedVelocityAmount=m.inheritedVelocityAmount,M.particleSystem._isSubEmitter=!0,M}dispose(){this.particleSystem.dispose()}}var Fm=h(11229);function wm(m,S){const h=new n;return h.direction1=m,h.direction2=S,h}function tm(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Am(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function im(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.nS(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0);return new U(m,S,h)}function Wm(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function mS(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.nS(0,1,0);return new D(m,S,h,M,O)}function SS(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Z(m,S)}function hS(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0),M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0);return new C(m,S,h,M)}const lS=l.nS.Zero(),MS=l.nS.Zero(),OS=l.nS.Zero();class uS{constructor(){this.strength=0,this.position=l.nS.Zero()}_processParticle(m,S){this.position.subtractToRef(m.position,lS);const h=lS.lengthSquared()+1;lS.normalize().scaleToRef(this.strength/h,MS),MS.scaleToRef(S._tempScaledUpdateSpeed,OS),m.direction.addInPlace(OS)}serialize(){return{position:this.position.DM(),strength:this.strength}}}class bS extends km{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=m=>{if(!this._subEmitters||0===this._subEmitters.length)return;const S=Math.floor(Math.random()*this._subEmitters.length);for(const h of this._subEmitters[S])if(1===h.type){const S=h.clone();m._inheritParticleInfoToSubEmitter(S),S.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(S.particleSystem),S.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(m,S){const h=wm(m,S);return this.particleEmitterType=h,h}get flowMap(){return this._flowMap}set flowMap(m){this._flowMap!==m&&(this._flowMap=m,this._flowMapUpdate&&(pm(this._flowMapUpdate),this._flowMapUpdate=null),m&&(this._flowMapUpdate={process:m=>{var S;const h=null===(S=this.sm())||void 0===S?void 0:S.getTransformMatrix();this._flowMap._processParticle(m,this.flowMapStrength*this._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null},cm(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(m){this._attractors.push(m),1===this._attractors.length&&(this._attractorUpdate={process:m=>{for(const S of this._attractors)S._processParticle(m,this)},previousItem:null,nextItem:null},cm(this._attractorUpdate,this._directionProcessing))}removeAttractor(m){const S=this._attractors.indexOf(m);-1!==S&&this._attractors.splice(S,1),0===this._attractors.length&&pm(this._attractorUpdate)}start(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(m)}createHemisphericEmitter(){const m=tm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=m,m}createSphereEmitter(){const m=Am(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=m,m}createDirectedSphereEmitter(){const m=im(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.nS(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0));return this.particleEmitterType=m,m}createCylinderEmitter(){const m=Wm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=m,m}createDirectedCylinderEmitter(){const m=mS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.nS(0,1,0));return this.particleEmitterType=m,m}createConeEmitter(){const m=SS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=m,m}createDirectedConeEmitter(){const m=hS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0));return this.particleEmitterType=m,m}createBoxEmitter(m,S,h,l){const M=new I;return this.particleEmitterType=M,this.direction1=m,this.direction2=S,this.minEmitBox=h,this.maxEmitBox=l,M}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const m of this.subEmitters)m instanceof bS?this._subEmitters.push([new Qm(m)]):m instanceof Qm?this._subEmitters.push([m]):m instanceof Array&&this._subEmitters.push(m)}_stopSubEmitters(){if(this.activeSubSystems){for(const m of this.activeSubSystems)m.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const m=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==m&&this._rootParticleSystem.activeSubSystems.splice(m,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(m){m&&this._stopSubEmitters()}_prepareParticle(m){if(this._subEmitters&&this._subEmitters.length>0){const S=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];m._attachedSubEmitters=[];for(const h of S)if(0===h.type){const S=h.clone();m._attachedSubEmitters.push(S),S.particleSystem.start()}}}_onDispose(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),m&&this.particles)for(const h of this.particles)if(h._attachedSubEmitters)for(let m=h._attachedSubEmitters.length-1;m>=0;m-=1)h._attachedSubEmitters[m].dispose();if(S&&this.activeSubSystems)for(let h=this.activeSubSystems.length-1;h>=0;h-=1)this.activeSubSystems[h].dispose();if(this._subEmitters&&this._subEmitters.length){for(let m=0;m<this._subEmitters.length;m++)for(const S of this._subEmitters[m])S.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.uS&&this.uS.dispose&&this.uS.dispose(!0)}static _Parse(m,S,h,M){let O;O=h instanceof Fm.b?null:h;const q=(0,b.d)("BABYLON.Texture");if(q&&O&&(m.texture?S.particleTexture=q.Parse(m.texture,O,M):m.textureName&&(S.particleTexture=new q(M+m.textureName,O,!1,void 0===m.invertY||m.invertY),S.particleTexture.name=m.textureName)),m.emitterId||0===m.emitterId||void 0!==m.uS?m.emitterId&&O?S.uS=O.getLastMeshById(m.emitterId):S.uS=l.nS.yS(m.uS):S.uS=l.nS.Zero(),S.isLocal=!!m.isLocal,void 0!==m.renderingGroupId&&(S.renderingGroupId=m.renderingGroupId),void 0!==m.isBillboardBased&&(S.isBillboardBased=m.isBillboardBased),void 0!==m.billboardMode&&(S.billboardMode=m.billboardMode),void 0!==m.useLogarithmicDepth&&(S.useLogarithmicDepth=m.useLogarithmicDepth),m.animations){for(let h=0;h<m.animations.length;h++){const l=m.animations[h],M=(0,b.d)("BABYLON.Animation");M&&S.animations.push(M.Parse(l))}S.beginAnimationOnStart=m.beginAnimationOnStart,S.beginAnimationFrom=m.beginAnimationFrom,S.beginAnimationTo=m.beginAnimationTo,S.beginAnimationLoop=m.beginAnimationLoop}if(m.autoAnimate&&O&&O.beginAnimation(S,m.autoAnimateFrom,m.autoAnimateTo,m.autoAnimateLoop,m.autoAnimateSpeed||1),S.startDelay=0|m.startDelay,S.minAngularSpeed=m.minAngularSpeed,S.maxAngularSpeed=m.maxAngularSpeed,S.minSize=m.minSize,S.maxSize=m.maxSize,m.minScaleX&&(S.minScaleX=m.minScaleX,S.maxScaleX=m.maxScaleX,S.minScaleY=m.minScaleY,S.maxScaleY=m.maxScaleY),void 0!==m.preWarmCycles&&(S.preWarmCycles=m.preWarmCycles,S.preWarmStepOffset=m.preWarmStepOffset),void 0!==m.minInitialRotation&&(S.minInitialRotation=m.minInitialRotation,S.maxInitialRotation=m.maxInitialRotation),S.minLifeTime=m.minLifeTime,S.maxLifeTime=m.maxLifeTime,S.minEmitPower=m.minEmitPower,S.maxEmitPower=m.maxEmitPower,S.emitRate=m.emitRate,S.gravity=l.nS.yS(m.gravity),m.noiseStrength&&(S.noiseStrength=l.nS.yS(m.noiseStrength)),S.color1=u.Bb.yS(m.color1),S.color2=u.Bb.yS(m.color2),S.colorDead=u.Bb.yS(m.colorDead),S.updateSpeed=m.updateSpeed,S.targetStopDuration=m.targetStopDuration,S.blendMode=m.blendMode,m.colorGradients)for(const l of m.colorGradients)S.addColorGradient(l.gradient,u.Bb.yS(l.color1),l.color2?u.Bb.yS(l.color2):void 0);if(m.rampGradients){for(const h of m.rampGradients)S.addRampGradient(h.gradient,u.RS.yS(h.color));S.useRampGradients=m.useRampGradients}if(m.colorRemapGradients)for(const l of m.colorRemapGradients)S.addColorRemapGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.alphaRemapGradients)for(const l of m.alphaRemapGradients)S.addAlphaRemapGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.sizeGradients)for(const l of m.sizeGradients)S.addSizeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.angularSpeedGradients)for(const l of m.angularSpeedGradients)S.addAngularSpeedGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.velocityGradients)for(const l of m.velocityGradients)S.addVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.dragGradients)for(const l of m.dragGradients)S.addDragGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.emitRateGradients)for(const l of m.emitRateGradients)S.addEmitRateGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.startSizeGradients)for(const l of m.startSizeGradients)S.addStartSizeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.lifeTimeGradients)for(const l of m.lifeTimeGradients)S.addLifeTimeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(m.limitVelocityGradients){for(const h of m.limitVelocityGradients)S.addLimitVelocityGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);S.limitVelocityDamping=m.limitVelocityDamping}if(m.noiseTexture&&O){const h=(0,b.d)("BABYLON.ProceduralTexture");S.noiseTexture=h.Parse(m.noiseTexture,O,M)}let Y;if(m.particleEmitterType){switch(m.particleEmitterType.type){case"SphereParticleEmitter":Y=new L;break;case"SphereDirectedParticleEmitter":Y=new U;break;case"ConeEmitter":case"ConeParticleEmitter":Y=new Z;break;case"ConeDirectedParticleEmitter":Y=new C;break;case"CylinderParticleEmitter":Y=new B;break;case"CylinderDirectedParticleEmitter":Y=new D;break;case"HemisphericParticleEmitter":Y=new E;break;case"PointParticleEmitter":Y=new n;break;case"MeshParticleEmitter":Y=new y;break;case"CustomParticleEmitter":Y=new H;break;default:Y=new I}Y.parse(m.particleEmitterType,O)}else Y=new I,Y.parse(m,O);S.particleEmitterType=Y,S.startSpriteCellID=m.startSpriteCellID,S.endSpriteCellID=m.endSpriteCellID,S.spriteCellLoop=m.spriteCellLoop??!0,S.spriteCellWidth=m.spriteCellWidth,S.spriteCellHeight=m.spriteCellHeight,S.spriteCellChangeSpeed=m.spriteCellChangeSpeed,S.spriteRandomStartCell=m.spriteRandomStartCell,S.disposeOnStop=m.disposeOnStop??!1,S.manualEmitCount=m.manualEmitCount??-1}static Parse(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0;const b=m.name;let q,Y,V=null,I=null;if(S instanceof Fm.b?q=S:(Y=S,q=Y.getEngine()),m.customShader&&q.createEffectForParticles){I=m.customShader;const S=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";V=q.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,S)}const Z=new bS(b,O||m.KS,S,V,m.isAnimationSheetEnabled);if(Z.customShader=I,Z._rootUrl=h,m.id&&(Z.id=m.id),m.subEmitters){Z.subEmitters=[];for(const l of m.subEmitters){const m=[];for(const M of l)m.push(Qm.Parse(M,S,h));Z.subEmitters.push(m)}}if(m.attractors)for(const u of m.attractors){const m=new uS;m.position=l.nS.yS(u.position),m.strength=u.strength,Z.addAttractor(m)}return bS._Parse(m,Z,S,h),m.textureMask&&(Z.textureMask=u.Bb.yS(m.textureMask)),m.jY&&(Z.jY=l.nS.yS(m.jY)),m.preventAutoStart&&(Z.preventAutoStart=m.preventAutoStart),M||Z.preventAutoStart||Z.start(),Z}serialize(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};if(bS._Serialize(S,this,m),S.textureMask=this.textureMask.DM(),S.customShader=this.customShader,S.preventAutoStart=this.preventAutoStart,S.jY=this.jY.DM(),this.subEmitters){S.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const h of this._subEmitters){const l=[];for(const S of h)l.push(S.serialize(m));S.subEmitters.push(l)}}if(this._attractors&&this._attractors.length){S.attractors=[];for(const m of this._attractors)S.attractors.push(m.serialize())}return S}static _Serialize(m,S,h){if(m.name=S.name,m.id=S.id,m.KS=S.getCapacity(),m.disposeOnStop=S.disposeOnStop,m.manualEmitCount=S.manualEmitCount,S.uS.position){const h=S.uS;m.emitterId=h.id}else{const h=S.uS;m.uS=h.DM()}S.particleEmitterType&&(m.particleEmitterType=S.particleEmitterType.serialize()),S.particleTexture&&(h?m.texture=S.particleTexture.serialize():(m.textureName=S.particleTexture.name,m.invertY=!!S.particleTexture._invertY)),m.isLocal=S.isLocal,x.e.AppendSerializedAnimations(S,m),m.beginAnimationOnStart=S.beginAnimationOnStart,m.beginAnimationFrom=S.beginAnimationFrom,m.beginAnimationTo=S.beginAnimationTo,m.beginAnimationLoop=S.beginAnimationLoop,m.startDelay=S.startDelay,m.renderingGroupId=S.renderingGroupId,m.isBillboardBased=S.isBillboardBased,m.billboardMode=S.billboardMode,m.minAngularSpeed=S.minAngularSpeed,m.maxAngularSpeed=S.maxAngularSpeed,m.minSize=S.minSize,m.maxSize=S.maxSize,m.minScaleX=S.minScaleX,m.maxScaleX=S.maxScaleX,m.minScaleY=S.minScaleY,m.maxScaleY=S.maxScaleY,m.minEmitPower=S.minEmitPower,m.maxEmitPower=S.maxEmitPower,m.minLifeTime=S.minLifeTime,m.maxLifeTime=S.maxLifeTime,m.emitRate=S.emitRate,m.gravity=S.gravity.DM(),m.noiseStrength=S.noiseStrength.DM(),m.color1=S.color1.DM(),m.color2=S.color2.DM(),m.colorDead=S.colorDead.DM(),m.updateSpeed=S.updateSpeed,m.targetStopDuration=S.targetStopDuration,m.blendMode=S.blendMode,m.preWarmCycles=S.preWarmCycles,m.preWarmStepOffset=S.preWarmStepOffset,m.minInitialRotation=S.minInitialRotation,m.maxInitialRotation=S.maxInitialRotation,m.startSpriteCellID=S.startSpriteCellID,m.spriteCellLoop=S.spriteCellLoop,m.endSpriteCellID=S.endSpriteCellID,m.spriteCellChangeSpeed=S.spriteCellChangeSpeed,m.spriteCellWidth=S.spriteCellWidth,m.spriteCellHeight=S.spriteCellHeight,m.spriteRandomStartCell=S.spriteRandomStartCell,m.isAnimationSheetEnabled=S.isAnimationSheetEnabled,m.useLogarithmicDepth=S.useLogarithmicDepth;const l=S.getColorGradients();if(l){m.colorGradients=[];for(const S of l){const h={gradient:S.gradient,color1:S.color1.DM()};S.color2?h.color2=S.color2.DM():h.color2=S.color1.DM(),m.colorGradients.push(h)}}const M=S.getRampGradients();if(M){m.rampGradients=[];for(const S of M){const h={gradient:S.gradient,color:S.color.DM()};m.rampGradients.push(h)}m.useRampGradients=S.useRampGradients}const O=S.getColorRemapGradients();if(O){m.colorRemapGradients=[];for(const S of O){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.colorRemapGradients.push(h)}}const u=S.getAlphaRemapGradients();if(u){m.alphaRemapGradients=[];for(const S of u){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.alphaRemapGradients.push(h)}}const b=S.getSizeGradients();if(b){m.sizeGradients=[];for(const S of b){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.sizeGradients.push(h)}}const q=S.getAngularSpeedGradients();if(q){m.angularSpeedGradients=[];for(const S of q){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.angularSpeedGradients.push(h)}}const Y=S.getVelocityGradients();if(Y){m.velocityGradients=[];for(const S of Y){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.velocityGradients.push(h)}}const V=S.getDragGradients();if(V){m.dragGradients=[];for(const S of V){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.dragGradients.push(h)}}const I=S.getEmitRateGradients();if(I){m.emitRateGradients=[];for(const S of I){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.emitRateGradients.push(h)}}const Z=S.getStartSizeGradients();if(Z){m.startSizeGradients=[];for(const S of Z){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.startSizeGradients.push(h)}}const C=S.getLifeTimeGradients();if(C){m.lifeTimeGradients=[];for(const S of C){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.lifeTimeGradients.push(h)}}const B=S.getLimitVelocityGradients();if(B){m.limitVelocityGradients=[];for(const S of B){const h={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?h.factor2=S.factor2:h.factor2=S.factor1,m.limitVelocityGradients.push(h)}m.limitVelocityDamping=S.limitVelocityDamping}S.noiseTexture&&(m.noiseTexture=S.noiseTexture.serialize())}clone(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l={...this._customWrappers};let M=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){M=this.customShader;const m=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"",S=O.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,m);l[0]?l[0].effect=S:this.setCustomEffect(S,0)}const u=this.serialize(h),b=bS.Parse(u,this._scene||this._engine,this._rootUrl);return b.name=m,b.customShader=M,b._customWrappers=l,void 0===S&&(S=this.uS),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.uS=S,this.preventAutoStart||b.start(),b}}bS.BILLBOARDMODE_Y=2,bS.BILLBOARDMODE_ALL=7,bS.BILLBOARDMODE_STRETCHED=8,bS.BILLBOARDMODE_STRETCHED_LOCAL=9,Qm._ParseParticleSystem=bS.Parse;var qS=h(11570),YS=h(11567),VS=h(11456);VS.d.prototype.createTransformFeedback=function(){const m=this._gl.createTransformFeedback();if(!m)throw new Error("Unable to create Transform Feedback");return m},VS.d.prototype.deleteTransformFeedback=function(m){this._gl.deleteTransformFeedback(m)},VS.d.prototype.bindTransformFeedback=function(m){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,m)},VS.d.prototype.beginTransformFeedback=function(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(m?this._gl.POINTS:this._gl.TRIANGLES)},VS.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},VS.d.prototype.setTranformFeedbackVaryings=function(m,S){this._gl.transformFeedbackVaryings(m,S,this._gl.INTERLEAVED_ATTRIBS)},VS.d.prototype.bindTransformFeedbackBuffer=function(m){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,m?m.underlyingResource:null)},VS.d.prototype.readTransformFeedbackBuffer=function(m){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,m)};const IS="clipPlaneFragmentDeclaration2",ZS="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";s.b.IncludesShadersStore[IS]||(s.b.IncludesShadersStore[IS]=ZS);h(12648),h(12651),h(12657),h(12660),h(12669),h(12672),h(12681),h(12688);const CS="gpuRenderParticlesPixelShader",BS="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";s.b.ShadersStore[CS]||(s.b.ShadersStore[CS]=BS);const DS="clipPlaneVertexDeclaration2",ES="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";s.b.IncludesShadersStore[DS]||(s.b.IncludesShadersStore[DS]=ES);h(12697),h(12701),h(12707),h(12712);const nS="gpuRenderParticlesVertexShader",LS="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";s.b.ShadersStore[nS]||(s.b.ShadersStore[nS]=LS);class US extends q{static get IsSupported(){if(!i.d.LastCreatedEngine)return!1;const m=i.d.LastCreatedEngine.getCaps();return m.supportTransformFeedbacks||m.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(m){this._maxActiveParticleCount=Math.min(m,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(m){this.maxActiveParticleCount=m}createPointEmitter(m,S){const h=wm(m,S);return this.particleEmitterType=h,h}createHemisphericEmitter(){const m=tm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=m,m}createSphereEmitter(){const m=Am(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=m,m}createDirectedSphereEmitter(){const m=im(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.nS(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0));return this.particleEmitterType=m,m}createCylinderEmitter(){const m=Wm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=m,m}createDirectedCylinderEmitter(){const m=mS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.nS(0,1,0));return this.particleEmitterType=m,m}createConeEmitter(){const m=SS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=m,m}createDirectedConeEmitter(){const m=hS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.nS(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.nS(0,1,0));return this.particleEmitterType=m,m}createBoxEmitter(m,S,h,l){const M=new I;return this.particleEmitterType=M,this.direction1=m,this.direction2=S,this.minEmitBox=h,this.maxEmitBox=l,M}get flowMap(){return this._flowMap}set flowMap(m){this._flowMap!==m&&(this._flowMap=m)}isReady(){if(!this.uS||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==bS.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(bS.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(bS.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";m?setTimeout((()=>{this.start(0)}),m):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var m;let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(m=this._customWrappers[S])||void 0===m?void 0:m.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[m]??this._customWrappers[0]}setCustomEffect(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[S]=new mm.e(this._engine),this._customWrappers[S].effect=m}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new t.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(m,S,h){return super._removeGradientAndTexture(m,S,h),this._releaseBuffers(),this}addColorGradient(m,S){this._colorGradients||(this._colorGradients=[]);const h=new z(m,S);return this._colorGradients.push(h),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(m&&this._colorGradients.sort(((m,S)=>m.gradient<S.gradient?-1:m.gradient>S.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(m){return this._removeGradientAndTexture(m,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const S in this._drawWrappers){var m;null===(m=this._drawWrappers[S].drawContext)||void 0===m||m.reset()}}_addFactorGradient(m,S,h){const l=new F(S,h);m.push(l),this._releaseBuffers()}addSizeGradient(m,S){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,m,S),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(m){return this._removeGradientAndTexture(m,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(m,S){if(!m)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&m.sort(((m,S)=>m.gradient<S.gradient?-1:m.gradient>S.gradient?1:0));const h=this;h[S]&&(h[S].dispose(),h[S]=null)}addAngularSpeedGradient(m,S){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,m,S),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(m){return this._removeGradientAndTexture(m,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(m,S){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,m,S),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(m){return this._removeGradientAndTexture(m,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(m,S){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,m,S),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(m){return this._removeGradientAndTexture(m,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(m,S){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,m,S),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(m){return this._removeGradientAndTexture(m,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(m){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(m),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Jh=new t.e,this.onStoppedObservable=new t.e,this.onStartedObservable=new t.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=l.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||i.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.UZ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,b.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,b.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,b.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,b.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new mm.e(this._engine)},this._customWrappers[0].effect=M,this._drawWrappers={0:new mm.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(S=S??{}).randomTextureSize||delete S.randomTextureSize;const u={KS:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...S},q=S;isFinite(q)&&(u.KS=q),this._capacity=u.KS,this._maxActiveParticleCount=u.KS,this._currentActiveCount=0,this._isAnimationSheetEnabled=O,this.particleEmitterType=new I;const Y=Math.min(this._engine.getCaps().maxTextureSize,u.randomTextureSize);let V=[];for(let l=0;l<Y;++l)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture=new A.d(new Float32Array(V),Y,1,5,h,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,V=[];for(let l=0;l<Y;++l)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture2=new A.d(new Float32Array(V),Y,1,5,h,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Y}_reset(){this._releaseBuffers()}_createVertexBuffers(m,S,h){const l={};l.position=S.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let M=3;l.age=S.createVertexBuffer("age",M,1,this._attributesStrideSize,!0),M+=1,l.size=S.createVertexBuffer("size",M,3,this._attributesStrideSize,!0),M+=3,l.life=S.createVertexBuffer("life",M,1,this._attributesStrideSize,!0),M+=1,M+=4,this.billboardMode===bS.BILLBOARDMODE_STRETCHED&&(l.direction=S.createVertexBuffer("direction",M,3,this._attributesStrideSize,!0)),M+=3,this._platform.alignDataInBuffer&&(M+=1),this.particleEmitterType instanceof H&&(M+=3,this._platform.alignDataInBuffer&&(M+=1)),this._colorGradientsTexture||(l.color=S.createVertexBuffer("color",M,4,this._attributesStrideSize,!0),M+=4),this._isBillboardBased||(l.initialDirection=S.createVertexBuffer("initialDirection",M,3,this._attributesStrideSize,!0),M+=3,this._platform.alignDataInBuffer&&(M+=1)),this.noiseTexture&&(l.noiseCoordinates1=S.createVertexBuffer("noiseCoordinates1",M,3,this._attributesStrideSize,!0),M+=3,this._platform.alignDataInBuffer&&(M+=1),l.noiseCoordinates2=S.createVertexBuffer("noiseCoordinates2",M,3,this._attributesStrideSize,!0),M+=3,this._platform.alignDataInBuffer&&(M+=1)),l.angle=S.createVertexBuffer("angle",M,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?M++:M+=2,this._isAnimationSheetEnabled&&(l.cellIndex=S.createVertexBuffer("cellIndex",M,1,this._attributesStrideSize,!0),M+=1,this.spriteRandomStartCell&&(l.cellStartOffset=S.createVertexBuffer("cellStartOffset",M,1,this._attributesStrideSize,!0),M+=1)),l.offset=h.createVertexBuffer("offset",0,2),l.uv=h.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(l),this._platform.createVertexBuffers(m,l),this.resetDrawCache()}_initialize(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!m)return;const S=this._engine,h=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof H&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const M=this.particleEmitterType instanceof H,O=l.TmpVectors.nS[0];let u=0;for(let l=0;l<this._capacity;l++)if(h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),M?(this.particleEmitterType.particleDestinationGenerator(l,null,O),h.push(O.x),h.push(O.y),h.push(O.z)):(h.push(0),h.push(0),h.push(0)),this._platform.alignDataInBuffer&&h.push(0),u+=16,M&&(this.particleEmitterType.particlePositionGenerator(l,null,O),h.push(O.x),h.push(O.y),h.push(O.z),this._platform.alignDataInBuffer&&h.push(0),u+=4),this._colorGradientsTexture||(h.push(0),h.push(0),h.push(0),h.push(0),u+=4),this.isBillboardBased||(h.push(0),h.push(0),h.push(0),this._platform.alignDataInBuffer&&h.push(0),u+=4),this.noiseTexture&&(h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),u+=8),h.push(0),u+=1,this._angularSpeedGradientsTexture||(h.push(0),u+=1),this._isAnimationSheetEnabled&&(h.push(0),u+=1,this.spriteRandomStartCell&&(h.push(0),u+=1)),this._platform.alignDataInBuffer){let m=3-(u+3&3);for(u+=m;m-- >0;)h.push(0)}const b=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),q=this._platform.createParticleBuffer(h),Y=this._platform.createParticleBuffer(h);this._buffer0=new R.b(S,q,!1,this._attributesStrideSize),this._buffer1=new R.b(S,Y,!1,this._attributesStrideSize),this._spriteBuffer=new R.b(S,b,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let m=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(m+="\n#define BILLBOARD"),this._colorGradientsTexture&&(m+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(m+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(m+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(m+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(m+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(m+="\n#define DRAGGRADIENTS"),this._flowMap&&(m+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(m+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(m+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(m+="\n#define NOISE"),this.isLocal&&(m+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===m||(this._cachedUpdateDefines=m,this._updateBuffer=this._platform.createUpdateBuffer(m)),this._platform.isUpdateBufferReady()}_getWrapper(m){const S=this._getCustomDrawWrapper(m);if(null!==S&&void 0!==S&&S.effect)return S;const h=[];this.fillDefines(h,m);let l=this._drawWrappers[m];l||(l=new mm.e(this._engine),l.drawContext&&(l.drawContext.useInstancing=!0),this._drawWrappers[m]=l);const M=h.join("\n");if(l.defines!==M){const m=[],S=[],h=[];this.fillUniformsAttributesAndSamplerNames(S,m,h),l.setEffect(this._engine.createEffect("gpuRenderParticles",m,S,h,M),M)}return l}static _GetAttributeNamesOrOptions(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const M=[R.f.PositionKind,"age","life","size","angle"];return m||M.push(R.f.ColorKind),S&&M.push("cellIndex"),h||M.push("initialDirection"),l&&M.push("direction"),M.push("offset",R.f.UVKind),M}static _GetEffectCreationOptions(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=["emitterWM","jY","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Sm.e)(l),m&&l.push("sheetInfos"),S&&l.push("logarithmicDepthConstant"),h&&(l.push("vFogInfos"),l.push("vFogColor")),l}fillDefines(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Sm.m)(this,this._scene,m),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==YS.c.FOGMODE_NONE&&m.push("#define FOG")),S===bS.BLENDMODE_MULTIPLY&&m.push("#define BLENDMULTIPLYMODE"),this.isLocal&&m.push("#define LOCAL"),this.useLogarithmicDepth&&m.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(m.push("#define BILLBOARD"),this.billboardMode){case bS.BILLBOARDMODE_Y:m.push("#define BILLBOARDY");break;case bS.BILLBOARDMODE_STRETCHED:m.push("#define BILLBOARDSTRETCHED");break;case bS.BILLBOARDMODE_ALL:m.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&m.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&m.push("#define ANIMATESHEET"),h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),m.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(m,S,h){S.push(...US._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===bS.BILLBOARDMODE_STRETCHED)),m.push(...US._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(qS.e.PrepareUniforms(m,this._imageProcessingConfigurationDefines),qS.e.PrepareSamplers(h,this._imageProcessingConfigurationDefines))}animate(){var m;let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(S?this.preWarmStepOffset:(null===(m=this._scene)||void 0===m?void 0:m.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(m,S){const h=this[S];if(!m||!m.length||h)return;const l=new Float32Array(this._rawTextureWidth);for(let M=0;M<this._rawTextureWidth;M++){const S=M/this._rawTextureWidth;w.GetCurrentGradient(S,m,((m,S,h)=>{l[M]=(0,Y.Lerp)(m.factor1,S.factor1,h)}))}this[S]=A.d.CreateRTexture(l,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[S].name=S.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const m=new Uint8Array(4*this._rawTextureWidth),S=u.TmpColors.Bb[0];for(let h=0;h<this._rawTextureWidth;h++){const l=h/this._rawTextureWidth;w.GetCurrentGradient(l,this._colorGradients,((l,M,O)=>{u.Bb.LerpToRef(l.color1,M.color1,O,S),m[4*h]=255*S.r,m[4*h+1]=255*S.g,m[4*h+2]=255*S.b,m[4*h+3]=255*S.a}))}this._colorGradientsTexture=A.d.CreateRGBATexture(m,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(m,S){var h,M,O,u;const b=this._getWrapper(m),q=b.effect;this._engine.enableEffect(b);const Y=(null===(h=this._scene)||void 0===h?void 0:h.getViewMatrix())||l.Matrix.IdentityReadOnly;if(q.setMatrix("view",Y),q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),q.setTexture("diffuseSampler",this.particleTexture),q.setVector2("translationPivot",this.translationPivot),q.setVector3("jY",this.jY),this.isLocal&&q.setMatrix("emitterWM",S),this._colorGradientsTexture?q.setTexture("colorGradientSampler",this._colorGradientsTexture):q.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const m=this.particleTexture.getBaseSize();q.setFloat3("sheetInfos",this.spriteCellWidth/m.width,this.spriteCellHeight/m.height,m.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const m=this._scene.activeCamera;q.setVector3("eyePosition",m.globalPosition)}const V=q.defines;if(this._scene&&((0,Sm.g)(q,this,this._scene),this.applyFog&&(0,hm.g)(this._scene,void 0,q)),V.indexOf("#define BILLBOARDMODE_ALL")>=0){const m=Y.clone();m.invert(),q.setMatrix("invView",m)}return this.useLogarithmicDepth&&this._scene&&(0,hm.j)(V,q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(q),this._setEngineBasedOnBlendMode(m),this._platform.bindDrawBuffers(this._targetIndex,q,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(q),null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(u=this._scene)&&void 0!==u&&u.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(m){if(!this.uS||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!m)if(this.uS.position){m=this.uS.getWorldMatrix()}else{const S=this.uS;m=l.TmpVectors.Matrix[0],l.Matrix.TranslationToRef(S.x,S.y,S.z,m)}const S=this._engine,h=S.getDepthWrite();if(S.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const m=this.sm();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",m.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",m),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const M=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=M,S.setDepthWrite(h)}render(){let m,S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!S&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let m=0;m<this.preWarmCycles;m++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const m=0|this._accumulatedCount;this._accumulatedCount-=m,this._currentActiveCount+=m}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.uS.position){m=this.uS.getWorldMatrix()}else{const S=this.uS;m=l.TmpVectors.Matrix[0],l.Matrix.TranslationToRef(S.x,S.y,S.z,m)}const M=this._engine;this.updateInAnimate||this._update(m);let O=0;return S||h||(M.setState(!1),this.forceDepthWrite&&M.setDepthWrite(!0),O=this.blendMode===bS.BLENDMODE_MULTIPLYADD?this._render(bS.BLENDMODE_MULTIPLY,m)+this._render(bS.BLENDMODE_ADD,m):this._render(this.blendMode,m),this._engine.setAlphaMode(0)),O}rebuild(){const m=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(m,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,m()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const S in this._drawWrappers){this._drawWrappers[S].dispose()}if(this._drawWrappers={},this._scene){const m=this._scene.UZ.indexOf(this);m>-1&&this._scene.UZ.splice(m,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let S=0;S<this._renderVertexBuffers.length;++S){const m=this._renderVertexBuffers[S];for(const S in m)m[S].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),m&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),m&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Jh.notifyObservers(this),this.Jh.clear()}clone(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l={...this._customWrappers};let M=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){M=this.customShader;const m=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"";l[0]=O.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,m,void 0,void 0,void 0,this)}const u=this.serialize(h),b=US.Parse(u,this._scene||this._engine,this._rootUrl);return b.name=m,b.customShader=M,b._customWrappers=l,void 0===S&&(S=this.uS),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.uS=S,b}serialize(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};return bS._Serialize(S,this,m),S.activeParticleCount=this.activeParticleCount,S.randomTextureSize=this._randomTextureSize,S.customShader=this.customShader,S}static Parse(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4?arguments[4]:void 0;const O=m.name;let u,b;S instanceof Fm.b?u=S:(b=S,u=b.getEngine());const q=new US(O,{KS:M||m.KS,randomTextureSize:m.randomTextureSize},S,null,m.isAnimationSheetEnabled);if(q._rootUrl=h,m.customShader&&u.createEffectForParticles){const S=m.customShader,h=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"",l=u.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,h,void 0,void 0,void 0,q);q.setCustomEffect(l,0),q.customShader=S}return m.id&&(q.id=m.id),m.activeParticleCount&&(q.activeParticleCount=m.activeParticleCount),bS._Parse(m,q,S,h),m.preventAutoStart&&(q.preventAutoStart=m.preventAutoStart),l||q.preventAutoStart||q.start(),q}}var HS=h(11156),RS=h(12721),yS=h(11674);class oS{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(m){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const S of this.systems)S.uS=m;this._emitterNode=m}setEmitterAsSphere(m,S,h){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:m,renderingGroupId:S};const l=(0,RS.c)("emitterSphere",{diameter:m.diameter,segments:m.segments},h);l.renderingGroupId=S;const M=new yS.HS("emitterSphereMaterial",h);M.emissiveColor=m.color,l.material=M;for(const O of this.systems)O.uS=l;this._emitterNode=l}start(m){for(const S of this.systems)m&&(S.uS=m),S.start()}dispose(){for(const m of this.systems)m.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={systems:[]};for(const h of this.systems)S.systems.push(h.serialize(m));return this._emitterNode&&(S.uS=this._emitterCreationOptions),S}static Parse(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;const M=new oS,O=this.BaseAssetsUrl+"/textures/";S=S||i.d.LastCreatedScene;for(const u of m.systems)M.systems.push(h?US.Parse(u,S,O,!0,l):bS.Parse(u,S,O,!0,l));if(m.uS){const h=m.uS.options;if("Sphere"===m.uS.kind)M.setEmitterAsSphere({diameter:h.diameter,segments:h.segments,color:u.RS.yS(h.color)},m.uS.renderingGroupId,S)}return M}}oS.BaseAssetsUrl="https://assets.babylonjs.com/particles";var sS=h(11191);class vS{static CreateDefault(m){let S,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,l=arguments.length>2?arguments[2]:void 0;S=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new US("default system",{KS:h},l):new bS("default system",h,l),S.uS=m;const M=HS.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return S.particleTexture=new P.e(M,S.sm()),S.createConeEmitter(.1,Math.PI/4),S.color1=new u.Bb(1,1,1,1),S.color2=new u.Bb(1,1,1,1),S.colorDead=new u.Bb(1,1,1,0),S.minSize=.1,S.maxSize=.1,S.minEmitPower=2,S.maxEmitPower=2,S.updateSpeed=1/60,S.emitRate=30,S}static CreateAsync(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;S||(S=i.d.LastCreatedScene);const M={};return S.addPendingData(M),new Promise(((O,u)=>{if(h&&!US.IsSupported)return S.removePendingData(M),u("Particle system with GPU is not supported.");HS.Tools.LoadFile(`${vS.BaseAssetsUrl}/systems/${m}.json`,(m=>{S.removePendingData(M);const u=JSON.parse(m.toString());return O(oS.Parse(u,S,h,l))}),void 0,void 0,void 0,(()=>(S.removePendingData(M),u(`An error occurred with the creation of your particle system. Check if your type '${m}' exists.`))))}))}static ExportSet(m){const S=new oS;for(const h of m)S.systems.push(h);return S}static ParseFromFileAsync(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",O=arguments.length>5?arguments[5]:void 0;return new Promise(((u,b)=>{const q=new sS.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const S=JSON.parse(q.responseText);let b;b=l?US.Parse(S,h,M,!1,O):bS.Parse(S,h,M,!1,O),m&&(b.name=m),u(b)}else b("Unable to load the particle system")})),q.open("GET",S),q.send()}))}static ParseFromSnippetAsync(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",M=arguments.length>4?arguments[4]:void 0;if("_BLANK"===m){const m=this.CreateDefault(null);return m.start(),Promise.resolve(m)}return new Promise(((O,u)=>{const b=new sS.b;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const u=JSON.parse(JSON.parse(b.responseText).jsonPayload),q=JSON.parse(u.particleSystem);let Y;Y=h?US.Parse(q,S,l,!1,M):bS.Parse(q,S,l,!1,M),Y.snippetId=m,O(Y)}else u("Unable to load the snippet "+m)})),b.open("GET",this.SnippetUrl+"/"+m.replace(/#/g,"/")),b.send()}))}}vS.BaseAssetsUrl=oS.BaseAssetsUrl,vS.SnippetUrl="https://snippet.babylonjs.com",vS.CreateFromSnippetAsync=vS.ParseFromSnippetAsync;var TS=h(11751),XS=h(11590),gS=h(12727);(0,gS.h)(XS.b.NAME_PARTICLESYSTEM,((m,S,h,l)=>{const M=(0,gS.j)(XS.b.NAME_PARTICLESYSTEM);if(M&&void 0!==m.UZ&&null!==m.UZ)for(let O=0,u=m.UZ.length;O<u;O++){const u=m.UZ[O];h.UZ.push(M(u,S,l))}})),(0,gS.e)(XS.b.NAME_PARTICLESYSTEM,((m,S,h)=>{if(m.activeParticleCount){return US.Parse(m,S,h)}return bS.Parse(m,S,h)})),Fm.b.prototype.createEffectForParticles=function(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",O=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,V=arguments.length>9?arguments[9]:void 0,I=[],Z=[];const C=[];return q?q.fillUniformsAttributesAndSamplerNames(Z,I,C):(I=bS._GetAttributeNamesOrOptions(),Z=bS._GetEffectCreationOptions()),-1===M.indexOf(" BILLBOARD")&&(M+="\n#define BILLBOARD\n"),null!==q&&void 0!==q&&q.isAnimationSheetEnabled&&-1===M.indexOf(" ANIMATESHEET")&&(M+="\n#define ANIMATESHEET\n"),-1===l.indexOf("diffuseSampler")&&l.push("diffuseSampler"),this.createEffect({vertex:V??(null===q||void 0===q?void 0:q.vertexShaderName)??"particles",fragmentElement:m},I,Z.concat(S),C.concat(l),M,O,u,b,void 0,Y,(async()=>{0===Y?await Promise.resolve().then(h.bind(h,12757)):await Promise.resolve().then(h.bind(h,12812))}))},TS.c.prototype.getEmittedParticleSystems=function(){const m=[];for(let S=0;S<this.sm().UZ.length;S++){const h=this.sm().UZ[S];h.uS===this&&m.push(h)}return m},TS.c.prototype.getHierarchyEmittedParticleSystems=function(){const m=[],S=this.getDescendants();S.push(this);for(let h=0;h<this.sm().UZ.length;h++){const l=this.sm().UZ[h],M=l.uS;M.position&&-1!==S.indexOf(M)&&m.push(l)}return m};h(11648),h(11653),h(11726);h(11734),h(12731),h(11532),h(11637),h(11773);h(11524);var GS;h(12735),h(11368);!function(m){m[m.Color=2]="Color",m[m.UV=1]="UV",m[m.Random=0]="Random",m[m.Stated=3]="Stated"}(GS||(GS={}));var eS=h(11556);const aS=new l.nS(0,0,0),xS=new l.nS(0,0,0),PS=new l.nS(0,0,0);class dS{constructor(m,S,h){this.width=m,this.height=S,this.data=h}processFlowable(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;if(!h)return;h instanceof l.Matrix?l.nS.TransformCoordinatesToRef(m.position,h,PS):(PS.x=h.x,PS.y=h.y,PS.z=h.z);const M=.5*PS.x+.5,O=1-(.5*PS.y+.5),u=Math.floor(M*this.width),b=Math.floor(O*this.height);if(u<0||u>=this.width||b<0||b>=this.height)return;const q=4*(b*this.width+u),Y=this.data[q]/255*2-1,V=this.data[q+1]/255*2-1,I=this.data[q+2]/255*2-1,Z=this.data[q+3]/255;aS.set(Y,V,I),aS.scaleToRef(S*Z,xS),m.direction.addInPlace(xS)}_processParticle(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;this.processFlowable(m,S,h)}static async FromUrlAsync(m){return await new Promise(((S,h)=>{const l=document.createElement("canvas"),M=l.getContext("2d");let O=null;const u=new Image;u.crossOrigin="anonymous",u.src=m,u.onerror=S=>{h(new Error(`Failed to load image: ${m} : ${S}`))},u.onload=()=>{l.width=u.width,l.height=u.height,M.drawImage(u,0,0),O=M.getImageData(0,0,l.width,l.height),S(new dS(l.width,l.height,O.data))}}))}static async ExtractFromTextureAsync(m){return await new Promise(((S,h)=>{if(!m.isReady())return void m.onLoadObservable.addOnce((async()=>{try{const h=await this.ExtractFromTextureAsync(m);S(h)}catch(l){h(l)}}));const l=m.getSize();eS.l.GetTextureDataAsync(m,l.width,l.height).then((m=>{S(new dS(l.width,l.height,new Uint8ClampedArray(m)))})).catch(h)}))}}var JS,NS,jS,KS,cS,fS,pS,kS,rS;!function(m){m[m.Int=1]="Int",m[m.Float=2]="Float",m[m.Vector2=4]="Vector2",m[m.nS=8]="nS",m[m.Matrix=16]="Matrix",m[m.Particle=32]="Particle",m[m.Texture=64]="Texture",m[m.Bb=128]="Bb",m[m.FloatGradient=256]="FloatGradient",m[m.Vector2Gradient=512]="Vector2Gradient",m[m.Vector3Gradient=1024]="Vector3Gradient",m[m.Color4Gradient=2048]="Color4Gradient",m[m.System=4096]="System",m[m.AutoDetect=8192]="AutoDetect",m[m.BasedOnInput=16384]="BasedOnInput",m[m.Undefined=32768]="Undefined",m[m.All=65535]="All"}(JS||(JS={})),function(m){m[m.Compatible=0]="Compatible",m[m.TypeIncompatible=1]="TypeIncompatible",m[m.HierarchyIssue=2]="HierarchyIssue"}(NS||(NS={})),function(m){m[m.Input=0]="Input",m[m.Output=1]="Output"}(jS||(jS={}));class zS{get direction(){return this._direction}get type(){if(this._type===JS.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===JS.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(m){this._type=m}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((m=>m.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(m,S,h){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=JS.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new t.e,this.onDisconnectionObservable=new t.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=S,this.name=m,this._direction=h}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(m){var S;return this.isConnected?null!==(S=this._connectedPoint)&&void 0!==S&&S._storedFunction?this._connectedPoint._storedFunction(m):this._connectedPoint._storedValue:this.value}canConnectTo(m){return 0===this.checkCompatibilityState(m)}checkCompatibilityState(m){const S=this._ownerBlock,h=m.ownerBlock;if(this.type!==m.type&&m.innerType!==JS.AutoDetect)return m.acceptedConnectionPointTypes&&-1!==m.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(m.excludedConnectionPointTypes&&-1!==m.excludedConnectionPointTypes.indexOf(this.type))return 1;let l=h,M=S;return 0===this.direction&&(l=S,M=h),l.isAnAncestorOf(M)?2:0}connectTo(m){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(m))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${m.ownerBlock.name}".${m.name}`;return this._endpoints.push(m),m._connectedPoint=this,this.onConnectionObservable.notifyObservers(m),m.onConnectionObservable.notifyObservers(this),this}disconnectFrom(m){const S=this._endpoints.indexOf(m);return-1===S||(this._endpoints.splice(S,1),m._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(m),m.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(m){let S=1;for(;S<JS.All;)m&S||this.excludedConnectionPointTypes.push(S),S<<=1}serialize(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const S={};return S.name=this.name,S.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.DM?(S.valueType="BABYLON."+this.value.getClassName(),S.value=this.value.DM()):(S.valueType="number",S.value=this.value)),m&&this.connectedPoint&&(S.inputName=this.name,S.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,S.targetConnectionName=this.connectedPoint.name,S.isExposedOnFrame=!0,S.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(S.isExposedOnFrame=!0,S.exposedPortPosition=this.exposedPortPosition),S}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class QS{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(m){this._name=m}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(m){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new t.e,this.Jh=new t.e,this.onInputChangedObservable=new t.e,this.visibleOnFrame=!1,this._name=m,this.uniqueId=d.e.UniqueId}_inputRename(m){return m}_outputRename(m){return m}isAnAncestorOf(m){for(const S of this._outputs)if(S.hasEndpoints)for(const h of S.endpoints){if(h.ownerBlock===m)return!0;if(h.ownerBlock.isAnAncestorOf(m))return!0}return!1}isAnAncestorOfType(m){if(this.getClassName()===m)return!0;for(const S of this._outputs)if(S.hasEndpoints)for(const h of S.endpoints)if(h.ownerBlock.isAnAncestorOfType(m))return!0;return!1}getInputByName(m){const S=this._inputs.filter((S=>S.name===m));return S.length?S[0]:null}_linkConnectionTypes(m,S){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[S]._acceptedConnectionPointType=this._inputs[m]:(this._inputs[m]._linkedConnectionSource=this._inputs[S],this._inputs[m]._isMainLinkSource=!0),this._inputs[S]._linkedConnectionSource=this._inputs[m]}registerInput(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0,M=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0;const u=new zS(m,this,0);return u.type=S,u.isOptional=h,u.defaultValue=l,u.value=l,u.valueMin=M,u.valueMax=O,this._inputs.push(u),this.onInputChangedObservable.notifyObservers(u),this}registerOutput(m,S,h){return(h=h??new zS(m,this,1)).type=S,this._outputs.push(h),this}_build(m){}_customBuildStep(m){}build(m){if(this._buildId===m.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((m=>m.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=m.buildId;for(const S of this._inputs){if(!S.connectedPoint){S.isOptional||m.notConnectedNonOptionalInputs.push(S);continue}const h=S.connectedPoint.ownerBlock;h&&h!==this&&!h.isSystem&&h.build(m)}return this._customBuildStep(m),m.verbose&&J.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(m),this.onBuildObservable.notifyObservers(this),!1}serialize(){const m={};m.customType="BABYLON."+this.getClassName(),m.id=this.uniqueId,m.name=this.name,m.visibleOnFrame=this.visibleOnFrame,m.inputs=[],m.outputs=[];for(const S of this.inputs)m.inputs.push(S.serialize());for(const S of this.outputs)m.outputs.push(S.serialize(!1));return m}_deserialize(m){this._name=m.name,this.comments=m.comments,this.visibleOnFrame=!!m.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(m)}_deserializePortDisplayNamesAndExposedOnFrame(m){const S=m.inputs,h=m.outputs;if(S)for(const l of S){const m=this.inputs.find((m=>m.name===l.name));if(!m)return;if(l.displayName&&(m.displayName=l.displayName),l.isExposedOnFrame&&(m.isExposedOnFrame=l.isExposedOnFrame,m.exposedPortPosition=l.exposedPortPosition),void 0!==l.value&&null!==l.value)if("number"===l.valueType)m.value=l.value;else{const S=(0,b.d)(l.valueType);S&&(m.value=S.yS(l.value))}}if(h)for(let l=0;l<h.length;l++){const m=h[l];m.displayName&&(this.outputs[l].displayName=m.displayName),m.isExposedOnFrame&&(this.outputs[l].isExposedOnFrame=m.isExposedOnFrame,this.outputs[l].exposedPortPosition=m.exposedPortPosition)}}clone(){const m=this.serialize(),S=(0,b.d)(m.customType);if(S){const h=new S;return h._deserialize(m),h}return null}dispose(){this.Jh.notifyObservers(this),this.Jh.clear();for(const m of this.inputs)m.dispose();for(const m of this.outputs)m.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function FS(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",l=arguments.length>3?arguments[3]:void 0;return(M,O)=>{let u=M._propStore;u||(u=[],M._propStore=u),u.push({propertyName:O,displayName:m,type:S,groupName:h,options:l??{},className:M.getClassName()})}}(0,e.d)([(0,a.F)("comment")],QS.prototype,"comments",void 0),function(m){m[m.Boolean=0]="Boolean",m[m.Float=1]="Float",m[m.Int=2]="Int",m[m.Vector2=3]="Vector2",m[m.List=4]="List",m[m.Bb=5]="Bb",m[m.SamplingMode=6]="SamplingMode",m[m.TextureFormat=7]="TextureFormat",m[m.TextureType=8]="TextureType"}(KS||(KS={})),function(m){m[m.None=0]="None",m[m.Position=1]="Position",m[m.Direction=2]="Direction",m[m.Age=3]="Age",m[m.Lifetime=4]="Lifetime",m[m.Color=5]="Color",m[m.ScaledDirection=6]="ScaledDirection",m[m.Scale=7]="Scale",m[m.AgeGradient=8]="AgeGradient",m[m.Angle=9]="Angle",m[m.SpriteCellIndex=16]="SpriteCellIndex",m[m.SpriteCellStart=17]="SpriteCellStart",m[m.SpriteCellEnd=18]="SpriteCellEnd"}(cS||(cS={})),function(m){m[m.None=0]="None",m[m.Time=1]="Time",m[m.Delta=2]="Delta",m[m.Emitter=3]="Emitter"}(fS||(fS={}));class wS{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let m="";for(const S of this.notConnectedNonOptionalInputs)m+=`input ${S.name} from block ${S.ownerBlock.name}[${S.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(m)throw"Build of Node Particle System Set failed:\n"+m}adapt(m,S){const h=m.getConnectedValue(this)||0;if(m.type===S)return h;switch(S){case JS.Vector2:return new l.Vector2(h,h);case JS.nS:return new l.nS(h,h,h);case JS.Bb:return new u.Bb(h,h,h,h)}return null}getContextualValue(m){if(!this.particleContext||!this.systemContext)return null;switch(m){case cS.Position:return this.particleContext.position;case cS.Direction:return this.particleContext.direction;case cS.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case cS.Color:return this.particleContext.color;case cS.Age:return this.particleContext.age;case cS.Lifetime:return this.particleContext.lifeTime;case cS.Angle:return this.particleContext.angle;case cS.Scale:return this.particleContext.scale;case cS.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case cS.SpriteCellEnd:return this.systemContext.endSpriteCellID;case cS.SpriteCellIndex:return this.particleContext.cellIndex;case cS.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.uS.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.uS.absolutePosition:this.systemContext.uS:null}getSystemValue(m){if(!this.particleContext||!this.systemContext)return null;switch(m){case fS.Time:return this.systemContext._actualFrame;case fS.Delta:return this.systemContext._scaledUpdateSpeed;case fS.Emitter:if(this.isEmitterTransformNode){return this.systemContext.uS.absolutePosition}return this.systemContext.uS}return null}}function tS(m,S,h){const l=new wS;l.US=S;const M=m.createSystem(l);return M.canStart=()=>!0,M.uS=h.clone(),M.disposeOnStop=!0,M.start(),M}class AS extends QS{constructor(m){super(m),this.blendMode=q.BLENDMODE_ONEONE,this.KS=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",JS.Particle),this.registerInput("texture",JS.Texture),this.registerInput("onStart",JS.System,!0),this.registerInput("onEnd",JS.System,!0),this.registerOutput("system",JS.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(m){m.KS=this.KS,m.buildId=this._buildId++,this.build(m);const S=this.particle.getConnectedValue(m);return S.particleTexture=this.texture.getConnectedValue(m),S.emitRate=this.emitRate,S.blendMode=this.blendMode,S.name=this.name,S._nodeGenerated=!0,S._targetStopDuration=this.targetStopDuration,S.startDelay=this.startDelay,this.system._storedValue=this,S.canStart=()=>!this.doNoStart,S.onStartedObservable.add((h=>{const l=this.onStart.getConnectedValue(m);l&&h.onStartedObservable.addOnce((()=>{m.systemContext=S;const h=tS(l,m.US,m.emitterPosition);this.Jh.addOnce((()=>{h.dispose()}))}));const M=this.onEnd.getConnectedValue(m);M&&h.onStoppedObservable.addOnce((()=>{m.systemContext=S;const h=tS(M,m.US,m.emitterPosition);this.Jh.addOnce((()=>{h.dispose()}))}))})),this.Jh.addOnce((()=>{S.dispose()})),S}serialize(){const m=super.serialize();return m.KS=this.KS,m.emitRate=this.emitRate,m.blendMode=this.blendMode,m.doNoStart=this.doNoStart,m.targetStopDuration=this.targetStopDuration,m.startDelay=this.startDelay,m}_deserialize(m){super._deserialize(m),this.KS=m.KS,this.emitRate=m.emitRate,this.doNoStart=!!m.doNoStart,void 0!==m.blendMode&&(this.blendMode=m.blendMode),void 0!==m.targetStopDuration&&(this.targetStopDuration=m.targetStopDuration),void 0!==m.startDelay&&(this.startDelay=m.startDelay)}}(0,e.d)([FS("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:q.BLENDMODE_ONEONE},{label:"Standard",value:q.BLENDMODE_STANDARD},{label:"Add",value:q.BLENDMODE_ADD},{label:"Multiply",value:q.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:q.BLENDMODE_MULTIPLYADD}]})],AS.prototype,"blendMode",void 0),(0,e.d)([FS("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],AS.prototype,"KS",void 0),(0,e.d)([FS("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AS.prototype,"emitRate",void 0),(0,e.d)([FS("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AS.prototype,"targetStopDuration",void 0),(0,e.d)([FS("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AS.prototype,"startDelay",void 0),(0,e.d)([FS("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],AS.prototype,"doNoStart",void 0),(0,b.e)("BABYLON.SystemBlock",AS);class iS extends QS{get type(){if(this._type===JS.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=JS.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=JS.Vector2,this._type;case"nS":return this._type=JS.nS,this._type;case"Bb":return this._type=JS.Bb,this._type;case"Matrix":return this._type=JS.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===cS.None&&this._systemSource!==fS.None}get systemSource(){return this._systemSource}set systemSource(m){if(this._systemSource=m,m!==fS.None){switch(this._contextualSource=cS.None,this._type=JS.Float,m){case fS.Time:case fS.Delta:this._type=JS.Float;break;case fS.Emitter:this._type=JS.nS}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==cS.None}get contextualValue(){return this._contextualSource}set contextualValue(m){if(this._contextualSource=m,m!==cS.None){switch(this._systemSource=fS.None,m){case cS.Scale:this._type=JS.Vector2;break;case cS.Position:case cS.Direction:case cS.ScaledDirection:this._type=JS.nS;break;case cS.Color:this._type=JS.Bb;break;case cS.Age:case cS.Lifetime:case cS.Angle:case cS.AgeGradient:this._type=JS.Float;break;case cS.SpriteCellEnd:case cS.SpriteCellStart:case cS.SpriteCellIndex:this._type=JS.Int}this.output&&(this.output.type=this._type)}}constructor(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JS.AutoDetect;super(m),this._type=JS.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new t.e,this._systemSource=fS.None,this._contextualSource=cS.None,this._type=S,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",S)}get value(){return this._storedValue}set value(m){this.type===JS.Float&&this.min!==this.max&&(m=Math.max(this.min,m),m=Math.min(this.max,m)),this._storedValue=m,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(m){this._valueCallback=m}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case JS.Int:case JS.Float:this.value=0;break;case JS.Vector2:this.value=l.Vector2.Zero();break;case JS.nS:this.value=l.nS.Zero();break;case JS.Bb:this.value=new u.Bb(1,1,1,1);break;case JS.Matrix:this.value=l.Matrix.Identity()}}_build(m){super._build(m),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=m=>m.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=m=>m.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const m=super.serialize();return m.type=this.type,m.contextualValue=this.contextualValue,m.systemSource=this.systemSource,m.min=this.min,m.max=this.max,m.groupInInspector=this.groupInInspector,m.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.DM?(m.valueType="BABYLON."+this._storedValue.getClassName(),m.value=this._storedValue.DM()):(m.valueType="number",m.value=this._storedValue)),m}_deserialize(m){if(super._deserialize(m),this._type=m.type,this.contextualValue=m.contextualValue,this.systemSource=m.systemSource||fS.None,this.min=m.min||0,this.max=m.max||0,this.groupInInspector=m.groupInInspector||"",void 0!==m.displayInInspector&&(this.displayInInspector=m.displayInInspector),m.valueType)if("number"===m.valueType)this._storedValue=m.value;else{const S=(0,b.d)(m.valueType);S&&(this._storedValue=S.yS(m.value))}}}(0,b.e)("BABYLON.ParticleInputBlock",iS);class WS extends QS{get url(){return this._url}set url(m){this._url!==m&&(this._cachedData=null,this._url=m,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(m){this._textureDataUrl!==m&&(this._cachedData=null,this._textureDataUrl=m,this._url="",this._sourceTexture=null)}set sourceTexture(m){this._sourceTexture!==m&&(this._cachedData=null,this._sourceTexture=m,this._url="",this._textureDataUrl="")}constructor(m){super(m),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",JS.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const m=this.texture._storedValue;return await new Promise(((S,h)=>{if(!m.isReady())return void m.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),S(this._cachedData)}catch(m){h(m)}}));const l=m.getSize();eS.l.GetTextureDataAsync(m,l.width,l.height).then((h=>{this._cachedData={width:l.width,height:l.height,data:new Uint8ClampedArray(h)},m.dispose(),S(this._cachedData)})).catch(h)}))}_build(m){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new P.e(this._textureDataUrl,m.US):this.texture._storedValue=new P.e(this._url,m.US):this.texture._storedValue=null}serialize(){const m=super.serialize();return m.url=this.url,m.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(m.textureDataUrl=this.textureDataUrl),m}_deserialize(m){super._deserialize(m),this.url=m.url,this.serializedCachedData=!!m.serializedCachedData,m.textureDataUrl&&(this.textureDataUrl=m.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,b.e)("BABYLON.ParticleTextureSourceBlock",WS);class mh extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("position",JS.nS),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(m){const S=this.particle.getConnectedValue(m);if(this.output._storedValue=S,!this.position.isConnected)return;const h={process:h=>{m.particleContext=h,m.systemContext=S,h.position.l(this.position.getConnectedValue(m))},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h}}(0,b.e)("BABYLON.UpdatePositionBlock",mh),function(m){m[m.Add=0]="Add",m[m.Subtract=1]="Subtract",m[m.Multiply=2]="Multiply",m[m.Divide=3]="Divide",m[m.Max=4]="Max",m[m.Min=5]="Min"}(pS||(pS={}));class Sh extends QS{constructor(m){super(m),this.operation=pS.Add,this.registerInput("left",JS.AutoDetect),this.registerInput("right",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this.output._typeConnectionSource=this.left;const S=[JS.Matrix,JS.Particle,JS.Texture,JS.System,JS.FloatGradient,JS.Color4Gradient,JS.Vector2Gradient,JS.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...S),this.right.excludedConnectionPointTypes.push(...S),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(m){let S;const h=this.left,M=this.right;if(!h.isConnected||!M.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const O=h.type===JS.Float||h.type===JS.Int,b=M.type===JS.Float||M.type===JS.Int,q=O&&b;switch(this.operation){case pS.Add:S=q?m=>h.getConnectedValue(m)+M.getConnectedValue(m):O?m=>m.adapt(h,M.type).add(M.getConnectedValue(m)):m=>h.getConnectedValue(m).add(m.adapt(M,h.type));break;case pS.Subtract:S=q?m=>h.getConnectedValue(m)-M.getConnectedValue(m):O?m=>m.adapt(h,M.type).LS(M.getConnectedValue(m)):m=>h.getConnectedValue(m).LS(m.adapt(M,h.type));break;case pS.Multiply:S=q?m=>h.getConnectedValue(m)*M.getConnectedValue(m):O?m=>m.adapt(h,M.type).multiply(M.getConnectedValue(m)):m=>h.getConnectedValue(m).multiply(m.adapt(M,h.type));break;case pS.Divide:S=q?m=>h.getConnectedValue(m)/M.getConnectedValue(m):O?m=>m.adapt(h,M.type).divide(M.getConnectedValue(m)):m=>h.getConnectedValue(m).divide(m.adapt(M,h.type));break;case pS.Min:if(q)S=m=>Math.min(h.getConnectedValue(m),M.getConnectedValue(m));else{const[m,b]=O?[M,h]:[h,M];switch(m.type){case JS.Vector2:S=S=>l.Vector2.Minimize(m.getConnectedValue(S),S.adapt(b,m.type));break;case JS.nS:S=S=>l.nS.Minimize(m.getConnectedValue(S),S.adapt(b,m.type));break;case JS.Bb:S=S=>{const h=m.getConnectedValue(S),{r:l,g:M,b:O,a:q}=S.adapt(b,m.type);return new u.Bb(Math.min(h.r,l),Math.min(h.g,M),Math.min(h.b,O),Math.min(h.a,q))}}}break;case pS.Max:if(!q){const[m,b]=O?[M,h]:[h,M];switch(m.type){case JS.Vector2:S=S=>l.Vector2.Maximize(m.getConnectedValue(S),S.adapt(b,m.type));break;case JS.nS:S=S=>l.nS.Maximize(m.getConnectedValue(S),S.adapt(b,m.type));break;case JS.Bb:S=S=>{const h=m.getConnectedValue(S),{r:l,g:M,b:O,a:q}=S.adapt(b,m.type);return new u.Bb(Math.max(h.r,l),Math.min(h.g,M),Math.min(h.b,O),Math.min(h.a,q))}}break}S=m=>Math.max(h.getConnectedValue(m),M.getConnectedValue(m))}this.output._storedFunction=m=>h.type===JS.Int?0|S(m):S(m)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===JS.Int||this.left.type===JS.Float&&this.right.type!==JS.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[m,S]of[[this.left,this.right],[this.right,this.left]])m.acceptedConnectionPointTypes=[JS.Int,JS.Float],S.isConnected&&(m.acceptedConnectionPointTypes.push(S.type),S.type!==JS.Int&&S.type!==JS.Float||m.acceptedConnectionPointTypes.push(JS.Vector2,JS.nS,JS.Bb))}dispose(){super.dispose();for(const m of this._connectionObservers)m.remove();this._connectionObservers.length=0}serialize(){const m=super.serialize();return m.operation=this.operation,m}_deserialize(m){super._deserialize(m),this.operation=m.operation}}(0,e.d)([FS("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:pS.Add},{label:"Subtract",value:pS.Subtract},{label:"Multiply",value:pS.Multiply},{label:"Divide",value:pS.Divide},{label:"Max",value:pS.Max},{label:"Min",value:pS.Min}]})],Sh.prototype,"operation",void 0),(0,b.e)("BABYLON.ParticleMathBlock",Sh);class hh extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("direction1",JS.nS,!0,new l.nS(0,1,0)),this.registerInput("direction2",JS.nS,!0,new l.nS(0,1,0)),this.registerInput("minEmitBox",JS.nS,!0,new l.nS(-.5,-.5,-.5)),this.registerInput("maxEmitBox",JS.nS,!0,new l.nS(.5,.5,.5)),this.registerOutput("output",JS.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(m){const S=this.particle.getConnectedValue(m);S._directionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.direction1.getConnectedValue(m),O=this.direction2.getConnectedValue(m),u=(0,Y.RandomRange)(M.x,O.x),b=(0,Y.RandomRange)(M.y,O.y),q=(0,Y.RandomRange)(M.z,O.z);m.isEmitterTransformNode?l.nS.TransformNormalFromFloatsToRef(u,b,q,m.emitterWorldMatrix,h.direction):h.direction.Yb(u,b,q)},S._positionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.minEmitBox.getConnectedValue(m),O=this.maxEmitBox.getConnectedValue(m),u=(0,Y.RandomRange)(M.x,O.x),b=(0,Y.RandomRange)(M.y,O.y),q=(0,Y.RandomRange)(M.z,O.z);m.isEmitterTransformNode?l.nS.TransformCoordinatesFromFloatsToRef(u,b,q,m.emitterWorldMatrix,h.position):(h.position.Yb(u,b,q),h.position.addInPlace(m.emitterPosition))},this.output._storedValue=S}}(0,b.e)("BABYLON.BoxShapeBlock",hh);class lh extends QS{constructor(m){super(m),this.registerInput("emitPower",JS.Float,!0,1),this.registerInput("lifeTime",JS.Float,!0,1),this.registerInput("color",JS.Bb,!0,new u.Bb(1,1,1,1)),this.registerInput("scale",JS.Vector2,!0,new l.Vector2(1,1)),this.registerInput("angle",JS.Float,!0,0),this.registerOutput("particle",JS.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(m){const S=new bS(this.name,m.KS,m.US,null,!1,void 0,!0);S.particleEmitterType=new n,S._lifeTimeCreation.process=(S,h)=>{m.particleContext=S,S.lifeTime=this.lifeTime.getConnectedValue(m),h._emitPower=this.emitPower.getConnectedValue(m)},S._colorCreation.process=S=>{m.particleContext=S,S.color.l(this.color.getConnectedValue(m))},S._sizeCreation.process=S=>{m.particleContext=S,S.size=1,S.scale.l(this.scale.getConnectedValue(m))},S._angleCreation.process=S=>{m.particleContext=S,S.angle=this.angle.getConnectedValue(m)},this.particle._storedValue=S}}(0,b.e)("BABYLON.CreateParticleBlock",lh);class Mh{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const m=[];for(const S of this.attachedBlocks)S.isInput&&m.push(S);return m}constructor(m){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new t.e,this.name=m}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(m)&&this.attachedBlocks.push(m);for(const h of m.inputs){const l=h.connectedPoint;if(l){const h=l.ownerBlock;h!==m&&this._initializeBlock(h,S)}}}async buildAsync(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((h=>{const l=new oS;for(const m of this._systemBlocks)this._initializeBlock(m);for(const M of this.systemBlocks){const h=new wS;h.buildId=this._buildId++,h.US=m,h.verbose=S;const O=M.createSystem(h);h.emitErrors(),l.systems.push(O)}this.onBuildObservable.notifyObservers(this),h(l)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const m=new AS("Particle system"),S=new mh("Update position");S.output.connectTo(m.particle);const h=new iS("Position");h.contextualValue=cS.Position;const l=new iS("Scaled direction");l.contextualValue=cS.ScaledDirection;const M=new Sh("Add");M.operation=pS.Add,h.output.connectTo(M.left),l.output.connectTo(M.right),M.output.connectTo(S.position);const O=new lh("Create particle"),u=new hh("Box shape");O.particle.connectTo(u.particle),u.output.connectTo(S.particle);const b=new WS("Texture");b.texture.connectTo(m.texture),b.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(m)}removeBlock(m){const S=this.attachedBlocks.indexOf(m);if(S>-1&&this.attachedBlocks.splice(S,1),m.isSystem){const S=this._systemBlocks.indexOf(m);S>-1&&this._systemBlocks.splice(S,1)}}parseSerializedObject(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S||this.clear();const h={};for(const l of m.jV){const m=(0,b.d)(l.customType);if(m){const S=new m;S._deserialize(l),h[l.id]=S,this.attachedBlocks.push(S),S.isSystem&&this._systemBlocks.push(S)}}for(const l of this.attachedBlocks)if(l.isTeleportOut){const m=l,S=m._tempEntryPointUniqueId;if(S){const l=h[S];l&&l.attachToEndpoint(m)}}for(let l=0;l<m.jV.length;l++){const M=m.jV[l],O=h[M.id];O&&(O.inputs.length&&M.inputs.some((m=>m.targetConnectionName))&&!S||this._restoreConnections(O,m,h))}if(m.locations||m.editorData&&m.editorData.locations){const l=m.locations||m.editorData.locations;for(const m of l)h[m.LM]&&(m.LM=h[m.LM].uniqueId);S&&this.editorData&&this.editorData.locations&&l.concat(this.editorData.locations),m.locations?this.editorData={locations:l}:(this.editorData=m.editorData,this.editorData.locations=l);const M=[];for(const m in h)M[m]=h[m].uniqueId;this.editorData.map=M}this.comment=m.comment}_restoreConnections(m,S,h){for(const l of m.outputs)for(const M of S.jV){const O=h[M.id];if(O)for(const u of M.inputs)if(h[u.targetBlockId]!==m||u.targetConnectionName!==l.name);else{const m=O.getInputByName(u.inputName);if(!m||m.isConnected)continue;l.connectTo(m,!0),this._restoreConnections(O,S,h)}}}serialize(m){const S=m?{}:x.e.Serialize(this);S.editorData=JSON.parse(JSON.stringify(this.editorData));let h=[];m?h=m:S.customType="BABYLON.NodeParticleSystemSet",S.jV=[];for(const l of h)S.jV.push(l.serialize());if(!m)for(const l of this.attachedBlocks)-1===h.indexOf(l)&&S.jV.push(l.serialize());return S}dispose(){for(const m of this.attachedBlocks)m.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(m){const S=new Mh(m);return S.setToDefault(),S}static Parse(m){const S=x.e.Parse((()=>new Mh(m.name)),m,null);return S.parseSerializedObject(m),S}static ParseFromSnippetAsync(m,S){return"_BLANK"===m?Promise.resolve(Mh.CreateDefault("blank")):new Promise(((h,l)=>{const M=new sS.b;M.addEventListener("readystatechange",(()=>{if(4==M.readyState)if(200==M.status){const u=JSON.parse(JSON.parse(M.responseText).jsonPayload),b=JSON.parse(u.nodeParticle);S||(S=x.e.Parse((()=>new Mh(m)),b,null)),S.parseSerializedObject(b),S.snippetId=m;try{h(S)}catch(O){l(O)}}else l("Unable to load the snippet "+m)})),M.open("GET",this.SnippetUrl+"/"+m.replace(/#/g,"/")),M.send()}))}}Mh.EditorURL=`${HS.Tools._DefaultCdnUrl}/v${Fm.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Mh.SnippetUrl="https://snippet.babylonjs.com",(0,e.d)([(0,a.F)()],Mh.prototype,"name",void 0),(0,e.d)([(0,a.F)("comment")],Mh.prototype,"comment",void 0),function(m){m[m.None=0]="None",m[m.PerParticle=1]="PerParticle",m[m.PerSystem=2]="PerSystem"}(kS||(kS={}));class Oh extends QS{constructor(m){super(m),this._currentLockId=-2,this.lockMode=kS.PerParticle,this.registerInput("min",JS.AutoDetect,!0,0),this.registerInput("max",JS.AutoDetect,!0,1),this.registerOutput("output",JS.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(JS.Float|JS.Int|JS.Vector2|JS.nS|JS.Bb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(JS.Float|JS.Int|JS.Vector2|JS.nS|JS.Bb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=JS.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let m=null;switch(this._currentLockId=-2,this.min.type){case JS.AutoDetect:case JS.Int:case JS.Float:m=m=>{const S=this.min.getConnectedValue(m)||0,h=this.max.getConnectedValue(m)||1;return S+Math.random()*(h-S)};break;case JS.Vector2:m=m=>{const S=this.min.getConnectedValue(m)||l.Vector2.Zero(),h=this.max.getConnectedValue(m)||l.Vector2.One();return new l.Vector2(S.x+Math.random()*(h.x-S.x),S.y+Math.random()*(h.y-S.y))};break;case JS.nS:m=m=>{const S=this.min.getConnectedValue(m)||l.nS.Zero(),h=this.max.getConnectedValue(m)||l.nS.One();return new l.nS(S.x+Math.random()*(h.x-S.x),S.y+Math.random()*(h.y-S.y),S.z+Math.random()*(h.z-S.z))};break;case JS.Bb:m=m=>{const S=this.min.getConnectedValue(m)||new u.Bb(0,0,0,0),h=this.max.getConnectedValue(m)||new u.Bb(1,1,1,1);return new u.Bb(S.x+Math.random()*(h.x-S.x),S.y+Math.random()*(h.y-S.y),S.z+Math.random()*(h.z-S.z),S.w+Math.random()*(h.w-S.w))}}this.output._storedFunction=S=>{var h;let l=0;switch(this.lockMode){case kS.PerParticle:l=(null===(h=S.particleContext)||void 0===h?void 0:h.id)||-1;break;case kS.PerSystem:l=S.buildId||0}return this._currentLockId!==l&&(this.lockMode!==kS.None&&(this._currentLockId=l),this.output._storedValue=m(S)),this.output._storedValue}}serialize(){const m=super.serialize();return m.lockMode=this.lockMode,m}_deserialize(m){super._deserialize(m),this.lockMode=m.lockMode}}(0,e.d)([FS("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:kS.None},{label:"Per particle",value:kS.PerParticle},{label:"Per system",value:kS.PerSystem}]})],Oh.prototype,"lockMode",void 0),(0,b.e)("BABYLON.ParticleRandomBlock",Oh);class uh extends QS{constructor(m){super(m),this._currentLockId=-2,this.lockMode=kS.PerParticle,this.registerInput("min",JS.AutoDetect),this.registerInput("max",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const S=[JS.Matrix,JS.Particle,JS.Texture,JS.System,JS.FloatGradient,JS.Color4Gradient,JS.Vector2Gradient,JS.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...S),this.max.excludedConnectionPointTypes.push(...S)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let m=null;switch(this._currentLockId=-2,this.min.type){case JS.Float:case JS.Int:m=m=>{const S=this.min.getConnectedValue(m),h=this.max.getConnectedValue(m);return Math.random()*(h-S)+S};break;case JS.Vector2:m=m=>{const S=this.min.getConnectedValue(m),h=this.max.getConnectedValue(m);return new l.Vector2(Math.random()*(h.x-S.x)+S.x,Math.random()*(h.y-S.y)+S.y)};break;case JS.nS:m=m=>{const S=this.min.getConnectedValue(m),h=this.max.getConnectedValue(m);return new l.nS(Math.random()*(h.x-S.x)+S.x,Math.random()*(h.y-S.y)+S.y,Math.random()*(h.z-S.z)+S.z)};break;case JS.Bb:m=m=>{const S=this.min.getConnectedValue(m),h=this.max.getConnectedValue(m);return new u.Bb(Math.random()*(h.r-S.r)+S.r,Math.random()*(h.g-S.g)+S.g,Math.random()*(h.b-S.b)+S.b,Math.random()*(h.a-S.a)+S.a)}}this.output._storedFunction=S=>{var h;let l=0;switch(this.lockMode){case kS.PerParticle:l=(null===(h=S.particleContext)||void 0===h?void 0:h.id)||-1;break;case kS.PerSystem:l=S.buildId||0}return this._currentLockId!==l&&(this.lockMode!==kS.None&&(this._currentLockId=l),this.output._storedValue=m(S)),this.output._storedValue}}serialize(){const m=super.serialize();return m.lockMode=this.lockMode,m}_deserialize(m){super._deserialize(m),void 0!==m.lockMode&&(this.lockMode=m.lockMode)}}(0,e.d)([FS("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:kS.None},{label:"Per particle",value:kS.PerParticle},{label:"Per system",value:kS.PerSystem}]})],uh.prototype,"lockMode",void 0),(0,b.e)("BABYLON.RandomRangeBlock",uh);(0,b.e)("BABYLON.ParticleLerpBlock",class extends QS{constructor(m){super(m),this.registerInput("left",JS.AutoDetect),this.registerInput("right",JS.AutoDetect),this.registerInput("gradient",JS.Float,!0,0,0,1),this.registerOutput("output",JS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(JS.Float|JS.Int|JS.Vector2|JS.nS|JS.Bb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const m=(m,S,h)=>(1-m)*S+m*h;this.output._storedFunction=S=>{const h=this.left.getConnectedValue(S),M=this.right.getConnectedValue(S),O=this.gradient.getConnectedValue(S);switch(this.left.type){case JS.Int:case JS.Float:return m(O,h,M);case JS.Vector2:return new l.Vector2(m(O,h.x,M.x),m(O,h.y,M.y));case JS.nS:return new l.nS(m(O,h.x,M.x),m(O,h.y,M.y),m(O,h.z,M.z));case JS.Bb:return new u.Bb(m(O,h.r,M.r),m(O,h.g,M.g),m(O,h.b,M.b),m(O,h.a,M.a))}return 0}}});(0,b.e)("BABYLON.UpdateDirectionBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("direction",JS.nS),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(m){const S=this.particle.getConnectedValue(m);if(this.output._storedValue=S,!this.direction.isConnected)return;const h={process:h=>{m.particleContext=h,m.systemContext=S,h.direction.l(this.direction.getConnectedValue(m))},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h}});(0,b.e)("BABYLON.UpdateColorBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("color",JS.Bb),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(m){const S=this.particle.getConnectedValue(m);if(this.output._storedValue=S,!this.color.isConnected)return;const h={process:h=>{m.particleContext=h,m.systemContext=S,h.color.l(this.color.getConnectedValue(m))},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h}});(0,b.e)("BABYLON.UpdateScaleBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("scale",JS.Vector2),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(m){const S=this.particle.getConnectedValue(m);if(this.output._storedValue=S,!this.scale.isConnected)return;const h={process:h=>{m.particleContext=h,m.systemContext=S,h.scale.l(this.scale.getConnectedValue(m))},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h}});(0,b.e)("BABYLON.UpdateAngleBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("angle",JS.Float),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(m){const S=this.particle.getConnectedValue(m);if(this.output._storedValue=S,!this.angle.isConnected)return;const h={process:h=>{m.particleContext=h,m.systemContext=S,h.angle=this.angle.getConnectedValue(m)},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h}});(0,b.e)("BABYLON.BasicPositionUpdateBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(m){const S=this.particle.getConnectedValue(m),h={process:h=>{m.particleContext=h,m.systemContext=S,h.direction.scaleToRef(S._directionScale,S._scaledDirection),h.position.addInPlace(S._scaledDirection)},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h,this.output._storedValue=S}});(0,b.e)("BABYLON.BasicSpriteUpdateBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(m){const S=this.particle.getConnectedValue(m),h={process:h=>{m.particleContext=h,m.systemContext=S,h.updateCellIndex()},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h,this.output._storedValue=S}});(0,b.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("cellIndex",JS.Int),this.registerOutput("output",JS.Particle),this.cellIndex.acceptedConnectionPointTypes=[JS.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(m){const S=this.particle.getConnectedValue(m);if(this.output._storedValue=S,!this.cellIndex.isConnected)return;const h={process:h=>{m.particleContext=h,m.systemContext=S,h.cellIndex=Math.floor(this.cellIndex.getConnectedValue(m))},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h}});class bh extends QS{constructor(m){super(m),this.strength=1,this.registerInput("particle",JS.Particle),this.registerInput("flowMap",JS.Texture),this.registerOutput("output",JS.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(m){var S;const h=this.particle.getConnectedValue(m),l=m.US;let M;(null===(S=this.flowMap.connectedPoint)||void 0===S?void 0:S.ownerBlock).extractTextureContentAsync().then((m=>{m&&(M=new dS(m.width,m.height,m.data))}));const O={process:m=>{const S=l.getTransformMatrix();M&&M._processParticle(m,this.strength*h._tempScaledUpdateSpeed,S)},previousItem:null,nextItem:null};h._updateQueueStart?fm(O,h._updateQueueStart):h._updateQueueStart=O,this.output._storedValue=h}serialize(){const m=super.serialize();return m.strength=this.strength,m}_deserialize(m){super._deserialize(m),this.strength=m.strength}}(0,e.d)([FS("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bh.prototype,"strength",void 0),(0,b.e)("BABYLON.UpdateFlowMapBlock",bh);(0,b.e)("BABYLON.SphereShapeBlock",class extends QS{constructor(m){super(m),this.registerInput("input",JS.Particle),this.registerInput("radius",JS.Float,!0,1),this.registerInput("radiusRange",JS.Float,!0,1,0,1),this.registerInput("directionRandomizer",JS.Float,!0,0,0,1),this.registerOutput("output",JS.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(m){const S=this.input.getConnectedValue(m);S._directionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.directionRandomizer.getConnectedValue(m),O=h.position.LS(m.emitterPosition).normalize(),u=(0,Y.RandomRange)(0,M),b=(0,Y.RandomRange)(0,M),q=(0,Y.RandomRange)(0,M);O.x+=u,O.y+=b,O.z+=q,O.normalize(),m.isEmitterTransformNode?l.nS.TransformNormalFromFloatsToRef(u,b,q,m.emitterWorldMatrix,h.direction):h.direction.Yb(u,b,q)},S._positionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.radius.getConnectedValue(m),O=this.radiusRange.getConnectedValue(m),u=M-(0,Y.RandomRange)(0,M*O),b=(0,Y.RandomRange)(0,1),q=(0,Y.RandomRange)(0,2*Math.PI),V=Math.acos(2*b-1),I=u*Math.cos(q)*Math.sin(V),Z=u*Math.cos(V),C=u*Math.sin(q)*Math.sin(V);m.isEmitterTransformNode?l.nS.TransformCoordinatesFromFloatsToRef(I,Z,C,m.emitterWorldMatrix,h.position):(h.position.Yb(I,Z,C),h.position.addInPlace(m.emitterPosition))},this.output._storedValue=S}});(0,b.e)("BABYLON.PointShapeBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("direction1",JS.nS,!0,new l.nS(0,1,0)),this.registerInput("direction2",JS.nS,!0,new l.nS(0,1,0)),this.registerOutput("output",JS.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(m){const S=this.particle.getConnectedValue(m);S._directionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.direction1.getConnectedValue(m),O=this.direction2.getConnectedValue(m),u=(0,Y.RandomRange)(M.x,O.x),b=(0,Y.RandomRange)(M.y,O.y),q=(0,Y.RandomRange)(M.z,O.z);m.isEmitterTransformNode?l.nS.TransformNormalFromFloatsToRef(u,b,q,m.emitterWorldMatrix,h.direction):h.direction.Yb(u,b,q)},S._positionCreation.process=h=>{m.systemContext=S,m.isEmitterTransformNode?l.nS.TransformCoordinatesFromFloatsToRef(0,0,0,m.emitterWorldMatrix,h.position):h.position.l(m.emitterPosition)},this.output._storedValue=S}});(0,b.e)("BABYLON.CustomShapeBlock",class extends QS{constructor(m){super(m),this.registerInput("particle",JS.Particle),this.registerInput("position",JS.nS,!0,new l.nS(0,0,0)),this.registerInput("direction",JS.nS,!0,new l.nS(0,1,0)),this.registerOutput("output",JS.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(m){const S=this.particle.getConnectedValue(m);S._directionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.direction.getConnectedValue(m);m.isEmitterTransformNode?l.nS.TransformNormalToRef(M,m.emitterWorldMatrix,h.direction):h.direction.l(M)},S._positionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.position.getConnectedValue(m);m.isEmitterTransformNode?l.nS.TransformCoordinatesToRef(M,m.emitterWorldMatrix,h.position):(h.position.l(M),h.position.addInPlace(m.emitterPosition))},this.output._storedValue=S}});(0,b.e)("BABYLON.CylinderShapeBlock",class extends QS{constructor(m){super(m),this._tempVector=l.nS.Zero(),this.registerInput("particle",JS.Particle),this.registerInput("radius",JS.Float,!0,1),this.registerInput("height",JS.Float,!0,1,0),this.registerInput("radiusRange",JS.Float,!0,1,0,1),this.registerInput("directionRandomizer",JS.Float,!0,0,0,1),this.registerOutput("output",JS.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(m){const S=this.particle.getConnectedValue(m);S._directionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.directionRandomizer.getConnectedValue(m);h.position.subtractToRef(m.emitterPosition,this._tempVector),this._tempVector.normalize(),m.isEmitterTransformNode&&l.nS.TransformNormalToRef(this._tempVector,m.emitterInverseWorldMatrix,this._tempVector);const O=(0,Y.RandomRange)(-M/2,M/2);let u=Math.atan2(this._tempVector.x,this._tempVector.z);u+=(0,Y.RandomRange)(-Math.PI/2,Math.PI/2)*M,this._tempVector.y=O,this._tempVector.x=Math.sin(u),this._tempVector.z=Math.cos(u),this._tempVector.normalize(),m.isEmitterTransformNode?l.nS.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,m.emitterWorldMatrix,h.direction):h.direction.l(this._tempVector)},S._positionCreation.process=h=>{m.particleContext=h,m.systemContext=S;const M=this.height.getConnectedValue(m),O=this.radiusRange.getConnectedValue(m),u=this.radius.getConnectedValue(m),b=(0,Y.RandomRange)(-M/2,M/2),q=(0,Y.RandomRange)(0,2*Math.PI),V=(0,Y.RandomRange)((1-O)*(1-O),1),I=Math.sqrt(V)*u,Z=I*Math.cos(q),C=I*Math.sin(q);m.isEmitterTransformNode?l.nS.TransformCoordinatesFromFloatsToRef(Z,b,C,m.emitterWorldMatrix,h.position):(h.position.Yb(Z,b,C),h.position.addInPlace(m.emitterPosition))},this.output._storedValue=S}});class qh extends QS{constructor(m){super(m),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",JS.Particle),this.registerOutput("output",JS.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(m){super._build(m);const S=this.particle.getConnectedValue(m);S._isAnimationSheetEnabled=!0,S.spriteCellWidth=this.width,S.spriteCellHeight=this.height,S.startSpriteCellID=this.start,S.endSpriteCellID=this.end,S.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=S}serialize(){const m=super.serialize();return m.width=this.width,m.height=this.height,m.start=this.start,m.end=this.end,m.randomStartCell=this.randomStartCell,m}_deserialize(m){super._deserialize(m),this.width=m.width,this.height=m.height,this.start=m.start,this.end=m.end,this.randomStartCell=m.randomStartCell}}(0,e.d)([FS("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qh.prototype,"start",void 0),(0,e.d)([FS("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qh.prototype,"end",void 0),(0,e.d)([FS("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qh.prototype,"width",void 0),(0,e.d)([FS("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qh.prototype,"height",void 0),(0,e.d)([FS("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qh.prototype,"loop",void 0),(0,e.d)([FS("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qh.prototype,"randomStartCell",void 0),(0,b.e)("BABYLON.SetupSpriteSheetBlock",qh);class Yh extends QS{constructor(m){super(m),this.reference=0,this.registerInput("value",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=m=>{switch(m){case JS.Float:return JS.FloatGradient;case JS.Vector2:return JS.Vector2Gradient;case JS.nS:return JS.Vector3Gradient;case JS.Bb:return JS.Color4Gradient}return m},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(JS.Float|JS.Vector2|JS.nS|JS.Bb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=m=>null}serialize(){const m=super.serialize();return m.reference=this.reference,m}_deserialize(m){super._deserialize(m),this.reference=m.reference}}(0,e.d)([FS("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Yh.prototype,"reference",void 0),(0,b.e)("BABYLON.ParticleGradientValueBlock",Yh);(0,b.e)("BABYLON.ParticleGradientBlock",class extends QS{constructor(m){super(m),this._entryCount=1,this.registerInput("gradient",JS.Float,!0,1,0,1),this.registerInput("value0",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=m=>{switch(m){case JS.FloatGradient:return JS.Float;case JS.Vector2Gradient:return JS.Vector2;case JS.Vector3Gradient:return JS.nS;case JS.Color4Gradient:return JS.Bb}return m},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(JS.FloatGradient|JS.Vector2Gradient|JS.Vector3Gradient|JS.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(m){this._inputs[m].onConnectionObservable.add((()=>{this._entryCount>m||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),JS.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const m=[];for(let h=1;h<this._inputs.length;h++){var S;if(this._inputs[h].isConnected)m.push(null===(S=this._inputs[h].connectedPoint)||void 0===S?void 0:S.ownerBlock)}m.sort(((m,S)=>m.reference-S.reference)),this.output._storedFunction=S=>{const h=this.gradient.getConnectedValue(S);if(1===m.length)return m[0].value.getConnectedValue(S);let M=null;for(let O=m.length-1;O>=0;O--){const b=m[O];if(b.reference<=h){const m=b.value.getConnectedValue(S);if(M){const O=M.value.getConnectedValue(S),q=M.reference,V=b.reference,I=Math.max(0,Math.min(1,(h-V)/(q-V)));switch(this.output.type){case JS.Float:return(0,Y.Lerp)(m,O,I);case JS.Vector2:return l.Vector2.Lerp(m,O,I);case JS.nS:return l.nS.Lerp(m,O,I);case JS.Bb:return u.Bb.Lerp(m,O,I)}}return m}M=b}return 0}}});(0,b.e)("BABYLON.ParticleConverterBlock",class extends QS{constructor(m){super(m),this.registerInput("color ",JS.Bb,!0),this.registerInput("xyz ",JS.nS,!0),this.registerInput("xy ",JS.Vector2,!0),this.registerInput("zw ",JS.Vector2,!0),this.registerInput("x ",JS.Float,!0),this.registerInput("y ",JS.Float,!0),this.registerInput("z ",JS.Float,!0),this.registerInput("w ",JS.Float,!0),this.registerOutput("color",JS.Bb),this.registerOutput("xyz",JS.nS),this.registerOutput("xy",JS.Vector2),this.registerOutput("zw",JS.Vector2),this.registerOutput("x",JS.Float),this.registerOutput("y",JS.Float),this.registerOutput("z",JS.Float),this.registerOutput("w",JS.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(m){return"color "===m?"colorIn":"xyz "===m?"xyzIn":"xy "===m?"xyIn":"zw "===m?"zwIn":"x "===m?"xIn":"y "===m?"yIn":"z "===m?"zIn":"w "===m?"wIn":m}_outputRename(m){switch(m){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return m}}_build(m){super._build(m);const S=this.xIn,h=this.yIn,M=this.zIn,O=this.wIn,b=this.xyIn,q=this.zwIn,Y=this.xyzIn,V=this.colorIn,I=this.colorOut,Z=this.xyzOut,C=this.xyOut,B=this.zwOut,D=this.xOut,E=this.yOut,n=this.zOut,L=this.wOut,U=m=>{if(V.isConnected)return V.getConnectedValue(m);let l=0,I=0,Z=0,C=0;if(S.isConnected&&(l=S.getConnectedValue(m)),h.isConnected&&(I=h.getConnectedValue(m)),M.isConnected&&(Z=M.getConnectedValue(m)),O.isConnected&&(C=O.getConnectedValue(m)),b.isConnected){const S=b.getConnectedValue(m);S&&(l=S.x,I=S.y)}if(q.isConnected){const S=q.getConnectedValue(m);S&&(Z=S.x,C=S.y)}if(Y.isConnected){const S=Y.getConnectedValue(m);S&&(l=S.x,I=S.y,Z=S.z)}return new u.Bb(l,I,Z,C)};I._storedFunction=m=>U(m),Z._storedFunction=m=>{const S=U(m);return new l.nS(S.r,S.g,S.b)},C._storedFunction=m=>{const S=U(m);return new l.Vector2(S.r,S.g)},B._storedFunction=m=>{const S=U(m);return new l.Vector2(S.b,S.a)},D._storedFunction=m=>U(m).r,E._storedFunction=m=>U(m).g,n._storedFunction=m=>U(m).b,L._storedFunction=m=>U(m).a}}),function(m){m[m.Cos=0]="Cos",m[m.Sin=1]="Sin",m[m.Abs=2]="Abs",m[m.Exp=3]="Exp",m[m.Exp2=4]="Exp2",m[m.Round=5]="Round",m[m.Floor=6]="Floor",m[m.Ceiling=7]="Ceiling",m[m.Sqrt=8]="Sqrt",m[m.Log=9]="Log",m[m.Tan=10]="Tan",m[m.ArcTan=11]="ArcTan",m[m.ArcCos=12]="ArcCos",m[m.ArcSin=13]="ArcSin",m[m.Sign=14]="Sign",m[m.Negate=15]="Negate",m[m.OneMinus=16]="OneMinus",m[m.Reciprocal=17]="Reciprocal",m[m.ToDegrees=18]="ToDegrees",m[m.ToRadians=19]="ToRadians",m[m.Fract=20]="Fract"}(rS||(rS={}));class Vh extends QS{constructor(m){super(m),this.operation=rS.Cos,this.registerInput("input",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(JS.Float|JS.Int|JS.Vector2|JS.nS|JS.Bb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(m){super._build(m);let S=null;switch(this.operation){case rS.Cos:S=m=>Math.cos(m);break;case rS.Sin:S=m=>Math.sin(m);break;case rS.Abs:S=m=>Math.abs(m);break;case rS.Exp:S=m=>Math.exp(m);break;case rS.Exp2:S=m=>Math.pow(2,m);break;case rS.Round:S=m=>Math.round(m);break;case rS.Floor:S=m=>Math.floor(m);break;case rS.Ceiling:S=m=>Math.ceil(m);break;case rS.Sqrt:S=m=>Math.sqrt(m);break;case rS.Log:S=m=>Math.log(m);break;case rS.Tan:S=m=>Math.tan(m);break;case rS.ArcTan:S=m=>Math.atan(m);break;case rS.ArcCos:S=m=>Math.acos(m);break;case rS.ArcSin:S=m=>Math.asin(m);break;case rS.Sign:S=m=>Math.sign(m);break;case rS.Negate:S=m=>-m;break;case rS.OneMinus:S=m=>1-m;break;case rS.Reciprocal:S=m=>1/m;break;case rS.ToRadians:S=m=>m*Math.PI/180;break;case rS.ToDegrees:S=m=>180*m/Math.PI;break;case rS.Fract:S=m=>m>=0?m-Math.floor(m):m-Math.ceil(m)}if(!S)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case JS.Int:case JS.Float:this.output._storedFunction=m=>{const h=this.input.getConnectedValue(m);return S(h)};break;case JS.Vector2:this.output._storedFunction=m=>{const h=this.input.getConnectedValue(m);return new l.Vector2(S(h.x),S(h.y))};break;case JS.nS:this.output._storedFunction=m=>{const h=this.input.getConnectedValue(m);return new l.nS(S(h.x),S(h.y),S(h.z))};break;case JS.Bb:this.output._storedFunction=m=>{const h=this.input.getConnectedValue(m);return new u.Bb(S(h.r),S(h.g),S(h.b),S(h.a))}}return this}serialize(){const m=super.serialize();return m.operation=this.operation,m}_deserialize(m){super._deserialize(m),this.operation=m.operation}}(0,e.d)([FS("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:rS.Cos},{label:"Sin",value:rS.Sin},{label:"Abs",value:rS.Abs},{label:"Exp",value:rS.Exp},{label:"Exp2",value:rS.Exp2},{label:"Round",value:rS.Round},{label:"Floor",value:rS.Floor},{label:"Ceiling",value:rS.Ceiling},{label:"Sqrt",value:rS.Sqrt},{label:"Log",value:rS.Log},{label:"Tan",value:rS.Tan},{label:"ArcTan",value:rS.ArcTan},{label:"ArcCos",value:rS.ArcCos},{label:"ArcSin",value:rS.ArcSin},{label:"Sign",value:rS.Sign},{label:"Negate",value:rS.Negate},{label:"OneMinus",value:rS.OneMinus},{label:"Reciprocal",value:rS.Reciprocal},{label:"ToDegrees",value:rS.ToDegrees},{label:"ToRadians",value:rS.ToRadians},{label:"Fract",value:rS.Fract}]})],Vh.prototype,"operation",void 0),(0,b.e)("BABYLON.ParticleTrigonometryBlock",Vh);var Ih,Zh=h(12740);class Ch extends QS{constructor(m){super(m),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(JS.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(JS.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(JS.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(JS.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(JS.System),this._inputs[0].excludedConnectionPointTypes.push(JS.Particle),this._inputs[0].excludedConnectionPointTypes.push(JS.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(m){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const S=m=>{const S=this.input.getConnectedValue(m);if(this.log.length>=this.stackSize)return S;if(null===S||void 0===S)return this.log.push(["null",""]),S;switch(this.input.type){case JS.Vector2:this.log.push([(0,Zh.i)(S,4),S.toString()]);break;case JS.nS:this.log.push([(0,Zh.l)(S,4),S.toString()]);break;case JS.Bb:this.log.push([`{R: ${S.r.toFixed(4)} G: ${S.g.toFixed(4)} B: ${S.b.toFixed(4)} A: ${S.a.toFixed(4)}}`,S.toString()]);break;default:this.log.push([S.toString(),S.toString()])}return S};this.output.isConnected?this.output._storedFunction=S:this.output._storedValue=S(m)}serialize(){const m=super.serialize();return m.stackSize=this.stackSize,m}_deserialize(m){super._deserialize(m),this.stackSize=m.stackSize}}(0,e.d)([FS("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Ch.prototype,"stackSize",void 0),(0,b.e)("BABYLON.ParticleDebugBlock",Ch);(0,b.e)("BABYLON.ParticleElbowBlock",class extends QS{constructor(m){super(m),this.registerInput("input",JS.AutoDetect),this.registerOutput("output",JS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(m){super._build(m);const S=this._outputs[0],h=this._inputs[0];S._storedFunction=m=>h.getConnectedValue(m)}});(0,b.e)("BABYLON.ParticleTeleportInBlock",class extends QS{get endpoints(){return this._endpoints}constructor(m){super(m),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",JS.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(m){if(this.getClassName()===m)return!0;for(const S of this.endpoints)if(S.isAnAncestorOfType(m))return!0;return!1}isAnAncestorOf(m){for(const S of this.endpoints){if(S===m)return!0;if(S.isAnAncestorOf(m))return!0}return!1}attachToEndpoint(m){m.detach(),this._endpoints.push(m),m._entryPoint=this,m._outputs[0]._typeConnectionSource=this._inputs[0],m._tempEntryPointUniqueId=null,m.name="> "+this.name}detachFromEndpoint(m){const S=this._endpoints.indexOf(m);-1!==S&&(this._endpoints.splice(S,1),m._outputs[0]._typeConnectionSource=null,m._entryPoint=null)}_build(){for(const m of this._endpoints)m.output._storedFunction=m=>this.input.getConnectedValue(m)}});(0,b.e)("BABYLON.ParticleTeleportOutBlock",class extends QS{constructor(m){super(m),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",JS.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(m){this.entryPoint&&this.entryPoint.build(m)}clone(){const m=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(m),m}serialize(){var m;const S=super.serialize();return S.entryPoint=(null===(m=this.entryPoint)||void 0===m?void 0:m.uniqueId)??"",S}_deserialize(m){super._deserialize(m),this._tempEntryPointUniqueId=m.entryPoint}}),function(m){m[m.Equal=0]="Equal",m[m.NotEqual=1]="NotEqual",m[m.LessThan=2]="LessThan",m[m.GreaterThan=3]="GreaterThan",m[m.LessOrEqual=4]="LessOrEqual",m[m.GreaterOrEqual=5]="GreaterOrEqual",m[m.Xor=6]="Xor",m[m.Or=7]="Or",m[m.And=8]="And"}(Ih||(Ih={}));class Bh extends QS{constructor(m){super(m),this.test=Ih.Equal,this.epsilon=0,this.registerInput("left",JS.Float),this.registerInput("right",JS.Float,!0,0),this.registerInput("ifTrue",JS.AutoDetect,!0,1),this.registerInput("ifFalse",JS.AutoDetect,!0,0),this.registerOutput("output",JS.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=JS.Float,this._inputs[0].acceptedConnectionPointTypes.push(JS.Int),this._inputs[1].acceptedConnectionPointTypes.push(JS.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const m=m=>{const S=this.left.getConnectedValue(m),h=this.right.getConnectedValue(m);let l=!1;switch(this.test){case Ih.Equal:l=(0,Y.WithinEpsilon)(S,h,this.epsilon);break;case Ih.NotEqual:l=!(0,Y.WithinEpsilon)(S,h,this.epsilon);break;case Ih.LessThan:l=S<h+this.epsilon;break;case Ih.GreaterThan:l=S>h-this.epsilon;break;case Ih.LessOrEqual:l=S<=h+this.epsilon;break;case Ih.GreaterOrEqual:l=S>=h-this.epsilon;break;case Ih.Xor:l=!!S&&!h||!S&&!!h;break;case Ih.Or:l=!!S||!!h;break;case Ih.And:l=!!S&&!!h}return l};this.output._storedFunction=S=>m(S)?this.ifTrue.getConnectedValue(S):this.ifFalse.getConnectedValue(S)}serialize(){const m=super.serialize();return m.test=this.test,m.epsilon=this.epsilon,m}_deserialize(m){super._deserialize(m),this.test=m.test,void 0!==m.epsilon&&(this.epsilon=m.epsilon)}}(0,e.d)([FS("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ih.Equal},{label:"NotEqual",value:Ih.NotEqual},{label:"LessThan",value:Ih.LessThan},{label:"GreaterThan",value:Ih.GreaterThan},{label:"LessOrEqual",value:Ih.LessOrEqual},{label:"GreaterOrEqual",value:Ih.GreaterOrEqual},{label:"Xor",value:Ih.Xor},{label:"Or",value:Ih.Or},{label:"And",value:Ih.And}]})],Bh.prototype,"test",void 0),(0,e.d)([FS("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Bh.prototype,"epsilon",void 0),(0,b.e)("BABYLON.ParticleConditionBlock",Bh);class Dh extends QS{constructor(m){super(m),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",JS.Particle),this.registerInput("condition",JS.Float,!0,0),this.registerInput("system",JS.System),this.registerOutput("output",JS.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(m){this._triggerCount=0;const S=this.input.getConnectedValue(m),h={process:h=>{if(m.particleContext=h,m.systemContext=S,0!==this.condition.getConnectedValue(m)&&(0===this.limit||this._triggerCount<this.limit)){const l=(new Date).getTime();if(this._previousOne&&l-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=l;const M=this.system.getConnectedValue(m);if(M){const l=tS(M,m.US,h.position);l.Jh.addOnce((()=>{this._triggerCount--})),S.Jh.addOnce((()=>{l.dispose()}))}}},previousItem:null,nextItem:null};S._updateQueueStart?fm(h,S._updateQueueStart):S._updateQueueStart=h,this.output._storedValue=S}serialize(){const m=super.serialize();return m.limit=this.limit,m.delay=this.delay,m}_deserialize(m){super._deserialize(m),void 0!==m.limit&&(this.limit=m.limit),void 0!==m.delay&&(this.delay=m.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,e.d)([FS("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Dh.prototype,"limit",void 0),(0,e.d)([FS("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Dh.prototype,"delay",void 0),(0,b.e)("BABYLON.ParticleTriggerBlock",Dh);h(12745),h(12757),h(12769),h(12812)},12802:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneFragment",O="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12772:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneFragmentDeclaration",O="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12826:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneVertex",O="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12819:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneVertexDeclaration",O="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12810:(m,S,h)=>{"use strict";var l=h(11242);const M="fogFragment",O="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12795:(m,S,h)=>{"use strict";var l=h(11242);const M="fogFragmentDeclaration",O="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12833:(m,S,h)=>{"use strict";var l=h(11242);const M="fogVertex",O="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12823:(m,S,h)=>{"use strict";var l=h(11242);const M="fogVertexDeclaration",O="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12788:(m,S,h)=>{"use strict";var l=h(11242);const M="helperFunctions",O="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12777:(m,S,h)=>{"use strict";var l=h(11242);const M="imageProcessingDeclaration",O="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12791:(m,S,h)=>{"use strict";var l=h(11242);const M="imageProcessingFunctions",O="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12780:(m,S,h)=>{"use strict";var l=h(11242);const M="logDepthDeclaration",O="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12804:(m,S,h)=>{"use strict";var l=h(11242);const M="logDepthFragment",O="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12841:(m,S,h)=>{"use strict";var l=h(11242);const M="logDepthVertex",O="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";l.b.IncludesShadersStoreWGSL[M]||(l.b.IncludesShadersStoreWGSL[M]=O)},12769:(m,S,h)=>{"use strict";h.r(S),h.d(S,{particlesPixelShaderWGSL:()=>u});var l=h(11242);h(12772),h(12777),h(12780),h(12788),h(12791),h(12795),h(12802),h(12804),h(12810);const M="particlesPixelShader",O="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";l.b.ShadersStoreWGSL[M]||(l.b.ShadersStoreWGSL[M]=O);const u={name:M,shader:O}},12812:(m,S,h)=>{"use strict";h.r(S),h.d(S,{particlesVertexShaderWGSL:()=>u});var l=h(11242);h(12819),h(12823),h(12780),h(12826),h(12833),h(12841);const M="particlesVertexShader",O="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";l.b.ShadersStoreWGSL[M]||(l.b.ShadersStoreWGSL[M]=O);const u={name:M,shader:O}},12672:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneFragment",O="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12753:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneFragmentDeclaration",O="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12701:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneVertex",O="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12766:(m,S,h)=>{"use strict";var l=h(11242);const M="clipPlaneVertexDeclaration",O="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12688:(m,S,h)=>{"use strict";var l=h(11242);const M="fogFragment",O="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12669:(m,S,h)=>{"use strict";var l=h(11242);const M="fogFragmentDeclaration",O="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12707:(m,S,h)=>{"use strict";var l=h(11242);const M="fogVertex",O="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12697:(m,S,h)=>{"use strict";var l=h(11242);const M="fogVertexDeclaration",O="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12657:(m,S,h)=>{"use strict";var l=h(11242);const M="helperFunctions",O="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12648:(m,S,h)=>{"use strict";var l=h(11242);const M="imageProcessingDeclaration",O="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12660:(m,S,h)=>{"use strict";var l=h(11242);const M="imageProcessingFunctions",O="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12651:(m,S,h)=>{"use strict";var l=h(11242);const M="logDepthDeclaration",O="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12681:(m,S,h)=>{"use strict";var l=h(11242);const M="logDepthFragment",O="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12712:(m,S,h)=>{"use strict";var l=h(11242);const M="logDepthVertex",O="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";l.b.IncludesShadersStore[M]||(l.b.IncludesShadersStore[M]=O)},12745:(m,S,h)=>{"use strict";h.r(S),h.d(S,{particlesPixelShader:()=>u});var l=h(11242);h(12753),h(12648),h(12651),h(12657),h(12660),h(12669),h(12672),h(12681),h(12688);const M="particlesPixelShader",O="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";l.b.ShadersStore[M]||(l.b.ShadersStore[M]=O);const u={name:M,shader:O}},12757:(m,S,h)=>{"use strict";h.r(S),h.d(S,{particlesVertexShader:()=>u});var l=h(11242);h(12766),h(12697),h(12651),h(12701),h(12707),h(12712);const M="particlesVertexShader",O="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";l.b.ShadersStore[M]||(l.b.ShadersStore[M]=O);const u={name:M,shader:O}},13111:(m,S,h)=>{"use strict";h.r(S),h.d(S,{FlowGraphGLTFDataProvider:()=>O});var l=h(13074),M=h(13060);class O extends l.d{constructor(m){var S,h;super();const l=m.glTF,O=(null===(S=l.animations)||void 0===S?void 0:S.map((m=>m._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",M.b,O);const u=(null===(h=l.nodes)||void 0===h?void 0:h.map((m=>m._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",M.b,u)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12999:(m,S,h)=>{"use strict";h.d(S,{e:()=>E,h:()=>B,i:()=>C,j:()=>D});var l=h(11347),M=h(11785),O=h(11387),u=h(13004);const b=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class q{constructor(m,S){this._gltf=m,this._infoTree=S}convert(m){let S,h=this._gltf,l=this._infoTree;if(!m.startsWith("/"))throw new Error("Path must start with a /");const M=m.split("/");if(M.shift(),M[M.length-1].includes(".length")){const m=M[M.length-1].split(".");M.pop(),M.push(...m)}let O=!1;for(const q of M){const M="length"===q;if(M&&!l.__array__)throw new Error(`Path ${m} is invalid`);if(l.__ignoreObjectTree__&&(O=!0),l.__array__&&!M)l=l.__array__;else if(l=l[q],!l)throw new Error(`Path ${m} is invalid`);if(!O)if(void 0===h){if(!b.find((S=>S.regex.test(m))))throw new Error(`Path ${m} is invalid`)}else if(!M){var u;h=null===(u=h)||void 0===u?void 0:u[q]}(l.__target__||M)&&(S=h)}return{object:S,info:l}}}function Y(m,S,h,l){const M=V(m,S);return l?M[h][l]:M[h]}function V(m,S,h){var l,O;return null===(l=m._data)||void 0===l||null===(O=l[(null===h||void 0===h?void 0:h.fillMode)??M.c.MATERIAL_TriangleFillMode])||void 0===O?void 0:O.babylonMaterial}function I(m,S){return{offset:{componentsCount:2,type:"Vector2",get:(h,M,O)=>{const u=Y(h,O,m,S);return new l.Vector2(null===u||void 0===u?void 0:u.uOffset,null===u||void 0===u?void 0:u.vOffset)},getTarget:V,set:(h,l,M,O)=>{const u=Y(l,O,m,S);u.uOffset=h.x,u.vOffset=h.y},getPropertyName:[()=>`${m}${S?"."+S:""}.uOffset`,()=>`${m}${S?"."+S:""}.vOffset`]},rotation:{type:"number",get:(h,l,M)=>{var O;return null===(O=Y(h,M,m,S))||void 0===O?void 0:O.wAng},getTarget:V,set:(h,l,M,O)=>Y(l,O,m,S).wAng=h,getPropertyName:[()=>`${m}${S?"."+S:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(h,M,O)=>{const u=Y(h,O,m,S);return new l.Vector2(null===u||void 0===u?void 0:u.uScale,null===u||void 0===u?void 0:u.vScale)},getTarget:V,set:(h,l,M,O)=>{const u=Y(l,O,m,S);u.uScale=h.x,u.vScale=h.y},getPropertyName:[()=>`${m}${S?"."+S:""}.uScale`,()=>`${m}${S?"."+S:""}.vScale`]}}}const Z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:m=>{var S,h;return new l.Vector2((null===(S=m._babylonCamera)||void 0===S?void 0:S.orthoLeft)??0,(null===(h=m._babylonCamera)||void 0===h?void 0:h.orthoRight)??0)},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.orthoLeft=m.x,S._babylonCamera.orthoRight=m.y)},getTarget:m=>m,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:m=>{var S,h;return new l.Vector2((null===(S=m._babylonCamera)||void 0===S?void 0:S.orthoBottom)??0,(null===(h=m._babylonCamera)||void 0===h?void 0:h.orthoTop)??0)},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.orthoBottom=m.x,S._babylonCamera.orthoTop=m.y)},getTarget:m=>m,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:m=>{var S;return null===(S=m._babylonCamera)||void 0===S?void 0:S.maxZ},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.maxZ=m)},getTarget:m=>m,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:m=>{var S;return null===(S=m._babylonCamera)||void 0===S?void 0:S.hb},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.hb=m)},getTarget:m=>m,getPropertyName:[()=>"hb"]}},perspective:{aspectRatio:{type:"number",get:m=>{var S;return null===(S=m._babylonCamera)||void 0===S?void 0:S.getEngine().getAspectRatio(m._babylonCamera)},getTarget:m=>m,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:m=>{var S;return null===(S=m._babylonCamera)||void 0===S?void 0:S.fov},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.fov=m)},getTarget:m=>m,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:m=>{var S;return null===(S=m._babylonCamera)||void 0===S?void 0:S.maxZ},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.maxZ=m)},getTarget:m=>m,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:m=>{var S;return null===(S=m._babylonCamera)||void 0===S?void 0:S.hb},set:(m,S)=>{S._babylonCamera&&(S._babylonCamera.hb=m)},getTarget:m=>m,getPropertyName:[()=>"hb"]}}}},nodes:{length:{type:"number",get:m=>m.length,getTarget:m=>m.map((m=>m._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"nS",get:m=>{var S;return null===(S=m._babylonTransformNode)||void 0===S?void 0:S.position},set:(m,S)=>{var h;return null===(h=S._babylonTransformNode)||void 0===h?void 0:h.position.l(m)},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:m=>{var S;return null===(S=m._babylonTransformNode)||void 0===S?void 0:S.rotationQuaternion},set:(m,S)=>{var h,l;return null===(h=S._babylonTransformNode)||void 0===h||null===(l=h.rotationQuaternion)||void 0===l?void 0:l.l(m)},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"nS",get:m=>{var S;return null===(S=m._babylonTransformNode)||void 0===S?void 0:S.Ib},set:(m,S)=>{var h;return null===(h=S._babylonTransformNode)||void 0===h?void 0:h.Ib.l(m)},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"Ib"]},weights:{length:{type:"number",get:m=>m._numMorphTargets,getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(m,S)=>{var h,l;return void 0!==S?null===(h=m._primitiveBabylonMeshes)||void 0===h||null===(l=h[0].morphTargetManager)||void 0===l?void 0:l.getTarget(S).influence:void 0},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(m,S)=>[0],getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:m=>{var S,h,M;return l.Matrix.Compose(null===(S=m._babylonTransformNode)||void 0===S?void 0:S.Ib,null===(h=m._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion,null===(M=m._babylonTransformNode)||void 0===M?void 0:M.position)},getTarget:m=>m._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:m=>{var S,h,M,O;const u=l.Matrix.Identity();let b=m.parent;for(;b&&b.parent;)b=b.parent;const q=(null===(S=m._babylonTransformNode)||void 0===S?void 0:S.position._isDirty)||(null===(h=m._babylonTransformNode)||void 0===h||null===(M=h.rotationQuaternion)||void 0===M?void 0:M._isDirty)||(null===(O=m._babylonTransformNode)||void 0===O?void 0:O.Ib._isDirty);if(b){var Y;const S=null===(Y=b._babylonTransformNode)||void 0===Y?void 0:Y.Mb(!0).invert();var V,I;if(S)null===(V=m._babylonTransformNode)||void 0===V||null===(I=V.Mb(q))||void 0===I||I.multiplyToRef(S,u)}else m._babylonTransformNode&&u.l(m._babylonTransformNode.Mb(q));return u},getTarget:m=>m._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:m=>{var S,h;return null===(S=m._babylonTransformNode)||void 0===S||null===(h=S.getChildren((m=>m instanceof u.d),!0)[0])||void 0===h?void 0:h.nb},getTarget:m=>{var S;return null===(S=m._babylonTransformNode)||void 0===S?void 0:S.getChildren((m=>m instanceof u.d),!0)[0]},set:(m,S)=>{if(S._babylonTransformNode){const h=S._babylonTransformNode.getChildren((m=>m instanceof u.d),!0)[0];h&&(h.nb=m)}}},color:{type:"RS",get:m=>{var S,h;return null===(S=m._babylonTransformNode)||void 0===S||null===(h=S.getChildren((m=>m instanceof u.d),!0)[0])||void 0===h?void 0:h.Lb},getTarget:m=>{var S;return null===(S=m._babylonTransformNode)||void 0===S?void 0:S.getChildren((m=>m instanceof u.d),!0)[0]},set:(m,S)=>{if(S._babylonTransformNode){const h=S._babylonTransformNode.getChildren((m=>m instanceof u.d),!0)[0];h&&(h.Lb=m)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"RS",get:(m,S,h)=>V(m,S,h).emissiveColor,set:(m,S,h,l)=>V(S,h,l).emissiveColor.l(m),getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:I("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(m,S,h)=>{var l;return null===(l=Y(m,h,"bumpTexture"))||void 0===l?void 0:l.level},set:(m,S,h,l)=>{const M=Y(S,l,"bumpTexture");M&&(M.level=m)},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:I("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(m,S,h)=>V(m,S,h).ambientTextureStrength,set:(m,S,h,l)=>{const M=V(S,h,l);M&&(M.ambientTextureStrength=m)},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:I("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Bb",get:(m,S,h)=>{const l=V(m,S,h);return O.Bb.FromColor3(l.albedoColor,l.alpha)},set:(m,S,h,l)=>{const M=V(S,h,l);M.albedoColor.set(m.r,m.g,m.b),M.alpha=m.a},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:I("albedoTexture")}},metallicFactor:{type:"number",get:(m,S,h)=>V(m,S,h).metallic,set:(m,S,h,l)=>{const M=V(S,h,l);M&&(M.metallic=m)},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(m,S,h)=>V(m,S,h).roughness,set:(m,S,h,l)=>{const M=V(S,h,l);M&&(M.roughness=m)},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:I("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(m,S,h)=>V(m,S,h).anisotropy.nb,set:(m,S,h,l)=>{V(S,h,l).anisotropy.nb=m},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(m,S,h)=>V(m,S,h).anisotropy.angle,set:(m,S,h,l)=>{V(S,h,l).anisotropy.angle=m},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:I("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(m,S,h)=>V(m,S,h).clearCoat.nb,set:(m,S,h,l)=>{V(S,h,l).clearCoat.nb=m},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(m,S,h)=>V(m,S,h).clearCoat.roughness,set:(m,S,h,l)=>{V(S,h,l).clearCoat.roughness=m},getTarget:(m,S,h)=>V(m,S,h),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:I("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(m,S,h)=>{var l;return null===(l=V(m,S,h).clearCoat.bumpTexture)||void 0===l?void 0:l.level},getTarget:V,set:(m,S,h,l)=>V(S,h,l).clearCoat.bumpTexture.level=m},extensions:{KHR_texture_transform:I("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:I("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(m,S,h)=>V(m,S,h).subSurface.dispersion,getTarget:V,set:(m,S,h,l)=>V(S,h,l).subSurface.dispersion=m}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(m,S,h)=>V(m,S,h).emissiveIntensity,getTarget:V,set:(m,S,h,l)=>V(S,h,l).emissiveIntensity=m}},KHR_materials_ior:{ior:{type:"number",get:(m,S,h)=>V(m,S,h).indexOfRefraction,getTarget:V,set:(m,S,h,l)=>V(S,h,l).indexOfRefraction=m}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(m,S,h)=>V(m,S,h).iridescence.nb,getTarget:V,set:(m,S,h,l)=>V(S,h,l).iridescence.nb=m},iridescenceIor:{type:"number",get:(m,S,h)=>V(m,S,h).iridescence.indexOfRefraction,getTarget:V,set:(m,S,h,l)=>V(S,h,l).iridescence.indexOfRefraction=m},iridescenceTexture:{extensions:{KHR_texture_transform:I("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(m,S,h)=>V(m,S,h).iridescence.maximumThickness,getTarget:V,set:(m,S,h,l)=>V(S,h,l).iridescence.maximumThickness=m},iridescenceThicknessMinimum:{type:"number",get:(m,S,h)=>V(m,S,h).iridescence.minimumThickness,getTarget:V,set:(m,S,h,l)=>V(S,h,l).iridescence.minimumThickness=m},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:I("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"RS",get:(m,S,h)=>V(m,S,h).sheen.color,getTarget:V,set:(m,S,h,l)=>V(S,h,l).sheen.color.l(m)},sheenColorTexture:{extensions:{KHR_texture_transform:I("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(m,S,h)=>V(m,S,h).sheen.nb,getTarget:V,set:(m,S,h,l)=>V(S,h,l).sheen.nb=m},sheenRoughnessTexture:{extensions:{KHR_texture_transform:I("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(m,S,h)=>V(m,S,h).metallicF0Factor,getTarget:V,set:(m,S,h,l)=>V(S,h,l).metallicF0Factor=m,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"RS",get:(m,S,h)=>V(m,S,h).metallicReflectanceColor,getTarget:V,set:(m,S,h,l)=>V(S,h,l).metallicReflectanceColor.l(m),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:I("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:I("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(m,S,h)=>V(m,S,h).subSurface.refractionIntensity,getTarget:V,set:(m,S,h,l)=>V(S,h,l).subSurface.refractionIntensity=m,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:I("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(m,S,h)=>V(m,S,h).subSurface.translucencyIntensity,getTarget:V,set:(m,S,h,l)=>V(S,h,l).subSurface.translucencyIntensity=m},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:I("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"RS",get:(m,S,h)=>V(m,S,h).subSurface.translucencyColor,getTarget:V,set:(m,S,h,l)=>{var M;return m&&(null===(M=V(S,h,l).subSurface.translucencyColor)||void 0===M?void 0:M.l(m))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:I("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"RS",get:(m,S,h)=>V(m,S,h).subSurface.tintColor,getTarget:V,set:(m,S,h,l)=>V(S,h,l).subSurface.tintColor.l(m)},attenuationDistance:{type:"number",get:(m,S,h)=>V(m,S,h).subSurface.tintColorAtDistance,getTarget:V,set:(m,S,h,l)=>V(S,h,l).subSurface.tintColorAtDistance=m},thicknessFactor:{type:"number",get:(m,S,h)=>V(m,S,h).subSurface.maximumThickness,getTarget:V,set:(m,S,h,l)=>V(S,h,l).subSurface.maximumThickness=m},thicknessTexture:{extensions:{KHR_texture_transform:I("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:m=>m.length,getTarget:m=>m.map((m=>m._babylonLight)),getPropertyName:[m=>"length"]},__array__:{__target__:!0,color:{type:"RS",get:m=>{var S;return null===(S=m._babylonLight)||void 0===S?void 0:S.Lb},set:(m,S)=>{var h;return null===(h=S._babylonLight)||void 0===h?void 0:h.Lb.l(m)},getTarget:m=>m._babylonLight,getPropertyName:[m=>"diffuse"]},nb:{type:"number",get:m=>{var S;return null===(S=m._babylonLight)||void 0===S?void 0:S.nb},set:(m,S)=>S._babylonLight?S._babylonLight.nb=m:void 0,getTarget:m=>m._babylonLight,getPropertyName:[m=>"intensity"]},range:{type:"number",get:m=>{var S;return null===(S=m._babylonLight)||void 0===S?void 0:S.range},set:(m,S)=>S._babylonLight?S._babylonLight.range=m:void 0,getTarget:m=>m._babylonLight,getPropertyName:[m=>"range"]},spot:{innerConeAngle:{type:"number",get:m=>{var S;return null===(S=m._babylonLight)||void 0===S?void 0:S.innerAngle},set:(m,S)=>S._babylonLight?S._babylonLight.innerAngle=m:void 0,getTarget:m=>m._babylonLight,getPropertyName:[m=>"innerConeAngle"]},outerConeAngle:{type:"number",get:m=>{var S;return null===(S=m._babylonLight)||void 0===S?void 0:S.angle},set:(m,S)=>S._babylonLight?S._babylonLight.angle=m:void 0,getTarget:m=>m._babylonLight,getPropertyName:[m=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:m=>m.length,getTarget:m=>m.map((m=>m._babylonLight)),getPropertyName:[m=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:m=>m.length,getTarget:m=>m.map((m=>m._babylonTexture)),getPropertyName:[m=>"length"]},__array__:{__target__:!0,nb:{type:"number",get:m=>{var S;return null===(S=m._babylonTexture)||void 0===S?void 0:S.level},set:(m,S)=>{S._babylonTexture&&(S._babylonTexture.level=m)},getTarget:m=>m._babylonTexture},rotation:{type:"Quaternion",get:m=>{var S;return m._babylonTexture&&l.Quaternion.FromRotationMatrix(null===(S=m._babylonTexture)||void 0===S?void 0:S.getReflectionTextureMatrix())},set:(m,S)=>{var h;S._babylonTexture&&(null!==(h=S._babylonTexture.sm())&&void 0!==h&&h.useRightHandedSystem||(m=l.Quaternion.Inverse(m)),l.Matrix.FromQuaternionToRef(m,S._babylonTexture.getReflectionTextureMatrix()))},getTarget:m=>m._babylonTexture}}}}},animations:{length:{type:"number",get:m=>m.length,getTarget:m=>m.map((m=>m._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:m=>m.length,getTarget:m=>m.map((m=>{var S;return null===(S=m.primitives[0]._instanceData)||void 0===S?void 0:S.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function C(m){return new q(m,Z)}function B(m){const S=m.split("/").map((m=>m.replace(/{}/g,"__array__")));let h=Z;for(const l of S)l&&(h=h[l]);if(h&&h.type&&h.get)return h}function D(m,S){const h=m.split("/").map((m=>m.replace(/{}/g,"__array__")));let l=Z;for(const M of h)M&&(l=l[M]);l&&l.type&&l.get&&(l.interpolation=S)}function E(m,S){const h=m.split("/").map((m=>m.replace(/{}/g,"__array__")));let l=Z;for(const M of h)if(M){if(!l[M]){if("?"===M){l.__ignoreObjectTree__=!0;continue}l[M]={},"__array__"===M&&(l[M].__target__=!0)}l=l[M]}Object.assign(l,S)}},13006:(m,S,h)=>{"use strict";h.r(S),h.d(S,{AnimationPropertyInfo:()=>Y,TransformNodeAnimationPropertyInfo:()=>V,WeightAnimationPropertyInfo:()=>I,getQuaternion:()=>b,getVector3:()=>u,getWeights:()=>q});var l=h(11838),M=h(11347),O=h(12999);function u(m,S,h,l){return M.nS.yS(S,h).scaleInPlace(l)}function b(m,S,h,l){return M.Quaternion.yS(S,h).scaleInPlace(l)}function q(m,S,h,l){const M=new Array(m._numMorphTargets);for(let O=0;O<M.length;O++)M[O]=S[h++]*l;return M}class Y{constructor(m,S,h,l){this.type=m,this.name=S,this.getValue=h,this.getStride=l}_buildAnimation(m,S,h){const M=new l.e(m,this.name,S,this.type);return M.setKeys(h),M}}class V extends Y{buildAnimations(m,S,h,l){const M=[];return M.push({babylonAnimatable:m._babylonTransformNode,babylonAnimation:this._buildAnimation(S,h,l)}),M}}class I extends Y{buildAnimations(m,S,h,M){const O=[];if(m._numMorphTargets)for(let u=0;u<m._numMorphTargets;u++){const b=new l.e(`${S}_${u}`,this.name,h,this.type);if(b.setKeys(M.map((m=>({frame:m.frame,inTangent:m.inTangent?m.inTangent[u]:void 0,value:m.value[u],outTangent:m.outTangent?m.outTangent[u]:void 0,interpolation:m.interpolation})))),m._primitiveBabylonMeshes)for(const S of m._primitiveBabylonMeshes)if(S.morphTargetManager){const m=S.morphTargetManager.getTarget(u),h=b.clone();m.animations.push(h),O.push({babylonAnimatable:m,babylonAnimation:h})}}return O}}(0,O.j)("/nodes/{}/translation",[new V(l.e.ANIMATIONTYPE_VECTOR3,"position",u,(()=>3))]),(0,O.j)("/nodes/{}/rotation",[new V(l.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",b,(()=>4))]),(0,O.j)("/nodes/{}/scale",[new V(l.e.ANIMATIONTYPE_VECTOR3,"Ib",u,(()=>3))]),(0,O.j)("/nodes/{}/weights",[new I(l.e.ANIMATIONTYPE_FLOAT,"influence",q,(m=>m._numMorphTargets))])},12966:(m,S,h)=>{"use strict";class l{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((m,S)=>{this._resolve=m,this._reject=S}))}}var M=h(11347),O=h(11387),u=h(11156),b=h(11759),q=h(12970),Y=h(12981),V=h(11161),I=h(11782),Z=h(11838),C=h(11847),B=h(11196),D=h(11173),E=h(11179);class n{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(m){this._useTextureToStoreBoneMatrices=m,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(m){this._animationPropertiesOverride=m}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(m,S,h){this.name=m,this.id=S,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=M.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new V.e,this.bones=[],this._scene=h||B.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const l=this._scene.getEngine().getCaps();this._canUseTextureForBones=l.textureFloat&&l.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((m=>!m.getParent()))}getTransformMatrices(m){if(this.needInitialSkinMatrix){if(!m)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return m._bonesTransformMatrices||this.prepare(!0),m._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(m){return this.needInitialSkinMatrix&&m._transformMatrixTexture?m._transformMatrixTexture:this._transformMatrixTexture}sm(){return this._scene}toString(m){let S=`Name: ${this.name}, nBones: ${this.bones.length}`;if(S+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,m){S+=", Ranges: {";let m=!0;for(const h in this._ranges)m&&(S+=", ",m=!1),S+=h;S+="}"}return S}getBoneIndexByName(m){for(let S=0,h=this.bones.length;S<h;S++)if(this.bones[S].name===m)return S;return-1}createAnimationRange(m,S,h){if(!this._ranges[m]){this._ranges[m]=new C.d(m,S,h);for(let l=0,M=this.bones.length;l<M;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].createRange(m,S,h)}}deleteAnimationRange(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let h=0,l=this.bones.length;h<l;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].deleteRange(m,S);this._ranges[m]=null}getAnimationRange(m){return this._ranges[m]||null}getAnimationRanges(){const m=[];let S;for(S in this._ranges)m.push(this._ranges[S]);return m}copyAnimationRange(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[S]||!m.getAnimationRange(S))return!1;let l=!0;const M=this._getHighestAnimationFrame()+1,O={},u=m.bones;let b,q;for(q=0,b=u.length;q<b;q++)O[u[q].name]=u[q];this.bones.length!==u.length&&(D.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${u.length}`),l=!1);const Y=h&&this.dimensionsAtRest&&m.dimensionsAtRest?this.dimensionsAtRest.divide(m.dimensionsAtRest):null;for(q=0,b=this.bones.length;q<b;q++){const m=this.bones[q].name,u=O[m];u?l=l&&this.bones[q].copyAnimationRange(u,S,M,h,Y):(D.e.Warn("copyAnimationRange: not same rig, missing source bone "+m),l=!1)}const V=m.getAnimationRange(S);return V&&(this._ranges[S]=new C.d(S,V.from+M,V.to+M)),l}returnToRest(){for(const m of this.bones)-1!==m._index&&m.returnToRest()}_getHighestAnimationFrame(){let m=0;for(let S=0,h=this.bones.length;S<h;S++)if(this.bones[S].animations[0]){const h=this.bones[S].animations[0].getHighestFrame();m<h&&(m=h)}return m}beginAnimation(m,S,h,l){const M=this.getAnimationRange(m);return M?this._scene.beginAnimation(this,M.from,M.to,S,h,l):null}static MakeAnimationAdditive(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const l=m.getAnimationRange(h);if(!l)return null;const M=m._scene.getAllAnimatablesByTarget(m);let O=null;for(let b=0;b<M.length;b++){const m=M[b];if(m.fromFrame===(null===l||void 0===l?void 0:l.from)&&m.toFrame===(null===l||void 0===l?void 0:l.to)){O=m;break}}const u=m.getAnimatables();for(let b=0;b<u.length;b++){const m=u[b].animations;if(m)for(let l=0;l<m.length;l++)Z.e.MakeAnimationAdditive(m[l],S,h)}return O&&(O.isAdditive=!0),m}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(m){this._meshesWithPoseMatrix.push(m)}_unregisterMeshWithPoseMatrix(m){const S=this._meshesWithPoseMatrix.indexOf(m);S>-1&&this._meshesWithPoseMatrix.splice(S,1)}_computeTransformMatrices(m,S){this.onBeforeComputeObservable.notifyObservers(this);for(let h=0;h<this.bones.length;h++){const l=this.bones[h];l._childUpdateId++;const M=l.getParent();if(M?l.getLocalMatrix().multiplyToRef(M.getFinalMatrix(),l.getFinalMatrix()):S?l.getLocalMatrix().multiplyToRef(S,l.getFinalMatrix()):l.getFinalMatrix().l(l.getLocalMatrix()),-1!==l._index){const S=null===l._index?h:l._index;l.getAbsoluteInverseBindMatrix().multiplyToArray(l.getFinalMatrix(),m,16*S)}}this._identity.copyToArray(m,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const m=this.sm().getRenderId();if(this._currentRenderId===m)return;this._currentRenderId=m}if(this._numBonesWithLinkedTransformNode>0)for(const m of this.bones)if(m._linkedTransformNode){const S=m._linkedTransformNode;m.position=S.position,S.rotationQuaternion?m.rotationQuaternion=S.rotationQuaternion:m.rotation=S.rotation,m.Ib=S.Ib}if(this.needInitialSkinMatrix)for(const m of this._meshesWithPoseMatrix){const S=m.getPoseMatrix();let h=this._isDirty;if(m._bonesTransformMatrices&&m._bonesTransformMatrices.length===16*(this.bones.length+1)||(m._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),h=!0),h){if(this._synchronizedWithMesh!==m){this._synchronizedWithMesh=m;for(const m of this.bones)if(!m.getParent()){m.getBindMatrix().multiplyToRef(S,M.TmpVectors.Matrix[1]),m._updateAbsoluteBindMatrices(M.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const S=4*(this.bones.length+1);m._transformMatrixTexture&&m._transformMatrixTexture.getSize().width===S||(m._transformMatrixTexture&&m._transformMatrixTexture.dispose(),m._transformMatrixTexture=I.d.CreateRGBATexture(m._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(m._bonesTransformMatrices,S),this.isUsingTextureForMatrices&&m._transformMatrixTexture&&m._transformMatrixTexture.update(m._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=I.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let m=0;m<this.bones.length;m++)this._animatables.push(this.bones[m])}return this._animatables}clone(m,S){const h=new n(m,S||m,this._scene);h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){const m=this.bones[l];let S=null;const M=m.getParent();if(M){const m=this.bones.indexOf(M);S=h.bones[m]}const O=new Y.d(m.name,h,S,m.getBindMatrix().clone(),m.getRestMatrix().clone());O._index=m._index,m._linkedTransformNode&&O.linkTransformNode(m._linkedTransformNode),E.e.DeepCopy(m.animations,O.animations)}if(this._ranges){h._ranges={};for(const m in this._ranges){const S=this._ranges[m];S&&(h._ranges[m]=S.clone())}}return this._isDirty=!0,h.prepare(!0),h}enableBlending(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const S of this.bones)for(const h of S.animations)h.enableBlending=!0,h.blendingSpeed=m}dispose(){if(this._meshesWithPoseMatrix.length=0,this.sm().stopAnimation(this),this.sm().removeSkeleton(this),this._parentContainer){const m=this._parentContainer.skeletons.indexOf(this);m>-1&&this._parentContainer.skeletons.splice(m,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const m={};m.name=this.name,m.id=this.id,this.dimensionsAtRest&&(m.dimensionsAtRest=this.dimensionsAtRest.DM()),m.bones=[],m.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let h=0;h<this.bones.length;h++){var S;const l=this.bones[h],M=l.getParent(),O={parentBoneIndex:M?this.bones.indexOf(M):-1,index:l.getIndex(),name:l.name,id:l.id,matrix:l.getBindMatrix().DM(),rest:l.getRestMatrix().DM(),linkedTransformNodeId:null===(S=l.getTransformNode())||void 0===S?void 0:S.id};m.bones.push(O),l.length&&(O.length=l.length),l.metadata&&(O.metadata=l.metadata),l.animations&&l.animations.length>0&&(O.animation=l.animations[0].serialize()),m.ranges=[];for(const S in this._ranges){const h=this._ranges[S];if(!h)continue;const l={};l.name=S,l.from=h.from,l.to=h.to,m.ranges.push(l)}}return m}static Parse(m,S){const h=new n(m.name,m.id,S);let l;for(m.dimensionsAtRest&&(h.dimensionsAtRest=M.nS.yS(m.dimensionsAtRest)),h.needInitialSkinMatrix=m.needInitialSkinMatrix,l=0;l<m.bones.length;l++){const S=m.bones[l],O=m.bones[l].index;let u=null;S.parentBoneIndex>-1&&(u=h.bones[S.parentBoneIndex]);const b=S.rest?M.Matrix.yS(S.rest):null,q=new Y.d(S.name,h,u,M.Matrix.yS(S.matrix),b,null,O);void 0!==S.id&&null!==S.id&&(q.id=S.id),S.length&&(q.length=S.length),S.metadata&&(q.metadata=S.metadata),S.animation&&q.animations.push(Z.e.Parse(S.animation)),void 0!==S.linkedTransformNodeId&&null!==S.linkedTransformNodeId&&(h._hasWaitingData=!0,q._waitingTransformNodeId=S.linkedTransformNodeId)}if(m.ranges)for(l=0;l<m.ranges.length;l++){const S=m.ranges[l];h.createAnimationRange(S.name,S.from,S.to)}return h}computeAbsoluteMatrices(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||m)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(m)}getPoseMatrix(){let m=null;return this._meshesWithPoseMatrix.length>0&&(m=this._meshesWithPoseMatrix[0].getPoseMatrix()),m}sortBones(){const m=[],S=new Array(this.bones.length);for(let h=0;h<this.bones.length;h++)this._sortBones(h,m,S);this.bones=m}_sortBones(m,S,h){if(h[m])return;h[m]=!0;const l=this.bones[m];if(!l)return;void 0===l._index&&(l._index=m);const M=l.getParent();M&&this._sortBones(this.bones.indexOf(M),S,h),S.push(l)}setCurrentPoseAsRest(){for(const m of this.bones)m.setCurrentPoseAsRest()}}var L=h(11629),U=h(11798),H=h(11321),R=h(11712),y=h(11410),o=h(11763),s=h(11726),v=h(11751),T=h(11850),X=h(11434),g=h(12931);class G{set areUpdatesFrozen(m){m?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new X.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,m||(m=B.d.LastCreatedScene),this._scene=m,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const m=this._scene.getEngine().getCaps();this._canUseTextureForTargets=m.canUseGLVertexID&&m.textureFloat&&m.maxVertexTextureImageUnits>0&&m.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return G.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?G.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(m){this._numMaxInfluencers!==m&&(this._numMaxInfluencers=m,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(m){this._useTextureToStoreTargets!==m&&(this._useTextureToStoreTargets=m,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var m;return G.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(m=this._scene)&&void 0!==m&&m.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(m){return this._activeTargets.data[m]}getTarget(m){return this._targets[m]}getTargetByName(m){for(const S of this._targets)if(S.name===m)return S;return null}addTarget(m){this._targets.push(m),this._targetInfluenceChangedObservers.push(m.onInfluenceChanged.add((m=>{this.areUpdatesFrozen&&m&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(m)}))),this._targetDataLayoutChangedObservers.push(m._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(m){const S=this._targets.indexOf(m);S>=0&&(this._targets.splice(S,1),m.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(S,1)[0]),m._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(S,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(m)}_bind(m){m.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),m.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),m.setTexture("morphTargets",this._targetStoreTexture),m.setInt("morphTargetCount",this.numInfluencers)}clone(){const m=new G(this._scene);for(const S of this._targets)m.addTarget(S.clone());return m.enablePositionMorphing=this.enablePositionMorphing,m.enableNormalMorphing=this.enableNormalMorphing,m.enableTangentMorphing=this.enableTangentMorphing,m.enableUVMorphing=this.enableUVMorphing,m.enableUV2Morphing=this.enableUV2Morphing,m.enableColorMorphing=this.enableColorMorphing,m}serialize(){const m={};m.id=this.uniqueId,m.targets=[];for(const S of this._targets)m.targets.push(S.serialize());return m}_syncActiveTargets(){let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const S=!!this._targetStoreTexture,h=this.isUsingTextureForTargets;(this._mustSynchronize||S!==h)&&(this._mustSynchronize=!1,this.synchronize());let l=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let M=-1;for(const O of this._targets)if(M++,0!==O.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=G.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(O),this._morphTargetTextureIndices[l]=M,this._tempInfluences[l++]=O.influence}this._morphTargetTextureIndices.length!==l&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,l)),this._influences&&this._influences.length===l||(this._influences=new Float32Array(l));for(let O=0;O<l;O++)this._influences[O]=this._tempInfluences[O];if(m&&this._scene)for(const O of this._scene.meshes)O.morphTargetManager===this&&(h?O._markSubMeshesAsAttributesDirty():O._syncGeometryWithMorphTargetManager())}synchronize(){var m;if(!this._scene||this.areUpdatesFrozen)return;const S=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(m=this._targetStoreTexture)||void 0===m||m.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>S.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const h of this._targets){this._supportsPositions=this._supportsPositions&&h.hasPositions,this._supportsNormals=this._supportsNormals&&h.hasNormals,this._supportsTangents=this._supportsTangents&&h.hasTangents,this._supportsUVs=this._supportsUVs&&h.hasUVs,this._supportsUV2s=this._supportsUV2s&&h.hasUV2s,this._supportsColors=this._supportsColors&&h.hasColors;const m=h.vertexCount;if(0===this._vertexCount)this._vertexCount=m;else if(this._vertexCount!==m)return void D.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${h.name}": ${m}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const m=S.getCaps().maxTextureSize;this._textureWidth>m&&(this._textureHeight=Math.ceil(this._textureWidth/m),this._textureWidth=m);const h=this._targets.length,l=new Float32Array(h*this._textureWidth*this._textureHeight*4);let M=0;for(let S=0;S<h;S++){const m=this._targets[S],h=m.getPositions(),O=m.getNormals(),u=m.getUVs(),b=m.getTangents(),q=m.getUV2s(),Y=m.getColors();M=S*this._textureWidth*this._textureHeight*4;for(let S=0;S<this._vertexCount;S++)this._supportsPositions&&h&&(l[M]=h[3*S],l[M+1]=h[3*S+1],l[M+2]=h[3*S+2],M+=4),this._supportsNormals&&O&&(l[M]=O[3*S],l[M+1]=O[3*S+1],l[M+2]=O[3*S+2],M+=4),this._supportsUVs&&u&&(l[M]=u[2*S],l[M+1]=u[2*S+1],M+=4),this._supportsTangents&&b&&(l[M]=b[3*S],l[M+1]=b[3*S+1],l[M+2]=b[3*S+2],M+=4),this._supportsUV2s&&q&&(l[M]=q[2*S],l[M+1]=q[2*S+1],M+=4),this._supportsColors&&Y&&(l[M]=Y[4*S],l[M+1]=Y[4*S+1],l[M+2]=Y[4*S+2],l[M+3]=Y[4*S+3],M+=4)}this._targetStoreTexture=g.d.CreateRGBATexture(l,this._textureWidth,this._textureHeight,h,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const h of this._scene.meshes)h.morphTargetManager===this&&h._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const m=this._parentContainer.morphTargetManagers.indexOf(this);m>-1&&this._parentContainer.morphTargetManagers.splice(m,1),this._parentContainer=null}for(const m of this._targets)this._scene.stopAnimation(m)}}static Parse(m,S){const h=new G(S);for(const l of m.targets)h.addTarget(T.c.Parse(l,S));return h}}G.EnableTextureStorage=!0,G.MaxActiveMorphTargetsInVertexAttributeMode=8,G.ConstantTargetCountForTextureMode=0;var e=h(12988),a=h(11205),x=h(11648);const P=new Map,d=P;function J(m,S,h){N(m)&&D.e.Warn(`Extension with the name '${m}' already exists`),P.set(m,{isGLTFExtension:S,factory:h})}function N(m){return P.delete(m)}var j=h(12999),K=h(11912),c=h(11419);class f{static Get(m,S,h){if(!S||void 0==h||!S[h])throw new Error(`${m}: Failed to find index (${h})`);return S[h]}static TryGet(m,S){return m&&void 0!=S&&m[S]?m[S]:null}static Assign(m){if(m)for(let S=0;S<m.length;S++)m[S].index=S}}function p(m){if(m.min&&m.max){const S=m.min,h=m.max,l=M.TmpVectors.nS[0].Yb(S[0],S[1],S[2]),O=M.TmpVectors.nS[1].Yb(h[0],h[1],h[2]);if(m.normalized&&5126!==m.componentType){let S=1;switch(m.componentType){case 5120:S=127;break;case 5121:S=255;break;case 5122:S=32767;break;case 5123:S=65535}const h=1/S;l.scaleInPlace(h),O.scaleInPlace(h)}return new x.d(l,O)}return null}class k{static RegisterExtension(m,S){J(m,!1,S)}static UnregisterExtension(m){return N(m)}get th(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(m){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=m}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((m=>m.dispose&&m.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(m,S,h,l,M,O){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=S,this._assetContainer=h,this._loadData(l);let O=null;if(m){const S={};if(this._gltf.nodes)for(const m of this._gltf.nodes)m.name&&(S[m.name]=m.index);O=(m instanceof Array?m:[m]).map((m=>{const h=S[m];if(void 0===h)throw new Error(`Failed to find node '${m}'`);return h}))}return await this._loadAsync(M,u,O,(()=>({meshes:this._getMeshes(),UZ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=m,this._loadData(S),await this._loadAsync(h,M,null,(()=>{}))}async _loadAsync(m,S,h,l){return await Promise.resolve().then((async()=>{this._rootUrl=m,this._uniqueRootUrl=!m.startsWith("file:")&&S?m:`${m}${Date.now()}/`,this._fileName=S,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const M=`${e.l[e.l.LOADING]} => ${e.l[e.l.READY]}`,O=`${e.l[e.l.LOADING]} => ${e.l[e.l.COMPLETE]}`;this._parent._startPerformanceCounter(M),this._parent._startPerformanceCounter(O),this._parent._setState(e.l.LOADING),this._extensionsOnLoading();const b=new Array;if(!this.parent.loadOnlyMaterials)if(h)b.push(this.loadSceneAsync("/nodes",{nodes:h,index:-1}));else if(void 0!=this._gltf.US||this._gltf.scenes&&this._gltf.scenes[0]){const m=f.Get("/scene",this._gltf.scenes,this._gltf.US||0);b.push(this.loadSceneAsync(`/scenes/${m.index}`,m))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let m=0;m<this._gltf.materials.length;++m){const S=this._gltf.materials[m],h="/materials/"+m,l=L.e.TriangleFillMode;b.push(this._loadMaterialAsync(h,S,null,l,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&b.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&b.push(this._compileShadowGeneratorsAsync());const q=Promise.all(b).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Bq(!0);for(const m of this._babylonScene.materials){const S=m;void 0!==S.maxSimultaneousLights&&(S.maxSimultaneousLights=Math.max(S.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(e.l.READY),this._skipStartAnimationStep||this._startAnimations(),l()}));return await q.then((m=>(this._parent._endPerformanceCounter(M),u.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(O),this._parent._setState(e.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(m=>{this._parent.onErrorObservable.notifyObservers(m),this._parent.onErrorObservable.clear(),this.dispose()}))})),m)))})).catch((m=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(m),this._parent.onErrorObservable.clear(),this.dispose()),m}))}_loadData(m){if(this._gltf=m.json,this._setupData(),m.bin){const S=this._gltf.buffers;if(S&&S[0]&&!S[0].uri){const h=S[0];(h.byteLength<m.bin.byteLength-3||h.byteLength>m.bin.byteLength)&&D.e.Warn(`Binary buffer length (${h.byteLength}) from JSON does not match chunk length (${m.bin.byteLength})`),this._bin=m.bin}else D.e.Warn("Unexpected BIN chunk")}}_setupData(){if(f.Assign(this._gltf.accessors),f.Assign(this._gltf.animations),f.Assign(this._gltf.buffers),f.Assign(this._gltf.bufferViews),f.Assign(this._gltf.cameras),f.Assign(this._gltf.images),f.Assign(this._gltf.materials),f.Assign(this._gltf.meshes),f.Assign(this._gltf.nodes),f.Assign(this._gltf.samplers),f.Assign(this._gltf.scenes),f.Assign(this._gltf.skins),f.Assign(this._gltf.textures),this._gltf.nodes){const m={};for(const h of this._gltf.nodes)if(h.children)for(const S of h.children)m[S]=h.index;const S=this._createRootNode();for(const h of this._gltf.nodes){const l=m[h.index];h.parent=void 0===l?S:this._gltf.nodes[l]}}}async _loadExtensionsAsync(){const m=[];if(d.forEach(((S,h)=>{var l;!1===(null===(l=this.parent.extensionOptions[h])||void 0===l?void 0:l.enabled)?S.isGLTFExtension&&this.isExtensionUsed(h)&&D.e.Warn(`Extension ${h} is used but has been explicitly disabled.`):S.isGLTFExtension&&!this.isExtensionUsed(h)||m.push((async()=>{const m=await S.factory(this);return m.name!==h&&D.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${m.name} !== ${h}`),this._parent.onExtensionLoadedObservable.notifyObservers(m),m})())})),this._extensions.push(...await Promise.all(m)),this._extensions.sort(((m,S)=>(m.order||Number.MAX_VALUE)-(S.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const h of this._gltf.extensionsRequired){if(!this._extensions.some((m=>m.name===h&&m.enabled))){var S;if(!1===(null===(S=this.parent.extensionOptions[h])||void 0===S?void 0:S.enabled))throw new Error(`Required extension ${h} is disabled`);throw new Error(`Required extension ${h} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new v.c("__root__",this._babylonScene);this._rootBabylonMesh=m,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Bq(!1);const S={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case e.i.AUTO:this._babylonScene.useRightHandedSystem||(S.rotation=[0,1,0,0],S.scale=[1,1,-1],k._LoadTransform(S,this._rootBabylonMesh));break;case e.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(m),S}loadSceneAsync(m,S){const h=this._extensionsLoadSceneAsync(m,S);if(h)return h;const l=new Array;if(this.logOpen(`${m} ${S.name||""}`),S.nodes)for(const M of S.nodes){const S=f.Get(`${m}/nodes/${M}`,this._gltf.nodes,M);l.push(this.loadNodeAsync(`/nodes/${S.index}`,S,(m=>{m.parent=this._rootBabylonMesh})))}for(const M of this._postSceneLoadActions)M();return l.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(l).then((()=>{}))}_forEachPrimitive(m,S){if(m._primitiveBabylonMeshes)for(const h of m._primitiveBabylonMeshes)S(h)}_getGeometries(){const m=[],S=this._gltf.nodes;if(S)for(const h of S)this._forEachPrimitive(h,(S=>{const h=S.ub;h&&-1===m.indexOf(h)&&m.push(h)}));return m}_getMeshes(){const m=[];this._rootBabylonMesh instanceof s.e&&m.push(this._rootBabylonMesh);const S=this._gltf.nodes;if(S)for(const h of S)this._forEachPrimitive(h,(S=>{m.push(S)}));return m}_getTransformNodes(){const m=[],S=this._gltf.nodes;if(S)for(const h of S)h._babylonTransformNode&&"Rb"===h._babylonTransformNode.getClassName()&&m.push(h._babylonTransformNode),h._babylonTransformNodeForSkin&&m.push(h._babylonTransformNodeForSkin);return m}_getSkeletons(){const m=[],S=this._gltf.skins;if(S)for(const h of S)h._data&&m.push(h._data.babylonSkeleton);return m}_getAnimationGroups(){const m=[],S=this._gltf.animations;if(S)for(const h of S)h._babylonAnimationGroup&&m.push(h._babylonAnimationGroup);return m}_startAnimations(){switch(this._parent.animationStartMode){case e.f.NONE:break;case e.f.FIRST:{const m=this._getAnimationGroups();0!==m.length&&m[0].start(!0);break}case e.f.ALL:{const m=this._getAnimationGroups();for(const S of m)S.start(!0);break}default:return void D.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadNodeAsync(m,S,h);if(l)return l;if(S._babylonTransformNode)throw new Error(`${m}: Invalid recursive node hierarchy`);const M=new Array;this.logOpen(`${m} ${S.name||""}`);const O=l=>{if(k.AddPointerMetadata(l,m),k._LoadTransform(S,l),void 0!=S.camera){const h=f.Get(`${m}/camera`,this._gltf.cameras,S.camera);M.push(this.loadCameraAsync(`/cameras/${h.index}`,h,(m=>{m.parent=l,this._babylonScene.useRightHandedSystem||(l.Ib.x=-1)})))}if(S.children)for(const h of S.children){const S=f.Get(`${m}/children/${h}`,this._gltf.nodes,h);M.push(this.loadNodeAsync(`/nodes/${S.index}`,S,(m=>{m.parent=l})))}h(l)},u=void 0!=S.mesh,b=this._parent.loadSkins&&void 0!=S.skin;if(!u||b){const m=S.name||`node${S.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new R.d(m,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==S.mesh?S._babylonTransformNode=h:S._babylonTransformNodeForSkin=h,O(h)}if(u)if(b){const h=f.Get(`${m}/mesh`,this._gltf.meshes,S.mesh);M.push(this._loadMeshAsync(`/meshes/${h.index}`,S,h,(h=>{const l=S._babylonTransformNodeForSkin;h.metadata=(0,K.b)(l.metadata,h.metadata||{});const O=f.Get(`${m}/skin`,this._gltf.skins,S.skin);M.push(this._loadSkinAsync(`/skins/${O.index}`,S,O,(m=>{this._forEachPrimitive(S,(S=>{S.skeleton=m})),this._postSceneLoadActions.push((()=>{if(void 0!=O.skeleton){const m=f.Get(`/skins/${O.index}/skeleton`,this._gltf.nodes,O.skeleton).parent;S.index===m.index?h.parent=l.parent:h.parent=m._babylonTransformNode}else h.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:l,skinnedNode:h})}))})))})))}else{const h=f.Get(`${m}/mesh`,this._gltf.meshes,S.mesh);M.push(this._loadMeshAsync(`/meshes/${h.index}`,S,h,O))}return this.logClose(),Promise.all(M).then((()=>(this._forEachPrimitive(S,(m=>{const S=m;!S.isAnInstance&&S.ub&&S.ub.useBoundingInfoFromGeometry?m.dm():m.refreshBoundingInfo(!0,!0)})),S._babylonTransformNode)))}_loadMeshAsync(m,S,h,l){const M=h.primitives;if(!M||!M.length)throw new Error(`${m}: Primitives are missing`);void 0==M[0].index&&f.Assign(M);const O=new Array;this.logOpen(`${m} ${h.name||""}`);const u=S.name||`node${S.index}`;if(1===M.length){const l=h.primitives[0];O.push(this._loadMeshPrimitiveAsync(`${m}/primitives/${l.index}`,u,S,h,l,(m=>{S._babylonTransformNode=m,S._primitiveBabylonMeshes=[m]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,S._babylonTransformNode=new R.d(u,this._babylonScene),S._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._primitiveBabylonMeshes=[];for(const l of M)O.push(this._loadMeshPrimitiveAsync(`${m}/primitives/${l.index}`,`${u}_primitive${l.index}`,S,h,l,(m=>{m.parent=S._babylonTransformNode,S._primitiveBabylonMeshes.push(m)})))}return l(S._babylonTransformNode),this.logClose(),Promise.all(O).then((()=>S._babylonTransformNode))}_loadMeshPrimitiveAsync(m,S,h,l,M,O){const u=this._extensionsLoadMeshPrimitiveAsync(m,S,h,l,M,O);if(u)return u;this.logOpen(`${m}`);const b=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==h.skin&&!l.primitives[0].targets;let q,Y;if(b&&M._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,q=M._instanceData.babylonSourceMesh.createInstance(S),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y=M._instanceData.promise;else{const O=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new v.c(S,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.sideOrientation=this._babylonScene.useRightHandedSystem?L.e.CounterClockWiseSideOrientation:L.e.ClockWiseSideOrientation,this._createMorphTargets(m,h,l,M,u),O.push(this._loadVertexDataAsync(m,M,u).then((async S=>await this._loadMorphTargetsAsync(m,M,u,S).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,S.xm(u),S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const V=k._GetDrawMode(m,M.mode);if(void 0==M.material){let m=this._defaultBabylonMaterialData[V];m||(m=this._createDefaultMaterial("__GLTFLoader._default",V),this._parent.onMaterialLoadedObservable.notifyObservers(m),this._defaultBabylonMaterialData[V]=m),u.material=m}else if(!this.parent.skipMaterials){const S=f.Get(`${m}/material`,this._gltf.materials,M.material);O.push(this._loadMaterialAsync(`/materials/${S.index}`,S,u,V,(m=>{u.material=m})))}Y=Promise.all(O),b&&(M._instanceData={babylonSourceMesh:u,promise:Y}),q=u}return k.AddPointerMetadata(q,m),this._parent.onMeshLoadedObservable.notifyObservers(q),O(q),this.logClose(),Y.then((()=>q))}_loadVertexDataAsync(m,S,h){const l=this._extensionsLoadVertexDataAsync(m,S,h);if(l)return l;const M=S.attributes;if(!M)throw new Error(`${m}: Attributes are missing`);const O=new Array,u=new o.e(h.name,this._babylonScene);if(void 0==S.indices)h.isUnIndexed=!0;else{const h=f.Get(`${m}/indices`,this._gltf.accessors,S.indices);O.push(this._loadIndicesAccessorAsync(`/accessors/${h.index}`,h).then((m=>{u.setIndices(m)})))}const b=(S,l,b)=>{if(void 0==M[S])return;h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(l)&&h._delayInfo.push(l);const q=f.Get(`${m}/attributes/${S}`,this._gltf.accessors,M[S]);O.push(this._loadVertexAccessorAsync(`/accessors/${q.index}`,q,l).then((m=>{if(m.getKind()===y.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!h.skeleton){const m=p(q);m&&(u._boundingInfo=m,u.useBoundingInfoFromGeometry=!0)}u.setVerticesBuffer(m,q.count)}))),l==y.f.MatricesIndicesExtraKind&&(h.numBoneInfluencers=8),b&&b(q)};return b("POSITION",y.f.PositionKind),b("NORMAL",y.f.NormalKind),b("TANGENT",y.f.TangentKind),b("TEXCOORD_0",y.f.UVKind),b("TEXCOORD_1",y.f.UV2Kind),b("TEXCOORD_2",y.f.UV3Kind),b("TEXCOORD_3",y.f.UV4Kind),b("TEXCOORD_4",y.f.UV5Kind),b("TEXCOORD_5",y.f.UV6Kind),b("JOINTS_0",y.f.MatricesIndicesKind),b("WEIGHTS_0",y.f.MatricesWeightsKind),b("JOINTS_1",y.f.MatricesIndicesExtraKind),b("WEIGHTS_1",y.f.MatricesWeightsExtraKind),b("COLOR_0",y.f.ColorKind,(m=>{"VEC4"===m.type&&(h.hasVertexAlpha=!0)})),Promise.all(O).then((()=>u))}_createMorphTargets(m,S,h,l,M){if(!l.targets||!this._parent.loadMorphTargets)return;if(void 0==S._numMorphTargets)S._numMorphTargets=l.targets.length;else if(l.targets.length!==S._numMorphTargets)throw new Error(`${m}: Primitives do not have the same number of targets`);const O=h.extras?h.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,M.morphTargetManager=new G(this._babylonScene),M.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.morphTargetManager.areUpdatesFrozen=!0;for(let u=0;u<l.targets.length;u++){const m=S.weights?S.weights[u]:h.weights?h.weights[u]:0,l=O?O[u]:`morphTarget${u}`;M.morphTargetManager.addTarget(new T.c(l,m,M.sm()))}}_loadMorphTargetsAsync(m,S,h,l){if(!S.targets||!this._parent.loadMorphTargets)return Promise.resolve();const M=new Array,O=h.morphTargetManager;for(let u=0;u<O.numTargets;u++){const h=O.getTarget(u);M.push(this._loadMorphTargetVertexDataAsync(`${m}/targets/${u}`,l,S.targets[u],h))}return Promise.all(M).then((()=>{O.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(m,S,h,l){const M=new Array,O=(l,O,u)=>{if(void 0==h[l])return;const b=S.getVertexBuffer(O);if(!b)return;const q=f.Get(`${m}/${l}`,this._gltf.accessors,h[l]);M.push(this._loadFloatAccessorAsync(`/accessors/${q.index}`,q).then((m=>{u(b,m)})))};return O("POSITION",y.f.PositionKind,((m,S)=>{const h=new Float32Array(S.length);m.forEach(S.length,((m,l)=>{h[l]=S[l]+m})),l.setPositions(h)})),O("NORMAL",y.f.NormalKind,((m,S)=>{const h=new Float32Array(S.length);m.forEach(h.length,((m,l)=>{h[l]=S[l]+m})),l.setNormals(h)})),O("TANGENT",y.f.TangentKind,((m,S)=>{const h=new Float32Array(S.length/3*4);let M=0;m.forEach(S.length/3*4,((m,l)=>{(l+1)%4!==0&&(h[M]=S[M]+m,M++)})),l.setTangents(h)})),O("TEXCOORD_0",y.f.UVKind,((m,S)=>{const h=new Float32Array(S.length);m.forEach(S.length,((m,l)=>{h[l]=S[l]+m})),l.setUVs(h)})),O("TEXCOORD_1",y.f.UV2Kind,((m,S)=>{const h=new Float32Array(S.length);m.forEach(S.length,((m,l)=>{h[l]=S[l]+m})),l.setUV2s(h)})),O("COLOR_0",y.f.ColorKind,((S,h)=>{let M=null;const O=S.getSize();if(3===O){M=new Float32Array(h.length/3*4),S.forEach(h.length,((m,S)=>{const l=Math.floor(S/3),O=S%3;M[4*l+O]=h[3*l+O]+m}));for(let m=0;m<h.length/3;++m)M[4*m+3]=1}else{if(4!==O)throw new Error(`${m}: Invalid number of components (${O}) for COLOR_0 attribute`);M=new Float32Array(h.length),S.forEach(h.length,((m,S)=>{M[S]=h[S]+m}))}l.setColors(M)})),await Promise.all(M).then((()=>{}))}static _LoadTransform(m,S){if(void 0!=m.skin)return;let h=M.nS.Zero(),l=M.Quaternion.Identity(),O=M.nS.One();if(m.matrix){M.Matrix.yS(m.matrix).decompose(O,l,h)}else m.translation&&(h=M.nS.yS(m.translation)),m.rotation&&(l=M.Quaternion.yS(m.rotation)),m.scale&&(O=M.nS.yS(m.scale));S.position=h,S.rotationQuaternion=l,S.Ib=O}_loadSkinAsync(m,S,h,l){if(!this._parent.loadSkins)return Promise.resolve();const M=this._extensionsLoadSkinAsync(m,S,h);if(M)return M;if(h._data)return l(h._data.babylonSkeleton),h._data.promise;const O=`skeleton${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new n(h.name||O,O,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(m,h,u);const b=this._loadSkinInverseBindMatricesDataAsync(m,h).then((m=>{this._updateBoneMatrices(u,m)}));return h._data={babylonSkeleton:u,promise:b},l(u),b}_loadBones(m,S,h){if(void 0==S.skeleton||this._parent.alwaysComputeSkeletonRootNode){const h=this._findSkeletonRootNode(`${m}/joints`,S.joints);if(h)if(void 0===S.skeleton)S.skeleton=h.index;else{const l=(m,S)=>{for(;S.parent;S=S.parent)if(S.parent===m)return!0;return!1},M=f.Get(`${m}/skeleton`,this._gltf.nodes,S.skeleton);M===h||l(M,h)||(D.e.Warn(`${m}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),S.skeleton=h.index)}else D.e.Warn(`${m}: Failed to find common root`)}const l={};for(const M of S.joints){const O=f.Get(`${m}/joints/${M}`,this._gltf.nodes,M);this._loadBone(O,S,h,l)}}_findSkeletonRootNode(m,S){if(0===S.length)return null;const h={};for(const M of S){const S=[];let l=f.Get(`${m}/${M}`,this._gltf.nodes,M);for(;-1!==l.index;)S.unshift(l),l=l.parent;h[M]=S}let l=null;for(let M=0;;++M){let m=h[S[0]];if(M>=m.length)return l;const O=m[M];for(let u=1;u<S.length;++u)if(m=h[S[u]],M>=m.length||O!==m[M])return l;l=O}}_loadBone(m,S,h,l){m._isJoint=!0;let M=l[m.index];if(M)return M;let O=null;m.index!==S.skeleton&&(m.parent&&-1!==m.parent.index?O=this._loadBone(m.parent,S,h,l):void 0!==S.skeleton&&D.e.Warn(`/skins/${S.index}/skeleton: Skeleton node is not a common root`));const u=S.joints.indexOf(m.index);return M=new Y.d(m.name||`joint${m.index}`,h,O,this._getNodeMatrix(m),null,null,u),l[m.index]=M,this._postSceneLoadActions.push((()=>{M.linkTransformNode(m._babylonTransformNode)})),M}_loadSkinInverseBindMatricesDataAsync(m,S){if(void 0==S.inverseBindMatrices)return Promise.resolve(null);const h=f.Get(`${m}/inverseBindMatrices`,this._gltf.accessors,S.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)}_updateBoneMatrices(m,S){for(const h of m.bones){const m=M.Matrix.Identity(),l=h._index;S&&-1!==l&&(M.Matrix.FromArrayToRef(S,16*l,m),m.invertToRef(m));const O=h.getParent();O&&m.multiplyToRef(O.getAbsoluteInverseBindMatrix(),m),h.lb(m,!1,!1),h._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(m){return m.matrix?M.Matrix.yS(m.matrix):M.Matrix.Compose(m.scale?M.nS.yS(m.scale):M.nS.One(),m.rotation?M.Quaternion.yS(m.rotation):M.Quaternion.Identity(),m.translation?M.nS.yS(m.translation):M.nS.Zero())}loadCameraAsync(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadCameraAsync(m,S,h);if(l)return l;const O=new Array;this.logOpen(`${m} ${S.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new q.d(S.name||`camera${S.index}`,M.nS.Zero(),this._babylonScene,!1);switch(u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._babylonCamera=u,u.setTarget(new M.nS(0,0,-1)),S.type){case"perspective":{const h=S.perspective;if(!h)throw new Error(`${m}: Camera perspective properties are missing`);u.fov=h.yfov,u.hb=h.znear,u.maxZ=h.zfar||0;break}case"orthographic":if(!S.orthographic)throw new Error(`${m}: Camera orthographic properties are missing`);u.mode=b.d.ORTHOGRAPHIC_CAMERA,u.orthoLeft=-S.orthographic.xmag,u.orthoRight=S.orthographic.xmag,u.orthoBottom=-S.orthographic.ymag,u.orthoTop=S.orthographic.ymag,u.hb=S.orthographic.znear,u.maxZ=S.orthographic.zfar;break;default:throw new Error(`${m}: Invalid camera type (${S.type})`)}return k.AddPointerMetadata(u,m),this._parent.onCameraLoadedObservable.notifyObservers(u),h(u),this.logClose(),Promise.all(O).then((()=>u))}_loadAnimationsAsync(){const m=this._gltf.animations;if(!m)return Promise.resolve();const S=new Array;for(let h=0;h<m.length;h++){const l=m[h];S.push(this.loadAnimationAsync(`/animations/${l.index}`,l).then((m=>{0===m.targetedAnimations.length&&m.dispose()})))}return Promise.all(S).then((()=>{}))}loadAnimationAsync(m,S){const l=this._extensionsLoadAnimationAsync(m,S);return l||h.e(78).then(h.bind(h,14557)).then((h=>{let{AnimationGroup:l}=h;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new l(S.name||`animation${S.index}`,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._babylonAnimationGroup=M;const O=new Array;f.Assign(S.channels),f.Assign(S.samplers);for(const u of S.channels)O.push(this._loadAnimationChannelAsync(`${m}/channels/${u.index}`,m,S,u,((m,S)=>{m.animations=m.animations||[],m.animations.push(S),M.addTargetedAnimation(S,m)})));return Promise.all(O).then((()=>(M.normalize(0),M)))}))}async _loadAnimationChannelAsync(m,S,l,M,O){const u=this._extensionsLoadAnimationChannelAsync(m,S,l,M,O);if(u)return await u;if(void 0==M.target.node)return await Promise.resolve();const b=f.Get(`${m}/target/node`,this._gltf.nodes,M.target.node),q=M.target.path,Y="weights"===q;if(Y&&!b._numMorphTargets||!Y&&!b._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!Y&&!b._isJoint)return await Promise.resolve();let V;switch(await Promise.resolve().then(h.bind(h,13006)),q){case"translation":var I;V=null===(I=(0,j.h)("/nodes/{}/translation"))||void 0===I?void 0:I.interpolation;break;case"rotation":var Z;V=null===(Z=(0,j.h)("/nodes/{}/rotation"))||void 0===Z?void 0:Z.interpolation;break;case"scale":var C;V=null===(C=(0,j.h)("/nodes/{}/scale"))||void 0===C?void 0:C.interpolation;break;case"weights":var B;V=null===(B=(0,j.h)("/nodes/{}/weights"))||void 0===B?void 0:B.interpolation;break;default:throw new Error(`${m}/target/path: Invalid value (${M.target.path})`)}if(!V)throw new Error(`${m}/target/path: Could not find interpolation properties for target path (${M.target.path})`);const D={object:b,info:V};return await this._loadAnimationChannelFromTargetInfoAsync(m,S,l,M,D,O)}_loadAnimationChannelFromTargetInfoAsync(m,S,h,l,M,O){const u=this.parent.targetFps,b=1/u,q=f.Get(`${m}/sampler`,h.samplers,l.sampler);return this._loadAnimationSamplerAsync(`${S}/samplers/${l.sampler}`,q).then((m=>{let S=0;const q=M.object,Y=M.info;for(const M of Y){const Y=M.getStride(q),V=m.input,I=m.output,Z=new Array(V.length);let C=0;switch(m.interpolation){case"STEP":for(let m=0;m<V.length;m++){const S=M.getValue(q,I,C,1);C+=Y,Z[m]={frame:V[m]*u,value:S,interpolation:1}}break;case"CUBICSPLINE":for(let m=0;m<V.length;m++){const S=M.getValue(q,I,C,b);C+=Y;const h=M.getValue(q,I,C,1);C+=Y;const l=M.getValue(q,I,C,b);C+=Y,Z[m]={frame:V[m]*u,inTangent:S,value:h,outTangent:l}}break;case"LINEAR":for(let m=0;m<V.length;m++){const S=M.getValue(q,I,C,1);C+=Y,Z[m]={frame:V[m]*u,value:S}}}if(C>0){const m=`${h.name||`animation${h.index}`}_channel${l.index}_${S}`,b=M.buildAnimations(q,m,u,Z);for(const h of b)S++,O(h.babylonAnimatable,h.babylonAnimation)}}}))}_loadAnimationSamplerAsync(m,S){if(S._data)return S._data;const h=S.interpolation||"LINEAR";switch(h){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${m}/interpolation: Invalid value (${S.interpolation})`)}const l=f.Get(`${m}/input`,this._gltf.accessors,S.input),M=f.Get(`${m}/output`,this._gltf.accessors,S.output);return S._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${l.index}`,l),this._loadFloatAccessorAsync(`/accessors/${M.index}`,M)]).then((m=>{let[S,l]=m;return{input:S,interpolation:h,output:l}})),S._data}loadBufferAsync(m,S,h,l){const M=this._extensionsLoadBufferAsync(m,S,h,l);if(M)return M;if(!S._data)if(S.uri)S._data=this.loadUriAsync(`${m}/uri`,S,S.uri);else{if(!this._bin)throw new Error(`${m}: Uri is missing or the binary glTF is missing its binary chunk`);S._data=this._bin.readAsync(0,S.byteLength)}return S._data.then((S=>{try{return new Uint8Array(S.buffer,S.byteOffset+h,l)}catch(M){throw new Error(`${m}: ${M.message}`)}}))}loadBufferViewAsync(m,S){const h=this._extensionsLoadBufferViewAsync(m,S);if(h)return h;if(S._data)return S._data;const l=f.Get(`${m}/buffer`,this._gltf.buffers,S.buffer);return S._data=this.loadBufferAsync(`/buffers/${l.index}`,l,S.byteOffset||0,S.byteLength),S._data}_loadAccessorAsync(m,S,h){if(S._data)return S._data;const l=k._GetNumComponents(m,S.type),M=l*y.f.GetTypeByteLength(S.componentType),O=l*S.count;if(void 0==S.bufferView)S._data=Promise.resolve(new h(O));else{const u=f.Get(`${m}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((b=>{if(5126!==S.componentType||S.normalized||u.byteStride&&u.byteStride!==M){const m=new h(O);return y.f.ForEach(b,S.byteOffset||0,u.byteStride||M,l,S.componentType,m.length,S.normalized||!1,((S,h)=>{m[h]=S})),m}return k._GetTypedArray(m,S.componentType,b,S.byteOffset,O)}))}if(S.sparse){const O=S.sparse;S._data=S._data.then((u=>{const b=u,q=f.Get(`${m}/sparse/indices/bufferView`,this._gltf.bufferViews,O.indices.bufferView),Y=f.Get(`${m}/sparse/values/bufferView`,this._gltf.bufferViews,O.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${q.index}`,q),this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)]).then((u=>{let[q,Y]=u;const V=k._GetTypedArray(`${m}/sparse/indices`,O.indices.componentType,q,O.indices.byteOffset,O.count),I=l*O.count;let Z;if(5126!==S.componentType||S.normalized){const u=k._GetTypedArray(`${m}/sparse/values`,S.componentType,Y,O.values.byteOffset,I);Z=new h(I),y.f.ForEach(u,0,M,l,S.componentType,Z.length,S.normalized||!1,((m,S)=>{Z[S]=m}))}else Z=k._GetTypedArray(`${m}/sparse/values`,S.componentType,Y,O.values.byteOffset,I);let C=0;for(let m=0;m<V.length;m++){let S=V[m]*l;for(let m=0;m<l;m++)b[S++]=Z[C++]}return b}))}))}return S._data}_loadFloatAccessorAsync(m,S){return this._loadAccessorAsync(m,S,Float32Array)}_loadIndicesAccessorAsync(m,S){if("SCALAR"!==S.type)throw new Error(`${m}/type: Invalid value ${S.type}`);if(5121!==S.componentType&&5123!==S.componentType&&5125!==S.componentType)throw new Error(`${m}/componentType: Invalid value ${S.componentType}`);if(S._data)return S._data;if(S.sparse){const h=k._GetTypedArrayConstructor(`${m}/componentType`,S.componentType);S._data=this._loadAccessorAsync(m,S,h)}else{const h=f.Get(`${m}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>k._GetTypedArray(m,S.componentType,h,S.byteOffset,S.count)))}return S._data}_loadVertexBufferViewAsync(m){if(m._babylonBuffer)return m._babylonBuffer;const S=this._babylonScene.getEngine();return m._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((m=>new y.b(S,m,!1))),m._babylonBuffer}_loadVertexAccessorAsync(m,S,h){var l;if(null!==(l=S._babylonVertexBuffer)&&void 0!==l&&l[h])return S._babylonVertexBuffer[h];S._babylonVertexBuffer||(S._babylonVertexBuffer={});const M=this._babylonScene.getEngine();if(S.sparse||void 0==S.bufferView)S._babylonVertexBuffer[h]=this._loadFloatAccessorAsync(m,S).then((m=>new y.f(M,m,h,!1)));else{const l=f.Get(`${m}/bufferView`,this._gltf.bufferViews,S.bufferView);S._babylonVertexBuffer[h]=this._loadVertexBufferViewAsync(l).then((O=>{const u=k._GetNumComponents(m,S.type);return new y.f(M,O,h,!1,void 0,l.byteStride,void 0,S.byteOffset,u,S.componentType,S.normalized,!0,void 0,!0)}))}return S._babylonVertexBuffer[h]}_loadMaterialMetallicRoughnessPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return S&&(S.baseColorFactor?(h.albedoColor=O.RS.yS(S.baseColorFactor),h.alpha=S.baseColorFactor[3]):h.albedoColor=O.RS.White(),h.metallic=void 0==S.metallicFactor?1:S.metallicFactor,h.roughness=void 0==S.roughnessFactor?1:S.roughnessFactor,S.baseColorTexture&&l.push(this.loadTextureInfoAsync(`${m}/baseColorTexture`,S.baseColorTexture,(m=>{m.name=`${h.name} (Base Color)`,h.albedoTexture=m}))),S.metallicRoughnessTexture&&(S.metallicRoughnessTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${m}/metallicRoughnessTexture`,S.metallicRoughnessTexture,(m=>{m.name=`${h.name} (Metallic Roughness)`,h.metallicTexture=m}))),h.useMetallnessFromMetallicTextureBlue=!0,h.useRoughnessFromMetallicTextureGreen=!0,h.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(l).then((()=>{}))}_loadMaterialAsync(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const O=this._extensionsLoadMaterialAsync(m,S,h,l,M);if(O)return O;S._data=S._data||{};let u=S._data[l];if(!u){this.logOpen(`${m} ${S.name||""}`);const h=this.createMaterial(m,S,l);u={babylonMaterial:h,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(m,S,h)},S._data[l]=u,k.AddPointerMetadata(h,m),this._parent.onMaterialLoadedObservable.notifyObservers(h),this.logClose()}return h&&(u.babylonMeshes.push(h),h.Jh.addOnce((()=>{const m=u.babylonMeshes.indexOf(h);-1!==m&&u.babylonMeshes.splice(m,1)}))),M(u.babylonMaterial),u.promise.then((()=>u.babylonMaterial))}_createDefaultMaterial(m,S){this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new U.c(m,this._babylonScene);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.fillMode=S,h.enableSpecularAntiAliasing=!0,h.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,h.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,h.transparencyMode=U.c.PBRMATERIAL_OPAQUE,h.metallic=1,h.roughness=1,h}createMaterial(m,S,h){const l=this._extensionsCreateMaterial(m,S,h);if(l)return l;const M=S.name||`material${S.index}`;return this._createDefaultMaterial(M,h)}loadMaterialPropertiesAsync(m,S,h){const l=this._extensionsLoadMaterialPropertiesAsync(m,S,h);if(l)return l;const M=new Array;return M.push(this.loadMaterialBasePropertiesAsync(m,S,h)),S.pbrMetallicRoughness&&M.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${m}/pbrMetallicRoughness`,S.pbrMetallicRoughness,h)),this.loadMaterialAlphaProperties(m,S,h),Promise.all(M).then((()=>{}))}loadMaterialBasePropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return h.emissiveColor=S.emissiveFactor?O.RS.yS(S.emissiveFactor):new O.RS(0,0,0),S.doubleSided&&(h.qb=!1,h.twoSidedLighting=!0),S.normalTexture&&(S.normalTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${m}/normalTexture`,S.normalTexture,(m=>{m.name=`${h.name} (Normal)`,h.bumpTexture=m}))),h.invertNormalMapX=!this._babylonScene.useRightHandedSystem,h.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=S.normalTexture.scale&&h.bumpTexture&&(h.bumpTexture.level=S.normalTexture.scale),h.forceIrradianceInFragment=!0),S.occlusionTexture&&(S.occlusionTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${m}/occlusionTexture`,S.occlusionTexture,(m=>{m.name=`${h.name} (Occlusion)`,h.ambientTexture=m}))),h.useAmbientInGrayScale=!0,void 0!=S.occlusionTexture.strength&&(h.ambientTextureStrength=S.occlusionTexture.strength)),S.emissiveTexture&&l.push(this.loadTextureInfoAsync(`${m}/emissiveTexture`,S.emissiveTexture,(m=>{m.name=`${h.name} (Emissive)`,h.emissiveTexture=m}))),Promise.all(l).then((()=>{}))}loadMaterialAlphaProperties(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);switch(S.alphaMode||"OPAQUE"){case"OPAQUE":h.transparencyMode=U.c.PBRMATERIAL_OPAQUE,h.alpha=1;break;case"MASK":h.transparencyMode=U.c.PBRMATERIAL_ALPHATEST,h.alphaCutOff=void 0==S.alphaCutoff?.5:S.alphaCutoff,h.albedoTexture&&(h.albedoTexture.Sb=!0);break;case"BLEND":h.transparencyMode=U.c.PBRMATERIAL_ALPHABLEND,h.albedoTexture&&(h.albedoTexture.Sb=!0,h.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${m}/alphaMode: Invalid value (${S.alphaMode})`)}}loadTextureInfoAsync(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadTextureInfoAsync(m,S,h);if(l)return l;if(this.logOpen(`${m}`),S.texCoord>=6)throw new Error(`${m}/texCoord: Invalid value (${S.texCoord})`);const M=f.Get(`${m}/index`,this._gltf.textures,S.index);M._textureInfo=S;const O=this._loadTextureAsync(`/textures/${S.index}`,M,(l=>{l.coordinatesIndex=S.texCoord||0,k.AddPointerMetadata(l,m),this._parent.onTextureLoadedObservable.notifyObservers(l),h(l)}));return this.logClose(),O}_loadTextureAsync(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadTextureAsync(m,S,h);if(l)return l;this.logOpen(`${m} ${S.name||""}`);const M=void 0==S.sampler?k.DefaultSampler:f.Get(`${m}/sampler`,this._gltf.samplers,S.sampler),O=f.Get(`${m}/source`,this._gltf.images,S.source),u=this._createTextureAsync(m,M,O,h,void 0,!S._textureInfo.nonColorData);return this.logClose(),u}_createTextureAsync(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},O=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;const b=this._loadSampler(`/samplers/${S.index}`,S),q=new Array,Y=new l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V={noMipmap:b.noMipMaps,invertY:!1,samplingMode:b.samplingMode,t:()=>{this._disposed||Y.resolve()},onError:(S,h)=>{this._disposed||Y.reject(new Error(`${m}: ${h&&h.message?h.message:S||"Failed to load texture"}`))},mimeType:h.mimeType??(0,a.h)(h.uri??""),loaderOptions:O,useSRGBBuffer:!!u&&this._parent.useSRGBBuffers},I=new H.e(null,this._babylonScene,V);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.push(Y.promise),q.push(this.loadImageAsync(`/images/${h.index}`,h).then((m=>{const S=h.uri||`${this._fileName}#image${h.index}`,l=`data:${this._uniqueRootUrl}${S}`;I.updateURL(l,m);const M=I.getInternalTexture();M&&(M.label=h.name)}))),I.wrapU=b.wrapU,I.wrapV=b.wrapV,M(I),this._parent.useGltfTextureNames&&(I.name=h.name||h.uri||`image${h.index}`),Promise.all(q).then((()=>I))}_loadSampler(m,S){return S._data||(S._data={noMipMaps:9728===S.minFilter||9729===S.minFilter,samplingMode:k._GetTextureSamplingMode(m,S),wrapU:k._GetTextureWrapMode(`${m}/wrapS`,S.wrapS),wrapV:k._GetTextureWrapMode(`${m}/wrapT`,S.wrapT)}),S._data}loadImageAsync(m,S){if(!S._data){if(this.logOpen(`${m} ${S.name||""}`),S.uri)S._data=this.loadUriAsync(`${m}/uri`,S,S.uri);else{const h=f.Get(`${m}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}this.logClose()}return S._data}loadUriAsync(m,S,h){const l=this._extensionsLoadUriAsync(m,S,h);if(l)return l;if(!k._ValidateUri(h))throw new Error(`${m}: '${h}' is invalid`);if((0,a.k)(h)){const S=new Uint8Array((0,a.c)(h));return this.log(`${m}: Decoded ${h.substring(0,64)}... (${S.length} bytes)`),Promise.resolve(S)}return this.log(`${m}: Loading ${h}`),this._parent.preprocessUrlAsync(this._rootUrl+h).then((S=>new Promise(((l,M)=>{this._parent._loadFile(this._babylonScene,S,(S=>{this._disposed||(this.log(`${m}: Loaded ${h} (${S.byteLength} bytes)`),l(new Uint8Array(S)))}),!0,(S=>{M(new a.o(`${m}: Failed to load '${h}'${S?": "+S.status+" "+S.statusText:""}`,S))}))}))))}static AddPointerMetadata(m,S){m.metadata=m.metadata||{};const h=m._internalMetadata=m._internalMetadata||{},l=h.th=h.th||{};(l.pointers=l.pointers||[]).push(S)}static _GetTextureWrapMode(m,S){switch(S=void 0==S?10497:S){case 33071:return H.e.CLAMP_ADDRESSMODE;case 33648:return H.e.MIRROR_ADDRESSMODE;case 10497:return H.e.WRAP_ADDRESSMODE;default:return D.e.Warn(`${m}: Invalid value (${S})`),H.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(m,S){const h=void 0==S.magFilter?9729:S.magFilter,l=void 0==S.minFilter?9987:S.minFilter;if(9729===h)switch(l){case 9728:return H.e.LINEAR_NEAREST;case 9729:return H.e.LINEAR_LINEAR;case 9984:return H.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return H.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return H.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return H.e.LINEAR_LINEAR_MIPLINEAR;default:return D.e.Warn(`${m}/minFilter: Invalid value (${l})`),H.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==h&&D.e.Warn(`${m}/magFilter: Invalid value (${h})`),l){case 9728:return H.e.NEAREST_NEAREST;case 9729:return H.e.NEAREST_LINEAR;case 9984:return H.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return H.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return H.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return H.e.NEAREST_LINEAR_MIPLINEAR;default:return D.e.Warn(`${m}/minFilter: Invalid value (${l})`),H.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(m,S){try{return(0,c.r)(S)}catch(h){throw new Error(`${m}: ${h.message}`)}}static _GetTypedArray(m,S,h,l,M){const O=h.buffer;l=h.byteOffset+(l||0);const u=k._GetTypedArrayConstructor(`${m}/componentType`,S),b=y.f.GetTypeByteLength(S);return l%b!==0?(D.e.Warn(`${m}: Copying buffer as byte offset (${l}) is not a multiple of component type byte length (${b})`),new u(O.slice(l,l+M*b),0)):new u(O,l,M)}static _GetNumComponents(m,S){switch(S){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${m}: Invalid type (${S})`)}static _ValidateUri(m){return u.Tools.IsBase64(m)||-1===m.indexOf("..")}static _GetDrawMode(m,S){switch(void 0==S&&(S=4),S){case 0:return L.e.PointListDrawMode;case 1:return L.e.LineListDrawMode;case 2:return L.e.LineLoopDrawMode;case 3:return L.e.LineStripDrawMode;case 4:return L.e.TriangleFillMode;case 5:return L.e.TriangleStripDrawMode;case 6:return L.e.TriangleFanDrawMode}throw new Error(`${m}: Invalid mesh primitive mode (${S})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const m=new Array;if(this._gltf.materials)for(const S of this._gltf.materials)if(S._data)for(const h in S._data){const l=S._data[h];for(const S of l.babylonMeshes){S.Mb(!0);const h=l.babylonMaterial;m.push(h.forceCompilationAsync(S)),m.push(h.forceCompilationAsync(S,{useInstances:!0})),this._parent.useClipPlane&&(m.push(h.forceCompilationAsync(S,{clipPlane:!0})),m.push(h.forceCompilationAsync(S,{clipPlane:!0,useInstances:!0})))}}return Promise.all(m).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const m=new Array,S=this._babylonScene.lights;for(const h of S){const S=h.getShadowGenerator();S&&m.push(S.forceCompilationAsync())}return Promise.all(m).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(m){for(const S of this._extensions)S.enabled&&m(S)}_applyExtensions(m,S,h){for(const l of this._extensions)if(l.enabled){const M=`${l.name}.${S}`,O=m;O._activeLoaderExtensionFunctions=O._activeLoaderExtensionFunctions||{};const u=O._activeLoaderExtensionFunctions;if(!u[M]){u[M]=!0;try{const m=h(l);if(m)return m}finally{delete u[M]}}}return null}_extensionsOnLoading(){this._forEachExtensions((m=>m.onLoading&&m.onLoading()))}_extensionsOnReady(){this._forEachExtensions((m=>m.onReady&&m.onReady()))}_extensionsLoadSceneAsync(m,S){return this._applyExtensions(S,"loadScene",(h=>h.loadSceneAsync&&h.loadSceneAsync(m,S)))}_extensionsLoadNodeAsync(m,S,h){return this._applyExtensions(S,"loadNode",(l=>l.loadNodeAsync&&l.loadNodeAsync(m,S,h)))}_extensionsLoadCameraAsync(m,S,h){return this._applyExtensions(S,"loadCamera",(l=>l.loadCameraAsync&&l.loadCameraAsync(m,S,h)))}_extensionsLoadVertexDataAsync(m,S,h){return this._applyExtensions(S,"loadVertexData",(l=>l._loadVertexDataAsync&&l._loadVertexDataAsync(m,S,h)))}_extensionsLoadMeshPrimitiveAsync(m,S,h,l,M,O){return this._applyExtensions(M,"loadMeshPrimitive",(u=>u._loadMeshPrimitiveAsync&&u._loadMeshPrimitiveAsync(m,S,h,l,M,O)))}_extensionsLoadMaterialAsync(m,S,h,l,M){return this._applyExtensions(S,"loadMaterial",(O=>O._loadMaterialAsync&&O._loadMaterialAsync(m,S,h,l,M)))}_extensionsCreateMaterial(m,S,h){return this._applyExtensions(S,"createMaterial",(l=>l.createMaterial&&l.createMaterial(m,S,h)))}_extensionsLoadMaterialPropertiesAsync(m,S,h){return this._applyExtensions(S,"loadMaterialProperties",(l=>l.loadMaterialPropertiesAsync&&l.loadMaterialPropertiesAsync(m,S,h)))}_extensionsLoadTextureInfoAsync(m,S,h){return this._applyExtensions(S,"loadTextureInfo",(l=>l.loadTextureInfoAsync&&l.loadTextureInfoAsync(m,S,h)))}_extensionsLoadTextureAsync(m,S,h){return this._applyExtensions(S,"loadTexture",(l=>l._loadTextureAsync&&l._loadTextureAsync(m,S,h)))}_extensionsLoadAnimationAsync(m,S){return this._applyExtensions(S,"loadAnimation",(h=>h.loadAnimationAsync&&h.loadAnimationAsync(m,S)))}_extensionsLoadAnimationChannelAsync(m,S,h,l,M){return this._applyExtensions(h,"loadAnimationChannel",(O=>O._loadAnimationChannelAsync&&O._loadAnimationChannelAsync(m,S,h,l,M)))}_extensionsLoadSkinAsync(m,S,h){return this._applyExtensions(h,"loadSkin",(l=>l._loadSkinAsync&&l._loadSkinAsync(m,S,h)))}_extensionsLoadUriAsync(m,S,h){return this._applyExtensions(S,"loadUri",(l=>l._loadUriAsync&&l._loadUriAsync(m,S,h)))}_extensionsLoadBufferViewAsync(m,S){return this._applyExtensions(S,"loadBufferView",(h=>h.loadBufferViewAsync&&h.loadBufferViewAsync(m,S)))}_extensionsLoadBufferAsync(m,S,h,l){return this._applyExtensions(S,"loadBuffer",(M=>M.loadBufferAsync&&M.loadBufferAsync(m,S,h,l)))}static LoadExtensionAsync(m,S,h,l){if(!S.extensions)return null;const M=S.extensions[h];return M?l(`${m}/extensions/${h}`,M):null}static LoadExtraAsync(m,S,h,l){if(!S.extras)return null;const M=S.extras[h];return M?l(`${m}/extras/${h}`,M):null}isExtensionUsed(m){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(m)}logOpen(m){this._parent._logOpen(m)}logClose(){this._parent._logClose()}log(m){this._parent._log(m)}startPerformanceCounter(m){this._parent._startPerformanceCounter(m)}endPerformanceCounter(m){this._parent._endPerformanceCounter(m)}}k.DefaultSampler={index:-1},e.c._CreateGLTF2Loader=m=>new k(m);var r=h(13006),z=h(11520),Q=h(11377),F=h(13014),w=h(13023);class t extends w.d{constructor(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",m),this._texture=m.getEngine().createRawCubeTexture(S,h,l,M,O,u,b,q)}update(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,m,S,h,l,M)}updateRGBDAsync(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,F.o)(this._texture,m,S,h,l).then((()=>{}))}clone(){return Q.e.Clone((()=>{const m=this.sm(),S=this._texture,h=new t(m,S._bufferViewArray,S.width,S.format,S.type,S.generateMipMaps,S.invertY,S.samplingMode,S._compression);return 13===S.source&&h.updateRGBDAsync(S._bufferViewArrayArray,S._sphericalPolynomial,S._lodGenerationScale,S._lodGenerationOffset),h}),this)}}const A="EXT_lights_image_based";class i{constructor(m){this.name=A,this._loader=m,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null,delete this._lights}onLoading(){const m=this._loader.th.extensions;if(m&&m[this.name]){const S=m[this.name];this._lights=S.lights}}loadSceneAsync(m,S){return k.LoadExtensionAsync(m,S,this.name,(async(h,l)=>{this._loader._allMaterialsDirtyRequired=!0;const M=new Array;M.push(this._loader.loadSceneAsync(m,S)),this._loader.logOpen(`${h}`);const O=f.Get(`${h}/light`,this._lights,l.Dh);return M.push(this._loadLightAsync(`/extensions/${this.name}/lights/${l.Dh}`,O).then((m=>{this._loader.babylonScene.environmentTexture=m}))),this._loader.logClose(),await Promise.all(M).then((()=>{}))}))}_loadLightAsync(m,S){if(!S._loaded){const h=new Array;this._loader.logOpen(`${m}`);const l=new Array(S.specularImages.length);for(let M=0;M<S.specularImages.length;M++){const O=S.specularImages[M];l[M]=new Array(O.length);for(let S=0;S<O.length;S++){const u=`${m}/specularImages/${M}/${S}`;this._loader.logOpen(`${u}`);const b=O[S],q=f.Get(u,this._loader.th.images,b);h.push(this._loader.loadImageAsync(`/images/${b}`,q).then((m=>{l[M][S]=m}))),this._loader.logClose()}}this._loader.logClose(),S._loaded=Promise.all(h).then((async()=>{const h=new t(this._loader.babylonScene,null,S.specularImageSize);if(h.name=S.name||"environment",S._babylonTexture=h,void 0!=S.nb&&(h.level=S.nb),S.rotation){let m=M.Quaternion.yS(S.rotation);this._loader.babylonScene.useRightHandedSystem||(m=M.Quaternion.Inverse(m)),M.Matrix.FromQuaternionToRef(m,h.getReflectionTextureMatrix())}if(!S.irradianceCoefficients)throw new Error(`${m}: Irradiance coefficients are missing`);const O=z.e.yS(S.irradianceCoefficients);O.scaleInPlace(S.nb),O.convertIrradianceToLambertianRadiance();const u=z.i.FromHarmonics(O),b=(l.length-1)/Math.log2(S.specularImageSize);return await h.updateRGBDAsync(l,u,b)}))}return S._loaded.then((()=>S._babylonTexture))}}N(A),J(A,!0,(m=>new i(m)));h(11877);const W="EXT_mesh_gpu_instancing";class mm{constructor(m){this.name=W,this._loader=m,this.enabled=this._loader.isExtensionUsed(W)}dispose(){this._loader=null}loadNodeAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(m,l)=>{this._loader._disableInstancedMesh++;const O=this._loader.loadNodeAsync(`/nodes/${S.index}`,S,h);if(this._loader._disableInstancedMesh--,!S._primitiveBabylonMeshes)return await O;const u=new Array;let b=0;const q=S=>{if(void 0==l.attributes[S])return void u.push(Promise.resolve(null));const h=f.Get(`${m}/attributes/${S}`,this._loader.th.accessors,l.attributes[S]);if(u.push(this._loader._loadFloatAccessorAsync(`/accessors/${h.bufferView}`,h)),0===b)b=h.count;else if(b!==h.count)throw new Error(`${m}/attributes: Instance buffer accessors do not have the same count.`)};return q("TRANSLATION"),q("ROTATION"),q("SCALE"),await O.then((async m=>{const[h,l,O]=await Promise.all(u),q=new Float32Array(16*b);M.TmpVectors.nS[0].Yb(0,0,0),M.TmpVectors.Quaternion[0].Yb(0,0,0,1),M.TmpVectors.nS[1].Yb(1,1,1);for(let S=0;S<b;++S)h&&M.nS.FromArrayToRef(h,3*S,M.TmpVectors.nS[0]),l&&M.Quaternion.FromArrayToRef(l,4*S,M.TmpVectors.Quaternion[0]),O&&M.nS.FromArrayToRef(O,3*S,M.TmpVectors.nS[1]),M.Matrix.ComposeToRef(M.TmpVectors.nS[1],M.TmpVectors.Quaternion[0],M.TmpVectors.nS[0],M.TmpVectors.Matrix[0]),M.TmpVectors.Matrix[0].copyToArray(q,16*S);for(const M of S._primitiveBabylonMeshes)M.cI("matrix",q,16,!0);return m}))}))}}N(W),J(W,!0,(m=>new mm(m)));let Sm=0,hm=null;class lm{static get Default(){return lm._Default||(lm._Default=new lm),lm._Default}constructor(){const m=lm.Configuration.decoder;this._decoderModulePromise=u.Tools.LoadBabylonScriptAsync(m.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(m,S,h,l,M){await this._decoderModulePromise,0===Sm&&(MeshoptDecoder.useWorkers(1),Sm=1);const O=await MeshoptDecoder.decodeGltfBufferAsync(S,h,m,l,M);return null!==hm&&clearTimeout(hm),hm=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Sm=0,hm=null}),1e3),O}}lm.Configuration={decoder:{url:`${u.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},lm._Default=null;const Mm="EXT_meshopt_compression";class Om{constructor(m){this.name=Mm,this.enabled=m.isExtensionUsed(Mm),this._loader=m}dispose(){this._loader=null}loadBufferViewAsync(m,S){return k.LoadExtensionAsync(m,S,this.name,(async(h,l)=>{const M=S;if(M._meshOptData)return await M._meshOptData;const O=f.Get(`${m}/buffer`,this._loader.th.buffers,l.buffer);return M._meshOptData=this._loader.loadBufferAsync(`/buffers/${O.index}`,O,l.byteOffset||0,l.byteLength).then((async m=>await lm.Default.decodeGltfBufferAsync(m,l.count,l.byteStride,l.mode,l.filter))),await M._meshOptData}))}}N(Mm),J(Mm,!0,(m=>new Om(m)));const um="EXT_texture_webp";class bm{constructor(m){this.name=um,this._loader=m,this.enabled=m.isExtensionUsed(um)}dispose(){this._loader=null}_loadTextureAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=void 0==S.sampler?k.DefaultSampler:f.Get(`${m}/sampler`,this._loader.th.samplers,S.sampler),u=f.Get(`${l}/source`,this._loader.th.images,M.source);return await this._loader._createTextureAsync(m,O,u,(m=>{h(m)}),void 0,!S._textureInfo.nonColorData)}))}}N(um),J(um,!0,(m=>new bm(m)));const qm="EXT_texture_avif";class Ym{constructor(m){this.name=qm,this._loader=m,this.enabled=m.isExtensionUsed(qm)}dispose(){this._loader=null}_loadTextureAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=void 0==S.sampler?k.DefaultSampler:f.Get(`${m}/sampler`,this._loader.th.samplers,S.sampler),u=f.Get(`${l}/source`,this._loader.th.images,M.source);return await this._loader._createTextureAsync(m,O,u,(m=>{h(m)}),void 0,!S._textureInfo.nonColorData)}))}}N(qm),J(qm,!0,(m=>new Ym(m)));var Vm=h(13004),Im=h(11855);const Zm="EXT_lights_ies";class Cm{constructor(m){this.name=Zm,this._loader=m,this.enabled=this._loader.isExtensionUsed(Zm)}dispose(){this._loader=null,delete this._lights}onLoading(){const m=this._loader.th.extensions;if(m&&m[this.name]){const S=m[this.name];this._lights=S.lights,f.Assign(this._lights)}}loadNodeAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,u)=>{let b,q;this._loader._allMaterialsDirtyRequired=!0;const Y=await this._loader.loadNodeAsync(m,S,(m=>{q=f.Get(l,this._lights,u.Dh);const S=q.name||m.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,b=new Vm.d(S,M.nS.Zero(),M.nS.Backward(),0,1,this._loader.babylonScene),b.angle=Math.PI/2,b.innerAngle=0,b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,q._babylonLight=b,b.falloffType=Im.b.FALLOFF_GLTF,b.Lb=u.color?O.RS.yS(u.color):O.RS.White(),b.nb=u.multiplier||1,b.range=Number.MAX_VALUE,b.parent=m,this._loader._babylonLights.push(b),k.AddPointerMetadata(b,l),h(m)}));let V;if(q.uri)V=await this._loader.loadUriAsync(m,q,q.uri);else{const S=f.Get(`${m}/bufferView`,this._loader.th.bufferViews,q.bufferView);V=await this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return b.iesProfileTexture=new H.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,V,!0,void 0,void 0,void 0,void 0,".ies"),Y}))}}N(Zm),J(Zm,!0,(m=>new Cm(m)));var Bm=h(13033);const Dm="KHR_draco_mesh_compression";class Em{constructor(m){this.name=Dm,this.useNormalizedFlagFromAccessor=!0,this._loader=m,this.enabled=Bm.e.DefaultAvailable&&this._loader.isExtensionUsed(Dm)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{if(void 0!=S.mode&&4!==S.mode&&5!==S.mode)throw new Error(`${m}: Unsupported mode ${S.mode}`);const O={},u={},b=(m,l)=>{const b=M.attributes[m];if(void 0!=b&&(h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(l)&&h._delayInfo.push(l),O[l]=b,this.useNormalizedFlagFromAccessor)){const h=f.TryGet(this._loader.th.accessors,S.attributes[m]);h&&(u[l]=h.normalized||!1)}};b("POSITION",y.f.PositionKind),b("NORMAL",y.f.NormalKind),b("TANGENT",y.f.TangentKind),b("TEXCOORD_0",y.f.UVKind),b("TEXCOORD_1",y.f.UV2Kind),b("TEXCOORD_2",y.f.UV3Kind),b("TEXCOORD_3",y.f.UV4Kind),b("TEXCOORD_4",y.f.UV5Kind),b("TEXCOORD_5",y.f.UV6Kind),b("JOINTS_0",y.f.MatricesIndicesKind),b("WEIGHTS_0",y.f.MatricesWeightsKind),b("COLOR_0",y.f.ColorKind);const q=f.Get(l,this._loader.th.bufferViews,M.bufferView);return q._dracoBabylonGeometry||(q._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((async l=>{const M=this.dracoDecoder||Bm.e.Default,b=f.TryGet(this._loader.th.accessors,S.attributes.POSITION),q=this._loader.parent.alwaysComputeBoundingBox||h.skeleton||!b?null:p(b);return await M._decodeMeshToGeometryForGltfAsync(h.name,this._loader.babylonScene,l,O,u,q).catch((S=>{throw new Error(`${m}: ${S.message}`)}))}))),await q._dracoBabylonGeometry}))}}N(Dm),J(Dm,!0,(m=>new Em(m)));var nm=h(13040),Lm=h(11327),Um=h(11336),Hm=h(11718),Rm=h(11916),ym=h(11293);Hm.e.AddNodeConstructor("Light_Type_0",((m,S)=>()=>new om(m,M.nS.Zero(),S)));class om extends Rm.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(m){this._shadowAngle=m,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(m){const S=this.needCube();if(this._direction=m,this.needCube()!==S&&this._shadowGenerators){const m=this._shadowGenerators.values();for(let S=m.next();!0!==S.done;S=m.next()){S.value.recreateShadowMap()}}}constructor(m,S,h){super(m,h),this._shadowAngle=Math.PI/2,this.position=S}getClassName(){return"PointLight"}getTypeID(){return Im.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(m){if(this.direction)return super.getShadowDirection(m);switch(m){case 0:return new M.nS(1,0,0);case 1:return new M.nS(-1,0,0);case 2:return new M.nS(0,-1,0);case 3:return new M.nS(0,1,0);case 4:return new M.nS(0,0,1);case 5:return new M.nS(0,0,-1)}return M.nS.Zero()}_setDefaultShadowProjectionMatrix(m,S,h){const l=this.sm().activeCamera;if(!l)return;const O=void 0!==this.shadowMinZ?this.shadowMinZ:l.hb,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,b=this.sm().getEngine().useReverseDepthBuffer;M.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,b?u:O,b?O:u,m,!0,this._scene.getEngine().isNDCHalfZRange,void 0,b)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(m,S){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,S):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,S),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,S),this}transferToNodeMaterialEffect(m,S){return this.computeTransformedInformation()?m.setFloat3(S,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):m.setFloat3(S,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(m,S){m["POINTLIGHT"+S]=!0}}(0,Lm.d)([(0,Um.F)()],om.prototype,"shadowAngle",null),(0,ym.e)("BABYLON.PointLight",om);const sm="KHR_lights_punctual";class vm{constructor(m){this.name=sm,this._loader=m,this.enabled=this._loader.isExtensionUsed(sm)}dispose(){this._loader=null,delete this._lights}onLoading(){const m=this._loader.th.extensions;if(m&&m[this.name]){const S=m[this.name];this._lights=S.lights,f.Assign(this._lights)}}loadNodeAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,u)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(m,S,(m=>{let S;const b=f.Get(l,this._lights,u.Dh),q=b.name||m.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,b.type){case"directional":{const m=new nm.d(q,M.nS.Backward(),this._loader.babylonScene);m.position.Zb(0),S=m;break}case"point":S=new om(q,M.nS.Zero(),this._loader.babylonScene);break;case"spot":{const m=new Vm.d(q,M.nS.Zero(),M.nS.Backward(),0,1,this._loader.babylonScene);m.angle=2*(b.spot&&b.spot.outerConeAngle||Math.PI/4),m.innerAngle=2*(b.spot&&b.spot.innerConeAngle||0),S=m;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${b.type})`)}S._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,b._babylonLight=S,S.falloffType=Im.b.FALLOFF_GLTF,S.Lb=b.color?O.RS.yS(b.color):O.RS.White(),S.nb=void 0==b.nb?1:b.nb,S.range=void 0==b.range?Number.MAX_VALUE:b.range,S.parent=m,this._loader._babylonLights.push(S),k.AddPointerMetadata(S,l),h(m)})))))}}N(sm),J(sm,!0,(m=>new vm(m)));const Tm="KHR_materials_pbrSpecularGlossiness";class Xm{constructor(m){this.name=Tm,this.order=200,this._loader=m,this.enabled=this._loader.isExtensionUsed(Tm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialBasePropertiesAsync(m,S,h)),O.push(this._loadSpecularGlossinessPropertiesAsync(l,M,h)),this._loader.loadMaterialAlphaProperties(m,S,h),await Promise.all(O).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return h.metallic=null,h.roughness=null,S.diffuseFactor?(h.albedoColor=O.RS.yS(S.diffuseFactor),h.alpha=S.diffuseFactor[3]):h.albedoColor=O.RS.White(),h.reflectivityColor=S.specularFactor?O.RS.yS(S.specularFactor):O.RS.White(),h.microSurface=void 0==S.glossinessFactor?1:S.glossinessFactor,S.diffuseTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/diffuseTexture`,S.diffuseTexture,(m=>{m.name=`${h.name} (Diffuse)`,h.albedoTexture=m}))),S.specularGlossinessTexture&&(l.push(this._loader.loadTextureInfoAsync(`${m}/specularGlossinessTexture`,S.specularGlossinessTexture,(m=>{m.name=`${h.name} (Specular Glossiness)`,h.reflectivityTexture=m,h.reflectivityTexture.Sb=!0}))),h.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(l).then((()=>{}))}}N(Tm),J(Tm,!0,(m=>new Xm(m)));const gm="KHR_materials_unlit";class Gm{constructor(m){this.name=gm,this.order=210,this._loader=m,this.enabled=this._loader.isExtensionUsed(gm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async()=>await this._loadUnlitPropertiesAsync(m,S,h)))}_loadUnlitPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;h.unlit=!0;const M=S.pbrMetallicRoughness;return M&&(M.baseColorFactor?(h.albedoColor=O.RS.yS(M.baseColorFactor),h.alpha=M.baseColorFactor[3]):h.albedoColor=O.RS.White(),M.baseColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/baseColorTexture`,M.baseColorTexture,(m=>{m.name=`${h.name} (Base Color)`,h.albedoTexture=m})))),S.doubleSided&&(h.qb=!1,h.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(m,S,h),Promise.all(l).then((()=>{}))}}N(gm),J(gm,!0,(m=>new Gm(m)));const em="KHR_materials_clearcoat";class am{constructor(m){this.name=em,this.order=190,this._loader=m,this.enabled=this._loader.isExtensionUsed(em)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadClearCoatPropertiesAsync(l,M,h)),await Promise.all(O)}))}_loadClearCoatPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return h.clearCoat.isEnabled=!0,h.clearCoat.useRoughnessFromMainTexture=!1,h.clearCoat.remapF0OnInterfaceChange=!1,void 0!=S.clearcoatFactor?h.clearCoat.nb=S.clearcoatFactor:h.clearCoat.nb=0,S.clearcoatTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/clearcoatTexture`,S.clearcoatTexture,(m=>{m.name=`${h.name} (ClearCoat)`,h.clearCoat.texture=m}))),void 0!=S.clearcoatRoughnessFactor?h.clearCoat.roughness=S.clearcoatRoughnessFactor:h.clearCoat.roughness=0,S.clearcoatRoughnessTexture&&(S.clearcoatRoughnessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${m}/clearcoatRoughnessTexture`,S.clearcoatRoughnessTexture,(m=>{m.name=`${h.name} (ClearCoat Roughness)`,h.clearCoat.textureRoughness=m})))),S.clearcoatNormalTexture&&(S.clearcoatNormalTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${m}/clearcoatNormalTexture`,S.clearcoatNormalTexture,(m=>{m.name=`${h.name} (ClearCoat Normal)`,h.clearCoat.bumpTexture=m}))),h.invertNormalMapX=!h.sm().useRightHandedSystem,h.invertNormalMapY=h.sm().useRightHandedSystem,void 0!=S.clearcoatNormalTexture.scale&&(h.clearCoat.bumpTexture.level=S.clearcoatNormalTexture.scale)),Promise.all(l).then((()=>{}))}}N(em),J(em,!0,(m=>new am(m)));const xm="KHR_materials_iridescence";class Pm{constructor(m){this.name=xm,this.order=195,this._loader=m,this.enabled=this._loader.isExtensionUsed(xm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadIridescencePropertiesAsync(l,M,h)),await Promise.all(O).then((()=>{}))}))}_loadIridescencePropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return h.iridescence.isEnabled=!0,h.iridescence.nb=S.iridescenceFactor??0,h.iridescence.indexOfRefraction=S.iridescenceIor??S.iridescenceIOR??1.3,h.iridescence.minimumThickness=S.iridescenceThicknessMinimum??100,h.iridescence.maximumThickness=S.iridescenceThicknessMaximum??400,S.iridescenceTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/iridescenceTexture`,S.iridescenceTexture,(m=>{m.name=`${h.name} (Iridescence)`,h.iridescence.texture=m}))),S.iridescenceThicknessTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/iridescenceThicknessTexture`,S.iridescenceThicknessTexture,(m=>{m.name=`${h.name} (Iridescence Thickness)`,h.iridescence.thicknessTexture=m}))),Promise.all(l).then((()=>{}))}}N(xm),J(xm,!0,(m=>new Pm(m)));const dm="KHR_materials_anisotropy";class Jm{constructor(m){this.name=dm,this.order=195,this._loader=m,this.enabled=this._loader.isExtensionUsed(dm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadIridescencePropertiesAsync(l,M,h)),await Promise.all(O)}))}async _loadIridescencePropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;h.anisotropy.isEnabled=!0,h.anisotropy.nb=S.anisotropyStrength??0,h.anisotropy.angle=S.anisotropyRotation??0,S.anisotropyTexture&&(S.anisotropyTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${m}/anisotropyTexture`,S.anisotropyTexture,(m=>{m.name=`${h.name} (Anisotropy Intensity)`,h.anisotropy.texture=m})))),await Promise.all(l)}}N(dm),J(dm,!0,(m=>new Jm(m)));const Nm="KHR_materials_emissive_strength";class jm{constructor(m){this.name=Nm,this.order=170,this._loader=m,this.enabled=this._loader.isExtensionUsed(Nm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>await this._loader.loadMaterialPropertiesAsync(m,S,h).then((()=>{this._loadEmissiveProperties(l,M,h)}))))}_loadEmissiveProperties(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);void 0!==S.emissiveStrength&&(h.emissiveIntensity=S.emissiveStrength)}}N(Nm),J(Nm,!0,(m=>new jm(m)));const Km="KHR_materials_sheen";class cm{constructor(m){this.name=Km,this.order=190,this._loader=m,this.enabled=this._loader.isExtensionUsed(Km)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadSheenPropertiesAsync(l,M,h)),await Promise.all(O).then((()=>{}))}))}_loadSheenPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return h.sheen.isEnabled=!0,h.sheen.nb=1,void 0!=S.sheenColorFactor?h.sheen.color=O.RS.yS(S.sheenColorFactor):h.sheen.color=O.RS.Black(),S.sheenColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/sheenColorTexture`,S.sheenColorTexture,(m=>{m.name=`${h.name} (Sheen Color)`,h.sheen.texture=m}))),void 0!==S.sheenRoughnessFactor?h.sheen.roughness=S.sheenRoughnessFactor:h.sheen.roughness=0,S.sheenRoughnessTexture&&(S.sheenRoughnessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${m}/sheenRoughnessTexture`,S.sheenRoughnessTexture,(m=>{m.name=`${h.name} (Sheen Roughness)`,h.sheen.textureRoughness=m})))),h.sheen.albedoScaling=!0,h.sheen.useRoughnessFromMainTexture=!1,Promise.all(l).then((()=>{}))}}N(Km),J(Km,!0,(m=>new cm(m)));var fm=h(11785);const pm="KHR_materials_specular";class km{constructor(m){this.name=pm,this.order=190,this._loader=m,this.enabled=this._loader.isExtensionUsed(pm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;if(O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadSpecularPropertiesAsync(l,M,h)),M.extensions&&M.extensions.EXT_materials_specular_edge_color&&h instanceof U.c){M.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(h.brdf.dielectricSpecularModel=fm.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,h.brdf.conductorSpecularModel=fm.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(O).then((()=>{}))}))}_loadSpecularPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return void 0!==S.specularFactor&&(h.metallicF0Factor=S.specularFactor),void 0!==S.specularColorFactor&&(h.metallicReflectanceColor=O.RS.yS(S.specularColorFactor)),S.specularTexture&&(S.specularTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${m}/specularTexture`,S.specularTexture,(m=>{m.name=`${h.name} (Specular)`,h.metallicReflectanceTexture=m,h.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),S.specularColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/specularColorTexture`,S.specularColorTexture,(m=>{m.name=`${h.name} (Specular Color)`,h.reflectanceTexture=m}))),Promise.all(l).then((()=>{}))}}N(pm),J(pm,!0,(m=>new km(m)));const rm="KHR_materials_ior";class zm{constructor(m){this.name=rm,this.order=180,this._loader=m,this.enabled=this._loader.isExtensionUsed(rm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadIorPropertiesAsync(l,M,h)),await Promise.all(O).then((()=>{}))}))}_loadIorPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);return void 0!==S.ior?h.indexOfRefraction=S.ior:h.indexOfRefraction=zm._DEFAULT_IOR,Promise.resolve()}}zm._DEFAULT_IOR=1.5,N(rm),J(rm,!0,(m=>new zm(m)));const Qm="KHR_materials_variants";class Fm{constructor(m){this.name=Qm,this._loader=m,this.enabled=this._loader.isExtensionUsed(Qm)}dispose(){this._loader=null}static GetAvailableVariants(m){const S=this._GetExtensionMetadata(m);return S?Object.keys(S.variants):[]}getAvailableVariants(m){return Fm.GetAvailableVariants(m)}static SelectVariant(m,S){const h=this._GetExtensionMetadata(m);if(!h)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Qm} extension`);const l=m=>{const S=h.variants[m];if(S)for(const h of S)h.mesh.material=h.material};if(S instanceof Array)for(const M of S)l(M);else l(S);h.lastSelected=S}selectVariant(m,S){Fm.SelectVariant(m,S)}static Reset(m){const S=this._GetExtensionMetadata(m);if(!S)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Qm} extension`);for(const h of S.original)h.mesh.material=h.material;S.lastSelected=null}reset(m){Fm.Reset(m)}static GetLastSelectedVariant(m){const S=this._GetExtensionMetadata(m);if(!S)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Qm} extension`);return S.lastSelected}getLastSelectedVariant(m){return Fm.GetLastSelectedVariant(m)}static _GetExtensionMetadata(m){var S,h;return(null===m||void 0===m||null===(S=m._internalMetadata)||void 0===S||null===(h=S.th)||void 0===h?void 0:h[Qm])||null}onLoading(){const m=this._loader.th.extensions;if(m&&m[this.name]){const S=m[this.name];this._variants=S.variants}}onReady(){const m=this._loader.rootBabylonMesh;if(m){var S;const h=this._loader.parent.extensionOptions[Qm];null!==h&&void 0!==h&&h.defaultVariant&&Fm.SelectVariant(m,h.defaultVariant),null===h||void 0===h||null===(S=h.onLoaded)||void 0===S||S.call(h,{get variants(){return Fm.GetAvailableVariants(m)},get selectedVariant(){const S=Fm.GetLastSelectedVariant(m);return S?Array.isArray(S)?S[0]:S:Fm.GetAvailableVariants(m)[0]},set selectedVariant(S){Fm.SelectVariant(m,S)}})}}_loadMeshPrimitiveAsync(m,S,h,l,M,O){return k.LoadExtensionAsync(m,M,this.name,(async(u,b)=>{const q=new Array;return q.push(this._loader._loadMeshPrimitiveAsync(m,S,h,l,M,(S=>{if(O(S),S instanceof v.c){const h=k._GetDrawMode(m,M.mode),l=this._loader.rootBabylonMesh,O=l?l._internalMetadata=l._internalMetadata||{}:{},Y=O.th=O.th||{},V=Y[Qm]=Y[Qm]||{lastSelected:null,original:[],variants:{}};V.original.push({mesh:S,material:S.material});for(let m=0;m<b.mappings.length;++m){const M=b.mappings[m],O=f.Get(`${u}/mappings/${m}/material`,this._loader.th.materials,M.material);q.push(this._loader._loadMaterialAsync(`#/materials/${M.material}`,O,S,h,(m=>{for(let h=0;h<M.variants.length;++h){const O=M.variants[h],u=f.Get(`/extensions/${Qm}/variants/${O}`,this._variants,O);V.variants[u.name]=V.variants[u.name]||[],V.variants[u.name].push({mesh:S,material:m}),S.onClonedObservable.add((m=>{const h=m;let M=null,O=h;do{if(O=O.parent,!O)return;M=Fm._GetExtensionMetadata(O)}while(null===M);if(l&&M===Fm._GetExtensionMetadata(l)){O._internalMetadata={};for(const m in l._internalMetadata)O._internalMetadata[m]=l._internalMetadata[m];O._internalMetadata.th=[];for(const m in l._internalMetadata.th)O._internalMetadata.th[m]=l._internalMetadata.th[m];O._internalMetadata.th[Qm]={lastSelected:null,original:[],variants:{}};for(const m of M.original)O._internalMetadata.th[Qm].original.push({mesh:m.mesh,material:m.material});for(const m in M.variants)if(Object.prototype.hasOwnProperty.call(M.variants,m)){O._internalMetadata.th[Qm].variants[m]=[];for(const S of M.variants[m])O._internalMetadata.th[Qm].variants[m].push({mesh:S.mesh,material:S.material})}M=O._internalMetadata.th[Qm]}for(const l of M.original)l.mesh===S&&(l.mesh=h);for(const l of M.variants[u.name])l.mesh===S&&(l.mesh=h)}))}})))}}}))),await Promise.all(q).then((m=>{let[S]=m;return S}))}))}}N(Qm),J(Qm,!0,(m=>new Fm(m)));var wm=h(11398);class tm{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:fm.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(m,S){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...tm._GetDefaultOptions(),...m},this._scene=S,this._scene._transmissionHelper=this,this.onErrorObservable=new V.e,this._scene.Jh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(m){if(!Object.keys(m).filter((S=>this._options[S]!==m[S])).length)return;const S={...this._options,...m},h=this._options;this._options=S,S.renderSize===h.renderSize&&S.renderTargetTextureType===h.renderTargetTextureType&&S.generateMipmaps===h.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=S.samples,this._opaqueRenderTarget.lodGenerationScale=S.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=S.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(m){return!!m&&!!(m instanceof U.c&&m.subSurface.isRefractionEnabled)}_addMesh(m){this._materialObservers[m.uniqueId]=m.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),u.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(m.material)?(m.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(m)&&this._transparentMeshesCache.push(m)):-1===this._opaqueMeshesCache.indexOf(m)&&this._opaqueMeshesCache.push(m)}))}_removeMesh(m){m.onMaterialChangedObservable.remove(this._materialObservers[m.uniqueId]),delete this._materialObservers[m.uniqueId];let S=this._transparentMeshesCache.indexOf(m);-1!==S&&this._transparentMeshesCache.splice(S,1),S=this._opaqueMeshesCache.indexOf(m),-1!==S&&this._opaqueMeshesCache.splice(S,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(m){const S=this._transparentMeshesCache.indexOf(m),h=this._opaqueMeshesCache.indexOf(m);this._shouldRenderAsTransmission(m.material)?(m.material instanceof U.c&&(m.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==h?(this._opaqueMeshesCache.splice(h,1),this._transparentMeshesCache.push(m)):-1===S&&this._transparentMeshesCache.push(m)):-1!==S?(this._transparentMeshesCache.splice(S,1),this._opaqueMeshesCache.push(m)):-1===h&&this._opaqueMeshesCache.push(m)}_isRenderTargetValid(){var m;return null!==(null===(m=this._opaqueRenderTarget)||void 0===m?void 0:m.getInternalTexture())}_setupRenderTargets(){var m;let S;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new wm.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(m=this._options.clearColor)||void 0===m?void 0:m.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((m=>{S=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?m.clearColor.l(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(m.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=S}));for(const h of this._transparentMeshesCache)this._shouldRenderAsTransmission(h.material)&&(h.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Am="KHR_materials_transmission";class im{constructor(m){this.name=Am,this.order=175,this._loader=m,this.enabled=this._loader.isExtensionUsed(Am),this.enabled&&(m.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadTransparentPropertiesAsync(l,S,h,M)),await Promise.all(O).then((()=>{}))}))}_loadTransparentPropertiesAsync(m,S,h,l){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const M=h;if(M.subSurface.isRefractionEnabled=!0,M.subSurface.volumeIndexOfRefraction=1,M.subSurface.useAlbedoToTintRefraction=!0,void 0===l.transmissionFactor)return M.subSurface.refractionIntensity=0,M.subSurface.isRefractionEnabled=!1,Promise.resolve();{var O;M.subSurface.refractionIntensity=l.transmissionFactor;const m=M.sm();if(M.subSurface.refractionIntensity&&!m._transmissionHelper)new tm({},M.sm());else if(M.subSurface.refractionIntensity&&(null===(O=m._transmissionHelper)||void 0===O||!O._isRenderTargetValid())){var u;null===(u=m._transmissionHelper)||void 0===u||u._setupRenderTargets()}}return M.subSurface.minimumThickness=0,M.subSurface.maximumThickness=0,l.transmissionTexture?(l.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${m}/transmissionTexture`,l.transmissionTexture,void 0).then((m=>{m.name=`${h.name} (Transmission)`,M.subSurface.refractionIntensityTexture=m,M.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(Am),J(Am,!0,(m=>new im(m)));const Wm="KHR_materials_diffuse_transmission";class mS{constructor(m){this.name=Wm,this.order=174,this._loader=m,this.enabled=this._loader.isExtensionUsed(Wm),this.enabled&&(m.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadTranslucentPropertiesAsync(l,S,h,M)),await Promise.all(O).then((()=>{}))}))}_loadTranslucentPropertiesAsync(m,S,h,l){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const M=h;if(M.subSurface.isTranslucencyEnabled=!0,M.subSurface.volumeIndexOfRefraction=1,M.subSurface.minimumThickness=0,M.subSurface.maximumThickness=0,M.subSurface.useAlbedoToTintTranslucency=!1,void 0===l.diffuseTransmissionFactor)return M.subSurface.translucencyIntensity=0,M.subSurface.isTranslucencyEnabled=!1,Promise.resolve();M.subSurface.translucencyIntensity=l.diffuseTransmissionFactor;const u=new Array;return M.subSurface.useGltfStyleTextures=!0,l.diffuseTransmissionTexture&&(l.diffuseTransmissionTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${m}/diffuseTransmissionTexture`,l.diffuseTransmissionTexture).then((m=>{m.name=`${h.name} (Diffuse Transmission)`,M.subSurface.translucencyIntensityTexture=m})))),void 0!==l.diffuseTransmissionColorFactor?M.subSurface.translucencyColor=O.RS.yS(l.diffuseTransmissionColorFactor):M.subSurface.translucencyColor=O.RS.White(),l.diffuseTransmissionColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${m}/diffuseTransmissionColorTexture`,l.diffuseTransmissionColorTexture).then((m=>{m.name=`${h.name} (Diffuse Transmission Color)`,M.subSurface.translucencyColorTexture=m}))),Promise.all(u).then((()=>{}))}}N(Wm),J(Wm,!0,(m=>new mS(m)));const SS="KHR_materials_volume";class hS{constructor(m){this.name=SS,this.order=173,this._loader=m,this.enabled=this._loader.isExtensionUsed(SS),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadVolumePropertiesAsync(l,S,h,M)),await Promise.all(O).then((()=>{}))}))}_loadVolumePropertiesAsync(m,S,h,l){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);if(!h.subSurface.isRefractionEnabled&&!h.subSurface.isTranslucencyEnabled||!l.thicknessFactor)return Promise.resolve();h.subSurface.volumeIndexOfRefraction=h.indexOfRefraction;const M=void 0!==l.attenuationDistance?l.attenuationDistance:Number.MAX_VALUE;return h.subSurface.tintColorAtDistance=M,void 0!==l.attenuationColor&&3==l.attenuationColor.length&&h.subSurface.tintColor.Yb(l.attenuationColor[0],l.attenuationColor[1],l.attenuationColor[2]),h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=l.thicknessFactor,h.subSurface.useThicknessAsDepth=!0,l.thicknessTexture?(l.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${m}/thicknessTexture`,l.thicknessTexture).then((m=>{m.name=`${h.name} (Thickness)`,h.subSurface.thicknessTexture=m,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(SS),J(SS,!0,(m=>new hS(m)));const lS="KHR_materials_dispersion";class MS{constructor(m){this.name=lS,this.order=174,this._loader=m,this.enabled=this._loader.isExtensionUsed(lS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadDispersionPropertiesAsync(l,S,h,M)),await Promise.all(O).then((()=>{}))}))}_loadDispersionPropertiesAsync(m,S,h,l){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);return h.subSurface.isRefractionEnabled&&l.dispersion?(h.subSurface.isDispersionEnabled=!0,h.subSurface.dispersion=l.dispersion,Promise.resolve()):Promise.resolve()}}N(lS),J(lS,!0,(m=>new MS(m)));const OS="EXT_materials_diffuse_roughness";class uS{constructor(m){this.name=OS,this.order=190,this._loader=m,this.enabled=this._loader.isExtensionUsed(OS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(m,S,h)),O.push(this._loadDiffuseRoughnessPropertiesAsync(l,M,h)),await Promise.all(O).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(m,S,h){if(!(h instanceof U.c))throw new Error(`${m}: Material type not supported`);const l=new Array;return h.brdf.baseDiffuseModel=fm.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=S.diffuseRoughnessFactor?h.baseDiffuseRoughness=S.diffuseRoughnessFactor:h.baseDiffuseRoughness=0,S.diffuseRoughnessTexture&&l.push(this._loader.loadTextureInfoAsync(`${m}/diffuseRoughnessTexture`,S.diffuseRoughnessTexture,(m=>{m.name=`${h.name} (Diffuse Roughness)`,h.baseDiffuseRoughnessTexture=m}))),Promise.all(l).then((()=>{}))}}N(OS),J(OS,!0,(m=>new uS(m)));const bS="KHR_mesh_quantization";class qS{constructor(m){this.name=bS,this.enabled=m.isExtensionUsed(bS)}dispose(){}}N(bS),J(bS,!0,(m=>new qS(m)));const YS="KHR_texture_basisu";class VS{constructor(m){this.name=YS,this._loader=m,this.enabled=m.isExtensionUsed(YS)}dispose(){this._loader=null}_loadTextureAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>{const O=void 0==S.sampler?k.DefaultSampler:f.Get(`${m}/sampler`,this._loader.th.samplers,S.sampler),u=f.Get(`${l}/source`,this._loader.th.images,M.source);return await this._loader._createTextureAsync(m,O,u,(m=>{h(m)}),S._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!S._textureInfo.nonColorData)}))}}N(YS),J(YS,!0,(m=>new VS(m)));const IS="KHR_texture_transform";class ZS{constructor(m){this.name=IS,this._loader=m,this.enabled=this._loader.isExtensionUsed(IS)}dispose(){this._loader=null}loadTextureInfoAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(l,M)=>await this._loader.loadTextureInfoAsync(m,S,(m=>{if(!(m instanceof H.e))throw new Error(`${l}: Texture type not supported`);M.offset&&(m.uOffset=M.offset[0],m.vOffset=M.offset[1]),m.uRotationCenter=0,m.vRotationCenter=0,M.rotation&&(m.wAng=-M.rotation),M.scale&&(m.uScale=M.scale[0],m.vScale=M.scale[1]),void 0!=M.texCoord&&(m.coordinatesIndex=M.texCoord),h(m)}))))}}N(IS),J(IS,!0,(m=>new ZS(m)));const CS="KHR_xmp_json_ld";class BS{constructor(m){this.name=CS,this.order=100,this._loader=m,this.enabled=this._loader.isExtensionUsed(CS)}dispose(){this._loader=null}onLoading(){var m,S,h;if(null===this._loader.rootBabylonMesh)return;const l=null===(m=this._loader.th.extensions)||void 0===m?void 0:m.KHR_xmp_json_ld,M=null===(S=this._loader.th.asset)||void 0===S||null===(h=S.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld;if(l&&M){const m=+M.packet;l.packets&&m<l.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=l.packets[m])}}}function DS(m,S,h,l){return O.RS.yS(S,h).scale(l)}function ES(m,S,h,l){return S[h]*l}function nS(m,S,h,l){return-S[h]*l}function LS(m,S,h,l){return S[h+1]*l}function US(m,S,h,l){return S[h]*l*2}function HS(m){return{scale:[new yS(Z.e.ANIMATIONTYPE_FLOAT,`${m}.uScale`,ES,(()=>2)),new yS(Z.e.ANIMATIONTYPE_FLOAT,`${m}.vScale`,LS,(()=>2))],offset:[new yS(Z.e.ANIMATIONTYPE_FLOAT,`${m}.uOffset`,ES,(()=>2)),new yS(Z.e.ANIMATIONTYPE_FLOAT,`${m}.vOffset`,LS,(()=>2))],rotation:[new yS(Z.e.ANIMATIONTYPE_FLOAT,`${m}.wAng`,nS,(()=>1))]}}N(CS),J(CS,!0,(m=>new BS(m)));class RS extends r.AnimationPropertyInfo{buildAnimations(m,S,h,l){return[{babylonAnimatable:m._babylonCamera,babylonAnimation:this._buildAnimation(S,h,l)}]}}class yS extends r.AnimationPropertyInfo{buildAnimations(m,S,h,l){const M=[];for(const O in m._data)M.push({babylonAnimatable:m._data[O].babylonMaterial,babylonAnimation:this._buildAnimation(S,h,l)});return M}}class oS extends r.AnimationPropertyInfo{buildAnimations(m,S,h,l){return[{babylonAnimatable:m._babylonLight,babylonAnimation:this._buildAnimation(S,h,l)}]}}(0,j.j)("/cameras/{}/orthographic/xmag",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"orthoLeft",nS,(()=>1)),new RS(Z.e.ANIMATIONTYPE_FLOAT,"orthoRight",LS,(()=>1))]),(0,j.j)("/cameras/{}/orthographic/ymag",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"orthoBottom",nS,(()=>1)),new RS(Z.e.ANIMATIONTYPE_FLOAT,"orthoTop",LS,(()=>1))]),(0,j.j)("/cameras/{}/orthographic/zfar",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"maxZ",ES,(()=>1))]),(0,j.j)("/cameras/{}/orthographic/znear",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"hb",ES,(()=>1))]),(0,j.j)("/cameras/{}/perspective/yfov",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"fov",ES,(()=>1))]),(0,j.j)("/cameras/{}/perspective/zfar",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"maxZ",ES,(()=>1))]),(0,j.j)("/cameras/{}/perspective/znear",[new RS(Z.e.ANIMATIONTYPE_FLOAT,"hb",ES,(()=>1))]),(0,j.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new yS(Z.e.ANIMATIONTYPE_COLOR3,"albedoColor",DS,(()=>4)),new yS(Z.e.ANIMATIONTYPE_FLOAT,"alpha",(function(m,S,h,l){return S[h+3]*l}),(()=>4))]),(0,j.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"metallic",ES,(()=>1))]),(0,j.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"roughness",ES,(()=>1))]);const sS=HS("albedoTexture");(0,j.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",sS.scale),(0,j.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",sS.offset),(0,j.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",sS.rotation);const vS=HS("metallicTexture");(0,j.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",vS.scale),(0,j.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",vS.offset),(0,j.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",vS.rotation),(0,j.j)("/materials/{}/emissiveFactor",[new yS(Z.e.ANIMATIONTYPE_COLOR3,"emissiveColor",DS,(()=>3))]);const TS=HS("bumpTexture");(0,j.j)("/materials/{}/normalTexture/scale",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",ES,(()=>1))]),(0,j.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",TS.scale),(0,j.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",TS.offset),(0,j.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",TS.rotation),(0,j.j)("/materials/{}/occlusionTexture/strength",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",ES,(()=>1))]);const XS=HS("ambientTexture");(0,j.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",XS.scale),(0,j.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",XS.offset),(0,j.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",XS.rotation);const gS=HS("emissiveTexture");(0,j.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",gS.scale),(0,j.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",gS.offset),(0,j.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",gS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",ES,(()=>1))]);const GS=HS("anisotropy.texture");(0,j.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",GS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",GS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",GS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",ES,(()=>1))]);const eS=HS("clearCoat.texture");(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",eS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",eS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",eS.rotation);const aS=HS("clearCoat.bumpTexture");(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",aS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",aS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",aS.rotation);const xS=HS("clearCoat.textureRoughness");(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",xS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",xS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",xS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",ES,(()=>1))]);const PS=HS("iridescence.texture");(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",PS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",PS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",PS.rotation);const dS=HS("iridescence.thicknessTexture");(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",dS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",dS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",dS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new yS(Z.e.ANIMATIONTYPE_COLOR3,"sheen.color",DS,(()=>3))]),(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",ES,(()=>1))]);const JS=HS("sheen.texture");(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",JS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",JS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",JS.rotation);const NS=HS("sheen.textureRoughness");(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",NS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",NS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",NS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new yS(Z.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",DS,(()=>3))]);const jS=HS("metallicReflectanceTexture");(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",jS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",jS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",jS.rotation);const KS=HS("reflectanceTexture");(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",KS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",KS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",KS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",ES,(()=>1))]);const cS=HS("subSurface.refractionIntensityTexture");(0,j.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",cS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",cS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",cS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new yS(Z.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",DS,(()=>3))]),(0,j.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",ES,(()=>1))]),(0,j.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",ES,(()=>1))]);const fS=HS("subSurface.thicknessTexture");(0,j.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",fS.scale),(0,j.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",fS.offset),(0,j.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",fS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new yS(Z.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",ES,(()=>1))]);const pS=HS("subSurface.translucencyIntensityTexture");(0,j.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",pS.scale),(0,j.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",pS.offset),(0,j.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",pS.rotation),(0,j.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new yS(Z.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",DS,(()=>3))]);const kS=HS("subSurface.translucencyColorTexture");(0,j.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",kS.scale),(0,j.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",kS.offset),(0,j.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",kS.rotation),(0,j.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new oS(Z.e.ANIMATIONTYPE_COLOR3,"diffuse",DS,(()=>3))]),(0,j.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new oS(Z.e.ANIMATIONTYPE_FLOAT,"intensity",ES,(()=>1))]),(0,j.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new oS(Z.e.ANIMATIONTYPE_FLOAT,"range",ES,(()=>1))]),(0,j.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new oS(Z.e.ANIMATIONTYPE_FLOAT,"innerAngle",US,(()=>1))]),(0,j.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new oS(Z.e.ANIMATIONTYPE_FLOAT,"angle",US,(()=>1))]),(0,j.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new oS(Z.e.ANIMATIONTYPE_COLOR3,"diffuse",DS,(()=>3))]),(0,j.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new oS(Z.e.ANIMATIONTYPE_FLOAT,"intensity",ES,(()=>1))]);const rS="KHR_animation_pointer";class zS{constructor(m){this.name=rS,this._loader=m,this._pathToObjectConverter=(0,j.i)(this._loader.th)}get enabled(){return this._loader.isExtensionUsed(rS)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(m,S,h,l,M){var O;const u=null===(O=l.target.extensions)||void 0===O?void 0:O.KHR_animation_pointer;if(!u||!this._pathToObjectConverter)return null;"pointer"!==l.target.path&&D.e.Warn(`${m}/target/path: Value (${l.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=l.target.node&&D.e.Warn(`${m}/target/node: Value (${l.target.node}) must not be present when using the ${this.name} extension`);const b=`${m}/extensions/${this.name}`,q=u.pointer;if(!q)throw new Error(`${b}: Pointer is missing`);try{const O=this._pathToObjectConverter.convert(q);if(!O.info.interpolation)throw new Error(`${b}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(m,S,h,l,{object:O.object,info:O.info.interpolation},M)}catch(Y){return D.e.Warn(`${b}/pointer: Invalid pointer (${q}) skipped`),null}}}N(rS),J(rS,!0,(m=>new zS(m)));class QS{constructor(m,S,h){this.frame=m,this.action=S,this.onlyOnce=h,this.isDone=!1}_clone(){return new QS(this.frame,this.action,this.onlyOnce)}}var FS=h(11189),wS=h(11229),tS=h(11226);class AS{get loop(){return this._loop}set loop(m){m!==this._loop&&(this._loop=m,this.updateOptions({loop:m}))}get currentTime(){var m;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(m=wS.b.audioEngine)&&void 0!==m&&m.audioContext&&(this.isPlaying||this.isPaused)){const m=this.isPaused?0:wS.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+m}return 0}get spatialSound(){return this._spatialSound}set spatialSound(m){if(m==this._spatialSound)return;const S=this.isPlaying;this.pause(),m?(this._spatialSound=m,this._updateSpatialParameters()):this._disableSpatialSound(),S&&this.play()}constructor(m,S,h){var l;let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new V.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=M.nS.Zero(),this._localDirection=new M.nS(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=m,h=h||B.d.LastCreatedScene)if(this._scene=h,AS._SceneComponentInitialization(h),this._readyToPlayCallback=O,this._customAttenuationFunction=(m,S,h,l,M)=>S<h?m*(1-S/h):0,b&&(this.autoplay=b.autoplay||!1,this._loop=b.loop||!1,void 0!==b.volume&&(this._volume=b.volume),this._spatialSound=b.spatialSound??!1,this.maxDistance=b.maxDistance??100,this.useCustomAttenuation=b.useCustomAttenuation??!1,this.rolloffFactor=b.rolloffFactor||1,this.refDistance=b.refDistance||1,this.distanceModel=b.distanceModel||"linear",this._playbackRate=b.playbackRate||1,this._streaming=b.streaming??!1,this._length=b.length,this._offset=b.offset),null!==(l=wS.b.audioEngine)&&void 0!==l&&l.canUseWebAudio&&wS.b.audioEngine.audioContext){this._soundGain=wS.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let m=!0;if(S)try{"string"===typeof S?(this._urlType="String",this._url=S):S instanceof ArrayBuffer?this._urlType="ArrayBuffer":S instanceof HTMLMediaElement?this._urlType="MediaElement":S instanceof MediaStream?this._urlType="MediaStream":S instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(S)&&(this._urlType="Array");let h=[],l=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wS.b.audioEngine.audioContext.createMediaElementSource(S),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wS.b.audioEngine.audioContext.createMediaStreamSource(S),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":S.byteLength>0&&(l=!0,this._soundLoaded(S));break;case"AudioBuffer":this._audioBufferLoaded(S);break;case"String":h.push(S);case"Array":0===h.length&&(h=S);for(let m=0;m<h.length;m++){const S=h[m];if(l=b&&b.skipCodecCheck||-1!==S.indexOf(".mp3",S.length-4)&&wS.b.audioEngine.isMP3supported||-1!==S.indexOf(".ogg",S.length-4)&&wS.b.audioEngine.isOGGsupported||-1!==S.indexOf(".wav",S.length-4)||-1!==S.indexOf(".m4a",S.length-4)||-1!==S.indexOf(".mp4",S.length-4)||-1!==S.indexOf("blob:"),l){this._streaming?(this._htmlAudioElement=new Audio(S),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,u.Tools.SetCorsBehavior(S,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(S,(m=>{this._soundLoaded(m)}),void 0,!0,!0,(m=>{m&&D.e.Error("XHR "+m.status+" error on: "+S+"."),D.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:m=!1}m?l||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):D.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(q){D.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),wS.b.audioEngine&&!wS.b.audioEngine.WarnedWebAudioUnsupported&&(D.e.Error("Web Audio is not supported by your browser."),wS.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var m;null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(m){var S;null!==(S=wS.b.audioEngine)&&void 0!==S&&S.audioContext&&(this._audioBuffer=m,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(m){var S;null!==(S=wS.b.audioEngine)&&void 0!==S&&S.audioContext&&wS.b.audioEngine.audioContext.decodeAudioData(m,(m=>{this._audioBufferLoaded(m)}),(m=>{D.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+m)}))}setAudioBuffer(m){var S;null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&(this._audioBuffer=m,this._isReadyToPlay=!0)}updateOptions(m){m&&(this.loop=m.loop??this.loop,this.maxDistance=m.maxDistance??this.maxDistance,this.useCustomAttenuation=m.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=m.rolloffFactor??this.rolloffFactor,this.refDistance=m.refDistance??this.refDistance,this.distanceModel=m.distanceModel??this.distanceModel,this._playbackRate=m.playbackRate??this._playbackRate,this._length=m.length??void 0,this.spatialSound=m.spatialSound??this._spatialSound,this._setOffset(m.offset??void 0),this.setVolume(m.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var m;null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&wS.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??wS.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var m;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(m=this._soundPanner)||void 0===m||m.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var m;null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(m){var S;null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(m),this._isOutputConnected=!0)}setDirectionalCone(m,S,h){S<m?D.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=m,this._coneOuterAngle=S,this._coneOuterGain=h,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(m){if(m!=this._coneInnerAngle){var S;if(this._coneOuterAngle<m)return void D.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=m,null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(m){if(m!=this._coneOuterAngle){var S;if(m<this._coneInnerAngle)return void D.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=m,null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(m){var S;m.equals(this._position)||(this._position.l(m),null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(m){var S;this._localDirection=m,null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const m=this._connectedTransformNode.getWorldMatrix(),S=M.nS.TransformNormal(this._localDirection,m);S.normalize(),this._soundPanner.orientationX.value=S.x,this._soundPanner.orientationY.value=S.y,this._soundPanner.orientationZ.value=S.z}updateDistanceFromListener(){var m;if(null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const m=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.LS(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,m,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(m){this._customAttenuationFunction=m}play(m,S,h){var l;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(l=wS.b.audioEngine)&&void 0!==l&&l.audioContext)try{var M,O;this._clearTimeoutsAndObservers();let l=m?(null===(M=wS.b.audioEngine)||void 0===M?void 0:M.audioContext.currentTime)+m:null===(O=wS.b.audioEngine)||void 0===O?void 0:O.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=wS.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const m=()=>{var h;if(null!==(h=wS.b.audioEngine)&&void 0!==h&&h.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=S??0;const h=this._htmlAudioElement.play();void 0!==h&&h.catch((()=>{var S,h;(null===(S=wS.b.audioEngine)||void 0===S||S.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(h=wS.b.audioEngine)||void 0===h?void 0:h.onAudioUnlockedObservable.addOnce((()=>{m()})))}))}else{var l;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(l=wS.b.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{m()}))}};m()}}else{var u;const M=()=>{var M;if(null!==(M=wS.b.audioEngine)&&void 0!==M&&M.audioContext){var O;if(h=h||this._length,void 0!==S&&this._setOffset(S),this._soundSource){const m=this._soundSource;m.onended=()=>{m.disconnect()}}if(this._soundSource=null===(O=wS.b.audioEngine)||void 0===O?void 0:O.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var u;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==S&&(this._soundSource.loopStart=S),void 0!==h&&(this._soundSource.loopEnd=(0|S)+h),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},l=m?(null===(u=wS.b.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+m:wS.b.audioEngine.audioContext.currentTime;const M=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(l,M,this.loop?void 0:h)}}};"suspended"===(null===(u=wS.b.audioEngine)||void 0===u?void 0:u.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var m;"suspended"===(null===(m=wS.b.audioEngine)||void 0===m?void 0:m.audioContext.state)?(wS.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=wS.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{M()})))):M()}),500):M()}this._startTime=l,this.isPlaying=!0,this.isPaused=!1}catch(b){D.e.Error("Error while trying to play audio: "+this.name+", "+b.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(m){var S;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1}else if(null!==(S=wS.b.audioEngine)&&void 0!==S&&S.audioContext&&this._soundSource){const S=m?wS.b.audioEngine.audioContext.currentTime+m:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(S)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var m;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var S;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(S=this._streamingSource)||void 0===S||S.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(m=wS.b.audioEngine)&&void 0!==m&&m.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wS.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(m,S){var h;null!==(h=wS.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._soundGain&&(S&&wS.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(wS.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,wS.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(m,wS.b.audioEngine.audioContext.currentTime+S)):this._soundGain.gain.value=m),this._volume=m}setPlaybackRate(m){this._playbackRate=m,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(m){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=m,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=m=>this._onRegisterAfterWorldMatrixUpdate(m),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(m){var S;if(m.getBoundingInfo){const S=m.getBoundingInfo();this.setPosition(S.boundingSphere.centerWorld)}else this.setPosition(m.absolutePosition);null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const m=()=>{(0,tS.e)((()=>this._isReadyToPlay),(()=>{h._audioBuffer=this.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,this._offset,this._length)}),void 0,300)},S={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},h=new AS(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,S);return this.useCustomAttenuation&&h.setAttenuationFunction(this._customAttenuationFunction),h.setPosition(this._position),h.setPlaybackRate(this._playbackRate),m(),h}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const m={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(m.connectedMeshId=this._connectedTransformNode.id),m.position=this._position.DM(),m.refDistance=this.refDistance,m.distanceModel=this.distanceModel,m.isDirectional=this._isDirectional,m.localDirectionToMesh=this._localDirection.DM(),m.coneInnerAngle=this._coneInnerAngle,m.coneOuterAngle=this._coneOuterAngle,m.coneOuterGain=this._coneOuterGain),m}static Parse(m,S,h,l){const O=m.name;let u;u=m.url?h+m.url:h+O;const b={autoplay:m.autoplay,loop:m.loop,volume:m.volume,spatialSound:m.spatialSound,maxDistance:m.maxDistance,rolloffFactor:m.rolloffFactor,refDistance:m.refDistance,distanceModel:m.distanceModel,playbackRate:m.playbackRate};let q;if(l){const m=()=>{(0,tS.e)((()=>l._isReadyToPlay),(()=>{q._audioBuffer=l.getAudioBuffer(),q._isReadyToPlay=!0,q.autoplay&&q.play(0,q._offset,q._length)}),void 0,300)};q=new AS(O,new ArrayBuffer(0),S,null,b),m()}else q=new AS(O,u,S,(()=>{S.removePendingData(q)}),b),S.addPendingData(q);if(m.position){const S=M.nS.yS(m.position);q.setPosition(S)}if(m.isDirectional&&(q.setDirectionalCone(m.coneInnerAngle||360,m.coneOuterAngle||360,m.coneOuterGain||0),m.localDirectionToMesh)){const S=M.nS.yS(m.localDirectionToMesh);q.setLocalDirectionToMesh(S)}if(m.connectedMeshId){const h=S.getMeshById(m.connectedMeshId);h&&q.attachToMesh(h)}return m.metadata&&(q.metadata=m.metadata),q}_setOffset(m){this._offset!==m&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=m)}_clearTimeoutsAndObservers(){var m;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(m=wS.b.audioEngine)||void 0===m||m.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}AS._SceneComponentInitialization=m=>{throw(0,FS.c)("AudioSceneComponent")},(0,ym.e)("BABYLON.Sound",AS);class iS{constructor(m,S,h){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],S.length!==h.length)throw new Error("Sounds length does not equal weights length");this.loop=m,this._weights=h;let l=0;for(const O of h)l+=O;const M=l>0?1/l:0;for(let O=0;O<this._weights.length;O++)this._weights[O]*=M;this._sounds=S;for(const O of this._sounds)O.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(m){if(m!==this._coneInnerAngle){if(this._coneOuterAngle<m)return void D.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=m;for(const S of this._sounds)S.directionalConeInnerAngle=m}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(m){if(m!==this._coneOuterAngle){if(m<this._coneInnerAngle)return void D.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=m;for(const S of this._sounds)S.directionalConeOuterAngle=m}}get volume(){return this._volume}set volume(m){if(m!==this._volume)for(const S of this._sounds)S.setVolume(m)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(m){if(!this.isPaused){this.stop();const m=Math.random();let S=0;for(let h=0;h<this._weights.length;h++)if(S+=this._weights[h],m<=S){this._currentIndex=h;break}}const S=this._sounds[this._currentIndex??0];S.isReady()?S.play(0,this.isPaused?void 0:m):S.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class WS{constructor(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(m=m||B.d.LastCreatedScene)&&(this._scene=m,this.soundCollection=[],this._options=S,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var m;null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&wS.b.audioEngine.audioContext&&(this._outputAudioNode=wS.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(wS.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(wS.b.audioEngine&&wS.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(m){var S;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&m.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==m.soundTrackId&&(-1===m.soundTrackId?this._scene.mainSoundTrack.removeSound(m):this._scene.soundTracks&&this._scene.soundTracks[m.soundTrackId].removeSound(m)),this.soundCollection.push(m),m.soundTrackId=this.id}removeSound(m){const S=this.soundCollection.indexOf(m);-1!==S&&this.soundCollection.splice(S,1)}setVolume(m){var S;null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=m)}switchPanningModelToHRTF(){var m;if(null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio)for(let S=0;S<this.soundCollection.length;S++)this.soundCollection[S].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var m;if(null!==(m=wS.b.audioEngine)&&void 0!==m&&m.canUseWebAudio)for(let S=0;S<this.soundCollection.length;S++)this.soundCollection[S].switchPanningModelToEqualPower()}connectToAnalyser(m){var S;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=m,null!==(S=wS.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,wS.b.audioEngine.masterGain))}}var mh=h(11590),Sh=h(11567),hh=h(11169);wS.b.AudioEngineFactory=(m,S,h)=>new lh(m,S,h);class lh{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new V.e,this.onAudioLockedObservable=new V.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,hh.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const l=document.createElement("audio");this._hostElement=m,this._audioContext=S,this._audioDestination=h;try{l&&l.canPlayType&&(l.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||l.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(M){}try{l&&l.canPlayType&&l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(M){}}lock(){this._triggerSuspendedState()}unlock(){var m,S;if("running"===(null===(m=this._audioContext)||void 0===m?void 0:m.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(S=this._audioContext)||void 0===S||S.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{D.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var m;null===(m=this._audioContext)||void 0===m||m.addEventListener("statechange",(()=>{var m;this.unlocked&&"running"!==(null===(m=this._audioContext)||void 0===m?void 0:m.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var m;return null!==(m=this._audioContext)&&void 0!==m&&m.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(m){this.canUseWebAudio=!1,D.e.Error("Web Audio: "+m.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(m){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const m=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",S=document.createElement("style");S.appendChild(document.createTextNode(m)),document.getElementsByTagName("head")[0].appendChild(S),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var m;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(m=this._audioContext)||void 0===m||m.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(m){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=m)}connectToAnalyser(m){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=m,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Mh=h(11183);(0,h(12727).h)(mh.b.NAME_AUDIO,((m,S,h,l)=>{let M,O=[];if(h.SC=h.SC||[],void 0!==m.SC&&null!==m.SC)for(let b=0,q=m.SC.length;b<q;b++){var u;const q=m.SC[b];null!==(u=wS.b.audioEngine)&&void 0!==u&&u.canUseWebAudio?(q.url||(q.url=q.name),O[q.url]?h.SC.push(AS.Parse(q,S,l,O[q.url])):(M=AS.Parse(q,S,l),O[q.url]=M,h.SC.push(M))):h.SC.push(new AS(q.name,null,S))}O=[]})),Object.defineProperty(Sh.c.prototype,"mainSoundTrack",{get:function(){let m=this._getComponent(mh.b.NAME_AUDIO);return m||(m=new Oh(this),this.Hh(m)),this._mainSoundTrack||(this._mainSoundTrack=new WS(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Sh.c.prototype.getSoundByName=function(m){let S;for(S=0;S<this.mainSoundTrack.soundCollection.length;S++)if(this.mainSoundTrack.soundCollection[S].name===m)return this.mainSoundTrack.soundCollection[S];if(this.soundTracks)for(let h=0;h<this.soundTracks.length;h++)for(S=0;S<this.soundTracks[h].soundCollection.length;S++)if(this.soundTracks[h].soundCollection[S].name===m)return this.soundTracks[h].soundCollection[S];return null},Object.defineProperty(Sh.c.prototype,"audioEnabled",{get:function(){let m=this._getComponent(mh.b.NAME_AUDIO);return m||(m=new Oh(this),this.Hh(m)),m.audioEnabled},set:function(m){let S=this._getComponent(mh.b.NAME_AUDIO);S||(S=new Oh(this),this.Hh(S)),m?S.enableAudio():S.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Sh.c.prototype,"headphone",{get:function(){let m=this._getComponent(mh.b.NAME_AUDIO);return m||(m=new Oh(this),this.Hh(m)),m.headphone},set:function(m){let S=this._getComponent(mh.b.NAME_AUDIO);S||(S=new Oh(this),this.Hh(S)),m?S.switchAudioModeForHeadphones():S.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Sh.c.prototype,"audioListenerPositionProvider",{get:function(){let m=this._getComponent(mh.b.NAME_AUDIO);return m||(m=new Oh(this),this.Hh(m)),m.audioListenerPositionProvider},set:function(m){let S=this._getComponent(mh.b.NAME_AUDIO);if(S||(S=new Oh(this),this.Hh(S)),m&&"function"!==typeof m)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");S.audioListenerPositionProvider=m},enumerable:!0,configurable:!0}),Object.defineProperty(Sh.c.prototype,"audioListenerRotationProvider",{get:function(){let m=this._getComponent(mh.b.NAME_AUDIO);return m||(m=new Oh(this),this.Hh(m)),m.audioListenerRotationProvider},set:function(m){let S=this._getComponent(mh.b.NAME_AUDIO);if(S||(S=new Oh(this),this.Hh(S)),m&&"function"!==typeof m)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");S.audioListenerRotationProvider=m},enumerable:!0,configurable:!0}),Object.defineProperty(Sh.c.prototype,"audioPositioningRefreshRate",{get:function(){let m=this._getComponent(mh.b.NAME_AUDIO);return m||(m=new Oh(this),this.Hh(m)),m.audioPositioningRefreshRate},set:function(m){let S=this._getComponent(mh.b.NAME_AUDIO);S||(S=new Oh(this),this.Hh(S)),S.audioPositioningRefreshRate=m},enumerable:!0,configurable:!0});class Oh{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(m){this.name=mh.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new M.nS,this._cachedCameraPosition=new M.nS,this._lastCheck=0,this._invertMatrixTemp=new M.Matrix,this._cameraDirectionTemp=new M.nS,(m=m||B.d.LastCreatedScene)&&(this.US=m,m.soundTracks=[],m.SC=[])}register(){this.US._afterRenderStage.registerStep(mh.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(m){if(m.SC=[],this.US.soundTracks)for(let S=0;S<this.US.soundTracks.length;S++){const h=this.US.soundTracks[S];for(let S=0;S<h.soundCollection.length;S++)m.SC.push(h.soundCollection[S].serialize())}}addFromContainer(m){if(m.SC)for(const S of m.SC)S.play(),S.autoplay=!0,this.US.mainSoundTrack.addSound(S)}removeFromContainer(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(m.SC)for(const h of m.SC)h.stop(),h.autoplay=!1,this.US.mainSoundTrack.removeSound(h),S&&h.dispose()}dispose(){const m=this.US;if(m._mainSoundTrack&&m.mainSoundTrack.dispose(),m.soundTracks)for(let S=0;S<m.soundTracks.length;S++)m.soundTracks[S].dispose()}disableAudio(){const m=this.US;let S;for(this._audioEnabled=!1,wS.b.audioEngine&&wS.b.audioEngine.audioContext&&wS.b.audioEngine.audioContext.suspend(),S=0;S<m.mainSoundTrack.soundCollection.length;S++)m.mainSoundTrack.soundCollection[S].pause();if(m.soundTracks)for(S=0;S<m.soundTracks.length;S++)for(let h=0;h<m.soundTracks[S].soundCollection.length;h++)m.soundTracks[S].soundCollection[h].pause()}enableAudio(){const m=this.US;let S;for(this._audioEnabled=!0,wS.b.audioEngine&&wS.b.audioEngine.audioContext&&wS.b.audioEngine.audioContext.resume(),S=0;S<m.mainSoundTrack.soundCollection.length;S++)m.mainSoundTrack.soundCollection[S].isPaused&&m.mainSoundTrack.soundCollection[S].play();if(m.soundTracks)for(S=0;S<m.soundTracks.length;S++)for(let h=0;h<m.soundTracks[S].soundCollection.length;h++)m.soundTracks[S].soundCollection[h].isPaused&&m.soundTracks[S].soundCollection[h].play()}switchAudioModeForHeadphones(){const m=this.US;if(this._headphone=!0,m.mainSoundTrack.switchPanningModelToHRTF(),m.soundTracks)for(let S=0;S<m.soundTracks.length;S++)m.soundTracks[S].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const m=this.US;if(this._headphone=!1,m.mainSoundTrack.switchPanningModelToEqualPower(),m.soundTracks)for(let S=0;S<m.soundTracks.length;S++)m.soundTracks[S].switchPanningModelToEqualPower()}_afterRender(){const m=Mh.b.Now;if(this._lastCheck&&m-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=m;const S=this.US;if(!this._audioEnabled||!S._mainSoundTrack||!S.soundTracks||0===S._mainSoundTrack.soundCollection.length&&1===S.soundTracks.length)return;const h=wS.b.audioEngine;if(h&&h.audioContext){let m,l=S.activeCamera;if(S.activeCameras&&S.activeCameras.length>0&&(l=S.activeCameras[0]),this.audioListenerPositionProvider){const m=this.audioListenerPositionProvider();h.audioContext.listener.setPosition(m.x||0,m.y||0,m.z||0)}else l?this._cachedCameraPosition.equals(l.globalPosition)||(this._cachedCameraPosition.l(l.globalPosition),h.audioContext.listener.setPosition(l.globalPosition.x,l.globalPosition.y,l.globalPosition.z)):h.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const m=this.audioListenerRotationProvider();h.audioContext.listener.setOrientation(m.x||0,m.y||0,m.z||0,0,1,0)}else l?(l.rigCameras&&l.rigCameras.length>0&&(l=l.rigCameras[0]),l.getViewMatrix().invertToRef(this._invertMatrixTemp),M.nS.TransformNormalToRef(Oh._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.l(this._cameraDirectionTemp),h.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):h.audioContext.listener.setOrientation(0,0,0,0,1,0);for(m=0;m<S.mainSoundTrack.soundCollection.length;m++){const h=S.mainSoundTrack.soundCollection[m];h.useCustomAttenuation&&h.updateDistanceFromListener()}if(S.soundTracks)for(m=0;m<S.soundTracks.length;m++)for(let h=0;h<S.soundTracks[m].soundCollection.length;h++){const l=S.soundTracks[m].soundCollection[h];l.useCustomAttenuation&&l.updateDistanceFromListener()}}}}Oh._CameraDirection=new M.nS(0,0,-1),AS._SceneComponentInitialization=m=>{let S=m._getComponent(mh.b.NAME_AUDIO);S||(S=new Oh(m),m.Hh(S))};const uh="MSFT_audio_emitter";class bh{constructor(m){this.name=uh,this._loader=m,this.enabled=this._loader.isExtensionUsed(uh)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const m=this._loader.th.extensions;if(m&&m[this.name]){const S=m[this.name];this._clips=S.clips,this._emitters=S.emitters,f.Assign(this._clips),f.Assign(this._emitters)}}loadSceneAsync(m,S){return k.LoadExtensionAsync(m,S,this.name,(async(h,l)=>{const M=new Array;M.push(this._loader.loadSceneAsync(m,S));for(const m of l.emitters){const S=f.Get(`${h}/emitters`,this._emitters,m);if(void 0!=S.refDistance||void 0!=S.maxDistance||void 0!=S.rolloffFactor||void 0!=S.distanceModel||void 0!=S.innerAngle||void 0!=S.outerAngle)throw new Error(`${h}: Direction or Distance properties are not allowed on emitters attached to a scene`);M.push(this._loadEmitterAsync(`${h}/emitters/${S.index}`,S))}await Promise.all(M)}))}loadNodeAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(m,l)=>{const O=new Array,b=await this._loader.loadNodeAsync(m,S,(S=>{for(const h of l.emitters){const l=f.Get(`${m}/emitters`,this._emitters,h);O.push(this._loadEmitterAsync(`${m}/emitters/${l.index}`,l).then((()=>{for(const m of l._babylonSounds)m.attachToMesh(S),void 0==l.innerAngle&&void 0==l.outerAngle||(m.setLocalDirectionToMesh(M.nS.Forward()),m.setDirectionalCone(2*u.Tools.ToDegrees(void 0==l.innerAngle?Math.PI:l.innerAngle),2*u.Tools.ToDegrees(void 0==l.outerAngle?Math.PI:l.outerAngle),0))})))}h(S)}));return await Promise.all(O),b}))}loadAnimationAsync(m,S){return k.LoadExtensionAsync(m,S,this.name,(async(h,l)=>{const M=await this._loader.loadAnimationAsync(m,S),O=new Array;f.Assign(l.events);for(const u of l.events)O.push(this._loadAnimationEventAsync(`${h}/events/${u.index}`,m,S,u,M));return await Promise.all(O),M}))}_loadClipAsync(m,S){if(S._objectURL)return S._objectURL;let h;if(S.uri)h=this._loader.loadUriAsync(m,S,S.uri);else{const l=f.Get(`${m}/bufferView`,this._loader.th.bufferViews,S.bufferView);h=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}return S._objectURL=h.then((m=>URL.createObjectURL(new Blob([m],{type:S.mimeType})))),S._objectURL}_loadEmitterAsync(m,S){if(S._babylonSounds=S._babylonSounds||[],!S._babylonData){const m=new Array,h=S.name||`emitter${S.index}`,l={loop:!1,autoplay:!1,volume:void 0==S.volume?1:S.volume};for(let O=0;O<S.clips.length;O++){const M=`/extensions/${this.name}/clips`,u=f.Get(M,this._clips,S.clips[O].clip);m.push(this._loadClipAsync(`${M}/${S.clips[O].clip}`,u).then((m=>{const M=S._babylonSounds[O]=new AS(h,m,this._loader.babylonScene,null,l);M.refDistance=S.refDistance||1,M.maxDistance=S.maxDistance||256,M.rolloffFactor=S.rolloffFactor||1,M.distanceModel=S.distanceModel||"exponential"})))}const M=Promise.all(m).then((()=>{const m=S.clips.map((m=>m.weight||1)),h=new iS(S.loop||!1,S._babylonSounds,m);S.innerAngle&&(h.directionalConeInnerAngle=2*u.Tools.ToDegrees(S.innerAngle)),S.outerAngle&&(h.directionalConeOuterAngle=2*u.Tools.ToDegrees(S.outerAngle)),S.volume&&(h.volume=S.volume),S._babylonData.sound=h}));S._babylonData={loaded:M}}return S._babylonData.loaded}_getEventAction(m,S,h,l,M){switch(h){case"play":return m=>{const h=(M||0)+(m-l);S.play(h)};case"stop":return()=>{S.stop()};case"pause":return()=>{S.pause()};default:throw new Error(`${m}: Unsupported action ${h}`)}}_loadAnimationEventAsync(m,S,h,l,M){if(0==M.targetedAnimations.length)return Promise.resolve();const O=M.targetedAnimations[0],u=l.uS,b=f.Get(`/extensions/${this.name}/emitters`,this._emitters,u);return this._loadEmitterAsync(m,b).then((()=>{const S=b._babylonData.sound;if(S){const h=new QS(l.time,this._getEventAction(m,S,l.action,l.time,l.startOffset));O.animation.addEvent(h),M.onAnimationGroupEndObservable.add((()=>{S.stop()})),M.onAnimationGroupPauseObservable.add((()=>{S.pause()}))}}))}}N(uh),J(uh,!0,(m=>new bh(m)));const qh="MSFT_lod";class Yh{constructor(m){var S;this.name=qh,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new V.e,this.onMaterialLODsLoadedObservable=new V.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=m,this.maxLODsToLoad=(null===(S=this._loader.parent.extensionOptions[qh])||void 0===S?void 0:S.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(qh)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let m=0;m<this._nodePromiseLODs.length;m++){const S=Promise.all(this._nodePromiseLODs[m]).then((()=>{0!==m&&(this._loader.endPerformanceCounter(`Node LOD ${m}`),this._loader.log(`Loaded node LOD ${m}`)),this.onNodeLODsLoadedObservable.notifyObservers(m),m!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${m+1}`),this._loadBufferLOD(this._nodeBufferLODs,m+1),this._nodeSignalLODs[m]&&this._nodeSignalLODs[m].resolve())}));this._loader._completePromises.push(S)}for(let m=0;m<this._materialPromiseLODs.length;m++){const S=Promise.all(this._materialPromiseLODs[m]).then((()=>{0!==m&&(this._loader.endPerformanceCounter(`Material LOD ${m}`),this._loader.log(`Loaded material LOD ${m}`)),this.onMaterialLODsLoadedObservable.notifyObservers(m),m!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${m+1}`),this._loadBufferLOD(this._materialBufferLODs,m+1),this._materialSignalLODs[m]&&this._materialSignalLODs[m].resolve())}));this._loader._completePromises.push(S)}}loadSceneAsync(m,S){const h=this._loader.loadSceneAsync(m,S);return this._loadBufferLOD(this._bufferLODs,0),h}loadNodeAsync(m,S,h){return k.LoadExtensionAsync(m,S,this.name,(async(m,M)=>{let O;const u=this._getLODs(m,S,this._loader.th.nodes,M.ids);this._loader.logOpen(`${m}`);for(let S=0;S<u.length;S++){const m=u[S];0!==S&&(this._nodeIndexLOD=S,this._nodeSignalLODs[S]=this._nodeSignalLODs[S]||new l);const M=m=>{h(m),m.Bq(!1)},b=this._loader.loadNodeAsync(`/nodes/${m.index}`,m,M).then((m=>{if(0!==S){const m=u[S-1];m._babylonTransformNode&&(this._disposeTransformNode(m._babylonTransformNode),delete m._babylonTransformNode)}return m.Bq(!0),m}));this._nodePromiseLODs[S]=this._nodePromiseLODs[S]||[],0===S?O=b:(this._nodeIndexLOD=null,this._nodePromiseLODs[S].push(b))}return this._loader.logClose(),await O}))}_loadMaterialAsync(m,S,h,l,M){return this._nodeIndexLOD?null:k.LoadExtensionAsync(m,S,this.name,(async(m,O)=>{let u;const b=this._getLODs(m,S,this._loader.th.materials,O.ids);this._loader.logOpen(`${m}`);for(let S=0;S<b.length;S++){const m=b[S];0!==S&&(this._materialIndexLOD=S);const O=this._loader._loadMaterialAsync(`/materials/${m.index}`,m,h,l,(m=>{0===S&&M(m)})).then((m=>{if(0!==S){M(m);const h=b[S-1]._data;h[l]&&(this._disposeMaterials([h[l].babylonMaterial]),delete h[l])}return m}));this._materialPromiseLODs[S]=this._materialPromiseLODs[S]||[],0===S?u=O:(this._materialIndexLOD=null,this._materialPromiseLODs[S].push(O))}return this._loader.logClose(),await u}))}_loadUriAsync(m,S,h){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const M=this._nodeIndexLOD-1;return this._nodeSignalLODs[M]=this._nodeSignalLODs[M]||new l,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(m,S,h)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const M=this._materialIndexLOD-1;return this._materialSignalLODs[M]=this._materialSignalLODs[M]||new l,this._materialSignalLODs[M].promise.then((async()=>await this._loader.loadUriAsync(m,S,h)))}return null}loadBufferAsync(m,S,h,M){if(this._loader.parent.useRangeRequests&&!S.uri){if(!this._loader.bin)throw new Error(`${m}: Uri is missing or the binary glTF is missing its binary chunk`);const S=async(m,S)=>{const O=h,u=O+M-1;let b=m[S];return b?(b.start=Math.min(b.start,O),b.end=Math.max(b.end,u)):(b={start:O,end:u,loaded:new l},m[S]=b),await b.loaded.promise.then((m=>new Uint8Array(m.buffer,m.byteOffset+h-b.start,M)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?S(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?S(this._materialBufferLODs,this._materialIndexLOD):S(this._bufferLODs,0)}return null}_loadBufferLOD(m,S){const h=m[S];h&&(this._loader.log(`Loading buffer range [${h.start}-${h.end}]`),this._loader.bin.readAsync(h.start,h.end-h.start+1).then((m=>{h.loaded.resolve(m)}),(m=>{h.loaded.reject(m)})))}_getLODs(m,S,h,l){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const M=[];for(let O=l.length-1;O>=0;O--)if(M.push(f.Get(`${m}/ids/${l[O]}`,h,l[O])),M.length===this.maxLODsToLoad)return M;return M.push(S),M}_disposeTransformNode(m){const S=[],h=m.material;h&&S.push(h);for(const M of m.getChildMeshes())M.material&&S.push(M.material);m.dispose();const l=S.filter((m=>this._loader.babylonScene.meshes.every((S=>S.material!=m))));this._disposeMaterials(l)}_disposeMaterials(m){const S={};for(const h of m){for(const m of h.getActiveTextures())S[m.uniqueId]=m;h.dispose()}for(const h in S)for(const m of this._loader.babylonScene.materials)m.hasTexture(S[h])&&delete S[h];for(const h in S)S[h].dispose()}}N(qh),J(qh,!0,(m=>new Yh(m)));const Vh="MSFT_minecraftMesh";class Ih{constructor(m){this.name=Vh,this._loader=m,this.enabled=this._loader.isExtensionUsed(Vh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtraAsync(m,S,this.name,(async(l,M)=>{if(M){if(!(h instanceof U.c))throw new Error(`${l}: Material type not supported`);const M=this._loader.loadMaterialPropertiesAsync(m,S,h);return h.needAlphaBlending()&&(h.forceDepthWrite=!0,h.separateCullingPass=!0),h.qb=h.forceDepthWrite,h.twoSidedLighting=!0,await M}}))}}N(Vh),J(Vh,!0,(m=>new Ih(m)));const Zh="MSFT_sRGBFactors";class Ch{constructor(m){this.name=Zh,this._loader=m,this.enabled=this._loader.isExtensionUsed(Zh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(m,S,h){return k.LoadExtraAsync(m,S,this.name,(async(l,M)=>{if(M){if(!(h instanceof U.c))throw new Error(`${l}: Material type not supported`);const M=this._loader.loadMaterialPropertiesAsync(m,S,h),O=h.sm().getEngine().useExactSrgbConversions;return h.albedoTexture||h.albedoColor.toLinearSpaceToRef(h.albedoColor,O),h.reflectivityTexture||h.reflectivityColor.toLinearSpaceToRef(h.reflectivityColor,O),await M}}))}}N(Zh),J(Zh,!0,(m=>new Ch(m)));var Bh=h(13045);const Dh={};var Eh=h(13094),nh=h(13071),Lh=h(13047),Uh=h(13060);function Hh(m,S){for(const h of m)for(const m of h.dataOutputs)if(m.uniqueId===S)return m;throw new Error("Could not find data out connection with unique id "+S)}function Rh(m,S){for(const h of m)if(h instanceof nh.e)for(const m of h.signalInputs)if(m.uniqueId===S)return m;throw new Error("Could not find signal in connection with unique id "+S)}async function yh(m,S){const l=await Promise.all(m.allBlocks.map((async m=>{const S=function(m){switch(m){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([h.e(78),h.e(79)]).then(h.bind(h,14564))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await h.e(80).then(h.bind(h,14570))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await h.e(81).then(h.bind(h,14576))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await h.e(82).then(h.bind(h,14581))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await h.e(83).then(h.bind(h,14588))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await h.e(84).then(h.bind(h,14597))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await h.e(85).then(h.bind(h,14600))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await h.e(86).then(h.bind(h,14604))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await h.e(87).then(h.bind(h,14612))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await h.e(90).then(h.bind(h,14642))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await h.e(90).then(h.bind(h,14642))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await h.e(90).then(h.bind(h,14642))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await h.e(90).then(h.bind(h,14642))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await h.e(95).then(h.bind(h,14651))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await h.e(96).then(h.bind(h,14654))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await h.e(97).then(h.bind(h,14658))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await h.e(98).then(h.bind(h,14661))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await h.e(99).then(h.bind(h,14665))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await h.e(100).then(h.bind(h,14674))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await h.e(101).then(h.bind(h,14677))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await h.e(102).then(h.bind(h,14681))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await h.e(103).then(h.bind(h,14686))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await h.e(104).then(h.bind(h,14692))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await h.e(105).then(h.bind(h,14694))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await h.e(106).then(h.bind(h,14703))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await h.e(107).then(h.bind(h,14706))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await h.e(108).then(h.bind(h,14715))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await h.e(109).then(h.bind(h,14718))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await h.e(110).then(h.bind(h,14727))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await h.e(111).then(h.bind(h,14735))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await h.e(112).then(h.bind(h,14741))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await h.e(113).then(h.bind(h,14749))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await h.e(92).then(h.bind(h,14752))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await h.e(114).then(h.bind(h,14755))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await h.e(115).then(h.bind(h,14759))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await h.e(116).then(h.bind(h,14768))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await h.e(93).then(h.bind(h,14772))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await h.e(88).then(h.bind(h,14615))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await h.e(94).then(h.bind(h,14777))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await h.e(89).then(h.bind(h,14634))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await h.e(90).then(h.bind(h,14642))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await h.e(90).then(h.bind(h,14642))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await h.e(91).then(h.bind(h,14780))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await h.e(91).then(h.bind(h,14780))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await h.e(91).then(h.bind(h,14780))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await h.e(91).then(h.bind(h,14780))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await h.e(91).then(h.bind(h,14780))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await h.e(91).then(h.bind(h,14780))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await h.e(117).then(h.bind(h,14787))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await h.e(118).then(h.bind(h,14793))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await h.e(119).then(h.bind(h,14799))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await h.e(120).then(h.bind(h,14808))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await h.e(121).then(h.bind(h,14811))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await h.e(122).then(h.bind(h,14814))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await h.e(123).then(h.bind(h,14821))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await h.e(124).then(h.bind(h,14830))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await h.e(125).then(h.bind(h,14835))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await h.e(126).then(h.bind(h,14843))).FlowGraphDataSwitchBlock;default:if(Dh[m])return Dh[m];throw new Error(`Unknown block name ${m}`)}}(m.className);return await S()})));return function(m,S,h){const l=S.coordinator.createGraph(),M=[],O=S.valueParseFunction??Lh.d;for(let u=0;u<m.allBlocks.length;u++){const b=sh(m.allBlocks[u],{US:S.coordinator.config.US,pathConverter:S.pathConverter,assetsContainer:S.coordinator.config.US,valueParseFunction:O},h[u]);M.push(b),b instanceof Eh.b&&l.addEventBlock(b)}for(const u of M){for(const m of u.dataInputs)for(const S of m.connectedPointIds){const h=Hh(M,S);m.connectTo(h)}if(u instanceof nh.e)for(const m of u.signalOutputs)for(const S of m.connectedPointIds){const h=Rh(M,S);m.connectTo(h)}}for(const u of m.executionContexts)oh(u,{graph:l,valueParseFunction:O},m.rightHanded);return l}(m,S,l)}function oh(m,S,h){const l=S.graph.createContext();m.enableLogging&&(l.enableLogging=!0),l.treatDataAsRightHanded=h||!1;const M=S.valueParseFunction??Lh.d;l.uniqueId=m.uniqueId;const O=l.sm();if(m._assetsContext){var u,b,q,Y,V,I,Z,C,B,D;const S=m._assetsContext,h={meshes:null===(u=S.meshes)||void 0===u?void 0:u.map((m=>O.getMeshById(m))),lights:null===(b=S.lights)||void 0===b?void 0:b.map((m=>O.getLightByName(m))),cameras:null===(q=S.cameras)||void 0===q?void 0:q.map((m=>O.getCameraByName(m))),materials:null===(Y=S.materials)||void 0===Y?void 0:Y.map((m=>O.getMaterialById(m))),textures:null===(V=S.textures)||void 0===V?void 0:V.map((m=>O.getTextureByName(m))),animations:null===(I=S.animations)||void 0===I?void 0:I.map((m=>O.animations.find((S=>S.name===m)))),skeletons:null===(Z=S.skeletons)||void 0===Z?void 0:Z.map((m=>O.getSkeletonByName(m))),UZ:null===(C=S.UZ)||void 0===C?void 0:C.map((m=>O.getParticleSystemById(m))),animationGroups:null===(B=S.animationGroups)||void 0===B?void 0:B.map((m=>O.getAnimationGroupByName(m))),transformNodes:null===(D=S.transformNodes)||void 0===D?void 0:D.map((m=>O.getTransformNodeById(m))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],SC:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};l.assetsContext=h}for(const E in m._userVariables){const S=M(E,m._userVariables,l.assetsContext,O);l.userVariables[E]=S}for(const E in m._connectionValues){const S=M(E,m._connectionValues,l.assetsContext,O);l._setConnectionValueByKey(E,S)}return l}function sh(m,S,h){const l={},M=S.valueParseFunction??Lh.d;if(m.config)for(const u in m.config)l[u]=M(u,m.config,S.assetsContainer||S.US,S.US);if((0,Lh.h)(m.className)){if(!S.pathConverter)throw new Error("Path converter is required for this block");l.pathConverter=S.pathConverter}const O=new h(l);O.uniqueId=m.uniqueId;for(let u=0;u<m.dataInputs.length;u++){const S=O.getDataInput(m.dataInputs[u].name);if(!S)throw new Error("Could not find data input with name "+m.dataInputs[u].name+" in block "+m.className);S.deserialize(m.dataInputs[u])}for(let u=0;u<m.dataOutputs.length;u++){const S=O.getDataOutput(m.dataOutputs[u].name);if(!S)throw new Error("Could not find data output with name "+m.dataOutputs[u].name+" in block "+m.className);S.deserialize(m.dataOutputs[u])}return O.metadata=m.metadata,O.deserialize&&O.deserialize(m),O}function vh(m){const[S,h]=m.split(":");return Th({op:S,extension:h})}function Th(m){var S;let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=m.extension?null===(S=gh[m.extension])||void 0===S?void 0:S[m.op]:Gh[m.op];if(!l&&(D.e.Warn(`No mapping found for operation ${m.op} and extension ${m.extension||"KHR_interactivity"}`),h)){const S={},h={flows:{}};if(m.inputValueSockets){S.values={};for(const h in m.inputValueSockets)S.values[h]={name:h}}return m.outputValueSockets&&(h.values={},Object.keys(m.outputValueSockets).forEach((m=>{h.values[m]={name:m}}))),{jV:[],inputs:S,outputs:h}}return l}function Xh(m,S,h){gh[S]||(gh[S]={}),gh[S][m]=h}const gh={BABYLON:{"flow/log":{jV:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Gh={"event/onStart":{jV:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{jV:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{jV:["FlowGraphSendCustomEventBlock"],extraProcessor(m,S,h,l,M){if("event/send"!==S.op||!m.configuration||1!==Object.keys(m.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const O=m.configuration.event.value[0];if("number"!==typeof O)throw new Error("Event id should be a number");const u=l.arrays.events[O],b=M[0];return b.config||(b.config={}),b.config.eventId=u.eventId,b.config.eventData=u.eventData,M}},"event/receive":{jV:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(m,S){var h;if(!m.configuration)return D.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const l=m.configuration.event;if(!l)return D.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const M=l.value[0];if("number"!==typeof M)return D.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(h=S.events)||void 0===h?void 0:h[M])?{valid:!0}:(D.e.Error(`Event with id ${M} not found`),{valid:!1,error:`Event with id ${M} not found`})},extraProcessor(m,S,h,l,M){if("event/receive"!==S.op||!m.configuration||1!==Object.keys(m.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const O=m.configuration.event.value[0];if("number"!==typeof O)throw new Error("Event id should be a number");const u=l.arrays.events[O],b=M[0];return b.config||(b.config={}),b.config.eventId=u.eventId,b.config.eventData=u.eventData,M}},"math/e":eh("FlowGraphEBlock"),"math/pi":eh("FlowGraphPIBlock"),"math/inf":eh("FlowGraphInfBlock"),"math/nan":eh("FlowGraphNaNBlock"),"math/abs":eh("FlowGraphAbsBlock"),"math/sign":eh("FlowGraphSignBlock"),"math/trunc":eh("FlowGraphTruncBlock"),"math/floor":eh("FlowGraphFloorBlock"),"math/ceil":eh("FlowGraphCeilBlock"),"math/round":{jV:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M){var O;return(O=M[0]).config||(O.config={}),M[0].config.roundHalfAwayFromZero=!0,M}},"math/fract":eh("FlowGraphFractBlock"),"math/neg":eh("FlowGraphNegationBlock"),"math/add":eh("FlowGraphAddBlock",["a","b"],!0),"math/sub":eh("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{jV:["FlowGraphMultiplyBlock"],extraProcessor(m,S,h,l,M){var O;(O=M[0]).config||(O.config={}),M[0].config.useMatrixPerComponent=!0,M[0].config.preventIntegerFloatArithmetic=!0;let u=-1;return Object.keys(m.values||{}).find((S=>{var h;return void 0!==(null===(h=m.values)||void 0===h?void 0:h[S].type)&&(u=m.values[S].type,!0)})),-1!==u&&(M[0].config.type=l.arrays.types[u].flowGraphType),M},validation:m=>m.values?ah(m):{valid:!0}},"math/div":eh("FlowGraphDivideBlock",["a","b"],!0),"math/rem":eh("FlowGraphModuloBlock",["a","b"]),"math/min":eh("FlowGraphMinBlock",["a","b"]),"math/max":eh("FlowGraphMaxBlock",["a","b"]),"math/clamp":eh("FlowGraphClampBlock",["a","b","c"]),"math/saturate":eh("FlowGraphSaturateBlock"),"math/mix":eh("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":eh("FlowGraphEqualityBlock",["a","b"]),"math/lt":eh("FlowGraphLessThanBlock",["a","b"]),"math/le":eh("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":eh("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":eh("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":eh("FlowGraphIsNaNBlock"),"math/isinf":eh("FlowGraphIsInfBlock"),"math/select":{jV:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{jV:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":eh("FlowGraphSinBlock"),"math/cos":eh("FlowGraphCosBlock"),"math/tan":eh("FlowGraphTanBlock"),"math/asin":eh("FlowGraphASinBlock"),"math/acos":eh("FlowGraphACosBlock"),"math/atan":eh("FlowGraphATanBlock"),"math/atan2":eh("FlowGraphATan2Block",["a","b"]),"math/sinh":eh("FlowGraphSinhBlock"),"math/cosh":eh("FlowGraphCoshBlock"),"math/tanh":eh("FlowGraphTanhBlock"),"math/asinh":eh("FlowGraphASinhBlock"),"math/acosh":eh("FlowGraphACoshBlock"),"math/atanh":eh("FlowGraphATanhBlock"),"math/exp":eh("FlowGraphExponentialBlock"),"math/log":eh("FlowGraphLogBlock"),"math/log2":eh("FlowGraphLog2Block"),"math/log10":eh("FlowGraphLog10Block"),"math/sqrt":eh("FlowGraphSquareRootBlock"),"math/cbrt":eh("FlowGraphCubeRootBlock"),"math/pow":eh("FlowGraphPowerBlock",["a","b"]),"math/length":eh("FlowGraphLengthBlock"),"math/normalize":eh("FlowGraphNormalizeBlock"),"math/dot":eh("FlowGraphDotBlock",["a","b"]),"math/cross":eh("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":eh("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":eh("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{jV:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{jV:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{jV:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{jV:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{jV:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{jV:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{jV:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":eh("FlowGraphTransposeBlock"),"math/determinant":eh("FlowGraphDeterminantBlock"),"math/inverse":eh("FlowGraphInvertMatrixBlock"),"math/matmul":eh("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{jV:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ib",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M,O){const u=M[0].dataInputs.find((m=>"rotationQuaternion"===m.name));if(!u)throw new Error("Rotation quaternion input not found");return O._connectionValues[u.uniqueId]&&(O._connectionValues[u.uniqueId].type="Quaternion"),M}},"math/matDecompose":{jV:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ib"}}}},"math/quatConjugate":eh("FlowGraphConjugateBlock",["a"]),"math/quatMul":{jV:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M){var O;return(O=M[0]).config||(O.config={}),M[0].config.type="Quaternion",M}},"math/quatAngleBetween":eh("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{jV:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":eh("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":eh("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{jV:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M){var O;return(O=M[0]).config||(O.config={}),M[0].config.inputIsColumnMajor=!0,M}},"math/extract2x2":{jV:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{jV:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M){var O;return(O=M[0]).config||(O.config={}),M[0].config.inputIsColumnMajor=!0,M}},"math/extract3x3":{jV:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{jV:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M){var O;return(O=M[0]).config||(O.config={}),M[0].config.inputIsColumnMajor=!0,M}},"math/extract4x4":{jV:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{jV:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M,O){var u,b;(b=M[0]).config||(b.config={});const q=M[0].dataInputs[0];return M[0].config.valueType=(null===(u=O._connectionValues[q.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",M}},"math/and":{jV:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M,O){var u,b,q;(q=M[0]).config||(q.config={});const Y=M[0].dataInputs[0],V=M[0].dataInputs[1];return M[0].config.valueType=(null===(u=O._connectionValues[Y.uniqueId])||void 0===u?void 0:u.type)??(null===(b=O._connectionValues[V.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",M}},"math/or":{jV:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M,O){var u,b,q;(q=M[0]).config||(q.config={});const Y=M[0].dataInputs[0],V=M[0].dataInputs[1];return M[0].config.valueType=(null===(u=O._connectionValues[Y.uniqueId])||void 0===u?void 0:u.type)??(null===(b=O._connectionValues[V.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",M}},"math/xor":{jV:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(m,S,h,l,M,O){var u,b,q;(q=M[0]).config||(q.config={});const Y=M[0].dataInputs[0],V=M[0].dataInputs[1];return M[0].config.valueType=(null===(u=O._connectionValues[Y.uniqueId])||void 0===u?void 0:u.type)??(null===(b=O._connectionValues[V.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",M}},"math/asr":eh("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":eh("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":eh("FlowGraphLeadingZerosBlock"),"math/ctz":eh("FlowGraphTrailingZerosBlock"),"math/popcnt":eh("FlowGraphOneBitsCounterBlock"),"math/rad":eh("FlowGraphDegToRadBlock"),"math/deg":eh("FlowGraphRadToDegBlock"),"type/boolToInt":eh("FlowGraphBooleanToInt"),"type/boolToFloat":eh("FlowGraphBooleanToFloat"),"type/intToBool":eh("FlowGraphIntToBoolean"),"type/intToFloat":eh("FlowGraphIntToFloat"),"type/floatToInt":eh("FlowGraphFloatToInt"),"type/floatToBool":eh("FlowGraphFloatToBoolean"),"flow/sequence":{jV:["FlowGraphSequenceBlock"],extraProcessor(m,S,h,l,M){const O=M[0];return O.config||(O.config={}),O.config.outputSignalCount=Object.keys(m.flows||[]).length,O.signalOutputs.forEach(((m,S)=>{m.name="out_"+S})),M}},"flow/branch":{jV:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{jV:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(m){if(m.configuration&&m.configuration.cases){const S=m.configuration.cases.value;if(!S.every((m=>"number"===typeof m&&/^-?\d+$/.test(m.toString()))))return D.e.Warn("Switch cases should be integers. Using empty array instead."),m.configuration.cases.value=[],{valid:!0};const h=new Set(S);m.configuration.cases.value=Array.from(h)}return{valid:!0}},extraProcessor(m,S,h,l,M){if("flow/switch"!==S.op||!m.flows||0===Object.keys(m.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return M[0].signalOutputs.forEach((m=>{"default"!==m.name&&(m.name="out_"+m.name)})),M}},"flow/while":{jV:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{jV:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(m,S,h,l,M){const O=M[0];return O.config||(O.config={}),O.config.incrementIndexWhenLoopDone=!0,M}},"flow/doN":{jV:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{jV:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(m,S,h,l,M){if("flow/multiGate"!==S.op||!m.flows||0===Object.keys(m.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const O=M[0];return O.config||(O.config={}),O.config.outputSignalCount=Object.keys(m.flows).length,O.signalOutputs.forEach(((m,S)=>{m.name="out_"+S})),M}},"flow/waitAll":{jV:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(m){var S,h;return"number"!==typeof(null===(S=m.configuration)||void 0===S||null===(h=S.inputFlows)||void 0===h?void 0:h.value[0])&&(m.configuration=m.configuration||{inputFlows:{value:[0]}},m.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{jV:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{jV:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{jV:["FlowGraphCancelDelayBlock"]},"variable/get":{jV:["FlowGraphGetVariableBlock"],validation(m){var S,h;return null!==(S=m.configuration)&&void 0!==S&&null!==(h=S.variable)&&void 0!==h&&h.value?{valid:!0}:(D.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(m,S)=>[S.getVariableName(m[0])]}}},"variable/set":{jV:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(m,S)=>[S.getVariableName(m[0])]}}},"variable/setMultiple":{jV:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(m,S)=>[m[0].map((m=>S.getVariableName(m)))]}},extraProcessor:(m,S,h,l,M)=>(M[0].dataInputs.forEach((m=>{m.name=l.getVariableName(+m.name)})),M)},"variable/interpolate":{jV:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(m,S)=>[S.getVariableName(m[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:m=>!0===m[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Xh:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Xh:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Xh:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Xh:"FlowGraphPlayAnimationBlock"},out:{name:"out",Xh:"FlowGraphPlayAnimationBlock"},done:{name:"done",Xh:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(m,S,h,l,M){var O,u,b;const q=M[0],Y=null===(O=m.configuration)||void 0===O?void 0:O.variable.value[0];if("number"!==typeof Y)throw D.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const V=l.arrays.staticVariables[Y];"undefined"===typeof q.config.animationType.value&&(l.arrays.staticVariables,q.config.animationType.value=(0,Uh.D)(V.type));const I=M[4];return I.config||(I.config={}),(u=I.config).variable||(u.variable={}),I.config.variable.value=l.getVariableName(Y),(b=M[3]).config||(b.config={}),M}},"pointer/get":{jV:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Xh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Xh:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(m,S,h,l,M)=>(M.forEach((m=>{"FlowGraphJsonPointerParserBlock"===m.className&&(m.config||(m.config={}),m.config.outputValue=!0)})),M)},"pointer/set":{jV:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Xh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Xh:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(m,S,h,l,M)=>(M.forEach((m=>{"FlowGraphJsonPointerParserBlock"===m.className&&(m.config||(m.config={}),m.config.outputValue=!0)})),M)},"pointer/interpolate":{jV:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Xh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Xh:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Xh:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Xh:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Xh:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Xh:"FlowGraphPlayAnimationBlock"},out:{name:"out",Xh:"FlowGraphPlayAnimationBlock"},done:{name:"done",Xh:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(m,S,h,l,M)=>(M.forEach((S=>{"FlowGraphJsonPointerParserBlock"===S.className?(S.config||(S.config={}),S.config.outputValue=!0):"FlowGraphInterpolationBlock"===S.className&&(S.config||(S.config={}),Object.keys(m.values||[]).forEach((h=>{var M;const O=null===(M=m.values)||void 0===M?void 0:M[h];if("value"===h&&O){const m=O.type;void 0!==m&&(S.config.animationType=l.arrays.types[m].flowGraphType)}})))})),M)},"animation/start":{jV:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Xh:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(m,S)=>[m[0]*S._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(m,S)=>[m[0]*S._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(m,S,h,l,M,O,u){const b=M[M.length-1];return b.config||(b.config={}),b.config.glTF=u,M}},"animation/stop":{jV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Xh:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(m,S,h,l,M,O,u){const b=M[M.length-1];return b.config||(b.config={}),b.config.glTF=u,M}},"animation/stopAt":{jV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Xh:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(m,S)=>[m[0]*S._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(m,S,h,l,M,O,u){const b=M[M.length-1];return b.config||(b.config={}),b.config.glTF=u,M}},"math/switch":{jV:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(m){if(m.configuration&&m.configuration.cases){const S=m.configuration.cases.value;if(!S.every((m=>"number"===typeof m&&/^-?\d+$/.test(m.toString()))))return D.e.Warn("Switch cases should be integers. Using empty array instead."),m.configuration.cases.value=[],{valid:!0};const h=new Set(S);m.configuration.cases.value=Array.from(h)}return{valid:!0}},extraProcessor(m,S,h,l,M){const O=M[0];return O.dataInputs.forEach((m=>{"default"!==m.name&&"case"!==m.name&&(m.name="in_"+m.name)})),O.config||(O.config={}),O.config.treatCasesAsIntegers=!0,M}},"debug/log":{jV:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function eh(m){let S=arguments.length>2?arguments[2]:void 0;return{jV:[m],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((m,S)=>(m[S]={name:S},m)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(m,h,l,M,O){var u;if(S){(u=O[0]).config||(u.config={}),O[0].config.preventIntegerFloatArithmetic=!0;let S=-1;Object.keys(m.values||{}).find((h=>{var l;return void 0!==(null===(l=m.values)||void 0===l?void 0:l[h].type)&&(S=m.values[h].type,!0)})),-1!==S&&(O[0].config.type=M.arrays.types[S].flowGraphType)}return O},validation:m=>S?ah(m):{valid:!0}}}function ah(m){if(m.values){const S=Object.keys(m.values).map((S=>m.values[S].type)).filter((m=>void 0!==m));if(!S.every((m=>m===S[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Gh["math/compose"]=Gh["math/matCompose"],Gh["math/decompose"]=Gh["math/matDecompose"];var xh=h(11302);const Ph={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"nS",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class dh{constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=m,this._gltf=S,this._animationTargetFps=h,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const m of this._interactivityGraph.types)this._types.push(Ph[m.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const m of this._interactivityGraph.declarations){const S=Th(m);if(!S)throw D.e.Error(["No mapping found for declaration",m]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:S,fullOperationName:m.extension?m.op+":"+m.extension:m.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const m of this._interactivityGraph.variables){const S=this._parseVariable(m);this._staticVariables.push(S)}}_parseVariable(m,S){const h=this._types[m.type];if(!h)throw D.e.Error(["No type found for variable",m]),new Error("Error parsing variables");if(m.value&&m.value.length!==h.length)throw D.e.Error(["Invalid value length for variable",m,h]),new Error("Error parsing variables");const l=m.value||[];if(!l.length)switch(h.flowGraphType){case"boolean":l.push(!1);break;case"FlowGraphInteger":l.push(0);break;case"number":l.push(NaN);break;case"Vector2":l.push(NaN,NaN);break;case"nS":l.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":l.fill(NaN,0,4);break;case"Matrix":l.fill(NaN,0,16);break;case"Matrix3D":l.fill(NaN,0,9)}return"number"===h.elementType&&"string"===typeof l[0]&&(l[0]=parseFloat(l[0])),{type:h.flowGraphType,value:S?S(l,this):l}}_parseEvents(){if(this._interactivityGraph.events)for(const m of this._interactivityGraph.events){const S={eventId:m.id||"internalEvent_"+this._internalEventsCounter++};m.values&&(S.eventData=Object.keys(m.values).map((S=>{var h;const l=null===(h=m.values)||void 0===h?void 0:h[S];if(!l)throw D.e.Error(["No value found for event key",S]),new Error("Error parsing events");const M=this._types[l.type];if(!M)throw D.e.Error(["No type found for event value",l]),new Error("Error parsing events");const O="undefined"!==typeof l.value?this._parseVariable(l):void 0;return{id:S,type:M.flowGraphType,eventData:!0,value:O}}))),this._events.push(S)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const S of this._interactivityGraph.nodes){if("number"!==typeof S.declaration)throw D.e.Error(["No declaration found for node",S]),new Error("Error parsing nodes");const h=this._mappings[S.declaration];if(!h)throw D.e.Error(["No mapping found for node",S]),new Error("Error parsing nodes");if(h.flowGraphMapping.validation){const l=h.flowGraphMapping.validation(S,this._interactivityGraph,this._gltf);var m;if(!l.valid)throw new Error(`Error validating interactivity node ${null===(m=this._interactivityGraph.declarations)||void 0===m?void 0:m[S.declaration].op} - ${l.error}`)}const l=[];for(const m of h.flowGraphMapping.jV){const M=this._getEmptyBlock(m,h.fullOperationName);this._parseNodeConfiguration(S,M,h.flowGraphMapping,m),l.push(M)}this._nodes.push({jV:l,fullOperationName:h.fullOperationName})}}_getEmptyBlock(m,S){return{uniqueId:(0,xh.b)(),className:m,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:S,metadata:{}}}_parseNodeConfiguration(m,S,h,l){const M=S.config;if(m.configuration){const S=Object.keys(m.configuration);for(const b of S){var O,u;const S=null===(O=m.configuration)||void 0===O?void 0:O[b];if(!S)throw D.e.Error(["No value found for node configuration",b]),new Error("Error parsing node configuration");const q=null===(u=h.configuration)||void 0===u?void 0:u[b];if(q&&q.Xh?q.Xh===l:0===h.jV.indexOf(l)){const m=(null===q||void 0===q?void 0:q.name)||b;S&&"undefined"!==typeof S.value||"undefined"===typeof(null===q||void 0===q?void 0:q.defaultValue)?S.value.length>=0?M[m]={value:1===S.value.length?S.value[0]:S.value}:D.e.Warn(["Invalid value for node configuration",S]):M[m]={value:q.defaultValue},q&&q.dataTransformer&&(M[m].value=q.dataTransformer([M[m].value],this)[0])}}}}_parseNodeConnections(m){for(let y=0;y<this._nodes.length;y++){var S;const o=null===(S=this._interactivityGraph.nodes)||void 0===S?void 0:S[y];if(!o)throw D.e.Error(["No node found for interactivity node",this._nodes[y]]),new Error("Error parsing node connections");const s=this._nodes[y],v=this._mappings[o.declaration];if(!v)throw D.e.Error(["No mapping found for node",o]),new Error("Error parsing node connections");const T=o.flows||{},X=Object.keys(T).sort();for(const m of X){var h,l,M,O;const S=T[m],Y=null===(h=v.flowGraphMapping.outputs)||void 0===h||null===(l=h.flows)||void 0===l?void 0:l[m],V=(null===Y||void 0===Y?void 0:Y.name)||m,I=this._createNewSocketConnection(V,!0);(Y&&Y.Xh&&s.jV.find((m=>m.className===Y.Xh))||s.jV[0]).signalOutputs.push(I);const Z=S.node,C=this._nodes[Z];if(!C)throw D.e.Error(["No node found for input node id",Z]),new Error("Error parsing node connections");const B=vh(C.fullOperationName);if(!B)throw D.e.Error(["No mapping found for input node",C]),new Error("Error parsing node connections");let E=null===(M=B.inputs)||void 0===M||null===(O=M.flows)||void 0===O?void 0:O[S.socket||"in"],n=!1;if(!E)for(const m in null===(u=B.inputs)||void 0===u?void 0:u.flows){var u,b,q;if(m.startsWith("[")&&m.endsWith("]"))n=!0,E=null===(b=B.inputs)||void 0===b||null===(q=b.flows)||void 0===q?void 0:q[m]}const L=E?n?E.name.replace("$1",S.socket||""):E.name:S.socket||"in",U=E&&E.Xh&&C.jV.find((m=>m.className===E.Xh))||C.jV[0];let H=U.signalInputs.find((m=>m.name===L));H||(H=this._createNewSocketConnection(L),U.signalInputs.push(H)),H.connectedPointIds.push(I.uniqueId),I.connectedPointIds.push(H.uniqueId)}const g=o.values||{},G=Object.keys(g);for(const S of G){var Y,V;const h=g[S];let l=null===(Y=v.flowGraphMapping.inputs)||void 0===Y||null===(V=Y.values)||void 0===V?void 0:V[S],M=!1;if(!l)for(const m in null===(I=v.flowGraphMapping.inputs)||void 0===I?void 0:I.values){var I,Z,C;if(m.startsWith("[")&&m.endsWith("]"))M=!0,l=null===(Z=v.flowGraphMapping.inputs)||void 0===Z||null===(C=Z.values)||void 0===C?void 0:C[m]}const O=l?M?l.name.replace("$1",S):l.name:S,u=this._createNewSocketConnection(O);if((l&&l.Xh&&s.jV.find((m=>m.className===l.Xh))||s.jV[0]).dataInputs.push(u),void 0!==h.value){const S=this._parseVariable(h,l&&l.dataTransformer);m._connectionValues[u.uniqueId]=S}else{if("undefined"===typeof h.node)throw D.e.Error(["Invalid value for value connection",h]),new Error("Error parsing node connections");{var B,E,n;const m=h.node,S=h.socket||"value",l=this._nodes[m];if(!l)throw D.e.Error(["No node found for output socket reference",h]),new Error("Error parsing node connections");const M=vh(l.fullOperationName);if(!M)throw D.e.Error(["No mapping found for output socket reference",h]),new Error("Error parsing node connections");let O=null===(B=M.outputs)||void 0===B||null===(E=B.values)||void 0===E?void 0:E[S],b=!1;if(!O)for(const h in null===(L=M.outputs)||void 0===L?void 0:L.values){var L,U,H;if(h.startsWith("[")&&h.endsWith("]"))b=!0,O=null===(U=M.outputs)||void 0===U||null===(H=U.values)||void 0===H?void 0:H[h]}const q=O?b?O.name.replace("$1",S):null===(n=O)||void 0===n?void 0:n.name:S,Y=O&&O.Xh&&l.jV.find((m=>m.className===O.Xh))||l.jV[0];let V=Y.dataOutputs.find((m=>m.name===q));V||(V=this._createNewSocketConnection(q,!0),Y.dataOutputs.push(V)),u.connectedPointIds.push(V.uniqueId),V.connectedPointIds.push(u.uniqueId)}}}if(v.flowGraphMapping.interBlockConnectors)for(const m of v.flowGraphMapping.interBlockConnectors){const S=m.input,h=m.output,l=m.isVariable;this._connectFlowGraphNodes(S,h,s.jV[m.inputBlockIndex],s.jV[m.outputBlockIndex],l)}if(v.flowGraphMapping.extraProcessor){var R;const S=null===(R=this._interactivityGraph.declarations)||void 0===R?void 0:R[o.declaration];if(!S)throw D.e.Error(["No declaration found for extra processor",o]),new Error("Error parsing node connections");s.jV=v.flowGraphMapping.extraProcessor(o,S,v.flowGraphMapping,this,s.jV,m,this._gltf)}}}_createNewSocketConnection(m,S){return{uniqueId:(0,xh.b)(),name:m,_connectionType:S?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(m,S,h,l,M){const O=M?h.dataInputs:h.signalInputs,u=M?l.dataOutputs:l.signalOutputs,b=O.find((S=>S.name===m))||this._createNewSocketConnection(m),q=u.find((m=>m.name===S))||this._createNewSocketConnection(S,!0);O.find((S=>S.name===m))||O.push(b),u.find((m=>m.name===S))||u.push(q),b.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(b.uniqueId)}getVariableName(m){return"staticVariable_"+m}serializeToFlowGraph(){const m={uniqueId:(0,xh.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(m);for(let S=0;S<this._staticVariables.length;S++){const h=this._staticVariables[S];m._userVariables[this.getVariableName(S)]=h}return{rightHanded:!0,allBlocks:this._nodes.reduce(((m,S)=>m.concat(S.jV)),[]),executionContexts:[m]}}}const Jh="KHR_interactivity";class Nh{constructor(m){this._loader=m,this.name=Jh,this.enabled=this._loader.isExtensionUsed(Jh),this._pathConverter=(0,j.i)(this._loader.th),m._skipStartAnimationStep=!0;const S=m.babylonScene;S&&function(m){(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!m.activeCamera)return new M.Quaternion(NaN,NaN,NaN,NaN);const S=M.Quaternion.FromRotationMatrix(m.activeCamera.getWorldMatrix()).normalize();return m.useRightHandedSystem||(S.w*=-1,S.x*=-1),S},type:"Quaternion",getTarget:()=>m.activeCamera}),(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!m.activeCamera)return new M.nS(NaN,NaN,NaN);const S=m.activeCamera.getWorldMatrix().getTranslation();return m.useRightHandedSystem||(S.x*=-1),S},type:"nS",getTarget:()=>m.activeCamera}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:m=>{var S;return(null===(S=m._babylonAnimationGroup)||void 0===S?void 0:S.isPlaying)??!1},type:"boolean",getTarget:m=>m._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:m=>{var S;return((null===(S=m._babylonAnimationGroup)||void 0===S?void 0:S.from)??0)/60},type:"number",getTarget:m=>m._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:m=>{var S;return((null===(S=m._babylonAnimationGroup)||void 0===S?void 0:S.to)??0)/60},type:"number",getTarget:m=>m._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:m=>{var S;return((null===(S=m._babylonAnimationGroup)||void 0===S?void 0:S.getCurrentFrame())??0)/60},type:"number",getTarget:m=>m._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:m=>{var S;return((null===(S=m._babylonAnimationGroup)||void 0===S?void 0:S.getCurrentFrame())??0)/60},type:"number",getTarget:m=>m._babylonAnimationGroup})}(S)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var m;if(!this._loader.babylonScene||!this._pathConverter)return;const S=this._loader.babylonScene,h=null===(m=this._loader.th.extensions)||void 0===m?void 0:m.KHR_interactivity;if(!h)return;const l=new Bh.b({US:S});l.dispatchEventsSynchronously=!1;const M=h.graphs.map((m=>new dh(m,this._loader.th,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(M.map((async m=>await yh(m,{coordinator:l,pathConverter:this._pathConverter})))),l.start()}}var jh;jh=async()=>(await Promise.resolve().then(h.bind(h,13111))).FlowGraphGLTFDataProvider,Dh[`${Jh}/${"FlowGraphGLTFDataProvider"}`]=jh,N(Jh),J(Jh,!0,(m=>new Nh(m)));const Kh="KHR_node_visibility";(0,j.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:m=>{const S=m._babylonTransformNode;return!S||void 0===S.isVisible||S.isVisible},set:(m,S)=>{var h,l;null===(h=S._primitiveBabylonMeshes)||void 0===h||h.forEach((m=>{m.inheritVisibility=!0})),S._babylonTransformNode&&(S._babylonTransformNode.isVisible=m),null===(l=S._primitiveBabylonMeshes)||void 0===l||l.forEach((S=>{S.isVisible=m}))},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class ch{constructor(m){this.name=Kh,this._loader=m,this.enabled=m.isExtensionUsed(Kh)}async onReady(){var m;null===(m=this._loader.th.nodes)||void 0===m||m.forEach((m=>{var S,h,l,M;(null===(S=m._primitiveBabylonMeshes)||void 0===S||S.forEach((m=>{m.inheritVisibility=!0})),null!==(h=m.extensions)&&void 0!==h&&h.KHR_node_visibility)&&(!1===(null===(l=m.extensions)||void 0===l?void 0:l.KHR_node_visibility.visible)&&(m._babylonTransformNode&&(m._babylonTransformNode.isVisible=!1),null===(M=m._primitiveBabylonMeshes)||void 0===M||M.forEach((m=>{m.isVisible=!1}))))}))}dispose(){this._loader=null}}N(Kh),J(Kh,!0,(m=>new ch(m)));const fh="KHR_node_selectability";Xh("event/onSelect",fh,{jV:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Xh:"FlowGraphGetVariableBlock",dataTransformer:m=>["pickedMesh_"+m[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Xh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(m,S,h,l,M,O,u){var b,q,Y,V,I,Z;const C=M[M.length-1];C.config=C.config||{},C.config.glTF=u;const B=null===(b=m.configuration)||void 0===b||null===(q=b.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const D="pickedMesh_"+B;return M[1].config.variable=D,O._userVariables[D]={className:"Mesh",id:null===u||void 0===u||null===(Y=u.nodes)||void 0===Y||null===(V=Y[B]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===u||void 0===u||null===(I=u.nodes)||void 0===I||null===(Z=I[B]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},M}}),(0,j.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:m=>{const S=m._babylonTransformNode;return!S||void 0===S.qY||S.qY},set:(m,S)=>{var h;null===(h=S._primitiveBabylonMeshes)||void 0===h||h.forEach((S=>{S.qY=m}))},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"qY"],type:"boolean"});class ph{constructor(m){this.name=fh,this._loader=m,this.enabled=m.isExtensionUsed(fh)}async onReady(){var m;null===(m=this._loader.th.nodes)||void 0===m||m.forEach((m=>{var S,h,l;null!==(S=m.extensions)&&void 0!==S&&S.KHR_node_selectability&&!1===(null===(h=m.extensions)||void 0===h?void 0:h.KHR_node_selectability.selectable)&&(null===(l=m._babylonTransformNode)||void 0===l||l.getChildMeshes().forEach((m=>{m.qY=!1})))}))}dispose(){this._loader=null}}N(fh),J(fh,!0,(m=>new ph(m)));const kh="KHR_node_hoverability",rh="targetMeshPointerOver_";Xh("event/onHoverIn",kh,{jV:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Xh:"FlowGraphGetVariableBlock",dataTransformer:m=>[rh+m[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Xh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(m,S,h,l,M,O,u){var b,q,Y,V,I,Z;const C=M[M.length-1];C.config=C.config||{},C.config.glTF=u;const B=null===(b=m.configuration)||void 0===b||null===(q=b.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const D=rh+B;return M[1].config.variable=D,O._userVariables[D]={className:"Mesh",id:null===u||void 0===u||null===(Y=u.nodes)||void 0===Y||null===(V=Y[B]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===u||void 0===u||null===(I=u.nodes)||void 0===I||null===(Z=I[B]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},M}});const zh="targetMeshPointerOut_";Xh("event/onHoverOut",kh,{jV:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Xh:"FlowGraphGetVariableBlock",dataTransformer:m=>[zh+m[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Xh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(m,S,h,l,M,O,u){var b,q,Y,V,I,Z;const C=M[M.length-1];C.config=C.config||{},C.config.glTF=u;const B=null===(b=m.configuration)||void 0===b||null===(q=b.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const D=zh+B;return M[1].config.variable=D,O._userVariables[D]={className:"Mesh",id:null===u||void 0===u||null===(Y=u.nodes)||void 0===Y||null===(V=Y[B]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===u||void 0===u||null===(I=u.nodes)||void 0===I||null===(Z=I[B]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},M}}),(0,j.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:m=>{const S=m._babylonTransformNode;return!S||void 0===S.pointerOverDisableMeshTesting||S.pointerOverDisableMeshTesting},set:(m,S)=>{var h;null===(h=S._primitiveBabylonMeshes)||void 0===h||h.forEach((S=>{S.pointerOverDisableMeshTesting=!m}))},getTarget:m=>m._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Qh{constructor(m){this.name=kh,this._loader=m,this.enabled=m.isExtensionUsed(kh)}async onReady(){var m;null===(m=this._loader.th.nodes)||void 0===m||m.forEach((m=>{var S,h,l;null!==(S=m.extensions)&&void 0!==S&&S.KHR_node_hoverability&&!1===(null===(h=m.extensions)||void 0===h?void 0:h.KHR_node_hoverability.hoverable)&&(null===(l=m._babylonTransformNode)||void 0===l||l.getChildMeshes().forEach((m=>{m.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}N(kh),J(kh,!0,(m=>new Qh(m)));const Fh="ExtrasAsMetadata";class wh{_assignExtras(m,S){if(S.extras&&Object.keys(S.extras).length>0){const h=m.metadata=m.metadata||{};(h.th=h.th||{}).extras=S.extras}}constructor(m){this.name=Fh,this.enabled=!0,this._loader=m}dispose(){this._loader=null}loadNodeAsync(m,S,h){return this._loader.loadNodeAsync(m,S,(m=>{this._assignExtras(m,S),h(m)}))}loadCameraAsync(m,S,h){return this._loader.loadCameraAsync(m,S,(m=>{this._assignExtras(m,S),h(m)}))}createMaterial(m,S,h){const l=this._loader.createMaterial(m,S,h);return this._assignExtras(l,S),l}}N(Fh),J(Fh,!1,(m=>new wh(m)));h(13111)},12988:(m,S,h)=>{"use strict";h.d(S,{c:()=>a,f:()=>v,i:()=>s,l:()=>T});var l=h(11161),M=h(11156),O=h(12616),u=h(11751),b=h(11712),q=h(11726),Y=h(11173),V=h(11196),I=h(11745),Z=h(11855),C=h(11759),B=h(11381);class D{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.UZ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.SC=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(m){this._environmentTexture=m}getNodes(){let m=[];m=m.concat(this.meshes),m=m.concat(this.lights),m=m.concat(this.cameras),m=m.concat(this.transformNodes);for(const S of this.skeletons)m=m.concat(S.bones);return m}}class E extends D{}class n{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const m=this.rootNodes;for(const l of m)l.dispose();m.length=0;const S=this.skeletons;for(const l of S)l.dispose();S.length=0;const h=this.animationGroups;for(const l of h)l.dispose();h.length=0}}class L extends D{constructor(m){super(),this._wasAddedToScene=!1,(m=m||V.d.LastCreatedScene)&&(this.US=m,this.proceduralTextures=[],m.Jh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=m.getEngine().onContextRestoredObservable.add((()=>{for(const m of this.geometries)m._rebuild();for(const m of this.meshes)m._rebuild();for(const m of this.UZ)m.rebuild();for(const m of this.textures)m._rebuild()})))}_topologicalSort(m){const S=new Map;for(const u of m)S.set(u.uniqueId,u);const h={dependsOn:new Map,dependedBy:new Map};for(const u of m){const m=u.uniqueId;h.dependsOn.set(m,new Set),h.dependedBy.set(m,new Set)}for(const u of m){const m=u.uniqueId,l=h.dependsOn.get(m);if(u instanceof I.c){const M=u.sourceMesh;S.has(M.uniqueId)&&(l.add(M.uniqueId),h.dependedBy.get(M.uniqueId).add(m))}const M=h.dependedBy.get(m);for(const O of u.getDescendants()){const l=O.uniqueId;if(S.has(l)){M.add(l);h.dependsOn.get(l).add(m)}}}const l=[],M=[];for(const u of m){const m=u.uniqueId;0===h.dependsOn.get(m).size&&(M.push(u),S.delete(m))}const O=M;for(;O.length>0;){const m=O.shift();l.push(m);const M=h.dependedBy.get(m.uniqueId);for(const l of Array.from(M.values())){const M=h.dependsOn.get(l);M.delete(m.uniqueId),0===M.size&&S.get(l)&&(O.push(S.get(l)),S.delete(l))}}return S.size>0&&(Y.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),S.forEach((m=>{Y.e.Error(m.name)}))),l}_addNodeAndDescendantsToList(m,S,h,l){if(h&&(!l||l(h))&&!S.has(h.uniqueId)){m.push(h),S.add(h.uniqueId);for(const M of h.getDescendants(!0))this._addNodeAndDescendantsToList(m,S,M,l)}}_isNodeInContainer(m){return m instanceof q.e&&-1!==this.meshes.indexOf(m)||(m instanceof b.d&&-1!==this.transformNodes.indexOf(m)||(m instanceof Z.b&&-1!==this.lights.indexOf(m)||m instanceof C.d&&-1!==this.cameras.indexOf(m)))}_isValidHierarchy(){for(const m of this.meshes)if(m.parent&&!this._isNodeInContainer(m.parent))return Y.e.Warn(`Node ${m.name} has a parent that is not in the container.`),!1;for(const m of this.transformNodes)if(m.parent&&!this._isNodeInContainer(m.parent))return Y.e.Warn(`Node ${m.name} has a parent that is not in the container.`),!1;for(const m of this.lights)if(m.parent&&!this._isNodeInContainer(m.parent))return Y.e.Warn(`Node ${m.name} has a parent that is not in the container.`),!1;for(const m of this.cameras)if(m.parent&&!this._isNodeInContainer(m.parent))return Y.e.Warn(`Node ${m.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(m){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||M.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const l={},O={},b=new n,q=[],Y=[],V={doNotInstantiate:!0,...h},I=[],Z=new Set;for(const M of this.transformNodes)null===M.parent&&this._addNodeAndDescendantsToList(I,Z,M,V.predicate);for(const M of this.meshes)null===M.parent&&this._addNodeAndDescendantsToList(I,Z,M,V.predicate);const C=this._topologicalSort(I),B=(h,M)=>{if(((S,h)=>{if(l[S.uniqueId]=h.uniqueId,O[h.uniqueId]=h,m&&(h.name=m(S.name)),h instanceof u.c){const m=h;if(m.morphTargetManager){const h=S.morphTargetManager;m.morphTargetManager=h.clone();for(let S=0;S<h.numTargets;S++){const M=h.getTarget(S),u=m.morphTargetManager.getTarget(S);l[M.uniqueId]=u.uniqueId,O[u.uniqueId]=u}}}})(h,M),h.parent){const m=l[h.parent.uniqueId],S=O[m];M.parent=S||h.parent}if(M.position&&h.position&&M.position.l(h.position),M.rotationQuaternion&&h.rotationQuaternion&&M.rotationQuaternion.l(h.rotationQuaternion),M.rotation&&h.rotation&&M.rotation.l(h.rotation),M.Ib&&h.Ib&&M.Ib.l(h.Ib),M.material){const u=M;if(u.material)if(S){const S=h.material;if(-1===Y.indexOf(S)){let h=S.clone(m?m(S.name):"Clone of "+S.name);if(Y.push(S),l[S.uniqueId]=h.uniqueId,O[h.uniqueId]=h,"MultiMaterial"===S.getClassName()){const M=S;for(const S of M.Db)S&&(h=S.clone(m?m(S.name):"Clone of "+S.name),Y.push(S),l[S.uniqueId]=h.uniqueId,O[h.uniqueId]=h);M.Db=M.Db.map((m=>m&&O[l[m.uniqueId]]))}}"InstancedMesh"!==u.getClassName()&&(u.material=O[l[S.uniqueId]])}else"MultiMaterial"===u.material.getClassName()?-1===this.US.multiMaterials.indexOf(u.material)&&this.US.addMultiMaterial(u.material):-1===this.US.materials.indexOf(u.material)&&this.US.addMaterial(u.material)}null===M.parent&&b.rootNodes.push(M)};for(const M of C)if("InstancedMesh"===M.getClassName()){const m=M,S=m.sourceMesh,h=l[S.uniqueId];B(m,("number"===typeof h?O[h]:S).createInstance(m.name))}else{let m=!0;"Rb"===M.getClassName()||"Node"===M.getClassName()||M.skeleton||!M.getTotalVertices||0===M.getTotalVertices()?m=!1:V.doNotInstantiate&&(m="function"===typeof V.doNotInstantiate?!V.doNotInstantiate(M):!V.doNotInstantiate);const S=m?M.createInstance(`instance of ${M.name}`):M.clone(`Clone of ${M.name}`,null,!0);if(!S)throw new Error(`Could not clone or instantiate node on Asset Container ${M.name}`);B(M,S)}for(const M of this.skeletons){if(V.predicate&&!V.predicate(M))continue;const S=M.clone(m?m(M.name):"Clone of "+M.name);for(const m of this.meshes)if(m.skeleton===M&&!m.isAnInstance){const h=O[l[m.uniqueId]];if(!h||h.isAnInstance)continue;if(h.skeleton=S,-1!==q.indexOf(S))continue;q.push(S);for(const m of S.bones)m._linkedTransformNode&&(m._linkedTransformNode=O[l[m._linkedTransformNode.uniqueId]])}b.skeletons.push(S)}for(const M of this.animationGroups){if(V.predicate&&!V.predicate(M))continue;const S=M.clone(m?m(M.name):"Clone of "+M.name,(m=>O[l[m.uniqueId]]||m));b.animationGroups.push(S)}return b}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||M.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.US.environmentTexture=this.environmentTexture);for(const m of this.US._serializableComponents)m.addFromContainer(this);this.US.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const S=[];for(const h of this.cameras)m&&!m(h)||(this.US.addCamera(h),S.push(h));for(const h of this.lights)m&&!m(h)||(this.US.addLight(h),S.push(h));for(const h of this.meshes)m&&!m(h)||(this.US.vV(h),S.push(h));for(const h of this.skeletons)m&&!m(h)||this.US.addSkeleton(h);for(const h of this.animations)m&&!m(h)||this.US.addAnimation(h);for(const h of this.animationGroups)m&&!m(h)||this.US.addAnimationGroup(h);for(const h of this.multiMaterials)m&&!m(h)||this.US.addMultiMaterial(h);for(const h of this.materials)m&&!m(h)||this.US.addMaterial(h);for(const h of this.morphTargetManagers)m&&!m(h)||this.US.addMorphTargetManager(h);for(const h of this.geometries)m&&!m(h)||this.US.addGeometry(h);for(const h of this.transformNodes)m&&!m(h)||(this.US.addTransformNode(h),S.push(h));for(const h of this.actionManagers)m&&!m(h)||this.US.addActionManager(h);for(const h of this.textures)m&&!m(h)||this.US.addTexture(h);for(const h of this.reflectionProbes)m&&!m(h)||this.US.addReflectionProbe(h);for(const h of S)h.parent&&-1===this.US.getNodes().indexOf(h.parent)&&(h.setParent?h.setParent(null):h.parent=null)}removeAllFromScene(){this._isValidHierarchy()||M.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.US.environmentTexture&&(this.US.environmentTexture=null);for(const m of this.US._serializableComponents)m.removeFromContainer(this)}removeFromScene(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const S of this.cameras)m&&!m(S)||this.US.removeCamera(S);for(const S of this.lights)m&&!m(S)||this.US.removeLight(S);for(const S of this.meshes)m&&!m(S)||this.US.sV(S,!0);for(const S of this.skeletons)m&&!m(S)||this.US.removeSkeleton(S);for(const S of this.animations)m&&!m(S)||this.US.removeAnimation(S);for(const S of this.animationGroups)m&&!m(S)||this.US.removeAnimationGroup(S);for(const S of this.multiMaterials)m&&!m(S)||this.US.removeMultiMaterial(S);for(const S of this.materials)m&&!m(S)||this.US.removeMaterial(S);for(const S of this.morphTargetManagers)m&&!m(S)||this.US.removeMorphTargetManager(S);for(const S of this.geometries)m&&!m(S)||this.US.removeGeometry(S);for(const S of this.transformNodes)m&&!m(S)||this.US.removeTransformNode(S);for(const S of this.actionManagers)m&&!m(S)||this.US.removeActionManager(S);for(const S of this.textures)m&&!m(S)||this.US.removeTexture(S);for(const S of this.reflectionProbes)m&&!m(S)||this.US.removeReflectionProbe(S)}dispose(){const m=this.cameras.slice(0);for(const C of m)C.dispose();this.cameras.length=0;const S=this.lights.slice(0);for(const C of S)C.dispose();this.lights.length=0;const h=this.meshes.slice(0);for(const C of h)C.dispose();this.meshes.length=0;const l=this.skeletons.slice(0);for(const C of l)C.dispose();this.skeletons.length=0;const M=this.animationGroups.slice(0);for(const C of M)C.dispose();this.animationGroups.length=0;const O=this.multiMaterials.slice(0);for(const C of O)C.dispose();this.multiMaterials.length=0;const u=this.materials.slice(0);for(const C of u)C.dispose();this.materials.length=0;const b=this.geometries.slice(0);for(const C of b)C.dispose();this.geometries.length=0;const q=this.transformNodes.slice(0);for(const C of q)C.dispose();this.transformNodes.length=0;const Y=this.actionManagers.slice(0);for(const C of Y)C.dispose();this.actionManagers.length=0;const V=this.textures.slice(0);for(const C of V)C.dispose();this.textures.length=0;const I=this.reflectionProbes.slice(0);for(const C of I)C.dispose();this.reflectionProbes.length=0;const Z=this.morphTargetManagers.slice(0);for(const C of Z)C.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const C of this.US._serializableComponents)C.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.US.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(m,S,h){if(m&&S)for(const l of m){let m=!0;if(h)for(const S of h)if(l===S){m=!1;break}m&&(S.push(l),l._parentContainer=this)}}moveAllFromScene(m){this._wasAddedToScene=!1,void 0===m&&(m=new E);for(const S in this)Object.prototype.hasOwnProperty.call(this,S)&&(this[S]=this[S]||("_environmentTexture"===S?null:[]),this._moveAssets(this.US[S],this[S],m[S]));this.environmentTexture=this.US.environmentTexture,this.removeAllFromScene()}createRootMesh(){const m=new u.c("assetContainerRootMesh",this.US);for(const S of this.meshes)S.parent||m.addChild(S);return this.meshes.unshift(m),m}mergeAnimationsTo(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.d.LastCreatedScene,S=arguments.length>1?arguments[1]:void 0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!m)return Y.e.Error("No scene available to merge animations to"),[];const l=h||(S=>{let h=null;const l=S.animations.length?S.animations[0].targetProperty:"",M=S.name.split(".").join("").split("_primitive")[0];switch(l){case"position":case"rotationQuaternion":h=m.getTransformNodeByName(S.name)||m.getTransformNodeByName(M);break;case"influence":h=m.getMorphTargetByName(S.name)||m.getMorphTargetByName(M);break;default:h=m.getNodeByName(S.name)||m.getNodeByName(M)}return h}),M=this.getNodes();for(const b of M){const m=l(b);if(null!==m){for(const S of b.animations){const h=m.animations.filter((m=>m.targetProperty===S.targetProperty));for(const S of h){const h=m.animations.indexOf(S,0);h>-1&&m.animations.splice(h,1)}}m.animations=m.animations.concat(b.animations)}}const O=[],u=this.animationGroups.slice();for(const b of u){O.push(b.clone(b.name,l));for(const m of b.animatables)m.stop()}for(const b of S){const S=l(b.target);S&&(m.beginAnimation(S,b.fromFrame,b.toFrame,b.loopAnimation,b.speedRatio,b.onAnimationEnd?b.onAnimationEnd:void 0,void 0,!0,void 0,b.onAnimationLoop?b.onAnimationLoop:void 0),m.stopAnimation(b.target))}return O}populateRootNodes(){this.rootNodes.length=0;for(const m of this.meshes)m.parent||-1!==this.rootNodes.indexOf(m)||this.rootNodes.push(m);for(const m of this.transformNodes)m.parent||-1!==this.rootNodes.indexOf(m)||this.rootNodes.push(m);for(const m of this.lights)m.parent||-1!==this.rootNodes.indexOf(m)||this.rootNodes.push(m);for(const m of this.cameras)m.parent||-1!==this.rootNodes.indexOf(m)||this.rootNodes.push(m)}addAllAssetsToContainer(m){if(!m)return;const S=[],h=new Set;for(S.push(m);S.length>0;){const m=S.pop();if(m instanceof u.c?(m.ub&&-1===this.geometries.indexOf(m.ub)&&this.geometries.push(m.ub),this.meshes.push(m)):m instanceof I.c?this.meshes.push(m):m instanceof b.d?this.transformNodes.push(m):m instanceof Z.b?this.lights.push(m):m instanceof C.d&&this.cameras.push(m),m instanceof q.e){if(m.material&&-1===this.materials.indexOf(m.material)){this.materials.push(m.material);for(const S of m.material.getActiveTextures())-1===this.textures.indexOf(S)&&this.textures.push(S)}m.skeleton&&-1===this.skeletons.indexOf(m.skeleton)&&this.skeletons.push(m.skeleton),m.morphTargetManager&&-1===this.morphTargetManagers.indexOf(m.morphTargetManager)&&this.morphTargetManagers.push(m.morphTargetManager)}for(const l of m.getChildren())h.has(l)||S.push(l);h.add(m)}this.populateRootNodes()}_getByTags(m,S,h){if(void 0===S)return m;const l=[];for(const M in m){const O=m[M];B.b&&B.b.MatchesQuery(O,S)&&(!h||h(O))&&l.push(O)}return l}getMeshesByTags(m,S){return this._getByTags(this.meshes,m,S)}getCamerasByTags(m,S){return this._getByTags(this.cameras,m,S)}getLightsByTags(m,S){return this._getByTags(this.lights,m,S)}getMaterialsByTags(m,S){return this._getByTags(this.materials,m,S).concat(this._getByTags(this.multiMaterials,m,S))}getTransformNodesByTags(m,S){return this._getByTags(this.transformNodes,m,S)}}var U=h(11216);class H{constructor(m){this.byteOffset=0,this.buffer=m}async loadAsync(m){const S=await this.buffer.readAsync(this.byteOffset,m);this._dataView=new DataView(S.buffer,S.byteOffset,S.byteLength),this._dataByteOffset=0}readUint32(){const m=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,m}readUint8Array(m){const S=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,m);return this._dataByteOffset+=m,this.byteOffset+=m,S}readString(m){return(0,U.f)(this.readUint8Array(m))}skipBytes(m){this._dataByteOffset+=m,this.byteOffset+=m}}var R=h(12997);const y="Z2xURg",o={name:"th",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:m=>-1!==m.indexOf("asset")&&-1!==m.indexOf("version")||m.startsWith("data:base64,"+y)||m.startsWith("data:;base64,"+y)||m.startsWith("data:application/octet-stream;base64,"+y)||m.startsWith("data:model/gltf-binary;base64,"+y)};var s,v,T,X=h(11205),g=h(11210);function G(m,S,h){try{return Promise.resolve(new Uint8Array(m,S,h))}catch(l){return Promise.reject(l)}}!function(m){m[m.AUTO=0]="AUTO",m[m.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(s||(s={})),function(m){m[m.NONE=0]="NONE",m[m.FIRST=1]="FIRST",m[m.ALL=2]="ALL"}(v||(v={})),function(m){m[m.LOADING=0]="LOADING",m[m.READY=1]="READY",m[m.COMPLETE=2]="COMPLETE"}(T||(T={}));class e{constructor(){this.coordinateSystemMode=s.AUTO,this.animationStartMode=v.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=m=>Promise.resolve(m),this.extensionOptions={}}l(m){m&&(this.onParsed=m.onParsed,this.coordinateSystemMode=m.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=m.animationStartMode??this.animationStartMode,this.loadNodeAnimations=m.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=m.loadSkins??this.loadSkins,this.loadMorphTargets=m.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=m.compileMaterials??this.compileMaterials,this.useClipPlane=m.useClipPlane??this.useClipPlane,this.compileShadowGenerators=m.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=m.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=m.useRangeRequests??this.useRangeRequests,this.createInstances=m.createInstances??this.createInstances,this.alwaysComputeBoundingBox=m.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=m.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=m.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=m.skipMaterials??this.skipMaterials,this.useSRGBBuffers=m.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=m.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=m.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=m.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=m.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=m.customRootNode,this.onMeshLoaded=m.onMeshLoaded,this.onSkinLoaded=m.onSkinLoaded,this.onTextureLoaded=m.onTextureLoaded,this.onMaterialLoaded=m.onMaterialLoaded,this.onCameraLoaded=m.onCameraLoaded,this.extensionOptions=m.extensionOptions??this.extensionOptions)}}class a extends e{constructor(m){super(),this.onParsedObservable=new l.e,this.onMeshLoadedObservable=new l.e,this.onSkinLoadedObservable=new l.e,this.onTextureLoadedObservable=new l.e,this.onMaterialLoadedObservable=new l.e,this.onCameraLoadedObservable=new l.e,this.onCompleteObservable=new l.e,this.onErrorObservable=new l.e,this.Jh=new l.e,this.onExtensionLoadedObservable=new l.e,this.validate=!1,this.onValidatedObservable=new l.e,this._loader=null,this._state=null,this._requests=new Array,this.name=o.name,this.extensions=o.extensions,this.onLoaderStateChangedObservable=new l.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.l(m)}set onParsed(m){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),m&&(this._onParsedObserver=this.onParsedObservable.add(m))}set onMeshLoaded(m){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),m&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(m))}set onSkinLoaded(m){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),m&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((S=>m(S.node,S.skinnedNode))))}set onTextureLoaded(m){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),m&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(m))}set onMaterialLoaded(m){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),m&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(m))}set onCameraLoaded(m){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),m&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(m))}set onComplete(m){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(m)}set onError(m){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(m)}set onDispose(m){this._onDisposeObserver&&this.Jh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Jh.add(m)}set onExtensionLoaded(m){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(m)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(m){this._loggingEnabled!==m&&(this._loggingEnabled=m,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(m){this._capturePerformanceCounters!==m&&(this._capturePerformanceCounters=m,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(m){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(m)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const m of this._requests)m.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=m=>Promise.resolve(m),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Jh.notifyObservers(void 0),this.Jh.clear()}loadFile(m,S,h,O,u,b,q,V){if(ArrayBuffer.isView(S))return this._loadBinary(m,S,h,O,q,V),null;this._progressCallback=u;const I=S.name||M.Tools.GetFilename(S);if(b){if(this.useRangeRequests){this.validate&&Y.e.Warn("glTF validation is not supported when range requests are enabled");const h={abort:()=>{},onCompleteObservable:new l.e},M={readAsync:(h,l)=>new Promise(((M,O)=>{this._loadFile(m,S,(m=>{M(new Uint8Array(m))}),!0,(m=>{O(m)}),(m=>{m.setRequestHeader("Range",`bytes=${h}-${h+l-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new H(M)).then((m=>{h.onCompleteObservable.notifyObservers(h),O(m)}),q?m=>q(void 0,m):void 0),h}return this._loadFile(m,S,(S=>{this._validate(m,new Uint8Array(S,0,S.byteLength),h,I),this._unpackBinaryAsync(new H({readAsync:(m,h)=>G(S,m,h),byteLength:S.byteLength})).then((m=>{O(m)}),q?m=>q(void 0,m):void 0)}),!0,q)}return this._loadFile(m,S,(S=>{try{this._validate(m,S,h,I),O({json:this._parseJson(S)})}catch{q&&q()}}),!1,q)}_loadBinary(m,S,h,l,M,O){this._validate(m,new Uint8Array(S.buffer,S.byteOffset,S.byteLength),h,O),this._unpackBinaryAsync(new H({readAsync:(m,h)=>function(m,S,h){try{if(S<0||S>=m.byteLength)throw new RangeError("Offset is out of range.");if(S+h>m.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(m.buffer,m.byteOffset+S,h))}catch(l){return Promise.reject(l)}}(S,m,h),byteLength:S.byteLength})).then((m=>{l(m)}),M?m=>M(void 0,m):void 0)}importMeshAsync(m,S,h,l,M,O){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${O||""}`),this._loader=this._getLoader(h),this._loader.importMeshAsync(m,S,null,h,l,M,O))))}loadAsync(m,S,h,l,M){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${M||""}`),this._loader=this._getLoader(S),this._loader.loadAsync(m,S,h,l,M))))}loadAssetContainerAsync(m,S,h,l,M){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${M||""}`),this._loader=this._getLoader(S);const O=new L(m),u=[];this.onMaterialLoadedObservable.add((m=>{u.push(m)}));const b=[];this.onTextureLoadedObservable.add((m=>{b.push(m)}));const q=[];this.onCameraLoadedObservable.add((m=>{q.push(m)}));const Y=[];return this.onMeshLoadedObservable.add((m=>{m.morphTargetManager&&Y.push(m.morphTargetManager)})),this._loader.importMeshAsync(null,m,O,S,h,l,M).then((m=>(Array.prototype.push.apply(O.geometries,m.geometries),Array.prototype.push.apply(O.meshes,m.meshes),Array.prototype.push.apply(O.UZ,m.UZ),Array.prototype.push.apply(O.skeletons,m.skeletons),Array.prototype.push.apply(O.animationGroups,m.animationGroups),Array.prototype.push.apply(O.materials,u),Array.prototype.push.apply(O.textures,b),Array.prototype.push.apply(O.lights,m.lights),Array.prototype.push.apply(O.transformNodes,m.transformNodes),Array.prototype.push.apply(O.cameras,q),Array.prototype.push.apply(O.morphTargetManagers,Y),O)))}))}canDirectLoad(m){return o.canDirectLoad(m)}directLoad(m,S){if(S.startsWith("base64,"+y)||S.startsWith(";base64,"+y)||S.startsWith("application/octet-stream;base64,"+y)||S.startsWith("model/gltf-binary;base64,"+y)){const h=(0,X.c)(S);return this._validate(m,new Uint8Array(h,0,h.byteLength)),this._unpackBinaryAsync(new H({readAsync:(m,S)=>G(h,m,S),byteLength:h.byteLength}))}return this._validate(m,S),Promise.resolve({json:this._parseJson(S)})}createPlugin(m){return new a(m[o.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((m,S)=>{this.onCompleteObservable.addOnce((()=>{m()})),this.onErrorObservable.addOnce((m=>{S(m)}))}))}_setState(m){this._state!==m&&(this._state=m,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(T[this._state]))}_loadFile(m,S,h,l,M,O){const u=m._loadFile(S,h,(m=>{this._onProgress(m,u)}),!0,l,M,O);return u.onCompleteObservable.add((()=>{u._lengthComputable=!0,u._total=u._loaded})),this._requests.push(u),u}_onProgress(m,S){if(!this._progressCallback)return;S._lengthComputable=m.lengthComputable,S._loaded=m.loaded,S._total=m.total;let h=!0,l=0,M=0;for(const O of this._requests){if(void 0===O._lengthComputable||void 0===O._loaded||void 0===O._total)return;h=h&&O._lengthComputable,l+=O._loaded,M+=O._total}this._progressCallback({lengthComputable:h,loaded:l,total:h?M:0})}_validate(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),R.e.ValidateAsync(S,h,l,(S=>this.preprocessUrlAsync(h+S).then((S=>m._loadFileAsync(S,void 0,!0,!0).then((m=>new Uint8Array(m,0,m.byteLength))))))).then((m=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(m),this.onValidatedObservable.clear()}),(m=>{this._endPerformanceCounter("Validate JSON"),M.Tools.Warn(`Failed to validate: ${m.message}`),this.onValidatedObservable.clear()})))}_getLoader(m){const S=m.json.asset||{};this._log(`Asset version: ${S.version}`),S.minVersion&&this._log(`Asset minimum version: ${S.minVersion}`),S.generator&&this._log(`Asset generator: ${S.generator}`);const h=a._parseVersion(S.version);if(!h)throw new Error("Invalid version: "+S.version);if(void 0!==S.minVersion){const m=a._parseVersion(S.minVersion);if(!m)throw new Error("Invalid minimum version: "+S.minVersion);if(a._compareVersion(m,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+S.minVersion)}const l={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader}[h.major];if(!l)throw new Error("Unsupported version: "+S.version);return l(this)}_parseJson(m){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${m.length}`);const S=JSON.parse(m);return this._endPerformanceCounter("Parse JSON"),S}_unpackBinaryAsync(m){return this._startPerformanceCounter("Unpack Binary"),m.loadAsync(20).then((()=>{const S=m.readUint32();if(1179937895!==S)throw new g.e("Unexpected magic: "+S,g.d.GLTFLoaderUnexpectedMagicError);const h=m.readUint32();this.loggingEnabled&&this._log(`Binary version: ${h}`);const l=m.readUint32();let M;switch(this.useRangeRequests||l===m.buffer.byteLength||Y.e.Warn(`Length in header does not match actual data length: ${l} != ${m.buffer.byteLength}`),h){case 1:M=this._unpackBinaryV1Async(m,l);break;case 2:M=this._unpackBinaryV2Async(m,l);break;default:throw new Error("Unsupported version: "+h)}return this._endPerformanceCounter("Unpack Binary"),M}))}_unpackBinaryV1Async(m,S){const h=m.readUint32(),l=m.readUint32();if(0!==l)throw new Error(`Unexpected content format: ${l}`);const M=S-m.byteOffset,O={json:this._parseJson(m.readString(h)),bin:null};if(0!==M){const S=m.byteOffset;O.bin={readAsync:(h,l)=>m.buffer.readAsync(S+h,l),byteLength:M}}return Promise.resolve(O)}_unpackBinaryV2Async(m,S){const h=1313821514,l=5130562,M=m.readUint32();if(m.readUint32()!==h)throw new Error("First chunk format is not JSON");return m.byteOffset+M===S?m.loadAsync(M).then((()=>({json:this._parseJson(m.readString(M)),bin:null}))):m.loadAsync(M+8).then((()=>{const O={json:this._parseJson(m.readString(M)),bin:null},u=()=>{const M=m.readUint32();switch(m.readUint32()){case h:throw new Error("Unexpected JSON chunk");case l:{const S=m.byteOffset;O.bin={readAsync:(h,l)=>m.buffer.readAsync(S+h,l),byteLength:M},m.skipBytes(M);break}default:m.skipBytes(M)}return m.byteOffset!==S?m.loadAsync(8).then(u):Promise.resolve(O)};return u()}))}static _parseVersion(m){if("1.0"===m||"1.0.1"===m)return{major:1,minor:0};const S=(m+"").match(/^(\d+)\.(\d+)/);return S?{major:parseInt(S[1]),minor:parseInt(S[2])}:null}static _compareVersion(m,S){return m.major>S.major?1:m.major<S.major?-1:m.minor>S.minor?1:m.minor<S.minor?-1:0}_logOpen(m){this._log(m),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(m){const S=a._logSpaces.substring(0,2*this._logIndentLevel);Y.e.Log(`${S}${m}`)}_logDisabled(m){}_startPerformanceCounterEnabled(m){M.Tools.StartPerformanceCounter(m)}_startPerformanceCounterDisabled(m){}_endPerformanceCounterEnabled(m){M.Tools.EndPerformanceCounter(m)}_endPerformanceCounterDisabled(m){}}a.IncrementalLoading=!0,a.HomogeneousCoordinates=!1,a._logSpaces="                                ",(0,O.b)(new a)},12997:(m,S,h)=>{"use strict";h.d(S,{e:()=>u});var l=h(11156);function M(m,S,h,l){const M={externalResourceFunction:l};return h&&(M.uri="file:"===S?h:S+h),ArrayBuffer.isView(m)?GLTFValidator.validateBytes(m,M):GLTFValidator.validateString(m,M)}function O(){const m=[];onmessage=S=>{const h=S.data;switch(h.id){case"init":importScripts(h.url);break;case"validate":M(h.data,h.rootUrl,h.fileName,(S=>new Promise(((h,l)=>{const M=m.length;m.push({resolve:h,reject:l}),postMessage({id:"getExternalResource",index:M,uri:S})})))).then((m=>{postMessage({id:"validate.resolve",value:m})}),(m=>{postMessage({id:"validate.reject",reason:m})}));break;case"getExternalResource.resolve":m[h.index].resolve(h.value);break;case"getExternalResource.reject":m[h.index].reject(h.reason)}}}class u{static ValidateAsync(m,S,h,u){return"function"===typeof Worker?new Promise(((b,q)=>{const Y=`${M}(${O})()`,V=URL.createObjectURL(new Blob([Y],{type:"application/javascript"})),I=new Worker(V),Z=m=>{I.removeEventListener("error",Z),I.removeEventListener("message",C),q(m)},C=m=>{const S=m.data;switch(S.id){case"getExternalResource":u(S.uri).then((m=>{I.postMessage({id:"getExternalResource.resolve",index:S.index,value:m},[m.buffer])}),(m=>{I.postMessage({id:"getExternalResource.reject",index:S.index,reason:m})}));break;case"validate.resolve":I.removeEventListener("error",Z),I.removeEventListener("message",C),b(S.value),I.terminate();break;case"validate.reject":I.removeEventListener("error",Z),I.removeEventListener("message",C),q(S.reason),I.terminate()}};if(I.addEventListener("error",Z),I.addEventListener("message",C),I.postMessage({id:"init",url:l.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(m)){const l=m.slice();I.postMessage({id:"validate",data:l,rootUrl:S,fileName:h},[l.buffer])}else I.postMessage({id:"validate",data:m,rootUrl:S,fileName:h})})):(this._LoadScriptPromise||(this._LoadScriptPromise=l.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>M(m,S,h,u))))}}u.Configuration={url:`${l.Tools._DefaultCdnUrl}/gltf_validator.js`}},13564:(m,S,h)=>{"use strict";h.d(S,{d:()=>o});var l=h(11327),M=h(11336),O=h(11377),u=h(11347),b=h(11682),q=h(11625),Y=h(11410),V=h(11567),I=h(11293),Z=h(11242);h(12753),h(12651),h(12669),h(12657),h(12672),h(12681),h(12688);const C="imageProcessingCompatibility",B="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Z.b.IncludesShadersStore[C]||(Z.b.IncludesShadersStore[C]=B);const D="skyPixelShader",E="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Z.b.ShadersStore[D]||(Z.b.ShadersStore[D]=E);h(12766),h(12697),h(12701),h(12712),h(12707);const n="skyVertexShader",L="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Z.b.ShadersStore[n]||(Z.b.ShadersStore[n]=L);var U=h(11617),H=h(11668),R=h(11663);class y extends b.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class o extends q.d{constructor(m,S){super(m,S),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new u.nS(0,100,0),this.useSunPosition=!1,this.cameraOffset=u.nS.Zero(),this.up=u.nS.Up(),this.dithering=!1,this._cameraPosition=u.nS.Zero(),this._skyOrientation=new u.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(m,S){const h=S._drawWrapper;if(this.isFrozen&&h.effect&&h._wasPreviouslyReady)return!0;S.materialDefines||(S.materialDefines=new y);const l=S.materialDefines,M=this.sm();if(this._isReadyForSubMesh(S))return!0;if((0,R.X)(m,M,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,l),(0,R.N)(m,l,!0,!1),l.IMAGEPROCESSINGPOSTPROCESS!==M.imageProcessingConfiguration.applyByPostProcess&&l.markAsMiscDirty(),l.DITHER!==this.dithering&&l.markAsMiscDirty(),l.isDirty){l.markAsProcessed(),M.resetCachedMaterial();const m=new U.e;l.FOG&&m.addFallback(1,"FOG"),l.IMAGEPROCESSINGPOSTPROCESS=M.imageProcessingConfiguration.applyByPostProcess,l.DITHER=this.dithering;const h=[Y.f.PositionKind];l.VERTEXCOLOR&&h.push(Y.f.ColorKind);const O="sky",u=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,H.e)(u);const b=l.toString();S.setEffect(M.getEngine().createEffect(O,h,u,[],b,m,this.onCompiled,this.onError),l,this._materialContext)}return!(!S.effect||!S.effect.isReady())&&(l._renderId=M.getRenderId(),h._wasPreviouslyReady=!0,!0)}bindForSubMesh(m,S,h){const l=this.sm(),M=h.materialDefines;if(!M)return;const O=h.effect;if(!O)return;this._activeEffect=O,this.bindOnlyWorldMatrix(m),this._activeEffect.setMatrix("viewProjection",l.getTransformMatrix()),this._mustRebind(l,O,h)&&((0,H.g)(O,this,l),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,R.j)(M,O,l)),l.fogEnabled&&S.applyFog&&l.fogMode!==V.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",l.getViewMatrix()),(0,R.g)(l,S,this._activeEffect);const b=l.activeCamera;if(b){const m=b.getWorldMatrix();this._cameraPosition.x=m.m[12],this._cameraPosition.y=m.m[13],this._cameraPosition.z=m.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const m=Math.PI*(this.inclination-.5),S=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(S)*Math.cos(m),this.sunPosition.y=this.distance*Math.sin(-m),this.sunPosition.z=this.distance*Math.sin(S)*Math.cos(m),u.Quaternion.FromUnitVectorsToRef(u.nS.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(S,this._activeEffect,h)}getAnimatables(){return[]}dispose(m){super.dispose(m)}clone(m){return O.e.Clone((()=>new o(m,this.sm())),this)}serialize(){const m=super.serialize();return m.customType="BABYLON.SkyMaterial",m}getClassName(){return"SkyMaterial"}static Parse(m,S,h){return O.e.Parse((()=>new o(m.name,S)),m,S,h)}}(0,l.d)([(0,M.F)()],o.prototype,"luminance",void 0),(0,l.d)([(0,M.F)()],o.prototype,"turbidity",void 0),(0,l.d)([(0,M.F)()],o.prototype,"rayleigh",void 0),(0,l.d)([(0,M.F)()],o.prototype,"mieCoefficient",void 0),(0,l.d)([(0,M.F)()],o.prototype,"mieDirectionalG",void 0),(0,l.d)([(0,M.F)()],o.prototype,"distance",void 0),(0,l.d)([(0,M.F)()],o.prototype,"inclination",void 0),(0,l.d)([(0,M.F)()],o.prototype,"azimuth",void 0),(0,l.d)([(0,M.B)()],o.prototype,"sunPosition",void 0),(0,l.d)([(0,M.F)()],o.prototype,"useSunPosition",void 0),(0,l.d)([(0,M.B)()],o.prototype,"cameraOffset",void 0),(0,l.d)([(0,M.B)()],o.prototype,"up",void 0),(0,l.d)([(0,M.F)()],o.prototype,"dithering",void 0),(0,I.e)("BABYLON.SkyMaterial",o)},12016:(m,S,h)=>{"use strict";function l(m,S){S.headers=m.headers||{},S.statusMessage=m.statusText,S.statusCode=m.status,S.data=m.response}function M(m,S,h){return new Promise((function(M,O){h=h||{};var u,b,q,Y=new XMLHttpRequest,V=h.body,I=h.headers||{};for(u in h.timeout&&(Y.timeout=h.timeout),Y.ontimeout=Y.onerror=function(m){m.timeout="timeout"==m.type,O(m)},Y.open(m,S.href||S),Y.onload=function(){for(q=Y.getAllResponseHeaders().trim().split(/[\r\n]+/),l(Y,Y);b=q.shift();)b=b.split(": "),Y.headers[b.shift().toLowerCase()]=b.join(": ");if((b=Y.headers["content-type"])&&~b.indexOf("application/json"))try{Y.data=JSON.parse(Y.data,h.reviver)}catch(m){return l(Y,m),O(m)}(Y.status>=400?O:M)(Y)},typeof FormData<"u"&&V instanceof FormData||V&&"object"==typeof V&&(I["content-type"]="application/json",V=JSON.stringify(V)),Y.withCredentials=!!h.withCredentials,I)Y.setRequestHeader(u,I[u]);Y.send(V)}))}h.r(S),h.d(S,{del:()=>q,get:()=>O,patch:()=>b,post:()=>u,put:()=>Y,send:()=>M});var O=M.bind(M,"GET"),u=M.bind(M,"POST"),b=M.bind(M,"PATCH"),q=M.bind(M,"DELETE"),Y=M.bind(M,"PUT")},13672:(m,S,h)=>{"use strict";h.d(S,{e:()=>I});const l=.5*(Math.sqrt(3)-1),M=(3-Math.sqrt(3))/6,O=1/3,u=1/6,b=(Math.sqrt(5)-1)/4,q=(5-Math.sqrt(5))/20,Y=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),V=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const I=class{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const S="function"==typeof m?m:function(m){let S=0,h=0,l=0,M=1;const O=function(){let m=4022871197;return function(S){S=S.toString();for(let h=0;h<S.length;h++){m+=S.charCodeAt(h);let l=.02519603282416938*m;m=l>>>0,l-=m,l*=m,m=l>>>0,l-=m,m+=4294967296*l}return 2.3283064365386963e-10*(m>>>0)}}();S=O(" "),h=O(" "),l=O(" "),S-=O(m),S<0&&(S+=1);h-=O(m),h<0&&(h+=1);l-=O(m),l<0&&(l+=1);return function(){const m=2091639*S+2.3283064365386963e-10*M;return S=h,h=l,l=m-(M=0|m)}}(m);this.p=function(m){const S=new Uint8Array(256);for(let h=0;h<256;h++)S[h]=h;for(let h=0;h<255;h++){const l=h+~~(m()*(256-h)),M=S[h];S[h]=S[l],S[l]=M}return S}(S),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let h=0;h<512;h++)this.perm[h]=this.p[255&h],this.permMod12[h]=this.perm[h]%12}noise2D(m,S){const h=this.permMod12,O=this.perm;let u=0,b=0,q=0;const V=(m+S)*l,I=Math.floor(m+V),Z=Math.floor(S+V),C=(I+Z)*M,B=m-(I-C),D=S-(Z-C);let E,n;B>D?(E=1,n=0):(E=0,n=1);const L=B-E+M,U=D-n+M,H=B-1+2*M,R=D-1+2*M,y=255&I,o=255&Z;let s=.5-B*B-D*D;if(s>=0){const m=3*h[y+O[o]];s*=s,u=s*s*(Y[m]*B+Y[m+1]*D)}let v=.5-L*L-U*U;if(v>=0){const m=3*h[y+E+O[o+n]];v*=v,b=v*v*(Y[m]*L+Y[m+1]*U)}let T=.5-H*H-R*R;if(T>=0){const m=3*h[y+1+O[o+1]];T*=T,q=T*T*(Y[m]*H+Y[m+1]*R)}return 70*(u+b+q)}noise3D(m,S,h){const l=this.permMod12,M=this.perm;let b,q,V,I;const Z=(m+S+h)*O,C=Math.floor(m+Z),B=Math.floor(S+Z),D=Math.floor(h+Z),E=(C+B+D)*u,n=m-(C-E),L=S-(B-E),U=h-(D-E);let H,R,y,o,s,v;n>=L?L>=U?(H=1,R=0,y=0,o=1,s=1,v=0):n>=U?(H=1,R=0,y=0,o=1,s=0,v=1):(H=0,R=0,y=1,o=1,s=0,v=1):L<U?(H=0,R=0,y=1,o=0,s=1,v=1):n<U?(H=0,R=1,y=0,o=0,s=1,v=1):(H=0,R=1,y=0,o=1,s=1,v=0);const T=n-H+u,X=L-R+u,g=U-y+u,G=n-o+2*u,e=L-s+2*u,a=U-v+2*u,x=n-1+.5,P=L-1+.5,d=U-1+.5,J=255&C,N=255&B,j=255&D;let K=.6-n*n-L*L-U*U;if(K<0)b=0;else{const m=3*l[J+M[N+M[j]]];K*=K,b=K*K*(Y[m]*n+Y[m+1]*L+Y[m+2]*U)}let c=.6-T*T-X*X-g*g;if(c<0)q=0;else{const m=3*l[J+H+M[N+R+M[j+y]]];c*=c,q=c*c*(Y[m]*T+Y[m+1]*X+Y[m+2]*g)}let f=.6-G*G-e*e-a*a;if(f<0)V=0;else{const m=3*l[J+o+M[N+s+M[j+v]]];f*=f,V=f*f*(Y[m]*G+Y[m+1]*e+Y[m+2]*a)}let p=.6-x*x-P*P-d*d;if(p<0)I=0;else{const m=3*l[J+1+M[N+1+M[j+1]]];p*=p,I=p*p*(Y[m]*x+Y[m+1]*P+Y[m+2]*d)}return 32*(b+q+V+I)}noise4D(m,S,h,l){const M=this.perm;let O,u,Y,I,Z;const C=(m+S+h+l)*b,B=Math.floor(m+C),D=Math.floor(S+C),E=Math.floor(h+C),n=Math.floor(l+C),L=(B+D+E+n)*q,U=m-(B-L),H=S-(D-L),R=h-(E-L),y=l-(n-L);let o=0,s=0,v=0,T=0;U>H?o++:s++,U>R?o++:v++,U>y?o++:T++,H>R?s++:v++,H>y?s++:T++,R>y?v++:T++;const X=o>=3?1:0,g=s>=3?1:0,G=v>=3?1:0,e=T>=3?1:0,a=o>=2?1:0,x=s>=2?1:0,P=v>=2?1:0,d=T>=2?1:0,J=o>=1?1:0,N=s>=1?1:0,j=v>=1?1:0,K=T>=1?1:0,c=U-X+q,f=H-g+q,p=R-G+q,k=y-e+q,r=U-a+2*q,z=H-x+2*q,Q=R-P+2*q,F=y-d+2*q,w=U-J+3*q,t=H-N+3*q,A=R-j+3*q,i=y-K+3*q,W=U-1+4*q,mm=H-1+4*q,Sm=R-1+4*q,hm=y-1+4*q,lm=255&B,Mm=255&D,Om=255&E,um=255&n;let bm=.6-U*U-H*H-R*R-y*y;if(bm<0)O=0;else{const m=M[lm+M[Mm+M[Om+M[um]]]]%32*4;bm*=bm,O=bm*bm*(V[m]*U+V[m+1]*H+V[m+2]*R+V[m+3]*y)}let qm=.6-c*c-f*f-p*p-k*k;if(qm<0)u=0;else{const m=M[lm+X+M[Mm+g+M[Om+G+M[um+e]]]]%32*4;qm*=qm,u=qm*qm*(V[m]*c+V[m+1]*f+V[m+2]*p+V[m+3]*k)}let Ym=.6-r*r-z*z-Q*Q-F*F;if(Ym<0)Y=0;else{const m=M[lm+a+M[Mm+x+M[Om+P+M[um+d]]]]%32*4;Ym*=Ym,Y=Ym*Ym*(V[m]*r+V[m+1]*z+V[m+2]*Q+V[m+3]*F)}let Vm=.6-w*w-t*t-A*A-i*i;if(Vm<0)I=0;else{const m=M[lm+J+M[Mm+N+M[Om+j+M[um+K]]]]%32*4;Vm*=Vm,I=Vm*Vm*(V[m]*w+V[m+1]*t+V[m+2]*A+V[m+3]*i)}let Im=.6-W*W-mm*mm-Sm*Sm-hm*hm;if(Im<0)Z=0;else{const m=M[lm+1+M[Mm+1+M[Om+1+M[um+1]]]]%32*4;Im*=Im,Z=Im*Im*(V[m]*W+V[m+1]*mm+V[m+2]*Sm+V[m+3]*hm)}return 27*(O+u+Y+I+Z)}}}}]);