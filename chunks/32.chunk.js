/*! For license information please see mllir8.32.624aa5fd.chunk.js.LICENSE.txt */
(self.yg1iw12lizp=self.yg1iw12lizp||[]).push([[32],{14631:(L,U,x)=>{"use strict";var mL=x(14634),p=x(14640),G=x(14648);x.g.__TYPEDARRAY_POOL||(x.g.__TYPEDARRAY_POOL={UINT8:p([32,0]),UINT16:p([32,0]),UINT32:p([32,0]),INT8:p([32,0]),INT16:p([32,0]),INT32:p([32,0]),FLOAT:p([32,0]),DOUBLE:p([32,0]),DATA:p([32,0]),UINT8C:p([32,0]),BUFFER:p([32,0])});var F="undefined"!==typeof Uint8ClampedArray,a=x.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=p([32,0])),a.BUFFER||(a.BUFFER=p([32,0]));var o=a.DATA,A=a.BUFFER;function r(L){if(L){var U=L.length||L.byteLength,x=mL.log2(U);o[x].push(L)}}function h(L){L=mL.nextPow2(L);var U=mL.log2(L),x=o[U];return x.length>0?x.pop():new ArrayBuffer(L)}function b(L){return new Uint8Array(h(L),0,L)}function E(L){return new Uint16Array(h(2*L),0,L)}function Y(L){return new Uint32Array(h(4*L),0,L)}function S(L){return new Int8Array(h(L),0,L)}function V(L){return new Int16Array(h(2*L),0,L)}function H(L){return new Int32Array(h(4*L),0,L)}function Q(L){return new Float32Array(h(4*L),0,L)}function q(L){return new Float64Array(h(8*L),0,L)}function f(L){return F?new Uint8ClampedArray(h(L),0,L):b(L)}function v(L){return new DataView(h(L),0,L)}U.free=function(L){if(G(L))A[mL.log2(L.length)].push(L);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(L)&&(L=L.buffer),!L)return;var U=L.length||L.byteLength,x=0|mL.log2(U);o[x].push(L)}},U.freeUint8=U.freeUint16=U.freeUint32=U.freeInt8=U.freeInt16=U.freeInt32=U.freeFloat32=U.freeFloat=U.freeFloat64=U.freeDouble=U.freeUint8Clamped=U.freeDataView=function(L){r(L.buffer)},U.freeArrayBuffer=r,U.freeBuffer=function(L){A[mL.log2(L.length)].push(L)},U.malloc=function(L,U){if(void 0===U||"arraybuffer"===U)return h(L);switch(U){case"uint8":return b(L);case"uint16":return E(L);case"uint32":return Y(L);case"int8":return S(L);case"int16":return V(L);case"int32":return H(L);case"float":case"float32":return Q(L);case"double":case"float64":return q(L);case"uint8_clamped":return f(L);case"buffer":throw"Buffer not supported";case"data":case"dataview":return v(L);default:return null}return null},U.mallocArrayBuffer=h,U.mallocUint8=b,U.mallocUint16=E,U.mallocUint32=Y,U.mallocInt8=S,U.mallocInt16=V,U.mallocInt32=H,U.mallocFloat32=U.mallocFloat=Q,U.mallocFloat64=U.mallocDouble=q,U.mallocUint8Clamped=f,U.mallocDataView=v,U.clearCache=function(){for(var L=0;L<32;++L)a.UINT8[L].length=0,a.UINT16[L].length=0,a.UINT32[L].length=0,a.INT8[L].length=0,a.INT16[L].length=0,a.INT32[L].length=0,a.FLOAT[L].length=0,a.DOUBLE[L].length=0,a.UINT8C[L].length=0,o[L].length=0,A[L].length=0}},14729:(L,U,x)=>{L.exports=p;var mL=x(13428);function p(L,U){if(!(this instanceof p))return new p(L,U);var x=mL.create();mL.add(x,L,U),this.base=mL.min(mL.create(),L,x),this.ar=mL.clone(U),this.max=mL.max(mL.create(),L,x),this.mag=mL.length(this.ar)}var G=p.prototype;G.width=function(){return this.ar[0]},G.height=function(){return this.ar[1]},G.depth=function(){return this.ar[2]},G.x0=function(){return this.base[0]},G.y0=function(){return this.base[1]},G.z0=function(){return this.base[2]},G.x1=function(){return this.max[0]},G.y1=function(){return this.max[1]},G.z1=function(){return this.max[2]},G.translate=function(L){return mL.add(this.max,this.max,L),mL.add(this.base,this.base,L),this},G.setPosition=function(L){return mL.add(this.max,L,this.ar),mL.k(this.base,L),this},G.expand=function(L){var U=mL.create(),x=mL.create();return mL.max(U,L.max,this.max),mL.min(x,L.base,this.base),mL.SU(U,U,x),new p(x,U)},G.intersects=function(L){return!(L.base[0]>this.max[0])&&(!(L.base[1]>this.max[1])&&(!(L.base[2]>this.max[2])&&(!(L.max[0]<this.base[0])&&(!(L.max[1]<this.base[1])&&!(L.max[2]<this.base[2])))))},G.touches=function(L){var U=this.union(L);return null!==U&&(0==U.width()||0==U.height()||0==U.depth())},G.union=function(L){if(!this.intersects(L))return null;var U=Math.max(L.base[0],this.base[0]),x=Math.max(L.base[1],this.base[1]),mL=Math.max(L.base[2],this.base[2]);return new p([U,x,mL],[Math.min(L.max[0],this.max[0])-U,Math.min(L.max[1],this.max[1])-x,Math.min(L.max[2],this.max[2])-mL])}},14634:(L,U)=>{"use strict";function x(L){var U=32;return(L&=-L)&&U--,65535&L&&(U-=16),16711935&L&&(U-=8),252645135&L&&(U-=4),858993459&L&&(U-=2),1431655765&L&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(L){return(L>0)-(L<0)},U.abs=function(L){var U=L>>31;return(L^U)-U},U.min=function(L,U){return U^(L^U)&-(L<U)},U.max=function(L,U){return L^(L^U)&-(L<U)},U.isPow2=function(L){return!(L&L-1)&&!!L},U.log2=function(L){var U,x;return U=(L>65535)<<4,U|=x=((L>>>=U)>255)<<3,U|=x=((L>>>=x)>15)<<2,(U|=x=((L>>>=x)>3)<<1)|(L>>>=x)>>1},U.log10=function(L){return L>=1e9?9:L>=1e8?8:L>=1e7?7:L>=1e6?6:L>=1e5?5:L>=1e4?4:L>=1e3?3:L>=100?2:L>=10?1:0},U.popCount=function(L){return 16843009*((L=(858993459&(L-=L>>>1&1431655765))+(L>>>2&858993459))+(L>>>4)&252645135)>>>24},U.countTrailingZeros=x,U.nextPow2=function(L){return L+=0===L,--L,L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)+1},U.prevPow2=function(L){return L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)-(L>>>1)},U.parity=function(L){return L^=L>>>16,L^=L>>>8,L^=L>>>4,27030>>>(L&=15)&1};var mL=new Array(256);!function(L){for(var U=0;U<256;++U){var x=U,mL=U,p=7;for(x>>>=1;x;x>>>=1)mL<<=1,mL|=1&x,--p;L[U]=mL<<p&255}}(mL),U.reverse=function(L){return mL[255&L]<<24|mL[L>>>8&255]<<16|mL[L>>>16&255]<<8|mL[L>>>24&255]},U.interleave2=function(L,U){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L&=65535)|L<<8))|L<<4))|L<<2))|L<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(L,U){return(L=65535&((L=16711935&((L=252645135&((L=858993459&((L=L>>>U&1431655765)|L>>>1))|L>>>2))|L>>>4))|L>>>16))<<16>>16},U.interleave3=function(L,U,x){return L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2),(L|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<2},U.deinterleave3=function(L,U){return(L=1023&((L=4278190335&((L=251719695&((L=3272356035&((L=L>>>U&1227133513)|L>>>2))|L>>>4))|L>>>8))|L>>>16))<<22>>22},U.nextCombination=function(L){var U=L|L-1;return U+1|(~U&-~U)-1>>>x(L)+1}},14626:(L,U,x)=>{"use strict";L.exports=function(L,U,x){switch(arguments.length){case 1:return mL=[],A(p=L,p,r,!0),mL;case 2:return"function"===typeof U?A(L,L,U,!0):function(L,U){return mL=[],A(L,U,r,!1),mL}(L,U);case 3:return A(L,U,x,!1);default:throw new Error("box-intersect: Invalid arguments")}var p};var mL,p=x(14631),G=x(14656),F=x(14668);function a(L,U){for(var x=0;x<L;++x)if(!(U[x]<=U[x+L]))return!0;return!1}function o(L,U,x,mL){for(var p=0,G=0,F=0,o=L.length;F<o;++F){var A=L[F];if(!a(U,A)){for(var r=0;r<2*U;++r)x[p++]=A[r];mL[G++]=F}}return G}function A(L,U,x,mL){var a=L.length,A=U.length;if(!(a<=0||A<=0)){var r=L[0].length>>>1;if(!(r<=0)){var h,b=p.mallocDouble(2*r*a),E=p.mallocInt32(a);if((a=o(L,r,b,E))>0){if(1===r&&mL)G.init(a),h=G.sweepComplete(r,x,0,a,b,E,0,a,b,E);else{var Y=p.mallocDouble(2*r*A),S=p.mallocInt32(A);(A=o(U,r,Y,S))>0&&(G.init(a+A),h=1===r?G.sweepBipartite(r,x,0,a,b,E,0,A,Y,S):F(r,x,mL,a,b,E,A,Y,S),p.free(Y),p.free(S))}p.free(b),p.free(E)}return h}}}function r(L,U){mL.push([L,U])}},14675:(L,U)=>{"use strict";var x="d",mL="ax",p="fp",G="es",F="rs",a="re",o="rb",A="bs",r="be",h="bb",b=[x,mL,"vv",F,a,o,"ri",A,r,h,"bi"];function E(L){var U="bruteForce"+(L?"Full":"Partial"),mL=[],F=b.slice();L||F.splice(3,0,p);var a=["function "+U+"("+F.join()+"){"];function o(U,p){var F=function(L,U,mL){var p="bruteForce"+(L?"Red":"Blue")+(U?"Flip":"")+(mL?"Full":""),F=["function ",p,"(",b.join(),"){","var ",G,"=2*",x,";"],a="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",o="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(mL?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return L?F.push(a,"Q",":",o):F.push(o,"Q",":",a),mL?F.push("if(y1<x0||x1<y0)continue;"):U?F.push("if(y0<=x0||x1<y0)continue;"):F.push("if(y0<x0||x1<y0)continue;"),F.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),U?F.push("yi,xi"):F.push("xi,yi"),F.push(");if(rv!==void 0)return rv;}}}"),{name:p,code:F.join("")}}(U,p,L);mL.push(F.code),a.push("return "+F.name+"("+b.join()+");")}a.push("if(re-rs>be-bs){"),L?(o(!0,!1),a.push("}else{"),o(!1,!1)):(a.push("if(fp){"),o(!0,!0),a.push("}else{"),o(!0,!1),a.push("}}else{if(fp){"),o(!1,!0),a.push("}else{"),o(!1,!1),a.push("}")),a.push("}}return "+U);var A=mL.join("")+a.join("");return new Function(A)()}U.partial=E(!1),U.full=E(!0)},14668:(L,U,x)=>{"use strict";L.exports=function(L,U,x,G,r,i,X,t,y){!function(L,U){var x=8*p.log2(U+1)*(L+1)|0,G=p.nextPow2(f*x);D.length<G&&(mL.free(D),D=mL.mallocInt32(G));var F=p.nextPow2(v*x);P.length<F&&(mL.free(P),P=mL.mallocDouble(F))}(L,G+X);var n,N=0,e=2*L;d(N++,0,0,G,0,X,x?16:0,-1/0,1/0),x||d(N++,0,0,X,0,G,1,-1/0,1/0);for(;N>0;){var u=(N-=1)*f,Z=D[u],g=D[u+1],z=D[u+2],M=D[u+3],J=D[u+4],j=D[u+5],R=N*v,c=P[R],W=P[R+1],I=1&j,w=!!(16&j),B=r,s=i,C=t,k=y;if(I&&(B=t,s=y,C=r,k=i),!(2&j&&g>=(z=V(L,Z,g,z,B,s,W)))&&!(4&j&&(g=H(L,Z,g,z,B,s,c))>=z)){var T=z-g,O=J-M;if(w){if(L*T*(T+O)<E){if(void 0!==(n=o.scanComplete(L,Z,U,g,z,B,s,M,J,C,k)))return n;continue}}else{if(L*Math.min(T,O)<h){if(void 0!==(n=F(L,Z,U,I,g,z,B,s,M,J,C,k)))return n;continue}if(L*T*O<b){if(void 0!==(n=o.scanBipartite(L,Z,U,I,g,z,B,s,M,J,C,k)))return n;continue}}var LL=Y(L,Z,g,z,B,s,c,W);if(g<LL)if(L*(LL-g)<h){if(void 0!==(n=a(L,Z+1,U,g,LL,B,s,M,J,C,k)))return n}else if(Z===L-2){if(void 0!==(n=I?o.sweepBipartite(L,U,M,J,C,k,g,LL,B,s):o.sweepBipartite(L,U,g,LL,B,s,M,J,C,k)))return n}else d(N++,Z+1,g,LL,M,J,I,-1/0,1/0),d(N++,Z+1,M,J,g,LL,1^I,-1/0,1/0);if(LL<z){var UL=A(L,Z,M,J,C,k),xL=C[e*UL+Z],mU=S(L,Z,UL,J,C,k,xL);if(mU<J&&d(N++,Z,LL,z,mU,J,(4|I)+(w?16:0),xL,W),M<UL&&d(N++,Z,LL,z,M,UL,(2|I)+(w?16:0),c,xL),UL+1===mU){if(void 0!==(n=w?l(L,Z,U,LL,z,B,s,UL,C,k[UL]):K(L,Z,U,I,LL,z,B,s,UL,C,k[UL])))return n}else if(UL<mU){var pL;if(w){if(LL<(pL=Q(L,Z,LL,z,B,s,xL))){var GL=S(L,Z,LL,pL,B,s,xL);if(Z===L-2){if(LL<GL&&void 0!==(n=o.sweepComplete(L,U,LL,GL,B,s,UL,mU,C,k)))return n;if(GL<pL&&void 0!==(n=o.sweepBipartite(L,U,GL,pL,B,s,UL,mU,C,k)))return n}else LL<GL&&d(N++,Z+1,LL,GL,UL,mU,16,-1/0,1/0),GL<pL&&(d(N++,Z+1,GL,pL,UL,mU,0,-1/0,1/0),d(N++,Z+1,UL,mU,GL,pL,1,-1/0,1/0))}}else LL<(pL=I?q(L,Z,LL,z,B,s,xL):Q(L,Z,LL,z,B,s,xL))&&(Z===L-2?n=I?o.sweepBipartite(L,U,UL,mU,C,k,LL,pL,B,s):o.sweepBipartite(L,U,LL,pL,B,s,UL,mU,C,k):(d(N++,Z+1,LL,pL,UL,mU,I,-1/0,1/0),d(N++,Z+1,UL,mU,LL,pL,1^I,-1/0,1/0)))}}}}};var mL=x(14631),p=x(14634),G=x(14675),F=G.partial,a=G.full,o=x(14656),A=x(14681),r=x(14690),h=128,b=1<<22,E=1<<22,Y=r("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),S=r("lo===p0",["p0"]),V=r("lo<p0",["p0"]),H=r("hi<=p0",["p0"]),Q=r("lo<=p0&&p0<=hi",["p0"]),q=r("lo<p0&&p0<=hi",["p0"]),f=6,v=2,D=mL.mallocInt32(1024),P=mL.mallocDouble(1024);function d(L,U,x,mL,p,G,F,a,o){var A=f*L;D[A]=U,D[A+1]=x,D[A+2]=mL,D[A+3]=p,D[A+4]=G,D[A+5]=F;var r=v*L;P[r]=a,P[r+1]=o}function K(L,U,x,mL,p,G,F,a,o,A,r){var h=2*L,b=o*h,E=A[b+U];L:for(var Y=p,S=p*h;Y<G;++Y,S+=h){var V=F[S+U],H=F[S+U+L];if(!(E<V||H<E)&&(!mL||E!==V)){for(var Q,q=a[Y],f=U+1;f<L;++f){V=F[S+f],H=F[S+f+L];var v=A[b+f],D=A[b+f+L];if(H<v||D<V)continue L}if(void 0!==(Q=mL?x(r,q):x(q,r)))return Q}}}function l(L,U,x,mL,p,G,F,a,o,A){var r=2*L,h=a*r,b=o[h+U];L:for(var E=mL,Y=mL*r;E<p;++E,Y+=r){var S=F[E];if(S!==A){var V=G[Y+U],H=G[Y+U+L];if(!(b<V||H<b)){for(var Q=U+1;Q<L;++Q){V=G[Y+Q],H=G[Y+Q+L];var q=o[h+Q],f=o[h+Q+L];if(H<q||f<V)continue L}var v=x(S,A);if(void 0!==v)return v}}}}},14681:(L,U,x)=>{"use strict";L.exports=function(L,U,x,F,a,o){if(F<=x+1)return x;var A=x,r=F,h=F+x>>>1,b=2*L,E=h,Y=a[b*h+U];for(;A<r;){if(r-A<p){G(L,U,A,r,a,o),Y=a[b*h+U];break}var S=r-A,V=Math.random()*S+A|0,H=a[b*V+U],Q=Math.random()*S+A|0,q=a[b*Q+U],f=Math.random()*S+A|0,v=a[b*f+U];H<=q?v>=q?(E=Q,Y=q):H>=v?(E=V,Y=H):(E=f,Y=v):q>=v?(E=Q,Y=q):v>=H?(E=V,Y=H):(E=f,Y=v);for(var D=b*(r-1),P=b*E,d=0;d<b;++d,++D,++P){var K=a[D];a[D]=a[P],a[P]=K}var l=o[r-1];o[r-1]=o[E],o[E]=l;for(D=b*(r-1),P=b*(E=mL(L,U,A,r-1,a,o,Y)),d=0;d<b;++d,++D,++P){K=a[D];a[D]=a[P],a[P]=K}l=o[r-1];if(o[r-1]=o[E],o[E]=l,h<E){for(r=E-1;A<r&&a[b*(r-1)+U]===Y;)r-=1;r+=1}else{if(!(E<h))break;for(A=E+1;A<r&&a[b*A+U]===Y;)A+=1}}return mL(L,U,x,h,a,o,a[b*h+U])};var mL=x(14690)("lo<p0",["p0"]),p=8;function G(L,U,x,mL,p,G){for(var F=2*L,a=F*(x+1)+U,o=x+1;o<mL;++o,a+=F)for(var A=p[a],r=o,h=F*(o-1);r>x&&p[h+U]>A;--r,h-=F){for(var b=h,E=h+F,Y=0;Y<F;++Y,++b,++E){var S=p[b];p[b]=p[E],p[E]=S}var V=G[r];G[r]=G[r-1],G[r-1]=V}}},14690:L=>{"use strict";L.exports=function(L,x){var mL="abcdef".split("").concat(x),p=[];L.indexOf("lo")>=0&&p.push("lo=e[k+n]");L.indexOf("hi")>=0&&p.push("hi=e[k+o]");return mL.push(U.replace("_",p.join()).replace("$",L)),Function.apply(void 0,mL)};var U="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14663:L=>{"use strict";L.exports=function(L,mL){mL<=4*U?x(0,mL-1,L):A(0,mL-1,L)};var U=32;function x(L,U,x){for(var mL=2*(L+1),p=L+1;p<=U;++p){for(var G=x[mL++],F=x[mL++],a=p,o=mL-2;a-- >L;){var A=x[o-2],r=x[o-1];if(A<G)break;if(A===G&&r<F)break;x[o]=A,x[o+1]=r,o-=2}x[o]=G,x[o+1]=F}}function mL(L,U,x){U*=2;var mL=x[L*=2],p=x[L+1];x[L]=x[U],x[L+1]=x[U+1],x[U]=mL,x[U+1]=p}function p(L,U,x){U*=2,x[L*=2]=x[U],x[L+1]=x[U+1]}function G(L,U,x,mL){U*=2,x*=2;var p=mL[L*=2],G=mL[L+1];mL[L]=mL[U],mL[L+1]=mL[U+1],mL[U]=mL[x],mL[U+1]=mL[x+1],mL[x]=p,mL[x+1]=G}function F(L,U,x,mL,p){U*=2,p[L*=2]=p[U],p[U]=x,p[L+1]=p[U+1],p[U+1]=mL}function a(L,U,x){U*=2;var mL=x[L*=2],p=x[U];return!(mL<p)&&(mL!==p||x[L+1]>x[U+1])}function o(L,U,x,mL){var p=mL[L*=2];return p<U||p===U&&mL[L+1]<x}function A(L,r,h){var b=(r-L+1)/6|0,E=L+b,Y=r-b,S=L+r>>1,V=S-b,H=S+b,Q=E,q=V,f=S,v=H,D=Y,P=L+1,d=r-1,K=0;a(Q,q,h)&&(K=Q,Q=q,q=K),a(v,D,h)&&(K=v,v=D,D=K),a(Q,f,h)&&(K=Q,Q=f,f=K),a(q,f,h)&&(K=q,q=f,f=K),a(Q,v,h)&&(K=Q,Q=v,v=K),a(f,v,h)&&(K=f,f=v,v=K),a(q,D,h)&&(K=q,q=D,D=K),a(q,f,h)&&(K=q,q=f,f=K),a(v,D,h)&&(K=v,v=D,D=K);for(var l=h[2*q],i=h[2*q+1],X=h[2*v],t=h[2*v+1],y=2*Q,n=2*f,N=2*D,e=2*E,u=2*S,Z=2*Y,g=0;g<2;++g){var z=h[y+g],M=h[n+g],J=h[N+g];h[e+g]=z,h[u+g]=M,h[Z+g]=J}p(V,L,h),p(H,r,h);for(var j=P;j<=d;++j)if(o(j,l,i,h))j!==P&&mL(j,P,h),++P;else if(!o(j,X,t,h))for(;;){if(o(d,X,t,h)){o(d,l,i,h)?(G(j,P,d,h),++P,--d):(mL(j,d,h),--d);break}if(--d<j)break}F(L,P-1,l,i,h),F(r,d+1,X,t,h),P-2-L<=U?x(L,P-2,h):A(L,P-2,h),r-(d+2)<=U?x(d+2,r,h):A(d+2,r,h),d-P<=U?x(P,d,h):A(P,d,h)}},14656:(L,U,x)=>{"use strict";L.exports={init:function(L){var U=p.nextPow2(L);o.length<U&&(mL.free(o),o=mL.mallocInt32(U));A.length<U&&(mL.free(A),A=mL.mallocInt32(U));r.length<U&&(mL.free(r),r=mL.mallocInt32(U));h.length<U&&(mL.free(h),h=mL.mallocInt32(U));b.length<U&&(mL.free(b),b=mL.mallocInt32(U));E.length<U&&(mL.free(E),E=mL.mallocInt32(U));var x=8*U;Y.length<x&&(mL.free(Y),Y=mL.mallocDouble(x))},sweepBipartite:function(L,U,x,mL,p,a,b,E,H,Q){for(var q=0,f=2*L,v=L-1,D=f-1,P=x;P<mL;++P){var d=a[P],K=f*P;Y[q++]=p[K+v],Y[q++]=-(d+1),Y[q++]=p[K+D],Y[q++]=d}for(P=b;P<E;++P){d=Q[P]+F;var l=f*P;Y[q++]=H[l+v],Y[q++]=-d,Y[q++]=H[l+D],Y[q++]=d}var i=q>>>1;G(Y,i);var X=0,t=0;for(P=0;P<i;++P){var y=0|Y[2*P+1];if(y>=F)S(r,h,t--,y=y-F|0);else if(y>=0)S(o,A,X--,y);else if(y<=-F){y=-y-F|0;for(var n=0;n<X;++n){if(void 0!==(N=U(o[n],y)))return N}V(r,h,t++,y)}else{y=-y-1|0;for(n=0;n<t;++n){var N;if(void 0!==(N=U(y,r[n])))return N}V(o,A,X++,y)}}},sweepComplete:function(L,U,x,mL,p,F,a,H,Q,q){for(var f=0,v=2*L,D=L-1,P=v-1,d=x;d<mL;++d){var K=F[d]+1<<1,l=v*d;Y[f++]=p[l+D],Y[f++]=-K,Y[f++]=p[l+P],Y[f++]=K}for(d=a;d<H;++d){K=q[d]+1<<1;var i=v*d;Y[f++]=Q[i+D],Y[f++]=1|-K,Y[f++]=Q[i+P],Y[f++]=1|K}var X=f>>>1;G(Y,X);var t=0,y=0,n=0;for(d=0;d<X;++d){var N=0|Y[2*d+1],e=1&N;if(d<X-1&&N>>1===Y[2*d+3]>>1&&(e=2,d+=1),N<0){for(var u=-(N>>1)-1,Z=0;Z<n;++Z){if(void 0!==(g=U(b[Z],u)))return g}if(0!==e)for(Z=0;Z<t;++Z){if(void 0!==(g=U(o[Z],u)))return g}if(1!==e)for(Z=0;Z<y;++Z){var g;if(void 0!==(g=U(r[Z],u)))return g}0===e?V(o,A,t++,u):1===e?V(r,h,y++,u):2===e&&V(b,E,n++,u)}else{u=(N>>1)-1;0===e?S(o,A,t--,u):1===e?S(r,h,y--,u):2===e&&S(b,E,n--,u)}}},scanBipartite:function(L,U,x,mL,p,a,r,h,b,E,H,Q){var q=0,f=2*L,v=U,D=U+L,P=1,d=1;mL?d=F:P=F;for(var K=p;K<a;++K){var l=K+P,i=f*K;Y[q++]=r[i+v],Y[q++]=-l,Y[q++]=r[i+D],Y[q++]=l}for(K=b;K<E;++K){l=K+d;var X=f*K;Y[q++]=H[X+v],Y[q++]=-l}var t=q>>>1;G(Y,t);var y=0;for(K=0;K<t;++K){var n=0|Y[2*K+1];if(n<0){var N=!1;if((l=-n)>=F?(N=!mL,l-=F):(N=!!mL,l-=1),N)V(o,A,y++,l);else{var e=Q[l],u=f*l,Z=H[u+U+1],g=H[u+U+1+L];L:for(var z=0;z<y;++z){var M=o[z],J=f*M;if(!(g<r[J+U+1]||r[J+U+1+L]<Z)){for(var j=U+2;j<L;++j)if(H[u+j+L]<r[J+j]||r[J+j+L]<H[u+j])continue L;var R,c=h[M];if(void 0!==(R=mL?x(e,c):x(c,e)))return R}}}}else S(o,A,y--,n-P)}},scanComplete:function(L,U,x,mL,p,a,A,r,h,b,E){for(var S=0,V=2*L,H=U,Q=U+L,q=mL;q<p;++q){var f=q+F,v=V*q;Y[S++]=a[v+H],Y[S++]=-f,Y[S++]=a[v+Q],Y[S++]=f}for(q=r;q<h;++q){f=q+1;var D=V*q;Y[S++]=b[D+H],Y[S++]=-f}var P=S>>>1;G(Y,P);var d=0;for(q=0;q<P;++q){var K=0|Y[2*q+1];if(K<0){if((f=-K)>=F)o[d++]=f-F;else{var l=E[f-=1],i=V*f,X=b[i+U+1],t=b[i+U+1+L];L:for(var y=0;y<d;++y){var n=o[y],N=A[n];if(N===l)break;var e=V*n;if(!(t<a[e+U+1]||a[e+U+1+L]<X)){for(var u=U+2;u<L;++u)if(b[i+u+L]<a[e+u]||a[e+u+L]<b[i+u])continue L;var Z=x(N,l);if(void 0!==Z)return Z}}}}else{for(f=K-F,y=d-1;y>=0;--y)if(o[y]===f){for(u=y+1;u<d;++u)o[u-1]=o[u];break}--d}}}};var mL=x(14631),p=x(14634),G=x(14663),F=1<<28,a=1024,o=mL.mallocInt32(a),A=mL.mallocInt32(a),r=mL.mallocInt32(a),h=mL.mallocInt32(a),b=mL.mallocInt32(a),E=mL.mallocInt32(a),Y=mL.mallocDouble(8192);function S(L,U,x,mL){var p=U[mL],G=L[x-1];L[p]=G,U[G]=p}function V(L,U,x,mL){L[x]=mL,U[mL]=x}},14640:L=>{"use strict";function U(L,x,mL){var p=0|L[mL];if(p<=0)return[];var G,F=new Array(p);if(mL===L.length-1)for(G=0;G<p;++G)F[G]=x;else for(G=0;G<p;++G)F[G]=U(L,x,mL+1);return F}L.exports=function(L,x){switch("undefined"===typeof x&&(x=0),typeof L){case"number":if(L>0)return function(L,U){var x,mL;for(x=new Array(L),mL=0;mL<L;++mL)x[mL]=U;return x}(0|L,x);break;case"object":if("number"===typeof L.length)return U(L,x,0)}return[]}},14593:(L,U,x)=>{L.exports=function(){var L=this;this.components={},this.comps=this.components;var U=this.components,x=1,p={},G=[],F=[],a={timeout:!1,removals:[],multiComps:[]};function o(L,x){var mL=U[x],G=p[x],F=G.hash[L];F&&(G.remove(L),mL.nx&&(mL.multi?(F.forEach((U=>{U&&mL.nx(L,U)})),F.length=0):mL.nx(L,F)),a.removals.push(G),A())}function A(){a.timeout||(a.timeout=!0,setTimeout(r,1))}function r(){a.timeout=!1,h()}function h(){a.multiComps.length&&function(L){for(var U=0;U<L.length;U++){var{entID:x,data:mL}=L[U],p=mL.hash[x];if(p){for(var G=0;G<p.length;G++)p[G]||(p.splice(G,1),G--);0===p.length&&(mL.remove(x),a.removals.push(mL))}}L.length=0}(a.multiComps),a.removals.length&&function(L){for(var U=0;U<L.length;U++){L[U].flush()}L.length=0}(a.removals)}this.Mh=p,this._systems=G,this._renderSystems=F,this.hr=function(U){var mL=x++;return Array.isArray(U)&&U.forEach((U=>L.Io(mL,U))),mL},this.deleteEntity=function(U){return Object.keys(p).forEach((L=>{p[L].hash[U]&&o(U,L)})),L},this.ir=function(L){if(!L)throw new Error("Missing component definition");var x=L.name;if(!x)throw new Error("Component definition must have a name property.");if("string"!==typeof x)throw new Error("Component name must be a string.");if(""===x)throw new Error("Component name must be a non-empty string.");if(p[x])throw new Error(`Component ${x} already exists.`);var a={};return a.name=x,a.multi=!!L.multi,a.order=isNaN(L.order)?99:L.order,a.stateConstructor=L.stateConstructor||null,a.state=L.state||{},a.Ja=L.Ja||null,a.nx=L.nx||null,a.system=L.system||null,a.wa=L.wa||null,U[x]=a,p[x]=new mL,p[x]._pendingMultiCleanup=!1,p[x]._multiCleanupIDs=a.multi?[]:null,a.system&&(G.push(x),G.sort(((L,x)=>U[L].order-U[x].order))),a.wa&&(F.push(x),F.sort(((L,x)=>U[L].order-U[x].order))),x},this.overwriteComponent=function(L,x){var mL=U[L];if(!mL)throw new Error(`Unknown component: ${L}`);if(!x)throw new Error("Missing component definition");if(mL.name!==x.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=L,a.multi=!!x.multi,a.order=isNaN(x.order)?99:x.order,a.state=x.state||{},a.Ja=x.Ja||null,a.nx=x.nx||null,a.system=x.system||null,a.wa=x.wa||null,U[L]=a,p[L]._pendingMultiCleanup=!1,p[L]._multiCleanupIDs=a.multi?[]:null;var o=G.indexOf(L);a.system&&o<0&&G.push(L),!a.system&&o>=0&&G.splice(o,1),G.sort(((L,x)=>U[L].order-U[x].order));var A=F.indexOf(L);a.wa&&A<0&&F.push(L),!a.wa&&A>=0&&F.splice(A,1),F.sort(((L,x)=>U[L].order-U[x].order));var r=a.state;return this.cA(L).forEach((L=>{for(var U in r)U in L||(L[U]=r[U]);a.Ja&&a.Ja(L.Wa,L)})),L},this.deleteComponent=function(x){var mL=p[x];if(!mL)throw new Error(`Unknown component: ${x}`);mL.flush(),mL.list.forEach((L=>{L&&o(L.Wa||L[0].Wa,x)}));var a=G.indexOf(x),A=F.indexOf(x);return a>-1&&G.splice(a,1),A>-1&&F.splice(A,1),p[x].dispose(),delete p[x],delete U[x],L},this.Io=function(L,x,mL){var G,F=U[x],a=p[x];if(!a)throw new Error(`Unknown component: ${x}.`);if(a.hash[L]&&!F.multi)throw new Error(`Entity ${L} already has component: ${x}.`);if(F.stateConstructor){if(!(G=new F.stateConstructor).hasOwnProperty("Wa"))throw new Error(`Component ${F.name} stateConstructor type does not have property __id`)}else G=Object.assign({},{Wa:L},F.state,mL);if(G.Wa=L,F.multi){var o=a.hash[L];o||(o=[],a.add(L,o)),o.push(G)}else a.add(L,G);return F.Ja&&F.Ja(L,G),this},this.xA=function(L,U){var x=p[U];if(!x)throw new Error(`Unknown component: ${U}.`);return!!x.hash[L]},this.Co=function(U,x){if(!p[x])throw new Error(`Unknown component: ${x}.`);return o(U,x),L},this.getState=function(L,U){var x=p[U];if(!x)throw new Error(`Unknown component: ${U}.`);return x.hash[L]},this.cA=function(L){var U=p[L];if(!U)throw new Error(`Unknown component: ${L}.`);return h(),U.list},this.KY=function(L){if(!p[L])throw new Error(`Unknown component: ${L}.`);var U=p[L].hash;return L=>U[L]},this.XY=function(L){if(!p[L])throw new Error(`Unknown component: ${L}.`);var U=p[L].hash;return L=>!!U[L]},this.pa=function(x){h();for(var mL=0;mL<G.length;mL++){var F=G[mL],a=U[F],o=p[F];a.system(x,o.list),h()}return L},this.render=function(x){h();for(var mL=0;mL<F.length;mL++){var G=F[mL],a=U[G],o=p[G];a.wa(x,o.list),h()}return L},this.removeMultiComponent=function(x,mL,G){var F=U[mL],o=p[mL];if(!o)throw new Error(`Unknown component: ${mL}.`);if(!F.multi)throw new Error("removeMultiComponent called on non-multi component");return function(L,U,x,mL){var p=x.hash[L];if(p){var G=p[mL];G&&(p[mL]=null,U.nx&&U.nx(L,G),a.multiComps.push({entID:L,data:x}),A())}}(x,F,o,G),L}};var mL=x(14598)},14598:L=>{function U(L,U){var x=L._map[U];if(delete L.hash[U],delete L._map[U],x===L.list.length-1)L.list.pop();else{var mL=L.list.pop();if(L.list[x]=mL,null===mL||null===mL[0]){var p=L.list.length;for(var G in L._map)if(L._map[G]===p)return void(L._map[G]=x)}else{var F=mL.Wa||mL[0].Wa;L._map[F]=x}}}L.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(L,U){if("number"===typeof this._map[L]){var x=this._map[L];this.hash[L]=U,this.list[x]=U}else this._map[L]=this.list.length,this.hash[L]=U,this.list.push(U)}remove(L){var U=this._map[L];this.hash[L]=null,this.list[U]=null,this._pendingRemovals.push(L)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var L=0;L<this._pendingRemovals.length;L++){var x=this._pendingRemovals[L];null===this.hash[x]&&U(this,x)}this._pendingRemovals.length=0}}},14555:L=>{"use strict";var U,x="object"===typeof Reflect?Reflect:null,mL=function(L,U,x){return Function.prototype.apply.call(L,U,x)};U=x&&"function"===typeof x.ownKeys?x.ownKeys:Object.getOwnPropertySymbols?function(L){return Object.getOwnPropertyNames(L).concat(Object.getOwnPropertySymbols(L))}:function(L){return Object.getOwnPropertyNames(L)};var p=Number.isNaN||function(L){return L!==L};function G(){G.init.call(this)}L.exports=G,L.exports.once=function(L,U){return new Promise((function(x,mL){function p(x){L.removeListener(U,G),mL(x)}function G(){"function"===typeof L.removeListener&&L.removeListener("error",p),x([].slice.call(arguments))}S(L,U,G,{once:!0}),"error"!==U&&function(L,U,x){"function"===typeof L.on&&S(L,"error",U,x)}(L,p,{once:!0})}))},G.EventEmitter=G,G.prototype._events=void 0,G.prototype._eventsCount=0,G.prototype._maxListeners=void 0;var F=10;function a(L){if("function"!==typeof L)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof L)}function o(L){return void 0===L._maxListeners?G.defaultMaxListeners:L._maxListeners}function A(L,U,x,mL){var p,G,F,A;if(a(x),void 0===(G=L._events)?(G=L._events=Object.create(null),L._eventsCount=0):(void 0!==G.newListener&&(L.emit("newListener",U,x.listener?x.listener:x),G=L._events),F=G[U]),void 0===F)F=G[U]=x,++L._eventsCount;else if("function"===typeof F?F=G[U]=mL?[x,F]:[F,x]:mL?F.unshift(x):F.push(x),(p=o(L))>0&&F.length>p&&!F.warned){F.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(U)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.mx=L,r.type=U,r.count=F.length,A=r,console&&console.warn&&console.warn(A)}return L}function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(L,U,x){var mL={fired:!1,wrapFn:void 0,target:L,type:U,listener:x},p=r.bind(mL);return p.listener=x,mL.wrapFn=p,p}function b(L,U,x){var mL=L._events;if(void 0===mL)return[];var p=mL[U];return void 0===p?[]:"function"===typeof p?x?[p.listener||p]:[p]:x?function(L){for(var U=new Array(L.length),x=0;x<U.length;++x)U[x]=L[x].listener||L[x];return U}(p):Y(p,p.length)}function E(L){var U=this._events;if(void 0!==U){var x=U[L];if("function"===typeof x)return 1;if(void 0!==x)return x.length}return 0}function Y(L,U){for(var x=new Array(U),mL=0;mL<U;++mL)x[mL]=L[mL];return x}function S(L,U,x,mL){if("function"===typeof L.on)mL.once?L.once(U,x):L.on(U,x);else{if("function"!==typeof L.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof L);L.addEventListener(U,(function p(G){mL.once&&L.removeEventListener(U,p),x(G)}))}}Object.defineProperty(G,"defaultMaxListeners",{enumerable:!0,get:function(){return F},set:function(L){if("number"!==typeof L||L<0||p(L))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+L+".");F=L}}),G.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},G.prototype.setMaxListeners=function(L){if("number"!==typeof L||L<0||p(L))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+L+".");return this._maxListeners=L,this},G.prototype.getMaxListeners=function(){return o(this)},G.prototype.emit=function(L){for(var U=[],x=1;x<arguments.length;x++)U.push(arguments[x]);var p="error"===L,G=this._events;if(void 0!==G)p=p&&void 0===G.error;else if(!p)return!1;if(p){var F;if(U.length>0&&(F=U[0]),F instanceof Error)throw F;var a=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw a.context=F,a}var o=G[L];if(void 0===o)return!1;if("function"===typeof o)mL(o,this,U);else{var A=o.length,r=Y(o,A);for(x=0;x<A;++x)mL(r[x],this,U)}return!0},G.prototype.addListener=function(L,U){return A(this,L,U,!1)},G.prototype.on=G.prototype.addListener,G.prototype.prependListener=function(L,U){return A(this,L,U,!0)},G.prototype.once=function(L,U){return a(U),this.on(L,h(this,L,U)),this},G.prototype.prependOnceListener=function(L,U){return a(U),this.prependListener(L,h(this,L,U)),this},G.prototype.removeListener=function(L,U){var x,mL,p,G,F;if(a(U),void 0===(mL=this._events))return this;if(void 0===(x=mL[L]))return this;if(x===U||x.listener===U)0===--this._eventsCount?this._events=Object.create(null):(delete mL[L],mL.removeListener&&this.emit("removeListener",L,x.listener||U));else if("function"!==typeof x){for(p=-1,G=x.length-1;G>=0;G--)if(x[G]===U||x[G].listener===U){F=x[G].listener,p=G;break}if(p<0)return this;0===p?x.shift():function(L,U){for(;U+1<L.length;U++)L[U]=L[U+1];L.pop()}(x,p),1===x.length&&(mL[L]=x[0]),void 0!==mL.removeListener&&this.emit("removeListener",L,F||U)}return this},G.prototype.off=G.prototype.removeListener,G.prototype.pU=function(L){var U,x,mL;if(void 0===(x=this._events))return this;if(void 0===x.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==x[L]&&(0===--this._eventsCount?this._events=Object.create(null):delete x[L]),this;if(0===arguments.length){var p,G=Object.keys(x);for(mL=0;mL<G.length;++mL)"removeListener"!==(p=G[mL])&&this.pU(p);return this.pU("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(U=x[L]))this.removeListener(L,U);else if(void 0!==U)for(mL=U.length-1;mL>=0;mL--)this.removeListener(L,U[mL]);return this},G.prototype.listeners=function(L){return b(this,L,!0)},G.prototype.rawListeners=function(L){return b(this,L,!1)},G.listenerCount=function(L,U){return"function"===typeof L.listenerCount?L.listenerCount(U):E.call(L,U)},G.prototype.listenerCount=E,G.prototype.eventNames=function(){return this._eventsCount>0?U(this._events):[]}},14833:L=>{"use strict";L.exports=function(L,U,x,mL,p,G){var F=+U[0],a=+U[1],o=+U[2],A=+x[0],r=+x[1],h=+x[2],b=Math.sqrt(A*A+r*r+h*h);if(0===b)throw new Error("Can't raycast along a zero vector");return function(L,U,x,mL,p,G,F,a,o,A){for(var r=0,h=Math.floor,b=0|h(U),E=0|h(x),Y=0|h(mL),S=p>0?1:-1,V=G>0?1:-1,H=F>0?1:-1,Q=Math.abs(1/p),q=Math.abs(1/G),f=Math.abs(1/F),v=Q<1/0?Q*(S>0?b+1-U:U-b):1/0,D=q<1/0?q*(V>0?E+1-x:x-E):1/0,P=f<1/0?f*(H>0?Y+1-mL:mL-Y):1/0,d=-1;r<=a;){var K=L(b,E,Y);if(K)return o&&(o[0]=U+r*p,o[1]=x+r*G,o[2]=mL+r*F),A&&(A[0]=A[1]=A[2]=0,0===d&&(A[0]=-S),1===d&&(A[1]=-V),2===d&&(A[2]=-H)),K;v<D?v<P?(b+=S,r=v,v+=Q,d=0):(Y+=H,r=P,P+=f,d=2):D<P?(E+=V,r=D,D+=q,d=1):(Y+=H,r=P,P+=f,d=2)}return o&&(o[0]=U+r*p,o[1]=x+r*G,o[2]=mL+r*F),A&&(A[0]=A[1]=A[2]=0),0}(L,F,a,o,A/=b,r/=b,h/=b,mL="undefined"===typeof mL?64:+mL,p,G)}},14852:(L,U,x)=>{"use strict";x.d(U,{b:()=>G});var mL=x(14555);function p(){this.KE=!1,this.stopPropagation=!1,this.lE=!1,this.disabled=!1}class G{constructor(L,U){this.version="0.7.0";var x=Object.assign({},new p,U||{});this.element=L||document,this.KE=!!x.KE,this.stopPropagation=!!x.stopPropagation,this.lE=!!x.lE,this.disabled=!!x.disabled,this.filterEvents=(L,U)=>!0,this.down=new mL.EventEmitter,this.up=new mL.EventEmitter,this.state={},this.gA={dx:0,dy:0,SY:0,ZA:0,VY:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?a(this):document.addEventListener("DOMContentLoaded",(L=>{a(this)}),{once:!0})}bind(L){for(var U=arguments.length,x=new Array(U>1?U-1:0),mL=1;mL<U;mL++)x[mL-1]=arguments[mL];x.forEach((U=>{var x=this._keyBindmap[U]||[];x.includes(L)||(x.push(L),this._keyBindmap[U]=x)})),this.state[L]=!!this.state[L],this.pressCount[L]=this.pressCount[L]||0,this.releaseCount[L]=this.releaseCount[L]||0}unbind(L){for(var U in this._keyBindmap){var x=this._keyBindmap[U],mL=x.indexOf(L);mL>-1&&x.splice(mL,1)}}getBindings(){var L={};for(var U in this._keyBindmap){this._keyBindmap[U].forEach((x=>{L[x]=L[x]||[],L[x].push(U)}))}return L}pa(){F(this.gA),F(this.pressCount),F(this.releaseCount)}}function F(L){for(var U in L)L[U]=0}function a(L){window.addEventListener("keydown",Y.bind(null,L,!0),!1),window.addEventListener("keyup",Y.bind(null,L,!1),!1);var U={passive:!0};L.element.addEventListener("touchstart",h.bind(void 0,L),{passive:!1}),L.element.addEventListener("touchend",E.bind(void 0,L),U),L.element.addEventListener("mousedown",S.bind(null,L,!0),U),window.document.addEventListener("mouseup",S.bind(null,L,!1),U),L.element.addEventListener("touchmove",V.bind(null,L),U),L.element.addEventListener("mousemove",V.bind(null,L),U),window.PointerEvent,L.element.addEventListener("wheel",H.bind(null,L),U),L.element.addEventListener("contextmenu",Q.bind(null,L),!1),window.addEventListener("blur",q.bind(null,L),!1)}var o=0,A=0,r=null;function h(L,U){U.preventDefault(),b(U)}function b(L){let U=!1;for(let x=0;x<L.touches.length;++x)if(L.touches[x].identifier===r){U=!0;break}if(!U){const U=L.changedTouches[0];o=U.clientX,A=U.clientY,r=U.identifier}}function E(L,U){for(var x=U.changedTouches,mL=0;mL<x.length;++mL)x[mL].identifier===r&&(r=null)}function Y(L,U,x){f(x.code,U,L,x)}function S(L,U,x){if("pointerId"in x)if(U){if(null!==L._touches.currID)return;L._touches.currID=x.pointerId}else{if(L._touches.currID!==x.pointerId)return;L._touches.currID=null}return f("Mouse"+("button"in x?x.button+1:1),U,L,x),!1}function V(L,U){var x=U.movementX||U.mozMovementX||0,mL=U.movementY||U.mozMovementY||0;if(U.touches&&0===(x|mL)){var p=function(L){b(L);for(let U=0;U<L.changedTouches.length;++U)if(L.changedTouches[U].identifier==r){const x=L.changedTouches[U],mL=[x.clientX-o,x.clientY-A];return o=x.clientX,A=x.clientY,mL}return console.error(`Did not find touch id ${r}`),[0,0]}(U);x=p[0],mL=p[1]}L.gA.dx+=x,L.gA.dy+=mL}function H(L,U){var x=1;switch(U.deltaMode){case 0:x=1;break;case 1:x=12;break;case 2:x=L.element.clientHeight||window.innerHeight}L.gA.SY+=(U.deltaX||0)*x,L.gA.ZA+=(U.deltaY||0)*x,L.gA.VY+=(U.deltaZ||0)*x}function Q(L,U){if(!L.lE)return U.preventDefault(),!1}function q(L){for(var U in L._keyStates)L._keyStates[U]&&(/^Mouse\d/.test(U)||f(U,!1,L,{code:U,note:"xhotrc3hqp",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(L,U,x,mL){var p=x._keyBindmap[L];p&&(v(x._keyStates[L],U)&&(x._keyStates[L]=U,p.forEach((L=>{(!x.filterEvents||x.filterEvents(mL,L))&&function(L,U,x,mL){var p=U?x.pressCount:x.releaseCount;p[L]=(p[L]||0)+1;var G=x._bindPressCount[L]||0;(G+=U?1:-1)<0&&(G=0);x._bindPressCount[L]=G;var F=x.state[L];if(v(F,G)){x.state[L]=G>0;var a=U?x.down:x.up;x.disabled||a.emit(L,mL)}}(L,U,x,mL)}))),"button"in mL||(x.KE&&!mL.defaultPrevented&&mL.preventDefault(),x.stopPropagation&&mL.stopPropagation()))}function v(L,U){return L?!U:U}},13491:L=>{L.exports=function(L,U,x){return L[0]=U[0]+x[0],L[1]=U[1]+x[1],L[2]=U[2]+x[2],L}},13453:(L,U,x)=>{L.exports=function(L,U){var x=mL(L[0],L[1],L[2]),F=mL(U[0],U[1],U[2]);p(x,x),p(F,F);var a=G(x,F);return a>1?0:Math.acos(a)};var mL=x(13462),p=x(13466),G=x(13475)},13539:L=>{L.exports=function(L,U){return L[0]=Math.ceil(U[0]),L[1]=Math.ceil(U[1]),L[2]=Math.ceil(U[2]),L}},13445:L=>{L.exports=function(L){var U=new Float32Array(3);return U[0]=L[0],U[1]=L[1],U[2]=L[2],U}},13478:L=>{L.exports=function(L,U){return L[0]=U[0],L[1]=U[1],L[2]=U[2],L}},13438:L=>{L.exports=function(){var L=new Float32Array(3);return L[0]=0,L[1]=0,L[2]=0,L}},13626:L=>{L.exports=function(L,U,x){var mL=U[0],p=U[1],G=U[2],F=x[0],a=x[1],o=x[2];return L[0]=p*o-G*a,L[1]=G*F-mL*o,L[2]=mL*a-p*F,L}},13569:(L,U,x)=>{L.exports=x(13564)},13564:L=>{L.exports=function(L,U){var x=U[0]-L[0],mL=U[1]-L[1],p=U[2]-L[2];return Math.sqrt(x*x+mL*mL+p*p)}},13522:(L,U,x)=>{L.exports=x(13518)},13518:L=>{L.exports=function(L,U,x){return L[0]=U[0]/x[0],L[1]=U[1]/x[1],L[2]=U[2]/x[2],L}},13475:L=>{L.exports=function(L,U){return L[0]*U[0]+L[1]*U[1]+L[2]*U[2]}},13431:L=>{L.exports=1e-6},13483:(L,U,x)=>{L.exports=function(L,U){var x=L[0],p=L[1],G=L[2],F=U[0],a=U[1],o=U[2];return Math.abs(x-F)<=mL*Math.max(1,Math.abs(x),Math.abs(F))&&Math.abs(p-a)<=mL*Math.max(1,Math.abs(p),Math.abs(a))&&Math.abs(G-o)<=mL*Math.max(1,Math.abs(G),Math.abs(o))};var mL=x(13431)},13489:L=>{L.exports=function(L,U){return L[0]===U[0]&&L[1]===U[1]&&L[2]===U[2]}},13533:L=>{L.exports=function(L,U){return L[0]=Math.floor(U[0]),L[1]=Math.floor(U[1]),L[2]=Math.floor(U[2]),L}},13681:(L,U,x)=>{L.exports=function(L,U,x,p,G,F){var a,o;U||(U=3);x||(x=0);o=p?Math.min(p*U+x,L.length):L.length;for(a=x;a<o;a+=U)mL[0]=L[a],mL[1]=L[a+1],mL[2]=L[a+2],G(mL,mL,F),L[a]=mL[0],L[a+1]=mL[1],L[a+2]=mL[2];return L};var mL=x(13438)()},13462:L=>{L.exports=function(L,U,x){var mL=new Float32Array(3);return mL[0]=L,mL[1]=U,mL[2]=x,mL}},13428:(L,U,x)=>{L.exports={EPSILON:x(13431),create:x(13438),clone:x(13445),angle:x(13453),sF:x(13462),k:x(13478),set:x(13480),equals:x(13483),exactEquals:x(13489),add:x(13491),SU:x(13495),sub:x(13500),multiply:x(13508),mul:x(13512),divide:x(13518),div:x(13522),min:x(13525),max:x(13531),floor:x(13533),ceil:x(13539),round:x(13542),scale:x(13551),CF:x(13560),distance:x(13564),i:x(13569),squaredDistance:x(13576),sqrDist:x(13583),length:x(13589),len:x(13594),squaredLength:x(13602),kF:x(13609),negate:x(13613),inverse:x(13622),normalize:x(13466),dot:x(13475),cross:x(13626),IF:x(13633),random:x(13639),transformMat4:x(13644),transformMat3:x(13651),transformQuat:x(13653),TF:x(13660),OF:x(13669),La:x(13678),forEach:x(13681)}},13622:L=>{L.exports=function(L,U){return L[0]=1/U[0],L[1]=1/U[1],L[2]=1/U[2],L}},13594:(L,U,x)=>{L.exports=x(13589)},13589:L=>{L.exports=function(L){var U=L[0],x=L[1],mL=L[2];return Math.sqrt(U*U+x*x+mL*mL)}},13633:L=>{L.exports=function(L,U,x,mL){var p=U[0],G=U[1],F=U[2];return L[0]=p+mL*(x[0]-p),L[1]=G+mL*(x[1]-G),L[2]=F+mL*(x[2]-F),L}},13531:L=>{L.exports=function(L,U,x){return L[0]=Math.max(U[0],x[0]),L[1]=Math.max(U[1],x[1]),L[2]=Math.max(U[2],x[2]),L}},13525:L=>{L.exports=function(L,U,x){return L[0]=Math.min(U[0],x[0]),L[1]=Math.min(U[1],x[1]),L[2]=Math.min(U[2],x[2]),L}},13512:(L,U,x)=>{L.exports=x(13508)},13508:L=>{L.exports=function(L,U,x){return L[0]=U[0]*x[0],L[1]=U[1]*x[1],L[2]=U[2]*x[2],L}},13613:L=>{L.exports=function(L,U){return L[0]=-U[0],L[1]=-U[1],L[2]=-U[2],L}},13466:L=>{L.exports=function(L,U){var x=U[0],mL=U[1],p=U[2],G=x*x+mL*mL+p*p;G>0&&(G=1/Math.sqrt(G),L[0]=U[0]*G,L[1]=U[1]*G,L[2]=U[2]*G);return L}},13639:L=>{L.exports=function(L,U){U=U||1;var x=2*Math.random()*Math.PI,mL=2*Math.random()-1,p=Math.sqrt(1-mL*mL)*U;return L[0]=Math.cos(x)*p,L[1]=Math.sin(x)*p,L[2]=mL*U,L}},13660:L=>{L.exports=function(L,U,x,mL){var p=x[1],G=x[2],F=U[1]-p,a=U[2]-G,o=Math.sin(mL),A=Math.cos(mL);return L[0]=U[0],L[1]=p+F*A-a*o,L[2]=G+F*o+a*A,L}},13669:L=>{L.exports=function(L,U,x,mL){var p=x[0],G=x[2],F=U[0]-p,a=U[2]-G,o=Math.sin(mL),A=Math.cos(mL);return L[0]=p+a*o+F*A,L[1]=U[1],L[2]=G+a*A-F*o,L}},13678:L=>{L.exports=function(L,U,x,mL){var p=x[0],G=x[1],F=U[0]-p,a=U[1]-G,o=Math.sin(mL),A=Math.cos(mL);return L[0]=p+F*A-a*o,L[1]=G+F*o+a*A,L[2]=U[2],L}},13542:L=>{L.exports=function(L,U){return L[0]=Math.round(U[0]),L[1]=Math.round(U[1]),L[2]=Math.round(U[2]),L}},13551:L=>{L.exports=function(L,U,x){return L[0]=U[0]*x,L[1]=U[1]*x,L[2]=U[2]*x,L}},13560:L=>{L.exports=function(L,U,x,mL){return L[0]=U[0]+x[0]*mL,L[1]=U[1]+x[1]*mL,L[2]=U[2]+x[2]*mL,L}},13480:L=>{L.exports=function(L,U,x,mL){return L[0]=U,L[1]=x,L[2]=mL,L}},13583:(L,U,x)=>{L.exports=x(13576)},13609:(L,U,x)=>{L.exports=x(13602)},13576:L=>{L.exports=function(L,U){var x=U[0]-L[0],mL=U[1]-L[1],p=U[2]-L[2];return x*x+mL*mL+p*p}},13602:L=>{L.exports=function(L){var U=L[0],x=L[1],mL=L[2];return U*U+x*x+mL*mL}},13500:(L,U,x)=>{L.exports=x(13495)},13495:L=>{L.exports=function(L,U,x){return L[0]=U[0]-x[0],L[1]=U[1]-x[1],L[2]=U[2]-x[2],L}},13651:L=>{L.exports=function(L,U,x){var mL=U[0],p=U[1],G=U[2];return L[0]=mL*x[0]+p*x[3]+G*x[6],L[1]=mL*x[1]+p*x[4]+G*x[7],L[2]=mL*x[2]+p*x[5]+G*x[8],L}},13644:L=>{L.exports=function(L,U,x){var mL=U[0],p=U[1],G=U[2],F=x[3]*mL+x[7]*p+x[11]*G+x[15];return F=F||1,L[0]=(x[0]*mL+x[4]*p+x[8]*G+x[12])/F,L[1]=(x[1]*mL+x[5]*p+x[9]*G+x[13])/F,L[2]=(x[2]*mL+x[6]*p+x[10]*G+x[14])/F,L}},13653:L=>{L.exports=function(L,U,x){var mL=U[0],p=U[1],G=U[2],F=x[0],a=x[1],o=x[2],A=x[3],r=A*mL+a*G-o*p,h=A*p+o*mL-F*G,b=A*G+F*p-a*mL,E=-F*mL-a*p-o*G;return L[0]=r*A+E*-F+h*-o-b*-a,L[1]=h*A+E*-a+b*-F-r*-o,L[2]=b*A+E*-o+r*-a-h*-F,L}},14576:L=>{"use strict";L.exports=function(L){for(var U=new Array(L),x=0;x<L;++x)U[x]=x;return U}},14648:L=>{L.exports=function(L){return null!=L&&null!=L.constructor&&"function"===typeof L.constructor.isBuffer&&L.constructor.isBuffer(L)}},14835:(L,U,x)=>{"use strict";x.d(U,{b:()=>mL});class mL{constructor(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.sr=!1,this.Cr=!1,this.wr=30,this.Br=0,this.rh=!1,this.fullscreen=!1,this.Tr=function(L){},this.Or=function(){},this.ah=function(){},this.Up=function(){},this.Uh=function(L){},this.onFullscreenChanged=function(L){},A((()=>{!function(L,U){L._nowObject=performance||Date,L._lastTick=0,L._renderAccum=0,L._rt=0,L._frameCB=a.bind(null,L),requestAnimationFrame(L._frameCB),U>0&&(L._intervalCB=F.bind(null,L),L._interval=setInterval(L._intervalCB,Math.max(U,1e3/L.wr/2)))}(this,U),function(L,U){if(!U)return;var x=!1,mL=!1;document.addEventListener("pointerlockchange",(mL=>{x=document.pointerLockElement===U,L.Uh(x)})),document.addEventListener("fullscreenchange",(x=>{mL=document.fullscreenElement===U,L.onFullscreenChanged(mL)})),Object.defineProperty(L,"rh",{get:()=>x,set:L=>{L&&!x?o(U):x&&!L&&function(L){L.exitPointerLock&&L.exitPointerLock()}(document)}}),Object.defineProperty(L,"fullscreen",{get:()=>mL,set:L=>{L&&!mL?U.requestFullscreen():mL&&!L&&document.exitFullscreen()}}),U.addEventListener("click",(p=>{L.sr&&!x&&o(U),L.Cr&&!mL&&U.requestFullscreen()}));var p=()=>L.Up();if(window.ResizeObserver){new ResizeObserver(p).observe(U)}else window.addEventListener("resize",p)}(this,L),this.ah()}))}}var p=3,G=20;function F(L){for(var U=1e3/L.wr,x=L._nowObject.now()+G,mL=0;L._nowObject.now()>=L._lastTick+U&&L._nowObject.now()<x&&++mL<=p;)L.Tr(U),L._lastTick+=U;var F=5*(U+5),a=L._nowObject.now();if(a-L._lastTick>F)for(;a>=L._lastTick+U;)L._lastTick+=U}function a(L){requestAnimationFrame(L._frameCB),F(L);var U=L._nowObject.now(),x=U-L._rt;if(L._rt=U,L.Br>0){L._renderAccum+=x;var mL=1e3/L.Br;if(L._renderAccum<mL)return;L._renderAccum=Math.min(L._renderAccum-mL,mL)}var p=1e3/L.wr,G=(U-L._lastTick)/p;L.Or(x,G,p)}function o(L){L.requestPointerLock&&L.requestPointerLock()}var A=L=>{if("loading"===document.readyState){var U=()=>{document.removeEventListener("readystatechange",U),L()};document.addEventListener("readystatechange",U)}else setTimeout(L,1)}},14570:(L,U,x)=>{var mL=x(14576),p=x(14578),G="undefined"!==typeof Float64Array;function F(L,U){return L[0]-U[0]}function a(){var L,U=this.stride,x=new Array(U.length);for(L=0;L<x.length;++L)x[L]=[Math.abs(U[L]),L];x.sort(F);var mL=new Array(x.length);for(L=0;L<mL.length;++L)mL[L]=x[L][1];return mL}function o(L,U){var x=["View",U,"d",L].join("");U<0&&(x="View_Nil"+L);var p="generic"===L;if(-1===U){var G="function "+x+"(a){this.data=a;};var proto="+x+".prototype;proto.dtype='"+L+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+x+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+x+"(a){return new "+x+"(a);}";return new Function(G)()}if(0===U){G="function "+x+"(a,d) {this.data = a;this.offset = d};var proto="+x+".prototype;proto.dtype='"+L+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+x+"_copy() {return new "+x+"(this.data,this.offset)};proto.pick=function "+x+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+x+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+x+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+x+"(a,b,c,d){return new "+x+"(a,d)}";return new Function("TrivialArray",G)(A[L][0])}G=["'use strict'"];var F=mL(U),o=F.map((function(L){return"i"+L})),r="this.offset+"+F.map((function(L){return"this.stride["+L+"]*i"+L})).join("+"),h=F.map((function(L){return"b"+L})).join(","),b=F.map((function(L){return"c"+L})).join(",");G.push("function "+x+"(a,"+h+","+b+",d){this.data=a","this.shape=["+h+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+x+".prototype","proto.dtype='"+L+"'","proto.dimension="+U),G.push("Object.defineProperty(proto,'size',{get:function "+x+"_size(){return "+F.map((function(L){return"this.shape["+L+"]"})).join("*"),"}})"),1===U?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),U<4?(G.push("function "+x+"_order(){"),2===U?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+x+"_set("+o.join(",")+",v){"),p?G.push("return this.data.set("+r+",v)}"):G.push("return this.data["+r+"]=v}"),G.push("proto.get=function "+x+"_get("+o.join(",")+"){"),p?G.push("return this.data.get("+r+")}"):G.push("return this.data["+r+"]}"),G.push("proto.index=function "+x+"_index(",o.join(),"){return "+r+"}"),G.push("proto.hi=function "+x+"_hi("+o.join(",")+"){return new "+x+"(this.data,"+F.map((function(L){return["(typeof i",L,"!=='number'||i",L,"<0)?this.shape[",L,"]:i",L,"|0"].join("")})).join(",")+","+F.map((function(L){return"this.stride["+L+"]"})).join(",")+",this.offset)}");var E=F.map((function(L){return"a"+L+"=this.shape["+L+"]"})),Y=F.map((function(L){return"c"+L+"=this.stride["+L+"]"}));G.push("proto.lo=function "+x+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+E.join(",")+","+Y.join(","));for(var S=0;S<U;++S)G.push("if(typeof i"+S+"==='number'&&i"+S+">=0){d=i"+S+"|0;b+=c"+S+"*d;a"+S+"-=d}");G.push("return new "+x+"(this.data,"+F.map((function(L){return"a"+L})).join(",")+","+F.map((function(L){return"c"+L})).join(",")+",b)}"),G.push("proto.step=function "+x+"_step("+o.join(",")+"){var "+F.map((function(L){return"a"+L+"=this.shape["+L+"]"})).join(",")+","+F.map((function(L){return"b"+L+"=this.stride["+L+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(S=0;S<U;++S)G.push("if(typeof i"+S+"==='number'){d=i"+S+"|0;if(d<0){c+=b"+S+"*(a"+S+"-1);a"+S+"=ceil(-a"+S+"/d)}else{a"+S+"=ceil(a"+S+"/d)}b"+S+"*=d}");G.push("return new "+x+"(this.data,"+F.map((function(L){return"a"+L})).join(",")+","+F.map((function(L){return"b"+L})).join(",")+",c)}");var V=new Array(U),H=new Array(U);for(S=0;S<U;++S)V[S]="a[i"+S+"]",H[S]="b[i"+S+"]";G.push("proto.transpose=function "+x+"_transpose("+o+"){"+o.map((function(L,U){return L+"=("+L+"===undefined?"+U+":"+L+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+x+"(this.data,"+V.join(",")+","+H.join(",")+",this.offset)}"),G.push("proto.pick=function "+x+"_pick("+o+"){var a=[],b=[],c=this.offset");for(S=0;S<U;++S)G.push("if(typeof i"+S+"==='number'&&i"+S+">=0){c=(c+this.stride["+S+"]*i"+S+")|0}else{a.push(this.shape["+S+"]);b.push(this.stride["+S+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+x+"(data,shape,stride,offset){return new "+x+"(data,"+F.map((function(L){return"shape["+L+"]"})).join(",")+","+F.map((function(L){return"stride["+L+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(A[L],a)}var A={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};L.exports=function(L,U,x,mL){if(void 0===L)return(0,A.array[0])([]);"number"===typeof L&&(L=[L]),void 0===U&&(U=[L.length]);var F=U.length;if(void 0===x){x=new Array(F);for(var a=F-1,r=1;a>=0;--a)x[a]=r,r*=U[a]}if(void 0===mL){mL=0;for(a=0;a<F;++a)x[a]<0&&(mL-=(U[a]-1)*x[a])}for(var h=function(L){if(p(L))return"buffer";if(G)switch(Object.prototype.toString.call(L)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(L)?"array":"generic"}(L),b=A[h];b.length<=F+1;)b.push(o(h,b.length-1));return(0,b[F+1])(L,U,x,mL)}},14578:L=>{function U(L){return!!L.constructor&&"function"===typeof L.constructor.isBuffer&&L.constructor.isBuffer(L)}L.exports=function(L){return null!=L&&(U(L)||function(L){return"function"===typeof L.readFloatLE&&"function"===typeof L.slice&&U(L.slice(0,0))}(L)||!!L._isBuffer)}},14731:L=>{"use strict";var U=[],x=[],mL=[],p=[],G=[],F=[],a=[],o=[],A=[],r=[],h=[],b=[];L.exports=function(L,E,Y,S,V,H){for(var Q=a,q=A,f=r,v=b,D=0;D<3;D++)Q[D]=+Y[D],f[D]=+E.max[D],q[D]=+E.base[D];H||(H=1e-10);var P=function(L,a,A,r,b,E){var Y=U,S=x,V=mL,H=p,Q=G,q=F,f=o,v=Math.floor,D=0,P=0,d=0,K=0,l=0;if(i(),0===d)return 0;for(K=y();P<=d;){if(X(K)&&t())return D;K=y()}for(D+=d,l=0;l<3;l++)r[l]+=A[l],b[l]+=A[l];return D;function i(){if(P=0,0!==(d=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2])))for(var L=0;L<3;L++){var U=A[L]>=0;H[L]=U?1:-1;var x=U?b[L]:r[L];Y[L]=U?r[L]:b[L],S[L]=n(x,H[L]),V[L]=N(Y[L],H[L]),f[L]=A[L]/d,Q[L]=Math.abs(1/f[L]);var mL=U?S[L]+1-x:x-S[L];q[L]=Q[L]<1/0?Q[L]*mL:1/0}}function X(U){for(var x=H[0],mL=0===U?S[0]:V[0],p=S[0]+x,G=H[1],F=1===U?S[1]:V[1],a=S[1]+G,o=H[2],A=2===U?S[2]:V[2],r=S[2]+o,h=mL;h!=p;h+=x)for(var b=F;b!=a;b+=G)for(var E=A;E!=r;E+=o)if(L(h,b,E))return!0;return!1}function t(){D+=P;var L=H[K],U=P/d,x=h;for(l=0;l<3;l++){var mL=A[l]*U;r[l]+=mL,b[l]+=mL,x[l]=A[l]-mL}if(L>0?b[K]=Math.round(b[K]):r[K]=Math.round(r[K]),a(D,K,L,x))return!0;for(l=0;l<3;l++)A[l]=x[l];return i(),0===d}function y(){var L=q[0]<q[1]?q[0]<q[2]?0:2:q[1]<q[2]?1:2,U=q[L]-P;for(P=q[L],S[L]+=H[L],q[L]+=Q[L],l=0;l<3;l++)Y[l]+=U*f[l],V[l]=N(Y[l],H[l]);return L}function n(L,U){return v(L-U*E)}function N(L,U){return v(L+U*E)}}(L,S,Q,q,f,H);if(!V){for(D=0;D<3;D++)v[D]=Y[D]>0?f[D]-E.max[D]:q[D]-E.base[D];E.translate(v)}return P}},14856:(L,U,x)=>{"use strict";x.d(U,{b:()=>h});var mL=x(14729),p=x(13428);class G{constructor(L,U,x,G,F,a,o){this.RA=new mL(L.base,L.ar),this.zp=U,this.friction=x,this.restitution=G,this.zF=F,this.gY=a,this.MF=!!o,this.Fr=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.PS=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.HA=p.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=p.create(),this._impulses=p.create(),this._sleepFrameCount=10}loadFromCopy(L){p.k(this.RA.base,L.RA.base),p.k(this.RA.ar,L.RA.ar),p.k(this.RA.max,L.RA.max),this.RA.mag=L.RA.mag,this.zp=L.zp,this.friction=L.friction,this.restitution=L.restitution,this.zF=L.zF,this.gY=L.gY,this.MF=L.MF,this.Fr=L.Fr,this.fluidDrag=L.fluidDrag,this.PS=L.PS,this.preventFallOffEdge=L.preventFallOffEdge,this.rolledBackLastTick=L.rolledBackLastTick,p.k(this.HA,L.HA),p.k(this.resting,L.resting),this.inFluid=L.inFluid,this._ratioInFluid=L._ratioInFluid,p.k(this._forces,L._forces),p.k(this._impulses,L._impulses),this._sleepFrameCount=L._sleepFrameCount}setPosition(L){F(L),p.SU(L,L,this.RA.base),this.RA.translate(L),this.fA()}dp(){return p.clone(this.RA.base)}applyForce(L){F(L),p.add(this._forces,this._forces,L),this.fA()}applyImpulse(L){F(L),p.add(this._impulses,this._impulses,L),this.fA()}fA(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var F=L=>{};var a=x(14729),o=x(13428),A=x(14731);function r(){this.Fr=.1,this.fluidDrag=.4,this.WF=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function h(L,U,x){L=Object.assign(new r,L),this.gravity=L.gravity||[0,-10,0],this.Fr=L.Fr||.1,this.WF=L.WF||2,this.fluidDrag=L.fluidDrag||.4,this.minBounceImpulse=L.minBounceImpulse,this.bodies=[],this.GY=L.GY,this.testSolid=U,this.testFluid=x}h.prototype.WY=function(L,U,x,mL,p,F){L=L||new a([0,0,0],[1,1,1]),"undefined"==typeof U&&(U=1),"undefined"==typeof x&&(x=1),"undefined"==typeof mL&&(mL=0),"undefined"==typeof p&&(p=1);var o=new G(L,U,x,mL,p,F);return this.bodies.push(o),o},h.prototype.IY=function(L){var U=this.bodies.indexOf(L);U<0||(this.bodies.splice(U,1),L.RA=L.gY=null)};var b=o.create(),E=o.create(),Y=o.create(),S=o.create(),V=o.create(),H=o.create(),Q=o.create(),q=new a([0,0,0],[1,1,1]),f=new G(q,1,1,0,1,(()=>{}),!1);function v(L,U,x){return U=x,U*=1-(1-L.ratioInFluid)**2}h.prototype.pa=function(L){L/=1e3;var U=z(0,o.squaredLength(this.gravity));this.bodies.forEach((x=>function(L,U,x,mL){o.k(V,U.resting),L.GY&&f.loadFromCopy(U);if(U.zp<=0)return o.set(U.HA,0,0,0),o.set(U._forces,0,0,0),void o.set(U._impulses,0,0,0);var p=mL||0===U.zF;if(function(L,U,x,mL){if(U._sleepFrameCount>0)return!1;if(mL)return!0;var p=!1,G=.5*x*x*U.zF;return o.scale(g,L.gravity,G),A(L.testSolid,U.RA,g,(function(){return p=!0,!0}),!0),p}(L,U,x,p))return;U._sleepFrameCount--,function(L,U){var x=U.RA,mL=Math.floor(x.base[0]),p=Math.floor(x.base[2]),G=Math.floor(x.base[1]),F=Math.floor(x.max[1]);if(!L.testFluid(mL,G,p))return U.inFluid=!1,void(U.ratioInFluid=0);var a=1,A=G+1;for(;A<=F&&L.testFluid(mL,A,p);)a++,A++;var r=(G+a-x.base[1])/x.ar[1];r>1&&(r=1);var h=x.ar[0]*x.ar[1]*x.ar[2]*r,b=P;o.scale(b,L.gravity,-L.WF*h*U.zF),U.applyForce(b),U.inFluid=!0,U.ratioInFluid=r}(L,U),J(U._forces),J(U._impulses),J(U.HA),J(U.resting),o.scale(b,U._forces,1/U.zp),o.CF(b,b,L.gravity,U.zF),o.scale(E,U._impulses,1/U.zp),o.CF(E,E,b,x),o.add(U.HA,U.HA,E),U.friction&&(d(L,0,U,E,x),d(L,1,U,E,x),d(L,2,U,E,x));var G=U.fluidDrag>=0?U.fluidDrag:L.fluidDrag,F=U.Fr>=0?U.Fr:L.Fr,a=F,r=F;U.inFluid&&(a=v(U,a,U.fluidDragHoriz>=0?U.fluidDragHoriz:G),r=v(U,r,U.fluidDragVert>=0?U.fluidDragVert:G));a=Math.max(1-a*x/U.zp,0),r=Math.max(1-r*x/U.zp,0),o.set(D,a,r,a),o.multiply(U.HA,U.HA,D),o.scale(Y,U.HA,x),o.set(U._forces,0,0,0),o.set(U._impulses,0,0,0),U.MF&&M(i,U.RA);o.k(H,Y),o.set(Q,0,0,0),U.preventFallOffEdge&&function(L,U,x,mL){if(!U.resting[1]||x[1]>0)return;var p=e;M(p,U.RA);for(var G=0;G<3;G+=2){o.set(N,0,0,0),N[G]=x[G];var F=!0;(F=(F=(F=(F=F&&!Z(L,p.base[0]+N[0]+1e-5,p.base[1],p.base[2]+N[2]+1e-5))&&!Z(L,p.max[0]+N[0]-1e-5,p.base[1],p.base[2]+N[2]+1e-5))&&!Z(L,p.base[0]+N[0]+1e-5,p.base[1],p.max[2]+N[2]-1e-5))&&!Z(L,p.max[0]+N[0]-1e-5,p.base[1],p.max[2]+N[2]-1e-5))?(mL[G]=x[G]>0?1:-1,x[G]=0):0===G&&(o.set(u,x[0],0,0),l(L,p,u,mL,U.slideOnCollision))}}(L,U,Y,Q);l(L,U.RA,Y,U.resting,U.slideOnCollision),U.MF&&function(L,U,x,mL){if(U.resting[1]>=0&&!U.inFluid)return;var p=0!==U.resting[0],G=0!==U.resting[2];if(!p&&!G)return;var F=Math.abs(mL[0]/mL[2]),a=4;if(!p&&F>a)return;if(!G&&F<1/a)return;o.add(t,x.base,mL);var r=L.testSolid;A(r,x,mL,(function(L,U,x,mL){if(1!==U)return!0;mL[U]=0}));var h=x.base[1],b=U.inFluid?1.951:1.001,E=Math.floor(h+b)-h;o.set(y,0,E,0);var Y=!1;if(A(r,x,y,(function(L,U,x,mL){return Y=!0,!0})),Y)return;o.SU(n,t,x.base),n[1]=0,l(L,x,n,X,!0);var S=z(x.base[0],t[0]),V=z(x.base[2],t[2]);if(p&&!S&&(!V||!G))return;if(G&&(!S||!p)&&!V)return;var H=!0;if(H=H&&!Z(L,x.base[0]+1e-5,x.base[1],x.base[2]+1e-5),H=H&&!Z(L,x.max[0]-1e-5,x.base[1],x.base[2]+1e-5),H=H&&!Z(L,x.base[0]+1e-5,x.base[1],x.max[2]-1e-5),H=H&&!Z(L,x.max[0]-1e-5,x.base[1],x.max[2]-1e-5),H)return;M(U.RA,x),U.resting[0]=X[0],U.resting[2]=X[2],U.PS&&U.PS()}(L,U,i,H);for(var h=0;h<3;++h)U.resting[h]=U.resting[h]||Q[h],S[h]=0,U.resting[h]&&(V[h]||(S[h]=-U.HA[h]),U.HA[h]=0);var q=o.length(S);q>.001&&(o.scale(S,S,U.zp),U.gY&&U.gY(S),U.restitution>0&&q>L.minBounceImpulse&&(o.scale(S,S,U.restitution),U.applyImpulse(S)));var K=o.squaredLength(U.HA);K>1e-5&&U.fA();L.GY&&L.GY(U)?(U.loadFromCopy(f),U.rolledBackLastTick=!0):U.rolledBackLastTick=!1}(this,x,L,U)))};var D=o.create([0,0,0]);var P=o.create();function d(L,U,x,mL,p){var G=x.resting[U],F=mL[U];if(!x.alwaysApplyHorizFriction||1!==U){if(0===G)return;if(G*F<=0)return}o.k(K,x.HA),K[U]=0;var a=o.length(K);if(!z(a,0)){var A=Math.abs(x.friction*L.gravity[U]*p),r=a>A?(a-A)/a:0;x.HA[(U+1)%3]*=r,x.HA[(U+2)%3]*=r}}var K=o.create();function l(L,U,x,mL,p){return o.set(mL,0,0,0),A(L.testSolid,U,x,(function(L,U,x,G){mL[U]=x,G[U]=0,p||(G[0]=0,G[1]=0,G[2]=0)}))}var i=new a([],[]),X=o.create(),t=o.create(),y=o.create(),n=o.create();var N=o.create(),e=new a([],[]),u=o.create();function Z(L,U,x,mL){return L.testSolid(Math.floor(U),Math.floor(x-1),Math.floor(mL))}var g=o.create();function z(L,U){return Math.abs(L-U)<1e-5}function M(L,U){for(var x=0;x<3;x++)L.base[x]=U.base[x],L.max[x]=U.max[x],L.ar[x]=U.ar[x]}var J=function(L){}},13295:function(L,U){!function(L){"use strict";var U=function(L,x){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,U){L.__proto__=U}||function(L,U){for(var x in U)Object.prototype.hasOwnProperty.call(U,x)&&(L[x]=U[x])},U(L,x)};function x(L,x){if("function"!==typeof x&&null!==x)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function mL(){this.constructor=L}U(L,x),L.prototype=null===x?Object.create(x):(mL.prototype=x.prototype,new mL)}function mL(L,U,x,mL){var p,G=arguments.length,F=G<3?U:null===mL?mL=Object.getOwnPropertyDescriptor(U,x):mL;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)F=Reflect.decorate(L,U,x,mL);else for(var a=L.length-1;a>=0;a--)(p=L[a])&&(F=(G<3?p(F):G>3?p(U,x,F):p(U,x))||F);return G>3&&F&&Object.defineProperty(U,x,F),F}function p(L,U,x){if(x||2===arguments.length)for(var mL,p=0,G=U.length;p<G;p++)!mL&&p in U||(mL||(mL=Array.prototype.slice.call(U,0,p)),mL[p]=U[p]);return L.concat(mL||Array.prototype.slice.call(U))}var G,F=255,a=213;L.OPERATION=void 0,(G=L.OPERATION||(L.OPERATION={}))[G.ADD=128]="ADD",G[G.REPLACE=0]="REPLACE",G[G.DELETE=64]="DELETE",G[G.DELETE_AND_ADD=192]="DELETE_AND_ADD",G[G.TOUCH=1]="TOUCH",G[G.CLEAR=10]="CLEAR";var o=function(){function U(L,U,x){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=L,this.setParent(U,x)}return U.prototype.setParent=function(L,U,x){var mL=this;if(this.indexes||(this.indexes=this.ref instanceof nL?this.ref._definition.indexes:{}),this.parent=L,this.parentIndex=x,U)if(this.root=U,this.ref instanceof nL){var p=this.ref._definition;for(var G in p.schema){var F=this.ref[G];if(F&&F.$changes){var a=p.indexes[G];F.$changes.setParent(this.ref,U,a)}}}else"object"===typeof this.ref&&this.ref.forEach((function(L,U){if(L instanceof nL){var x=L.$changes,p=mL.ref.$changes.indexes[U];x.setParent(mL.ref,mL.root,p)}}))},U.prototype.operation=function(L){this.changes.set(--this.currentCustomOperation,L)},U.prototype.change=function(U,x){void 0===x&&(x=L.OPERATION.ADD);var mL="number"===typeof U?U:this.indexes[U];this.assertValidIndex(mL,U);var p=this.changes.get(mL);p&&p.op!==L.OPERATION.DELETE&&p.op!==L.OPERATION.TOUCH||this.changes.set(mL,{op:p&&p.op===L.OPERATION.DELETE?L.OPERATION.DELETE_AND_ADD:x,index:mL}),this.allChanges.add(mL),this.changed=!0,this.touchParents()},U.prototype.touch=function(U){var x="number"===typeof U?U:this.indexes[U];this.assertValidIndex(x,U),this.changes.has(x)||this.changes.set(x,{op:L.OPERATION.TOUCH,index:x}),this.allChanges.add(x),this.touchParents()},U.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},U.prototype.getType=function(L){if(this.ref._definition)return(U=this.ref._definition).schema[U.fieldsByIndex[L]];var U,x=(U=this.parent._definition).schema[U.fieldsByIndex[this.parentIndex]];return Object.values(x)[0]},U.prototype.getChildrenFilter=function(){var L=this.parent._definition.childFilters;return L&&L[this.parentIndex]},U.prototype.getValue=function(L){return this.ref.getByIndex(L)},U.prototype.delete=function(U){var x="number"===typeof U?U:this.indexes[U];if(void 0!==x){var mL=this.getValue(x);this.changes.set(x,{op:L.OPERATION.DELETE,index:x}),this.allChanges.delete(x),delete this.caches[x],mL&&mL.$changes&&(mL.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(U," (").concat(x,")"))},U.prototype.discard=function(U,x){var mL=this;void 0===U&&(U=!1),void 0===x&&(x=!1),this.ref instanceof nL||this.changes.forEach((function(U){if(U.op===L.OPERATION.DELETE){var x=mL.ref.getIndex(U.index);delete mL.indexes[x]}})),this.changes.clear(),this.changed=U,x&&this.allChanges.clear(),this.currentCustomOperation=0},U.prototype.discardAll=function(){var L=this;this.changes.forEach((function(U){var x=L.getValue(U.index);x&&x.$changes&&x.$changes.discardAll()})),this.discard()},U.prototype.cache=function(L,U){this.caches[L]=U},U.prototype.clone=function(){return new U(this.ref,this.parent,this.root)},U.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},U.prototype.assertValidIndex=function(L,U){if(void 0===L)throw new Error('ChangeTree: missing index for field "'.concat(U,'"'))},U}();function A(L,U,x,mL){return L[U]||(L[U]=[]),L[U].push(x),null===mL||void 0===mL||mL.forEach((function(L,U){return x(L,U)})),function(){return h(L[U],L[U].indexOf(x))}}function r(U){var x=this,mL="string"!==typeof this.$changes.getType();this.$items.forEach((function(p,G){U.push({refId:x.$changes.refId,op:L.OPERATION.DELETE,field:G,value:void 0,previousValue:p}),mL&&x.$changes.root.removeRef(p.$changes.refId)}))}function h(L,U){if(-1===U||U>=L.length)return!1;for(var x=L.length-1,mL=U;mL<x;mL++)L[mL]=L[mL+1];return L.length=x,!0}var b=function(L,U){var x=L.toString(),mL=U.toString();return x<mL?-1:x>mL?1:0};function E(L){return L.$proxy=!0,L=new Proxy(L,{get:function(L,U){return"symbol"===typeof U||isNaN(U)?L[U]:L.at(U)},set:function(L,U,x){if("symbol"===typeof U||isNaN(U))L[U]=x;else{var mL=Array.from(L.$items.keys()),p=parseInt(mL[U]||U);void 0===x||null===x?L.deleteAt(p):L.setAt(p,x)}return!0},deleteProperty:function(L,U){return"number"===typeof U?L.deleteAt(U):delete L[U],!0}})}var Y=function(){function U(){for(var L=[],U=0;U<arguments.length;U++)L[U]=arguments[U];this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,L)}return U.prototype.Ja=function(U,x){return void 0===x&&(x=!0),A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,U,x?this.$items:void 0)},U.prototype.nx=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,U)},U.is=function(L){return Array.isArray(L)||void 0!==L.array},Object.defineProperty(U.prototype,"length",{get:function(){return this.$items.size},set:function(L){0===L?this.clear():this.splice(L,this.length-L)},enumerable:!1,configurable:!0}),U.prototype.push=function(){for(var L,U=this,x=[],mL=0;mL<arguments.length;mL++)x[mL]=arguments[mL];return x.forEach((function(x){L=U.$refId++,U.setAt(L,x)})),L},U.prototype.pop=function(){var L=Array.from(this.$indexes.values()).pop();if(void 0!==L){this.$changes.delete(L),this.$indexes.delete(L);var U=this.$items.get(L);return this.$items.delete(L),U}},U.prototype.at=function(L){var U=Array.from(this.$items.keys())[L];return this.$items.get(U)},U.prototype.setAt=function(U,x){var mL,p;if(void 0!==x&&null!==x){if(this.$items.get(U)!==x){void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,U);var G=null!==(p=null===(mL=this.$changes.indexes[U])||void 0===mL?void 0:mL.op)&&void 0!==p?p:L.OPERATION.ADD;this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,x),this.$changes.change(U,G)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},U.prototype.deleteAt=function(L){var U=Array.from(this.$items.keys())[L];return void 0!==U&&this.$deleteAt(U)},U.prototype.$deleteAt=function(L){return this.$changes.delete(L),this.$indexes.delete(L),this.$items.delete(L)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&r.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.concat=function(){for(var L,x=[],mL=0;mL<arguments.length;mL++)x[mL]=arguments[mL];return new(U.bind.apply(U,p([void 0],(L=Array.from(this.$items.values())).concat.apply(L,x),!1)))},U.prototype.join=function(L){return Array.from(this.$items.values()).join(L)},U.prototype.reverse=function(){var L=this,U=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(x,mL){L.setAt(U[mL],x)})),this},U.prototype.shift=function(){var L=Array.from(this.$items.keys()).shift();if(void 0!==L){var U=this.$items.get(L);return this.$deleteAt(L),U}},U.prototype.slice=function(L,x){var mL=new U;return mL.push.apply(mL,Array.from(this.$items.values()).slice(L,x)),mL},U.prototype.sort=function(L){var U=this;void 0===L&&(L=b);var x=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(L).forEach((function(L,mL){U.setAt(x[mL],L)})),this},U.prototype.splice=function(L,U){void 0===U&&(U=this.length-L);for(var x=Array.from(this.$items.keys()),mL=[],p=L;p<L+U;p++)mL.push(this.$items.get(x[p])),this.$deleteAt(x[p]);return mL},U.prototype.unshift=function(){for(var L=this,U=[],x=0;x<arguments.length;x++)U[x]=arguments[x];var mL=this.length,p=U.length,G=Array.from(this.$items.values());return U.forEach((function(U,x){L.setAt(x,U)})),G.forEach((function(U,x){L.setAt(p+x,U)})),mL+p},U.prototype.indexOf=function(L,U){return Array.from(this.$items.values()).indexOf(L,U)},U.prototype.lastIndexOf=function(L,U){return void 0===U&&(U=this.length-1),Array.from(this.$items.values()).lastIndexOf(L,U)},U.prototype.every=function(L,U){return Array.from(this.$items.values()).every(L,U)},U.prototype.some=function(L,U){return Array.from(this.$items.values()).some(L,U)},U.prototype.forEach=function(L,U){Array.from(this.$items.values()).forEach(L,U)},U.prototype.map=function(L,U){return Array.from(this.$items.values()).map(L,U)},U.prototype.filter=function(L,U){return Array.from(this.$items.values()).filter(L,U)},U.prototype.reduce=function(L,U){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},U.prototype.reduceRight=function(L,U){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},U.prototype.find=function(L,U){return Array.from(this.$items.values()).find(L,U)},U.prototype.findIndex=function(L,U){return Array.from(this.$items.values()).findIndex(L,U)},U.prototype.fill=function(L,U,x){throw new Error("ArraySchema#fill() not implemented")},U.prototype.copyWithin=function(L,U,x){throw new Error("ArraySchema#copyWithin() not implemented")},U.prototype.toString=function(){return this.$items.toString()},U.prototype.toLocaleString=function(){return this.$items.toLocaleString()},U.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},U.prototype.includes=function(L,U){return Array.from(this.$items.values()).includes(L,U)},U.prototype.flatMap=function(L,U){throw new Error("ArraySchema#flatMap() is not supported.")},U.prototype.flat=function(L){throw new Error("ArraySchema#flat() is not supported.")},U.prototype.findLast=function(){var L=Array.from(this.$items.values());return L.findLast.apply(L,arguments)},U.prototype.findLastIndex=function(){var L=Array.from(this.$items.values());return L.findLastIndex.apply(L,arguments)},U.prototype.setIndex=function(L,U){this.$indexes.set(L,U)},U.prototype.getIndex=function(L){return this.$indexes.get(L)},U.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},U.prototype.deleteByIndex=function(L){var U=this.$indexes.get(L);this.$items.delete(U),this.$indexes.delete(L)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){return this.toArray().map((function(L){return"function"===typeof L.toJSON?L.toJSON():L}))},U.prototype.clone=function(L){return L?new(U.bind.apply(U,p([void 0],Array.from(this.$items.values()),!1))):new(U.bind.apply(U,p([void 0],this.map((function(L){return L.$changes?L.clone():L})),!1)))},U}();function S(L){return L.$proxy=!0,L=new Proxy(L,{get:function(L,U){return"symbol"!==typeof U&&"undefined"===typeof L[U]?L.get(U):L[U]},set:function(L,U,x){return"symbol"!==typeof U&&-1===U.indexOf("$")&&"Ja"!==U&&"nx"!==U&&"onChange"!==U?L.set(U,x):L[U]=x,!0},deleteProperty:function(L,U){return L.delete(U),!0}})}var V=function(){function U(L){var x=this;if(this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L)if(L instanceof Map||L instanceof U)L.forEach((function(L,U){return x.set(U,L)}));else for(var mL in L)this.set(mL,L[mL])}return U.prototype.Ja=function(U,x){return void 0===x&&(x=!0),A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,U,x?this.$items:void 0)},U.prototype.nx=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,U)},U.is=function(L){return void 0!==L.map},U.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(U.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.set=function(U,x){if(void 0===x||null===x)throw new Error("MapSchema#set('".concat(U,"', ").concat(x,"): trying to set ").concat(x," value on '").concat(U,"'."));U=U.toString();var mL="undefined"!==typeof this.$changes.indexes[U],p=mL?this.$changes.indexes[U]:this.$refId++,G=mL?L.OPERATION.REPLACE:L.OPERATION.ADD,F=void 0!==x.$changes;if(F&&x.$changes.setParent(this,this.$changes.root,p),mL){if(!F&&this.$items.get(U)===x)return;F&&this.$items.get(U)!==x&&(G=L.OPERATION.ADD)}else this.$changes.indexes[U]=p,this.$indexes.set(p,U);return this.$items.set(U,x),this.$changes.change(U,G),this},U.prototype.get=function(L){return this.$items.get(L)},U.prototype.delete=function(L){return this.$changes.delete(L),this.$items.delete(L)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&r.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(L){return this.$items.has(L)},U.prototype.forEach=function(L){this.$items.forEach(L)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(L,U){this.$indexes.set(L,U)},U.prototype.getIndex=function(L){return this.$indexes.get(L)},U.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},U.prototype.deleteByIndex=function(L){var U=this.$indexes.get(L);this.$items.delete(U),this.$indexes.delete(L)},U.prototype.toJSON=function(){var L={};return this.forEach((function(U,x){L[x]="function"===typeof U.toJSON?U.toJSON():U})),L},U.prototype.clone=function(L){var x;return L?x=Object.assign(new U,this):(x=new U,this.forEach((function(L,U){L.$changes?x.set(U,L.clone()):x.set(U,L)}))),x},U}(),H={};function Q(L,U){H[L]=U}function q(L){return H[L]}var f=function(){function L(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return L.create=function(U){var x=new L;return x.schema=Object.assign({},U&&U.schema||{}),x.indexes=Object.assign({},U&&U.indexes||{}),x.fieldsByIndex=Object.assign({},U&&U.fieldsByIndex||{}),x.descriptors=Object.assign({},U&&U.descriptors||{}),x.deprecated=Object.assign({},U&&U.deprecated||{}),x},L.prototype.addField=function(L,U){var x=this.getNextFieldIndex();this.fieldsByIndex[x]=L,this.indexes[L]=x,this.schema[L]=Array.isArray(U)?{array:U[0]}:U},L.prototype.hasField=function(L){return void 0!==this.indexes[L]},L.prototype.addFilter=function(L,U){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[L]]=U,this.indexesWithFilters.push(this.indexes[L]),!0},L.prototype.addChildrenFilter=function(L,U){var x=this.indexes[L],mL=this.schema[L];if(q(Object.keys(mL)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[x]=U,!0;console.warn("@filterChildren: field '".concat(L,"' can't have children. Ignoring filter."))},L.prototype.getChildrenFilter=function(L){return this.childFilters&&this.childFilters[this.indexes[L]]},L.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},L}();function v(L){return L._context&&L._context.useFilters}var D=function(){function L(){this.types={},this.schemas=new Map,this.useFilters=!1}return L.prototype.has=function(L){return this.schemas.has(L)},L.prototype.get=function(L){return this.types[L]},L.prototype.add=function(L,U){void 0===U&&(U=this.schemas.size),L._definition=f.create(L._definition),L._typeid=U,this.types[U]=L,this.schemas.set(L,U)},L.create=function(U){return void 0===U&&(U={}),function(x){return U.context||(U.context=new L),d(x,U)}},L}(),P=new D;function d(L,U){return void 0===U&&(U={}),function(x,mL){var G=U.context||P,F=x.constructor;if(F._context=G,!L)throw new Error("".concat(F.name,': @type() reference provided for "').concat(mL,"\" is undefined. Make sure you don't have any circular dependencies."));G.has(F)||G.add(F);var a=F._definition;if(a.addField(mL,L),a.descriptors[mL]){if(a.deprecated[mL])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(mL,"' definition on '").concat(F.name,"'.\nCheck @type() annotation"))}catch(H){var o=H.stack.split("\n")[4].trim();throw new Error("".concat(H.message," ").concat(o))}}var A=Y.is(L),r=!A&&V.is(L);if("string"!==typeof L&&!nL.is(L)){var h=Object.values(L)[0];"string"===typeof h||G.has(h)||G.add(h)}if(U.manual)a.descriptors[mL]={enumerable:!0,configurable:!0,writable:!0};else{var b="_".concat(mL);a.descriptors[b]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[mL]={get:function(){return this[b]},set:function(L){L!==this[b]&&(void 0!==L&&null!==L?(!A||L instanceof Y||(L=new(Y.bind.apply(Y,p([void 0],L,!1)))),!r||L instanceof V||(L=new V(L)),void 0===L.$proxy&&(r?L=S(L):A&&(L=E(L))),this.$changes.change(mL),L.$changes&&L.$changes.setParent(this,this.$changes.root,this._definition.indexes[mL])):this[b]&&this.$changes.delete(mL),this[b]=L)},enumerable:!0,configurable:!0}}}}function K(L){return function(U,x){var mL=U.constructor;mL._definition.addFilter(x,L)&&(mL._context.useFilters=!0)}}function l(L){return function(U,x){var mL=U.constructor;mL._definition.addChildrenFilter(x,L)&&(mL._context.useFilters=!0)}}function i(L){return void 0===L&&(L=!0),function(U,x){var mL=U.constructor._definition;mL.deprecated[x]=!0,L&&(mL.descriptors[x]={get:function(){throw new Error("".concat(x," is deprecated."))},set:function(L){},enumerable:!1,configurable:!0})}}function X(L,U,x){for(var mL in void 0===x&&(x={}),x.context||(x.context=L._context||x.context||P),U)d(U[mL],x)(L.prototype,mL);return L}function t(L){for(var U=0,x=0,mL=0,p=L.length;mL<p;mL++)(U=L.charCodeAt(mL))<128?x+=1:U<2048?x+=2:U<55296||U>=57344?x+=3:(mL++,x+=4);return x}function y(L,U,x){for(var mL=0,p=0,G=x.length;p<G;p++)(mL=x.charCodeAt(p))<128?L[U++]=mL:mL<2048?(L[U++]=192|mL>>6,L[U++]=128|63&mL):mL<55296||mL>=57344?(L[U++]=224|mL>>12,L[U++]=128|mL>>6&63,L[U++]=128|63&mL):(p++,mL=65536+((1023&mL)<<10|1023&x.charCodeAt(p)),L[U++]=240|mL>>18,L[U++]=128|mL>>12&63,L[U++]=128|mL>>6&63,L[U++]=128|63&mL)}function n(L,U){L.push(255&U)}function N(L,U){L.push(255&U)}function e(L,U){L.push(255&U),L.push(U>>8&255)}function u(L,U){L.push(255&U),L.push(U>>8&255)}function Z(L,U){L.push(255&U),L.push(U>>8&255),L.push(U>>16&255),L.push(U>>24&255)}function g(L,U){var x=U>>24,mL=U>>16,p=U>>8,G=U;L.push(255&G),L.push(255&p),L.push(255&mL),L.push(255&x)}function z(L,U){var x=Math.floor(U/Math.pow(2,32));g(L,U>>>0),g(L,x)}function M(L,U){var x=U/Math.pow(2,32)|0;g(L,U>>>0),g(L,x)}function J(L,U){I(L,U)}function j(L,U){w(L,U)}var R=new Int32Array(2),c=new Float32Array(R.buffer),W=new Float64Array(R.buffer);function I(L,U){c[0]=U,Z(L,R[0])}function w(L,U){W[0]=U,Z(L,R[0]),Z(L,R[1])}function B(L,U){return N(L,U?1:0)}function s(L,U){U||(U="");var x=t(U),mL=0;if(x<32)L.push(160|x),mL=1;else if(x<256)L.push(217),N(L,x),mL=2;else if(x<65536)L.push(218),u(L,x),mL=3;else{if(!(x<4294967296))throw new Error("String too long");L.push(219),g(L,x),mL=5}return y(L,L.length,U),mL+x}function C(L,U){return isNaN(U)?C(L,0):isFinite(U)?U!==(0|U)?(L.push(203),w(L,U),9):U>=0?U<128?(N(L,U),1):U<256?(L.push(204),N(L,U),2):U<65536?(L.push(205),u(L,U),3):U<4294967296?(L.push(206),g(L,U),5):(L.push(207),M(L,U),9):U>=-32?(L.push(224|U+32),1):U>=-128?(L.push(208),n(L,U),2):U>=-32768?(L.push(209),e(L,U),3):U>=-2147483648?(L.push(210),Z(L,U),5):(L.push(211),z(L,U),9):C(L,U>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var k=Object.freeze({__proto__:null,utf8Write:y,int8:n,uint8:N,int16:e,uint16:u,int32:Z,uint32:g,int64:z,uint64:M,float32:J,float64:j,writeFloat32:I,writeFloat64:w,boolean:B,string:s,number:C});function T(L,U,x){for(var mL="",p=0,G=U,F=U+x;G<F;G++){var a=L[G];0!==(128&a)?192!==(224&a)?224!==(240&a)?240!==(248&a)?console.error("Invalid byte "+a.toString(16)):(p=(7&a)<<18|(63&L[++G])<<12|(63&L[++G])<<6|63&L[++G])>=65536?(p-=65536,mL+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):mL+=String.fromCharCode(p):mL+=String.fromCharCode((15&a)<<12|(63&L[++G])<<6|63&L[++G]):mL+=String.fromCharCode((31&a)<<6|63&L[++G]):mL+=String.fromCharCode(a)}return mL}function O(L,U){return LL(L,U)<<24>>24}function LL(L,U){return L[U.offset++]}function UL(L,U){return xL(L,U)<<16>>16}function xL(L,U){return L[U.offset++]|L[U.offset++]<<8}function mU(L,U){return L[U.offset++]|L[U.offset++]<<8|L[U.offset++]<<16|L[U.offset++]<<24}function pL(L,U){return mU(L,U)>>>0}function GL(L,U){return bL(L,U)}function FL(L,U){return EL(L,U)}function aL(L,U){var x=pL(L,U);return mU(L,U)*Math.pow(2,32)+x}function oL(L,U){var x=pL(L,U);return pL(L,U)*Math.pow(2,32)+x}var AL=new Int32Array(2),rL=new Float32Array(AL.buffer),hL=new Float64Array(AL.buffer);function bL(L,U){return AL[0]=mU(L,U),rL[0]}function EL(L,U){return AL[0]=mU(L,U),AL[1]=mU(L,U),hL[0]}function YL(L,U){return LL(L,U)>0}function SL(L,U){var x,mL=L[U.offset++];mL<192?x=31&mL:217===mL?x=LL(L,U):218===mL?x=xL(L,U):219===mL&&(x=pL(L,U));var p=T(L,U.offset,x);return U.offset+=x,p}function VL(L,U){var x=L[U.offset];return x<192&&x>160||217===x||218===x||219===x}function HL(L,U){var x=L[U.offset++];return x<128?x:202===x?bL(L,U):203===x?EL(L,U):204===x?LL(L,U):205===x?xL(L,U):206===x?pL(L,U):207===x?oL(L,U):208===x?O(L,U):209===x?UL(L,U):210===x?mU(L,U):211===x?aL(L,U):x>223?-1*(255-x+1):void 0}function QL(L,U){var x=L[U.offset];return x<128||x>=202&&x<=211}function qL(L,U){return L[U.offset]<160}function fL(L,U){return L[U.offset-1]===F&&(L[U.offset]<128||L[U.offset]>=202&&L[U.offset]<=211)}var vL=Object.freeze({__proto__:null,int8:O,uint8:LL,int16:UL,uint16:xL,int32:mU,uint32:pL,float32:GL,float64:FL,int64:aL,uint64:oL,readFloat32:bL,readFloat64:EL,boolean:YL,string:SL,stringCheck:VL,number:HL,numberCheck:QL,arrayCheck:qL,switchStructureCheck:fL}),DL=function(){function U(L){var U=this;this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L&&L.forEach((function(L){return U.add(L)}))}return U.prototype.Ja=function(U,x){return void 0===x&&(x=!0),A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,U,x?this.$items:void 0)},U.prototype.nx=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,U)},U.is=function(L){return void 0!==L.collection},U.prototype.add=function(L){var U=this.$refId++;return void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,U),this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,L),this.$changes.change(U),U},U.prototype.at=function(L){var U=Array.from(this.$items.keys())[L];return this.$items.get(U)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(L){for(var U,x,mL=this.$items.entries();(x=mL.next())&&!x.done;)if(L===x.value[1]){U=x.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&r.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(L){return Array.from(this.$items.values()).some((function(U){return U===L}))},U.prototype.forEach=function(L){var U=this;this.$items.forEach((function(x,mL,p){return L(x,mL,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(L,U){this.$indexes.set(L,U)},U.prototype.getIndex=function(L){return this.$indexes.get(L)},U.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},U.prototype.deleteByIndex=function(L){var U=this.$indexes.get(L);this.$items.delete(U),this.$indexes.delete(L)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var L=[];return this.forEach((function(U,x){L.push("function"===typeof U.toJSON?U.toJSON():U)})),L},U.prototype.clone=function(L){var x;return L?x=Object.assign(new U,this):(x=new U,this.forEach((function(L){L.$changes?x.add(L.clone()):x.add(L)}))),x},U}(),PL=function(){function U(L){var U=this;this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L&&L.forEach((function(L){return U.add(L)}))}return U.prototype.Ja=function(U,x){return void 0===x&&(x=!0),A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,U,x?this.$items:void 0)},U.prototype.nx=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,U)},U.is=function(L){return void 0!==L.set},U.prototype.add=function(U){var x,mL;if(this.has(U))return!1;var p=this.$refId++;void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,p);var G=null!==(mL=null===(x=this.$changes.indexes[p])||void 0===x?void 0:x.op)&&void 0!==mL?mL:L.OPERATION.ADD;return this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,U),this.$changes.change(p,G),p},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(L){for(var U,x,mL=this.$items.entries();(x=mL.next())&&!x.done;)if(L===x.value[1]){U=x.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&r.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(L){for(var U,x=this.$items.values(),mL=!1;(U=x.next())&&!U.done;)if(L===U.value){mL=!0;break}return mL},U.prototype.forEach=function(L){var U=this;this.$items.forEach((function(x,mL,p){return L(x,mL,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(L,U){this.$indexes.set(L,U)},U.prototype.getIndex=function(L){return this.$indexes.get(L)},U.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},U.prototype.deleteByIndex=function(L){var U=this.$indexes.get(L);this.$items.delete(U),this.$indexes.delete(L)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var L=[];return this.forEach((function(U,x){L.push("function"===typeof U.toJSON?U.toJSON():U)})),L},U.prototype.clone=function(L){var x;return L?x=Object.assign(new U,this):(x=new U,this.forEach((function(L){L.$changes?x.add(L.clone()):x.add(L)}))),x},U}(),dL=function(){function L(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return L.prototype.addRefId=function(L){this.refIds.has(L)||(this.refIds.add(L),this.containerIndexes.set(L,new Set))},L.get=function(U){return void 0===U.$filterState&&(U.$filterState=new L),U.$filterState},L}(),KL=function(){function L(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return L.prototype.getNextUniqueId=function(){return this.nextUniqueId++},L.prototype.addRef=function(L,U,x){void 0===x&&(x=!0),this.refs.set(L,U),x&&(this.refCounts[L]=(this.refCounts[L]||0)+1)},L.prototype.removeRef=function(L){this.refCounts[L]=this.refCounts[L]-1,this.deletedRefs.add(L)},L.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},L.prototype.garbageCollectDeletedRefs=function(){var L=this;this.deletedRefs.forEach((function(U){if(!(L.refCounts[U]>0)){var x=L.refs.get(U);if(x instanceof nL)for(var mL in x._definition.schema)"string"!==typeof x._definition.schema[mL]&&x[mL]&&x[mL].$changes&&L.removeRef(x[mL].$changes.refId);else{var p=x.$changes.parent._definition,G=p.schema[p.fieldsByIndex[x.$changes.parentIndex]];"function"===typeof Object.values(G)[0]&&Array.from(x.values()).forEach((function(U){return L.removeRef(U.$changes.refId)}))}L.refs.delete(U),delete L.refCounts[U]}})),this.deletedRefs.clear()},L}(),lL=function(L){function U(){return null!==L&&L.apply(this,arguments)||this}return x(U,L),U}(Error);function iL(L,U,x,mL){var p,G=!1;switch(U){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":p="number",isNaN(L)&&console.log('trying to encode "NaN" in '.concat(x.constructor.name,"#").concat(mL));break;case"string":p="string",G=!0;break;case"boolean":return}if(typeof L!==p&&(!G||G&&null!==L)){var F="'".concat(JSON.stringify(L),"'").concat(L&&L.constructor&&" (".concat(L.constructor.name,")")||"");throw new lL("a '".concat(p,"' was expected, but ").concat(F," was provided in ").concat(x.constructor.name,"#").concat(mL))}}function XL(L,U,x,mL){if(!(L instanceof U))throw new lL("a '".concat(U.name,"' was expected, but '").concat(L.constructor.name,"' was provided in ").concat(x.constructor.name,"#").concat(mL))}function tL(L,U,x,mL,p){iL(x,L,mL,p);var G=k[L];if(!G)throw new lL("a '".concat(L,"' was expected, but ").concat(x," was provided in ").concat(mL.constructor.name,"#").concat(p));G(U,x)}function yL(L,U,x){return vL[L](U,x)}var nL=function(){function U(){for(var L=[],U=0;U<arguments.length;U++)L[U]=arguments[U];Object.defineProperties(this,{$changes:{value:new o(this,void 0,new KL),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var x=this._definition.descriptors;x&&Object.defineProperties(this,x),L[0]&&this.assign(L[0])}return U.onError=function(L){console.error(L)},U.is=function(L){return L._definition&&void 0!==L._definition.schema},U.prototype.onChange=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,U)},U.prototype.nx=function(U){return A(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,U)},U.prototype.assign=function(L){return Object.assign(this,L),this},Object.defineProperty(U.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),U.prototype.setDirty=function(L,U){this.$changes.change(L,U)},U.prototype.listen=function(L,U,x){var mL=this;return void 0===x&&(x=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[L]||(this.$callbacks[L]=[]),this.$callbacks[L].push(U),x&&void 0!==this[L]&&U(this[L],void 0),function(){return h(mL.$callbacks[L],mL.$callbacks[L].indexOf(U))}},U.prototype.decode=function(x,mL,p){var G;void 0===mL&&(mL={offset:0}),void 0===p&&(p=this);var a=[],o=this.$changes.root,A=x.length,r=0;for(o.refs.set(r,this);mL.offset<A;){var h=x[mL.offset++];if(h!=F){var b=p.$changes,E=void 0!==p._definition,S=E?h>>6<<6:h;if(S!==L.OPERATION.CLEAR){var H=E?h%(S||255):HL(x,mL),Q=E?p._definition.fieldsByIndex[H]:"",f=b.getType(H),v=void 0,D=void 0,P=void 0;if(E?D=p["_".concat(Q)]:(D=p.getByIndex(H),(S&L.OPERATION.ADD)===L.OPERATION.ADD?(P=p instanceof V?SL(x,mL):H,p.setIndex(H,P)):P=p.getIndex(H)),(S&L.OPERATION.DELETE)===L.OPERATION.DELETE&&(S!==L.OPERATION.DELETE_AND_ADD&&p.deleteByIndex(H),D&&D.$changes&&o.removeRef(D.$changes.refId),v=null),void 0!==Q){if(S===L.OPERATION.DELETE);else if(U.is(f)){var d=HL(x,mL);if(v=o.refs.get(d),S!==L.OPERATION.REPLACE){var K=this.getSchemaType(x,mL,f);v||((v=this.createTypeInstance(K)).$changes.refId=d,D&&(v.$callbacks=D.$callbacks,D.$changes.refId&&d!==D.$changes.refId&&o.removeRef(D.$changes.refId))),o.addRef(d,v,v!==D)}}else if("string"===typeof f)v=yL(f,x,mL);else{var l=q(Object.keys(f)[0]),i=HL(x,mL),X=o.refs.has(i)?D||o.refs.get(i):new l.constructor;if((v=X.clone(!0)).$changes.refId=i,D&&(v.$callbacks=D.$callbacks,D.$changes.refId&&i!==D.$changes.refId)){o.removeRef(D.$changes.refId);for(var t=D.entries(),y=void 0;(y=t.next())&&!y.done;){var n=(G=y.value)[0],N=G[1];a.push({refId:i,op:L.OPERATION.DELETE,field:n,value:void 0,previousValue:N})}}o.addRef(i,v,X!==D)}if(null!==v&&void 0!==v)if(v.$changes&&v.$changes.setParent(b.ref,b.root,H),p instanceof U)p[Q]=v;else if(p instanceof V)n=P,p.$items.set(n,v),p.$changes.allChanges.add(H);else if(p instanceof Y)p.setAt(H,v);else if(p instanceof DL){var e=p.add(v);p.setIndex(H,e)}else p instanceof PL&&!1!==(e=p.add(v))&&p.setIndex(H,e);D!==v&&a.push({refId:r,op:S,field:Q,dynamicIndex:P,value:v,previousValue:D})}else{console.warn("@colyseus/schema: definition mismatch");for(var u={offset:mL.offset};mL.offset<A&&(!fL(x,mL)||(u.offset=mL.offset+1,!o.refs.has(HL(x,u))));)mL.offset++}}else p.clear(a)}else{r=HL(x,mL);var Z=o.refs.get(r);if(!Z)throw new Error('"refId" not found: '.concat(r));p=Z}}return this._triggerChanges(a),o.garbageCollectDeletedRefs(),a},U.prototype.encode=function(x,mL,p){void 0===x&&(x=!1),void 0===mL&&(mL=[]),void 0===p&&(p=!1);for(var G=this.$changes,a=new WeakSet,o=[G],A=1,r=0;r<A;r++){var h=o[r],b=h.ref,E=b instanceof U;h.ensureRefId(),a.add(h),h!==G&&(h.changed||x)&&(N(mL,F),C(mL,h.refId));for(var Y=x?Array.from(h.allChanges):Array.from(h.changes.values()),S=0,H=Y.length;S<H;S++){var Q=x?{op:L.OPERATION.ADD,index:Y[S]}:Y[S],f=Q.index,v=E?b._definition.fieldsByIndex&&b._definition.fieldsByIndex[f]:f,D=mL.length;if(Q.op!==L.OPERATION.TOUCH)if(E)N(mL,f|Q.op);else{if(N(mL,Q.op),Q.op===L.OPERATION.CLEAR)continue;C(mL,f)}if(E||(Q.op&L.OPERATION.ADD)!=L.OPERATION.ADD||b instanceof V&&s(mL,h.ref.$indexes.get(f)),Q.op!==L.OPERATION.DELETE){var P=h.getType(f),d=h.getValue(f);if(d&&d.$changes&&!a.has(d.$changes)&&(o.push(d.$changes),d.$changes.ensureRefId(),A++),Q.op!==L.OPERATION.TOUCH){if(U.is(P))XL(d,P,b,v),C(mL,d.$changes.refId),(Q.op&L.OPERATION.ADD)===L.OPERATION.ADD&&this.tryEncodeTypeId(mL,P,d.constructor);else if("string"===typeof P)tL(P,mL,d,b,v);else{var K=q(Object.keys(P)[0]);XL(b["_".concat(v)],K.constructor,b,v),C(mL,d.$changes.refId)}p&&h.cache(f,mL.slice(D))}}}x||p||h.discard()}return mL},U.prototype.encodeAll=function(L){return this.encode(!0,[],L)},U.prototype.applyFilters=function(x,mL){var p,G;void 0===mL&&(mL=!1);for(var a=this,o=new Set,A=dL.get(x),r=[this.$changes],h=1,b=[],E=function(E){var Y=r[E];if(o.has(Y.refId))return"continue";var S=Y.ref,H=S instanceof U;N(b,F),C(b,Y.refId);var Q=A.refIds.has(Y),q=mL||!Q;A.addRefId(Y);var f=A.containerIndexes.get(Y),v=q?Array.from(Y.allChanges):Array.from(Y.changes.values());!mL&&H&&S._definition.indexesWithFilters&&S._definition.indexesWithFilters.forEach((function(U){!f.has(U)&&Y.allChanges.has(U)&&(q?v.push(U):v.push({op:L.OPERATION.ADD,index:U}))}));for(var D=0,P=v.length;D<P;D++){var d=q?{op:L.OPERATION.ADD,index:v[D]}:v[D];if(d.op!==L.OPERATION.CLEAR){var K=d.index;if(d.op!==L.OPERATION.DELETE){var l=Y.getValue(K),i=Y.getType(K);if(H){if((X=S._definition.filters&&S._definition.filters[K])&&!X.call(S,x,l,a)){l&&l.$changes&&o.add(l.$changes.refId);continue}}else{var X,t=Y.parent;if((X=Y.getChildrenFilter())&&!X.call(t,x,S.$indexes.get(K),l,a)){l&&l.$changes&&o.add(l.$changes.refId);continue}}if(l.$changes&&(r.push(l.$changes),h++),d.op!==L.OPERATION.TOUCH)if(d.op===L.OPERATION.ADD||H)b.push.apply(b,null!==(p=Y.caches[K])&&void 0!==p?p:[]),f.add(K);else if(f.has(K))b.push.apply(b,null!==(G=Y.caches[K])&&void 0!==G?G:[]);else{if(f.add(K),N(b,L.OPERATION.ADD),C(b,K),S instanceof V){var y=Y.ref.$indexes.get(K);s(b,y)}l.$changes?C(b,l.$changes.refId):k[i](b,l)}else l.$changes&&!H&&(N(b,L.OPERATION.ADD),C(b,K),S instanceof V&&(y=Y.ref.$indexes.get(K),s(b,y)),C(b,l.$changes.refId))}else H?N(b,d.op|K):(N(b,d.op),C(b,K))}else N(b,d.op)}},Y=0;Y<h;Y++)E(Y);return b},U.prototype.clone=function(){var L,U=new this.constructor,x=this._definition.schema;for(var mL in x)"object"===typeof this[mL]&&"function"===typeof(null===(L=this[mL])||void 0===L?void 0:L.clone)?U[mL]=this[mL].clone():U[mL]=this[mL];return U},U.prototype.toJSON=function(){var L=this._definition.schema,U=this._definition.deprecated,x={};for(var mL in L)U[mL]||null===this[mL]||"undefined"===typeof this[mL]||(x[mL]="function"===typeof this[mL].toJSON?this[mL].toJSON():this["_".concat(mL)]);return x},U.prototype.discardAllChanges=function(){this.$changes.discardAll()},U.prototype.getByIndex=function(L){return this[this._definition.fieldsByIndex[L]]},U.prototype.deleteByIndex=function(L){this[this._definition.fieldsByIndex[L]]=void 0},U.prototype.tryEncodeTypeId=function(L,U,x){U._typeid!==x._typeid&&(N(L,a),C(L,x._typeid))},U.prototype.getSchemaType=function(L,U,x){var mL;return L[U.offset]===a&&(U.offset++,mL=this.constructor._context.get(HL(L,U))),mL||x},U.prototype.createTypeInstance=function(L){var U=new L;return U.$changes.root=this.$changes.root,U},U.prototype._triggerChanges=function(x){for(var mL,p,G,F,a,o,A,r,h,b=new Set,E=this.$changes.root.refs,Y=function(Y){var S=x[Y],V=S.refId,H=E.get(V),Q=H.$callbacks;if((S.op&L.OPERATION.DELETE)===L.OPERATION.DELETE&&S.previousValue instanceof U&&(null===(p=null===(mL=S.previousValue.$callbacks)||void 0===mL?void 0:mL[L.OPERATION.DELETE])||void 0===p||p.forEach((function(L){return L()}))),!Q)return"continue";if(H instanceof U){if(!b.has(V))try{null===(G=null===Q||void 0===Q?void 0:Q[L.OPERATION.REPLACE])||void 0===G||G.forEach((function(L){return L()}))}catch(q){U.onError(q)}try{Q.hasOwnProperty(S.field)&&(null===(F=Q[S.field])||void 0===F||F.forEach((function(L){return L(S.value,S.previousValue)})))}catch(q){U.onError(q)}}else S.op===L.OPERATION.ADD&&void 0===S.previousValue?null===(a=Q[L.OPERATION.ADD])||void 0===a||a.forEach((function(L){var U;return L(S.value,null!==(U=S.dynamicIndex)&&void 0!==U?U:S.field)})):S.op===L.OPERATION.DELETE?void 0!==S.previousValue&&(null===(o=Q[L.OPERATION.DELETE])||void 0===o||o.forEach((function(L){var U;return L(S.previousValue,null!==(U=S.dynamicIndex)&&void 0!==U?U:S.field)}))):S.op===L.OPERATION.DELETE_AND_ADD&&(void 0!==S.previousValue&&(null===(A=Q[L.OPERATION.DELETE])||void 0===A||A.forEach((function(L){var U;return L(S.previousValue,null!==(U=S.dynamicIndex)&&void 0!==U?U:S.field)}))),null===(r=Q[L.OPERATION.ADD])||void 0===r||r.forEach((function(L){var U;return L(S.value,null!==(U=S.dynamicIndex)&&void 0!==U?U:S.field)}))),S.value!==S.previousValue&&(null===(h=Q[L.OPERATION.REPLACE])||void 0===h||h.forEach((function(L){var U;return L(S.value,null!==(U=S.dynamicIndex)&&void 0!==U?U:S.field)})));b.add(V)},S=0;S<x.length;S++)Y(S)},U._definition=f.create(),U}();function NL(L){for(var U=[L.$changes],x=1,mL={},p=mL,G=function(L){var x=U[L];x.changes.forEach((function(L){var U=x.ref,mL=L.index,G=U._definition?U._definition.fieldsByIndex[mL]:U.$indexes.get(mL);p[G]=x.getValue(mL)}))},F=0;F<x;F++)G(F);return mL}var eL={context:new D},uL=function(L){function U(){return null!==L&&L.apply(this,arguments)||this}return x(U,L),mL([d("string",eL)],U.prototype,"name",void 0),mL([d("string",eL)],U.prototype,"type",void 0),mL([d("number",eL)],U.prototype,"referencedType",void 0),U}(nL),ZL=function(L){function U(){var U=null!==L&&L.apply(this,arguments)||this;return U.fields=new Y,U}return x(U,L),mL([d("number",eL)],U.prototype,"id",void 0),mL([d([uL],eL)],U.prototype,"fields",void 0),U}(nL),gL=function(L){function U(){var U=null!==L&&L.apply(this,arguments)||this;return U.types=new Y,U}return x(U,L),U.encode=function(L){var x=L.constructor,mL=new U;mL.rootType=x._typeid;var p=function(L,U){for(var x in U){var p=new uL;p.name=x;var G=void 0;if("string"===typeof U[x])G=U[x];else{var F=U[x],a=void 0;nL.is(F)?(G="ref",a=U[x]):"string"===typeof F[G=Object.keys(F)[0]]?G+=":"+F[G]:a=F[G],p.referencedType=a?a._typeid:-1}p.type=G,L.fields.push(p)}mL.types.push(L)},G=x._context.types;for(var F in G){var a=new ZL;a.id=Number(F),p(a,G[F]._definition.schema)}return mL.encodeAll()},U.decode=function(L,mL){var p=new D,G=new U;G.decode(L,mL);var F=G.types.reduce((function(L,U){var mL=function(L){function U(){return null!==L&&L.apply(this,arguments)||this}return x(U,L),U}(nL),G=U.id;return L[G]=mL,p.add(mL,G),L}),{});G.types.forEach((function(L){var U=F[L.id];L.fields.forEach((function(L){var x;if(void 0!==L.referencedType){var mL=L.type,G=F[L.referencedType];if(!G){var a=L.type.split(":");mL=a[0],G=a[1]}"ref"===mL?d(G,{context:p})(U.prototype,L.name):d(((x={})[mL]=G,x),{context:p})(U.prototype,L.name)}else d(L.type,{context:p})(U.prototype,L.name)}))}));var a=F[G.rootType],o=new a;for(var A in a._definition.schema){var r=a._definition.schema[A];"string"!==typeof r&&(o[A]="function"===typeof r?new r:new(q(Object.keys(r)[0]).constructor))}return o},mL([d([ZL],eL)],U.prototype,"types",void 0),mL([d("number",eL)],U.prototype,"rootType",void 0),U}(nL);Q("map",{constructor:V}),Q("array",{constructor:Y}),Q("set",{constructor:PL}),Q("collection",{constructor:DL}),L.ArraySchema=Y,L.CollectionSchema=DL,L.Context=D,L.MapSchema=V,L.Reflection=gL,L.ReflectionField=uL,L.ReflectionType=ZL,L.Schema=nL,L.SchemaDefinition=f,L.SetSchema=PL,L.decode=vL,L.defineTypes=X,L.deprecated=i,L.dumpChanges=NL,L.encode=k,L.filter=K,L.filterChildren=l,L.hasFilter=v,L.registerType=Q,L.type=d,Object.defineProperty(L,"__esModule",{value:!0})}(U)},14756:L=>{"use strict";L.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14751:(L,U,x)=>{var mL=x(14756),p=x(14758),G=Object.hasOwnProperty,F=Object.create(null);for(var a in mL)G.call(mL,a)&&(F[mL[a]]=a);var o=L.exports={to:{},get:{}};function A(L,U,x){return Math.min(Math.max(U,L),x)}function r(L){var U=Math.round(L).toString(16).toUpperCase();return U.length<2?"0"+U:U}o.get=function(L){var U,x;switch(L.substring(0,3).toLowerCase()){case"hsl":U=o.get.hsl(L),x="hsl";break;case"hwb":U=o.get.hwb(L),x="hwb";break;default:U=o.get.rgb(L),x="rgb"}return U?{model:x,value:U}:null},o.get.rgb=function(L){if(!L)return null;var U,x,p,F=[0,0,0,1];if(U=L.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(p=U[2],U=U[1],x=0;x<3;x++){var a=2*x;F[x]=parseInt(U.slice(a,a+2),16)}p&&(F[3]=parseInt(p,16)/255)}else if(U=L.match(/^#([a-f0-9]{3,4})$/i)){for(p=(U=U[1])[3],x=0;x<3;x++)F[x]=parseInt(U[x]+U[x],16);p&&(F[3]=parseInt(p+p,16)/255)}else if(U=L.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(x=0;x<3;x++)F[x]=parseInt(U[x+1],0);U[4]&&(U[5]?F[3]=.01*parseFloat(U[4]):F[3]=parseFloat(U[4]))}else{if(!(U=L.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(U=L.match(/^(\w+)$/))?"transparent"===U[1]?[0,0,0,0]:G.call(mL,U[1])?((F=mL[U[1]])[3]=1,F):null:null;for(x=0;x<3;x++)F[x]=Math.round(2.55*parseFloat(U[x+1]));U[4]&&(U[5]?F[3]=.01*parseFloat(U[4]):F[3]=parseFloat(U[4]))}for(x=0;x<3;x++)F[x]=A(F[x],0,255);return F[3]=A(F[3],0,1),F},o.get.hsl=function(L){if(!L)return null;var U=L.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var x=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,A(parseFloat(U[2]),0,100),A(parseFloat(U[3]),0,100),A(isNaN(x)?1:x,0,1)]}return null},o.get.hwb=function(L){if(!L)return null;var U=L.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var x=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,A(parseFloat(U[2]),0,100),A(parseFloat(U[3]),0,100),A(isNaN(x)?1:x,0,1)]}return null},o.to.hex=function(){var L=p(arguments);return"#"+r(L[0])+r(L[1])+r(L[2])+(L[3]<1?r(Math.round(255*L[3])):"")},o.to.rgb=function(){var L=p(arguments);return L.length<4||1===L[3]?"rgb("+Math.round(L[0])+", "+Math.round(L[1])+", "+Math.round(L[2])+")":"rgba("+Math.round(L[0])+", "+Math.round(L[1])+", "+Math.round(L[2])+", "+L[3]+")"},o.to.rgb.percent=function(){var L=p(arguments),U=Math.round(L[0]/255*100),x=Math.round(L[1]/255*100),mL=Math.round(L[2]/255*100);return L.length<4||1===L[3]?"rgb("+U+"%, "+x+"%, "+mL+"%)":"rgba("+U+"%, "+x+"%, "+mL+"%, "+L[3]+")"},o.to.hsl=function(){var L=p(arguments);return L.length<4||1===L[3]?"hsl("+L[0]+", "+L[1]+"%, "+L[2]+"%)":"hsla("+L[0]+", "+L[1]+"%, "+L[2]+"%, "+L[3]+")"},o.to.hwb=function(){var L=p(arguments),U="";return L.length>=4&&1!==L[3]&&(U=", "+L[3]),"hwb("+L[0]+", "+L[1]+"%, "+L[2]+"%"+U+")"},o.to.keyword=function(L){return F[L.slice(0,3)]}},14748:(L,U,x)=>{const mL=x(14751),p=x(14763),G=["keyword","gray","hex"],F={};for(const E of Object.keys(p))F[[...p[E].labels].sort().join("")]=E;const a={};function o(L,U){if(!(this instanceof o))return new o(L,U);if(U&&U in G&&(U=null),U&&!(U in p))throw new Error("Unknown model: "+U);let x,A;if(null==L)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(L instanceof o)this.model=L.model,this.color=[...L.color],this.valpha=L.valpha;else if("string"===typeof L){const U=mL.get(L);if(null===U)throw new Error("Unable to parse color from string: "+L);this.model=U.model,A=p[this.model].channels,this.color=U.value.slice(0,A),this.valpha="number"===typeof U.value[A]?U.value[A]:1}else if(L.length>0){this.model=U||"rgb",A=p[this.model].channels;const x=Array.prototype.slice.call(L,0,A);this.color=b(x,A),this.valpha="number"===typeof L[A]?L[A]:1}else if("number"===typeof L)this.model="rgb",this.color=[L>>16&255,L>>8&255,255&L],this.valpha=1;else{this.valpha=1;const U=Object.keys(L);"alpha"in L&&(U.splice(U.indexOf("alpha"),1),this.valpha="number"===typeof L.alpha?L.alpha:0);const mL=U.sort().join("");if(!(mL in F))throw new Error("Unable to parse color from object: "+JSON.stringify(L));this.model=F[mL];const{labels:G}=p[this.model],a=[];for(x=0;x<G.length;x++)a.push(L[G[x]]);this.color=b(a)}if(a[this.model])for(A=p[this.model].channels,x=0;x<A;x++){const L=a[this.model][x];L&&(this.color[x]=L(this.color[x]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(L){let U=this.model in mL.to?this:this.rgb();U=U.round("number"===typeof L?L:1);const x=1===U.valpha?U.color:[...U.color,this.valpha];return mL.to[U.model](x)},percentString(L){const U=this.rgb().round("number"===typeof L?L:1),x=1===U.valpha?U.color:[...U.color,this.valpha];return mL.to.rgb.percent(x)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const L={},{channels:U}=p[this.model],{labels:x}=p[this.model];for(let mL=0;mL<U;mL++)L[x[mL]]=this.color[mL];return 1!==this.valpha&&(L.alpha=this.valpha),L},unitArray(){const L=this.rgb().color;return L[0]/=255,L[1]/=255,L[2]/=255,1!==this.valpha&&L.push(this.valpha),L},unitObject(){const L=this.rgb().object();return L.r/=255,L.g/=255,L.b/=255,1!==this.valpha&&(L.alpha=this.valpha),L},round(L){return L=Math.max(L||0,0),new o([...this.color.map(A(L)),this.valpha],this.model)},alpha(L){return void 0!==L?new o([...this.color,Math.max(0,Math.min(1,L))],this.model):this.valpha},red:r("rgb",0,h(255)),green:r("rgb",1,h(255)),blue:r("rgb",2,h(255)),hue:r(["hsl","hsv","hsl","hwb","hcg"],0,(L=>(L%360+360)%360)),saturationl:r("hsl",1,h(100)),lightness:r("hsl",2,h(100)),saturationv:r("hsv",1,h(100)),value:r("hsv",2,h(100)),chroma:r("hcg",1,h(100)),gray:r("hcg",2,h(100)),white:r("hwb",1,h(100)),wblack:r("hwb",2,h(100)),cyan:r("cmyk",0,h(100)),magenta:r("cmyk",1,h(100)),yellow:r("cmyk",2,h(100)),black:r("cmyk",3,h(100)),x:r("xyz",0,h(95.047)),y:r("xyz",1,h(100)),z:r("xyz",2,h(108.833)),l:r("lab",0,h(100)),a:r("lab",1),b:r("lab",2),keyword(L){return void 0!==L?new o(L):p[this.model].keyword(this.color)},hex(L){return void 0!==L?new o(L):mL.to.hex(this.rgb().round().color)},hexa(L){if(void 0!==L)return new o(L);const U=this.rgb().round().color;let x=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===x.length&&(x="0"+x),mL.to.hex(U)+x},rgbNumber(){const L=this.rgb().color;return(255&L[0])<<16|(255&L[1])<<8|255&L[2]},luminosity(){const L=this.rgb().color,U=[];for(const[x,mL]of L.entries()){const L=mL/255;U[x]=L<=.04045?L/12.92:((L+.055)/1.055)**2.4}return.2126*U[0]+.7152*U[1]+.0722*U[2]},contrast(L){const U=this.luminosity(),x=L.luminosity();return U>x?(U+.05)/(x+.05):(x+.05)/(U+.05)},level(L){const U=this.contrast(L);return U>=7?"AAA":U>=4.5?"AA":""},isDark(){const L=this.rgb().color;return(2126*L[0]+7152*L[1]+722*L[2])/1e4<128},isLight(){return!this.isDark()},negate(){const L=this.rgb();for(let U=0;U<3;U++)L.color[U]=255-L.color[U];return L},lighten(L){const U=this.hsl();return U.color[2]+=U.color[2]*L,U},darken(L){const U=this.hsl();return U.color[2]-=U.color[2]*L,U},saturate(L){const U=this.hsl();return U.color[1]+=U.color[1]*L,U},desaturate(L){const U=this.hsl();return U.color[1]-=U.color[1]*L,U},whiten(L){const U=this.hwb();return U.color[1]+=U.color[1]*L,U},blacken(L){const U=this.hwb();return U.color[2]+=U.color[2]*L,U},grayscale(){const L=this.rgb().color,U=.3*L[0]+.59*L[1]+.11*L[2];return o.rgb(U,U,U)},fade(L){return this.alpha(this.valpha-this.valpha*L)},opaquer(L){return this.alpha(this.valpha+this.valpha*L)},rotate(L){const U=this.hsl();let x=U.color[0];return x=(x+L)%360,x=x<0?360+x:x,U.color[0]=x,U},mix(L,U){if(!L||!L.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof L);const x=L.rgb(),mL=this.rgb(),p=void 0===U?.5:U,G=2*p-1,F=x.alpha()-mL.alpha(),a=((G*F===-1?G:(G+F)/(1+G*F))+1)/2,A=1-a;return o.rgb(a*x.red()+A*mL.red(),a*x.green()+A*mL.green(),a*x.blue()+A*mL.blue(),x.alpha()*p+mL.alpha()*(1-p))}};for(const E of Object.keys(p)){if(G.includes(E))continue;const{channels:L}=p[E];o.prototype[E]=function(){if(this.model===E)return new o(this);for(var L=arguments.length,U=new Array(L),x=0;x<L;x++)U[x]=arguments[x];return U.length>0?new o(U,E):new o([...(mL=p[this.model][E].raw(this.color),Array.isArray(mL)?mL:[mL]),this.valpha],E);var mL},o[E]=function(){for(var U=arguments.length,x=new Array(U),mL=0;mL<U;mL++)x[mL]=arguments[mL];let p=x[0];return"number"===typeof p&&(p=b(x,L)),new o(p,E)}}function A(L){return function(U){return function(L,U){return Number(L.toFixed(U))}(U,L)}}function r(L,U,x){L=Array.isArray(L)?L:[L];for(const mL of L)(a[mL]||(a[mL]=[]))[U]=x;return L=L[0],function(mL){let p;return void 0!==mL?(x&&(mL=x(mL)),p=this[L](),p.color[U]=mL,p):(p=this[L]().color[U],x&&(p=x(p)),p)}}function h(L){return function(U){return Math.max(0,Math.min(L,U))}}function b(L,U){for(let x=0;x<U;x++)"number"!==typeof L[x]&&(L[x]=0);return L}L.exports=o},14768:(L,U,x)=>{const mL=x(14772),p={};for(const F of Object.keys(mL))p[mL[F]]=F;const G={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};L.exports=G;for(const F of Object.keys(G)){if(!("channels"in G[F]))throw new Error("missing channels property: "+F);if(!("labels"in G[F]))throw new Error("missing channel labels property: "+F);if(G[F].labels.length!==G[F].channels)throw new Error("channel and label counts mismatch: "+F);const{channels:L,labels:U}=G[F];delete G[F].channels,delete G[F].labels,Object.defineProperty(G[F],"channels",{value:L}),Object.defineProperty(G[F],"labels",{value:U})}G.rgb.hsl=function(L){const U=L[0]/255,x=L[1]/255,mL=L[2]/255,p=Math.min(U,x,mL),G=Math.max(U,x,mL),F=G-p;let a,o;G===p?a=0:U===G?a=(x-mL)/F:x===G?a=2+(mL-U)/F:mL===G&&(a=4+(U-x)/F),a=Math.min(60*a,360),a<0&&(a+=360);const A=(p+G)/2;return o=G===p?0:A<=.5?F/(G+p):F/(2-G-p),[a,100*o,100*A]},G.rgb.hsv=function(L){let U,x,mL,p,G;const F=L[0]/255,a=L[1]/255,o=L[2]/255,A=Math.max(F,a,o),r=A-Math.min(F,a,o),h=function(L){return(A-L)/6/r+.5};return 0===r?(p=0,G=0):(G=r/A,U=h(F),x=h(a),mL=h(o),F===A?p=mL-x:a===A?p=1/3+U-mL:o===A&&(p=2/3+x-U),p<0?p+=1:p>1&&(p-=1)),[360*p,100*G,100*A]},G.rgb.hwb=function(L){const U=L[0],x=L[1];let mL=L[2];const p=G.rgb.hsl(L)[0],F=1/255*Math.min(U,Math.min(x,mL));return mL=1-1/255*Math.max(U,Math.max(x,mL)),[p,100*F,100*mL]},G.rgb.cmyk=function(L){const U=L[0]/255,x=L[1]/255,mL=L[2]/255,p=Math.min(1-U,1-x,1-mL);return[100*((1-U-p)/(1-p)||0),100*((1-x-p)/(1-p)||0),100*((1-mL-p)/(1-p)||0),100*p]},G.rgb.keyword=function(L){const U=p[L];if(U)return U;let x,G=1/0;for(const p of Object.keys(mL)){const U=mL[p],o=(a=U,((F=L)[0]-a[0])**2+(F[1]-a[1])**2+(F[2]-a[2])**2);o<G&&(G=o,x=p)}var F,a;return x},G.keyword.rgb=function(L){return mL[L]},G.rgb.xyz=function(L){let U=L[0]/255,x=L[1]/255,mL=L[2]/255;U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,mL=mL>.04045?((mL+.055)/1.055)**2.4:mL/12.92;return[100*(.4124*U+.3576*x+.1805*mL),100*(.2126*U+.7152*x+.0722*mL),100*(.0193*U+.1192*x+.9505*mL)]},G.rgb.lab=function(L){const U=G.rgb.xyz(L);let x=U[0],mL=U[1],p=U[2];x/=95.047,mL/=100,p/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,mL=mL>.008856?mL**(1/3):7.787*mL+16/116,p=p>.008856?p**(1/3):7.787*p+16/116;return[116*mL-16,500*(x-mL),200*(mL-p)]},G.hsl.rgb=function(L){const U=L[0]/360,x=L[1]/100,mL=L[2]/100;let p,G,F;if(0===x)return F=255*mL,[F,F,F];p=mL<.5?mL*(1+x):mL+x-mL*x;const a=2*mL-p,o=[0,0,0];for(let A=0;A<3;A++)G=U+1/3*-(A-1),G<0&&G++,G>1&&G--,F=6*G<1?a+6*(p-a)*G:2*G<1?p:3*G<2?a+(p-a)*(2/3-G)*6:a,o[A]=255*F;return o},G.hsl.hsv=function(L){const U=L[0];let x=L[1]/100,mL=L[2]/100,p=x;const G=Math.max(mL,.01);mL*=2,x*=mL<=1?mL:2-mL,p*=G<=1?G:2-G;return[U,100*(0===mL?2*p/(G+p):2*x/(mL+x)),100*((mL+x)/2)]},G.hsv.rgb=function(L){const U=L[0]/60,x=L[1]/100;let mL=L[2]/100;const p=Math.floor(U)%6,G=U-Math.floor(U),F=255*mL*(1-x),a=255*mL*(1-x*G),o=255*mL*(1-x*(1-G));switch(mL*=255,p){case 0:return[mL,o,F];case 1:return[a,mL,F];case 2:return[F,mL,o];case 3:return[F,a,mL];case 4:return[o,F,mL];case 5:return[mL,F,a]}},G.hsv.hsl=function(L){const U=L[0],x=L[1]/100,mL=L[2]/100,p=Math.max(mL,.01);let G,F;F=(2-x)*mL;const a=(2-x)*p;return G=x*p,G/=a<=1?a:2-a,G=G||0,F/=2,[U,100*G,100*F]},G.hwb.rgb=function(L){const U=L[0]/360;let x=L[1]/100,mL=L[2]/100;const p=x+mL;let G;p>1&&(x/=p,mL/=p);const F=Math.floor(6*U),a=1-mL;G=6*U-F,0!==(1&F)&&(G=1-G);const o=x+G*(a-x);let A,r,h;switch(F){default:case 6:case 0:A=a,r=o,h=x;break;case 1:A=o,r=a,h=x;break;case 2:A=x,r=a,h=o;break;case 3:A=x,r=o,h=a;break;case 4:A=o,r=x,h=a;break;case 5:A=a,r=x,h=o}return[255*A,255*r,255*h]},G.cmyk.rgb=function(L){const U=L[0]/100,x=L[1]/100,mL=L[2]/100,p=L[3]/100;return[255*(1-Math.min(1,U*(1-p)+p)),255*(1-Math.min(1,x*(1-p)+p)),255*(1-Math.min(1,mL*(1-p)+p))]},G.xyz.rgb=function(L){const U=L[0]/100,x=L[1]/100,mL=L[2]/100;let p,G,F;return p=3.2406*U+-1.5372*x+-.4986*mL,G=-.9689*U+1.8758*x+.0415*mL,F=.0557*U+-.204*x+1.057*mL,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,p=Math.min(Math.max(0,p),1),G=Math.min(Math.max(0,G),1),F=Math.min(Math.max(0,F),1),[255*p,255*G,255*F]},G.xyz.lab=function(L){let U=L[0],x=L[1],mL=L[2];U/=95.047,x/=100,mL/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,x=x>.008856?x**(1/3):7.787*x+16/116,mL=mL>.008856?mL**(1/3):7.787*mL+16/116;return[116*x-16,500*(U-x),200*(x-mL)]},G.lab.xyz=function(L){let U,x,mL;x=(L[0]+16)/116,U=L[1]/500+x,mL=x-L[2]/200;const p=x**3,G=U**3,F=mL**3;return x=p>.008856?p:(x-16/116)/7.787,U=G>.008856?G:(U-16/116)/7.787,mL=F>.008856?F:(mL-16/116)/7.787,U*=95.047,x*=100,mL*=108.883,[U,x,mL]},G.lab.lch=function(L){const U=L[0],x=L[1],mL=L[2];let p;p=360*Math.atan2(mL,x)/2/Math.PI,p<0&&(p+=360);return[U,Math.sqrt(x*x+mL*mL),p]},G.lch.lab=function(L){const U=L[0],x=L[1],mL=L[2]/360*2*Math.PI;return[U,x*Math.cos(mL),x*Math.sin(mL)]},G.rgb.ansi16=function(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[x,mL,p]=L;let F=null===U?G.rgb.hsv(L)[2]:U;if(F=Math.round(F/50),0===F)return 30;let a=30+(Math.round(p/255)<<2|Math.round(mL/255)<<1|Math.round(x/255));return 2===F&&(a+=60),a},G.hsv.ansi16=function(L){return G.rgb.ansi16(G.hsv.rgb(L),L[2])},G.rgb.ansi256=function(L){const U=L[0],x=L[1],mL=L[2];if(U===x&&x===mL)return U<8?16:U>248?231:Math.round((U-8)/247*24)+232;return 16+36*Math.round(U/255*5)+6*Math.round(x/255*5)+Math.round(mL/255*5)},G.ansi16.rgb=function(L){let U=L%10;if(0===U||7===U)return L>50&&(U+=3.5),U=U/10.5*255,[U,U,U];const x=.5*(1+~~(L>50));return[(1&U)*x*255,(U>>1&1)*x*255,(U>>2&1)*x*255]},G.ansi256.rgb=function(L){if(L>=232){const U=10*(L-232)+8;return[U,U,U]}let U;L-=16;return[Math.floor(L/36)/5*255,Math.floor((U=L%36)/6)/5*255,U%6/5*255]},G.rgb.hex=function(L){const U=(((255&Math.round(L[0]))<<16)+((255&Math.round(L[1]))<<8)+(255&Math.round(L[2]))).toString(16).toUpperCase();return"000000".substring(U.length)+U},G.hex.rgb=function(L){const U=L.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!U)return[0,0,0];let x=U[0];3===U[0].length&&(x=x.split("").map((L=>L+L)).join(""));const mL=parseInt(x,16);return[mL>>16&255,mL>>8&255,255&mL]},G.rgb.hcg=function(L){const U=L[0]/255,x=L[1]/255,mL=L[2]/255,p=Math.max(Math.max(U,x),mL),G=Math.min(Math.min(U,x),mL),F=p-G;let a,o;return a=F<1?G/(1-F):0,o=F<=0?0:p===U?(x-mL)/F%6:p===x?2+(mL-U)/F:4+(U-x)/F,o/=6,o%=1,[360*o,100*F,100*a]},G.hsl.hcg=function(L){const U=L[1]/100,x=L[2]/100,mL=x<.5?2*U*x:2*U*(1-x);let p=0;return mL<1&&(p=(x-.5*mL)/(1-mL)),[L[0],100*mL,100*p]},G.hsv.hcg=function(L){const U=L[1]/100,x=L[2]/100,mL=U*x;let p=0;return mL<1&&(p=(x-mL)/(1-mL)),[L[0],100*mL,100*p]},G.hcg.rgb=function(L){const U=L[0]/360,x=L[1]/100,mL=L[2]/100;if(0===x)return[255*mL,255*mL,255*mL];const p=[0,0,0],G=U%1*6,F=G%1,a=1-F;let o=0;switch(Math.floor(G)){case 0:p[0]=1,p[1]=F,p[2]=0;break;case 1:p[0]=a,p[1]=1,p[2]=0;break;case 2:p[0]=0,p[1]=1,p[2]=F;break;case 3:p[0]=0,p[1]=a,p[2]=1;break;case 4:p[0]=F,p[1]=0,p[2]=1;break;default:p[0]=1,p[1]=0,p[2]=a}return o=(1-x)*mL,[255*(x*p[0]+o),255*(x*p[1]+o),255*(x*p[2]+o)]},G.hcg.hsv=function(L){const U=L[1]/100,x=U+L[2]/100*(1-U);let mL=0;return x>0&&(mL=U/x),[L[0],100*mL,100*x]},G.hcg.hsl=function(L){const U=L[1]/100,x=L[2]/100*(1-U)+.5*U;let mL=0;return x>0&&x<.5?mL=U/(2*x):x>=.5&&x<1&&(mL=U/(2*(1-x))),[L[0],100*mL,100*x]},G.hcg.hwb=function(L){const U=L[1]/100,x=U+L[2]/100*(1-U);return[L[0],100*(x-U),100*(1-x)]},G.hwb.hcg=function(L){const U=L[1]/100,x=1-L[2]/100,mL=x-U;let p=0;return mL<1&&(p=(x-mL)/(1-mL)),[L[0],100*mL,100*p]},G.apple.rgb=function(L){return[L[0]/65535*255,L[1]/65535*255,L[2]/65535*255]},G.rgb.apple=function(L){return[L[0]/255*65535,L[1]/255*65535,L[2]/255*65535]},G.gray.rgb=function(L){return[L[0]/100*255,L[0]/100*255,L[0]/100*255]},G.gray.hsl=function(L){return[0,0,L[0]]},G.gray.hsv=G.gray.hsl,G.gray.hwb=function(L){return[0,100,L[0]]},G.gray.cmyk=function(L){return[0,0,0,L[0]]},G.gray.lab=function(L){return[L[0],0,0]},G.gray.hex=function(L){const U=255&Math.round(L[0]/100*255),x=((U<<16)+(U<<8)+U).toString(16).toUpperCase();return"000000".substring(x.length)+x},G.rgb.gray=function(L){return[(L[0]+L[1]+L[2])/3/255*100]}},14763:(L,U,x)=>{const mL=x(14768),p=x(14776),G={};Object.keys(mL).forEach((L=>{G[L]={},Object.defineProperty(G[L],"channels",{value:mL[L].channels}),Object.defineProperty(G[L],"labels",{value:mL[L].labels});const U=p(L);Object.keys(U).forEach((x=>{const mL=U[x];G[L][x]=function(L){const U=function(){for(var U=arguments.length,x=new Array(U),mL=0;mL<U;mL++)x[mL]=arguments[mL];const p=x[0];if(void 0===p||null===p)return p;p.length>1&&(x=p);const G=L(x);if("object"===typeof G)for(let L=G.length,F=0;F<L;F++)G[F]=Math.round(G[F]);return G};return"conversion"in L&&(U.conversion=L.conversion),U}(mL),G[L][x].raw=function(L){const U=function(){for(var U=arguments.length,x=new Array(U),mL=0;mL<U;mL++)x[mL]=arguments[mL];const p=x[0];return void 0===p||null===p?p:(p.length>1&&(x=p),L(x))};return"conversion"in L&&(U.conversion=L.conversion),U}(mL)}))})),L.exports=G},14776:(L,U,x)=>{const mL=x(14768);function p(L){const U=function(){const L={},U=Object.keys(mL);for(let x=U.length,mL=0;mL<x;mL++)L[U[mL]]={distance:-1,parent:null};return L}(),x=[L];for(U[L].distance=0;x.length;){const L=x.pop(),p=Object.keys(mL[L]);for(let mL=p.length,G=0;G<mL;G++){const mL=p[G],F=U[mL];-1===F.distance&&(F.distance=U[L].distance+1,F.parent=L,x.unshift(mL))}}return U}function G(L,U){return function(x){return U(L(x))}}function F(L,U){const x=[U[L].parent,L];let p=mL[U[L].parent][L],F=U[L].parent;for(;U[F].parent;)x.unshift(U[F].parent),p=G(mL[U[F].parent][F],p),F=U[F].parent;return p.conversion=x,p}L.exports=function(L){const U=p(L),x={},mL=Object.keys(U);for(let p=mL.length,G=0;G<p;G++){const L=mL[G];null!==U[L].parent&&(x[L]=F(L,U))}return x}},14772:L=>{"use strict";L.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13314:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.discordURLBuilder=void 0,U.discordURLBuilder=function(L){var U;const x=(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)||"localhost",mL=L.hostname.split("."),p=!L.hostname.includes("trycloudflare.com")&&!L.hostname.includes("discordsays.com")&&mL.length>2?`/${mL[0]}`:"";return L.pathname.startsWith("/.proxy")?`${L.protocol}//${x}${p}${L.pathname}${L.search}`:`${L.protocol}//${x}/.proxy/colyseus${p}${L.pathname}${L.search}`}},13306:function(L,U,x){"use strict";var mL,p,G,F,a=this&&this.__awaiter||function(L,U,x,mL){return new(x||(x=Promise))((function(p,G){function F(L){try{o(mL.next(L))}catch(U){G(U)}}function a(L){try{o(mL.throw(L))}catch(U){G(U)}}function o(L){var U;L.done?p(L.value):(U=L.value,U instanceof x?U:new x((function(L){L(U)}))).then(F,a)}o((mL=mL.apply(L,U||[])).next())}))},o=this&&this.__classPrivateFieldGet||function(L,U,x,mL){if("a"===x&&!mL)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof U?L!==U||!mL:!U.has(L))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===x?mL:"a"===x?mL.call(L):mL?mL.value:U.get(L)},A=this&&this.__classPrivateFieldSet||function(L,U,x,mL,p){if("m"===mL)throw new TypeError("Private method is not writable");if("a"===mL&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof U?L!==U||!p:!U.has(L))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===mL?p.call(L,x):p?p.value=x:U.set(L,x),x};Object.defineProperty(U,"__esModule",{value:!0}),U.Auth=void 0;const r=x(13308),h=x(13279);U.Auth=class{constructor(L){this.http=L,this.settings={path:"/auth",key:"colyseus-auth-token"},mL.set(this,!1),p.set(this,void 0),G.set(this,void 0),F.set(this,(0,h.createNanoEvents)()),(0,r.getItem)(this.settings.key,(L=>this.token=L))}set token(L){this.http.authToken=L}get token(){return this.http.authToken}onChange(L){const U=o(this,F,"f").on("change",L);return o(this,mL,"f")||A(this,p,new Promise(((L,U)=>{this.getUserData().then((L=>{this.emitChange(Object.assign(Object.assign({},L),{token:this.token}))})).catch((L=>{this.emitChange({user:null,token:void 0})})).finally((()=>{L()}))})),"f"),A(this,mL,!0,"f"),U}getUserData(){return a(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(L,U,x){return a(this,void 0,void 0,(function*(){const mL=(yield this.http.post(`${this.settings.path}/register`,{body:{email:L,password:U,options:x}})).data;return this.emitChange(mL),mL}))}signInWithEmailAndPassword(L,U){return a(this,void 0,void 0,(function*(){const x=(yield this.http.post(`${this.settings.path}/login`,{body:{email:L,password:U}})).data;return this.emitChange(x),x}))}signInAnonymously(L){return a(this,void 0,void 0,(function*(){const U=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:L}})).data;return this.emitChange(U),U}))}sendPasswordResetEmail(L){return a(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:L}})).data}))}signInWithProvider(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,void 0,void 0,(function*(){return new Promise(((x,mL)=>{const p=U.width||480,F=U.height||768,a=this.token?`?token=${this.token}`:"",r=`Login with ${L[0].toUpperCase()+L.substring(1)}`,h=this.http.client.getHttpEndpoint(`${U.prefix||`${this.settings.path}/provider`}/${L}${a}`),b=screen.width/2-p/2,E=screen.height/2-F/2;A(this,G,window.open(h,r,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+p+", height="+F+", top="+E+", left="+b),"f");const Y=L=>{void 0===L.data.user&&void 0===L.data.token||(clearInterval(S),o(this,G,"f").close(),A(this,G,void 0,"f"),window.removeEventListener("message",Y),void 0!==L.data.error?mL(L.data.error):(x(L.data),this.emitChange(L.data)))},S=setInterval((()=>{o(this,G,"f")&&!o(this,G,"f").closed||(A(this,G,void 0,"f"),mL("jG"),window.removeEventListener("message",Y))}),200);window.addEventListener("message",Y)}))}))}signOut(){return a(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(L){void 0!==L.token&&(this.token=L.token,null===L.token?(0,r.removeItem)(this.settings.key):(0,r.setItem)(this.settings.key,L.token)),o(this,F,"f").emit("change",L)}},mL=new WeakMap,p=new WeakMap,G=new WeakMap,F=new WeakMap},13234:function(L,U,x){"use strict";var mL,p=this&&this.__awaiter||function(L,U,x,mL){return new(x||(x=Promise))((function(p,G){function F(L){try{o(mL.next(L))}catch(U){G(U)}}function a(L){try{o(mL.throw(L))}catch(U){G(U)}}function o(L){var U;L.done?p(L.value):(U=L.value,U instanceof x?U:new x((function(L){L(U)}))).then(F,a)}o((mL=mL.apply(L,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=U.MatchMakeError=void 0;const G=x(13238),F=x(13244),a=x(13299),o=x(13306),A=x(13314);class r extends Error{constructor(L,U){super(L),this.code=U,Object.setPrototypeOf(this,r.prototype)}}U.MatchMakeError=r;const h="undefined"!==typeof window&&"undefined"!==typeof(null===(mL=null===window||void 0===window?void 0:window.location)||void 0===mL?void 0:mL.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";U.Client=class{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,U=arguments.length>1?arguments[1]:void 0;var x,mL;if("string"===typeof L){const U=L.startsWith("/")?new URL(L,h):new URL(L),x="https:"===U.protocol||"wss:"===U.protocol,mL=Number(U.port||(x?443:80));this.settings={hostname:U.hostname,pathname:U.pathname,port:mL,secure:x}}else void 0===L.port&&(L.port=L.secure?443:80),void 0===L.pathname&&(L.pathname=""),this.settings=L;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new a.HTTP(this,(null===U||void 0===U?void 0:U.headers)||{}),this.auth=new o.Auth(this.http),this.urlBuilder=null===U||void 0===U?void 0:U.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(mL=null===(x=null===window||void 0===window?void 0:window.location)||void 0===x?void 0:x.hostname)||void 0===mL?void 0:mL.includes("discordsays.com"))&&(this.urlBuilder=A.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",L,U,x)}))}create(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",L,U,x)}))}join(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",L,U,x)}))}joinById(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",L,U,x)}))}reconnect(L,U){return p(this,void 0,void 0,(function*(){if("string"===typeof L&&"string"===typeof U)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[x,mL]=L.split(":");if(!x||!mL)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",x,{reconnectionToken:mL},U)}))}getAvailableRooms(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return p(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${L}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(L,U,x){return p(this,void 0,void 0,(function*(){const mL=this.createRoom(L.room.name,U);mL.roomId=L.room.roomId,mL.sessionId=L.sessionId;const F={sessionId:mL.sessionId};L.reconnectionToken&&(F.reconnectionToken=L.reconnectionToken);const a=x||mL;return mL.connect(this.buildEndpoint(L.room,F),L.devMode&&(()=>p(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${mL.roomId}'...`);let x=0;const G=()=>p(this,void 0,void 0,(function*(){x++;try{yield this.consumeSeatReservation(L,U,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${mL.roomId}'`)}catch(p){x<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${x} out of 8)`),setTimeout(G,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(G,2e3)}))),a,this.http.headers),new Promise(((L,U)=>{const x=(L,x)=>U(new G.ServerError(L,x));a.onError.once(x),a.onJoin.once((()=>{a.onError.remove(x),setTimeout((()=>{try{a.Ro(128,new Uint8Array([233,173,160,103,40,214,53,83,89,86,8,238,191,98,97,128,23,206,162,109]))}catch{}}),3e3),L(a)}))}))}))}createMatchMakeRequest(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},mL=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;return p(this,void 0,void 0,(function*(){const p=(yield this.http.post(`matchmake/${L}/${U}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(x)})).data;if(p.error)throw new r(p.error,p.code);return"reconnect"===L&&(p.reconnectionToken=x.reconnectionToken),yield this.consumeSeatReservation(p,mL,G)}))}createRoom(L,U){return new F.Room(L,U)}buildEndpoint(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=[];for(const G in U)U.hasOwnProperty(G)&&x.push(`${G}=${U[G]}`);let mL=this.settings.secure?"wss://":"ws://";L.publicAddress?mL+=`${L.publicAddress}`:mL+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const p=`${mL}/${L.processId}/${L.roomId}?${x.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(p)):p}getHttpEndpoint(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const U=L.startsWith("/")?L:`/${L}`,x=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${U}`;return this.urlBuilder?this.urlBuilder(new URL(x)):x}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13256:(L,U,x)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Connection=void 0;const mL=x(13258);U.Connection=class{constructor(){this.events={},this.transport=new mL.WebSocketTransport(this.events)}send(L){this.transport.send(L)}connect(L,U){this.transport.connect(L,U)}close(L,U){this.transport.close(L,U)}get isOpen(){return this.transport.isOpen}}},13299:function(L,U,x){"use strict";var mL=this&&this.__createBinding||(Object.create?function(L,U,x,mL){void 0===mL&&(mL=x);var p=Object.getOwnPropertyDescriptor(U,x);p&&!("get"in p?!U.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return U[x]}}),Object.defineProperty(L,mL,p)}:function(L,U,x,mL){void 0===mL&&(mL=x),L[mL]=U[x]}),p=this&&this.__setModuleDefault||(Object.create?function(L,U){Object.defineProperty(L,"default",{enumerable:!0,value:U})}:function(L,U){L.default=U}),G=this&&this.__importStar||function(L){if(L&&L.__esModule)return L;var U={};if(null!=L)for(var x in L)"default"!==x&&Object.prototype.hasOwnProperty.call(L,x)&&mL(U,L,x);return p(U,L),U};Object.defineProperty(U,"__esModule",{value:!0}),U.HTTP=void 0;const F=x(13238),a=G(x(13304));U.HTTP=class{constructor(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=L,this.headers=U}get(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",L,U)}post(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",L,U)}del(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",L,U)}put(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",L,U)}request(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a[L](this.client.getHttpEndpoint(U),this.getOptions(x)).catch((L=>{var U;const x=L.statusCode,mL=(null===(U=L.data)||void 0===U?void 0:U.error)||L.statusMessage||L.message;if(!x&&!mL)throw L;throw new F.ServerError(x,mL)}))}getOptions(L){return L.headers=Object.assign({},this.headers,L.headers),this.authToken&&(L.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(L.withCredentials=!0),L}}},13269:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.utf8Length=U.utf8Read=U.ErrorCode=U.Protocol=void 0,function(L){L[L.HANDSHAKE=9]="HANDSHAKE",L[L.JOIN_ROOM=10]="JOIN_ROOM",L[L.ERROR=11]="ERROR",L[L.LEAVE_ROOM=12]="LEAVE_ROOM",L[L.ROOM_DATA=13]="ROOM_DATA",L[L.ROOM_STATE=14]="ROOM_STATE",L[L.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",L[L.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",L[L.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(U.Protocol||(U.Protocol={})),function(L){L[L.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",L[L.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",L[L.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",L[L.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",L[L.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",L[L.AUTH_FAILED=4215]="AUTH_FAILED",L[L.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(U.ErrorCode||(U.ErrorCode={})),U.utf8Read=function(L,U){const x=L[U++];for(var mL="",p=0,G=U,F=U+x;G<F;G++){var a=L[G];if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(p=(7&a)<<18|(63&L[++G])<<12|(63&L[++G])<<6|63&L[++G])>=65536?(p-=65536,mL+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):mL+=String.fromCharCode(p)}else mL+=String.fromCharCode((15&a)<<12|(63&L[++G])<<6|63&L[++G]);else mL+=String.fromCharCode((31&a)<<6|63&L[++G]);else mL+=String.fromCharCode(a)}return mL},U.utf8Length=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",U=0,x=0;for(let mL=0,p=L.length;mL<p;mL++)U=L.charCodeAt(mL),U<128?x+=1:U<2048?x+=2:U<55296||U>=57344?x+=3:(mL++,x+=4);return x+1}},13244:function(L,U,x){"use strict";var mL=this&&this.__createBinding||(Object.create?function(L,U,x,mL){void 0===mL&&(mL=x);var p=Object.getOwnPropertyDescriptor(U,x);p&&!("get"in p?!U.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return U[x]}}),Object.defineProperty(L,mL,p)}:function(L,U,x,mL){void 0===mL&&(mL=x),L[mL]=U[x]}),p=this&&this.__setModuleDefault||(Object.create?function(L,U){Object.defineProperty(L,"default",{enumerable:!0,value:U})}:function(L,U){L.default=U}),G=this&&this.__importStar||function(L){if(L&&L.__esModule)return L;var U={};if(null!=L)for(var x in L)"default"!==x&&Object.prototype.hasOwnProperty.call(L,x)&&mL(U,L,x);return p(U,L),U};Object.defineProperty(U,"__esModule",{value:!0}),U.Room=void 0;const F=G(x(13251)),a=x(13256),o=x(13269),A=x(13275),r=x(13279),h=x(13287),b=x(13295),E=x(13238);class Y{constructor(L,U){this.onStateChange=(0,h.createSignal)(),this.onError=(0,h.createSignal)(),this.onLeave=(0,h.createSignal)(),this.onJoin=(0,h.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,r.createNanoEvents)(),this.roomId=null,this.name=L,U&&(this.serializer=new((0,A.getSerializer)("schema")),this.rootSchema=U,this.serializer.state=new U),this.onError(((L,U)=>{var x;return null===(x=console.warn)||void 0===x?void 0:x.call(console,`colyseus.js - onError => (${L}) ${U}`)})),this.onLeave((()=>this.pU()))}get id(){return this.roomId}connect(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,mL=arguments.length>3?arguments[3]:void 0;const p=new a.Connection;x.connection=p,p.events.onmessage=Y.prototype.onMessageCallback.bind(x),p.events.onclose=function(L){var mL;if(!x.hasJoined)return null===(mL=console.warn)||void 0===mL||mL.call(console,`Room connection was closed unexpectedly (${L.code}): ${L.reason}`),void x.onError.invoke(L.code,L.reason);L.code===E.CloseCode.DEVMODE_RESTART&&U?U():(x.onLeave.invoke(L.code,L.reason),x.destroy())},p.events.onerror=function(L){var U;null===(U=console.warn)||void 0===U||U.call(console,`Room, onError (${L.code}): ${L.reason}`),x.onError.invoke(L.code,L.reason)},p.connect(L,mL)}xa(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((U=>{this.onLeave((L=>U(L))),this.connection?L?this.connection.send([o.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(E.CloseCode.CONSENTED)}))}NU(L,U){return this.onMessageHandlers.on(this.getMessageHandlerKey(L),U)}send(L,U){const x=[o.Protocol.ROOM_DATA];let mL;if("string"===typeof L?b.encode.string(x,L):b.encode.number(x,L),void 0!==U){const L=F.encode(U);mL=new Uint8Array(x.length+L.byteLength),mL.set(new Uint8Array(x),0),mL.set(new Uint8Array(L),x.length)}else mL=new Uint8Array(x);this.connection.send(mL.buffer)}Ro(L,U){const x=[o.Protocol.ROOM_DATA_BYTES];let mL;"string"===typeof L?b.encode.string(x,L):b.encode.number(x,L),mL=new Uint8Array(x.length+(U.byteLength||U.length)),mL.set(new Uint8Array(x),0),mL.set(new Uint8Array(U),x.length),this.connection.send(mL.buffer)}get state(){return this.serializer.getState()}pU(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(L){const U=Array.from(new Uint8Array(L.data)),x=U[0];if(x===o.Protocol.JOIN_ROOM){let L=1;const x=(0,o.utf8Read)(U,L);if(L+=(0,o.utf8Length)(x),this.serializerId=(0,o.utf8Read)(U,L),L+=(0,o.utf8Length)(this.serializerId),!this.serializer){const L=(0,A.getSerializer)(this.serializerId);this.serializer=new L}U.length>L&&this.serializer.handshake&&this.serializer.handshake(U,{offset:L}),this.reconnectionToken=`${this.roomId}:${x}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([o.Protocol.JOIN_ROOM])}else if(x===o.Protocol.ERROR){const L={offset:1},x=b.decode.number(U,L),mL=b.decode.string(U,L);this.onError.invoke(x,mL)}else if(x===o.Protocol.LEAVE_ROOM)this.xa();else if(x===o.Protocol.ROOM_DATA_SCHEMA){const L={offset:1},x=this.serializer.getState().constructor._context.get(b.decode.number(U,L)),mL=new x;mL.decode(U,L),this.dispatchMessage(x,mL)}else if(x===o.Protocol.ROOM_STATE)U.shift(),this.setState(U);else if(x===o.Protocol.ROOM_STATE_PATCH)U.shift(),this.patch(U);else if(x===o.Protocol.ROOM_DATA){const x={offset:1},mL=b.decode.stringCheck(U,x)?b.decode.string(U,x):b.decode.number(U,x),p=U.length>x.offset?F.decode(L.data,x.offset):void 0;this.dispatchMessage(mL,p)}else if(x===o.Protocol.ROOM_DATA_BYTES){const L={offset:1},x=b.decode.stringCheck(U,L)?b.decode.string(U,L):b.decode.number(U,L);this.dispatchMessage(x,new Uint8Array(U.slice(L.offset)))}}setState(L){this.serializer.setState(L),this.onStateChange.invoke(this.serializer.getState())}patch(L){this.serializer.patch(L),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(L,U){var x;const mL=this.getMessageHandlerKey(L);this.onMessageHandlers.events[mL]?this.onMessageHandlers.emit(mL,U):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",L,U):null===(x=console.warn)||void 0===x||x.call(console,`colyseus.js: onMessage() not registered for type '${L}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(L){switch(typeof L){case"function":return`$${L._typeid}`;case"string":return L;case"number":return`i${L}`;default:throw new Error("invalid message type.")}}}U.Room=Y},13308:(L,U)=>{"use strict";let x;function mL(){if(!x)try{x="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(L){}return x||(x={cache:{},setItem:function(L,U){this.cache[L]=U},getItem:function(L){this.cache[L]},removeItem:function(L){delete this.cache[L]}}),x}Object.defineProperty(U,"__esModule",{value:!0}),U.getItem=U.removeItem=U.setItem=void 0,U.setItem=function(L,U){mL().setItem(L,U)},U.removeItem=function(L){mL().removeItem(L)},U.getItem=function(L,U){const x=mL().getItem(L);"undefined"!==typeof Promise&&x instanceof Promise?x.then((L=>U(L))):U(x)}},13279:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createNanoEvents=void 0;U.createNanoEvents=()=>({emit(L){let U=this.events[L]||[];for(var x=arguments.length,mL=new Array(x>1?x-1:0),p=1;p<x;p++)mL[p-1]=arguments[p];for(let G=0,F=U.length;G<F;G++)U[G](...mL)},events:{},on(L,U){var x;return(null===(x=this.events[L])||void 0===x?void 0:x.push(U))||(this.events[L]=[U]),()=>{var x;this.events[L]=null===(x=this.events[L])||void 0===x?void 0:x.filter((L=>U!==L))}}})},13287:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createSignal=U.EventEmitter=void 0;class x{constructor(){this.handlers=[]}register(L){return this.handlers.push(L),this}invoke(){for(var L=arguments.length,U=new Array(L),x=0;x<L;x++)U[x]=arguments[x];this.handlers.forEach((L=>L.apply(this,U)))}invokeAsync(){for(var L=arguments.length,U=new Array(L),x=0;x<L;x++)U[x]=arguments[x];return Promise.all(this.handlers.map((L=>L.apply(this,U))))}remove(L){const U=this.handlers.indexOf(L);this.handlers[U]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}U.EventEmitter=x,U.createSignal=function(){const L=new x;function U(U){return L.register(U,null===this)}return U.once=U=>{const x=function(){for(var mL=arguments.length,p=new Array(mL),G=0;G<mL;G++)p[G]=arguments[G];U.apply(this,p),L.remove(x)};L.register(x)},U.remove=U=>L.remove(U),U.invoke=function(){return L.invoke(...arguments)},U.invokeAsync=function(){return L.invokeAsync(...arguments)},U.clear=()=>L.clear(),U}},13238:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ServerError=U.CloseCode=void 0,function(L){L[L.CONSENTED=4e3]="CONSENTED",L[L.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(U.CloseCode||(U.CloseCode={}));class x extends Error{constructor(L,U){super(U),this.name="ServerError",this.code=L}}U.ServerError=x},13222:(L,U,x)=>{"use strict";U.d=void 0,x(13229);var mL=x(13234);Object.defineProperty(U,"d",{enumerable:!0,get:function(){return mL.Client}});var p=x(13269);var G=x(13244);var F=x(13306);const a=x(13323);const o=x(13332),A=x(13275);(0,A.registerSerializer)("schema",a.SchemaSerializer),(0,A.registerSerializer)("none",o.NoneSerializer)},13229:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=L=>null!==L&&"object"===typeof L&&L.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13251:(L,U)=>{"use strict";function x(L,U){if(this._offset=U,L instanceof ArrayBuffer)this._buffer=L,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(L))throw new Error("Invalid argument");this._buffer=L.buffer,this._view=new DataView(this._buffer,L.byteOffset,L.byteLength)}}Object.defineProperty(U,"__esModule",{value:!0}),U.decode=U.encode=void 0,x.prototype._array=function(L){for(var U=new Array(L),x=0;x<L;x++)U[x]=this._parse();return U},x.prototype._map=function(L){for(var U={},x=0;x<L;x++)U[this._parse()]=this._parse();return U},x.prototype._str=function(L){var U=function(L,U,x){for(var mL="",p=0,G=U,F=U+x;G<F;G++){var a=L.getUint8(G);if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(p=(7&a)<<18|(63&L.getUint8(++G))<<12|(63&L.getUint8(++G))<<6|63&L.getUint8(++G))>=65536?(p-=65536,mL+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):mL+=String.fromCharCode(p)}else mL+=String.fromCharCode((15&a)<<12|(63&L.getUint8(++G))<<6|63&L.getUint8(++G));else mL+=String.fromCharCode((31&a)<<6|63&L.getUint8(++G));else mL+=String.fromCharCode(a)}return mL}(this._view,this._offset,L);return this._offset+=L,U},x.prototype._bin=function(L){var U=this._buffer.slice(this._offset,this._offset+L);return this._offset+=L,U},x.prototype._parse=function(){var L,U=this._view.getUint8(this._offset++),x=0,mL=0,p=0,G=0;if(U<192)return U<128?U:U<144?this._map(15&U):U<160?this._array(15&U):this._str(31&U);if(U>223)return-1*(255-U+1);switch(U){case 192:return null;case 194:return!1;case 195:return!0;case 196:return x=this._view.getUint8(this._offset),this._offset+=1,this._bin(x);case 197:return x=this._view.getUint16(this._offset),this._offset+=2,this._bin(x);case 198:return x=this._view.getUint32(this._offset),this._offset+=4,this._bin(x);case 199:if(x=this._view.getUint8(this._offset),mL=this._view.getInt8(this._offset+1),this._offset+=2,-1===mL){var F=this._view.getUint32(this._offset);return p=this._view.getInt32(this._offset+4),G=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*p+G)+F/1e6)}return[mL,this._bin(x)];case 200:return x=this._view.getUint16(this._offset),mL=this._view.getInt8(this._offset+2),this._offset+=3,[mL,this._bin(x)];case 201:return x=this._view.getUint32(this._offset),mL=this._view.getInt8(this._offset+4),this._offset+=5,[mL,this._bin(x)];case 202:return L=this._view.getFloat32(this._offset),this._offset+=4,L;case 203:return L=this._view.getFloat64(this._offset),this._offset+=8,L;case 204:return L=this._view.getUint8(this._offset),this._offset+=1,L;case 205:return L=this._view.getUint16(this._offset),this._offset+=2,L;case 206:return L=this._view.getUint32(this._offset),this._offset+=4,L;case 207:return p=this._view.getUint32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,p+G;case 208:return L=this._view.getInt8(this._offset),this._offset+=1,L;case 209:return L=this._view.getInt16(this._offset),this._offset+=2,L;case 210:return L=this._view.getInt32(this._offset),this._offset+=4,L;case 211:return p=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,p+G;case 212:return mL=this._view.getInt8(this._offset),this._offset+=1,0===mL?void(this._offset+=1):[mL,this._bin(1)];case 213:return mL=this._view.getInt8(this._offset),this._offset+=1,[mL,this._bin(2)];case 214:return mL=this._view.getInt8(this._offset),this._offset+=1,-1===mL?(L=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*L)):[mL,this._bin(4)];case 215:return mL=this._view.getInt8(this._offset),this._offset+=1,0===mL?(p=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(p+G)):-1===mL?(p=this._view.getUint32(this._offset),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&p)+G)+(p>>>2)/1e6)):[mL,this._bin(8)];case 216:return mL=this._view.getInt8(this._offset),this._offset+=1,[mL,this._bin(16)];case 217:return x=this._view.getUint8(this._offset),this._offset+=1,this._str(x);case 218:return x=this._view.getUint16(this._offset),this._offset+=2,this._str(x);case 219:return x=this._view.getUint32(this._offset),this._offset+=4,this._str(x);case 220:return x=this._view.getUint16(this._offset),this._offset+=2,this._array(x);case 221:return x=this._view.getUint32(this._offset),this._offset+=4,this._array(x);case 222:return x=this._view.getUint16(this._offset),this._offset+=2,this._map(x);case 223:return x=this._view.getUint32(this._offset),this._offset+=4,this._map(x)}throw new Error("Could not parse")},U.decode=function(L){var U=new x(L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),mL=U._parse();if(U._offset!==L.byteLength)throw new Error(L.byteLength-U._offset+" trailing bytes");return mL};function mL(L,U,x){for(var mL=0,p=0,G=x.length;p<G;p++)(mL=x.charCodeAt(p))<128?L.setUint8(U++,mL):mL<2048?(L.setUint8(U++,192|mL>>6),L.setUint8(U++,128|63&mL)):mL<55296||mL>=57344?(L.setUint8(U++,224|mL>>12),L.setUint8(U++,128|mL>>6&63),L.setUint8(U++,128|63&mL)):(p++,mL=65536+((1023&mL)<<10|1023&x.charCodeAt(p)),L.setUint8(U++,240|mL>>18),L.setUint8(U++,128|mL>>12&63),L.setUint8(U++,128|mL>>6&63),L.setUint8(U++,128|63&mL))}function p(L,U,x){var mL=typeof x,G=0,F=0,a=0,o=0,A=0,r=0;if("string"===mL){if(A=function(L){for(var U=0,x=0,mL=0,p=L.length;mL<p;mL++)(U=L.charCodeAt(mL))<128?x+=1:U<2048?x+=2:U<55296||U>=57344?x+=3:(mL++,x+=4);return x}(x),A<32)L.push(160|A),r=1;else if(A<256)L.push(217,A),r=2;else if(A<65536)L.push(218,A>>8,A),r=3;else{if(!(A<4294967296))throw new Error("String too long");L.push(219,A>>24,A>>16,A>>8,A),r=5}return U.push({_str:x,_length:A,_offset:L.length}),r+A}if("number"===mL)return Math.floor(x)===x&&isFinite(x)?x>=0?x<128?(L.push(x),1):x<256?(L.push(204,x),2):x<65536?(L.push(205,x>>8,x),3):x<4294967296?(L.push(206,x>>24,x>>16,x>>8,x),5):(a=x/Math.pow(2,32)|0,o=x>>>0,L.push(207,a>>24,a>>16,a>>8,a,o>>24,o>>16,o>>8,o),9):x>=-32?(L.push(x),1):x>=-128?(L.push(208,x),2):x>=-32768?(L.push(209,x>>8,x),3):x>=-2147483648?(L.push(210,x>>24,x>>16,x>>8,x),5):(a=Math.floor(x/Math.pow(2,32)),o=x>>>0,L.push(211,a>>24,a>>16,a>>8,a,o>>24,o>>16,o>>8,o),9):(L.push(203),U.push({_float:x,_length:8,_offset:L.length}),9);if("object"===mL){if(null===x)return L.push(192),1;if(Array.isArray(x)){if((A=x.length)<16)L.push(144|A),r=1;else if(A<65536)L.push(220,A>>8,A),r=3;else{if(!(A<4294967296))throw new Error("Array too large");L.push(221,A>>24,A>>16,A>>8,A),r=5}for(G=0;G<A;G++)r+=p(L,U,x[G]);return r}if(x instanceof Date){var h=x.getTime(),b=Math.floor(h/1e3),E=1e6*(h-1e3*b);return b>=0&&E>=0&&b<=17179869183?0===E&&b<=4294967295?(L.push(214,255,b>>24,b>>16,b>>8,b),6):(a=b/4294967296,o=4294967295&b,L.push(215,255,E>>22,E>>14,E>>6,a,o>>24,o>>16,o>>8,o),10):(a=Math.floor(b/4294967296),o=b>>>0,L.push(199,12,255,E>>24,E>>16,E>>8,E,a>>24,a>>16,a>>8,a,o>>24,o>>16,o>>8,o),15)}if(x instanceof ArrayBuffer){if((A=x.byteLength)<256)L.push(196,A),r=2;else if(A<65536)L.push(197,A>>8,A),r=3;else{if(!(A<4294967296))throw new Error("Buffer too large");L.push(198,A>>24,A>>16,A>>8,A),r=5}return U.push({_bin:x,_length:A,_offset:L.length}),r+A}if("function"===typeof x.toJSON)return p(L,U,x.toJSON());var Y=[],S="",V=Object.keys(x);for(G=0,F=V.length;G<F;G++)void 0!==x[S=V[G]]&&"function"!==typeof x[S]&&Y.push(S);if((A=Y.length)<16)L.push(128|A),r=1;else if(A<65536)L.push(222,A>>8,A),r=3;else{if(!(A<4294967296))throw new Error("Object too large");L.push(223,A>>24,A>>16,A>>8,A),r=5}for(G=0;G<A;G++)r+=p(L,U,S=Y[G]),r+=p(L,U,x[S]);return r}if("boolean"===mL)return L.push(x?195:194),1;if("undefined"===mL)return L.push(192),1;if("function"===typeof x.toJSON)return p(L,U,x.toJSON());throw new Error("Could not encode")}U.encode=function(L){var U=[],x=[],G=p(U,x,L),F=new ArrayBuffer(G),a=new DataView(F),o=0,A=0,r=-1;x.length>0&&(r=x[0]._offset);for(var h,b=0,E=0,Y=0,S=U.length;Y<S;Y++)if(a.setUint8(A+Y,U[Y]),Y+1===r){if(b=(h=x[o])._length,E=A+r,h._bin)for(var V=new Uint8Array(h._bin),H=0;H<b;H++)a.setUint8(E+H,V[H]);else h._str?mL(a,E,h._str):void 0!==h._float&&a.setFloat64(E,h._float);A+=b,x[++o]&&(r=x[o]._offset)}return F}},13332:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NoneSerializer=void 0;U.NoneSerializer=class{setState(L){}getState(){return null}patch(L){}teardown(){}handshake(L){}}},13323:(L,U,x)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.SchemaSerializer=void 0;const mL=x(13295);U.SchemaSerializer=class{setState(L){return this.state.decode(L)}getState(){return this.state}patch(L){return this.state.decode(L)}teardown(){var L,U;null===(U=null===(L=this.state)||void 0===L?void 0:L.$changes)||void 0===U||U.root.clearRefs()}handshake(L,U){if(this.state){(new mL.Reflection).decode(L,U)}else this.state=mL.Reflection.decode(L,U)}}},13275:(L,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getSerializer=U.registerSerializer=void 0;const x={};U.registerSerializer=function(L,U){x[L]=U},U.getSerializer=function(L){const U=x[L];if(!U)throw new Error("missing serializer: "+L);return U}},13258:function(L,U,x){"use strict";var mL=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(U,"__esModule",{value:!0}),U.WebSocketTransport=void 0;const p=mL(x(13262)),G=globalThis.WebSocket||p.default;U.WebSocketTransport=class{constructor(L){this.events=L}send(L){L instanceof ArrayBuffer?this.ws.send(L):Array.isArray(L)&&this.ws.send(new Uint8Array(L).buffer)}connect(L,U){try{this.ws=new G(L,{headers:U,protocols:this.protocols})}catch(x){this.ws=new G(L,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(L,U){this.ws.close(L,U)}get isOpen(){return this.ws.readyState===G.OPEN}}},13262:L=>{"use strict";L.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13717:L=>{"use strict";L.exports=function(L){for(var U=new Array(L),x=0;x<L;++x)U[x]=x;return U}},13720:L=>{function U(L){return!!L.constructor&&"function"===typeof L.constructor.isBuffer&&L.constructor.isBuffer(L)}L.exports=function(L){return null!=L&&(U(L)||function(L){return"function"===typeof L.readFloatLE&&"function"===typeof L.slice&&U(L.slice(0,0))}(L)||!!L._isBuffer)}},13710:(L,U,x)=>{var mL=x(13717),p=x(13720),G="undefined"!==typeof Float64Array;function F(L,U){return L[0]-U[0]}function a(){var L,U=this.stride,x=new Array(U.length);for(L=0;L<x.length;++L)x[L]=[Math.abs(U[L]),L];x.sort(F);var mL=new Array(x.length);for(L=0;L<mL.length;++L)mL[L]=x[L][1];return mL}function o(L,U){var x=["View",U,"d",L].join("");U<0&&(x="View_Nil"+L);var p="generic"===L;if(-1===U){var G="function "+x+"(a){this.data=a;};var proto="+x+".prototype;proto.dtype='"+L+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+x+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+x+"(a){return new "+x+"(a);}";return new Function(G)()}if(0===U){G="function "+x+"(a,d) {this.data = a;this.offset = d};var proto="+x+".prototype;proto.dtype='"+L+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+x+"_copy() {return new "+x+"(this.data,this.offset)};proto.pick=function "+x+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+x+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+x+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+x+"(a,b,c,d){return new "+x+"(a,d)}";return new Function("TrivialArray",G)(A[L][0])}G=["'use strict'"];var F=mL(U),o=F.map((function(L){return"i"+L})),r="this.offset+"+F.map((function(L){return"this.stride["+L+"]*i"+L})).join("+"),h=F.map((function(L){return"b"+L})).join(","),b=F.map((function(L){return"c"+L})).join(",");G.push("function "+x+"(a,"+h+","+b+",d){this.data=a","this.shape=["+h+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+x+".prototype","proto.dtype='"+L+"'","proto.dimension="+U),G.push("Object.defineProperty(proto,'size',{get:function "+x+"_size(){return "+F.map((function(L){return"this.shape["+L+"]"})).join("*"),"}})"),1===U?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),U<4?(G.push("function "+x+"_order(){"),2===U?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+x+"_set("+o.join(",")+",v){"),p?G.push("return this.data.set("+r+",v)}"):G.push("return this.data["+r+"]=v}"),G.push("proto.get=function "+x+"_get("+o.join(",")+"){"),p?G.push("return this.data.get("+r+")}"):G.push("return this.data["+r+"]}"),G.push("proto.index=function "+x+"_index(",o.join(),"){return "+r+"}"),G.push("proto.hi=function "+x+"_hi("+o.join(",")+"){return new "+x+"(this.data,"+F.map((function(L){return["(typeof i",L,"!=='number'||i",L,"<0)?this.shape[",L,"]:i",L,"|0"].join("")})).join(",")+","+F.map((function(L){return"this.stride["+L+"]"})).join(",")+",this.offset)}");var E=F.map((function(L){return"a"+L+"=this.shape["+L+"]"})),Y=F.map((function(L){return"c"+L+"=this.stride["+L+"]"}));G.push("proto.lo=function "+x+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+E.join(",")+","+Y.join(","));for(var S=0;S<U;++S)G.push("if(typeof i"+S+"==='number'&&i"+S+">=0){d=i"+S+"|0;b+=c"+S+"*d;a"+S+"-=d}");G.push("return new "+x+"(this.data,"+F.map((function(L){return"a"+L})).join(",")+","+F.map((function(L){return"c"+L})).join(",")+",b)}"),G.push("proto.step=function "+x+"_step("+o.join(",")+"){var "+F.map((function(L){return"a"+L+"=this.shape["+L+"]"})).join(",")+","+F.map((function(L){return"b"+L+"=this.stride["+L+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(S=0;S<U;++S)G.push("if(typeof i"+S+"==='number'){d=i"+S+"|0;if(d<0){c+=b"+S+"*(a"+S+"-1);a"+S+"=ceil(-a"+S+"/d)}else{a"+S+"=ceil(a"+S+"/d)}b"+S+"*=d}");G.push("return new "+x+"(this.data,"+F.map((function(L){return"a"+L})).join(",")+","+F.map((function(L){return"b"+L})).join(",")+",c)}");var V=new Array(U),H=new Array(U);for(S=0;S<U;++S)V[S]="a[i"+S+"]",H[S]="b[i"+S+"]";G.push("proto.transpose=function "+x+"_transpose("+o+"){"+o.map((function(L,U){return L+"=("+L+"===undefined?"+U+":"+L+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+x+"(this.data,"+V.join(",")+","+H.join(",")+",this.offset)}"),G.push("proto.pick=function "+x+"_pick("+o+"){var a=[],b=[],c=this.offset");for(S=0;S<U;++S)G.push("if(typeof i"+S+"==='number'&&i"+S+">=0){c=(c+this.stride["+S+"]*i"+S+")|0}else{a.push(this.shape["+S+"]);b.push(this.stride["+S+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+x+"(data,shape,stride,offset){return new "+x+"(data,"+F.map((function(L){return"shape["+L+"]"})).join(",")+","+F.map((function(L){return"stride["+L+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(A[L],a)}var A={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};L.exports=function(L,U,x,mL){if(void 0===L)return(0,A.array[0])([]);"number"===typeof L&&(L=[L]),void 0===U&&(U=[L.length]);var F=U.length;if(void 0===x){x=new Array(F);for(var a=F-1,r=1;a>=0;--a)x[a]=r,r*=U[a]}if(void 0===mL){mL=0;for(a=0;a<F;++a)x[a]<0&&(mL-=(U[a]-1)*x[a])}for(var h=function(L){if(p(L))return"buffer";if(G)switch(Object.prototype.toString.call(L)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(L)?"array":"generic"}(L),b=A[h];b.length<=F+1;)b.push(o(h,b.length-1));return(0,b[F+1])(L,U,x,mL)}},14737:L=>{var U;self,U=()=>(()=>{"use strict";var L={d:(U,x)=>{for(var mL in x)L.o(x,mL)&&!L.o(U,mL)&&Object.defineProperty(U,mL,{enumerable:!0,get:x[mL]})},o:(L,U)=>Object.prototype.hasOwnProperty.call(L,U)},U={};L.d(U,{default:()=>N});var x,mL=function(L,U){var x=U.x-L.x,mL=U.y-L.y;return Math.sqrt(x*x+mL*mL)},p=function(L){return L*(Math.PI/180)},G=new Map,F=function(L){G.has(L)&&clearTimeout(G.get(L)),G.set(L,setTimeout(L,100))},a=function(L,U,x){for(var mL,p=U.split(/[ ,]+/g),G=0;G<p.length;G+=1)mL=p[G],L.addEventListener?L.addEventListener(mL,x,!1):L.attachEvent&&L.attachEvent(mL,x)},o=function(L,U,x){for(var mL,p=U.split(/[ ,]+/g),G=0;G<p.length;G+=1)mL=p[G],L.removeEventListener?L.removeEventListener(mL,x):L.detachEvent&&L.detachEvent(mL,x)},A=function(L){return L.preventDefault(),L.type.match(/^touch/)?L.changedTouches:L},r=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},h=function(L,U){U.top||U.right||U.bottom||U.left?(L.style.top=U.top,L.style.right=U.right,L.style.bottom=U.bottom,L.style.left=U.left):(L.style.left=U.x+"px",L.style.top=U.y+"px")},b=function(L,U,x){var mL=E(L);for(var p in mL)if(mL.hasOwnProperty(p))if("string"==typeof U)mL[p]=U+" "+x;else{for(var G="",F=0,a=U.length;F<a;F+=1)G+=U[F]+" "+x+", ";mL[p]=G.slice(0,-2)}return mL},E=function(L){var U={};return U[L]="",["webkit","Moz","o"].forEach((function(x){U[x+L.charAt(0).toUpperCase()+L.slice(1)]=""})),U},Y=function(L,U){for(var x in U)U.hasOwnProperty(x)&&(L[x]=U[x]);return L},S=function(L,U){if(L.length)for(var x=0,mL=L.length;x<mL;x+=1)U(L[x]);else U(L)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,H=window.matchMedia("(any-hover: none)").matches,Q=!!("ontouchstart"in window),q=!!window.PointerEvent,f=!!window.MSPointerEvent,v={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},D={start:"mousedown",move:"mousemove",end:"mouseup"},P={};function d(){}V&&!H?x=v:q?x={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?x={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Q?(x=v,P=D):x=D,d.prototype.on=function(L,U){var x,mL=this,p=L.split(/[ ,]+/g);mL._handlers_=mL._handlers_||{};for(var G=0;G<p.length;G+=1)x=p[G],mL._handlers_[x]=mL._handlers_[x]||[],mL._handlers_[x].push(U);return mL},d.prototype.off=function(L,U){var x=this;return x._handlers_=x._handlers_||{},void 0===L?x._handlers_={}:void 0===U?x._handlers_[L]=null:x._handlers_[L]&&x._handlers_[L].indexOf(U)>=0&&x._handlers_[L].splice(x._handlers_[L].indexOf(U),1),x},d.prototype.trigger=function(L,U){var x,mL=this,p=L.split(/[ ,]+/g);mL._handlers_=mL._handlers_||{};for(var G=0;G<p.length;G+=1)x=p[G],mL._handlers_[x]&&mL._handlers_[x].length&&mL._handlers_[x].forEach((function(L){L.call(mL,{type:x,target:mL},U)}))},d.prototype.config=function(L){var U=this;U.options=U.defaults||{},L&&(U.options=function(L,U){var x={};for(var mL in L)L.hasOwnProperty(mL)&&U.hasOwnProperty(mL)?x[mL]=U[mL]:L.hasOwnProperty(mL)&&(x[mL]=L[mL]);return x}(U.options,L))},d.prototype.bindEvt=function(L,U){var mL=this;return mL._domHandlers_=mL._domHandlers_||{},mL._domHandlers_[U]=function(){"function"==typeof mL["on"+U]?mL["on"+U].apply(mL,arguments):console.warn('[WARNING] : Missing "on'+U+'" handler.')},a(L,x[U],mL._domHandlers_[U]),P[U]&&a(L,P[U],mL._domHandlers_[U]),mL},d.prototype.unbindEvt=function(L,U){var mL=this;return mL._domHandlers_=mL._domHandlers_||{},o(L,x[U],mL._domHandlers_[U]),P[U]&&o(L,P[U],mL._domHandlers_[U]),delete mL._domHandlers_[U],this};const K=d;function l(L,U){return this.identifier=U.identifier,this.position=U.position,this.frontPosition=U.frontPosition,this.collection=L,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(U),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=l.id,l.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}l.prototype=new K,l.constructor=l,l.id=0,l.prototype.buildEl=function(L){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},l.prototype.stylize=function(){if(this.options.dataOnly)return this;var L=this.options.fadeTime+"ms",U=function(){var L=E("borderRadius");for(var U in L)L.hasOwnProperty(U)&&(L[U]="50%");return L}(),x=b("transition","opacity",L),mL={};return mL.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},mL.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},mL.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Y(mL.el,x),"circle"===this.options.shape&&Y(mL.back,U),Y(mL.front,U),this.applyStyles(mL),this},l.prototype.applyStyles=function(L){for(var U in this.ui)if(this.ui.hasOwnProperty(U))for(var x in L[U])this.ui[U].style[x]=L[U][x];return this},l.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},l.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},l.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},l.prototype.show=function(L){var U=this;return U.options.dataOnly||(clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.addToDom(),U.restCallback(),setTimeout((function(){U.ui.el.style.opacity=1}),0),U.showTimeout=setTimeout((function(){U.trigger("shown",U.instance),"function"==typeof L&&L.call(this)}),U.options.fadeTime)),U},l.prototype.hide=function(L){var U=this;if(U.options.dataOnly)return U;if(U.ui.el.style.opacity=U.options.restOpacity,clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.removeTimeout=setTimeout((function(){var x="dynamic"===U.options.mode?"none":"block";U.ui.el.style.display=x,"function"==typeof L&&L.call(U),U.trigger("hidden",U.instance)}),U.options.fadeTime),U.options.restJoystick){var x=U.options.restJoystick,mL={};mL.x=!0===x||!1!==x.x?0:U.instance.frontPosition.x,mL.y=!0===x||!1!==x.y?0:U.instance.frontPosition.y,U.setPosition(L,mL)}return U},l.prototype.setPosition=function(L,U){var x=this;x.frontPosition={x:U.x,y:U.y};var mL=x.options.fadeTime+"ms",p={};p.front=b("transition",["transform"],mL);var G={front:{}};G.front={transform:"translate("+x.frontPosition.x+"px,"+x.frontPosition.y+"px)"},x.applyStyles(p),x.applyStyles(G),x.restTimeout=setTimeout((function(){"function"==typeof L&&L.call(x),x.restCallback()}),x.options.fadeTime)},l.prototype.restCallback=function(){var L=this,U={};U.front=b("transition","none",""),L.applyStyles(U),L.trigger("rested",L.instance)},l.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},l.prototype.computeDirection=function(L){var U,x,mL,p=L.angle.radian,G=Math.PI/4,F=Math.PI/2;if(p>G&&p<3*G&&!L.lockX?U="up":p>-G&&p<=G&&!L.lockY?U="left":p>3*-G&&p<=-G&&!L.lockX?U="down":L.lockY||(U="right"),L.lockY||(x=p>-F&&p<F?"left":"right"),L.lockX||(mL=p>0?"up":"down"),L.force>this.options.threshold){var a,o={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(o[a]=this.direction[a]);var A={};for(a in this.direction={x:x,y:mL,angle:U},L.direction=this.direction,o)o[a]===this.direction[a]&&(A[a]=!0);if(A.x&&A.y&&A.angle)return L;A.x&&A.y||this.trigger("plain",L),A.x||this.trigger("plain:"+x,L),A.y||this.trigger("plain:"+mL,L),A.angle||this.trigger("dir dir:"+U,L)}else this.resetDirection();return L};const i=l;function X(L,U){var x=this;x.nipples=[],x.idles=[],x.actives=[],x.ids=[],x.pressureIntervals={},x.manager=L,x.id=X.id,X.id+=1,x.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},x.config(U),"static"!==x.options.mode&&"semi"!==x.options.mode||(x.options.multitouch=!1),x.options.multitouch||(x.options.maxNumberOfNipples=1);var mL=getComputedStyle(x.options.zone.parentElement);return mL&&"flex"===mL.display&&(x.parentIsFlex=!0),x.updateBox(),x.prepareNipples(),x.iE(),x.begin(),x.nipples}X.prototype=new K,X.constructor=X,X.id=0,X.prototype.prepareNipples=function(){var L=this,U=L.nipples;U.on=L.on.bind(L),U.off=L.off.bind(L),U.options=L.options,U.destroy=L.destroy.bind(L),U.ids=L.ids,U.id=L.id,U.processOnMove=L.processOnMove.bind(L),U.processOnEnd=L.processOnEnd.bind(L),U.get=function(L){if(void 0===L)return U[0];for(var x=0,mL=U.length;x<mL;x+=1)if(U[x].identifier===L)return U[x];return!1}},X.prototype.iE=function(){var L=this;L.bindEvt(L.options.zone,"start"),L.options.zone.style.touchAction="none",L.options.zone.style.msTouchAction="none"},X.prototype.begin=function(){var L=this,U=L.options;if("static"===U.mode){var x=L.createNipple(U.position,L.manager.getIdentifier());x.add(),L.idles.push(x)}},X.prototype.createNipple=function(L,U){var x=this,mL=x.manager.scroll,p={},G=x.options,F=x.parentIsFlex?mL.x:mL.x+x.box.left,a=x.parentIsFlex?mL.y:mL.y+x.box.top;if(L.x&&L.y)p={x:L.x-F,y:L.y-a};else if(L.top||L.right||L.bottom||L.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=L.top,o.style.right=L.right,o.style.bottom=L.bottom,o.style.left=L.left,o.style.position="absolute",G.zone.appendChild(o);var A=o.getBoundingClientRect();G.zone.removeChild(o),p=L,L={x:A.left+mL.x,y:A.top+mL.y}}var r=new i(x,{color:G.color,size:G.size,threshold:G.threshold,fadeTime:G.fadeTime,dataOnly:G.dataOnly,restJoystick:G.restJoystick,restOpacity:G.restOpacity,mode:G.mode,identifier:U,position:L,zone:G.zone,frontPosition:{x:0,y:0},shape:G.shape});return G.dataOnly||(h(r.ui.el,p),h(r.ui.front,r.frontPosition)),x.nipples.push(r),x.trigger("added "+r.identifier+":added",r),x.manager.trigger("added "+r.identifier+":added",r),x.bindNipple(r),r},X.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},X.prototype.bindNipple=function(L){var U,x=this,mL=function(L,mL){U=L.type+" "+mL.id+":"+L.type,x.trigger(U,mL)};L.on("destroyed",x.onDestroyed.bind(x)),L.on("shown hidden rested dir plain",mL),L.on("dir:up dir:right dir:down dir:left",mL),L.on("plain:up plain:right plain:down plain:left",mL)},X.prototype.pressureFn=function(L,U,x){var mL=this,p=0;clearInterval(mL.pressureIntervals[x]),mL.pressureIntervals[x]=setInterval(function(){var x=L.force||L.pressure||L.webkitForce||0;x!==p&&(U.trigger("pressure",x),mL.trigger("pressure "+U.identifier+":pressure",x),p=x)}.bind(mL),100)},X.prototype.onstart=function(L){var U=this,x=U.options,mL=L;return L=A(L),U.updateBox(),S(L,(function(p){U.actives.length<x.maxNumberOfNipples?U.processOnStart(p):mL.type.match(/^touch/)&&(Object.keys(U.manager.ids).forEach((function(x){if(Object.values(mL.touches).findIndex((function(L){return L.identifier===x}))<0){var p=[L[0]];p.identifier=x,U.processOnEnd(p)}})),U.actives.length<x.maxNumberOfNipples&&U.processOnStart(p))})),U.manager.bindDocument(),!1},X.prototype.processOnStart=function(L){var U,x=this,p=x.options,G=x.manager.getIdentifier(L),F=L.force||L.pressure||L.webkitForce||0,a={x:L.pageX,y:L.pageY},o=x.getOrCreate(G,a);o.identifier!==G&&x.manager.removeIdentifier(o.identifier),o.identifier=G;var A=function(U){U.trigger("start",U),x.trigger("start "+U.id+":start",U),U.show(),F>0&&x.pressureFn(L,U,U.identifier),x.processOnMove(L)};if((U=x.idles.indexOf(o))>=0&&x.idles.splice(U,1),x.actives.push(o),x.ids.push(o.identifier),"semi"!==p.mode)A(o);else{if(!(mL(a,o.position)<=p.catchDistance))return o.destroy(),void x.processOnStart(L);A(o)}return o},X.prototype.getOrCreate=function(L,U){var x,mL=this,p=mL.options;return/(semi|static)/.test(p.mode)?(x=mL.idles[0])?(mL.idles.splice(0,1),x):"semi"===p.mode?mL.createNipple(U,L):(console.warn("Coudln't find the needed nipple."),!1):x=mL.createNipple(U,L)},X.prototype.processOnMove=function(L){var U=this,x=U.options,G=U.manager.getIdentifier(L),F=U.nipples.get(G),a=U.manager.scroll;if(function(L){return isNaN(L.buttons)?0!==L.pressure:0!==L.buttons}(L)){if(!F)return console.error("Found zombie joystick with ID "+G),void U.manager.removeIdentifier(G);if(x.dynamicPage){var o=F.el.getBoundingClientRect();F.position={x:a.x+o.left,y:a.y+o.top}}F.identifier=G;var A=F.options.size/2,r={x:L.pageX,y:L.pageY};x.lockX&&(r.y=F.position.y),x.lockY&&(r.x=F.position.x);var h,b,E,Y,S,V,H,Q,q,f,v=mL(r,F.position),D=(h=r,E=(b=F.position).x-h.x,Y=b.y-h.y,function(L){return L*(180/Math.PI)}(Math.atan2(Y,E))),P=p(D),d=v/A,K={distance:v,position:r};if("circle"===F.options.shape?(S=Math.min(v,A),H=F.position,Q=S,f={x:0,y:0},q=p(q=D),f.x=H.x-Q*Math.cos(q),f.y=H.y-Q*Math.sin(q),V=f):(V=function(L,U,x){return{x:Math.min(Math.max(L.x,U.x-x),U.x+x),y:Math.min(Math.max(L.y,U.y-x),U.y+x)}}(r,F.position,A),S=mL(V,F.position)),x.follow){if(v>A){var l=r.x-V.x,i=r.y-V.y;F.position.x+=l,F.position.y+=i,F.el.style.top=F.position.y-(U.box.top+a.y)+"px",F.el.style.left=F.position.x-(U.box.left+a.x)+"px",v=mL(r,F.position)}}else r=V,v=S;var X=r.x-F.position.x,t=r.y-F.position.y;F.frontPosition={x:X,y:t},x.dataOnly||(F.ui.front.style.transform="translate("+X+"px,"+t+"px)");var y={identifier:F.identifier,position:r,force:d,pressure:L.force||L.pressure||L.webkitForce||0,distance:v,angle:{radian:P,degree:D},vector:{x:X/A,y:-t/A},raw:K,instance:F,lockX:x.lockX,lockY:x.lockY};(y=F.computeDirection(y)).angle={radian:p(180-D),degree:180-D},F.trigger("move",y),U.trigger("move "+F.id+":move",y)}else this.processOnEnd(L)},X.prototype.processOnEnd=function(L){var U=this,x=U.options,mL=U.manager.getIdentifier(L),p=U.nipples.get(mL),G=U.manager.removeIdentifier(p.identifier);p&&(x.dataOnly||p.hide((function(){"dynamic"===x.mode&&(p.trigger("removed",p),U.trigger("removed "+p.id+":removed",p),U.manager.trigger("removed "+p.id+":removed",p),p.destroy())})),clearInterval(U.pressureIntervals[p.identifier]),p.resetDirection(),p.trigger("end",p),U.trigger("end "+p.id+":end",p),U.ids.indexOf(p.identifier)>=0&&U.ids.splice(U.ids.indexOf(p.identifier),1),U.actives.indexOf(p)>=0&&U.actives.splice(U.actives.indexOf(p),1),/(semi|static)/.test(x.mode)?U.idles.push(p):U.nipples.indexOf(p)>=0&&U.nipples.splice(U.nipples.indexOf(p),1),U.manager.unbindDocument(),/(semi|static)/.test(x.mode)&&(U.manager.ids[G.id]=G.identifier))},X.prototype.onDestroyed=function(L,U){var x=this;x.nipples.indexOf(U)>=0&&x.nipples.splice(x.nipples.indexOf(U),1),x.actives.indexOf(U)>=0&&x.actives.splice(x.actives.indexOf(U),1),x.idles.indexOf(U)>=0&&x.idles.splice(x.idles.indexOf(U),1),x.ids.indexOf(U.identifier)>=0&&x.ids.splice(x.ids.indexOf(U.identifier),1),x.manager.removeIdentifier(U.identifier),x.manager.unbindDocument()},X.prototype.destroy=function(){var L=this;for(var U in L.unbindEvt(L.options.zone,"start"),L.nipples.forEach((function(L){L.destroy()})),L.pressureIntervals)L.pressureIntervals.hasOwnProperty(U)&&clearInterval(L.pressureIntervals[U]);L.trigger("destroyed",L.nipples),L.manager.unbindDocument(),L.off()};const t=X;function y(L){var U=this;U.ids={},U.index=0,U.collections=[],U.scroll=r(),U.config(L),U.prepareCollections();var x=function(){var L;U.collections.forEach((function(x){x.forEach((function(x){L=x.el.getBoundingClientRect(),x.position={x:U.scroll.x+L.left,y:U.scroll.y+L.top}}))}))};a(window,"resize",(function(){F(x)}));var mL=function(){U.scroll=r()};return a(window,"scroll",(function(){F(mL)})),U.collections}y.prototype=new K,y.constructor=y,y.prototype.prepareCollections=function(){var L=this;L.collections.create=L.create.bind(L),L.collections.on=L.on.bind(L),L.collections.off=L.off.bind(L),L.collections.destroy=L.destroy.bind(L),L.collections.get=function(U){var x;return L.collections.every((function(L){return!(x=L.get(U))})),x}},y.prototype.create=function(L){return this.createCollection(L)},y.prototype.createCollection=function(L){var U=this,x=new t(U,L);return U.bindCollection(x),U.collections.push(x),x},y.prototype.bindCollection=function(L){var U,x=this,mL=function(L,mL){U=L.type+" "+mL.id+":"+L.type,x.trigger(U,mL)};L.on("destroyed",x.onDestroyed.bind(x)),L.on("shown hidden rested dir plain",mL),L.on("dir:up dir:right dir:down dir:left",mL),L.on("plain:up plain:right plain:down plain:left",mL)},y.prototype.bindDocument=function(){var L=this;L.binded||(L.bindEvt(document,"move").bindEvt(document,"end"),L.binded=!0)},y.prototype.unbindDocument=function(L){var U=this;Object.keys(U.ids).length&&!0!==L||(U.unbindEvt(document,"move").unbindEvt(document,"end"),U.binded=!1)},y.prototype.getIdentifier=function(L){var U;return L?void 0===(U=void 0===L.identifier?L.pointerId:L.identifier)&&(U=this.latest||0):U=this.index,void 0===this.ids[U]&&(this.ids[U]=this.index,this.index+=1),this.latest=U,this.ids[U]},y.prototype.removeIdentifier=function(L){var U={};for(var x in this.ids)if(this.ids[x]===L){U.id=x,U.identifier=this.ids[x],delete this.ids[x];break}return U},y.prototype.onmove=function(L){return this.onAny("move",L),!1},y.prototype.onend=function(L){return this.onAny("end",L),!1},y.prototype.oncancel=function(L){return this.onAny("end",L),!1},y.prototype.onAny=function(L,U){var x,mL=this,p="processOn"+L.charAt(0).toUpperCase()+L.slice(1);U=A(U);var G=function(L,U,x){x.ids.indexOf(U)>=0&&(x[p](L),L._found_=!0)};return S(U,(function(L){x=mL.getIdentifier(L),S(mL.collections,G.bind(null,L,x)),L._found_||mL.removeIdentifier(x)})),!1},y.prototype.destroy=function(){var L=this;L.unbindDocument(!0),L.ids={},L.index=0,L.collections.forEach((function(L){L.destroy()})),L.off()},y.prototype.onDestroyed=function(L,U){var x=this;if(x.collections.indexOf(U)<0)return!1;x.collections.splice(x.collections.indexOf(U),1)};var n=new y;const N={create:function(L){return n.create(L)},factory:n};return U.default})(),L.exports=U()},13739:(L,U,x)=>{"use strict";const{Deflate:mL,deflate:p,deflateRaw:G,gzip:F}=x(13748),{Inflate:a,inflate:o,inflateRaw:A,ungzip:r}=x(13811),h=x(13785);L.exports.Deflate=mL,L.exports.deflate=p,L.exports.deflateRaw=G,L.exports.gzip=F,L.exports.Inflate=a,L.exports.inflate=o,L.exports.inflateRaw=A,L.exports.ungzip=r,L.exports.constants=h},13748:(L,U,x)=>{"use strict";const mL=x(13754),p=x(13792),G=x(13795),F=x(13776),a=x(13803),o=Object.prototype.toString,{Z_NO_FLUSH:A,Z_SYNC_FLUSH:r,Z_FULL_FLUSH:h,Z_FINISH:b,Z_OK:E,Z_STREAM_END:Y,Z_DEFAULT_COMPRESSION:S,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:H}=x(13785);function Q(L){this.options=p.assign({level:S,method:H,zL:16384,windowBits:15,memLevel:8,strategy:V},L||{});let U=this.options;U.raw&&U.windowBits>0?U.windowBits=-U.windowBits:U.gzip&&U.windowBits>0&&U.windowBits<16&&(U.windowBits+=16),this.err=0,this.AU="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let x=mL.deflateInit2(this.strm,U.level,U.method,U.windowBits,U.memLevel,U.strategy);if(x!==E)throw new Error(F[x]);if(U.header&&mL.deflateSetHeader(this.strm,U.header),U.dictionary){let L;if(L="string"===typeof U.dictionary?G.string2buf(U.dictionary):"[object ArrayBuffer]"===o.call(U.dictionary)?new Uint8Array(U.dictionary):U.dictionary,x=mL.deflateSetDictionary(this.strm,L),x!==E)throw new Error(F[x]);this._dict_set=!0}}function q(L,U){const x=new Q(U);if(x.push(L,!0),x.err)throw x.AU||F[x.err];return x.result}Q.prototype.push=function(L,U){const x=this.strm,p=this.options.zL;let F,a;if(this.ended)return!1;for(a=U===~~U?U:!0===U?b:A,"string"===typeof L?x.input=G.string2buf(L):"[object ArrayBuffer]"===o.call(L)?x.input=new Uint8Array(L):x.input=L,x.next_in=0,x.avail_in=x.input.length;;)if(0===x.avail_out&&(x.output=new Uint8Array(p),x.next_out=0,x.avail_out=p),(a===r||a===h)&&x.avail_out<=6)this.onData(x.output.subarray(0,x.next_out)),x.avail_out=0;else{if(F=mL.deflate(x,a),F===Y)return x.next_out>0&&this.onData(x.output.subarray(0,x.next_out)),F=mL.deflateEnd(this.strm),this.onEnd(F),this.ended=!0,F===E;if(0!==x.avail_out){if(a>0&&x.next_out>0)this.onData(x.output.subarray(0,x.next_out)),x.avail_out=0;else if(0===x.avail_in)break}else this.onData(x.output)}return!0},Q.prototype.onData=function(L){this.chunks.push(L)},Q.prototype.onEnd=function(L){L===E&&(this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.AU=this.strm.AU},L.exports.Deflate=Q,L.exports.deflate=q,L.exports.deflateRaw=function(L,U){return(U=U||{}).raw=!0,q(L,U)},L.exports.gzip=function(L,U){return(U=U||{}).gzip=!0,q(L,U)},L.exports.constants=x(13785)},13811:(L,U,x)=>{"use strict";const mL=x(13818),p=x(13792),G=x(13795),F=x(13776),a=x(13803),o=x(13836),A=Object.prototype.toString,{Z_NO_FLUSH:r,Z_FINISH:h,Z_OK:b,Z_STREAM_END:E,Z_NEED_DICT:Y,Z_STREAM_ERROR:S,Z_DATA_ERROR:V,Z_MEM_ERROR:H}=x(13785);function Q(L){this.options=p.assign({zL:65536,windowBits:15,to:""},L||{});const U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,0===U.windowBits&&(U.windowBits=-15)),!(U.windowBits>=0&&U.windowBits<16)||L&&L.windowBits||(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&0===(15&U.windowBits)&&(U.windowBits|=15),this.err=0,this.AU="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let x=mL.inflateInit2(this.strm,U.windowBits);if(x!==b)throw new Error(F[x]);if(this.header=new o,mL.inflateGetHeader(this.strm,this.header),U.dictionary&&("string"===typeof U.dictionary?U.dictionary=G.string2buf(U.dictionary):"[object ArrayBuffer]"===A.call(U.dictionary)&&(U.dictionary=new Uint8Array(U.dictionary)),U.raw&&(x=mL.inflateSetDictionary(this.strm,U.dictionary),x!==b)))throw new Error(F[x])}function q(L,U){const x=new Q(U);if(x.push(L),x.err)throw x.AU||F[x.err];return x.result}Q.prototype.push=function(L,U){const x=this.strm,p=this.options.zL,F=this.options.dictionary;let a,o,Q;if(this.ended)return!1;for(o=U===~~U?U:!0===U?h:r,"[object ArrayBuffer]"===A.call(L)?x.input=new Uint8Array(L):x.input=L,x.next_in=0,x.avail_in=x.input.length;;){for(0===x.avail_out&&(x.output=new Uint8Array(p),x.next_out=0,x.avail_out=p),a=mL.inflate(x,o),a===Y&&F&&(a=mL.inflateSetDictionary(x,F),a===b?a=mL.inflate(x,o):a===V&&(a=Y));x.avail_in>0&&a===E&&x.state.wrap>0&&0!==L[x.next_in];)mL.inflateReset(x),a=mL.inflate(x,o);switch(a){case S:case V:case Y:case H:return this.onEnd(a),this.ended=!0,!1}if(Q=x.avail_out,x.next_out&&(0===x.avail_out||a===E))if("string"===this.options.to){let L=G.utf8border(x.output,x.next_out),U=x.next_out-L,mL=G.buf2string(x.output,L);x.next_out=U,x.avail_out=p-U,U&&x.output.set(x.output.subarray(L,L+U),0),this.onData(mL)}else this.onData(x.output.length===x.next_out?x.output:x.output.subarray(0,x.next_out));if(a!==b||0!==Q){if(a===E)return a=mL.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===x.avail_in)break}}return!0},Q.prototype.onData=function(L){this.chunks.push(L)},Q.prototype.onEnd=function(L){L===b&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.AU=this.strm.AU},L.exports.Inflate=Q,L.exports.inflate=q,L.exports.inflateRaw=function(L,U){return(U=U||{}).raw=!0,q(L,U)},L.exports.ungzip=q,L.exports.constants=x(13785)},13792:L=>{"use strict";const U=(L,U)=>Object.prototype.hasOwnProperty.call(L,U);L.exports.assign=function(L){const x=Array.prototype.slice.call(arguments,1);for(;x.length;){const mL=x.shift();if(mL){if("object"!==typeof mL)throw new TypeError(mL+"must be non-object");for(const x in mL)U(mL,x)&&(L[x]=mL[x])}}return L},L.exports.flattenChunks=L=>{let U=0;for(let mL=0,p=L.length;mL<p;mL++)U+=L[mL].length;const x=new Uint8Array(U);for(let mL=0,p=0,G=L.length;mL<G;mL++){let U=L[mL];x.set(U,p),p+=U.length}return x}},13795:L=>{"use strict";let U=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(mL){U=!1}const x=new Uint8Array(256);for(let p=0;p<256;p++)x[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;x[254]=x[254]=1,L.exports.string2buf=L=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(L);let U,x,mL,p,G,F=L.length,a=0;for(p=0;p<F;p++)x=L.charCodeAt(p),55296===(64512&x)&&p+1<F&&(mL=L.charCodeAt(p+1),56320===(64512&mL)&&(x=65536+(x-55296<<10)+(mL-56320),p++)),a+=x<128?1:x<2048?2:x<65536?3:4;for(U=new Uint8Array(a),G=0,p=0;G<a;p++)x=L.charCodeAt(p),55296===(64512&x)&&p+1<F&&(mL=L.charCodeAt(p+1),56320===(64512&mL)&&(x=65536+(x-55296<<10)+(mL-56320),p++)),x<128?U[G++]=x:x<2048?(U[G++]=192|x>>>6,U[G++]=128|63&x):x<65536?(U[G++]=224|x>>>12,U[G++]=128|x>>>6&63,U[G++]=128|63&x):(U[G++]=240|x>>>18,U[G++]=128|x>>>12&63,U[G++]=128|x>>>6&63,U[G++]=128|63&x);return U};L.exports.buf2string=(L,mL)=>{const p=mL||L.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(L.subarray(0,mL));let G,F;const a=new Array(2*p);for(F=0,G=0;G<p;){let U=L[G++];if(U<128){a[F++]=U;continue}let mL=x[U];if(mL>4)a[F++]=65533,G+=mL-1;else{for(U&=2===mL?31:3===mL?15:7;mL>1&&G<p;)U=U<<6|63&L[G++],mL--;mL>1?a[F++]=65533:U<65536?a[F++]=U:(U-=65536,a[F++]=55296|U>>10&1023,a[F++]=56320|1023&U)}}return((L,x)=>{if(x<65534&&L.subarray&&U)return String.fromCharCode.apply(null,L.length===x?L:L.subarray(0,x));let mL="";for(let U=0;U<x;U++)mL+=String.fromCharCode(L[U]);return mL})(a,F)},L.exports.utf8border=(L,U)=>{(U=U||L.length)>L.length&&(U=L.length);let mL=U-1;for(;mL>=0&&128===(192&L[mL]);)mL--;return mL<0||0===mL?U:mL+x[L[mL]]>U?mL:U}},13765:L=>{"use strict";L.exports=(L,U,x,mL)=>{let p=65535&L,G=L>>>16&65535,F=0;for(;0!==x;){F=x>2e3?2e3:x,x-=F;do{p=p+U[mL++]|0,G=G+p|0}while(--F);p%=65521,G%=65521}return p|G<<16}},13785:L=>{"use strict";L.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13767:L=>{"use strict";const U=new Uint32Array((()=>{let L,U=[];for(var x=0;x<256;x++){L=x;for(var mL=0;mL<8;mL++)L=1&L?3988292384^L>>>1:L>>>1;U[x]=L}return U})());L.exports=(L,x,mL,p)=>{const G=U,F=p+mL;L^=-1;for(let U=p;U<F;U++)L=L>>>8^G[255&(L^x[U])];return~L}},13754:(L,U,x)=>{"use strict";const{_tr_init:mL,_tr_stored_block:p,_tr_flush_block:G,_tr_tally:F,_tr_align:a}=x(13760),o=x(13765),A=x(13767),r=x(13776),{Z_NO_FLUSH:h,Z_PARTIAL_FLUSH:b,Z_FULL_FLUSH:E,Z_FINISH:Y,Z_BLOCK:S,Z_OK:V,Z_STREAM_END:H,Z_STREAM_ERROR:Q,Z_DATA_ERROR:q,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:v,Z_FILTERED:D,Z_HUFFMAN_ONLY:P,Z_RLE:d,Z_FIXED:K,Z_DEFAULT_STRATEGY:l,Z_UNKNOWN:i,Z_DEFLATED:X}=x(13785),t=258,y=262,n=103,N=113,e=666,u=(L,U)=>(L.AU=r[U],U),Z=L=>(L<<1)-(L>4?9:0),g=L=>{let U=L.length;for(;--U>=0;)L[U]=0};let z=(L,U,x)=>(U<<L.hash_shift^x)&L.hash_mask;const M=L=>{const U=L.state;let x=U.pending;x>L.avail_out&&(x=L.avail_out),0!==x&&(L.output.set(U.pending_buf.subarray(U.pending_out,U.pending_out+x),L.next_out),L.next_out+=x,U.pending_out+=x,L.total_out+=x,L.avail_out-=x,U.pending-=x,0===U.pending&&(U.pending_out=0))},J=(L,U)=>{G(L,L.block_start>=0?L.block_start:-1,L.strstart-L.block_start,U),L.block_start=L.strstart,M(L.strm)},j=(L,U)=>{L.pending_buf[L.pending++]=U},R=(L,U)=>{L.pending_buf[L.pending++]=U>>>8&255,L.pending_buf[L.pending++]=255&U},c=(L,U,x,mL)=>{let p=L.avail_in;return p>mL&&(p=mL),0===p?0:(L.avail_in-=p,U.set(L.input.subarray(L.next_in,L.next_in+p),x),1===L.state.wrap?L.adler=o(L.adler,U,p,x):2===L.state.wrap&&(L.adler=A(L.adler,U,p,x)),L.next_in+=p,L.total_in+=p,p)},W=(L,U)=>{let x,mL,p=L.max_chain_length,G=L.strstart,F=L.prev_length,a=L.nice_match;const o=L.strstart>L.w_size-y?L.strstart-(L.w_size-y):0,A=L.window,r=L.w_mask,h=L.prev,b=L.strstart+t;let E=A[G+F-1],Y=A[G+F];L.prev_length>=L.good_match&&(p>>=2),a>L.lookahead&&(a=L.lookahead);do{if(x=U,A[x+F]===Y&&A[x+F-1]===E&&A[x]===A[G]&&A[++x]===A[G+1]){G+=2,x++;do{}while(A[++G]===A[++x]&&A[++G]===A[++x]&&A[++G]===A[++x]&&A[++G]===A[++x]&&A[++G]===A[++x]&&A[++G]===A[++x]&&A[++G]===A[++x]&&A[++G]===A[++x]&&G<b);if(mL=t-(b-G),G=b-t,mL>F){if(L.match_start=U,F=mL,mL>=a)break;E=A[G+F-1],Y=A[G+F]}}}while((U=h[U&r])>o&&0!==--p);return F<=L.lookahead?F:L.lookahead},I=L=>{const U=L.w_size;let x,mL,p,G,F;do{if(G=L.window_size-L.lookahead-L.strstart,L.strstart>=U+(U-y)){L.window.set(L.window.subarray(U,U+U),0),L.match_start-=U,L.strstart-=U,L.block_start-=U,mL=L.hash_size,x=mL;do{p=L.head[--x],L.head[x]=p>=U?p-U:0}while(--mL);mL=U,x=mL;do{p=L.prev[--x],L.prev[x]=p>=U?p-U:0}while(--mL);G+=U}if(0===L.strm.avail_in)break;if(mL=c(L.strm,L.window,L.strstart+L.lookahead,G),L.lookahead+=mL,L.lookahead+L.insert>=3)for(F=L.strstart-L.insert,L.ins_h=L.window[F],L.ins_h=z(L,L.ins_h,L.window[F+1]);L.insert&&(L.ins_h=z(L,L.ins_h,L.window[F+3-1]),L.prev[F&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=F,F++,L.insert--,!(L.lookahead+L.insert<3)););}while(L.lookahead<y&&0!==L.strm.avail_in)},w=(L,U)=>{let x,mL;for(;;){if(L.lookahead<y){if(I(L),L.lookahead<y&&U===h)return 1;if(0===L.lookahead)break}if(x=0,L.lookahead>=3&&(L.ins_h=z(L,L.ins_h,L.window[L.strstart+3-1]),x=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),0!==x&&L.strstart-x<=L.w_size-y&&(L.match_length=W(L,x)),L.match_length>=3)if(mL=F(L,L.strstart-L.match_start,L.match_length-3),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=3){L.match_length--;do{L.strstart++,L.ins_h=z(L,L.ins_h,L.window[L.strstart+3-1]),x=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart}while(0!==--L.match_length);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=z(L,L.ins_h,L.window[L.strstart+1]);else mL=F(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(mL&&(J(L,!1),0===L.strm.avail_out))return 1}return L.insert=L.strstart<2?L.strstart:2,U===Y?(J(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(J(L,!1),0===L.strm.avail_out)?1:2},B=(L,U)=>{let x,mL,p;for(;;){if(L.lookahead<y){if(I(L),L.lookahead<y&&U===h)return 1;if(0===L.lookahead)break}if(x=0,L.lookahead>=3&&(L.ins_h=z(L,L.ins_h,L.window[L.strstart+3-1]),x=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=2,0!==x&&L.prev_length<L.max_lazy_match&&L.strstart-x<=L.w_size-y&&(L.match_length=W(L,x),L.match_length<=5&&(L.strategy===D||3===L.match_length&&L.strstart-L.match_start>4096)&&(L.match_length=2)),L.prev_length>=3&&L.match_length<=L.prev_length){p=L.strstart+L.lookahead-3,mL=F(L,L.strstart-1-L.prev_match,L.prev_length-3),L.lookahead-=L.prev_length-1,L.prev_length-=2;do{++L.strstart<=p&&(L.ins_h=z(L,L.ins_h,L.window[L.strstart+3-1]),x=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart)}while(0!==--L.prev_length);if(L.match_available=0,L.match_length=2,L.strstart++,mL&&(J(L,!1),0===L.strm.avail_out))return 1}else if(L.match_available){if(mL=F(L,0,L.window[L.strstart-1]),mL&&J(L,!1),L.strstart++,L.lookahead--,0===L.strm.avail_out)return 1}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(mL=F(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<2?L.strstart:2,U===Y?(J(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(J(L,!1),0===L.strm.avail_out)?1:2};function s(L,U,x,mL,p){this.good_length=L,this.max_lazy=U,this.nice_length=x,this.max_chain=mL,this.func=p}const C=[new s(0,0,0,0,((L,U)=>{let x=65535;for(x>L.pending_buf_size-5&&(x=L.pending_buf_size-5);;){if(L.lookahead<=1){if(I(L),0===L.lookahead&&U===h)return 1;if(0===L.lookahead)break}L.strstart+=L.lookahead,L.lookahead=0;const mL=L.block_start+x;if((0===L.strstart||L.strstart>=mL)&&(L.lookahead=L.strstart-mL,L.strstart=mL,J(L,!1),0===L.strm.avail_out))return 1;if(L.strstart-L.block_start>=L.w_size-y&&(J(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,U===Y?(J(L,!0),0===L.strm.avail_out?3:4):(L.strstart>L.block_start&&(J(L,!1),L.strm.avail_out),1)})),new s(4,4,8,4,w),new s(4,5,16,8,w),new s(4,6,32,32,w),new s(4,4,16,16,B),new s(8,16,32,32,B),new s(8,16,128,128,B),new s(8,32,128,256,B),new s(32,128,258,1024,B),new s(32,258,258,4096,B)];function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=X,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const T=L=>{if(!L||!L.state)return u(L,Q);L.total_in=L.total_out=0,L.data_type=i;const U=L.state;return U.pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?42:N,L.adler=2===U.wrap?0:1,U.last_flush=h,mL(U),V},O=L=>{const U=T(L);var x;return U===V&&((x=L.state).window_size=2*x.w_size,g(x.head),x.max_lazy_match=C[x.level].max_lazy,x.good_match=C[x.level].good_length,x.nice_match=C[x.level].nice_length,x.max_chain_length=C[x.level].max_chain,x.strstart=0,x.block_start=0,x.lookahead=0,x.insert=0,x.match_length=x.prev_length=2,x.match_available=0,x.ins_h=0),U},LL=(L,U,x,mL,p,G)=>{if(!L)return Q;let F=1;if(U===v&&(U=6),mL<0?(F=0,mL=-mL):mL>15&&(F=2,mL-=16),p<1||p>9||x!==X||mL<8||mL>15||U<0||U>9||G<0||G>K)return u(L,Q);8===mL&&(mL=9);const a=new k;return L.state=a,a.strm=L,a.wrap=F,a.gzhead=null,a.w_bits=mL,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=p+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<p+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=U,a.strategy=G,a.method=x,O(L)};L.exports.deflateInit=(L,U)=>LL(L,U,X,15,8,l),L.exports.deflateInit2=LL,L.exports.deflateReset=O,L.exports.deflateResetKeep=T,L.exports.deflateSetHeader=(L,U)=>L&&L.state?2!==L.state.wrap?Q:(L.state.gzhead=U,V):Q,L.exports.deflate=(L,U)=>{let x,mL;if(!L||!L.state||U>S||U<0)return L?u(L,Q):Q;const G=L.state;if(!L.output||!L.input&&0!==L.avail_in||G.status===e&&U!==Y)return u(L,0===L.avail_out?f:Q);G.strm=L;const o=G.last_flush;if(G.last_flush=U,42===G.status)if(2===G.wrap)L.adler=0,j(G,31),j(G,139),j(G,8),G.gzhead?(j(G,(G.gzhead.text?1:0)+(G.gzhead.hcrc?2:0)+(G.gzhead.extra?4:0)+(G.gzhead.name?8:0)+(G.gzhead.comment?16:0)),j(G,255&G.gzhead.time),j(G,G.gzhead.time>>8&255),j(G,G.gzhead.time>>16&255),j(G,G.gzhead.time>>24&255),j(G,9===G.level?2:G.strategy>=P||G.level<2?4:0),j(G,255&G.gzhead.os),G.gzhead.extra&&G.gzhead.extra.length&&(j(G,255&G.gzhead.extra.length),j(G,G.gzhead.extra.length>>8&255)),G.gzhead.hcrc&&(L.adler=A(L.adler,G.pending_buf,G.pending,0)),G.gzindex=0,G.status=69):(j(G,0),j(G,0),j(G,0),j(G,0),j(G,0),j(G,9===G.level?2:G.strategy>=P||G.level<2?4:0),j(G,3),G.status=N);else{let U=X+(G.w_bits-8<<4)<<8,x=-1;x=G.strategy>=P||G.level<2?0:G.level<6?1:6===G.level?2:3,U|=x<<6,0!==G.strstart&&(U|=32),U+=31-U%31,G.status=N,R(G,U),0!==G.strstart&&(R(G,L.adler>>>16),R(G,65535&L.adler)),L.adler=1}if(69===G.status)if(G.gzhead.extra){for(x=G.pending;G.gzindex<(65535&G.gzhead.extra.length)&&(G.pending!==G.pending_buf_size||(G.gzhead.hcrc&&G.pending>x&&(L.adler=A(L.adler,G.pending_buf,G.pending-x,x)),M(L),x=G.pending,G.pending!==G.pending_buf_size));)j(G,255&G.gzhead.extra[G.gzindex]),G.gzindex++;G.gzhead.hcrc&&G.pending>x&&(L.adler=A(L.adler,G.pending_buf,G.pending-x,x)),G.gzindex===G.gzhead.extra.length&&(G.gzindex=0,G.status=73)}else G.status=73;if(73===G.status)if(G.gzhead.name){x=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>x&&(L.adler=A(L.adler,G.pending_buf,G.pending-x,x)),M(L),x=G.pending,G.pending===G.pending_buf_size)){mL=1;break}mL=G.gzindex<G.gzhead.name.length?255&G.gzhead.name.charCodeAt(G.gzindex++):0,j(G,mL)}while(0!==mL);G.gzhead.hcrc&&G.pending>x&&(L.adler=A(L.adler,G.pending_buf,G.pending-x,x)),0===mL&&(G.gzindex=0,G.status=91)}else G.status=91;if(91===G.status)if(G.gzhead.comment){x=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>x&&(L.adler=A(L.adler,G.pending_buf,G.pending-x,x)),M(L),x=G.pending,G.pending===G.pending_buf_size)){mL=1;break}mL=G.gzindex<G.gzhead.comment.length?255&G.gzhead.comment.charCodeAt(G.gzindex++):0,j(G,mL)}while(0!==mL);G.gzhead.hcrc&&G.pending>x&&(L.adler=A(L.adler,G.pending_buf,G.pending-x,x)),0===mL&&(G.status=n)}else G.status=n;if(G.status===n&&(G.gzhead.hcrc?(G.pending+2>G.pending_buf_size&&M(L),G.pending+2<=G.pending_buf_size&&(j(G,255&L.adler),j(G,L.adler>>8&255),L.adler=0,G.status=N)):G.status=N),0!==G.pending){if(M(L),0===L.avail_out)return G.last_flush=-1,V}else if(0===L.avail_in&&Z(U)<=Z(o)&&U!==Y)return u(L,f);if(G.status===e&&0!==L.avail_in)return u(L,f);if(0!==L.avail_in||0!==G.lookahead||U!==h&&G.status!==e){let x=G.strategy===P?((L,U)=>{let x;for(;;){if(0===L.lookahead&&(I(L),0===L.lookahead)){if(U===h)return 1;break}if(L.match_length=0,x=F(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,x&&(J(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,U===Y?(J(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(J(L,!1),0===L.strm.avail_out)?1:2})(G,U):G.strategy===d?((L,U)=>{let x,mL,p,G;const a=L.window;for(;;){if(L.lookahead<=t){if(I(L),L.lookahead<=t&&U===h)return 1;if(0===L.lookahead)break}if(L.match_length=0,L.lookahead>=3&&L.strstart>0&&(p=L.strstart-1,mL=a[p],mL===a[++p]&&mL===a[++p]&&mL===a[++p])){G=L.strstart+t;do{}while(mL===a[++p]&&mL===a[++p]&&mL===a[++p]&&mL===a[++p]&&mL===a[++p]&&mL===a[++p]&&mL===a[++p]&&mL===a[++p]&&p<G);L.match_length=t-(G-p),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=3?(x=F(L,1,L.match_length-3),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(x=F(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),x&&(J(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,U===Y?(J(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(J(L,!1),0===L.strm.avail_out)?1:2})(G,U):C[G.level].func(G,U);if(3!==x&&4!==x||(G.status=e),1===x||3===x)return 0===L.avail_out&&(G.last_flush=-1),V;if(2===x&&(U===b?a(G):U!==S&&(p(G,0,0,!1),U===E&&(g(G.head),0===G.lookahead&&(G.strstart=0,G.block_start=0,G.insert=0))),M(L),0===L.avail_out))return G.last_flush=-1,V}return U!==Y?V:G.wrap<=0?H:(2===G.wrap?(j(G,255&L.adler),j(G,L.adler>>8&255),j(G,L.adler>>16&255),j(G,L.adler>>24&255),j(G,255&L.total_in),j(G,L.total_in>>8&255),j(G,L.total_in>>16&255),j(G,L.total_in>>24&255)):(R(G,L.adler>>>16),R(G,65535&L.adler)),M(L),G.wrap>0&&(G.wrap=-G.wrap),0!==G.pending?V:H)},L.exports.deflateEnd=L=>{if(!L||!L.state)return Q;const U=L.state.status;return 42!==U&&69!==U&&73!==U&&91!==U&&U!==n&&U!==N&&U!==e?u(L,Q):(L.state=null,U===N?u(L,q):V)},L.exports.deflateSetDictionary=(L,U)=>{let x=U.length;if(!L||!L.state)return Q;const mL=L.state,p=mL.wrap;if(2===p||1===p&&42!==mL.status||mL.lookahead)return Q;if(1===p&&(L.adler=o(L.adler,U,x,0)),mL.wrap=0,x>=mL.w_size){0===p&&(g(mL.head),mL.strstart=0,mL.block_start=0,mL.insert=0);let L=new Uint8Array(mL.w_size);L.set(U.subarray(x-mL.w_size,x),0),U=L,x=mL.w_size}const G=L.avail_in,F=L.next_in,a=L.input;for(L.avail_in=x,L.next_in=0,L.input=U,I(mL);mL.lookahead>=3;){let L=mL.strstart,U=mL.lookahead-2;do{mL.ins_h=z(mL,mL.ins_h,mL.window[L+3-1]),mL.prev[L&mL.w_mask]=mL.head[mL.ins_h],mL.head[mL.ins_h]=L,L++}while(--U);mL.strstart=L,mL.lookahead=2,I(mL)}return mL.strstart+=mL.lookahead,mL.block_start=mL.strstart,mL.insert=mL.lookahead,mL.lookahead=0,mL.match_length=mL.prev_length=2,mL.match_available=0,L.next_in=F,L.input=a,L.avail_in=G,mL.wrap=p,V},L.exports.deflateInfo="pako deflate (from Nodeca project)"},13836:L=>{"use strict";L.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13823:L=>{"use strict";L.exports=function(L,U){let x,mL,p,G,F,a,o,A,r,h,b,E,Y,S,V,H,Q,q,f,v,D,P,d,K;const l=L.state;x=L.next_in,d=L.input,mL=x+(L.avail_in-5),p=L.next_out,K=L.output,G=p-(U-L.avail_out),F=p+(L.avail_out-257),a=l.dmax,o=l.wsize,A=l.whave,r=l.wnext,h=l.window,b=l.hold,E=l.bits,Y=l.lencode,S=l.distcode,V=(1<<l.lenbits)-1,H=(1<<l.distbits)-1;L:do{E<15&&(b+=d[x++]<<E,E+=8,b+=d[x++]<<E,E+=8),Q=Y[b&V];U:for(;;){if(q=Q>>>24,b>>>=q,E-=q,q=Q>>>16&255,0===q)K[p++]=65535&Q;else{if(!(16&q)){if(0===(64&q)){Q=Y[(65535&Q)+(b&(1<<q)-1)];continue U}if(32&q){l.mode=12;break L}L.AU="invalid literal/length code",l.mode=30;break L}f=65535&Q,q&=15,q&&(E<q&&(b+=d[x++]<<E,E+=8),f+=b&(1<<q)-1,b>>>=q,E-=q),E<15&&(b+=d[x++]<<E,E+=8,b+=d[x++]<<E,E+=8),Q=S[b&H];x:for(;;){if(q=Q>>>24,b>>>=q,E-=q,q=Q>>>16&255,!(16&q)){if(0===(64&q)){Q=S[(65535&Q)+(b&(1<<q)-1)];continue x}L.AU="invalid distance code",l.mode=30;break L}if(v=65535&Q,q&=15,E<q&&(b+=d[x++]<<E,E+=8,E<q&&(b+=d[x++]<<E,E+=8)),v+=b&(1<<q)-1,v>a){L.AU="invalid distance too far back",l.mode=30;break L}if(b>>>=q,E-=q,q=p-G,v>q){if(q=v-q,q>A&&l.sane){L.AU="invalid distance too far back",l.mode=30;break L}if(D=0,P=h,0===r){if(D+=o-q,q<f){f-=q;do{K[p++]=h[D++]}while(--q);D=p-v,P=K}}else if(r<q){if(D+=o+r-q,q-=r,q<f){f-=q;do{K[p++]=h[D++]}while(--q);if(D=0,r<f){q=r,f-=q;do{K[p++]=h[D++]}while(--q);D=p-v,P=K}}}else if(D+=r-q,q<f){f-=q;do{K[p++]=h[D++]}while(--q);D=p-v,P=K}for(;f>2;)K[p++]=P[D++],K[p++]=P[D++],K[p++]=P[D++],f-=3;f&&(K[p++]=P[D++],f>1&&(K[p++]=P[D++]))}else{D=p-v;do{K[p++]=K[D++],K[p++]=K[D++],K[p++]=K[D++],f-=3}while(f>2);f&&(K[p++]=K[D++],f>1&&(K[p++]=K[D++]))}break}}break}}while(x<mL&&p<F);f=E>>3,x-=f,E-=f<<3,b&=(1<<E)-1,L.next_in=x,L.next_out=p,L.avail_in=x<mL?mL-x+5:5-(x-mL),L.avail_out=p<F?F-p+257:257-(p-F),l.hold=b,l.bits=E}},13818:(L,U,x)=>{"use strict";const mL=x(13765),p=x(13767),G=x(13823),F=x(13827),{Z_FINISH:a,Z_BLOCK:o,Z_TREES:A,Z_OK:r,Z_STREAM_END:h,Z_NEED_DICT:b,Z_STREAM_ERROR:E,Z_DATA_ERROR:Y,Z_MEM_ERROR:S,Z_BUF_ERROR:V,Z_DEFLATED:H}=x(13785),Q=12,q=30,f=L=>(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24);function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const D=L=>{if(!L||!L.state)return E;const U=L.state;return L.total_in=L.total_out=U.total=0,L.AU="",U.wrap&&(L.adler=1&U.wrap),U.mode=1,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new Int32Array(852),U.distcode=U.distdyn=new Int32Array(592),U.sane=1,U.back=-1,r},P=L=>{if(!L||!L.state)return E;const U=L.state;return U.wsize=0,U.whave=0,U.wnext=0,D(L)},d=(L,U)=>{let x;if(!L||!L.state)return E;const mL=L.state;return U<0?(x=0,U=-U):(x=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?E:(null!==mL.window&&mL.wbits!==U&&(mL.window=null),mL.wrap=x,mL.wbits=U,P(L))},K=(L,U)=>{if(!L)return E;const x=new v;L.state=x,x.window=null;const mL=d(L,U);return mL!==r&&(L.state=null),mL};let l,i,X=!0;const t=L=>{if(X){l=new Int32Array(512),i=new Int32Array(32);let U=0;for(;U<144;)L.lens[U++]=8;for(;U<256;)L.lens[U++]=9;for(;U<280;)L.lens[U++]=7;for(;U<288;)L.lens[U++]=8;for(F(1,L.lens,0,288,l,0,L.work,{bits:9}),U=0;U<32;)L.lens[U++]=5;F(2,L.lens,0,32,i,0,L.work,{bits:5}),X=!1}L.lencode=l,L.lenbits=9,L.distcode=i,L.distbits=5},y=(L,U,x,mL)=>{let p;const G=L.state;return null===G.window&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new Uint8Array(G.wsize)),mL>=G.wsize?(G.window.set(U.subarray(x-G.wsize,x),0),G.wnext=0,G.whave=G.wsize):(p=G.wsize-G.wnext,p>mL&&(p=mL),G.window.set(U.subarray(x-mL,x-mL+p),G.wnext),(mL-=p)?(G.window.set(U.subarray(x-mL,x),0),G.wnext=mL,G.whave=G.wsize):(G.wnext+=p,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=p))),0};L.exports.inflateReset=P,L.exports.inflateReset2=d,L.exports.inflateResetKeep=D,L.exports.inflateInit=L=>K(L,15),L.exports.inflateInit2=K,L.exports.inflate=(L,U)=>{let x,v,D,P,d,K,l,i,X,n,N,e,u,Z,g,z,M,J,j,R,c,W,I=0;const w=new Uint8Array(4);let B,s;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!L||!L.state||!L.output||!L.input&&0!==L.avail_in)return E;x=L.state,x.mode===Q&&(x.mode=13),d=L.next_out,D=L.output,l=L.avail_out,P=L.next_in,v=L.input,K=L.avail_in,i=x.hold,X=x.bits,n=K,N=l,W=r;L:for(;;)switch(x.mode){case 1:if(0===x.wrap){x.mode=13;break}for(;X<16;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(2&x.wrap&&35615===i){x.check=0,w[0]=255&i,w[1]=i>>>8&255,x.check=p(x.check,w,2,0),i=0,X=0,x.mode=2;break}if(x.flags=0,x.head&&(x.head.done=!1),!(1&x.wrap)||(((255&i)<<8)+(i>>8))%31){L.AU="incorrect header check",x.mode=q;break}if((15&i)!==H){L.AU="unknown compression method",x.mode=q;break}if(i>>>=4,X-=4,c=8+(15&i),0===x.wbits)x.wbits=c;else if(c>x.wbits){L.AU="invalid window size",x.mode=q;break}x.dmax=1<<x.wbits,L.adler=x.check=1,x.mode=512&i?10:Q,i=0,X=0;break;case 2:for(;X<16;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(x.flags=i,(255&x.flags)!==H){L.AU="unknown compression method",x.mode=q;break}if(57344&x.flags){L.AU="unknown header flags set",x.mode=q;break}x.head&&(x.head.text=i>>8&1),512&x.flags&&(w[0]=255&i,w[1]=i>>>8&255,x.check=p(x.check,w,2,0)),i=0,X=0,x.mode=3;case 3:for(;X<32;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}x.head&&(x.head.time=i),512&x.flags&&(w[0]=255&i,w[1]=i>>>8&255,w[2]=i>>>16&255,w[3]=i>>>24&255,x.check=p(x.check,w,4,0)),i=0,X=0,x.mode=4;case 4:for(;X<16;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}x.head&&(x.head.xflags=255&i,x.head.os=i>>8),512&x.flags&&(w[0]=255&i,w[1]=i>>>8&255,x.check=p(x.check,w,2,0)),i=0,X=0,x.mode=5;case 5:if(1024&x.flags){for(;X<16;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}x.length=i,x.head&&(x.head.extra_len=i),512&x.flags&&(w[0]=255&i,w[1]=i>>>8&255,x.check=p(x.check,w,2,0)),i=0,X=0}else x.head&&(x.head.extra=null);x.mode=6;case 6:if(1024&x.flags&&(e=x.length,e>K&&(e=K),e&&(x.head&&(c=x.head.extra_len-x.length,x.head.extra||(x.head.extra=new Uint8Array(x.head.extra_len)),x.head.extra.set(v.subarray(P,P+e),c)),512&x.flags&&(x.check=p(x.check,v,e,P)),K-=e,P+=e,x.length-=e),x.length))break L;x.length=0,x.mode=7;case 7:if(2048&x.flags){if(0===K)break L;e=0;do{c=v[P+e++],x.head&&c&&x.length<65536&&(x.head.name+=String.fromCharCode(c))}while(c&&e<K);if(512&x.flags&&(x.check=p(x.check,v,e,P)),K-=e,P+=e,c)break L}else x.head&&(x.head.name=null);x.length=0,x.mode=8;case 8:if(4096&x.flags){if(0===K)break L;e=0;do{c=v[P+e++],x.head&&c&&x.length<65536&&(x.head.comment+=String.fromCharCode(c))}while(c&&e<K);if(512&x.flags&&(x.check=p(x.check,v,e,P)),K-=e,P+=e,c)break L}else x.head&&(x.head.comment=null);x.mode=9;case 9:if(512&x.flags){for(;X<16;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(i!==(65535&x.check)){L.AU="header crc mismatch",x.mode=q;break}i=0,X=0}x.head&&(x.head.hcrc=x.flags>>9&1,x.head.done=!0),L.adler=x.check=0,x.mode=Q;break;case 10:for(;X<32;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}L.adler=x.check=f(i),i=0,X=0,x.mode=11;case 11:if(0===x.havedict)return L.next_out=d,L.avail_out=l,L.next_in=P,L.avail_in=K,x.hold=i,x.bits=X,b;L.adler=x.check=1,x.mode=Q;case Q:if(U===o||U===A)break L;case 13:if(x.last){i>>>=7&X,X-=7&X,x.mode=27;break}for(;X<3;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}switch(x.last=1&i,i>>>=1,X-=1,3&i){case 0:x.mode=14;break;case 1:if(t(x),x.mode=20,U===A){i>>>=2,X-=2;break L}break;case 2:x.mode=17;break;case 3:L.AU="invalid block type",x.mode=q}i>>>=2,X-=2;break;case 14:for(i>>>=7&X,X-=7&X;X<32;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if((65535&i)!==(i>>>16^65535)){L.AU="invalid stored block lengths",x.mode=q;break}if(x.length=65535&i,i=0,X=0,x.mode=15,U===A)break L;case 15:x.mode=16;case 16:if(e=x.length,e){if(e>K&&(e=K),e>l&&(e=l),0===e)break L;D.set(v.subarray(P,P+e),d),K-=e,P+=e,l-=e,d+=e,x.length-=e;break}x.mode=Q;break;case 17:for(;X<14;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(x.nlen=257+(31&i),i>>>=5,X-=5,x.ndist=1+(31&i),i>>>=5,X-=5,x.ncode=4+(15&i),i>>>=4,X-=4,x.nlen>286||x.ndist>30){L.AU="too many length or distance symbols",x.mode=q;break}x.have=0,x.mode=18;case 18:for(;x.have<x.ncode;){for(;X<3;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}x.lens[C[x.have++]]=7&i,i>>>=3,X-=3}for(;x.have<19;)x.lens[C[x.have++]]=0;if(x.lencode=x.lendyn,x.lenbits=7,B={bits:x.lenbits},W=F(0,x.lens,0,19,x.lencode,0,x.work,B),x.lenbits=B.bits,W){L.AU="invalid code lengths set",x.mode=q;break}x.have=0,x.mode=19;case 19:for(;x.have<x.nlen+x.ndist;){for(;I=x.lencode[i&(1<<x.lenbits)-1],g=I>>>24,z=I>>>16&255,M=65535&I,!(g<=X);){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(M<16)i>>>=g,X-=g,x.lens[x.have++]=M;else{if(16===M){for(s=g+2;X<s;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(i>>>=g,X-=g,0===x.have){L.AU="invalid bit length repeat",x.mode=q;break}c=x.lens[x.have-1],e=3+(3&i),i>>>=2,X-=2}else if(17===M){for(s=g+3;X<s;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}i>>>=g,X-=g,c=0,e=3+(7&i),i>>>=3,X-=3}else{for(s=g+7;X<s;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}i>>>=g,X-=g,c=0,e=11+(127&i),i>>>=7,X-=7}if(x.have+e>x.nlen+x.ndist){L.AU="invalid bit length repeat",x.mode=q;break}for(;e--;)x.lens[x.have++]=c}}if(x.mode===q)break;if(0===x.lens[256]){L.AU="invalid code -- missing end-of-block",x.mode=q;break}if(x.lenbits=9,B={bits:x.lenbits},W=F(1,x.lens,0,x.nlen,x.lencode,0,x.work,B),x.lenbits=B.bits,W){L.AU="invalid literal/lengths set",x.mode=q;break}if(x.distbits=6,x.distcode=x.distdyn,B={bits:x.distbits},W=F(2,x.lens,x.nlen,x.ndist,x.distcode,0,x.work,B),x.distbits=B.bits,W){L.AU="invalid distances set",x.mode=q;break}if(x.mode=20,U===A)break L;case 20:x.mode=21;case 21:if(K>=6&&l>=258){L.next_out=d,L.avail_out=l,L.next_in=P,L.avail_in=K,x.hold=i,x.bits=X,G(L,N),d=L.next_out,D=L.output,l=L.avail_out,P=L.next_in,v=L.input,K=L.avail_in,i=x.hold,X=x.bits,x.mode===Q&&(x.back=-1);break}for(x.back=0;I=x.lencode[i&(1<<x.lenbits)-1],g=I>>>24,z=I>>>16&255,M=65535&I,!(g<=X);){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(z&&0===(240&z)){for(J=g,j=z,R=M;I=x.lencode[R+((i&(1<<J+j)-1)>>J)],g=I>>>24,z=I>>>16&255,M=65535&I,!(J+g<=X);){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}i>>>=J,X-=J,x.back+=J}if(i>>>=g,X-=g,x.back+=g,x.length=M,0===z){x.mode=26;break}if(32&z){x.back=-1,x.mode=Q;break}if(64&z){L.AU="invalid literal/length code",x.mode=q;break}x.extra=15&z,x.mode=22;case 22:if(x.extra){for(s=x.extra;X<s;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}x.length+=i&(1<<x.extra)-1,i>>>=x.extra,X-=x.extra,x.back+=x.extra}x.was=x.length,x.mode=23;case 23:for(;I=x.distcode[i&(1<<x.distbits)-1],g=I>>>24,z=I>>>16&255,M=65535&I,!(g<=X);){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(0===(240&z)){for(J=g,j=z,R=M;I=x.distcode[R+((i&(1<<J+j)-1)>>J)],g=I>>>24,z=I>>>16&255,M=65535&I,!(J+g<=X);){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}i>>>=J,X-=J,x.back+=J}if(i>>>=g,X-=g,x.back+=g,64&z){L.AU="invalid distance code",x.mode=q;break}x.offset=M,x.extra=15&z,x.mode=24;case 24:if(x.extra){for(s=x.extra;X<s;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}x.offset+=i&(1<<x.extra)-1,i>>>=x.extra,X-=x.extra,x.back+=x.extra}if(x.offset>x.dmax){L.AU="invalid distance too far back",x.mode=q;break}x.mode=25;case 25:if(0===l)break L;if(e=N-l,x.offset>e){if(e=x.offset-e,e>x.whave&&x.sane){L.AU="invalid distance too far back",x.mode=q;break}e>x.wnext?(e-=x.wnext,u=x.wsize-e):u=x.wnext-e,e>x.length&&(e=x.length),Z=x.window}else Z=D,u=d-x.offset,e=x.length;e>l&&(e=l),l-=e,x.length-=e;do{D[d++]=Z[u++]}while(--e);0===x.length&&(x.mode=21);break;case 26:if(0===l)break L;D[d++]=x.length,l--,x.mode=21;break;case 27:if(x.wrap){for(;X<32;){if(0===K)break L;K--,i|=v[P++]<<X,X+=8}if(N-=l,L.total_out+=N,x.total+=N,N&&(L.adler=x.check=x.flags?p(x.check,D,N,d-N):mL(x.check,D,N,d-N)),N=l,(x.flags?i:f(i))!==x.check){L.AU="incorrect data check",x.mode=q;break}i=0,X=0}x.mode=28;case 28:if(x.wrap&&x.flags){for(;X<32;){if(0===K)break L;K--,i+=v[P++]<<X,X+=8}if(i!==(4294967295&x.total)){L.AU="incorrect length check",x.mode=q;break}i=0,X=0}x.mode=29;case 29:W=h;break L;case q:W=Y;break L;case 31:return S;default:return E}return L.next_out=d,L.avail_out=l,L.next_in=P,L.avail_in=K,x.hold=i,x.bits=X,(x.wsize||N!==L.avail_out&&x.mode<q&&(x.mode<27||U!==a))&&y(L,L.output,L.next_out,N-L.avail_out)?(x.mode=31,S):(n-=L.avail_in,N-=L.avail_out,L.total_in+=n,L.total_out+=N,x.total+=N,x.wrap&&N&&(L.adler=x.check=x.flags?p(x.check,D,N,L.next_out-N):mL(x.check,D,N,L.next_out-N)),L.data_type=x.bits+(x.last?64:0)+(x.mode===Q?128:0)+(20===x.mode||15===x.mode?256:0),(0===n&&0===N||U===a)&&W===r&&(W=V),W)},L.exports.inflateEnd=L=>{if(!L||!L.state)return E;let U=L.state;return U.window&&(U.window=null),L.state=null,r},L.exports.inflateGetHeader=(L,U)=>{if(!L||!L.state)return E;const x=L.state;return 0===(2&x.wrap)?E:(x.head=U,U.done=!1,r)},L.exports.inflateSetDictionary=(L,U)=>{const x=U.length;let p,G,F;return L&&L.state?(p=L.state,0!==p.wrap&&11!==p.mode?E:11===p.mode&&(G=1,G=mL(G,U,x,0),G!==p.check)?Y:(F=y(L,U,x,x),F?(p.mode=31,S):(p.havedict=1,r))):E},L.exports.inflateInfo="pako inflate (from Nodeca project)"},13827:L=>{"use strict";const U=15,x=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),p=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),G=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);L.exports=(L,F,a,o,A,r,h,b)=>{const E=b.bits;let Y,S,V,H,Q,q,f=0,v=0,D=0,P=0,d=0,K=0,l=0,i=0,X=0,t=0,y=null,n=0;const N=new Uint16Array(16),e=new Uint16Array(16);let u,Z,g,z=null,M=0;for(f=0;f<=U;f++)N[f]=0;for(v=0;v<o;v++)N[F[a+v]]++;for(d=E,P=U;P>=1&&0===N[P];P--);if(d>P&&(d=P),0===P)return A[r++]=20971520,A[r++]=20971520,b.bits=1,0;for(D=1;D<P&&0===N[D];D++);for(d<D&&(d=D),i=1,f=1;f<=U;f++)if(i<<=1,i-=N[f],i<0)return-1;if(i>0&&(0===L||1!==P))return-1;for(e[1]=0,f=1;f<U;f++)e[f+1]=e[f]+N[f];for(v=0;v<o;v++)0!==F[a+v]&&(h[e[F[a+v]]++]=v);if(0===L?(y=z=h,q=19):1===L?(y=x,n-=257,z=mL,M-=257,q=256):(y=p,z=G,q=-1),t=0,v=0,f=D,Q=r,K=d,l=0,V=-1,X=1<<d,H=X-1,1===L&&X>852||2===L&&X>592)return 1;for(;;){u=f-l,h[v]<q?(Z=0,g=h[v]):h[v]>q?(Z=z[M+h[v]],g=y[n+h[v]]):(Z=96,g=0),Y=1<<f-l,S=1<<K,D=S;do{S-=Y,A[Q+(t>>l)+S]=u<<24|Z<<16|g}while(0!==S);for(Y=1<<f-1;t&Y;)Y>>=1;if(0!==Y?(t&=Y-1,t+=Y):t=0,v++,0===--N[f]){if(f===P)break;f=F[a+h[v]]}if(f>d&&(t&H)!==V){for(0===l&&(l=d),Q+=D,K=f-l,i=1<<K;K+l<P&&(i-=N[K+l],!(i<=0));)K++,i<<=1;if(X+=1<<K,1===L&&X>852||2===L&&X>592)return 1;V=t&H,A[V]=d<<24|K<<16|Q-r}}return 0!==t&&(A[Q+t]=f-l<<24|64<<16),b.bits=d,0}},13776:L=>{"use strict";L.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13760:L=>{"use strict";function U(L){let U=L.length;for(;--U>=0;)L[U]=0}const x=256,mL=286,p=30,G=15,F=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Array(576);U(r);const h=new Array(60);U(h);const b=new Array(512);U(b);const E=new Array(256);U(E);const Y=new Array(29);U(Y);const S=new Array(p);function V(L,U,x,mL,p){this.static_tree=L,this.extra_bits=U,this.extra_base=x,this.elems=mL,this.max_length=p,this.has_stree=L&&L.length}let H,Q,q;function f(L,U){this.dyn_tree=L,this.max_code=0,this.stat_desc=U}U(S);const v=L=>L<256?b[L]:b[256+(L>>>7)],D=(L,U)=>{L.pending_buf[L.pending++]=255&U,L.pending_buf[L.pending++]=U>>>8&255},P=(L,U,x)=>{L.bi_valid>16-x?(L.bi_buf|=U<<L.bi_valid&65535,D(L,L.bi_buf),L.bi_buf=U>>16-L.bi_valid,L.bi_valid+=x-16):(L.bi_buf|=U<<L.bi_valid&65535,L.bi_valid+=x)},d=(L,U,x)=>{P(L,x[2*U],x[2*U+1])},K=(L,U)=>{let x=0;do{x|=1&L,L>>>=1,x<<=1}while(--U>0);return x>>>1},l=(L,U,x)=>{const mL=new Array(16);let p,F,a=0;for(p=1;p<=G;p++)mL[p]=a=a+x[p-1]<<1;for(F=0;F<=U;F++){let U=L[2*F+1];0!==U&&(L[2*F]=K(mL[U]++,U))}},i=L=>{let U;for(U=0;U<mL;U++)L.dyn_ltree[2*U]=0;for(U=0;U<p;U++)L.dyn_dtree[2*U]=0;for(U=0;U<19;U++)L.bl_tree[2*U]=0;L.dyn_ltree[512]=1,L.opt_len=L.static_len=0,L.last_lit=L.matches=0},X=L=>{L.bi_valid>8?D(L,L.bi_buf):L.bi_valid>0&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0},t=(L,U,x,mL)=>{const p=2*U,G=2*x;return L[p]<L[G]||L[p]===L[G]&&mL[U]<=mL[x]},y=(L,U,x)=>{const mL=L.heap[x];let p=x<<1;for(;p<=L.heap_len&&(p<L.heap_len&&t(U,L.heap[p+1],L.heap[p],L.depth)&&p++,!t(U,mL,L.heap[p],L.depth));)L.heap[x]=L.heap[p],x=p,p<<=1;L.heap[x]=mL},n=(L,U,mL)=>{let p,G,o,A,r=0;if(0!==L.last_lit)do{p=L.pending_buf[L.d_buf+2*r]<<8|L.pending_buf[L.d_buf+2*r+1],G=L.pending_buf[L.l_buf+r],r++,0===p?d(L,G,U):(o=E[G],d(L,o+x+1,U),A=F[o],0!==A&&(G-=Y[o],P(L,G,A)),p--,o=v(p),d(L,o,mL),A=a[o],0!==A&&(p-=S[o],P(L,p,A)))}while(r<L.last_lit);d(L,256,U)},N=(L,U)=>{const x=U.dyn_tree,mL=U.stat_desc.static_tree,p=U.stat_desc.has_stree,F=U.stat_desc.elems;let a,o,A,r=-1;for(L.heap_len=0,L.heap_max=573,a=0;a<F;a++)0!==x[2*a]?(L.heap[++L.heap_len]=r=a,L.depth[a]=0):x[2*a+1]=0;for(;L.heap_len<2;)A=L.heap[++L.heap_len]=r<2?++r:0,x[2*A]=1,L.depth[A]=0,L.opt_len--,p&&(L.static_len-=mL[2*A+1]);for(U.max_code=r,a=L.heap_len>>1;a>=1;a--)y(L,x,a);A=F;do{a=L.heap[1],L.heap[1]=L.heap[L.heap_len--],y(L,x,1),o=L.heap[1],L.heap[--L.heap_max]=a,L.heap[--L.heap_max]=o,x[2*A]=x[2*a]+x[2*o],L.depth[A]=(L.depth[a]>=L.depth[o]?L.depth[a]:L.depth[o])+1,x[2*a+1]=x[2*o+1]=A,L.heap[1]=A++,y(L,x,1)}while(L.heap_len>=2);L.heap[--L.heap_max]=L.heap[1],((L,U)=>{const x=U.dyn_tree,mL=U.max_code,p=U.stat_desc.static_tree,F=U.stat_desc.has_stree,a=U.stat_desc.extra_bits,o=U.stat_desc.extra_base,A=U.stat_desc.max_length;let r,h,b,E,Y,S,V=0;for(E=0;E<=G;E++)L.bl_count[E]=0;for(x[2*L.heap[L.heap_max]+1]=0,r=L.heap_max+1;r<573;r++)h=L.heap[r],E=x[2*x[2*h+1]+1]+1,E>A&&(E=A,V++),x[2*h+1]=E,h>mL||(L.bl_count[E]++,Y=0,h>=o&&(Y=a[h-o]),S=x[2*h],L.opt_len+=S*(E+Y),F&&(L.static_len+=S*(p[2*h+1]+Y)));if(0!==V){do{for(E=A-1;0===L.bl_count[E];)E--;L.bl_count[E]--,L.bl_count[E+1]+=2,L.bl_count[A]--,V-=2}while(V>0);for(E=A;0!==E;E--)for(h=L.bl_count[E];0!==h;)b=L.heap[--r],b>mL||(x[2*b+1]!==E&&(L.opt_len+=(E-x[2*b+1])*x[2*b],x[2*b+1]=E),h--)}})(L,U),l(x,r,L.bl_count)},e=(L,U,x)=>{let mL,p,G=-1,F=U[1],a=0,o=7,A=4;for(0===F&&(o=138,A=3),U[2*(x+1)+1]=65535,mL=0;mL<=x;mL++)p=F,F=U[2*(mL+1)+1],++a<o&&p===F||(a<A?L.bl_tree[2*p]+=a:0!==p?(p!==G&&L.bl_tree[2*p]++,L.bl_tree[32]++):a<=10?L.bl_tree[34]++:L.bl_tree[36]++,a=0,G=p,0===F?(o=138,A=3):p===F?(o=6,A=3):(o=7,A=4))},u=(L,U,x)=>{let mL,p,G=-1,F=U[1],a=0,o=7,A=4;for(0===F&&(o=138,A=3),mL=0;mL<=x;mL++)if(p=F,F=U[2*(mL+1)+1],!(++a<o&&p===F)){if(a<A)do{d(L,p,L.bl_tree)}while(0!==--a);else 0!==p?(p!==G&&(d(L,p,L.bl_tree),a--),d(L,16,L.bl_tree),P(L,a-3,2)):a<=10?(d(L,17,L.bl_tree),P(L,a-3,3)):(d(L,18,L.bl_tree),P(L,a-11,7));a=0,G=p,0===F?(o=138,A=3):p===F?(o=6,A=3):(o=7,A=4)}};let Z=!1;const g=(L,U,x,mL)=>{P(L,0+(mL?1:0),3),((L,U,x,mL)=>{X(L),mL&&(D(L,x),D(L,~x)),L.pending_buf.set(L.window.subarray(U,U+x),L.pending),L.pending+=x})(L,U,x,!0)};L.exports._tr_init=L=>{Z||((()=>{let L,U,x,A,f;const v=new Array(16);for(x=0,A=0;A<28;A++)for(Y[A]=x,L=0;L<1<<F[A];L++)E[x++]=A;for(E[x-1]=A,f=0,A=0;A<16;A++)for(S[A]=f,L=0;L<1<<a[A];L++)b[f++]=A;for(f>>=7;A<p;A++)for(S[A]=f<<7,L=0;L<1<<a[A]-7;L++)b[256+f++]=A;for(U=0;U<=G;U++)v[U]=0;for(L=0;L<=143;)r[2*L+1]=8,L++,v[8]++;for(;L<=255;)r[2*L+1]=9,L++,v[9]++;for(;L<=279;)r[2*L+1]=7,L++,v[7]++;for(;L<=287;)r[2*L+1]=8,L++,v[8]++;for(l(r,287,v),L=0;L<p;L++)h[2*L+1]=5,h[2*L]=K(L,5);H=new V(r,F,257,mL,G),Q=new V(h,a,0,p,G),q=new V(new Array(0),o,0,19,7)})(),Z=!0),L.l_desc=new f(L.dyn_ltree,H),L.d_desc=new f(L.dyn_dtree,Q),L.bl_desc=new f(L.bl_tree,q),L.bi_buf=0,L.bi_valid=0,i(L)},L.exports._tr_stored_block=g,L.exports._tr_flush_block=(L,U,mL,p)=>{let G,F,a=0;L.level>0?(2===L.strm.data_type&&(L.strm.data_type=(L=>{let U,mL=4093624447;for(U=0;U<=31;U++,mL>>>=1)if(1&mL&&0!==L.dyn_ltree[2*U])return 0;if(0!==L.dyn_ltree[18]||0!==L.dyn_ltree[20]||0!==L.dyn_ltree[26])return 1;for(U=32;U<x;U++)if(0!==L.dyn_ltree[2*U])return 1;return 0})(L)),N(L,L.l_desc),N(L,L.d_desc),a=(L=>{let U;for(e(L,L.dyn_ltree,L.l_desc.max_code),e(L,L.dyn_dtree,L.d_desc.max_code),N(L,L.bl_desc),U=18;U>=3&&0===L.bl_tree[2*A[U]+1];U--);return L.opt_len+=3*(U+1)+5+5+4,U})(L),G=L.opt_len+3+7>>>3,F=L.static_len+3+7>>>3,F<=G&&(G=F)):G=F=mL+5,mL+4<=G&&-1!==U?g(L,U,mL,p):4===L.strategy||F===G?(P(L,2+(p?1:0),3),n(L,r,h)):(P(L,4+(p?1:0),3),((L,U,x,mL)=>{let p;for(P(L,U-257,5),P(L,x-1,5),P(L,mL-4,4),p=0;p<mL;p++)P(L,L.bl_tree[2*A[p]+1],3);u(L,L.dyn_ltree,U-1),u(L,L.dyn_dtree,x-1)})(L,L.l_desc.max_code+1,L.d_desc.max_code+1,a+1),n(L,L.dyn_ltree,L.dyn_dtree)),i(L),p&&X(L)},L.exports._tr_tally=(L,U,mL)=>(L.pending_buf[L.d_buf+2*L.last_lit]=U>>>8&255,L.pending_buf[L.d_buf+2*L.last_lit+1]=255&U,L.pending_buf[L.l_buf+L.last_lit]=255&mL,L.last_lit++,0===U?L.dyn_ltree[2*mL]++:(L.matches++,U--,L.dyn_ltree[2*(E[mL]+x+1)]++,L.dyn_dtree[2*v(U)]++),L.last_lit===L.lit_bufsize-1),L.exports._tr_align=L=>{P(L,2,3),d(L,256,r),(L=>{16===L.bi_valid?(D(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):L.bi_valid>=8&&(L.pending_buf[L.pending++]=255&L.bi_buf,L.bi_buf>>=8,L.bi_valid-=8)})(L)}},13803:L=>{"use strict";L.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.AU="",this.state=null,this.data_type=2,this.adler=0}},13417:L=>{function U(L,U,x){for(var mL=L.length,p=-1/0,G=1/0,F=0;F<mL;F++){var a=(x[0][F]-L[F])/U[F],o=(x[1][F]-L[F])/U[F];if(a>o){var A=a;a=o,o=A}if(o<p||a>G)return 1/0;a>p&&(p=a),o<G&&(G=o)}return p>G?1/0:p}L.exports=function(L,x,mL,p){var G=U(x,mL,p);if(G===1/0)L=null;else{L=L||[];for(var F=0;F<x.length;F++)L[F]=x[F]+mL[F]*G}return L},L.exports.distance=U},14803:(L,U,x)=>{"use strict";x.d(U,{d:()=>F});var mL=x(33);const p=mL.useLayoutEffect;const G=function(L){var U=(0,mL.useRef)(L);return p((function(){U.current=L})),U};var F=function(L){var U=G(L);(0,mL.FU)((function(){var L=function(L){var x;if(null!=U.current&&(x=U.current(L)),L.defaultPrevented&&(L.returnValue=""),"string"===typeof x)return L.returnValue=x,x};return window.addEventListener("beforeunload",L),function(){window.removeEventListener("beforeunload",L)}}),[])}},14758:(L,U,x)=>{"use strict";var mL=x(14760),p=Array.prototype.concat,G=Array.prototype.slice,F=L.exports=function(L){for(var U=[],x=0,F=L.length;x<F;x++){var a=L[x];mL(a)?U=p.call(U,G.call(a)):U.push(a)}return U};F.wrap=function(L){return function(){return L(F(arguments))}}},14760:L=>{L.exports=function(L){return!(!L||"string"===typeof L)&&(L instanceof Array||Array.isArray(L)||L.length>=0&&(L.splice instanceof Function||Object.getOwnPropertyDescriptor(L,L.length-1)&&"String"!==L.constructor.name))}},13693:(L,U,x)=>{var mL=x(13702);function p(L){for(var U,x,p=0,G=L.length,F=0;F<L.length;){for(U=L[F],x=0;F<G&&L[F]===U;)++F,++x;p+=mL.log2(x)/7|0,p+=mL.log2(U>>>0)/7|0,p+=2}return p}U.size=p,U.encode=function(L,U){U||(U=new Uint8Array(p(L)));for(var x,mL,G=0,F=U.length,a=0;a<L.length;){for(x=L[a],mL=0;a<L.length&&L[a]===x;)++a,++mL;for(;G<F&&mL>=128;)U[G++]=128+(127&mL),mL>>>=7;if(G>=F)throw new Error("RLE buffer overflow");for(U[G++]=mL,x>>>=0;G<F&&x>=128;)U[G++]=128+(127&x),x>>>=7;if(G>=F)throw new Error("RLE buffer overflow");U[G++]=x}return U},U.decode=function(L,U){for(var x,mL,p,G,F=U.length,a=L.length,o=0,A=0;A<a;){for(x=0,mL=0;A<a&&L[A]>=128;)x+=(127&L[A++])<<mL,mL+=7;if(x+=L[A++]<<mL,A>=a)throw new Error("RLE buffer underrun");if(o+x>F)throw new Error("Chunk buffer overflow");for(p=0,mL=0;A<a&&L[A]>=128;)p+=(127&L[A++])<<mL,mL+=7;if(A>=a)throw new Error("RLE buffer underrun");for(p+=L[A++]<<mL,G=0;G<x;++G)U[o++]=p}return U}},13702:(L,U)=>{"use strict";function x(L){var U=32;return(L&=-L)&&U--,65535&L&&(U-=16),16711935&L&&(U-=8),252645135&L&&(U-=4),858993459&L&&(U-=2),1431655765&L&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(L){return(L>0)-(L<0)},U.abs=function(L){var U=L>>31;return(L^U)-U},U.min=function(L,U){return U^(L^U)&-(L<U)},U.max=function(L,U){return L^(L^U)&-(L<U)},U.isPow2=function(L){return!(L&L-1)&&!!L},U.log2=function(L){var U,x;return U=(L>65535)<<4,U|=x=((L>>>=U)>255)<<3,U|=x=((L>>>=x)>15)<<2,(U|=x=((L>>>=x)>3)<<1)|(L>>>=x)>>1},U.log10=function(L){return L>=1e9?9:L>=1e8?8:L>=1e7?7:L>=1e6?6:L>=1e5?5:L>=1e4?4:L>=1e3?3:L>=100?2:L>=10?1:0},U.popCount=function(L){return 16843009*((L=(858993459&(L-=L>>>1&1431655765))+(L>>>2&858993459))+(L>>>4)&252645135)>>>24},U.countTrailingZeros=x,U.nextPow2=function(L){return L+=0===L,--L,L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)+1},U.prevPow2=function(L){return L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)-(L>>>1)},U.parity=function(L){return L^=L>>>16,L^=L>>>8,L^=L>>>4,27030>>>(L&=15)&1};var mL=new Array(256);!function(L){for(var U=0;U<256;++U){var x=U,mL=U,p=7;for(x>>>=1;x;x>>>=1)mL<<=1,mL|=1&x,--p;L[U]=mL<<p&255}}(mL),U.reverse=function(L){return mL[255&L]<<24|mL[L>>>8&255]<<16|mL[L>>>16&255]<<8|mL[L>>>24&255]},U.interleave2=function(L,U){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L&=65535)|L<<8))|L<<4))|L<<2))|L<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(L,U){return(L=65535&((L=16711935&((L=252645135&((L=858993459&((L=L>>>U&1431655765)|L>>>1))|L>>>2))|L>>>4))|L>>>16))<<16>>16},U.interleave3=function(L,U,x){return L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2),(L|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<2},U.deinterleave3=function(L,U){return(L=1023&((L=4278190335&((L=251719695&((L=3272356035&((L=L>>>U&1227133513)|L>>>2))|L>>>4))|L>>>8))|L>>>16))<<22>>22},U.nextCombination=function(L){var U=L|L-1;return U+1|(~U&-~U)-1>>>x(L)+1}},13736:L=>{"use strict";L.exports=function(L,U,x,mL){var p=self||window;try{try{var G;try{G=new p.Blob([L])}catch(A){(G=new(p.BlobBuilder||p.WebKitBlobBuilder||p.MozBlobBuilder||p.MSBlobBuilder)).append(L),G=G.getBlob()}var F=p.URL||p.webkitURL,a=F.createObjectURL(G),o=new p[U](a,x);return F.revokeObjectURL(a),o}catch(A){return new p[U]("data:application/javascript,".concat(encodeURIComponent(L)),x)}}catch(A){if(!mL)throw Error("Inline worker is not supported");return new p[U](mL,x)}}},13392:(L,U,x)=>{"use strict";function mL(L,U,x,mL,p){var G={};return Object.keys(mL).forEach((function(L){G[L]=mL[L]})),G.enumerable=!!G.enumerable,G.configurable=!!G.configurable,("value"in G||G.initializer)&&(G.writable=!0),G=x.slice().reverse().reduce((function(x,mL){return mL(L,U,x)||x}),G),p&&void 0!==G.initializer&&(G.value=G.initializer?G.initializer.call(p):void 0,G.initializer=void 0),void 0===G.initializer&&(Object.defineProperty(L,U,G),G=null),G}x.d(U,{c:()=>mL})},13387:(L,U,x)=>{"use strict";function mL(L,U,x,mL){x&&Object.defineProperty(L,U,{enumerable:x.enumerable,configurable:x.configurable,writable:x.writable,value:x.initializer?x.initializer.call(mL):void 0})}x.d(U,{b:()=>mL})},14785:(L,U,x)=>{"use strict";x.d(U,{c:()=>F,e:()=>h,i:()=>a,l:()=>G,n:()=>o,r:()=>p,v:()=>A,y:()=>r});var mL=x(12791);class p{constructor(){this._easingMode=p.EASINGMODE_EASEIN}setEasingMode(L){const U=Math.min(Math.max(L,0),2);this._easingMode=U}getEasingMode(){return this._easingMode}easeInCore(L){throw new Error("You must implement this method")}ease(L){switch(this._easingMode){case p.EASINGMODE_EASEIN:return this.easeInCore(L);case p.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-L)}return L>=.5?.5*(1-this.easeInCore(2*(1-L)))+.5:.5*this.easeInCore(2*L)}}p.EASINGMODE_EASEIN=0,p.EASINGMODE_EASEOUT=1,p.EASINGMODE_EASEINOUT=2;class G extends p{easeInCore(L){return L=Math.max(0,Math.min(1,L)),1-Math.sqrt(1-L*L)}}class F extends p{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=L}easeInCore(L){const U=Math.max(0,this.amplitude);return Math.pow(L,3)-L*U*Math.sin(3.141592653589793*L)}}class a extends p{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=L,this.bounciness=U}easeInCore(L){const U=Math.max(0,this.bounces);let x=this.bounciness;x<=1&&(x=1.001);const mL=Math.pow(x,U),p=1-x,G=(1-mL)/p+.5*mL,F=L*G,a=Math.log(-F*(1-x)+1)/Math.log(x),o=Math.floor(a),A=o+1,r=(1-Math.pow(x,o))/(p*G),h=.5*(r+(1-Math.pow(x,A))/(p*G)),b=L-h,E=h-r;return-Math.pow(1/x,U-o)/(E*E)*(b-E)*(b+E)}}class o extends p{easeInCore(L){return L*L*L}}class A extends p{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=L,this.springiness=U}easeInCore(L){let U;const x=Math.max(0,this.oscillations),mL=Math.max(0,this.springiness);return U=0==mL?L:(Math.exp(mL*L)-1)/(Math.exp(mL)-1),U*Math.sin((6.283185307179586*x+1.5707963267948966)*L)}}class r extends p{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=L}easeInCore(L){return this.exponent<=0?L:(Math.exp(this.exponent*L)-1)/(Math.exp(this.exponent)-1)}}class h extends p{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=L,this.y1=U,this.x2=x,this.y2=mL}easeInCore(L){return mL.e.Interpolate(L,this.x1,this.y1,this.x2,this.y2)}}},14271:(L,U,x)=>{"use strict";x.d(U,{d:()=>F});var mL=x(12589),p=x(12602),G=x(13022);class F extends G.e{get _matrix(){return this._compose(),this.cE}set _matrix(L){(L.updateFlag!==this.cE.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.cE.p(L),this._markAsDirtyAndDecompose())}constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(L,U.PL(),!1),this.name=L,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=U,this.cE=(null===p||void 0===p?void 0:p.clone())??mL.Matrix.Identity(),this._restMatrix=G??this.cE.clone(),this._bindMatrix=F??this.cE.clone(),this._index=a,this._absoluteMatrix=new mL.Matrix,this._absoluteBindMatrix=new mL.Matrix,this._absoluteInverseBindMatrix=new mL.Matrix,this._finalMatrix=new mL.Matrix,U.bones.push(this),this.setParent(x,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(L){this.setParent(L)}setParent(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==L){if(this.parent){const L=this.parent.children.indexOf(this);-1!==L&&this.parent.children.splice(L,1)}this._parentNode=L,this.parent&&this.parent.children.push(this),U&&this._updateAbsoluteBindMatrices(),this.kA()}}getLocalMatrix(){return this._compose(),this.cE}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(L){this._restMatrix.p(L)}setRestPose(L){this.setRestMatrix(L)}getBindPose(){return this.getBindMatrix()}setBindMatrix(L){this.qa(L)}setBindPose(L){this.setBindMatrix(L)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const L=mL.TmpVectors.YU[0],U=mL.TmpVectors.Quaternion[0],x=mL.TmpVectors.YU[1];this.getRestMatrix().decompose(L,U,x),this._linkedTransformNode.position.p(x),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??mL.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.p(U),this._linkedTransformNode.Ka.p(L)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(L){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=L,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Oa}set position(L){this._decompose(),this.Oa.p(L),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(L){this.setRotation(L)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(L){this.setRotationQuaternion(L)}get Ka(){return this.getScale()}set Ka(L){this.setScale(L)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=mL.YU.Zero(),this._localRotation=mL.Quaternion.Zero(),this.Oa=mL.YU.Zero()),this.cE.decompose(this._localScaling,this._localRotation,this.Oa))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,mL.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Oa,this.cE)):this._needToCompose=!1)}qa(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(L),U&&this._updateAbsoluteBindMatrices(),x?this._matrix=L:this.kA()}_updateAbsoluteBindMatrices(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(L||(L=this._bindMatrix),this.parent?L.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(L),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),U)for(let x=0;x<this.children.length;x++)this.children[x]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}kA(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.kA(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.kA(),this._needToDecompose=!0}_updatePosition(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=this.getLocalMatrix();if(0==U)p?(G.addAtIndex(12,L.x),G.addAtIndex(13,L.y),G.addAtIndex(14,L.z)):G.setTranslationFromFloats(L.x,L.y,L.z);else{let U=null;x&&(U=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=F._TmpMats[0],o=F._TmpVecs[0];this.parent?x&&U?(a.p(this.parent.getAbsoluteMatrix()),a.multiplyToRef(U,a)):a.p(this.parent.getAbsoluteMatrix()):mL.Matrix.IdentityToRef(a),p&&a.setTranslationFromFloats(0,0,0),a.invert(),mL.YU.TransformCoordinatesToRef(L,a,o),p?(G.addAtIndex(12,o.x),G.addAtIndex(13,o.y),G.addAtIndex(14,o.z)):G.setTranslationFromFloats(o.x,o.y,o.z)}this._markAsDirtyAndDecompose()}translate(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;this._updatePosition(L,U,x,!0)}setPosition(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;this._updatePosition(L,U,x,!1)}setAbsolutePosition(L,U){this.setPosition(L,1,U)}scale(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=this.getLocalMatrix(),a=F._TmpMats[0];mL.Matrix.ScalingToRef(L,U,x,a),a.multiplyToRef(G,G),a.invert();for(const mL of this.children){const p=mL.getLocalMatrix();p.multiplyToRef(a,p),p.multiplyAtIndex(12,L),p.multiplyAtIndex(13,U),p.multiplyAtIndex(14,x),mL._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),p)for(const mL of this.children)mL.scale(L,U,x,p)}setScale(L){this._decompose(),this._localScaling.p(L),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(L){this._decompose(),L.p(this._localScaling)}setYawPitchRoll(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4?arguments[4]:void 0;if(0===p){const a=F._TmpQuat;return mL.Quaternion.RotationYawPitchRollToRef(L,U,x,a),void this.setRotationQuaternion(a,p,G)}const a=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,G))return;const o=F._TmpMats[1];mL.Matrix.RotationYawPitchRollToRef(L,U,x,o),a.multiplyToRef(o,o),this._rotateWithMatrix(o,p,G)}rotate(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3?arguments[3]:void 0;const G=F._TmpMats[0];G.setTranslationFromFloats(0,0,0),mL.Matrix.RotationAxisToRef(L,U,G),this._rotateWithMatrix(G,x,p)}setAxisAngle(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3?arguments[3]:void 0;if(0===x){const G=F._TmpQuat;return mL.Quaternion.RotationAxisToRef(L,U,G),void this.setRotationQuaternion(G,x,p)}const G=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,p))return;const a=F._TmpMats[1];mL.Matrix.RotationAxisToRef(L,U,a),G.multiplyToRef(a,a),this._rotateWithMatrix(a,x,p)}setRotation(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(L.y,L.x,L.z,U,x)}setRotationQuaternion(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;if(0===U)return this._decompose(),this._localRotation.p(L),void this._markAsDirtyAndCompose();const p=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,x))return;const G=F._TmpMats[1];mL.Matrix.FromQuaternionToRef(L,G),p.multiplyToRef(G,G),this._rotateWithMatrix(G,U,x)}setRotationMatrix(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;if(0===U){const p=F._TmpQuat;return mL.Quaternion.FromRotationMatrixToRef(L,p),void this.setRotationQuaternion(p,U,x)}const p=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,x))return;const G=F._TmpMats[1];G.p(L),p.multiplyToRef(L,G),this._rotateWithMatrix(G,U,x)}_rotateWithMatrix(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;const mL=this.getLocalMatrix(),p=mL.m[12],G=mL.m[13],a=mL.m[14],o=this.getParent(),A=F._TmpMats[3],r=F._TmpMats[4];o&&1==U?(x?(A.p(x.getWorldMatrix()),o.getAbsoluteMatrix().multiplyToRef(A,A)):A.p(o.getAbsoluteMatrix()),r.p(A),r.invert(),mL.multiplyToRef(A,mL),mL.multiplyToRef(L,mL),mL.multiplyToRef(r,mL)):1==U&&x?(A.p(x.getWorldMatrix()),r.p(A),r.invert(),mL.multiplyToRef(A,mL),mL.multiplyToRef(L,mL),mL.multiplyToRef(r,mL)):mL.multiplyToRef(L,mL),mL.setTranslationFromFloats(p,G,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(L,U){const x=F._TmpMats[2];return L.p(this.getAbsoluteMatrix()),U?(L.multiplyToRef(U.getWorldMatrix(),L),mL.Matrix.ScalingToRef(U.Ka.x,U.Ka.y,U.Ka.z,x)):mL.Matrix.IdentityToRef(x),L.invert(),!isNaN(L.m[0])&&(x.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyToRef(x,L),!0)}dp(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=mL.YU.Zero();return this.getPositionToRef(L,U,x),x}getPositionToRef(){let L=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const L=this.getLocalMatrix();U.x=L.m[12],U.y=L.m[13],U.z=L.m[14]}else{let x=null;L&&(x=L.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let mL=F._TmpMats[0];L&&x?(mL.p(this.getAbsoluteMatrix()),mL.multiplyToRef(x,mL)):mL=this.getAbsoluteMatrix(),U.x=mL.m[12],U.y=mL.m[13],U.z=mL.m[14]}}getAbsolutePosition(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=mL.YU.Zero();return this.getPositionToRef(1,L,U),U}getAbsolutePositionToRef(L,U){this.getPositionToRef(1,L,U)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.cE.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.cE);const L=this._skeleton.getPoseMatrix();L&&this._absoluteMatrix.multiplyToRef(L,this._absoluteMatrix)}const L=this.children,U=L.length;for(let x=0;x<U;x++)L[x].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}io(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=mL.YU.Zero();return this.getDirectionToRef(L,U,x),x}getDirectionToRef(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0,p=null;U&&(p=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=F._TmpMats[0];G.p(this.getAbsoluteMatrix()),U&&p&&G.multiplyToRef(p,G),mL.YU.TransformNormalToRef(L,G,x),x.normalize()}getRotation(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=mL.YU.Zero();return this.getRotationToRef(L,U,x),x}getRotationToRef(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;const mL=F._TmpQuat;this.getRotationQuaternionToRef(L,U,mL),mL.toEulerAnglesToRef(x)}getRotationQuaternion(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=mL.Quaternion.Identity();return this.getRotationQuaternionToRef(L,U,x),x}getRotationQuaternionToRef(){let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),U.p(this._localRotation);else{const x=F._TmpMats[0],mL=this.getAbsoluteMatrix();L?mL.multiplyToRef(L.getWorldMatrix(),x):x.p(mL),x.multiplyAtIndex(0,this._scalingDeterminant),x.multiplyAtIndex(1,this._scalingDeterminant),x.multiplyAtIndex(2,this._scalingDeterminant),x.decompose(void 0,U,void 0)}}getRotationMatrix(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1?arguments[1]:void 0;const x=mL.Matrix.Identity();return this.getRotationMatrixToRef(L,U,x),x}getRotationMatrixToRef(){let L=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(U);else{const x=F._TmpMats[0],mL=this.getAbsoluteMatrix();L?mL.multiplyToRef(L.getWorldMatrix(),x):x.p(mL),x.multiplyAtIndex(0,this._scalingDeterminant),x.multiplyAtIndex(1,this._scalingDeterminant),x.multiplyAtIndex(2,this._scalingDeterminant),x.getRotationMatrixToRef(U)}}getAbsolutePositionFromLocal(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=mL.YU.Zero();return this.getAbsolutePositionFromLocalToRef(L,U,x),x}getAbsolutePositionFromLocalToRef(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0,p=null;U&&(p=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=F._TmpMats[0];G.p(this.getAbsoluteMatrix()),U&&p&&G.multiplyToRef(p,G),mL.YU.TransformCoordinatesToRef(L,G,x)}getLocalPositionFromAbsolute(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=mL.YU.Zero();return this.getLocalPositionFromAbsoluteToRef(L,U,x),x}getLocalPositionFromAbsoluteToRef(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0,p=null;U&&(p=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=F._TmpMats[0];G.p(this.getAbsoluteMatrix()),U&&p&&G.multiplyToRef(p,G),G.invert(),mL.YU.TransformCoordinatesToRef(L,G,x)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const L=this._skeleton.bones.indexOf(this);if(-1!==L&&this._skeleton.bones.splice(L,1),this._parentNode&&this._parentNode.children){const L=this._parentNode.children,U=L.indexOf(this);-1!==U&&L.splice(U,1)}super.dispose()}}F._TmpVecs=(0,p.e)(2,mL.YU.Zero),F._TmpQuat=mL.Quaternion.Identity(),F._TmpMats=(0,p.e)(5,mL.Matrix.Identity)},14779:(L,U,x)=>{"use strict";x.d(U,{b:()=>N});var mL=x(12571),p=x(12574),G=x(12391),F=x(12589),a=x(12610),o=x(13022),A=x(13046),r=x(12862),h=x(12420),b=x(12598);class E{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(L){this._zoomStopsAnimation=L}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(L){this._idleRotationSpeed=L}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(L){this._idleRotationWaitTime=L}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(L){this._idleRotationSpinupTime=L}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(L){this._attachedCamera=L;const U=this._attachedCamera.PL();this._onPrePointerObservableObserver=U.onPrePointerObservable.add((L=>{L.type!==r.b.POINTERDOWN?L.type===r.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const L=h.e.Now;let U=0;null!=this._lastFrameTime&&(U=L-this._lastFrameTime),this._lastFrameTime=L,this._applyUserInteraction();const x=L-this._lastInteractionTime-this._idleRotationWaitTime,mL=Math.max(Math.min(x/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*mL,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(U/1e3))}))}detach(){if(!this._attachedCamera)return;const L=this._attachedCamera.PL();this._onPrePointerObservableObserver&&L.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(L){this._lastInteractionTime=L??h.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<b.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let L=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(L=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?L:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=h.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Y=x(14785),S=x(13133);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(L){if(this._autoTransitionRange===L)return;this._autoTransitionRange=L;const U=this._attachedCamera;U&&(L?this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((L=>{if(L&&(L.fa(!0),L.getBoundingInfo)){const U=L.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*U,this.upperRadiusTransitionRange=.05*U}})):this._onMeshTargetChangedObserver&&U.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(L){this._attachedCamera=L,this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(L){return!!this._attachedCamera&&(this._attachedCamera.radius===L&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(L){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=S.c.CreateAnimation("radius",S.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const U=S.c.TransitionTo("radius",this._attachedCamera.radius+L,this._attachedCamera,this._attachedCamera.PL(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));U&&this._animatables.push(U)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new Y.c(.3),V.EasingMode=Y.r.EASINGMODE_EASEOUT;class H{constructor(){this.onTargetFramingAnimationEndObservable=new G.c,this._mode=H.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(L){this._mode=L}get mode(){return this._mode}set radiusScale(L){this._radiusScale=L}get radiusScale(){return this._radiusScale}set positionScale(L){this._positionScale=L}get positionScale(){return this._positionScale}set defaultElevation(L){this._defaultElevation=L}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(L){this._elevationReturnTime=L}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(L){this._elevationReturnWaitTime=L}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(L){this._zoomStopsAnimation=L}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(L){this._framingTime=L}get framingTime(){return this._framingTime}init(){}attach(L){this._attachedCamera=L;const U=this._attachedCamera.PL();H.EasingFunction.setEasingMode(H.EasingMode),this._onPrePointerObservableObserver=U.onPrePointerObservable.add((L=>{L.type!==r.b.POINTERDOWN?L.type===r.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=L.onMeshTargetChangedObservable.add((L=>{L&&L.getBoundingInfo&&this.zoomOnMesh(L,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const L=this._attachedCamera.PL();this._onPrePointerObservableObserver&&L.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.fa(!0);const mL=L.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(mL.minimumWorld,mL.maximumWorld,U,x)}zoomOnMeshHierarchy(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.fa(!0);const mL=L.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(mL.min,mL.max,U,x)}zoomOnMeshesHierarchy(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new F.YU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new F.YU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let G=0;G<L.length;G++){const U=L[G].getHierarchyBoundingVectors(!0);F.YU.CheckExtends(U.min,mL,p),F.YU.CheckExtends(U.max,mL,p)}this.zoomOnBoundingInfo(mL,p,U,x)}zoomOnBoundingInfo(L,U){let x,mL=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const G=L.y,a=G+(U.y-G)*this._positionScale,o=U.SU(L).scale(.5);if(!isFinite(a))return!1;if(mL)x=new F.YU(0,a,0);else{const U=L.add(o);x=new F.YU(U.x,a,U.z)}this._vectorTransition||(this._vectorTransition=S.c.CreateAnimation("target",S.c.ANIMATIONTYPE_VECTOR3,60,H.EasingFunction)),this._betaIsAnimating=!0;let A=S.c.TransitionTo("target",x,this._attachedCamera,this._attachedCamera.PL(),60,this._vectorTransition,this._framingTime);A&&this._animatables.push(A);let r=0;if(this._mode===H.FitFrustumSidesMode){const x=this._calculateLowerRadiusFromModelBoundingSphere(L,U);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=o.length()+this._attachedCamera.Qa),r=x}else this._mode===H.IgnoreBoundsSizeMode&&(r=this._calculateLowerRadiusFromModelBoundingSphere(L,U),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Qa));if(this.autoCorrectCameraLimitsAndSensibility){const x=U.SU(L).length();this._attachedCamera.panningSensibility=5e3/x,this._attachedCamera.wheelPrecision=100/r}return this._radiusTransition||(this._radiusTransition=S.c.CreateAnimation("radius",S.c.ANIMATIONTYPE_FLOAT,60,H.EasingFunction)),A=S.c.TransitionTo("radius",r,this._attachedCamera,this._attachedCamera.PL(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),p&&p(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),A&&this._animatables.push(A),!0}_calculateLowerRadiusFromModelBoundingSphere(L,U){const x=this._attachedCamera;if(!x)return 0;let mL=x._calculateLowerRadiusFromModelBoundingSphere(L,U,this._radiusScale);return x.lowerRadiusLimit&&this._mode===H.IgnoreBoundsSizeMode&&(mL=mL<x.lowerRadiusLimit?x.lowerRadiusLimit:mL),x.upperRadiusLimit&&(mL=mL>x.upperRadiusLimit?x.upperRadiusLimit:mL),mL}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const L=h.e.Now-this._lastInteractionTime,U=.5*Math.PI-this._defaultElevation,x=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>x&&L>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=S.c.CreateAnimation("beta",S.c.ANIMATIONTYPE_FLOAT,60,H.EasingFunction));const L=S.c.TransitionTo("beta",U,this._attachedCamera,this._attachedCamera.PL(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));L&&this._animatables.push(L)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=h.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}H.EasingFunction=new Y.y,H.EasingMode=Y.r.EASINGMODE_EASEINOUT,H.IgnoreBoundsSizeMode=0,H.FitFrustumSidesMode=1;var Q=x(13052),q=x(13093),f=x(14266),v=x(12382);class D{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(L){L=v.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),x=U.getInputElement();let mL=0,p=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=G=>{var F,a;const o=G.event,A="touch"===o.pointerType;if(G.type!==r.b.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const h=o.target;if(this._altKey=o.altKey,this._ctrlKey=o.ctrlKey,this._metaKey=o.metaKey,this._shiftKey=o.shiftKey,this._buttonsPressed=o.buttons,U.isPointerLock){const L=o.movementX,U=o.movementY;this.onTouch(null,L,U),this._pointA=null,this._pointB=null}else{if(G.type!==r.b.POINTERDOWN&&G.type!==r.b.POINTERDOUBLETAP&&A&&(null===(F=this._pointA)||void 0===F?void 0:F.pointerId)!==o.pointerId&&(null===(a=this._pointB)||void 0===a?void 0:a.pointerId)!==o.pointerId)return;if(G.type!==r.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!A)if(G.type===r.b.POINTERDOUBLETAP)this.onDoubleTap(o.pointerType);else if(G.type!==r.b.POINTERUP||this._currentMousePointerIdDown!==o.pointerId&&!A){if(G.type===r.b.POINTERMOVE)if(L||o.preventDefault(),this._pointA&&null===this._pointB){const L=o.clientX-this._pointA.x,U=o.clientY-this._pointA.y;this._pointA.x=o.clientX,this._pointA.y=o.clientY,this.onTouch(this._pointA,L,U)}else if(this._pointA&&this._pointB){const L=this._pointA.pointerId===o.pointerId?this._pointA:this._pointB;L.x=o.clientX,L.y=o.clientY;const U=this._pointA.x-this._pointB.x,x=this._pointA.y-this._pointB.y,F=U*U+x*x,a={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:o.pointerId,type:G.type};this.onMultiTouch(this._pointA,this._pointB,mL,F,p,a),p=a,mL=F}}else{try{null===h||void 0===h||h.releasePointerCapture(o.pointerId)}catch(b){}A||(this._pointB=null),U._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==o.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==o.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==mL||p)&&(this.onMultiTouch(this._pointA,this._pointB,mL,0,p,null),mL=0,p=null),this._currentMousePointerIdDown=-1,this.onButtonUp(o),L||o.preventDefault()}else{try{null===h||void 0===h||h.setPointerCapture(o.pointerId)}catch(b){}if(null===this._pointA)this._pointA={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType};else{if(null!==this._pointB)return;this._pointB={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType}}-1!==this._currentMousePointerIdDown||A||(this._currentMousePointerIdDown=o.pointerId),this.onButtonDown(o),L||(o.preventDefault(),x&&x.focus())}}},this._observer=this.camera.PL()._inputManager._addCameraPointerObserver(this._pointerInput,r.b.POINTERDOWN|r.b.POINTERUP|r.b.POINTERMOVE|r.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,mL=0,p=null,this.onLostFocus()},this._contextMenuBind=L=>this.onContextMenu(L),x&&x.addEventListener("contextmenu",this._contextMenuBind,!1);const G=this.camera.PL().getEngine().getHostWindow();G&&v.Tools.RegisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}UE(){if(this._onLostFocus){const L=this.camera.PL().getEngine().getHostWindow();L&&v.Tools.UnregisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.PL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const L=this.camera.PL().getEngine().getInputElement();L&&L.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(L){}onTouch(L,U,x){}onMultiTouch(L,U,x,mL,p,G){}onContextMenu(L){L.preventDefault()}onButtonDown(L){}onButtonUp(L){}onLostFocus(){}}(0,mL.d)([(0,p.R)()],D.prototype,"buttons",void 0);class P extends D{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(L,U){if(0!==this.panningSensibility&&L&&U){const x=U.x-L.x,mL=U.y-L.y;this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=mL/this.panningSensibility}}_computePinchZoom(L,U){const x=this.camera.radius||P.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=x*Math.sqrt(L)/Math.sqrt(U):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(U-L)*x*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(U-L)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(L,U,x){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=x/this.panningSensibility):(this.camera.inertialAlphaOffset-=U/this.angularSensibilityX,this.camera.inertialBetaOffset-=x/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(L,U,x,mL,p,G){0===x&&null===p||0===mL&&null===G||(this.multiTouchPanAndZoom?(this._computePinchZoom(x,mL),this._computeMultiTouchPanning(p,G)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(mL)-Math.sqrt(x))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(x,mL),this._isPinching=!0):this._computeMultiTouchPanning(p,G)):this.multiTouchPanning?this._computeMultiTouchPanning(p,G):this.pinchZoom&&this._computePinchZoom(x,mL))}onButtonDown(L){this._isPanClick=L.button===this.camera._panningMouseButton}onButtonUp(L){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}P.MinimumRadiusForPinch=.001,(0,mL.d)([(0,p.R)()],P.prototype,"buttons",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"angularSensibilityX",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"angularSensibilityY",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"pinchPrecision",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"pinchDeltaPercentage",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"useNaturalPinchZoom",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"pinchZoom",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"panningSensibility",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"multiTouchPanning",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"multiTouchPanAndZoom",void 0),f.e.ArcRotateCameraPointersInput=P;var d=x(12867);class K{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(L){L=v.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.PL(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const x=U.event;if(!x.metaKey)if(U.type===d.c.KEYDOWN){if(this._ctrlPressed=x.ctrlKey,this._altPressed=x.altKey,-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysReset.indexOf(x.keyCode)){-1===this._keys.indexOf(x.keyCode)&&this._keys.push(x.keyCode),x.preventDefault&&(L||x.preventDefault())}}else if(-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysReset.indexOf(x.keyCode)){const U=this._keys.indexOf(x.keyCode);U>=0&&this._keys.splice(U,1),x.preventDefault&&(L||x.preventDefault())}})))}UE(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const L=this.camera;for(let U=0;U<this._keys.length;U++){const x=this._keys[U];-1!==this.keysLeft.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningX-=1/this.panningSensibility:L.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?L.inertialRadiusOffset+=1/this.zoomingSensibility:L.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningX+=1/this.panningSensibility:L.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?L.inertialRadiusOffset-=1/this.zoomingSensibility:L.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(x)&&L.useInputToRestoreState&&L.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,mL.d)([(0,p.R)()],K.prototype,"keysUp",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"keysDown",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"keysLeft",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"keysRight",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"keysReset",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"panningSensibility",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"zoomingSensibility",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"useAltToZoom",void 0),(0,mL.d)([(0,p.R)()],K.prototype,"angularSpeed",void 0),f.e.ArcRotateCameraKeyboardMoveInput=K;var l=x(12639),i=x(12876);class X{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new F.YU(0,0,0),this._globalOffset=new F.YU(0,0,0),this._inertialPanning=F.YU.Zero()}_computeDeltaFromMouseWheelLegacyEvent(L,U){let x=0;const mL=.01*L*this.wheelDeltaPercentage*U;return x=L>0?mL/(1+this.wheelDeltaPercentage):mL*(1+this.wheelDeltaPercentage),x}attachControl(L){L=v.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==r.b.POINTERWHEEL)return;const x=U.event;let mL=0;const p=x.deltaMode===i.c.DOM_DELTA_LINE?40:1,G=-x.deltaY*p;if(this.customComputeDeltaFromMouseWheel)mL=this.customComputeDeltaFromMouseWheel(G,this,x);else if(this.wheelDeltaPercentage){if(mL=this._computeDeltaFromMouseWheelLegacyEvent(G,this.camera.radius),mL>0){let L=this.camera.radius,U=this.camera.inertialRadiusOffset+mL;for(let x=0;x<20&&!(L<=U)&&!(Math.abs(U*this.camera.inertia)<.001);x++)L-=U,U*=this.camera.inertia;L=(0,a.Clamp)(L,0,Number.MAX_VALUE),mL=this._computeDeltaFromMouseWheelLegacyEvent(G,L)}}else mL=G/(40*this.wheelPrecision);mL&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(mL)):this.camera.inertialRadiusOffset+=mL),x.preventDefault&&(L||x.preventDefault())},this._observer=this.camera.PL()._inputManager._addCameraPointerObserver(this._wheel,r.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.la(0)}UE(){this._observer&&(this.camera.PL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const L=this.camera;0+L.inertialAlphaOffset+L.inertialBetaOffset+L.inertialRadiusOffset&&(this._updateHitPlane(),L.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(L.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const L=this.camera,U=L.target.SU(L.position);this._hitPlane=l.d.FromPositionAndNormal(L.target,U)}_getPosition(){const L=this.camera,U=L.PL(),x=U.createPickingRay(U.pointerX,U.pointerY,F.Matrix.Identity(),L,!1);0===L.targetScreenOffset.x&&0===L.targetScreenOffset.y||(this._viewOffset.set(L.targetScreenOffset.x,L.targetScreenOffset.y,0),L.getViewMatrix().invertToRef(L._cameraTransformMatrix),this._globalOffset=F.YU.TransformNormal(this._viewOffset,L._cameraTransformMatrix),x.origin.addInPlace(this._globalOffset));let mL=0;return this._hitPlane&&(mL=x.intersectsPlane(this._hitPlane)??0),x.origin.addInPlace(x.direction.scaleInPlace(mL))}_zoomToMouse(L){const U=this.camera,x=1-U.inertia;if(U.lowerRadiusLimit){const mL=U.lowerRadiusLimit??0;U.radius-(U.inertialRadiusOffset+L)/x<mL&&(L=(U.radius-mL)*x-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const mL=U.upperRadiusLimit??0;U.radius-(U.inertialRadiusOffset+L)/x>mL&&(L=(U.radius-mL)*x-U.inertialRadiusOffset)}const mL=L/x/U.radius,p=this._getPosition(),G=F.TmpVectors.YU[6];p.subtractToRef(U.target,G),G.scaleInPlace(mL),G.scaleInPlace(x),this._inertialPanning.addInPlace(G),U.inertialRadiusOffset+=L}_zeroIfClose(L){Math.abs(L.x)<b.c&&(L.x=0),Math.abs(L.y)<b.c&&(L.y=0),Math.abs(L.z)<b.c&&(L.z=0)}}(0,mL.d)([(0,p.R)()],X.prototype,"wheelPrecision",void 0),(0,mL.d)([(0,p.R)()],X.prototype,"zoomToMouseLocation",void 0),(0,mL.d)([(0,p.R)()],X.prototype,"wheelDeltaPercentage",void 0),f.e.ArcRotateCameraMouseWheelInput=X;class t extends f.h{constructor(L){super(L)}addMouseWheel(){return this.add(new X),this}addPointers(){return this.add(new P),this}addKeyboard(){return this.add(new K),this}}var y=x(12547);function n(L,U){return isNaN(L)?U:L}o.e.AddNodeConstructor("ArcRotateCamera",((L,U)=>()=>new N(L,0,0,1,F.YU.Zero(),U)));class N extends q.b{get target(){return this._target}set target(L){this.setTarget(L)}get targetHost(){return this._targetHost}set targetHost(L){L&&this.setTarget(L)}getTarget(){return this.target}get position(){return this._position}set position(L){this.setPosition(L)}set upVector(L){this._upToYMatrix||(this._yToUpMatrix=new F.Matrix,this._upToYMatrix=new F.Matrix,this._upVector=F.YU.Zero()),L.normalize(),this._upVector.p(L),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){F.Matrix.RotationAlignToRef(F.YU.UpReadOnly,this._upVector,this._yToUpMatrix),F.Matrix.RotationAlignToRef(this._upVector,F.YU.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const L=this.inputs.attached.pointers;return L?L.angularSensibilityX:0}set angularSensibilityX(L){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityX=L)}get angularSensibilityY(){const L=this.inputs.attached.pointers;return L?L.angularSensibilityY:0}set angularSensibilityY(L){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityY=L)}get pinchPrecision(){const L=this.inputs.attached.pointers;return L?L.pinchPrecision:0}set pinchPrecision(L){const U=this.inputs.attached.pointers;U&&(U.pinchPrecision=L)}get pinchDeltaPercentage(){const L=this.inputs.attached.pointers;return L?L.pinchDeltaPercentage:0}set pinchDeltaPercentage(L){const U=this.inputs.attached.pointers;U&&(U.pinchDeltaPercentage=L)}get useNaturalPinchZoom(){const L=this.inputs.attached.pointers;return!!L&&L.useNaturalPinchZoom}set useNaturalPinchZoom(L){const U=this.inputs.attached.pointers;U&&(U.useNaturalPinchZoom=L)}get panningSensibility(){const L=this.inputs.attached.pointers;return L?L.panningSensibility:0}set panningSensibility(L){const U=this.inputs.attached.pointers;U&&(U.panningSensibility=L)}get keysUp(){const L=this.inputs.attached.keyboard;return L?L.keysUp:[]}set keysUp(L){const U=this.inputs.attached.keyboard;U&&(U.keysUp=L)}get keysDown(){const L=this.inputs.attached.keyboard;return L?L.keysDown:[]}set keysDown(L){const U=this.inputs.attached.keyboard;U&&(U.keysDown=L)}get keysLeft(){const L=this.inputs.attached.keyboard;return L?L.keysLeft:[]}set keysLeft(L){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=L)}get keysRight(){const L=this.inputs.attached.keyboard;return L?L.keysRight:[]}set keysRight(L){const U=this.inputs.attached.keyboard;U&&(U.keysRight=L)}get wheelPrecision(){const L=this.inputs.attached.mousewheel;return L?L.wheelPrecision:0}set wheelPrecision(L){const U=this.inputs.attached.mousewheel;U&&(U.wheelPrecision=L)}get zoomToMouseLocation(){const L=this.inputs.attached.mousewheel;return!!L&&L.zoomToMouseLocation}set zoomToMouseLocation(L){const U=this.inputs.attached.mousewheel;U&&(U.zoomToMouseLocation=L)}get wheelDeltaPercentage(){const L=this.inputs.attached.mousewheel;return L?L.wheelDeltaPercentage:0}set wheelDeltaPercentage(L){const U=this.inputs.attached.mousewheel;U&&(U.wheelDeltaPercentage=L)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(L){L!==this.useBouncingBehavior&&(L?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(L){L!==this.useFramingBehavior&&(L?(this._framingBehavior=new H,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(L){L!==this.useAutoRotationBehavior&&(L?(this._autoRotationBehavior=new E,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(L,U,x,mL,p,a){var o;let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(L,F.YU.Zero(),a,A),o=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=F.YU.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=F.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new F.Matrix,this.panningAxis=new F.YU(1,1,0),this._transformedDirection=new F.YU,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new G.c,this.checkCollisions=!1,this.collisionRadius=new F.YU(.5,.5,.5),this._previousPosition=F.YU.Zero(),this._collisionVelocity=F.YU.Zero(),this._newPosition=F.YU.Zero(),this._computationVector=F.YU.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new F.YU(NaN,NaN,NaN),this._goalTargetScreenOffset=new F.Vector2(NaN,NaN),this._onCollisionPositionChange=function(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x?(o.setPosition(U),o.gY&&o.gY(x)):o._previousPosition.p(o._position);const mL=Math.cos(o.alpha),p=Math.sin(o.alpha),G=Math.cos(o.beta);let F=Math.sin(o.beta);0===F&&(F=1e-4);const a=o._getTargetPosition();o._computationVector.da(o.radius*mL*F,o.radius*G,o.radius*p*F),a.addToRef(o._computationVector,o._newPosition),o._position.p(o._newPosition);let A=o.upVector;o.allowUpsideDown&&o.beta<0&&(A=A.clone(),A=A.negate()),o._computeViewMatrix(o._position,a,A),o._viewMatrix.addAtIndex(12,o.targetScreenOffset.x),o._viewMatrix.addAtIndex(13,o.targetScreenOffset.y),o._collisionTriggered=!1},this._target=F.YU.Zero(),p&&this.setTarget(p),this.alpha=U,this.beta=x,this.radius=mL,this.getViewMatrix(),this.inputs=new t(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new F.YU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=F.Vector2.Zero()}_updateCache(L){L||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const L=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?L.addToRef(this._targetBoundingCenter,this._target):this._target.p(L)}const L=this._getLockedTargetPosition();return L||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>b.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,G=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=G?this._currentInterpolationFactor=G:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=n(L,this._goalAlpha),this._goalBeta=n(U,this._goalBeta),this._goalRadius=n(x,this._goalRadius),this._goalTarget.set(n(mL.x,this._goalTarget.x),n(mL.y,this._goalTarget.y),n(mL.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(n(p.x,this._goalTargetScreenOffset.x),n(p.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,a.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,a.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,a.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,a.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(L,U){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const p=arguments;U=v.Tools.BackCompatCameraNoPreventDefault(p),this._useCtrlForPanning=x,this._panningMouseButton=mL,"boolean"===typeof p[0]&&(p.length>1&&(this._useCtrlForPanning=p[1]),p.length>2&&(this._panningMouseButton=p[2])),this.inputs.attachElement(U),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}UE(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let L=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){L=!0;const U=this.invertRotation?-1:1,x=this._calculateHandednessMultiplier();let mL=this.inertialAlphaOffset*x;this.beta<0&&(mL*=-1),this.alpha+=mL*U,this.beta+=this.inertialBetaOffset*U,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<b.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<b.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*b.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){L=!0;const U=new F.YU(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),U.multiplyInPlace(this.panningAxis),F.YU.TransformNormalToRef(U,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const L=this.upVector,U=F.YU.CrossToRef(this._transformedDirection,L,this._transformedDirection);F.YU.CrossToRef(L,U,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);F.YU.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const L=F.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(L),L.transposeToRef(L),F.YU.TransformCoordinatesToRef(this._transformedDirection,L,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*b.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*b.c&&(this.inertialPanningY=0)}if(L)this.stopInterpolation();else if(this._isInterpolating){let L=!1;const U=this._scene.getEngine().getDeltaTime()/1e3,x=1-Math.pow(2,-U/this._currentInterpolationFactor),mL=n(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const U=F.TmpVectors.YU[0].set(n(this._goalTarget.x,this._target.x),n(this._goalTarget.y,this._target.y),n(this._goalTarget.z,this._target.z));F.YU.LerpToRef(this.target,U,x,this._target),10*F.YU.Distance(this.target,U)/mL<b.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(U),this.setTarget(this.target,!1,!0,!0)):L=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const U=F.Quaternion.RotationAlphaBetaGammaToRef(n(this._goalAlpha,this.alpha),n(this._goalBeta,this.beta),0,F.TmpVectors.Quaternion[0]),mL=F.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,F.TmpVectors.Quaternion[1]),p=F.Quaternion.SlerpToRef(mL,U,x,F.TmpVectors.Quaternion[2]);p.normalize();const G=p.toAlphaBetaGammaToRef(F.TmpVectors.YU[0]);if(this.alpha=G.x,this.beta=G.y,p.isApprox(U,b.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const L=U.toAlphaBetaGammaToRef(F.TmpVectors.YU[0]);this.alpha=L.x,this.beta=L.y}else L=!0}if(isNaN(this._goalRadius)||(this.radius+=(mL-this.radius)*x,Math.abs(mL/this.radius-1)<b.c?(this._goalRadius=NaN,this.radius=mL):L=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const U=F.TmpVectors.Vector2[0].set(n(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),n(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));F.Vector2.LerpToRef(this.targetScreenOffset,U,x,this.targetScreenOffset),F.Vector2.Distance(this.targetScreenOffset,U)<b.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(U)):L=!0}this._isInterpolating=L}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.YU.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const L=this.alpha;var U,x;this.alpha=function(L){let U=Math.PI/2;return 0===L.x&&0===L.z||(U=Math.acos(L.x/Math.sqrt(Math.pow(L.x,2)+Math.pow(L.z,2)))),L.z<0&&(U=2*Math.PI-U),U}(this._computationVector),this.beta=(U=this._computationVector.y,x=this.radius,Math.acos(U/x));const mL=Math.round((L-this.alpha)/(2*Math.PI));this.alpha+=2*mL*Math.PI,this._checkLimits()}setPosition(L){this._position.equals(L)||(this._position.p(L),this.rebuildAnglesAndRadius())}setTarget(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(mL=this.overrideCloneAlphaBetaRadius??mL,L.fa)U&&L.getBoundingInfo?this._targetBoundingCenter=L.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,L.fa(),this._targetHost=L,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const U=L,mL=this._getTargetPosition();if(mL&&!x&&mL.equals(U))return;this._targetHost=null,this._target=U,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}mL||this.rebuildAnglesAndRadius()}_getViewMatrix(){const L=Math.cos(this.alpha),U=Math.sin(this.alpha),x=Math.cos(this.beta);let mL=Math.sin(this.beta);0===mL&&(mL=1e-4),0===this.radius&&(this.radius=1e-4);const p=this._getTargetPosition();if(this._computationVector.da(this.radius*L*mL,this.radius*x,this.radius*U*mL),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.YU.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),p.addToRef(this._computationVector,this._newPosition),this.PL().collisionsEnabled&&this.checkCollisions){const L=this.PL().collisionCoordinator;this._collider||(this._collider=L.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,L.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let L=this.upVector;this.allowUpsideDown&&mL<0&&(L=L.negate()),this._computeViewMatrix(this._position,p,L),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(p),this._viewMatrix}zoomOn(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];L=L||this.PL().meshes;const x=A.e.MinMax(L);let mL=this._calculateLowerRadiusFromModelBoundingSphere(x.min,x.max);if(mL=Math.max(Math.min(mL,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=mL*this.zoomOnFactor,this.mode===Q.c.ORTHOGRAPHIC_CAMERA){const L=this.PL().getEngine().getAspectRatio(this),U=mL*this.zoomOnFactor/2;this.orthoLeft=-U*L,this.orthoRight=U*L,this.orthoBottom=-U,this.orthoTop=U}this.focusOn({min:x.min,max:x.max,distance:mL},U)}focusOn(L){let U,x,mL=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===L.min){const mL=L||this.PL().meshes;U=A.e.MinMax(mL),x=F.YU.Distance(U.min,U.max)}else{U=L,x=L.distance}this._target=A.e.Center(U),mL||(this.maxZ=2*x)}createRigCamera(L,U){let x=0;switch(this.cameraRigMode){case Q.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case Q.c.RIG_MODE_VR:x=this._cameraRigParams.stereoHalfAngle*(0===U?1:-1);break;case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:x=this._cameraRigParams.stereoHalfAngle*(0===U?-1:1)}const mL=new N(L,this.alpha+x,this.beta,this.radius,this._target,this.PL());return mL._cameraRigParams={},mL.isRigCamera=!0,mL.rigParent=this,mL.upVector=this.upVector,mL.mode=this.mode,mL.orthoLeft=this.orthoLeft,mL.orthoRight=this.orthoRight,mL.orthoBottom=this.orthoBottom,mL.orthoTop=this.orthoTop,mL}_updateRigCameras(){const L=this._rigCameras[0],U=this._rigCameras[1];switch(L.beta=U.beta=this.beta,this.cameraRigMode){case Q.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case Q.c.RIG_MODE_VR:L.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:L.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const mL=F.YU.Distance(L,U),p=this.PL().getEngine().getAspectRatio(this),G=Math.tan(this.fov/2),a=G*p,o=.5*mL*x,A=o*Math.sqrt(1+1/(a*a)),r=o*Math.sqrt(1+1/(G*G));return Math.max(A,r)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,mL.d)([(0,p.R)()],N.prototype,"alpha",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"beta",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"radius",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,mL.d)([(0,p.Q)("target")],N.prototype,"_target",void 0),(0,mL.d)([(0,p.C)("targetHost")],N.prototype,"_targetHost",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"inertialAlphaOffset",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"inertialBetaOffset",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"inertialRadiusOffset",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"lowerAlphaLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"upperAlphaLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"lowerBetaLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"upperBetaLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"lowerRadiusLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"upperRadiusLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"lowerTargetYLimit",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"inertialPanningX",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"inertialPanningY",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"pinchToPanMaxDistance",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"panningDistanceLimit",void 0),(0,mL.d)([(0,p.Q)()],N.prototype,"panningOriginTarget",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"panningInertia",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"zoomToMouseLocation",null),(0,mL.d)([(0,p.R)()],N.prototype,"zoomOnFactor",void 0),(0,mL.d)([(0,p.N)()],N.prototype,"targetScreenOffset",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"allowUpsideDown",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"useInputToRestoreState",void 0),(0,mL.d)([(0,p.R)()],N.prototype,"restoreStateInterpolationFactor",void 0),(0,y.d)("BABYLON.ArcRotateCamera",N)},14266:(L,U,x)=>{"use strict";x.d(U,{e:()=>F,h:()=>a});var mL=x(12406),p=x(12625),G=x(13052),F={};class a{constructor(L){this.attachedToElement=!1,this.attached={},this.camera=L,this.checkInputs=()=>{}}add(L){const U=L.getSimpleName();this.attached[U]?mL.c.Warn("camera input of type "+U+" already exists on camera"):(this.attached[U]=L,L.camera=this.camera,L.checkInputs&&(this.checkInputs=this._addCheckInputs(L.checkInputs.bind(L))),this.attachedToElement&&L.attachControl(this.noPreventDefault))}remove(L){for(const U in this.attached){const x=this.attached[U];if(x===L)return x.UE(),x.camera=null,delete this.attached[U],void this.rebuildInputCheck()}}removeByType(L){for(const U in this.attached){const x=this.attached[U];x.getClassName()===L&&(x.UE(),x.camera=null,delete this.attached[U],this.rebuildInputCheck())}}_addCheckInputs(L){const U=this.checkInputs;return()=>{U(),L()}}attachInput(L){this.attachedToElement&&L.attachControl(this.noPreventDefault)}attachElement(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){L=!G.c.ForceAttachControlToAlwaysPreventDefault&&L,this.attachedToElement=!0,this.noPreventDefault=L;for(const U in this.attached)this.attached[U].attachControl(L)}}detachElement(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const U in this.attached)this.attached[U].UE(),L&&(this.attached[U].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const L in this.attached){const U=this.attached[L];U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(L){const U={};for(const x in this.attached){const L=this.attached[x],mL=p.e.Serialize(L);U[L.getClassName()]=mL}L.inputsmgr=U}parse(L){const U=L.inputsmgr;if(U){this.clear();for(const L in U){const x=F[L];if(x){const mL=U[L],G=p.e.Parse((()=>new x),mL,null);this.add(G)}}}else for(const x in this.attached){const U=F[this.attached[x].getClassName()];if(U){const mL=p.e.Parse((()=>new U),L,null);this.remove(this.attached[x]),this.add(mL)}}}}},14258:(L,U,x)=>{"use strict";x.d(U,{c:()=>D});var mL=x(12571),p=x(12574),G=x(12589),F=x(13093),a=x(14266),o=x(12867),A=x(12382);class r{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(L){L=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.PL(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const x=U.event;if(!x.metaKey)if(U.type===o.c.KEYDOWN){if(-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysUpward.indexOf(x.keyCode)||-1!==this.keysDownward.indexOf(x.keyCode)||-1!==this.keysRotateLeft.indexOf(x.keyCode)||-1!==this.keysRotateRight.indexOf(x.keyCode)||-1!==this.keysRotateUp.indexOf(x.keyCode)||-1!==this.keysRotateDown.indexOf(x.keyCode)){-1===this._keys.indexOf(x.keyCode)&&this._keys.push(x.keyCode),L||x.preventDefault()}}else if(-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysUpward.indexOf(x.keyCode)||-1!==this.keysDownward.indexOf(x.keyCode)||-1!==this.keysRotateLeft.indexOf(x.keyCode)||-1!==this.keysRotateRight.indexOf(x.keyCode)||-1!==this.keysRotateUp.indexOf(x.keyCode)||-1!==this.keysRotateDown.indexOf(x.keyCode)){const U=this._keys.indexOf(x.keyCode);U>=0&&this._keys.splice(U,1),L||x.preventDefault()}})))}UE(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const L=this.camera;for(let U=0;U<this._keys.length;U++){const x=this._keys[U],mL=L._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(x)?L._localDirection.da(-mL,0,0):-1!==this.keysUp.indexOf(x)?L._localDirection.da(0,0,mL):-1!==this.keysRight.indexOf(x)?L._localDirection.da(mL,0,0):-1!==this.keysDown.indexOf(x)?L._localDirection.da(0,0,-mL):-1!==this.keysUpward.indexOf(x)?L._localDirection.da(0,mL,0):-1!==this.keysDownward.indexOf(x)?L._localDirection.da(0,-mL,0):-1!==this.keysRotateLeft.indexOf(x)?(L._localDirection.da(0,0,0),L.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(x)?(L._localDirection.da(0,0,0),L.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(x)?(L._localDirection.da(0,0,0),L.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(x)&&(L._localDirection.da(0,0,0),L.cameraRotation.x+=this._getLocalRotation()),L.PL().useRightHandedSystem&&(L._localDirection.z*=-1),L.getViewMatrix().invertToRef(L._cameraTransformMatrix),G.YU.TransformNormalToRef(L._localDirection,L._cameraTransformMatrix,L._transformedDirection),L.cameraDirection.addInPlace(L._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const L=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*L}}(0,mL.d)([(0,p.R)()],r.prototype,"keysUp",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysUpward",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysDown",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysDownward",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysLeft",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysRight",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"rotationSpeed",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysRotateLeft",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysRotateRight",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysRotateUp",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"keysRotateDown",void 0),a.e.FreeCameraKeyboardMoveInput=r;var h=x(12391),b=x(12862);class E{constructor(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=L,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new h.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(L){L=A.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),x=U.getInputElement();this._pointerInput||(this._pointerInput=mL=>{const p=mL.event,G="touch"===p.pointerType;if(!this.touchEnabled&&G)return;if(mL.type!==b.b.POINTERMOVE&&-1===this.buttons.indexOf(p.button))return;const F=p.target;if(mL.type===b.b.POINTERDOWN){if(G&&-1!==this._activePointerId||!G&&-1!==this._currentActiveButton)return;this._activePointerId=p.pointerId;try{null===F||void 0===F||F.setPointerCapture(p.pointerId)}catch(a){}-1===this._currentActiveButton&&(this._currentActiveButton=p.button),this._previousPosition={x:p.clientX,y:p.clientY},L||(p.preventDefault(),x&&x.focus()),U.isPointerLock&&this._onMouseMove&&this._onMouseMove(mL.event)}else if(mL.type===b.b.POINTERUP){if(G&&this._activePointerId!==p.pointerId||!G&&this._currentActiveButton!==p.button)return;try{null===F||void 0===F||F.releasePointerCapture(p.pointerId)}catch(a){}this._currentActiveButton=-1,this._previousPosition=null,L||p.preventDefault(),this._activePointerId=-1}else if(mL.type===b.b.POINTERMOVE&&(this._activePointerId===p.pointerId||!G))if(U.isPointerLock&&this._onMouseMove)this._onMouseMove(mL.event);else if(this._previousPosition){const U=this.camera._calculateHandednessMultiplier(),x=(p.clientX-this._previousPosition.x)*U,mL=p.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=x/this.angularSensibility,this.camera.cameraRotation.x+=mL/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:x,offsetY:mL}),this._previousPosition={x:p.clientX,y:p.clientY},L||p.preventDefault()}}),this._onMouseMove=x=>{if(!U.isPointerLock)return;const mL=this.camera._calculateHandednessMultiplier(),p=x.movementX*mL;this.camera.cameraRotation.y+=p/this.angularSensibility;const G=x.movementY;this.camera.cameraRotation.x+=G/this.angularSensibility,this._previousPosition=null,L||x.preventDefault()},this._observer=this.camera.PL()._inputManager._addCameraPointerObserver(this._pointerInput,b.b.POINTERDOWN|b.b.POINTERUP|b.b.POINTERMOVE),x&&(this._contextMenuBind=L=>this.onContextMenu(L),x.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(L){L.preventDefault()}UE(){if(this._observer){if(this.camera.PL()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const L=this.camera.getEngine().getInputElement();L&&L.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,mL.d)([(0,p.R)()],E.prototype,"buttons",void 0),(0,mL.d)([(0,p.R)()],E.prototype,"angularSensibility",void 0),a.e.FreeCameraMouseInput=E;var Y,S=x(12876);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new h.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(L){L=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==b.b.POINTERWHEEL)return;const x=U.event,mL=x.deltaMode===S.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*mL*x.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*mL*x.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*mL*x.deltaZ/this._normalize,x.preventDefault&&(L||x.preventDefault())},this._observer=this.camera.PL()._inputManager._addCameraPointerObserver(this._wheel,b.b.POINTERWHEEL)}UE(){this._observer&&(this.camera.PL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,mL.d)([(0,p.R)()],V.prototype,"wheelPrecisionX",void 0),(0,mL.d)([(0,p.R)()],V.prototype,"wheelPrecisionY",void 0),(0,mL.d)([(0,p.R)()],V.prototype,"wheelPrecisionZ",void 0),function(L){L[L.MoveRelative=0]="MoveRelative",L[L.RotateRelative=1]="RotateRelative",L[L.MoveScene=2]="MoveScene"}(Y||(Y={}));class H extends V{constructor(){super(...arguments),this._moveRelative=G.YU.Zero(),this._rotateRelative=G.YU.Zero(),this._moveScene=G.YU.Zero(),this._wheelXAction=Y.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Y.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(L){null===L&&this._wheelXAction!==Y.MoveRelative||(this._wheelXAction=Y.MoveRelative,this._wheelXActionCoordinate=L)}get wheelXMoveRelative(){return this._wheelXAction!==Y.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(L){null===L&&this._wheelYAction!==Y.MoveRelative||(this._wheelYAction=Y.MoveRelative,this._wheelYActionCoordinate=L)}get wheelYMoveRelative(){return this._wheelYAction!==Y.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(L){null===L&&this._wheelZAction!==Y.MoveRelative||(this._wheelZAction=Y.MoveRelative,this._wheelZActionCoordinate=L)}get wheelZMoveRelative(){return this._wheelZAction!==Y.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(L){null===L&&this._wheelXAction!==Y.RotateRelative||(this._wheelXAction=Y.RotateRelative,this._wheelXActionCoordinate=L)}get wheelXRotateRelative(){return this._wheelXAction!==Y.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(L){null===L&&this._wheelYAction!==Y.RotateRelative||(this._wheelYAction=Y.RotateRelative,this._wheelYActionCoordinate=L)}get wheelYRotateRelative(){return this._wheelYAction!==Y.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(L){null===L&&this._wheelZAction!==Y.RotateRelative||(this._wheelZAction=Y.RotateRelative,this._wheelZActionCoordinate=L)}get wheelZRotateRelative(){return this._wheelZAction!==Y.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(L){null===L&&this._wheelXAction!==Y.MoveScene||(this._wheelXAction=Y.MoveScene,this._wheelXActionCoordinate=L)}get wheelXMoveScene(){return this._wheelXAction!==Y.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(L){null===L&&this._wheelYAction!==Y.MoveScene||(this._wheelYAction=Y.MoveScene,this._wheelYActionCoordinate=L)}get wheelYMoveScene(){return this._wheelYAction!==Y.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(L){null===L&&this._wheelZAction!==Y.MoveScene||(this._wheelZAction=Y.MoveScene,this._wheelZActionCoordinate=L)}get wheelZMoveScene(){return this._wheelZAction!==Y.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.la(0),this._rotateRelative.la(0),this._moveScene.la(0),this._updateCamera(),this.camera.PL().useRightHandedSystem&&(this._moveRelative.z*=-1);const L=G.Matrix.Zero();this.camera.getViewMatrix().invertToRef(L);const U=G.YU.Zero();G.YU.TransformNormalToRef(this._moveRelative,L,U),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(U),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(L,U,x){if(0===L)return;if(null===U||null===x)return;let mL=null;switch(U){case Y.MoveRelative:mL=this._moveRelative;break;case Y.RotateRelative:mL=this._rotateRelative;break;case Y.MoveScene:mL=this._moveScene}switch(x){case 0:mL.set(L,0,0);break;case 1:mL.set(0,L,0);break;case 2:mL.set(0,0,L)}}}(0,mL.d)([(0,p.R)()],H.prototype,"wheelXMoveRelative",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelYMoveRelative",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelZMoveRelative",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelXRotateRelative",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelYRotateRelative",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelZRotateRelative",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelXMoveScene",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelYMoveScene",null),(0,mL.d)([(0,p.R)()],H.prototype,"wheelZMoveScene",null),a.e.FreeCameraMouseWheelInput=H;class Q{constructor(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=L,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=A.Tools.IsSafari()}attachControl(L){L=A.Tools.BackCompatCameraNoPreventDefault(arguments);let U=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=x=>{const mL=x.event,p="mouse"===mL.pointerType||this._isSafari&&"undefined"===typeof mL.pointerType;if(this.allowMouse||!p)if(x.type===b.b.POINTERDOWN){if(L||mL.preventDefault(),this._pointerPressed.push(mL.pointerId),1!==this._pointerPressed.length)return;U={x:mL.clientX,y:mL.clientY}}else if(x.type===b.b.POINTERUP){L||mL.preventDefault();const x=this._pointerPressed.indexOf(mL.pointerId);if(-1===x)return;if(this._pointerPressed.splice(x,1),0!=x)return;U=null,this._offsetX=null,this._offsetY=null}else if(x.type===b.b.POINTERMOVE){if(L||mL.preventDefault(),!U)return;if(0!=this._pointerPressed.indexOf(mL.pointerId))return;this._offsetX=mL.clientX-U.x,this._offsetY=-(mL.clientY-U.y)}}),this._observer=this.camera.PL()._inputManager._addCameraPointerObserver(this._pointerInput,b.b.POINTERDOWN|b.b.POINTERUP|b.b.POINTERMOVE),this._onLostFocus){const L=this.camera.getEngine().getInputElement();L&&L.addEventListener("blur",this._onLostFocus)}}UE(){if(this._pointerInput){if(this._observer&&(this.camera.PL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const L=this.camera.getEngine().getInputElement();L&&L.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const L=this.camera,U=L._calculateHandednessMultiplier();L.cameraRotation.y=U*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)L.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const U=L._computeLocalCameraSpeed(),x=new G.YU(0,0,0!==this.touchMoveSensibility?U*this._offsetY/this.touchMoveSensibility:0);G.Matrix.RotationYawPitchRollToRef(L.rotation.y,L.rotation.x,0,L._cameraRotationMatrix),L.cameraDirection.addInPlace(G.YU.TransformCoordinates(x,L._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,mL.d)([(0,p.R)()],Q.prototype,"touchAngularSensibility",void 0),(0,mL.d)([(0,p.R)()],Q.prototype,"touchMoveSensibility",void 0),a.e.FreeCameraTouchInput=Q;class q extends a.h{constructor(L){super(L),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new r),this}addMouse(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new E(L),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new H,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Q),this}clear(){super.clear(),this._mouseInput=null}}var f=x(12547),v=x(12479);class D extends F.b{get angularSensibility(){const L=this.inputs.attached.mouse;return L?L.angularSensibility:0}set angularSensibility(L){const U=this.inputs.attached.mouse;U&&(U.angularSensibility=L)}get keysUp(){const L=this.inputs.attached.keyboard;return L?L.keysUp:[]}set keysUp(L){const U=this.inputs.attached.keyboard;U&&(U.keysUp=L)}get keysUpward(){const L=this.inputs.attached.keyboard;return L?L.keysUpward:[]}set keysUpward(L){const U=this.inputs.attached.keyboard;U&&(U.keysUpward=L)}get keysDown(){const L=this.inputs.attached.keyboard;return L?L.keysDown:[]}set keysDown(L){const U=this.inputs.attached.keyboard;U&&(U.keysDown=L)}get keysDownward(){const L=this.inputs.attached.keyboard;return L?L.keysDownward:[]}set keysDownward(L){const U=this.inputs.attached.keyboard;U&&(U.keysDownward=L)}get keysLeft(){const L=this.inputs.attached.keyboard;return L?L.keysLeft:[]}set keysLeft(L){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=L)}get keysRight(){const L=this.inputs.attached.keyboard;return L?L.keysRight:[]}set keysRight(L){const U=this.inputs.attached.keyboard;U&&(U.keysRight=L)}get keysRotateLeft(){const L=this.inputs.attached.keyboard;return L?L.keysRotateLeft:[]}set keysRotateLeft(L){const U=this.inputs.attached.keyboard;U&&(U.keysRotateLeft=L)}get keysRotateRight(){const L=this.inputs.attached.keyboard;return L?L.keysRotateRight:[]}set keysRotateRight(L){const U=this.inputs.attached.keyboard;U&&(U.keysRotateRight=L)}get keysRotateUp(){const L=this.inputs.attached.keyboard;return L?L.keysRotateUp:[]}set keysRotateUp(L){const U=this.inputs.attached.keyboard;U&&(U.keysRotateUp=L)}get keysRotateDown(){const L=this.inputs.attached.keyboard;return L?L.keysRotateDown:[]}set keysRotateDown(L){const U=this.inputs.attached.keyboard;U&&(U.keysRotateDown=L)}constructor(L,U,x){var mL;super(L,U,x,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),mL=this,this.ellipsoid=new G.YU(.5,1,.5),this.ellipsoidOffset=new G.YU(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=G.YU.Zero(),this._diffPosition=G.YU.Zero(),this._newPosition=G.YU.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;mL._newPosition.p(U),mL._newPosition.subtractToRef(mL._oldPosition,mL._diffPosition),mL._diffPosition.length()>v.e.CollisionsEpsilon&&(mL.position.addToRef(mL._diffPosition,mL._deferredPositionUpdate),mL._deferOnly?mL._deferredUpdated=!0:mL.position.p(mL._deferredPositionUpdate),mL.gY&&x&&mL.gY(x))},this.inputs=new q(this),this.inputs.addKeyboard().addMouse()}attachControl(L,U){U=A.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(U)}UE(){this.inputs.detachElement(),this.cameraDirection=new G.YU(0,0,0),this.cameraRotation=new G.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(L){this._collisionMask=isNaN(L)?-1:L}_collideWithWorld(L){let U;U=this.parent?G.YU.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,U.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const x=this.PL().collisionCoordinator;this._collider||(this._collider=x.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let mL=L;this.applyGravity&&(mL=L.add(this.PL().gravity)),x.getNewPosition(this._oldPosition,mL,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=G.YU.Zero(),this._transformedDirection=G.YU.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(L){this._needMoveForGravity=L}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.PL().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Lh"}}(0,mL.d)([(0,p.Q)()],D.prototype,"ellipsoid",void 0),(0,mL.d)([(0,p.Q)()],D.prototype,"ellipsoidOffset",void 0),(0,mL.d)([(0,p.R)()],D.prototype,"checkCollisions",void 0),(0,mL.d)([(0,p.R)()],D.prototype,"applyGravity",void 0),(0,f.d)("BABYLON.FreeCamera",D)},14839:(L,U,x)=>{"use strict";x.d(U,{c:()=>G});var mL=x(12684),p=x(14844);class G{constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=x,this.Sh=[],this._maxBlockCapacity=U||64,this._selectionContent=new mL.d(1024),this._creationFunc=L}update(L,U,x){p.b._CreateBlocks(L,U,x,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Er(L){for(let U=0;U<this.lr.length;U++){this.lr[U].addEntry(L)}}br(L){for(let U=0;U<this.lr.length;U++){this.lr[U].removeEntry(L)}}select(L,U){this._selectionContent.reset();for(let x=0;x<this.lr.length;x++){this.lr[x].select(L,this._selectionContent,U)}return U?this._selectionContent.concat(this.Sh):this._selectionContent.concatWithNoDuplicate(this.Sh),this._selectionContent}intersects(L,U,x){this._selectionContent.reset();for(let mL=0;mL<this.lr.length;mL++){this.lr[mL].intersects(L,U,this._selectionContent,x)}return x?this._selectionContent.concat(this.Sh):this._selectionContent.concatWithNoDuplicate(this.Sh),this._selectionContent}intersectsRay(L){this._selectionContent.reset();for(let U=0;U<this.lr.length;U++){this.lr[U].intersectsRay(L,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Sh),this._selectionContent}}G.CreationFuncForMeshes=(L,U)=>{const x=L.getBoundingInfo();!L.isBlocked&&x.boundingBox.intersectsMinMax(U.Kh,U.ih)&&U.entries.push(L)},G.CreationFuncForSubMeshes=(L,U)=>{L.getBoundingInfo().boundingBox.intersectsMinMax(U.Kh,U.ih)&&U.entries.push(L)}},14844:(L,U,x)=>{"use strict";x.d(U,{b:()=>G});var mL=x(12589),p=x(12940);class G{constructor(L,U,x,mL,p,G){this.entries=[],this.Xh=new Array,this._capacity=x,this._depth=mL,this._maxDepth=p,this._creationFunc=G,this._minPoint=L,this._maxPoint=U,this.Xh.push(L.clone()),this.Xh.push(U.clone()),this.Xh.push(L.clone()),this.Xh[2].x=U.x,this.Xh.push(L.clone()),this.Xh[3].y=U.y,this.Xh.push(L.clone()),this.Xh[4].z=U.z,this.Xh.push(U.clone()),this.Xh[5].z=L.z,this.Xh.push(U.clone()),this.Xh[6].x=L.x,this.Xh.push(U.clone()),this.Xh[7].y=L.y}get ga(){return this._capacity}get Kh(){return this._minPoint}get ih(){return this._maxPoint}addEntry(L){if(this.lr)for(let U=0;U<this.lr.length;U++){this.lr[U].addEntry(L)}else this._creationFunc(L,this),this.entries.length>this.ga&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(L){if(this.lr){for(let U=0;U<this.lr.length;U++){this.lr[U].removeEntry(L)}return}const U=this.entries.indexOf(L);U>-1&&this.entries.splice(U,1)}addEntries(L){for(let U=0;U<L.length;U++){const x=L[U];this.addEntry(x)}}select(L,U,x){if(p.c.IsInFrustum(this.Xh,L)){if(this.lr){for(let mL=0;mL<this.lr.length;mL++){this.lr[mL].select(L,U,x)}return}x?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersects(L,U,x,mL){if(p.c.IntersectsSphere(this._minPoint,this._maxPoint,L,U)){if(this.lr){for(let p=0;p<this.lr.length;p++){this.lr[p].intersects(L,U,x,mL)}return}mL?x.concat(this.entries):x.concatWithNoDuplicate(this.entries)}}intersectsRay(L,U){if(L.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.lr){for(let x=0;x<this.lr.length;x++){this.lr[x].intersectsRay(L,U)}return}U.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){G._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(L,U,x,p,F,a,o,A){o.lr=new Array;const r=new mL.YU((U.x-L.x)/2,(U.y-L.y)/2,(U.z-L.z)/2);for(let mL=0;mL<2;mL++)for(let U=0;U<2;U++)for(let h=0;h<2;h++){const b=L.add(r.multiplyByFloats(mL,U,h)),E=L.add(r.multiplyByFloats(mL+1,U+1,h+1)),Y=new G(b,E,p,F+1,a,A);Y.addEntries(x),o.lr.push(Y)}}}},14847:(L,U,x)=>{"use strict";x.d(U,{b:()=>r});var mL=x(12820),p=x(12589),G=x(13026),F=x(14027),a=x(12858),o=x(14839),A=x(12440);mL.e.prototype.createOrUpdateSelectionOctree=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,x=this._getComponent(a.b.NAME_OCTREE);x||(x=new r(this),this.o(x)),this.hh||(this.hh=new o.c(o.c.CreationFuncForMeshes,L,U));const mL=this.getWorldExtends();return this.hh.update(mL.min,mL.max,this.meshes),this.hh},Object.defineProperty(mL.e.prototype,"selectionOctree",{get:function(){return this.hh},enumerable:!0,configurable:!0}),G.c.prototype.createOrUpdateSubmeshesOctree=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const x=this.PL();let mL=x._getComponent(a.b.NAME_OCTREE);mL||(mL=new r(x),x.o(mL)),this._submeshesOctree||(this._submeshesOctree=new o.c(o.c.CreationFuncForSubMeshes,L,U)),this.fa(!0);const p=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(p.minimumWorld,p.maximumWorld,this.Sa),this._submeshesOctree};class r{constructor(L){this.name=a.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new F.d(p.YU.Zero(),new p.YU(1,1,1)),(L=L||A.c.LastCreatedScene)&&(this.VU=L,this.VU.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.VU.getActiveSubMeshCandidates=L=>this.getActiveSubMeshCandidates(L),this.VU.getCollidingSubMeshCandidates=(L,U)=>this.getCollidingSubMeshCandidates(L,U),this.VU.getIntersectingSubMeshCandidates=(L,U)=>this.getIntersectingSubMeshCandidates(L,U))}register(){this.VU.onMeshRemovedObservable.add((L=>{const U=this.VU.selectionOctree;if(void 0!==U&&null!==U){const x=U.Sh.indexOf(L);-1!==x&&U.Sh.splice(x,1)}})),this.VU.onMeshImportedObservable.add((L=>{const U=this.VU.selectionOctree;void 0!==U&&null!==U&&U.Er(L)}))}getActiveMeshCandidates(){var L;return(null===(L=this.VU.hh)||void 0===L?void 0:L.select(this.VU.frustumPlanes))||this.VU._getDefaultMeshCandidates()}getActiveSubMeshCandidates(L){if(L._submeshesOctree&&L.useOctreeForRenderingSelection){return L._submeshesOctree.select(this.VU.frustumPlanes)}return this.VU._getDefaultSubMeshCandidates(L)}getIntersectingSubMeshCandidates(L,U){if(L._submeshesOctree&&L.useOctreeForPicking){F.d.TransformToRef(U,L.getWorldMatrix(),this._tempRay);return L._submeshesOctree.intersectsRay(this._tempRay)}return this.VU._getDefaultSubMeshCandidates(L)}getCollidingSubMeshCandidates(L,U){if(L._submeshesOctree&&L.useOctreeForCollisions){const x=U._velocityWorldLength+Math.max(U._radius.x,U._radius.y,U._radius.z);return L._submeshesOctree.intersects(U._basePointWorld,x)}return this.VU._getDefaultSubMeshCandidates(L)}rebuild(){}dispose(){}}},14027:(L,U,x)=>{"use strict";x.d(U,{d:()=>E});var mL=x(12820),p=x(13052),G=x(12598),F=x(12589),a=x(12602),o=x(12929),A=x(12851),r=x(12440),h=x(12883);const b={internalPickerForMesh:void 0};class E{constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.c;this.origin=L,this.direction=U,this.length=x,this.epsilon=mL}clone(){return new E(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const mL=E._TmpVector3[0].da(L.x-x,L.y-x,L.z-x),p=E._TmpVector3[1].da(U.x+x,U.y+x,U.z+x);let G,F,a,o,A=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<mL.x||this.origin.x>p.x)return!1}else if(G=1/this.direction.x,F=(mL.x-this.origin.x)*G,a=(p.x-this.origin.x)*G,a===-1/0&&(a=1/0),F>a&&(o=F,F=a,a=o),A=Math.max(F,A),r=Math.min(a,r),A>r)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<mL.y||this.origin.y>p.y)return!1}else if(G=1/this.direction.y,F=(mL.y-this.origin.y)*G,a=(p.y-this.origin.y)*G,a===-1/0&&(a=1/0),F>a&&(o=F,F=a,a=o),A=Math.max(F,A),r=Math.min(a,r),A>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<mL.z||this.origin.z>p.z)return!1}else if(G=1/this.direction.z,F=(mL.z-this.origin.z)*G,a=(p.z-this.origin.z)*G,a===-1/0&&(a=1/0),F>a&&(o=F,F=a,a=o),A=Math.max(F,A),r=Math.min(a,r),A>r)return!1;return!0}intersectsBox(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(L.minimum,L.maximum,U)}intersectsSphere(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const x=L.center.x-this.origin.x,mL=L.center.y-this.origin.y,p=L.center.z-this.origin.z,G=x*x+mL*mL+p*p,F=L.radius+U,a=F*F;if(G<=a)return!0;const o=x*this.direction.x+mL*this.direction.y+p*this.direction.z;if(o<0)return!1;return G-o*o<=a}intersectsTriangle(L,U,x){const mL=E._TmpVector3[0],p=E._TmpVector3[1],G=E._TmpVector3[2],a=E._TmpVector3[3],A=E._TmpVector3[4];U.subtractToRef(L,mL),x.subtractToRef(L,p),F.YU.CrossToRef(this.direction,p,G);const r=F.YU.Dot(mL,G);if(0===r)return null;const h=1/r;this.origin.subtractToRef(L,a);const b=F.YU.Dot(a,G)*h;if(b<-this.epsilon||b>1+this.epsilon)return null;F.YU.CrossToRef(a,mL,A);const Y=F.YU.Dot(this.direction,A)*h;if(Y<-this.epsilon||b+Y>1+this.epsilon)return null;const S=F.YU.Dot(p,A)*h;return S>this.length?null:new o.c(1-b-Y,b,S)}intersectsPlane(L){let U;const x=F.YU.Dot(L.normal,this.direction);if(Math.abs(x)<9.99999997475243e-7)return null;{const mL=F.YU.Dot(L.normal,this.origin);return U=(-L.d-mL)/x,U<0?U<-9.99999997475243e-7?null:0:U}}intersectsAxis(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(L){case"y":{const L=(this.origin.y-U)/this.direction.y;return L>0?null:new F.YU(this.origin.x+this.direction.x*-L,U,this.origin.z+this.direction.z*-L)}case"x":{const L=(this.origin.x-U)/this.direction.x;return L>0?null:new F.YU(U,this.origin.y+this.direction.y*-L,this.origin.z+this.direction.z*-L)}case"z":{const L=(this.origin.z-U)/this.direction.z;return L>0?null:new F.YU(this.origin.x+this.direction.x*-L,this.origin.y+this.direction.y*-L,U)}default:return null}}intersectsMesh(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=F.TmpVectors.Matrix[0];return L.getWorldMatrix().invertToRef(a),this._tmpRay?E.TransformToRef(this,a,this._tmpRay):this._tmpRay=E.Transform(this,a),L.intersects(this._tmpRay,U,x,mL,p,G)}intersectsMeshes(L,U,x){x?x.length=0:x=[];for(let mL=0;mL<L.length;mL++){const p=this.intersectsMesh(L[mL],U);p.hit&&x.push(p)}return x.sort(this._comparePickingInfo),x}_comparePickingInfo(L,U){return L.distance<U.distance?-1:L.distance>U.distance?1:0}intersectionSegment(L,U,x){const mL=this.origin,p=F.TmpVectors.YU[0],G=F.TmpVectors.YU[1],a=F.TmpVectors.YU[2],o=F.TmpVectors.YU[3];U.subtractToRef(L,p),this.direction.scaleToRef(E._Rayl,a),mL.addToRef(a,G),L.subtractToRef(mL,o);const A=F.YU.Dot(p,p),r=F.YU.Dot(p,a),h=F.YU.Dot(a,a),b=F.YU.Dot(p,o),Y=F.YU.Dot(a,o),S=A*h-r*r;let V,H,Q=S,q=S;S<E._Smallnum?(V=0,Q=1,H=Y,q=h):(V=r*Y-h*b,H=A*Y-r*b,V<0?(V=0,H=Y,q=h):V>Q&&(V=Q,H=Y+r,q=h)),H<0?(H=0,-b<0?V=0:-b>A?V=Q:(V=-b,Q=A)):H>q&&(H=q,-b+r<0?V=0:-b+r>A?V=Q:(V=-b+r,Q=A));const f=Math.abs(V)<E._Smallnum?0:V/Q,v=Math.abs(H)<E._Smallnum?0:H/q,D=F.TmpVectors.YU[4];a.scaleToRef(v,D);const P=F.TmpVectors.YU[5];p.scaleToRef(f,P),P.addInPlace(o);const d=F.TmpVectors.YU[6];P.subtractToRef(D,d);return v>0&&v<=this.length&&d.lengthSquared()<x*x?P.length():-1}update(L,U,x,mL,p,G,a){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){E._RayDistant||(E._RayDistant=E.Zero()),E._RayDistant.unprojectRayToRef(L,U,x,mL,F.Matrix.IdentityReadOnly,G,a);const o=F.TmpVectors.Matrix[0];p.invertToRef(o),E.TransformToRef(E._RayDistant,o,this)}else this.unprojectRayToRef(L,U,x,mL,p,G,a);return this}static Zero(){return new E(F.YU.Zero(),F.YU.Zero())}static CreateNew(L,U,x,mL,p,G,F){return E.Zero().update(L,U,x,mL,p,G,F)}static CreateNewFromTo(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.Matrix.IdentityReadOnly;const mL=new E(new F.YU(0,0,0),new F.YU(0,0,0));return E.CreateFromToToRef(L,U,mL,x)}static CreateFromToToRef(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.Matrix.IdentityReadOnly;x.origin.p(L);const p=U.subtractToRef(L,x.direction),G=Math.sqrt(p.x*p.x+p.y*p.y+p.z*p.z);return x.length=G,x.direction.normalize(),E.TransformToRef(x,mL,x)}static Transform(L,U){const x=new E(new F.YU(0,0,0),new F.YU(0,0,0));return E.TransformToRef(L,U,x),x}static TransformToRef(L,U,x){F.YU.TransformCoordinatesToRef(L.origin,U,x.origin),F.YU.TransformNormalToRef(L.direction,U,x.direction),x.length=L.length,x.epsilon=L.epsilon;const mL=x.direction,p=mL.length();if(0!==p&&1!==p){const L=1/p;mL.x*=L,mL.y*=L,mL.z*=L,x.length*=p}return x}unprojectRayToRef(L,U,x,mL,p,G,a){const o=F.TmpVectors.Matrix[0];p.multiplyToRef(G,o),o.multiplyToRef(a,o),o.invert();const A=r.c.LastCreatedEngine,h=F.TmpVectors.YU[0];h.x=L/x*2-1,h.y=-(U/mL*2-1),h.z=null!==A&&void 0!==A&&A.Ga?1:null!==A&&void 0!==A&&A.isNDCHalfZRange?0:-1;const b=F.TmpVectors.YU[1].da(h.x,h.y,1-1e-8),E=F.TmpVectors.YU[2],Y=F.TmpVectors.YU[3];F.YU._UnprojectFromInvertedMatrixToRef(h,o,E),F.YU._UnprojectFromInvertedMatrixToRef(b,o,Y),this.origin.p(E),Y.subtractToRef(E,this.direction),this.direction.normalize()}}function Y(L,U,x,mL,p){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=E.Zero();return S(L,U,x,mL,F,p,G),F}function S(L,U,x,mL,p,G){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const A=L.getEngine();if(!G&&!(G=L.activeCamera))return L;const r=G.viewport,h=A.getRenderHeight(),{x:b,y:E,width:Y,height:S}=r.toGlobal(A.getRenderWidth(),h),V=1/A.getHardwareScalingLevel();return U=U*V-b,x=x*V-(h-E-S),p.update(U,x,Y,S,mL||F.Matrix.IdentityReadOnly,a?F.Matrix.IdentityReadOnly:G.getViewMatrix(),G.getProjectionMatrix(),o),L}function V(L,U,x,mL,p){if(!A.e)return L;const G=L.getEngine();if(!p&&!(p=L.activeCamera))throw new Error("Active camera not set");const a=p.viewport,o=G.getRenderHeight(),{x:r,y:h,width:b,height:E}=a.toGlobal(G.getRenderWidth(),o),Y=F.Matrix.Identity(),S=1/G.getHardwareScalingLevel();return U=U*S-r,x=x*S-(o-h-E),mL.update(U,x,b,E,Y,Y,p.getProjectionMatrix()),L}function H(L,U,x,mL,p,G,F,a){const o=U(mL,x.enableDistantPicking),A=x.intersects(o,p,F,G,mL,a);return A&&A.hit?!p&&null!=L&&A.distance>=L.distance?null:A:null}function Q(L,U,x,mL,p,G){let a=null;const o=!!(L.activeCameras&&L.activeCameras.length>1&&L.cameraToUseForPointers!==L.activeCamera),r=L.cameraToUseForPointers||L.activeCamera,h=b.internalPickerForMesh||H;for(let A=0;A<L.meshes.length;A++){const b=L.meshes[A];if(x){if(!x(b,-1))continue}else if(!b.isEnabled()||!b.isVisible||!b.Bo)continue;const E=o&&b.isWorldMatrixCameraDependent(),Y=b.fa(E,r);if(b.hasThinInstances&&b.lA){const L=h(a,U,b,Y,!0,!0,G);if(L){if(p)return L;const o=F.TmpVectors.Matrix[1],A=b.thinInstanceGetWorldMatrices();for(let L=0;L<A.length;L++){if(x&&!x(b,L))continue;A[L].multiplyToRef(Y,o);const F=h(a,U,b,o,mL,p,G,!0);if(F&&(a=F,a.thinInstanceIndex=L,mL))return a}}}else{const L=h(a,U,b,Y,mL,p,G);if(L&&(a=L,mL))return a}}return a||new A.e}function q(L,U,x,mL){if(!A.e)return null;const p=[],G=!!(L.activeCameras&&L.activeCameras.length>1&&L.cameraToUseForPointers!==L.activeCamera),a=L.cameraToUseForPointers||L.activeCamera,o=b.internalPickerForMesh||H;for(let A=0;A<L.meshes.length;A++){const r=L.meshes[A];if(x){if(!x(r,-1))continue}else if(!r.isEnabled()||!r.isVisible||!r.Bo)continue;const h=G&&r.isWorldMatrixCameraDependent(),b=r.fa(h,a);if(r.hasThinInstances&&r.lA){if(o(null,U,r,b,!0,!0,mL)){const L=F.TmpVectors.Matrix[1],G=r.thinInstanceGetWorldMatrices();for(let F=0;F<G.length;F++){if(x&&!x(r,F))continue;G[F].multiplyToRef(b,L);const a=o(null,U,r,L,!1,!1,mL,!0);a&&(a.thinInstanceIndex=F,p.push(a))}}}else{const L=o(null,U,r,b,!1,!1,mL);L&&p.push(L)}}return p}function f(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,mL=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;mL||(mL=L.getWorldMatrix()),U.length=x,p?U.origin.p(p):U.origin.p(L.position);const G=F.TmpVectors.YU[2];G.set(0,0,L._scene.useRightHandedSystem?-1:1);const a=F.TmpVectors.YU[3];return F.YU.TransformNormalToRef(G,mL,a),F.YU.NormalizeToRef(a,U.direction),U}var v,D;E._TmpVector3=(0,a.e)(6,F.YU.Zero),E._RayDistant=E.Zero(),E._Smallnum=1e-8,E._Rayl=1e9,v=mL.e,(D=p.c)&&(D.prototype.getForwardRay=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,U=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;return f(this,new E(F.YU.Zero(),F.YU.Zero(),L),L,U,x)},D.prototype.getForwardRayToRef=function(L){return f(this,L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),v&&(h.c._IsPickingAvailable=!0,v.prototype.createPickingRay=function(L,U,x,mL){return Y(this,L,U,x,mL,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),mL.e.prototype.createPickingRayToRef=function(L,U,x,mL,p){return S(this,L,U,x,mL,p,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},mL.e.prototype.createPickingRayInCameraSpace=function(L,U,x){return function(L,U,x,mL){const p=E.Zero();return V(L,U,x,p,mL),p}(this,L,U,x)},mL.e.prototype.createPickingRayInCameraSpaceToRef=function(L,U,x,mL){return V(this,L,U,x,mL)},mL.e.prototype.pickWithBoundingInfo=function(L,U,x,mL,p){return function(L,U,x,mL,p,G){if(!A.e)return null;const a=Q(L,(mL=>(L._tempPickingRay||(L._tempPickingRay=E.Zero()),S(L,U,x,mL,L._tempPickingRay,G||null),L._tempPickingRay)),mL,p,!0);return a&&(a.ray=Y(L,U,x,F.Matrix.Identity(),G||null)),a}(this,L,U,x,mL,p)},mL.e.prototype.Sx=function(L,U,x,mL,p,G){return function(L,U,x,mL,p,G,a){const o=Q(L,((mL,p)=>(L._tempPickingRay||(L._tempPickingRay=E.Zero()),S(L,U,x,mL,L._tempPickingRay,G||null,!1,p),L._tempPickingRay)),mL,p,!1,a);return o&&(o.ray=Y(L,U,x,F.Matrix.Identity(),G||null)),o}(this,L,U,x,mL,p,G)},mL.e.prototype.pickWithRay=function(L,U,x,mL){return function(L,U,x,mL,p){const G=Q(L,(x=>(L._pickWithRayInverseMatrix||(L._pickWithRayInverseMatrix=F.Matrix.Identity()),x.invertToRef(L._pickWithRayInverseMatrix),L._cachedRayForTransform||(L._cachedRayForTransform=E.Zero()),E.TransformToRef(U,L._pickWithRayInverseMatrix,L._cachedRayForTransform),L._cachedRayForTransform)),x,mL,!1,p);return G&&(G.ray=U),G}(this,L,U,x,mL)},mL.e.prototype.multiPick=function(L,U,x,mL,p){return function(L,U,x,mL,p,G){return q(L,(mL=>Y(L,U,x,mL,p||null)),mL,G)}(this,L,U,x,mL,p)},mL.e.prototype.multiPickWithRay=function(L,U,x){return function(L,U,x,mL){return q(L,(x=>(L._pickWithRayInverseMatrix||(L._pickWithRayInverseMatrix=F.Matrix.Identity()),x.invertToRef(L._pickWithRayInverseMatrix),L._cachedRayForTransform||(L._cachedRayForTransform=E.Zero()),E.TransformToRef(U,L._pickWithRayInverseMatrix,L._cachedRayForTransform),L._cachedRayForTransform)),x,mL)}(this,L,U,x)}},14319:(L,U,x)=>{"use strict";var mL=x(12521),p=x(12406),G=x(12448),F=x(12550),a=x(12479),o=x(12532);a.e.prototype._partialLoadFile=function(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(L,(L=>{x[U]=L,x._internalCount++,6===x._internalCount&&mL(x)}),void 0,void 0,!0,((L,U)=>{p&&L&&p(L.status+" "+L.statusText,U)}))},a.e.prototype._cascadeLoadFiles=function(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=[];p._internalCount=0;for(let G=0;G<6;G++)this._partialLoadFile(x[G],G,p,U,mL)},a.e.prototype._cascadeLoadImgs=function(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5?arguments[5]:void 0;const F=[];F._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(mL[a],a,F,L,U,x,p,G)},a.e.prototype._partialLoadImg=function(L,U,x,mL,p,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7?arguments[7]:void 0;const r=(0,F.b)();(0,G.q)(L,(L=>{x[U]=L,x._internalCount++,mL&&mL.removePendingData(r),6===x._internalCount&&a&&a(p,x)}),((L,U)=>{mL&&mL.removePendingData(r),o&&o(L,U)}),mL?mL.offlineProvider:null,A),mL&&mL.addPendingData(r)},a.e.prototype.createCubeTextureBase=function(L,U,x,G){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,H=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const q=Y||new mL.d(this,7);q.isCube=!0,q.url=L,q.generateMipMaps=!G,q._lodGenerationScale=b,q._lodGenerationOffset=E,q._useSRGBBuffer=!!H&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!G),q!==Y&&(q.label=L.substring(0,60)),this._doNotHandleContextLost||(q._extension=r,q._files=x,q._buffer=Q);const f=L;this._transformTextureUrl&&!Y&&(L=this._transformTextureUrl(L));const v=r??function(L){const U=L.split("?")[0],x=U.lastIndexOf(".");return x>-1?U.substring(x).toLowerCase():""}(L),D=(0,o.d)(v),P=(L,U)=>{q.dispose(),a?a(L,U):L&&p.c.Warn(L)},d=(mL,a)=>{L===f?mL&&P(mL.status+" "+mL.statusText,a):(p.c.Warn(`Failed to load ${L}, falling back to the ${f}`),this.createCubeTextureBase(f,U,x,!!G,F,P,A,r,h,b,E,q,S,V,H,Q))};if(D)D.then((mL=>{const p=L=>{S&&S(q,L),mL.loadCubeData(L,q,h,F,((L,U)=>{P(L,U)}))};Q?p(Q):x&&6===x.length?mL.supportCascades?this._cascadeLoadFiles(U,(L=>p(L.map((L=>new Uint8Array(L))))),x,P):P("Textures type does not support cascades."):this._loadFile(L,(L=>p(new Uint8Array(L))),void 0,void 0,!0,d)}));else{if(!x||0===x.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,q,((L,U)=>{V&&V(L,U)}),x,P)}return this._internalTexturesCache.push(q),q}},14849:(L,U,x)=>{"use strict";x(12406);var mL=x(12719);x(12521),x(12673),x(12515),x(12761),x(12727);mL.b},14343:(L,U,x)=>{"use strict";x.d(U,{b:()=>p});var mL=x(12547);class p{constructor(L){this.value=this._toInt(L)}_toInt(L){return 0|L}add(L){return new p(this.value+L.value)}SU(L){return new p(this.value-L.value)}multiply(L){return new p(Math.imul(this.value,L.value))}divide(L){return new p(this.value/L.value)}getClassName(){return p.ClassName}equals(L){return this.value===L.value}static FromValue(L){return new p(L)}toString(){return this.value.toString()}}p.ClassName="FlowGraphInteger",(0,mL.d)("FlowGraphInteger",p)},14351:(L,U,x)=>{"use strict";x.d(U,{e:()=>p,f:()=>G});var mL=x(12589);class p{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ra=L}get m(){return this.ra}transformVector(L){return this.transformVectorToRef(L,new mL.Vector2)}transformVectorToRef(L,U){return U.x=L.x*this.ra[0]+L.y*this.ra[1],U.y=L.x*this.ra[2]+L.y*this.ra[3],U}Va(){return this.toArray()}toArray(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<4;U++)L[U]=this.ra[U];return L}Vx(L){for(let U=0;U<4;U++)this.ra[U]=L[U];return this}multiplyToRef(L,U){const x=L.ra,mL=this.ra,p=U.ra;return p[0]=x[0]*mL[0]+x[1]*mL[2],p[1]=x[0]*mL[1]+x[1]*mL[3],p[2]=x[2]*mL[0]+x[3]*mL[2],p[3]=x[2]*mL[1]+x[3]*mL[3],U}multiply(L){return this.multiplyToRef(L,new p)}divideToRef(L,U){const x=this.ra,mL=L.ra,p=U.ra;return p[0]=x[0]/mL[0],p[1]=x[1]/mL[1],p[2]=x[2]/mL[2],p[3]=x[3]/mL[3],U}divide(L){return this.divideToRef(L,new p)}addToRef(L,U){const x=this.ra,mL=L.m,p=U.m;return p[0]=x[0]+mL[0],p[1]=x[1]+mL[1],p[2]=x[2]+mL[2],p[3]=x[3]+mL[3],U}add(L){return this.addToRef(L,new p)}subtractToRef(L,U){const x=this.ra,mL=L.m,p=U.m;return p[0]=x[0]-mL[0],p[1]=x[1]-mL[1],p[2]=x[2]-mL[2],p[3]=x[3]-mL[3],U}SU(L){return this.subtractToRef(L,new p)}transpose(){const L=this.ra;return new p([L[0],L[2],L[1],L[3]])}determinant(){const L=this.ra;return L[0]*L[3]-L[1]*L[2]}inverse(){const L=this.determinant();if(0===L)throw new Error("Matrix is not invertible");const U=this.ra,x=1/L;return new p([U[3]*x,-U[1]*x,-U[2]*x,U[0]*x])}equals(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const x=this.ra,mL=L.m;return 0===U?x[0]===mL[0]&&x[1]===mL[1]&&x[2]===mL[2]&&x[3]===mL[3]:Math.abs(x[0]-mL[0])<U&&Math.abs(x[1]-mL[1])<U&&Math.abs(x[2]-mL[2])<U&&Math.abs(x[3]-mL[3])<U}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ra.join(", ")})`}}class G{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ra=L}get m(){return this.ra}transformVector(L){return this.transformVectorToRef(L,new mL.YU)}transformVectorToRef(L,U){const x=this.ra;return U.x=L.x*x[0]+L.y*x[1]+L.z*x[2],U.y=L.x*x[3]+L.y*x[4]+L.z*x[5],U.z=L.x*x[6]+L.y*x[7]+L.z*x[8],U}multiplyToRef(L,U){const x=L.ra,mL=this.ra,p=U.m;return p[0]=x[0]*mL[0]+x[1]*mL[3]+x[2]*mL[6],p[1]=x[0]*mL[1]+x[1]*mL[4]+x[2]*mL[7],p[2]=x[0]*mL[2]+x[1]*mL[5]+x[2]*mL[8],p[3]=x[3]*mL[0]+x[4]*mL[3]+x[5]*mL[6],p[4]=x[3]*mL[1]+x[4]*mL[4]+x[5]*mL[7],p[5]=x[3]*mL[2]+x[4]*mL[5]+x[5]*mL[8],p[6]=x[6]*mL[0]+x[7]*mL[3]+x[8]*mL[6],p[7]=x[6]*mL[1]+x[7]*mL[4]+x[8]*mL[7],p[8]=x[6]*mL[2]+x[7]*mL[5]+x[8]*mL[8],U}multiply(L){return this.multiplyToRef(L,new G)}divideToRef(L,U){const x=this.ra,mL=L.m,p=U.m;return p[0]=x[0]/mL[0],p[1]=x[1]/mL[1],p[2]=x[2]/mL[2],p[3]=x[3]/mL[3],p[4]=x[4]/mL[4],p[5]=x[5]/mL[5],p[6]=x[6]/mL[6],p[7]=x[7]/mL[7],p[8]=x[8]/mL[8],U}divide(L){return this.divideToRef(L,new G)}addToRef(L,U){const x=this.ra,mL=L.m,p=U.m;return p[0]=x[0]+mL[0],p[1]=x[1]+mL[1],p[2]=x[2]+mL[2],p[3]=x[3]+mL[3],p[4]=x[4]+mL[4],p[5]=x[5]+mL[5],p[6]=x[6]+mL[6],p[7]=x[7]+mL[7],p[8]=x[8]+mL[8],U}add(L){return this.addToRef(L,new G)}subtractToRef(L,U){const x=this.ra,mL=L.m,p=U.m;return p[0]=x[0]-mL[0],p[1]=x[1]-mL[1],p[2]=x[2]-mL[2],p[3]=x[3]-mL[3],p[4]=x[4]-mL[4],p[5]=x[5]-mL[5],p[6]=x[6]-mL[6],p[7]=x[7]-mL[7],p[8]=x[8]-mL[8],U}SU(L){return this.subtractToRef(L,new G)}toArray(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<9;U++)L[U]=this.ra[U];return L}Va(){return this.toArray()}Vx(L){for(let U=0;U<9;U++)this.ra[U]=L[U];return this}transpose(){const L=this.ra;return new G([L[0],L[3],L[6],L[1],L[4],L[7],L[2],L[5],L[8]])}determinant(){const L=this.ra;return L[0]*(L[4]*L[8]-L[5]*L[7])-L[1]*(L[3]*L[8]-L[5]*L[6])+L[2]*(L[3]*L[7]-L[4]*L[6])}inverse(){const L=this.determinant();if(0===L)throw new Error("Matrix is not invertible");const U=this.ra,x=1/L;return new G([(U[4]*U[8]-U[5]*U[7])*x,(U[2]*U[7]-U[1]*U[8])*x,(U[1]*U[5]-U[2]*U[4])*x,(U[5]*U[6]-U[3]*U[8])*x,(U[0]*U[8]-U[2]*U[6])*x,(U[2]*U[3]-U[0]*U[5])*x,(U[3]*U[7]-U[4]*U[6])*x,(U[1]*U[6]-U[0]*U[7])*x,(U[0]*U[4]-U[1]*U[3])*x])}equals(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const x=this.ra,mL=L.m;return 0===U?x[0]===mL[0]&&x[1]===mL[1]&&x[2]===mL[2]&&x[3]===mL[3]&&x[4]===mL[4]&&x[5]===mL[5]&&x[6]===mL[6]&&x[7]===mL[7]&&x[8]===mL[8]:Math.abs(x[0]-mL[0])<U&&Math.abs(x[1]-mL[1])<U&&Math.abs(x[2]-mL[2])<U&&Math.abs(x[3]-mL[3])<U&&Math.abs(x[4]-mL[4])<U&&Math.abs(x[5]-mL[5])<U&&Math.abs(x[6]-mL[6])<U&&Math.abs(x[7]-mL[7])<U&&Math.abs(x[8]-mL[8])<U}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ra.join(", ")})`}}},14356:(L,U,x)=>{"use strict";var mL;function p(L,U,x,mL){switch(U){case"Animation":return mL?L.animations.find((L=>L.uniqueId===x))??null:L.animations[x]??null;case"AnimationGroup":return mL?L.animationGroups.find((L=>L.uniqueId===x))??null:L.animationGroups[x]??null;case"Mesh":return mL?L.meshes.find((L=>L.uniqueId===x))??null:L.meshes[x]??null;case"Material":return mL?L.materials.find((L=>L.uniqueId===x))??null:L.materials[x]??null;case"Dr":return mL?L.cameras.find((L=>L.uniqueId===x))??null:L.cameras[x]??null;case"Light":return mL?L.lights.find((L=>L.uniqueId===x))??null:L.lights[x]??null;default:return null}}x.d(U,{e:()=>p}),function(L){L.Animation="Animation",L.AnimationGroup="AnimationGroup",L.Mesh="Mesh",L.Material="Material",L.Dr="Dr",L.Light="Light"}(mL||(mL={}))},14396:(L,U,x)=>{"use strict";x.d(U,{c:()=>p});var mL=x(14401);class p extends mL.d{constructor(L,U){if(super(L),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),U)for(const x of U)this._eventsSignalOutputs[x]=this._registerSignalOutput(x+"Event")}_executeOnTick(L){}_startPendingTasks(L){L._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(L),this._resetAfterCanceled(L)),this._preparePendingTasks(L),L._addPendingBlock(this),this.out._activateSignal(L),L._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(L){L._deleteExecutionVariable(this,"_initialized"),L._removePendingBlock(this)}}},14371:(L,U,x)=>{"use strict";x.d(U,{e:()=>A});var mL=x(12550),p=x(12547),G=x(14373),F=x(12391),a=x(14339);class o extends G.e{constructor(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:mL.defaultValue,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(L,U,x),this.richType=mL,this._defaultValue=p,this._optional=G,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new F.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(L){this._isDisabled!==L&&(this._isDisabled=L,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(L,U){U._getConnectionValue(this)!==L&&(U._setConnectionValue(this,L),this.onValueChangedObservable.notifyObservers(L))}resetToDefaultValue(L){L._setConnectionValue(this,this._defaultValue)}connectTo(L){this._isDisabled||super.connectTo(L)}_getValueOrDefault(L){const U=L._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(L){if(1===this.connectionType){L._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(L);const U=this._getValueOrDefault(L);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}const U=this.isConnected()?this._connectedPoint[0].getValue(L):this._getValueOrDefault(L);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(L),L.richType={},this.richType.serialize(L.richType),L.optional=this._optional,(0,a.e)("defaultValue",this._defaultValue,L)}}(0,p.d)("FlowGraphDataConnection",o);class A{constructor(L){var U;this.config=L,this.uniqueId=(0,mL.b)(),this.name=(null===(U=this.config)||void 0===U?void 0:U.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(L){}registerDataInput(L,U,x){const mL=new o(L,0,this,U,x);return this.dataInputs.push(mL),mL}registerDataOutput(L,U,x){const mL=new o(L,1,this,U,x);return this.dataOutputs.push(mL),mL}getDataInput(L){return this.dataInputs.find((U=>U.name===L))}getDataOutput(L){return this.dataOutputs.find((U=>U.name===L))}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.e;if(L.uniqueId=this.uniqueId,L.config={},this.config){const x=this.config,mL=Object.keys(x);for(const p of mL)U(p,x[p],L.config)}L.dataInputs=[],L.dataOutputs=[],L.className=this.getClassName();for(const x of this.dataInputs){const U={};x.serialize(U),L.dataInputs.push(U)}for(const x of this.dataOutputs){const U={};x.serialize(U),L.dataOutputs.push(U)}}deserialize(L){}_log(L,U,x){var mL;null===(mL=L.logger)||void 0===mL||mL.addLogItem({action:U,Hx:x,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14373:(L,U,x)=>{"use strict";x.d(U,{e:()=>G});var mL,p=x(12550);!function(L){L[L.Input=0]="Input",L[L.Output=1]="Output"}(mL||(mL={}));class G{constructor(L,U,x){this._ownerBlock=x,this._connectedPoint=[],this.uniqueId=(0,p.b)(),this.connectedPointIds=[],this.name=L,this._connectionType=U}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(L){if(this._connectionType===L._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||L._isSingularConnection()&&L._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(L),L._connectedPoint.push(this)}disconnectFrom(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const x=this._connectedPoint.indexOf(L),mL=L._connectedPoint.indexOf(this);-1!==x&&-1!==mL&&(U&&this._connectedPoint.splice(x,1),L._connectedPoint.splice(mL,1))}disconnectFromAll(){for(const L of this._connectedPoint)this.disconnectFrom(L,!1);this._connectedPoint.length=0}dispose(){for(const L of this._connectedPoint)this.disconnectFrom(L)}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L.uniqueId=this.uniqueId,L.name=this.name,L._connectionType=this._connectionType,L.connectedPointIds=[],L.className=this.getClassName();for(const U of this._connectedPoint)L.connectedPointIds.push(U.uniqueId)}getClassName(){return"FGConnection"}deserialize(L){this.uniqueId=L.uniqueId,this.name=L.name,this._connectionType=L._connectionType,this.connectedPointIds=L.connectedPointIds}}},14336:(L,U,x)=>{"use strict";x.d(U,{b:()=>q});var mL,p=x(12391),G=x(12571),F=x(12574),a=x(12550),o=x(14339),A=x(14356),r=x(12406);!function(L){L.ExecuteBlock="ExecuteBlock",L.ExecuteEvent="ExecuteEvent",L.TriggerConnection="TriggerConnection",L.ContextVariableSet="ContextVariableSet",L.GlobalVariableSet="GlobalVariableSet",L.GlobalVariableDelete="GlobalVariableDelete",L.GlobalVariableGet="GlobalVariableGet",L.AddConnection="AddConnection",L.GetConnectionValue="GetConnectionValue",L.SetConnectionValue="SetConnectionValue",L.ActivateSignal="ActivateSignal",L.ContextVariableGet="ContextVariableGet"}(mL||(mL={}));class h{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(L){if(L.time||(L.time=Date.now()),this.log.push(L),this.logToConsole){var U;const x=null===(U=L.Hx)||void 0===U?void 0:U.value;"object"===typeof x&&x.getClassName?r.c.Log(`[FGLog] ${L.className}:${L.uniqueId.split("-")[0]} ${L.action} - ${JSON.stringify(x.getClassName())}: ${x.toString()}`):r.c.Log(`[FGLog] ${L.className}:${L.uniqueId.split("-")[0]} ${L.action} - ${JSON.stringify(L.Hx)}`)}}getItemsOfType(L){return this.log.filter((U=>U.action===L))}}class b{get enableLogging(){return this._enableLogging}set enableLogging(L){this._enableLogging!==L&&(this._enableLogging=L,this._enableLogging?(this.logger=new h,this.logger.logToConsole=!0):this.logger=null)}constructor(L){this.uniqueId=(0,a.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new p.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=L,this.assetsContext=L.assetsContext??L.VU}hasVariable(L){return L in this._userVariables}setVariable(L,U){var x;this._userVariables[L]=U,null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Hx:{name:L,value:U}})}getAsset(L,U){return(0,A.e)(this.assetsContext,L,U)}getVariable(L){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Hx:{name:L,value:this._userVariables[L]}}),this._userVariables[L]}get userVariables(){return this._userVariables}PL(){return this._configuration.VU}_getUniqueIdPrefixedName(L,U){return`${L.uniqueId}_${U}`}_getGlobalContextVariable(L,U){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Hx:{name:L,defaultValue:U,possibleValue:this._globalContextVariables[L]}}),this._hasGlobalContextVariable(L)?this._globalContextVariables[L]:U}_setGlobalContextVariable(L,U){var x;null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Hx:{name:L,value:U}}),this._globalContextVariables[L]=U}_deleteGlobalContextVariable(L){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Hx:{name:L}}),delete this._globalContextVariables[L]}_hasGlobalContextVariable(L){return L in this._globalContextVariables}_setExecutionVariable(L,U,x){this._executionVariables[this._getUniqueIdPrefixedName(L,U)]=x}_getExecutionVariable(L,U,x){return this._hasExecutionVariable(L,U)?this._executionVariables[this._getUniqueIdPrefixedName(L,U)]:x}_deleteExecutionVariable(L,U){delete this._executionVariables[this._getUniqueIdPrefixedName(L,U)]}_hasExecutionVariable(L,U){return this._getUniqueIdPrefixedName(L,U)in this._executionVariables}_hasConnectionValue(L){return L.uniqueId in this._connectionValues}_setConnectionValue(L,U){var x;this._connectionValues[L.uniqueId]=U,null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Hx:{connectionPointId:L.uniqueId,value:U}})}_setConnectionValueByKey(L,U){this._connectionValues[L]=U}_getConnectionValue(L){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Hx:{connectionPointId:L.uniqueId,value:this._connectionValues[L.uniqueId]}}),this._connectionValues[L.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(L){this._pendingBlocks.includes(L)||(this._pendingBlocks.push(L),this._pendingBlocks.sort(((L,U)=>L.priority-U.priority)))}_removePendingBlock(L){const U=this._pendingBlocks.indexOf(L);-1!==U&&this._pendingBlocks.splice(U,1)}_clearPendingBlocks(){for(const L of this._pendingBlocks)L._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(L){var U;this.onNodeExecutedObservable.notifyObservers(L),null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:L.getClassName(),uniqueId:L.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(L){this._setGlobalContextVariable("timeSinceStart",L.timeSinceStart),this._setGlobalContextVariable("deltaTime",L.deltaTime);for(const x of this._pendingBlocks){var U;null===(U=x._executeOnTick)||void 0===U||U.call(x,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.e;L.uniqueId=this.uniqueId,L._userVariables={};for(const mL in this._userVariables)U(mL,this._userVariables[mL],L._userVariables);L._connectionValues={};for(const mL in this._connectionValues)U(mL,this._connectionValues[mL],L._connectionValues);var x;this.assetsContext!==this.PL()&&(L._assetsContext={meshes:this.assetsContext.meshes.map((L=>L.id)),materials:this.assetsContext.materials.map((L=>L.id)),textures:this.assetsContext.textures.map((L=>L.name)),animations:this.assetsContext.animations.map((L=>L.name)),lights:this.assetsContext.lights.map((L=>L.id)),cameras:this.assetsContext.cameras.map((L=>L.id)),UY:null===(x=this.assetsContext.UY)||void 0===x?void 0:x.map((L=>L.name)),skeletons:this.assetsContext.skeletons.map((L=>L.id)),fE:this.assetsContext.fE.map((L=>L.name)),geometries:this.assetsContext.geometries.map((L=>L.id)),multiMaterials:this.assetsContext.multiMaterials.map((L=>L.id)),transformNodes:this.assetsContext.transformNodes.map((L=>L.id))})}getClassName(){return"FlowGraphContext"}}(0,G.d)([(0,F.R)()],b.prototype,"uniqueId",void 0);var E=x(14362),Y=x(12862);class S{constructor(L){this.onEventTriggeredObservable=new p.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=L,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.oa.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const L=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Hx:{timeSinceStart:this._startingTime,deltaTime:L}}),this._startingTime+=L})),this._meshPickedObserver=this._scene.onPointerObservable.add((L=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Hx:L})}),Y.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((L=>{const U=L.pointerId,x=L.mesh,mL=this._pointerUnderMeshState[U];!mL&&x?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Hx:{pointerId:U,mesh:x}}):mL&&!x?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Hx:{pointerId:U,mesh:mL}}):mL&&x&&mL!==x&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Hx:{pointerId:U,mesh:mL,over:x}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Hx:{pointerId:U,mesh:x,out:mL}})),this._pointerUnderMeshState[U]=x}),Y.b.POINTERMOVE)}dispose(){var L,U,x,mL,p;null===(L=this._sceneDisposeObserver)||void 0===L||L.remove(),null===(U=this._sceneReadyObserver)||void 0===U||U.remove(),null===(x=this._sceneOnBeforeRenderObserver)||void 0===x||x.remove(),null===(mL=this._meshPickedObserver)||void 0===mL||mL.remove(),null===(p=this._meshUnderPointerObserver)||void 0===p||p.remove(),this.onEventTriggeredObservable.clear()}}var V,H=x(14379);!function(L){L[L.Stopped=0]="Stopped",L[L.Started=1]="Started"}(V||(V={}));class Q{get state(){return this._state}set state(L){this._state=L,this.onStateChangedObservable.notifyObservers(L)}constructor(L){this.onStateChangedObservable=new p.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=L.VU,this._sceneEventCoordinator=new S(this._scene),this._coordinator=L.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((L=>{for(const U of this._executionContexts){const x=this._getContextualOrder(L.type,U);for(const mL of x)if(!mL._executeEvent(U,L.Hx))break}switch(L.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const U of this._executionContexts)U._notifyOnTick(L.Hx);break;case"SceneDispose":this.dispose()}}))}createContext(){const L=new b({VU:this._scene,coordinator:this._coordinator});return this._executionContexts.push(L),L}getContext(L){return this._executionContexts[L]}addEventBlock(L){if("PointerOver"!==L.type&&"PointerOut"!==L.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==L.type&&this._eventBlocks[L.type].push(L),1===this.state)for(const U of this._executionContexts)L._startPendingTasks(U);else this.onStateChangedObservable.addOnce((U=>{if(1===U)for(const x of this._executionContexts)L._startPendingTasks(x)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((L=>{1===L&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const L of this._executionContexts)for(const U in this._eventBlocks){const x=this._getContextualOrder(U,L);for(const U of x)U._startPendingTasks(L)}}_getContextualOrder(L,U){const x=this._eventBlocks[L].sort(((L,U)=>U.initPriority-L.initPriority));if("MeshPick"===L){const L=[];for(const mL of x){const p=mL.asset.getValue(U);let G=0;for(;G<x.length;G++){const L=x[G].asset.getValue(U);if(p&&L&&(0,H.p)(p,L))break}L.splice(G,0,mL)}return L}return x}dispose(){var L;if(0!==this.state){this.state=0;for(const L of this._executionContexts)L._clearPendingBlocks();this._executionContexts.length=0;for(const L in this._eventBlocks)this._eventBlocks[L].length=0;null===(L=this._eventObserver)||void 0===L||L.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(L){const U=[],x=new Set;for(const mL in this._eventBlocks)for(const L of this._eventBlocks[mL])U.push(L),x.add(L.uniqueId);for(;U.length>0;){const mL=U.pop();L(mL);for(const L of mL.dataInputs)for(const mL of L._connectedPoint)x.has(mL._ownerBlock.uniqueId)||(U.push(mL._ownerBlock),x.add(mL._ownerBlock.uniqueId));if(mL instanceof E.d)for(const L of mL.signalOutputs)for(const mL of L._connectedPoint)x.has(mL._ownerBlock.uniqueId)||(U.push(mL._ownerBlock),x.add(mL._ownerBlock.uniqueId))}}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1?arguments[1]:void 0;L.allBlocks=[],this.visitAllBlocks((U=>{const x={};U.serialize(x),L.allBlocks.push(x)})),L.executionContexts=[];for(const x of this._executionContexts){const mL={};x.serialize(mL,U),L.executionContexts.push(mL)}}}class q{constructor(L){this.config=L,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.VU.oa.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.VU.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const L=this._executeOnNextFrame.slice(0);if(L.length)for(const U of L){this.notifyCustomEvent(U.id,U.data,!1);const L=this._executeOnNextFrame.findIndex((L=>L.uniqueId===U.uniqueId));-1!==L&&this._executeOnNextFrame.splice(L,1)}}));(q.SceneCoordinators.get(this.config.VU)??[]).push(this)}createGraph(){const L=new Q({VU:this.config.VU,coordinator:this});return this._flowGraphs.push(L),L}removeGraph(L){const U=this._flowGraphs.indexOf(L);-1!==U&&(L.dispose(),this._flowGraphs.splice(U,1))}start(){for(const L of this._flowGraphs)L.start()}dispose(){var L,U;for(const p of this._flowGraphs)p.dispose();this._flowGraphs.length=0,null===(L=this._disposeObserver)||void 0===L||L.remove(),null===(U=this._onBeforeRenderObserver)||void 0===U||U.remove();const x=q.SceneCoordinators.get(this.config.VU)??[],mL=x.indexOf(this);-1!==mL&&x.splice(mL,1)}serialize(L,U){L._flowGraphs=[];for(const x of this._flowGraphs){const mL={};x.serialize(mL,U),L._flowGraphs.push(mL)}L.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(L){let U=this._customEventsMap.get(L);return U||(U=new p.c,this._customEventsMap.set(L,U)),U}notifyCustomEvent(L,U){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:L,data:U,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(L)){const U=this._eventExecutionCounter.get(L);if(this._eventExecutionCounter.set(L,U+1),U>=q.MaxEventTypeExecutionPerFrame)return void(U===q.MaxEventTypeExecutionPerFrame&&r.c.Warn(`FlowGraphCoordinator: Too many executions of event "${L}".`))}else this._eventExecutionCounter.set(L,1);const x=this._customEventsMap.get(L);x&&x.notifyObservers(U)}}q.MaxEventsPerType=30,q.MaxEventTypeExecutionPerFrame=30,q.SceneCoordinators=new Map},14388:(L,U,x)=>{"use strict";x.d(U,{e:()=>p});var mL=x(14396);class p extends mL.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(L){L._notifyExecuteNode(this),this.done._activateSignal(L)}}},14362:(L,U,x)=>{"use strict";x.d(U,{d:()=>a});var mL=x(14371),p=x(14373),G=x(12547);class F extends p.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(L){super.connectTo(L),this._connectedPoint.sort(((L,U)=>U.priority-L.priority))}_activateSignal(L){var U;if(null===(U=L.logger)||void 0===U||U.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Hx:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)L._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(L,this),L._increaseExecutionId();else for(const x of this._connectedPoint)x._activateSignal(L)}}(0,G.d)("FlowGraphSignalConnection",F);class a extends mL.e{constructor(L){super(L),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(L){const U=new F(L,0,this);return this.signalInputs.push(U),U}_registerSignalOutput(L){const U=new F(L,1,this);return this.signalOutputs.push(U),U}_unregisterSignalInput(L){const U=this.signalInputs.findIndex((U=>U.name===L));-1!==U&&(this.signalInputs[U].dispose(),this.signalInputs.splice(U,1))}_unregisterSignalOutput(L){const U=this.signalOutputs.findIndex((U=>U.name===L));-1!==U&&(this.signalOutputs[U].dispose(),this.signalOutputs.splice(U,1))}_reportError(L,U){this.error.Hx="string"===typeof U?new Error(U):U,this.error._activateSignal(L)}getSignalInput(L){return this.signalInputs.find((U=>U.name===L))}getSignalOutput(L){return this.signalOutputs.find((U=>U.name===L))}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(L),L.signalInputs=[],L.signalOutputs=[];for(const U of this.signalInputs){const x={};U.serialize(x),L.signalInputs.push(x)}for(const U of this.signalOutputs){const x={};U.serialize(x),L.signalOutputs.push(x)}}deserialize(L){for(let U=0;U<L.signalInputs.length;U++){const x=this.getSignalInput(L.signalInputs[U].name);if(!x)throw new Error("Could not find signal input with name "+L.signalInputs[U].name+" in block "+L.className);x.deserialize(L.signalInputs[U])}for(let U=0;U<L.signalOutputs.length;U++){const x=this.getSignalOutput(L.signalOutputs[U].name);if(!x)throw new Error("Could not find signal output with name "+L.signalOutputs[U].name+" in block "+L.className);x.deserialize(L.signalOutputs[U])}}getClassName(){return"FlowGraphExecutionBlock"}}},14401:(L,U,x)=>{"use strict";x.d(U,{d:()=>p});var mL=x(14362);class p extends mL.d{constructor(L){super(L),this.out=this._registerSignalOutput("out")}}},14348:(L,U,x)=>{"use strict";x.d(U,{A:()=>E,B:()=>Y,E:()=>S,F:()=>K,H:()=>l,I:()=>d,K:()=>P,c:()=>A,e:()=>b,i:()=>D,m:()=>V,o:()=>H,q:()=>Q,u:()=>h,x:()=>v,y:()=>r});var mL,p=x(12589),G=x(12637),F=x(14343),a=x(14351);!function(L){L.Any="any",L.String="string",L.Number="number",L.Boolean="boolean",L.Object="object",L.Integer="FlowGraphInteger",L.Vector2="Vector2",L.YU="YU",L.Vector4="Vector4",L.Quaternion="Quaternion",L.Matrix="Matrix",L.Matrix2D="Matrix2D",L.Matrix3D="Matrix3D",L.QU="QU",L.ia="ia"}(mL||(mL={}));class o{constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=L,this.defaultValue=U,this.animationType=x}serialize(L){L.typeName=this.typeName,L.defaultValue=this.defaultValue}}const A=new o("any",void 0),r=new o("string",""),h=new o("number",0,0),b=new o("boolean",!1),E=new o("Vector2",p.Vector2.Zero(),5),Y=new o("YU",p.YU.Zero(),1),S=new o("Vector4",p.Vector4.Zero()),V=new o("Matrix",p.Matrix.Identity(),3),H=new o("Matrix2D",new a.e),Q=new o("Matrix3D",new a.f),q=new o("QU",G.QU.Black(),4),f=new o("ia",new G.ia(0,0,0,0),7),v=new o("Quaternion",p.Quaternion.Identity(),2);v.typeTransformer=L=>{if(L.getClassName){if("Vector4"===L.getClassName())return p.Quaternion.qU(L.Va());if("YU"===L.getClassName())return p.Quaternion.FromEulerVector(L);if("Matrix"===L.getClassName())return p.Quaternion.FromRotationMatrix(L)}return L};const D=new o("FlowGraphInteger",new F.b(0),0);function P(L){const U=L;switch(typeof L){case"string":return r;case"number":return h;case"boolean":return b;case"object":if(U.getClassName)switch(U.getClassName()){case"Vector2":return E;case"YU":return Y;case"Vector4":return S;case"Matrix":return V;case"QU":return q;case"ia":return f;case"Quaternion":return v;case"FlowGraphInteger":return D;case"Matrix2D":return H;case"Matrix3D":return Q}return A;default:return A}}function d(L){switch(L){case"string":return r;case"number":return h;case"boolean":return b;case"Vector2":return E;case"YU":return Y;case"Vector4":return S;case"Matrix":return V;case"QU":return q;case"ia":return f;case"Quaternion":return v;case"FlowGraphInteger":return D;case"Matrix2D":return H;case"Matrix3D":return Q;default:return A}}function K(L){switch(L){case"number":default:return 0;case"Vector2":return 5;case"YU":return 1;case"Matrix":return 3;case"QU":return 4;case"ia":return 7;case"Quaternion":return 2}}function l(L){switch(L){case 0:return h;case 5:return E;case 1:return Y;case 3:return V;case 4:return q;case 7:return f;case 2:return v;default:return A}}},14339:(L,U,x)=>{"use strict";x.d(U,{b:()=>r,e:()=>A,f:()=>h});var mL=x(12637),p=x(12589),G=x(14343),F=x(14348),a=x(14351);function o(L){return"Vector2"===L||"YU"===L||"Vector4"===L||"Quaternion"===L||"QU"===L||"ia"===L}function A(L,U,x){var mL;const p=(null===U||void 0===U||null===(mL=U.getClassName)||void 0===mL?void 0:mL.call(U))??"";if(o(p)||function(L){return"Matrix"===L||"Matrix2D"===L||"Matrix3D"===L}(p))x[L]={value:U.Va(),className:p};else if("FlowGraphInteger"===p)x[L]={value:U.value,className:p};else if(p&&(U.id||U.name))x[L]={id:U.id,name:U.name,className:p};else{if("object"===typeof U)throw new Error(`Could not serialize value ${U}`);x[L]=U}}function r(L,U,x,A){const h=U[L];let b;const E=(null===h||void 0===h?void 0:h.type)??(null===h||void 0===h?void 0:h.className);if(function(L){return"Mesh"===L||"AbstractMesh"===L||"GroundMesh"===L||"InstanceMesh"===L||"LinesMesh"===L||"GoldbergMesh"===L||"GreasedLineMesh"===L||"TrailMesh"===L}(E)){let L=A.meshes.filter((L=>h.id?L.id===h.id:L.name===h.name));0===L.length&&(L=A.transformNodes.filter((L=>h.id?L.id===h.id:L.name===h.name))),b=h.uniqueId?L.find((L=>L.uniqueId===h.uniqueId)):L[0]}else if(o(E))b=function(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===L)return p.Vector2.qU(U);if("YU"===L)return x&&(U[2]*=-1),p.YU.qU(U);if("Vector4"===L)return p.Vector4.qU(U);if("Quaternion"===L)return x&&(U[2]*=-1,U[3]*=-1),p.Quaternion.qU(U);if("QU"===L)return new mL.QU(U[0],U[1],U[2]);if("ia"===L)return new mL.ia(U[0],U[1],U[2],U[3]);throw new Error(`Unknown vector class name ${L}`)}(E,h.value);else if(function(L){return"AnimationGroup"===L}(E)){const L=A.animationGroups.filter((L=>L.name===h.name));b=1===L.length?L[0]:L.find((L=>L.uniqueId===h.uniqueId))}else b="Matrix"===E?p.Matrix.qU(h.value):"Matrix2D"===E?new a.e(h.value):"Matrix3D"===E?new a.f(h.value):"FlowGraphInteger"===E?G.b.FromValue(h.value):"number"===E||"string"===E||"boolean"===E?h.value[0]:h&&void 0!==h.value?h.value:Array.isArray(h)?h.reduce(((L,U)=>U.eventData?(L[U.id]={type:(0,F.I)(U.type)},"undefined"!==typeof U.value&&(L[U.id].value=r("value",U,x,A)),L):L),{}):h;return b}function h(L){return"FlowGraphJsonPointerParserBlock"===L}},14379:(L,U,x)=>{"use strict";function mL(L,U){return!(!L.parent||L.parent!==U&&!mL(L.parent,U))}function p(L){if(L.getClassName)return L.getClassName()}function G(L,U){return L===U&&("Vector2"===L||"YU"===L||"Vector4"===L||"Quaternion"===L)}function F(L,U){return L===U&&("Matrix"===L||"Matrix2D"===L||"Matrix3D"===L)}function a(L,U){return"FlowGraphInteger"===L&&"FlowGraphInteger"===U}function o(L,U){const x="number"===typeof L||"number"===typeof(null===L||void 0===L?void 0:L.value);return x&&!U?!isNaN(A(L)):x}function A(L){return"number"===typeof L?L:L.value}x.d(U,{e:()=>a,f:()=>F,j:()=>G,l:()=>p,p:()=>mL,s:()=>A,u:()=>o})},13728:(L,U,x)=>{"use strict";x.r(U),x.d(U,{SceneInstrumentation:()=>G});var mL=x(12382),p=x(12796);class G{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(L){L!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=L,L?(this._onBeforeActiveMeshesEvaluationObserver=this.VU.onBeforeActiveMeshesEvaluationObservable.add((()=>{mL.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.VU.onAfterActiveMeshesEvaluationObservable.add((()=>{mL.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.VU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.VU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(L){L!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=L,L?(this._onBeforeRenderTargetsRenderObserver=this.VU.onBeforeRenderTargetsRenderObservable.add((()=>{mL.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.VU.onAfterRenderTargetsRenderObservable.add((()=>{mL.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.VU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.VU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(L){L!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=L,L?(this._onBeforeParticlesRenderingObserver=this.VU.onBeforeParticlesRenderingObservable.add((()=>{mL.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.VU.onAfterParticlesRenderingObservable.add((()=>{mL.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.VU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.VU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(L){L!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=L,this.VU.spriteManagers&&(L?(this._onBeforeSpritesRenderingObserver=this.VU.onBeforeSpritesRenderingObservable.add((()=>{mL.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.VU.onAfterSpritesRenderingObservable.add((()=>{mL.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.VU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.VU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(L){L!==this._capturePhysicsTime&&this.VU.onBeforePhysicsObservable&&(this._capturePhysicsTime=L,L?(this._onBeforePhysicsObserver=this.VU.onBeforePhysicsObservable.add((()=>{mL.Tools.StartPerformanceCounter("xh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.VU.onAfterPhysicsObservable.add((()=>{mL.Tools.EndPerformanceCounter("xh"),this._physicsTime.endMonitoring()}))):(this.VU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.VU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(L){L!==this._captureAnimationsTime&&(this._captureAnimationsTime=L,L?this._onAfterAnimationsObserver=this.VU.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.VU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(L){this._captureFrameTime=L}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(L){this._captureInterFrameTime=L}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(L){L!==this._captureRenderTime&&(this._captureRenderTime=L,L?(this._onBeforeDrawPhaseObserver=this.VU.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),mL.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.VU.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),mL.Tools.EndPerformanceCounter("Main render")}))):(this.VU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.VU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(L){L!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=L,L?(this._onBeforeCameraRenderObserver=this.VU.onBeforeCameraRenderObservable.add((L=>{this._cameraRenderTime.beginMonitoring(),mL.Tools.StartPerformanceCounter(`Rendering camera ${L.name}`)})),this._onAfterCameraRenderObserver=this.VU.onAfterCameraRenderObservable.add((L=>{this._cameraRenderTime.endMonitoring(!1),mL.Tools.EndPerformanceCounter(`Rendering camera ${L.name}`)}))):(this.VU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.VU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.VU.getEngine()._drawCalls}constructor(L){this.VU=L,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new p.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new p.e,this._captureFrameTime=!1,this._frameTime=new p.e,this._captureRenderTime=!1,this._renderTime=new p.e,this._captureInterFrameTime=!1,this._interFrameTime=new p.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new p.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new p.e,this._capturePhysicsTime=!1,this._physicsTime=new p.e,this._captureAnimationsTime=!1,this._animationsTime=new p.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new p.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=L.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(mL.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.VU.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=L.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(mL.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.aa(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.aa(),this._captureParticlesRenderTime&&this._particlesRenderTime.aa(),this._captureSpritesRenderTime&&this._spritesRenderTime.aa(),this._captureRenderTime&&this._renderTime.aa(),this._captureCameraRenderTime&&this._cameraRenderTime.aa()}))}dispose(){this._disposed||(this.VU.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.VU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.VU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.VU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.VU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.VU.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.VU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.VU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.VU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.VU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.VU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.VU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.VU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.VU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.VU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.VU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.VU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.VU=null,this._disposed=!0)}}},14332:(L,U,x)=>{"use strict";x.d(U,{b:()=>r});var mL=x(12571),p=x(12574),G=x(12589),F=x(13022),a=x(13150),o=x(13208),A=x(12547);F.e.AddNodeConstructor("Light_Type_1",((L,U)=>()=>new r(L,G.YU.Zero(),U)));class r extends o.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(L){this._shadowFrustumSize=L,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(L){this._shadowOrthoScale=L,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(L){this._orthoLeft=L}get orthoRight(){return this._orthoRight}set orthoRight(L){this._orthoRight=L}get orthoTop(){return this._orthoTop}set orthoTop(L){this._orthoTop=L}get orthoBottom(){return this._orthoBottom}set orthoBottom(L){this._orthoBottom=L}constructor(L,U,x){super(L,x),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=U.scale(-1),this.direction=U}getClassName(){return"mb"}getTypeID(){return a.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(L,U,x){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(L):this._setDefaultAutoExtendShadowProjectionMatrix(L,U,x)}_setDefaultFixedFrustumShadowProjectionMatrix(L){const U=this.PL().activeCamera;U&&G.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:U.Qa,void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,L,this.PL().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(L,U,x){const mL=this.PL().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const L=G.YU.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let mL=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let F=0;F<x.length;F++){const a=x[F];if(!a)continue;const o=a.getBoundingInfo().boundingBox;for(let x=0;x<o.vectorsWorld.length;x++)G.YU.TransformCoordinatesToRef(o.vectorsWorld[x],U,L),L.x<this._orthoLeft&&(this._orthoLeft=L.x),L.y<this._orthoBottom&&(this._orthoBottom=L.y),L.x>this._orthoRight&&(this._orthoRight=L.x),L.y>this._orthoTop&&(this._orthoTop=L.y),this.autoCalcShadowZBounds&&(L.z<mL&&(mL=L.z),L.z>p&&(p=L.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=mL,this._shadowMaxZ=p)}const p=this._orthoRight-this._orthoLeft,F=this._orthoTop-this._orthoBottom,a=void 0!==this.shadowMinZ?this.shadowMinZ:(null===mL||void 0===mL?void 0:mL.Qa)||0,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===mL||void 0===mL?void 0:mL.maxZ)||1e4,A=this.PL().getEngine().Ga;G.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-p*this.shadowOrthoScale,this._orthoRight+p*this.shadowOrthoScale,this._orthoBottom-F*this.shadowOrthoScale,this._orthoTop+F*this.shadowOrthoScale,A?o:a,A?a:o,L,this.PL().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(L,U){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,U),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,U),this)}transferToNodeMaterialEffect(L,U){return this.computeTransformedInformation()?(L.setFloat3(U,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(L.setFloat3(U,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(L){const U=this._scene.getEngine();return!U.Ga&&U.isNDCHalfZRange?0:1}getDepthMaxZ(L){const U=this._scene.getEngine();return U.Ga&&U.isNDCHalfZRange?0:1}prepareLightSpecificDefines(L,U){L["DIRLIGHT"+U]=!0}}(0,mL.d)([(0,p.R)()],r.prototype,"shadowFrustumSize",null),(0,mL.d)([(0,p.R)()],r.prototype,"shadowOrthoScale",null),(0,mL.d)([(0,p.R)()],r.prototype,"autoUpdateExtends",void 0),(0,mL.d)([(0,p.R)()],r.prototype,"autoCalcShadowZBounds",void 0),(0,mL.d)([(0,p.R)("orthoLeft")],r.prototype,"_orthoLeft",void 0),(0,mL.d)([(0,p.R)("orthoRight")],r.prototype,"_orthoRight",void 0),(0,mL.d)([(0,p.R)("orthoTop")],r.prototype,"_orthoTop",void 0),(0,mL.d)([(0,p.R)("orthoBottom")],r.prototype,"_orthoBottom",void 0),(0,A.d)("BABYLON.DirectionalLight",r)},14794:(L,U,x)=>{"use strict";x.d(U,{d:()=>r});var mL=x(12571),p=x(12574),G=x(12589),F=x(12637),a=x(13022),o=x(13150),A=x(12547);a.e.AddNodeConstructor("Light_Type_3",((L,U)=>()=>new r(L,G.YU.Zero(),U)));class r extends o.d{constructor(L,U,x){super(L,x),this.groundColor=new F.QU(0,0,0),this.direction=U||G.YU.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Gh"}setDirectionToTarget(L){return this.direction=G.YU.Normalize(L.SU(G.YU.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(L,U){const x=G.YU.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",x.x,x.y,x.z,0,U),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.ya),U),this}transferToNodeMaterialEffect(L,U){const x=G.YU.Normalize(this.direction);return L.setFloat3(U,x.x,x.y,x.z),this}fa(){return this._worldMatrix||(this._worldMatrix=G.Matrix.Identity()),this._worldMatrix}getTypeID(){return o.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(L,U){L["HEMILIGHT"+U]=!0}}(0,mL.d)([(0,p.m)()],r.prototype,"groundColor",void 0),(0,mL.d)([(0,p.Q)()],r.prototype,"direction",void 0),(0,A.d)("BABYLON.HemisphericLight",r)},14294:(L,U,x)=>{"use strict";x.d(U,{b:()=>h});var mL=x(12571),p=x(12574),G=x(12589),F=x(13022),a=x(13150),o=x(13208),A=x(12565),r=x(12547);F.e.AddNodeConstructor("Light_Type_2",((L,U)=>()=>new h(L,G.YU.Zero(),G.YU.Zero(),0,0,U)));class h extends o.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(L){this._iesProfileTexture!==L&&(this._iesProfileTexture=L,this._iesProfileTexture&&h._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(L){this._angle=L,this._cosHalfAngle=Math.cos(.5*L),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(L){this._innerAngle=L,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(L){this._shadowAngleScale=L,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(L){this._projectionTextureLightNear=L,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(L){this._projectionTextureLightFar=L,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(L){this._projectionTextureUpDirection=L,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(L){this._projectionTexture!==L&&(this._projectionTexture=L,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(h._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):h._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(L){return void 0!==L.onGeneratedObservable}static _IsTexture(L){return void 0!==L.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(L){this._projectionTextureProjectionLightMatrix=L,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(L,U,x,mL,p,F){super(L,F),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=G.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=G.YU.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=G.YU.Zero(),this._projectionTextureViewLightMatrix=G.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=G.Matrix.Zero(),this._projectionTextureScalingMatrix=G.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=U,this.direction=x,this.angle=mL,this.exponent=p}getClassName(){return"SpotLight"}getTypeID(){return a.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(L){super._setDirection(L),this._projectionTextureViewLightDirty=!0}_setPosition(L){super._setPosition(L),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(L,U,x){const mL=this.PL().activeCamera;if(!mL)return;this._shadowAngleScale=this._shadowAngleScale||1;const p=this._shadowAngleScale*this._angle,F=void 0!==this.shadowMinZ?this.shadowMinZ:mL.Qa,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:mL.maxZ,o=this.PL().getEngine().Ga;G.Matrix.PerspectiveFovLHToRef(p,1,o?a:F,o?F:a,L,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),G.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const L=this.projectionTextureLightFar,U=this.projectionTextureLightNear,x=L/(L-U),mL=-x*U,p=1/Math.tan(this._angle/2);G.Matrix.FromValuesToRef(p/1,0,0,0,0,p,0,0,0,0,x,1,0,0,mL,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof A.e){const L=this._projectionTexture.uScale/2,U=this._projectionTexture.vScale/2;G.Matrix.FromValuesToRef(L,0,0,0,0,U,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(L,U){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),L.setMatrix("textureProjectionMatrix"+U,this._projectionTextureMatrix),L.setTexture("projectionLightTexture"+U,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&L.setTexture("iesLightTexture"+U,this._iesProfileTexture),this}transferToEffect(L,U){let x;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,U),x=G.YU.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,U),x=G.YU.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",x.x,x.y,x.z,this._cosHalfAngle,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,U),this}transferToNodeMaterialEffect(L,U){let x;return x=this.computeTransformedInformation()?G.YU.Normalize(this.transformedDirection):G.YU.Normalize(this.direction),this.PL().useRightHandedSystem?L.setFloat3(U,-x.x,-x.y,-x.z):L.setFloat3(U,x.x,x.y,x.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(L){const U=this._scene.getEngine(),x=void 0!==this.shadowMinZ?this.shadowMinZ:(null===L||void 0===L?void 0:L.Qa)??0;return U.Ga&&U.isNDCHalfZRange?x:this._scene.getEngine().isNDCHalfZRange?0:x}getDepthMaxZ(L){const U=this._scene.getEngine(),x=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===L||void 0===L?void 0:L.maxZ)??1e4;return U.Ga&&U.isNDCHalfZRange?0:x}prepareLightSpecificDefines(L,U){L["SPOTLIGHT"+U]=!0,L["PROJECTEDLIGHTTEXTURE"+U]=!(!this.projectionTexture||!this.projectionTexture.isReady()),L["IESLIGHTTEXTURE"+U]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,mL.d)([(0,p.R)()],h.prototype,"angle",null),(0,mL.d)([(0,p.R)()],h.prototype,"innerAngle",null),(0,mL.d)([(0,p.R)()],h.prototype,"shadowAngleScale",null),(0,mL.d)([(0,p.R)()],h.prototype,"exponent",void 0),(0,mL.d)([(0,p.R)()],h.prototype,"projectionTextureLightNear",null),(0,mL.d)([(0,p.R)()],h.prototype,"projectionTextureLightFar",null),(0,mL.d)([(0,p.R)()],h.prototype,"projectionTextureUpDirection",null),(0,mL.d)([(0,p.J)("projectedLightTexture")],h.prototype,"_projectionTexture",void 0),(0,r.d)("BABYLON.SpotLight",h)},14017:(L,U,x)=>{"use strict";x.d(U,{e:()=>F,h:()=>G,i:()=>a});const mL={},p={};function G(L,U){mL[L]=U}function F(L,U){p[L]=U}function a(L){return p[L]?p[L]:null}},13916:(L,U,x)=>{"use strict";x.d(U,{c:()=>P,f:()=>u});var mL,p=x(12382),G=x(12391),F=x(12820),a=x(12440),o=x(12406),A=x(13066),r=x(12448),h=x(12452),b=x(12550),E=x(12479),Y=x(12434);!function(L){L[L.Clean=0]="Clean",L[L.Stop=1]="Stop",L[L.Sync=2]="Sync",L[L.NoSync=3]="NoSync"}(mL||(mL={}));const S=new G.c,V={};let H=!1;function Q(){return V[".babylon"]}function q(L,U){const x=V[L];return x||(o.c.Warn("Unable to find a plugin to load "+L+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U?Q():void 0)}function f(L,U,x){let mL="Unable to load from "+(L.rawData?"binary data":L.url);return U?mL+=`: ${U}`:x&&(mL+=`: ${x}`),mL}async function v(L,U,x,mL,p,G,F,a,o){var A;const h="data:"===(b=L.url).substring(0,5)?b.substring(5):null;var b;if(L.rawData&&!F)throw"When using ArrayBufferView to load data the file extension must be provided.";const H=h||F?"":function(L){const U=L.indexOf("?");-1!==U&&(L=L.substring(0,U));const x=L.lastIndexOf(".");return L.substring(x,L.length).toLowerCase()}(L.url);let f=F?q(F,!0):h?function(L){for(const U in V){const x=V[U].plugin;if(x.canDirectLoad&&x.canDirectLoad(L))return V[U]}return Q()}(L.url):q(H,!1);if(!f&&H){if(L.url&&!L.url.startsWith("blob:")){const U=await async function(L,U){const x=U.method||"GET";return await new Promise(((mL,p)=>{const G=new Y.e;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const L={};if(U.responseHeaders)for(const x of U.responseHeaders)L[x]=G.getResponseHeader(x)||"";mL({response:G.response,headerValues:L})}else p(`Unable to fetch data from ${L}. Error code: ${G.status}`)})),G.open(x,L),G.send()}))}(L.url,{method:"HEAD",responseHeaders:["Content-Type"]}),x=U.headerValues?U.headerValues["Content-Type"]:"";x&&(f=function(L){for(const U in V){const x=V[U];if(x.mimeType===L)return x}}(x))}f||(f=Q())}if(!f)throw new Error(`No plugin or fallback for ${F??L.url}`);if(!1===(null===o||void 0===o||null===(A=o[f.plugin.name])||void 0===A?void 0:A.enabled))throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(L.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(L=>{if(f.plugin.createPlugin){const U=f.plugin.createPlugin(o??{});return U instanceof Promise?(U.then(L).catch((L=>{p("Error instantiating plugin.",L)})),null):(L(U),U)}return L(f.plugin),f.plugin})((o=>{var A;if(!o)throw`The loader plugin corresponding to the '${F}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(S.notifyObservers(o),h&&(o.canDirectLoad&&o.canDirectLoad(L.url)||!(0,r.i)(L.url))){if(o.directLoad){const L=o.directLoad(U,h);L instanceof Promise?L.then((L=>{x(o,L)})).catch((L=>{p("Error in directLoad of _loadData: "+L,L)})):x(o,L)}else x(o,h);return}const b=f.isBinary,Y=(L,mL)=>{U.A?p("Scene has been disposed"):x(o,L,mL)};let V=null,H=!1;null===(A=o.oa)||void 0===A||A.add((()=>{H=!0,V&&(V.abort(),V=null),G()}));const Q=()=>{if(H)return;const x=(L,U)=>{p(null===L||void 0===L?void 0:L.statusText,U)};if(!o.loadFile&&L.rawData)throw"Plugin does not support loading ArrayBufferView.";V=o.loadFile?o.loadFile(U,L.rawData||L.file||L.url,L.rootUrl,Y,mL,b,x,a):U._loadFile(L.file||L.url,Y,mL,!0,b,x)},q=U.getEngine();let v=q.enableOfflineSupport;if(v){let x=!1;for(const mL of U.disableOfflineSupportExceptionRules)if(mL.test(L.url)){x=!0;break}v=!x}v&&E.e.OfflineProviderFactory?U.offlineProvider=E.e.OfflineProviderFactory(L.url,Q,q.disableManifestCheck):Q()}))}function D(L,U){let x,mL,G=null,F=null;if(U)if(U.name)x=`file:${U.name}`,mL=U.name,G=U;else if(ArrayBuffer.isView(U))x="",mL=(0,b.b)(),F=U;else if(U.startsWith("data:"))x=U,mL="";else if(L){const G=U;if("/"===G.substring(0,1))return p.Tools.Error("Wrong sceneFilename parameter"),null;x=L+G,mL=G}else x=U,mL=p.Tools.GetFilename(U),L=p.Tools.GetFolderPath(U);else x=L,mL=p.Tools.GetFilename(L),L=p.Tools.GetFolderPath(L);return{url:x,rootUrl:L,name:mL,file:G,rawData:F}}function P(L){if("string"===typeof L.extensions){const U=L.extensions;V[U.toLowerCase()]={plugin:L,isBinary:!1}}else{const U=L.extensions,x=Object.keys(U);for(const mL of x)V[mL.toLowerCase()]={plugin:L,isBinary:U[mL].isBinary,mimeType:U[mL].mimeType}}}async function d(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.c.LastCreatedScene,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!mL)return o.c.Error("No scene available to import mesh to"),null;const E=D(U,x);if(!E)return null;const Y={};mL.addPendingData(Y);const S=()=>{mL.removePendingData(Y)},V=(L,U)=>{const x=f(E,L,U);F?F(mL,x,new h.i(x,h.h.SceneLoaderError,U)):o.c.Error(x),S()},H=G?L=>{try{G(L)}catch(U){V("Error in onProgress callback: "+U,U)}}:void 0,Q=(L,U,x,G,F,a,o,A)=>{if(mL.importedMeshesFiles.push(E.url),p)try{p(L,U,x,G,F,a,o,A)}catch(r){V("Error in onSuccess callback: "+r,r)}mL.removePendingData(Y)};return await v(E,mL,((U,x,p)=>{if(U.rewriteRootURL&&(E.rootUrl=U.rewriteRootURL(E.rootUrl,p)),U.importMesh){const p=[],G=[],F=[];if(!U.importMesh(L,mL,x,E.rootUrl,p,G,F,V))return;mL.loadingPluginName=U.name,Q(p,G,F,[],[],[],[],[])}else{U.importMeshAsync(L,mL,x,E.rootUrl,H,E.name).then((L=>{mL.loadingPluginName=U.name,Q(L.meshes,L.fE,L.skeletons,L.animationGroups,L.transformNodes,L.geometries,L.lights,L.spriteManagers)})).catch((L=>{V(L.message,L)}))}}),H,V,S,A,r,b)}async function K(L,U,x,mL,p,G,F,a){return await new Promise(((o,A)=>{try{d(L,U,x,mL,((L,U,x,mL,p,G,F,a)=>{o({meshes:L,fE:U,skeletons:x,animationGroups:mL,transformNodes:p,geometries:G,lights:F,spriteManagers:a})}),p,((L,U,x)=>{A(x||new Error(U))}),G,F,a).catch(A)}catch(h){A(h)}}))}async function l(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedEngine,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};x?await X(L,U,new F.e(x),mL,G,o,A,r,h):p.Tools.Error("No engine available")}async function i(L,U,x,mL,p,G,F){return await new Promise(((a,o)=>{l(L,U,x,(L=>{a(L)}),mL,((L,U,x)=>{o(x||new Error(U))}),p,G,F)}))}async function X(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedScene,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!x)return o.c.Error("No scene available to append to"),null;const E=D(L,U);if(!E)return null;const Y={};x.addPendingData(Y);const S=()=>{x.removePendingData(Y)};A.d.ShowLoadingScreen&&!H&&(H=!0,x.getEngine().displayLoadingUI(),x.executeWhenReady((()=>{x.getEngine().hideLoadingUI(),H=!1})));const V=(L,U)=>{const mL=f(E,L,U);G?G(x,mL,new h.i(mL,h.h.SceneLoaderError,U)):o.c.Error(mL),S()},Q=p?L=>{try{p(L)}catch(U){V("Error in onProgress callback",U)}}:void 0,q=()=>{if(mL)try{mL(x)}catch(L){V("Error in onSuccess callback",L)}x.removePendingData(Y)};return await v(E,x,((L,U)=>{if(L.load){if(!L.load(x,U,E.rootUrl,V))return;x.loadingPluginName=L.name,q()}else{L.loadAsync(x,U,E.rootUrl,Q,E.name).then((()=>{x.loadingPluginName=L.name,q()})).catch((L=>{V(L.message,L)}))}}),Q,V,S,F,r,b)}async function t(L,U,x,mL,p,G,F){return await new Promise(((a,o)=>{try{X(L,U,x,(L=>{a(L)}),mL,((L,U,x)=>{o(x||new Error(U))}),p,G,F).catch(o)}catch(h){o(h)}}))}async function y(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedScene,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!x)return o.c.Error("No scene available to load asset container to"),null;const b=D(L,U);if(!b)return null;const E={};x.addPendingData(E);const Y=()=>{x.removePendingData(E)},S=(L,U)=>{const mL=f(b,L,U);G?G(x,mL,new h.i(mL,h.h.SceneLoaderError,U)):o.c.Error(mL),Y()},V=p?L=>{try{p(L)}catch(U){S("Error in onProgress callback",U)}}:void 0,H=L=>{if(mL)try{mL(L)}catch(U){S("Error in onSuccess callback",U)}x.removePendingData(E)};return await v(b,x,((L,U)=>{if(L.loadAssetContainer){const mL=L.loadAssetContainer(x,U,b.rootUrl,S);if(!mL)return;mL.populateRootNodes(),x.loadingPluginName=L.name,H(mL)}else if(L.loadAssetContainerAsync){L.loadAssetContainerAsync(x,U,b.rootUrl,V,b.name).then((U=>{U.populateRootNodes(),x.loadingPluginName=L.name,H(U)})).catch((L=>{S(L.message,L)}))}else S("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,S,Y,F,A,r)}async function n(L,U,x,mL,p,G,F){return await new Promise(((a,o)=>{try{y(L,U,x,(L=>{a(L)}),mL,((L,U,x)=>{o(x||new Error(U))}),p,G,F).catch(o)}catch(h){o(h)}}))}async function N(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedScene,mL=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!x)return void o.c.Error("No scene available to load animations to");if(mL){for(const mL of x.animatables)mL.reset();x.stopAllAnimations();const L=x.animationGroups.slice();for(const x of L)x.dispose();const U=x.getNodes();for(const x of U)x.animations&&(x.animations=[])}else switch(p){case 0:const L=x.animationGroups.slice();for(const U of L)U.dispose();break;case 1:for(const U of x.animationGroups)U.stop();break;case 2:for(const U of x.animationGroups)U.reset(),U.restart();break;case 3:break;default:return void o.c.Error("Unknown animation group loading mode value '"+p+"'")}const Y=x.animatables.length;await y(L,U,x,(L=>{L.mergeAnimationsTo(x,x.animatables.slice(Y),G),L.dispose(),x.onAnimationFileImportedObservable.notifyObservers(x),F&&F(x)}),A,r,h,b,E)}async function e(L,U,x,mL,p,G,F,a,o,A){return await new Promise(((r,b)=>{try{N(L,U,x,mL,p,G,(L=>{r(L)}),F,((L,U,x)=>{b(x||new Error(U))}),a,o,A).catch(b)}catch(h){b(h)}}))}class u{static get ForceFullSceneLoadingForIncremental(){return A.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(L){A.d.ForceFullSceneLoadingForIncremental=L}static get ShowLoadingScreen(){return A.d.ShowLoadingScreen}static set ShowLoadingScreen(L){A.d.ShowLoadingScreen=L}static get loggingLevel(){return A.d.loggingLevel}static set loggingLevel(L){A.d.loggingLevel=L}static get CleanBoneMatrixWeights(){return A.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(L){A.d.CleanBoneMatrixWeights=L}static GetDefaultPlugin(){return Q()}static GetPluginForExtension(L){var U;return null===(U=q(L,!0))||void 0===U?void 0:U.plugin}static IsPluginForExtensionAvailable(L){return function(L){return!!V[L]}(L)}static RegisterPlugin(L){P(L)}static ImportMesh(L,U,x,mL,p,G,F,o,A){d(L,U,x,mL,p,G,F,o,A).catch((L=>null===F||void 0===F?void 0:F(a.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async ImportMeshAsync(L,U,x,mL,p,G,F){return await K(L,U,x,mL,p,G,F)}static Load(L,U,x,mL,p,G,F,o){l(L,U,x,mL,p,G,F,o).catch((L=>null===G||void 0===G?void 0:G(a.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async LoadAsync(L,U,x,mL,p,G){return await i(L,U,x,mL,p,G)}static Append(L,U,x,mL,p,G,F,o){X(L,U,x,mL,p,G,F,o).catch((L=>null===G||void 0===G?void 0:G(x??a.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async AppendAsync(L,U,x,mL,p,G){return await t(L,U,x,mL,p,G)}static LoadAssetContainer(L,U,x,mL,p,G,F,o){y(L,U,x,mL,p,G,F,o).catch((L=>null===G||void 0===G?void 0:G(x??a.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async LoadAssetContainerAsync(L,U,x,mL,p,G){return await n(L,U,x,mL,p,G)}static ImportAnimations(L,U,x,mL,p,G,F,o,A,r,h){N(L,U,x,mL,p,G,F,o,A,r,h).catch((L=>null===A||void 0===A?void 0:A(x??a.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async ImportAnimationsAsync(L,U,x,mL,p,G,F,a,o,A,r){return await e(L,U,x,mL,p,G,a,A,r)}}u.NO_LOGGING=0,u.MINIMAL_LOGGING=1,u.SUMMARY_LOGGING=2,u.DETAILED_LOGGING=3,u.OnPluginActivatedObservable=S},14313:(L,U,x)=>{"use strict";x.d(U,{c:()=>b});var mL=x(12571),p=x(12574),G=x(12382),F=x(12589),a=x(12613),o=x(12565),A=x(12547),r=x(12391),h=x(12625);x(14319);class b extends a.e{set boundingBoxSize(L){if(this._boundingBoxSize&&this._boundingBoxSize.equals(L))return;this._boundingBoxSize=L;const U=this.PL();U&&U.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(L){this._rotationY=L,this.setReflectionTextureMatrix(F.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(L,U,x){let mL="";for(const p of L)mL+=p;return new b(mL,U,null,x,L)}static CreateFromPrefilteredData(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,mL=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const G=new b(L,U,null,!1,null,null,null,void 0,!0,x,mL);return U.useDelayedTextureLoading=p,G}constructor(L,U){var x;let mL=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,H=arguments.length>13?arguments[13]:void 0,Q=arguments.length>14?arguments[14]:void 0;super(U),this.onLoadObservable=new r.c,this.boundingBoxPosition=F.YU.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new F.Matrix,this._buffer=null,this.name=L,this.url=L,this._noMipmap=p,this.Ha=!1,this.isCube=!0,this._textureMatrix=F.Matrix.Identity(),this.coordinatesMode=o.e.CUBIC_MODE;let q=null,f=null;null===mL||Array.isArray(mL)?(this._noMipmap=p,this._format=h,this._createPolynomials=Y,q=mL,this._loaderOptions=H,this._useSRGBBuffer=Q,this._lodScale=S,this._lodOffset=V):(q=mL.extensions??null,this._noMipmap=mL.noMipmap??!1,G=mL.files??null,f=mL.buffer??null,this._format=mL.format??5,b=mL.prefiltered??!1,E=mL.forcedExtension??null,this._createPolynomials=mL.createPolynomials??!1,this._lodScale=mL.lodScale??.8,this._lodOffset=mL.lodOffset??0,this._loaderOptions=mL.loaderOptions,this._useSRGBBuffer=mL.useSRGBBuffer,a=mL.C??null,A=mL.onError??null),(L||G)&&this.updateURL(L,E,a,b,A,q,null===(x=this.PL())||void 0===x?void 0:x.useDelayedTextureLoading,G,f)}getClassName(){return"CubeTexture"}updateURL(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=L),this.url=L,U&&(this._forcedExtension=U);const A=L.lastIndexOf("."),r=U||(A>-1?L.substring(A).toLowerCase():""),h=0===r.indexOf(".dds"),b=0===r.indexOf(".env"),E=0===r.indexOf(".basis");if(b?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=mL,mL&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(E||b||h||G||(G=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,G){for(let U=0;U<G.length;U++)this._files.push(L+G[U]);this._extensions=G}this._buffer=o,F?(this.delayLoadState=4,this._delayedOnLoad=x,this._delayedOnError=p):this._loadTexture(x,p)}delayLoad(L){4===this.delayLoadState&&(L&&(this._forcedExtension=L),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(L){var U,x;if(L.updateFlag===this._textureMatrix.updateFlag)return;L.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(x=this.PL())||void 0===x||x.markAllMaterialsAsDirty(1,(L=>-1!==L.getActiveTextures().indexOf(this))));if(this._textureMatrix=L,null===(U=this.PL())||void 0===U||!U.useRightHandedSystem)return;const mL=F.TmpVectors.YU[0],p=F.TmpVectors.Quaternion[0],G=F.TmpVectors.YU[1];this._textureMatrix.decompose(mL,p,G),p.z*=-1,p.w*=-1,F.Matrix.ComposeToRef(mL,p,G,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var L;return null!==(L=this.PL())&&void 0!==L&&L.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=this.PL(),mL=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const p=()=>{var U;(this.onLoadObservable.notifyObservers(this),mL)&&(mL.dispose(),null===(U=this.PL())||void 0===U||U.markAllMaterialsAsDirty(1));L&&L()},F=(L,x)=>{this._loadingError=!0,this._errorObject={message:L,exception:x},U&&U(L,x),o.e.OnTextureLoadErrorObservable.notifyObservers(this)};var a;this._texture?this._texture.isReady?G.Tools.SetImmediate((()=>p())):this._texture.onLoadedObservable.add((()=>p())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,x,this._lodScale,this._lodOffset,L,F,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,x,this._files,this._noMipmap,L,F,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(a=this._texture)||void 0===a||a.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(L,U,x){const mL=h.e.Parse((()=>{let mL=!1;return L.prefiltered&&(mL=L.prefiltered),new b(x+(L.url??L.name),U,L.extensions,!1,L.files||null,null,null,void 0,mL,L.forcedExtension)}),L,U);if(L.boundingBoxPosition&&(mL.boundingBoxPosition=F.YU.qU(L.boundingBoxPosition)),L.boundingBoxSize&&(mL.boundingBoxSize=F.YU.qU(L.boundingBoxSize)),L.animations)for(let p=0;p<L.animations.length;p++){const U=L.animations[p],x=(0,A.b)("BABYLON.Animation");x&&mL.animations.push(x.Parse(U))}return mL}clone(){let L=0;const U=h.e.Clone((()=>{const U=new b(this.url,this.PL()||this._getEngine(),this._extensions,this._noMipmap,this._files);return L=U.uniqueId,U}),this);return U.uniqueId=L,U}}(0,mL.d)([(0,p.R)()],b.prototype,"url",void 0),(0,mL.d)([(0,p.Q)()],b.prototype,"boundingBoxPosition",void 0),(0,mL.d)([(0,p.Q)()],b.prototype,"boundingBoxSize",null),(0,mL.d)([(0,p.R)("rotationY")],b.prototype,"rotationY",null),(0,mL.d)([(0,p.R)("files")],b.prototype,"_files",void 0),(0,mL.d)([(0,p.R)("forcedExtension")],b.prototype,"_forcedExtension",void 0),(0,mL.d)([(0,p.R)("extensions")],b.prototype,"_extensions",void 0),(0,mL.d)([(0,p.B)("textureMatrix")],b.prototype,"_textureMatrix",void 0),(0,mL.d)([(0,p.B)("textureMatrixRefraction")],b.prototype,"_textureMatrixRefraction",void 0),o.e._CubeTextureParser=b.Parse,(0,A.d)("BABYLON.CubeTexture",b)},14809:(L,U,x)=>{"use strict";x.d(U,{c:()=>o});var mL=x(12406),p=x(12565),G=x(12557),F=x(12723),a=x(12521);F.ThinEngine.prototype.createDynamicTexture=function(L,U,x,mL){const p=new a.d(this,4);return p.baseWidth=L,p.baseHeight=U,x&&(L=this.needPOTTextures?(0,G.c)(L,this._caps.maxTextureSize):L,U=this.needPOTTextures?(0,G.c)(U,this._caps.maxTextureSize):U),p.width=L,p.height=U,p.isReady=!1,p.generateMipMaps=x,p.samplingMode=mL,this.updateTextureSamplingMode(mL,p),this._internalTexturesCache.push(p),p},F.ThinEngine.prototype.updateDynamicTexture=function(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!L)return;const F=this._gl,a=F.TEXTURE_2D,o=this._bindTextureDirectly(a,L,!0,G);this._unpackFlipY(void 0===x?L.invertY:x),mL&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const A=this._getWebGLTextureType(L.type),r=this._getInternalFormat(p||L.format),h=this._getRGBABufferInternalSizedFormat(L.type,r);F.texImage2D(a,0,h,r,A,U),L.generateMipMaps&&F.generateMipmap(a),o||this._bindTextureDirectly(a,null),mL&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),p&&(L.format=p),L._dynamicTextureSource=U,L._premulAlpha=mL,L.invertY=x||!1,L.isReady=!0};class o extends p.e{constructor(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,a=arguments.length>6?arguments[6]:void 0;const o=!x||x._isScene;super(null,o?x:null===x||void 0===x?void 0:x.VU,o?!mL:x,a,G,void 0,void 0,void 0,void 0,F),this.name=L,this.wrapU=p.e.CLAMP_ADDRESSMODE,this.wrapV=p.e.CLAMP_ADDRESSMODE,this._generateMipMaps=mL;const A=this._getEngine();if(!A)return;if(U.getContext)this._canvas=U,this._ownCanvas=!1,this._texture=A.createDynamicTexture(this._canvas.width,this._canvas.height,mL,G);else{this._canvas=A.createCanvas(1,1),this._ownCanvas=!0;const L=U;L.width||0===L.width?this._texture=A.createDynamicTexture(L.width,L.height,mL,G):this._texture=A.createDynamicTexture(U,U,mL,G)}const r=this.getSize();this._canvas.width!==r.width&&(this._canvas.width=r.width),this._canvas.height!==r.height&&(this._canvas.height=r.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(L){this._canvas.width=L.width,this._canvas.height=L.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(L.width,L.height,this._generateMipMaps,this.samplingMode)}scale(L){const U=this.getSize();U.width*=L,U.height*=L,this._recreate(U)}scaleTo(L,U){const x=this.getSize();x.width=L,x.height=U,this._recreate(x)}getContext(){return this._context}clear(L){const U=this.getSize();L&&(this._context.fillStyle=L),this._context.clearRect(0,0,U.width,U.height)}update(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===L||L,U,this._format||void 0,void 0,x)}drawText(L,U,x,mL,p,G,F){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const o=this.getSize();if(G&&(this._context.fillStyle=G,this._context.fillRect(0,0,o.width,o.height)),this._context.font=mL,null===U||void 0===U){const x=this._context.measureText(L);U=(o.width-x.width)/2}if(null===x||void 0===x){const L=parseInt(mL.replace(/\D/g,""));x=o.height/2+L/3.65}this._context.fillStyle=p||"",this._context.fillText(L,U,x),a&&this.update(F)}dispose(){var L,U;(super.dispose(),this._ownCanvas)&&(null===(L=this._canvas)||void 0===L||null===(U=L.remove)||void 0===U||U.call(L));this._canvas=null,this._context=null}clone(){const L=this.PL();if(!L)return this;const U=this.getSize(),x=new o(this.name,U,L,this._generateMipMaps);return x.Ha=this.Ha,x.level=this.level,x.wrapU=this.wrapU,x.wrapV=this.wrapV,x}serialize(){const L=this.PL();L&&!L.isReady()&&mL.c.Warn("The scene must be ready before serializing the dynamic texture");const U=super.serialize();return o._IsCanvasElement(this._canvas)&&(U.base64String=this._canvas.toDataURL()),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U}static _IsCanvasElement(L){return void 0!==L.toDataURL}_rebuild(){this.update()}}},14215:(L,U,x)=>{"use strict";x.d(U,{e:()=>p});var mL=x(12565);class p extends mL.e{get depth(){return this._depth}constructor(L,U,x,p,G,F){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:mL.e.TRILINEAR_SAMPLINGMODE,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,h=arguments.length>10?arguments[10]:void 0;super(null,F,!a,o),this.format=G,this._texture=F.getEngine().createRawTexture2DArray(L,U,x,p,G,a,o,A,null,r,h),this._depth=p,this.is2DArray=!0}update(L){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,L,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(L,U,x,mL,G){return new p(L,U,x,mL,5,G,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14030:(L,U,x)=>{"use strict";x.d(U,{b:()=>a,c:()=>o,d:()=>G,h:()=>F});var mL=x(12610),p=x(12589);function G(L,U){return`{X: ${L.x.toFixed(U)} Y: ${L.y.toFixed(U)}}`}function F(L,U){return`{X: ${L._x.toFixed(U)} Y: ${L._y.toFixed(U)} Z: ${L._z.toFixed(U)}}`}function a(L,U){return 2*Math.acos((0,mL.Clamp)(p.Quaternion.Dot(L,U)))}function o(L,U){const x=new p.Quaternion;return function(L,U,x){const G=p.YU.Cross(L,U),F=Math.acos((0,mL.Clamp)(p.YU.Dot(L,U),-1,1));p.Quaternion.RotationAxisToRef(G,F,x)}(L,U,x),x}},13867:(L,U,x)=>{"use strict";x.d(U,{c:()=>A});var mL=x(12589),p=x(12637),G=x(13046),F=x(13031),a=x(12646);x(13871);function o(L){let U=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const x=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],G=[];let o=[];const A=L.width||L.size||1,r=L.height||L.size||1,h=L.depth||L.size||1,b=L.wrap||!1;let E=void 0===L.topBaseAt?1:L.topBaseAt,Y=void 0===L.bottomBaseAt?0:L.bottomBaseAt;E=(E+4)%4,Y=(Y+4)%4;let S=[2,0,3,1][E],V=[2,0,1,3][Y],H=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(b){U=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],H=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let L=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],x=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const mL=[17,18,19,16],p=[22,23,20,21];for(;S>0;)L.unshift(L.pop()),mL.unshift(mL.pop()),S--;for(;V>0;)x.unshift(x.pop()),p.unshift(p.pop()),V--;L=L.flat(),x=x.flat(),H=H.concat(L).concat(x),U.push(mL[0],mL[2],mL[3],mL[0],mL[1],mL[2]),U.push(p[0],p[2],p[3],p[0],p[1],p[2])}const Q=[A/2,r/2,h/2];o=H.reduce(((L,U,x)=>L.concat(U*Q[x%3])),[]);const q=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,f=L.faceUV||new Array(6),v=L.faceColors,D=[];for(let F=0;F<6;F++)void 0===f[F]&&(f[F]=new mL.Vector4(0,0,1,1)),v&&void 0===v[F]&&(v[F]=new p.ia(1,1,1,1));for(let mL=0;mL<6;mL++)if(G.push(f[mL].z,a.b?1-f[mL].w:f[mL].w),G.push(f[mL].x,a.b?1-f[mL].w:f[mL].w),G.push(f[mL].x,a.b?1-f[mL].y:f[mL].y),G.push(f[mL].z,a.b?1-f[mL].y:f[mL].y),v)for(let L=0;L<4;L++)D.push(v[mL].r,v[mL].g,v[mL].b,v[mL].a);F.b._ComputeSides(q,o,U,x,G,L.frontUVs,L.backUVs);const P=new F.b;if(P.indices=U,P.KL=o,P.lL=x,P.XL=G,v){const L=q===F.b.DOUBLESIDE?D.concat(D):D;P.iL=L}return P}function A(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new G.e(L,x);U.sideOrientation=G.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return o(U).yL(mL,U.updatable),mL}F.b.CreateBox=o,G.e.CreateBox=function(L,U){return A(L,{size:U,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14020:(L,U,x)=>{"use strict";x.d(U,{b:()=>a});var mL=x(13046),p=x(13031),G=x(12646);function F(L){const U=[],x=[],mL=[],F=[],a=L.radius||.5,o=L.tessellation||64,A=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,r=0===L.sideOrientation?0:L.sideOrientation||p.b.DEFAULTSIDE;U.push(0,0,0),F.push(.5,.5);const h=2*Math.PI*A,b=1===A?h/o:h/(o-1);let E=0;for(let p=0;p<o;p++){const L=Math.cos(E),x=Math.sin(E),mL=(L+1)/2,p=(1-x)/2;U.push(a*L,a*x,0),F.push(mL,G.b?1-p:p),E+=b}1===A&&(U.push(U[3],U[4],U[5]),F.push(F[2],G.b?1-F[3]:F[3]));const Y=U.length/3;for(let p=1;p<Y-1;p++)x.push(p+1,0,p);p.b.ComputeNormals(U,x,mL),p.b._ComputeSides(r,U,x,mL,F,L.frontUVs,L.backUVs);const S=new p.b;return S.indices=x,S.KL=U,S.lL=mL,S.XL=F,S}function a(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new mL.e(L,x);U.sideOrientation=mL.e._GetDefaultSideOrientation(U.sideOrientation),p._originalBuilderSideOrientation=U.sideOrientation;return F(U).yL(p,U.updatable),p}p.b.CreateDisc=F,mL.e.CreateDisc=function(L,U,x){return a(L,{radius:U,tessellation:x,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13871:(L,U,x)=>{"use strict";x.d(U,{f:()=>V,b:()=>Q,j:()=>H});var mL=x(12589),p=x(12637),G=x(13046),F=x(13031),a=x(12666);G.e._GroundMeshParser=(L,U)=>o.Parse(L,U);class o extends G.e{constructor(L,U){super(L,U),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=L,this._subdivisionsY=L,this.subdivide(L);const x=this;x.createOrUpdateSubmeshesOctree&&x.createOrUpdateSubmeshesOctree(U)}getHeightAtCoordinates(L,U){const x=this.getWorldMatrix(),p=mL.TmpVectors.Matrix[5];x.invertToRef(p);const G=mL.TmpVectors.YU[8];if(mL.YU.TransformCoordinatesFromFloatsToRef(L,0,U,p,G),L=G.x,U=G.z,L<this._minX||L>=this._maxX||U<=this._minZ||U>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(L,U),a=-(F.x*L+F.z*U+F.w)/F.y;return mL.YU.TransformCoordinatesFromFloatsToRef(0,a,0,x,G),G.y}getNormalAtCoordinates(L,U){const x=new mL.YU(0,1,0);return this.getNormalAtCoordinatesToRef(L,U,x),x}getNormalAtCoordinatesToRef(L,U,x){const p=this.getWorldMatrix(),G=mL.TmpVectors.Matrix[5];p.invertToRef(G);const F=mL.TmpVectors.YU[8];if(mL.YU.TransformCoordinatesFromFloatsToRef(L,0,U,G,F),L=F.x,U=F.z,L<this._minX||L>this._maxX||U<this._minZ||U>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(L,U);return mL.YU.TransformNormalFromFloatsToRef(a.x,a.y,a.z,p,x),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(L,U){const x=Math.floor((L+this._maxX)*this._subdivisionsX/this._width),mL=Math.floor(-(U+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),p=this._heightQuads[mL*this._subdivisionsX+x];let G;return G=U<p.slope.x*L+p.slope.y?p.facet1:p.facet2,G}_initHeightQuads(){const L=this._subdivisionsX,U=this._subdivisionsY;this._heightQuads=[];for(let x=0;x<U;x++)for(let U=0;U<L;U++){const p={slope:mL.Vector2.Zero(),facet1:new mL.Vector4(0,0,0,0),facet2:new mL.Vector4(0,0,0,0)};this._heightQuads[x*L+U]=p}return this}_computeHeightQuads(){const L=this.getVerticesData(a.h.PositionKind);if(!L)return this;const U=mL.TmpVectors.YU[3],x=mL.TmpVectors.YU[2],p=mL.TmpVectors.YU[1],G=mL.TmpVectors.YU[0],F=mL.TmpVectors.YU[4],o=mL.TmpVectors.YU[5],A=mL.TmpVectors.YU[6],r=mL.TmpVectors.YU[7],h=mL.TmpVectors.YU[8];let b=0,E=0,Y=0,S=0,V=0,H=0,Q=0;const q=this._subdivisionsX,f=this._subdivisionsY;for(let a=0;a<f;a++)for(let f=0;f<q;f++){b=3*f,E=a*(q+1)*3,Y=(a+1)*(q+1)*3,U.x=L[E+b],U.y=L[E+b+1],U.z=L[E+b+2],x.x=L[E+b+3],x.y=L[E+b+4],x.z=L[E+b+5],p.x=L[Y+b],p.y=L[Y+b+1],p.z=L[Y+b+2],G.x=L[Y+b+3],G.y=L[Y+b+4],G.z=L[Y+b+5],S=(G.z-U.z)/(G.x-U.x),V=U.z-S*U.x,x.subtractToRef(U,F),p.subtractToRef(U,o),G.subtractToRef(U,A),mL.YU.CrossToRef(A,o,r),mL.YU.CrossToRef(F,A,h),r.normalize(),h.normalize(),H=-(r.x*U.x+r.y*U.y+r.z*U.z),Q=-(h.x*x.x+h.y*x.y+h.z*x.z);const v=this._heightQuads[a*q+f];v.slope.da(S,V),v.facet1.da(r.x,r.y,r.z,H),v.facet2.da(h.x,h.y,h.z,Q)}return this}serialize(L){super.serialize(L),L.subdivisionsX=this._subdivisionsX,L.subdivisionsY=this._subdivisionsY,L.minX=this._minX,L.maxX=this._maxX,L.Qa=this._minZ,L.maxZ=this._maxZ,L.width=this._width,L.height=this._height}static Parse(L,U){const x=new o(L.name,U);return x._subdivisionsX=L.subdivisionsX||1,x._subdivisionsY=L.subdivisionsY||1,x._minX=L.minX,x._maxX=L.maxX,x._minZ=L.Qa,x._maxZ=L.maxZ,x._width=L.width,x._height=L.height,x}}var A=x(12382),r=x(12440),h=x(12598),b=x(12646);function E(L){const U=[],x=[],p=[],G=[];let a,o;const A=L.width||L.size||1,r=L.height||L.size||1,h=0|(L.subdivisionsX||L.subdivisions||1),E=0|(L.subdivisionsY||L.subdivisions||1);for(a=0;a<=E;a++)for(o=0;o<=h;o++){const L=new mL.YU(o*A/h-A/2,0,(E-a)*r/E-r/2),U=new mL.YU(0,1,0);x.push(L.x,L.y,L.z),p.push(U.x,U.y,U.z),G.push(o/h,b.b?a/E:1-a/E)}for(a=0;a<E;a++)for(o=0;o<h;o++)U.push(o+1+(a+1)*(h+1)),U.push(o+1+a*(h+1)),U.push(o+a*(h+1)),U.push(o+(a+1)*(h+1)),U.push(o+1+(a+1)*(h+1)),U.push(o+a*(h+1));const Y=new F.b;return Y.indices=U,Y.KL=x,Y.lL=p,Y.XL=G,Y}function Y(L){const U=void 0!==L.xmin&&null!==L.xmin?L.xmin:-1,x=void 0!==L.zmin&&null!==L.zmin?L.zmin:-1,p=void 0!==L.xmax&&null!==L.xmax?L.xmax:1,G=void 0!==L.zmax&&null!==L.zmax?L.zmax:1,a=L.subdivisions||{w:1,h:1},o=L.precision||{w:1,h:1},A=[],r=[],h=[],b=[];let E,Y,S,V;a.h=a.h<1?1:a.h,a.w=a.w<1?1:a.w,o.w=o.w<1?1:o.w,o.h=o.h<1?1:o.h;const H=(p-U)/a.w,Q=(G-x)/a.h;function q(L,U,x,p){const G=r.length/3,F=o.w+1;for(E=0;E<o.h;E++)for(Y=0;Y<o.w;Y++){const L=[G+Y+E*F,G+(Y+1)+E*F,G+(Y+1)+(E+1)*F,G+Y+(E+1)*F];A.push(L[1]),A.push(L[2]),A.push(L[3]),A.push(L[0]),A.push(L[1]),A.push(L[3])}const a=mL.YU.Zero(),S=new mL.YU(0,1,0);for(E=0;E<=o.h;E++)for(a.z=E*(p-U)/o.h+U,Y=0;Y<=o.w;Y++)a.x=Y*(x-L)/o.w+L,a.y=0,r.push(a.x,a.y,a.z),h.push(S.x,S.y,S.z),b.push(Y/o.w,E/o.h)}for(S=0;S<a.h;S++)for(V=0;V<a.w;V++)q(U+V*H,x+S*Q,U+(V+1)*H,x+(S+1)*Q);const f=new F.b;return f.indices=A,f.KL=r,f.lL=h,f.XL=b,f}function S(L){const U=[],x=[],G=[],a=[];let o,A;const r=L.colorFilter||new p.QU(.3,.59,.11),b=L.alphaFilter||0;let E=!1;if(L.minHeight>L.maxHeight){E=!0;const U=L.maxHeight;L.maxHeight=L.minHeight,L.minHeight=U}for(o=0;o<=L.subdivisions;o++)for(A=0;A<=L.subdivisions;A++){const U=new mL.YU(A*L.width/L.subdivisions-L.width/2,0,(L.subdivisions-o)*L.height/L.subdivisions-L.height/2),p=4*(((U.x+L.width/2)/L.width*(L.bufferWidth-1)|0)+((1-(U.z+L.height/2)/L.height)*(L.bufferHeight-1)|0)*L.bufferWidth);let F=L.buffer[p]/255,Y=L.buffer[p+1]/255,S=L.buffer[p+2]/255;const V=L.buffer[p+3]/255;E&&(F=1-F,Y=1-Y,S=1-S);const H=F*r.r+Y*r.g+S*r.b;U.y=V>=b?L.minHeight+(L.maxHeight-L.minHeight)*H:L.minHeight-h.c,L.heightBuffer&&(L.heightBuffer[o*(L.subdivisions+1)+A]=U.y),x.push(U.x,U.y,U.z),G.push(0,0,0),a.push(A/L.subdivisions,1-o/L.subdivisions)}for(o=0;o<L.subdivisions;o++)for(A=0;A<L.subdivisions;A++){const mL=A+1+(o+1)*(L.subdivisions+1),p=A+1+o*(L.subdivisions+1),G=A+o*(L.subdivisions+1),F=A+(o+1)*(L.subdivisions+1),a=x[3*mL+1]>=L.minHeight,r=x[3*p+1]>=L.minHeight,h=x[3*G+1]>=L.minHeight;a&&r&&h&&(U.push(mL),U.push(p),U.push(G));x[3*F+1]>=L.minHeight&&a&&h&&(U.push(F),U.push(mL),U.push(G))}F.b.ComputeNormals(x,U,G);const Y=new F.b;return Y.indices=U,Y.KL=x,Y.lL=G,Y.XL=a,Y}function V(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=new o(L,arguments.length>2?arguments[2]:void 0);x._setReady(!1),x._subdivisionsX=U.subdivisionsX||U.subdivisions||1,x._subdivisionsY=U.subdivisionsY||U.subdivisions||1,x._width=U.width||1,x._height=U.height||1,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ;return E(U).yL(x,U.updatable),x._setReady(!0),x}function H(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new G.e(L,x);return Y(U).yL(mL,U.updatable),mL}function Q(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=x.width||10,F=x.height||10,a=x.subdivisions||1,h=x.minHeight||0,b=x.maxHeight||1,E=x.colorFilter||new p.QU(.3,.59,.11),Y=x.alphaFilter||0,V=x.updatable,H=x.onReady;mL=mL||r.c.LastCreatedScene;const Q=new o(L,mL);let q;Q._subdivisionsX=a,Q._subdivisionsY=a,Q._width=G,Q._height=F,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ,Q._setReady(!1),x.passHeightBufferInCallback&&(q=new Float32Array((a+1)*(a+1)));const f=(L,U,x)=>{S({width:G,height:F,subdivisions:a,minHeight:h,maxHeight:b,colorFilter:E,buffer:L,bufferWidth:U,bufferHeight:x,alphaFilter:Y,heightBuffer:q}).yL(Q,V),H&&H(Q,q),Q._setReady(!0)};if("string"===typeof U){const L=L=>{var U;const x=L.width,p=L.height;if(mL.A)return;const G=null===(U=mL)||void 0===U?void 0:U.getEngine().resizeImageBitmap(L,x,p);f(G,x,p)};A.Tools.LoadImage(U,L,x.onError?x.onError:()=>{},mL.offlineProvider)}else f(U.data,U.width,U.height);return Q}F.b.CreateGround=E,F.b.CreateTiledGround=Y,F.b.CreateGroundFromHeightMap=S,G.e.CreateGround=(L,U,x,mL,p,G)=>V(L,{width:U,height:x,subdivisions:mL,updatable:G},p),G.e.CreateTiledGround=(L,U,x,mL,p,G,F,a,o)=>H(L,{xmin:U,zmin:x,xmax:mL,zmax:p,subdivisions:G,precision:F,updatable:o},a),G.e.CreateGroundFromHeightMap=(L,U,x,mL,p,G,F,a,o,A,r)=>Q(L,U,{width:x,height:mL,subdivisions:p,minHeight:G,maxHeight:F,updatable:o,onReady:A,alphaFilter:r},a)},14528:(L,U,x)=>{"use strict";x.d(U,{c:()=>E,e:()=>h,f:()=>b});var mL=x(12589),p=x(13046),G=x(13031),F=x(13154),a=x(12666),o=x(12406);function A(L){const U=[],x=[],mL=L.lines,p=L.iL,F=[];let a=0;for(let G=0;G<mL.length;G++){const L=mL[G];for(let mL=0;mL<L.length;mL++){const{x:o,y:A,z:r}=L[mL];if(x.push(o,A,r),p){const L=p[G],{r:U,g:x,b:a,a:o}=L[mL];F.push(U,x,a,o)}mL>0&&(U.push(a-1),U.push(a)),a++}}const o=new G.b;return o.indices=U,o.KL=x,p&&(o.iL=F),o}function r(L){const U=L.dashSize||3,x=L.gapSize||1,p=L.dashNb||200,F=L.points,a=[],o=[],A=mL.YU.Zero();let r=0,h=0,b=0,E=0,Y=0,S=0,V=0;for(V=0;V<F.length-1;V++)F[V+1].subtractToRef(F[V],A),r+=A.length();for(b=r/p,E=U*b/(U+x),V=0;V<F.length-1;V++){F[V+1].subtractToRef(F[V],A),h=Math.floor(A.length()/b),A.normalize();for(let L=0;L<h;L++)Y=b*L,a.push(F[V].x+Y*A.x,F[V].y+Y*A.y,F[V].z+Y*A.z),a.push(F[V].x+(Y+E)*A.x,F[V].y+(Y+E)*A.y,F[V].z+(Y+E)*A.z),o.push(S,S+1),S+=2}const H=new G.b;return H.KL=a,H.indices=o,H}function h(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=U.instance,p=U.lines,G=U.iL;if(mL){const L=mL.getVerticesData(a.h.PositionKind);let U,x;G&&(U=mL.getVerticesData(a.h.ColorKind));let F=0,o=0;for(let mL=0;mL<p.length;mL++){const a=p[mL];for(let p=0;p<a.length;p++)L[F]=a[p].x,L[F+1]=a[p].y,L[F+2]=a[p].z,G&&U&&(x=G[mL],U[o]=x[p].r,U[o+1]=x[p].g,U[o+2]=x[p].b,U[o+3]=x[p].a,o+=4),F+=3}return mL.updateVerticesData(a.h.PositionKind,L,!1,!1),G&&U&&mL.updateVerticesData(a.h.ColorKind,U,!1,!1),mL.refreshBoundingInfo(),mL}const o=!!G,r=new F.c(L,x,null,void 0,void 0,o,U.useVertexAlpha,U.material);return A(U).yL(r,U.updatable),r}function b(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=U.iL?[U.iL]:null;return h(L,{lines:[U.points],updatable:U.updatable,instance:U.instance,iL:mL,useVertexAlpha:U.useVertexAlpha,material:U.material},x)}function E(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=U.points,a=U.instance,A=U.gapSize||1,h=U.dashSize||3;if(a){const L=L=>{const U=mL.YU.Zero(),x=L.length/6;let p=0,F=0,o=0,A=0,r=0,h=0,b=0,E=0;for(b=0;b<G.length-1;b++)G[b+1].subtractToRef(G[b],U),p+=U.length();o=p/x;const Y=a._creationDataStorage.dashSize;for(A=Y*o/(Y+a._creationDataStorage.gapSize),b=0;b<G.length-1;b++)for(G[b+1].subtractToRef(G[b],U),F=Math.floor(U.length()/o),U.normalize(),E=0;E<F&&h<L.length;)r=o*E,L[h]=G[b].x+r*U.x,L[h+1]=G[b].y+r*U.y,L[h+2]=G[b].z+r*U.z,L[h+3]=G[b].x+(r+A)*U.x,L[h+4]=G[b].y+(r+A)*U.y,L[h+5]=G[b].z+(r+A)*U.z,h+=6,E++;for(;h<L.length;)L[h]=G[b].x,L[h+1]=G[b].y,L[h+2]=G[b].z,h+=3};return(U.dashNb||U.dashSize||U.gapSize||U.useVertexAlpha||U.material)&&o.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(L,!1),a}const b=new F.c(L,x,null,void 0,void 0,void 0,U.useVertexAlpha,U.material);return r(U).yL(b,U.updatable),b._creationDataStorage=new p.f,b._creationDataStorage.dashSize=h,b._creationDataStorage.gapSize=A,b}G.b.CreateLineSystem=A,G.b.CreateDashedLines=r,p.e.KA=function(L,U){return b(L,{points:U,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},p.e.CreateDashedLines=function(L,U,x,mL,p){return E(L,{points:U,dashSize:x,gapSize:mL,dashNb:p,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13921:(L,U,x)=>{"use strict";x.d(U,{e:()=>a,h:()=>o});var mL=x(13046),p=x(13031),G=x(12646);function F(L){const U=[],x=[],mL=[],F=[],a=void 0!==L.width?L.width:void 0!==L.size?L.size:1,o=void 0!==L.height?L.height:void 0!==L.size?L.size:1,A=0===L.sideOrientation?0:L.sideOrientation||p.b.DEFAULTSIDE,r=a/2,h=o/2;x.push(-r,-h,0),mL.push(0,0,-1),F.push(0,G.b?1:0),x.push(r,-h,0),mL.push(0,0,-1),F.push(1,G.b?1:0),x.push(r,h,0),mL.push(0,0,-1),F.push(1,G.b?0:1),x.push(-r,h,0),mL.push(0,0,-1),F.push(0,G.b?0:1),U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),p.b._ComputeSides(A,x,U,mL,F,L.frontUVs,L.backUVs);const b=new p.b;return b.indices=U,b.KL=x,b.lL=mL,b.XL=F,b}function a(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new mL.e(L,x);U.sideOrientation=mL.e._GetDefaultSideOrientation(U.sideOrientation),p._originalBuilderSideOrientation=U.sideOrientation;return F(U).yL(p,U.updatable),U.sourcePlane&&(p.translate(U.sourcePlane.normal,-U.sourcePlane.d),p.setDirection(U.sourcePlane.normal.scale(-1))),p}const o={XA:a};p.b.XA=F,mL.e.XA=(L,U,x,mL,p)=>a(L,{size:U,width:U,height:U,sideOrientation:p,updatable:mL},x)},14013:(L,U,x)=>{"use strict";x.d(U,{e:()=>o});var mL=x(12589),p=x(13046),G=x(13031),F=x(12646);function a(L){const U=0|(L.segments||32),x=L.diameterX||L.diameter||1,p=L.diameterY||L.diameter||1,a=L.diameterZ||L.diameter||1,o=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,A=L.slice&&L.slice<=0?1:L.slice||1,r=0===L.sideOrientation?0:L.sideOrientation||G.b.DEFAULTSIDE,h=!!L.dedupTopBottomIndices,b=new mL.YU(x/2,p/2,a/2),E=2+U,Y=2*E,S=[],V=[],H=[],Q=[];for(let G=0;G<=E;G++){const L=G/E,U=L*Math.PI*A;for(let x=0;x<=Y;x++){const p=x/Y,G=p*Math.PI*2*o,a=mL.Matrix.RotationZ(-U),A=mL.Matrix.RotationY(G),r=mL.YU.TransformCoordinates(mL.YU.Up(),a),h=mL.YU.TransformCoordinates(r,A),E=h.multiply(b),S=h.divide(b).normalize();V.push(E.x,E.y,E.z),H.push(S.x,S.y,S.z),Q.push(p,F.b?1-L:L)}if(G>0){const L=V.length/3;for(let U=L-2*(Y+1);U+Y+2<L;U++)h?(G>1&&(S.push(U),S.push(U+1),S.push(U+Y+1)),(G<E||A<1)&&(S.push(U+Y+1),S.push(U+1),S.push(U+Y+2))):(S.push(U),S.push(U+1),S.push(U+Y+1),S.push(U+Y+1),S.push(U+1),S.push(U+Y+2))}}G.b._ComputeSides(r,V,S,H,Q,L.frontUVs,L.backUVs);const q=new G.b;return q.indices=S,q.KL=V,q.lL=H,q.XL=Q,q}function o(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return a(U).yL(mL,U.updatable),mL}G.b.CreateSphere=a,p.e.CreateSphere=(L,U,x,mL,p,G)=>o(L,{segments:U,diameterX:x,diameterY:x,diameterZ:x,sideOrientation:G,updatable:p},mL)},14817:(L,U,x)=>{"use strict";x.d(U,{e:()=>a});var mL=x(13179),p=x(14328),G=x(13195),F=x(13031);class a{static get Configuration(){return{get decoder(){return p.e.DefaultConfiguration},set decoder(L){p.e.DefaultConfiguration=L}}}static set Configuration(L){p.e.DefaultConfiguration=L.decoder}static get DecoderAvailable(){return(0,mL.i)(p.e.DefaultConfiguration)}static get Default(){return a._Default??(a._Default=new a),a._Default}static ResetDefault(L){a._Default&&(L||a._Default.dispose(),a._Default=null)}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DefaultNumWorkers;const U="number"===typeof L?{...p.e.DefaultConfiguration,numWorkers:L}:{...p.e.DefaultConfiguration,...L};this._decoder=new p.e(U)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(L,U,x){return this._decoder.decodeMeshToMeshDataAsync(L,U,x)}async decodeMeshToGeometryAsync(L,U,x,mL){return await this._decoder.decodeMeshToGeometryAsync(L,U,x,mL)}async _decodeMeshToGeometryForGltfAsync(L,U,x,mL,p,G){return await this._decoder._decodeMeshToGeometryForGltfAsync(L,U,x,mL,p,G)}async decodeMeshAsync(L,U){const x=await this._decoder.decodeMeshToMeshDataAsync(L,U),mL=new F.b;x.indices&&(mL.indices=x.indices);for(const p of x.attributes){const L=G.e.GetFloatData(p.data,p.size,G.e.GetDataType(p.data),p.byteOffset,p.byteStride,p.normalized,x.totalVertices);mL.set(L,p.kind)}return mL}}a.DefaultNumWorkers=(0,mL.f)(),a._Default=null},14328:(L,U,x)=>{"use strict";x.d(U,{e:()=>A});var mL=x(13179),p=x(12382),G=x(13061),F=x(13195),a=x(12406),o=x(13191);class A extends mL.b{static get DefaultAvailable(){return(0,mL.i)(A.DefaultConfiguration)}static get Default(){return A._Default??(A._Default=new A),A._Default}static ResetDefault(L){A._Default&&(L||A._Default.dispose(),A._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(L,U){return{module:await(U||DracoDecoderModule)({wasmBinary:L})}}_getWorkerContent(){return`${o.c}(${o.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.DefaultConfiguration)}decodeMeshToMeshDataAsync(L,U,x){const mL=L instanceof ArrayBuffer?new Int8Array(L):new Int8Array(L.buffer,L.byteOffset,L.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async L=>await new Promise(((p,G)=>{L.push(((L,F)=>{let o=null;const A=[],r=U=>{L.removeEventListener("error",r),L.removeEventListener("message",h),G(U),F()},h=U=>{const mL=U.data;switch(mL.id){case"indices":o=mL.data;break;case"attribute":A.push({kind:mL.kind,data:mL.data,size:mL.size,byteOffset:mL.byteOffset,byteStride:mL.byteStride,normalized:(G=mL.kind,b=mL.normalized,x&&void 0!==x[G]?(b!==x[G]&&a.c.Warn(`Normalized flag from Draco data (${b}) does not match normalized flag from glTF accessor (${x[G]}). Using flag from glTF accessor.`),x[G]):b)});break;case"decodeMeshDone":L.removeEventListener("error",r),L.removeEventListener("message",h),p({indices:o,attributes:A,totalVertices:mL.totalVertices}),F()}var G,b};L.addEventListener("error",r),L.addEventListener("message",h);const b=mL.slice();L.postMessage({id:"decodeMesh",dataView:b,attributes:U},[b.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((L=>{let x=null;const p=[],G=(0,o.c)(L.module,mL,U,(L=>{x=L}),((L,U,x,mL,G,F)=>{p.push({kind:L,data:U,size:x,byteOffset:mL,byteStride:G,normalized:F})}));return{indices:x,attributes:p,totalVertices:G}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(L,U,x,mL){const p=await this.decodeMeshToMeshDataAsync(x,mL),a=new G.b(L,U);p.indices&&a.setIndices(p.indices);for(const G of p.attributes)a.setVerticesBuffer(new F.e(U.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),p.totalVertices);return a}async _decodeMeshToGeometryForGltfAsync(L,U,x,mL,p,a){const o=await this.decodeMeshToMeshDataAsync(x,mL,p),A=new G.b(L,U);a&&(A._boundingInfo=a,A.useBoundingInfoFromGeometry=!0),o.indices&&A.setIndices(o.indices);for(const G of o.attributes)A.setVerticesBuffer(new F.e(U.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),o.totalVertices);return A}}A.DefaultConfiguration={wasmUrl:`${p.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${p.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${p.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},A._Default=null},14519:(L,U,x)=>{"use strict";x.d(U,{e:()=>aL});var mL=x(12589),p=x(13046),G=x(12666),F=x(13031),a=x(12646);function o(L){let U=L.pathArray;const x=L.closeArray||!1,mL=L.closePath||!1,p=L.invertUV||!1,o=Math.floor(U[0].length/2);let A=L.offset||o;A=A>o?o:Math.floor(A);const r=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,h=L.XL,b=L.iL,E=[],Y=[],S=[],V=[],H=[],Q=[],q=[],f=[];let v;const D=[],P=[];let d,K,l;if(U.length<2){const L=[],x=[];for(K=0;K<U[0].length-A;K++)L.push(U[0][K]),x.push(U[0][K+A]);U=[L,x]}let i=0;const X=mL?1:0,t=x?1:0;let y,n,N,e,u,Z;for(v=U[0].length,d=0;d<U.length+t;d++){for(q[d]=0,H[d]=[0],y=d===U.length?U[0]:U[d],n=y.length,v=v<n?v:n,l=0;l<n;)E.push(y[l].x,y[l].y,y[l].z),l>0&&(N=y[l].SU(y[l-1]).length(),e=N+q[d],H[d].push(e),q[d]=e),l++;mL&&(l--,E.push(y[0].x,y[0].y,y[0].z),N=y[l].SU(y[0]).length(),e=N+q[d],H[d].push(e),q[d]=e),D[d]=n+X,P[d]=i,i+=n+X}let g,z,M=null,J=null;for(K=0;K<v+X;K++)for(f[K]=0,Q[K]=[0],d=0;d<U.length-1+t;d++)u=U[d],Z=d===U.length-1?U[0]:U[d+1],K===v?(M=u[0],J=Z[0]):(M=u[K],J=Z[K]),N=J.SU(M).length(),e=N+f[K],Q[K].push(e),f[K]=e;if(h)for(d=0;d<h.length;d++)V.push(h[d].x,a.b?1-h[d].y:h[d].y);else for(d=0;d<U.length+t;d++)for(K=0;K<v+X;K++)g=0!=q[d]?H[d][K]/q[d]:0,z=0!=f[K]?Q[K][d]/f[K]:0,p?V.push(z,g):V.push(g,a.b?1-z:z);d=0;let j=0,R=D[d]-1,c=D[d+1]-1,W=R<c?R:c,I=P[1]-P[0];const w=D.length-1;for(;j<=W&&d<w;)Y.push(j,j+I,j+1),Y.push(j+I+1,j+1,j+I),j+=1,j===W&&(d++,I=P[d+1]-P[d],R=D[d]-1,c=D[d+1]-1,j=P[d],W=R<c?R+j:c+j);if(F.b.ComputeNormals(E,Y,S),mL){let L=0,x=0;for(d=0;d<U.length;d++){L=3*P[d],x=d+1<U.length?3*(P[d+1]-1):S.length-3,S[L]=.5*(S[L]+S[x]),S[L+1]=.5*(S[L+1]+S[x+1]),S[L+2]=.5*(S[L+2]+S[x+2]);const mL=Math.sqrt(S[L]*S[L]+S[L+1]*S[L+1]+S[L+2]*S[L+2]);S[L]/=mL,S[L+1]/=mL,S[L+2]/=mL,S[x]=S[L],S[x+1]=S[L+1],S[x+2]=S[L+2]}}if(x){let L=3*P[0],x=3*P[U.length];for(K=0;K<v+X;K++){S[L]=.5*(S[L]+S[x]),S[L+1]=.5*(S[L+1]+S[x+1]),S[L+2]=.5*(S[L+2]+S[x+2]);const U=Math.sqrt(S[L]*S[L]+S[L+1]*S[L+1]+S[L+2]*S[L+2]);S[L]/=U,S[L+1]/=U,S[L+2]/=U,S[x]=S[L],S[x+1]=S[L+1],S[x+2]=S[L+2],L+=3,x+=3}}F.b._ComputeSides(r,E,Y,S,V,L.frontUVs,L.backUVs);let B=null;if(b){B=new Float32Array(4*b.length);for(let L=0;L<b.length;L++)B[4*L]=b[L].r,B[4*L+1]=b[L].g,B[4*L+2]=b[L].b,B[4*L+3]=b[L].a}const s=new F.b,C=new Float32Array(E),k=new Float32Array(S),T=new Float32Array(V);return s.indices=Y,s.KL=C,s.lL=k,s.XL=T,B&&s.set(B,G.h.ColorKind),mL&&(s._idx=P),s}function A(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=U.pathArray,r=U.closeArray,h=U.closePath,b=p.e._GetDefaultSideOrientation(U.sideOrientation),E=U.instance,Y=U.updatable;if(E){const L=mL.TmpVectors.YU[0].la(Number.MAX_VALUE),x=mL.TmpVectors.YU[1].la(-Number.MAX_VALUE),o=U=>{let mL=A[0].length;const G=E;let F=0;const a=G._originalBuilderSideOrientation===p.e.DOUBLESIDE?2:1;for(let p=1;p<=a;++p)for(let a=0;a<A.length;++a){const p=A[a],o=p.length;mL=mL<o?mL:o;for(let G=0;G<mL;++G){const mL=p[G];U[F]=mL.x,U[F+1]=mL.y,U[F+2]=mL.z,L.minimizeInPlaceFromFloats(mL.x,mL.y,mL.z),x.maximizeInPlaceFromFloats(mL.x,mL.y,mL.z),F+=3}if(G._creationDataStorage&&G._creationDataStorage.closePath){const L=p[0];U[F]=L.x,U[F+1]=L.y,U[F+2]=L.z,F+=3}}},r=E.getVerticesData(G.h.PositionKind);if(o(r),E.hasBoundingInfo?E.getBoundingInfo().reConstruct(L,x,E._worldMatrix):E.buildBoundingInfo(L,x,E._worldMatrix),E.updateVerticesData(G.h.PositionKind,r,!1,!1),U.iL){const L=E.getVerticesData(G.h.ColorKind);for(let x=0,mL=0;x<U.iL.length;x++,mL+=4){const p=U.iL[x];L[mL]=p.r,L[mL+1]=p.g,L[mL+2]=p.b,L[mL+3]=p.a}E.updateVerticesData(G.h.ColorKind,L,!1,!1)}if(U.XL){const L=E.getVerticesData(G.h.UVKind);for(let x=0;x<U.XL.length;x++)L[2*x]=U.XL[x].x,L[2*x+1]=a.b?1-U.XL[x].y:U.XL[x].y;E.updateVerticesData(G.h.UVKind,L,!1,!1)}if(!E.areNormalsFrozen||E.isFacetDataEnabled){const L=E.Da(),U=E.getVerticesData(G.h.NormalKind),x=E.isFacetDataEnabled?E.getFacetDataParameters():null;if(F.b.ComputeNormals(r,L,U,x),E._creationDataStorage&&E._creationDataStorage.closePath){let L=0,x=0;for(let mL=0;mL<A.length;mL++)L=3*E._creationDataStorage.idx[mL],x=mL+1<A.length?3*(E._creationDataStorage.idx[mL+1]-1):U.length-3,U[L]=.5*(U[L]+U[x]),U[L+1]=.5*(U[L+1]+U[x+1]),U[L+2]=.5*(U[L+2]+U[x+2]),U[x]=U[L],U[x+1]=U[L+1],U[x+2]=U[L+2]}E.areNormalsFrozen||E.updateVerticesData(G.h.NormalKind,U,!1,!1)}return E}{const mL=new p.e(L,x);mL._originalBuilderSideOrientation=b,mL._creationDataStorage=new p.f;const G=o(U);return h&&(mL._creationDataStorage.idx=G._idx),mL._creationDataStorage.closePath=h,mL._creationDataStorage.closeArray=r,G.yL(mL,Y),mL}}F.b.CreateRibbon=o,p.e.CreateRibbon=function(L,U){return A(L,{pathArray:U,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var r=x(14020),h=x(13867),b=x(12637);function E(L){const U=L.pattern||p.e.NO_FLIP,x=L.tileWidth||L.tileSize||1,mL=L.tileHeight||L.tileSize||1,G=L.alignHorizontal||0,a=L.alignVertical||0,o=L.width||L.size||1,A=Math.floor(o/x);let r=o-A*x;const h=L.height||L.size||1,b=Math.floor(h/mL);let E=h-b*mL;const Y=x*A/2,S=mL*b/2;let V=0,H=0,Q=0,q=0,f=0,v=0;if(r>0||E>0){switch(Q=-Y,q=-S,f=Y,v=S,G){case p.e.CENTER:r/=2,Q-=r,f+=r;break;case p.e.LEFT:f+=r,V=-r/2;break;case p.e.RIGHT:Q-=r,V=r/2}switch(a){case p.e.CENTER:E/=2,q-=E,v+=E;break;case p.e.BOTTOM:v+=E,H=-E/2;break;case p.e.TOP:q-=E,H=E/2}}const D=[],P=[],d=[];d[0]=[0,0,1,0,1,1,0,1],d[1]=[0,0,1,0,1,1,0,1],U!==p.e.ROTATE_TILE&&U!==p.e.ROTATE_ROW||(d[1]=[1,1,0,1,0,0,1,0]),U!==p.e.FLIP_TILE&&U!==p.e.FLIP_ROW||(d[1]=[1,0,0,0,0,1,1,1]),U!==p.e.FLIP_N_ROTATE_TILE&&U!==p.e.FLIP_N_ROTATE_ROW||(d[1]=[0,1,1,1,1,0,0,0]);let K=[];const l=[],i=[];let X=0;for(let F=0;F<b;F++)for(let L=0;L<A;L++)D.push(L*x-Y+V,F*mL-S+H,0),D.push((L+1)*x-Y+V,F*mL-S+H,0),D.push((L+1)*x-Y+V,(F+1)*mL-S+H,0),D.push(L*x-Y+V,(F+1)*mL-S+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),K=U===p.e.FLIP_TILE||U===p.e.ROTATE_TILE||U===p.e.FLIP_N_ROTATE_TILE?K.concat(d[(L%2+F%2)%2]):U===p.e.FLIP_ROW||U===p.e.ROTATE_ROW||U===p.e.FLIP_N_ROTATE_ROW?K.concat(d[F%2]):K.concat(d[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),X+=4;if(r>0||E>0){const L=E>0&&(a===p.e.CENTER||a===p.e.TOP),F=E>0&&(a===p.e.CENTER||a===p.e.BOTTOM),o=r>0&&(G===p.e.CENTER||G===p.e.RIGHT),h=r>0&&(G===p.e.CENTER||G===p.e.LEFT);let d,t,y,n,N=[];if(L&&o&&(D.push(Q+V,q+H,0),D.push(-Y+V,q+H,0),D.push(-Y+V,q+E+H,0),D.push(Q+V,q+E+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,d=1-r/x,t=1-E/mL,y=1,n=1,N=[d,t,y,t,y,n,d,n],U===p.e.ROTATE_ROW&&(N=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),U===p.e.FLIP_ROW&&(N=[1-d,t,1-y,t,1-y,n,1-d,n]),U===p.e.FLIP_N_ROTATE_ROW&&(N=[d,1-t,y,1-t,y,1-n,d,1-n]),K=K.concat(N),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&h&&(D.push(Y+V,q+H,0),D.push(f+V,q+H,0),D.push(f+V,q+E+H,0),D.push(Y+V,q+E+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,d=0,t=1-E/mL,y=r/x,n=1,N=[d,t,y,t,y,n,d,n],(U===p.e.ROTATE_ROW||U===p.e.ROTATE_TILE&&A%2===0)&&(N=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),(U===p.e.FLIP_ROW||U===p.e.FLIP_TILE&&A%2===0)&&(N=[1-d,t,1-y,t,1-y,n,1-d,n]),(U===p.e.FLIP_N_ROTATE_ROW||U===p.e.FLIP_N_ROTATE_TILE&&A%2===0)&&(N=[d,1-t,y,1-t,y,1-n,d,1-n]),K=K.concat(N),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&o&&(D.push(Q+V,S+H,0),D.push(-Y+V,S+H,0),D.push(-Y+V,v+H,0),D.push(Q+V,v+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,d=1-r/x,t=0,y=1,n=E/mL,N=[d,t,y,t,y,n,d,n],(U===p.e.ROTATE_ROW&&b%2===1||U===p.e.ROTATE_TILE&&b%1===0)&&(N=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),(U===p.e.FLIP_ROW&&b%2===1||U===p.e.FLIP_TILE&&b%2===0)&&(N=[1-d,t,1-y,t,1-y,n,1-d,n]),(U===p.e.FLIP_N_ROTATE_ROW&&b%2===1||U===p.e.FLIP_N_ROTATE_TILE&&b%2===0)&&(N=[d,1-t,y,1-t,y,1-n,d,1-n]),K=K.concat(N),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&h&&(D.push(Y+V,S+H,0),D.push(f+V,S+H,0),D.push(f+V,v+H,0),D.push(Y+V,v+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,d=0,t=0,y=r/x,n=E/mL,N=[d,t,y,t,y,n,d,n],(U===p.e.ROTATE_ROW&&b%2===1||U===p.e.ROTATE_TILE&&(b+A)%2===1)&&(N=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),(U===p.e.FLIP_ROW&&b%2===1||U===p.e.FLIP_TILE&&(b+A)%2===1)&&(N=[1-d,t,1-y,t,1-y,n,1-d,n]),(U===p.e.FLIP_N_ROTATE_ROW&&b%2===1||U===p.e.FLIP_N_ROTATE_TILE&&(b+A)%2===1)&&(N=[d,1-t,y,1-t,y,1-n,d,1-n]),K=K.concat(N),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L){const L=[];d=0,t=1-E/mL,y=1,n=1,L[0]=[d,t,y,t,y,n,d,n],L[1]=[d,t,y,t,y,n,d,n],U!==p.e.ROTATE_TILE&&U!==p.e.ROTATE_ROW||(L[1]=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),U!==p.e.FLIP_TILE&&U!==p.e.FLIP_ROW||(L[1]=[1-d,t,1-y,t,1-y,n,1-d,n]),U!==p.e.FLIP_N_ROTATE_TILE&&U!==p.e.FLIP_N_ROTATE_ROW||(L[1]=[d,1-t,y,1-t,y,1-n,d,1-n]);for(let mL=0;mL<A;mL++)D.push(mL*x-Y+V,q+H,0),D.push((mL+1)*x-Y+V,q+H,0),D.push((mL+1)*x-Y+V,q+E+H,0),D.push(mL*x-Y+V,q+E+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,K=U===p.e.FLIP_TILE||U===p.e.ROTATE_TILE||U===p.e.FLIP_N_ROTATE_TILE?K.concat(L[(mL+1)%2]):U===p.e.FLIP_ROW||U===p.e.ROTATE_ROW||U===p.e.FLIP_N_ROTATE_ROW?K.concat(L[1]):K.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const L=[];d=0,t=0,y=1,n=E/mL,L[0]=[d,t,y,t,y,n,d,n],L[1]=[d,t,y,t,y,n,d,n],U!==p.e.ROTATE_TILE&&U!==p.e.ROTATE_ROW||(L[1]=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),U!==p.e.FLIP_TILE&&U!==p.e.FLIP_ROW||(L[1]=[1-d,t,1-y,t,1-y,n,1-d,n]),U!==p.e.FLIP_N_ROTATE_TILE&&U!==p.e.FLIP_N_ROTATE_ROW||(L[1]=[d,1-t,y,1-t,y,1-n,d,1-n]);for(let mL=0;mL<A;mL++)D.push(mL*x-Y+V,v-E+H,0),D.push((mL+1)*x-Y+V,v-E+H,0),D.push((mL+1)*x-Y+V,v+H,0),D.push(mL*x-Y+V,v+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,K=U===p.e.FLIP_TILE||U===p.e.ROTATE_TILE||U===p.e.FLIP_N_ROTATE_TILE?K.concat(L[(mL+b)%2]):U===p.e.FLIP_ROW||U===p.e.ROTATE_ROW||U===p.e.FLIP_N_ROTATE_ROW?K.concat(L[b%2]):K.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(o){const L=[];d=1-r/x,t=0,y=1,n=1,L[0]=[d,t,y,t,y,n,d,n],L[1]=[d,t,y,t,y,n,d,n],U!==p.e.ROTATE_TILE&&U!==p.e.ROTATE_ROW||(L[1]=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),U!==p.e.FLIP_TILE&&U!==p.e.FLIP_ROW||(L[1]=[1-d,t,1-y,t,1-y,n,1-d,n]),U!==p.e.FLIP_N_ROTATE_TILE&&U!==p.e.FLIP_N_ROTATE_ROW||(L[1]=[d,1-t,y,1-t,y,1-n,d,1-n]);for(let x=0;x<b;x++)D.push(Q+V,x*mL-S+H,0),D.push(Q+r+V,x*mL-S+H,0),D.push(Q+r+V,(x+1)*mL-S+H,0),D.push(Q+V,(x+1)*mL-S+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,K=U===p.e.FLIP_TILE||U===p.e.ROTATE_TILE||U===p.e.FLIP_N_ROTATE_TILE?K.concat(L[(x+1)%2]):U===p.e.FLIP_ROW||U===p.e.ROTATE_ROW||U===p.e.FLIP_N_ROTATE_ROW?K.concat(L[x%2]):K.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const L=[];d=0,t=0,y=r/mL,n=1,L[0]=[d,t,y,t,y,n,d,n],L[1]=[d,t,y,t,y,n,d,n],U!==p.e.ROTATE_TILE&&U!==p.e.ROTATE_ROW||(L[1]=[1-d,1-t,1-y,1-t,1-y,1-n,1-d,1-n]),U!==p.e.FLIP_TILE&&U!==p.e.FLIP_ROW||(L[1]=[1-d,t,1-y,t,1-y,n,1-d,n]),U!==p.e.FLIP_N_ROTATE_TILE&&U!==p.e.FLIP_N_ROTATE_ROW||(L[1]=[d,1-t,y,1-t,y,1-n,d,1-n]);for(let x=0;x<b;x++)D.push(f-r+V,x*mL-S+H,0),D.push(f+V,x*mL-S+H,0),D.push(f+V,(x+1)*mL-S+H,0),D.push(f-r+V,(x+1)*mL-S+H,0),i.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,K=U===p.e.FLIP_TILE||U===p.e.ROTATE_TILE||U===p.e.FLIP_N_ROTATE_TILE?K.concat(L[(x+A)%2]):U===p.e.FLIP_ROW||U===p.e.ROTATE_ROW||U===p.e.FLIP_N_ROTATE_ROW?K.concat(L[x%2]):K.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const t=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE;F.b._ComputeSides(t,D,i,P,K,L.frontUVs,L.backUVs);const y=new F.b;y.indices=i,y.KL=D,y.lL=P,y.XL=K;const n=t===F.b.DOUBLESIDE?l.concat(l):l;return y.iL=n,y}function Y(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return E(U).yL(mL,U.updatable),mL}function S(L){const U=L.faceUV||new Array(6),x=L.faceColors,G=L.pattern||p.e.NO_FLIP,o=L.width||L.size||1,A=L.height||L.size||1,r=L.depth||L.size||1,h=L.tileWidth||L.tileSize||1,Y=L.tileHeight||L.tileSize||1,S=L.alignHorizontal||0,V=L.alignVertical||0,H=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE;for(let p=0;p<6;p++)void 0===U[p]&&(U[p]=new mL.Vector4(0,0,1,1)),x&&void 0===x[p]&&(x[p]=new b.ia(1,1,1,1));const Q=o/2,q=A/2,f=r/2,v=[];for(let mL=0;mL<2;mL++)v[mL]=E({pattern:G,tileWidth:h,tileHeight:Y,width:o,height:A,alignVertical:V,alignHorizontal:S,sideOrientation:H});for(let mL=2;mL<4;mL++)v[mL]=E({pattern:G,tileWidth:h,tileHeight:Y,width:r,height:A,alignVertical:V,alignHorizontal:S,sideOrientation:H});let D=V;V===p.e.BOTTOM?D=p.e.TOP:V===p.e.TOP&&(D=p.e.BOTTOM);for(let mL=4;mL<6;mL++)v[mL]=E({pattern:G,tileWidth:h,tileHeight:Y,width:o,height:r,alignVertical:D,alignHorizontal:S,sideOrientation:H});let P=[],d=[],K=[],l=[];const i=[],X=[],t=[],y=[];let n=0,N=0;for(let p=0;p<6;p++){const L=v[p].KL.length;X[p]=[],t[p]=[];for(let U=0;U<L/3;U++)X[p].push(new mL.YU(v[p].KL[3*U],v[p].KL[3*U+1],v[p].KL[3*U+2])),t[p].push(new mL.YU(v[p].lL[3*U],v[p].lL[3*U+1],v[p].lL[3*U+2]));n=v[p].XL.length,y[p]=[];for(let x=0;x<n;x+=2)y[p][x]=U[p].x+(U[p].z-U[p].x)*v[p].XL[x],y[p][x+1]=U[p].y+(U[p].w-U[p].y)*v[p].XL[x+1],a.b&&(y[p][x+1]=1-y[p][x+1]);if(K=K.concat(y[p]),l=l.concat(v[p].indices.map((L=>L+N))),N+=X[p].length,x)for(let U=0;U<4;U++)i.push(x[p].r,x[p].g,x[p].b,x[p].a)}const e=new mL.YU(0,0,f),u=mL.Matrix.RotationY(Math.PI);P=X[0].map((L=>mL.YU.TransformNormal(L,u).add(e))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[]),d=t[0].map((L=>mL.YU.TransformNormal(L,u))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[]),P=P.concat(X[1].map((L=>L.SU(e))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[])),d=d.concat(t[1].map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[]));const Z=new mL.YU(Q,0,0),g=mL.Matrix.RotationY(-Math.PI/2);P=P.concat(X[2].map((L=>mL.YU.TransformNormal(L,g).add(Z))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[])),d=d.concat(t[2].map((L=>mL.YU.TransformNormal(L,g))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[]));const z=mL.Matrix.RotationY(Math.PI/2);P=P.concat(X[3].map((L=>mL.YU.TransformNormal(L,z).SU(Z))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[])),d=d.concat(t[3].map((L=>mL.YU.TransformNormal(L,z))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[]));const M=new mL.YU(0,q,0),J=mL.Matrix.RotationX(Math.PI/2);P=P.concat(X[4].map((L=>mL.YU.TransformNormal(L,J).add(M))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[])),d=d.concat(t[4].map((L=>mL.YU.TransformNormal(L,J))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[]));const j=mL.Matrix.RotationX(-Math.PI/2);P=P.concat(X[5].map((L=>mL.YU.TransformNormal(L,j).SU(M))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[])),d=d.concat(t[5].map((L=>mL.YU.TransformNormal(L,j))).map((L=>[L.x,L.y,L.z])).reduce(((L,U)=>L.concat(U)),[])),F.b._ComputeSides(H,P,l,d,K);const R=new F.b;if(R.indices=l,R.KL=P,R.lL=d,R.XL=K,x){const L=H===F.b.DOUBLESIDE?i.concat(i):i;R.iL=L}return R}function V(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return S(U).yL(mL,U.updatable),mL}F.b.CreateTiledPlane=E;F.b.CreateTiledBox=S;var H=x(14013),Q=x(12820),q=x(12785);function f(L){const U=L.height||2;let x=0===L.diameterTop?0:L.diameterTop||L.diameter||1,G=0===L.diameterBottom?0:L.diameterBottom||L.diameter||1;x=x||1e-5,G=G||1e-5;const o=0|(L.tessellation||24),A=0|(L.subdivisions||1),r=!!L.hasRings,h=!!L.enclose,E=0===L.cap?0:L.cap||p.e.CAP_ALL,Y=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,S=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,V=L.faceUV||new Array(3),H=L.faceColors,Q=2+(1+(1!==Y&&h?2:0))*(r?A:1);let f;for(f=0;f<Q;f++)H&&void 0===H[f]&&(H[f]=new b.ia(1,1,1,1));for(f=0;f<Q;f++)V&&void 0===V[f]&&(V[f]=new mL.Vector4(0,0,1,1));const v=[],D=[],P=[],d=[],K=[],l=2*Math.PI*Y/o;let i,X,t;const y=(G-x)/2/U,n=mL.YU.Zero(),N=mL.YU.Zero(),e=mL.YU.Zero(),u=mL.YU.Zero(),Z=mL.YU.Zero(),g=q.b.Y;let z,M,J,j=1,R=1,c=0,W=0;for(z=0;z<=A;z++)for(X=z/A,t=(X*(x-G)+G)/2,j=r&&0!==z&&z!==A?2:1,J=0;J<j;J++){for(r&&(R+=J),h&&(R+=2*J),M=0;M<=o;M++)i=M*l,n.x=Math.cos(-i)*t,n.y=-U/2+X*U,n.z=Math.sin(-i)*t,0===x&&z===A?(N.x=P[P.length-3*(o+1)],N.y=P[P.length-3*(o+1)+1],N.z=P[P.length-3*(o+1)+2]):(N.x=n.x,N.z=n.z,N.y=Math.sqrt(N.x*N.x+N.z*N.z)*y,N.normalize()),0===M&&(e.p(n),u.p(N)),D.push(n.x,n.y,n.z),P.push(N.x,N.y,N.z),W=r?c!==R?V[R].y:V[R].w:V[R].y+(V[R].w-V[R].y)*X,d.push(V[R].x+(V[R].z-V[R].x)*M/o,a.b?1-W:W),H&&K.push(H[R].r,H[R].g,H[R].b,H[R].a);1!==Y&&h&&(D.push(n.x,n.y,n.z),D.push(0,n.y,0),D.push(0,n.y,0),D.push(e.x,e.y,e.z),mL.YU.CrossToRef(g,N,Z),Z.normalize(),P.push(Z.x,Z.y,Z.z,Z.x,Z.y,Z.z),mL.YU.CrossToRef(u,g,Z),Z.normalize(),P.push(Z.x,Z.y,Z.z,Z.x,Z.y,Z.z),W=r?c!==R?V[R+1].y:V[R+1].w:V[R+1].y+(V[R+1].w-V[R+1].y)*X,d.push(V[R+1].x,a.b?1-W:W),d.push(V[R+1].z,a.b?1-W:W),W=r?c!==R?V[R+2].y:V[R+2].w:V[R+2].y+(V[R+2].w-V[R+2].y)*X,d.push(V[R+2].x,a.b?1-W:W),d.push(V[R+2].z,a.b?1-W:W),H&&(K.push(H[R+1].r,H[R+1].g,H[R+1].b,H[R+1].a),K.push(H[R+1].r,H[R+1].g,H[R+1].b,H[R+1].a),K.push(H[R+2].r,H[R+2].g,H[R+2].b,H[R+2].a),K.push(H[R+2].r,H[R+2].g,H[R+2].b,H[R+2].a))),c!==R&&(c=R)}const I=1!==Y&&h?o+4:o;for(z=0,R=0;R<A;R++){let L=0,U=0,x=0,mL=0;for(M=0;M<o;M++)L=z*(I+1)+M,U=(z+1)*(I+1)+M,x=z*(I+1)+(M+1),mL=(z+1)*(I+1)+(M+1),v.push(L,U,x),v.push(mL,x,U);1!==Y&&h&&(v.push(L+2,U+2,x+2),v.push(mL+2,x+2,U+2),v.push(L+4,U+4,x+4),v.push(mL+4,x+4,U+4)),z=r?z+2:z+1}const w=L=>{const p=L?x/2:G/2;if(0===p)return;let F,A,r;const h=L?V[Q-1]:V[0];let b=null;H&&(b=L?H[Q-1]:H[0]);const E=D.length/3,S=L?U/2:-U/2,q=new mL.YU(0,S,0);D.push(q.x,q.y,q.z),P.push(0,L?1:-1,0);const f=h.y+.5*(h.w-h.y);d.push(h.x+.5*(h.z-h.x),a.b?1-f:f),b&&K.push(b.r,b.g,b.b,b.a);const l=new mL.Vector2(.5,.5);for(r=0;r<=o;r++){F=2*Math.PI*r*Y/o;const U=Math.cos(-F),x=Math.sin(-F);A=new mL.YU(U*p,S,x*p);const G=new mL.Vector2(U*l.x+.5,x*l.y+.5);D.push(A.x,A.y,A.z),P.push(0,L?1:-1,0);const E=h.y+(h.w-h.y)*G.y;d.push(h.x+(h.z-h.x)*G.x,a.b?1-E:E),b&&K.push(b.r,b.g,b.b,b.a)}for(r=0;r<o;r++)L?(v.push(E),v.push(E+(r+2)),v.push(E+(r+1))):(v.push(E),v.push(E+(r+1)),v.push(E+(r+2)))};E!==p.e.CAP_START&&E!==p.e.CAP_ALL||w(!1),E!==p.e.CAP_END&&E!==p.e.CAP_ALL||w(!0),F.b._ComputeSides(S,D,v,P,d,L.frontUVs,L.backUVs);const B=new F.b;return B.indices=v,B.KL=D,B.lL=P,B.XL=d,H&&(B.iL=K),B}function v(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return f(U).yL(mL,U.updatable),mL}function D(L){const U=[],x=[],p=[],G=[],o=L.diameter||1,A=L.thickness||.5,r=0|(L.tessellation||16),h=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,b=r+1;for(let F=0;F<=r;F++){const L=F/r,h=F*Math.PI*2/r-Math.PI/2,E=mL.Matrix.Translation(o/2,0,0).multiply(mL.Matrix.RotationY(h));for(let o=0;o<=r;o++){const h=1-o/r,Y=o*Math.PI*2/r+Math.PI,S=Math.cos(Y),V=Math.sin(Y);let H=new mL.YU(S,V,0),Q=H.scale(A/2);const q=new mL.Vector2(L,h);Q=mL.YU.TransformCoordinates(Q,E),H=mL.YU.TransformNormal(H,E),x.push(Q.x,Q.y,Q.z),p.push(H.x,H.y,H.z),G.push(q.x,a.b?1-q.y:q.y);const f=(F+1)%b,v=(o+1)%b;U.push(F*b+o),U.push(F*b+v),U.push(f*b+o),U.push(F*b+v),U.push(f*b+v),U.push(f*b+o)}}F.b._ComputeSides(h,x,U,p,G,L.frontUVs,L.backUVs);const E=new F.b;return E.indices=U,E.KL=x,E.lL=p,E.XL=G,E}function P(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return D(U).yL(mL,U.updatable),mL}F.b.CreateCylinder=f,p.e.CreateCylinder=(L,U,x,mL,G,F,a,o,A)=>{void 0!==a&&a instanceof Q.e||(void 0!==a&&(A=o||p.e.DEFAULTSIDE,o=a),a=F,F=1);return v(L,{height:U,diameterTop:x,diameterBottom:mL,tessellation:G,subdivisions:F,sideOrientation:A,updatable:o},a)};function d(L){const U=[],x=[],p=[],G=[],o=L.radius||2,A=L.tube||.5,r=L.radialSegments||32,h=L.tubularSegments||32,b=L.p||2,E=L.q||3,Y=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,S=L=>{const U=Math.cos(L),x=Math.sin(L),p=E/b*L,G=Math.cos(p),F=o*(2+G)*.5*U,a=o*(2+G)*x*.5,A=o*Math.sin(p)*.5;return new mL.YU(F,a,A)};let V,H;for(V=0;V<=r;V++){const L=V%r/r*2*b*Math.PI,U=S(L),p=S(L+.01),F=p.SU(U);let o=p.add(U);const E=mL.YU.Cross(F,o);for(o=mL.YU.Cross(E,F),E.normalize(),o.normalize(),H=0;H<h;H++){const L=H%h/h*2*Math.PI,mL=-A*Math.cos(L),p=A*Math.sin(L);x.push(U.x+mL*o.x+p*E.x),x.push(U.y+mL*o.y+p*E.y),x.push(U.z+mL*o.z+p*E.z),G.push(V/r),G.push(a.b?1-H/h:H/h)}}for(V=0;V<r;V++)for(H=0;H<h;H++){const L=(H+1)%h,x=V*h+H,mL=(V+1)*h+H,p=(V+1)*h+L,G=V*h+L;U.push(G),U.push(mL),U.push(x),U.push(G),U.push(p),U.push(mL)}F.b.ComputeNormals(x,U,p),F.b._ComputeSides(Y,x,U,p,G,L.frontUVs,L.backUVs);const Q=new F.b;return Q.indices=U,Q.KL=x,Q.lL=p,Q.XL=G,Q}function K(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return d(U).yL(mL,U.updatable),mL}F.b.CreateTorus=D,p.e.CreateTorus=(L,U,x,mL,p,G,F)=>P(L,{diameter:U,thickness:x,tessellation:mL,sideOrientation:F,updatable:G},p);F.b.CreateTorusKnot=d,p.e.CreateTorusKnot=(L,U,x,mL,p,G,F,a,o,A)=>K(L,{radius:U,tube:x,radialSegments:mL,tubularSegments:p,p:G,q:F,sideOrientation:A,updatable:o},a);var l=x(14528),i=x(13166),X=x(12791);function t(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=U.path,G=U.shape,F=U.scale||1,a=U.rotation||0,o=0===U.cap?0:U.cap||p.e.NO_CAP,A=U.updatable,r=p.e._GetDefaultSideOrientation(U.sideOrientation),h=U.instance||null,b=U.invertUV||!1,E=U.closeShape||!1,Y=U.closePath||!1,S=U.capFunction||null;return n(L,G,mL,F,a,null,null,Y,E,o,!1,x,!!A,r,h,b,U.frontUVs||null,U.backUVs||null,U.firstNormal||null,!!U.adjustFrame,S)}function y(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=U.path,G=U.shape,F=U.scaleFunction||(()=>1),a=U.rotationFunction||(()=>0),o=U.closePath||U.ribbonCloseArray||!1,A=U.closeShape||U.ribbonClosePath||!1,r=0===U.cap?0:U.cap||p.e.NO_CAP,h=U.updatable,b=U.firstNormal||null,E=U.adjustFrame||!1,Y=p.e._GetDefaultSideOrientation(U.sideOrientation),S=U.instance,V=U.invertUV||!1,H=U.capFunction||null;return n(L,G,mL,null,null,F,a,o,A,r,!0,x,!!h,Y,S||null,V,U.frontUVs||null,U.backUVs||null,b,E,H||null)}function n(L,U,x,G,F,a,o,r,h,b,E,Y,S,V,H,Q,q,f,v,D,P){const d=(L,U,x,G,F,a,o,A,r,h,b)=>{const E=x.getTangents(),Y=x.getNormals(),S=x.getBinormals(),V=x.getDistances();if(b)for(let p=0;p<E.length;p++)if(0==E[p].x&&0==E[p].y&&0==E[p].z&&E[p].p(E[p-1]),0==Y[p].x&&0==Y[p].y&&0==Y[p].z&&Y[p].p(Y[p-1]),0==S[p].x&&0==S[p].y&&0==S[p].z&&S[p].p(S[p-1]),p>0){let L=E[p-1];mL.YU.Dot(L,E[p])<0&&E[p].scaleInPlace(-1),L=Y[p-1],mL.YU.Dot(L,Y[p])<0&&Y[p].scaleInPlace(-1),L=S[p-1],mL.YU.Dot(L,S[p])<0&&S[p].scaleInPlace(-1)}let H=0;const Q=h&&A?A:()=>null!==a?a:0,q=h&&o?o:()=>null!==F?F:1;let f=r===p.e.NO_CAP||r===p.e.CAP_END?0:2;const v=mL.TmpVectors.Matrix[0];for(let p=0;p<U.length;p++){const x=[],F=Q(p,V[p]),a=q(p,V[p]);mL.Matrix.RotationAxisToRef(E[p],H,v);for(let G=0;G<L.length;G++){const F=E[p].scale(L[G].z).add(Y[p].scale(L[G].x)).add(S[p].scale(L[G].y)),o=mL.YU.Zero();mL.YU.TransformCoordinatesToRef(F,v,o),o.scaleInPlace(a).addInPlace(U[p]),x[G]=o}G[f]=x,H+=F,f++}const D=P||(L=>{const U=Array(),x=mL.YU.Zero();let p;for(p=0;p<L.length;p++)x.addInPlace(L[p]);for(x.scaleInPlace(1/L.length),p=0;p<L.length;p++)U.push(x);return U});switch(r){case p.e.NO_CAP:break;case p.e.CAP_START:G[0]=D(G[2]),G[1]=G[2];break;case p.e.CAP_END:G[f]=G[f-1],G[f+1]=D(G[f-1]);break;case p.e.CAP_ALL:G[0]=D(G[2]),G[1]=G[2],G[f]=G[f-1],G[f+1]=D(G[f-1])}return G};let K,l;if(H){const L=H._creationDataStorage;return K=v?L.path3D.update(x,v):L.path3D.update(x),l=d(U,x,L.path3D,L.pathArray,G,F,a,o,L.cap,E,D),H=A("",{pathArray:l,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:H},Y||void 0)}K=v?new X.o(x,v):new X.o(x);l=d(U,x,K,new Array,G,F,a,o,b=b<0||b>3?0:b,E,D);const i=A(L,{pathArray:l,closeArray:r,closePath:h,updatable:S,sideOrientation:V,invertUV:Q,frontUVs:q||void 0,backUVs:f||void 0},Y);return i._creationDataStorage.pathArray=l,i._creationDataStorage.path3D=K,i._creationDataStorage.cap=b,i}function N(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=U.arc?U.arc<=0||U.arc>1?1:U.arc:1,F=void 0===U.closed||U.closed,a=U.shape,o=U.radius||1,r=U.tessellation||64,h=U.clip||0,b=U.updatable,E=p.e._GetDefaultSideOrientation(U.sideOrientation),Y=U.cap||p.e.NO_CAP,S=2*Math.PI,V=[],H=U.invertUV||!1;let Q=0,q=0;const f=S/r*G;let v,D;for(Q=0;Q<=r-h;Q++){for(D=[],Y!=p.e.CAP_START&&Y!=p.e.CAP_ALL||(D.push(new mL.YU(0,a[0].y,0)),D.push(new mL.YU(Math.cos(Q*f)*a[0].x*o,a[0].y,Math.sin(Q*f)*a[0].x*o))),q=0;q<a.length;q++)v=new mL.YU(Math.cos(Q*f)*a[q].x*o,a[q].y,Math.sin(Q*f)*a[q].x*o),D.push(v);Y!=p.e.CAP_END&&Y!=p.e.CAP_ALL||(D.push(new mL.YU(Math.cos(Q*f)*a[a.length-1].x*o,a[a.length-1].y,Math.sin(Q*f)*a[a.length-1].x*o)),D.push(new mL.YU(0,a[a.length-1].y,0))),V.push(D)}return A(L,{pathArray:V,closeArray:F,sideOrientation:E,updatable:b,invertUV:H,frontUVs:U.frontUVs,backUVs:U.backUVs},x)}p.e.ExtrudeShape=function(L,U,x,mL,G,F){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,r=arguments.length>9?arguments[9]:void 0;return t(L,{shape:U,path:x,scale:mL,rotation:G,cap:0===F?0:F||p.e.NO_CAP,sideOrientation:A,instance:r,updatable:o},a)},p.e.ExtrudeShapeCustom=(L,U,x,mL,G,F,a,o,A,r,h,b)=>y(L,{shape:U,path:x,scaleFunction:mL,rotationFunction:G,ribbonCloseArray:F,ribbonClosePath:a,cap:0===o?0:o||p.e.NO_CAP,sideOrientation:h,instance:b,updatable:r},A);p.e.CreateLathe=(L,U,x,mL,p,G,F)=>N(L,{shape:U,radius:x,tessellation:mL,sideOrientation:F,updatable:G},p);var e=x(13921),u=x(13871);function Z(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=U.path;let F=U.instance,a=1;void 0!==U.radius?a=U.radius:F&&(a=F._creationDataStorage.radius);const o=U.tessellation||64,r=U.radiusFunction||null;let h=U.cap||p.e.NO_CAP;const b=U.invertUV||!1,E=U.updatable,Y=p.e._GetDefaultSideOrientation(U.sideOrientation);U.arc=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1;const S=(L,U,x,G,F,a,o,A)=>{const r=U.getTangents(),h=U.getNormals(),b=U.getDistances(),E=2*Math.PI/F*A,Y=a||(()=>G);let S,V,H,Q;const q=mL.TmpVectors.Matrix[0];let f=o===p.e.NO_CAP||o===p.e.CAP_END?0:2;for(let p=0;p<L.length;p++){V=Y(p,b[p]),S=Array(),H=h[p];for(let U=0;U<F;U++)mL.Matrix.RotationAxisToRef(r[p],E*U,q),Q=S[U]?S[U]:mL.YU.Zero(),mL.YU.TransformCoordinatesToRef(H,q,Q),Q.scaleInPlace(V).addInPlace(L[p]),S[U]=Q;x[f]=S,f++}const v=(U,x)=>{const mL=Array();for(let p=0;p<U;p++)mL.push(L[x]);return mL};switch(o){case p.e.NO_CAP:break;case p.e.CAP_START:x[0]=v(F,0),x[1]=x[2].slice(0);break;case p.e.CAP_END:x[f]=x[f-1].slice(0),x[f+1]=v(F,L.length-1);break;case p.e.CAP_ALL:x[0]=v(F,0),x[1]=x[2].slice(0),x[f]=x[f-1].slice(0),x[f+1]=v(F,L.length-1)}return x};let V,H;if(F){const L=F._creationDataStorage,x=U.arc||L.arc;return V=L.path3D.update(G),H=S(G,V,L.pathArray,a,L.tessellation,r,L.cap,x),F=A("",{pathArray:H,instance:F}),L.path3D=V,L.pathArray=H,L.arc=x,L.radius=a,F}V=new X.o(G);h=h<0||h>3?0:h,H=S(G,V,new Array,a,o,r,h,U.arc);const Q=A(L,{pathArray:H,closePath:!0,closeArray:!1,updatable:E,sideOrientation:Y,invertUV:b,frontUVs:U.frontUVs,backUVs:U.backUVs},x);return Q._creationDataStorage.pathArray=H,Q._creationDataStorage.path3D=V,Q._creationDataStorage.tessellation=o,Q._creationDataStorage.cap=h,Q._creationDataStorage.arc=U.arc,Q._creationDataStorage.radius=a,Q}function g(L){const U=[];U[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},U[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},U[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},U[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},U[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},U[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},U[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},U[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},U[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},U[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},U[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},U[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},U[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},U[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},U[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const x=L.type&&(L.type<0||L.type>=U.length)?0:L.type||0,p=L.size,G=L.sizeX||p||1,o=L.sizeY||p||1,A=L.sizeZ||p||1,r=L.custom||U[x],h=r.face.length,E=L.faceUV||new Array(h),Y=L.faceColors,S=void 0===L.flat||L.flat,V=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,H=[],Q=[],q=[],f=[],v=[];let D=0,P=0;const d=[];let K,l,i,X,t,y,n=0,N=0;if(S)for(N=0;N<h;N++)Y&&void 0===Y[N]&&(Y[N]=new b.ia(1,1,1,1)),E&&void 0===E[N]&&(E[N]=new mL.Vector4(0,0,1,1));if(S)for(N=0;N<h;N++){const L=r.face[N].length;for(i=2*Math.PI/L,X=.5*Math.tan(i/2),t=.5,n=0;n<L;n++)H.push(r.vertex[r.face[N][n]][0]*G,r.vertex[r.face[N][n]][1]*o,r.vertex[r.face[N][n]][2]*A),d.push(D),D++,K=E[N].x+(E[N].z-E[N].x)*(.5+X),l=E[N].y+(E[N].w-E[N].y)*(t-.5),f.push(K,a.b?1-l:l),y=X*Math.cos(i)-t*Math.sin(i),t=X*Math.sin(i)+t*Math.cos(i),X=y,Y&&v.push(Y[N].r,Y[N].g,Y[N].b,Y[N].a);for(n=0;n<L-2;n++)Q.push(d[0+P],d[n+2+P],d[n+1+P]);P+=L}else{for(n=0;n<r.vertex.length;n++)H.push(r.vertex[n][0]*G,r.vertex[n][1]*o,r.vertex[n][2]*A),f.push(0,a.b?1:0);for(N=0;N<h;N++)for(n=0;n<r.face[N].length-2;n++)Q.push(r.face[N][0],r.face[N][n+2],r.face[N][n+1])}F.b.ComputeNormals(H,Q,q),F.b._ComputeSides(V,H,Q,q,f,L.frontUVs,L.backUVs);const e=new F.b;return e.KL=H,e.indices=Q,e.lL=q,e.XL=f,Y&&S&&(e.iL=v),e}function z(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return g(U).yL(mL,U.updatable),mL}p.e.CreateTube=(L,U,x,mL,p,G,F,a,o,A)=>Z(L,{path:U,radius:x,tessellation:mL,radiusFunction:p,arc:1,cap:G,updatable:a,sideOrientation:o,instance:A},F);function M(L){const U=L.sideOrientation||F.b.DEFAULTSIDE,x=L.radius||1,p=void 0===L.flat||L.flat,G=0|(L.subdivisions||4),o=L.radiusX||x,A=L.radiusY||x,r=L.radiusZ||x,h=(1+Math.sqrt(5))/2,b=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],E=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Y=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],S=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],H=[],Q=[],q=[],f=[];let v=0;const D=new Array(3),P=new Array(3);let d;for(d=0;d<3;d++)D[d]=mL.YU.Zero(),P[d]=mL.Vector2.Zero();for(let F=0;F<20;F++){for(d=0;d<3;d++){const L=E[3*F+d];D[d].da(b[3*Y[L]],b[3*Y[L]+1],b[3*Y[L]+2]),D[d].normalize(),P[d].da(.134765625*S[2*L]+.05859375+-.0390625*V[F],.2333984375*S[2*L+1]+.025390625+.01953125*V[F])}const L=(L,U,x,F)=>{const h=mL.YU.Lerp(D[0],D[2],U/G),b=mL.YU.Lerp(D[1],D[2],U/G),E=G===U?D[2]:mL.YU.Lerp(h,b,L/(G-U));let Y;if(E.normalize(),p){const L=mL.YU.Lerp(D[0],D[2],F/G),U=mL.YU.Lerp(D[1],D[2],F/G);Y=mL.YU.Lerp(L,U,x/(G-F))}else Y=new mL.YU(E.x,E.y,E.z);Y.x/=o,Y.y/=A,Y.z/=r,Y.normalize();const S=mL.Vector2.Lerp(P[0],P[2],U/G),V=mL.Vector2.Lerp(P[1],P[2],U/G),d=G===U?P[2]:mL.Vector2.Lerp(S,V,L/(G-U));Q.push(E.x*o,E.y*A,E.z*r),q.push(Y.x,Y.y,Y.z),f.push(d.x,a.b?1-d.y:d.y),H.push(v),v++};for(let U=0;U<G;U++)for(let x=0;x+U<G;x++)L(x,U,x+1/3,U+1/3),L(x+1,U,x+1/3,U+1/3),L(x,U+1,x+1/3,U+1/3),x+U+1<G&&(L(x+1,U,x+2/3,U+2/3),L(x+1,U+1,x+2/3,U+2/3),L(x,U+1,x+2/3,U+2/3))}F.b._ComputeSides(U,Q,H,q,f,L.frontUVs,L.backUVs);const K=new F.b;return K.indices=H,K.KL=Q,K.lL=q,K.XL=f,K}function J(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mL=new p.e(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),mL._originalBuilderSideOrientation=U.sideOrientation;return M(U).yL(mL,U.updatable),mL}F.b.CreatePolyhedron=g,p.e.CreatePolyhedron=(L,U,x)=>z(L,U,x);F.b.CreateIcoSphere=M,p.e.CreateIcoSphere=(L,U,x)=>J(L,U,x);var j=x(12610);const R=new mL.YU(1,0,0),c=new mL.YU(-1,0,0),W=new mL.YU(0,1,0),I=new mL.YU(0,-1,0),w=new mL.YU(0,0,1),B=new mL.YU(0,0,-1);class s{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mL.YU.Zero(),U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mL.YU.Up(),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mL.Vector2.Zero(),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=L,this.normal=U,this.uv=x,this.vertexIdx=p,this.vertexIdxForBones=G,this.localPositionOverride=F,this.localNormalOverride=a,this.matrixIndicesOverride=o,this.matrixWeightsOverride=A}clone(){var L,U,x,mL;return new s(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(L=this.localPositionOverride)||void 0===L?void 0:L.slice(),null===(U=this.localNormalOverride)||void 0===U?void 0:U.slice(),null===(x=this.matrixIndicesOverride)||void 0===x?void 0:x.slice(),null===(mL=this.matrixWeightsOverride)||void 0===mL?void 0:mL.slice())}}function C(L,U,x){var o,A,r,h,b;const E=!!U.skeleton,Y=!(null===(o=U.morphTargetManager)||void 0===o||!o.numTargets),S=x.localMode||E,V=U.Da(),H=E||Y?U.Ra(!0,!0):U.getVerticesData(G.h.PositionKind),Q=E||Y?U.getNormalsData(!0,!0):U.getVerticesData(G.h.NormalKind),q=S?E?U.getVerticesData(G.h.PositionKind):H:null,f=S?E?U.getVerticesData(G.h.NormalKind):Q:null,v=U.getVerticesData(G.h.UVKind),D=E?U.getVerticesData(G.h.MatricesIndicesKind):null,P=E?U.getVerticesData(G.h.MatricesWeightsKind):null,d=E?U.getVerticesData(G.h.MatricesIndicesExtraKind):null,K=E?U.getVerticesData(G.h.MatricesWeightsExtraKind):null,l=x.position||mL.YU.Zero();let i=x.normal||mL.YU.Up();const X=x.size||mL.YU.One(),t=x.angle||0;if(!i){const L=new mL.YU(0,0,1),x=U.PL().activeCamera,p=mL.YU.TransformCoordinates(L,x.getWorldMatrix());i=x.globalPosition.SU(p)}const y=-Math.atan2(i.z,i.x)-Math.PI/2,n=Math.sqrt(i.x*i.x+i.z*i.z),N=Math.atan2(i.y,n),e=new F.b;e.indices=[],e.KL=[],e.lL=[],e.XL=[],e.matricesIndices=E?[]:null,e.matricesWeights=E?[]:null,e.matricesIndicesExtra=d?[]:null,e.matricesWeightsExtra=K?[]:null;let u=0;const Z=(L,U)=>{const p=new s;if(!V||!H||!Q)return p;const G=V[L];if(p.vertexIdx=3*G,p.vertexIdxForBones=4*G,p.position=new mL.YU(H[3*G],H[3*G+1],H[3*G+2]),mL.YU.TransformCoordinatesToRef(p.position,U,p.position),p.normal=new mL.YU(Q[3*G],Q[3*G+1],Q[3*G+2]),mL.YU.TransformNormalToRef(p.normal,U,p.normal),x.captureUVS&&v){const L=v[2*G+1];p.uv=new mL.Vector2(v[2*G],a.b?1-L:L)}return p},g=[0,0,0,0],z=(L,U)=>{if(0===L.length)return L;const x=.5*Math.abs(mL.YU.Dot(X,U)),p=(L,U,x,mL)=>{for(let p=0;p<mL;++p)if(L[x+p]===U)return x+p;return-1},G=(L,G)=>{const F=mL.YU.GetClipFactor(L.position,G.position,U,x);let a=g,o=g;if(D&&P){const U=L.matrixIndicesOverride?0:L.vertexIdxForBones,x=L.matrixIndicesOverride??D,mL=L.matrixWeightsOverride??P,A=G.matrixIndicesOverride?0:G.vertexIdxForBones,r=G.matrixIndicesOverride??D,h=G.matrixWeightsOverride??P;a=[0,0,0,0],o=[0,0,0,0];let b=0;for(let L=0;L<4;++L)if(mL[U+L]>0){const G=p(r,x[U+L],A,4);a[b]=x[U+L],o[b]=(0,j.Lerp)(mL[U+L],G>=0?h[G]:0,F),b++}for(let L=0;L<4&&b<4;++L){const mL=r[A+L];-1===p(x,mL,U,4)&&(a[b]=mL,o[b]=(0,j.Lerp)(0,h[A+L],F),b++)}const E=o[0]+o[1]+o[2]+o[3];o[0]/=E,o[1]/=E,o[2]/=E,o[3]/=E}const A=L.localPositionOverride?L.localPositionOverride[0]:(null===q||void 0===q?void 0:q[L.vertexIdx])??0,r=L.localPositionOverride?L.localPositionOverride[1]:(null===q||void 0===q?void 0:q[L.vertexIdx+1])??0,h=L.localPositionOverride?L.localPositionOverride[2]:(null===q||void 0===q?void 0:q[L.vertexIdx+2])??0,b=G.localPositionOverride?G.localPositionOverride[0]:(null===q||void 0===q?void 0:q[G.vertexIdx])??0,E=G.localPositionOverride?G.localPositionOverride[1]:(null===q||void 0===q?void 0:q[G.vertexIdx+1])??0,Y=G.localPositionOverride?G.localPositionOverride[2]:(null===q||void 0===q?void 0:q[G.vertexIdx+2])??0,S=L.localNormalOverride?L.localNormalOverride[0]:(null===f||void 0===f?void 0:f[L.vertexIdx])??0,V=L.localNormalOverride?L.localNormalOverride[1]:(null===f||void 0===f?void 0:f[L.vertexIdx+1])??0,H=L.localNormalOverride?L.localNormalOverride[2]:(null===f||void 0===f?void 0:f[L.vertexIdx+2])??0,Q=S+((G.localNormalOverride?G.localNormalOverride[0]:(null===f||void 0===f?void 0:f[G.vertexIdx])??0)-S)*F,v=V+((G.localNormalOverride?G.localNormalOverride[1]:(null===f||void 0===f?void 0:f[G.vertexIdx+1])??0)-V)*F,d=H+((G.localNormalOverride?G.localNormalOverride[2]:(null===f||void 0===f?void 0:f[G.vertexIdx+2])??0)-H)*F,K=Math.sqrt(Q*Q+v*v+d*d);return new s(mL.YU.Lerp(L.position,G.position,F),mL.YU.Lerp(L.normal,G.normal,F).normalize(),mL.Vector2.Lerp(L.uv,G.uv,F),-1,-1,q?[A+(b-A)*F,r+(E-r)*F,h+(Y-h)*F]:null,f?[Q/K,v/K,d/K]:null,a,o)};let F=null;L.length>3&&(F=[]);for(let a=0;a<L.length;a+=3){let p=0,o=null,A=null,r=null,h=null;const b=mL.YU.Dot(L[a].position,U)-x>0,E=mL.YU.Dot(L[a+1].position,U)-x>0,Y=mL.YU.Dot(L[a+2].position,U)-x>0;switch(p=(b?1:0)+(E?1:0)+(Y?1:0),p){case 0:L.length>3?(F.push(L[a]),F.push(L[a+1]),F.push(L[a+2])):F=L;break;case 1:if(F=F??new Array,b&&(o=L[a+1],A=L[a+2],r=G(L[a],o),h=G(L[a],A)),E){o=L[a],A=L[a+2],r=G(L[a+1],o),h=G(L[a+1],A),F.push(r),F.push(A.clone()),F.push(o.clone()),F.push(A.clone()),F.push(r.clone()),F.push(h);break}Y&&(o=L[a],A=L[a+1],r=G(L[a+2],o),h=G(L[a+2],A)),o&&A&&r&&h&&(F.push(o.clone()),F.push(A.clone()),F.push(r),F.push(h),F.push(r.clone()),F.push(A.clone()));break;case 2:F=F??new Array,b||(o=L[a].clone(),A=G(o,L[a+1]),r=G(o,L[a+2]),F.push(o),F.push(A),F.push(r)),E||(o=L[a+1].clone(),A=G(o,L[a+2]),r=G(o,L[a]),F.push(o),F.push(A),F.push(r)),Y||(o=L[a+2].clone(),A=G(o,L[a]),r=G(o,L[a+1]),F.push(o),F.push(A),F.push(r))}}return F},M=U instanceof p.e?U:null,J=null===M||void 0===M?void 0:M._thinInstanceDataStorage.matrixData,C=(null===M||void 0===M?void 0:M.ta)||1,k=mL.TmpVectors.Matrix[0];k.p(mL.Matrix.IdentityReadOnly);for(let p=0;p<C;++p){if(null!==M&&void 0!==M&&M.hasThinInstances&&J){const L=16*p;k.setRowFromFloats(0,J[L+0],J[L+1],J[L+2],J[L+3]),k.setRowFromFloats(1,J[L+4],J[L+5],J[L+6],J[L+7]),k.setRowFromFloats(2,J[L+8],J[L+9],J[L+10],J[L+11]),k.setRowFromFloats(3,J[L+12],J[L+13],J[L+14],J[L+15])}const L=mL.Matrix.RotationYawPitchRoll(y,N,t).multiply(mL.Matrix.Translation(l.x,l.y,l.z)),G=mL.Matrix.Invert(L),F=U.getWorldMatrix(),o=k.multiply(F).multiply(G),A=new Array(3);for(let U=0;U<V.length;U+=3){let L=A;if(L[0]=Z(U,o),L[1]=Z(U+1,o),L[2]=Z(U+2,o),!(x.cullBackFaces&&-L[0].normal.z<=0&&-L[1].normal.z<=0&&-L[2].normal.z<=0)&&(L=z(L,R),L&&(L=z(L,c),L&&(L=z(L,W),L&&(L=z(L,I),L&&(L=z(L,w),L&&(L=z(L,B),L)))))))for(let U=0;U<L.length;U++){const mL=L[U];if(e.indices.push(u),S?(mL.localPositionOverride?(e.KL[3*u]=mL.localPositionOverride[0],e.KL[3*u+1]=mL.localPositionOverride[1],e.KL[3*u+2]=mL.localPositionOverride[2]):q&&(e.KL[3*u]=q[mL.vertexIdx],e.KL[3*u+1]=q[mL.vertexIdx+1],e.KL[3*u+2]=q[mL.vertexIdx+2]),mL.localNormalOverride?(e.lL[3*u]=mL.localNormalOverride[0],e.lL[3*u+1]=mL.localNormalOverride[1],e.lL[3*u+2]=mL.localNormalOverride[2]):f&&(e.lL[3*u]=f[mL.vertexIdx],e.lL[3*u+1]=f[mL.vertexIdx+1],e.lL[3*u+2]=f[mL.vertexIdx+2])):(mL.position.toArray(e.KL,3*u),mL.normal.toArray(e.lL,3*u)),e.matricesIndices&&e.matricesWeights&&(mL.matrixIndicesOverride?(e.matricesIndices[4*u]=mL.matrixIndicesOverride[0],e.matricesIndices[4*u+1]=mL.matrixIndicesOverride[1],e.matricesIndices[4*u+2]=mL.matrixIndicesOverride[2],e.matricesIndices[4*u+3]=mL.matrixIndicesOverride[3]):(D&&(e.matricesIndices[4*u]=D[mL.vertexIdxForBones],e.matricesIndices[4*u+1]=D[mL.vertexIdxForBones+1],e.matricesIndices[4*u+2]=D[mL.vertexIdxForBones+2],e.matricesIndices[4*u+3]=D[mL.vertexIdxForBones+3]),d&&e.matricesIndicesExtra&&(e.matricesIndicesExtra[4*u]=d[mL.vertexIdxForBones],e.matricesIndicesExtra[4*u+1]=d[mL.vertexIdxForBones+1],e.matricesIndicesExtra[4*u+2]=d[mL.vertexIdxForBones+2],e.matricesIndicesExtra[4*u+3]=d[mL.vertexIdxForBones+3])),mL.matrixWeightsOverride?(e.matricesWeights[4*u]=mL.matrixWeightsOverride[0],e.matricesWeights[4*u+1]=mL.matrixWeightsOverride[1],e.matricesWeights[4*u+2]=mL.matrixWeightsOverride[2],e.matricesWeights[4*u+3]=mL.matrixWeightsOverride[3]):(P&&(e.matricesWeights[4*u]=P[mL.vertexIdxForBones],e.matricesWeights[4*u+1]=P[mL.vertexIdxForBones+1],e.matricesWeights[4*u+2]=P[mL.vertexIdxForBones+2],e.matricesWeights[4*u+3]=P[mL.vertexIdxForBones+3]),K&&e.matricesWeightsExtra&&(e.matricesWeightsExtra[4*u]=K[mL.vertexIdxForBones],e.matricesWeightsExtra[4*u+1]=K[mL.vertexIdxForBones+1],e.matricesWeightsExtra[4*u+2]=K[mL.vertexIdxForBones+2],e.matricesWeightsExtra[4*u+3]=K[mL.vertexIdxForBones+3]))),x.captureUVS)mL.uv.toArray(e.XL,2*u);else{e.XL.push(.5+mL.position.x/X.x);const L=.5+mL.position.y/X.y;e.XL.push(a.b?1-L:L)}u++}}}0===e.indices.length&&(e.indices=null),0===e.KL.length&&(e.KL=null),0===e.lL.length&&(e.lL=null),0===e.XL.length&&(e.XL=null),0===(null===(A=e.matricesIndices)||void 0===A?void 0:A.length)&&(e.matricesIndices=null),0===(null===(r=e.matricesWeights)||void 0===r?void 0:r.length)&&(e.matricesWeights=null),0===(null===(h=e.matricesIndicesExtra)||void 0===h?void 0:h.length)&&(e.matricesIndicesExtra=null),0===(null===(b=e.matricesWeightsExtra)||void 0===b?void 0:b.length)&&(e.matricesWeightsExtra=null);const T=new p.e(L,U.PL());return e.yL(T),S?(T.skeleton=U.skeleton,T.parent=U):(T.position=l.clone(),T.rotation=new mL.YU(N,y,t)),T.fa(!0),T.refreshBoundingInfo(!0,!0),T}function k(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const U=0|Math.max(L.subdivisions?L.subdivisions:2,1),x=0|Math.max(L.tessellation?L.tessellation:16,3),p=Math.max(L.height?L.height:1,0),G=Math.max(L.radius?L.radius:.25,0),o=0|Math.max(L.capSubdivisions?L.capSubdivisions:6,1),A=x,r=U,h=Math.max(L.radiusTop?L.radiusTop:G,0),b=Math.max(L.radiusBottom?L.radiusBottom:G,0),E=p-(h+b),Y=2*Math.PI,S=Math.max(L.topCapSubdivisions?L.topCapSubdivisions:o,1),V=Math.max(L.bottomCapSubdivisions?L.bottomCapSubdivisions:o,1),H=Math.acos((b-h)/p);let Q=[];const q=[],f=[],v=[];let D=0;const P=[],d=.5*E,K=.5*Math.PI;let l,i;const X=mL.YU.Zero(),t=mL.YU.Zero(),y=Math.cos(H),n=Math.sin(H),N=new mL.Vector2(h*n,d+h*y).SU(new mL.Vector2(b*n,b*y-d)).length(),e=h*H+N+b*(K-H);let u=0;for(i=0;i<=S;i++){const L=[],U=K-H*(i/S);u+=h*H/S;const x=Math.cos(U),mL=Math.sin(U),p=x*h;for(l=0;l<=A;l++){const U=l/A,G=U*Y+0,F=Math.sin(G),o=Math.cos(G);t.x=p*F,t.y=d+mL*h,t.z=p*o,q.push(t.x,t.y,t.z),X.set(x*F,mL,x*o),f.push(X.x,X.y,X.z),v.push(U,a.b?u/e:1-u/e),L.push(D),D++}P.push(L)}const Z=p-h-b+y*h-y*b,g=n*(b-h)/Z;for(i=1;i<=r;i++){const L=[];u+=N/r;const U=n*(i*(b-h)/r+h);for(l=0;l<=A;l++){const x=l/A,mL=x*Y+0,p=Math.sin(mL),G=Math.cos(mL);t.x=U*p,t.y=d+y*h-i*Z/r,t.z=U*G,q.push(t.x,t.y,t.z),X.set(p,g,G).normalize(),f.push(X.x,X.y,X.z),v.push(x,a.b?u/e:1-u/e),L.push(D),D++}P.push(L)}for(i=1;i<=V;i++){const L=[],U=K-H-(Math.PI-H)*(i/V);u+=b*H/V;const x=Math.cos(U),mL=Math.sin(U),p=x*b;for(l=0;l<=A;l++){const U=l/A,G=U*Y+0,F=Math.sin(G),o=Math.cos(G);t.x=p*F,t.y=mL*b-d,t.z=p*o,q.push(t.x,t.y,t.z),X.set(x*F,mL,x*o),f.push(X.x,X.y,X.z),v.push(U,a.b?u/e:1-u/e),L.push(D),D++}P.push(L)}for(l=0;l<A;l++)for(i=0;i<S+r+V;i++){const L=P[i][l],U=P[i+1][l],x=P[i+1][l+1],mL=P[i][l+1];Q.push(L),Q.push(U),Q.push(mL),Q.push(U),Q.push(x),Q.push(mL)}if(Q=Q.reverse(),L.orientation&&!L.orientation.equals(mL.YU.Up())){const U=new mL.Matrix;L.orientation.clone().scale(.5*Math.PI).cross(mL.YU.Up()).toQuaternion().toRotationMatrix(U);const x=mL.YU.Zero();for(let L=0;L<q.length;L+=3)x.set(q[L],q[L+1],q[L+2]),mL.YU.TransformCoordinatesToRef(x.clone(),U,x),q[L]=x.x,q[L+1]=x.y,q[L+2]=x.z}const z=new F.b;return z.KL=q,z.lL=f,z.XL=v,z.indices=Q,z}function T(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:mL.YU.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new p.e(L,x);return k(U).yL(G,U.updatable),G}p.e.CreateDecal=(L,U,x,mL,p,G)=>C(L,U,{position:x,normal:mL,size:p,angle:G});p.e.CreateCapsule=(L,U,x)=>T(L,U,x),F.b.CreateCapsule=k;var O=x(12406),LL=x(12598);class UL{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=L,this.y=U,L!==Math.floor(L)&&(L=Math.floor(L),O.c.Warn("x is not an integer, floor(x) used")),U!==Math.floor(U)&&(U=Math.floor(U),O.c.Warn("y is not an integer, floor(y) used"))}clone(){return new UL(this.x,this.y)}rotate60About(L){const U=this.x;return this.x=L.x+L.y-this.y,this.y=U+this.y-L.x,this}rotateNeg60About(L){const U=this.x;return this.x=U+this.y-L.y,this.y=L.x+L.y-U,this}rotate120(L,U){L!==Math.floor(L)&&(L=Math.floor(L),O.c.Warn("m not an integer only floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),O.c.Warn("n not an integer only floor(n) used"));const x=this.x;return this.x=L-x-this.y,this.y=U+x,this}rotateNeg120(L,U){L!==Math.floor(L)&&(L=Math.floor(L),O.c.Warn("m is not an integer, floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),O.c.Warn("n is not an integer,   floor(n) used"));const x=this.x;return this.x=this.y-U,this.y=L+U-x-this.y,this}toCartesianOrigin(L,U){const x=mL.YU.Zero();return x.x=L.x+2*this.x*U+this.y*U,x.y=L.y+Math.sqrt(3)*this.y*U,x}static Zero(){return new UL(0,0)}}class xL{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new mU("icosahedron","Regular",[[0,LL.d,-1],[-LL.d,1,0],[-1,0,-LL.d],[1,0,-LL.d],[LL.d,1,0],[0,LL.d,1],[-1,0,LL.d],[-LL.d,-1,0],[0,-LL.d,-1],[LL.d,-1,0],[1,0,LL.d],[0,-LL.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let L=12;const U={},x=this.m,mL=this.n;let p,G,F,a,o,A=x,r=1,h=0;0!==mL&&(A=(0,j.HighestCommonFactor)(x,mL)),r=x/A,h=mL/A;const b=UL.Zero(),E=new UL(x,mL),Y=new UL(-mL,x+mL),S=UL.Zero(),V=UL.Zero(),H=UL.Zero();let Q,q,f,v,D=[];const P=[],d=this.vertByDist,K=(x,mL,p,G)=>{Q=x+"|"+p,q=mL+"|"+G,Q in U||q in U?Q in U&&!(q in U)?U[q]=U[Q]:q in U&&!(Q in U)&&(U[Q]=U[q]):(U[Q]=L,U[q]=L,L++),d[p][0]>2?P[U[Q]]=[-d[p][0],d[p][1],U[Q]]:P[U[Q]]=[D[d[p][0]],d[p][1],U[Q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let l=0;l<20;l++){if(D=this.IDATA.face[l],F=D[2],a=D[1],o=D[0],f=b.x+"|"+b.y,Q=l+"|"+f,Q in U||(U[Q]=F,P[F]=[D[d[f][0]],d[f][1]]),f=E.x+"|"+E.y,Q=l+"|"+f,Q in U||(U[Q]=a,P[a]=[D[d[f][0]],d[f][1]]),f=Y.x+"|"+Y.y,Q=l+"|"+f,Q in U||(U[Q]=o,P[o]=[D[d[f][0]],d[f][1]]),p=this.IDATA.edgematch[l][0],G=this.IDATA.edgematch[l][1],"B"===G)for(let L=1;L<A;L++)V.x=x-L*(r+h),V.y=mL+L*r,H.x=-L*h,H.y=L*(r+h),f=V.x+"|"+V.y,v=H.x+"|"+H.y,K(l,p,f,v);if("O"===G)for(let L=1;L<A;L++)H.x=-L*h,H.y=L*(r+h),S.x=L*r,S.y=L*h,f=H.x+"|"+H.y,v=S.x+"|"+S.y,K(l,p,f,v);if(p=this.IDATA.edgematch[l][2],G=this.IDATA.edgematch[l][3],G&&"A"===G)for(let L=1;L<A;L++)S.x=L*r,S.y=L*h,V.x=x-(A-L)*(r+h),V.y=mL+(A-L)*r,f=S.x+"|"+S.y,v=V.x+"|"+V.y,K(l,p,f,v);for(let x=0;x<this.vertices.length;x++)f=this.vertices[x].x+"|"+this.vertices[x].y,Q=l+"|"+f,Q in U||(U[Q]=L++,d[f][0]>2?P[U[Q]]=[-d[f][0],d[f][1],U[Q]]:P[U[Q]]=[D[d[f][0]],d[f][1],U[Q]])}this.closestTo=P,this.vecToidx=U}calcCoeffs(){const L=this.m,U=this.n,x=Math.sqrt(3)/3,mL=L*L+U*U+L*U;this.coau=(L+U)/mL,this.cobu=-U/mL,this.coav=-x*(L-U)/mL,this.cobv=x*(2*L+U)/mL}createInnerFacets(){const L=this.m,U=this.n;for(let x=0;x<U+L+1;x++)for(let L=this.min[x];L<this.max[x]+1;L++)L<this.max[x]&&L<this.max[x+1]+1&&this.innerFacets.push(["|"+L+"|"+x,"|"+L+"|"+(x+1),"|"+(L+1)+"|"+x]),x>0&&L<this.max[x-1]&&L+1<this.max[x]+1&&this.innerFacets.push(["|"+L+"|"+x,"|"+(L+1)+"|"+x,"|"+(L+1)+"|"+(x-1)])}edgeVecsABOB(){const L=this.m,U=this.n,x=new UL(-U,L+U);for(let mL=1;mL<L+U;mL++){const L=new UL(this.min[mL],mL),U=new UL(this.min[mL-1],mL-1),p=new UL(this.min[mL+1],mL+1),G=L.clone(),F=U.clone(),a=p.clone();G.rotate60About(x),F.rotate60About(x),a.rotate60About(x);const o=new UL(this.max[G.y],G.y),A=new UL(this.max[G.y-1],G.y-1),r=new UL(this.max[G.y-1]-1,G.y-1);G.x===o.x&&G.y===o.y||(G.x!==A.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,A,r]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,r,o])):G.y===a.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([L,U,A]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([L,A,p])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([L,U,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,A,o])))}}mapABOBtoOBOA(){const L=new UL(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const x=[];for(let mL=0;mL<3;mL++)L.x=this.isoVecsABOB[U][mL].x,L.y=this.isoVecsABOB[U][mL].y,0===this.vertexTypes[U][mL]&&L.rotateNeg120(this.m,this.n),x.push(L.clone());this.isoVecsOBOA.push(x)}}mapABOBtoBAOA(){const L=new UL(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const x=[];for(let mL=0;mL<3;mL++)L.x=this.isoVecsABOB[U][mL].x,L.y=this.isoVecsABOB[U][mL].y,1===this.vertexTypes[U][mL]&&L.rotate120(this.m,this.n),x.push(L.clone());this.isoVecsBAOA.push(x)}}MapToFace(L,U){const x=this.IDATA.face[L],p=x[2],G=x[1],F=x[0],a=mL.YU.qU(this.IDATA.vertex[p]),o=mL.YU.qU(this.IDATA.vertex[G]),A=mL.YU.qU(this.IDATA.vertex[F]),r=o.SU(a),h=A.SU(a),b=r.scale(this.coau).add(h.scale(this.cobu)),E=r.scale(this.coav).add(h.scale(this.cobv)),Y=[];let S,V=mL.TmpVectors.YU[0];for(let mL=0;mL<this.cartesian.length;mL++)V=b.scale(this.cartesian[mL].x).add(E.scale(this.cartesian[mL].y)).add(a),Y[mL]=[V.x,V.y,V.z],S=L+"|"+this.vertices[mL].x+"|"+this.vertices[mL].y,U.vertex[this.vecToidx[S]]=[V.x,V.y,V.z]}build(L,U){const x=[],mL=UL.Zero(),p=new UL(L,U),G=new UL(-U,L+U);x.push(mL,p,G);for(let f=U;f<L+1;f++)for(let U=0;U<L+1-f;U++)x.push(new UL(U,f));if(U>0){const mL=(0,j.HighestCommonFactor)(L,U),p=L/mL,G=U/mL;for(let a=1;a<mL;a++)x.push(new UL(a*p,a*G)),x.push(new UL(-a*G,a*(p+G))),x.push(new UL(L-a*(p+G),U+a*p));const F=L/U;for(let a=1;a<U;a++)for(let mL=0;mL<a*F;mL++)x.push(new UL(mL,a)),x.push(new UL(mL,a).rotate120(L,U)),x.push(new UL(mL,a).rotateNeg120(L,U))}x.sort(((L,U)=>L.x-U.x)),x.sort(((L,U)=>L.y-U.y));const F=new Array(L+U+1),a=new Array(L+U+1);for(let f=0;f<F.length;f++)F[f]=1/0,a[f]=-1/0;let o=0,A=0;const r=x.length;for(let f=0;f<r;f++)A=x[f].x,o=x[f].y,F[o]=Math.min(A,F[o]),a[o]=Math.max(A,a[o]);const h=(x,mL)=>{const p=x.clone();return"A"===mL&&p.rotateNeg120(L,U),"B"===mL&&p.rotate120(L,U),p.x<0?p.y:p.x+p.y},b=[],E=[],Y=[],S=[],V={},H=[];let Q=-1,q=-1;for(let f=0;f<r;f++)b[f]=x[f].toCartesianOrigin(new UL(0,0),.5),E[f]=h(x[f],"O"),Y[f]=h(x[f],"A"),S[f]=h(x[f],"B"),E[f]===Y[f]&&Y[f]===S[f]?(Q=3,q=E[f]):E[f]===Y[f]?(Q=4,q=E[f]):Y[f]===S[f]?(Q=5,q=Y[f]):S[f]===E[f]&&(Q=6,q=E[f]),E[f]<Y[f]&&E[f]<S[f]&&(Q=2,q=E[f]),Y[f]<E[f]&&Y[f]<S[f]&&(Q=1,q=Y[f]),S[f]<Y[f]&&S[f]<E[f]&&(Q=0,q=S[f]),H.push([Q,q,x[f].x,x[f].y]);H.sort(((L,U)=>L[2]-U[2])),H.sort(((L,U)=>L[3]-U[3])),H.sort(((L,U)=>L[1]-U[1])),H.sort(((L,U)=>L[0]-U[0]));for(let f=0;f<H.length;f++)V[H[f][2]+"|"+H[f][3]]=[H[f][0],H[f][1],f];return this.m=L,this.n=U,this.vertices=x,this.vertByDist=V,this.cartesian=b,this.min=F,this.max=a,this}}class mU{constructor(L,U,x,mL){this.name=L,this.category=U,this.vertex=x,this.face=mL}}class pL extends mU{innerToData(L,U){for(let x=0;x<U.innerFacets.length;x++)this.face.push(U.innerFacets[x].map((x=>U.vecToidx[L+x])))}mapABOBtoDATA(L,U){const x=U.IDATA.edgematch[L][0];for(let mL=0;mL<U.isoVecsABOB.length;mL++){const p=[];for(let G=0;G<3;G++)0===U.vertexTypes[mL][G]?p.push(L+"|"+U.isoVecsABOB[mL][G].x+"|"+U.isoVecsABOB[mL][G].y):p.push(x+"|"+U.isoVecsABOB[mL][G].x+"|"+U.isoVecsABOB[mL][G].y);this.face.push([U.vecToidx[p[0]],U.vecToidx[p[1]],U.vecToidx[p[2]]])}}mapOBOAtoDATA(L,U){const x=U.IDATA.edgematch[L][0];for(let mL=0;mL<U.isoVecsOBOA.length;mL++){const p=[];for(let G=0;G<3;G++)1===U.vertexTypes[mL][G]?p.push(L+"|"+U.isoVecsOBOA[mL][G].x+"|"+U.isoVecsOBOA[mL][G].y):p.push(x+"|"+U.isoVecsOBOA[mL][G].x+"|"+U.isoVecsOBOA[mL][G].y);this.face.push([U.vecToidx[p[0]],U.vecToidx[p[1]],U.vecToidx[p[2]]])}}mapBAOAtoDATA(L,U){const x=U.IDATA.edgematch[L][2];for(let mL=0;mL<U.isoVecsBAOA.length;mL++){const p=[];for(let G=0;G<3;G++)1===U.vertexTypes[mL][G]?p.push(L+"|"+U.isoVecsBAOA[mL][G].x+"|"+U.isoVecsBAOA[mL][G].y):p.push(x+"|"+U.isoVecsBAOA[mL][G].x+"|"+U.isoVecsBAOA[mL][G].y);this.face.push([U.vecToidx[p[0]],U.vecToidx[p[1]],U.vecToidx[p[2]]])}}orderData(L){const U=[];for(let G=0;G<13;G++)U[G]=[];const x=L.closestTo;for(let G=0;G<x.length;G++)x[G][0]>-1?x[G][1]>0&&U[x[G][0]].push([G,x[G][1]]):U[12].push([G,x[G][0]]);const mL=[];for(let G=0;G<12;G++)mL[G]=G;let p=12;for(let G=0;G<12;G++){U[G].sort(((L,U)=>L[1]-U[1]));for(let L=0;L<U[G].length;L++)mL[U[G][L][0]]=p++}for(let G=0;G<U[12].length;G++)mL[U[12][G][0]]=p++;for(let G=0;G<this.vertex.length;G++)this.vertex[G].push(mL[G]);this.vertex.sort(((L,U)=>L[3]-U[3]));for(let G=0;G<this.vertex.length;G++)this.vertex[G].pop();for(let G=0;G<this.face.length;G++)for(let L=0;L<this.face[G].length;L++)this.face[G][L]=mL[this.face[G][L]];this.sharedNodes=U[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(L,U){const x=[],mL=[];let p=U.pop();mL.push(p);let G=this.face[p].indexOf(L);G=(G+2)%3;let F=this.face[p][G];x.push(F);let a=0;for(;U.length>0;)p=U[a],this.face[p].indexOf(F)>-1?(G=(this.face[p].indexOf(F)+1)%3,F=this.face[p][G],x.push(F),mL.push(p),U.splice(a,1),a=0):a++;return this.adjacentFaces.push(x),mL}toGoldbergPolyhedronData(){const L=new mU("GeoDual","Goldberg",[],[]);L.name="GD dual";const U=this.vertex.length,x=new Array(U);for(let o=0;o<U;o++)x[o]=[];for(let o=0;o<this.face.length;o++)for(let L=0;L<3;L++)x[this.face[o][L]].push(o);let mL=0,p=0,G=0,F=[],a=[];this.adjacentFaces=[];for(let o=0;o<x.length;o++){L.face[o]=this.setOrder(o,x[o].concat([]));for(const U of x[o]){mL=0,p=0,G=0,F=this.face[U];for(let L=0;L<3;L++)a=this.vertex[F[L]],mL+=a[0],p+=a[1],G+=a[2];L.vertex[U]=[mL/3,p/3,G/3]}}return L}static BuildGeodesicData(L){const U=new pL("Geodesic-m-n","Geodesic",[[0,LL.d,-1],[-LL.d,1,0],[-1,0,-LL.d],[1,0,-LL.d],[LL.d,1,0],[0,LL.d,1],[-1,0,LL.d],[-LL.d,-1,0],[0,-LL.d,-1],[LL.d,-1,0],[1,0,LL.d],[0,-LL.d,1]],[]);L.setIndices(),L.calcCoeffs(),L.createInnerFacets(),L.edgeVecsABOB(),L.mapABOBtoOBOA(),L.mapABOBtoBAOA();for(let x=0;x<L.IDATA.face.length;x++)L.MapToFace(x,U),U.innerToData(x,L),"B"===L.IDATA.edgematch[x][1]&&U.mapABOBtoDATA(x,L),"O"===L.IDATA.edgematch[x][1]&&U.mapOBOAtoDATA(x,L),"A"===L.IDATA.edgematch[x][3]&&U.mapBAOAtoDATA(x,L);U.orderData(L);return U.vertex=U.vertex.map((function(L){const U=L[0],x=L[1],mL=L[2],p=Math.sqrt(U*U+x*x+mL*mL);return L[0]*=1/p,L[1]*=1/p,L[2]*=1/p,L})),U}}p.e._GoldbergMeshParser=(L,U)=>GL.Parse(L,U);class GL extends p.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(L,U){return void 0===U?(L>this.goldbergData.nbUnsharedFaces-1&&(O.c.Warn("Maximum number of unshared faces used"),L=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+L):(L>11&&(O.c.Warn("Last pole used"),L=11),U>this.goldbergData.nbFacesAtPole-1&&(O.c.Warn("Maximum number of faces at a pole used"),U=this.goldbergData.nbFacesAtPole-1),12+L*this.goldbergData.nbFacesAtPole+U)}_changeGoldbergFaceColors(L){for(let x=0;x<L.length;x++){const U=L[x][0],mL=L[x][1],p=L[x][2];for(let L=U;L<mL+1;L++)this.goldbergData.faceColors[L]=p}const U=[];for(let x=0;x<12;x++)for(let L=0;L<5;L++)U.push(this.goldbergData.faceColors[x].r,this.goldbergData.faceColors[x].g,this.goldbergData.faceColors[x].b,this.goldbergData.faceColors[x].a);for(let x=12;x<this.goldbergData.faceColors.length;x++)for(let L=0;L<6;L++)U.push(this.goldbergData.faceColors[x].r,this.goldbergData.faceColors[x].g,this.goldbergData.faceColors[x].b,this.goldbergData.faceColors[x].a);return U}setGoldbergFaceColors(L){const U=this._changeGoldbergFaceColors(L);this.uL(G.h.ColorKind,U)}updateGoldbergFaceColors(L){const U=this._changeGoldbergFaceColors(L);this.updateVerticesData(G.h.ColorKind,U)}_changeGoldbergFaceUVs(L){const U=this.getVerticesData(G.h.UVKind);for(let x=0;x<L.length;x++){const mL=L[x][0],p=L[x][1],G=L[x][2],F=L[x][3],a=L[x][4],o=[],A=[];let r,h;for(let L=0;L<5;L++)r=G.x+F*Math.cos(a+L*Math.PI/2.5),h=G.y+F*Math.sin(a+L*Math.PI/2.5),r<0&&(r=0),r>1&&(r=1),o.push(r,h);for(let L=0;L<6;L++)r=G.x+F*Math.cos(a+L*Math.PI/3),h=G.y+F*Math.sin(a+L*Math.PI/3),r<0&&(r=0),r>1&&(r=1),A.push(r,h);for(let L=mL;L<Math.min(12,p+1);L++)for(let x=0;x<5;x++)U[10*L+2*x]=o[2*x],U[10*L+2*x+1]=o[2*x+1];for(let L=Math.max(12,mL);L<p+1;L++)for(let x=0;x<6;x++)U[12*L-24+2*x]=A[2*x],U[12*L-23+2*x]=A[2*x+1]}return U}setGoldbergFaceUVs(L){const U=this._changeGoldbergFaceUVs(L);this.uL(G.h.UVKind,U)}updateGoldbergFaceUVs(L){const U=this._changeGoldbergFaceUVs(L);this.updateVerticesData(G.h.UVKind,U)}placeOnGoldbergFaceAt(L,U,x){const p=mL.YU.RotationFromAxis(this.goldbergData.faceXaxis[U],this.goldbergData.faceYaxis[U],this.goldbergData.faceZaxis[U]);L.rotation=p,L.position=this.goldbergData.faceCenters[U].add(this.goldbergData.faceXaxis[U].scale(x.x)).add(this.goldbergData.faceYaxis[U].scale(x.y)).add(this.goldbergData.faceZaxis[U].scale(x.z))}serialize(L){super.serialize(L),L.type="GoldbergMesh";const U={};if(U.adjacentFaces=this.goldbergData.adjacentFaces,U.nbSharedFaces=this.goldbergData.nbSharedFaces,U.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,U.nbFaces=this.goldbergData.nbFaces,U.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){U.faceColors=[];for(const L of this.goldbergData.faceColors)U.faceColors.push(L.Va())}if(this.goldbergData.faceCenters){U.faceCenters=[];for(const L of this.goldbergData.faceCenters)U.faceCenters.push(L.Va())}if(this.goldbergData.faceZaxis){U.faceZaxis=[];for(const L of this.goldbergData.faceZaxis)U.faceZaxis.push(L.Va())}if(this.goldbergData.faceYaxis){U.faceYaxis=[];for(const L of this.goldbergData.faceYaxis)U.faceYaxis.push(L.Va())}if(this.goldbergData.faceXaxis){U.faceXaxis=[];for(const L of this.goldbergData.faceXaxis)U.faceXaxis.push(L.Va())}L.goldbergData=U}static Parse(L,U){const x=L.goldbergData;x.faceColors=x.faceColors.map((L=>b.ia.qU(L))),x.faceCenters=x.faceCenters.map((L=>mL.YU.qU(L))),x.faceZaxis=x.faceZaxis.map((L=>mL.YU.qU(L))),x.faceXaxis=x.faceXaxis.map((L=>mL.YU.qU(L))),x.faceYaxis=x.faceYaxis.map((L=>mL.YU.qU(L)));const p=new GL(L.name,U);return p.goldbergData=x,p}}var FL=x(13158);const aL={CreateBox:h.c,CreateTiledBox:V,CreateSphere:H.e,CreateDisc:r.b,CreateIcoSphere:J,CreateRibbon:A,CreateCylinder:v,CreateTorus:P,CreateTorusKnot:K,CreateLineSystem:l.e,KA:l.f,CreateDashedLines:l.c,ExtrudeShape:t,ExtrudeShapeCustom:y,CreateLathe:N,CreateTiledPlane:Y,XA:e.e,CreateGround:u.f,CreateTiledGround:u.j,CreateGroundFromHeightMap:u.b,CreatePolygon:i.e,ExtrudePolygon:i.g,CreateTube:Z,CreatePolyhedron:z,CreateGeodesic:function(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,mL=U.m||1;mL!==Math.floor(mL)&&(mL=Math.floor(mL),O.c.Warn("m not an integer only floor(m) used"));let p=U.n||0;if(p!==Math.floor(p)&&(p=Math.floor(p),O.c.Warn("n not an integer only floor(n) used")),p>mL){const L=p;p=mL,mL=L,O.c.Warn("n > m therefore m and n swapped")}const G=new xL;return G.build(mL,p),z(L,{custom:pL.BuildGeodesicData(G),size:U.size,sizeX:U.sizeX,sizeY:U.sizeY,sizeZ:U.sizeZ,faceUV:U.faceUV,faceColors:U.faceColors,flat:U.flat,updatable:U.updatable,sideOrientation:U.sideOrientation,frontUVs:U.frontUVs,backUVs:U.backUVs},x)},CreateGoldberg:function(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=U.size,o=U.sizeX||G||1,A=U.sizeY||G||1,r=U.sizeZ||G||1;let h=U.m||1;h!==Math.floor(h)&&(h=Math.floor(h),O.c.Warn("m not an integer only floor(m) used"));let E=U.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),O.c.Warn("n not an integer only floor(n) used")),E>h){const L=E;E=h,h=L,O.c.Warn("n > m therefore m and n swapped")}const Y=new xL;Y.build(h,E);const S=pL.BuildGeodesicData(Y),V=S.toGoldbergPolyhedronData(),H=new GL(L,x);U.sideOrientation=p.e._GetDefaultSideOrientation(U.sideOrientation),H._originalBuilderSideOrientation=U.sideOrientation;(function(L,U){const x=L.size,p=L.sizeX||x||1,G=L.sizeY||x||1,o=L.sizeZ||x||1,A=0===L.sideOrientation?0:L.sideOrientation||F.b.DEFAULTSIDE,r=[],h=[],b=[],E=[];let Y=1/0,S=-1/0,V=1/0,H=-1/0;for(let mL=0;mL<U.vertex.length;mL++)Y=Math.min(Y,U.vertex[mL][0]*p),S=Math.max(S,U.vertex[mL][0]*p),V=Math.min(V,U.vertex[mL][1]*G),H=Math.max(H,U.vertex[mL][1]*G);let Q=0;for(let F=0;F<U.face.length;F++){const L=U.face[F],x=mL.YU.qU(U.vertex[L[0]]),A=mL.YU.qU(U.vertex[L[2]]),q=mL.YU.qU(U.vertex[L[1]]),f=A.SU(x),v=q.SU(x),D=mL.YU.Cross(v,f).normalize();for(let mL=0;mL<L.length;mL++){b.push(D.x,D.y,D.z);const x=U.vertex[L[mL]];r.push(x[0]*p,x[1]*G,x[2]*o);const F=(x[1]*G-V)/(H-V);E.push((x[0]*p-Y)/(S-Y),a.b?1-F:F)}for(let U=0;U<L.length-2;U++)h.push(Q,Q+U+2,Q+U+1);Q+=L.length}F.b._ComputeSides(A,r,h,b,E);const q=new F.b;return q.KL=r,q.indices=h,q.lL=b,q.XL=E,q})(U,V).yL(H,U.updatable),H.goldbergData.nbSharedFaces=S.sharedNodes,H.goldbergData.nbUnsharedFaces=S.poleNodes,H.goldbergData.adjacentFaces=S.adjacentFaces,H.goldbergData.nbFaces=H.goldbergData.nbSharedFaces+H.goldbergData.nbUnsharedFaces,H.goldbergData.nbFacesAtPole=(H.goldbergData.nbUnsharedFaces-12)/12;for(let p=0;p<S.vertex.length;p++)H.goldbergData.faceCenters.push(mL.YU.qU(S.vertex[p])),H.goldbergData.faceCenters[p].x*=o,H.goldbergData.faceCenters[p].y*=A,H.goldbergData.faceCenters[p].z*=r,H.goldbergData.faceColors.push(new b.ia(1,1,1,1));for(let p=0;p<V.face.length;p++){const L=V.face[p],U=mL.YU.qU(V.vertex[L[0]]),x=mL.YU.qU(V.vertex[L[2]]),G=mL.YU.qU(V.vertex[L[1]]),F=x.SU(U),a=G.SU(U),o=mL.YU.Cross(a,F).normalize(),A=mL.YU.Cross(a,o).normalize();H.goldbergData.faceXaxis.push(a.normalize()),H.goldbergData.faceYaxis.push(o),H.goldbergData.faceZaxis.push(A)}return H},CreateDecal:C,CreateCapsule:T,CreateText:FL.f}},13935:(L,U,x)=>{"use strict";x.d(U,{c:()=>aU});var mL=x(12589),p=x(12979);class G extends p.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var F=x(12637),a=(x(12752),x(12547));class o{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(L){this._targetStopDuration!==L&&(this._targetStopDuration=L)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(L){this._noiseTexture!==L&&(this._noiseTexture=L,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(L){this._animationSheetEnabled!==L&&(this._animationSheetEnabled=L)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(L){this._isAnimationSheetEnabled!=L&&(this._isAnimationSheetEnabled=L,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(L){this._useLogarithmicDepth=L&&this.PL().getEngine().getCaps().fragmentDepthSupported}PL(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(L){switch(L){case o.BLENDMODE_MULTIPLYADD:return;case o.BLENDMODE_ADD:L=1;break;case o.BLENDMODE_ONEONE:L=6;break;case o.BLENDMODE_STANDARD:L=2;break;case o.BLENDMODE_MULTIPLY:L=4;break;case o.BLENDMODE_SUBTRACT:L=3}this._engine.setAlphaMode(L)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:mL.YU.Zero()}set direction1(L){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=L)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:mL.YU.Zero()}set direction2(L){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=L)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:mL.YU.Zero()}set minEmitBox(L){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=L)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:mL.YU.Zero()}set maxEmitBox(L){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=L)}get billboardMode(){return this._billboardMode}set billboardMode(L){this._billboardMode!==L&&(this._billboardMode=L,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(L){this._isBillboardBased!==L&&(this._isBillboardBased=L,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(L){this._attachImageProcessingConfiguration(L)}_attachImageProcessingConfiguration(L){L!==this._imageProcessingConfiguration&&(!L&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=L)}_reset(){}_removeGradientAndTexture(L,U,x){if(!U)return this;let mL=0;for(const p of U){if(p.gradient===L){U.splice(mL,1);break}mL++}return x&&x.dispose(),this}constructor(L){this.animations=[],this.renderingGroupId=0,this.mx=mL.YU.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new mL.YU(10,10,10),this.onAnimationEnd=null,this.blendMode=o.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new mL.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.DA=new mL.YU(0,0,0),this._useLogarithmicDepth=!1,this.gravity=mL.YU.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new F.ia(1,1,1,1),this.color2=new F.ia(1,1,1,1),this.colorDead=new F.ia(0,0,0,1),this.textureMask=new F.ia(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new G,this.id=L,this.name=L}createPointEmitter(L,U){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new mL.YU(0,1,0),arguments.length>2&&void 0!==arguments[2]||new mL.YU(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new mL.YU(0,1,0),arguments.length>4&&void 0!==arguments[4]||new mL.YU(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new mL.YU(0,1,0),arguments.length>3&&void 0!==arguments[3]||new mL.YU(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(L,U,x,mL){throw new Error("Method not implemented.")}}o.BLENDMODE_ONEONE=0,o.BLENDMODE_STANDARD=1,o.BLENDMODE_ADD=2,o.BLENDMODE_MULTIPLY=3,o.BLENDMODE_MULTIPLYADD=4,o.BLENDMODE_SUBTRACT=-1,(0,a.d)("BABYLON.BaseParticleSystem",o);var A=x(12610),r=x(12414);class h{constructor(){this.direction1=new mL.YU(0,1,0),this.direction2=new mL.YU(0,1,0),this.minEmitBox=new mL.YU(-.5,-.5,-.5),this.maxEmitBox=new mL.YU(.5,.5,.5)}startDirectionFunction(L,U,x,p){const G=(0,A.RandomRange)(this.direction1.x,this.direction2.x),F=(0,A.RandomRange)(this.direction1.y,this.direction2.y),a=(0,A.RandomRange)(this.direction1.z,this.direction2.z);if(p)return U.x=G,U.y=F,void(U.z=a);mL.YU.TransformNormalFromFloatsToRef(G,F,a,L,U)}startPositionFunction(L,U,x,p){const G=(0,A.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),F=(0,A.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),a=(0,A.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(p)return U.x=G,U.y=F,void(U.z=a);mL.YU.TransformCoordinatesFromFloatsToRef(G,F,a,L,U)}clone(){const L=new h;return r.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2),L.setVector3("minEmitBox",this.minEmitBox),L.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3),L.addUniform("minEmitBox",3),L.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.direction1=this.direction1.Va(),L.direction2=this.direction2.Va(),L.minEmitBox=this.minEmitBox.Va(),L.maxEmitBox=this.maxEmitBox.Va(),L}parse(L){mL.YU.FromArrayToRef(L.direction1,0,this.direction1),mL.YU.FromArrayToRef(L.direction2,0,this.direction2),mL.YU.FromArrayToRef(L.minEmitBox,0,this.minEmitBox),mL.YU.FromArrayToRef(L.maxEmitBox,0,this.maxEmitBox)}}class b{get radius(){return this._radius}set radius(L){this._radius=L,this._buildHeight()}get angle(){return this._angle}set angle(L){this._angle=L,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=x,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=U,this.radius=L}startDirectionFunction(L,U,x,p){p?mL.TmpVectors.YU[0].p(x.Oa).normalize():x.position.subtractToRef(L.getTranslation(),mL.TmpVectors.YU[0]).normalize();const G=(0,A.RandomRange)(0,this.directionRandomizer),F=(0,A.RandomRange)(0,this.directionRandomizer),a=(0,A.RandomRange)(0,this.directionRandomizer);U.x=mL.TmpVectors.YU[0].x+G,U.y=mL.TmpVectors.YU[0].y+F,U.z=mL.TmpVectors.YU[0].z+a,U.normalize()}startPositionFunction(L,U,x,p){const G=(0,A.RandomRange)(0,2*Math.PI);let F;this.emitFromSpawnPointOnly?F=1e-4:(F=(0,A.RandomRange)(0,this.heightRange),F=1-F*F);let a=this._radius-(0,A.RandomRange)(0,this._radius*this.radiusRange);a*=F;const o=a*Math.sin(G),r=a*Math.cos(G),h=F*this._height;if(p)return U.x=o,U.y=h,void(U.z=r);mL.YU.TransformCoordinatesFromFloatsToRef(o,h,r,L,U)}clone(){const L=new b(this._radius,this._angle,this.directionRandomizer);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat2("radius",this._radius,this.radiusRange),L.setFloat("coneAngle",this._angle),L.setFloat2("height",this._height,this.heightRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",2),L.addUniform("coneAngle",1),L.addUniform("height",2),L.addUniform("directionRandomizer",1)}getEffectDefines(){let L="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(L+="\n#define CONEEMITTERSPAWNPOINT"),L}getClassName(){return"ConeParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this._radius,L.angle=this._angle,L.directionRandomizer=this.directionRandomizer,L.radiusRange=this.radiusRange,L.heightRange=this.heightRange,L.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,L}parse(L){this.radius=L.radius,this.angle=L.angle,this.directionRandomizer=L.directionRandomizer,this.radiusRange=void 0!==L.radiusRange?L.radiusRange:1,this.heightRange=void 0!==L.radiusRange?L.heightRange:1,this.emitFromSpawnPointOnly=void 0!==L.emitFromSpawnPointOnly&&L.emitFromSpawnPointOnly}}class E extends b{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0);super(L,U),this.direction1=x,this.direction2=p}startDirectionFunction(L,U){const x=(0,A.RandomRange)(this.direction1.x,this.direction2.x),p=(0,A.RandomRange)(this.direction1.y,this.direction2.y),G=(0,A.RandomRange)(this.direction1.z,this.direction2.z);mL.YU.TransformNormalFromFloatsToRef(x,p,G,L,U)}clone(){const L=new E(this.radius,this.angle,this.direction1,this.direction2);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.Va(),L.direction2=this.direction2.Va(),L}parse(L){super.parse(L),this.direction1.p(L.direction1),this.direction2.p(L.direction2)}}class Y{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=L,this.height=U,this.radiusRange=x,this.directionRandomizer=p,this._tempVector=mL.YU.Zero()}startDirectionFunction(L,U,x,p,G){x.position.subtractToRef(L.getTranslation(),this._tempVector),this._tempVector.normalize(),mL.YU.TransformNormalToRef(this._tempVector,G,this._tempVector);const F=(0,A.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=F,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),p?U.p(this._tempVector):mL.YU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,L,U)}startPositionFunction(L,U,x,p){const G=(0,A.RandomRange)(-this.height/2,this.height/2),F=(0,A.RandomRange)(0,2*Math.PI),a=(0,A.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),o=Math.sqrt(a)*this.radius,r=o*Math.cos(F),h=o*Math.sin(F);p?U.da(r,G,h):mL.YU.TransformCoordinatesFromFloatsToRef(r,G,h,L,U)}clone(){const L=new Y(this.radius,this.directionRandomizer);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("height",this.height),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("height",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.height=this.height,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.height=L.height,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class S extends Y{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new mL.YU(0,1,0);super(L,U,x),this.direction1=p,this.direction2=G}startDirectionFunction(L,U,x,p){const G=(0,A.RandomRange)(this.direction1.x,this.direction2.x),F=(0,A.RandomRange)(this.direction1.y,this.direction2.y),a=(0,A.RandomRange)(this.direction1.z,this.direction2.z);p?U.da(G,F,a):mL.YU.TransformNormalFromFloatsToRef(G,F,a,L,U)}clone(){const L=new S(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("height",this.height),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("height",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.Va(),L.direction2=this.direction2.Va(),L}parse(L){super.parse(L),mL.YU.FromArrayToRef(L.direction1,0,this.direction1),mL.YU.FromArrayToRef(L.direction2,0,this.direction2)}}class V{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=L,this.radiusRange=U,this.directionRandomizer=x}startDirectionFunction(L,U,x,p){const G=x.position.SU(L.getTranslation()).normalize(),F=(0,A.RandomRange)(0,this.directionRandomizer),a=(0,A.RandomRange)(0,this.directionRandomizer),o=(0,A.RandomRange)(0,this.directionRandomizer);G.x+=F,G.y+=a,G.z+=o,G.normalize(),p?U.p(G):mL.YU.TransformNormalFromFloatsToRef(G.x,G.y,G.z,L,U)}startPositionFunction(L,U,x,p){const G=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),F=(0,A.RandomRange)(0,1),a=(0,A.RandomRange)(0,2*Math.PI),o=Math.acos(2*F-1),r=G*Math.cos(a)*Math.sin(o),h=G*Math.cos(o),b=G*Math.sin(a)*Math.sin(o);p?U.da(r,Math.abs(h),b):mL.YU.TransformCoordinatesFromFloatsToRef(r,Math.abs(h),b,L,U)}clone(){const L=new V(this.radius,this.directionRandomizer);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class H{constructor(){this.direction1=new mL.YU(0,1,0),this.direction2=new mL.YU(0,1,0)}startDirectionFunction(L,U,x,p){const G=(0,A.RandomRange)(this.direction1.x,this.direction2.x),F=(0,A.RandomRange)(this.direction1.y,this.direction2.y),a=(0,A.RandomRange)(this.direction1.z,this.direction2.z);p?U.da(G,F,a):mL.YU.TransformNormalFromFloatsToRef(G,F,a,L,U)}startPositionFunction(L,U,x,p){p?U.da(0,0,0):mL.YU.TransformCoordinatesFromFloatsToRef(0,0,0,L,U)}clone(){const L=new H;return r.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.direction1=this.direction1.Va(),L.direction2=this.direction2.Va(),L}parse(L){mL.YU.FromArrayToRef(L.direction1,0,this.direction1),mL.YU.FromArrayToRef(L.direction2,0,this.direction2)}}class Q{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=L,this.radiusRange=U,this.directionRandomizer=x}startDirectionFunction(L,U,x,p){const G=x.position.SU(L.getTranslation()).normalize(),F=(0,A.RandomRange)(0,this.directionRandomizer),a=(0,A.RandomRange)(0,this.directionRandomizer),o=(0,A.RandomRange)(0,this.directionRandomizer);G.x+=F,G.y+=a,G.z+=o,G.normalize(),p?U.p(G):mL.YU.TransformNormalFromFloatsToRef(G.x,G.y,G.z,L,U)}startPositionFunction(L,U,x,p){const G=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),F=(0,A.RandomRange)(0,1),a=(0,A.RandomRange)(0,2*Math.PI),o=Math.acos(2*F-1),r=G*Math.cos(a)*Math.sin(o),h=G*Math.cos(o),b=G*Math.sin(a)*Math.sin(o);p?U.da(r,h,b):mL.YU.TransformCoordinatesFromFloatsToRef(r,h,b,L,U)}clone(){const L=new Q(this.radius,this.directionRandomizer);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class q extends Q{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mL.YU(0,1,0),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0);super(L),this.direction1=U,this.direction2=x}startDirectionFunction(L,U){const x=(0,A.RandomRange)(this.direction1.x,this.direction2.x),p=(0,A.RandomRange)(this.direction1.y,this.direction2.y),G=(0,A.RandomRange)(this.direction1.z,this.direction2.z);mL.YU.TransformNormalFromFloatsToRef(x,p,G,L,U)}clone(){const L=new q(this.radius,this.direction1,this.direction2);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.Va(),L.direction2=this.direction2.Va(),L}parse(L){super.parse(L),this.direction1.p(L.direction1),this.direction2.p(L.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(L,U,x,p){const G=mL.TmpVectors.YU[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,x,G);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,x,G);const L=mL.TmpVectors.YU[1];G.subtractToRef(x.position,L),L.scaleToRef(1/x.lifeTime,G)}else G.set(0,0,0);p?U.p(G):mL.YU.TransformNormalToRef(G,L,U)}startPositionFunction(L,U,x,p){const G=mL.TmpVectors.YU[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,x,G):G.set(0,0,0),p?U.p(G):mL.YU.TransformCoordinatesToRef(G,L,U)}clone(){const L=new f;return r.b.DeepCopy(this,L),L}applyToShader(L){}buildUniformLayout(L){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.particlePositionGenerator=this.particlePositionGenerator,L.particleDestinationGenerator=this.particleDestinationGenerator,L}parse(L){L.particlePositionGenerator&&(this.particlePositionGenerator=L.particlePositionGenerator),L.particleDestinationGenerator&&(this.particleDestinationGenerator=L.particleDestinationGenerator)}}var v=x(12666);class D{get mesh(){return this._mesh}set mesh(L){this._mesh!==L&&(this._mesh=L,L?(this._indices=L.Da(),this._positions=L.getVerticesData(v.h.PositionKind),this._normals=L.getVerticesData(v.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=mL.YU.Zero(),this._mesh=null,this.direction1=new mL.YU(0,1,0),this.direction2=new mL.YU(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=L}startDirectionFunction(L,U,x,p){if(this.useMeshNormalsForDirection&&this._normals)return void mL.YU.TransformNormalToRef(this._storedNormal,L,U);const G=(0,A.RandomRange)(this.direction1.x,this.direction2.x),F=(0,A.RandomRange)(this.direction1.y,this.direction2.y),a=(0,A.RandomRange)(this.direction1.z,this.direction2.z);p?U.da(G,F,a):mL.YU.TransformNormalFromFloatsToRef(G,F,a,L,U)}startPositionFunction(L,U,x,p){if(!this._indices||!this._positions)return;const G=3*(Math.random()*(this._indices.length/3)|0),F=Math.random(),a=Math.random()*(1-F),o=1-F-a,A=this._indices[G],r=this._indices[G+1],h=this._indices[G+2],b=mL.TmpVectors.YU[0],E=mL.TmpVectors.YU[1],Y=mL.TmpVectors.YU[2],S=mL.TmpVectors.YU[3];mL.YU.FromArrayToRef(this._positions,3*A,b),mL.YU.FromArrayToRef(this._positions,3*r,E),mL.YU.FromArrayToRef(this._positions,3*h,Y),S.x=F*b.x+a*E.x+o*Y.x,S.y=F*b.y+a*E.y+o*Y.y,S.z=F*b.z+a*E.z+o*Y.z,p?U.da(S.x,S.y,S.z):mL.YU.TransformCoordinatesFromFloatsToRef(S.x,S.y,S.z,L,U),this.useMeshNormalsForDirection&&this._normals&&(mL.YU.FromArrayToRef(this._normals,3*A,b),mL.YU.FromArrayToRef(this._normals,3*r,E),mL.YU.FromArrayToRef(this._normals,3*h,Y),this._storedNormal.x=F*b.x+a*E.x+o*Y.x,this._storedNormal.y=F*b.y+a*E.y+o*Y.y,this._storedNormal.z=F*b.z+a*E.z+o*Y.z)}clone(){const L=new D(this.mesh);return r.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var L;const U={};return U.type=this.getClassName(),U.direction1=this.direction1.Va(),U.direction2=this.direction2.Va(),U.meshId=null===(L=this.mesh)||void 0===L?void 0:L.id,U.useMeshNormalsForDirection=this.useMeshNormalsForDirection,U}parse(L,U){mL.YU.FromArrayToRef(L.direction1,0,this.direction1),mL.YU.FromArrayToRef(L.direction2,0,this.direction2),L.meshId&&U&&(this.mesh=U.getLastMeshById(L.meshId)),this.useMeshNormalsForDirection=L.useMeshNormalsForDirection}}class P{_isUbo(L){return void 0!==L.addUniform}constructor(L){this._isUbo(L)?(this.setMatrix3x3=L.updateMatrix3x3.bind(L),this.setMatrix2x2=L.updateMatrix2x2.bind(L),this.setFloat=L.updateFloat.bind(L),this.setFloat2=L.updateFloat2.bind(L),this.setFloat3=L.updateFloat3.bind(L),this.setFloat4=L.updateFloat4.bind(L),this.setFloatArray=L.updateFloatArray.bind(L),this.setArray=L.updateArray.bind(L),this.setIntArray=L.updateIntArray.bind(L),this.setMatrix=L.qa.bind(L),this.setMatrices=L.updateMatrices.bind(L),this.setVector3=L.updateVector3.bind(L),this.setVector4=L.updateVector4.bind(L),this.setColor3=L.updateColor3.bind(L),this.setColor4=L.updateColor4.bind(L),this.setDirectColor4=L.updateDirectColor4.bind(L),this.setInt=L.updateInt.bind(L),this.setInt2=L.updateInt2.bind(L),this.setInt3=L.updateInt3.bind(L),this.setInt4=L.updateInt4.bind(L)):(this.setMatrix3x3=L.setMatrix3x3.bind(L),this.setMatrix2x2=L.setMatrix2x2.bind(L),this.setFloat=L.setFloat.bind(L),this.setFloat2=L.setFloat2.bind(L),this.setFloat3=L.setFloat3.bind(L),this.setFloat4=L.setFloat4.bind(L),this.setFloatArray=L.setFloatArray.bind(L),this.setArray=L.setArray.bind(L),this.setIntArray=L.setIntArray.bind(L),this.setMatrix=L.setMatrix.bind(L),this.setMatrices=L.setMatrices.bind(L),this.setVector3=L.setVector3.bind(L),this.setVector4=L.setVector4.bind(L),this.setColor3=L.setColor3.bind(L),this.setColor4=L.setColor4.bind(L),this.setDirectColor4=L.setDirectColor4.bind(L),this.setInt=L.setInt.bind(L),this.setInt2=L.setInt2.bind(L),this.setInt3=L.setInt3.bind(L),this.setInt4=L.setInt4.bind(L))}}var d=x(12496);const K="gpuUpdateParticlesPixelShader",l="#version 300 es\nvoid main() {discard;}\n";d.d.ShadersStore[K]||(d.d.ShadersStore[K]=l);const i="gpuUpdateParticlesVertexShader",X="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";d.d.ShadersStore[i]||(d.d.ShadersStore[i]=X);(0,a.d)("BABYLON.WebGL2ParticleSystem",class{constructor(L,U){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=L,this._engine=U,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var L;return(null===(L=this._updateEffect)||void 0===L?void 0:L.isReady())??!1}createUpdateBuffer(L){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=L,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new P(this._updateEffect)}createVertexBuffers(L,U){this._updateVAO.push(this._createUpdateVAO(L)),this._renderVAO.push(this._engine.recordVertexArrayObject(U,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=U}createParticleBuffer(L){return L}bindDrawBuffers(L,U,x){x?this._engine.bindBuffers(this._renderVertexBuffers,x,U):this._engine.bindVertexArrayObject(this._renderVAO[L],null)}preUpdateParticleBuffer(){const L=this._engine;if(this._engine.enableEffect(this._updateEffect),!L.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(L,U,x){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[L],null);const mL=this._engine;mL.bindTransformFeedbackBuffer(U.getBuffer()),mL.setRasterizerState(!1),mL.beginTransformFeedback(!0),mL.drawArraysType(3,0,x),mL.endTransformFeedback(),mL.setRasterizerState(!0),mL.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let L=0;L<this._updateVAO.length;L++)this._engine.releaseVertexArrayObject(this._updateVAO[L]);this._updateVAO.length=0;for(let L=0;L<this._renderVAO.length;L++)this._engine.releaseVertexArrayObject(this._renderVAO[L]);this._renderVAO.length=0}_createUpdateVAO(L){const U={};U.position=L.createVertexBuffer("position",0,3);let x=3;U.age=L.createVertexBuffer("age",x,1),x+=1,U.size=L.createVertexBuffer("size",x,3),x+=3,U.life=L.createVertexBuffer("life",x,1),x+=1,U.seed=L.createVertexBuffer("seed",x,4),x+=4,U.direction=L.createVertexBuffer("direction",x,3),x+=3,this._parent.particleEmitterType instanceof f&&(U.initialPosition=L.createVertexBuffer("initialPosition",x,3),x+=3),this._parent._colorGradientsTexture||(U.color=L.createVertexBuffer("color",x,4),x+=4),this._parent._isBillboardBased||(U.initialDirection=L.createVertexBuffer("initialDirection",x,3),x+=3),this._parent.noiseTexture&&(U.noiseCoordinates1=L.createVertexBuffer("noiseCoordinates1",x,3),x+=3,U.noiseCoordinates2=L.createVertexBuffer("noiseCoordinates2",x,3),x+=3),this._parent._angularSpeedGradientsTexture?(U.angle=L.createVertexBuffer("angle",x,1),x+=1):(U.angle=L.createVertexBuffer("angle",x,2),x+=2),this._parent._isAnimationSheetEnabled&&(U.cellIndex=L.createVertexBuffer("cellIndex",x,1),x+=1,this._parent.spriteRandomStartCell&&(U.cellStartOffset=L.createVertexBuffer("cellStartOffset",x,1),x+=1));const mL=this._engine.recordVertexArrayObject(U,null,this._updateEffect);return this._engine.bindArrayBuffer(null),mL}});class t{constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,mL=arguments.length>3?arguments[3]:void 0;this._engine=L,this._label=mL,this._engine._storageBuffers.push(this),this._create(U,x)}_create(L,U){this._bufferSize=L,this._creationFlags=U,this._buffer=this._engine.createStorageBuffer(L,U,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(L,U,x){this._buffer&&this._engine.updateStorageBuffer(this._buffer,L,U,x)}async read(L,U,x,mL){return await this._engine.readFromStorageBuffer(this._buffer,L,U,x,mL)}dispose(){const L=this._engine._storageBuffers,U=L.indexOf(this);-1!==U&&(L[U]=L[L.length-1],L.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var y=x(12571),n=x(12574),N=x(12625),e=x(12565),u=x(12890),Z=x(12406),g=x(12529),z=x(12796);class M{constructor(){this._gpuTimeInFrameId=-1,this.counter=new z.e}_addDuration(L,U){L<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==L?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(U,!1),this._gpuTimeInFrameId=L):this.counter.addCount(U,!1))}}var J=x(12475);class j{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=L,this._engine=U,this.uniqueId=u.d.UniqueId,U.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new M),this._engine.getCaps().supportComputeShaders?mL.bindingsMapping?(this._context=U.createComputeContext(),this._shaderPath=x,this._options={bindingsMapping:{},defines:[],...mL}):Z.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):Z.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(L,U){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const mL=this._bindings[L];this._bindings[L]={type:x?0:4,object:U,indexInGroupEntries:null===mL||void 0===mL?void 0:mL.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!mL||mL.object!==U||mL.type!==this._bindings[L].type)}setStorageTexture(L,U){const x=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==U),this._bindings[L]={type:1,object:U,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setExternalTexture(L,U){const x=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==U),this._bindings[L]={type:6,object:U,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setVideoTexture(L,U){return!!U.externalTexture&&(this.setExternalTexture(L,U.externalTexture),!0)}setUniformBuffer(L,U){const x=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==U),this._bindings[L]={type:j._BufferIsDataBuffer(U)?7:2,object:U,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setStorageBuffer(L,U){const x=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==U),this._bindings[L]={type:j._BufferIsDataBuffer(U)?7:3,object:U,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setTextureSampler(L,U){const x=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!x||!U.compareSampler(x.object)),this._bindings[L]={type:5,object:U,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}isReady(){let L=this._effect;for(const p in this._bindings){const L=this._bindings[p],U=L.type,x=L.object;switch(U){case 0:case 4:case 1:if(!x.isReady())return!1;break;case 6:if(!x.isReady())return!1;break}}const U=[],x=this._shaderPath;if(this._options.defines)for(let p=0;p<this._options.defines.length;p++)U.push(this._options.defines[p]);const mL=U.join("\n");return this._cachedDefines!==mL&&(this._cachedDefines=mL,L=this._engine.createComputeEffect(x,{defines:mL,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=L),!!L.isReady()}dispatch(L,U,x){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,L,U,x,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const x=j._BufferIsDataBuffer(L)?L:L.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,x,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const U in this._bindings){const x=this._bindings[U];if(!this._options.bindingsMapping[U])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+U+"'");switch(x.type){case 0:{const mL=this._samplers[U],p=x.object;var L;if(!mL||!p._texture||!mL.compareSampler(p._texture))this._samplers[U]=(new g.c).setParameters(p.wrapU,p.wrapV,p.wrapR,p.anisotropicFilteringLevel,p._texture.samplingMode,null===(L=p._texture)||void 0===L?void 0:L._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const L=x.object;L.getBuffer()!==x.buffer&&(x.buffer=L.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((p=>{(0,J.h)((()=>this.dispatch(L,U,x)),p,void 0,mL)}))}serialize(){const L=N.e.Serialize(this);L.options=this._options,L.shaderPath=this._shaderPath,L.iE={},L.textures={};for(const U in this._bindings){const x=this._bindings[U],mL=x.object;switch(x.type){case 0:case 4:case 1:{const p=mL.serialize();p&&(L.textures[U]=p,L.iE[U]={type:x.type});break}}}return L}static Parse(L,U,x){const mL=N.e.Parse((()=>new j(L.name,U.getEngine(),L.shaderPath,L.options)),L,U,x);for(const p in L.textures){const G=L.iE[p],F=e.e.Parse(L.textures[p],U,x);0===G.type?mL.setTexture(p,F):4===G.type?mL.setTexture(p,F,!1):mL.setStorageTexture(p,F)}return mL}static _BufferIsDataBuffer(L){return void 0!==L.underlyingResource}}(0,y.d)([(0,n.R)()],j.prototype,"name",void 0),(0,y.d)([(0,n.R)()],j.prototype,"fastMode",void 0),(0,a.d)("BABYLON.ComputeShader",j);var R=x(12846);const c="gpuUpdateParticlesComputeShader",W="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";d.d.ShadersStoreWGSL[c]||(d.d.ShadersStoreWGSL[c]=W);(0,a.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(L,U){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=L,this._engine=U}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var L;return(null===(L=this._updateComputeShader)||void 0===L?void 0:L.isReady())??!1}createUpdateBuffer(L){var U;const x={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(x.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(x.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(x.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(x.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(x.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(x.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(x.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new j("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:x,defines:L.split("\n")}),null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=new R.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new P(this._simParamsComputeShader)}createVertexBuffers(L,U){this._renderVertexBuffers.push(U)}createParticleBuffer(L){const U=new t(this._engine,4*L.length,11,"ComputeShaderParticleSystemBuffer");return U.update(L),this._bufferComputeShader.push(U),U.getBuffer()}bindDrawBuffers(L,U,x){this._engine.bindBuffers(this._renderVertexBuffers[L],x,U)}preUpdateParticleBuffer(){}updateParticleBuffer(L,U,x){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[L]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^L]),this._updateComputeShader.dispatch(Math.ceil(x/64))}releaseBuffers(){var L;for(let U=0;U<this._bufferComputeShader.length;++U)this._bufferComputeShader[U].dispose();this._bufferComputeShader.length=0,null===(L=this._simParamsComputeShader)||void 0===L||L.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(L,U,x){this.gradient=L,this.color1=U,this.color2=x}getColorToRef(L){this.color2?F.ia.LerpToRef(this.color1,this.color2,Math.random(),L):L.p(this.color1)}}class w{constructor(L,U){this.gradient=L,this.color=U}}class B{constructor(L,U,x){this.gradient=L,this.factor1=U,this.factor2=x}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class s{static GetCurrentGradient(L,U,x){if(U[0].gradient>L)return void x(U[0],U[0],1);for(let p=0;p<U.length-1;p++){const mL=U[p],G=U[p+1];if(L>=mL.gradient&&L<=G.gradient){return void x(mL,G,(L-mL.gradient)/(G.gradient-mL.gradient))}}const mL=U.length-1;x(U[mL],U[mL],1)}}var C=x(12391),k=x(13078),T=x(12440);class O{constructor(L){this.particleSystem=L,this.position=mL.YU.Zero(),this.direction=mL.YU.Zero(),this.color=new F.ia(0,0,0,0),this.colorStep=new F.ia(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new mL.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new F.ia(0,0,0,0),this._currentColor2=new F.ia(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=O._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let L=this.age,U=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===U?(U=1,L=this._randomCellOffset):L+=this._randomCellOffset);const x=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let mL;mL=this._initialSpriteCellLoop?(0,A.Clamp)(L*U%this.lifeTime/this.lifeTime):(0,A.Clamp)(L*U/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+mL*x|0}_inheritParticleInfoToSubEmitter(L){if(L.particleSystem.mx.position){const U=L.particleSystem.mx;if(U.position.p(this.position),L.inheritDirection){const L=mL.TmpVectors.YU[0];this.direction.normalizeToRef(L),U.setDirection(L,0,Math.PI/2)}}else{L.particleSystem.mx.p(this.position)}this.direction.scaleToRef(L.inheritedVelocityAmount/2,mL.TmpVectors.YU[0]),L.particleSystem._inheritedVelocityOffset.p(mL.TmpVectors.YU[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const L of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(L)}_reset(){this.age=0,this.id=O._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(L){L.position.p(this.position),this._initialDirection?L._initialDirection?L._initialDirection.p(this._initialDirection):L._initialDirection=this._initialDirection.clone():L._initialDirection=null,L.direction.p(this.direction),this.Oa&&(L.Oa?L.Oa.p(this.Oa):L.Oa=this.Oa.clone()),L.color.p(this.color),L.colorStep.p(this.colorStep),L.lifeTime=this.lifeTime,L.age=this.age,L._randomCellOffset=this._randomCellOffset,L.size=this.size,L.scale.p(this.scale),L.angle=this.angle,L.angularSpeed=this.angularSpeed,L.particleSystem=this.particleSystem,L.cellIndex=this.cellIndex,L.id=this.id,L._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(L._currentColorGradient=this._currentColorGradient,L._currentColor1.p(this._currentColor1),L._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(L._currentSizeGradient=this._currentSizeGradient,L._currentSize1=this._currentSize1,L._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(L._currentAngularSpeedGradient=this._currentAngularSpeedGradient,L._currentAngularSpeed1=this._currentAngularSpeed1,L._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(L._currentVelocityGradient=this._currentVelocityGradient,L._currentVelocity1=this._currentVelocity1,L._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(L._currentLimitVelocityGradient=this._currentLimitVelocityGradient,L._currentLimitVelocity1=this._currentLimitVelocity1,L._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(L._currentDragGradient=this._currentDragGradient,L._currentDrag1=this._currentDrag1,L._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(L._initialStartSpriteCellId=this._initialStartSpriteCellId,L._initialEndSpriteCellId=this._initialEndSpriteCellId,L._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(L.remapData&&this.remapData?L.remapData.p(this.remapData):L.remapData=new mL.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(L._randomNoiseCoordinates1?(L._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),L._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(L._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),L._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}O._Count=0;var LL=x(12704),UL=(x(12749),x(12966)),xL=x(12961),mU=x(12837);function pL(L,U){const x=(0,A.RandomRange)(0,1);F.ia.LerpToRef(U.color1,U.color2,x,L.color),U.colorDead.subtractToRef(L.color,U._colorDiff),U._colorDiff.scaleToRef(1/L.lifeTime,L.colorStep)}function GL(L,U){L._currentColorGradient=U._colorGradients[0],L._currentColorGradient.getColorToRef(L.color),L._currentColor1.p(L.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(L._currentColor2):L._currentColor2.p(L.color)}function FL(L,U){const x=U._colorGradients;s.GetCurrentGradient(U._ratio,x,((U,x,mL)=>{U!==L._currentColorGradient&&(L._currentColor1.p(L._currentColor2),x.getColorToRef(L._currentColor2),L._currentColorGradient=U),F.ia.LerpToRef(L._currentColor1,L._currentColor2,mL,L.color)}))}function aL(L,U){L.colorStep.scaleToRef(U._scaledUpdateSpeed,U._scaledColorStep),L.color.addInPlace(U._scaledColorStep),L.color.a<0&&(L.color.a=0)}function oL(L,U){s.GetCurrentGradient(U._ratio,U._angularSpeedGradients,((U,x,mL)=>{U!==L._currentAngularSpeedGradient&&(L._currentAngularSpeed1=L._currentAngularSpeed2,L._currentAngularSpeed2=x.getFactor(),L._currentAngularSpeedGradient=U),L.angularSpeed=(0,A.Lerp)(L._currentAngularSpeed1,L._currentAngularSpeed2,mL)}))}function AL(L,U){L.angle+=L.angularSpeed*U._scaledUpdateSpeed}function rL(L,U){U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,L.direction,L,U.isLocal,U._emitterInverseWorldMatrix)}function hL(L,U){U.startDirectionFunction(U._emitterWorldMatrix,L.direction,L,U.isLocal)}function bL(L,U){L._currentVelocityGradient=U._velocityGradients[0],L._currentVelocity1=L._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?L._currentVelocity2=U._velocityGradients[1].getFactor():L._currentVelocity2=L._currentVelocity1}function EL(L,U){L._currentLimitVelocityGradient=U._limitVelocityGradients[0],L._currentLimitVelocity1=L._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?L._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():L._currentLimitVelocity2=L._currentLimitVelocity1}function YL(L,U){s.GetCurrentGradient(U._ratio,U._velocityGradients,((x,mL,p)=>{x!==L._currentVelocityGradient&&(L._currentVelocity1=L._currentVelocity2,L._currentVelocity2=mL.getFactor(),L._currentVelocityGradient=x),U._directionScale*=(0,A.Lerp)(L._currentVelocity1,L._currentVelocity2,p)}))}function SL(L,U){s.GetCurrentGradient(U._ratio,U._limitVelocityGradients,((x,mL,p)=>{x!==L._currentLimitVelocityGradient&&(L._currentLimitVelocity1=L._currentLimitVelocity2,L._currentLimitVelocity2=mL.getFactor(),L._currentLimitVelocityGradient=x);const G=(0,A.Lerp)(L._currentLimitVelocity1,L._currentLimitVelocity2,p);L.direction.length()>G&&L.direction.scaleInPlace(U.limitVelocityDamping)}))}function VL(L,U){L.direction.scaleToRef(U._directionScale,U._scaledDirection)}function HL(L,U){U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,L.position,L,U.isLocal)}function QL(L,U){U.startPositionFunction(U._emitterWorldMatrix,L.position,L,U.isLocal)}function qL(L,U){L.Oa?L.Oa.p(L.position):L.Oa=L.position.clone(),mL.YU.TransformCoordinatesToRef(L.Oa,U._emitterWorldMatrix,L.position)}function fL(L,U){U.isLocal&&L.Oa?(L.Oa.addInPlace(U._scaledDirection),mL.YU.TransformCoordinatesToRef(L.Oa,U._emitterWorldMatrix,L.position)):L.position.addInPlace(U._scaledDirection)}function vL(L,U){L._currentDragGradient=U._dragGradients[0],L._currentDrag1=L._currentDragGradient.getFactor(),U._dragGradients.length>1?L._currentDrag2=U._dragGradients[1].getFactor():L._currentDrag2=L._currentDrag1}function DL(L,U){s.GetCurrentGradient(U._ratio,U._dragGradients,((x,mL,p)=>{x!==L._currentDragGradient&&(L._currentDrag1=L._currentDrag2,L._currentDrag2=mL.getFactor(),L._currentDragGradient=x);const G=(0,A.Lerp)(L._currentDrag1,L._currentDrag2,p);U._scaledDirection.scaleInPlace(1-G)}))}function PL(L,U){L._randomNoiseCoordinates1?(L._randomNoiseCoordinates1.da(Math.random(),Math.random(),Math.random()),L._randomNoiseCoordinates2.da(Math.random(),Math.random(),Math.random())):(L._randomNoiseCoordinates1=new mL.YU(Math.random(),Math.random(),Math.random()),L._randomNoiseCoordinates2=new mL.YU(Math.random(),Math.random(),Math.random()))}function dL(L,U){const x=U._noiseTextureData,p=U._noiseTextureSize;if(x&&p&&L._randomNoiseCoordinates1){const G=U._fetchR(L._randomNoiseCoordinates1.x,L._randomNoiseCoordinates1.y,p.width,p.height,x),F=U._fetchR(L._randomNoiseCoordinates1.z,L._randomNoiseCoordinates2.x,p.width,p.height,x),a=U._fetchR(L._randomNoiseCoordinates2.y,L._randomNoiseCoordinates2.z,p.width,p.height,x),o=mL.TmpVectors.YU[0],A=mL.TmpVectors.YU[1];o.da((2*G-1)*U.noiseStrength.x,(2*F-1)*U.noiseStrength.y,(2*a-1)*U.noiseStrength.z),o.scaleToRef(U._tempScaledUpdateSpeed,A),L.direction.addInPlace(A)}}function KL(L,U){U.gravity.scaleToRef(U._tempScaledUpdateSpeed,U._scaledGravity),L.direction.addInPlace(U._scaledGravity)}function lL(L,U){L.size=(0,A.RandomRange)(U.minSize,U.maxSize),L.scale.da((0,A.RandomRange)(U.minScaleX,U.maxScaleX),(0,A.RandomRange)(U.minScaleY,U.maxScaleY))}function iL(L,U){L._currentSizeGradient=U._sizeGradients[0],L._currentSize1=L._currentSizeGradient.getFactor(),L.size=L._currentSize1,U._sizeGradients.length>1?L._currentSize2=U._sizeGradients[1].getFactor():L._currentSize2=L._currentSize1,L.scale.da((0,A.RandomRange)(U.minScaleX,U.maxScaleX),(0,A.RandomRange)(U.minScaleY,U.maxScaleY))}function XL(L,U){const x=U._actualFrame/U.targetStopDuration;s.GetCurrentGradient(x,U._startSizeGradients,((x,mL,p)=>{x!==U._currentStartSizeGradient&&(U._currentStartSize1=U._currentStartSize2,U._currentStartSize2=mL.getFactor(),U._currentStartSizeGradient=x);const G=(0,A.Lerp)(U._currentStartSize1,U._currentStartSize2,p);L.scale.scaleInPlace(G)}))}function tL(L,U){s.GetCurrentGradient(U._ratio,U._sizeGradients,((U,x,mL)=>{U!==L._currentSizeGradient&&(L._currentSize1=L._currentSize2,L._currentSize2=x.getFactor(),L._currentSizeGradient=U),L.size=(0,A.Lerp)(L._currentSize1,L._currentSize2,mL)}))}function yL(L,U){L.remapData=new mL.Vector4(0,1,0,1)}function nL(L,U){U._colorRemapGradients&&U._colorRemapGradients.length>0&&s.GetCurrentGradient(U._ratio,U._colorRemapGradients,((U,x,mL)=>{const p=(0,A.Lerp)(U.factor1,x.factor1,mL),G=(0,A.Lerp)(U.factor2,x.factor2,mL);L.remapData.x=p,L.remapData.y=G-p})),U._alphaRemapGradients&&U._alphaRemapGradients.length>0&&s.GetCurrentGradient(U._ratio,U._alphaRemapGradients,((U,x,mL)=>{const p=(0,A.Lerp)(U.factor1,x.factor1,mL),G=(0,A.Lerp)(U.factor2,x.factor2,mL);L.remapData.z=p,L.remapData.w=G-p}))}function NL(L,U){const x=(0,A.Clamp)(U._actualFrame/U.targetStopDuration);s.GetCurrentGradient(x,U._lifeTimeGradients,((U,mL)=>{const p=U,G=mL,F=p.getFactor(),a=G.getFactor(),o=(x-p.gradient)/(G.gradient-p.gradient);L.lifeTime=(0,A.Lerp)(F,a,o)})),U._emitPower=(0,A.RandomRange)(U.minEmitPower,U.maxEmitPower)}function eL(L,U){L.lifeTime=(0,A.RandomRange)(U.minLifeTime,U.maxLifeTime),U._emitPower=(0,A.RandomRange)(U.minEmitPower,U.maxEmitPower)}function uL(L,U){0===U._emitPower?(L._initialDirection?L._initialDirection.p(L.direction):L._initialDirection=L.direction.clone(),L.direction.set(0,0,0)):(L._initialDirection=null,L.direction.scaleInPlace(U._emitPower)),L.direction.addInPlace(U._inheritedVelocityOffset)}function ZL(L,U){L.angularSpeed=(0,A.RandomRange)(U.minAngularSpeed,U.maxAngularSpeed),L.angle=(0,A.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function gL(L,U){L._currentAngularSpeedGradient=U._angularSpeedGradients[0],L.angularSpeed=L._currentAngularSpeedGradient.getFactor(),L._currentAngularSpeed1=L.angularSpeed,U._angularSpeedGradients.length>1?L._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():L._currentAngularSpeed2=L._currentAngularSpeed1,L.angle=(0,A.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function zL(L,U){L._initialStartSpriteCellId=U.startSpriteCellID,L._initialEndSpriteCellId=U.endSpriteCellID,L._initialSpriteCellLoop=U.spriteCellLoop}function ML(L,U){L.previousItem=U.previousItem,L.nextItem=U,U.previousItem&&(U.previousItem.nextItem=L),U.previousItem=L}function JL(L,U){L.previousItem=U,L.nextItem=U.nextItem,U.nextItem&&(U.nextItem.previousItem=L),U.nextItem=L}function jL(L,U){let x=U;for(;x.nextItem;)x=x.nextItem;L.previousItem=x,L.nextItem=x.nextItem,x.nextItem=L}function RL(L){L.previousItem&&(L.previousItem.nextItem=L.nextItem),L.nextItem&&(L.nextItem.previousItem=L.previousItem)}class cL extends o{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(L){this._startDirectionFunction!==L&&(this._startDirectionFunction=L,this._directionProcessing.process=L?hL:rL)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(L){this._startPositionFunction!==L&&(this._startPositionFunction=L,this._positionCreation.process=L?QL:HL)}set onDispose(L){this._onDisposeObserver&&this.oa.remove(this._onDisposeObserver),this._onDisposeObserver=this.oa.add(L)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(L){this._useRampGradients!==L&&(this._useRampGradients=L,this._resetEffect(),L?(this._rampCreation={process:yL,previousItem:null,nextItem:null},JL(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:nL,previousItem:null,nextItem:null},JL(this._remapGradientProcessing,this._gravityProcessing)):(RL(this._rampCreation),RL(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(L){this._isLocal!==L&&(this._isLocal=L,L?(this._isLocalCreation={process:qL,previousItem:null,nextItem:null},JL(this._isLocalCreation,this._positionCreation)):RL(this._isLocalCreation))}get particles(){return this.DE}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(L){this._animationSheetEnabled!==L&&(this._animationSheetEnabled=L,L?(this._sheetCreation={process:zL,previousItem:null,nextItem:null},JL(this._sheetCreation,this._colorCreation)):RL(this._sheetCreation),this._reset())}getActiveCount(){return this.DE.length}getClassName(){return"ua"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var L;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(L=this._customWrappers[U])||void 0===L?void 0:L.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[L]??this._customWrappers[0]}setCustomEffect(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new LL.e(this._engine),this._customWrappers[U].effect=L,this._customWrappers[U].drawContext&&(this._customWrappers[U].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(L){if(this.noiseTexture!==L){if(this._noiseTexture=L,!L)return RL(this._noiseCreation),void RL(this._noiseProcessing);this._noiseCreation={process:PL,previousItem:null,nextItem:null},JL(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:dL,previousItem:null,nextItem:null},JL(this._noiseProcessing,this._positionProcessing)}}constructor(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(L),this._emitterInverseWorldMatrix=mL.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new mL.YU,this.oa=new C.c,this.onStoppedObservable=new C.c,this.onStartedObservable=new C.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.DE=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new F.ia(0,0,0,0),this._colorDiff=new F.ia(0,0,0,0),this._scaledDirection=mL.YU.Zero(),this._scaledGravity=mL.YU.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=L=>{},this.recycleParticle=L=>{const U=this.DE.pop();U!==L&&U.copyTo(L),this._stockParticles.push(U)},this._createParticle=()=>{let L;return 0!==this._stockParticles.length?(L=this._stockParticles.pop(),L._reset()):L=new O(this),this._prepareParticle(L),L},this.paused=!1,this._shadersLoaded=!1,this._capacity=U,this._epsilon=a,x&&"Scene"!==x.getClassName()?(this._engine=x,this.defaultProjectionMatrix=mL.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=x||T.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fE.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:eL,previousItem:null,nextItem:null},this._positionCreation={process:HL,previousItem:null,nextItem:null},JL(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:rL,previousItem:null,nextItem:null},JL(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:uL,previousItem:null,nextItem:null},JL(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:lL,previousItem:null,nextItem:null},JL(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:ZL,previousItem:null,nextItem:null},JL(this._angleCreation,this._sizeCreation),this._colorCreation={process:pL,previousItem:null,nextItem:null},JL(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,o||(this._colorProcessing={process:aL,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:AL,previousItem:null,nextItem:null},JL(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:VL,previousItem:null,nextItem:null},JL(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:fL,previousItem:null,nextItem:null},JL(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:KL,previousItem:null,nextItem:null},JL(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=G,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new LL.e(this._engine)},this._customWrappers[0].effect=p,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new h,this.updateFunction=L=>{var U;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(U=this.noiseTexture.getContent())||void 0===U||U.then((L=>{this._noiseTextureData=L})));const x=L===this.DE;for(let mL=0;mL<L.length;mL++){const U=L[mL];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const p=U.age;if(U.age+=this._tempScaledUpdateSpeed,U.age>U.lifeTime){const L=U.age-p,x=U.lifeTime-p;this._tempScaledUpdateSpeed=x*this._tempScaledUpdateSpeed/L,U.age=U.lifeTime}this._ratio=U.age/U.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let G=this._updateQueueStart;for(;G;)G.process(U,this),G=G.nextItem;if(this._isAnimationSheetEnabled&&!o&&U.updateCellIndex(),U._inheritParticleInfoToSubEmitters(),U.age>=U.lifeTime){if(this._emitFromParticle(U),U._attachedSubEmitters){for(const L of U._attachedSubEmitters)L.particleSystem.disposeOnStop=!0,L.particleSystem.stop();U._attachedSubEmitters=null}this.recycleParticle(U),x&&mL--}else;}}}serialize(L){throw new Error("Method not implemented.")}clone(L,U){throw new Error("Method not implemented.")}_addFactorGradient(L,U,x,mL){const p=new B(U,x,mL);L.push(p),L.sort(((L,U)=>L.gradient<U.gradient?-1:L.gradient>U.gradient?1:0))}_removeFactorGradient(L,U){if(!L)return;let x=0;for(const mL of L){if(mL.gradient===U){L.splice(x,1);break}x++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=NL:this._lifeTimeCreation.process=eL}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:XL,previousItem:null,nextItem:null},JL(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(RL(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(L){this.targetStopDuration!==L&&(this._targetStopDuration=L,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(L,U,x){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,L,U,x),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(L){return this._removeFactorGradient(this._lifeTimeGradients,L),this._syncLifeTimeCreation(),this}addSizeGradient(L,U,x){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=iL,this._sizeGradientProcessing={process:tL,previousItem:null,nextItem:null},ML(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,L,U,x),this}removeSizeGradient(L){var U;return this._removeFactorGradient(this._sizeGradients,L),0===(null===(U=this._sizeGradients)||void 0===U?void 0:U.length)&&(RL(this._sizeGradientProcessing),this._sizeCreation.process=lL),this}addColorRemapGradient(L,U,x){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,L,U,x),this}removeColorRemapGradient(L){return this._removeFactorGradient(this._colorRemapGradients,L),this}addAlphaRemapGradient(L,U,x){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,L,U,x),this}removeAlphaRemapGradient(L){return this._removeFactorGradient(this._alphaRemapGradients,L),this}addAngularSpeedGradient(L,U,x){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=gL,this._angularSpeedGradientProcessing={process:oL,previousItem:null,nextItem:null},ML(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,L,U,x),this}removeAngularSpeedGradient(L){var U;return this._removeFactorGradient(this._angularSpeedGradients,L),0===(null===(U=this._angularSpeedGradients)||void 0===U?void 0:U.length)&&(this._angleCreation.process=ZL,RL(this._angularSpeedGradientProcessing)),this}addVelocityGradient(L,U,x){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:bL,previousItem:null,nextItem:null},JL(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:YL,previousItem:null,nextItem:null},ML(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,L,U,x),this}removeVelocityGradient(L){var U;return this._removeFactorGradient(this._velocityGradients,L),0===(null===(U=this._velocityGradients)||void 0===U?void 0:U.length)&&(RL(this._velocityCreation),RL(this._velocityGradientProcessing)),this}addLimitVelocityGradient(L,U,x){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:EL,previousItem:null,nextItem:null},JL(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:SL,previousItem:null,nextItem:null},JL(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,L,U,x),this}removeLimitVelocityGradient(L){var U;return this._removeFactorGradient(this._limitVelocityGradients,L),0===(null===(U=this._limitVelocityGradients)||void 0===U?void 0:U.length)&&(RL(this._limitVelocityCreation),RL(this._limitVelocityGradientProcessing)),this}addDragGradient(L,U,x){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:vL,previousItem:null,nextItem:null},ML(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:DL,previousItem:null,nextItem:null},ML(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,L,U,x),this}removeDragGradient(L){var U;return this._removeFactorGradient(this._dragGradients,L),0===(null===(U=this._dragGradients)||void 0===U?void 0:U.length)&&(RL(this._dragCreation),RL(this._dragGradientProcessing)),this}addEmitRateGradient(L,U,x){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,L,U,x),this}removeEmitRateGradient(L){return this._removeFactorGradient(this._emitRateGradients,L),this}addStartSizeGradient(L,U,x){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,L,U,x),this._syncStartSizeCreation(),this}removeStartSizeGradient(L){return this._removeFactorGradient(this._startSizeGradients,L),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const L=new Uint8Array(4*this._rawTextureWidth),U=F.TmpColors.QU[0];for(let x=0;x<this._rawTextureWidth;x++){const mL=x/this._rawTextureWidth;s.GetCurrentGradient(mL,this._rampGradients,((mL,p,G)=>{F.QU.LerpToRef(mL.color,p.color,G,U),L[4*x]=255*U.r,L[4*x+1]=255*U.g,L[4*x+2]=255*U.b,L[4*x+3]=255}))}this._rampGradientsTexture=k.b.CreateRGBATexture(L,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((L,U)=>L.gradient<U.gradient?-1:L.gradient>U.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(L,U){this._rampGradients||(this._rampGradients=[]);const x=new w(L,U);return this._rampGradients.push(x),this._syncRampGradientTexture(),this}removeRampGradient(L){return this._removeGradientAndTexture(L,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(L,U,x){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=GL,this._colorProcessing.process=FL);const mL=new I(L,U,x);return this._colorGradients.push(mL),this._colorGradients.sort(((L,U)=>L.gradient<U.gradient?-1:L.gradient>U.gradient?1:0)),this}removeColorGradient(L){if(!this._colorGradients)return this;let U=0;for(const x of this._colorGradients){if(x.gradient===L){this._colorGradients.splice(U,1);break}U++}return 0===this._colorGradients.length&&(this._colorCreation.process=pL,this._colorProcessing.process=aL),this}resetDrawCache(){if(this._drawWrappers){for(const L of this._drawWrappers)if(L)for(const U of L)null===U||void 0===U||U.dispose();this._drawWrappers=[]}}_fetchR(L,U,x,mL,p){return p[4*(((L=.5*Math.abs(L)+.5)*x%x|0)+((U=.5*Math.abs(U)+.5)*mL%mL|0)*x)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const L=this._engine,U=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*U),this._vertexBuffer=new v.d(L,this._vertexData,!0,U);let x=0;const mL=this._vertexBuffer.createVertexBuffer(v.h.PositionKind,x,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[v.h.PositionKind]=mL,x+=3;const p=this._vertexBuffer.createVertexBuffer(v.h.ColorKind,x,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[v.h.ColorKind]=p,x+=4;const G=this._vertexBuffer.createVertexBuffer("angle",x,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=G,x+=1;const F=this._vertexBuffer.createVertexBuffer("size",x,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=F,x+=2,this._isAnimationSheetEnabled){const L=this._vertexBuffer.createVertexBuffer("cellIndex",x,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=L,x+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const L=this._vertexBuffer.createVertexBuffer("direction",x,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=L,x+=3}if(this._useRampGradients){const L=this._vertexBuffer.createVertexBuffer("remapData",x,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=L,x+=4}let a;if(this._useInstancing){const U=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new v.d(L,U,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",x,2,this._vertexBufferSize,this._useInstancing),x+=2;this._vertexBuffers.offset=a,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const L=[],U=[];let x=0;for(let mL=0;mL<this._capacity;mL++)L.push(x),L.push(x+1),L.push(x+2),L.push(x),L.push(x+2),L.push(x+3),U.push(x,x+1,x+1,x+2,x+2,x+3,x+3,x,x,x+3),x+=4;this._indexBuffer=this._engine.createIndexBuffer(L),this._linesIndexBuffer=this._engine.createIndexBuffer(U)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(L)setTimeout((()=>{this.start(0)}),L);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var U;-1!==(null===(U=this.mx)||void 0===U?void 0:U.getClassName().indexOf("Mesh"))&&this.mx.fa(!0);const L=this.noiseTexture;if(L&&L.onGeneratedObservable)L.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),L.render()}))}));else for(let U=0;U<this.preWarmCycles;U++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(L))}_postStop(L){}reset(){this._stockParticles.length=0,this.DE.length=0}_appendParticleVertex(L,U,x,p){let G=L*this._vertexBufferSize;if(this._vertexData[G++]=U.position.x+this.DA.x,this._vertexData[G++]=U.position.y+this.DA.y,this._vertexData[G++]=U.position.z+this.DA.z,this._vertexData[G++]=U.color.r,this._vertexData[G++]=U.color.g,this._vertexData[G++]=U.color.b,this._vertexData[G++]=U.color.a,this._vertexData[G++]=U.angle,this._vertexData[G++]=U.scale.x*U.size,this._vertexData[G++]=U.scale.y*U.size,this._isAnimationSheetEnabled&&(this._vertexData[G++]=U.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[G++]=U.direction.x,this._vertexData[G++]=U.direction.y,this._vertexData[G++]=U.direction.z);else if(U._initialDirection){let L=U._initialDirection;this.isLocal&&(mL.YU.TransformNormalToRef(L,this._emitterWorldMatrix,mL.TmpVectors.YU[0]),L=mL.TmpVectors.YU[0]),0===L.x&&0===L.z&&(L.x=.001),this._vertexData[G++]=L.x,this._vertexData[G++]=L.y,this._vertexData[G++]=L.z}else{let L=U.direction;this.isLocal&&(mL.YU.TransformNormalToRef(L,this._emitterWorldMatrix,mL.TmpVectors.YU[0]),L=mL.TmpVectors.YU[0]),0===L.x&&0===L.z&&(L.x=.001),this._vertexData[G++]=L.x,this._vertexData[G++]=L.y,this._vertexData[G++]=L.z}this._useRampGradients&&U.remapData&&(this._vertexData[G++]=U.remapData.x,this._vertexData[G++]=U.remapData.y,this._vertexData[G++]=U.remapData.z,this._vertexData[G++]=U.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===x?x=this._epsilon:1===x&&(x=1-this._epsilon),0===p?p=this._epsilon:1===p&&(p=1-this._epsilon)),this._vertexData[G++]=x,this._vertexData[G++]=p)}_prepareParticle(L){}_createNewOnes(L){let U;for(let x=0;x<L&&this.DE.length!==this._capacity;x++){U=this._createParticle(),this.DE.push(U);let L=this._createQueueStart;for(;L;)L.process(U,this),L=L.nextItem;U._inheritParticleInfoToSubEmitters()}}_update(L){if(this._alive=this.DE.length>0,this.mx.position){const L=this.mx;this._emitterWorldMatrix=L.getWorldMatrix()}else{const L=this.mx;this._emitterWorldMatrix=mL.Matrix.Translation(L.x,L.y,L.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.DE),this._createNewOnes(L)}static _GetAttributeNamesOrOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const mL=[v.h.PositionKind,v.h.ColorKind,"angle","offset","size"];return L&&mL.push("cellIndex"),U||mL.push("direction"),x&&mL.push("remapData"),mL}static _GetEffectCreationOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const mL=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,UL.e)(mL),L&&mL.push("particlesInfos"),U&&mL.push("logarithmicDepthConstant"),x&&(mL.push("vFogInfos"),mL.push("vFogColor")),mL}fillDefines(L,U){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UL.o)(this,this._scene,L),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&L.push("#define FOG")),this._isAnimationSheetEnabled&&L.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&L.push("#define LOGARITHMICDEPTH"),U===o.BLENDMODE_MULTIPLY&&L.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&L.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(L.push("#define BILLBOARD"),this.billboardMode){case 2:L.push("#define BILLBOARDY");break;case 8:case 9:L.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&L.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:L.push("#define BILLBOARDMODE_ALL")}x&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),L.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(L,U,x){U.push(...cL._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),L.push(...cL._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),x.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,mU.d)(L,this._imageProcessingConfigurationDefines),(0,mU.c)(x,this._imageProcessingConfigurationDefines))}_getWrapper(L){const U=this._getCustomDrawWrapper(L);if(null!==U&&void 0!==U&&U.effect)return U;const x=[];this.fillDefines(x,L);const mL=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let p=this._drawWrappers[mL];p||(p=this._drawWrappers[mL]=[]);let G=p[L];G||(G=new LL.e(this._engine),G.drawContext&&(G.drawContext.useInstancing=this._useInstancing),p[L]=G);const F=x.join("\n");if(G.defines!==F){const L=[],U=[],x=[];this.fillUniformsAttributesAndSamplerNames(U,L,x),G.setEffect(this._engine.createEffect("particles",L,U,x,F,void 0,void 0,void 0,void 0,this._shaderLanguage),F)}return G}animate(){var L;let U,x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!x&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(x?this.preWarmStepOffset:(null===(L=this._scene)||void 0===L?void 0:L.getAnimationRatio())||1),this.manualEmitCount>-1)U=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let L=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const U=this._actualFrame/this.targetStopDuration;s.GetCurrentGradient(U,this._emitRateGradients,((U,x,mL)=>{U!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=x.getFactor(),this._currentEmitRateGradient=U),L=(0,A.Lerp)(this._currentEmitRate1,this._currentEmitRate2,mL)}))}U=L*this._scaledUpdateSpeed|0,this._newPartsExcess+=L*this._scaledUpdateSpeed-U}if(this._newPartsExcess>1&&(U+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?U=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(U),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!x){let L=0;for(let U=0;U<this.DE.length;U++){const x=this.DE[U];this._appendParticleVertices(L,x),L+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.DE.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(L,U){this._appendParticleVertex(L++,U,0,0),this._useInstancing||(this._appendParticleVertex(L++,U,1,0),this._appendParticleVertex(L++,U,1,1),this._appendParticleVertex(L++,U,0,1))}rebuild(){var L;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(L=this._spriteBuffer)||void 0===L||L._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!cL.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(x.bind(x,14114)),Promise.resolve().then(x.bind(x,14059))])):await Promise.all([Promise.resolve().then(x.bind(x,14048)),Promise.resolve().then(x.bind(x,14036))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.mx||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==o.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(o.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(o.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(L){const U=this._getWrapper(L),x=U.effect,p=this._engine;p.enableEffect(U);const G=this.defaultViewMatrix??this._scene.getViewMatrix();if(x.setTexture("diffuseSampler",this.particleTexture),x.setMatrix("view",G),x.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const L=this.particleTexture.getBaseSize();x.setFloat3("particlesInfos",this.spriteCellWidth/L.width,this.spriteCellHeight/L.height,this.spriteCellWidth/L.width)}if(x.setVector2("translationPivot",this.translationPivot),x.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const L=this._scene.activeCamera;x.setVector3("eyePosition",L.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),x.setTexture("rampSampler",this._rampGradientsTexture));const F=x.defines;var a,o,A,r,h,b;(this._scene&&((0,UL.i)(x,this,this._scene),this.applyFog&&(0,xL.f)(this._scene,void 0,x)),F.indexOf("#define BILLBOARDMODE_ALL")>=0&&(G.invertToRef(mL.TmpVectors.Matrix[0]),x.setMatrix("invView",mL.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?p.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,x):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,x)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?p.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBuffer:this._indexBuffer,x):p.bindBuffers(this._vertexBuffers,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:null,x);(this.useLogarithmicDepth&&this._scene&&(0,xL.l)(F,x,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(x),this._setEngineBasedOnBlendMode(L),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(x),this._useInstancing)?null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?p.drawElementsType(6,0,10,this.DE.length):p.drawArraysType(7,0,4,this.DE.length):null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?p.drawElementsType(1,0,10*this.DE.length):p.drawElementsType(0,0,6*this.DE.length);return this.DE.length}render(){if(!this.isReady()||!this.DE.length)return 0;const L=this._engine;L.setState&&(L.setState(!1),this.forceDepthWrite&&L.setDepthWrite(!0));let U=0;return U=this.blendMode===o.BLENDMODE_MULTIPLYADD?this._render(o.BLENDMODE_MULTIPLY)+this._render(o.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),U}_onDispose(){}dispose(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),L&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),L&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(U,x),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const L=this._scene.fE.indexOf(this);L>-1&&this._scene.fE.splice(L,1),this._scene._activeParticleSystems.dispose()}this.oa.notifyObservers(this),this.oa.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}cL.ForceGLSL=!1;var WL,IL=x(12426);!function(L){L[L.ATTACHED=0]="ATTACHED",L[L.END=1]="END"}(WL||(WL={}));class wL{constructor(L){if(this.particleSystem=L,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!L.mx||!L.mx.dispose){const U=(0,a.b)("BABYLON.AbstractMesh");L.mx=new U("SubemitterSystemEmitter",L.PL()),L._disposeEmitterOnDispose=!0}}clone(){let L=this.particleSystem.mx;if(L){if(L instanceof mL.YU)L=L.clone();else if(-1!==L.getClassName().indexOf("Mesh")){L=new((0,a.b)("BABYLON.Mesh"))("",L.PL()),L.isVisible=!1}}else L=new mL.YU;const U=new wL(this.particleSystem.clone(this.particleSystem.name,L));return U.particleSystem.name+="Clone",U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem._disposeEmitterOnDispose=!0,U.particleSystem.disposeOnStop=!0,U}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem=this.particleSystem.serialize(L),U}static _ParseParticleSystem(L,U,x){throw(0,IL.c)("ParseParticle")}static Parse(L,U,x){const mL=L.particleSystem,p=new wL(wL._ParseParticleSystem(mL,U,x,!0));return p.type=L.type,p.inheritDirection=L.inheritDirection,p.inheritedVelocityAmount=L.inheritedVelocityAmount,p.particleSystem._isSubEmitter=!0,p}dispose(){this.particleSystem.dispose()}}var BL=x(12479);function sL(L,U){const x=new H;return x.direction1=L,x.direction2=U,x}function CL(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function kL(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function TL(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mL.YU(0,1,0),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0);return new q(L,U,x)}function OL(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function LU(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new mL.YU(0,1,0);return new S(L,U,x,p,G)}function UU(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new b(L,U)}function xU(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0);return new E(L,U,x,p)}const mx=mL.YU.Zero(),pU=mL.YU.Zero(),GU=mL.YU.Zero();class FU{constructor(){this.strength=0,this.position=mL.YU.Zero()}_processParticle(L,U){this.position.subtractToRef(L.position,mx);const x=mx.lengthSquared()+1;mx.normalize().scaleToRef(this.strength/x,pU),pU.scaleToRef(U._tempScaledUpdateSpeed,GU),L.direction.addInPlace(GU)}serialize(){return{position:this.position.Va(),strength:this.strength}}}class aU extends cL{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=L=>{if(!this._subEmitters||0===this._subEmitters.length)return;const U=Math.floor(Math.random()*this._subEmitters.length);for(const x of this._subEmitters[U])if(1===x.type){const U=x.clone();L._inheritParticleInfoToSubEmitter(U),U.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(U.particleSystem),U.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(L,U){const x=sL(L,U);return this.particleEmitterType=x,x}get flowMap(){return this._flowMap}set flowMap(L){this._flowMap!==L&&(this._flowMap=L,this._flowMapUpdate&&(RL(this._flowMapUpdate),this._flowMapUpdate=null),L&&(this._flowMapUpdate={process:L=>{var U;const x=null===(U=this.PL())||void 0===U?void 0:U.getTransformMatrix();this._flowMap._processParticle(L,this.flowMapStrength*this._tempScaledUpdateSpeed,x)},previousItem:null,nextItem:null},JL(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(L){this._attractors.push(L),1===this._attractors.length&&(this._attractorUpdate={process:L=>{for(const U of this._attractors)U._processParticle(L,this)},previousItem:null,nextItem:null},JL(this._attractorUpdate,this._directionProcessing))}removeAttractor(L){const U=this._attractors.indexOf(L);-1!==U&&this._attractors.splice(U,1),0===this._attractors.length&&RL(this._attractorUpdate)}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(L)}createHemisphericEmitter(){const L=CL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createSphereEmitter(){const L=kL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createDirectedSphereEmitter(){const L=TL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mL.YU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0));return this.particleEmitterType=L,L}createCylinderEmitter(){const L=OL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=L,L}createDirectedCylinderEmitter(){const L=LU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new mL.YU(0,1,0));return this.particleEmitterType=L,L}createConeEmitter(){const L=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=L,L}createDirectedConeEmitter(){const L=xU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0));return this.particleEmitterType=L,L}createBoxEmitter(L,U,x,mL){const p=new h;return this.particleEmitterType=p,this.direction1=L,this.direction2=U,this.minEmitBox=x,this.maxEmitBox=mL,p}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const L of this.subEmitters)L instanceof aU?this._subEmitters.push([new wL(L)]):L instanceof wL?this._subEmitters.push([L]):L instanceof Array&&this._subEmitters.push(L)}_stopSubEmitters(){if(this.activeSubSystems){for(const L of this.activeSubSystems)L.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const L=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==L&&this._rootParticleSystem.activeSubSystems.splice(L,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(L){L&&this._stopSubEmitters()}_prepareParticle(L){if(this._subEmitters&&this._subEmitters.length>0){const U=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];L._attachedSubEmitters=[];for(const x of U)if(0===x.type){const U=x.clone();L._attachedSubEmitters.push(U),U.particleSystem.start()}}}_onDispose(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),L&&this.particles)for(const x of this.particles)if(x._attachedSubEmitters)for(let L=x._attachedSubEmitters.length-1;L>=0;L-=1)x._attachedSubEmitters[L].dispose();if(U&&this.activeSubSystems)for(let x=this.activeSubSystems.length-1;x>=0;x-=1)this.activeSubSystems[x].dispose();if(this._subEmitters&&this._subEmitters.length){for(let L=0;L<this._subEmitters.length;L++)for(const U of this._subEmitters[L])U.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.mx&&this.mx.dispose&&this.mx.dispose(!0)}static _Parse(L,U,x,p){let G;G=x instanceof BL.e?null:x;const o=(0,a.b)("BABYLON.Texture");if(o&&G&&(L.texture?U.particleTexture=o.Parse(L.texture,G,p):L.textureName&&(U.particleTexture=new o(p+L.textureName,G,!1,void 0===L.invertY||L.invertY),U.particleTexture.name=L.textureName)),L.emitterId||0===L.emitterId||void 0!==L.mx?L.emitterId&&G?U.mx=G.getLastMeshById(L.emitterId):U.mx=mL.YU.qU(L.mx):U.mx=mL.YU.Zero(),U.isLocal=!!L.isLocal,void 0!==L.renderingGroupId&&(U.renderingGroupId=L.renderingGroupId),void 0!==L.isBillboardBased&&(U.isBillboardBased=L.isBillboardBased),void 0!==L.billboardMode&&(U.billboardMode=L.billboardMode),void 0!==L.useLogarithmicDepth&&(U.useLogarithmicDepth=L.useLogarithmicDepth),L.animations){for(let x=0;x<L.animations.length;x++){const mL=L.animations[x],p=(0,a.b)("BABYLON.Animation");p&&U.animations.push(p.Parse(mL))}U.beginAnimationOnStart=L.beginAnimationOnStart,U.beginAnimationFrom=L.beginAnimationFrom,U.beginAnimationTo=L.beginAnimationTo,U.beginAnimationLoop=L.beginAnimationLoop}if(L.autoAnimate&&G&&G.beginAnimation(U,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1),U.startDelay=0|L.startDelay,U.minAngularSpeed=L.minAngularSpeed,U.maxAngularSpeed=L.maxAngularSpeed,U.minSize=L.minSize,U.maxSize=L.maxSize,L.minScaleX&&(U.minScaleX=L.minScaleX,U.maxScaleX=L.maxScaleX,U.minScaleY=L.minScaleY,U.maxScaleY=L.maxScaleY),void 0!==L.preWarmCycles&&(U.preWarmCycles=L.preWarmCycles,U.preWarmStepOffset=L.preWarmStepOffset),void 0!==L.minInitialRotation&&(U.minInitialRotation=L.minInitialRotation,U.maxInitialRotation=L.maxInitialRotation),U.minLifeTime=L.minLifeTime,U.maxLifeTime=L.maxLifeTime,U.minEmitPower=L.minEmitPower,U.maxEmitPower=L.maxEmitPower,U.emitRate=L.emitRate,U.gravity=mL.YU.qU(L.gravity),L.noiseStrength&&(U.noiseStrength=mL.YU.qU(L.noiseStrength)),U.color1=F.ia.qU(L.color1),U.color2=F.ia.qU(L.color2),U.colorDead=F.ia.qU(L.colorDead),U.updateSpeed=L.updateSpeed,U.targetStopDuration=L.targetStopDuration,U.blendMode=L.blendMode,L.colorGradients)for(const mL of L.colorGradients)U.addColorGradient(mL.gradient,F.ia.qU(mL.color1),mL.color2?F.ia.qU(mL.color2):void 0);if(L.rampGradients){for(const x of L.rampGradients)U.addRampGradient(x.gradient,F.QU.qU(x.color));U.useRampGradients=L.useRampGradients}if(L.colorRemapGradients)for(const mL of L.colorRemapGradients)U.addColorRemapGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.alphaRemapGradients)for(const mL of L.alphaRemapGradients)U.addAlphaRemapGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.sizeGradients)for(const mL of L.sizeGradients)U.addSizeGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.angularSpeedGradients)for(const mL of L.angularSpeedGradients)U.addAngularSpeedGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.velocityGradients)for(const mL of L.velocityGradients)U.addVelocityGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.dragGradients)for(const mL of L.dragGradients)U.addDragGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.emitRateGradients)for(const mL of L.emitRateGradients)U.addEmitRateGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.startSizeGradients)for(const mL of L.startSizeGradients)U.addStartSizeGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.lifeTimeGradients)for(const mL of L.lifeTimeGradients)U.addLifeTimeGradient(mL.gradient,void 0!==mL.factor1?mL.factor1:mL.factor,mL.factor2);if(L.limitVelocityGradients){for(const x of L.limitVelocityGradients)U.addLimitVelocityGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);U.limitVelocityDamping=L.limitVelocityDamping}if(L.noiseTexture&&G){const x=(0,a.b)("BABYLON.ProceduralTexture");U.noiseTexture=x.Parse(L.noiseTexture,G,p)}let A;if(L.particleEmitterType){switch(L.particleEmitterType.type){case"SphereParticleEmitter":A=new Q;break;case"SphereDirectedParticleEmitter":A=new q;break;case"ConeEmitter":case"ConeParticleEmitter":A=new b;break;case"ConeDirectedParticleEmitter":A=new E;break;case"CylinderParticleEmitter":A=new Y;break;case"CylinderDirectedParticleEmitter":A=new S;break;case"HemisphericParticleEmitter":A=new V;break;case"PointParticleEmitter":A=new H;break;case"MeshParticleEmitter":A=new D;break;case"CustomParticleEmitter":A=new f;break;default:A=new h}A.parse(L.particleEmitterType,G)}else A=new h,A.parse(L,G);U.particleEmitterType=A,U.startSpriteCellID=L.startSpriteCellID,U.endSpriteCellID=L.endSpriteCellID,U.spriteCellLoop=L.spriteCellLoop??!0,U.spriteCellWidth=L.spriteCellWidth,U.spriteCellHeight=L.spriteCellHeight,U.spriteCellChangeSpeed=L.spriteCellChangeSpeed,U.spriteRandomStartCell=L.spriteRandomStartCell,U.disposeOnStop=L.disposeOnStop??!1,U.manualEmitCount=L.manualEmitCount??-1}static Parse(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0;const a=L.name;let o,A,r=null,h=null;if(U instanceof BL.e?o=U:(A=U,o=A.getEngine()),L.customShader&&o.createEffectForParticles){h=L.customShader;const U=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";r=o.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,U)}const b=new aU(a,G||L.ga,U,r,L.isAnimationSheetEnabled);if(b.customShader=h,b._rootUrl=x,L.id&&(b.id=L.id),L.subEmitters){b.subEmitters=[];for(const mL of L.subEmitters){const L=[];for(const p of mL)L.push(wL.Parse(p,U,x));b.subEmitters.push(L)}}if(L.attractors)for(const F of L.attractors){const L=new FU;L.position=mL.YU.qU(F.position),L.strength=F.strength,b.addAttractor(L)}return aU._Parse(L,b,U,x),L.textureMask&&(b.textureMask=F.ia.qU(L.textureMask)),L.DA&&(b.DA=mL.YU.qU(L.DA)),L.preventAutoStart&&(b.preventAutoStart=L.preventAutoStart),p||b.preventAutoStart||b.start(),b}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};if(aU._Serialize(U,this,L),U.textureMask=this.textureMask.Va(),U.customShader=this.customShader,U.preventAutoStart=this.preventAutoStart,U.DA=this.DA.Va(),this.subEmitters){U.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const x of this._subEmitters){const mL=[];for(const U of x)mL.push(U.serialize(L));U.subEmitters.push(mL)}}if(this._attractors&&this._attractors.length){U.attractors=[];for(const L of this._attractors)U.attractors.push(L.serialize())}return U}static _Serialize(L,U,x){if(L.name=U.name,L.id=U.id,L.ga=U.getCapacity(),L.disposeOnStop=U.disposeOnStop,L.manualEmitCount=U.manualEmitCount,U.mx.position){const x=U.mx;L.emitterId=x.id}else{const x=U.mx;L.mx=x.Va()}U.particleEmitterType&&(L.particleEmitterType=U.particleEmitterType.serialize()),U.particleTexture&&(x?L.texture=U.particleTexture.serialize():(L.textureName=U.particleTexture.name,L.invertY=!!U.particleTexture._invertY)),L.isLocal=U.isLocal,N.e.AppendSerializedAnimations(U,L),L.beginAnimationOnStart=U.beginAnimationOnStart,L.beginAnimationFrom=U.beginAnimationFrom,L.beginAnimationTo=U.beginAnimationTo,L.beginAnimationLoop=U.beginAnimationLoop,L.startDelay=U.startDelay,L.renderingGroupId=U.renderingGroupId,L.isBillboardBased=U.isBillboardBased,L.billboardMode=U.billboardMode,L.minAngularSpeed=U.minAngularSpeed,L.maxAngularSpeed=U.maxAngularSpeed,L.minSize=U.minSize,L.maxSize=U.maxSize,L.minScaleX=U.minScaleX,L.maxScaleX=U.maxScaleX,L.minScaleY=U.minScaleY,L.maxScaleY=U.maxScaleY,L.minEmitPower=U.minEmitPower,L.maxEmitPower=U.maxEmitPower,L.minLifeTime=U.minLifeTime,L.maxLifeTime=U.maxLifeTime,L.emitRate=U.emitRate,L.gravity=U.gravity.Va(),L.noiseStrength=U.noiseStrength.Va(),L.color1=U.color1.Va(),L.color2=U.color2.Va(),L.colorDead=U.colorDead.Va(),L.updateSpeed=U.updateSpeed,L.targetStopDuration=U.targetStopDuration,L.blendMode=U.blendMode,L.preWarmCycles=U.preWarmCycles,L.preWarmStepOffset=U.preWarmStepOffset,L.minInitialRotation=U.minInitialRotation,L.maxInitialRotation=U.maxInitialRotation,L.startSpriteCellID=U.startSpriteCellID,L.spriteCellLoop=U.spriteCellLoop,L.endSpriteCellID=U.endSpriteCellID,L.spriteCellChangeSpeed=U.spriteCellChangeSpeed,L.spriteCellWidth=U.spriteCellWidth,L.spriteCellHeight=U.spriteCellHeight,L.spriteRandomStartCell=U.spriteRandomStartCell,L.isAnimationSheetEnabled=U.isAnimationSheetEnabled,L.useLogarithmicDepth=U.useLogarithmicDepth;const mL=U.getColorGradients();if(mL){L.colorGradients=[];for(const U of mL){const x={gradient:U.gradient,color1:U.color1.Va()};U.color2?x.color2=U.color2.Va():x.color2=U.color1.Va(),L.colorGradients.push(x)}}const p=U.getRampGradients();if(p){L.rampGradients=[];for(const U of p){const x={gradient:U.gradient,color:U.color.Va()};L.rampGradients.push(x)}L.useRampGradients=U.useRampGradients}const G=U.getColorRemapGradients();if(G){L.colorRemapGradients=[];for(const U of G){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.colorRemapGradients.push(x)}}const F=U.getAlphaRemapGradients();if(F){L.alphaRemapGradients=[];for(const U of F){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.alphaRemapGradients.push(x)}}const a=U.getSizeGradients();if(a){L.sizeGradients=[];for(const U of a){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.sizeGradients.push(x)}}const o=U.getAngularSpeedGradients();if(o){L.angularSpeedGradients=[];for(const U of o){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.angularSpeedGradients.push(x)}}const A=U.getVelocityGradients();if(A){L.velocityGradients=[];for(const U of A){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.velocityGradients.push(x)}}const r=U.getDragGradients();if(r){L.dragGradients=[];for(const U of r){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.dragGradients.push(x)}}const h=U.getEmitRateGradients();if(h){L.emitRateGradients=[];for(const U of h){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.emitRateGradients.push(x)}}const b=U.getStartSizeGradients();if(b){L.startSizeGradients=[];for(const U of b){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.startSizeGradients.push(x)}}const E=U.getLifeTimeGradients();if(E){L.lifeTimeGradients=[];for(const U of E){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.lifeTimeGradients.push(x)}}const Y=U.getLimitVelocityGradients();if(Y){L.limitVelocityGradients=[];for(const U of Y){const x={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?x.factor2=U.factor2:x.factor2=U.factor1,L.limitVelocityGradients.push(x)}L.limitVelocityDamping=U.limitVelocityDamping}U.noiseTexture&&(L.noiseTexture=U.noiseTexture.serialize())}clone(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const mL={...this._customWrappers};let p=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){p=this.customShader;const L=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",U=G.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,L);mL[0]?mL[0].effect=U:this.setCustomEffect(U,0)}const F=this.serialize(x),a=aU.Parse(F,this._scene||this._engine,this._rootUrl);return a.name=L,a.customShader=p,a._customWrappers=mL,void 0===U&&(U=this.mx),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.mx=U,this.preventAutoStart||a.start(),a}}aU.BILLBOARDMODE_Y=2,aU.BILLBOARDMODE_ALL=7,aU.BILLBOARDMODE_STRETCHED=8,aU.BILLBOARDMODE_STRETCHED_LOCAL=9,wL._ParseParticleSystem=aU.Parse;var oU=x(12822),AU=x(12820),rU=x(12719);rU.b.prototype.createTransformFeedback=function(){const L=this._gl.createTransformFeedback();if(!L)throw new Error("Unable to create Transform Feedback");return L},rU.b.prototype.deleteTransformFeedback=function(L){this._gl.deleteTransformFeedback(L)},rU.b.prototype.bindTransformFeedback=function(L){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,L)},rU.b.prototype.beginTransformFeedback=function(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(L?this._gl.POINTS:this._gl.TRIANGLES)},rU.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},rU.b.prototype.setTranformFeedbackVaryings=function(L,U){this._gl.transformFeedbackVaryings(L,U,this._gl.INTERLEAVED_ATTRIBS)},rU.b.prototype.bindTransformFeedbackBuffer=function(L){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,L?L.underlyingResource:null)},rU.b.prototype.readTransformFeedbackBuffer=function(L){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,L)};const hU="clipPlaneFragmentDeclaration2",bU="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";d.d.IncludesShadersStore[hU]||(d.d.IncludesShadersStore[hU]=bU);x(13938),x(13947),x(13952),x(13961),x(13969),x(13974),x(13977),x(13984);const EU="gpuRenderParticlesPixelShader",YU="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";d.d.ShadersStore[EU]||(d.d.ShadersStore[EU]=YU);const SU="clipPlaneVertexDeclaration2",VU="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";d.d.IncludesShadersStore[SU]||(d.d.IncludesShadersStore[SU]=VU);x(13992),x(13999),x(14004),x(14009);const HU="gpuRenderParticlesVertexShader",QU="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";d.d.ShadersStore[HU]||(d.d.ShadersStore[HU]=QU);class qU extends o{static get IsSupported(){if(!T.c.LastCreatedEngine)return!1;const L=T.c.LastCreatedEngine.getCaps();return L.supportTransformFeedbacks||L.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(L){this._maxActiveParticleCount=Math.min(L,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(L){this.maxActiveParticleCount=L}createPointEmitter(L,U){const x=sL(L,U);return this.particleEmitterType=x,x}createHemisphericEmitter(){const L=CL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createSphereEmitter(){const L=kL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createDirectedSphereEmitter(){const L=TL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mL.YU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0));return this.particleEmitterType=L,L}createCylinderEmitter(){const L=OL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=L,L}createDirectedCylinderEmitter(){const L=LU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new mL.YU(0,1,0));return this.particleEmitterType=L,L}createConeEmitter(){const L=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=L,L}createDirectedConeEmitter(){const L=xU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mL.YU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mL.YU(0,1,0));return this.particleEmitterType=L,L}createBoxEmitter(L,U,x,mL){const p=new h;return this.particleEmitterType=p,this.direction1=L,this.direction2=U,this.minEmitBox=x,this.maxEmitBox=mL,p}get flowMap(){return this._flowMap}set flowMap(L){this._flowMap!==L&&(this._flowMap=L)}isReady(){if(!this.mx||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==aU.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(aU.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(aU.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";L?setTimeout((()=>{this.start(0)}),L):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var L;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(L=this._customWrappers[U])||void 0===L?void 0:L.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[L]??this._customWrappers[0]}setCustomEffect(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new LL.e(this._engine),this._customWrappers[U].effect=L}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(L,U,x){return super._removeGradientAndTexture(L,U,x),this._releaseBuffers(),this}addColorGradient(L,U){this._colorGradients||(this._colorGradients=[]);const x=new I(L,U);return this._colorGradients.push(x),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(L&&this._colorGradients.sort(((L,U)=>L.gradient<U.gradient?-1:L.gradient>U.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(L){return this._removeGradientAndTexture(L,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const U in this._drawWrappers){var L;null===(L=this._drawWrappers[U].drawContext)||void 0===L||L.reset()}}_addFactorGradient(L,U,x){const mL=new B(U,x);L.push(mL),this._releaseBuffers()}addSizeGradient(L,U){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,L,U),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(L){return this._removeGradientAndTexture(L,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(L,U){if(!L)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&L.sort(((L,U)=>L.gradient<U.gradient?-1:L.gradient>U.gradient?1:0));const x=this;x[U]&&(x[U].dispose(),x[U]=null)}addAngularSpeedGradient(L,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,L,U),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(L){return this._removeGradientAndTexture(L,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(L,U){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,L,U),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(L){return this._removeGradientAndTexture(L,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(L,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,L,U),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(L){return this._removeGradientAndTexture(L,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(L,U){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,L,U),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(L){return this._removeGradientAndTexture(L,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(L){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(L),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.oa=new C.c,this.onStoppedObservable=new C.c,this.onStartedObservable=new C.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,x&&"Scene"!==x.getClassName()?(this._engine=x,this.defaultProjectionMatrix=mL.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=x||T.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fE.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,a.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,a.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new LL.e(this._engine)},this._customWrappers[0].effect=p,this._drawWrappers={0:new LL.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(U=U??{}).randomTextureSize||delete U.randomTextureSize;const F={ga:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...U},o=U;isFinite(o)&&(F.ga=o),this._capacity=F.ga,this._maxActiveParticleCount=F.ga,this._currentActiveCount=0,this._isAnimationSheetEnabled=G,this.particleEmitterType=new h;const A=Math.min(this._engine.getCaps().maxTextureSize,F.randomTextureSize);let r=[];for(let mL=0;mL<A;++mL)r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random());this._randomTexture=new k.b(new Float32Array(r),A,1,5,x,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,r=[];for(let mL=0;mL<A;++mL)r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random());this._randomTexture2=new k.b(new Float32Array(r),A,1,5,x,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=A}_reset(){this._releaseBuffers()}_createVertexBuffers(L,U,x){const mL={};mL.position=U.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let p=3;mL.age=U.createVertexBuffer("age",p,1,this._attributesStrideSize,!0),p+=1,mL.size=U.createVertexBuffer("size",p,3,this._attributesStrideSize,!0),p+=3,mL.life=U.createVertexBuffer("life",p,1,this._attributesStrideSize,!0),p+=1,p+=4,this.billboardMode===aU.BILLBOARDMODE_STRETCHED&&(mL.direction=U.createVertexBuffer("direction",p,3,this._attributesStrideSize,!0)),p+=3,this._platform.alignDataInBuffer&&(p+=1),this.particleEmitterType instanceof f&&(p+=3,this._platform.alignDataInBuffer&&(p+=1)),this._colorGradientsTexture||(mL.color=U.createVertexBuffer("color",p,4,this._attributesStrideSize,!0),p+=4),this._isBillboardBased||(mL.initialDirection=U.createVertexBuffer("initialDirection",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1)),this.noiseTexture&&(mL.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1),mL.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1)),mL.angle=U.createVertexBuffer("angle",p,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?p++:p+=2,this._isAnimationSheetEnabled&&(mL.cellIndex=U.createVertexBuffer("cellIndex",p,1,this._attributesStrideSize,!0),p+=1,this.spriteRandomStartCell&&(mL.cellStartOffset=U.createVertexBuffer("cellStartOffset",p,1,this._attributesStrideSize,!0),p+=1)),mL.offset=x.createVertexBuffer("offset",0,2),mL.uv=x.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(mL),this._platform.createVertexBuffers(L,mL),this.resetDrawCache()}_initialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!L)return;const U=this._engine,x=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const p=this.particleEmitterType instanceof f,G=mL.TmpVectors.YU[0];let F=0;for(let mL=0;mL<this._capacity;mL++)if(x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),p?(this.particleEmitterType.particleDestinationGenerator(mL,null,G),x.push(G.x),x.push(G.y),x.push(G.z)):(x.push(0),x.push(0),x.push(0)),this._platform.alignDataInBuffer&&x.push(0),F+=16,p&&(this.particleEmitterType.particlePositionGenerator(mL,null,G),x.push(G.x),x.push(G.y),x.push(G.z),this._platform.alignDataInBuffer&&x.push(0),F+=4),this._colorGradientsTexture||(x.push(0),x.push(0),x.push(0),x.push(0),F+=4),this.isBillboardBased||(x.push(0),x.push(0),x.push(0),this._platform.alignDataInBuffer&&x.push(0),F+=4),this.noiseTexture&&(x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),this._platform.alignDataInBuffer&&x.push(0),x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),this._platform.alignDataInBuffer&&x.push(0),F+=8),x.push(0),F+=1,this._angularSpeedGradientsTexture||(x.push(0),F+=1),this._isAnimationSheetEnabled&&(x.push(0),F+=1,this.spriteRandomStartCell&&(x.push(0),F+=1)),this._platform.alignDataInBuffer){let L=3-(F+3&3);for(F+=L;L-- >0;)x.push(0)}const a=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),o=this._platform.createParticleBuffer(x),A=this._platform.createParticleBuffer(x);this._buffer0=new v.d(U,o,!1,this._attributesStrideSize),this._buffer1=new v.d(U,A,!1,this._attributesStrideSize),this._spriteBuffer=new v.d(U,a,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let L=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(L+="\n#define BILLBOARD"),this._colorGradientsTexture&&(L+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(L+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(L+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(L+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(L+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(L+="\n#define DRAGGRADIENTS"),this._flowMap&&(L+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(L+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(L+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(L+="\n#define NOISE"),this.isLocal&&(L+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===L||(this._cachedUpdateDefines=L,this._updateBuffer=this._platform.createUpdateBuffer(L)),this._platform.isUpdateBufferReady()}_getWrapper(L){const U=this._getCustomDrawWrapper(L);if(null!==U&&void 0!==U&&U.effect)return U;const x=[];this.fillDefines(x,L);let mL=this._drawWrappers[L];mL||(mL=new LL.e(this._engine),mL.drawContext&&(mL.drawContext.useInstancing=!0),this._drawWrappers[L]=mL);const p=x.join("\n");if(mL.defines!==p){const L=[],U=[],x=[];this.fillUniformsAttributesAndSamplerNames(U,L,x),mL.setEffect(this._engine.createEffect("gpuRenderParticles",L,U,x,p),p)}return mL}static _GetAttributeNamesOrOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=[v.h.PositionKind,"age","life","size","angle"];return L||p.push(v.h.ColorKind),U&&p.push("cellIndex"),x||p.push("initialDirection"),mL&&p.push("direction"),p.push("offset",v.h.UVKind),p}static _GetEffectCreationOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const mL=["emitterWM","DA","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,UL.e)(mL),L&&mL.push("sheetInfos"),U&&mL.push("logarithmicDepthConstant"),x&&(mL.push("vFogInfos"),mL.push("vFogColor")),mL}fillDefines(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UL.o)(this,this._scene,L),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==AU.e.FOGMODE_NONE&&L.push("#define FOG")),U===aU.BLENDMODE_MULTIPLY&&L.push("#define BLENDMULTIPLYMODE"),this.isLocal&&L.push("#define LOCAL"),this.useLogarithmicDepth&&L.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(L.push("#define BILLBOARD"),this.billboardMode){case aU.BILLBOARDMODE_Y:L.push("#define BILLBOARDY");break;case aU.BILLBOARDMODE_STRETCHED:L.push("#define BILLBOARDSTRETCHED");break;case aU.BILLBOARDMODE_ALL:L.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&L.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&L.push("#define ANIMATESHEET"),x&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),L.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(L,U,x){U.push(...qU._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===aU.BILLBOARDMODE_STRETCHED)),L.push(...qU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),x.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(oU.d.PrepareUniforms(L,this._imageProcessingConfigurationDefines),oU.d.PrepareSamplers(x,this._imageProcessingConfigurationDefines))}animate(){var L;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(U?this.preWarmStepOffset:(null===(L=this._scene)||void 0===L?void 0:L.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(L,U){const x=this[U];if(!L||!L.length||x)return;const mL=new Float32Array(this._rawTextureWidth);for(let p=0;p<this._rawTextureWidth;p++){const U=p/this._rawTextureWidth;s.GetCurrentGradient(U,L,((L,U,x)=>{mL[p]=(0,A.Lerp)(L.factor1,U.factor1,x)}))}this[U]=k.b.CreateRTexture(mL,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[U].name=U.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const L=new Uint8Array(4*this._rawTextureWidth),U=F.TmpColors.ia[0];for(let x=0;x<this._rawTextureWidth;x++){const mL=x/this._rawTextureWidth;s.GetCurrentGradient(mL,this._colorGradients,((mL,p,G)=>{F.ia.LerpToRef(mL.color1,p.color1,G,U),L[4*x]=255*U.r,L[4*x+1]=255*U.g,L[4*x+2]=255*U.b,L[4*x+3]=255*U.a}))}this._colorGradientsTexture=k.b.CreateRGBATexture(L,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(L,U){var x,p,G,F;const a=this._getWrapper(L),o=a.effect;this._engine.enableEffect(a);const A=(null===(x=this._scene)||void 0===x?void 0:x.getViewMatrix())||mL.Matrix.IdentityReadOnly;if(o.setMatrix("view",A),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),o.setTexture("diffuseSampler",this.particleTexture),o.setVector2("translationPivot",this.translationPivot),o.setVector3("DA",this.DA),this.isLocal&&o.setMatrix("emitterWM",U),this._colorGradientsTexture?o.setTexture("colorGradientSampler",this._colorGradientsTexture):o.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const L=this.particleTexture.getBaseSize();o.setFloat3("sheetInfos",this.spriteCellWidth/L.width,this.spriteCellHeight/L.height,L.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const L=this._scene.activeCamera;o.setVector3("eyePosition",L.globalPosition)}const r=o.defines;if(this._scene&&((0,UL.i)(o,this,this._scene),this.applyFog&&(0,xL.f)(this._scene,void 0,o)),r.indexOf("#define BILLBOARDMODE_ALL")>=0){const L=A.clone();L.invert(),o.setMatrix("invView",L)}return this.useLogarithmicDepth&&this._scene&&(0,xL.l)(r,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(L),this._platform.bindDrawBuffers(this._targetIndex,o,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(F=this._scene)&&void 0!==F&&F.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(L){if(!this.mx||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!L)if(this.mx.position){L=this.mx.getWorldMatrix()}else{const U=this.mx;L=mL.TmpVectors.Matrix[0],mL.Matrix.TranslationToRef(U.x,U.y,U.z,L)}const U=this._engine,x=U.getDepthWrite();if(U.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const L=this.PL();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",L.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",L),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const p=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=p,U.setDepthWrite(x)}render(){let L,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!U&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let L=0;L<this.preWarmCycles;L++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const L=0|this._accumulatedCount;this._accumulatedCount-=L,this._currentActiveCount+=L}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.mx.position){L=this.mx.getWorldMatrix()}else{const U=this.mx;L=mL.TmpVectors.Matrix[0],mL.Matrix.TranslationToRef(U.x,U.y,U.z,L)}const p=this._engine;this.updateInAnimate||this._update(L);let G=0;return U||x||(p.setState(!1),this.forceDepthWrite&&p.setDepthWrite(!0),G=this.blendMode===aU.BLENDMODE_MULTIPLYADD?this._render(aU.BLENDMODE_MULTIPLY,L)+this._render(aU.BLENDMODE_ADD,L):this._render(this.blendMode,L),this._engine.setAlphaMode(0)),G}rebuild(){const L=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(L,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,L()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const U in this._drawWrappers){this._drawWrappers[U].dispose()}if(this._drawWrappers={},this._scene){const L=this._scene.fE.indexOf(this);L>-1&&this._scene.fE.splice(L,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let U=0;U<this._renderVertexBuffers.length;++U){const L=this._renderVertexBuffers[U];for(const U in L)L[U].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),L&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),L&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.oa.notifyObservers(this),this.oa.clear()}clone(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const mL={...this._customWrappers};let p=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){p=this.customShader;const L=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"";mL[0]=G.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,L,void 0,void 0,void 0,this)}const F=this.serialize(x),a=qU.Parse(F,this._scene||this._engine,this._rootUrl);return a.name=L,a.customShader=p,a._customWrappers=mL,void 0===U&&(U=this.mx),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.mx=U,a}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return aU._Serialize(U,this,L),U.activeParticleCount=this.activeParticleCount,U.randomTextureSize=this._randomTextureSize,U.customShader=this.customShader,U}static Parse(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0;const G=L.name;let F,a;U instanceof BL.e?F=U:(a=U,F=a.getEngine());const o=new qU(G,{ga:p||L.ga,randomTextureSize:L.randomTextureSize},U,null,L.isAnimationSheetEnabled);if(o._rootUrl=x,L.customShader&&F.createEffectForParticles){const U=L.customShader,x=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",mL=F.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,x,void 0,void 0,void 0,o);o.setCustomEffect(mL,0),o.customShader=U}return L.id&&(o.id=L.id),L.activeParticleCount&&(o.activeParticleCount=L.activeParticleCount),aU._Parse(L,o,U,x),L.preventAutoStart&&(o.preventAutoStart=L.preventAutoStart),mL||o.preventAutoStart||o.start(),o}}var fU=x(12382),vU=x(14013),DU=x(12968);class PU{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(L){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const U of this.systems)U.mx=L;this._emitterNode=L}setEmitterAsSphere(L,U,x){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:L,renderingGroupId:U};const mL=(0,vU.e)("emitterSphere",{diameter:L.diameter,segments:L.segments},x);mL.renderingGroupId=U;const p=new DU.HU("emitterSphereMaterial",x);p.emissiveColor=L.color,mL.material=p;for(const G of this.systems)G.mx=mL;this._emitterNode=mL}start(L){for(const U of this.systems)L&&(U.mx=L),U.start()}dispose(){for(const L of this.systems)L.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={systems:[]};for(const x of this.systems)U.systems.push(x.serialize(L));return this._emitterNode&&(U.mx=this._emitterCreationOptions),U}static Parse(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3?arguments[3]:void 0;const p=new PU,G=this.BaseAssetsUrl+"/textures/";U=U||T.c.LastCreatedScene;for(const F of L.systems)p.systems.push(x?qU.Parse(F,U,G,!0,mL):aU.Parse(F,U,G,!0,mL));if(L.mx){const x=L.mx.options;if("Sphere"===L.mx.kind)p.setEmitterAsSphere({diameter:x.diameter,segments:x.segments,color:F.QU.qU(x.color)},L.mx.renderingGroupId,U)}return p}}PU.BaseAssetsUrl="https://assets.babylonjs.com/particles";var dU=x(12434);class KU{static CreateDefault(L){let U,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,mL=arguments.length>2?arguments[2]:void 0;U=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new qU("default system",{ga:x},mL):new aU("default system",x,mL),U.mx=L;const p=fU.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return U.particleTexture=new e.e(p,U.PL()),U.createConeEmitter(.1,Math.PI/4),U.color1=new F.ia(1,1,1,1),U.color2=new F.ia(1,1,1,1),U.colorDead=new F.ia(1,1,1,0),U.minSize=.1,U.maxSize=.1,U.minEmitPower=2,U.maxEmitPower=2,U.updateSpeed=1/60,U.emitRate=30,U}static CreateAsync(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3?arguments[3]:void 0;U||(U=T.c.LastCreatedScene);const p={};return U.addPendingData(p),new Promise(((G,F)=>{if(x&&!qU.IsSupported)return U.removePendingData(p),F("Particle system with GPU is not supported.");fU.Tools.LoadFile(`${KU.BaseAssetsUrl}/systems/${L}.json`,(L=>{U.removePendingData(p);const F=JSON.parse(L.toString());return G(PU.Parse(F,U,x,mL))}),void 0,void 0,void 0,(()=>(U.removePendingData(p),F(`An error occurred with the creation of your particle system. Check if your type '${L}' exists.`))))}))}static ExportSet(L){const U=new PU;for(const x of L)U.systems.push(x);return U}static ParseFromFileAsync(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",G=arguments.length>5?arguments[5]:void 0;return new Promise(((F,a)=>{const o=new dU.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const U=JSON.parse(o.responseText);let a;a=mL?qU.Parse(U,x,p,!1,G):aU.Parse(U,x,p,!1,G),L&&(a.name=L),F(a)}else a("Unable to load the particle system")})),o.open("GET",U),o.send()}))}static ParseFromSnippetAsync(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",p=arguments.length>4?arguments[4]:void 0;if("_BLANK"===L){const L=this.CreateDefault(null);return L.start(),Promise.resolve(L)}return new Promise(((G,F)=>{const a=new dU.e;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const F=JSON.parse(JSON.parse(a.responseText).jsonPayload),o=JSON.parse(F.particleSystem);let A;A=x?qU.Parse(o,U,mL,!1,p):aU.Parse(o,U,mL,!1,p),A.snippetId=L,G(A)}else F("Unable to load the snippet "+L)})),a.open("GET",this.SnippetUrl+"/"+L.replace(/#/g,"/")),a.send()}))}}KU.BaseAssetsUrl=PU.BaseAssetsUrl,KU.SnippetUrl="https://snippet.babylonjs.com",KU.CreateFromSnippetAsync=KU.ParseFromSnippetAsync;var lU=x(13046),iU=x(12858),XU=x(14017);(0,XU.h)(iU.b.NAME_PARTICLESYSTEM,((L,U,x,mL)=>{const p=(0,XU.i)(iU.b.NAME_PARTICLESYSTEM);if(p&&void 0!==L.fE&&null!==L.fE)for(let G=0,F=L.fE.length;G<F;G++){const F=L.fE[G];x.fE.push(p(F,U,mL))}})),(0,XU.e)(iU.b.NAME_PARTICLESYSTEM,((L,U,x)=>{if(L.activeParticleCount){return qU.Parse(L,U,x)}return aU.Parse(L,U,x)})),BL.e.prototype.createEffectForParticles=function(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],mL=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",G=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,r=arguments.length>9?arguments[9]:void 0,h=[],b=[];const E=[];return o?o.fillUniformsAttributesAndSamplerNames(b,h,E):(h=aU._GetAttributeNamesOrOptions(),b=aU._GetEffectCreationOptions()),-1===p.indexOf(" BILLBOARD")&&(p+="\n#define BILLBOARD\n"),null!==o&&void 0!==o&&o.isAnimationSheetEnabled&&-1===p.indexOf(" ANIMATESHEET")&&(p+="\n#define ANIMATESHEET\n"),-1===mL.indexOf("diffuseSampler")&&mL.push("diffuseSampler"),this.createEffect({vertex:r??(null===o||void 0===o?void 0:o.vertexShaderName)??"particles",fragmentElement:L},h,b.concat(U),E.concat(mL),p,G,F,a,void 0,A,(async()=>{0===A?await Promise.resolve().then(x.bind(x,14048)):await Promise.resolve().then(x.bind(x,14114))}))},lU.e.prototype.getEmittedParticleSystems=function(){const L=[];for(let U=0;U<this.PL().fE.length;U++){const x=this.PL().fE[U];x.mx===this&&L.push(x)}return L},lU.e.prototype.getHierarchyEmittedParticleSystems=function(){const L=[],U=this.getDescendants();U.push(this);for(let x=0;x<this.PL().fE.length;x++){const mL=this.PL().fE[x],p=mL.mx;p.position&&-1!==U.indexOf(p)&&L.push(mL)}return L};x(12938),x(12945),x(13026);x(13031),x(14020),x(12785),x(12921),x(13075);x(12780);var tU;x(14027),x(12613);!function(L){L[L.Color=2]="Color",L[L.UV=1]="UV",L[L.Random=0]="Random",L[L.Stated=3]="Stated"}(tU||(tU={}));var yU=x(12810);const nU=new mL.YU(0,0,0),NU=new mL.YU(0,0,0),eU=new mL.YU(0,0,0);class uU{constructor(L,U,x){this.width=L,this.height=U,this.data=x}processFlowable(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2?arguments[2]:void 0;if(!x)return;x instanceof mL.Matrix?mL.YU.TransformCoordinatesToRef(L.position,x,eU):(eU.x=x.x,eU.y=x.y,eU.z=x.z);const p=.5*eU.x+.5,G=1-(.5*eU.y+.5),F=Math.floor(p*this.width),a=Math.floor(G*this.height);if(F<0||F>=this.width||a<0||a>=this.height)return;const o=4*(a*this.width+F),A=this.data[o]/255*2-1,r=this.data[o+1]/255*2-1,h=this.data[o+2]/255*2-1,b=this.data[o+3]/255;nU.set(A,r,h),nU.scaleToRef(U*b,NU),L.direction.addInPlace(NU)}_processParticle(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2?arguments[2]:void 0;this.processFlowable(L,U,x)}static async FromUrlAsync(L){return await new Promise(((U,x)=>{const mL=document.createElement("canvas"),p=mL.getContext("2d");let G=null;const F=new Image;F.crossOrigin="anonymous",F.src=L,F.onerror=U=>{x(new Error(`Failed to load image: ${L} : ${U}`))},F.onload=()=>{mL.width=F.width,mL.height=F.height,p.drawImage(F,0,0),G=p.getImageData(0,0,mL.width,mL.height),U(new uU(mL.width,mL.height,G.data))}}))}static async ExtractFromTextureAsync(L){return await new Promise(((U,x)=>{if(!L.isReady())return void L.onLoadObservable.addOnce((async()=>{try{const x=await this.ExtractFromTextureAsync(L);U(x)}catch(mL){x(mL)}}));const mL=L.getSize();yU.n.GetTextureDataAsync(L,mL.width,mL.height).then((L=>{U(new uU(mL.width,mL.height,new Uint8ClampedArray(L)))})).catch(x)}))}}var ZU,gU,zU,MU,JU,jU,RU,cU,WU;!function(L){L[L.Int=1]="Int",L[L.Float=2]="Float",L[L.Vector2=4]="Vector2",L[L.YU=8]="YU",L[L.Matrix=16]="Matrix",L[L.Particle=32]="Particle",L[L.Texture=64]="Texture",L[L.ia=128]="ia",L[L.FloatGradient=256]="FloatGradient",L[L.Vector2Gradient=512]="Vector2Gradient",L[L.Vector3Gradient=1024]="Vector3Gradient",L[L.Color4Gradient=2048]="Color4Gradient",L[L.System=4096]="System",L[L.AutoDetect=8192]="AutoDetect",L[L.BasedOnInput=16384]="BasedOnInput",L[L.Undefined=32768]="Undefined",L[L.All=65535]="All"}(ZU||(ZU={})),function(L){L[L.Compatible=0]="Compatible",L[L.TypeIncompatible=1]="TypeIncompatible",L[L.HierarchyIssue=2]="HierarchyIssue"}(gU||(gU={})),function(L){L[L.Input=0]="Input",L[L.Output=1]="Output"}(zU||(zU={}));class IU{get direction(){return this._direction}get type(){if(this._type===ZU.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===ZU.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(L){this._type=L}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((L=>L.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(L,U,x){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=ZU.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new C.c,this.onDisconnectionObservable=new C.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=U,this.name=L,this._direction=x}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(L){var U;return this.isConnected?null!==(U=this._connectedPoint)&&void 0!==U&&U._storedFunction?this._connectedPoint._storedFunction(L):this._connectedPoint._storedValue:this.value}canConnectTo(L){return 0===this.checkCompatibilityState(L)}checkCompatibilityState(L){const U=this._ownerBlock,x=L.ownerBlock;if(this.type!==L.type&&L.innerType!==ZU.AutoDetect)return L.acceptedConnectionPointTypes&&-1!==L.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(L.excludedConnectionPointTypes&&-1!==L.excludedConnectionPointTypes.indexOf(this.type))return 1;let mL=x,p=U;return 0===this.direction&&(mL=U,p=x),mL.isAnAncestorOf(p)?2:0}connectTo(L){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(L))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${L.ownerBlock.name}".${L.name}`;return this._endpoints.push(L),L._connectedPoint=this,this.onConnectionObservable.notifyObservers(L),L.onConnectionObservable.notifyObservers(this),this}disconnectFrom(L){const U=this._endpoints.indexOf(L);return-1===U||(this._endpoints.splice(U,1),L._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(L),L.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(L){let U=1;for(;U<ZU.All;)L&U||this.excludedConnectionPointTypes.push(U),U<<=1}serialize(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U={};return U.name=this.name,U.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Va?(U.valueType="BABYLON."+this.value.getClassName(),U.value=this.value.Va()):(U.valueType="number",U.value=this.value)),L&&this.connectedPoint&&(U.inputName=this.name,U.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,U.targetConnectionName=this.connectedPoint.name,U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),U}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class wU{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(L){this._name=L}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(L){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new C.c,this.oa=new C.c,this.onInputChangedObservable=new C.c,this.visibleOnFrame=!1,this._name=L,this.uniqueId=u.d.UniqueId}_inputRename(L){return L}_outputRename(L){return L}isAnAncestorOf(L){for(const U of this._outputs)if(U.hasEndpoints)for(const x of U.endpoints){if(x.ownerBlock===L)return!0;if(x.ownerBlock.isAnAncestorOf(L))return!0}return!1}isAnAncestorOfType(L){if(this.getClassName()===L)return!0;for(const U of this._outputs)if(U.hasEndpoints)for(const x of U.endpoints)if(x.ownerBlock.isAnAncestorOfType(L))return!0;return!1}getInputByName(L){const U=this._inputs.filter((U=>U.name===L));return U.length?U[0]:null}_linkConnectionTypes(L,U){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[U]._acceptedConnectionPointType=this._inputs[L]:(this._inputs[L]._linkedConnectionSource=this._inputs[U],this._inputs[L]._isMainLinkSource=!0),this._inputs[U]._linkedConnectionSource=this._inputs[L]}registerInput(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const F=new IU(L,this,0);return F.type=U,F.isOptional=x,F.defaultValue=mL,F.value=mL,F.valueMin=p,F.valueMax=G,this._inputs.push(F),this.onInputChangedObservable.notifyObservers(F),this}registerOutput(L,U,x){return(x=x??new IU(L,this,1)).type=U,this._outputs.push(x),this}_build(L){}_customBuildStep(L){}build(L){if(this._buildId===L.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((L=>L.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=L.buildId;for(const U of this._inputs){if(!U.connectedPoint){U.isOptional||L.notConnectedNonOptionalInputs.push(U);continue}const x=U.connectedPoint.ownerBlock;x&&x!==this&&!x.isSystem&&x.build(L)}return this._customBuildStep(L),L.verbose&&Z.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(L),this.onBuildObservable.notifyObservers(this),!1}serialize(){const L={};L.customType="BABYLON."+this.getClassName(),L.id=this.uniqueId,L.name=this.name,L.visibleOnFrame=this.visibleOnFrame,L.inputs=[],L.outputs=[];for(const U of this.inputs)L.inputs.push(U.serialize());for(const U of this.outputs)L.outputs.push(U.serialize(!1));return L}_deserialize(L){this._name=L.name,this.comments=L.comments,this.visibleOnFrame=!!L.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(L)}_deserializePortDisplayNamesAndExposedOnFrame(L){const U=L.inputs,x=L.outputs;if(U)for(const mL of U){const L=this.inputs.find((L=>L.name===mL.name));if(!L)return;if(mL.displayName&&(L.displayName=mL.displayName),mL.isExposedOnFrame&&(L.isExposedOnFrame=mL.isExposedOnFrame,L.exposedPortPosition=mL.exposedPortPosition),void 0!==mL.value&&null!==mL.value)if("number"===mL.valueType)L.value=mL.value;else{const U=(0,a.b)(mL.valueType);U&&(L.value=U.qU(mL.value))}}if(x)for(let mL=0;mL<x.length;mL++){const L=x[mL];L.displayName&&(this.outputs[mL].displayName=L.displayName),L.isExposedOnFrame&&(this.outputs[mL].isExposedOnFrame=L.isExposedOnFrame,this.outputs[mL].exposedPortPosition=L.exposedPortPosition)}}clone(){const L=this.serialize(),U=(0,a.b)(L.customType);if(U){const x=new U;return x._deserialize(L),x}return null}dispose(){this.oa.notifyObservers(this),this.oa.clear();for(const L of this.inputs)L.dispose();for(const L of this.outputs)L.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function BU(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",mL=arguments.length>3?arguments[3]:void 0;return(p,G)=>{let F=p._propStore;F||(F=[],p._propStore=F),F.push({propertyName:G,displayName:L,type:U,groupName:x,options:mL??{},className:p.getClassName()})}}(0,y.d)([(0,n.R)("comment")],wU.prototype,"comments",void 0),function(L){L[L.Boolean=0]="Boolean",L[L.Float=1]="Float",L[L.Int=2]="Int",L[L.Vector2=3]="Vector2",L[L.List=4]="List",L[L.ia=5]="ia",L[L.SamplingMode=6]="SamplingMode",L[L.TextureFormat=7]="TextureFormat",L[L.TextureType=8]="TextureType"}(MU||(MU={})),function(L){L[L.None=0]="None",L[L.Position=1]="Position",L[L.Direction=2]="Direction",L[L.Age=3]="Age",L[L.Lifetime=4]="Lifetime",L[L.Color=5]="Color",L[L.ScaledDirection=6]="ScaledDirection",L[L.Scale=7]="Scale",L[L.AgeGradient=8]="AgeGradient",L[L.Angle=9]="Angle",L[L.SpriteCellIndex=16]="SpriteCellIndex",L[L.SpriteCellStart=17]="SpriteCellStart",L[L.SpriteCellEnd=18]="SpriteCellEnd"}(JU||(JU={})),function(L){L[L.None=0]="None",L[L.Time=1]="Time",L[L.Delta=2]="Delta",L[L.Emitter=3]="Emitter"}(jU||(jU={}));class sU{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let L="";for(const U of this.notConnectedNonOptionalInputs)L+=`input ${U.name} from block ${U.ownerBlock.name}[${U.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(L)throw"Build of Node Particle System Set failed:\n"+L}adapt(L,U){const x=L.getConnectedValue(this)||0;if(L.type===U)return x;switch(U){case ZU.Vector2:return new mL.Vector2(x,x);case ZU.YU:return new mL.YU(x,x,x);case ZU.ia:return new F.ia(x,x,x,x)}return null}getContextualValue(L){if(!this.particleContext||!this.systemContext)return null;switch(L){case JU.Position:return this.particleContext.position;case JU.Direction:return this.particleContext.direction;case JU.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case JU.Color:return this.particleContext.color;case JU.Age:return this.particleContext.age;case JU.Lifetime:return this.particleContext.lifeTime;case JU.Angle:return this.particleContext.angle;case JU.Scale:return this.particleContext.scale;case JU.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case JU.SpriteCellEnd:return this.systemContext.endSpriteCellID;case JU.SpriteCellIndex:return this.particleContext.cellIndex;case JU.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.mx.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.mx.absolutePosition:this.systemContext.mx:null}getSystemValue(L){if(!this.particleContext||!this.systemContext)return null;switch(L){case jU.Time:return this.systemContext._actualFrame;case jU.Delta:return this.systemContext._scaledUpdateSpeed;case jU.Emitter:if(this.isEmitterTransformNode){return this.systemContext.mx.absolutePosition}return this.systemContext.mx}return null}}function CU(L,U,x){const mL=new sU;mL.VU=U;const p=L.createSystem(mL);return p.canStart=()=>!0,p.mx=x.clone(),p.disposeOnStop=!0,p.start(),p}class kU extends wU{constructor(L){super(L),this.blendMode=o.BLENDMODE_ONEONE,this.ga=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",ZU.Particle),this.registerInput("texture",ZU.Texture),this.registerInput("onStart",ZU.System,!0),this.registerInput("onEnd",ZU.System,!0),this.registerOutput("system",ZU.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(L){L.ga=this.ga,L.buildId=this._buildId++,this.build(L);const U=this.particle.getConnectedValue(L);return U.particleTexture=this.texture.getConnectedValue(L),U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.name=this.name,U._nodeGenerated=!0,U._targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,this.system._storedValue=this,U.canStart=()=>!this.doNoStart,U.onStartedObservable.add((x=>{const mL=this.onStart.getConnectedValue(L);mL&&x.onStartedObservable.addOnce((()=>{L.systemContext=U;const x=CU(mL,L.VU,L.emitterPosition);this.oa.addOnce((()=>{x.dispose()}))}));const p=this.onEnd.getConnectedValue(L);p&&x.onStoppedObservable.addOnce((()=>{L.systemContext=U;const x=CU(p,L.VU,L.emitterPosition);this.oa.addOnce((()=>{x.dispose()}))}))})),this.oa.addOnce((()=>{U.dispose()})),U}serialize(){const L=super.serialize();return L.ga=this.ga,L.emitRate=this.emitRate,L.blendMode=this.blendMode,L.doNoStart=this.doNoStart,L.targetStopDuration=this.targetStopDuration,L.startDelay=this.startDelay,L}_deserialize(L){super._deserialize(L),this.ga=L.ga,this.emitRate=L.emitRate,this.doNoStart=!!L.doNoStart,void 0!==L.blendMode&&(this.blendMode=L.blendMode),void 0!==L.targetStopDuration&&(this.targetStopDuration=L.targetStopDuration),void 0!==L.startDelay&&(this.startDelay=L.startDelay)}}(0,y.d)([BU("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:o.BLENDMODE_ONEONE},{label:"Standard",value:o.BLENDMODE_STANDARD},{label:"Add",value:o.BLENDMODE_ADD},{label:"Multiply",value:o.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:o.BLENDMODE_MULTIPLYADD}]})],kU.prototype,"blendMode",void 0),(0,y.d)([BU("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],kU.prototype,"ga",void 0),(0,y.d)([BU("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kU.prototype,"emitRate",void 0),(0,y.d)([BU("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kU.prototype,"targetStopDuration",void 0),(0,y.d)([BU("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kU.prototype,"startDelay",void 0),(0,y.d)([BU("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kU.prototype,"doNoStart",void 0),(0,a.d)("BABYLON.SystemBlock",kU);class TU extends wU{get type(){if(this._type===ZU.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=ZU.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=ZU.Vector2,this._type;case"YU":return this._type=ZU.YU,this._type;case"ia":return this._type=ZU.ia,this._type;case"Matrix":return this._type=ZU.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===JU.None&&this._systemSource!==jU.None}get systemSource(){return this._systemSource}set systemSource(L){if(this._systemSource=L,L!==jU.None){switch(this._contextualSource=JU.None,this._type=ZU.Float,L){case jU.Time:case jU.Delta:this._type=ZU.Float;break;case jU.Emitter:this._type=ZU.YU}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==JU.None}get contextualValue(){return this._contextualSource}set contextualValue(L){if(this._contextualSource=L,L!==JU.None){switch(this._systemSource=jU.None,L){case JU.Scale:this._type=ZU.Vector2;break;case JU.Position:case JU.Direction:case JU.ScaledDirection:this._type=ZU.YU;break;case JU.Color:this._type=ZU.ia;break;case JU.Age:case JU.Lifetime:case JU.Angle:case JU.AgeGradient:this._type=ZU.Float;break;case JU.SpriteCellEnd:case JU.SpriteCellStart:case JU.SpriteCellIndex:this._type=ZU.Int}this.output&&(this.output.type=this._type)}}constructor(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ZU.AutoDetect;super(L),this._type=ZU.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new C.c,this._systemSource=jU.None,this._contextualSource=JU.None,this._type=U,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",U)}get value(){return this._storedValue}set value(L){this.type===ZU.Float&&this.min!==this.max&&(L=Math.max(this.min,L),L=Math.min(this.max,L)),this._storedValue=L,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(L){this._valueCallback=L}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case ZU.Int:case ZU.Float:this.value=0;break;case ZU.Vector2:this.value=mL.Vector2.Zero();break;case ZU.YU:this.value=mL.YU.Zero();break;case ZU.ia:this.value=new F.ia(1,1,1,1);break;case ZU.Matrix:this.value=mL.Matrix.Identity()}}_build(L){super._build(L),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=L=>L.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=L=>L.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const L=super.serialize();return L.type=this.type,L.contextualValue=this.contextualValue,L.systemSource=this.systemSource,L.min=this.min,L.max=this.max,L.groupInInspector=this.groupInInspector,L.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Va?(L.valueType="BABYLON."+this._storedValue.getClassName(),L.value=this._storedValue.Va()):(L.valueType="number",L.value=this._storedValue)),L}_deserialize(L){if(super._deserialize(L),this._type=L.type,this.contextualValue=L.contextualValue,this.systemSource=L.systemSource||jU.None,this.min=L.min||0,this.max=L.max||0,this.groupInInspector=L.groupInInspector||"",void 0!==L.displayInInspector&&(this.displayInInspector=L.displayInInspector),L.valueType)if("number"===L.valueType)this._storedValue=L.value;else{const U=(0,a.b)(L.valueType);U&&(this._storedValue=U.qU(L.value))}}}(0,a.d)("BABYLON.ParticleInputBlock",TU);class OU extends wU{get url(){return this._url}set url(L){this._url!==L&&(this._cachedData=null,this._url=L,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(L){this._textureDataUrl!==L&&(this._cachedData=null,this._textureDataUrl=L,this._url="",this._sourceTexture=null)}set sourceTexture(L){this._sourceTexture!==L&&(this._cachedData=null,this._sourceTexture=L,this._url="",this._textureDataUrl="")}constructor(L){super(L),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",ZU.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const L=this.texture._storedValue;return await new Promise(((U,x)=>{if(!L.isReady())return void L.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),U(this._cachedData)}catch(L){x(L)}}));const mL=L.getSize();yU.n.GetTextureDataAsync(L,mL.width,mL.height).then((x=>{this._cachedData={width:mL.width,height:mL.height,data:new Uint8ClampedArray(x)},L.dispose(),U(this._cachedData)})).catch(x)}))}_build(L){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new e.e(this._textureDataUrl,L.VU):this.texture._storedValue=new e.e(this._url,L.VU):this.texture._storedValue=null}serialize(){const L=super.serialize();return L.url=this.url,L.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(L.textureDataUrl=this.textureDataUrl),L}_deserialize(L){super._deserialize(L),this.url=L.url,this.serializedCachedData=!!L.serializedCachedData,L.textureDataUrl&&(this.textureDataUrl=L.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,a.d)("BABYLON.ParticleTextureSourceBlock",OU);class Lx extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("position",ZU.YU),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(L){const U=this.particle.getConnectedValue(L);if(this.output._storedValue=U,!this.position.isConnected)return;const x={process:x=>{L.particleContext=x,L.systemContext=U,x.position.p(this.position.getConnectedValue(L))},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x}}(0,a.d)("BABYLON.UpdatePositionBlock",Lx),function(L){L[L.Add=0]="Add",L[L.Subtract=1]="Subtract",L[L.Multiply=2]="Multiply",L[L.Divide=3]="Divide",L[L.Max=4]="Max",L[L.Min=5]="Min"}(RU||(RU={}));class Ux extends wU{constructor(L){super(L),this.operation=RU.Add,this.registerInput("left",ZU.AutoDetect),this.registerInput("right",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this.output._typeConnectionSource=this.left;const U=[ZU.Matrix,ZU.Particle,ZU.Texture,ZU.System,ZU.FloatGradient,ZU.Color4Gradient,ZU.Vector2Gradient,ZU.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...U),this.right.excludedConnectionPointTypes.push(...U),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(L){let U;const x=this.left,p=this.right;if(!x.isConnected||!p.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const G=x.type===ZU.Float||x.type===ZU.Int,a=p.type===ZU.Float||p.type===ZU.Int,o=G&&a;switch(this.operation){case RU.Add:U=o?L=>x.getConnectedValue(L)+p.getConnectedValue(L):G?L=>L.adapt(x,p.type).add(p.getConnectedValue(L)):L=>x.getConnectedValue(L).add(L.adapt(p,x.type));break;case RU.Subtract:U=o?L=>x.getConnectedValue(L)-p.getConnectedValue(L):G?L=>L.adapt(x,p.type).SU(p.getConnectedValue(L)):L=>x.getConnectedValue(L).SU(L.adapt(p,x.type));break;case RU.Multiply:U=o?L=>x.getConnectedValue(L)*p.getConnectedValue(L):G?L=>L.adapt(x,p.type).multiply(p.getConnectedValue(L)):L=>x.getConnectedValue(L).multiply(L.adapt(p,x.type));break;case RU.Divide:U=o?L=>x.getConnectedValue(L)/p.getConnectedValue(L):G?L=>L.adapt(x,p.type).divide(p.getConnectedValue(L)):L=>x.getConnectedValue(L).divide(L.adapt(p,x.type));break;case RU.Min:if(o)U=L=>Math.min(x.getConnectedValue(L),p.getConnectedValue(L));else{const[L,a]=G?[p,x]:[x,p];switch(L.type){case ZU.Vector2:U=U=>mL.Vector2.Minimize(L.getConnectedValue(U),U.adapt(a,L.type));break;case ZU.YU:U=U=>mL.YU.Minimize(L.getConnectedValue(U),U.adapt(a,L.type));break;case ZU.ia:U=U=>{const x=L.getConnectedValue(U),{r:mL,g:p,b:G,a:o}=U.adapt(a,L.type);return new F.ia(Math.min(x.r,mL),Math.min(x.g,p),Math.min(x.b,G),Math.min(x.a,o))}}}break;case RU.Max:if(!o){const[L,a]=G?[p,x]:[x,p];switch(L.type){case ZU.Vector2:U=U=>mL.Vector2.Maximize(L.getConnectedValue(U),U.adapt(a,L.type));break;case ZU.YU:U=U=>mL.YU.Maximize(L.getConnectedValue(U),U.adapt(a,L.type));break;case ZU.ia:U=U=>{const x=L.getConnectedValue(U),{r:mL,g:p,b:G,a:o}=U.adapt(a,L.type);return new F.ia(Math.max(x.r,mL),Math.min(x.g,p),Math.min(x.b,G),Math.min(x.a,o))}}break}U=L=>Math.max(x.getConnectedValue(L),p.getConnectedValue(L))}this.output._storedFunction=L=>x.type===ZU.Int?0|U(L):U(L)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===ZU.Int||this.left.type===ZU.Float&&this.right.type!==ZU.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[L,U]of[[this.left,this.right],[this.right,this.left]])L.acceptedConnectionPointTypes=[ZU.Int,ZU.Float],U.isConnected&&(L.acceptedConnectionPointTypes.push(U.type),U.type!==ZU.Int&&U.type!==ZU.Float||L.acceptedConnectionPointTypes.push(ZU.Vector2,ZU.YU,ZU.ia))}dispose(){super.dispose();for(const L of this._connectionObservers)L.remove();this._connectionObservers.length=0}serialize(){const L=super.serialize();return L.operation=this.operation,L}_deserialize(L){super._deserialize(L),this.operation=L.operation}}(0,y.d)([BU("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:RU.Add},{label:"Subtract",value:RU.Subtract},{label:"Multiply",value:RU.Multiply},{label:"Divide",value:RU.Divide},{label:"Max",value:RU.Max},{label:"Min",value:RU.Min}]})],Ux.prototype,"operation",void 0),(0,a.d)("BABYLON.ParticleMathBlock",Ux);class xx extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("direction1",ZU.YU,!0,new mL.YU(0,1,0)),this.registerInput("direction2",ZU.YU,!0,new mL.YU(0,1,0)),this.registerInput("minEmitBox",ZU.YU,!0,new mL.YU(-.5,-.5,-.5)),this.registerInput("maxEmitBox",ZU.YU,!0,new mL.YU(.5,.5,.5)),this.registerOutput("output",ZU.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(L){const U=this.particle.getConnectedValue(L);U._directionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.direction1.getConnectedValue(L),G=this.direction2.getConnectedValue(L),F=(0,A.RandomRange)(p.x,G.x),a=(0,A.RandomRange)(p.y,G.y),o=(0,A.RandomRange)(p.z,G.z);L.isEmitterTransformNode?mL.YU.TransformNormalFromFloatsToRef(F,a,o,L.emitterWorldMatrix,x.direction):x.direction.da(F,a,o)},U._positionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.minEmitBox.getConnectedValue(L),G=this.maxEmitBox.getConnectedValue(L),F=(0,A.RandomRange)(p.x,G.x),a=(0,A.RandomRange)(p.y,G.y),o=(0,A.RandomRange)(p.z,G.z);L.isEmitterTransformNode?mL.YU.TransformCoordinatesFromFloatsToRef(F,a,o,L.emitterWorldMatrix,x.position):(x.position.da(F,a,o),x.position.addInPlace(L.emitterPosition))},this.output._storedValue=U}}(0,a.d)("BABYLON.BoxShapeBlock",xx);class mm extends wU{constructor(L){super(L),this.registerInput("emitPower",ZU.Float,!0,1),this.registerInput("lifeTime",ZU.Float,!0,1),this.registerInput("color",ZU.ia,!0,new F.ia(1,1,1,1)),this.registerInput("scale",ZU.Vector2,!0,new mL.Vector2(1,1)),this.registerInput("angle",ZU.Float,!0,0),this.registerOutput("particle",ZU.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(L){const U=new aU(this.name,L.ga,L.VU,null,!1,void 0,!0);U.particleEmitterType=new H,U._lifeTimeCreation.process=(U,x)=>{L.particleContext=U,U.lifeTime=this.lifeTime.getConnectedValue(L),x._emitPower=this.emitPower.getConnectedValue(L)},U._colorCreation.process=U=>{L.particleContext=U,U.color.p(this.color.getConnectedValue(L))},U._sizeCreation.process=U=>{L.particleContext=U,U.size=1,U.scale.p(this.scale.getConnectedValue(L))},U._angleCreation.process=U=>{L.particleContext=U,U.angle=this.angle.getConnectedValue(L)},this.particle._storedValue=U}}(0,a.d)("BABYLON.CreateParticleBlock",mm);class px{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const L=[];for(const U of this.attachedBlocks)U.isInput&&L.push(U);return L}constructor(L){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new C.c,this.name=L}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(L)&&this.attachedBlocks.push(L);for(const x of L.inputs){const mL=x.connectedPoint;if(mL){const x=mL.ownerBlock;x!==L&&this._initializeBlock(x,U)}}}async buildAsync(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((x=>{const mL=new PU;for(const L of this._systemBlocks)this._initializeBlock(L);for(const p of this.systemBlocks){const x=new sU;x.buildId=this._buildId++,x.VU=L,x.verbose=U;const G=p.createSystem(x);x.emitErrors(),mL.systems.push(G)}this.onBuildObservable.notifyObservers(this),x(mL)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const L=new kU("Particle system"),U=new Lx("Update position");U.output.connectTo(L.particle);const x=new TU("Position");x.contextualValue=JU.Position;const mL=new TU("Scaled direction");mL.contextualValue=JU.ScaledDirection;const p=new Ux("Add");p.operation=RU.Add,x.output.connectTo(p.left),mL.output.connectTo(p.right),p.output.connectTo(U.position);const G=new mm("Create particle"),F=new xx("Box shape");G.particle.connectTo(F.particle),F.output.connectTo(U.particle);const a=new OU("Texture");a.texture.connectTo(L.texture),a.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(L)}removeBlock(L){const U=this.attachedBlocks.indexOf(L);if(U>-1&&this.attachedBlocks.splice(U,1),L.isSystem){const U=this._systemBlocks.indexOf(L);U>-1&&this._systemBlocks.splice(U,1)}}parseSerializedObject(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U||this.clear();const x={};for(const mL of L.lr){const L=(0,a.b)(mL.customType);if(L){const U=new L;U._deserialize(mL),x[mL.id]=U,this.attachedBlocks.push(U),U.isSystem&&this._systemBlocks.push(U)}}for(const mL of this.attachedBlocks)if(mL.isTeleportOut){const L=mL,U=L._tempEntryPointUniqueId;if(U){const mL=x[U];mL&&mL.attachToEndpoint(L)}}for(let mL=0;mL<L.lr.length;mL++){const p=L.lr[mL],G=x[p.id];G&&(G.inputs.length&&p.inputs.some((L=>L.targetConnectionName))&&!U||this._restoreConnections(G,L,x))}if(L.locations||L.editorData&&L.editorData.locations){const mL=L.locations||L.editorData.locations;for(const L of mL)x[L.lm]&&(L.lm=x[L.lm].uniqueId);U&&this.editorData&&this.editorData.locations&&mL.concat(this.editorData.locations),L.locations?this.editorData={locations:mL}:(this.editorData=L.editorData,this.editorData.locations=mL);const p=[];for(const L in x)p[L]=x[L].uniqueId;this.editorData.map=p}this.comment=L.comment}_restoreConnections(L,U,x){for(const mL of L.outputs)for(const p of U.lr){const G=x[p.id];if(G)for(const F of p.inputs)if(x[F.targetBlockId]!==L||F.targetConnectionName!==mL.name);else{const L=G.getInputByName(F.inputName);if(!L||L.isConnected)continue;mL.connectTo(L,!0),this._restoreConnections(G,U,x)}}}serialize(L){const U=L?{}:N.e.Serialize(this);U.editorData=JSON.parse(JSON.stringify(this.editorData));let x=[];L?x=L:U.customType="BABYLON.NodeParticleSystemSet",U.lr=[];for(const mL of x)U.lr.push(mL.serialize());if(!L)for(const mL of this.attachedBlocks)-1===x.indexOf(mL)&&U.lr.push(mL.serialize());return U}dispose(){for(const L of this.attachedBlocks)L.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(L){const U=new px(L);return U.setToDefault(),U}static Parse(L){const U=N.e.Parse((()=>new px(L.name)),L,null);return U.parseSerializedObject(L),U}static ParseFromSnippetAsync(L,U){return"_BLANK"===L?Promise.resolve(px.CreateDefault("blank")):new Promise(((x,mL)=>{const p=new dU.e;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const F=JSON.parse(JSON.parse(p.responseText).jsonPayload),a=JSON.parse(F.nodeParticle);U||(U=N.e.Parse((()=>new px(L)),a,null)),U.parseSerializedObject(a),U.snippetId=L;try{x(U)}catch(G){mL(G)}}else mL("Unable to load the snippet "+L)})),p.open("GET",this.SnippetUrl+"/"+L.replace(/#/g,"/")),p.send()}))}}px.EditorURL=`${fU.Tools._DefaultCdnUrl}/v${BL.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,px.SnippetUrl="https://snippet.babylonjs.com",(0,y.d)([(0,n.R)()],px.prototype,"name",void 0),(0,y.d)([(0,n.R)("comment")],px.prototype,"comment",void 0),function(L){L[L.None=0]="None",L[L.PerParticle=1]="PerParticle",L[L.PerSystem=2]="PerSystem"}(cU||(cU={}));class Gx extends wU{constructor(L){super(L),this._currentLockId=-2,this.lockMode=cU.PerParticle,this.registerInput("min",ZU.AutoDetect,!0,0),this.registerInput("max",ZU.AutoDetect,!0,1),this.registerOutput("output",ZU.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ZU.Float|ZU.Int|ZU.Vector2|ZU.YU|ZU.ia),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(ZU.Float|ZU.Int|ZU.Vector2|ZU.YU|ZU.ia),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=ZU.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let L=null;switch(this._currentLockId=-2,this.min.type){case ZU.AutoDetect:case ZU.Int:case ZU.Float:L=L=>{const U=this.min.getConnectedValue(L)||0,x=this.max.getConnectedValue(L)||1;return U+Math.random()*(x-U)};break;case ZU.Vector2:L=L=>{const U=this.min.getConnectedValue(L)||mL.Vector2.Zero(),x=this.max.getConnectedValue(L)||mL.Vector2.One();return new mL.Vector2(U.x+Math.random()*(x.x-U.x),U.y+Math.random()*(x.y-U.y))};break;case ZU.YU:L=L=>{const U=this.min.getConnectedValue(L)||mL.YU.Zero(),x=this.max.getConnectedValue(L)||mL.YU.One();return new mL.YU(U.x+Math.random()*(x.x-U.x),U.y+Math.random()*(x.y-U.y),U.z+Math.random()*(x.z-U.z))};break;case ZU.ia:L=L=>{const U=this.min.getConnectedValue(L)||new F.ia(0,0,0,0),x=this.max.getConnectedValue(L)||new F.ia(1,1,1,1);return new F.ia(U.x+Math.random()*(x.x-U.x),U.y+Math.random()*(x.y-U.y),U.z+Math.random()*(x.z-U.z),U.w+Math.random()*(x.w-U.w))}}this.output._storedFunction=U=>{var x;let mL=0;switch(this.lockMode){case cU.PerParticle:mL=(null===(x=U.particleContext)||void 0===x?void 0:x.id)||-1;break;case cU.PerSystem:mL=U.buildId||0}return this._currentLockId!==mL&&(this.lockMode!==cU.None&&(this._currentLockId=mL),this.output._storedValue=L(U)),this.output._storedValue}}serialize(){const L=super.serialize();return L.lockMode=this.lockMode,L}_deserialize(L){super._deserialize(L),this.lockMode=L.lockMode}}(0,y.d)([BU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cU.None},{label:"Per particle",value:cU.PerParticle},{label:"Per system",value:cU.PerSystem}]})],Gx.prototype,"lockMode",void 0),(0,a.d)("BABYLON.ParticleRandomBlock",Gx);class Fx extends wU{constructor(L){super(L),this._currentLockId=-2,this.lockMode=cU.PerParticle,this.registerInput("min",ZU.AutoDetect),this.registerInput("max",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const U=[ZU.Matrix,ZU.Particle,ZU.Texture,ZU.System,ZU.FloatGradient,ZU.Color4Gradient,ZU.Vector2Gradient,ZU.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...U),this.max.excludedConnectionPointTypes.push(...U)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let L=null;switch(this._currentLockId=-2,this.min.type){case ZU.Float:case ZU.Int:L=L=>{const U=this.min.getConnectedValue(L),x=this.max.getConnectedValue(L);return Math.random()*(x-U)+U};break;case ZU.Vector2:L=L=>{const U=this.min.getConnectedValue(L),x=this.max.getConnectedValue(L);return new mL.Vector2(Math.random()*(x.x-U.x)+U.x,Math.random()*(x.y-U.y)+U.y)};break;case ZU.YU:L=L=>{const U=this.min.getConnectedValue(L),x=this.max.getConnectedValue(L);return new mL.YU(Math.random()*(x.x-U.x)+U.x,Math.random()*(x.y-U.y)+U.y,Math.random()*(x.z-U.z)+U.z)};break;case ZU.ia:L=L=>{const U=this.min.getConnectedValue(L),x=this.max.getConnectedValue(L);return new F.ia(Math.random()*(x.r-U.r)+U.r,Math.random()*(x.g-U.g)+U.g,Math.random()*(x.b-U.b)+U.b,Math.random()*(x.a-U.a)+U.a)}}this.output._storedFunction=U=>{var x;let mL=0;switch(this.lockMode){case cU.PerParticle:mL=(null===(x=U.particleContext)||void 0===x?void 0:x.id)||-1;break;case cU.PerSystem:mL=U.buildId||0}return this._currentLockId!==mL&&(this.lockMode!==cU.None&&(this._currentLockId=mL),this.output._storedValue=L(U)),this.output._storedValue}}serialize(){const L=super.serialize();return L.lockMode=this.lockMode,L}_deserialize(L){super._deserialize(L),void 0!==L.lockMode&&(this.lockMode=L.lockMode)}}(0,y.d)([BU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cU.None},{label:"Per particle",value:cU.PerParticle},{label:"Per system",value:cU.PerSystem}]})],Fx.prototype,"lockMode",void 0),(0,a.d)("BABYLON.RandomRangeBlock",Fx);(0,a.d)("BABYLON.ParticleLerpBlock",class extends wU{constructor(L){super(L),this.registerInput("left",ZU.AutoDetect),this.registerInput("right",ZU.AutoDetect),this.registerInput("gradient",ZU.Float,!0,0,0,1),this.registerOutput("output",ZU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ZU.Float|ZU.Int|ZU.Vector2|ZU.YU|ZU.ia)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=(L,U,x)=>(1-L)*U+L*x;this.output._storedFunction=U=>{const x=this.left.getConnectedValue(U),p=this.right.getConnectedValue(U),G=this.gradient.getConnectedValue(U);switch(this.left.type){case ZU.Int:case ZU.Float:return L(G,x,p);case ZU.Vector2:return new mL.Vector2(L(G,x.x,p.x),L(G,x.y,p.y));case ZU.YU:return new mL.YU(L(G,x.x,p.x),L(G,x.y,p.y),L(G,x.z,p.z));case ZU.ia:return new F.ia(L(G,x.r,p.r),L(G,x.g,p.g),L(G,x.b,p.b),L(G,x.a,p.a))}return 0}}});(0,a.d)("BABYLON.UpdateDirectionBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("direction",ZU.YU),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(L){const U=this.particle.getConnectedValue(L);if(this.output._storedValue=U,!this.direction.isConnected)return;const x={process:x=>{L.particleContext=x,L.systemContext=U,x.direction.p(this.direction.getConnectedValue(L))},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x}});(0,a.d)("BABYLON.UpdateColorBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("color",ZU.ia),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(L){const U=this.particle.getConnectedValue(L);if(this.output._storedValue=U,!this.color.isConnected)return;const x={process:x=>{L.particleContext=x,L.systemContext=U,x.color.p(this.color.getConnectedValue(L))},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x}});(0,a.d)("BABYLON.UpdateScaleBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("scale",ZU.Vector2),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(L){const U=this.particle.getConnectedValue(L);if(this.output._storedValue=U,!this.scale.isConnected)return;const x={process:x=>{L.particleContext=x,L.systemContext=U,x.scale.p(this.scale.getConnectedValue(L))},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x}});(0,a.d)("BABYLON.UpdateAngleBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("angle",ZU.Float),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(L){const U=this.particle.getConnectedValue(L);if(this.output._storedValue=U,!this.angle.isConnected)return;const x={process:x=>{L.particleContext=x,L.systemContext=U,x.angle=this.angle.getConnectedValue(L)},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x}});(0,a.d)("BABYLON.BasicPositionUpdateBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(L){const U=this.particle.getConnectedValue(L),x={process:x=>{L.particleContext=x,L.systemContext=U,x.direction.scaleToRef(U._directionScale,U._scaledDirection),x.position.addInPlace(U._scaledDirection)},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x,this.output._storedValue=U}});(0,a.d)("BABYLON.BasicSpriteUpdateBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(L){const U=this.particle.getConnectedValue(L),x={process:x=>{L.particleContext=x,L.systemContext=U,x.updateCellIndex()},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x,this.output._storedValue=U}});(0,a.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("cellIndex",ZU.Int),this.registerOutput("output",ZU.Particle),this.cellIndex.acceptedConnectionPointTypes=[ZU.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(L){const U=this.particle.getConnectedValue(L);if(this.output._storedValue=U,!this.cellIndex.isConnected)return;const x={process:x=>{L.particleContext=x,L.systemContext=U,x.cellIndex=Math.floor(this.cellIndex.getConnectedValue(L))},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x}});class ax extends wU{constructor(L){super(L),this.strength=1,this.registerInput("particle",ZU.Particle),this.registerInput("flowMap",ZU.Texture),this.registerOutput("output",ZU.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(L){var U;const x=this.particle.getConnectedValue(L),mL=L.VU;let p;(null===(U=this.flowMap.connectedPoint)||void 0===U?void 0:U.ownerBlock).extractTextureContentAsync().then((L=>{L&&(p=new uU(L.width,L.height,L.data))}));const G={process:L=>{const U=mL.getTransformMatrix();p&&p._processParticle(L,this.strength*x._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null};x._updateQueueStart?jL(G,x._updateQueueStart):x._updateQueueStart=G,this.output._storedValue=x}serialize(){const L=super.serialize();return L.strength=this.strength,L}_deserialize(L){super._deserialize(L),this.strength=L.strength}}(0,y.d)([BU("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ax.prototype,"strength",void 0),(0,a.d)("BABYLON.UpdateFlowMapBlock",ax);(0,a.d)("BABYLON.SphereShapeBlock",class extends wU{constructor(L){super(L),this.registerInput("input",ZU.Particle),this.registerInput("radius",ZU.Float,!0,1),this.registerInput("radiusRange",ZU.Float,!0,1,0,1),this.registerInput("directionRandomizer",ZU.Float,!0,0,0,1),this.registerOutput("output",ZU.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(L){const U=this.input.getConnectedValue(L);U._directionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.directionRandomizer.getConnectedValue(L),G=x.position.SU(L.emitterPosition).normalize(),F=(0,A.RandomRange)(0,p),a=(0,A.RandomRange)(0,p),o=(0,A.RandomRange)(0,p);G.x+=F,G.y+=a,G.z+=o,G.normalize(),L.isEmitterTransformNode?mL.YU.TransformNormalFromFloatsToRef(F,a,o,L.emitterWorldMatrix,x.direction):x.direction.da(F,a,o)},U._positionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.radius.getConnectedValue(L),G=this.radiusRange.getConnectedValue(L),F=p-(0,A.RandomRange)(0,p*G),a=(0,A.RandomRange)(0,1),o=(0,A.RandomRange)(0,2*Math.PI),r=Math.acos(2*a-1),h=F*Math.cos(o)*Math.sin(r),b=F*Math.cos(r),E=F*Math.sin(o)*Math.sin(r);L.isEmitterTransformNode?mL.YU.TransformCoordinatesFromFloatsToRef(h,b,E,L.emitterWorldMatrix,x.position):(x.position.da(h,b,E),x.position.addInPlace(L.emitterPosition))},this.output._storedValue=U}});(0,a.d)("BABYLON.PointShapeBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("direction1",ZU.YU,!0,new mL.YU(0,1,0)),this.registerInput("direction2",ZU.YU,!0,new mL.YU(0,1,0)),this.registerOutput("output",ZU.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){const U=this.particle.getConnectedValue(L);U._directionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.direction1.getConnectedValue(L),G=this.direction2.getConnectedValue(L),F=(0,A.RandomRange)(p.x,G.x),a=(0,A.RandomRange)(p.y,G.y),o=(0,A.RandomRange)(p.z,G.z);L.isEmitterTransformNode?mL.YU.TransformNormalFromFloatsToRef(F,a,o,L.emitterWorldMatrix,x.direction):x.direction.da(F,a,o)},U._positionCreation.process=x=>{L.systemContext=U,L.isEmitterTransformNode?mL.YU.TransformCoordinatesFromFloatsToRef(0,0,0,L.emitterWorldMatrix,x.position):x.position.p(L.emitterPosition)},this.output._storedValue=U}});(0,a.d)("BABYLON.CustomShapeBlock",class extends wU{constructor(L){super(L),this.registerInput("particle",ZU.Particle),this.registerInput("position",ZU.YU,!0,new mL.YU(0,0,0)),this.registerInput("direction",ZU.YU,!0,new mL.YU(0,1,0)),this.registerOutput("output",ZU.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){const U=this.particle.getConnectedValue(L);U._directionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.direction.getConnectedValue(L);L.isEmitterTransformNode?mL.YU.TransformNormalToRef(p,L.emitterWorldMatrix,x.direction):x.direction.p(p)},U._positionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.position.getConnectedValue(L);L.isEmitterTransformNode?mL.YU.TransformCoordinatesToRef(p,L.emitterWorldMatrix,x.position):(x.position.p(p),x.position.addInPlace(L.emitterPosition))},this.output._storedValue=U}});(0,a.d)("BABYLON.CylinderShapeBlock",class extends wU{constructor(L){super(L),this._tempVector=mL.YU.Zero(),this.registerInput("particle",ZU.Particle),this.registerInput("radius",ZU.Float,!0,1),this.registerInput("height",ZU.Float,!0,1,0),this.registerInput("radiusRange",ZU.Float,!0,1,0,1),this.registerInput("directionRandomizer",ZU.Float,!0,0,0,1),this.registerOutput("output",ZU.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(L){const U=this.particle.getConnectedValue(L);U._directionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.directionRandomizer.getConnectedValue(L);x.position.subtractToRef(L.emitterPosition,this._tempVector),this._tempVector.normalize(),L.isEmitterTransformNode&&mL.YU.TransformNormalToRef(this._tempVector,L.emitterInverseWorldMatrix,this._tempVector);const G=(0,A.RandomRange)(-p/2,p/2);let F=Math.atan2(this._tempVector.x,this._tempVector.z);F+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*p,this._tempVector.y=G,this._tempVector.x=Math.sin(F),this._tempVector.z=Math.cos(F),this._tempVector.normalize(),L.isEmitterTransformNode?mL.YU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,L.emitterWorldMatrix,x.direction):x.direction.p(this._tempVector)},U._positionCreation.process=x=>{L.particleContext=x,L.systemContext=U;const p=this.height.getConnectedValue(L),G=this.radiusRange.getConnectedValue(L),F=this.radius.getConnectedValue(L),a=(0,A.RandomRange)(-p/2,p/2),o=(0,A.RandomRange)(0,2*Math.PI),r=(0,A.RandomRange)((1-G)*(1-G),1),h=Math.sqrt(r)*F,b=h*Math.cos(o),E=h*Math.sin(o);L.isEmitterTransformNode?mL.YU.TransformCoordinatesFromFloatsToRef(b,a,E,L.emitterWorldMatrix,x.position):(x.position.da(b,a,E),x.position.addInPlace(L.emitterPosition))},this.output._storedValue=U}});class ox extends wU{constructor(L){super(L),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",ZU.Particle),this.registerOutput("output",ZU.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);const U=this.particle.getConnectedValue(L);U._isAnimationSheetEnabled=!0,U.spriteCellWidth=this.width,U.spriteCellHeight=this.height,U.startSpriteCellID=this.start,U.endSpriteCellID=this.end,U.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=U}serialize(){const L=super.serialize();return L.width=this.width,L.height=this.height,L.start=this.start,L.end=this.end,L.randomStartCell=this.randomStartCell,L}_deserialize(L){super._deserialize(L),this.width=L.width,this.height=L.height,this.start=L.start,this.end=L.end,this.randomStartCell=L.randomStartCell}}(0,y.d)([BU("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ox.prototype,"start",void 0),(0,y.d)([BU("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ox.prototype,"end",void 0),(0,y.d)([BU("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ox.prototype,"width",void 0),(0,y.d)([BU("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ox.prototype,"height",void 0),(0,y.d)([BU("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ox.prototype,"loop",void 0),(0,y.d)([BU("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ox.prototype,"randomStartCell",void 0),(0,a.d)("BABYLON.SetupSpriteSheetBlock",ox);class Ax extends wU{constructor(L){super(L),this.reference=0,this.registerInput("value",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=L=>{switch(L){case ZU.Float:return ZU.FloatGradient;case ZU.Vector2:return ZU.Vector2Gradient;case ZU.YU:return ZU.Vector3Gradient;case ZU.ia:return ZU.Color4Gradient}return L},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ZU.Float|ZU.Vector2|ZU.YU|ZU.ia)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=L=>null}serialize(){const L=super.serialize();return L.reference=this.reference,L}_deserialize(L){super._deserialize(L),this.reference=L.reference}}(0,y.d)([BU("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Ax.prototype,"reference",void 0),(0,a.d)("BABYLON.ParticleGradientValueBlock",Ax);(0,a.d)("BABYLON.ParticleGradientBlock",class extends wU{constructor(L){super(L),this._entryCount=1,this.registerInput("gradient",ZU.Float,!0,1,0,1),this.registerInput("value0",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=L=>{switch(L){case ZU.FloatGradient:return ZU.Float;case ZU.Vector2Gradient:return ZU.Vector2;case ZU.Vector3Gradient:return ZU.YU;case ZU.Color4Gradient:return ZU.ia}return L},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(ZU.FloatGradient|ZU.Vector2Gradient|ZU.Vector3Gradient|ZU.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(L){this._inputs[L].onConnectionObservable.add((()=>{this._entryCount>L||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),ZU.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const L=[];for(let x=1;x<this._inputs.length;x++){var U;if(this._inputs[x].isConnected)L.push(null===(U=this._inputs[x].connectedPoint)||void 0===U?void 0:U.ownerBlock)}L.sort(((L,U)=>L.reference-U.reference)),this.output._storedFunction=U=>{const x=this.gradient.getConnectedValue(U);if(1===L.length)return L[0].value.getConnectedValue(U);let p=null;for(let G=L.length-1;G>=0;G--){const a=L[G];if(a.reference<=x){const L=a.value.getConnectedValue(U);if(p){const G=p.value.getConnectedValue(U),o=p.reference,r=a.reference,h=Math.max(0,Math.min(1,(x-r)/(o-r)));switch(this.output.type){case ZU.Float:return(0,A.Lerp)(L,G,h);case ZU.Vector2:return mL.Vector2.Lerp(L,G,h);case ZU.YU:return mL.YU.Lerp(L,G,h);case ZU.ia:return F.ia.Lerp(L,G,h)}}return L}p=a}return 0}}});(0,a.d)("BABYLON.ParticleConverterBlock",class extends wU{constructor(L){super(L),this.registerInput("color ",ZU.ia,!0),this.registerInput("xyz ",ZU.YU,!0),this.registerInput("xy ",ZU.Vector2,!0),this.registerInput("zw ",ZU.Vector2,!0),this.registerInput("x ",ZU.Float,!0),this.registerInput("y ",ZU.Float,!0),this.registerInput("z ",ZU.Float,!0),this.registerInput("w ",ZU.Float,!0),this.registerOutput("color",ZU.ia),this.registerOutput("xyz",ZU.YU),this.registerOutput("xy",ZU.Vector2),this.registerOutput("zw",ZU.Vector2),this.registerOutput("x",ZU.Float),this.registerOutput("y",ZU.Float),this.registerOutput("z",ZU.Float),this.registerOutput("w",ZU.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(L){return"color "===L?"colorIn":"xyz "===L?"xyzIn":"xy "===L?"xyIn":"zw "===L?"zwIn":"x "===L?"xIn":"y "===L?"yIn":"z "===L?"zIn":"w "===L?"wIn":L}_outputRename(L){switch(L){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return L}}_build(L){super._build(L);const U=this.xIn,x=this.yIn,p=this.zIn,G=this.wIn,a=this.xyIn,o=this.zwIn,A=this.xyzIn,r=this.colorIn,h=this.colorOut,b=this.xyzOut,E=this.xyOut,Y=this.zwOut,S=this.xOut,V=this.yOut,H=this.zOut,Q=this.wOut,q=L=>{if(r.isConnected)return r.getConnectedValue(L);let mL=0,h=0,b=0,E=0;if(U.isConnected&&(mL=U.getConnectedValue(L)),x.isConnected&&(h=x.getConnectedValue(L)),p.isConnected&&(b=p.getConnectedValue(L)),G.isConnected&&(E=G.getConnectedValue(L)),a.isConnected){const U=a.getConnectedValue(L);U&&(mL=U.x,h=U.y)}if(o.isConnected){const U=o.getConnectedValue(L);U&&(b=U.x,E=U.y)}if(A.isConnected){const U=A.getConnectedValue(L);U&&(mL=U.x,h=U.y,b=U.z)}return new F.ia(mL,h,b,E)};h._storedFunction=L=>q(L),b._storedFunction=L=>{const U=q(L);return new mL.YU(U.r,U.g,U.b)},E._storedFunction=L=>{const U=q(L);return new mL.Vector2(U.r,U.g)},Y._storedFunction=L=>{const U=q(L);return new mL.Vector2(U.b,U.a)},S._storedFunction=L=>q(L).r,V._storedFunction=L=>q(L).g,H._storedFunction=L=>q(L).b,Q._storedFunction=L=>q(L).a}}),function(L){L[L.Cos=0]="Cos",L[L.Sin=1]="Sin",L[L.Abs=2]="Abs",L[L.Exp=3]="Exp",L[L.Exp2=4]="Exp2",L[L.Round=5]="Round",L[L.Floor=6]="Floor",L[L.Ceiling=7]="Ceiling",L[L.Sqrt=8]="Sqrt",L[L.Log=9]="Log",L[L.Tan=10]="Tan",L[L.ArcTan=11]="ArcTan",L[L.ArcCos=12]="ArcCos",L[L.ArcSin=13]="ArcSin",L[L.Sign=14]="Sign",L[L.Negate=15]="Negate",L[L.OneMinus=16]="OneMinus",L[L.Reciprocal=17]="Reciprocal",L[L.ToDegrees=18]="ToDegrees",L[L.ToRadians=19]="ToRadians",L[L.Fract=20]="Fract"}(WU||(WU={}));class rx extends wU{constructor(L){super(L),this.operation=WU.Cos,this.registerInput("input",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ZU.Float|ZU.Int|ZU.Vector2|ZU.YU|ZU.ia)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);let U=null;switch(this.operation){case WU.Cos:U=L=>Math.cos(L);break;case WU.Sin:U=L=>Math.sin(L);break;case WU.Abs:U=L=>Math.abs(L);break;case WU.Exp:U=L=>Math.exp(L);break;case WU.Exp2:U=L=>Math.pow(2,L);break;case WU.Round:U=L=>Math.round(L);break;case WU.Floor:U=L=>Math.floor(L);break;case WU.Ceiling:U=L=>Math.ceil(L);break;case WU.Sqrt:U=L=>Math.sqrt(L);break;case WU.Log:U=L=>Math.log(L);break;case WU.Tan:U=L=>Math.tan(L);break;case WU.ArcTan:U=L=>Math.atan(L);break;case WU.ArcCos:U=L=>Math.acos(L);break;case WU.ArcSin:U=L=>Math.asin(L);break;case WU.Sign:U=L=>Math.sign(L);break;case WU.Negate:U=L=>-L;break;case WU.OneMinus:U=L=>1-L;break;case WU.Reciprocal:U=L=>1/L;break;case WU.ToRadians:U=L=>L*Math.PI/180;break;case WU.ToDegrees:U=L=>180*L/Math.PI;break;case WU.Fract:U=L=>L>=0?L-Math.floor(L):L-Math.ceil(L)}if(!U)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case ZU.Int:case ZU.Float:this.output._storedFunction=L=>{const x=this.input.getConnectedValue(L);return U(x)};break;case ZU.Vector2:this.output._storedFunction=L=>{const x=this.input.getConnectedValue(L);return new mL.Vector2(U(x.x),U(x.y))};break;case ZU.YU:this.output._storedFunction=L=>{const x=this.input.getConnectedValue(L);return new mL.YU(U(x.x),U(x.y),U(x.z))};break;case ZU.ia:this.output._storedFunction=L=>{const x=this.input.getConnectedValue(L);return new F.ia(U(x.r),U(x.g),U(x.b),U(x.a))}}return this}serialize(){const L=super.serialize();return L.operation=this.operation,L}_deserialize(L){super._deserialize(L),this.operation=L.operation}}(0,y.d)([BU("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:WU.Cos},{label:"Sin",value:WU.Sin},{label:"Abs",value:WU.Abs},{label:"Exp",value:WU.Exp},{label:"Exp2",value:WU.Exp2},{label:"Round",value:WU.Round},{label:"Floor",value:WU.Floor},{label:"Ceiling",value:WU.Ceiling},{label:"Sqrt",value:WU.Sqrt},{label:"Log",value:WU.Log},{label:"Tan",value:WU.Tan},{label:"ArcTan",value:WU.ArcTan},{label:"ArcCos",value:WU.ArcCos},{label:"ArcSin",value:WU.ArcSin},{label:"Sign",value:WU.Sign},{label:"Negate",value:WU.Negate},{label:"OneMinus",value:WU.OneMinus},{label:"Reciprocal",value:WU.Reciprocal},{label:"ToDegrees",value:WU.ToDegrees},{label:"ToRadians",value:WU.ToRadians},{label:"Fract",value:WU.Fract}]})],rx.prototype,"operation",void 0),(0,a.d)("BABYLON.ParticleTrigonometryBlock",rx);var hx,bx=x(14030);class Ex extends wU{constructor(L){super(L),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(ZU.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(ZU.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(ZU.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(ZU.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(ZU.System),this._inputs[0].excludedConnectionPointTypes.push(ZU.Particle),this._inputs[0].excludedConnectionPointTypes.push(ZU.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const U=L=>{const U=this.input.getConnectedValue(L);if(this.log.length>=this.stackSize)return U;if(null===U||void 0===U)return this.log.push(["null",""]),U;switch(this.input.type){case ZU.Vector2:this.log.push([(0,bx.d)(U,4),U.toString()]);break;case ZU.YU:this.log.push([(0,bx.h)(U,4),U.toString()]);break;case ZU.ia:this.log.push([`{R: ${U.r.toFixed(4)} G: ${U.g.toFixed(4)} B: ${U.b.toFixed(4)} A: ${U.a.toFixed(4)}}`,U.toString()]);break;default:this.log.push([U.toString(),U.toString()])}return U};this.output.isConnected?this.output._storedFunction=U:this.output._storedValue=U(L)}serialize(){const L=super.serialize();return L.stackSize=this.stackSize,L}_deserialize(L){super._deserialize(L),this.stackSize=L.stackSize}}(0,y.d)([BU("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Ex.prototype,"stackSize",void 0),(0,a.d)("BABYLON.ParticleDebugBlock",Ex);(0,a.d)("BABYLON.ParticleElbowBlock",class extends wU{constructor(L){super(L),this.registerInput("input",ZU.AutoDetect),this.registerOutput("output",ZU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);const U=this._outputs[0],x=this._inputs[0];U._storedFunction=L=>x.getConnectedValue(L)}});(0,a.d)("BABYLON.ParticleTeleportInBlock",class extends wU{get endpoints(){return this._endpoints}constructor(L){super(L),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",ZU.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(L){if(this.getClassName()===L)return!0;for(const U of this.endpoints)if(U.isAnAncestorOfType(L))return!0;return!1}isAnAncestorOf(L){for(const U of this.endpoints){if(U===L)return!0;if(U.isAnAncestorOf(L))return!0}return!1}attachToEndpoint(L){L.detach(),this._endpoints.push(L),L._entryPoint=this,L._outputs[0]._typeConnectionSource=this._inputs[0],L._tempEntryPointUniqueId=null,L.name="> "+this.name}detachFromEndpoint(L){const U=this._endpoints.indexOf(L);-1!==U&&(this._endpoints.splice(U,1),L._outputs[0]._typeConnectionSource=null,L._entryPoint=null)}_build(){for(const L of this._endpoints)L.output._storedFunction=L=>this.input.getConnectedValue(L)}});(0,a.d)("BABYLON.ParticleTeleportOutBlock",class extends wU{constructor(L){super(L),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",ZU.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(L){this.entryPoint&&this.entryPoint.build(L)}clone(){const L=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(L),L}serialize(){var L;const U=super.serialize();return U.entryPoint=(null===(L=this.entryPoint)||void 0===L?void 0:L.uniqueId)??"",U}_deserialize(L){super._deserialize(L),this._tempEntryPointUniqueId=L.entryPoint}}),function(L){L[L.Equal=0]="Equal",L[L.NotEqual=1]="NotEqual",L[L.LessThan=2]="LessThan",L[L.GreaterThan=3]="GreaterThan",L[L.LessOrEqual=4]="LessOrEqual",L[L.GreaterOrEqual=5]="GreaterOrEqual",L[L.Xor=6]="Xor",L[L.Or=7]="Or",L[L.And=8]="And"}(hx||(hx={}));class Yx extends wU{constructor(L){super(L),this.test=hx.Equal,this.epsilon=0,this.registerInput("left",ZU.Float),this.registerInput("right",ZU.Float,!0,0),this.registerInput("ifTrue",ZU.AutoDetect,!0,1),this.registerInput("ifFalse",ZU.AutoDetect,!0,0),this.registerOutput("output",ZU.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=ZU.Float,this._inputs[0].acceptedConnectionPointTypes.push(ZU.Int),this._inputs[1].acceptedConnectionPointTypes.push(ZU.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const L=L=>{const U=this.left.getConnectedValue(L),x=this.right.getConnectedValue(L);let mL=!1;switch(this.test){case hx.Equal:mL=(0,A.WithinEpsilon)(U,x,this.epsilon);break;case hx.NotEqual:mL=!(0,A.WithinEpsilon)(U,x,this.epsilon);break;case hx.LessThan:mL=U<x+this.epsilon;break;case hx.GreaterThan:mL=U>x-this.epsilon;break;case hx.LessOrEqual:mL=U<=x+this.epsilon;break;case hx.GreaterOrEqual:mL=U>=x-this.epsilon;break;case hx.Xor:mL=!!U&&!x||!U&&!!x;break;case hx.Or:mL=!!U||!!x;break;case hx.And:mL=!!U&&!!x}return mL};this.output._storedFunction=U=>L(U)?this.ifTrue.getConnectedValue(U):this.ifFalse.getConnectedValue(U)}serialize(){const L=super.serialize();return L.test=this.test,L.epsilon=this.epsilon,L}_deserialize(L){super._deserialize(L),this.test=L.test,void 0!==L.epsilon&&(this.epsilon=L.epsilon)}}(0,y.d)([BU("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:hx.Equal},{label:"NotEqual",value:hx.NotEqual},{label:"LessThan",value:hx.LessThan},{label:"GreaterThan",value:hx.GreaterThan},{label:"LessOrEqual",value:hx.LessOrEqual},{label:"GreaterOrEqual",value:hx.GreaterOrEqual},{label:"Xor",value:hx.Xor},{label:"Or",value:hx.Or},{label:"And",value:hx.And}]})],Yx.prototype,"test",void 0),(0,y.d)([BU("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Yx.prototype,"epsilon",void 0),(0,a.d)("BABYLON.ParticleConditionBlock",Yx);class Sx extends wU{constructor(L){super(L),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",ZU.Particle),this.registerInput("condition",ZU.Float,!0,0),this.registerInput("system",ZU.System),this.registerOutput("output",ZU.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){this._triggerCount=0;const U=this.input.getConnectedValue(L),x={process:x=>{if(L.particleContext=x,L.systemContext=U,0!==this.condition.getConnectedValue(L)&&(0===this.limit||this._triggerCount<this.limit)){const mL=(new Date).getTime();if(this._previousOne&&mL-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=mL;const p=this.system.getConnectedValue(L);if(p){const mL=CU(p,L.VU,x.position);mL.oa.addOnce((()=>{this._triggerCount--})),U.oa.addOnce((()=>{mL.dispose()}))}}},previousItem:null,nextItem:null};U._updateQueueStart?jL(x,U._updateQueueStart):U._updateQueueStart=x,this.output._storedValue=U}serialize(){const L=super.serialize();return L.limit=this.limit,L.delay=this.delay,L}_deserialize(L){super._deserialize(L),void 0!==L.limit&&(this.limit=L.limit),void 0!==L.delay&&(this.delay=L.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,y.d)([BU("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sx.prototype,"limit",void 0),(0,y.d)([BU("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sx.prototype,"delay",void 0),(0,a.d)("BABYLON.ParticleTriggerBlock",Sx);x(14036),x(14048),x(14059),x(14114)},14101:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneFragment",G="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14061:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneFragmentDeclaration",G="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14127:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneVertex",G="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14119:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneVertexDeclaration",G="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14111:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogFragment",G="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14095:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogFragmentDeclaration",G="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14136:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogVertex",G="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14124:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogVertexDeclaration",G="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14080:(L,U,x)=>{"use strict";var mL=x(12496);const p="helperFunctions",G="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14067:(L,U,x)=>{"use strict";var mL=x(12496);const p="imageProcessingDeclaration",G="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14089:(L,U,x)=>{"use strict";var mL=x(12496);const p="imageProcessingFunctions",G="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14072:(L,U,x)=>{"use strict";var mL=x(12496);const p="logDepthDeclaration",G="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14108:(L,U,x)=>{"use strict";var mL=x(12496);const p="logDepthFragment",G="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14144:(L,U,x)=>{"use strict";var mL=x(12496);const p="logDepthVertex",G="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";mL.d.IncludesShadersStoreWGSL[p]||(mL.d.IncludesShadersStoreWGSL[p]=G)},14059:(L,U,x)=>{"use strict";x.r(U),x.d(U,{particlesPixelShaderWGSL:()=>F});var mL=x(12496);x(14061),x(14067),x(14072),x(14080),x(14089),x(14095),x(14101),x(14108),x(14111);const p="particlesPixelShader",G="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";mL.d.ShadersStoreWGSL[p]||(mL.d.ShadersStoreWGSL[p]=G);const F={name:p,shader:G}},14114:(L,U,x)=>{"use strict";x.r(U),x.d(U,{particlesVertexShaderWGSL:()=>F});var mL=x(12496);x(14119),x(14124),x(14072),x(14127),x(14136),x(14144);const p="particlesVertexShader",G="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";mL.d.ShadersStoreWGSL[p]||(mL.d.ShadersStoreWGSL[p]=G);const F={name:p,shader:G}},13974:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneFragment",G="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},14041:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneFragmentDeclaration",G="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13999:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneVertex",G="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},14050:(L,U,x)=>{"use strict";var mL=x(12496);const p="clipPlaneVertexDeclaration",G="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13984:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogFragment",G="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13969:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogFragmentDeclaration",G="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},14004:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogVertex",G="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13992:(L,U,x)=>{"use strict";var mL=x(12496);const p="fogVertexDeclaration",G="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13952:(L,U,x)=>{"use strict";var mL=x(12496);const p="helperFunctions",G="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13938:(L,U,x)=>{"use strict";var mL=x(12496);const p="imageProcessingDeclaration",G="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13961:(L,U,x)=>{"use strict";var mL=x(12496);const p="imageProcessingFunctions",G="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13947:(L,U,x)=>{"use strict";var mL=x(12496);const p="logDepthDeclaration",G="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},13977:(L,U,x)=>{"use strict";var mL=x(12496);const p="logDepthFragment",G="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},14009:(L,U,x)=>{"use strict";var mL=x(12496);const p="logDepthVertex",G="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";mL.d.IncludesShadersStore[p]||(mL.d.IncludesShadersStore[p]=G)},14036:(L,U,x)=>{"use strict";x.r(U),x.d(U,{particlesPixelShader:()=>F});var mL=x(12496);x(14041),x(13938),x(13947),x(13952),x(13961),x(13969),x(13974),x(13977),x(13984);const p="particlesPixelShader",G="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";mL.d.ShadersStore[p]||(mL.d.ShadersStore[p]=G);const F={name:p,shader:G}},14048:(L,U,x)=>{"use strict";x.r(U),x.d(U,{particlesVertexShader:()=>F});var mL=x(12496);x(14050),x(13992),x(13947),x(13999),x(14004),x(14009);const p="particlesVertexShader",G="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";mL.d.ShadersStore[p]||(mL.d.ShadersStore[p]=G);const F={name:p,shader:G}},14408:(L,U,x)=>{"use strict";x.r(U),x.d(U,{FlowGraphGLTFDataProvider:()=>G});var mL=x(14371),p=x(14348);class G extends mL.e{constructor(L){var U,x;super();const mL=L.glTF,G=(null===(U=mL.animations)||void 0===U?void 0:U.map((L=>L._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",p.c,G);const F=(null===(x=mL.nodes)||void 0===x?void 0:x.map((L=>L._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",p.c,F)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14285:(L,U,x)=>{"use strict";x.d(U,{d:()=>V,h:()=>Y,j:()=>E,m:()=>S});var mL=x(12589),p=x(13086),G=x(12637),F=x(14294);const a=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class o{constructor(L,U){this._gltf=L,this._infoTree=U}convert(L){let U,x=this._gltf,mL=this._infoTree;if(!L.startsWith("/"))throw new Error("Path must start with a /");const p=L.split("/");if(p.shift(),p[p.length-1].includes(".length")){const L=p[p.length-1].split(".");p.pop(),p.push(...L)}let G=!1;for(const o of p){const p="length"===o;if(p&&!mL.__array__)throw new Error(`Path ${L} is invalid`);if(mL.__ignoreObjectTree__&&(G=!0),mL.__array__&&!p)mL=mL.__array__;else if(mL=mL[o],!mL)throw new Error(`Path ${L} is invalid`);if(!G)if(void 0===x){if(!a.find((U=>U.regex.test(L))))throw new Error(`Path ${L} is invalid`)}else if(!p){var F;x=null===(F=x)||void 0===F?void 0:F[o]}(mL.__target__||p)&&(U=x)}return{object:U,info:mL}}}function A(L,U,x,mL){const p=r(L,U);return mL?p[x][mL]:p[x]}function r(L,U,x){var mL,G;return null===(mL=L._data)||void 0===mL||null===(G=mL[(null===x||void 0===x?void 0:x.fillMode)??p.d.MATERIAL_TriangleFillMode])||void 0===G?void 0:G.babylonMaterial}function h(L,U){return{offset:{componentsCount:2,type:"Vector2",get:(x,p,G)=>{const F=A(x,G,L,U);return new mL.Vector2(null===F||void 0===F?void 0:F.uOffset,null===F||void 0===F?void 0:F.vOffset)},getTarget:r,set:(x,mL,p,G)=>{const F=A(mL,G,L,U);F.uOffset=x.x,F.vOffset=x.y},getPropertyName:[()=>`${L}${U?"."+U:""}.uOffset`,()=>`${L}${U?"."+U:""}.vOffset`]},rotation:{type:"number",get:(x,mL,p)=>{var G;return null===(G=A(x,p,L,U))||void 0===G?void 0:G.wAng},getTarget:r,set:(x,mL,p,G)=>A(mL,G,L,U).wAng=x,getPropertyName:[()=>`${L}${U?"."+U:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(x,p,G)=>{const F=A(x,G,L,U);return new mL.Vector2(null===F||void 0===F?void 0:F.uScale,null===F||void 0===F?void 0:F.vScale)},getTarget:r,set:(x,mL,p,G)=>{const F=A(mL,G,L,U);F.uScale=x.x,F.vScale=x.y},getPropertyName:[()=>`${L}${U?"."+U:""}.uScale`,()=>`${L}${U?"."+U:""}.vScale`]}}}const b={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:L=>{var U,x;return new mL.Vector2((null===(U=L._babylonCamera)||void 0===U?void 0:U.orthoLeft)??0,(null===(x=L._babylonCamera)||void 0===x?void 0:x.orthoRight)??0)},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.orthoLeft=L.x,U._babylonCamera.orthoRight=L.y)},getTarget:L=>L,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:L=>{var U,x;return new mL.Vector2((null===(U=L._babylonCamera)||void 0===U?void 0:U.orthoBottom)??0,(null===(x=L._babylonCamera)||void 0===x?void 0:x.orthoTop)??0)},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.orthoBottom=L.x,U._babylonCamera.orthoTop=L.y)},getTarget:L=>L,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:L=>{var U;return null===(U=L._babylonCamera)||void 0===U?void 0:U.maxZ},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=L)},getTarget:L=>L,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:L=>{var U;return null===(U=L._babylonCamera)||void 0===U?void 0:U.Qa},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.Qa=L)},getTarget:L=>L,getPropertyName:[()=>"Qa"]}},perspective:{aspectRatio:{type:"number",get:L=>{var U;return null===(U=L._babylonCamera)||void 0===U?void 0:U.getEngine().getAspectRatio(L._babylonCamera)},getTarget:L=>L,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:L=>{var U;return null===(U=L._babylonCamera)||void 0===U?void 0:U.fov},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.fov=L)},getTarget:L=>L,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:L=>{var U;return null===(U=L._babylonCamera)||void 0===U?void 0:U.maxZ},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=L)},getTarget:L=>L,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:L=>{var U;return null===(U=L._babylonCamera)||void 0===U?void 0:U.Qa},set:(L,U)=>{U._babylonCamera&&(U._babylonCamera.Qa=L)},getTarget:L=>L,getPropertyName:[()=>"Qa"]}}}},nodes:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"YU",get:L=>{var U;return null===(U=L._babylonTransformNode)||void 0===U?void 0:U.position},set:(L,U)=>{var x;return null===(x=U._babylonTransformNode)||void 0===x?void 0:x.position.p(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:L=>{var U;return null===(U=L._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion},set:(L,U)=>{var x,mL;return null===(x=U._babylonTransformNode)||void 0===x||null===(mL=x.rotationQuaternion)||void 0===mL?void 0:mL.p(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"YU",get:L=>{var U;return null===(U=L._babylonTransformNode)||void 0===U?void 0:U.Ka},set:(L,U)=>{var x;return null===(x=U._babylonTransformNode)||void 0===x?void 0:x.Ka.p(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"Ka"]},weights:{length:{type:"number",get:L=>L._numMorphTargets,getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(L,U)=>{var x,mL;return void 0!==U?null===(x=L._primitiveBabylonMeshes)||void 0===x||null===(mL=x[0].morphTargetManager)||void 0===mL?void 0:mL.getTarget(U).influence:void 0},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(L,U)=>[0],getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:L=>{var U,x,p;return mL.Matrix.Compose(null===(U=L._babylonTransformNode)||void 0===U?void 0:U.Ka,null===(x=L._babylonTransformNode)||void 0===x?void 0:x.rotationQuaternion,null===(p=L._babylonTransformNode)||void 0===p?void 0:p.position)},getTarget:L=>L._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:L=>{var U,x,p,G;const F=mL.Matrix.Identity();let a=L.parent;for(;a&&a.parent;)a=a.parent;const o=(null===(U=L._babylonTransformNode)||void 0===U?void 0:U.position._isDirty)||(null===(x=L._babylonTransformNode)||void 0===x||null===(p=x.rotationQuaternion)||void 0===p?void 0:p._isDirty)||(null===(G=L._babylonTransformNode)||void 0===G?void 0:G.Ka._isDirty);if(a){var A;const U=null===(A=a._babylonTransformNode)||void 0===A?void 0:A.fa(!0).invert();var r,h;if(U)null===(r=L._babylonTransformNode)||void 0===r||null===(h=r.fa(o))||void 0===h||h.multiplyToRef(U,F)}else L._babylonTransformNode&&F.p(L._babylonTransformNode.fa(o));return F},getTarget:L=>L._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:L=>{var U,x;return null===(U=L._babylonTransformNode)||void 0===U||null===(x=U.getChildren((L=>L instanceof F.b),!0)[0])||void 0===x?void 0:x.ya},getTarget:L=>{var U;return null===(U=L._babylonTransformNode)||void 0===U?void 0:U.getChildren((L=>L instanceof F.b),!0)[0]},set:(L,U)=>{if(U._babylonTransformNode){const x=U._babylonTransformNode.getChildren((L=>L instanceof F.b),!0)[0];x&&(x.ya=L)}}},color:{type:"QU",get:L=>{var U,x;return null===(U=L._babylonTransformNode)||void 0===U||null===(x=U.getChildren((L=>L instanceof F.b),!0)[0])||void 0===x?void 0:x.na},getTarget:L=>{var U;return null===(U=L._babylonTransformNode)||void 0===U?void 0:U.getChildren((L=>L instanceof F.b),!0)[0]},set:(L,U)=>{if(U._babylonTransformNode){const x=U._babylonTransformNode.getChildren((L=>L instanceof F.b),!0)[0];x&&(x.na=L)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"QU",get:(L,U,x)=>r(L,U,x).emissiveColor,set:(L,U,x,mL)=>r(U,x,mL).emissiveColor.p(L),getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:h("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(L,U,x)=>{var mL;return null===(mL=A(L,x,"bumpTexture"))||void 0===mL?void 0:mL.level},set:(L,U,x,mL)=>{const p=A(U,mL,"bumpTexture");p&&(p.level=L)},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:h("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(L,U,x)=>r(L,U,x).ambientTextureStrength,set:(L,U,x,mL)=>{const p=r(U,x,mL);p&&(p.ambientTextureStrength=L)},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:h("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ia",get:(L,U,x)=>{const mL=r(L,U,x);return G.ia.FromColor3(mL.albedoColor,mL.alpha)},set:(L,U,x,mL)=>{const p=r(U,x,mL);p.albedoColor.set(L.r,L.g,L.b),p.alpha=L.a},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:h("albedoTexture")}},metallicFactor:{type:"number",get:(L,U,x)=>r(L,U,x).metallic,set:(L,U,x,mL)=>{const p=r(U,x,mL);p&&(p.metallic=L)},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(L,U,x)=>r(L,U,x).roughness,set:(L,U,x,mL)=>{const p=r(U,x,mL);p&&(p.roughness=L)},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:h("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(L,U,x)=>r(L,U,x).anisotropy.ya,set:(L,U,x,mL)=>{r(U,x,mL).anisotropy.ya=L},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(L,U,x)=>r(L,U,x).anisotropy.angle,set:(L,U,x,mL)=>{r(U,x,mL).anisotropy.angle=L},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:h("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(L,U,x)=>r(L,U,x).clearCoat.ya,set:(L,U,x,mL)=>{r(U,x,mL).clearCoat.ya=L},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(L,U,x)=>r(L,U,x).clearCoat.roughness,set:(L,U,x,mL)=>{r(U,x,mL).clearCoat.roughness=L},getTarget:(L,U,x)=>r(L,U,x),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:h("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(L,U,x)=>{var mL;return null===(mL=r(L,U,x).clearCoat.bumpTexture)||void 0===mL?void 0:mL.level},getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).clearCoat.bumpTexture.level=L},extensions:{KHR_texture_transform:h("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:h("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(L,U,x)=>r(L,U,x).subSurface.dispersion,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).subSurface.dispersion=L}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(L,U,x)=>r(L,U,x).emissiveIntensity,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).emissiveIntensity=L}},KHR_materials_ior:{ior:{type:"number",get:(L,U,x)=>r(L,U,x).indexOfRefraction,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).indexOfRefraction=L}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(L,U,x)=>r(L,U,x).iridescence.ya,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).iridescence.ya=L},iridescenceIor:{type:"number",get:(L,U,x)=>r(L,U,x).iridescence.indexOfRefraction,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).iridescence.indexOfRefraction=L},iridescenceTexture:{extensions:{KHR_texture_transform:h("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(L,U,x)=>r(L,U,x).iridescence.maximumThickness,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).iridescence.maximumThickness=L},iridescenceThicknessMinimum:{type:"number",get:(L,U,x)=>r(L,U,x).iridescence.minimumThickness,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).iridescence.minimumThickness=L},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:h("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"QU",get:(L,U,x)=>r(L,U,x).sheen.color,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).sheen.color.p(L)},sheenColorTexture:{extensions:{KHR_texture_transform:h("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(L,U,x)=>r(L,U,x).sheen.ya,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).sheen.ya=L},sheenRoughnessTexture:{extensions:{KHR_texture_transform:h("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(L,U,x)=>r(L,U,x).metallicF0Factor,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).metallicF0Factor=L,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"QU",get:(L,U,x)=>r(L,U,x).metallicReflectanceColor,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).metallicReflectanceColor.p(L),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:h("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:h("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(L,U,x)=>r(L,U,x).subSurface.refractionIntensity,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).subSurface.refractionIntensity=L,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(L,U,x)=>r(L,U,x).subSurface.translucencyIntensity,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).subSurface.translucencyIntensity=L},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"QU",get:(L,U,x)=>r(L,U,x).subSurface.translucencyColor,getTarget:r,set:(L,U,x,mL)=>{var p;return L&&(null===(p=r(U,x,mL).subSurface.translucencyColor)||void 0===p?void 0:p.p(L))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"QU",get:(L,U,x)=>r(L,U,x).subSurface.tintColor,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).subSurface.tintColor.p(L)},attenuationDistance:{type:"number",get:(L,U,x)=>r(L,U,x).subSurface.tintColorAtDistance,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).subSurface.tintColorAtDistance=L},thicknessFactor:{type:"number",get:(L,U,x)=>r(L,U,x).subSurface.maximumThickness,getTarget:r,set:(L,U,x,mL)=>r(U,x,mL).subSurface.maximumThickness=L},thicknessTexture:{extensions:{KHR_texture_transform:h("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonLight)),getPropertyName:[L=>"length"]},__array__:{__target__:!0,color:{type:"QU",get:L=>{var U;return null===(U=L._babylonLight)||void 0===U?void 0:U.na},set:(L,U)=>{var x;return null===(x=U._babylonLight)||void 0===x?void 0:x.na.p(L)},getTarget:L=>L._babylonLight,getPropertyName:[L=>"diffuse"]},ya:{type:"number",get:L=>{var U;return null===(U=L._babylonLight)||void 0===U?void 0:U.ya},set:(L,U)=>U._babylonLight?U._babylonLight.ya=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"intensity"]},range:{type:"number",get:L=>{var U;return null===(U=L._babylonLight)||void 0===U?void 0:U.range},set:(L,U)=>U._babylonLight?U._babylonLight.range=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"range"]},spot:{innerConeAngle:{type:"number",get:L=>{var U;return null===(U=L._babylonLight)||void 0===U?void 0:U.innerAngle},set:(L,U)=>U._babylonLight?U._babylonLight.innerAngle=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"innerConeAngle"]},outerConeAngle:{type:"number",get:L=>{var U;return null===(U=L._babylonLight)||void 0===U?void 0:U.angle},set:(L,U)=>U._babylonLight?U._babylonLight.angle=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonLight)),getPropertyName:[L=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonTexture)),getPropertyName:[L=>"length"]},__array__:{__target__:!0,ya:{type:"number",get:L=>{var U;return null===(U=L._babylonTexture)||void 0===U?void 0:U.level},set:(L,U)=>{U._babylonTexture&&(U._babylonTexture.level=L)},getTarget:L=>L._babylonTexture},rotation:{type:"Quaternion",get:L=>{var U;return L._babylonTexture&&mL.Quaternion.FromRotationMatrix(null===(U=L._babylonTexture)||void 0===U?void 0:U.getReflectionTextureMatrix())},set:(L,U)=>{var x;U._babylonTexture&&(null!==(x=U._babylonTexture.PL())&&void 0!==x&&x.useRightHandedSystem||(L=mL.Quaternion.Inverse(L)),mL.Matrix.FromQuaternionToRef(L,U._babylonTexture.getReflectionTextureMatrix()))},getTarget:L=>L._babylonTexture}}}}},animations:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>{var U;return null===(U=L.primitives[0]._instanceData)||void 0===U?void 0:U.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function E(L){return new o(L,b)}function Y(L){const U=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let x=b;for(const mL of U)mL&&(x=x[mL]);if(x&&x.type&&x.get)return x}function S(L,U){const x=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let mL=b;for(const p of x)p&&(mL=mL[p]);mL&&mL.type&&mL.get&&(mL.interpolation=U)}function V(L,U){const x=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let mL=b;for(const p of x)if(p){if(!mL[p]){if("?"===p){mL.__ignoreObjectTree__=!0;continue}mL[p]={},"__array__"===p&&(mL[p].__target__=!0)}mL=mL[p]}Object.assign(mL,U)}},14300:(L,U,x)=>{"use strict";x.r(U),x.d(U,{AnimationPropertyInfo:()=>A,TransformNodeAnimationPropertyInfo:()=>r,WeightAnimationPropertyInfo:()=>h,getQuaternion:()=>a,getVector3:()=>F,getWeights:()=>o});var mL=x(13133),p=x(12589),G=x(14285);function F(L,U,x,mL){return p.YU.qU(U,x).scaleInPlace(mL)}function a(L,U,x,mL){return p.Quaternion.qU(U,x).scaleInPlace(mL)}function o(L,U,x,mL){const p=new Array(L._numMorphTargets);for(let G=0;G<p.length;G++)p[G]=U[x++]*mL;return p}class A{constructor(L,U,x,mL){this.type=L,this.name=U,this.getValue=x,this.getStride=mL}_buildAnimation(L,U,x){const p=new mL.c(L,this.name,U,this.type);return p.setKeys(x),p}}class r extends A{buildAnimations(L,U,x,mL){const p=[];return p.push({babylonAnimatable:L._babylonTransformNode,babylonAnimation:this._buildAnimation(U,x,mL)}),p}}class h extends A{buildAnimations(L,U,x,p){const G=[];if(L._numMorphTargets)for(let F=0;F<L._numMorphTargets;F++){const a=new mL.c(`${U}_${F}`,this.name,x,this.type);if(a.setKeys(p.map((L=>({frame:L.frame,inTangent:L.inTangent?L.inTangent[F]:void 0,value:L.value[F],outTangent:L.outTangent?L.outTangent[F]:void 0,interpolation:L.interpolation})))),L._primitiveBabylonMeshes)for(const U of L._primitiveBabylonMeshes)if(U.morphTargetManager){const L=U.morphTargetManager.getTarget(F),x=a.clone();L.animations.push(x),G.push({babylonAnimatable:L,babylonAnimation:x})}}return G}}(0,G.m)("/nodes/{}/translation",[new r(mL.c.ANIMATIONTYPE_VECTOR3,"position",F,(()=>3))]),(0,G.m)("/nodes/{}/rotation",[new r(mL.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",a,(()=>4))]),(0,G.m)("/nodes/{}/scale",[new r(mL.c.ANIMATIONTYPE_VECTOR3,"Ka",F,(()=>3))]),(0,G.m)("/nodes/{}/weights",[new h(mL.c.ANIMATIONTYPE_FLOAT,"influence",o,(L=>L._numMorphTargets))])},14254:(L,U,x)=>{"use strict";class mL{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((L,U)=>{this._resolve=L,this._reject=U}))}}var p=x(12589),G=x(12637),F=x(12382),a=x(13052),o=x(14258),A=x(14271),r=x(12391),h=x(13078),b=x(13133),E=x(13138),Y=x(12440),S=x(12406),V=x(12414);class H{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(L){this._useTextureToStoreBoneMatrices=L,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(L){this._animationPropertiesOverride=L}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(L,U,x){this.name=L,this.id=U,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=p.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new r.c,this.bones=[],this._scene=x||Y.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const mL=this._scene.getEngine().getCaps();this._canUseTextureForBones=mL.textureFloat&&mL.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((L=>!L.getParent()))}getTransformMatrices(L){if(this.needInitialSkinMatrix){if(!L)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return L._bonesTransformMatrices||this.prepare(!0),L._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(L){return this.needInitialSkinMatrix&&L._transformMatrixTexture?L._transformMatrixTexture:this._transformMatrixTexture}PL(){return this._scene}toString(L){let U=`Name: ${this.name}, nBones: ${this.bones.length}`;if(U+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,L){U+=", Ranges: {";let L=!0;for(const x in this._ranges)L&&(U+=", ",L=!1),U+=x;U+="}"}return U}getBoneIndexByName(L){for(let U=0,x=this.bones.length;U<x;U++)if(this.bones[U].name===L)return U;return-1}createAnimationRange(L,U,x){if(!this._ranges[L]){this._ranges[L]=new E.b(L,U,x);for(let mL=0,p=this.bones.length;mL<p;mL++)this.bones[mL].animations[0]&&this.bones[mL].animations[0].createRange(L,U,x)}}deleteAnimationRange(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let x=0,mL=this.bones.length;x<mL;x++)this.bones[x].animations[0]&&this.bones[x].animations[0].deleteRange(L,U);this._ranges[L]=null}getAnimationRange(L){return this._ranges[L]||null}getAnimationRanges(){const L=[];let U;for(U in this._ranges)L.push(this._ranges[U]);return L}copyAnimationRange(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[U]||!L.getAnimationRange(U))return!1;let mL=!0;const p=this._getHighestAnimationFrame()+1,G={},F=L.bones;let a,o;for(o=0,a=F.length;o<a;o++)G[F[o].name]=F[o];this.bones.length!==F.length&&(S.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${F.length}`),mL=!1);const A=x&&this.dimensionsAtRest&&L.dimensionsAtRest?this.dimensionsAtRest.divide(L.dimensionsAtRest):null;for(o=0,a=this.bones.length;o<a;o++){const L=this.bones[o].name,F=G[L];F?mL=mL&&this.bones[o].copyAnimationRange(F,U,p,x,A):(S.c.Warn("copyAnimationRange: not same rig, missing source bone "+L),mL=!1)}const r=L.getAnimationRange(U);return r&&(this._ranges[U]=new E.b(U,r.from+p,r.to+p)),mL}returnToRest(){for(const L of this.bones)-1!==L._index&&L.returnToRest()}_getHighestAnimationFrame(){let L=0;for(let U=0,x=this.bones.length;U<x;U++)if(this.bones[U].animations[0]){const x=this.bones[U].animations[0].getHighestFrame();L<x&&(L=x)}return L}beginAnimation(L,U,x,mL){const p=this.getAnimationRange(L);return p?this._scene.beginAnimation(this,p.from,p.to,U,x,mL):null}static MakeAnimationAdditive(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;const mL=L.getAnimationRange(x);if(!mL)return null;const p=L._scene.getAllAnimatablesByTarget(L);let G=null;for(let a=0;a<p.length;a++){const L=p[a];if(L.fromFrame===(null===mL||void 0===mL?void 0:mL.from)&&L.toFrame===(null===mL||void 0===mL?void 0:mL.to)){G=L;break}}const F=L.getAnimatables();for(let a=0;a<F.length;a++){const L=F[a].animations;if(L)for(let mL=0;mL<L.length;mL++)b.c.MakeAnimationAdditive(L[mL],U,x)}return G&&(G.isAdditive=!0),L}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(L){this._meshesWithPoseMatrix.push(L)}_unregisterMeshWithPoseMatrix(L){const U=this._meshesWithPoseMatrix.indexOf(L);U>-1&&this._meshesWithPoseMatrix.splice(U,1)}_computeTransformMatrices(L,U){this.onBeforeComputeObservable.notifyObservers(this);for(let x=0;x<this.bones.length;x++){const mL=this.bones[x];mL._childUpdateId++;const p=mL.getParent();if(p?mL.getLocalMatrix().multiplyToRef(p.getFinalMatrix(),mL.getFinalMatrix()):U?mL.getLocalMatrix().multiplyToRef(U,mL.getFinalMatrix()):mL.getFinalMatrix().p(mL.getLocalMatrix()),-1!==mL._index){const U=null===mL._index?x:mL._index;mL.getAbsoluteInverseBindMatrix().multiplyToArray(mL.getFinalMatrix(),L,16*U)}}this._identity.copyToArray(L,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const L=this.PL().getRenderId();if(this._currentRenderId===L)return;this._currentRenderId=L}if(this._numBonesWithLinkedTransformNode>0)for(const L of this.bones)if(L._linkedTransformNode){const U=L._linkedTransformNode;L.position=U.position,U.rotationQuaternion?L.rotationQuaternion=U.rotationQuaternion:L.rotation=U.rotation,L.Ka=U.Ka}if(this.needInitialSkinMatrix)for(const L of this._meshesWithPoseMatrix){const U=L.getPoseMatrix();let x=this._isDirty;if(L._bonesTransformMatrices&&L._bonesTransformMatrices.length===16*(this.bones.length+1)||(L._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),x=!0),x){if(this._synchronizedWithMesh!==L){this._synchronizedWithMesh=L;for(const L of this.bones)if(!L.getParent()){L.getBindMatrix().multiplyToRef(U,p.TmpVectors.Matrix[1]),L._updateAbsoluteBindMatrices(p.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const U=4*(this.bones.length+1);L._transformMatrixTexture&&L._transformMatrixTexture.getSize().width===U||(L._transformMatrixTexture&&L._transformMatrixTexture.dispose(),L._transformMatrixTexture=h.b.CreateRGBATexture(L._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(L._bonesTransformMatrices,U),this.isUsingTextureForMatrices&&L._transformMatrixTexture&&L._transformMatrixTexture.update(L._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=h.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let L=0;L<this.bones.length;L++)this._animatables.push(this.bones[L])}return this._animatables}clone(L,U){const x=new H(L,U||L,this._scene);x.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let mL=0;mL<this.bones.length;mL++){const L=this.bones[mL];let U=null;const p=L.getParent();if(p){const L=this.bones.indexOf(p);U=x.bones[L]}const G=new A.d(L.name,x,U,L.getBindMatrix().clone(),L.getRestMatrix().clone());G._index=L._index,L._linkedTransformNode&&G.linkTransformNode(L._linkedTransformNode),V.b.DeepCopy(L.animations,G.animations)}if(this._ranges){x._ranges={};for(const L in this._ranges){const U=this._ranges[L];U&&(x._ranges[L]=U.clone())}}return this._isDirty=!0,x.prepare(!0),x}enableBlending(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const U of this.bones)for(const x of U.animations)x.enableBlending=!0,x.blendingSpeed=L}dispose(){if(this._meshesWithPoseMatrix.length=0,this.PL().stopAnimation(this),this.PL().removeSkeleton(this),this._parentContainer){const L=this._parentContainer.skeletons.indexOf(this);L>-1&&this._parentContainer.skeletons.splice(L,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const L={};L.name=this.name,L.id=this.id,this.dimensionsAtRest&&(L.dimensionsAtRest=this.dimensionsAtRest.Va()),L.bones=[],L.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let x=0;x<this.bones.length;x++){var U;const mL=this.bones[x],p=mL.getParent(),G={parentBoneIndex:p?this.bones.indexOf(p):-1,index:mL.getIndex(),name:mL.name,id:mL.id,matrix:mL.getBindMatrix().Va(),rest:mL.getRestMatrix().Va(),linkedTransformNodeId:null===(U=mL.getTransformNode())||void 0===U?void 0:U.id};L.bones.push(G),mL.length&&(G.length=mL.length),mL.metadata&&(G.metadata=mL.metadata),mL.animations&&mL.animations.length>0&&(G.animation=mL.animations[0].serialize()),L.ranges=[];for(const U in this._ranges){const x=this._ranges[U];if(!x)continue;const mL={};mL.name=U,mL.from=x.from,mL.to=x.to,L.ranges.push(mL)}}return L}static Parse(L,U){const x=new H(L.name,L.id,U);let mL;for(L.dimensionsAtRest&&(x.dimensionsAtRest=p.YU.qU(L.dimensionsAtRest)),x.needInitialSkinMatrix=L.needInitialSkinMatrix,mL=0;mL<L.bones.length;mL++){const U=L.bones[mL],G=L.bones[mL].index;let F=null;U.parentBoneIndex>-1&&(F=x.bones[U.parentBoneIndex]);const a=U.rest?p.Matrix.qU(U.rest):null,o=new A.d(U.name,x,F,p.Matrix.qU(U.matrix),a,null,G);void 0!==U.id&&null!==U.id&&(o.id=U.id),U.length&&(o.length=U.length),U.metadata&&(o.metadata=U.metadata),U.animation&&o.animations.push(b.c.Parse(U.animation)),void 0!==U.linkedTransformNodeId&&null!==U.linkedTransformNodeId&&(x._hasWaitingData=!0,o._waitingTransformNodeId=U.linkedTransformNodeId)}if(L.ranges)for(mL=0;mL<L.ranges.length;mL++){const U=L.ranges[mL];x.createAnimationRange(U.name,U.from,U.to)}return x}computeAbsoluteMatrices(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||L)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(L)}getPoseMatrix(){let L=null;return this._meshesWithPoseMatrix.length>0&&(L=this._meshesWithPoseMatrix[0].getPoseMatrix()),L}sortBones(){const L=[],U=new Array(this.bones.length);for(let x=0;x<this.bones.length;x++)this._sortBones(x,L,U);this.bones=L}_sortBones(L,U,x){if(x[L])return;x[L]=!0;const mL=this.bones[L];if(!mL)return;void 0===mL._index&&(mL._index=L);const p=mL.getParent();p&&this._sortBones(this.bones.indexOf(p),U,x),U.push(mL)}setCurrentPoseAsRest(){for(const L of this.bones)L.setCurrentPoseAsRest()}}var Q=x(12915),q=x(13102),f=x(12565),v=x(13015),D=x(12666),P=x(13061),d=x(13026),K=x(13046),l=x(13143),i=x(12684),X=x(14215);class t{set areUpdatesFrozen(L){L?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,L||(L=Y.c.LastCreatedScene),this._scene=L,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const L=this._scene.getEngine().getCaps();this._canUseTextureForTargets=L.canUseGLVertexID&&L.textureFloat&&L.maxVertexTextureImageUnits>0&&L.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return t.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?t.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(L){this._numMaxInfluencers!==L&&(this._numMaxInfluencers=L,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(L){this._useTextureToStoreTargets!==L&&(this._useTextureToStoreTargets=L,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var L;return t.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(L=this._scene)&&void 0!==L&&L.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(L){return this._activeTargets.data[L]}getTarget(L){return this._targets[L]}getTargetByName(L){for(const U of this._targets)if(U.name===L)return U;return null}addTarget(L){this._targets.push(L),this._targetInfluenceChangedObservers.push(L.onInfluenceChanged.add((L=>{this.areUpdatesFrozen&&L&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(L)}))),this._targetDataLayoutChangedObservers.push(L._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(L){const U=this._targets.indexOf(L);U>=0&&(this._targets.splice(U,1),L.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(U,1)[0]),L._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(U,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(L)}_bind(L){L.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),L.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),L.setTexture("morphTargets",this._targetStoreTexture),L.setInt("morphTargetCount",this.numInfluencers)}clone(){const L=new t(this._scene);for(const U of this._targets)L.addTarget(U.clone());return L.enablePositionMorphing=this.enablePositionMorphing,L.enableNormalMorphing=this.enableNormalMorphing,L.enableTangentMorphing=this.enableTangentMorphing,L.enableUVMorphing=this.enableUVMorphing,L.enableUV2Morphing=this.enableUV2Morphing,L.enableColorMorphing=this.enableColorMorphing,L}serialize(){const L={};L.id=this.uniqueId,L.targets=[];for(const U of this._targets)L.targets.push(U.serialize());return L}_syncActiveTargets(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const U=!!this._targetStoreTexture,x=this.isUsingTextureForTargets;(this._mustSynchronize||U!==x)&&(this._mustSynchronize=!1,this.synchronize());let mL=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let p=-1;for(const G of this._targets)if(p++,0!==G.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=t.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(G),this._morphTargetTextureIndices[mL]=p,this._tempInfluences[mL++]=G.influence}this._morphTargetTextureIndices.length!==mL&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,mL)),this._influences&&this._influences.length===mL||(this._influences=new Float32Array(mL));for(let G=0;G<mL;G++)this._influences[G]=this._tempInfluences[G];if(L&&this._scene)for(const G of this._scene.meshes)G.morphTargetManager===this&&(x?G._markSubMeshesAsAttributesDirty():G._syncGeometryWithMorphTargetManager())}synchronize(){var L;if(!this._scene||this.areUpdatesFrozen)return;const U=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(L=this._targetStoreTexture)||void 0===L||L.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>U.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const x of this._targets){this._supportsPositions=this._supportsPositions&&x.hasPositions,this._supportsNormals=this._supportsNormals&&x.hasNormals,this._supportsTangents=this._supportsTangents&&x.hasTangents,this._supportsUVs=this._supportsUVs&&x.hasUVs,this._supportsUV2s=this._supportsUV2s&&x.hasUV2s,this._supportsColors=this._supportsColors&&x.hasColors;const L=x.vertexCount;if(0===this._vertexCount)this._vertexCount=L;else if(this._vertexCount!==L)return void S.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${x.name}": ${L}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const L=U.getCaps().maxTextureSize;this._textureWidth>L&&(this._textureHeight=Math.ceil(this._textureWidth/L),this._textureWidth=L);const x=this._targets.length,mL=new Float32Array(x*this._textureWidth*this._textureHeight*4);let p=0;for(let U=0;U<x;U++){const L=this._targets[U],x=L.getPositions(),G=L.getNormals(),F=L.getUVs(),a=L.getTangents(),o=L.getUV2s(),A=L.getColors();p=U*this._textureWidth*this._textureHeight*4;for(let U=0;U<this._vertexCount;U++)this._supportsPositions&&x&&(mL[p]=x[3*U],mL[p+1]=x[3*U+1],mL[p+2]=x[3*U+2],p+=4),this._supportsNormals&&G&&(mL[p]=G[3*U],mL[p+1]=G[3*U+1],mL[p+2]=G[3*U+2],p+=4),this._supportsUVs&&F&&(mL[p]=F[2*U],mL[p+1]=F[2*U+1],p+=4),this._supportsTangents&&a&&(mL[p]=a[3*U],mL[p+1]=a[3*U+1],mL[p+2]=a[3*U+2],p+=4),this._supportsUV2s&&o&&(mL[p]=o[2*U],mL[p+1]=o[2*U+1],p+=4),this._supportsColors&&A&&(mL[p]=A[4*U],mL[p+1]=A[4*U+1],mL[p+2]=A[4*U+2],mL[p+3]=A[4*U+3],p+=4)}this._targetStoreTexture=X.e.CreateRGBATexture(mL,this._textureWidth,this._textureHeight,x,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const x of this._scene.meshes)x.morphTargetManager===this&&x._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const L=this._parentContainer.morphTargetManagers.indexOf(this);L>-1&&this._parentContainer.morphTargetManagers.splice(L,1),this._parentContainer=null}for(const L of this._targets)this._scene.stopAnimation(L)}}static Parse(L,U){const x=new t(U);for(const mL of L.targets)x.addTarget(l.b.Parse(mL,U));return x}}t.EnableTextureStorage=!0,t.MaxActiveMorphTargetsInVertexAttributeMode=8,t.ConstantTargetCountForTextureMode=0;var y=x(14273),n=x(12448),N=x(12938);const e=new Map,u=e;function Z(L,U,x){g(L)&&S.c.Warn(`Extension with the name '${L}' already exists`),e.set(L,{isGLTFExtension:U,factory:x})}function g(L){return e.delete(L)}var z=x(14285),M=x(13202),J=x(12675);class j{static Get(L,U,x){if(!U||void 0==x||!U[x])throw new Error(`${L}: Failed to find index (${x})`);return U[x]}static TryGet(L,U){return L&&void 0!=U&&L[U]?L[U]:null}static Assign(L){if(L)for(let U=0;U<L.length;U++)L[U].index=U}}function R(L){if(L.min&&L.max){const U=L.min,x=L.max,mL=p.TmpVectors.YU[0].da(U[0],U[1],U[2]),G=p.TmpVectors.YU[1].da(x[0],x[1],x[2]);if(L.normalized&&5126!==L.componentType){let U=1;switch(L.componentType){case 5120:U=127;break;case 5121:U=255;break;case 5122:U=32767;break;case 5123:U=65535}const x=1/U;mL.scaleInPlace(x),G.scaleInPlace(x)}return new N.b(mL,G)}return null}class c{static RegisterExtension(L,U){Z(L,!1,U)}static UnregisterExtension(L){return g(L)}get ba(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(L){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=L}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((L=>L.dispose&&L.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(L,U,x,mL,p,G){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=U,this._assetContainer=x,this._loadData(mL);let G=null;if(L){const U={};if(this._gltf.nodes)for(const L of this._gltf.nodes)L.name&&(U[L.name]=L.index);G=(L instanceof Array?L:[L]).map((L=>{const x=U[L];if(void 0===x)throw new Error(`Failed to find node '${L}'`);return x}))}return await this._loadAsync(p,F,G,(()=>({meshes:this._getMeshes(),fE:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=L,this._loadData(U),await this._loadAsync(x,p,null,(()=>{}))}async _loadAsync(L,U,x,mL){return await Promise.resolve().then((async()=>{this._rootUrl=L,this._uniqueRootUrl=!L.startsWith("file:")&&U?L:`${L}${Date.now()}/`,this._fileName=U,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const p=`${y.l[y.l.LOADING]} => ${y.l[y.l.READY]}`,G=`${y.l[y.l.LOADING]} => ${y.l[y.l.COMPLETE]}`;this._parent._startPerformanceCounter(p),this._parent._startPerformanceCounter(G),this._parent._setState(y.l.LOADING),this._extensionsOnLoading();const a=new Array;if(!this.parent.loadOnlyMaterials)if(x)a.push(this.loadSceneAsync("/nodes",{nodes:x,index:-1}));else if(void 0!=this._gltf.VU||this._gltf.scenes&&this._gltf.scenes[0]){const L=j.Get("/scene",this._gltf.scenes,this._gltf.VU||0);a.push(this.loadSceneAsync(`/scenes/${L.index}`,L))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let L=0;L<this._gltf.materials.length;++L){const U=this._gltf.materials[L],x="/materials/"+L,mL=Q.c.TriangleFillMode;a.push(this._loadMaterialAsync(x,U,null,mL,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&a.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&a.push(this._compileShadowGeneratorsAsync());const o=Promise.all(a).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ka(!0);for(const L of this._babylonScene.materials){const U=L;void 0!==U.maxSimultaneousLights&&(U.maxSimultaneousLights=Math.max(U.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(y.l.READY),this._skipStartAnimationStep||this._startAnimations(),mL()}));return await o.then((L=>(this._parent._endPerformanceCounter(p),F.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(G),this._parent._setState(y.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(L=>{this._parent.onErrorObservable.notifyObservers(L),this._parent.onErrorObservable.clear(),this.dispose()}))})),L)))})).catch((L=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(L),this._parent.onErrorObservable.clear(),this.dispose()),L}))}_loadData(L){if(this._gltf=L.json,this._setupData(),L.bin){const U=this._gltf.buffers;if(U&&U[0]&&!U[0].uri){const x=U[0];(x.byteLength<L.bin.byteLength-3||x.byteLength>L.bin.byteLength)&&S.c.Warn(`Binary buffer length (${x.byteLength}) from JSON does not match chunk length (${L.bin.byteLength})`),this._bin=L.bin}else S.c.Warn("Unexpected BIN chunk")}}_setupData(){if(j.Assign(this._gltf.accessors),j.Assign(this._gltf.animations),j.Assign(this._gltf.buffers),j.Assign(this._gltf.bufferViews),j.Assign(this._gltf.cameras),j.Assign(this._gltf.images),j.Assign(this._gltf.materials),j.Assign(this._gltf.meshes),j.Assign(this._gltf.nodes),j.Assign(this._gltf.samplers),j.Assign(this._gltf.scenes),j.Assign(this._gltf.skins),j.Assign(this._gltf.textures),this._gltf.nodes){const L={};for(const x of this._gltf.nodes)if(x.children)for(const U of x.children)L[U]=x.index;const U=this._createRootNode();for(const x of this._gltf.nodes){const mL=L[x.index];x.parent=void 0===mL?U:this._gltf.nodes[mL]}}}async _loadExtensionsAsync(){const L=[];if(u.forEach(((U,x)=>{var mL;!1===(null===(mL=this.parent.extensionOptions[x])||void 0===mL?void 0:mL.enabled)?U.isGLTFExtension&&this.isExtensionUsed(x)&&S.c.Warn(`Extension ${x} is used but has been explicitly disabled.`):U.isGLTFExtension&&!this.isExtensionUsed(x)||L.push((async()=>{const L=await U.factory(this);return L.name!==x&&S.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${L.name} !== ${x}`),this._parent.onExtensionLoadedObservable.notifyObservers(L),L})())})),this._extensions.push(...await Promise.all(L)),this._extensions.sort(((L,U)=>(L.order||Number.MAX_VALUE)-(U.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const x of this._gltf.extensionsRequired){if(!this._extensions.some((L=>L.name===x&&L.enabled))){var U;if(!1===(null===(U=this.parent.extensionOptions[x])||void 0===U?void 0:U.enabled))throw new Error(`Required extension ${x} is disabled`);throw new Error(`Required extension ${x} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new K.e("__root__",this._babylonScene);this._rootBabylonMesh=L,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ka(!1);const U={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case y.i.AUTO:this._babylonScene.useRightHandedSystem||(U.rotation=[0,1,0,0],U.scale=[1,1,-1],c._LoadTransform(U,this._rootBabylonMesh));break;case y.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(L),U}loadSceneAsync(L,U){const x=this._extensionsLoadSceneAsync(L,U);if(x)return x;const mL=new Array;if(this.logOpen(`${L} ${U.name||""}`),U.nodes)for(const p of U.nodes){const U=j.Get(`${L}/nodes/${p}`,this._gltf.nodes,p);mL.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(L=>{L.parent=this._rootBabylonMesh})))}for(const p of this._postSceneLoadActions)p();return mL.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(mL).then((()=>{}))}_forEachPrimitive(L,U){if(L._primitiveBabylonMeshes)for(const x of L._primitiveBabylonMeshes)U(x)}_getGeometries(){const L=[],U=this._gltf.nodes;if(U)for(const x of U)this._forEachPrimitive(x,(U=>{const x=U.va;x&&-1===L.indexOf(x)&&L.push(x)}));return L}_getMeshes(){const L=[];this._rootBabylonMesh instanceof d.c&&L.push(this._rootBabylonMesh);const U=this._gltf.nodes;if(U)for(const x of U)this._forEachPrimitive(x,(U=>{L.push(U)}));return L}_getTransformNodes(){const L=[],U=this._gltf.nodes;if(U)for(const x of U)x._babylonTransformNode&&"mh"===x._babylonTransformNode.getClassName()&&L.push(x._babylonTransformNode),x._babylonTransformNodeForSkin&&L.push(x._babylonTransformNodeForSkin);return L}_getSkeletons(){const L=[],U=this._gltf.skins;if(U)for(const x of U)x._data&&L.push(x._data.babylonSkeleton);return L}_getAnimationGroups(){const L=[],U=this._gltf.animations;if(U)for(const x of U)x._babylonAnimationGroup&&L.push(x._babylonAnimationGroup);return L}_startAnimations(){switch(this._parent.animationStartMode){case y.g.NONE:break;case y.g.FIRST:{const L=this._getAnimationGroups();0!==L.length&&L[0].start(!0);break}case y.g.ALL:{const L=this._getAnimationGroups();for(const U of L)U.start(!0);break}default:return void S.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const mL=this._extensionsLoadNodeAsync(L,U,x);if(mL)return mL;if(U._babylonTransformNode)throw new Error(`${L}: Invalid recursive node hierarchy`);const p=new Array;this.logOpen(`${L} ${U.name||""}`);const G=mL=>{if(c.AddPointerMetadata(mL,L),c._LoadTransform(U,mL),void 0!=U.camera){const x=j.Get(`${L}/camera`,this._gltf.cameras,U.camera);p.push(this.loadCameraAsync(`/cameras/${x.index}`,x,(L=>{L.parent=mL,this._babylonScene.useRightHandedSystem||(mL.Ka.x=-1)})))}if(U.children)for(const x of U.children){const U=j.Get(`${L}/children/${x}`,this._gltf.nodes,x);p.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(L=>{L.parent=mL})))}x(mL)},F=void 0!=U.mesh,a=this._parent.loadSkins&&void 0!=U.skin;if(!F||a){const L=U.name||`node${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new v.e(L,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==U.mesh?U._babylonTransformNode=x:U._babylonTransformNodeForSkin=x,G(x)}if(F)if(a){const x=j.Get(`${L}/mesh`,this._gltf.meshes,U.mesh);p.push(this._loadMeshAsync(`/meshes/${x.index}`,U,x,(x=>{const mL=U._babylonTransformNodeForSkin;x.metadata=(0,M.e)(mL.metadata,x.metadata||{});const G=j.Get(`${L}/skin`,this._gltf.skins,U.skin);p.push(this._loadSkinAsync(`/skins/${G.index}`,U,G,(L=>{this._forEachPrimitive(U,(U=>{U.skeleton=L})),this._postSceneLoadActions.push((()=>{if(void 0!=G.skeleton){const L=j.Get(`/skins/${G.index}/skeleton`,this._gltf.nodes,G.skeleton).parent;U.index===L.index?x.parent=mL.parent:x.parent=L._babylonTransformNode}else x.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:mL,skinnedNode:x})}))})))})))}else{const x=j.Get(`${L}/mesh`,this._gltf.meshes,U.mesh);p.push(this._loadMeshAsync(`/meshes/${x.index}`,U,x,G))}return this.logClose(),Promise.all(p).then((()=>(this._forEachPrimitive(U,(L=>{const U=L;!U.isAnInstance&&U.va&&U.va.useBoundingInfoFromGeometry?L.NL():L.refreshBoundingInfo(!0,!0)})),U._babylonTransformNode)))}_loadMeshAsync(L,U,x,mL){const p=x.primitives;if(!p||!p.length)throw new Error(`${L}: Primitives are missing`);void 0==p[0].index&&j.Assign(p);const G=new Array;this.logOpen(`${L} ${x.name||""}`);const F=U.name||`node${U.index}`;if(1===p.length){const mL=x.primitives[0];G.push(this._loadMeshPrimitiveAsync(`${L}/primitives/${mL.index}`,F,U,x,mL,(L=>{U._babylonTransformNode=L,U._primitiveBabylonMeshes=[L]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,U._babylonTransformNode=new v.e(F,this._babylonScene),U._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._primitiveBabylonMeshes=[];for(const mL of p)G.push(this._loadMeshPrimitiveAsync(`${L}/primitives/${mL.index}`,`${F}_primitive${mL.index}`,U,x,mL,(L=>{L.parent=U._babylonTransformNode,U._primitiveBabylonMeshes.push(L)})))}return mL(U._babylonTransformNode),this.logClose(),Promise.all(G).then((()=>U._babylonTransformNode))}_loadMeshPrimitiveAsync(L,U,x,mL,p,G){const F=this._extensionsLoadMeshPrimitiveAsync(L,U,x,mL,p,G);if(F)return F;this.logOpen(`${L}`);const a=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==x.skin&&!mL.primitives[0].targets;let o,A;if(a&&p._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,o=p._instanceData.babylonSourceMesh.createInstance(U),o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A=p._instanceData.promise;else{const G=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new K.e(U,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.sideOrientation=this._babylonScene.useRightHandedSystem?Q.c.CounterClockWiseSideOrientation:Q.c.ClockWiseSideOrientation,this._createMorphTargets(L,x,mL,p,F),G.push(this._loadVertexDataAsync(L,p,F).then((async U=>await this._loadMorphTargetsAsync(L,p,F,U).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,U.yL(F),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const r=c._GetDrawMode(L,p.mode);if(void 0==p.material){let L=this._defaultBabylonMaterialData[r];L||(L=this._createDefaultMaterial("__GLTFLoader._default",r),this._parent.onMaterialLoadedObservable.notifyObservers(L),this._defaultBabylonMaterialData[r]=L),F.material=L}else if(!this.parent.skipMaterials){const U=j.Get(`${L}/material`,this._gltf.materials,p.material);G.push(this._loadMaterialAsync(`/materials/${U.index}`,U,F,r,(L=>{F.material=L})))}A=Promise.all(G),a&&(p._instanceData={babylonSourceMesh:F,promise:A}),o=F}return c.AddPointerMetadata(o,L),this._parent.onMeshLoadedObservable.notifyObservers(o),G(o),this.logClose(),A.then((()=>o))}_loadVertexDataAsync(L,U,x){const mL=this._extensionsLoadVertexDataAsync(L,U,x);if(mL)return mL;const p=U.attributes;if(!p)throw new Error(`${L}: Attributes are missing`);const G=new Array,F=new P.b(x.name,this._babylonScene);if(void 0==U.indices)x.isUnIndexed=!0;else{const x=j.Get(`${L}/indices`,this._gltf.accessors,U.indices);G.push(this._loadIndicesAccessorAsync(`/accessors/${x.index}`,x).then((L=>{F.setIndices(L)})))}const a=(U,mL,a)=>{if(void 0==p[U])return;x._delayInfo=x._delayInfo||[],-1===x._delayInfo.indexOf(mL)&&x._delayInfo.push(mL);const o=j.Get(`${L}/attributes/${U}`,this._gltf.accessors,p[U]);G.push(this._loadVertexAccessorAsync(`/accessors/${o.index}`,o,mL).then((L=>{if(L.getKind()===D.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!x.skeleton){const L=R(o);L&&(F._boundingInfo=L,F.useBoundingInfoFromGeometry=!0)}F.setVerticesBuffer(L,o.count)}))),mL==D.h.MatricesIndicesExtraKind&&(x.numBoneInfluencers=8),a&&a(o)};return a("POSITION",D.h.PositionKind),a("NORMAL",D.h.NormalKind),a("TANGENT",D.h.TangentKind),a("TEXCOORD_0",D.h.UVKind),a("TEXCOORD_1",D.h.UV2Kind),a("TEXCOORD_2",D.h.UV3Kind),a("TEXCOORD_3",D.h.UV4Kind),a("TEXCOORD_4",D.h.UV5Kind),a("TEXCOORD_5",D.h.UV6Kind),a("JOINTS_0",D.h.MatricesIndicesKind),a("WEIGHTS_0",D.h.MatricesWeightsKind),a("JOINTS_1",D.h.MatricesIndicesExtraKind),a("WEIGHTS_1",D.h.MatricesWeightsExtraKind),a("COLOR_0",D.h.ColorKind,(L=>{"VEC4"===L.type&&(x.hasVertexAlpha=!0)})),Promise.all(G).then((()=>F))}_createMorphTargets(L,U,x,mL,p){if(!mL.targets||!this._parent.loadMorphTargets)return;if(void 0==U._numMorphTargets)U._numMorphTargets=mL.targets.length;else if(mL.targets.length!==U._numMorphTargets)throw new Error(`${L}: Primitives do not have the same number of targets`);const G=x.extras?x.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,p.morphTargetManager=new t(this._babylonScene),p.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.morphTargetManager.areUpdatesFrozen=!0;for(let F=0;F<mL.targets.length;F++){const L=U.weights?U.weights[F]:x.weights?x.weights[F]:0,mL=G?G[F]:`morphTarget${F}`;p.morphTargetManager.addTarget(new l.b(mL,L,p.PL()))}}_loadMorphTargetsAsync(L,U,x,mL){if(!U.targets||!this._parent.loadMorphTargets)return Promise.resolve();const p=new Array,G=x.morphTargetManager;for(let F=0;F<G.numTargets;F++){const x=G.getTarget(F);p.push(this._loadMorphTargetVertexDataAsync(`${L}/targets/${F}`,mL,U.targets[F],x))}return Promise.all(p).then((()=>{G.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(L,U,x,mL){const p=new Array,G=(mL,G,F)=>{if(void 0==x[mL])return;const a=U.getVertexBuffer(G);if(!a)return;const o=j.Get(`${L}/${mL}`,this._gltf.accessors,x[mL]);p.push(this._loadFloatAccessorAsync(`/accessors/${o.index}`,o).then((L=>{F(a,L)})))};return G("POSITION",D.h.PositionKind,((L,U)=>{const x=new Float32Array(U.length);L.forEach(U.length,((L,mL)=>{x[mL]=U[mL]+L})),mL.setPositions(x)})),G("NORMAL",D.h.NormalKind,((L,U)=>{const x=new Float32Array(U.length);L.forEach(x.length,((L,mL)=>{x[mL]=U[mL]+L})),mL.setNormals(x)})),G("TANGENT",D.h.TangentKind,((L,U)=>{const x=new Float32Array(U.length/3*4);let p=0;L.forEach(U.length/3*4,((L,mL)=>{(mL+1)%4!==0&&(x[p]=U[p]+L,p++)})),mL.setTangents(x)})),G("TEXCOORD_0",D.h.UVKind,((L,U)=>{const x=new Float32Array(U.length);L.forEach(U.length,((L,mL)=>{x[mL]=U[mL]+L})),mL.setUVs(x)})),G("TEXCOORD_1",D.h.UV2Kind,((L,U)=>{const x=new Float32Array(U.length);L.forEach(U.length,((L,mL)=>{x[mL]=U[mL]+L})),mL.setUV2s(x)})),G("COLOR_0",D.h.ColorKind,((U,x)=>{let p=null;const G=U.getSize();if(3===G){p=new Float32Array(x.length/3*4),U.forEach(x.length,((L,U)=>{const mL=Math.floor(U/3),G=U%3;p[4*mL+G]=x[3*mL+G]+L}));for(let L=0;L<x.length/3;++L)p[4*L+3]=1}else{if(4!==G)throw new Error(`${L}: Invalid number of components (${G}) for COLOR_0 attribute`);p=new Float32Array(x.length),U.forEach(x.length,((L,U)=>{p[U]=x[U]+L}))}mL.setColors(p)})),await Promise.all(p).then((()=>{}))}static _LoadTransform(L,U){if(void 0!=L.skin)return;let x=p.YU.Zero(),mL=p.Quaternion.Identity(),G=p.YU.One();if(L.matrix){p.Matrix.qU(L.matrix).decompose(G,mL,x)}else L.translation&&(x=p.YU.qU(L.translation)),L.rotation&&(mL=p.Quaternion.qU(L.rotation)),L.scale&&(G=p.YU.qU(L.scale));U.position=x,U.rotationQuaternion=mL,U.Ka=G}_loadSkinAsync(L,U,x,mL){if(!this._parent.loadSkins)return Promise.resolve();const p=this._extensionsLoadSkinAsync(L,U,x);if(p)return p;if(x._data)return mL(x._data.babylonSkeleton),x._data.promise;const G=`skeleton${x.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new H(x.name||G,G,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(L,x,F);const a=this._loadSkinInverseBindMatricesDataAsync(L,x).then((L=>{this._updateBoneMatrices(F,L)}));return x._data={babylonSkeleton:F,promise:a},mL(F),a}_loadBones(L,U,x){if(void 0==U.skeleton||this._parent.alwaysComputeSkeletonRootNode){const x=this._findSkeletonRootNode(`${L}/joints`,U.joints);if(x)if(void 0===U.skeleton)U.skeleton=x.index;else{const mL=(L,U)=>{for(;U.parent;U=U.parent)if(U.parent===L)return!0;return!1},p=j.Get(`${L}/skeleton`,this._gltf.nodes,U.skeleton);p===x||mL(p,x)||(S.c.Warn(`${L}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),U.skeleton=x.index)}else S.c.Warn(`${L}: Failed to find common root`)}const mL={};for(const p of U.joints){const G=j.Get(`${L}/joints/${p}`,this._gltf.nodes,p);this._loadBone(G,U,x,mL)}}_findSkeletonRootNode(L,U){if(0===U.length)return null;const x={};for(const p of U){const U=[];let mL=j.Get(`${L}/${p}`,this._gltf.nodes,p);for(;-1!==mL.index;)U.unshift(mL),mL=mL.parent;x[p]=U}let mL=null;for(let p=0;;++p){let L=x[U[0]];if(p>=L.length)return mL;const G=L[p];for(let F=1;F<U.length;++F)if(L=x[U[F]],p>=L.length||G!==L[p])return mL;mL=G}}_loadBone(L,U,x,mL){L._isJoint=!0;let p=mL[L.index];if(p)return p;let G=null;L.index!==U.skeleton&&(L.parent&&-1!==L.parent.index?G=this._loadBone(L.parent,U,x,mL):void 0!==U.skeleton&&S.c.Warn(`/skins/${U.index}/skeleton: Skeleton node is not a common root`));const F=U.joints.indexOf(L.index);return p=new A.d(L.name||`joint${L.index}`,x,G,this._getNodeMatrix(L),null,null,F),mL[L.index]=p,this._postSceneLoadActions.push((()=>{p.linkTransformNode(L._babylonTransformNode)})),p}_loadSkinInverseBindMatricesDataAsync(L,U){if(void 0==U.inverseBindMatrices)return Promise.resolve(null);const x=j.Get(`${L}/inverseBindMatrices`,this._gltf.accessors,U.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${x.index}`,x)}_updateBoneMatrices(L,U){for(const x of L.bones){const L=p.Matrix.Identity(),mL=x._index;U&&-1!==mL&&(p.Matrix.FromArrayToRef(U,16*mL,L),L.invertToRef(L));const G=x.getParent();G&&L.multiplyToRef(G.getAbsoluteInverseBindMatrix(),L),x.qa(L,!1,!1),x._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(L){return L.matrix?p.Matrix.qU(L.matrix):p.Matrix.Compose(L.scale?p.YU.qU(L.scale):p.YU.One(),L.rotation?p.Quaternion.qU(L.rotation):p.Quaternion.Identity(),L.translation?p.YU.qU(L.translation):p.YU.Zero())}loadCameraAsync(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const mL=this._extensionsLoadCameraAsync(L,U,x);if(mL)return mL;const G=new Array;this.logOpen(`${L} ${U.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new o.c(U.name||`camera${U.index}`,p.YU.Zero(),this._babylonScene,!1);switch(F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonCamera=F,F.setTarget(new p.YU(0,0,-1)),U.type){case"perspective":{const x=U.perspective;if(!x)throw new Error(`${L}: Camera perspective properties are missing`);F.fov=x.yfov,F.Qa=x.znear,F.maxZ=x.zfar||0;break}case"orthographic":if(!U.orthographic)throw new Error(`${L}: Camera orthographic properties are missing`);F.mode=a.c.ORTHOGRAPHIC_CAMERA,F.orthoLeft=-U.orthographic.xmag,F.orthoRight=U.orthographic.xmag,F.orthoBottom=-U.orthographic.ymag,F.orthoTop=U.orthographic.ymag,F.Qa=U.orthographic.znear,F.maxZ=U.orthographic.zfar;break;default:throw new Error(`${L}: Invalid camera type (${U.type})`)}return c.AddPointerMetadata(F,L),this._parent.onCameraLoadedObservable.notifyObservers(F),x(F),this.logClose(),Promise.all(G).then((()=>F))}_loadAnimationsAsync(){const L=this._gltf.animations;if(!L)return Promise.resolve();const U=new Array;for(let x=0;x<L.length;x++){const mL=L[x];U.push(this.loadAnimationAsync(`/animations/${mL.index}`,mL).then((L=>{0===L.targetedAnimations.length&&L.dispose()})))}return Promise.all(U).then((()=>{}))}loadAnimationAsync(L,U){const mL=this._extensionsLoadAnimationAsync(L,U);return mL||x.e(78).then(x.bind(x,15804)).then((x=>{let{AnimationGroup:mL}=x;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new mL(U.name||`animation${U.index}`,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonAnimationGroup=p;const G=new Array;j.Assign(U.channels),j.Assign(U.samplers);for(const F of U.channels)G.push(this._loadAnimationChannelAsync(`${L}/channels/${F.index}`,L,U,F,((L,U)=>{L.animations=L.animations||[],L.animations.push(U),p.addTargetedAnimation(U,L)})));return Promise.all(G).then((()=>(p.normalize(0),p)))}))}async _loadAnimationChannelAsync(L,U,mL,p,G){const F=this._extensionsLoadAnimationChannelAsync(L,U,mL,p,G);if(F)return await F;if(void 0==p.target.node)return await Promise.resolve();const a=j.Get(`${L}/target/node`,this._gltf.nodes,p.target.node),o=p.target.path,A="weights"===o;if(A&&!a._numMorphTargets||!A&&!a._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!A&&!a._isJoint)return await Promise.resolve();let r;switch(await Promise.resolve().then(x.bind(x,14300)),o){case"translation":var h;r=null===(h=(0,z.h)("/nodes/{}/translation"))||void 0===h?void 0:h.interpolation;break;case"rotation":var b;r=null===(b=(0,z.h)("/nodes/{}/rotation"))||void 0===b?void 0:b.interpolation;break;case"scale":var E;r=null===(E=(0,z.h)("/nodes/{}/scale"))||void 0===E?void 0:E.interpolation;break;case"weights":var Y;r=null===(Y=(0,z.h)("/nodes/{}/weights"))||void 0===Y?void 0:Y.interpolation;break;default:throw new Error(`${L}/target/path: Invalid value (${p.target.path})`)}if(!r)throw new Error(`${L}/target/path: Could not find interpolation properties for target path (${p.target.path})`);const S={object:a,info:r};return await this._loadAnimationChannelFromTargetInfoAsync(L,U,mL,p,S,G)}_loadAnimationChannelFromTargetInfoAsync(L,U,x,mL,p,G){const F=this.parent.targetFps,a=1/F,o=j.Get(`${L}/sampler`,x.samplers,mL.sampler);return this._loadAnimationSamplerAsync(`${U}/samplers/${mL.sampler}`,o).then((L=>{let U=0;const o=p.object,A=p.info;for(const p of A){const A=p.getStride(o),r=L.input,h=L.output,b=new Array(r.length);let E=0;switch(L.interpolation){case"STEP":for(let L=0;L<r.length;L++){const U=p.getValue(o,h,E,1);E+=A,b[L]={frame:r[L]*F,value:U,interpolation:1}}break;case"CUBICSPLINE":for(let L=0;L<r.length;L++){const U=p.getValue(o,h,E,a);E+=A;const x=p.getValue(o,h,E,1);E+=A;const mL=p.getValue(o,h,E,a);E+=A,b[L]={frame:r[L]*F,inTangent:U,value:x,outTangent:mL}}break;case"LINEAR":for(let L=0;L<r.length;L++){const U=p.getValue(o,h,E,1);E+=A,b[L]={frame:r[L]*F,value:U}}}if(E>0){const L=`${x.name||`animation${x.index}`}_channel${mL.index}_${U}`,a=p.buildAnimations(o,L,F,b);for(const x of a)U++,G(x.babylonAnimatable,x.babylonAnimation)}}}))}_loadAnimationSamplerAsync(L,U){if(U._data)return U._data;const x=U.interpolation||"LINEAR";switch(x){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${L}/interpolation: Invalid value (${U.interpolation})`)}const mL=j.Get(`${L}/input`,this._gltf.accessors,U.input),p=j.Get(`${L}/output`,this._gltf.accessors,U.output);return U._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${mL.index}`,mL),this._loadFloatAccessorAsync(`/accessors/${p.index}`,p)]).then((L=>{let[U,mL]=L;return{input:U,interpolation:x,output:mL}})),U._data}loadBufferAsync(L,U,x,mL){const p=this._extensionsLoadBufferAsync(L,U,x,mL);if(p)return p;if(!U._data)if(U.uri)U._data=this.loadUriAsync(`${L}/uri`,U,U.uri);else{if(!this._bin)throw new Error(`${L}: Uri is missing or the binary glTF is missing its binary chunk`);U._data=this._bin.readAsync(0,U.byteLength)}return U._data.then((U=>{try{return new Uint8Array(U.buffer,U.byteOffset+x,mL)}catch(p){throw new Error(`${L}: ${p.message}`)}}))}loadBufferViewAsync(L,U){const x=this._extensionsLoadBufferViewAsync(L,U);if(x)return x;if(U._data)return U._data;const mL=j.Get(`${L}/buffer`,this._gltf.buffers,U.buffer);return U._data=this.loadBufferAsync(`/buffers/${mL.index}`,mL,U.byteOffset||0,U.byteLength),U._data}_loadAccessorAsync(L,U,x){if(U._data)return U._data;const mL=c._GetNumComponents(L,U.type),p=mL*D.h.GetTypeByteLength(U.componentType),G=mL*U.count;if(void 0==U.bufferView)U._data=Promise.resolve(new x(G));else{const F=j.Get(`${L}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((a=>{if(5126!==U.componentType||U.normalized||F.byteStride&&F.byteStride!==p){const L=new x(G);return D.h.ForEach(a,U.byteOffset||0,F.byteStride||p,mL,U.componentType,L.length,U.normalized||!1,((U,x)=>{L[x]=U})),L}return c._GetTypedArray(L,U.componentType,a,U.byteOffset,G)}))}if(U.sparse){const G=U.sparse;U._data=U._data.then((F=>{const a=F,o=j.Get(`${L}/sparse/indices/bufferView`,this._gltf.bufferViews,G.indices.bufferView),A=j.Get(`${L}/sparse/values/bufferView`,this._gltf.bufferViews,G.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${o.index}`,o),this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)]).then((F=>{let[o,A]=F;const r=c._GetTypedArray(`${L}/sparse/indices`,G.indices.componentType,o,G.indices.byteOffset,G.count),h=mL*G.count;let b;if(5126!==U.componentType||U.normalized){const F=c._GetTypedArray(`${L}/sparse/values`,U.componentType,A,G.values.byteOffset,h);b=new x(h),D.h.ForEach(F,0,p,mL,U.componentType,b.length,U.normalized||!1,((L,U)=>{b[U]=L}))}else b=c._GetTypedArray(`${L}/sparse/values`,U.componentType,A,G.values.byteOffset,h);let E=0;for(let L=0;L<r.length;L++){let U=r[L]*mL;for(let L=0;L<mL;L++)a[U++]=b[E++]}return a}))}))}return U._data}_loadFloatAccessorAsync(L,U){return this._loadAccessorAsync(L,U,Float32Array)}_loadIndicesAccessorAsync(L,U){if("SCALAR"!==U.type)throw new Error(`${L}/type: Invalid value ${U.type}`);if(5121!==U.componentType&&5123!==U.componentType&&5125!==U.componentType)throw new Error(`${L}/componentType: Invalid value ${U.componentType}`);if(U._data)return U._data;if(U.sparse){const x=c._GetTypedArrayConstructor(`${L}/componentType`,U.componentType);U._data=this._loadAccessorAsync(L,U,x)}else{const x=j.Get(`${L}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((x=>c._GetTypedArray(L,U.componentType,x,U.byteOffset,U.count)))}return U._data}_loadVertexBufferViewAsync(L){if(L._babylonBuffer)return L._babylonBuffer;const U=this._babylonScene.getEngine();return L._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((L=>new D.d(U,L,!1))),L._babylonBuffer}_loadVertexAccessorAsync(L,U,x){var mL;if(null!==(mL=U._babylonVertexBuffer)&&void 0!==mL&&mL[x])return U._babylonVertexBuffer[x];U._babylonVertexBuffer||(U._babylonVertexBuffer={});const p=this._babylonScene.getEngine();if(U.sparse||void 0==U.bufferView)U._babylonVertexBuffer[x]=this._loadFloatAccessorAsync(L,U).then((L=>new D.h(p,L,x,!1)));else{const mL=j.Get(`${L}/bufferView`,this._gltf.bufferViews,U.bufferView);U._babylonVertexBuffer[x]=this._loadVertexBufferViewAsync(mL).then((G=>{const F=c._GetNumComponents(L,U.type);return new D.h(p,G,x,!1,void 0,mL.byteStride,void 0,U.byteOffset,F,U.componentType,U.normalized,!0,void 0,!0)}))}return U._babylonVertexBuffer[x]}_loadMaterialMetallicRoughnessPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return U&&(U.baseColorFactor?(x.albedoColor=G.QU.qU(U.baseColorFactor),x.alpha=U.baseColorFactor[3]):x.albedoColor=G.QU.White(),x.metallic=void 0==U.metallicFactor?1:U.metallicFactor,x.roughness=void 0==U.roughnessFactor?1:U.roughnessFactor,U.baseColorTexture&&mL.push(this.loadTextureInfoAsync(`${L}/baseColorTexture`,U.baseColorTexture,(L=>{L.name=`${x.name} (Base Color)`,x.albedoTexture=L}))),U.metallicRoughnessTexture&&(U.metallicRoughnessTexture.nonColorData=!0,mL.push(this.loadTextureInfoAsync(`${L}/metallicRoughnessTexture`,U.metallicRoughnessTexture,(L=>{L.name=`${x.name} (Metallic Roughness)`,x.metallicTexture=L}))),x.useMetallnessFromMetallicTextureBlue=!0,x.useRoughnessFromMetallicTextureGreen=!0,x.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(mL).then((()=>{}))}_loadMaterialAsync(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const G=this._extensionsLoadMaterialAsync(L,U,x,mL,p);if(G)return G;U._data=U._data||{};let F=U._data[mL];if(!F){this.logOpen(`${L} ${U.name||""}`);const x=this.createMaterial(L,U,mL);F={babylonMaterial:x,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(L,U,x)},U._data[mL]=F,c.AddPointerMetadata(x,L),this._parent.onMaterialLoadedObservable.notifyObservers(x),this.logClose()}return x&&(F.babylonMeshes.push(x),x.oa.addOnce((()=>{const L=F.babylonMeshes.indexOf(x);-1!==L&&F.babylonMeshes.splice(L,1)}))),p(F.babylonMaterial),F.promise.then((()=>F.babylonMaterial))}_createDefaultMaterial(L,U){this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new q.d(L,this._babylonScene);return x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.fillMode=U,x.enableSpecularAntiAliasing=!0,x.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,x.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,x.transparencyMode=q.d.PBRMATERIAL_OPAQUE,x.metallic=1,x.roughness=1,x}createMaterial(L,U,x){const mL=this._extensionsCreateMaterial(L,U,x);if(mL)return mL;const p=U.name||`material${U.index}`;return this._createDefaultMaterial(p,x)}loadMaterialPropertiesAsync(L,U,x){const mL=this._extensionsLoadMaterialPropertiesAsync(L,U,x);if(mL)return mL;const p=new Array;return p.push(this.loadMaterialBasePropertiesAsync(L,U,x)),U.pbrMetallicRoughness&&p.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${L}/pbrMetallicRoughness`,U.pbrMetallicRoughness,x)),this.loadMaterialAlphaProperties(L,U,x),Promise.all(p).then((()=>{}))}loadMaterialBasePropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return x.emissiveColor=U.emissiveFactor?G.QU.qU(U.emissiveFactor):new G.QU(0,0,0),U.doubleSided&&(x.Pa=!1,x.twoSidedLighting=!0),U.normalTexture&&(U.normalTexture.nonColorData=!0,mL.push(this.loadTextureInfoAsync(`${L}/normalTexture`,U.normalTexture,(L=>{L.name=`${x.name} (Normal)`,x.bumpTexture=L}))),x.invertNormalMapX=!this._babylonScene.useRightHandedSystem,x.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=U.normalTexture.scale&&x.bumpTexture&&(x.bumpTexture.level=U.normalTexture.scale),x.forceIrradianceInFragment=!0),U.occlusionTexture&&(U.occlusionTexture.nonColorData=!0,mL.push(this.loadTextureInfoAsync(`${L}/occlusionTexture`,U.occlusionTexture,(L=>{L.name=`${x.name} (Occlusion)`,x.ambientTexture=L}))),x.useAmbientInGrayScale=!0,void 0!=U.occlusionTexture.strength&&(x.ambientTextureStrength=U.occlusionTexture.strength)),U.emissiveTexture&&mL.push(this.loadTextureInfoAsync(`${L}/emissiveTexture`,U.emissiveTexture,(L=>{L.name=`${x.name} (Emissive)`,x.emissiveTexture=L}))),Promise.all(mL).then((()=>{}))}loadMaterialAlphaProperties(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);switch(U.alphaMode||"OPAQUE"){case"OPAQUE":x.transparencyMode=q.d.PBRMATERIAL_OPAQUE,x.alpha=1;break;case"MASK":x.transparencyMode=q.d.PBRMATERIAL_ALPHATEST,x.alphaCutOff=void 0==U.alphaCutoff?.5:U.alphaCutoff,x.albedoTexture&&(x.albedoTexture.Ha=!0);break;case"BLEND":x.transparencyMode=q.d.PBRMATERIAL_ALPHABLEND,x.albedoTexture&&(x.albedoTexture.Ha=!0,x.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${L}/alphaMode: Invalid value (${U.alphaMode})`)}}loadTextureInfoAsync(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const mL=this._extensionsLoadTextureInfoAsync(L,U,x);if(mL)return mL;if(this.logOpen(`${L}`),U.texCoord>=6)throw new Error(`${L}/texCoord: Invalid value (${U.texCoord})`);const p=j.Get(`${L}/index`,this._gltf.textures,U.index);p._textureInfo=U;const G=this._loadTextureAsync(`/textures/${U.index}`,p,(mL=>{mL.coordinatesIndex=U.texCoord||0,c.AddPointerMetadata(mL,L),this._parent.onTextureLoadedObservable.notifyObservers(mL),x(mL)}));return this.logClose(),G}_loadTextureAsync(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const mL=this._extensionsLoadTextureAsync(L,U,x);if(mL)return mL;this.logOpen(`${L} ${U.name||""}`);const p=void 0==U.sampler?c.DefaultSampler:j.Get(`${L}/sampler`,this._gltf.samplers,U.sampler),G=j.Get(`${L}/source`,this._gltf.images,U.source),F=this._createTextureAsync(L,p,G,x,void 0,!U._textureInfo.nonColorData);return this.logClose(),F}_createTextureAsync(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},G=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0;const a=this._loadSampler(`/samplers/${U.index}`,U),o=new Array,A=new mL;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,C:()=>{this._disposed||A.resolve()},onError:(U,x)=>{this._disposed||A.reject(new Error(`${L}: ${x&&x.message?x.message:U||"Failed to load texture"}`))},mimeType:x.mimeType??(0,n.f)(x.uri??""),loaderOptions:G,useSRGBBuffer:!!F&&this._parent.useSRGBBuffers},h=new f.e(null,this._babylonScene,r);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(A.promise),o.push(this.loadImageAsync(`/images/${x.index}`,x).then((L=>{const U=x.uri||`${this._fileName}#image${x.index}`,mL=`data:${this._uniqueRootUrl}${U}`;h.updateURL(mL,L);const p=h.getInternalTexture();p&&(p.label=x.name)}))),h.wrapU=a.wrapU,h.wrapV=a.wrapV,p(h),this._parent.useGltfTextureNames&&(h.name=x.name||x.uri||`image${x.index}`),Promise.all(o).then((()=>h))}_loadSampler(L,U){return U._data||(U._data={noMipMaps:9728===U.minFilter||9729===U.minFilter,samplingMode:c._GetTextureSamplingMode(L,U),wrapU:c._GetTextureWrapMode(`${L}/wrapS`,U.wrapS),wrapV:c._GetTextureWrapMode(`${L}/wrapT`,U.wrapT)}),U._data}loadImageAsync(L,U){if(!U._data){if(this.logOpen(`${L} ${U.name||""}`),U.uri)U._data=this.loadUriAsync(`${L}/uri`,U,U.uri);else{const x=j.Get(`${L}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}this.logClose()}return U._data}loadUriAsync(L,U,x){const mL=this._extensionsLoadUriAsync(L,U,x);if(mL)return mL;if(!c._ValidateUri(x))throw new Error(`${L}: '${x}' is invalid`);if((0,n.i)(x)){const U=new Uint8Array((0,n.b)(x));return this.log(`${L}: Decoded ${x.substring(0,64)}... (${U.length} bytes)`),Promise.resolve(U)}return this.log(`${L}: Loading ${x}`),this._parent.preprocessUrlAsync(this._rootUrl+x).then((U=>new Promise(((mL,p)=>{this._parent._loadFile(this._babylonScene,U,(U=>{this._disposed||(this.log(`${L}: Loaded ${x} (${U.byteLength} bytes)`),mL(new Uint8Array(U)))}),!0,(U=>{p(new n.l(`${L}: Failed to load '${x}'${U?": "+U.status+" "+U.statusText:""}`,U))}))}))))}static AddPointerMetadata(L,U){L.metadata=L.metadata||{};const x=L._internalMetadata=L._internalMetadata||{},mL=x.ba=x.ba||{};(mL.pointers=mL.pointers||[]).push(U)}static _GetTextureWrapMode(L,U){switch(U=void 0==U?10497:U){case 33071:return f.e.CLAMP_ADDRESSMODE;case 33648:return f.e.MIRROR_ADDRESSMODE;case 10497:return f.e.WRAP_ADDRESSMODE;default:return S.c.Warn(`${L}: Invalid value (${U})`),f.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(L,U){const x=void 0==U.magFilter?9729:U.magFilter,mL=void 0==U.minFilter?9987:U.minFilter;if(9729===x)switch(mL){case 9728:return f.e.LINEAR_NEAREST;case 9729:return f.e.LINEAR_LINEAR;case 9984:return f.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.e.LINEAR_LINEAR_MIPLINEAR;default:return S.c.Warn(`${L}/minFilter: Invalid value (${mL})`),f.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==x&&S.c.Warn(`${L}/magFilter: Invalid value (${x})`),mL){case 9728:return f.e.NEAREST_NEAREST;case 9729:return f.e.NEAREST_LINEAR;case 9984:return f.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.e.NEAREST_LINEAR_MIPLINEAR;default:return S.c.Warn(`${L}/minFilter: Invalid value (${mL})`),f.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(L,U){try{return(0,J.p)(U)}catch(x){throw new Error(`${L}: ${x.message}`)}}static _GetTypedArray(L,U,x,mL,p){const G=x.buffer;mL=x.byteOffset+(mL||0);const F=c._GetTypedArrayConstructor(`${L}/componentType`,U),a=D.h.GetTypeByteLength(U);return mL%a!==0?(S.c.Warn(`${L}: Copying buffer as byte offset (${mL}) is not a multiple of component type byte length (${a})`),new F(G.slice(mL,mL+p*a),0)):new F(G,mL,p)}static _GetNumComponents(L,U){switch(U){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${L}: Invalid type (${U})`)}static _ValidateUri(L){return F.Tools.IsBase64(L)||-1===L.indexOf("..")}static _GetDrawMode(L,U){switch(void 0==U&&(U=4),U){case 0:return Q.c.PointListDrawMode;case 1:return Q.c.LineListDrawMode;case 2:return Q.c.LineLoopDrawMode;case 3:return Q.c.LineStripDrawMode;case 4:return Q.c.TriangleFillMode;case 5:return Q.c.TriangleStripDrawMode;case 6:return Q.c.TriangleFanDrawMode}throw new Error(`${L}: Invalid mesh primitive mode (${U})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const L=new Array;if(this._gltf.materials)for(const U of this._gltf.materials)if(U._data)for(const x in U._data){const mL=U._data[x];for(const U of mL.babylonMeshes){U.fa(!0);const x=mL.babylonMaterial;L.push(x.forceCompilationAsync(U)),L.push(x.forceCompilationAsync(U,{useInstances:!0})),this._parent.useClipPlane&&(L.push(x.forceCompilationAsync(U,{clipPlane:!0})),L.push(x.forceCompilationAsync(U,{clipPlane:!0,useInstances:!0})))}}return Promise.all(L).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const L=new Array,U=this._babylonScene.lights;for(const x of U){const U=x.getShadowGenerator();U&&L.push(U.forceCompilationAsync())}return Promise.all(L).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(L){for(const U of this._extensions)U.enabled&&L(U)}_applyExtensions(L,U,x){for(const mL of this._extensions)if(mL.enabled){const p=`${mL.name}.${U}`,G=L;G._activeLoaderExtensionFunctions=G._activeLoaderExtensionFunctions||{};const F=G._activeLoaderExtensionFunctions;if(!F[p]){F[p]=!0;try{const L=x(mL);if(L)return L}finally{delete F[p]}}}return null}_extensionsOnLoading(){this._forEachExtensions((L=>L.onLoading&&L.onLoading()))}_extensionsOnReady(){this._forEachExtensions((L=>L.onReady&&L.onReady()))}_extensionsLoadSceneAsync(L,U){return this._applyExtensions(U,"loadScene",(x=>x.loadSceneAsync&&x.loadSceneAsync(L,U)))}_extensionsLoadNodeAsync(L,U,x){return this._applyExtensions(U,"loadNode",(mL=>mL.loadNodeAsync&&mL.loadNodeAsync(L,U,x)))}_extensionsLoadCameraAsync(L,U,x){return this._applyExtensions(U,"loadCamera",(mL=>mL.loadCameraAsync&&mL.loadCameraAsync(L,U,x)))}_extensionsLoadVertexDataAsync(L,U,x){return this._applyExtensions(U,"loadVertexData",(mL=>mL._loadVertexDataAsync&&mL._loadVertexDataAsync(L,U,x)))}_extensionsLoadMeshPrimitiveAsync(L,U,x,mL,p,G){return this._applyExtensions(p,"loadMeshPrimitive",(F=>F._loadMeshPrimitiveAsync&&F._loadMeshPrimitiveAsync(L,U,x,mL,p,G)))}_extensionsLoadMaterialAsync(L,U,x,mL,p){return this._applyExtensions(U,"loadMaterial",(G=>G._loadMaterialAsync&&G._loadMaterialAsync(L,U,x,mL,p)))}_extensionsCreateMaterial(L,U,x){return this._applyExtensions(U,"createMaterial",(mL=>mL.createMaterial&&mL.createMaterial(L,U,x)))}_extensionsLoadMaterialPropertiesAsync(L,U,x){return this._applyExtensions(U,"loadMaterialProperties",(mL=>mL.loadMaterialPropertiesAsync&&mL.loadMaterialPropertiesAsync(L,U,x)))}_extensionsLoadTextureInfoAsync(L,U,x){return this._applyExtensions(U,"loadTextureInfo",(mL=>mL.loadTextureInfoAsync&&mL.loadTextureInfoAsync(L,U,x)))}_extensionsLoadTextureAsync(L,U,x){return this._applyExtensions(U,"loadTexture",(mL=>mL._loadTextureAsync&&mL._loadTextureAsync(L,U,x)))}_extensionsLoadAnimationAsync(L,U){return this._applyExtensions(U,"loadAnimation",(x=>x.loadAnimationAsync&&x.loadAnimationAsync(L,U)))}_extensionsLoadAnimationChannelAsync(L,U,x,mL,p){return this._applyExtensions(x,"loadAnimationChannel",(G=>G._loadAnimationChannelAsync&&G._loadAnimationChannelAsync(L,U,x,mL,p)))}_extensionsLoadSkinAsync(L,U,x){return this._applyExtensions(x,"loadSkin",(mL=>mL._loadSkinAsync&&mL._loadSkinAsync(L,U,x)))}_extensionsLoadUriAsync(L,U,x){return this._applyExtensions(U,"loadUri",(mL=>mL._loadUriAsync&&mL._loadUriAsync(L,U,x)))}_extensionsLoadBufferViewAsync(L,U){return this._applyExtensions(U,"loadBufferView",(x=>x.loadBufferViewAsync&&x.loadBufferViewAsync(L,U)))}_extensionsLoadBufferAsync(L,U,x,mL){return this._applyExtensions(U,"loadBuffer",(p=>p.loadBufferAsync&&p.loadBufferAsync(L,U,x,mL)))}static LoadExtensionAsync(L,U,x,mL){if(!U.extensions)return null;const p=U.extensions[x];return p?mL(`${L}/extensions/${x}`,p):null}static LoadExtraAsync(L,U,x,mL){if(!U.extras)return null;const p=U.extras[x];return p?mL(`${L}/extras/${x}`,p):null}isExtensionUsed(L){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(L)}logOpen(L){this._parent._logOpen(L)}logClose(){this._parent._logClose()}log(L){this._parent._log(L)}startPerformanceCounter(L){this._parent._startPerformanceCounter(L)}endPerformanceCounter(L){this._parent._endPerformanceCounter(L)}}c.DefaultSampler={index:-1},y.e._CreateGLTF2Loader=L=>new c(L);var W=x(14300),I=x(12773),w=x(12625),B=x(14309),s=x(14313);class C extends s.c{constructor(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",L),this._texture=L.getEngine().createRawCubeTexture(U,x,mL,p,G,F,a,o)}update(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,L,U,x,mL,p)}updateRGBDAsync(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,B.n)(this._texture,L,U,x,mL).then((()=>{}))}clone(){return w.e.Clone((()=>{const L=this.PL(),U=this._texture,x=new C(L,U._bufferViewArray,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression);return 13===U.source&&x.updateRGBDAsync(U._bufferViewArrayArray,U._sphericalPolynomial,U._lodGenerationScale,U._lodGenerationOffset),x}),this)}}const k="EXT_lights_image_based";class T{constructor(L){this.name=k,this._loader=L,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.ba.extensions;if(L&&L[this.name]){const U=L[this.name];this._lights=U.lights}}loadSceneAsync(L,U){return c.LoadExtensionAsync(L,U,this.name,(async(x,mL)=>{this._loader._allMaterialsDirtyRequired=!0;const p=new Array;p.push(this._loader.loadSceneAsync(L,U)),this._loader.logOpen(`${x}`);const G=j.Get(`${x}/light`,this._lights,mL.ip);return p.push(this._loadLightAsync(`/extensions/${this.name}/lights/${mL.ip}`,G).then((L=>{this._loader.babylonScene.environmentTexture=L}))),this._loader.logClose(),await Promise.all(p).then((()=>{}))}))}_loadLightAsync(L,U){if(!U._loaded){const x=new Array;this._loader.logOpen(`${L}`);const mL=new Array(U.specularImages.length);for(let p=0;p<U.specularImages.length;p++){const G=U.specularImages[p];mL[p]=new Array(G.length);for(let U=0;U<G.length;U++){const F=`${L}/specularImages/${p}/${U}`;this._loader.logOpen(`${F}`);const a=G[U],o=j.Get(F,this._loader.ba.images,a);x.push(this._loader.loadImageAsync(`/images/${a}`,o).then((L=>{mL[p][U]=L}))),this._loader.logClose()}}this._loader.logClose(),U._loaded=Promise.all(x).then((async()=>{const x=new C(this._loader.babylonScene,null,U.specularImageSize);if(x.name=U.name||"environment",U._babylonTexture=x,void 0!=U.ya&&(x.level=U.ya),U.rotation){let L=p.Quaternion.qU(U.rotation);this._loader.babylonScene.useRightHandedSystem||(L=p.Quaternion.Inverse(L)),p.Matrix.FromQuaternionToRef(L,x.getReflectionTextureMatrix())}if(!U.irradianceCoefficients)throw new Error(`${L}: Irradiance coefficients are missing`);const G=I.b.qU(U.irradianceCoefficients);G.scaleInPlace(U.ya),G.convertIrradianceToLambertianRadiance();const F=I.d.FromHarmonics(G),a=(mL.length-1)/Math.log2(U.specularImageSize);return await x.updateRGBDAsync(mL,F,a)}))}return U._loaded.then((()=>U._babylonTexture))}}g(k),Z(k,!0,(L=>new T(L)));x(13175);const O="EXT_mesh_gpu_instancing";class LL{constructor(L){this.name=O,this._loader=L,this.enabled=this._loader.isExtensionUsed(O)}dispose(){this._loader=null}loadNodeAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(L,mL)=>{this._loader._disableInstancedMesh++;const G=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,x);if(this._loader._disableInstancedMesh--,!U._primitiveBabylonMeshes)return await G;const F=new Array;let a=0;const o=U=>{if(void 0==mL.attributes[U])return void F.push(Promise.resolve(null));const x=j.Get(`${L}/attributes/${U}`,this._loader.ba.accessors,mL.attributes[U]);if(F.push(this._loader._loadFloatAccessorAsync(`/accessors/${x.bufferView}`,x)),0===a)a=x.count;else if(a!==x.count)throw new Error(`${L}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),await G.then((async L=>{const[x,mL,G]=await Promise.all(F),o=new Float32Array(16*a);p.TmpVectors.YU[0].da(0,0,0),p.TmpVectors.Quaternion[0].da(0,0,0,1),p.TmpVectors.YU[1].da(1,1,1);for(let U=0;U<a;++U)x&&p.YU.FromArrayToRef(x,3*U,p.TmpVectors.YU[0]),mL&&p.Quaternion.FromArrayToRef(mL,4*U,p.TmpVectors.Quaternion[0]),G&&p.YU.FromArrayToRef(G,3*U,p.TmpVectors.YU[1]),p.Matrix.ComposeToRef(p.TmpVectors.YU[1],p.TmpVectors.Quaternion[0],p.TmpVectors.YU[0],p.TmpVectors.Matrix[0]),p.TmpVectors.Matrix[0].copyToArray(o,16*U);for(const p of U._primitiveBabylonMeshes)p.Bh("matrix",o,16,!0);return L}))}))}}g(O),Z(O,!0,(L=>new LL(L)));let UL=0,xL=null;class mU{static get Default(){return mU._Default||(mU._Default=new mU),mU._Default}constructor(){const L=mU.Configuration.decoder;this._decoderModulePromise=F.Tools.LoadBabylonScriptAsync(L.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(L,U,x,mL,p){await this._decoderModulePromise,0===UL&&(MeshoptDecoder.useWorkers(1),UL=1);const G=await MeshoptDecoder.decodeGltfBufferAsync(U,x,L,mL,p);return null!==xL&&clearTimeout(xL),xL=setTimeout((()=>{MeshoptDecoder.useWorkers(0),UL=0,xL=null}),1e3),G}}mU.Configuration={decoder:{url:`${F.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},mU._Default=null;const pL="EXT_meshopt_compression";class GL{constructor(L){this.name=pL,this.enabled=L.isExtensionUsed(pL),this._loader=L}dispose(){this._loader=null}loadBufferViewAsync(L,U){return c.LoadExtensionAsync(L,U,this.name,(async(x,mL)=>{const p=U;if(p._meshOptData)return await p._meshOptData;const G=j.Get(`${L}/buffer`,this._loader.ba.buffers,mL.buffer);return p._meshOptData=this._loader.loadBufferAsync(`/buffers/${G.index}`,G,mL.byteOffset||0,mL.byteLength).then((async L=>await mU.Default.decodeGltfBufferAsync(L,mL.count,mL.byteStride,mL.mode,mL.filter))),await p._meshOptData}))}}g(pL),Z(pL,!0,(L=>new GL(L)));const FL="EXT_texture_webp";class aL{constructor(L){this.name=FL,this._loader=L,this.enabled=L.isExtensionUsed(FL)}dispose(){this._loader=null}_loadTextureAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=void 0==U.sampler?c.DefaultSampler:j.Get(`${L}/sampler`,this._loader.ba.samplers,U.sampler),F=j.Get(`${mL}/source`,this._loader.ba.images,p.source);return await this._loader._createTextureAsync(L,G,F,(L=>{x(L)}),void 0,!U._textureInfo.nonColorData)}))}}g(FL),Z(FL,!0,(L=>new aL(L)));const oL="EXT_texture_avif";class AL{constructor(L){this.name=oL,this._loader=L,this.enabled=L.isExtensionUsed(oL)}dispose(){this._loader=null}_loadTextureAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=void 0==U.sampler?c.DefaultSampler:j.Get(`${L}/sampler`,this._loader.ba.samplers,U.sampler),F=j.Get(`${mL}/source`,this._loader.ba.images,p.source);return await this._loader._createTextureAsync(L,G,F,(L=>{x(L)}),void 0,!U._textureInfo.nonColorData)}))}}g(oL),Z(oL,!0,(L=>new AL(L)));var rL=x(14294),hL=x(13150);const bL="EXT_lights_ies";class EL{constructor(L){this.name=bL,this._loader=L,this.enabled=this._loader.isExtensionUsed(bL)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.ba.extensions;if(L&&L[this.name]){const U=L[this.name];this._lights=U.lights,j.Assign(this._lights)}}loadNodeAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,F)=>{let a,o;this._loader._allMaterialsDirtyRequired=!0;const A=await this._loader.loadNodeAsync(L,U,(L=>{o=j.Get(mL,this._lights,F.ip);const U=o.name||L.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a=new rL.b(U,p.YU.Zero(),p.YU.Backward(),0,1,this._loader.babylonScene),a.angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=a,a.falloffType=hL.d.FALLOFF_GLTF,a.na=F.color?G.QU.qU(F.color):G.QU.White(),a.ya=F.multiplier||1,a.range=Number.MAX_VALUE,a.parent=L,this._loader._babylonLights.push(a),c.AddPointerMetadata(a,mL),x(L)}));let r;if(o.uri)r=await this._loader.loadUriAsync(L,o,o.uri);else{const U=j.Get(`${L}/bufferView`,this._loader.ba.bufferViews,o.bufferView);r=await this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return a.iesProfileTexture=new f.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,r,!0,void 0,void 0,void 0,void 0,".ies"),A}))}}g(bL),Z(bL,!0,(L=>new EL(L)));var YL=x(14328);const SL="KHR_draco_mesh_compression";class VL{constructor(L){this.name=SL,this.useNormalizedFlagFromAccessor=!0,this._loader=L,this.enabled=YL.e.DefaultAvailable&&this._loader.isExtensionUsed(SL)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{if(void 0!=U.mode&&4!==U.mode&&5!==U.mode)throw new Error(`${L}: Unsupported mode ${U.mode}`);const G={},F={},a=(L,mL)=>{const a=p.attributes[L];if(void 0!=a&&(x._delayInfo=x._delayInfo||[],-1===x._delayInfo.indexOf(mL)&&x._delayInfo.push(mL),G[mL]=a,this.useNormalizedFlagFromAccessor)){const x=j.TryGet(this._loader.ba.accessors,U.attributes[L]);x&&(F[mL]=x.normalized||!1)}};a("POSITION",D.h.PositionKind),a("NORMAL",D.h.NormalKind),a("TANGENT",D.h.TangentKind),a("TEXCOORD_0",D.h.UVKind),a("TEXCOORD_1",D.h.UV2Kind),a("TEXCOORD_2",D.h.UV3Kind),a("TEXCOORD_3",D.h.UV4Kind),a("TEXCOORD_4",D.h.UV5Kind),a("TEXCOORD_5",D.h.UV6Kind),a("JOINTS_0",D.h.MatricesIndicesKind),a("WEIGHTS_0",D.h.MatricesWeightsKind),a("COLOR_0",D.h.ColorKind);const o=j.Get(mL,this._loader.ba.bufferViews,p.bufferView);return o._dracoBabylonGeometry||(o._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((async mL=>{const p=this.dracoDecoder||YL.e.Default,a=j.TryGet(this._loader.ba.accessors,U.attributes.POSITION),o=this._loader.parent.alwaysComputeBoundingBox||x.skeleton||!a?null:R(a);return await p._decodeMeshToGeometryForGltfAsync(x.name,this._loader.babylonScene,mL,G,F,o).catch((U=>{throw new Error(`${L}: ${U.message}`)}))}))),await o._dracoBabylonGeometry}))}}g(SL),Z(SL,!0,(L=>new VL(L)));var HL=x(14332),QL=x(12571),qL=x(12574),fL=x(13022),vL=x(13208),DL=x(12547);fL.e.AddNodeConstructor("Light_Type_0",((L,U)=>()=>new PL(L,p.YU.Zero(),U)));class PL extends vL.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(L){this._shadowAngle=L,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(L){const U=this.needCube();if(this._direction=L,this.needCube()!==U&&this._shadowGenerators){const L=this._shadowGenerators.values();for(let U=L.next();!0!==U.done;U=L.next()){U.value.recreateShadowMap()}}}constructor(L,U,x){super(L,x),this._shadowAngle=Math.PI/2,this.position=U}getClassName(){return"PointLight"}getTypeID(){return hL.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(L){if(this.direction)return super.getShadowDirection(L);switch(L){case 0:return new p.YU(1,0,0);case 1:return new p.YU(-1,0,0);case 2:return new p.YU(0,-1,0);case 3:return new p.YU(0,1,0);case 4:return new p.YU(0,0,1);case 5:return new p.YU(0,0,-1)}return p.YU.Zero()}_setDefaultShadowProjectionMatrix(L,U,x){const mL=this.PL().activeCamera;if(!mL)return;const G=void 0!==this.shadowMinZ?this.shadowMinZ:mL.Qa,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:mL.maxZ,a=this.PL().getEngine().Ga;p.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,a?F:G,a?G:F,L,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(L,U){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,U):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,U),this}transferToNodeMaterialEffect(L,U){return this.computeTransformedInformation()?L.setFloat3(U,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):L.setFloat3(U,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(L,U){L["POINTLIGHT"+U]=!0}}(0,QL.d)([(0,qL.R)()],PL.prototype,"shadowAngle",null),(0,DL.d)("BABYLON.PointLight",PL);const dL="KHR_lights_punctual";class KL{constructor(L){this.name=dL,this._loader=L,this.enabled=this._loader.isExtensionUsed(dL)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.ba.extensions;if(L&&L[this.name]){const U=L[this.name];this._lights=U.lights,j.Assign(this._lights)}}loadNodeAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,F)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(L,U,(L=>{let U;const a=j.Get(mL,this._lights,F.ip),o=a.name||L.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":{const L=new HL.b(o,p.YU.Backward(),this._loader.babylonScene);L.position.la(0),U=L;break}case"point":U=new PL(o,p.YU.Zero(),this._loader.babylonScene);break;case"spot":{const L=new rL.b(o,p.YU.Zero(),p.YU.Backward(),0,1,this._loader.babylonScene);L.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),L.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),U=L;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${mL}: Invalid light type (${a.type})`)}U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=U,U.falloffType=hL.d.FALLOFF_GLTF,U.na=a.color?G.QU.qU(a.color):G.QU.White(),U.ya=void 0==a.ya?1:a.ya,U.range=void 0==a.range?Number.MAX_VALUE:a.range,U.parent=L,this._loader._babylonLights.push(U),c.AddPointerMetadata(U,mL),x(L)})))))}}g(dL),Z(dL,!0,(L=>new KL(L)));const lL="KHR_materials_pbrSpecularGlossiness";class iL{constructor(L){this.name=lL,this.order=200,this._loader=L,this.enabled=this._loader.isExtensionUsed(lL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialBasePropertiesAsync(L,U,x)),G.push(this._loadSpecularGlossinessPropertiesAsync(mL,p,x)),this._loader.loadMaterialAlphaProperties(L,U,x),await Promise.all(G).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return x.metallic=null,x.roughness=null,U.diffuseFactor?(x.albedoColor=G.QU.qU(U.diffuseFactor),x.alpha=U.diffuseFactor[3]):x.albedoColor=G.QU.White(),x.reflectivityColor=U.specularFactor?G.QU.qU(U.specularFactor):G.QU.White(),x.microSurface=void 0==U.glossinessFactor?1:U.glossinessFactor,U.diffuseTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTexture`,U.diffuseTexture,(L=>{L.name=`${x.name} (Diffuse)`,x.albedoTexture=L}))),U.specularGlossinessTexture&&(mL.push(this._loader.loadTextureInfoAsync(`${L}/specularGlossinessTexture`,U.specularGlossinessTexture,(L=>{L.name=`${x.name} (Specular Glossiness)`,x.reflectivityTexture=L,x.reflectivityTexture.Ha=!0}))),x.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(mL).then((()=>{}))}}g(lL),Z(lL,!0,(L=>new iL(L)));const XL="KHR_materials_unlit";class tL{constructor(L){this.name=XL,this.order=210,this._loader=L,this.enabled=this._loader.isExtensionUsed(XL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async()=>await this._loadUnlitPropertiesAsync(L,U,x)))}_loadUnlitPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;x.unlit=!0;const p=U.pbrMetallicRoughness;return p&&(p.baseColorFactor?(x.albedoColor=G.QU.qU(p.baseColorFactor),x.alpha=p.baseColorFactor[3]):x.albedoColor=G.QU.White(),p.baseColorTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/baseColorTexture`,p.baseColorTexture,(L=>{L.name=`${x.name} (Base Color)`,x.albedoTexture=L})))),U.doubleSided&&(x.Pa=!1,x.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(L,U,x),Promise.all(mL).then((()=>{}))}}g(XL),Z(XL,!0,(L=>new tL(L)));const yL="KHR_materials_clearcoat";class nL{constructor(L){this.name=yL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(yL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadClearCoatPropertiesAsync(mL,p,x)),await Promise.all(G)}))}_loadClearCoatPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return x.clearCoat.isEnabled=!0,x.clearCoat.useRoughnessFromMainTexture=!1,x.clearCoat.remapF0OnInterfaceChange=!1,void 0!=U.clearcoatFactor?x.clearCoat.ya=U.clearcoatFactor:x.clearCoat.ya=0,U.clearcoatTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatTexture`,U.clearcoatTexture,(L=>{L.name=`${x.name} (ClearCoat)`,x.clearCoat.texture=L}))),void 0!=U.clearcoatRoughnessFactor?x.clearCoat.roughness=U.clearcoatRoughnessFactor:x.clearCoat.roughness=0,U.clearcoatRoughnessTexture&&(U.clearcoatRoughnessTexture.nonColorData=!0,mL.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatRoughnessTexture`,U.clearcoatRoughnessTexture,(L=>{L.name=`${x.name} (ClearCoat Roughness)`,x.clearCoat.textureRoughness=L})))),U.clearcoatNormalTexture&&(U.clearcoatNormalTexture.nonColorData=!0,mL.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatNormalTexture`,U.clearcoatNormalTexture,(L=>{L.name=`${x.name} (ClearCoat Normal)`,x.clearCoat.bumpTexture=L}))),x.invertNormalMapX=!x.PL().useRightHandedSystem,x.invertNormalMapY=x.PL().useRightHandedSystem,void 0!=U.clearcoatNormalTexture.scale&&(x.clearCoat.bumpTexture.level=U.clearcoatNormalTexture.scale)),Promise.all(mL).then((()=>{}))}}g(yL),Z(yL,!0,(L=>new nL(L)));const NL="KHR_materials_iridescence";class eL{constructor(L){this.name=NL,this.order=195,this._loader=L,this.enabled=this._loader.isExtensionUsed(NL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadIridescencePropertiesAsync(mL,p,x)),await Promise.all(G).then((()=>{}))}))}_loadIridescencePropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return x.iridescence.isEnabled=!0,x.iridescence.ya=U.iridescenceFactor??0,x.iridescence.indexOfRefraction=U.iridescenceIor??U.iridescenceIOR??1.3,x.iridescence.minimumThickness=U.iridescenceThicknessMinimum??100,x.iridescence.maximumThickness=U.iridescenceThicknessMaximum??400,U.iridescenceTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/iridescenceTexture`,U.iridescenceTexture,(L=>{L.name=`${x.name} (Iridescence)`,x.iridescence.texture=L}))),U.iridescenceThicknessTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/iridescenceThicknessTexture`,U.iridescenceThicknessTexture,(L=>{L.name=`${x.name} (Iridescence Thickness)`,x.iridescence.thicknessTexture=L}))),Promise.all(mL).then((()=>{}))}}g(NL),Z(NL,!0,(L=>new eL(L)));const uL="KHR_materials_anisotropy";class ZL{constructor(L){this.name=uL,this.order=195,this._loader=L,this.enabled=this._loader.isExtensionUsed(uL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadIridescencePropertiesAsync(mL,p,x)),await Promise.all(G)}))}async _loadIridescencePropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;x.anisotropy.isEnabled=!0,x.anisotropy.ya=U.anisotropyStrength??0,x.anisotropy.angle=U.anisotropyRotation??0,U.anisotropyTexture&&(U.anisotropyTexture.nonColorData=!0,mL.push(this._loader.loadTextureInfoAsync(`${L}/anisotropyTexture`,U.anisotropyTexture,(L=>{L.name=`${x.name} (Anisotropy Intensity)`,x.anisotropy.texture=L})))),await Promise.all(mL)}}g(uL),Z(uL,!0,(L=>new ZL(L)));const gL="KHR_materials_emissive_strength";class zL{constructor(L){this.name=gL,this.order=170,this._loader=L,this.enabled=this._loader.isExtensionUsed(gL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>await this._loader.loadMaterialPropertiesAsync(L,U,x).then((()=>{this._loadEmissiveProperties(mL,p,x)}))))}_loadEmissiveProperties(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);void 0!==U.emissiveStrength&&(x.emissiveIntensity=U.emissiveStrength)}}g(gL),Z(gL,!0,(L=>new zL(L)));const ML="KHR_materials_sheen";class JL{constructor(L){this.name=ML,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(ML)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadSheenPropertiesAsync(mL,p,x)),await Promise.all(G).then((()=>{}))}))}_loadSheenPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return x.sheen.isEnabled=!0,x.sheen.ya=1,void 0!=U.sheenColorFactor?x.sheen.color=G.QU.qU(U.sheenColorFactor):x.sheen.color=G.QU.Black(),U.sheenColorTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/sheenColorTexture`,U.sheenColorTexture,(L=>{L.name=`${x.name} (Sheen Color)`,x.sheen.texture=L}))),void 0!==U.sheenRoughnessFactor?x.sheen.roughness=U.sheenRoughnessFactor:x.sheen.roughness=0,U.sheenRoughnessTexture&&(U.sheenRoughnessTexture.nonColorData=!0,mL.push(this._loader.loadTextureInfoAsync(`${L}/sheenRoughnessTexture`,U.sheenRoughnessTexture,(L=>{L.name=`${x.name} (Sheen Roughness)`,x.sheen.textureRoughness=L})))),x.sheen.albedoScaling=!0,x.sheen.useRoughnessFromMainTexture=!1,Promise.all(mL).then((()=>{}))}}g(ML),Z(ML,!0,(L=>new JL(L)));var jL=x(13086);const RL="KHR_materials_specular";class cL{constructor(L){this.name=RL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(RL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;if(G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadSpecularPropertiesAsync(mL,p,x)),p.extensions&&p.extensions.EXT_materials_specular_edge_color&&x instanceof q.d){p.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(x.brdf.dielectricSpecularModel=jL.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,x.brdf.conductorSpecularModel=jL.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(G).then((()=>{}))}))}_loadSpecularPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return void 0!==U.specularFactor&&(x.metallicF0Factor=U.specularFactor),void 0!==U.specularColorFactor&&(x.metallicReflectanceColor=G.QU.qU(U.specularColorFactor)),U.specularTexture&&(U.specularTexture.nonColorData=!0,mL.push(this._loader.loadTextureInfoAsync(`${L}/specularTexture`,U.specularTexture,(L=>{L.name=`${x.name} (Specular)`,x.metallicReflectanceTexture=L,x.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),U.specularColorTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/specularColorTexture`,U.specularColorTexture,(L=>{L.name=`${x.name} (Specular Color)`,x.reflectanceTexture=L}))),Promise.all(mL).then((()=>{}))}}g(RL),Z(RL,!0,(L=>new cL(L)));const WL="KHR_materials_ior";class IL{constructor(L){this.name=WL,this.order=180,this._loader=L,this.enabled=this._loader.isExtensionUsed(WL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadIorPropertiesAsync(mL,p,x)),await Promise.all(G).then((()=>{}))}))}_loadIorPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);return void 0!==U.ior?x.indexOfRefraction=U.ior:x.indexOfRefraction=IL._DEFAULT_IOR,Promise.resolve()}}IL._DEFAULT_IOR=1.5,g(WL),Z(WL,!0,(L=>new IL(L)));const wL="KHR_materials_variants";class BL{constructor(L){this.name=wL,this._loader=L,this.enabled=this._loader.isExtensionUsed(wL)}dispose(){this._loader=null}static GetAvailableVariants(L){const U=this._GetExtensionMetadata(L);return U?Object.keys(U.variants):[]}getAvailableVariants(L){return BL.GetAvailableVariants(L)}static SelectVariant(L,U){const x=this._GetExtensionMetadata(L);if(!x)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${wL} extension`);const mL=L=>{const U=x.variants[L];if(U)for(const x of U)x.mesh.material=x.material};if(U instanceof Array)for(const p of U)mL(p);else mL(U);x.lastSelected=U}selectVariant(L,U){BL.SelectVariant(L,U)}static Reset(L){const U=this._GetExtensionMetadata(L);if(!U)throw new Error(`Cannot reset on a glTF mesh that does not have the ${wL} extension`);for(const x of U.original)x.mesh.material=x.material;U.lastSelected=null}reset(L){BL.Reset(L)}static GetLastSelectedVariant(L){const U=this._GetExtensionMetadata(L);if(!U)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${wL} extension`);return U.lastSelected}getLastSelectedVariant(L){return BL.GetLastSelectedVariant(L)}static _GetExtensionMetadata(L){var U,x;return(null===L||void 0===L||null===(U=L._internalMetadata)||void 0===U||null===(x=U.ba)||void 0===x?void 0:x[wL])||null}onLoading(){const L=this._loader.ba.extensions;if(L&&L[this.name]){const U=L[this.name];this._variants=U.variants}}onReady(){const L=this._loader.rootBabylonMesh;if(L){var U;const x=this._loader.parent.extensionOptions[wL];null!==x&&void 0!==x&&x.defaultVariant&&BL.SelectVariant(L,x.defaultVariant),null===x||void 0===x||null===(U=x.onLoaded)||void 0===U||U.call(x,{get variants(){return BL.GetAvailableVariants(L)},get selectedVariant(){const U=BL.GetLastSelectedVariant(L);return U?Array.isArray(U)?U[0]:U:BL.GetAvailableVariants(L)[0]},set selectedVariant(U){BL.SelectVariant(L,U)}})}}_loadMeshPrimitiveAsync(L,U,x,mL,p,G){return c.LoadExtensionAsync(L,p,this.name,(async(F,a)=>{const o=new Array;return o.push(this._loader._loadMeshPrimitiveAsync(L,U,x,mL,p,(U=>{if(G(U),U instanceof K.e){const x=c._GetDrawMode(L,p.mode),mL=this._loader.rootBabylonMesh,G=mL?mL._internalMetadata=mL._internalMetadata||{}:{},A=G.ba=G.ba||{},r=A[wL]=A[wL]||{lastSelected:null,original:[],variants:{}};r.original.push({mesh:U,material:U.material});for(let L=0;L<a.mappings.length;++L){const p=a.mappings[L],G=j.Get(`${F}/mappings/${L}/material`,this._loader.ba.materials,p.material);o.push(this._loader._loadMaterialAsync(`#/materials/${p.material}`,G,U,x,(L=>{for(let x=0;x<p.variants.length;++x){const G=p.variants[x],F=j.Get(`/extensions/${wL}/variants/${G}`,this._variants,G);r.variants[F.name]=r.variants[F.name]||[],r.variants[F.name].push({mesh:U,material:L}),U.onClonedObservable.add((L=>{const x=L;let p=null,G=x;do{if(G=G.parent,!G)return;p=BL._GetExtensionMetadata(G)}while(null===p);if(mL&&p===BL._GetExtensionMetadata(mL)){G._internalMetadata={};for(const L in mL._internalMetadata)G._internalMetadata[L]=mL._internalMetadata[L];G._internalMetadata.ba=[];for(const L in mL._internalMetadata.ba)G._internalMetadata.ba[L]=mL._internalMetadata.ba[L];G._internalMetadata.ba[wL]={lastSelected:null,original:[],variants:{}};for(const L of p.original)G._internalMetadata.ba[wL].original.push({mesh:L.mesh,material:L.material});for(const L in p.variants)if(Object.prototype.hasOwnProperty.call(p.variants,L)){G._internalMetadata.ba[wL].variants[L]=[];for(const U of p.variants[L])G._internalMetadata.ba[wL].variants[L].push({mesh:U.mesh,material:U.material})}p=G._internalMetadata.ba[wL]}for(const mL of p.original)mL.mesh===U&&(mL.mesh=x);for(const mL of p.variants[F.name])mL.mesh===U&&(mL.mesh=x)}))}})))}}}))),await Promise.all(o).then((L=>{let[U]=L;return U}))}))}}g(wL),Z(wL,!0,(L=>new BL(L)));var sL=x(12653);class CL{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:jL.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(L,U){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...CL._GetDefaultOptions(),...L},this._scene=U,this._scene._transmissionHelper=this,this.onErrorObservable=new r.c,this._scene.oa.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(L){if(!Object.keys(L).filter((U=>this._options[U]!==L[U])).length)return;const U={...this._options,...L},x=this._options;this._options=U,U.renderSize===x.renderSize&&U.renderTargetTextureType===x.renderTargetTextureType&&U.generateMipmaps===x.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=U.samples,this._opaqueRenderTarget.lodGenerationScale=U.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=U.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(L){return!!L&&!!(L instanceof q.d&&L.subSurface.isRefractionEnabled)}_addMesh(L){this._materialObservers[L.uniqueId]=L.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),F.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(L.material)?(L.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(L)&&this._transparentMeshesCache.push(L)):-1===this._opaqueMeshesCache.indexOf(L)&&this._opaqueMeshesCache.push(L)}))}_removeMesh(L){L.onMaterialChangedObservable.remove(this._materialObservers[L.uniqueId]),delete this._materialObservers[L.uniqueId];let U=this._transparentMeshesCache.indexOf(L);-1!==U&&this._transparentMeshesCache.splice(U,1),U=this._opaqueMeshesCache.indexOf(L),-1!==U&&this._opaqueMeshesCache.splice(U,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(L){const U=this._transparentMeshesCache.indexOf(L),x=this._opaqueMeshesCache.indexOf(L);this._shouldRenderAsTransmission(L.material)?(L.material instanceof q.d&&(L.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==x?(this._opaqueMeshesCache.splice(x,1),this._transparentMeshesCache.push(L)):-1===U&&this._transparentMeshesCache.push(L)):-1!==U?(this._transparentMeshesCache.splice(U,1),this._opaqueMeshesCache.push(L)):-1===x&&this._opaqueMeshesCache.push(L)}_isRenderTargetValid(){var L;return null!==(null===(L=this._opaqueRenderTarget)||void 0===L?void 0:L.getInternalTexture())}_setupRenderTargets(){var L;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new sL.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(L=this._options.clearColor)||void 0===L?void 0:L.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((L=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?L.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(L.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const x of this._transparentMeshesCache)this._shouldRenderAsTransmission(x.material)&&(x.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const kL="KHR_materials_transmission";class TL{constructor(L){this.name=kL,this.order=175,this._loader=L,this.enabled=this._loader.isExtensionUsed(kL),this.enabled&&(L.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadTransparentPropertiesAsync(mL,U,x,p)),await Promise.all(G).then((()=>{}))}))}_loadTransparentPropertiesAsync(L,U,x,mL){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const p=x;if(p.subSurface.isRefractionEnabled=!0,p.subSurface.volumeIndexOfRefraction=1,p.subSurface.useAlbedoToTintRefraction=!0,void 0===mL.transmissionFactor)return p.subSurface.refractionIntensity=0,p.subSurface.isRefractionEnabled=!1,Promise.resolve();{var G;p.subSurface.refractionIntensity=mL.transmissionFactor;const L=p.PL();if(p.subSurface.refractionIntensity&&!L._transmissionHelper)new CL({},p.PL());else if(p.subSurface.refractionIntensity&&(null===(G=L._transmissionHelper)||void 0===G||!G._isRenderTargetValid())){var F;null===(F=L._transmissionHelper)||void 0===F||F._setupRenderTargets()}}return p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=0,mL.transmissionTexture?(mL.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${L}/transmissionTexture`,mL.transmissionTexture,void 0).then((L=>{L.name=`${x.name} (Transmission)`,p.subSurface.refractionIntensityTexture=L,p.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}g(kL),Z(kL,!0,(L=>new TL(L)));const OL="KHR_materials_diffuse_transmission";class LU{constructor(L){this.name=OL,this.order=174,this._loader=L,this.enabled=this._loader.isExtensionUsed(OL),this.enabled&&(L.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadTranslucentPropertiesAsync(mL,U,x,p)),await Promise.all(G).then((()=>{}))}))}_loadTranslucentPropertiesAsync(L,U,x,mL){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const p=x;if(p.subSurface.isTranslucencyEnabled=!0,p.subSurface.volumeIndexOfRefraction=1,p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=0,p.subSurface.useAlbedoToTintTranslucency=!1,void 0===mL.diffuseTransmissionFactor)return p.subSurface.translucencyIntensity=0,p.subSurface.isTranslucencyEnabled=!1,Promise.resolve();p.subSurface.translucencyIntensity=mL.diffuseTransmissionFactor;const F=new Array;return p.subSurface.useGltfStyleTextures=!0,mL.diffuseTransmissionTexture&&(mL.diffuseTransmissionTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTransmissionTexture`,mL.diffuseTransmissionTexture).then((L=>{L.name=`${x.name} (Diffuse Transmission)`,p.subSurface.translucencyIntensityTexture=L})))),void 0!==mL.diffuseTransmissionColorFactor?p.subSurface.translucencyColor=G.QU.qU(mL.diffuseTransmissionColorFactor):p.subSurface.translucencyColor=G.QU.White(),mL.diffuseTransmissionColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTransmissionColorTexture`,mL.diffuseTransmissionColorTexture).then((L=>{L.name=`${x.name} (Diffuse Transmission Color)`,p.subSurface.translucencyColorTexture=L}))),Promise.all(F).then((()=>{}))}}g(OL),Z(OL,!0,(L=>new LU(L)));const UU="KHR_materials_volume";class xU{constructor(L){this.name=UU,this.order=173,this._loader=L,this.enabled=this._loader.isExtensionUsed(UU),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadVolumePropertiesAsync(mL,U,x,p)),await Promise.all(G).then((()=>{}))}))}_loadVolumePropertiesAsync(L,U,x,mL){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);if(!x.subSurface.isRefractionEnabled&&!x.subSurface.isTranslucencyEnabled||!mL.thicknessFactor)return Promise.resolve();x.subSurface.volumeIndexOfRefraction=x.indexOfRefraction;const p=void 0!==mL.attenuationDistance?mL.attenuationDistance:Number.MAX_VALUE;return x.subSurface.tintColorAtDistance=p,void 0!==mL.attenuationColor&&3==mL.attenuationColor.length&&x.subSurface.tintColor.da(mL.attenuationColor[0],mL.attenuationColor[1],mL.attenuationColor[2]),x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=mL.thicknessFactor,x.subSurface.useThicknessAsDepth=!0,mL.thicknessTexture?(mL.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${L}/thicknessTexture`,mL.thicknessTexture).then((L=>{L.name=`${x.name} (Thickness)`,x.subSurface.thicknessTexture=L,x.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}g(UU),Z(UU,!0,(L=>new xU(L)));const mx="KHR_materials_dispersion";class pU{constructor(L){this.name=mx,this.order=174,this._loader=L,this.enabled=this._loader.isExtensionUsed(mx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadDispersionPropertiesAsync(mL,U,x,p)),await Promise.all(G).then((()=>{}))}))}_loadDispersionPropertiesAsync(L,U,x,mL){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);return x.subSurface.isRefractionEnabled&&mL.dispersion?(x.subSurface.isDispersionEnabled=!0,x.subSurface.dispersion=mL.dispersion,Promise.resolve()):Promise.resolve()}}g(mx),Z(mx,!0,(L=>new pU(L)));const GU="EXT_materials_diffuse_roughness";class FU{constructor(L){this.name=GU,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(GU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(L,U,x)),G.push(this._loadDiffuseRoughnessPropertiesAsync(mL,p,x)),await Promise.all(G).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(L,U,x){if(!(x instanceof q.d))throw new Error(`${L}: Material type not supported`);const mL=new Array;return x.brdf.baseDiffuseModel=jL.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=U.diffuseRoughnessFactor?x.baseDiffuseRoughness=U.diffuseRoughnessFactor:x.baseDiffuseRoughness=0,U.diffuseRoughnessTexture&&mL.push(this._loader.loadTextureInfoAsync(`${L}/diffuseRoughnessTexture`,U.diffuseRoughnessTexture,(L=>{L.name=`${x.name} (Diffuse Roughness)`,x.baseDiffuseRoughnessTexture=L}))),Promise.all(mL).then((()=>{}))}}g(GU),Z(GU,!0,(L=>new FU(L)));const aU="KHR_mesh_quantization";class oU{constructor(L){this.name=aU,this.enabled=L.isExtensionUsed(aU)}dispose(){}}g(aU),Z(aU,!0,(L=>new oU(L)));const AU="KHR_texture_basisu";class rU{constructor(L){this.name=AU,this._loader=L,this.enabled=L.isExtensionUsed(AU)}dispose(){this._loader=null}_loadTextureAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>{const G=void 0==U.sampler?c.DefaultSampler:j.Get(`${L}/sampler`,this._loader.ba.samplers,U.sampler),F=j.Get(`${mL}/source`,this._loader.ba.images,p.source);return await this._loader._createTextureAsync(L,G,F,(L=>{x(L)}),U._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!U._textureInfo.nonColorData)}))}}g(AU),Z(AU,!0,(L=>new rU(L)));const hU="KHR_texture_transform";class bU{constructor(L){this.name=hU,this._loader=L,this.enabled=this._loader.isExtensionUsed(hU)}dispose(){this._loader=null}loadTextureInfoAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(mL,p)=>await this._loader.loadTextureInfoAsync(L,U,(L=>{if(!(L instanceof f.e))throw new Error(`${mL}: Texture type not supported`);p.offset&&(L.uOffset=p.offset[0],L.vOffset=p.offset[1]),L.uRotationCenter=0,L.vRotationCenter=0,p.rotation&&(L.wAng=-p.rotation),p.scale&&(L.uScale=p.scale[0],L.vScale=p.scale[1]),void 0!=p.texCoord&&(L.coordinatesIndex=p.texCoord),x(L)}))))}}g(hU),Z(hU,!0,(L=>new bU(L)));const EU="KHR_xmp_json_ld";class YU{constructor(L){this.name=EU,this.order=100,this._loader=L,this.enabled=this._loader.isExtensionUsed(EU)}dispose(){this._loader=null}onLoading(){var L,U,x;if(null===this._loader.rootBabylonMesh)return;const mL=null===(L=this._loader.ba.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld,p=null===(U=this._loader.ba.asset)||void 0===U||null===(x=U.extensions)||void 0===x?void 0:x.KHR_xmp_json_ld;if(mL&&p){const L=+p.packet;mL.packets&&L<mL.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=mL.packets[L])}}}function SU(L,U,x,mL){return G.QU.qU(U,x).scale(mL)}function VU(L,U,x,mL){return U[x]*mL}function HU(L,U,x,mL){return-U[x]*mL}function QU(L,U,x,mL){return U[x+1]*mL}function qU(L,U,x,mL){return U[x]*mL*2}function fU(L){return{scale:[new DU(b.c.ANIMATIONTYPE_FLOAT,`${L}.uScale`,VU,(()=>2)),new DU(b.c.ANIMATIONTYPE_FLOAT,`${L}.vScale`,QU,(()=>2))],offset:[new DU(b.c.ANIMATIONTYPE_FLOAT,`${L}.uOffset`,VU,(()=>2)),new DU(b.c.ANIMATIONTYPE_FLOAT,`${L}.vOffset`,QU,(()=>2))],rotation:[new DU(b.c.ANIMATIONTYPE_FLOAT,`${L}.wAng`,HU,(()=>1))]}}g(EU),Z(EU,!0,(L=>new YU(L)));class vU extends W.AnimationPropertyInfo{buildAnimations(L,U,x,mL){return[{babylonAnimatable:L._babylonCamera,babylonAnimation:this._buildAnimation(U,x,mL)}]}}class DU extends W.AnimationPropertyInfo{buildAnimations(L,U,x,mL){const p=[];for(const G in L._data)p.push({babylonAnimatable:L._data[G].babylonMaterial,babylonAnimation:this._buildAnimation(U,x,mL)});return p}}class PU extends W.AnimationPropertyInfo{buildAnimations(L,U,x,mL){return[{babylonAnimatable:L._babylonLight,babylonAnimation:this._buildAnimation(U,x,mL)}]}}(0,z.m)("/cameras/{}/orthographic/xmag",[new vU(b.c.ANIMATIONTYPE_FLOAT,"orthoLeft",HU,(()=>1)),new vU(b.c.ANIMATIONTYPE_FLOAT,"orthoRight",QU,(()=>1))]),(0,z.m)("/cameras/{}/orthographic/ymag",[new vU(b.c.ANIMATIONTYPE_FLOAT,"orthoBottom",HU,(()=>1)),new vU(b.c.ANIMATIONTYPE_FLOAT,"orthoTop",QU,(()=>1))]),(0,z.m)("/cameras/{}/orthographic/zfar",[new vU(b.c.ANIMATIONTYPE_FLOAT,"maxZ",VU,(()=>1))]),(0,z.m)("/cameras/{}/orthographic/znear",[new vU(b.c.ANIMATIONTYPE_FLOAT,"Qa",VU,(()=>1))]),(0,z.m)("/cameras/{}/perspective/yfov",[new vU(b.c.ANIMATIONTYPE_FLOAT,"fov",VU,(()=>1))]),(0,z.m)("/cameras/{}/perspective/zfar",[new vU(b.c.ANIMATIONTYPE_FLOAT,"maxZ",VU,(()=>1))]),(0,z.m)("/cameras/{}/perspective/znear",[new vU(b.c.ANIMATIONTYPE_FLOAT,"Qa",VU,(()=>1))]),(0,z.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new DU(b.c.ANIMATIONTYPE_COLOR3,"albedoColor",SU,(()=>4)),new DU(b.c.ANIMATIONTYPE_FLOAT,"alpha",(function(L,U,x,mL){return U[x+3]*mL}),(()=>4))]),(0,z.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"metallic",VU,(()=>1))]),(0,z.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"roughness",VU,(()=>1))]);const dU=fU("albedoTexture");(0,z.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",dU.scale),(0,z.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",dU.offset),(0,z.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",dU.rotation);const KU=fU("metallicTexture");(0,z.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",KU.scale),(0,z.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",KU.offset),(0,z.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",KU.rotation),(0,z.m)("/materials/{}/emissiveFactor",[new DU(b.c.ANIMATIONTYPE_COLOR3,"emissiveColor",SU,(()=>3))]);const lU=fU("bumpTexture");(0,z.m)("/materials/{}/normalTexture/scale",[new DU(b.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",VU,(()=>1))]),(0,z.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",lU.scale),(0,z.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",lU.offset),(0,z.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",lU.rotation),(0,z.m)("/materials/{}/occlusionTexture/strength",[new DU(b.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",VU,(()=>1))]);const iU=fU("ambientTexture");(0,z.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",iU.scale),(0,z.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",iU.offset),(0,z.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",iU.rotation);const XU=fU("emissiveTexture");(0,z.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",XU.scale),(0,z.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",XU.offset),(0,z.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",XU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new DU(b.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new DU(b.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",VU,(()=>1))]);const tU=fU("anisotropy.texture");(0,z.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",tU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",tU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",tU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",VU,(()=>1))]);const yU=fU("clearCoat.texture");(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",yU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",yU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",yU.rotation);const nU=fU("clearCoat.bumpTexture");(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new DU(b.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",nU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",nU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",nU.rotation);const NU=fU("clearCoat.textureRoughness");(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",NU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",NU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",NU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new DU(b.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new DU(b.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new DU(b.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new DU(b.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",VU,(()=>1))]);const eU=fU("iridescence.texture");(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",eU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",eU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",eU.rotation);const uU=fU("iridescence.thicknessTexture");(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",uU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",uU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",uU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new DU(b.c.ANIMATIONTYPE_COLOR3,"sheen.color",SU,(()=>3))]),(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",VU,(()=>1))]);const ZU=fU("sheen.texture");(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",ZU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",ZU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",ZU.rotation);const gU=fU("sheen.textureRoughness");(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",gU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",gU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",gU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new DU(b.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",SU,(()=>3))]);const zU=fU("metallicReflectanceTexture");(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",zU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",zU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",zU.rotation);const MU=fU("reflectanceTexture");(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",MU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",MU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",MU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",VU,(()=>1))]);const JU=fU("subSurface.refractionIntensityTexture");(0,z.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",JU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",JU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",JU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new DU(b.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",SU,(()=>3))]),(0,z.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new DU(b.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",VU,(()=>1))]),(0,z.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",VU,(()=>1))]);const jU=fU("subSurface.thicknessTexture");(0,z.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",jU.scale),(0,z.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",jU.offset),(0,z.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",jU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new DU(b.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",VU,(()=>1))]);const RU=fU("subSurface.translucencyIntensityTexture");(0,z.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",RU.scale),(0,z.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",RU.offset),(0,z.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",RU.rotation),(0,z.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new DU(b.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",SU,(()=>3))]);const cU=fU("subSurface.translucencyColorTexture");(0,z.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",cU.scale),(0,z.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",cU.offset),(0,z.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",cU.rotation),(0,z.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new PU(b.c.ANIMATIONTYPE_COLOR3,"diffuse",SU,(()=>3))]),(0,z.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new PU(b.c.ANIMATIONTYPE_FLOAT,"intensity",VU,(()=>1))]),(0,z.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new PU(b.c.ANIMATIONTYPE_FLOAT,"range",VU,(()=>1))]),(0,z.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new PU(b.c.ANIMATIONTYPE_FLOAT,"innerAngle",qU,(()=>1))]),(0,z.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new PU(b.c.ANIMATIONTYPE_FLOAT,"angle",qU,(()=>1))]),(0,z.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new PU(b.c.ANIMATIONTYPE_COLOR3,"diffuse",SU,(()=>3))]),(0,z.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new PU(b.c.ANIMATIONTYPE_FLOAT,"intensity",VU,(()=>1))]);const WU="KHR_animation_pointer";class IU{constructor(L){this.name=WU,this._loader=L,this._pathToObjectConverter=(0,z.j)(this._loader.ba)}get enabled(){return this._loader.isExtensionUsed(WU)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(L,U,x,mL,p){var G;const F=null===(G=mL.target.extensions)||void 0===G?void 0:G.KHR_animation_pointer;if(!F||!this._pathToObjectConverter)return null;"pointer"!==mL.target.path&&S.c.Warn(`${L}/target/path: Value (${mL.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=mL.target.node&&S.c.Warn(`${L}/target/node: Value (${mL.target.node}) must not be present when using the ${this.name} extension`);const a=`${L}/extensions/${this.name}`,o=F.pointer;if(!o)throw new Error(`${a}: Pointer is missing`);try{const G=this._pathToObjectConverter.convert(o);if(!G.info.interpolation)throw new Error(`${a}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(L,U,x,mL,{object:G.object,info:G.info.interpolation},p)}catch(A){return S.c.Warn(`${a}/pointer: Invalid pointer (${o}) skipped`),null}}}g(WU),Z(WU,!0,(L=>new IU(L)));class wU{constructor(L,U,x){this.frame=L,this.action=U,this.onlyOnce=x,this.isDone=!1}_clone(){return new wU(this.frame,this.action,this.onlyOnce)}}var BU=x(12426),sU=x(12479),CU=x(12475);class kU{get loop(){return this._loop}set loop(L){L!==this._loop&&(this._loop=L,this.updateOptions({loop:L}))}get currentTime(){var L;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(L=sU.e.audioEngine)&&void 0!==L&&L.audioContext&&(this.isPlaying||this.isPaused)){const L=this.isPaused?0:sU.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+L}return 0}get spatialSound(){return this._spatialSound}set spatialSound(L){if(L==this._spatialSound)return;const U=this.isPlaying;this.pause(),L?(this._spatialSound=L,this._updateSpatialParameters()):this._disableSpatialSound(),U&&this.play()}constructor(L,U,x){var mL;let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new r.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=p.YU.Zero(),this._localDirection=new p.YU(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=L,x=x||Y.c.LastCreatedScene)if(this._scene=x,kU._SceneComponentInitialization(x),this._readyToPlayCallback=G,this._customAttenuationFunction=(L,U,x,mL,p)=>U<x?L*(1-U/x):0,a&&(this.autoplay=a.autoplay||!1,this._loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this._spatialSound=a.spatialSound??!1,this.maxDistance=a.maxDistance??100,this.useCustomAttenuation=a.useCustomAttenuation??!1,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=a.streaming??!1,this._length=a.length,this._offset=a.offset),null!==(mL=sU.e.audioEngine)&&void 0!==mL&&mL.canUseWebAudio&&sU.e.audioEngine.audioContext){this._soundGain=sU.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let L=!0;if(U)try{"string"===typeof U?(this._urlType="String",this._url=U):U instanceof ArrayBuffer?this._urlType="ArrayBuffer":U instanceof HTMLMediaElement?this._urlType="MediaElement":U instanceof MediaStream?this._urlType="MediaStream":U instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(U)&&(this._urlType="Array");let x=[],mL=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=sU.e.audioEngine.audioContext.createMediaElementSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=sU.e.audioEngine.audioContext.createMediaStreamSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":U.byteLength>0&&(mL=!0,this._soundLoaded(U));break;case"AudioBuffer":this._audioBufferLoaded(U);break;case"String":x.push(U);case"Array":0===x.length&&(x=U);for(let L=0;L<x.length;L++){const U=x[L];if(mL=a&&a.skipCodecCheck||-1!==U.indexOf(".mp3",U.length-4)&&sU.e.audioEngine.isMP3supported||-1!==U.indexOf(".ogg",U.length-4)&&sU.e.audioEngine.isOGGsupported||-1!==U.indexOf(".wav",U.length-4)||-1!==U.indexOf(".m4a",U.length-4)||-1!==U.indexOf(".mp4",U.length-4)||-1!==U.indexOf("blob:"),mL){this._streaming?(this._htmlAudioElement=new Audio(U),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,F.Tools.SetCorsBehavior(U,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(U,(L=>{this._soundLoaded(L)}),void 0,!0,!0,(L=>{L&&S.c.Error("XHR "+L.status+" error on: "+U+"."),S.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:L=!1}L?mL||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):S.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(o){S.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),sU.e.audioEngine&&!sU.e.audioEngine.WarnedWebAudioUnsupported&&(S.c.Error("Web Audio is not supported by your browser."),sU.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var L;null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(L){var U;null!==(U=sU.e.audioEngine)&&void 0!==U&&U.audioContext&&(this._audioBuffer=L,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(L){var U;null!==(U=sU.e.audioEngine)&&void 0!==U&&U.audioContext&&sU.e.audioEngine.audioContext.decodeAudioData(L,(L=>{this._audioBufferLoaded(L)}),(L=>{S.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+L)}))}setAudioBuffer(L){var U;null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this._audioBuffer=L,this._isReadyToPlay=!0)}updateOptions(L){L&&(this.loop=L.loop??this.loop,this.maxDistance=L.maxDistance??this.maxDistance,this.useCustomAttenuation=L.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=L.rolloffFactor??this.rolloffFactor,this.refDistance=L.refDistance??this.refDistance,this.distanceModel=L.distanceModel??this.distanceModel,this._playbackRate=L.playbackRate??this._playbackRate,this._length=L.length??void 0,this.spatialSound=L.spatialSound??this._spatialSound,this._setOffset(L.offset??void 0),this.setVolume(L.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var L;null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&sU.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??sU.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var L;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(L=this._soundPanner)||void 0===L||L.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var L;null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(L){var U;null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(L),this._isOutputConnected=!0)}setDirectionalCone(L,U,x){U<L?S.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=L,this._coneOuterAngle=U,this._coneOuterGain=x,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(L){if(L!=this._coneInnerAngle){var U;if(this._coneOuterAngle<L)return void S.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=L,null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(L){if(L!=this._coneOuterAngle){var U;if(L<this._coneInnerAngle)return void S.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=L,null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(L){var U;L.equals(this._position)||(this._position.p(L),null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(L){var U;this._localDirection=L,null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const L=this._connectedTransformNode.getWorldMatrix(),U=p.YU.TransformNormal(this._localDirection,L);U.normalize(),this._soundPanner.orientationX.value=U.x,this._soundPanner.orientationY.value=U.y,this._soundPanner.orientationZ.value=U.z}updateDistanceFromListener(){var L;if(null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const L=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.SU(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,L,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(L){this._customAttenuationFunction=L}play(L,U,x){var mL;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(mL=sU.e.audioEngine)&&void 0!==mL&&mL.audioContext)try{var p,G;this._clearTimeoutsAndObservers();let mL=L?(null===(p=sU.e.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+L:null===(G=sU.e.audioEngine)||void 0===G?void 0:G.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=sU.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const L=()=>{var x;if(null!==(x=sU.e.audioEngine)&&void 0!==x&&x.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=U??0;const x=this._htmlAudioElement.play();void 0!==x&&x.catch((()=>{var U,x;(null===(U=sU.e.audioEngine)||void 0===U||U.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(x=sU.e.audioEngine)||void 0===x?void 0:x.onAudioUnlockedObservable.addOnce((()=>{L()})))}))}else{var mL;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(mL=sU.e.audioEngine)||void 0===mL?void 0:mL.onAudioUnlockedObservable.addOnce((()=>{L()}))}};L()}}else{var F;const p=()=>{var p;if(null!==(p=sU.e.audioEngine)&&void 0!==p&&p.audioContext){var G;if(x=x||this._length,void 0!==U&&this._setOffset(U),this._soundSource){const L=this._soundSource;L.onended=()=>{L.disconnect()}}if(this._soundSource=null===(G=sU.e.audioEngine)||void 0===G?void 0:G.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var F;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==U&&(this._soundSource.loopStart=U),void 0!==x&&(this._soundSource.loopEnd=(0|U)+x),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},mL=L?(null===(F=sU.e.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+L:sU.e.audioEngine.audioContext.currentTime;const p=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(mL,p,this.loop?void 0:x)}}};"suspended"===(null===(F=sU.e.audioEngine)||void 0===F?void 0:F.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var L;"suspended"===(null===(L=sU.e.audioEngine)||void 0===L?void 0:L.audioContext.state)?(sU.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=sU.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{p()})))):p()}),500):p()}this._startTime=mL,this.isPlaying=!0,this.isPaused=!1}catch(a){S.c.Error("Error while trying to play audio: "+this.name+", "+a.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(L){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var x;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(x=this._streamingSource)||void 0===x||x.disconnect();this.isPlaying=!1}else if(null!==(U=sU.e.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource){const U=L?sU.e.audioEngine.audioContext.currentTime+L:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(U)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var L;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(L=sU.e.audioEngine)&&void 0!==L&&L.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=sU.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(L,U){var x;null!==(x=sU.e.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._soundGain&&(U&&sU.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(sU.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,sU.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(L,sU.e.audioEngine.audioContext.currentTime+U)):this._soundGain.gain.value=L),this._volume=L}setPlaybackRate(L){this._playbackRate=L,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(L){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=L,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=L=>this._onRegisterAfterWorldMatrixUpdate(L),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(L){var U;if(L.getBoundingInfo){const U=L.getBoundingInfo();this.setPosition(U.boundingSphere.centerWorld)}else this.setPosition(L.absolutePosition);null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const L=()=>{(0,CU.h)((()=>this._isReadyToPlay),(()=>{x._audioBuffer=this.getAudioBuffer(),x._isReadyToPlay=!0,x.autoplay&&x.play(0,this._offset,this._length)}),void 0,300)},U={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},x=new kU(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,U);return this.useCustomAttenuation&&x.setAttenuationFunction(this._customAttenuationFunction),x.setPosition(this._position),x.setPlaybackRate(this._playbackRate),L(),x}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const L={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(L.connectedMeshId=this._connectedTransformNode.id),L.position=this._position.Va(),L.refDistance=this.refDistance,L.distanceModel=this.distanceModel,L.isDirectional=this._isDirectional,L.localDirectionToMesh=this._localDirection.Va(),L.coneInnerAngle=this._coneInnerAngle,L.coneOuterAngle=this._coneOuterAngle,L.coneOuterGain=this._coneOuterGain),L}static Parse(L,U,x,mL){const G=L.name;let F;F=L.url?x+L.url:x+G;const a={autoplay:L.autoplay,loop:L.loop,volume:L.volume,spatialSound:L.spatialSound,maxDistance:L.maxDistance,rolloffFactor:L.rolloffFactor,refDistance:L.refDistance,distanceModel:L.distanceModel,playbackRate:L.playbackRate};let o;if(mL){const L=()=>{(0,CU.h)((()=>mL._isReadyToPlay),(()=>{o._audioBuffer=mL.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,o._offset,o._length)}),void 0,300)};o=new kU(G,new ArrayBuffer(0),U,null,a),L()}else o=new kU(G,F,U,(()=>{U.removePendingData(o)}),a),U.addPendingData(o);if(L.position){const U=p.YU.qU(L.position);o.setPosition(U)}if(L.isDirectional&&(o.setDirectionalCone(L.coneInnerAngle||360,L.coneOuterAngle||360,L.coneOuterGain||0),L.localDirectionToMesh)){const U=p.YU.qU(L.localDirectionToMesh);o.setLocalDirectionToMesh(U)}if(L.connectedMeshId){const x=U.getMeshById(L.connectedMeshId);x&&o.attachToMesh(x)}return L.metadata&&(o.metadata=L.metadata),o}_setOffset(L){this._offset!==L&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=L)}_clearTimeoutsAndObservers(){var L;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(L=sU.e.audioEngine)||void 0===L||L.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}kU._SceneComponentInitialization=L=>{throw(0,BU.c)("AudioSceneComponent")},(0,DL.d)("BABYLON.Sound",kU);class TU{constructor(L,U,x){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],U.length!==x.length)throw new Error("Sounds length does not equal weights length");this.loop=L,this._weights=x;let mL=0;for(const G of x)mL+=G;const p=mL>0?1/mL:0;for(let G=0;G<this._weights.length;G++)this._weights[G]*=p;this._sounds=U;for(const G of this._sounds)G.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(L){if(L!==this._coneInnerAngle){if(this._coneOuterAngle<L)return void S.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=L;for(const U of this._sounds)U.directionalConeInnerAngle=L}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(L){if(L!==this._coneOuterAngle){if(L<this._coneInnerAngle)return void S.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=L;for(const U of this._sounds)U.directionalConeOuterAngle=L}}get volume(){return this._volume}set volume(L){if(L!==this._volume)for(const U of this._sounds)U.setVolume(L)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(L){if(!this.isPaused){this.stop();const L=Math.random();let U=0;for(let x=0;x<this._weights.length;x++)if(U+=this._weights[x],L<=U){this._currentIndex=x;break}}const U=this._sounds[this._currentIndex??0];U.isReady()?U.play(0,this.isPaused?void 0:L):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class OU{constructor(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(L=L||Y.c.LastCreatedScene)&&(this._scene=L,this.soundCollection=[],this._options=U,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var L;null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&sU.e.audioEngine.audioContext&&(this._outputAudioNode=sU.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(sU.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(sU.e.audioEngine&&sU.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(L){var U;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&L.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==L.soundTrackId&&(-1===L.soundTrackId?this._scene.mainSoundTrack.removeSound(L):this._scene.soundTracks&&this._scene.soundTracks[L.soundTrackId].removeSound(L)),this.soundCollection.push(L),L.soundTrackId=this.id}removeSound(L){const U=this.soundCollection.indexOf(L);-1!==U&&this.soundCollection.splice(U,1)}setVolume(L){var U;null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=L)}switchPanningModelToHRTF(){var L;if(null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var L;if(null!==(L=sU.e.audioEngine)&&void 0!==L&&L.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToEqualPower()}connectToAnalyser(L){var U;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=L,null!==(U=sU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,sU.e.audioEngine.masterGain))}}var Lx=x(12858),Ux=x(12820),xx=x(12397);sU.e.AudioEngineFactory=(L,U,x)=>new mm(L,U,x);class mm{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new r.c,this.onAudioLockedObservable=new r.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,xx.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const mL=document.createElement("audio");this._hostElement=L,this._audioContext=U,this._audioDestination=x;try{mL&&mL.canPlayType&&(mL.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||mL.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(p){}try{mL&&mL.canPlayType&&mL.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(p){}}lock(){this._triggerSuspendedState()}unlock(){var L,U;if("running"===(null===(L=this._audioContext)||void 0===L?void 0:L.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(U=this._audioContext)||void 0===U||U.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{S.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var L;null===(L=this._audioContext)||void 0===L||L.addEventListener("statechange",(()=>{var L;this.unlocked&&"running"!==(null===(L=this._audioContext)||void 0===L?void 0:L.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var L;return null!==(L=this._audioContext)&&void 0!==L&&L.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(L){this.canUseWebAudio=!1,S.c.Error("Web Audio: "+L.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(L){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const L=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",U=document.createElement("style");U.appendChild(document.createTextNode(L)),document.getElementsByTagName("head")[0].appendChild(U),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var L;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(L=this._audioContext)||void 0===L||L.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(L){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=L)}connectToAnalyser(L){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=L,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var px=x(12420);(0,x(14017).h)(Lx.b.NAME_AUDIO,((L,U,x,mL)=>{let p,G=[];if(x.UY=x.UY||[],void 0!==L.UY&&null!==L.UY)for(let a=0,o=L.UY.length;a<o;a++){var F;const o=L.UY[a];null!==(F=sU.e.audioEngine)&&void 0!==F&&F.canUseWebAudio?(o.url||(o.url=o.name),G[o.url]?x.UY.push(kU.Parse(o,U,mL,G[o.url])):(p=kU.Parse(o,U,mL),G[o.url]=p,x.UY.push(p))):x.UY.push(new kU(o.name,null,U))}G=[]})),Object.defineProperty(Ux.e.prototype,"mainSoundTrack",{get:function(){let L=this._getComponent(Lx.b.NAME_AUDIO);return L||(L=new Gx(this),this.o(L)),this._mainSoundTrack||(this._mainSoundTrack=new OU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Ux.e.prototype.getSoundByName=function(L){let U;for(U=0;U<this.mainSoundTrack.soundCollection.length;U++)if(this.mainSoundTrack.soundCollection[U].name===L)return this.mainSoundTrack.soundCollection[U];if(this.soundTracks)for(let x=0;x<this.soundTracks.length;x++)for(U=0;U<this.soundTracks[x].soundCollection.length;U++)if(this.soundTracks[x].soundCollection[U].name===L)return this.soundTracks[x].soundCollection[U];return null},Object.defineProperty(Ux.e.prototype,"audioEnabled",{get:function(){let L=this._getComponent(Lx.b.NAME_AUDIO);return L||(L=new Gx(this),this.o(L)),L.audioEnabled},set:function(L){let U=this._getComponent(Lx.b.NAME_AUDIO);U||(U=new Gx(this),this.o(U)),L?U.enableAudio():U.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Ux.e.prototype,"headphone",{get:function(){let L=this._getComponent(Lx.b.NAME_AUDIO);return L||(L=new Gx(this),this.o(L)),L.headphone},set:function(L){let U=this._getComponent(Lx.b.NAME_AUDIO);U||(U=new Gx(this),this.o(U)),L?U.switchAudioModeForHeadphones():U.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Ux.e.prototype,"audioListenerPositionProvider",{get:function(){let L=this._getComponent(Lx.b.NAME_AUDIO);return L||(L=new Gx(this),this.o(L)),L.audioListenerPositionProvider},set:function(L){let U=this._getComponent(Lx.b.NAME_AUDIO);if(U||(U=new Gx(this),this.o(U)),L&&"function"!==typeof L)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");U.audioListenerPositionProvider=L},enumerable:!0,configurable:!0}),Object.defineProperty(Ux.e.prototype,"audioListenerRotationProvider",{get:function(){let L=this._getComponent(Lx.b.NAME_AUDIO);return L||(L=new Gx(this),this.o(L)),L.audioListenerRotationProvider},set:function(L){let U=this._getComponent(Lx.b.NAME_AUDIO);if(U||(U=new Gx(this),this.o(U)),L&&"function"!==typeof L)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");U.audioListenerRotationProvider=L},enumerable:!0,configurable:!0}),Object.defineProperty(Ux.e.prototype,"audioPositioningRefreshRate",{get:function(){let L=this._getComponent(Lx.b.NAME_AUDIO);return L||(L=new Gx(this),this.o(L)),L.audioPositioningRefreshRate},set:function(L){let U=this._getComponent(Lx.b.NAME_AUDIO);U||(U=new Gx(this),this.o(U)),U.audioPositioningRefreshRate=L},enumerable:!0,configurable:!0});class Gx{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(L){this.name=Lx.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new p.YU,this._cachedCameraPosition=new p.YU,this._lastCheck=0,this._invertMatrixTemp=new p.Matrix,this._cameraDirectionTemp=new p.YU,(L=L||Y.c.LastCreatedScene)&&(this.VU=L,L.soundTracks=[],L.UY=[])}register(){this.VU._afterRenderStage.registerStep(Lx.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(L){if(L.UY=[],this.VU.soundTracks)for(let U=0;U<this.VU.soundTracks.length;U++){const x=this.VU.soundTracks[U];for(let U=0;U<x.soundCollection.length;U++)L.UY.push(x.soundCollection[U].serialize())}}addFromContainer(L){if(L.UY)for(const U of L.UY)U.play(),U.autoplay=!0,this.VU.mainSoundTrack.addSound(U)}removeFromContainer(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(L.UY)for(const x of L.UY)x.stop(),x.autoplay=!1,this.VU.mainSoundTrack.removeSound(x),U&&x.dispose()}dispose(){const L=this.VU;if(L._mainSoundTrack&&L.mainSoundTrack.dispose(),L.soundTracks)for(let U=0;U<L.soundTracks.length;U++)L.soundTracks[U].dispose()}disableAudio(){const L=this.VU;let U;for(this._audioEnabled=!1,sU.e.audioEngine&&sU.e.audioEngine.audioContext&&sU.e.audioEngine.audioContext.suspend(),U=0;U<L.mainSoundTrack.soundCollection.length;U++)L.mainSoundTrack.soundCollection[U].pause();if(L.soundTracks)for(U=0;U<L.soundTracks.length;U++)for(let x=0;x<L.soundTracks[U].soundCollection.length;x++)L.soundTracks[U].soundCollection[x].pause()}enableAudio(){const L=this.VU;let U;for(this._audioEnabled=!0,sU.e.audioEngine&&sU.e.audioEngine.audioContext&&sU.e.audioEngine.audioContext.resume(),U=0;U<L.mainSoundTrack.soundCollection.length;U++)L.mainSoundTrack.soundCollection[U].isPaused&&L.mainSoundTrack.soundCollection[U].play();if(L.soundTracks)for(U=0;U<L.soundTracks.length;U++)for(let x=0;x<L.soundTracks[U].soundCollection.length;x++)L.soundTracks[U].soundCollection[x].isPaused&&L.soundTracks[U].soundCollection[x].play()}switchAudioModeForHeadphones(){const L=this.VU;if(this._headphone=!0,L.mainSoundTrack.switchPanningModelToHRTF(),L.soundTracks)for(let U=0;U<L.soundTracks.length;U++)L.soundTracks[U].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const L=this.VU;if(this._headphone=!1,L.mainSoundTrack.switchPanningModelToEqualPower(),L.soundTracks)for(let U=0;U<L.soundTracks.length;U++)L.soundTracks[U].switchPanningModelToEqualPower()}_afterRender(){const L=px.e.Now;if(this._lastCheck&&L-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=L;const U=this.VU;if(!this._audioEnabled||!U._mainSoundTrack||!U.soundTracks||0===U._mainSoundTrack.soundCollection.length&&1===U.soundTracks.length)return;const x=sU.e.audioEngine;if(x&&x.audioContext){let L,mL=U.activeCamera;if(U.activeCameras&&U.activeCameras.length>0&&(mL=U.activeCameras[0]),this.audioListenerPositionProvider){const L=this.audioListenerPositionProvider();x.audioContext.listener.setPosition(L.x||0,L.y||0,L.z||0)}else mL?this._cachedCameraPosition.equals(mL.globalPosition)||(this._cachedCameraPosition.p(mL.globalPosition),x.audioContext.listener.setPosition(mL.globalPosition.x,mL.globalPosition.y,mL.globalPosition.z)):x.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const L=this.audioListenerRotationProvider();x.audioContext.listener.setOrientation(L.x||0,L.y||0,L.z||0,0,1,0)}else mL?(mL.rigCameras&&mL.rigCameras.length>0&&(mL=mL.rigCameras[0]),mL.getViewMatrix().invertToRef(this._invertMatrixTemp),p.YU.TransformNormalToRef(Gx._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),x.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):x.audioContext.listener.setOrientation(0,0,0,0,1,0);for(L=0;L<U.mainSoundTrack.soundCollection.length;L++){const x=U.mainSoundTrack.soundCollection[L];x.useCustomAttenuation&&x.updateDistanceFromListener()}if(U.soundTracks)for(L=0;L<U.soundTracks.length;L++)for(let x=0;x<U.soundTracks[L].soundCollection.length;x++){const mL=U.soundTracks[L].soundCollection[x];mL.useCustomAttenuation&&mL.updateDistanceFromListener()}}}}Gx._CameraDirection=new p.YU(0,0,-1),kU._SceneComponentInitialization=L=>{let U=L._getComponent(Lx.b.NAME_AUDIO);U||(U=new Gx(L),L.o(U))};const Fx="MSFT_audio_emitter";class ax{constructor(L){this.name=Fx,this._loader=L,this.enabled=this._loader.isExtensionUsed(Fx)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const L=this._loader.ba.extensions;if(L&&L[this.name]){const U=L[this.name];this._clips=U.clips,this._emitters=U.emitters,j.Assign(this._clips),j.Assign(this._emitters)}}loadSceneAsync(L,U){return c.LoadExtensionAsync(L,U,this.name,(async(x,mL)=>{const p=new Array;p.push(this._loader.loadSceneAsync(L,U));for(const L of mL.emitters){const U=j.Get(`${x}/emitters`,this._emitters,L);if(void 0!=U.refDistance||void 0!=U.maxDistance||void 0!=U.rolloffFactor||void 0!=U.distanceModel||void 0!=U.innerAngle||void 0!=U.outerAngle)throw new Error(`${x}: Direction or Distance properties are not allowed on emitters attached to a scene`);p.push(this._loadEmitterAsync(`${x}/emitters/${U.index}`,U))}await Promise.all(p)}))}loadNodeAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(L,mL)=>{const G=new Array,a=await this._loader.loadNodeAsync(L,U,(U=>{for(const x of mL.emitters){const mL=j.Get(`${L}/emitters`,this._emitters,x);G.push(this._loadEmitterAsync(`${L}/emitters/${mL.index}`,mL).then((()=>{for(const L of mL._babylonSounds)L.attachToMesh(U),void 0==mL.innerAngle&&void 0==mL.outerAngle||(L.setLocalDirectionToMesh(p.YU.Forward()),L.setDirectionalCone(2*F.Tools.ToDegrees(void 0==mL.innerAngle?Math.PI:mL.innerAngle),2*F.Tools.ToDegrees(void 0==mL.outerAngle?Math.PI:mL.outerAngle),0))})))}x(U)}));return await Promise.all(G),a}))}loadAnimationAsync(L,U){return c.LoadExtensionAsync(L,U,this.name,(async(x,mL)=>{const p=await this._loader.loadAnimationAsync(L,U),G=new Array;j.Assign(mL.events);for(const F of mL.events)G.push(this._loadAnimationEventAsync(`${x}/events/${F.index}`,L,U,F,p));return await Promise.all(G),p}))}_loadClipAsync(L,U){if(U._objectURL)return U._objectURL;let x;if(U.uri)x=this._loader.loadUriAsync(L,U,U.uri);else{const mL=j.Get(`${L}/bufferView`,this._loader.ba.bufferViews,U.bufferView);x=this._loader.loadBufferViewAsync(`/bufferViews/${mL.index}`,mL)}return U._objectURL=x.then((L=>URL.createObjectURL(new Blob([L],{type:U.mimeType})))),U._objectURL}_loadEmitterAsync(L,U){if(U._babylonSounds=U._babylonSounds||[],!U._babylonData){const L=new Array,x=U.name||`emitter${U.index}`,mL={loop:!1,autoplay:!1,volume:void 0==U.volume?1:U.volume};for(let G=0;G<U.clips.length;G++){const p=`/extensions/${this.name}/clips`,F=j.Get(p,this._clips,U.clips[G].clip);L.push(this._loadClipAsync(`${p}/${U.clips[G].clip}`,F).then((L=>{const p=U._babylonSounds[G]=new kU(x,L,this._loader.babylonScene,null,mL);p.refDistance=U.refDistance||1,p.maxDistance=U.maxDistance||256,p.rolloffFactor=U.rolloffFactor||1,p.distanceModel=U.distanceModel||"exponential"})))}const p=Promise.all(L).then((()=>{const L=U.clips.map((L=>L.weight||1)),x=new TU(U.loop||!1,U._babylonSounds,L);U.innerAngle&&(x.directionalConeInnerAngle=2*F.Tools.ToDegrees(U.innerAngle)),U.outerAngle&&(x.directionalConeOuterAngle=2*F.Tools.ToDegrees(U.outerAngle)),U.volume&&(x.volume=U.volume),U._babylonData.sound=x}));U._babylonData={loaded:p}}return U._babylonData.loaded}_getEventAction(L,U,x,mL,p){switch(x){case"play":return L=>{const x=(p||0)+(L-mL);U.play(x)};case"stop":return()=>{U.stop()};case"pause":return()=>{U.pause()};default:throw new Error(`${L}: Unsupported action ${x}`)}}_loadAnimationEventAsync(L,U,x,mL,p){if(0==p.targetedAnimations.length)return Promise.resolve();const G=p.targetedAnimations[0],F=mL.mx,a=j.Get(`/extensions/${this.name}/emitters`,this._emitters,F);return this._loadEmitterAsync(L,a).then((()=>{const U=a._babylonData.sound;if(U){const x=new wU(mL.time,this._getEventAction(L,U,mL.action,mL.time,mL.startOffset));G.animation.addEvent(x),p.onAnimationGroupEndObservable.add((()=>{U.stop()})),p.onAnimationGroupPauseObservable.add((()=>{U.pause()}))}}))}}g(Fx),Z(Fx,!0,(L=>new ax(L)));const ox="MSFT_lod";class Ax{constructor(L){var U;this.name=ox,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new r.c,this.onMaterialLODsLoadedObservable=new r.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=L,this.maxLODsToLoad=(null===(U=this._loader.parent.extensionOptions[ox])||void 0===U?void 0:U.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ox)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let L=0;L<this._nodePromiseLODs.length;L++){const U=Promise.all(this._nodePromiseLODs[L]).then((()=>{0!==L&&(this._loader.endPerformanceCounter(`Node LOD ${L}`),this._loader.log(`Loaded node LOD ${L}`)),this.onNodeLODsLoadedObservable.notifyObservers(L),L!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${L+1}`),this._loadBufferLOD(this._nodeBufferLODs,L+1),this._nodeSignalLODs[L]&&this._nodeSignalLODs[L].resolve())}));this._loader._completePromises.push(U)}for(let L=0;L<this._materialPromiseLODs.length;L++){const U=Promise.all(this._materialPromiseLODs[L]).then((()=>{0!==L&&(this._loader.endPerformanceCounter(`Material LOD ${L}`),this._loader.log(`Loaded material LOD ${L}`)),this.onMaterialLODsLoadedObservable.notifyObservers(L),L!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${L+1}`),this._loadBufferLOD(this._materialBufferLODs,L+1),this._materialSignalLODs[L]&&this._materialSignalLODs[L].resolve())}));this._loader._completePromises.push(U)}}loadSceneAsync(L,U){const x=this._loader.loadSceneAsync(L,U);return this._loadBufferLOD(this._bufferLODs,0),x}loadNodeAsync(L,U,x){return c.LoadExtensionAsync(L,U,this.name,(async(L,p)=>{let G;const F=this._getLODs(L,U,this._loader.ba.nodes,p.ids);this._loader.logOpen(`${L}`);for(let U=0;U<F.length;U++){const L=F[U];0!==U&&(this._nodeIndexLOD=U,this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new mL);const p=L=>{x(L),L.ka(!1)},a=this._loader.loadNodeAsync(`/nodes/${L.index}`,L,p).then((L=>{if(0!==U){const L=F[U-1];L._babylonTransformNode&&(this._disposeTransformNode(L._babylonTransformNode),delete L._babylonTransformNode)}return L.ka(!0),L}));this._nodePromiseLODs[U]=this._nodePromiseLODs[U]||[],0===U?G=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[U].push(a))}return this._loader.logClose(),await G}))}_loadMaterialAsync(L,U,x,mL,p){return this._nodeIndexLOD?null:c.LoadExtensionAsync(L,U,this.name,(async(L,G)=>{let F;const a=this._getLODs(L,U,this._loader.ba.materials,G.ids);this._loader.logOpen(`${L}`);for(let U=0;U<a.length;U++){const L=a[U];0!==U&&(this._materialIndexLOD=U);const G=this._loader._loadMaterialAsync(`/materials/${L.index}`,L,x,mL,(L=>{0===U&&p(L)})).then((L=>{if(0!==U){p(L);const x=a[U-1]._data;x[mL]&&(this._disposeMaterials([x[mL].babylonMaterial]),delete x[mL])}return L}));this._materialPromiseLODs[U]=this._materialPromiseLODs[U]||[],0===U?F=G:(this._materialIndexLOD=null,this._materialPromiseLODs[U].push(G))}return this._loader.logClose(),await F}))}_loadUriAsync(L,U,x){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const p=this._nodeIndexLOD-1;return this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new mL,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(L,U,x)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const p=this._materialIndexLOD-1;return this._materialSignalLODs[p]=this._materialSignalLODs[p]||new mL,this._materialSignalLODs[p].promise.then((async()=>await this._loader.loadUriAsync(L,U,x)))}return null}loadBufferAsync(L,U,x,p){if(this._loader.parent.useRangeRequests&&!U.uri){if(!this._loader.bin)throw new Error(`${L}: Uri is missing or the binary glTF is missing its binary chunk`);const U=async(L,U)=>{const G=x,F=G+p-1;let a=L[U];return a?(a.start=Math.min(a.start,G),a.end=Math.max(a.end,F)):(a={start:G,end:F,loaded:new mL},L[U]=a),await a.loaded.promise.then((L=>new Uint8Array(L.buffer,L.byteOffset+x-a.start,p)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?U(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?U(this._materialBufferLODs,this._materialIndexLOD):U(this._bufferLODs,0)}return null}_loadBufferLOD(L,U){const x=L[U];x&&(this._loader.log(`Loading buffer range [${x.start}-${x.end}]`),this._loader.bin.readAsync(x.start,x.end-x.start+1).then((L=>{x.loaded.resolve(L)}),(L=>{x.loaded.reject(L)})))}_getLODs(L,U,x,mL){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const p=[];for(let G=mL.length-1;G>=0;G--)if(p.push(j.Get(`${L}/ids/${mL[G]}`,x,mL[G])),p.length===this.maxLODsToLoad)return p;return p.push(U),p}_disposeTransformNode(L){const U=[],x=L.material;x&&U.push(x);for(const p of L.getChildMeshes())p.material&&U.push(p.material);L.dispose();const mL=U.filter((L=>this._loader.babylonScene.meshes.every((U=>U.material!=L))));this._disposeMaterials(mL)}_disposeMaterials(L){const U={};for(const x of L){for(const L of x.getActiveTextures())U[L.uniqueId]=L;x.dispose()}for(const x in U)for(const L of this._loader.babylonScene.materials)L.hasTexture(U[x])&&delete U[x];for(const x in U)U[x].dispose()}}g(ox),Z(ox,!0,(L=>new Ax(L)));const rx="MSFT_minecraftMesh";class hx{constructor(L){this.name=rx,this._loader=L,this.enabled=this._loader.isExtensionUsed(rx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtraAsync(L,U,this.name,(async(mL,p)=>{if(p){if(!(x instanceof q.d))throw new Error(`${mL}: Material type not supported`);const p=this._loader.loadMaterialPropertiesAsync(L,U,x);return x.needAlphaBlending()&&(x.forceDepthWrite=!0,x.separateCullingPass=!0),x.Pa=x.forceDepthWrite,x.twoSidedLighting=!0,await p}}))}}g(rx),Z(rx,!0,(L=>new hx(L)));const bx="MSFT_sRGBFactors";class Ex{constructor(L){this.name=bx,this._loader=L,this.enabled=this._loader.isExtensionUsed(bx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,U,x){return c.LoadExtraAsync(L,U,this.name,(async(mL,p)=>{if(p){if(!(x instanceof q.d))throw new Error(`${mL}: Material type not supported`);const p=this._loader.loadMaterialPropertiesAsync(L,U,x),G=x.PL().getEngine().useExactSrgbConversions;return x.albedoTexture||x.albedoColor.toLinearSpaceToRef(x.albedoColor,G),x.reflectivityTexture||x.reflectivityColor.toLinearSpaceToRef(x.reflectivityColor,G),await p}}))}}g(bx),Z(bx,!0,(L=>new Ex(L)));var Yx=x(14336);const Sx={};var Vx=x(14388),Hx=x(14362),Qx=x(14339),qx=x(14348);function fx(L,U){for(const x of L)for(const L of x.dataOutputs)if(L.uniqueId===U)return L;throw new Error("Could not find data out connection with unique id "+U)}function vx(L,U){for(const x of L)if(x instanceof Hx.d)for(const L of x.signalInputs)if(L.uniqueId===U)return L;throw new Error("Could not find signal in connection with unique id "+U)}async function Dx(L,U){const mL=await Promise.all(L.allBlocks.map((async L=>{const U=function(L){switch(L){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([x.e(78),x.e(79)]).then(x.bind(x,15810))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await x.e(80).then(x.bind(x,15817))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await x.e(81).then(x.bind(x,15826))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await x.e(82).then(x.bind(x,15834))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await x.e(83).then(x.bind(x,15837))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await x.e(84).then(x.bind(x,15846))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await x.e(85).then(x.bind(x,15848))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await x.e(86).then(x.bind(x,15852))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await x.e(87).then(x.bind(x,15861))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await x.e(90).then(x.bind(x,15891))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await x.e(90).then(x.bind(x,15891))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await x.e(90).then(x.bind(x,15891))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await x.e(90).then(x.bind(x,15891))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await x.e(95).then(x.bind(x,15898))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await x.e(96).then(x.bind(x,15907))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await x.e(97).then(x.bind(x,15914))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await x.e(98).then(x.bind(x,15916))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await x.e(99).then(x.bind(x,15922))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await x.e(100).then(x.bind(x,15930))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await x.e(101).then(x.bind(x,15933))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await x.e(102).then(x.bind(x,15935))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await x.e(103).then(x.bind(x,15943))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await x.e(104).then(x.bind(x,15945))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await x.e(105).then(x.bind(x,15951))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await x.e(106).then(x.bind(x,15958))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await x.e(107).then(x.bind(x,15962))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await x.e(108).then(x.bind(x,15965))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await x.e(109).then(x.bind(x,15974))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await x.e(110).then(x.bind(x,15976))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await x.e(111).then(x.bind(x,15985))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await x.e(112).then(x.bind(x,15990))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await x.e(113).then(x.bind(x,15996))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await x.e(92).then(x.bind(x,16001))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await x.e(114).then(x.bind(x,16005))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await x.e(115).then(x.bind(x,16012))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await x.e(116).then(x.bind(x,16017))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await x.e(93).then(x.bind(x,16023))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await x.e(88).then(x.bind(x,15869))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await x.e(94).then(x.bind(x,16027))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await x.e(89).then(x.bind(x,15887))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await x.e(90).then(x.bind(x,15891))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await x.e(90).then(x.bind(x,15891))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await x.e(91).then(x.bind(x,16034))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await x.e(91).then(x.bind(x,16034))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await x.e(91).then(x.bind(x,16034))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await x.e(91).then(x.bind(x,16034))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await x.e(91).then(x.bind(x,16034))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await x.e(91).then(x.bind(x,16034))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await x.e(117).then(x.bind(x,16037))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await x.e(118).then(x.bind(x,16044))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await x.e(119).then(x.bind(x,16049))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await x.e(120).then(x.bind(x,16055))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await x.e(121).then(x.bind(x,16058))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await x.e(122).then(x.bind(x,16062))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await x.e(123).then(x.bind(x,16065))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await x.e(124).then(x.bind(x,16067))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await x.e(125).then(x.bind(x,16073))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await x.e(126).then(x.bind(x,16077))).FlowGraphDataSwitchBlock;default:if(Sx[L])return Sx[L];throw new Error(`Unknown block name ${L}`)}}(L.className);return await U()})));return function(L,U,x){const mL=U.coordinator.createGraph(),p=[],G=U.valueParseFunction??Qx.b;for(let F=0;F<L.allBlocks.length;F++){const a=dx(L.allBlocks[F],{VU:U.coordinator.config.VU,pathConverter:U.pathConverter,assetsContainer:U.coordinator.config.VU,valueParseFunction:G},x[F]);p.push(a),a instanceof Vx.e&&mL.addEventBlock(a)}for(const F of p){for(const L of F.dataInputs)for(const U of L.connectedPointIds){const x=fx(p,U);L.connectTo(x)}if(F instanceof Hx.d)for(const L of F.signalOutputs)for(const U of L.connectedPointIds){const x=vx(p,U);L.connectTo(x)}}for(const F of L.executionContexts)Px(F,{graph:mL,valueParseFunction:G},L.rightHanded);return mL}(L,U,mL)}function Px(L,U,x){const mL=U.graph.createContext();L.enableLogging&&(mL.enableLogging=!0),mL.treatDataAsRightHanded=x||!1;const p=U.valueParseFunction??Qx.b;mL.uniqueId=L.uniqueId;const G=mL.PL();if(L._assetsContext){var F,a,o,A,r,h,b,E,Y,S;const U=L._assetsContext,x={meshes:null===(F=U.meshes)||void 0===F?void 0:F.map((L=>G.getMeshById(L))),lights:null===(a=U.lights)||void 0===a?void 0:a.map((L=>G.getLightByName(L))),cameras:null===(o=U.cameras)||void 0===o?void 0:o.map((L=>G.getCameraByName(L))),materials:null===(A=U.materials)||void 0===A?void 0:A.map((L=>G.getMaterialById(L))),textures:null===(r=U.textures)||void 0===r?void 0:r.map((L=>G.getTextureByName(L))),animations:null===(h=U.animations)||void 0===h?void 0:h.map((L=>G.animations.find((U=>U.name===L)))),skeletons:null===(b=U.skeletons)||void 0===b?void 0:b.map((L=>G.getSkeletonByName(L))),fE:null===(E=U.fE)||void 0===E?void 0:E.map((L=>G.getParticleSystemById(L))),animationGroups:null===(Y=U.animationGroups)||void 0===Y?void 0:Y.map((L=>G.getAnimationGroupByName(L))),transformNodes:null===(S=U.transformNodes)||void 0===S?void 0:S.map((L=>G.getTransformNodeById(L))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],UY:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};mL.assetsContext=x}for(const V in L._userVariables){const U=p(V,L._userVariables,mL.assetsContext,G);mL.userVariables[V]=U}for(const V in L._connectionValues){const U=p(V,L._connectionValues,mL.assetsContext,G);mL._setConnectionValueByKey(V,U)}return mL}function dx(L,U,x){const mL={},p=U.valueParseFunction??Qx.b;if(L.config)for(const F in L.config)mL[F]=p(F,L.config,U.assetsContainer||U.VU,U.VU);if((0,Qx.f)(L.className)){if(!U.pathConverter)throw new Error("Path converter is required for this block");mL.pathConverter=U.pathConverter}const G=new x(mL);G.uniqueId=L.uniqueId;for(let F=0;F<L.dataInputs.length;F++){const U=G.getDataInput(L.dataInputs[F].name);if(!U)throw new Error("Could not find data input with name "+L.dataInputs[F].name+" in block "+L.className);U.deserialize(L.dataInputs[F])}for(let F=0;F<L.dataOutputs.length;F++){const U=G.getDataOutput(L.dataOutputs[F].name);if(!U)throw new Error("Could not find data output with name "+L.dataOutputs[F].name+" in block "+L.className);U.deserialize(L.dataOutputs[F])}return G.metadata=L.metadata,G.deserialize&&G.deserialize(L),G}function Kx(L){const[U,x]=L.split(":");return lx({op:U,extension:x})}function lx(L){var U;let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const mL=L.extension?null===(U=Xx[L.extension])||void 0===U?void 0:U[L.op]:tx[L.op];if(!mL&&(S.c.Warn(`No mapping found for operation ${L.op} and extension ${L.extension||"KHR_interactivity"}`),x)){const U={},x={flows:{}};if(L.inputValueSockets){U.values={};for(const x in L.inputValueSockets)U.values[x]={name:x}}return L.outputValueSockets&&(x.values={},Object.keys(L.outputValueSockets).forEach((L=>{x.values[L]={name:L}}))),{lr:[],inputs:U,outputs:x}}return mL}function ix(L,U,x){Xx[U]||(Xx[U]={}),Xx[U][L]=x}const Xx={BABYLON:{"flow/log":{lr:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},tx={"event/onStart":{lr:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{lr:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{lr:["FlowGraphSendCustomEventBlock"],extraProcessor(L,U,x,mL,p){if("event/send"!==U.op||!L.configuration||1!==Object.keys(L.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const G=L.configuration.event.value[0];if("number"!==typeof G)throw new Error("Event id should be a number");const F=mL.arrays.events[G],a=p[0];return a.config||(a.config={}),a.config.eventId=F.eventId,a.config.eventData=F.eventData,p}},"event/receive":{lr:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(L,U){var x;if(!L.configuration)return S.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const mL=L.configuration.event;if(!mL)return S.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const p=mL.value[0];if("number"!==typeof p)return S.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(x=U.events)||void 0===x?void 0:x[p])?{valid:!0}:(S.c.Error(`Event with id ${p} not found`),{valid:!1,error:`Event with id ${p} not found`})},extraProcessor(L,U,x,mL,p){if("event/receive"!==U.op||!L.configuration||1!==Object.keys(L.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const G=L.configuration.event.value[0];if("number"!==typeof G)throw new Error("Event id should be a number");const F=mL.arrays.events[G],a=p[0];return a.config||(a.config={}),a.config.eventId=F.eventId,a.config.eventData=F.eventData,p}},"math/e":yx("FlowGraphEBlock"),"math/pi":yx("FlowGraphPIBlock"),"math/inf":yx("FlowGraphInfBlock"),"math/nan":yx("FlowGraphNaNBlock"),"math/abs":yx("FlowGraphAbsBlock"),"math/sign":yx("FlowGraphSignBlock"),"math/trunc":yx("FlowGraphTruncBlock"),"math/floor":yx("FlowGraphFloorBlock"),"math/ceil":yx("FlowGraphCeilBlock"),"math/round":{lr:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p){var G;return(G=p[0]).config||(G.config={}),p[0].config.roundHalfAwayFromZero=!0,p}},"math/fract":yx("FlowGraphFractBlock"),"math/neg":yx("FlowGraphNegationBlock"),"math/add":yx("FlowGraphAddBlock",["a","b"],!0),"math/sub":yx("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{lr:["FlowGraphMultiplyBlock"],extraProcessor(L,U,x,mL,p){var G;(G=p[0]).config||(G.config={}),p[0].config.useMatrixPerComponent=!0,p[0].config.preventIntegerFloatArithmetic=!0;let F=-1;return Object.keys(L.values||{}).find((U=>{var x;return void 0!==(null===(x=L.values)||void 0===x?void 0:x[U].type)&&(F=L.values[U].type,!0)})),-1!==F&&(p[0].config.type=mL.arrays.types[F].flowGraphType),p},validation:L=>L.values?nx(L):{valid:!0}},"math/div":yx("FlowGraphDivideBlock",["a","b"],!0),"math/rem":yx("FlowGraphModuloBlock",["a","b"]),"math/min":yx("FlowGraphMinBlock",["a","b"]),"math/max":yx("FlowGraphMaxBlock",["a","b"]),"math/clamp":yx("FlowGraphClampBlock",["a","b","c"]),"math/saturate":yx("FlowGraphSaturateBlock"),"math/mix":yx("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":yx("FlowGraphEqualityBlock",["a","b"]),"math/lt":yx("FlowGraphLessThanBlock",["a","b"]),"math/le":yx("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":yx("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":yx("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":yx("FlowGraphIsNaNBlock"),"math/isinf":yx("FlowGraphIsInfBlock"),"math/select":{lr:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{lr:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":yx("FlowGraphSinBlock"),"math/cos":yx("FlowGraphCosBlock"),"math/tan":yx("FlowGraphTanBlock"),"math/asin":yx("FlowGraphASinBlock"),"math/acos":yx("FlowGraphACosBlock"),"math/atan":yx("FlowGraphATanBlock"),"math/atan2":yx("FlowGraphATan2Block",["a","b"]),"math/sinh":yx("FlowGraphSinhBlock"),"math/cosh":yx("FlowGraphCoshBlock"),"math/tanh":yx("FlowGraphTanhBlock"),"math/asinh":yx("FlowGraphASinhBlock"),"math/acosh":yx("FlowGraphACoshBlock"),"math/atanh":yx("FlowGraphATanhBlock"),"math/exp":yx("FlowGraphExponentialBlock"),"math/log":yx("FlowGraphLogBlock"),"math/log2":yx("FlowGraphLog2Block"),"math/log10":yx("FlowGraphLog10Block"),"math/sqrt":yx("FlowGraphSquareRootBlock"),"math/cbrt":yx("FlowGraphCubeRootBlock"),"math/pow":yx("FlowGraphPowerBlock",["a","b"]),"math/length":yx("FlowGraphLengthBlock"),"math/normalize":yx("FlowGraphNormalizeBlock"),"math/dot":yx("FlowGraphDotBlock",["a","b"]),"math/cross":yx("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":yx("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":yx("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{lr:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{lr:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{lr:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{lr:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{lr:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{lr:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{lr:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":yx("FlowGraphTransposeBlock"),"math/determinant":yx("FlowGraphDeterminantBlock"),"math/inverse":yx("FlowGraphInvertMatrixBlock"),"math/matmul":yx("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{lr:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ka",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p,G){const F=p[0].dataInputs.find((L=>"rotationQuaternion"===L.name));if(!F)throw new Error("Rotation quaternion input not found");return G._connectionValues[F.uniqueId]&&(G._connectionValues[F.uniqueId].type="Quaternion"),p}},"math/matDecompose":{lr:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ka"}}}},"math/quatConjugate":yx("FlowGraphConjugateBlock",["a"]),"math/quatMul":{lr:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p){var G;return(G=p[0]).config||(G.config={}),p[0].config.type="Quaternion",p}},"math/quatAngleBetween":yx("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{lr:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":yx("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":yx("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{lr:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p){var G;return(G=p[0]).config||(G.config={}),p[0].config.inputIsColumnMajor=!0,p}},"math/extract2x2":{lr:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{lr:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p){var G;return(G=p[0]).config||(G.config={}),p[0].config.inputIsColumnMajor=!0,p}},"math/extract3x3":{lr:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{lr:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p){var G;return(G=p[0]).config||(G.config={}),p[0].config.inputIsColumnMajor=!0,p}},"math/extract4x4":{lr:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{lr:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p,G){var F,a;(a=p[0]).config||(a.config={});const o=p[0].dataInputs[0];return p[0].config.valueType=(null===(F=G._connectionValues[o.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",p}},"math/and":{lr:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p,G){var F,a,o;(o=p[0]).config||(o.config={});const A=p[0].dataInputs[0],r=p[0].dataInputs[1];return p[0].config.valueType=(null===(F=G._connectionValues[A.uniqueId])||void 0===F?void 0:F.type)??(null===(a=G._connectionValues[r.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",p}},"math/or":{lr:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p,G){var F,a,o;(o=p[0]).config||(o.config={});const A=p[0].dataInputs[0],r=p[0].dataInputs[1];return p[0].config.valueType=(null===(F=G._connectionValues[A.uniqueId])||void 0===F?void 0:F.type)??(null===(a=G._connectionValues[r.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",p}},"math/xor":{lr:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,U,x,mL,p,G){var F,a,o;(o=p[0]).config||(o.config={});const A=p[0].dataInputs[0],r=p[0].dataInputs[1];return p[0].config.valueType=(null===(F=G._connectionValues[A.uniqueId])||void 0===F?void 0:F.type)??(null===(a=G._connectionValues[r.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",p}},"math/asr":yx("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":yx("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":yx("FlowGraphLeadingZerosBlock"),"math/ctz":yx("FlowGraphTrailingZerosBlock"),"math/popcnt":yx("FlowGraphOneBitsCounterBlock"),"math/rad":yx("FlowGraphDegToRadBlock"),"math/deg":yx("FlowGraphRadToDegBlock"),"type/boolToInt":yx("FlowGraphBooleanToInt"),"type/boolToFloat":yx("FlowGraphBooleanToFloat"),"type/intToBool":yx("FlowGraphIntToBoolean"),"type/intToFloat":yx("FlowGraphIntToFloat"),"type/floatToInt":yx("FlowGraphFloatToInt"),"type/floatToBool":yx("FlowGraphFloatToBoolean"),"flow/sequence":{lr:["FlowGraphSequenceBlock"],extraProcessor(L,U,x,mL,p){const G=p[0];return G.config||(G.config={}),G.config.outputSignalCount=Object.keys(L.flows||[]).length,G.signalOutputs.forEach(((L,U)=>{L.name="out_"+U})),p}},"flow/branch":{lr:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{lr:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(L){if(L.configuration&&L.configuration.cases){const U=L.configuration.cases.value;if(!U.every((L=>"number"===typeof L&&/^-?\d+$/.test(L.toString()))))return S.c.Warn("Switch cases should be integers. Using empty array instead."),L.configuration.cases.value=[],{valid:!0};const x=new Set(U);L.configuration.cases.value=Array.from(x)}return{valid:!0}},extraProcessor(L,U,x,mL,p){if("flow/switch"!==U.op||!L.flows||0===Object.keys(L.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return p[0].signalOutputs.forEach((L=>{"default"!==L.name&&(L.name="out_"+L.name)})),p}},"flow/while":{lr:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{lr:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(L,U,x,mL,p){const G=p[0];return G.config||(G.config={}),G.config.incrementIndexWhenLoopDone=!0,p}},"flow/doN":{lr:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{lr:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(L,U,x,mL,p){if("flow/multiGate"!==U.op||!L.flows||0===Object.keys(L.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const G=p[0];return G.config||(G.config={}),G.config.outputSignalCount=Object.keys(L.flows).length,G.signalOutputs.forEach(((L,U)=>{L.name="out_"+U})),p}},"flow/waitAll":{lr:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(L){var U,x;return"number"!==typeof(null===(U=L.configuration)||void 0===U||null===(x=U.inputFlows)||void 0===x?void 0:x.value[0])&&(L.configuration=L.configuration||{inputFlows:{value:[0]}},L.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{lr:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{lr:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{lr:["FlowGraphCancelDelayBlock"]},"variable/get":{lr:["FlowGraphGetVariableBlock"],validation(L){var U,x;return null!==(U=L.configuration)&&void 0!==U&&null!==(x=U.variable)&&void 0!==x&&x.value?{valid:!0}:(S.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(L,U)=>[U.getVariableName(L[0])]}}},"variable/set":{lr:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(L,U)=>[U.getVariableName(L[0])]}}},"variable/setMultiple":{lr:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(L,U)=>[L[0].map((L=>U.getVariableName(L)))]}},extraProcessor:(L,U,x,mL,p)=>(p[0].dataInputs.forEach((L=>{L.name=mL.getVariableName(+L.name)})),p)},"variable/interpolate":{lr:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(L,U)=>[U.getVariableName(L[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:L=>!0===L[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",vx:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",vx:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",vx:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",vx:"FlowGraphPlayAnimationBlock"},out:{name:"out",vx:"FlowGraphPlayAnimationBlock"},done:{name:"done",vx:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(L,U,x,mL,p){var G,F,a;const o=p[0],A=null===(G=L.configuration)||void 0===G?void 0:G.variable.value[0];if("number"!==typeof A)throw S.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const r=mL.arrays.staticVariables[A];"undefined"===typeof o.config.animationType.value&&(mL.arrays.staticVariables,o.config.animationType.value=(0,qx.F)(r.type));const h=p[4];return h.config||(h.config={}),(F=h.config).variable||(F.variable={}),h.config.variable.value=mL.getVariableName(A),(a=p[3]).config||(a.config={}),p}},"pointer/get":{lr:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",vx:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",vx:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,U,x,mL,p)=>(p.forEach((L=>{"FlowGraphJsonPointerParserBlock"===L.className&&(L.config||(L.config={}),L.config.outputValue=!0)})),p)},"pointer/set":{lr:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",vx:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",vx:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,U,x,mL,p)=>(p.forEach((L=>{"FlowGraphJsonPointerParserBlock"===L.className&&(L.config||(L.config={}),L.config.outputValue=!0)})),p)},"pointer/interpolate":{lr:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",vx:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",vx:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",vx:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",vx:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",vx:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",vx:"FlowGraphPlayAnimationBlock"},out:{name:"out",vx:"FlowGraphPlayAnimationBlock"},done:{name:"done",vx:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,U,x,mL,p)=>(p.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className?(U.config||(U.config={}),U.config.outputValue=!0):"FlowGraphInterpolationBlock"===U.className&&(U.config||(U.config={}),Object.keys(L.values||[]).forEach((x=>{var p;const G=null===(p=L.values)||void 0===p?void 0:p[x];if("value"===x&&G){const L=G.type;void 0!==L&&(U.config.animationType=mL.arrays.types[L].flowGraphType)}})))})),p)},"animation/start":{lr:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",vx:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(L,U)=>[L[0]*U._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(L,U)=>[L[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,U,x,mL,p,G,F){const a=p[p.length-1];return a.config||(a.config={}),a.config.glTF=F,p}},"animation/stop":{lr:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",vx:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,U,x,mL,p,G,F){const a=p[p.length-1];return a.config||(a.config={}),a.config.glTF=F,p}},"animation/stopAt":{lr:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",vx:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(L,U)=>[L[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,U,x,mL,p,G,F){const a=p[p.length-1];return a.config||(a.config={}),a.config.glTF=F,p}},"math/switch":{lr:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(L){if(L.configuration&&L.configuration.cases){const U=L.configuration.cases.value;if(!U.every((L=>"number"===typeof L&&/^-?\d+$/.test(L.toString()))))return S.c.Warn("Switch cases should be integers. Using empty array instead."),L.configuration.cases.value=[],{valid:!0};const x=new Set(U);L.configuration.cases.value=Array.from(x)}return{valid:!0}},extraProcessor(L,U,x,mL,p){const G=p[0];return G.dataInputs.forEach((L=>{"default"!==L.name&&"case"!==L.name&&(L.name="in_"+L.name)})),G.config||(G.config={}),G.config.treatCasesAsIntegers=!0,p}},"debug/log":{lr:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function yx(L){let U=arguments.length>2?arguments[2]:void 0;return{lr:[L],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((L,U)=>(L[U]={name:U},L)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(L,x,mL,p,G){var F;if(U){(F=G[0]).config||(F.config={}),G[0].config.preventIntegerFloatArithmetic=!0;let U=-1;Object.keys(L.values||{}).find((x=>{var mL;return void 0!==(null===(mL=L.values)||void 0===mL?void 0:mL[x].type)&&(U=L.values[x].type,!0)})),-1!==U&&(G[0].config.type=p.arrays.types[U].flowGraphType)}return G},validation:L=>U?nx(L):{valid:!0}}}function nx(L){if(L.values){const U=Object.keys(L.values).map((U=>L.values[U].type)).filter((L=>void 0!==L));if(!U.every((L=>L===U[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}tx["math/compose"]=tx["math/matCompose"],tx["math/decompose"]=tx["math/matDecompose"];var Nx=x(12550);const ex={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"YU",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ux{constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=L,this._gltf=U,this._animationTargetFps=x,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const L of this._interactivityGraph.types)this._types.push(ex[L.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const L of this._interactivityGraph.declarations){const U=lx(L);if(!U)throw S.c.Error(["No mapping found for declaration",L]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:U,fullOperationName:L.extension?L.op+":"+L.extension:L.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const L of this._interactivityGraph.variables){const U=this._parseVariable(L);this._staticVariables.push(U)}}_parseVariable(L,U){const x=this._types[L.type];if(!x)throw S.c.Error(["No type found for variable",L]),new Error("Error parsing variables");if(L.value&&L.value.length!==x.length)throw S.c.Error(["Invalid value length for variable",L,x]),new Error("Error parsing variables");const mL=L.value||[];if(!mL.length)switch(x.flowGraphType){case"boolean":mL.push(!1);break;case"FlowGraphInteger":mL.push(0);break;case"number":mL.push(NaN);break;case"Vector2":mL.push(NaN,NaN);break;case"YU":mL.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":mL.fill(NaN,0,4);break;case"Matrix":mL.fill(NaN,0,16);break;case"Matrix3D":mL.fill(NaN,0,9)}return"number"===x.elementType&&"string"===typeof mL[0]&&(mL[0]=parseFloat(mL[0])),{type:x.flowGraphType,value:U?U(mL,this):mL}}_parseEvents(){if(this._interactivityGraph.events)for(const L of this._interactivityGraph.events){const U={eventId:L.id||"internalEvent_"+this._internalEventsCounter++};L.values&&(U.eventData=Object.keys(L.values).map((U=>{var x;const mL=null===(x=L.values)||void 0===x?void 0:x[U];if(!mL)throw S.c.Error(["No value found for event key",U]),new Error("Error parsing events");const p=this._types[mL.type];if(!p)throw S.c.Error(["No type found for event value",mL]),new Error("Error parsing events");const G="undefined"!==typeof mL.value?this._parseVariable(mL):void 0;return{id:U,type:p.flowGraphType,eventData:!0,value:G}}))),this._events.push(U)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const U of this._interactivityGraph.nodes){if("number"!==typeof U.declaration)throw S.c.Error(["No declaration found for node",U]),new Error("Error parsing nodes");const x=this._mappings[U.declaration];if(!x)throw S.c.Error(["No mapping found for node",U]),new Error("Error parsing nodes");if(x.flowGraphMapping.validation){const mL=x.flowGraphMapping.validation(U,this._interactivityGraph,this._gltf);var L;if(!mL.valid)throw new Error(`Error validating interactivity node ${null===(L=this._interactivityGraph.declarations)||void 0===L?void 0:L[U.declaration].op} - ${mL.error}`)}const mL=[];for(const L of x.flowGraphMapping.lr){const p=this._getEmptyBlock(L,x.fullOperationName);this._parseNodeConfiguration(U,p,x.flowGraphMapping,L),mL.push(p)}this._nodes.push({lr:mL,fullOperationName:x.fullOperationName})}}_getEmptyBlock(L,U){return{uniqueId:(0,Nx.b)(),className:L,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:U,metadata:{}}}_parseNodeConfiguration(L,U,x,mL){const p=U.config;if(L.configuration){const U=Object.keys(L.configuration);for(const a of U){var G,F;const U=null===(G=L.configuration)||void 0===G?void 0:G[a];if(!U)throw S.c.Error(["No value found for node configuration",a]),new Error("Error parsing node configuration");const o=null===(F=x.configuration)||void 0===F?void 0:F[a];if(o&&o.vx?o.vx===mL:0===x.lr.indexOf(mL)){const L=(null===o||void 0===o?void 0:o.name)||a;U&&"undefined"!==typeof U.value||"undefined"===typeof(null===o||void 0===o?void 0:o.defaultValue)?U.value.length>=0?p[L]={value:1===U.value.length?U.value[0]:U.value}:S.c.Warn(["Invalid value for node configuration",U]):p[L]={value:o.defaultValue},o&&o.dataTransformer&&(p[L].value=o.dataTransformer([p[L].value],this)[0])}}}}_parseNodeConnections(L){for(let D=0;D<this._nodes.length;D++){var U;const P=null===(U=this._interactivityGraph.nodes)||void 0===U?void 0:U[D];if(!P)throw S.c.Error(["No node found for interactivity node",this._nodes[D]]),new Error("Error parsing node connections");const d=this._nodes[D],K=this._mappings[P.declaration];if(!K)throw S.c.Error(["No mapping found for node",P]),new Error("Error parsing node connections");const l=P.flows||{},i=Object.keys(l).sort();for(const L of i){var x,mL,p,G;const U=l[L],A=null===(x=K.flowGraphMapping.outputs)||void 0===x||null===(mL=x.flows)||void 0===mL?void 0:mL[L],r=(null===A||void 0===A?void 0:A.name)||L,h=this._createNewSocketConnection(r,!0);(A&&A.vx&&d.lr.find((L=>L.className===A.vx))||d.lr[0]).signalOutputs.push(h);const b=U.node,E=this._nodes[b];if(!E)throw S.c.Error(["No node found for input node id",b]),new Error("Error parsing node connections");const Y=Kx(E.fullOperationName);if(!Y)throw S.c.Error(["No mapping found for input node",E]),new Error("Error parsing node connections");let V=null===(p=Y.inputs)||void 0===p||null===(G=p.flows)||void 0===G?void 0:G[U.socket||"in"],H=!1;if(!V)for(const L in null===(F=Y.inputs)||void 0===F?void 0:F.flows){var F,a,o;if(L.startsWith("[")&&L.endsWith("]"))H=!0,V=null===(a=Y.inputs)||void 0===a||null===(o=a.flows)||void 0===o?void 0:o[L]}const Q=V?H?V.name.replace("$1",U.socket||""):V.name:U.socket||"in",q=V&&V.vx&&E.lr.find((L=>L.className===V.vx))||E.lr[0];let f=q.signalInputs.find((L=>L.name===Q));f||(f=this._createNewSocketConnection(Q),q.signalInputs.push(f)),f.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(f.uniqueId)}const X=P.values||{},t=Object.keys(X);for(const U of t){var A,r;const x=X[U];let mL=null===(A=K.flowGraphMapping.inputs)||void 0===A||null===(r=A.values)||void 0===r?void 0:r[U],p=!1;if(!mL)for(const L in null===(h=K.flowGraphMapping.inputs)||void 0===h?void 0:h.values){var h,b,E;if(L.startsWith("[")&&L.endsWith("]"))p=!0,mL=null===(b=K.flowGraphMapping.inputs)||void 0===b||null===(E=b.values)||void 0===E?void 0:E[L]}const G=mL?p?mL.name.replace("$1",U):mL.name:U,F=this._createNewSocketConnection(G);if((mL&&mL.vx&&d.lr.find((L=>L.className===mL.vx))||d.lr[0]).dataInputs.push(F),void 0!==x.value){const U=this._parseVariable(x,mL&&mL.dataTransformer);L._connectionValues[F.uniqueId]=U}else{if("undefined"===typeof x.node)throw S.c.Error(["Invalid value for value connection",x]),new Error("Error parsing node connections");{var Y,V,H;const L=x.node,U=x.socket||"value",mL=this._nodes[L];if(!mL)throw S.c.Error(["No node found for output socket reference",x]),new Error("Error parsing node connections");const p=Kx(mL.fullOperationName);if(!p)throw S.c.Error(["No mapping found for output socket reference",x]),new Error("Error parsing node connections");let G=null===(Y=p.outputs)||void 0===Y||null===(V=Y.values)||void 0===V?void 0:V[U],a=!1;if(!G)for(const x in null===(Q=p.outputs)||void 0===Q?void 0:Q.values){var Q,q,f;if(x.startsWith("[")&&x.endsWith("]"))a=!0,G=null===(q=p.outputs)||void 0===q||null===(f=q.values)||void 0===f?void 0:f[x]}const o=G?a?G.name.replace("$1",U):null===(H=G)||void 0===H?void 0:H.name:U,A=G&&G.vx&&mL.lr.find((L=>L.className===G.vx))||mL.lr[0];let r=A.dataOutputs.find((L=>L.name===o));r||(r=this._createNewSocketConnection(o,!0),A.dataOutputs.push(r)),F.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(F.uniqueId)}}}if(K.flowGraphMapping.interBlockConnectors)for(const L of K.flowGraphMapping.interBlockConnectors){const U=L.input,x=L.output,mL=L.isVariable;this._connectFlowGraphNodes(U,x,d.lr[L.inputBlockIndex],d.lr[L.outputBlockIndex],mL)}if(K.flowGraphMapping.extraProcessor){var v;const U=null===(v=this._interactivityGraph.declarations)||void 0===v?void 0:v[P.declaration];if(!U)throw S.c.Error(["No declaration found for extra processor",P]),new Error("Error parsing node connections");d.lr=K.flowGraphMapping.extraProcessor(P,U,K.flowGraphMapping,this,d.lr,L,this._gltf)}}}_createNewSocketConnection(L,U){return{uniqueId:(0,Nx.b)(),name:L,_connectionType:U?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(L,U,x,mL,p){const G=p?x.dataInputs:x.signalInputs,F=p?mL.dataOutputs:mL.signalOutputs,a=G.find((U=>U.name===L))||this._createNewSocketConnection(L),o=F.find((L=>L.name===U))||this._createNewSocketConnection(U,!0);G.find((U=>U.name===L))||G.push(a),F.find((L=>L.name===U))||F.push(o),a.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(a.uniqueId)}getVariableName(L){return"staticVariable_"+L}serializeToFlowGraph(){const L={uniqueId:(0,Nx.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(L);for(let U=0;U<this._staticVariables.length;U++){const x=this._staticVariables[U];L._userVariables[this.getVariableName(U)]=x}return{rightHanded:!0,allBlocks:this._nodes.reduce(((L,U)=>L.concat(U.lr)),[]),executionContexts:[L]}}}const Zx="KHR_interactivity";class gx{constructor(L){this._loader=L,this.name=Zx,this.enabled=this._loader.isExtensionUsed(Zx),this._pathConverter=(0,z.j)(this._loader.ba),L._skipStartAnimationStep=!0;const U=L.babylonScene;U&&function(L){(0,z.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!L.activeCamera)return new p.Quaternion(NaN,NaN,NaN,NaN);const U=p.Quaternion.FromRotationMatrix(L.activeCamera.getWorldMatrix()).normalize();return L.useRightHandedSystem||(U.w*=-1,U.x*=-1),U},type:"Quaternion",getTarget:()=>L.activeCamera}),(0,z.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!L.activeCamera)return new p.YU(NaN,NaN,NaN);const U=L.activeCamera.getWorldMatrix().getTranslation();return L.useRightHandedSystem||(U.x*=-1),U},type:"YU",getTarget:()=>L.activeCamera}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:L=>{var U;return(null===(U=L._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)??!1},type:"boolean",getTarget:L=>L._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:L=>{var U;return((null===(U=L._babylonAnimationGroup)||void 0===U?void 0:U.from)??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:L=>{var U;return((null===(U=L._babylonAnimationGroup)||void 0===U?void 0:U.to)??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:L=>{var U;return((null===(U=L._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:L=>{var U;return((null===(U=L._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup})}(U)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var L;if(!this._loader.babylonScene||!this._pathConverter)return;const U=this._loader.babylonScene,x=null===(L=this._loader.ba.extensions)||void 0===L?void 0:L.KHR_interactivity;if(!x)return;const mL=new Yx.b({VU:U});mL.dispatchEventsSynchronously=!1;const p=x.graphs.map((L=>new ux(L,this._loader.ba,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(p.map((async L=>await Dx(L,{coordinator:mL,pathConverter:this._pathConverter})))),mL.start()}}var zx;zx=async()=>(await Promise.resolve().then(x.bind(x,14408))).FlowGraphGLTFDataProvider,Sx[`${Zx}/${"FlowGraphGLTFDataProvider"}`]=zx,g(Zx),Z(Zx,!0,(L=>new gx(L)));const Mx="KHR_node_visibility";(0,z.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:L=>{const U=L._babylonTransformNode;return!U||void 0===U.isVisible||U.isVisible},set:(L,U)=>{var x,mL;null===(x=U._primitiveBabylonMeshes)||void 0===x||x.forEach((L=>{L.inheritVisibility=!0})),U._babylonTransformNode&&(U._babylonTransformNode.isVisible=L),null===(mL=U._primitiveBabylonMeshes)||void 0===mL||mL.forEach((U=>{U.isVisible=L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Jx{constructor(L){this.name=Mx,this._loader=L,this.enabled=L.isExtensionUsed(Mx)}async onReady(){var L;null===(L=this._loader.ba.nodes)||void 0===L||L.forEach((L=>{var U,x,mL,p;(null===(U=L._primitiveBabylonMeshes)||void 0===U||U.forEach((L=>{L.inheritVisibility=!0})),null!==(x=L.extensions)&&void 0!==x&&x.KHR_node_visibility)&&(!1===(null===(mL=L.extensions)||void 0===mL?void 0:mL.KHR_node_visibility.visible)&&(L._babylonTransformNode&&(L._babylonTransformNode.isVisible=!1),null===(p=L._primitiveBabylonMeshes)||void 0===p||p.forEach((L=>{L.isVisible=!1}))))}))}dispose(){this._loader=null}}g(Mx),Z(Mx,!0,(L=>new Jx(L)));const jx="KHR_node_selectability";ix("event/onSelect",jx,{lr:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",vx:"FlowGraphGetVariableBlock",dataTransformer:L=>["pickedMesh_"+L[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",vx:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,U,x,mL,p,G,F){var a,o,A,r,h,b;const E=p[p.length-1];E.config=E.config||{},E.config.glTF=F;const Y=null===(a=L.configuration)||void 0===a||null===(o=a.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===Y||"number"!==typeof Y)throw new Error("nodeIndex not found in configuration");const S="pickedMesh_"+Y;return p[1].config.variable=S,G._userVariables[S]={className:"Mesh",id:null===F||void 0===F||null===(A=F.nodes)||void 0===A||null===(r=A[Y]._babylonTransformNode)||void 0===r?void 0:r.id,uniqueId:null===F||void 0===F||null===(h=F.nodes)||void 0===h||null===(b=h[Y]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},p}}),(0,z.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:L=>{const U=L._babylonTransformNode;return!U||void 0===U.Bo||U.Bo},set:(L,U)=>{var x;null===(x=U._primitiveBabylonMeshes)||void 0===x||x.forEach((U=>{U.Bo=L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"Bo"],type:"boolean"});class Rx{constructor(L){this.name=jx,this._loader=L,this.enabled=L.isExtensionUsed(jx)}async onReady(){var L;null===(L=this._loader.ba.nodes)||void 0===L||L.forEach((L=>{var U,x,mL;null!==(U=L.extensions)&&void 0!==U&&U.KHR_node_selectability&&!1===(null===(x=L.extensions)||void 0===x?void 0:x.KHR_node_selectability.selectable)&&(null===(mL=L._babylonTransformNode)||void 0===mL||mL.getChildMeshes().forEach((L=>{L.Bo=!1})))}))}dispose(){this._loader=null}}g(jx),Z(jx,!0,(L=>new Rx(L)));const cx="KHR_node_hoverability",Wx="targetMeshPointerOver_";ix("event/onHoverIn",cx,{lr:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",vx:"FlowGraphGetVariableBlock",dataTransformer:L=>[Wx+L[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",vx:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,U,x,mL,p,G,F){var a,o,A,r,h,b;const E=p[p.length-1];E.config=E.config||{},E.config.glTF=F;const Y=null===(a=L.configuration)||void 0===a||null===(o=a.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===Y||"number"!==typeof Y)throw new Error("nodeIndex not found in configuration");const S=Wx+Y;return p[1].config.variable=S,G._userVariables[S]={className:"Mesh",id:null===F||void 0===F||null===(A=F.nodes)||void 0===A||null===(r=A[Y]._babylonTransformNode)||void 0===r?void 0:r.id,uniqueId:null===F||void 0===F||null===(h=F.nodes)||void 0===h||null===(b=h[Y]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},p}});const Ix="targetMeshPointerOut_";ix("event/onHoverOut",cx,{lr:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",vx:"FlowGraphGetVariableBlock",dataTransformer:L=>[Ix+L[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",vx:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,U,x,mL,p,G,F){var a,o,A,r,h,b;const E=p[p.length-1];E.config=E.config||{},E.config.glTF=F;const Y=null===(a=L.configuration)||void 0===a||null===(o=a.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===Y||"number"!==typeof Y)throw new Error("nodeIndex not found in configuration");const S=Ix+Y;return p[1].config.variable=S,G._userVariables[S]={className:"Mesh",id:null===F||void 0===F||null===(A=F.nodes)||void 0===A||null===(r=A[Y]._babylonTransformNode)||void 0===r?void 0:r.id,uniqueId:null===F||void 0===F||null===(h=F.nodes)||void 0===h||null===(b=h[Y]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},p}}),(0,z.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:L=>{const U=L._babylonTransformNode;return!U||void 0===U.pointerOverDisableMeshTesting||U.pointerOverDisableMeshTesting},set:(L,U)=>{var x;null===(x=U._primitiveBabylonMeshes)||void 0===x||x.forEach((U=>{U.pointerOverDisableMeshTesting=!L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class wx{constructor(L){this.name=cx,this._loader=L,this.enabled=L.isExtensionUsed(cx)}async onReady(){var L;null===(L=this._loader.ba.nodes)||void 0===L||L.forEach((L=>{var U,x,mL;null!==(U=L.extensions)&&void 0!==U&&U.KHR_node_hoverability&&!1===(null===(x=L.extensions)||void 0===x?void 0:x.KHR_node_hoverability.hoverable)&&(null===(mL=L._babylonTransformNode)||void 0===mL||mL.getChildMeshes().forEach((L=>{L.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}g(cx),Z(cx,!0,(L=>new wx(L)));const Bx="ExtrasAsMetadata";class sx{_assignExtras(L,U){if(U.extras&&Object.keys(U.extras).length>0){const x=L.metadata=L.metadata||{};(x.ba=x.ba||{}).extras=U.extras}}constructor(L){this.name=Bx,this.enabled=!0,this._loader=L}dispose(){this._loader=null}loadNodeAsync(L,U,x){return this._loader.loadNodeAsync(L,U,(L=>{this._assignExtras(L,U),x(L)}))}loadCameraAsync(L,U,x){return this._loader.loadCameraAsync(L,U,(L=>{this._assignExtras(L,U),x(L)}))}createMaterial(L,U,x){const mL=this._loader.createMaterial(L,U,x);return this._assignExtras(mL,U),mL}}g(Bx),Z(Bx,!1,(L=>new sx(L)));x(14408)},14273:(L,U,x)=>{"use strict";x.d(U,{e:()=>n,g:()=>K,i:()=>d,l:()=>l});var mL=x(12391),p=x(12382),G=x(13916),F=x(13046),a=x(13015),o=x(13026),A=x(12406),r=x(12440),h=x(13042),b=x(13150),E=x(13052),Y=x(12632);class S{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.UY=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(L){this._environmentTexture=L}getNodes(){let L=[];L=L.concat(this.meshes),L=L.concat(this.lights),L=L.concat(this.cameras),L=L.concat(this.transformNodes);for(const U of this.skeletons)L=L.concat(U.bones);return L}}class V extends S{}class H{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const L=this.rootNodes;for(const mL of L)mL.dispose();L.length=0;const U=this.skeletons;for(const mL of U)mL.dispose();U.length=0;const x=this.animationGroups;for(const mL of x)mL.dispose();x.length=0}}class Q extends S{constructor(L){super(),this._wasAddedToScene=!1,(L=L||r.c.LastCreatedScene)&&(this.VU=L,this.proceduralTextures=[],L.oa.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=L.getEngine().onContextRestoredObservable.add((()=>{for(const L of this.geometries)L._rebuild();for(const L of this.meshes)L._rebuild();for(const L of this.fE)L.rebuild();for(const L of this.textures)L._rebuild()})))}_topologicalSort(L){const U=new Map;for(const F of L)U.set(F.uniqueId,F);const x={dependsOn:new Map,dependedBy:new Map};for(const F of L){const L=F.uniqueId;x.dependsOn.set(L,new Set),x.dependedBy.set(L,new Set)}for(const F of L){const L=F.uniqueId,mL=x.dependsOn.get(L);if(F instanceof h.e){const p=F.sourceMesh;U.has(p.uniqueId)&&(mL.add(p.uniqueId),x.dependedBy.get(p.uniqueId).add(L))}const p=x.dependedBy.get(L);for(const G of F.getDescendants()){const mL=G.uniqueId;if(U.has(mL)){p.add(mL);x.dependsOn.get(mL).add(L)}}}const mL=[],p=[];for(const F of L){const L=F.uniqueId;0===x.dependsOn.get(L).size&&(p.push(F),U.delete(L))}const G=p;for(;G.length>0;){const L=G.shift();mL.push(L);const p=x.dependedBy.get(L.uniqueId);for(const mL of Array.from(p.values())){const p=x.dependsOn.get(mL);p.delete(L.uniqueId),0===p.size&&U.get(mL)&&(G.push(U.get(mL)),U.delete(mL))}}return U.size>0&&(A.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),U.forEach((L=>{A.c.Error(L.name)}))),mL}_addNodeAndDescendantsToList(L,U,x,mL){if(x&&(!mL||mL(x))&&!U.has(x.uniqueId)){L.push(x),U.add(x.uniqueId);for(const p of x.getDescendants(!0))this._addNodeAndDescendantsToList(L,U,p,mL)}}_isNodeInContainer(L){return L instanceof o.c&&-1!==this.meshes.indexOf(L)||(L instanceof a.e&&-1!==this.transformNodes.indexOf(L)||(L instanceof b.d&&-1!==this.lights.indexOf(L)||L instanceof E.c&&-1!==this.cameras.indexOf(L)))}_isValidHierarchy(){for(const L of this.meshes)if(L.parent&&!this._isNodeInContainer(L.parent))return A.c.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.transformNodes)if(L.parent&&!this._isNodeInContainer(L.parent))return A.c.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.lights)if(L.parent&&!this._isNodeInContainer(L.parent))return A.c.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.cameras)if(L.parent&&!this._isNodeInContainer(L.parent))return A.c.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||p.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const mL={},G={},a=new H,o=[],A=[],r={doNotInstantiate:!0,...x},h=[],b=new Set;for(const p of this.transformNodes)null===p.parent&&this._addNodeAndDescendantsToList(h,b,p,r.predicate);for(const p of this.meshes)null===p.parent&&this._addNodeAndDescendantsToList(h,b,p,r.predicate);const E=this._topologicalSort(h),Y=(x,p)=>{if(((U,x)=>{if(mL[U.uniqueId]=x.uniqueId,G[x.uniqueId]=x,L&&(x.name=L(U.name)),x instanceof F.e){const L=x;if(L.morphTargetManager){const x=U.morphTargetManager;L.morphTargetManager=x.clone();for(let U=0;U<x.numTargets;U++){const p=x.getTarget(U),F=L.morphTargetManager.getTarget(U);mL[p.uniqueId]=F.uniqueId,G[F.uniqueId]=F}}}})(x,p),x.parent){const L=mL[x.parent.uniqueId],U=G[L];p.parent=U||x.parent}if(p.position&&x.position&&p.position.p(x.position),p.rotationQuaternion&&x.rotationQuaternion&&p.rotationQuaternion.p(x.rotationQuaternion),p.rotation&&x.rotation&&p.rotation.p(x.rotation),p.Ka&&x.Ka&&p.Ka.p(x.Ka),p.material){const F=p;if(F.material)if(U){const U=x.material;if(-1===A.indexOf(U)){let x=U.clone(L?L(U.name):"Clone of "+U.name);if(A.push(U),mL[U.uniqueId]=x.uniqueId,G[x.uniqueId]=x,"MultiMaterial"===U.getClassName()){const p=U;for(const U of p.Xa)U&&(x=U.clone(L?L(U.name):"Clone of "+U.name),A.push(U),mL[U.uniqueId]=x.uniqueId,G[x.uniqueId]=x);p.Xa=p.Xa.map((L=>L&&G[mL[L.uniqueId]]))}}"InstancedMesh"!==F.getClassName()&&(F.material=G[mL[U.uniqueId]])}else"MultiMaterial"===F.material.getClassName()?-1===this.VU.multiMaterials.indexOf(F.material)&&this.VU.addMultiMaterial(F.material):-1===this.VU.materials.indexOf(F.material)&&this.VU.addMaterial(F.material)}null===p.parent&&a.rootNodes.push(p)};for(const p of E)if("InstancedMesh"===p.getClassName()){const L=p,U=L.sourceMesh,x=mL[U.uniqueId];Y(L,("number"===typeof x?G[x]:U).createInstance(L.name))}else{let L=!0;"mh"===p.getClassName()||"Node"===p.getClassName()||p.skeleton||!p.getTotalVertices||0===p.getTotalVertices()?L=!1:r.doNotInstantiate&&(L="function"===typeof r.doNotInstantiate?!r.doNotInstantiate(p):!r.doNotInstantiate);const U=L?p.createInstance(`instance of ${p.name}`):p.clone(`Clone of ${p.name}`,null,!0);if(!U)throw new Error(`Could not clone or instantiate node on Asset Container ${p.name}`);Y(p,U)}for(const p of this.skeletons){if(r.predicate&&!r.predicate(p))continue;const U=p.clone(L?L(p.name):"Clone of "+p.name);for(const L of this.meshes)if(L.skeleton===p&&!L.isAnInstance){const x=G[mL[L.uniqueId]];if(!x||x.isAnInstance)continue;if(x.skeleton=U,-1!==o.indexOf(U))continue;o.push(U);for(const L of U.bones)L._linkedTransformNode&&(L._linkedTransformNode=G[mL[L._linkedTransformNode.uniqueId]])}a.skeletons.push(U)}for(const p of this.animationGroups){if(r.predicate&&!r.predicate(p))continue;const U=p.clone(L?L(p.name):"Clone of "+p.name,(L=>G[mL[L.uniqueId]]||L));a.animationGroups.push(U)}return a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||p.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.VU.environmentTexture=this.environmentTexture);for(const L of this.VU._serializableComponents)L.addFromContainer(this);this.VU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=[];for(const x of this.cameras)L&&!L(x)||(this.VU.addCamera(x),U.push(x));for(const x of this.lights)L&&!L(x)||(this.VU.addLight(x),U.push(x));for(const x of this.meshes)L&&!L(x)||(this.VU.Er(x),U.push(x));for(const x of this.skeletons)L&&!L(x)||this.VU.addSkeleton(x);for(const x of this.animations)L&&!L(x)||this.VU.addAnimation(x);for(const x of this.animationGroups)L&&!L(x)||this.VU.addAnimationGroup(x);for(const x of this.multiMaterials)L&&!L(x)||this.VU.addMultiMaterial(x);for(const x of this.materials)L&&!L(x)||this.VU.addMaterial(x);for(const x of this.morphTargetManagers)L&&!L(x)||this.VU.addMorphTargetManager(x);for(const x of this.geometries)L&&!L(x)||this.VU.addGeometry(x);for(const x of this.transformNodes)L&&!L(x)||(this.VU.addTransformNode(x),U.push(x));for(const x of this.actionManagers)L&&!L(x)||this.VU.addActionManager(x);for(const x of this.textures)L&&!L(x)||this.VU.addTexture(x);for(const x of this.reflectionProbes)L&&!L(x)||this.VU.addReflectionProbe(x);for(const x of U)x.parent&&-1===this.VU.getNodes().indexOf(x.parent)&&(x.setParent?x.setParent(null):x.parent=null)}removeAllFromScene(){this._isValidHierarchy()||p.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.VU.environmentTexture&&(this.VU.environmentTexture=null);for(const L of this.VU._serializableComponents)L.removeFromContainer(this)}removeFromScene(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const U of this.cameras)L&&!L(U)||this.VU.removeCamera(U);for(const U of this.lights)L&&!L(U)||this.VU.removeLight(U);for(const U of this.meshes)L&&!L(U)||this.VU.br(U,!0);for(const U of this.skeletons)L&&!L(U)||this.VU.removeSkeleton(U);for(const U of this.animations)L&&!L(U)||this.VU.removeAnimation(U);for(const U of this.animationGroups)L&&!L(U)||this.VU.removeAnimationGroup(U);for(const U of this.multiMaterials)L&&!L(U)||this.VU.removeMultiMaterial(U);for(const U of this.materials)L&&!L(U)||this.VU.removeMaterial(U);for(const U of this.morphTargetManagers)L&&!L(U)||this.VU.removeMorphTargetManager(U);for(const U of this.geometries)L&&!L(U)||this.VU.removeGeometry(U);for(const U of this.transformNodes)L&&!L(U)||this.VU.removeTransformNode(U);for(const U of this.actionManagers)L&&!L(U)||this.VU.removeActionManager(U);for(const U of this.textures)L&&!L(U)||this.VU.removeTexture(U);for(const U of this.reflectionProbes)L&&!L(U)||this.VU.removeReflectionProbe(U)}dispose(){const L=this.cameras.slice(0);for(const E of L)E.dispose();this.cameras.length=0;const U=this.lights.slice(0);for(const E of U)E.dispose();this.lights.length=0;const x=this.meshes.slice(0);for(const E of x)E.dispose();this.meshes.length=0;const mL=this.skeletons.slice(0);for(const E of mL)E.dispose();this.skeletons.length=0;const p=this.animationGroups.slice(0);for(const E of p)E.dispose();this.animationGroups.length=0;const G=this.multiMaterials.slice(0);for(const E of G)E.dispose();this.multiMaterials.length=0;const F=this.materials.slice(0);for(const E of F)E.dispose();this.materials.length=0;const a=this.geometries.slice(0);for(const E of a)E.dispose();this.geometries.length=0;const o=this.transformNodes.slice(0);for(const E of o)E.dispose();this.transformNodes.length=0;const A=this.actionManagers.slice(0);for(const E of A)E.dispose();this.actionManagers.length=0;const r=this.textures.slice(0);for(const E of r)E.dispose();this.textures.length=0;const h=this.reflectionProbes.slice(0);for(const E of h)E.dispose();this.reflectionProbes.length=0;const b=this.morphTargetManagers.slice(0);for(const E of b)E.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const E of this.VU._serializableComponents)E.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.VU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(L,U,x){if(L&&U)for(const mL of L){let L=!0;if(x)for(const U of x)if(mL===U){L=!1;break}L&&(U.push(mL),mL._parentContainer=this)}}moveAllFromScene(L){this._wasAddedToScene=!1,void 0===L&&(L=new V);for(const U in this)Object.prototype.hasOwnProperty.call(this,U)&&(this[U]=this[U]||("_environmentTexture"===U?null:[]),this._moveAssets(this.VU[U],this[U],L[U]));this.environmentTexture=this.VU.environmentTexture,this.removeAllFromScene()}createRootMesh(){const L=new F.e("assetContainerRootMesh",this.VU);for(const U of this.meshes)U.parent||L.addChild(U);return this.meshes.unshift(L),L}mergeAnimationsTo(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.c.LastCreatedScene,U=arguments.length>1?arguments[1]:void 0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!L)return A.c.Error("No scene available to merge animations to"),[];const mL=x||(U=>{let x=null;const mL=U.animations.length?U.animations[0].targetProperty:"",p=U.name.split(".").join("").split("_primitive")[0];switch(mL){case"position":case"rotationQuaternion":x=L.getTransformNodeByName(U.name)||L.getTransformNodeByName(p);break;case"influence":x=L.getMorphTargetByName(U.name)||L.getMorphTargetByName(p);break;default:x=L.getNodeByName(U.name)||L.getNodeByName(p)}return x}),p=this.getNodes();for(const a of p){const L=mL(a);if(null!==L){for(const U of a.animations){const x=L.animations.filter((L=>L.targetProperty===U.targetProperty));for(const U of x){const x=L.animations.indexOf(U,0);x>-1&&L.animations.splice(x,1)}}L.animations=L.animations.concat(a.animations)}}const G=[],F=this.animationGroups.slice();for(const a of F){G.push(a.clone(a.name,mL));for(const L of a.animatables)L.stop()}for(const a of U){const U=mL(a.target);U&&(L.beginAnimation(U,a.fromFrame,a.toFrame,a.loopAnimation,a.speedRatio,a.onAnimationEnd?a.onAnimationEnd:void 0,void 0,!0,void 0,a.onAnimationLoop?a.onAnimationLoop:void 0),L.stopAnimation(a.target))}return G}populateRootNodes(){this.rootNodes.length=0;for(const L of this.meshes)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.transformNodes)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.lights)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.cameras)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L)}addAllAssetsToContainer(L){if(!L)return;const U=[],x=new Set;for(U.push(L);U.length>0;){const L=U.pop();if(L instanceof F.e?(L.va&&-1===this.geometries.indexOf(L.va)&&this.geometries.push(L.va),this.meshes.push(L)):L instanceof h.e?this.meshes.push(L):L instanceof a.e?this.transformNodes.push(L):L instanceof b.d?this.lights.push(L):L instanceof E.c&&this.cameras.push(L),L instanceof o.c){if(L.material&&-1===this.materials.indexOf(L.material)){this.materials.push(L.material);for(const U of L.material.getActiveTextures())-1===this.textures.indexOf(U)&&this.textures.push(U)}L.skeleton&&-1===this.skeletons.indexOf(L.skeleton)&&this.skeletons.push(L.skeleton),L.morphTargetManager&&-1===this.morphTargetManagers.indexOf(L.morphTargetManager)&&this.morphTargetManagers.push(L.morphTargetManager)}for(const mL of L.getChildren())x.has(mL)||U.push(mL);x.add(L)}this.populateRootNodes()}_getByTags(L,U,x){if(void 0===U)return L;const mL=[];for(const p in L){const G=L[p];Y.e&&Y.e.MatchesQuery(G,U)&&(!x||x(G))&&mL.push(G)}return mL}getMeshesByTags(L,U){return this._getByTags(this.meshes,L,U)}getCamerasByTags(L,U){return this._getByTags(this.cameras,L,U)}getLightsByTags(L,U){return this._getByTags(this.lights,L,U)}getMaterialsByTags(L,U){return this._getByTags(this.materials,L,U).concat(this._getByTags(this.multiMaterials,L,U))}getTransformNodesByTags(L,U){return this._getByTags(this.transformNodes,L,U)}}var q=x(12457);class f{constructor(L){this.byteOffset=0,this.buffer=L}async loadAsync(L){const U=await this.buffer.readAsync(this.byteOffset,L);this._dataView=new DataView(U.buffer,U.byteOffset,U.byteLength),this._dataByteOffset=0}readUint32(){const L=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,L}readUint8Array(L){const U=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,L);return this._dataByteOffset+=L,this.byteOffset+=L,U}readString(L){return(0,q.j)(this.readUint8Array(L))}skipBytes(L){this._dataByteOffset+=L,this.byteOffset+=L}}var v=x(14277);const D="Z2xURg",P={name:"ba",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:L=>-1!==L.indexOf("asset")&&-1!==L.indexOf("version")||L.startsWith("data:base64,"+D)||L.startsWith("data:;base64,"+D)||L.startsWith("data:application/octet-stream;base64,"+D)||L.startsWith("data:model/gltf-binary;base64,"+D)};var d,K,l,i=x(12448),X=x(12452);function t(L,U,x){try{return Promise.resolve(new Uint8Array(L,U,x))}catch(mL){return Promise.reject(mL)}}!function(L){L[L.AUTO=0]="AUTO",L[L.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(d||(d={})),function(L){L[L.NONE=0]="NONE",L[L.FIRST=1]="FIRST",L[L.ALL=2]="ALL"}(K||(K={})),function(L){L[L.LOADING=0]="LOADING",L[L.READY=1]="READY",L[L.COMPLETE=2]="COMPLETE"}(l||(l={}));class y{constructor(){this.coordinateSystemMode=d.AUTO,this.animationStartMode=K.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=L=>Promise.resolve(L),this.extensionOptions={}}p(L){L&&(this.onParsed=L.onParsed,this.coordinateSystemMode=L.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=L.animationStartMode??this.animationStartMode,this.loadNodeAnimations=L.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=L.loadSkins??this.loadSkins,this.loadMorphTargets=L.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=L.compileMaterials??this.compileMaterials,this.useClipPlane=L.useClipPlane??this.useClipPlane,this.compileShadowGenerators=L.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=L.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=L.useRangeRequests??this.useRangeRequests,this.createInstances=L.createInstances??this.createInstances,this.alwaysComputeBoundingBox=L.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=L.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=L.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=L.skipMaterials??this.skipMaterials,this.useSRGBBuffers=L.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=L.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=L.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=L.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=L.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=L.customRootNode,this.onMeshLoaded=L.onMeshLoaded,this.onSkinLoaded=L.onSkinLoaded,this.onTextureLoaded=L.onTextureLoaded,this.onMaterialLoaded=L.onMaterialLoaded,this.onCameraLoaded=L.onCameraLoaded,this.extensionOptions=L.extensionOptions??this.extensionOptions)}}class n extends y{constructor(L){super(),this.onParsedObservable=new mL.c,this.onMeshLoadedObservable=new mL.c,this.onSkinLoadedObservable=new mL.c,this.onTextureLoadedObservable=new mL.c,this.onMaterialLoadedObservable=new mL.c,this.onCameraLoadedObservable=new mL.c,this.onCompleteObservable=new mL.c,this.onErrorObservable=new mL.c,this.oa=new mL.c,this.onExtensionLoadedObservable=new mL.c,this.validate=!1,this.onValidatedObservable=new mL.c,this._loader=null,this._state=null,this._requests=new Array,this.name=P.name,this.extensions=P.extensions,this.onLoaderStateChangedObservable=new mL.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(L)}set onParsed(L){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),L&&(this._onParsedObserver=this.onParsedObservable.add(L))}set onMeshLoaded(L){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),L&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(L))}set onSkinLoaded(L){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),L&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((U=>L(U.node,U.skinnedNode))))}set onTextureLoaded(L){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),L&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(L))}set onMaterialLoaded(L){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),L&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(L))}set onCameraLoaded(L){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),L&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(L))}set onComplete(L){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(L)}set onError(L){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(L)}set onDispose(L){this._onDisposeObserver&&this.oa.remove(this._onDisposeObserver),this._onDisposeObserver=this.oa.add(L)}set onExtensionLoaded(L){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(L)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(L){this._loggingEnabled!==L&&(this._loggingEnabled=L,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(L){this._capturePerformanceCounters!==L&&(this._capturePerformanceCounters=L,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(L){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(L)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const L of this._requests)L.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=L=>Promise.resolve(L),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.oa.notifyObservers(void 0),this.oa.clear()}loadFile(L,U,x,G,F,a,o,r){if(ArrayBuffer.isView(U))return this._loadBinary(L,U,x,G,o,r),null;this._progressCallback=F;const h=U.name||p.Tools.GetFilename(U);if(a){if(this.useRangeRequests){this.validate&&A.c.Warn("glTF validation is not supported when range requests are enabled");const x={abort:()=>{},onCompleteObservable:new mL.c},p={readAsync:(x,mL)=>new Promise(((p,G)=>{this._loadFile(L,U,(L=>{p(new Uint8Array(L))}),!0,(L=>{G(L)}),(L=>{L.setRequestHeader("Range",`bytes=${x}-${x+mL-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(p)).then((L=>{x.onCompleteObservable.notifyObservers(x),G(L)}),o?L=>o(void 0,L):void 0),x}return this._loadFile(L,U,(U=>{this._validate(L,new Uint8Array(U,0,U.byteLength),x,h),this._unpackBinaryAsync(new f({readAsync:(L,x)=>t(U,L,x),byteLength:U.byteLength})).then((L=>{G(L)}),o?L=>o(void 0,L):void 0)}),!0,o)}return this._loadFile(L,U,(U=>{try{this._validate(L,U,x,h),G({json:this._parseJson(U)})}catch{o&&o()}}),!1,o)}_loadBinary(L,U,x,mL,p,G){this._validate(L,new Uint8Array(U.buffer,U.byteOffset,U.byteLength),x,G),this._unpackBinaryAsync(new f({readAsync:(L,x)=>function(L,U,x){try{if(U<0||U>=L.byteLength)throw new RangeError("Offset is out of range.");if(U+x>L.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(L.buffer,L.byteOffset+U,x))}catch(mL){return Promise.reject(mL)}}(U,L,x),byteLength:U.byteLength})).then((L=>{mL(L)}),p?L=>p(void 0,L):void 0)}importMeshAsync(L,U,x,mL,p,G){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(x),this._loader.importMeshAsync(L,U,null,x,mL,p,G))))}loadAsync(L,U,x,mL,p){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(U),this._loader.loadAsync(L,U,x,mL,p))))}loadAssetContainerAsync(L,U,x,mL,p){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(U);const G=new Q(L),F=[];this.onMaterialLoadedObservable.add((L=>{F.push(L)}));const a=[];this.onTextureLoadedObservable.add((L=>{a.push(L)}));const o=[];this.onCameraLoadedObservable.add((L=>{o.push(L)}));const A=[];return this.onMeshLoadedObservable.add((L=>{L.morphTargetManager&&A.push(L.morphTargetManager)})),this._loader.importMeshAsync(null,L,G,U,x,mL,p).then((L=>(Array.prototype.push.apply(G.geometries,L.geometries),Array.prototype.push.apply(G.meshes,L.meshes),Array.prototype.push.apply(G.fE,L.fE),Array.prototype.push.apply(G.skeletons,L.skeletons),Array.prototype.push.apply(G.animationGroups,L.animationGroups),Array.prototype.push.apply(G.materials,F),Array.prototype.push.apply(G.textures,a),Array.prototype.push.apply(G.lights,L.lights),Array.prototype.push.apply(G.transformNodes,L.transformNodes),Array.prototype.push.apply(G.cameras,o),Array.prototype.push.apply(G.morphTargetManagers,A),G)))}))}canDirectLoad(L){return P.canDirectLoad(L)}directLoad(L,U){if(U.startsWith("base64,"+D)||U.startsWith(";base64,"+D)||U.startsWith("application/octet-stream;base64,"+D)||U.startsWith("model/gltf-binary;base64,"+D)){const x=(0,i.b)(U);return this._validate(L,new Uint8Array(x,0,x.byteLength)),this._unpackBinaryAsync(new f({readAsync:(L,U)=>t(x,L,U),byteLength:x.byteLength}))}return this._validate(L,U),Promise.resolve({json:this._parseJson(U)})}createPlugin(L){return new n(L[P.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((L,U)=>{this.onCompleteObservable.addOnce((()=>{L()})),this.onErrorObservable.addOnce((L=>{U(L)}))}))}_setState(L){this._state!==L&&(this._state=L,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(l[this._state]))}_loadFile(L,U,x,mL,p,G){const F=L._loadFile(U,x,(L=>{this._onProgress(L,F)}),!0,mL,p,G);return F.onCompleteObservable.add((()=>{F._lengthComputable=!0,F._total=F._loaded})),this._requests.push(F),F}_onProgress(L,U){if(!this._progressCallback)return;U._lengthComputable=L.lengthComputable,U._loaded=L.loaded,U._total=L.total;let x=!0,mL=0,p=0;for(const G of this._requests){if(void 0===G._lengthComputable||void 0===G._loaded||void 0===G._total)return;x=x&&G._lengthComputable,mL+=G._loaded,p+=G._total}this._progressCallback({lengthComputable:x,loaded:mL,total:x?p:0})}_validate(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),v.c.ValidateAsync(U,x,mL,(U=>this.preprocessUrlAsync(x+U).then((U=>L._loadFileAsync(U,void 0,!0,!0).then((L=>new Uint8Array(L,0,L.byteLength))))))).then((L=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(L),this.onValidatedObservable.clear()}),(L=>{this._endPerformanceCounter("Validate JSON"),p.Tools.Warn(`Failed to validate: ${L.message}`),this.onValidatedObservable.clear()})))}_getLoader(L){const U=L.json.asset||{};this._log(`Asset version: ${U.version}`),U.minVersion&&this._log(`Asset minimum version: ${U.minVersion}`),U.generator&&this._log(`Asset generator: ${U.generator}`);const x=n._parseVersion(U.version);if(!x)throw new Error("Invalid version: "+U.version);if(void 0!==U.minVersion){const L=n._parseVersion(U.minVersion);if(!L)throw new Error("Invalid minimum version: "+U.minVersion);if(n._compareVersion(L,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+U.minVersion)}const mL={1:n._CreateGLTF1Loader,2:n._CreateGLTF2Loader}[x.major];if(!mL)throw new Error("Unsupported version: "+U.version);return mL(this)}_parseJson(L){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${L.length}`);const U=JSON.parse(L);return this._endPerformanceCounter("Parse JSON"),U}_unpackBinaryAsync(L){return this._startPerformanceCounter("Unpack Binary"),L.loadAsync(20).then((()=>{const U=L.readUint32();if(1179937895!==U)throw new X.i("Unexpected magic: "+U,X.h.GLTFLoaderUnexpectedMagicError);const x=L.readUint32();this.loggingEnabled&&this._log(`Binary version: ${x}`);const mL=L.readUint32();let p;switch(this.useRangeRequests||mL===L.buffer.byteLength||A.c.Warn(`Length in header does not match actual data length: ${mL} != ${L.buffer.byteLength}`),x){case 1:p=this._unpackBinaryV1Async(L,mL);break;case 2:p=this._unpackBinaryV2Async(L,mL);break;default:throw new Error("Unsupported version: "+x)}return this._endPerformanceCounter("Unpack Binary"),p}))}_unpackBinaryV1Async(L,U){const x=L.readUint32(),mL=L.readUint32();if(0!==mL)throw new Error(`Unexpected content format: ${mL}`);const p=U-L.byteOffset,G={json:this._parseJson(L.readString(x)),bin:null};if(0!==p){const U=L.byteOffset;G.bin={readAsync:(x,mL)=>L.buffer.readAsync(U+x,mL),byteLength:p}}return Promise.resolve(G)}_unpackBinaryV2Async(L,U){const x=1313821514,mL=5130562,p=L.readUint32();if(L.readUint32()!==x)throw new Error("First chunk format is not JSON");return L.byteOffset+p===U?L.loadAsync(p).then((()=>({json:this._parseJson(L.readString(p)),bin:null}))):L.loadAsync(p+8).then((()=>{const G={json:this._parseJson(L.readString(p)),bin:null},F=()=>{const p=L.readUint32();switch(L.readUint32()){case x:throw new Error("Unexpected JSON chunk");case mL:{const U=L.byteOffset;G.bin={readAsync:(x,mL)=>L.buffer.readAsync(U+x,mL),byteLength:p},L.skipBytes(p);break}default:L.skipBytes(p)}return L.byteOffset!==U?L.loadAsync(8).then(F):Promise.resolve(G)};return F()}))}static _parseVersion(L){if("1.0"===L||"1.0.1"===L)return{major:1,minor:0};const U=(L+"").match(/^(\d+)\.(\d+)/);return U?{major:parseInt(U[1]),minor:parseInt(U[2])}:null}static _compareVersion(L,U){return L.major>U.major?1:L.major<U.major?-1:L.minor>U.minor?1:L.minor<U.minor?-1:0}_logOpen(L){this._log(L),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(L){const U=n._logSpaces.substring(0,2*this._logIndentLevel);A.c.Log(`${U}${L}`)}_logDisabled(L){}_startPerformanceCounterEnabled(L){p.Tools.StartPerformanceCounter(L)}_startPerformanceCounterDisabled(L){}_endPerformanceCounterEnabled(L){p.Tools.EndPerformanceCounter(L)}_endPerformanceCounterDisabled(L){}}n.IncrementalLoading=!0,n.HomogeneousCoordinates=!1,n._logSpaces="                                ",(0,G.c)(new n)},14277:(L,U,x)=>{"use strict";x.d(U,{c:()=>F});var mL=x(12382);function p(L,U,x,mL){const p={externalResourceFunction:mL};return x&&(p.uri="file:"===U?x:U+x),ArrayBuffer.isView(L)?GLTFValidator.validateBytes(L,p):GLTFValidator.validateString(L,p)}function G(){const L=[];onmessage=U=>{const x=U.data;switch(x.id){case"init":importScripts(x.url);break;case"validate":p(x.data,x.rootUrl,x.fileName,(U=>new Promise(((x,mL)=>{const p=L.length;L.push({resolve:x,reject:mL}),postMessage({id:"getExternalResource",index:p,uri:U})})))).then((L=>{postMessage({id:"validate.resolve",value:L})}),(L=>{postMessage({id:"validate.reject",reason:L})}));break;case"getExternalResource.resolve":L[x.index].resolve(x.value);break;case"getExternalResource.reject":L[x.index].reject(x.reason)}}}class F{static ValidateAsync(L,U,x,F){return"function"===typeof Worker?new Promise(((a,o)=>{const A=`${p}(${G})()`,r=URL.createObjectURL(new Blob([A],{type:"application/javascript"})),h=new Worker(r),b=L=>{h.removeEventListener("error",b),h.removeEventListener("message",E),o(L)},E=L=>{const U=L.data;switch(U.id){case"getExternalResource":F(U.uri).then((L=>{h.postMessage({id:"getExternalResource.resolve",index:U.index,value:L},[L.buffer])}),(L=>{h.postMessage({id:"getExternalResource.reject",index:U.index,reason:L})}));break;case"validate.resolve":h.removeEventListener("error",b),h.removeEventListener("message",E),a(U.value),h.terminate();break;case"validate.reject":h.removeEventListener("error",b),h.removeEventListener("message",E),o(U.reason),h.terminate()}};if(h.addEventListener("error",b),h.addEventListener("message",E),h.postMessage({id:"init",url:mL.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(L)){const mL=L.slice();h.postMessage({id:"validate",data:mL,rootUrl:U,fileName:x},[mL.buffer])}else h.postMessage({id:"validate",data:L,rootUrl:U,fileName:x})})):(this._LoadScriptPromise||(this._LoadScriptPromise=mL.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>p(L,U,x,F))))}}F.Configuration={url:`${mL.Tools._DefaultCdnUrl}/gltf_validator.js`}},14811:(L,U,x)=>{"use strict";x.d(U,{d:()=>P});var mL=x(12571),p=x(12574),G=x(12625),F=x(12589),a=x(12979),o=x(12909),A=x(12666),r=x(12820),h=x(12547),b=x(12496);x(14041),x(13947),x(13969),x(13952),x(13974),x(13977),x(13984);const E="imageProcessingCompatibility",Y="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";b.d.IncludesShadersStore[E]||(b.d.IncludesShadersStore[E]=Y);const S="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";b.d.ShadersStore[S]||(b.d.ShadersStore[S]=V);x(14050),x(13992),x(13999),x(14009),x(14004);const H="skyVertexShader",Q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";b.d.ShadersStore[H]||(b.d.ShadersStore[H]=Q);var q=x(12906),f=x(12966),v=x(12961);class D extends a.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class P extends o.d{constructor(L,U){super(L,U),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new F.YU(0,100,0),this.useSunPosition=!1,this.cameraOffset=F.YU.Zero(),this.up=F.YU.Up(),this.dithering=!1,this._cameraPosition=F.YU.Zero(),this._skyOrientation=new F.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(L,U){const x=U._drawWrapper;if(this.isFrozen&&x.effect&&x._wasPreviouslyReady)return!0;U.materialDefines||(U.materialDefines=new D);const mL=U.materialDefines,p=this.PL();if(this._isReadyForSubMesh(U))return!0;if((0,v.S)(L,p,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,mL),(0,v.E)(L,mL,!0,!1),mL.IMAGEPROCESSINGPOSTPROCESS!==p.imageProcessingConfiguration.applyByPostProcess&&mL.markAsMiscDirty(),mL.DITHER!==this.dithering&&mL.markAsMiscDirty(),mL.isDirty){mL.markAsProcessed(),p.resetCachedMaterial();const L=new q.b;mL.FOG&&L.addFallback(1,"FOG"),mL.IMAGEPROCESSINGPOSTPROCESS=p.imageProcessingConfiguration.applyByPostProcess,mL.DITHER=this.dithering;const x=[A.h.PositionKind];mL.VERTEXCOLOR&&x.push(A.h.ColorKind);const G="sky",F=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.e)(F);const a=mL.toString();U.setEffect(p.getEngine().createEffect(G,x,F,[],a,L,this.onCompiled,this.onError),mL,this._materialContext)}return!(!U.effect||!U.effect.isReady())&&(mL._renderId=p.getRenderId(),x._wasPreviouslyReady=!0,!0)}bindForSubMesh(L,U,x){const mL=this.PL(),p=x.materialDefines;if(!p)return;const G=x.effect;if(!G)return;this._activeEffect=G,this.bindOnlyWorldMatrix(L),this._activeEffect.setMatrix("viewProjection",mL.getTransformMatrix()),this._mustRebind(mL,G,x)&&((0,f.i)(G,this,mL),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,v.l)(p,G,mL)),mL.fogEnabled&&U.applyFog&&mL.fogMode!==r.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",mL.getViewMatrix()),(0,v.f)(mL,U,this._activeEffect);const a=mL.activeCamera;if(a){const L=a.getWorldMatrix();this._cameraPosition.x=L.m[12],this._cameraPosition.y=L.m[13],this._cameraPosition.z=L.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const L=Math.PI*(this.inclination-.5),U=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(U)*Math.cos(L),this.sunPosition.y=this.distance*Math.sin(-L),this.sunPosition.z=this.distance*Math.sin(U)*Math.cos(L),F.Quaternion.FromUnitVectorsToRef(F.YU.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(U,this._activeEffect,x)}getAnimatables(){return[]}dispose(L){super.dispose(L)}clone(L){return G.e.Clone((()=>new P(L,this.PL())),this)}serialize(){const L=super.serialize();return L.customType="BABYLON.SkyMaterial",L}getClassName(){return"SkyMaterial"}static Parse(L,U,x){return G.e.Parse((()=>new P(L.name,U)),L,U,x)}}(0,mL.d)([(0,p.R)()],P.prototype,"luminance",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"turbidity",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"rayleigh",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"mieCoefficient",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"mieDirectionalG",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"distance",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"inclination",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"azimuth",void 0),(0,mL.d)([(0,p.Q)()],P.prototype,"sunPosition",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"useSunPosition",void 0),(0,mL.d)([(0,p.Q)()],P.prototype,"cameraOffset",void 0),(0,mL.d)([(0,p.Q)()],P.prototype,"up",void 0),(0,mL.d)([(0,p.R)()],P.prototype,"dithering",void 0),(0,h.d)("BABYLON.SkyMaterial",P)},13304:(L,U,x)=>{"use strict";function mL(L,U){U.headers=L.headers||{},U.statusMessage=L.statusText,U.statusCode=L.status,U.data=L.response}function p(L,U,x){return new Promise((function(p,G){x=x||{};var F,a,o,A=new XMLHttpRequest,r=x.body,h=x.headers||{};for(F in x.timeout&&(A.timeout=x.timeout),A.ontimeout=A.onerror=function(L){L.timeout="timeout"==L.type,G(L)},A.open(L,U.href||U),A.onload=function(){for(o=A.getAllResponseHeaders().trim().split(/[\r\n]+/),mL(A,A);a=o.shift();)a=a.split(": "),A.headers[a.shift().toLowerCase()]=a.join(": ");if((a=A.headers["content-type"])&&~a.indexOf("application/json"))try{A.data=JSON.parse(A.data,x.reviver)}catch(L){return mL(A,L),G(L)}(A.status>=400?G:p)(A)},typeof FormData<"u"&&r instanceof FormData||r&&"object"==typeof r&&(h["content-type"]="application/json",r=JSON.stringify(r)),A.withCredentials=!!x.withCredentials,h)A.setRequestHeader(F,h[F]);A.send(r)}))}x.r(U),x.d(U,{del:()=>o,get:()=>G,patch:()=>a,post:()=>F,put:()=>A,send:()=>p});var G=p.bind(p,"GET"),F=p.bind(p,"POST"),a=p.bind(p,"PATCH"),o=p.bind(p,"DELETE"),A=p.bind(p,"PUT")},14911:(L,U,x)=>{"use strict";x.d(U,{c:()=>h});const mL=.5*(Math.sqrt(3)-1),p=(3-Math.sqrt(3))/6,G=1/3,F=1/6,a=(Math.sqrt(5)-1)/4,o=(5-Math.sqrt(5))/20,A=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),r=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const h=class{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const U="function"==typeof L?L:function(L){let U=0,x=0,mL=0,p=1;const G=function(){let L=4022871197;return function(U){U=U.toString();for(let x=0;x<U.length;x++){L+=U.charCodeAt(x);let mL=.02519603282416938*L;L=mL>>>0,mL-=L,mL*=L,L=mL>>>0,mL-=L,L+=4294967296*mL}return 2.3283064365386963e-10*(L>>>0)}}();U=G(" "),x=G(" "),mL=G(" "),U-=G(L),U<0&&(U+=1);x-=G(L),x<0&&(x+=1);mL-=G(L),mL<0&&(mL+=1);return function(){const L=2091639*U+2.3283064365386963e-10*p;return U=x,x=mL,mL=L-(p=0|L)}}(L);this.p=function(L){const U=new Uint8Array(256);for(let x=0;x<256;x++)U[x]=x;for(let x=0;x<255;x++){const mL=x+~~(L()*(256-x)),p=U[x];U[x]=U[mL],U[mL]=p}return U}(U),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let x=0;x<512;x++)this.perm[x]=this.p[255&x],this.permMod12[x]=this.perm[x]%12}noise2D(L,U){const x=this.permMod12,G=this.perm;let F=0,a=0,o=0;const r=(L+U)*mL,h=Math.floor(L+r),b=Math.floor(U+r),E=(h+b)*p,Y=L-(h-E),S=U-(b-E);let V,H;Y>S?(V=1,H=0):(V=0,H=1);const Q=Y-V+p,q=S-H+p,f=Y-1+2*p,v=S-1+2*p,D=255&h,P=255&b;let d=.5-Y*Y-S*S;if(d>=0){const L=3*x[D+G[P]];d*=d,F=d*d*(A[L]*Y+A[L+1]*S)}let K=.5-Q*Q-q*q;if(K>=0){const L=3*x[D+V+G[P+H]];K*=K,a=K*K*(A[L]*Q+A[L+1]*q)}let l=.5-f*f-v*v;if(l>=0){const L=3*x[D+1+G[P+1]];l*=l,o=l*l*(A[L]*f+A[L+1]*v)}return 70*(F+a+o)}noise3D(L,U,x){const mL=this.permMod12,p=this.perm;let a,o,r,h;const b=(L+U+x)*G,E=Math.floor(L+b),Y=Math.floor(U+b),S=Math.floor(x+b),V=(E+Y+S)*F,H=L-(E-V),Q=U-(Y-V),q=x-(S-V);let f,v,D,P,d,K;H>=Q?Q>=q?(f=1,v=0,D=0,P=1,d=1,K=0):H>=q?(f=1,v=0,D=0,P=1,d=0,K=1):(f=0,v=0,D=1,P=1,d=0,K=1):Q<q?(f=0,v=0,D=1,P=0,d=1,K=1):H<q?(f=0,v=1,D=0,P=0,d=1,K=1):(f=0,v=1,D=0,P=1,d=1,K=0);const l=H-f+F,i=Q-v+F,X=q-D+F,t=H-P+2*F,y=Q-d+2*F,n=q-K+2*F,N=H-1+.5,e=Q-1+.5,u=q-1+.5,Z=255&E,g=255&Y,z=255&S;let M=.6-H*H-Q*Q-q*q;if(M<0)a=0;else{const L=3*mL[Z+p[g+p[z]]];M*=M,a=M*M*(A[L]*H+A[L+1]*Q+A[L+2]*q)}let J=.6-l*l-i*i-X*X;if(J<0)o=0;else{const L=3*mL[Z+f+p[g+v+p[z+D]]];J*=J,o=J*J*(A[L]*l+A[L+1]*i+A[L+2]*X)}let j=.6-t*t-y*y-n*n;if(j<0)r=0;else{const L=3*mL[Z+P+p[g+d+p[z+K]]];j*=j,r=j*j*(A[L]*t+A[L+1]*y+A[L+2]*n)}let R=.6-N*N-e*e-u*u;if(R<0)h=0;else{const L=3*mL[Z+1+p[g+1+p[z+1]]];R*=R,h=R*R*(A[L]*N+A[L+1]*e+A[L+2]*u)}return 32*(a+o+r+h)}noise4D(L,U,x,mL){const p=this.perm;let G,F,A,h,b;const E=(L+U+x+mL)*a,Y=Math.floor(L+E),S=Math.floor(U+E),V=Math.floor(x+E),H=Math.floor(mL+E),Q=(Y+S+V+H)*o,q=L-(Y-Q),f=U-(S-Q),v=x-(V-Q),D=mL-(H-Q);let P=0,d=0,K=0,l=0;q>f?P++:d++,q>v?P++:K++,q>D?P++:l++,f>v?d++:K++,f>D?d++:l++,v>D?K++:l++;const i=P>=3?1:0,X=d>=3?1:0,t=K>=3?1:0,y=l>=3?1:0,n=P>=2?1:0,N=d>=2?1:0,e=K>=2?1:0,u=l>=2?1:0,Z=P>=1?1:0,g=d>=1?1:0,z=K>=1?1:0,M=l>=1?1:0,J=q-i+o,j=f-X+o,R=v-t+o,c=D-y+o,W=q-n+2*o,I=f-N+2*o,w=v-e+2*o,B=D-u+2*o,s=q-Z+3*o,C=f-g+3*o,k=v-z+3*o,T=D-M+3*o,O=q-1+4*o,LL=f-1+4*o,UL=v-1+4*o,xL=D-1+4*o,mU=255&Y,pL=255&S,GL=255&V,FL=255&H;let aL=.6-q*q-f*f-v*v-D*D;if(aL<0)G=0;else{const L=p[mU+p[pL+p[GL+p[FL]]]]%32*4;aL*=aL,G=aL*aL*(r[L]*q+r[L+1]*f+r[L+2]*v+r[L+3]*D)}let oL=.6-J*J-j*j-R*R-c*c;if(oL<0)F=0;else{const L=p[mU+i+p[pL+X+p[GL+t+p[FL+y]]]]%32*4;oL*=oL,F=oL*oL*(r[L]*J+r[L+1]*j+r[L+2]*R+r[L+3]*c)}let AL=.6-W*W-I*I-w*w-B*B;if(AL<0)A=0;else{const L=p[mU+n+p[pL+N+p[GL+e+p[FL+u]]]]%32*4;AL*=AL,A=AL*AL*(r[L]*W+r[L+1]*I+r[L+2]*w+r[L+3]*B)}let rL=.6-s*s-C*C-k*k-T*T;if(rL<0)h=0;else{const L=p[mU+Z+p[pL+g+p[GL+z+p[FL+M]]]]%32*4;rL*=rL,h=rL*rL*(r[L]*s+r[L+1]*C+r[L+2]*k+r[L+3]*T)}let hL=.6-O*O-LL*LL-UL*UL-xL*xL;if(hL<0)b=0;else{const L=p[mU+1+p[pL+1+p[GL+1+p[FL+1]]]]%32*4;hL*=hL,b=hL*hL*(r[L]*O+r[L+1]*LL+r[L+2]*UL+r[L+3]*xL)}return 27*(G+F+A+h+b)}}}}]);