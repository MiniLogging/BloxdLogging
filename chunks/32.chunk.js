/*! For license information please see moebl7.32.af27af29.chunk.js.LICENSE.txt */
(self.irtrrknfyfo=self.irtrrknfyfo||[]).push([[32],{13363:(B,E,v)=>{"use strict";var z=v(13366),o=v(13370),q=v(13374);v.g.__TYPEDARRAY_POOL||(v.g.__TYPEDARRAY_POOL={UINT8:o([32,0]),UINT16:o([32,0]),UINT32:o([32,0]),INT8:o([32,0]),INT16:o([32,0]),INT32:o([32,0]),FLOAT:o([32,0]),DOUBLE:o([32,0]),DATA:o([32,0]),UINT8C:o([32,0]),BUFFER:o([32,0])});var c="undefined"!==typeof Uint8ClampedArray,S=v.g.__TYPEDARRAY_POOL;S.UINT8C||(S.UINT8C=o([32,0])),S.BUFFER||(S.BUFFER=o([32,0]));var x=S.DATA,D=S.BUFFER;function h(B){if(B){var E=B.length||B.byteLength,v=z.log2(E);x[v].push(B)}}function y(B){B=z.nextPow2(B);var E=z.log2(B),v=x[E];return v.length>0?v.pop():new ArrayBuffer(B)}function Q(B){return new Uint8Array(y(B),0,B)}function P(B){return new Uint16Array(y(2*B),0,B)}function G(B){return new Uint32Array(y(4*B),0,B)}function Y(B){return new Int8Array(y(B),0,B)}function a(B){return new Int16Array(y(2*B),0,B)}function m(B){return new Int32Array(y(4*B),0,B)}function g(B){return new Float32Array(y(4*B),0,B)}function V(B){return new Float64Array(y(8*B),0,B)}function T(B){return c?new Uint8ClampedArray(y(B),0,B):Q(B)}function N(B){return new DataView(y(B),0,B)}E.free=function(B){if(q(B))D[z.log2(B.length)].push(B);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(B)&&(B=B.buffer),!B)return;var E=B.length||B.byteLength,v=0|z.log2(E);x[v].push(B)}},E.freeUint8=E.freeUint16=E.freeUint32=E.freeInt8=E.freeInt16=E.freeInt32=E.freeFloat32=E.freeFloat=E.freeFloat64=E.freeDouble=E.freeUint8Clamped=E.freeDataView=function(B){h(B.buffer)},E.freeArrayBuffer=h,E.freeBuffer=function(B){D[z.log2(B.length)].push(B)},E.malloc=function(B,E){if(void 0===E||"arraybuffer"===E)return y(B);switch(E){case"uint8":return Q(B);case"uint16":return P(B);case"uint32":return G(B);case"int8":return Y(B);case"int16":return a(B);case"int32":return m(B);case"float":case"float32":return g(B);case"double":case"float64":return V(B);case"uint8_clamped":return T(B);case"buffer":throw"Buffer not supported";case"data":case"dataview":return N(B);default:return null}return null},E.mallocArrayBuffer=y,E.mallocUint8=Q,E.mallocUint16=P,E.mallocUint32=G,E.mallocInt8=Y,E.mallocInt16=a,E.mallocInt32=m,E.mallocFloat32=E.mallocFloat=g,E.mallocFloat64=E.mallocDouble=V,E.mallocUint8Clamped=T,E.mallocDataView=N,E.clearCache=function(){for(var B=0;B<32;++B)S.UINT8[B].length=0,S.UINT16[B].length=0,S.UINT32[B].length=0,S.INT8[B].length=0,S.INT16[B].length=0,S.INT32[B].length=0,S.FLOAT[B].length=0,S.DOUBLE[B].length=0,S.UINT8C[B].length=0,x[B].length=0,D[B].length=0}},13442:(B,E,v)=>{B.exports=o;var z=v(12184);function o(B,E){if(!(this instanceof o))return new o(B,E);var v=z.create();z.add(v,B,E),this.base=z.min(z.create(),B,v),this.Ih=z.clone(E),this.max=z.max(z.create(),B,v),this.mag=z.length(this.Ih)}var q=o.prototype;q.width=function(){return this.Ih[0]},q.height=function(){return this.Ih[1]},q.depth=function(){return this.Ih[2]},q.x0=function(){return this.base[0]},q.y0=function(){return this.base[1]},q.z0=function(){return this.base[2]},q.x1=function(){return this.max[0]},q.y1=function(){return this.max[1]},q.z1=function(){return this.max[2]},q.translate=function(B){return z.add(this.max,this.max,B),z.add(this.base,this.base,B),this},q.setPosition=function(B){return z.add(this.max,B,this.Ih),z.k(this.base,B),this},q.expand=function(B){var E=z.create(),v=z.create();return z.max(E,B.max,this.max),z.min(v,B.base,this.base),z.YE(E,E,v),new o(v,E)},q.intersects=function(B){return!(B.base[0]>this.max[0])&&(!(B.base[1]>this.max[1])&&(!(B.base[2]>this.max[2])&&(!(B.max[0]<this.base[0])&&(!(B.max[1]<this.base[1])&&!(B.max[2]<this.base[2])))))},q.touches=function(B){var E=this.union(B);return null!==E&&(0==E.width()||0==E.height()||0==E.depth())},q.union=function(B){if(!this.intersects(B))return null;var E=Math.max(B.base[0],this.base[0]),v=Math.max(B.base[1],this.base[1]),z=Math.max(B.base[2],this.base[2]);return new o([E,v,z],[Math.min(B.max[0],this.max[0])-E,Math.min(B.max[1],this.max[1])-v,Math.min(B.max[2],this.max[2])-z])}},13366:(B,E)=>{"use strict";function v(B){var E=32;return(B&=-B)&&E--,65535&B&&(E-=16),16711935&B&&(E-=8),252645135&B&&(E-=4),858993459&B&&(E-=2),1431655765&B&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(B){return(B>0)-(B<0)},E.abs=function(B){var E=B>>31;return(B^E)-E},E.min=function(B,E){return E^(B^E)&-(B<E)},E.max=function(B,E){return B^(B^E)&-(B<E)},E.isPow2=function(B){return!(B&B-1)&&!!B},E.log2=function(B){var E,v;return E=(B>65535)<<4,E|=v=((B>>>=E)>255)<<3,E|=v=((B>>>=v)>15)<<2,(E|=v=((B>>>=v)>3)<<1)|(B>>>=v)>>1},E.log10=function(B){return B>=1e9?9:B>=1e8?8:B>=1e7?7:B>=1e6?6:B>=1e5?5:B>=1e4?4:B>=1e3?3:B>=100?2:B>=10?1:0},E.popCount=function(B){return 16843009*((B=(858993459&(B-=B>>>1&1431655765))+(B>>>2&858993459))+(B>>>4)&252645135)>>>24},E.countTrailingZeros=v,E.nextPow2=function(B){return B+=0===B,--B,B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)+1},E.prevPow2=function(B){return B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)-(B>>>1)},E.parity=function(B){return B^=B>>>16,B^=B>>>8,B^=B>>>4,27030>>>(B&=15)&1};var z=new Array(256);!function(B){for(var E=0;E<256;++E){var v=E,z=E,o=7;for(v>>>=1;v;v>>>=1)z<<=1,z|=1&v,--o;B[E]=z<<o&255}}(z),E.reverse=function(B){return z[255&B]<<24|z[B>>>8&255]<<16|z[B>>>16&255]<<8|z[B>>>24&255]},E.interleave2=function(B,E){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B&=65535)|B<<8))|B<<4))|B<<2))|B<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(B,E){return(B=65535&((B=16711935&((B=252645135&((B=858993459&((B=B>>>E&1431655765)|B>>>1))|B>>>2))|B>>>4))|B>>>16))<<16>>16},E.interleave3=function(B,E,v){return B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2),(B|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<2},E.deinterleave3=function(B,E){return(B=1023&((B=4278190335&((B=251719695&((B=3272356035&((B=B>>>E&1227133513)|B>>>2))|B>>>4))|B>>>8))|B>>>16))<<22>>22},E.nextCombination=function(B){var E=B|B-1;return E+1|(~E&-~E)-1>>>v(B)+1}},13355:(B,E,v)=>{"use strict";B.exports=function(B,E,v){switch(arguments.length){case 1:return z=[],D(o=B,o,h,!0),z;case 2:return"function"===typeof E?D(B,B,E,!0):function(B,E){return z=[],D(B,E,h,!1),z}(B,E);case 3:return D(B,E,v,!1);default:throw new Error("box-intersect: Invalid arguments")}var o};var z,o=v(13363),q=v(13377),c=v(13388);function S(B,E){for(var v=0;v<B;++v)if(!(E[v]<=E[v+B]))return!0;return!1}function x(B,E,v,z){for(var o=0,q=0,c=0,x=B.length;c<x;++c){var D=B[c];if(!S(E,D)){for(var h=0;h<2*E;++h)v[o++]=D[h];z[q++]=c}}return q}function D(B,E,v,z){var S=B.length,D=E.length;if(!(S<=0||D<=0)){var h=B[0].length>>>1;if(!(h<=0)){var y,Q=o.mallocDouble(2*h*S),P=o.mallocInt32(S);if((S=x(B,h,Q,P))>0){if(1===h&&z)q.init(S),y=q.sweepComplete(h,v,0,S,Q,P,0,S,Q,P);else{var G=o.mallocDouble(2*h*D),Y=o.mallocInt32(D);(D=x(E,h,G,Y))>0&&(q.init(S+D),y=1===h?q.sweepBipartite(h,v,0,S,Q,P,0,D,G,Y):c(h,v,z,S,Q,P,D,G,Y),o.free(G),o.free(Y))}o.free(Q),o.free(P)}return y}}}function h(B,E){z.push([B,E])}},13393:(B,E)=>{"use strict";var v="d",z="ax",o="fp",q="es",c="rs",S="re",x="rb",D="bs",h="be",y="bb",Q=[v,z,"vv",c,S,x,"ri",D,h,y,"bi"];function P(B){var E="bruteForce"+(B?"Full":"Partial"),z=[],c=Q.slice();B||c.splice(3,0,o);var S=["function "+E+"("+c.join()+"){"];function x(E,o){var c=function(B,E,z){var o="bruteForce"+(B?"Red":"Blue")+(E?"Flip":"")+(z?"Full":""),c=["function ",o,"(",Q.join(),"){","var ",q,"=2*",v,";"],S="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",x="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return B?c.push(S,"Q",":",x):c.push(x,"Q",":",S),z?c.push("if(y1<x0||x1<y0)continue;"):E?c.push("if(y0<=x0||x1<y0)continue;"):c.push("if(y0<x0||x1<y0)continue;"),c.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),E?c.push("yi,xi"):c.push("xi,yi"),c.push(");if(rv!==void 0)return rv;}}}"),{name:o,code:c.join("")}}(E,o,B);z.push(c.code),S.push("return "+c.name+"("+Q.join()+");")}S.push("if(re-rs>be-bs){"),B?(x(!0,!1),S.push("}else{"),x(!1,!1)):(S.push("if(fp){"),x(!0,!0),S.push("}else{"),x(!0,!1),S.push("}}else{if(fp){"),x(!1,!0),S.push("}else{"),x(!1,!1),S.push("}")),S.push("}}return "+E);var D=z.join("")+S.join("");return new Function(D)()}E.partial=P(!1),E.full=P(!0)},13388:(B,E,v)=>{"use strict";B.exports=function(B,E,v,q,h,K,C,f,A){!function(B,E){var v=8*o.log2(E+1)*(B+1)|0,q=o.nextPow2(T*v);X.length<q&&(z.free(X),X=z.mallocInt32(q));var c=o.nextPow2(N*v);r.length<c&&(z.free(r),r=z.mallocDouble(c))}(B,q+C);var l,d=0,t=2*B;i(d++,0,0,q,0,C,v?16:0,-1/0,1/0),v||i(d++,0,0,C,0,q,1,-1/0,1/0);for(;d>0;){var p=(d-=1)*T,H=X[p],j=X[p+1],R=X[p+2],b=X[p+3],F=X[p+4],W=X[p+5],w=d*N,n=r[w],U=r[w+1],s=1&W,J=!!(16&W),O=h,e=K,k=f,L=A;if(s&&(O=f,e=A,k=h,L=K),!(2&W&&j>=(R=a(B,H,j,R,O,e,U)))&&!(4&W&&(j=m(B,H,j,R,O,e,n))>=R)){var M=R-j,Z=F-b;if(J){if(B*M*(M+Z)<P){if(void 0!==(l=x.scanComplete(B,H,E,j,R,O,e,b,F,k,L)))return l;continue}}else{if(B*Math.min(M,Z)<y){if(void 0!==(l=c(B,H,E,s,j,R,O,e,b,F,k,L)))return l;continue}if(B*M*Z<Q){if(void 0!==(l=x.scanBipartite(B,H,E,s,j,R,O,e,b,F,k,L)))return l;continue}}var BB=G(B,H,j,R,O,e,n,U);if(j<BB)if(B*(BB-j)<y){if(void 0!==(l=S(B,H+1,E,j,BB,O,e,b,F,k,L)))return l}else if(H===B-2){if(void 0!==(l=s?x.sweepBipartite(B,E,b,F,k,L,j,BB,O,e):x.sweepBipartite(B,E,j,BB,O,e,b,F,k,L)))return l}else i(d++,H+1,j,BB,b,F,s,-1/0,1/0),i(d++,H+1,b,F,j,BB,1^s,-1/0,1/0);if(BB<R){var EB=D(B,H,b,F,k,L),vB=k[t*EB+H],zB=Y(B,H,EB,F,k,L,vB);if(zB<F&&i(d++,H,BB,R,zB,F,(4|s)+(J?16:0),vB,U),b<EB&&i(d++,H,BB,R,b,EB,(2|s)+(J?16:0),n,vB),EB+1===zB){if(void 0!==(l=J?I(B,H,E,BB,R,O,e,EB,k,L[EB]):u(B,H,E,s,BB,R,O,e,EB,k,L[EB])))return l}else if(EB<zB){var oB;if(J){if(BB<(oB=g(B,H,BB,R,O,e,vB))){var qB=Y(B,H,BB,oB,O,e,vB);if(H===B-2){if(BB<qB&&void 0!==(l=x.sweepComplete(B,E,BB,qB,O,e,EB,zB,k,L)))return l;if(qB<oB&&void 0!==(l=x.sweepBipartite(B,E,qB,oB,O,e,EB,zB,k,L)))return l}else BB<qB&&i(d++,H+1,BB,qB,EB,zB,16,-1/0,1/0),qB<oB&&(i(d++,H+1,qB,oB,EB,zB,0,-1/0,1/0),i(d++,H+1,EB,zB,qB,oB,1,-1/0,1/0))}}else BB<(oB=s?V(B,H,BB,R,O,e,vB):g(B,H,BB,R,O,e,vB))&&(H===B-2?l=s?x.sweepBipartite(B,E,EB,zB,k,L,BB,oB,O,e):x.sweepBipartite(B,E,BB,oB,O,e,EB,zB,k,L):(i(d++,H+1,BB,oB,EB,zB,s,-1/0,1/0),i(d++,H+1,EB,zB,BB,oB,1^s,-1/0,1/0)))}}}}};var z=v(13363),o=v(13366),q=v(13393),c=q.partial,S=q.full,x=v(13377),D=v(13398),h=v(13400),y=128,Q=1<<22,P=1<<22,G=h("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Y=h("lo===p0",["p0"]),a=h("lo<p0",["p0"]),m=h("hi<=p0",["p0"]),g=h("lo<=p0&&p0<=hi",["p0"]),V=h("lo<p0&&p0<=hi",["p0"]),T=6,N=2,X=z.mallocInt32(1024),r=z.mallocDouble(1024);function i(B,E,v,z,o,q,c,S,x){var D=T*B;X[D]=E,X[D+1]=v,X[D+2]=z,X[D+3]=o,X[D+4]=q,X[D+5]=c;var h=N*B;r[h]=S,r[h+1]=x}function u(B,E,v,z,o,q,c,S,x,D,h){var y=2*B,Q=x*y,P=D[Q+E];B:for(var G=o,Y=o*y;G<q;++G,Y+=y){var a=c[Y+E],m=c[Y+E+B];if(!(P<a||m<P)&&(!z||P!==a)){for(var g,V=S[G],T=E+1;T<B;++T){a=c[Y+T],m=c[Y+T+B];var N=D[Q+T],X=D[Q+T+B];if(m<N||X<a)continue B}if(void 0!==(g=z?v(h,V):v(V,h)))return g}}}function I(B,E,v,z,o,q,c,S,x,D){var h=2*B,y=S*h,Q=x[y+E];B:for(var P=z,G=z*h;P<o;++P,G+=h){var Y=c[P];if(Y!==D){var a=q[G+E],m=q[G+E+B];if(!(Q<a||m<Q)){for(var g=E+1;g<B;++g){a=q[G+g],m=q[G+g+B];var V=x[y+g],T=x[y+g+B];if(m<V||T<a)continue B}var N=v(Y,D);if(void 0!==N)return N}}}}},13398:(B,E,v)=>{"use strict";B.exports=function(B,E,v,c,S,x){if(c<=v+1)return v;var D=v,h=c,y=c+v>>>1,Q=2*B,P=y,G=S[Q*y+E];for(;D<h;){if(h-D<o){q(B,E,D,h,S,x),G=S[Q*y+E];break}var Y=h-D,a=Math.random()*Y+D|0,m=S[Q*a+E],g=Math.random()*Y+D|0,V=S[Q*g+E],T=Math.random()*Y+D|0,N=S[Q*T+E];m<=V?N>=V?(P=g,G=V):m>=N?(P=a,G=m):(P=T,G=N):V>=N?(P=g,G=V):N>=m?(P=a,G=m):(P=T,G=N);for(var X=Q*(h-1),r=Q*P,i=0;i<Q;++i,++X,++r){var u=S[X];S[X]=S[r],S[r]=u}var I=x[h-1];x[h-1]=x[P],x[P]=I;for(X=Q*(h-1),r=Q*(P=z(B,E,D,h-1,S,x,G)),i=0;i<Q;++i,++X,++r){u=S[X];S[X]=S[r],S[r]=u}I=x[h-1];if(x[h-1]=x[P],x[P]=I,y<P){for(h=P-1;D<h&&S[Q*(h-1)+E]===G;)h-=1;h+=1}else{if(!(P<y))break;for(D=P+1;D<h&&S[Q*D+E]===G;)D+=1}}return z(B,E,v,y,S,x,S[Q*y+E])};var z=v(13400)("lo<p0",["p0"]),o=8;function q(B,E,v,z,o,q){for(var c=2*B,S=c*(v+1)+E,x=v+1;x<z;++x,S+=c)for(var D=o[S],h=x,y=c*(x-1);h>v&&o[y+E]>D;--h,y-=c){for(var Q=y,P=y+c,G=0;G<c;++G,++Q,++P){var Y=o[Q];o[Q]=o[P],o[P]=Y}var a=q[h];q[h]=q[h-1],q[h-1]=a}}},13400:B=>{"use strict";B.exports=function(B,v){var z="abcdef".split("").concat(v),o=[];B.indexOf("lo")>=0&&o.push("lo=e[k+n]");B.indexOf("hi")>=0&&o.push("hi=e[k+o]");return z.push(E.replace("_",o.join()).replace("$",B)),Function.apply(void 0,z)};var E="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13385:B=>{"use strict";B.exports=function(B,z){z<=4*E?v(0,z-1,B):D(0,z-1,B)};var E=32;function v(B,E,v){for(var z=2*(B+1),o=B+1;o<=E;++o){for(var q=v[z++],c=v[z++],S=o,x=z-2;S-- >B;){var D=v[x-2],h=v[x-1];if(D<q)break;if(D===q&&h<c)break;v[x]=D,v[x+1]=h,x-=2}v[x]=q,v[x+1]=c}}function z(B,E,v){E*=2;var z=v[B*=2],o=v[B+1];v[B]=v[E],v[B+1]=v[E+1],v[E]=z,v[E+1]=o}function o(B,E,v){E*=2,v[B*=2]=v[E],v[B+1]=v[E+1]}function q(B,E,v,z){E*=2,v*=2;var o=z[B*=2],q=z[B+1];z[B]=z[E],z[B+1]=z[E+1],z[E]=z[v],z[E+1]=z[v+1],z[v]=o,z[v+1]=q}function c(B,E,v,z,o){E*=2,o[B*=2]=o[E],o[E]=v,o[B+1]=o[E+1],o[E+1]=z}function S(B,E,v){E*=2;var z=v[B*=2],o=v[E];return!(z<o)&&(z!==o||v[B+1]>v[E+1])}function x(B,E,v,z){var o=z[B*=2];return o<E||o===E&&z[B+1]<v}function D(B,h,y){var Q=(h-B+1)/6|0,P=B+Q,G=h-Q,Y=B+h>>1,a=Y-Q,m=Y+Q,g=P,V=a,T=Y,N=m,X=G,r=B+1,i=h-1,u=0;S(g,V,y)&&(u=g,g=V,V=u),S(N,X,y)&&(u=N,N=X,X=u),S(g,T,y)&&(u=g,g=T,T=u),S(V,T,y)&&(u=V,V=T,T=u),S(g,N,y)&&(u=g,g=N,N=u),S(T,N,y)&&(u=T,T=N,N=u),S(V,X,y)&&(u=V,V=X,X=u),S(V,T,y)&&(u=V,V=T,T=u),S(N,X,y)&&(u=N,N=X,X=u);for(var I=y[2*V],K=y[2*V+1],C=y[2*N],f=y[2*N+1],A=2*g,l=2*T,d=2*X,t=2*P,p=2*Y,H=2*G,j=0;j<2;++j){var R=y[A+j],b=y[l+j],F=y[d+j];y[t+j]=R,y[p+j]=b,y[H+j]=F}o(a,B,y),o(m,h,y);for(var W=r;W<=i;++W)if(x(W,I,K,y))W!==r&&z(W,r,y),++r;else if(!x(W,C,f,y))for(;;){if(x(i,C,f,y)){x(i,I,K,y)?(q(W,r,i,y),++r,--i):(z(W,i,y),--i);break}if(--i<W)break}c(B,r-1,I,K,y),c(h,i+1,C,f,y),r-2-B<=E?v(B,r-2,y):D(B,r-2,y),h-(i+2)<=E?v(i+2,h,y):D(i+2,h,y),i-r<=E?v(r,i,y):D(r,i,y)}},13377:(B,E,v)=>{"use strict";B.exports={init:function(B){var E=o.nextPow2(B);x.length<E&&(z.free(x),x=z.mallocInt32(E));D.length<E&&(z.free(D),D=z.mallocInt32(E));h.length<E&&(z.free(h),h=z.mallocInt32(E));y.length<E&&(z.free(y),y=z.mallocInt32(E));Q.length<E&&(z.free(Q),Q=z.mallocInt32(E));P.length<E&&(z.free(P),P=z.mallocInt32(E));var v=8*E;G.length<v&&(z.free(G),G=z.mallocDouble(v))},sweepBipartite:function(B,E,v,z,o,S,Q,P,m,g){for(var V=0,T=2*B,N=B-1,X=T-1,r=v;r<z;++r){var i=S[r],u=T*r;G[V++]=o[u+N],G[V++]=-(i+1),G[V++]=o[u+X],G[V++]=i}for(r=Q;r<P;++r){i=g[r]+c;var I=T*r;G[V++]=m[I+N],G[V++]=-i,G[V++]=m[I+X],G[V++]=i}var K=V>>>1;q(G,K);var C=0,f=0;for(r=0;r<K;++r){var A=0|G[2*r+1];if(A>=c)Y(h,y,f--,A=A-c|0);else if(A>=0)Y(x,D,C--,A);else if(A<=-c){A=-A-c|0;for(var l=0;l<C;++l){if(void 0!==(d=E(x[l],A)))return d}a(h,y,f++,A)}else{A=-A-1|0;for(l=0;l<f;++l){var d;if(void 0!==(d=E(A,h[l])))return d}a(x,D,C++,A)}}},sweepComplete:function(B,E,v,z,o,c,S,m,g,V){for(var T=0,N=2*B,X=B-1,r=N-1,i=v;i<z;++i){var u=c[i]+1<<1,I=N*i;G[T++]=o[I+X],G[T++]=-u,G[T++]=o[I+r],G[T++]=u}for(i=S;i<m;++i){u=V[i]+1<<1;var K=N*i;G[T++]=g[K+X],G[T++]=1|-u,G[T++]=g[K+r],G[T++]=1|u}var C=T>>>1;q(G,C);var f=0,A=0,l=0;for(i=0;i<C;++i){var d=0|G[2*i+1],t=1&d;if(i<C-1&&d>>1===G[2*i+3]>>1&&(t=2,i+=1),d<0){for(var p=-(d>>1)-1,H=0;H<l;++H){if(void 0!==(j=E(Q[H],p)))return j}if(0!==t)for(H=0;H<f;++H){if(void 0!==(j=E(x[H],p)))return j}if(1!==t)for(H=0;H<A;++H){var j;if(void 0!==(j=E(h[H],p)))return j}0===t?a(x,D,f++,p):1===t?a(h,y,A++,p):2===t&&a(Q,P,l++,p)}else{p=(d>>1)-1;0===t?Y(x,D,f--,p):1===t?Y(h,y,A--,p):2===t&&Y(Q,P,l--,p)}}},scanBipartite:function(B,E,v,z,o,S,h,y,Q,P,m,g){var V=0,T=2*B,N=E,X=E+B,r=1,i=1;z?i=c:r=c;for(var u=o;u<S;++u){var I=u+r,K=T*u;G[V++]=h[K+N],G[V++]=-I,G[V++]=h[K+X],G[V++]=I}for(u=Q;u<P;++u){I=u+i;var C=T*u;G[V++]=m[C+N],G[V++]=-I}var f=V>>>1;q(G,f);var A=0;for(u=0;u<f;++u){var l=0|G[2*u+1];if(l<0){var d=!1;if((I=-l)>=c?(d=!z,I-=c):(d=!!z,I-=1),d)a(x,D,A++,I);else{var t=g[I],p=T*I,H=m[p+E+1],j=m[p+E+1+B];B:for(var R=0;R<A;++R){var b=x[R],F=T*b;if(!(j<h[F+E+1]||h[F+E+1+B]<H)){for(var W=E+2;W<B;++W)if(m[p+W+B]<h[F+W]||h[F+W+B]<m[p+W])continue B;var w,n=y[b];if(void 0!==(w=z?v(t,n):v(n,t)))return w}}}}else Y(x,D,A--,l-r)}},scanComplete:function(B,E,v,z,o,S,D,h,y,Q,P){for(var Y=0,a=2*B,m=E,g=E+B,V=z;V<o;++V){var T=V+c,N=a*V;G[Y++]=S[N+m],G[Y++]=-T,G[Y++]=S[N+g],G[Y++]=T}for(V=h;V<y;++V){T=V+1;var X=a*V;G[Y++]=Q[X+m],G[Y++]=-T}var r=Y>>>1;q(G,r);var i=0;for(V=0;V<r;++V){var u=0|G[2*V+1];if(u<0){if((T=-u)>=c)x[i++]=T-c;else{var I=P[T-=1],K=a*T,C=Q[K+E+1],f=Q[K+E+1+B];B:for(var A=0;A<i;++A){var l=x[A],d=D[l];if(d===I)break;var t=a*l;if(!(f<S[t+E+1]||S[t+E+1+B]<C)){for(var p=E+2;p<B;++p)if(Q[K+p+B]<S[t+p]||S[t+p+B]<Q[K+p])continue B;var H=v(d,I);if(void 0!==H)return H}}}}else{for(T=u-c,A=i-1;A>=0;--A)if(x[A]===T){for(p=A+1;p<i;++p)x[p-1]=x[p];break}--i}}}};var z=v(13363),o=v(13366),q=v(13385),c=1<<28,S=1024,x=z.mallocInt32(S),D=z.mallocInt32(S),h=z.mallocInt32(S),y=z.mallocInt32(S),Q=z.mallocInt32(S),P=z.mallocInt32(S),G=z.mallocDouble(8192);function Y(B,E,v,z){var o=E[z],q=B[v-1];B[o]=q,E[q]=o}function a(B,E,v,z){B[v]=z,E[z]=v}},13370:B=>{"use strict";function E(B,v,z){var o=0|B[z];if(o<=0)return[];var q,c=new Array(o);if(z===B.length-1)for(q=0;q<o;++q)c[q]=v;else for(q=0;q<o;++q)c[q]=E(B,v,z+1);return c}B.exports=function(B,v){switch("undefined"===typeof v&&(v=0),typeof B){case"number":if(B>0)return function(B,E){var v,z;for(v=new Array(B),z=0;z<B;++z)v[z]=E;return v}(0|B,v);break;case"object":if("number"===typeof B.length)return E(B,v,0)}return[]}},13328:(B,E,v)=>{B.exports=function(){var B=this;this.components={},this.comps=this.components;var E=this.components,v=1,o={},q=[],c=[],S={timeout:!1,removals:[],multiComps:[]};function x(B,v){var z=E[v],q=o[v],c=q.hash[B];c&&(q.remove(B),z.tv&&(z.multi?(c.forEach((E=>{E&&z.tv(B,E)})),c.length=0):z.tv(B,c)),S.removals.push(q),D())}function D(){S.timeout||(S.timeout=!0,setTimeout(h,1))}function h(){S.timeout=!1,y()}function y(){S.multiComps.length&&function(B){for(var E=0;E<B.length;E++){var{entID:v,data:z}=B[E],o=z.hash[v];if(o){for(var q=0;q<o.length;q++)o[q]||(o.splice(q,1),q--);0===o.length&&(z.remove(v),S.removals.push(z))}}B.length=0}(S.multiComps),S.removals.length&&function(B){for(var E=0;E<B.length;E++){B[E].flush()}B.length=0}(S.removals)}this.vQ=o,this._systems=q,this._renderSystems=c,this.Ah=function(E){var z=v++;return Array.isArray(E)&&E.forEach((E=>B.oD(z,E))),z},this.deleteEntity=function(E){return Object.keys(o).forEach((B=>{o[B].hash[E]&&x(E,B)})),B},this.Zh=function(B){if(!B)throw new Error("Missing component definition");var v=B.name;if(!v)throw new Error("Component definition must have a name property.");if("string"!==typeof v)throw new Error("Component name must be a string.");if(""===v)throw new Error("Component name must be a non-empty string.");if(o[v])throw new Error(`Component ${v} already exists.`);var S={};return S.name=v,S.multi=!!B.multi,S.order=isNaN(B.order)?99:B.order,S.stateConstructor=B.stateConstructor||null,S.state=B.state||{},S.OS=B.OS||null,S.tv=B.tv||null,S.system=B.system||null,S.Bx=B.Bx||null,E[v]=S,o[v]=new z,o[v]._pendingMultiCleanup=!1,o[v]._multiCleanupIDs=S.multi?[]:null,S.system&&(q.push(v),q.sort(((B,v)=>E[B].order-E[v].order))),S.Bx&&(c.push(v),c.sort(((B,v)=>E[B].order-E[v].order))),v},this.overwriteComponent=function(B,v){var z=E[B];if(!z)throw new Error(`Unknown component: ${B}`);if(!v)throw new Error("Missing component definition");if(z.name!==v.name)throw new Error("Overwriting component must use the same name property.");var S={};S.name=B,S.multi=!!v.multi,S.order=isNaN(v.order)?99:v.order,S.state=v.state||{},S.OS=v.OS||null,S.tv=v.tv||null,S.system=v.system||null,S.Bx=v.Bx||null,E[B]=S,o[B]._pendingMultiCleanup=!1,o[B]._multiCleanupIDs=S.multi?[]:null;var x=q.indexOf(B);S.system&&x<0&&q.push(B),!S.system&&x>=0&&q.splice(x,1),q.sort(((B,v)=>E[B].order-E[v].order));var D=c.indexOf(B);S.Bx&&D<0&&c.push(B),!S.Bx&&D>=0&&c.splice(D,1),c.sort(((B,v)=>E[B].order-E[v].order));var h=S.state;return this.qh(B).forEach((B=>{for(var E in h)E in B||(B[E]=h[E]);S.OS&&S.OS(B.MS,B)})),B},this.deleteComponent=function(v){var z=o[v];if(!z)throw new Error(`Unknown component: ${v}`);z.flush(),z.list.forEach((B=>{B&&x(B.MS||B[0].MS,v)}));var S=q.indexOf(v),D=c.indexOf(v);return S>-1&&q.splice(S,1),D>-1&&c.splice(D,1),o[v].dispose(),delete o[v],delete E[v],B},this.oD=function(B,v,z){var q,c=E[v],S=o[v];if(!S)throw new Error(`Unknown component: ${v}.`);if(S.hash[B]&&!c.multi)throw new Error(`Entity ${B} already has component: ${v}.`);if(c.stateConstructor){if(!(q=new c.stateConstructor).hasOwnProperty("MS"))throw new Error(`Component ${c.name} stateConstructor type does not have property __id`)}else q=Object.assign({},{MS:B},c.state,z);if(q.MS=B,c.multi){var x=S.hash[B];x||(x=[],S.add(B,x)),x.push(q)}else S.add(B,q);return c.OS&&c.OS(B,q),this},this.GD=function(B,E){var v=o[E];if(!v)throw new Error(`Unknown component: ${E}.`);return!!v.hash[B]},this.xD=function(E,v){if(!o[v])throw new Error(`Unknown component: ${v}.`);return x(E,v),B},this.getState=function(B,E){var v=o[E];if(!v)throw new Error(`Unknown component: ${E}.`);return v.hash[B]},this.qh=function(B){var E=o[B];if(!E)throw new Error(`Unknown component: ${B}.`);return y(),E.list},this.nP=function(B){if(!o[B])throw new Error(`Unknown component: ${B}.`);var E=o[B].hash;return B=>E[B]},this.JP=function(B){if(!o[B])throw new Error(`Unknown component: ${B}.`);var E=o[B].hash;return B=>!!E[B]},this.nS=function(v){y();for(var z=0;z<q.length;z++){var c=q[z],S=E[c],x=o[c];S.system(v,x.list),y()}return B},this.render=function(v){y();for(var z=0;z<c.length;z++){var q=c[z],S=E[q],x=o[q];S.Bx(v,x.list),y()}return B},this.removeMultiComponent=function(v,z,q){var c=E[z],x=o[z];if(!x)throw new Error(`Unknown component: ${z}.`);if(!c.multi)throw new Error("removeMultiComponent called on non-multi component");return function(B,E,v,z){var o=v.hash[B];if(o){var q=o[z];q&&(o[z]=null,E.tv&&E.tv(B,q),S.multiComps.push({entID:B,data:v}),D())}}(v,c,x,q),B}};var z=v(13334)},13334:B=>{function E(B,E){var v=B._map[E];if(delete B.hash[E],delete B._map[E],v===B.list.length-1)B.list.pop();else{var z=B.list.pop();if(B.list[v]=z,null===z||null===z[0]){var o=B.list.length;for(var q in B._map)if(B._map[q]===o)return void(B._map[q]=v)}else{var c=z.MS||z[0].MS;B._map[c]=v}}}B.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(B,E){if("number"===typeof this._map[B]){var v=this._map[B];this.hash[B]=E,this.list[v]=E}else this._map[B]=this.list.length,this.hash[B]=E,this.list.push(E)}remove(B){var E=this._map[B];this.hash[B]=null,this.list[E]=null,this._pendingRemovals.push(B)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var B=0;B<this._pendingRemovals.length;B++){var v=this._pendingRemovals[B];null===this.hash[v]&&E(this,v)}this._pendingRemovals.length=0}}},13291:B=>{"use strict";var E,v="object"===typeof Reflect?Reflect:null,z=function(B,E,v){return Function.prototype.apply.call(B,E,v)};E=v&&"function"===typeof v.ownKeys?v.ownKeys:Object.getOwnPropertySymbols?function(B){return Object.getOwnPropertyNames(B).concat(Object.getOwnPropertySymbols(B))}:function(B){return Object.getOwnPropertyNames(B)};var o=Number.isNaN||function(B){return B!==B};function q(){q.init.call(this)}B.exports=q,B.exports.once=function(B,E){return new Promise((function(v,z){function o(v){B.removeListener(E,q),z(v)}function q(){"function"===typeof B.removeListener&&B.removeListener("error",o),v([].slice.call(arguments))}Y(B,E,q,{once:!0}),"error"!==E&&function(B,E,v){"function"===typeof B.on&&Y(B,"error",E,v)}(B,o,{once:!0})}))},q.EventEmitter=q,q.prototype._events=void 0,q.prototype._eventsCount=0,q.prototype._maxListeners=void 0;var c=10;function S(B){if("function"!==typeof B)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof B)}function x(B){return void 0===B._maxListeners?q.defaultMaxListeners:B._maxListeners}function D(B,E,v,z){var o,q,c,D;if(S(v),void 0===(q=B._events)?(q=B._events=Object.create(null),B._eventsCount=0):(void 0!==q.newListener&&(B.emit("newListener",E,v.listener?v.listener:v),q=B._events),c=q[E]),void 0===c)c=q[E]=v,++B._eventsCount;else if("function"===typeof c?c=q[E]=z?[v,c]:[c,v]:z?c.unshift(v):c.push(v),(o=x(B))>0&&c.length>o&&!c.warned){c.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.zE=B,h.type=E,h.count=c.length,D=h,console&&console.warn&&console.warn(D)}return B}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(B,E,v){var z={fired:!1,wrapFn:void 0,target:B,type:E,listener:v},o=h.bind(z);return o.listener=v,z.wrapFn=o,o}function Q(B,E,v){var z=B._events;if(void 0===z)return[];var o=z[E];return void 0===o?[]:"function"===typeof o?v?[o.listener||o]:[o]:v?function(B){for(var E=new Array(B.length),v=0;v<E.length;++v)E[v]=B[v].listener||B[v];return E}(o):G(o,o.length)}function P(B){var E=this._events;if(void 0!==E){var v=E[B];if("function"===typeof v)return 1;if(void 0!==v)return v.length}return 0}function G(B,E){for(var v=new Array(E),z=0;z<E;++z)v[z]=B[z];return v}function Y(B,E,v,z){if("function"===typeof B.on)z.once?B.once(E,v):B.on(E,v);else{if("function"!==typeof B.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof B);B.addEventListener(E,(function o(q){z.once&&B.removeEventListener(E,o),v(q)}))}}Object.defineProperty(q,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(B){if("number"!==typeof B||B<0||o(B))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+B+".");c=B}}),q.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},q.prototype.setMaxListeners=function(B){if("number"!==typeof B||B<0||o(B))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+B+".");return this._maxListeners=B,this},q.prototype.getMaxListeners=function(){return x(this)},q.prototype.emit=function(B){for(var E=[],v=1;v<arguments.length;v++)E.push(arguments[v]);var o="error"===B,q=this._events;if(void 0!==q)o=o&&void 0===q.error;else if(!o)return!1;if(o){var c;if(E.length>0&&(c=E[0]),c instanceof Error)throw c;var S=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw S.context=c,S}var x=q[B];if(void 0===x)return!1;if("function"===typeof x)z(x,this,E);else{var D=x.length,h=G(x,D);for(v=0;v<D;++v)z(h[v],this,E)}return!0},q.prototype.addListener=function(B,E){return D(this,B,E,!1)},q.prototype.on=q.prototype.addListener,q.prototype.prependListener=function(B,E){return D(this,B,E,!0)},q.prototype.once=function(B,E){return S(E),this.on(B,y(this,B,E)),this},q.prototype.prependOnceListener=function(B,E){return S(E),this.prependListener(B,y(this,B,E)),this},q.prototype.removeListener=function(B,E){var v,z,o,q,c;if(S(E),void 0===(z=this._events))return this;if(void 0===(v=z[B]))return this;if(v===E||v.listener===E)0===--this._eventsCount?this._events=Object.create(null):(delete z[B],z.removeListener&&this.emit("removeListener",B,v.listener||E));else if("function"!==typeof v){for(o=-1,q=v.length-1;q>=0;q--)if(v[q]===E||v[q].listener===E){c=v[q].listener,o=q;break}if(o<0)return this;0===o?v.shift():function(B,E){for(;E+1<B.length;E++)B[E]=B[E+1];B.pop()}(v,o),1===v.length&&(z[B]=v[0]),void 0!==z.removeListener&&this.emit("removeListener",B,c||E)}return this},q.prototype.off=q.prototype.removeListener,q.prototype.oE=function(B){var E,v,z;if(void 0===(v=this._events))return this;if(void 0===v.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==v[B]&&(0===--this._eventsCount?this._events=Object.create(null):delete v[B]),this;if(0===arguments.length){var o,q=Object.keys(v);for(z=0;z<q.length;++z)"removeListener"!==(o=q[z])&&this.oE(o);return this.oE("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(E=v[B]))this.removeListener(B,E);else if(void 0!==E)for(z=E.length-1;z>=0;z--)this.removeListener(B,E[z]);return this},q.prototype.listeners=function(B){return Q(this,B,!0)},q.prototype.rawListeners=function(B){return Q(this,B,!1)},q.listenerCount=function(B,E){return"function"===typeof B.listenerCount?B.listenerCount(E):P.call(B,E)},q.prototype.listenerCount=P,q.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},13593:B=>{"use strict";B.exports=function(B,E,v,z,o,q){var c=+E[0],S=+E[1],x=+E[2],D=+v[0],h=+v[1],y=+v[2],Q=Math.sqrt(D*D+h*h+y*y);if(0===Q)throw new Error("Can't raycast along a zero vector");return function(B,E,v,z,o,q,c,S,x,D){for(var h=0,y=Math.floor,Q=0|y(E),P=0|y(v),G=0|y(z),Y=o>0?1:-1,a=q>0?1:-1,m=c>0?1:-1,g=Math.abs(1/o),V=Math.abs(1/q),T=Math.abs(1/c),N=g<1/0?g*(Y>0?Q+1-E:E-Q):1/0,X=V<1/0?V*(a>0?P+1-v:v-P):1/0,r=T<1/0?T*(m>0?G+1-z:z-G):1/0,i=-1;h<=S;){var u=B(Q,P,G);if(u)return x&&(x[0]=E+h*o,x[1]=v+h*q,x[2]=z+h*c),D&&(D[0]=D[1]=D[2]=0,0===i&&(D[0]=-Y),1===i&&(D[1]=-a),2===i&&(D[2]=-m)),u;N<X?N<r?(Q+=Y,h=N,N+=g,i=0):(G+=m,h=r,r+=T,i=2):X<r?(P+=a,h=X,X+=V,i=1):(G+=m,h=r,r+=T,i=2)}return x&&(x[0]=E+h*o,x[1]=v+h*q,x[2]=z+h*c),D&&(D[0]=D[1]=D[2]=0),0}(B,c,S,x,D/=Q,h/=Q,y/=Q,z="undefined"===typeof z?64:+z,o,q)}},13626:(B,E,v)=>{"use strict";v.d(E,{e:()=>q});var z=v(13291);function o(){this.UQ=!1,this.stopPropagation=!1,this.sQ=!1,this.disabled=!1}class q{constructor(B,E){this.version="0.7.0";var v=Object.assign({},new o,E||{});this.element=B||document,this.UQ=!!v.UQ,this.stopPropagation=!!v.stopPropagation,this.sQ=!!v.sQ,this.disabled=!!v.disabled,this.filterEvents=(B,E)=>!0,this.down=new z.EventEmitter,this.up=new z.EventEmitter,this.state={},this.kD={dx:0,dy:0,tP:0,eD:0,pP:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?S(this):document.addEventListener("DOMContentLoaded",(B=>{S(this)}),{once:!0})}bind(B){for(var E=arguments.length,v=new Array(E>1?E-1:0),z=1;z<E;z++)v[z-1]=arguments[z];v.forEach((E=>{var v=this._keyBindmap[E]||[];v.includes(B)||(v.push(B),this._keyBindmap[E]=v)})),this.state[B]=!!this.state[B],this.pressCount[B]=this.pressCount[B]||0,this.releaseCount[B]=this.releaseCount[B]||0}unbind(B){for(var E in this._keyBindmap){var v=this._keyBindmap[E],z=v.indexOf(B);z>-1&&v.splice(z,1)}}getBindings(){var B={};for(var E in this._keyBindmap){this._keyBindmap[E].forEach((v=>{B[v]=B[v]||[],B[v].push(E)}))}return B}nS(){c(this.kD),c(this.pressCount),c(this.releaseCount)}}function c(B){for(var E in B)B[E]=0}function S(B){window.addEventListener("keydown",G.bind(null,B,!0),!1),window.addEventListener("keyup",G.bind(null,B,!1),!1);var E={passive:!0};B.element.addEventListener("touchstart",y.bind(void 0,B),{passive:!1}),B.element.addEventListener("touchend",P.bind(void 0,B),E),B.element.addEventListener("mousedown",Y.bind(null,B,!0),E),window.document.addEventListener("mouseup",Y.bind(null,B,!1),E),B.element.addEventListener("touchmove",a.bind(null,B),E),B.element.addEventListener("mousemove",a.bind(null,B),E),window.PointerEvent,B.element.addEventListener("wheel",m.bind(null,B),E),B.element.addEventListener("contextmenu",g.bind(null,B),!1),window.addEventListener("blur",V.bind(null,B),!1)}var x=0,D=0,h=null;function y(B,E){E.preventDefault(),Q(E)}function Q(B){let E=!1;for(let v=0;v<B.touches.length;++v)if(B.touches[v].identifier===h){E=!0;break}if(!E){const E=B.changedTouches[0];x=E.clientX,D=E.clientY,h=E.identifier}}function P(B,E){for(var v=E.changedTouches,z=0;z<v.length;++z)v[z].identifier===h&&(h=null)}function G(B,E,v){T(v.code,E,B,v)}function Y(B,E,v){if("pointerId"in v)if(E){if(null!==B._touches.currID)return;B._touches.currID=v.pointerId}else{if(B._touches.currID!==v.pointerId)return;B._touches.currID=null}return T("Mouse"+("button"in v?v.button+1:1),E,B,v),!1}function a(B,E){var v=E.movementX||E.mozMovementX||0,z=E.movementY||E.mozMovementY||0;if(E.touches&&0===(v|z)){var o=function(B){Q(B);for(let E=0;E<B.changedTouches.length;++E)if(B.changedTouches[E].identifier==h){const v=B.changedTouches[E],z=[v.clientX-x,v.clientY-D];return x=v.clientX,D=v.clientY,z}return console.error(`Did not find touch id ${h}`),[0,0]}(E);v=o[0],z=o[1]}B.kD.dx+=v,B.kD.dy+=z}function m(B,E){var v=1;switch(E.deltaMode){case 0:v=1;break;case 1:v=12;break;case 2:v=B.element.clientHeight||window.innerHeight}B.kD.tP+=(E.deltaX||0)*v,B.kD.eD+=(E.deltaY||0)*v,B.kD.pP+=(E.deltaZ||0)*v}function g(B,E){if(!B.sQ)return E.preventDefault(),!1}function V(B){for(var E in B._keyStates)B._keyStates[E]&&(/^Mouse\d/.test(E)||T(E,!1,B,{code:E,note:"8oaib90gj72",preventDefault:()=>{},stopPropagation:()=>{}}))}function T(B,E,v,z){var o=v._keyBindmap[B];o&&(N(v._keyStates[B],E)&&(v._keyStates[B]=E,o.forEach((B=>{(!v.filterEvents||v.filterEvents(z,B))&&function(B,E,v,z){var o=E?v.pressCount:v.releaseCount;o[B]=(o[B]||0)+1;var q=v._bindPressCount[B]||0;(q+=E?1:-1)<0&&(q=0);v._bindPressCount[B]=q;var c=v.state[B];if(N(c,q)){v.state[B]=q>0;var S=E?v.down:v.up;v.disabled||S.emit(B,z)}}(B,E,v,z)}))),"button"in z||(v.UQ&&!z.defaultPrevented&&z.preventDefault(),v.stopPropagation&&z.stopPropagation()))}function N(B,E){return B?!E:E}},12242:B=>{B.exports=function(B,E,v){return B[0]=E[0]+v[0],B[1]=E[1]+v[1],B[2]=E[2]+v[2],B}},12202:(B,E,v)=>{B.exports=function(B,E){var v=z(B[0],B[1],B[2]),c=z(E[0],E[1],E[2]);o(v,v),o(c,c);var S=q(v,c);return S>1?0:Math.acos(S)};var z=v(12207),o=v(12216),q=v(12220)},12305:B=>{B.exports=function(B,E){return B[0]=Math.ceil(E[0]),B[1]=Math.ceil(E[1]),B[2]=Math.ceil(E[2]),B}},12199:B=>{B.exports=function(B){var E=new Float32Array(3);return E[0]=B[0],E[1]=B[1],E[2]=B[2],E}},12227:B=>{B.exports=function(B,E){return B[0]=E[0],B[1]=E[1],B[2]=E[2],B}},12197:B=>{B.exports=function(){var B=new Float32Array(3);return B[0]=0,B[1]=0,B[2]=0,B}},12393:B=>{B.exports=function(B,E,v){var z=E[0],o=E[1],q=E[2],c=v[0],S=v[1],x=v[2];return B[0]=o*x-q*S,B[1]=q*c-z*x,B[2]=z*S-o*c,B}},12333:(B,E,v)=>{B.exports=v(12324)},12324:B=>{B.exports=function(B,E){var v=E[0]-B[0],z=E[1]-B[1],o=E[2]-B[2];return Math.sqrt(v*v+z*z+o*o)}},12278:(B,E,v)=>{B.exports=v(12271)},12271:B=>{B.exports=function(B,E,v){return B[0]=E[0]/v[0],B[1]=E[1]/v[1],B[2]=E[2]/v[2],B}},12220:B=>{B.exports=function(B,E){return B[0]*E[0]+B[1]*E[1]+B[2]*E[2]}},12193:B=>{B.exports=1e-6},12237:(B,E,v)=>{B.exports=function(B,E){var v=B[0],o=B[1],q=B[2],c=E[0],S=E[1],x=E[2];return Math.abs(v-c)<=z*Math.max(1,Math.abs(v),Math.abs(c))&&Math.abs(o-S)<=z*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(q-x)<=z*Math.max(1,Math.abs(q),Math.abs(x))};var z=v(12193)},12239:B=>{B.exports=function(B,E){return B[0]===E[0]&&B[1]===E[1]&&B[2]===E[2]}},12296:B=>{B.exports=function(B,E){return B[0]=Math.floor(E[0]),B[1]=Math.floor(E[1]),B[2]=Math.floor(E[2]),B}},12448:(B,E,v)=>{B.exports=function(B,E,v,o,q,c){var S,x;E||(E=3);v||(v=0);x=o?Math.min(o*E+v,B.length):B.length;for(S=v;S<x;S+=E)z[0]=B[S],z[1]=B[S+1],z[2]=B[S+2],q(z,z,c),B[S]=z[0],B[S+1]=z[1],B[S+2]=z[2];return B};var z=v(12197)()},12207:B=>{B.exports=function(B,E,v){var z=new Float32Array(3);return z[0]=B,z[1]=E,z[2]=v,z}},12184:(B,E,v)=>{B.exports={EPSILON:v(12193),create:v(12197),clone:v(12199),angle:v(12202),tS:v(12207),k:v(12227),set:v(12230),equals:v(12237),exactEquals:v(12239),add:v(12242),YE:v(12246),sub:v(12254),multiply:v(12261),mul:v(12268),divide:v(12271),div:v(12278),min:v(12280),max:v(12288),floor:v(12296),ceil:v(12305),round:v(12310),scale:v(12313),pS:v(12315),distance:v(12324),i:v(12333),squaredDistance:v(12341),sqrDist:v(12343),length:v(12352),len:v(12357),squaredLength:v(12366),HS:v(12371),negate:v(12380),inverse:v(12389),normalize:v(12216),dot:v(12220),cross:v(12393),AS:v(12399),random:v(12404),transformMat4:v(12412),transformMat3:v(12421),transformQuat:v(12424),jS:v(12429),RS:v(12438),bS:v(12442),forEach:v(12448)}},12389:B=>{B.exports=function(B,E){return B[0]=1/E[0],B[1]=1/E[1],B[2]=1/E[2],B}},12357:(B,E,v)=>{B.exports=v(12352)},12352:B=>{B.exports=function(B){var E=B[0],v=B[1],z=B[2];return Math.sqrt(E*E+v*v+z*z)}},12399:B=>{B.exports=function(B,E,v,z){var o=E[0],q=E[1],c=E[2];return B[0]=o+z*(v[0]-o),B[1]=q+z*(v[1]-q),B[2]=c+z*(v[2]-c),B}},12288:B=>{B.exports=function(B,E,v){return B[0]=Math.max(E[0],v[0]),B[1]=Math.max(E[1],v[1]),B[2]=Math.max(E[2],v[2]),B}},12280:B=>{B.exports=function(B,E,v){return B[0]=Math.min(E[0],v[0]),B[1]=Math.min(E[1],v[1]),B[2]=Math.min(E[2],v[2]),B}},12268:(B,E,v)=>{B.exports=v(12261)},12261:B=>{B.exports=function(B,E,v){return B[0]=E[0]*v[0],B[1]=E[1]*v[1],B[2]=E[2]*v[2],B}},12380:B=>{B.exports=function(B,E){return B[0]=-E[0],B[1]=-E[1],B[2]=-E[2],B}},12216:B=>{B.exports=function(B,E){var v=E[0],z=E[1],o=E[2],q=v*v+z*z+o*o;q>0&&(q=1/Math.sqrt(q),B[0]=E[0]*q,B[1]=E[1]*q,B[2]=E[2]*q);return B}},12404:B=>{B.exports=function(B,E){E=E||1;var v=2*Math.random()*Math.PI,z=2*Math.random()-1,o=Math.sqrt(1-z*z)*E;return B[0]=Math.cos(v)*o,B[1]=Math.sin(v)*o,B[2]=z*E,B}},12429:B=>{B.exports=function(B,E,v,z){var o=v[1],q=v[2],c=E[1]-o,S=E[2]-q,x=Math.sin(z),D=Math.cos(z);return B[0]=E[0],B[1]=o+c*D-S*x,B[2]=q+c*x+S*D,B}},12438:B=>{B.exports=function(B,E,v,z){var o=v[0],q=v[2],c=E[0]-o,S=E[2]-q,x=Math.sin(z),D=Math.cos(z);return B[0]=o+S*x+c*D,B[1]=E[1],B[2]=q+S*D-c*x,B}},12442:B=>{B.exports=function(B,E,v,z){var o=v[0],q=v[1],c=E[0]-o,S=E[1]-q,x=Math.sin(z),D=Math.cos(z);return B[0]=o+c*D-S*x,B[1]=q+c*x+S*D,B[2]=E[2],B}},12310:B=>{B.exports=function(B,E){return B[0]=Math.round(E[0]),B[1]=Math.round(E[1]),B[2]=Math.round(E[2]),B}},12313:B=>{B.exports=function(B,E,v){return B[0]=E[0]*v,B[1]=E[1]*v,B[2]=E[2]*v,B}},12315:B=>{B.exports=function(B,E,v,z){return B[0]=E[0]+v[0]*z,B[1]=E[1]+v[1]*z,B[2]=E[2]+v[2]*z,B}},12230:B=>{B.exports=function(B,E,v,z){return B[0]=E,B[1]=v,B[2]=z,B}},12343:(B,E,v)=>{B.exports=v(12341)},12371:(B,E,v)=>{B.exports=v(12366)},12341:B=>{B.exports=function(B,E){var v=E[0]-B[0],z=E[1]-B[1],o=E[2]-B[2];return v*v+z*z+o*o}},12366:B=>{B.exports=function(B){var E=B[0],v=B[1],z=B[2];return E*E+v*v+z*z}},12254:(B,E,v)=>{B.exports=v(12246)},12246:B=>{B.exports=function(B,E,v){return B[0]=E[0]-v[0],B[1]=E[1]-v[1],B[2]=E[2]-v[2],B}},12421:B=>{B.exports=function(B,E,v){var z=E[0],o=E[1],q=E[2];return B[0]=z*v[0]+o*v[3]+q*v[6],B[1]=z*v[1]+o*v[4]+q*v[7],B[2]=z*v[2]+o*v[5]+q*v[8],B}},12412:B=>{B.exports=function(B,E,v){var z=E[0],o=E[1],q=E[2],c=v[3]*z+v[7]*o+v[11]*q+v[15];return c=c||1,B[0]=(v[0]*z+v[4]*o+v[8]*q+v[12])/c,B[1]=(v[1]*z+v[5]*o+v[9]*q+v[13])/c,B[2]=(v[2]*z+v[6]*o+v[10]*q+v[14])/c,B}},12424:B=>{B.exports=function(B,E,v){var z=E[0],o=E[1],q=E[2],c=v[0],S=v[1],x=v[2],D=v[3],h=D*z+S*q-x*o,y=D*o+x*z-c*q,Q=D*q+c*o-S*z,P=-c*z-S*o-x*q;return B[0]=h*D+P*-c+y*-x-Q*-S,B[1]=y*D+P*-S+Q*-c-h*-x,B[2]=Q*D+P*-x+h*-S-y*-c,B}},13308:B=>{"use strict";B.exports=function(B){for(var E=new Array(B),v=0;v<B;++v)E[v]=v;return E}},13374:B=>{B.exports=function(B){return null!=B&&null!=B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}},13599:(B,E,v)=>{"use strict";v.d(E,{b:()=>z});class z{constructor(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Ny=!1,this.Xy=!1,this.Vy=30,this.Ty=0,this.ty=!1,this.fullscreen=!1,this.uy=function(B){},this.Iy=function(){},this.Ay=function(){},this.mz=function(){},this.Ky=function(B){},this.onFullscreenChanged=function(B){},D((()=>{!function(B,E){B._nowObject=performance||Date,B._lastTick=0,B._renderAccum=0,B._rt=0,B._frameCB=S.bind(null,B),requestAnimationFrame(B._frameCB),E>0&&(B._intervalCB=c.bind(null,B),B._interval=setInterval(B._intervalCB,Math.max(E,1e3/B.Vy/2)))}(this,E),function(B,E){if(!E)return;var v=!1,z=!1;document.addEventListener("pointerlockchange",(z=>{v=document.pointerLockElement===E,B.Ky(v)})),document.addEventListener("fullscreenchange",(v=>{z=document.fullscreenElement===E,B.onFullscreenChanged(z)})),Object.defineProperty(B,"ty",{get:()=>v,set:B=>{B&&!v?x(E):v&&!B&&function(B){B.exitPointerLock&&B.exitPointerLock()}(document)}}),Object.defineProperty(B,"fullscreen",{get:()=>z,set:B=>{B&&!z?E.requestFullscreen():z&&!B&&document.exitFullscreen()}}),E.addEventListener("click",(o=>{B.Ny&&!v&&x(E),B.Xy&&!z&&E.requestFullscreen()}));var o=()=>B.mz();if(window.ResizeObserver){new ResizeObserver(o).observe(E)}else window.addEventListener("resize",o)}(this,B),this.Ay()}))}}var o=3,q=20;function c(B){for(var E=1e3/B.Vy,v=B._nowObject.now()+q,z=0;B._nowObject.now()>=B._lastTick+E&&B._nowObject.now()<v&&++z<=o;)B.uy(E),B._lastTick+=E;var c=5*(E+5),S=B._nowObject.now();if(S-B._lastTick>c)for(;S>=B._lastTick+E;)B._lastTick+=E}function S(B){requestAnimationFrame(B._frameCB),c(B);var E=B._nowObject.now(),v=E-B._rt;if(B._rt=E,B.Ty>0){B._renderAccum+=v;var z=1e3/B.Ty;if(B._renderAccum<z)return;B._renderAccum=Math.min(B._renderAccum-z,z)}var o=1e3/B.Vy,q=(E-B._lastTick)/o;B.Iy(v,q,o)}function x(B){B.requestPointerLock&&B.requestPointerLock()}var D=B=>{if("loading"===document.readyState){var E=()=>{document.removeEventListener("readystatechange",E),B()};document.addEventListener("readystatechange",E)}else setTimeout(B,1)}},13305:(B,E,v)=>{var z=v(13308),o=v(13315),q="undefined"!==typeof Float64Array;function c(B,E){return B[0]-E[0]}function S(){var B,E=this.stride,v=new Array(E.length);for(B=0;B<v.length;++B)v[B]=[Math.abs(E[B]),B];v.sort(c);var z=new Array(v.length);for(B=0;B<z.length;++B)z[B]=v[B][1];return z}function x(B,E){var v=["View",E,"d",B].join("");E<0&&(v="View_Nil"+B);var o="generic"===B;if(-1===E){var q="function "+v+"(a){this.data=a;};var proto="+v+".prototype;proto.dtype='"+B+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+v+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+v+"(a){return new "+v+"(a);}";return new Function(q)()}if(0===E){q="function "+v+"(a,d) {this.data = a;this.offset = d};var proto="+v+".prototype;proto.dtype='"+B+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+v+"_copy() {return new "+v+"(this.data,this.offset)};proto.pick=function "+v+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+v+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+v+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+v+"(a,b,c,d){return new "+v+"(a,d)}";return new Function("TrivialArray",q)(D[B][0])}q=["'use strict'"];var c=z(E),x=c.map((function(B){return"i"+B})),h="this.offset+"+c.map((function(B){return"this.stride["+B+"]*i"+B})).join("+"),y=c.map((function(B){return"b"+B})).join(","),Q=c.map((function(B){return"c"+B})).join(",");q.push("function "+v+"(a,"+y+","+Q+",d){this.data=a","this.shape=["+y+"]","this.stride=["+Q+"]","this.offset=d|0}","var proto="+v+".prototype","proto.dtype='"+B+"'","proto.dimension="+E),q.push("Object.defineProperty(proto,'size',{get:function "+v+"_size(){return "+c.map((function(B){return"this.shape["+B+"]"})).join("*"),"}})"),1===E?q.push("proto.order=[0]"):(q.push("Object.defineProperty(proto,'order',{get:"),E<4?(q.push("function "+v+"_order(){"),2===E?q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):q.push("ORDER})")),q.push("proto.set=function "+v+"_set("+x.join(",")+",v){"),o?q.push("return this.data.set("+h+",v)}"):q.push("return this.data["+h+"]=v}"),q.push("proto.get=function "+v+"_get("+x.join(",")+"){"),o?q.push("return this.data.get("+h+")}"):q.push("return this.data["+h+"]}"),q.push("proto.index=function "+v+"_index(",x.join(),"){return "+h+"}"),q.push("proto.hi=function "+v+"_hi("+x.join(",")+"){return new "+v+"(this.data,"+c.map((function(B){return["(typeof i",B,"!=='number'||i",B,"<0)?this.shape[",B,"]:i",B,"|0"].join("")})).join(",")+","+c.map((function(B){return"this.stride["+B+"]"})).join(",")+",this.offset)}");var P=c.map((function(B){return"a"+B+"=this.shape["+B+"]"})),G=c.map((function(B){return"c"+B+"=this.stride["+B+"]"}));q.push("proto.lo=function "+v+"_lo("+x.join(",")+"){var b=this.offset,d=0,"+P.join(",")+","+G.join(","));for(var Y=0;Y<E;++Y)q.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");q.push("return new "+v+"(this.data,"+c.map((function(B){return"a"+B})).join(",")+","+c.map((function(B){return"c"+B})).join(",")+",b)}"),q.push("proto.step=function "+v+"_step("+x.join(",")+"){var "+c.map((function(B){return"a"+B+"=this.shape["+B+"]"})).join(",")+","+c.map((function(B){return"b"+B+"=this.stride["+B+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<E;++Y)q.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");q.push("return new "+v+"(this.data,"+c.map((function(B){return"a"+B})).join(",")+","+c.map((function(B){return"b"+B})).join(",")+",c)}");var a=new Array(E),m=new Array(E);for(Y=0;Y<E;++Y)a[Y]="a[i"+Y+"]",m[Y]="b[i"+Y+"]";q.push("proto.transpose=function "+v+"_transpose("+x+"){"+x.map((function(B,E){return B+"=("+B+"===undefined?"+E+":"+B+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+v+"(this.data,"+a.join(",")+","+m.join(",")+",this.offset)}"),q.push("proto.pick=function "+v+"_pick("+x+"){var a=[],b=[],c=this.offset");for(Y=0;Y<E;++Y)q.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),q.push("return function construct_"+v+"(data,shape,stride,offset){return new "+v+"(data,"+c.map((function(B){return"shape["+B+"]"})).join(",")+","+c.map((function(B){return"stride["+B+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",q.join("\n"))(D[B],S)}var D={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};B.exports=function(B,E,v,z){if(void 0===B)return(0,D.array[0])([]);"number"===typeof B&&(B=[B]),void 0===E&&(E=[B.length]);var c=E.length;if(void 0===v){v=new Array(c);for(var S=c-1,h=1;S>=0;--S)v[S]=h,h*=E[S]}if(void 0===z){z=0;for(S=0;S<c;++S)v[S]<0&&(z-=(E[S]-1)*v[S])}for(var y=function(B){if(o(B))return"buffer";if(q)switch(Object.prototype.toString.call(B)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(B)?"array":"generic"}(B),Q=D[y];Q.length<=c+1;)Q.push(x(y,Q.length-1));return(0,Q[c+1])(B,E,v,z)}},13315:B=>{function E(B){return!!B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}B.exports=function(B){return null!=B&&(E(B)||function(B){return"function"===typeof B.readFloatLE&&"function"===typeof B.slice&&E(B.slice(0,0))}(B)||!!B._isBuffer)}},13444:B=>{"use strict";var E=[],v=[],z=[],o=[],q=[],c=[],S=[],x=[],D=[],h=[],y=[],Q=[];B.exports=function(B,P,G,Y,a,m){for(var g=S,V=D,T=h,N=Q,X=0;X<3;X++)g[X]=+G[X],T[X]=+P.max[X],V[X]=+P.base[X];m||(m=1e-10);var r=function(B,S,D,h,Q,P){var G=E,Y=v,a=z,m=o,g=q,V=c,T=x,N=Math.floor,X=0,r=0,i=0,u=0,I=0;if(K(),0===i)return 0;for(u=A();r<=i;){if(C(u)&&f())return X;u=A()}for(X+=i,I=0;I<3;I++)h[I]+=D[I],Q[I]+=D[I];return X;function K(){if(r=0,0!==(i=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])))for(var B=0;B<3;B++){var E=D[B]>=0;m[B]=E?1:-1;var v=E?Q[B]:h[B];G[B]=E?h[B]:Q[B],Y[B]=l(v,m[B]),a[B]=d(G[B],m[B]),T[B]=D[B]/i,g[B]=Math.abs(1/T[B]);var z=E?Y[B]+1-v:v-Y[B];V[B]=g[B]<1/0?g[B]*z:1/0}}function C(E){for(var v=m[0],z=0===E?Y[0]:a[0],o=Y[0]+v,q=m[1],c=1===E?Y[1]:a[1],S=Y[1]+q,x=m[2],D=2===E?Y[2]:a[2],h=Y[2]+x,y=z;y!=o;y+=v)for(var Q=c;Q!=S;Q+=q)for(var P=D;P!=h;P+=x)if(B(y,Q,P))return!0;return!1}function f(){X+=r;var B=m[u],E=r/i,v=y;for(I=0;I<3;I++){var z=D[I]*E;h[I]+=z,Q[I]+=z,v[I]=D[I]-z}if(B>0?Q[u]=Math.round(Q[u]):h[u]=Math.round(h[u]),S(X,u,B,v))return!0;for(I=0;I<3;I++)D[I]=v[I];return K(),0===i}function A(){var B=V[0]<V[1]?V[0]<V[2]?0:2:V[1]<V[2]?1:2,E=V[B]-r;for(r=V[B],Y[B]+=m[B],V[B]+=g[B],I=0;I<3;I++)G[I]+=E*T[I],a[I]=d(G[I],m[I]);return B}function l(B,E){return N(B-E*P)}function d(B,E){return N(B+E*P)}}(B,Y,g,V,T,m);if(!a){for(X=0;X<3;X++)N[X]=G[X]>0?T[X]-P.max[X]:V[X]-P.base[X];P.translate(N)}return r}},13628:(B,E,v)=>{"use strict";v.d(E,{d:()=>y});var z=v(13442),o=v(12184);class q{constructor(B,E,v,q,c,S,x){this.Eh=new z(B.base,B.Ih),this.Ko=E,this.friction=v,this.restitution=q,this.rS=c,this.EG=S,this.iS=!!x,this.uh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.wG=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.fD=o.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=o.create(),this._impulses=o.create(),this._sleepFrameCount=10}loadFromCopy(B){o.k(this.Eh.base,B.Eh.base),o.k(this.Eh.Ih,B.Eh.Ih),o.k(this.Eh.max,B.Eh.max),this.Eh.mag=B.Eh.mag,this.Ko=B.Ko,this.friction=B.friction,this.restitution=B.restitution,this.rS=B.rS,this.EG=B.EG,this.iS=B.iS,this.uh=B.uh,this.fluidDrag=B.fluidDrag,this.wG=B.wG,this.preventFallOffEdge=B.preventFallOffEdge,this.rolledBackLastTick=B.rolledBackLastTick,o.k(this.fD,B.fD),o.k(this.resting,B.resting),this.inFluid=B.inFluid,this._ratioInFluid=B._ratioInFluid,o.k(this._forces,B._forces),o.k(this._impulses,B._impulses),this._sleepFrameCount=B._sleepFrameCount}setPosition(B){c(B),o.YE(B,B,this.Eh.base),this.Eh.translate(B),this.dD()}tz(){return o.clone(this.Eh.base)}applyForce(B){c(B),o.add(this._forces,this._forces,B),this.dD()}applyImpulse(B){c(B),o.add(this._impulses,this._impulses,B),this.dD()}dD(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var c=B=>{};var S=v(13442),x=v(12184),D=v(13444);function h(){this.uh=.1,this.fluidDrag=.4,this.fS=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function y(B,E,v){B=Object.assign(new h,B),this.gravity=B.gravity||[0,-10,0],this.uh=B.uh||.1,this.fS=B.fS||2,this.fluidDrag=B.fluidDrag||.4,this.minBounceImpulse=B.minBounceImpulse,this.bodies=[],this.rP=B.rP,this.testSolid=E,this.testFluid=v}y.prototype.xG=function(B,E,v,z,o,c){B=B||new S([0,0,0],[1,1,1]),"undefined"==typeof E&&(E=1),"undefined"==typeof v&&(v=1),"undefined"==typeof z&&(z=0),"undefined"==typeof o&&(o=1);var x=new q(B,E,v,z,o,c);return this.bodies.push(x),x},y.prototype.DG=function(B){var E=this.bodies.indexOf(B);E<0||(this.bodies.splice(E,1),B.Eh=B.EG=null)};var Q=x.create(),P=x.create(),G=x.create(),Y=x.create(),a=x.create(),m=x.create(),g=x.create(),V=new S([0,0,0],[1,1,1]),T=new q(V,1,1,0,1,(()=>{}),!1);function N(B,E,v){return E=v,E*=1-(1-B.ratioInFluid)**2}y.prototype.nS=function(B){B/=1e3;var E=R(0,x.squaredLength(this.gravity));this.bodies.forEach((v=>function(B,E,v,z){x.k(a,E.resting),B.rP&&T.loadFromCopy(E);if(E.Ko<=0)return x.set(E.fD,0,0,0),x.set(E._forces,0,0,0),void x.set(E._impulses,0,0,0);var o=z||0===E.rS;if(function(B,E,v,z){if(E._sleepFrameCount>0)return!1;if(z)return!0;var o=!1,q=.5*v*v*E.rS;return x.scale(j,B.gravity,q),D(B.testSolid,E.Eh,j,(function(){return o=!0,!0}),!0),o}(B,E,v,o))return;E._sleepFrameCount--,function(B,E){var v=E.Eh,z=Math.floor(v.base[0]),o=Math.floor(v.base[2]),q=Math.floor(v.base[1]),c=Math.floor(v.max[1]);if(!B.testFluid(z,q,o))return E.inFluid=!1,void(E.ratioInFluid=0);var S=1,D=q+1;for(;D<=c&&B.testFluid(z,D,o);)S++,D++;var h=(q+S-v.base[1])/v.Ih[1];h>1&&(h=1);var y=v.Ih[0]*v.Ih[1]*v.Ih[2]*h,Q=r;x.scale(Q,B.gravity,-B.fS*y*E.rS),E.applyForce(Q),E.inFluid=!0,E.ratioInFluid=h}(B,E),F(E._forces),F(E._impulses),F(E.fD),F(E.resting),x.scale(Q,E._forces,1/E.Ko),x.pS(Q,Q,B.gravity,E.rS),x.scale(P,E._impulses,1/E.Ko),x.pS(P,P,Q,v),x.add(E.fD,E.fD,P),E.friction&&(i(B,0,E,P,v),i(B,1,E,P,v),i(B,2,E,P,v));var q=E.fluidDrag>=0?E.fluidDrag:B.fluidDrag,c=E.uh>=0?E.uh:B.uh,S=c,h=c;E.inFluid&&(S=N(E,S,E.fluidDragHoriz>=0?E.fluidDragHoriz:q),h=N(E,h,E.fluidDragVert>=0?E.fluidDragVert:q));S=Math.max(1-S*v/E.Ko,0),h=Math.max(1-h*v/E.Ko,0),x.set(X,S,h,S),x.multiply(E.fD,E.fD,X),x.scale(G,E.fD,v),x.set(E._forces,0,0,0),x.set(E._impulses,0,0,0),E.iS&&b(K,E.Eh);x.k(m,G),x.set(g,0,0,0),E.preventFallOffEdge&&function(B,E,v,z){if(!E.resting[1]||v[1]>0)return;var o=t;b(o,E.Eh);for(var q=0;q<3;q+=2){x.set(d,0,0,0),d[q]=v[q];var c=!0;(c=(c=(c=(c=c&&!H(B,o.base[0]+d[0]+1e-5,o.base[1],o.base[2]+d[2]+1e-5))&&!H(B,o.max[0]+d[0]-1e-5,o.base[1],o.base[2]+d[2]+1e-5))&&!H(B,o.base[0]+d[0]+1e-5,o.base[1],o.max[2]+d[2]-1e-5))&&!H(B,o.max[0]+d[0]-1e-5,o.base[1],o.max[2]+d[2]-1e-5))?(z[q]=v[q]>0?1:-1,v[q]=0):0===q&&(x.set(p,v[0],0,0),I(B,o,p,z,E.slideOnCollision))}}(B,E,G,g);I(B,E.Eh,G,E.resting,E.slideOnCollision),E.iS&&function(B,E,v,z){if(E.resting[1]>=0&&!E.inFluid)return;var o=0!==E.resting[0],q=0!==E.resting[2];if(!o&&!q)return;var c=Math.abs(z[0]/z[2]),S=4;if(!o&&c>S)return;if(!q&&c<1/S)return;x.add(f,v.base,z);var h=B.testSolid;D(h,v,z,(function(B,E,v,z){if(1!==E)return!0;z[E]=0}));var y=v.base[1],Q=E.inFluid?1.951:1.001,P=Math.floor(y+Q)-y;x.set(A,0,P,0);var G=!1;if(D(h,v,A,(function(B,E,v,z){return G=!0,!0})),G)return;x.YE(l,f,v.base),l[1]=0,I(B,v,l,C,!0);var Y=R(v.base[0],f[0]),a=R(v.base[2],f[2]);if(o&&!Y&&(!a||!q))return;if(q&&(!Y||!o)&&!a)return;var m=!0;if(m=m&&!H(B,v.base[0]+1e-5,v.base[1],v.base[2]+1e-5),m=m&&!H(B,v.max[0]-1e-5,v.base[1],v.base[2]+1e-5),m=m&&!H(B,v.base[0]+1e-5,v.base[1],v.max[2]-1e-5),m=m&&!H(B,v.max[0]-1e-5,v.base[1],v.max[2]-1e-5),m)return;b(E.Eh,v),E.resting[0]=C[0],E.resting[2]=C[2],E.wG&&E.wG()}(B,E,K,m);for(var y=0;y<3;++y)E.resting[y]=E.resting[y]||g[y],Y[y]=0,E.resting[y]&&(a[y]||(Y[y]=-E.fD[y]),E.fD[y]=0);var V=x.length(Y);V>.001&&(x.scale(Y,Y,E.Ko),E.EG&&E.EG(Y),E.restitution>0&&V>B.minBounceImpulse&&(x.scale(Y,Y,E.restitution),E.applyImpulse(Y)));var u=x.squaredLength(E.fD);u>1e-5&&E.dD();B.rP&&B.rP(E)?(E.loadFromCopy(T),E.rolledBackLastTick=!0):E.rolledBackLastTick=!1}(this,v,B,E)))};var X=x.create([0,0,0]);var r=x.create();function i(B,E,v,z,o){var q=v.resting[E],c=z[E];if(!v.alwaysApplyHorizFriction||1!==E){if(0===q)return;if(q*c<=0)return}x.k(u,v.fD),u[E]=0;var S=x.length(u);if(!R(S,0)){var D=Math.abs(v.friction*B.gravity[E]*o),h=S>D?(S-D)/S:0;v.fD[(E+1)%3]*=h,v.fD[(E+2)%3]*=h}}var u=x.create();function I(B,E,v,z,o){return x.set(z,0,0,0),D(B.testSolid,E,v,(function(B,E,v,q){z[E]=v,q[E]=0,o||(q[0]=0,q[1]=0,q[2]=0)}))}var K=new S([],[]),C=x.create(),f=x.create(),A=x.create(),l=x.create();var d=x.create(),t=new S([],[]),p=x.create();function H(B,E,v,z){return B.testSolid(Math.floor(E),Math.floor(v-1),Math.floor(z))}var j=x.create();function R(B,E){return Math.abs(B-E)<1e-5}function b(B,E){for(var v=0;v<3;v++)B.base[v]=E.base[v],B.max[v]=E.max[v],B.Ih[v]=E.Ih[v]}var F=function(B){}},12077:function(B,E){!function(B){"use strict";var E=function(B,v){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,E){B.__proto__=E}||function(B,E){for(var v in E)Object.prototype.hasOwnProperty.call(E,v)&&(B[v]=E[v])},E(B,v)};function v(B,v){if("function"!==typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function z(){this.constructor=B}E(B,v),B.prototype=null===v?Object.create(v):(z.prototype=v.prototype,new z)}function z(B,E,v,z){var o,q=arguments.length,c=q<3?E:null===z?z=Object.getOwnPropertyDescriptor(E,v):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(B,E,v,z);else for(var S=B.length-1;S>=0;S--)(o=B[S])&&(c=(q<3?o(c):q>3?o(E,v,c):o(E,v))||c);return q>3&&c&&Object.defineProperty(E,v,c),c}function o(B,E,v){if(v||2===arguments.length)for(var z,o=0,q=E.length;o<q;o++)!z&&o in E||(z||(z=Array.prototype.slice.call(E,0,o)),z[o]=E[o]);return B.concat(z||Array.prototype.slice.call(E))}var q,c=255,S=213;B.OPERATION=void 0,(q=B.OPERATION||(B.OPERATION={}))[q.ADD=128]="ADD",q[q.REPLACE=0]="REPLACE",q[q.DELETE=64]="DELETE",q[q.DELETE_AND_ADD=192]="DELETE_AND_ADD",q[q.TOUCH=1]="TOUCH",q[q.CLEAR=10]="CLEAR";var x=function(){function E(B,E,v){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=B,this.setParent(E,v)}return E.prototype.setParent=function(B,E,v){var z=this;if(this.indexes||(this.indexes=this.ref instanceof lB?this.ref._definition.indexes:{}),this.parent=B,this.parentIndex=v,E)if(this.root=E,this.ref instanceof lB){var o=this.ref._definition;for(var q in o.schema){var c=this.ref[q];if(c&&c.$changes){var S=o.indexes[q];c.$changes.setParent(this.ref,E,S)}}}else"object"===typeof this.ref&&this.ref.forEach((function(B,E){if(B instanceof lB){var v=B.$changes,o=z.ref.$changes.indexes[E];v.setParent(z.ref,z.root,o)}}))},E.prototype.operation=function(B){this.changes.set(--this.currentCustomOperation,B)},E.prototype.change=function(E,v){void 0===v&&(v=B.OPERATION.ADD);var z="number"===typeof E?E:this.indexes[E];this.assertValidIndex(z,E);var o=this.changes.get(z);o&&o.op!==B.OPERATION.DELETE&&o.op!==B.OPERATION.TOUCH||this.changes.set(z,{op:o&&o.op===B.OPERATION.DELETE?B.OPERATION.DELETE_AND_ADD:v,index:z}),this.allChanges.add(z),this.changed=!0,this.touchParents()},E.prototype.touch=function(E){var v="number"===typeof E?E:this.indexes[E];this.assertValidIndex(v,E),this.changes.has(v)||this.changes.set(v,{op:B.OPERATION.TOUCH,index:v}),this.allChanges.add(v),this.touchParents()},E.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},E.prototype.getType=function(B){if(this.ref._definition)return(E=this.ref._definition).schema[E.fieldsByIndex[B]];var E,v=(E=this.parent._definition).schema[E.fieldsByIndex[this.parentIndex]];return Object.values(v)[0]},E.prototype.getChildrenFilter=function(){var B=this.parent._definition.childFilters;return B&&B[this.parentIndex]},E.prototype.getValue=function(B){return this.ref.getByIndex(B)},E.prototype.delete=function(E){var v="number"===typeof E?E:this.indexes[E];if(void 0!==v){var z=this.getValue(v);this.changes.set(v,{op:B.OPERATION.DELETE,index:v}),this.allChanges.delete(v),delete this.caches[v],z&&z.$changes&&(z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(E," (").concat(v,")"))},E.prototype.discard=function(E,v){var z=this;void 0===E&&(E=!1),void 0===v&&(v=!1),this.ref instanceof lB||this.changes.forEach((function(E){if(E.op===B.OPERATION.DELETE){var v=z.ref.getIndex(E.index);delete z.indexes[v]}})),this.changes.clear(),this.changed=E,v&&this.allChanges.clear(),this.currentCustomOperation=0},E.prototype.discardAll=function(){var B=this;this.changes.forEach((function(E){var v=B.getValue(E.index);v&&v.$changes&&v.$changes.discardAll()})),this.discard()},E.prototype.cache=function(B,E){this.caches[B]=E},E.prototype.clone=function(){return new E(this.ref,this.parent,this.root)},E.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},E.prototype.assertValidIndex=function(B,E){if(void 0===B)throw new Error('ChangeTree: missing index for field "'.concat(E,'"'))},E}();function D(B,E,v,z){return B[E]||(B[E]=[]),B[E].push(v),null===z||void 0===z||z.forEach((function(B,E){return v(B,E)})),function(){return y(B[E],B[E].indexOf(v))}}function h(E){var v=this,z="string"!==typeof this.$changes.getType();this.$items.forEach((function(o,q){E.push({refId:v.$changes.refId,op:B.OPERATION.DELETE,field:q,value:void 0,previousValue:o}),z&&v.$changes.root.removeRef(o.$changes.refId)}))}function y(B,E){if(-1===E||E>=B.length)return!1;for(var v=B.length-1,z=E;z<v;z++)B[z]=B[z+1];return B.length=v,!0}var Q=function(B,E){var v=B.toString(),z=E.toString();return v<z?-1:v>z?1:0};function P(B){return B.$proxy=!0,B=new Proxy(B,{get:function(B,E){return"symbol"===typeof E||isNaN(E)?B[E]:B.at(E)},set:function(B,E,v){if("symbol"===typeof E||isNaN(E))B[E]=v;else{var z=Array.from(B.$items.keys()),o=parseInt(z[E]||E);void 0===v||null===v?B.deleteAt(o):B.setAt(o,v)}return!0},deleteProperty:function(B,E){return"number"===typeof E?B.deleteAt(E):delete B[E],!0}})}var G=function(){function E(){for(var B=[],E=0;E<arguments.length;E++)B[E]=arguments[E];this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,B)}return E.prototype.OS=function(E,v){return void 0===v&&(v=!0),D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,E,v?this.$items:void 0)},E.prototype.tv=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,E)},E.is=function(B){return Array.isArray(B)||void 0!==B.array},Object.defineProperty(E.prototype,"length",{get:function(){return this.$items.size},set:function(B){0===B?this.clear():this.splice(B,this.length-B)},enumerable:!1,configurable:!0}),E.prototype.push=function(){for(var B,E=this,v=[],z=0;z<arguments.length;z++)v[z]=arguments[z];return v.forEach((function(v){B=E.$refId++,E.setAt(B,v)})),B},E.prototype.pop=function(){var B=Array.from(this.$indexes.values()).pop();if(void 0!==B){this.$changes.delete(B),this.$indexes.delete(B);var E=this.$items.get(B);return this.$items.delete(B),E}},E.prototype.at=function(B){var E=Array.from(this.$items.keys())[B];return this.$items.get(E)},E.prototype.setAt=function(E,v){var z,o;if(void 0!==v&&null!==v){if(this.$items.get(E)!==v){void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,E);var q=null!==(o=null===(z=this.$changes.indexes[E])||void 0===z?void 0:z.op)&&void 0!==o?o:B.OPERATION.ADD;this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,v),this.$changes.change(E,q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},E.prototype.deleteAt=function(B){var E=Array.from(this.$items.keys())[B];return void 0!==E&&this.$deleteAt(E)},E.prototype.$deleteAt=function(B){return this.$changes.delete(B),this.$indexes.delete(B),this.$items.delete(B)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&h.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.concat=function(){for(var B,v=[],z=0;z<arguments.length;z++)v[z]=arguments[z];return new(E.bind.apply(E,o([void 0],(B=Array.from(this.$items.values())).concat.apply(B,v),!1)))},E.prototype.join=function(B){return Array.from(this.$items.values()).join(B)},E.prototype.reverse=function(){var B=this,E=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(v,z){B.setAt(E[z],v)})),this},E.prototype.shift=function(){var B=Array.from(this.$items.keys()).shift();if(void 0!==B){var E=this.$items.get(B);return this.$deleteAt(B),E}},E.prototype.slice=function(B,v){var z=new E;return z.push.apply(z,Array.from(this.$items.values()).slice(B,v)),z},E.prototype.sort=function(B){var E=this;void 0===B&&(B=Q);var v=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(B).forEach((function(B,z){E.setAt(v[z],B)})),this},E.prototype.splice=function(B,E){void 0===E&&(E=this.length-B);for(var v=Array.from(this.$items.keys()),z=[],o=B;o<B+E;o++)z.push(this.$items.get(v[o])),this.$deleteAt(v[o]);return z},E.prototype.unshift=function(){for(var B=this,E=[],v=0;v<arguments.length;v++)E[v]=arguments[v];var z=this.length,o=E.length,q=Array.from(this.$items.values());return E.forEach((function(E,v){B.setAt(v,E)})),q.forEach((function(E,v){B.setAt(o+v,E)})),z+o},E.prototype.indexOf=function(B,E){return Array.from(this.$items.values()).indexOf(B,E)},E.prototype.lastIndexOf=function(B,E){return void 0===E&&(E=this.length-1),Array.from(this.$items.values()).lastIndexOf(B,E)},E.prototype.every=function(B,E){return Array.from(this.$items.values()).every(B,E)},E.prototype.some=function(B,E){return Array.from(this.$items.values()).some(B,E)},E.prototype.forEach=function(B,E){Array.from(this.$items.values()).forEach(B,E)},E.prototype.map=function(B,E){return Array.from(this.$items.values()).map(B,E)},E.prototype.filter=function(B,E){return Array.from(this.$items.values()).filter(B,E)},E.prototype.reduce=function(B,E){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},E.prototype.reduceRight=function(B,E){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},E.prototype.find=function(B,E){return Array.from(this.$items.values()).find(B,E)},E.prototype.findIndex=function(B,E){return Array.from(this.$items.values()).findIndex(B,E)},E.prototype.fill=function(B,E,v){throw new Error("ArraySchema#fill() not implemented")},E.prototype.copyWithin=function(B,E,v){throw new Error("ArraySchema#copyWithin() not implemented")},E.prototype.toString=function(){return this.$items.toString()},E.prototype.toLocaleString=function(){return this.$items.toLocaleString()},E.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},E.prototype.includes=function(B,E){return Array.from(this.$items.values()).includes(B,E)},E.prototype.flatMap=function(B,E){throw new Error("ArraySchema#flatMap() is not supported.")},E.prototype.flat=function(B){throw new Error("ArraySchema#flat() is not supported.")},E.prototype.findLast=function(){var B=Array.from(this.$items.values());return B.findLast.apply(B,arguments)},E.prototype.findLastIndex=function(){var B=Array.from(this.$items.values());return B.findLastIndex.apply(B,arguments)},E.prototype.setIndex=function(B,E){this.$indexes.set(B,E)},E.prototype.getIndex=function(B){return this.$indexes.get(B)},E.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},E.prototype.deleteByIndex=function(B){var E=this.$indexes.get(B);this.$items.delete(E),this.$indexes.delete(B)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){return this.toArray().map((function(B){return"function"===typeof B.toJSON?B.toJSON():B}))},E.prototype.clone=function(B){return B?new(E.bind.apply(E,o([void 0],Array.from(this.$items.values()),!1))):new(E.bind.apply(E,o([void 0],this.map((function(B){return B.$changes?B.clone():B})),!1)))},E}();function Y(B){return B.$proxy=!0,B=new Proxy(B,{get:function(B,E){return"symbol"!==typeof E&&"undefined"===typeof B[E]?B.get(E):B[E]},set:function(B,E,v){return"symbol"!==typeof E&&-1===E.indexOf("$")&&"OS"!==E&&"tv"!==E&&"onChange"!==E?B.set(E,v):B[E]=v,!0},deleteProperty:function(B,E){return B.delete(E),!0}})}var a=function(){function E(B){var v=this;if(this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B)if(B instanceof Map||B instanceof E)B.forEach((function(B,E){return v.set(E,B)}));else for(var z in B)this.set(z,B[z])}return E.prototype.OS=function(E,v){return void 0===v&&(v=!0),D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,E,v?this.$items:void 0)},E.prototype.tv=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,E)},E.is=function(B){return void 0!==B.map},E.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(E.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.set=function(E,v){if(void 0===v||null===v)throw new Error("MapSchema#set('".concat(E,"', ").concat(v,"): trying to set ").concat(v," value on '").concat(E,"'."));E=E.toString();var z="undefined"!==typeof this.$changes.indexes[E],o=z?this.$changes.indexes[E]:this.$refId++,q=z?B.OPERATION.REPLACE:B.OPERATION.ADD,c=void 0!==v.$changes;if(c&&v.$changes.setParent(this,this.$changes.root,o),z){if(!c&&this.$items.get(E)===v)return;c&&this.$items.get(E)!==v&&(q=B.OPERATION.ADD)}else this.$changes.indexes[E]=o,this.$indexes.set(o,E);return this.$items.set(E,v),this.$changes.change(E,q),this},E.prototype.get=function(B){return this.$items.get(B)},E.prototype.delete=function(B){return this.$changes.delete(B),this.$items.delete(B)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&h.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(B){return this.$items.has(B)},E.prototype.forEach=function(B){this.$items.forEach(B)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(B,E){this.$indexes.set(B,E)},E.prototype.getIndex=function(B){return this.$indexes.get(B)},E.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},E.prototype.deleteByIndex=function(B){var E=this.$indexes.get(B);this.$items.delete(E),this.$indexes.delete(B)},E.prototype.toJSON=function(){var B={};return this.forEach((function(E,v){B[v]="function"===typeof E.toJSON?E.toJSON():E})),B},E.prototype.clone=function(B){var v;return B?v=Object.assign(new E,this):(v=new E,this.forEach((function(B,E){B.$changes?v.set(E,B.clone()):v.set(E,B)}))),v},E}(),m={};function g(B,E){m[B]=E}function V(B){return m[B]}var T=function(){function B(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return B.create=function(E){var v=new B;return v.schema=Object.assign({},E&&E.schema||{}),v.indexes=Object.assign({},E&&E.indexes||{}),v.fieldsByIndex=Object.assign({},E&&E.fieldsByIndex||{}),v.descriptors=Object.assign({},E&&E.descriptors||{}),v.deprecated=Object.assign({},E&&E.deprecated||{}),v},B.prototype.addField=function(B,E){var v=this.getNextFieldIndex();this.fieldsByIndex[v]=B,this.indexes[B]=v,this.schema[B]=Array.isArray(E)?{array:E[0]}:E},B.prototype.hasField=function(B){return void 0!==this.indexes[B]},B.prototype.addFilter=function(B,E){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[B]]=E,this.indexesWithFilters.push(this.indexes[B]),!0},B.prototype.addChildrenFilter=function(B,E){var v=this.indexes[B],z=this.schema[B];if(V(Object.keys(z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[v]=E,!0;console.warn("@filterChildren: field '".concat(B,"' can't have children. Ignoring filter."))},B.prototype.getChildrenFilter=function(B){return this.childFilters&&this.childFilters[this.indexes[B]]},B.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},B}();function N(B){return B._context&&B._context.useFilters}var X=function(){function B(){this.types={},this.schemas=new Map,this.useFilters=!1}return B.prototype.has=function(B){return this.schemas.has(B)},B.prototype.get=function(B){return this.types[B]},B.prototype.add=function(B,E){void 0===E&&(E=this.schemas.size),B._definition=T.create(B._definition),B._typeid=E,this.types[E]=B,this.schemas.set(B,E)},B.create=function(E){return void 0===E&&(E={}),function(v){return E.context||(E.context=new B),i(v,E)}},B}(),r=new X;function i(B,E){return void 0===E&&(E={}),function(v,z){var q=E.context||r,c=v.constructor;if(c._context=q,!B)throw new Error("".concat(c.name,': @type() reference provided for "').concat(z,"\" is undefined. Make sure you don't have any circular dependencies."));q.has(c)||q.add(c);var S=c._definition;if(S.addField(z,B),S.descriptors[z]){if(S.deprecated[z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(z,"' definition on '").concat(c.name,"'.\nCheck @type() annotation"))}catch(m){var x=m.stack.split("\n")[4].trim();throw new Error("".concat(m.message," ").concat(x))}}var D=G.is(B),h=!D&&a.is(B);if("string"!==typeof B&&!lB.is(B)){var y=Object.values(B)[0];"string"===typeof y||q.has(y)||q.add(y)}if(E.manual)S.descriptors[z]={enumerable:!0,configurable:!0,writable:!0};else{var Q="_".concat(z);S.descriptors[Q]={enumerable:!1,configurable:!1,writable:!0},S.descriptors[z]={get:function(){return this[Q]},set:function(B){B!==this[Q]&&(void 0!==B&&null!==B?(!D||B instanceof G||(B=new(G.bind.apply(G,o([void 0],B,!1)))),!h||B instanceof a||(B=new a(B)),void 0===B.$proxy&&(h?B=Y(B):D&&(B=P(B))),this.$changes.change(z),B.$changes&&B.$changes.setParent(this,this.$changes.root,this._definition.indexes[z])):this[Q]&&this.$changes.delete(z),this[Q]=B)},enumerable:!0,configurable:!0}}}}function u(B){return function(E,v){var z=E.constructor;z._definition.addFilter(v,B)&&(z._context.useFilters=!0)}}function I(B){return function(E,v){var z=E.constructor;z._definition.addChildrenFilter(v,B)&&(z._context.useFilters=!0)}}function K(B){return void 0===B&&(B=!0),function(E,v){var z=E.constructor._definition;z.deprecated[v]=!0,B&&(z.descriptors[v]={get:function(){throw new Error("".concat(v," is deprecated."))},set:function(B){},enumerable:!1,configurable:!0})}}function C(B,E,v){for(var z in void 0===v&&(v={}),v.context||(v.context=B._context||v.context||r),E)i(E[z],v)(B.prototype,z);return B}function f(B){for(var E=0,v=0,z=0,o=B.length;z<o;z++)(E=B.charCodeAt(z))<128?v+=1:E<2048?v+=2:E<55296||E>=57344?v+=3:(z++,v+=4);return v}function A(B,E,v){for(var z=0,o=0,q=v.length;o<q;o++)(z=v.charCodeAt(o))<128?B[E++]=z:z<2048?(B[E++]=192|z>>6,B[E++]=128|63&z):z<55296||z>=57344?(B[E++]=224|z>>12,B[E++]=128|z>>6&63,B[E++]=128|63&z):(o++,z=65536+((1023&z)<<10|1023&v.charCodeAt(o)),B[E++]=240|z>>18,B[E++]=128|z>>12&63,B[E++]=128|z>>6&63,B[E++]=128|63&z)}function l(B,E){B.push(255&E)}function d(B,E){B.push(255&E)}function t(B,E){B.push(255&E),B.push(E>>8&255)}function p(B,E){B.push(255&E),B.push(E>>8&255)}function H(B,E){B.push(255&E),B.push(E>>8&255),B.push(E>>16&255),B.push(E>>24&255)}function j(B,E){var v=E>>24,z=E>>16,o=E>>8,q=E;B.push(255&q),B.push(255&o),B.push(255&z),B.push(255&v)}function R(B,E){var v=Math.floor(E/Math.pow(2,32));j(B,E>>>0),j(B,v)}function b(B,E){var v=E/Math.pow(2,32)|0;j(B,E>>>0),j(B,v)}function F(B,E){s(B,E)}function W(B,E){J(B,E)}var w=new Int32Array(2),n=new Float32Array(w.buffer),U=new Float64Array(w.buffer);function s(B,E){n[0]=E,H(B,w[0])}function J(B,E){U[0]=E,H(B,w[0]),H(B,w[1])}function O(B,E){return d(B,E?1:0)}function e(B,E){E||(E="");var v=f(E),z=0;if(v<32)B.push(160|v),z=1;else if(v<256)B.push(217),d(B,v),z=2;else if(v<65536)B.push(218),p(B,v),z=3;else{if(!(v<4294967296))throw new Error("String too long");B.push(219),j(B,v),z=5}return A(B,B.length,E),z+v}function k(B,E){return isNaN(E)?k(B,0):isFinite(E)?E!==(0|E)?(B.push(203),J(B,E),9):E>=0?E<128?(d(B,E),1):E<256?(B.push(204),d(B,E),2):E<65536?(B.push(205),p(B,E),3):E<4294967296?(B.push(206),j(B,E),5):(B.push(207),b(B,E),9):E>=-32?(B.push(224|E+32),1):E>=-128?(B.push(208),l(B,E),2):E>=-32768?(B.push(209),t(B,E),3):E>=-2147483648?(B.push(210),H(B,E),5):(B.push(211),R(B,E),9):k(B,E>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var L=Object.freeze({__proto__:null,utf8Write:A,int8:l,uint8:d,int16:t,uint16:p,int32:H,uint32:j,int64:R,uint64:b,float32:F,float64:W,writeFloat32:s,writeFloat64:J,boolean:O,string:e,number:k});function M(B,E,v){for(var z="",o=0,q=E,c=E+v;q<c;q++){var S=B[q];0!==(128&S)?192!==(224&S)?224!==(240&S)?240!==(248&S)?console.error("Invalid byte "+S.toString(16)):(o=(7&S)<<18|(63&B[++q])<<12|(63&B[++q])<<6|63&B[++q])>=65536?(o-=65536,z+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):z+=String.fromCharCode(o):z+=String.fromCharCode((15&S)<<12|(63&B[++q])<<6|63&B[++q]):z+=String.fromCharCode((31&S)<<6|63&B[++q]):z+=String.fromCharCode(S)}return z}function Z(B,E){return BB(B,E)<<24>>24}function BB(B,E){return B[E.offset++]}function EB(B,E){return vB(B,E)<<16>>16}function vB(B,E){return B[E.offset++]|B[E.offset++]<<8}function zB(B,E){return B[E.offset++]|B[E.offset++]<<8|B[E.offset++]<<16|B[E.offset++]<<24}function oB(B,E){return zB(B,E)>>>0}function qB(B,E){return QB(B,E)}function cB(B,E){return PB(B,E)}function SB(B,E){var v=oB(B,E);return zB(B,E)*Math.pow(2,32)+v}function xB(B,E){var v=oB(B,E);return oB(B,E)*Math.pow(2,32)+v}var DB=new Int32Array(2),hB=new Float32Array(DB.buffer),yB=new Float64Array(DB.buffer);function QB(B,E){return DB[0]=zB(B,E),hB[0]}function PB(B,E){return DB[0]=zB(B,E),DB[1]=zB(B,E),yB[0]}function GB(B,E){return BB(B,E)>0}function YB(B,E){var v,z=B[E.offset++];z<192?v=31&z:217===z?v=BB(B,E):218===z?v=vB(B,E):219===z&&(v=oB(B,E));var o=M(B,E.offset,v);return E.offset+=v,o}function aB(B,E){var v=B[E.offset];return v<192&&v>160||217===v||218===v||219===v}function mB(B,E){var v=B[E.offset++];return v<128?v:202===v?QB(B,E):203===v?PB(B,E):204===v?BB(B,E):205===v?vB(B,E):206===v?oB(B,E):207===v?xB(B,E):208===v?Z(B,E):209===v?EB(B,E):210===v?zB(B,E):211===v?SB(B,E):v>223?-1*(255-v+1):void 0}function gB(B,E){var v=B[E.offset];return v<128||v>=202&&v<=211}function VB(B,E){return B[E.offset]<160}function TB(B,E){return B[E.offset-1]===c&&(B[E.offset]<128||B[E.offset]>=202&&B[E.offset]<=211)}var NB=Object.freeze({__proto__:null,int8:Z,uint8:BB,int16:EB,uint16:vB,int32:zB,uint32:oB,float32:qB,float64:cB,int64:SB,uint64:xB,readFloat32:QB,readFloat64:PB,boolean:GB,string:YB,stringCheck:aB,number:mB,numberCheck:gB,arrayCheck:VB,switchStructureCheck:TB}),XB=function(){function E(B){var E=this;this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B&&B.forEach((function(B){return E.add(B)}))}return E.prototype.OS=function(E,v){return void 0===v&&(v=!0),D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,E,v?this.$items:void 0)},E.prototype.tv=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,E)},E.is=function(B){return void 0!==B.collection},E.prototype.add=function(B){var E=this.$refId++;return void 0!==B.$changes&&B.$changes.setParent(this,this.$changes.root,E),this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,B),this.$changes.change(E),E},E.prototype.at=function(B){var E=Array.from(this.$items.keys())[B];return this.$items.get(E)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(B){for(var E,v,z=this.$items.entries();(v=z.next())&&!v.done;)if(B===v.value[1]){E=v.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&h.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(B){return Array.from(this.$items.values()).some((function(E){return E===B}))},E.prototype.forEach=function(B){var E=this;this.$items.forEach((function(v,z,o){return B(v,z,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(B,E){this.$indexes.set(B,E)},E.prototype.getIndex=function(B){return this.$indexes.get(B)},E.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},E.prototype.deleteByIndex=function(B){var E=this.$indexes.get(B);this.$items.delete(E),this.$indexes.delete(B)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var B=[];return this.forEach((function(E,v){B.push("function"===typeof E.toJSON?E.toJSON():E)})),B},E.prototype.clone=function(B){var v;return B?v=Object.assign(new E,this):(v=new E,this.forEach((function(B){B.$changes?v.add(B.clone()):v.add(B)}))),v},E}(),rB=function(){function E(B){var E=this;this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B&&B.forEach((function(B){return E.add(B)}))}return E.prototype.OS=function(E,v){return void 0===v&&(v=!0),D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,E,v?this.$items:void 0)},E.prototype.tv=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,E)},E.is=function(B){return void 0!==B.set},E.prototype.add=function(E){var v,z;if(this.has(E))return!1;var o=this.$refId++;void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,o);var q=null!==(z=null===(v=this.$changes.indexes[o])||void 0===v?void 0:v.op)&&void 0!==z?z:B.OPERATION.ADD;return this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,E),this.$changes.change(o,q),o},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(B){for(var E,v,z=this.$items.entries();(v=z.next())&&!v.done;)if(B===v.value[1]){E=v.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&h.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(B){for(var E,v=this.$items.values(),z=!1;(E=v.next())&&!E.done;)if(B===E.value){z=!0;break}return z},E.prototype.forEach=function(B){var E=this;this.$items.forEach((function(v,z,o){return B(v,z,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(B,E){this.$indexes.set(B,E)},E.prototype.getIndex=function(B){return this.$indexes.get(B)},E.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},E.prototype.deleteByIndex=function(B){var E=this.$indexes.get(B);this.$items.delete(E),this.$indexes.delete(B)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var B=[];return this.forEach((function(E,v){B.push("function"===typeof E.toJSON?E.toJSON():E)})),B},E.prototype.clone=function(B){var v;return B?v=Object.assign(new E,this):(v=new E,this.forEach((function(B){B.$changes?v.add(B.clone()):v.add(B)}))),v},E}(),iB=function(){function B(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return B.prototype.addRefId=function(B){this.refIds.has(B)||(this.refIds.add(B),this.containerIndexes.set(B,new Set))},B.get=function(E){return void 0===E.$filterState&&(E.$filterState=new B),E.$filterState},B}(),uB=function(){function B(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return B.prototype.getNextUniqueId=function(){return this.nextUniqueId++},B.prototype.addRef=function(B,E,v){void 0===v&&(v=!0),this.refs.set(B,E),v&&(this.refCounts[B]=(this.refCounts[B]||0)+1)},B.prototype.removeRef=function(B){this.refCounts[B]=this.refCounts[B]-1,this.deletedRefs.add(B)},B.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},B.prototype.garbageCollectDeletedRefs=function(){var B=this;this.deletedRefs.forEach((function(E){if(!(B.refCounts[E]>0)){var v=B.refs.get(E);if(v instanceof lB)for(var z in v._definition.schema)"string"!==typeof v._definition.schema[z]&&v[z]&&v[z].$changes&&B.removeRef(v[z].$changes.refId);else{var o=v.$changes.parent._definition,q=o.schema[o.fieldsByIndex[v.$changes.parentIndex]];"function"===typeof Object.values(q)[0]&&Array.from(v.values()).forEach((function(E){return B.removeRef(E.$changes.refId)}))}B.refs.delete(E),delete B.refCounts[E]}})),this.deletedRefs.clear()},B}(),IB=function(B){function E(){return null!==B&&B.apply(this,arguments)||this}return v(E,B),E}(Error);function KB(B,E,v,z){var o,q=!1;switch(E){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(B)&&console.log('trying to encode "NaN" in '.concat(v.constructor.name,"#").concat(z));break;case"string":o="string",q=!0;break;case"boolean":return}if(typeof B!==o&&(!q||q&&null!==B)){var c="'".concat(JSON.stringify(B),"'").concat(B&&B.constructor&&" (".concat(B.constructor.name,")")||"");throw new IB("a '".concat(o,"' was expected, but ").concat(c," was provided in ").concat(v.constructor.name,"#").concat(z))}}function CB(B,E,v,z){if(!(B instanceof E))throw new IB("a '".concat(E.name,"' was expected, but '").concat(B.constructor.name,"' was provided in ").concat(v.constructor.name,"#").concat(z))}function fB(B,E,v,z,o){KB(v,B,z,o);var q=L[B];if(!q)throw new IB("a '".concat(B,"' was expected, but ").concat(v," was provided in ").concat(z.constructor.name,"#").concat(o));q(E,v)}function AB(B,E,v){return NB[B](E,v)}var lB=function(){function E(){for(var B=[],E=0;E<arguments.length;E++)B[E]=arguments[E];Object.defineProperties(this,{$changes:{value:new x(this,void 0,new uB),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var v=this._definition.descriptors;v&&Object.defineProperties(this,v),B[0]&&this.assign(B[0])}return E.onError=function(B){console.error(B)},E.is=function(B){return B._definition&&void 0!==B._definition.schema},E.prototype.onChange=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,E)},E.prototype.tv=function(E){return D(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,E)},E.prototype.assign=function(B){return Object.assign(this,B),this},Object.defineProperty(E.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),E.prototype.setDirty=function(B,E){this.$changes.change(B,E)},E.prototype.listen=function(B,E,v){var z=this;return void 0===v&&(v=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[B]||(this.$callbacks[B]=[]),this.$callbacks[B].push(E),v&&void 0!==this[B]&&E(this[B],void 0),function(){return y(z.$callbacks[B],z.$callbacks[B].indexOf(E))}},E.prototype.decode=function(v,z,o){var q;void 0===z&&(z={offset:0}),void 0===o&&(o=this);var S=[],x=this.$changes.root,D=v.length,h=0;for(x.refs.set(h,this);z.offset<D;){var y=v[z.offset++];if(y!=c){var Q=o.$changes,P=void 0!==o._definition,Y=P?y>>6<<6:y;if(Y!==B.OPERATION.CLEAR){var m=P?y%(Y||255):mB(v,z),g=P?o._definition.fieldsByIndex[m]:"",T=Q.getType(m),N=void 0,X=void 0,r=void 0;if(P?X=o["_".concat(g)]:(X=o.getByIndex(m),(Y&B.OPERATION.ADD)===B.OPERATION.ADD?(r=o instanceof a?YB(v,z):m,o.setIndex(m,r)):r=o.getIndex(m)),(Y&B.OPERATION.DELETE)===B.OPERATION.DELETE&&(Y!==B.OPERATION.DELETE_AND_ADD&&o.deleteByIndex(m),X&&X.$changes&&x.removeRef(X.$changes.refId),N=null),void 0!==g){if(Y===B.OPERATION.DELETE);else if(E.is(T)){var i=mB(v,z);if(N=x.refs.get(i),Y!==B.OPERATION.REPLACE){var u=this.getSchemaType(v,z,T);N||((N=this.createTypeInstance(u)).$changes.refId=i,X&&(N.$callbacks=X.$callbacks,X.$changes.refId&&i!==X.$changes.refId&&x.removeRef(X.$changes.refId))),x.addRef(i,N,N!==X)}}else if("string"===typeof T)N=AB(T,v,z);else{var I=V(Object.keys(T)[0]),K=mB(v,z),C=x.refs.has(K)?X||x.refs.get(K):new I.constructor;if((N=C.clone(!0)).$changes.refId=K,X&&(N.$callbacks=X.$callbacks,X.$changes.refId&&K!==X.$changes.refId)){x.removeRef(X.$changes.refId);for(var f=X.entries(),A=void 0;(A=f.next())&&!A.done;){var l=(q=A.value)[0],d=q[1];S.push({refId:K,op:B.OPERATION.DELETE,field:l,value:void 0,previousValue:d})}}x.addRef(K,N,C!==X)}if(null!==N&&void 0!==N)if(N.$changes&&N.$changes.setParent(Q.ref,Q.root,m),o instanceof E)o[g]=N;else if(o instanceof a)l=r,o.$items.set(l,N),o.$changes.allChanges.add(m);else if(o instanceof G)o.setAt(m,N);else if(o instanceof XB){var t=o.add(N);o.setIndex(m,t)}else o instanceof rB&&!1!==(t=o.add(N))&&o.setIndex(m,t);X!==N&&S.push({refId:h,op:Y,field:g,dynamicIndex:r,value:N,previousValue:X})}else{console.warn("@colyseus/schema: definition mismatch");for(var p={offset:z.offset};z.offset<D&&(!TB(v,z)||(p.offset=z.offset+1,!x.refs.has(mB(v,p))));)z.offset++}}else o.clear(S)}else{h=mB(v,z);var H=x.refs.get(h);if(!H)throw new Error('"refId" not found: '.concat(h));o=H}}return this._triggerChanges(S),x.garbageCollectDeletedRefs(),S},E.prototype.encode=function(v,z,o){void 0===v&&(v=!1),void 0===z&&(z=[]),void 0===o&&(o=!1);for(var q=this.$changes,S=new WeakSet,x=[q],D=1,h=0;h<D;h++){var y=x[h],Q=y.ref,P=Q instanceof E;y.ensureRefId(),S.add(y),y!==q&&(y.changed||v)&&(d(z,c),k(z,y.refId));for(var G=v?Array.from(y.allChanges):Array.from(y.changes.values()),Y=0,m=G.length;Y<m;Y++){var g=v?{op:B.OPERATION.ADD,index:G[Y]}:G[Y],T=g.index,N=P?Q._definition.fieldsByIndex&&Q._definition.fieldsByIndex[T]:T,X=z.length;if(g.op!==B.OPERATION.TOUCH)if(P)d(z,T|g.op);else{if(d(z,g.op),g.op===B.OPERATION.CLEAR)continue;k(z,T)}if(P||(g.op&B.OPERATION.ADD)!=B.OPERATION.ADD||Q instanceof a&&e(z,y.ref.$indexes.get(T)),g.op!==B.OPERATION.DELETE){var r=y.getType(T),i=y.getValue(T);if(i&&i.$changes&&!S.has(i.$changes)&&(x.push(i.$changes),i.$changes.ensureRefId(),D++),g.op!==B.OPERATION.TOUCH){if(E.is(r))CB(i,r,Q,N),k(z,i.$changes.refId),(g.op&B.OPERATION.ADD)===B.OPERATION.ADD&&this.tryEncodeTypeId(z,r,i.constructor);else if("string"===typeof r)fB(r,z,i,Q,N);else{var u=V(Object.keys(r)[0]);CB(Q["_".concat(N)],u.constructor,Q,N),k(z,i.$changes.refId)}o&&y.cache(T,z.slice(X))}}}v||o||y.discard()}return z},E.prototype.encodeAll=function(B){return this.encode(!0,[],B)},E.prototype.applyFilters=function(v,z){var o,q;void 0===z&&(z=!1);for(var S=this,x=new Set,D=iB.get(v),h=[this.$changes],y=1,Q=[],P=function(P){var G=h[P];if(x.has(G.refId))return"continue";var Y=G.ref,m=Y instanceof E;d(Q,c),k(Q,G.refId);var g=D.refIds.has(G),V=z||!g;D.addRefId(G);var T=D.containerIndexes.get(G),N=V?Array.from(G.allChanges):Array.from(G.changes.values());!z&&m&&Y._definition.indexesWithFilters&&Y._definition.indexesWithFilters.forEach((function(E){!T.has(E)&&G.allChanges.has(E)&&(V?N.push(E):N.push({op:B.OPERATION.ADD,index:E}))}));for(var X=0,r=N.length;X<r;X++){var i=V?{op:B.OPERATION.ADD,index:N[X]}:N[X];if(i.op!==B.OPERATION.CLEAR){var u=i.index;if(i.op!==B.OPERATION.DELETE){var I=G.getValue(u),K=G.getType(u);if(m){if((C=Y._definition.filters&&Y._definition.filters[u])&&!C.call(Y,v,I,S)){I&&I.$changes&&x.add(I.$changes.refId);continue}}else{var C,f=G.parent;if((C=G.getChildrenFilter())&&!C.call(f,v,Y.$indexes.get(u),I,S)){I&&I.$changes&&x.add(I.$changes.refId);continue}}if(I.$changes&&(h.push(I.$changes),y++),i.op!==B.OPERATION.TOUCH)if(i.op===B.OPERATION.ADD||m)Q.push.apply(Q,null!==(o=G.caches[u])&&void 0!==o?o:[]),T.add(u);else if(T.has(u))Q.push.apply(Q,null!==(q=G.caches[u])&&void 0!==q?q:[]);else{if(T.add(u),d(Q,B.OPERATION.ADD),k(Q,u),Y instanceof a){var A=G.ref.$indexes.get(u);e(Q,A)}I.$changes?k(Q,I.$changes.refId):L[K](Q,I)}else I.$changes&&!m&&(d(Q,B.OPERATION.ADD),k(Q,u),Y instanceof a&&(A=G.ref.$indexes.get(u),e(Q,A)),k(Q,I.$changes.refId))}else m?d(Q,i.op|u):(d(Q,i.op),k(Q,u))}else d(Q,i.op)}},G=0;G<y;G++)P(G);return Q},E.prototype.clone=function(){var B,E=new this.constructor,v=this._definition.schema;for(var z in v)"object"===typeof this[z]&&"function"===typeof(null===(B=this[z])||void 0===B?void 0:B.clone)?E[z]=this[z].clone():E[z]=this[z];return E},E.prototype.toJSON=function(){var B=this._definition.schema,E=this._definition.deprecated,v={};for(var z in B)E[z]||null===this[z]||"undefined"===typeof this[z]||(v[z]="function"===typeof this[z].toJSON?this[z].toJSON():this["_".concat(z)]);return v},E.prototype.discardAllChanges=function(){this.$changes.discardAll()},E.prototype.getByIndex=function(B){return this[this._definition.fieldsByIndex[B]]},E.prototype.deleteByIndex=function(B){this[this._definition.fieldsByIndex[B]]=void 0},E.prototype.tryEncodeTypeId=function(B,E,v){E._typeid!==v._typeid&&(d(B,S),k(B,v._typeid))},E.prototype.getSchemaType=function(B,E,v){var z;return B[E.offset]===S&&(E.offset++,z=this.constructor._context.get(mB(B,E))),z||v},E.prototype.createTypeInstance=function(B){var E=new B;return E.$changes.root=this.$changes.root,E},E.prototype._triggerChanges=function(v){for(var z,o,q,c,S,x,D,h,y,Q=new Set,P=this.$changes.root.refs,G=function(G){var Y=v[G],a=Y.refId,m=P.get(a),g=m.$callbacks;if((Y.op&B.OPERATION.DELETE)===B.OPERATION.DELETE&&Y.previousValue instanceof E&&(null===(o=null===(z=Y.previousValue.$callbacks)||void 0===z?void 0:z[B.OPERATION.DELETE])||void 0===o||o.forEach((function(B){return B()}))),!g)return"continue";if(m instanceof E){if(!Q.has(a))try{null===(q=null===g||void 0===g?void 0:g[B.OPERATION.REPLACE])||void 0===q||q.forEach((function(B){return B()}))}catch(V){E.onError(V)}try{g.hasOwnProperty(Y.field)&&(null===(c=g[Y.field])||void 0===c||c.forEach((function(B){return B(Y.value,Y.previousValue)})))}catch(V){E.onError(V)}}else Y.op===B.OPERATION.ADD&&void 0===Y.previousValue?null===(S=g[B.OPERATION.ADD])||void 0===S||S.forEach((function(B){var E;return B(Y.value,null!==(E=Y.dynamicIndex)&&void 0!==E?E:Y.field)})):Y.op===B.OPERATION.DELETE?void 0!==Y.previousValue&&(null===(x=g[B.OPERATION.DELETE])||void 0===x||x.forEach((function(B){var E;return B(Y.previousValue,null!==(E=Y.dynamicIndex)&&void 0!==E?E:Y.field)}))):Y.op===B.OPERATION.DELETE_AND_ADD&&(void 0!==Y.previousValue&&(null===(D=g[B.OPERATION.DELETE])||void 0===D||D.forEach((function(B){var E;return B(Y.previousValue,null!==(E=Y.dynamicIndex)&&void 0!==E?E:Y.field)}))),null===(h=g[B.OPERATION.ADD])||void 0===h||h.forEach((function(B){var E;return B(Y.value,null!==(E=Y.dynamicIndex)&&void 0!==E?E:Y.field)}))),Y.value!==Y.previousValue&&(null===(y=g[B.OPERATION.REPLACE])||void 0===y||y.forEach((function(B){var E;return B(Y.value,null!==(E=Y.dynamicIndex)&&void 0!==E?E:Y.field)})));Q.add(a)},Y=0;Y<v.length;Y++)G(Y)},E._definition=T.create(),E}();function dB(B){for(var E=[B.$changes],v=1,z={},o=z,q=function(B){var v=E[B];v.changes.forEach((function(B){var E=v.ref,z=B.index,q=E._definition?E._definition.fieldsByIndex[z]:E.$indexes.get(z);o[q]=v.getValue(z)}))},c=0;c<v;c++)q(c);return z}var tB={context:new X},pB=function(B){function E(){return null!==B&&B.apply(this,arguments)||this}return v(E,B),z([i("string",tB)],E.prototype,"name",void 0),z([i("string",tB)],E.prototype,"type",void 0),z([i("number",tB)],E.prototype,"referencedType",void 0),E}(lB),HB=function(B){function E(){var E=null!==B&&B.apply(this,arguments)||this;return E.fields=new G,E}return v(E,B),z([i("number",tB)],E.prototype,"id",void 0),z([i([pB],tB)],E.prototype,"fields",void 0),E}(lB),jB=function(B){function E(){var E=null!==B&&B.apply(this,arguments)||this;return E.types=new G,E}return v(E,B),E.encode=function(B){var v=B.constructor,z=new E;z.rootType=v._typeid;var o=function(B,E){for(var v in E){var o=new pB;o.name=v;var q=void 0;if("string"===typeof E[v])q=E[v];else{var c=E[v],S=void 0;lB.is(c)?(q="ref",S=E[v]):"string"===typeof c[q=Object.keys(c)[0]]?q+=":"+c[q]:S=c[q],o.referencedType=S?S._typeid:-1}o.type=q,B.fields.push(o)}z.types.push(B)},q=v._context.types;for(var c in q){var S=new HB;S.id=Number(c),o(S,q[c]._definition.schema)}return z.encodeAll()},E.decode=function(B,z){var o=new X,q=new E;q.decode(B,z);var c=q.types.reduce((function(B,E){var z=function(B){function E(){return null!==B&&B.apply(this,arguments)||this}return v(E,B),E}(lB),q=E.id;return B[q]=z,o.add(z,q),B}),{});q.types.forEach((function(B){var E=c[B.id];B.fields.forEach((function(B){var v;if(void 0!==B.referencedType){var z=B.type,q=c[B.referencedType];if(!q){var S=B.type.split(":");z=S[0],q=S[1]}"ref"===z?i(q,{context:o})(E.prototype,B.name):i(((v={})[z]=q,v),{context:o})(E.prototype,B.name)}else i(B.type,{context:o})(E.prototype,B.name)}))}));var S=c[q.rootType],x=new S;for(var D in S._definition.schema){var h=S._definition.schema[D];"string"!==typeof h&&(x[D]="function"===typeof h?new h:new(V(Object.keys(h)[0]).constructor))}return x},z([i([HB],tB)],E.prototype,"types",void 0),z([i("number",tB)],E.prototype,"rootType",void 0),E}(lB);g("map",{constructor:a}),g("array",{constructor:G}),g("set",{constructor:rB}),g("collection",{constructor:XB}),B.ArraySchema=G,B.CollectionSchema=XB,B.Context=X,B.MapSchema=a,B.Reflection=jB,B.ReflectionField=pB,B.ReflectionType=HB,B.Schema=lB,B.SchemaDefinition=T,B.SetSchema=rB,B.decode=NB,B.defineTypes=C,B.deprecated=K,B.dumpChanges=dB,B.encode=L,B.filter=u,B.filterChildren=I,B.hasFilter=N,B.registerType=g,B.type=i,Object.defineProperty(B,"__esModule",{value:!0})}(E)},13492:B=>{"use strict";B.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13484:(B,E,v)=>{var z=v(13492),o=v(13500),q=Object.hasOwnProperty,c=Object.create(null);for(var S in z)q.call(z,S)&&(c[z[S]]=S);var x=B.exports={to:{},get:{}};function D(B,E,v){return Math.min(Math.max(E,B),v)}function h(B){var E=Math.round(B).toString(16).toUpperCase();return E.length<2?"0"+E:E}x.get=function(B){var E,v;switch(B.substring(0,3).toLowerCase()){case"hsl":E=x.get.hsl(B),v="hsl";break;case"hwb":E=x.get.hwb(B),v="hwb";break;default:E=x.get.rgb(B),v="rgb"}return E?{model:v,value:E}:null},x.get.rgb=function(B){if(!B)return null;var E,v,o,c=[0,0,0,1];if(E=B.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=E[2],E=E[1],v=0;v<3;v++){var S=2*v;c[v]=parseInt(E.slice(S,S+2),16)}o&&(c[3]=parseInt(o,16)/255)}else if(E=B.match(/^#([a-f0-9]{3,4})$/i)){for(o=(E=E[1])[3],v=0;v<3;v++)c[v]=parseInt(E[v]+E[v],16);o&&(c[3]=parseInt(o+o,16)/255)}else if(E=B.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(v=0;v<3;v++)c[v]=parseInt(E[v+1],0);E[4]&&(E[5]?c[3]=.01*parseFloat(E[4]):c[3]=parseFloat(E[4]))}else{if(!(E=B.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(E=B.match(/^(\w+)$/))?"transparent"===E[1]?[0,0,0,0]:q.call(z,E[1])?((c=z[E[1]])[3]=1,c):null:null;for(v=0;v<3;v++)c[v]=Math.round(2.55*parseFloat(E[v+1]));E[4]&&(E[5]?c[3]=.01*parseFloat(E[4]):c[3]=parseFloat(E[4]))}for(v=0;v<3;v++)c[v]=D(c[v],0,255);return c[3]=D(c[3],0,1),c},x.get.hsl=function(B){if(!B)return null;var E=B.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var v=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,D(parseFloat(E[2]),0,100),D(parseFloat(E[3]),0,100),D(isNaN(v)?1:v,0,1)]}return null},x.get.hwb=function(B){if(!B)return null;var E=B.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var v=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,D(parseFloat(E[2]),0,100),D(parseFloat(E[3]),0,100),D(isNaN(v)?1:v,0,1)]}return null},x.to.hex=function(){var B=o(arguments);return"#"+h(B[0])+h(B[1])+h(B[2])+(B[3]<1?h(Math.round(255*B[3])):"")},x.to.rgb=function(){var B=o(arguments);return B.length<4||1===B[3]?"rgb("+Math.round(B[0])+", "+Math.round(B[1])+", "+Math.round(B[2])+")":"rgba("+Math.round(B[0])+", "+Math.round(B[1])+", "+Math.round(B[2])+", "+B[3]+")"},x.to.rgb.percent=function(){var B=o(arguments),E=Math.round(B[0]/255*100),v=Math.round(B[1]/255*100),z=Math.round(B[2]/255*100);return B.length<4||1===B[3]?"rgb("+E+"%, "+v+"%, "+z+"%)":"rgba("+E+"%, "+v+"%, "+z+"%, "+B[3]+")"},x.to.hsl=function(){var B=o(arguments);return B.length<4||1===B[3]?"hsl("+B[0]+", "+B[1]+"%, "+B[2]+"%)":"hsla("+B[0]+", "+B[1]+"%, "+B[2]+"%, "+B[3]+")"},x.to.hwb=function(){var B=o(arguments),E="";return B.length>=4&&1!==B[3]&&(E=", "+B[3]),"hwb("+B[0]+", "+B[1]+"%, "+B[2]+"%"+E+")"},x.to.keyword=function(B){return c[B.slice(0,3)]}},13480:(B,E,v)=>{const z=v(13484),o=v(13509),q=["keyword","gray","hex"],c={};for(const P of Object.keys(o))c[[...o[P].labels].sort().join("")]=P;const S={};function x(B,E){if(!(this instanceof x))return new x(B,E);if(E&&E in q&&(E=null),E&&!(E in o))throw new Error("Unknown model: "+E);let v,D;if(null==B)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(B instanceof x)this.model=B.model,this.color=[...B.color],this.valpha=B.valpha;else if("string"===typeof B){const E=z.get(B);if(null===E)throw new Error("Unable to parse color from string: "+B);this.model=E.model,D=o[this.model].channels,this.color=E.value.slice(0,D),this.valpha="number"===typeof E.value[D]?E.value[D]:1}else if(B.length>0){this.model=E||"rgb",D=o[this.model].channels;const v=Array.prototype.slice.call(B,0,D);this.color=Q(v,D),this.valpha="number"===typeof B[D]?B[D]:1}else if("number"===typeof B)this.model="rgb",this.color=[B>>16&255,B>>8&255,255&B],this.valpha=1;else{this.valpha=1;const E=Object.keys(B);"alpha"in B&&(E.splice(E.indexOf("alpha"),1),this.valpha="number"===typeof B.alpha?B.alpha:0);const z=E.sort().join("");if(!(z in c))throw new Error("Unable to parse color from object: "+JSON.stringify(B));this.model=c[z];const{labels:q}=o[this.model],S=[];for(v=0;v<q.length;v++)S.push(B[q[v]]);this.color=Q(S)}if(S[this.model])for(D=o[this.model].channels,v=0;v<D;v++){const B=S[this.model][v];B&&(this.color[v]=B(this.color[v]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}x.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(B){let E=this.model in z.to?this:this.rgb();E=E.round("number"===typeof B?B:1);const v=1===E.valpha?E.color:[...E.color,this.valpha];return z.to[E.model](v)},percentString(B){const E=this.rgb().round("number"===typeof B?B:1),v=1===E.valpha?E.color:[...E.color,this.valpha];return z.to.rgb.percent(v)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const B={},{channels:E}=o[this.model],{labels:v}=o[this.model];for(let z=0;z<E;z++)B[v[z]]=this.color[z];return 1!==this.valpha&&(B.alpha=this.valpha),B},unitArray(){const B=this.rgb().color;return B[0]/=255,B[1]/=255,B[2]/=255,1!==this.valpha&&B.push(this.valpha),B},unitObject(){const B=this.rgb().object();return B.r/=255,B.g/=255,B.b/=255,1!==this.valpha&&(B.alpha=this.valpha),B},round(B){return B=Math.max(B||0,0),new x([...this.color.map(D(B)),this.valpha],this.model)},alpha(B){return void 0!==B?new x([...this.color,Math.max(0,Math.min(1,B))],this.model):this.valpha},red:h("rgb",0,y(255)),green:h("rgb",1,y(255)),blue:h("rgb",2,y(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(B=>(B%360+360)%360)),saturationl:h("hsl",1,y(100)),lightness:h("hsl",2,y(100)),saturationv:h("hsv",1,y(100)),value:h("hsv",2,y(100)),chroma:h("hcg",1,y(100)),gray:h("hcg",2,y(100)),white:h("hwb",1,y(100)),wblack:h("hwb",2,y(100)),cyan:h("cmyk",0,y(100)),magenta:h("cmyk",1,y(100)),yellow:h("cmyk",2,y(100)),black:h("cmyk",3,y(100)),x:h("xyz",0,y(95.047)),y:h("xyz",1,y(100)),z:h("xyz",2,y(108.833)),l:h("lab",0,y(100)),a:h("lab",1),b:h("lab",2),keyword(B){return void 0!==B?new x(B):o[this.model].keyword(this.color)},hex(B){return void 0!==B?new x(B):z.to.hex(this.rgb().round().color)},hexa(B){if(void 0!==B)return new x(B);const E=this.rgb().round().color;let v=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===v.length&&(v="0"+v),z.to.hex(E)+v},rgbNumber(){const B=this.rgb().color;return(255&B[0])<<16|(255&B[1])<<8|255&B[2]},luminosity(){const B=this.rgb().color,E=[];for(const[v,z]of B.entries()){const B=z/255;E[v]=B<=.04045?B/12.92:((B+.055)/1.055)**2.4}return.2126*E[0]+.7152*E[1]+.0722*E[2]},contrast(B){const E=this.luminosity(),v=B.luminosity();return E>v?(E+.05)/(v+.05):(v+.05)/(E+.05)},level(B){const E=this.contrast(B);return E>=7?"AAA":E>=4.5?"AA":""},isDark(){const B=this.rgb().color;return(2126*B[0]+7152*B[1]+722*B[2])/1e4<128},isLight(){return!this.isDark()},negate(){const B=this.rgb();for(let E=0;E<3;E++)B.color[E]=255-B.color[E];return B},lighten(B){const E=this.hsl();return E.color[2]+=E.color[2]*B,E},darken(B){const E=this.hsl();return E.color[2]-=E.color[2]*B,E},saturate(B){const E=this.hsl();return E.color[1]+=E.color[1]*B,E},desaturate(B){const E=this.hsl();return E.color[1]-=E.color[1]*B,E},whiten(B){const E=this.hwb();return E.color[1]+=E.color[1]*B,E},blacken(B){const E=this.hwb();return E.color[2]+=E.color[2]*B,E},grayscale(){const B=this.rgb().color,E=.3*B[0]+.59*B[1]+.11*B[2];return x.rgb(E,E,E)},fade(B){return this.alpha(this.valpha-this.valpha*B)},opaquer(B){return this.alpha(this.valpha+this.valpha*B)},rotate(B){const E=this.hsl();let v=E.color[0];return v=(v+B)%360,v=v<0?360+v:v,E.color[0]=v,E},mix(B,E){if(!B||!B.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof B);const v=B.rgb(),z=this.rgb(),o=void 0===E?.5:E,q=2*o-1,c=v.alpha()-z.alpha(),S=((q*c===-1?q:(q+c)/(1+q*c))+1)/2,D=1-S;return x.rgb(S*v.red()+D*z.red(),S*v.green()+D*z.green(),S*v.blue()+D*z.blue(),v.alpha()*o+z.alpha()*(1-o))}};for(const P of Object.keys(o)){if(q.includes(P))continue;const{channels:B}=o[P];x.prototype[P]=function(){if(this.model===P)return new x(this);for(var B=arguments.length,E=new Array(B),v=0;v<B;v++)E[v]=arguments[v];return E.length>0?new x(E,P):new x([...(z=o[this.model][P].raw(this.color),Array.isArray(z)?z:[z]),this.valpha],P);var z},x[P]=function(){for(var E=arguments.length,v=new Array(E),z=0;z<E;z++)v[z]=arguments[z];let o=v[0];return"number"===typeof o&&(o=Q(v,B)),new x(o,P)}}function D(B){return function(E){return function(B,E){return Number(B.toFixed(E))}(E,B)}}function h(B,E,v){B=Array.isArray(B)?B:[B];for(const z of B)(S[z]||(S[z]=[]))[E]=v;return B=B[0],function(z){let o;return void 0!==z?(v&&(z=v(z)),o=this[B](),o.color[E]=z,o):(o=this[B]().color[E],v&&(o=v(o)),o)}}function y(B){return function(E){return Math.max(0,Math.min(B,E))}}function Q(B,E){for(let v=0;v<E;v++)"number"!==typeof B[v]&&(B[v]=0);return B}B.exports=x},13518:(B,E,v)=>{const z=v(13527),o={};for(const c of Object.keys(z))o[z[c]]=c;const q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};B.exports=q;for(const c of Object.keys(q)){if(!("channels"in q[c]))throw new Error("missing channels property: "+c);if(!("labels"in q[c]))throw new Error("missing channel labels property: "+c);if(q[c].labels.length!==q[c].channels)throw new Error("channel and label counts mismatch: "+c);const{channels:B,labels:E}=q[c];delete q[c].channels,delete q[c].labels,Object.defineProperty(q[c],"channels",{value:B}),Object.defineProperty(q[c],"labels",{value:E})}q.rgb.hsl=function(B){const E=B[0]/255,v=B[1]/255,z=B[2]/255,o=Math.min(E,v,z),q=Math.max(E,v,z),c=q-o;let S,x;q===o?S=0:E===q?S=(v-z)/c:v===q?S=2+(z-E)/c:z===q&&(S=4+(E-v)/c),S=Math.min(60*S,360),S<0&&(S+=360);const D=(o+q)/2;return x=q===o?0:D<=.5?c/(q+o):c/(2-q-o),[S,100*x,100*D]},q.rgb.hsv=function(B){let E,v,z,o,q;const c=B[0]/255,S=B[1]/255,x=B[2]/255,D=Math.max(c,S,x),h=D-Math.min(c,S,x),y=function(B){return(D-B)/6/h+.5};return 0===h?(o=0,q=0):(q=h/D,E=y(c),v=y(S),z=y(x),c===D?o=z-v:S===D?o=1/3+E-z:x===D&&(o=2/3+v-E),o<0?o+=1:o>1&&(o-=1)),[360*o,100*q,100*D]},q.rgb.hwb=function(B){const E=B[0],v=B[1];let z=B[2];const o=q.rgb.hsl(B)[0],c=1/255*Math.min(E,Math.min(v,z));return z=1-1/255*Math.max(E,Math.max(v,z)),[o,100*c,100*z]},q.rgb.cmyk=function(B){const E=B[0]/255,v=B[1]/255,z=B[2]/255,o=Math.min(1-E,1-v,1-z);return[100*((1-E-o)/(1-o)||0),100*((1-v-o)/(1-o)||0),100*((1-z-o)/(1-o)||0),100*o]},q.rgb.keyword=function(B){const E=o[B];if(E)return E;let v,q=1/0;for(const o of Object.keys(z)){const E=z[o],x=(S=E,((c=B)[0]-S[0])**2+(c[1]-S[1])**2+(c[2]-S[2])**2);x<q&&(q=x,v=o)}var c,S;return v},q.keyword.rgb=function(B){return z[B]},q.rgb.xyz=function(B){let E=B[0]/255,v=B[1]/255,z=B[2]/255;E=E>.04045?((E+.055)/1.055)**2.4:E/12.92,v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,z=z>.04045?((z+.055)/1.055)**2.4:z/12.92;return[100*(.4124*E+.3576*v+.1805*z),100*(.2126*E+.7152*v+.0722*z),100*(.0193*E+.1192*v+.9505*z)]},q.rgb.lab=function(B){const E=q.rgb.xyz(B);let v=E[0],z=E[1],o=E[2];v/=95.047,z/=100,o/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,z=z>.008856?z**(1/3):7.787*z+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*z-16,500*(v-z),200*(z-o)]},q.hsl.rgb=function(B){const E=B[0]/360,v=B[1]/100,z=B[2]/100;let o,q,c;if(0===v)return c=255*z,[c,c,c];o=z<.5?z*(1+v):z+v-z*v;const S=2*z-o,x=[0,0,0];for(let D=0;D<3;D++)q=E+1/3*-(D-1),q<0&&q++,q>1&&q--,c=6*q<1?S+6*(o-S)*q:2*q<1?o:3*q<2?S+(o-S)*(2/3-q)*6:S,x[D]=255*c;return x},q.hsl.hsv=function(B){const E=B[0];let v=B[1]/100,z=B[2]/100,o=v;const q=Math.max(z,.01);z*=2,v*=z<=1?z:2-z,o*=q<=1?q:2-q;return[E,100*(0===z?2*o/(q+o):2*v/(z+v)),100*((z+v)/2)]},q.hsv.rgb=function(B){const E=B[0]/60,v=B[1]/100;let z=B[2]/100;const o=Math.floor(E)%6,q=E-Math.floor(E),c=255*z*(1-v),S=255*z*(1-v*q),x=255*z*(1-v*(1-q));switch(z*=255,o){case 0:return[z,x,c];case 1:return[S,z,c];case 2:return[c,z,x];case 3:return[c,S,z];case 4:return[x,c,z];case 5:return[z,c,S]}},q.hsv.hsl=function(B){const E=B[0],v=B[1]/100,z=B[2]/100,o=Math.max(z,.01);let q,c;c=(2-v)*z;const S=(2-v)*o;return q=v*o,q/=S<=1?S:2-S,q=q||0,c/=2,[E,100*q,100*c]},q.hwb.rgb=function(B){const E=B[0]/360;let v=B[1]/100,z=B[2]/100;const o=v+z;let q;o>1&&(v/=o,z/=o);const c=Math.floor(6*E),S=1-z;q=6*E-c,0!==(1&c)&&(q=1-q);const x=v+q*(S-v);let D,h,y;switch(c){default:case 6:case 0:D=S,h=x,y=v;break;case 1:D=x,h=S,y=v;break;case 2:D=v,h=S,y=x;break;case 3:D=v,h=x,y=S;break;case 4:D=x,h=v,y=S;break;case 5:D=S,h=v,y=x}return[255*D,255*h,255*y]},q.cmyk.rgb=function(B){const E=B[0]/100,v=B[1]/100,z=B[2]/100,o=B[3]/100;return[255*(1-Math.min(1,E*(1-o)+o)),255*(1-Math.min(1,v*(1-o)+o)),255*(1-Math.min(1,z*(1-o)+o))]},q.xyz.rgb=function(B){const E=B[0]/100,v=B[1]/100,z=B[2]/100;let o,q,c;return o=3.2406*E+-1.5372*v+-.4986*z,q=-.9689*E+1.8758*v+.0415*z,c=.0557*E+-.204*v+1.057*z,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,o=Math.min(Math.max(0,o),1),q=Math.min(Math.max(0,q),1),c=Math.min(Math.max(0,c),1),[255*o,255*q,255*c]},q.xyz.lab=function(B){let E=B[0],v=B[1],z=B[2];E/=95.047,v/=100,z/=108.883,E=E>.008856?E**(1/3):7.787*E+16/116,v=v>.008856?v**(1/3):7.787*v+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*v-16,500*(E-v),200*(v-z)]},q.lab.xyz=function(B){let E,v,z;v=(B[0]+16)/116,E=B[1]/500+v,z=v-B[2]/200;const o=v**3,q=E**3,c=z**3;return v=o>.008856?o:(v-16/116)/7.787,E=q>.008856?q:(E-16/116)/7.787,z=c>.008856?c:(z-16/116)/7.787,E*=95.047,v*=100,z*=108.883,[E,v,z]},q.lab.lch=function(B){const E=B[0],v=B[1],z=B[2];let o;o=360*Math.atan2(z,v)/2/Math.PI,o<0&&(o+=360);return[E,Math.sqrt(v*v+z*z),o]},q.lch.lab=function(B){const E=B[0],v=B[1],z=B[2]/360*2*Math.PI;return[E,v*Math.cos(z),v*Math.sin(z)]},q.rgb.ansi16=function(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[v,z,o]=B;let c=null===E?q.rgb.hsv(B)[2]:E;if(c=Math.round(c/50),0===c)return 30;let S=30+(Math.round(o/255)<<2|Math.round(z/255)<<1|Math.round(v/255));return 2===c&&(S+=60),S},q.hsv.ansi16=function(B){return q.rgb.ansi16(q.hsv.rgb(B),B[2])},q.rgb.ansi256=function(B){const E=B[0],v=B[1],z=B[2];if(E===v&&v===z)return E<8?16:E>248?231:Math.round((E-8)/247*24)+232;return 16+36*Math.round(E/255*5)+6*Math.round(v/255*5)+Math.round(z/255*5)},q.ansi16.rgb=function(B){let E=B%10;if(0===E||7===E)return B>50&&(E+=3.5),E=E/10.5*255,[E,E,E];const v=.5*(1+~~(B>50));return[(1&E)*v*255,(E>>1&1)*v*255,(E>>2&1)*v*255]},q.ansi256.rgb=function(B){if(B>=232){const E=10*(B-232)+8;return[E,E,E]}let E;B-=16;return[Math.floor(B/36)/5*255,Math.floor((E=B%36)/6)/5*255,E%6/5*255]},q.rgb.hex=function(B){const E=(((255&Math.round(B[0]))<<16)+((255&Math.round(B[1]))<<8)+(255&Math.round(B[2]))).toString(16).toUpperCase();return"000000".substring(E.length)+E},q.hex.rgb=function(B){const E=B.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!E)return[0,0,0];let v=E[0];3===E[0].length&&(v=v.split("").map((B=>B+B)).join(""));const z=parseInt(v,16);return[z>>16&255,z>>8&255,255&z]},q.rgb.hcg=function(B){const E=B[0]/255,v=B[1]/255,z=B[2]/255,o=Math.max(Math.max(E,v),z),q=Math.min(Math.min(E,v),z),c=o-q;let S,x;return S=c<1?q/(1-c):0,x=c<=0?0:o===E?(v-z)/c%6:o===v?2+(z-E)/c:4+(E-v)/c,x/=6,x%=1,[360*x,100*c,100*S]},q.hsl.hcg=function(B){const E=B[1]/100,v=B[2]/100,z=v<.5?2*E*v:2*E*(1-v);let o=0;return z<1&&(o=(v-.5*z)/(1-z)),[B[0],100*z,100*o]},q.hsv.hcg=function(B){const E=B[1]/100,v=B[2]/100,z=E*v;let o=0;return z<1&&(o=(v-z)/(1-z)),[B[0],100*z,100*o]},q.hcg.rgb=function(B){const E=B[0]/360,v=B[1]/100,z=B[2]/100;if(0===v)return[255*z,255*z,255*z];const o=[0,0,0],q=E%1*6,c=q%1,S=1-c;let x=0;switch(Math.floor(q)){case 0:o[0]=1,o[1]=c,o[2]=0;break;case 1:o[0]=S,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=c;break;case 3:o[0]=0,o[1]=S,o[2]=1;break;case 4:o[0]=c,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=S}return x=(1-v)*z,[255*(v*o[0]+x),255*(v*o[1]+x),255*(v*o[2]+x)]},q.hcg.hsv=function(B){const E=B[1]/100,v=E+B[2]/100*(1-E);let z=0;return v>0&&(z=E/v),[B[0],100*z,100*v]},q.hcg.hsl=function(B){const E=B[1]/100,v=B[2]/100*(1-E)+.5*E;let z=0;return v>0&&v<.5?z=E/(2*v):v>=.5&&v<1&&(z=E/(2*(1-v))),[B[0],100*z,100*v]},q.hcg.hwb=function(B){const E=B[1]/100,v=E+B[2]/100*(1-E);return[B[0],100*(v-E),100*(1-v)]},q.hwb.hcg=function(B){const E=B[1]/100,v=1-B[2]/100,z=v-E;let o=0;return z<1&&(o=(v-z)/(1-z)),[B[0],100*z,100*o]},q.apple.rgb=function(B){return[B[0]/65535*255,B[1]/65535*255,B[2]/65535*255]},q.rgb.apple=function(B){return[B[0]/255*65535,B[1]/255*65535,B[2]/255*65535]},q.gray.rgb=function(B){return[B[0]/100*255,B[0]/100*255,B[0]/100*255]},q.gray.hsl=function(B){return[0,0,B[0]]},q.gray.hsv=q.gray.hsl,q.gray.hwb=function(B){return[0,100,B[0]]},q.gray.cmyk=function(B){return[0,0,0,B[0]]},q.gray.lab=function(B){return[B[0],0,0]},q.gray.hex=function(B){const E=255&Math.round(B[0]/100*255),v=((E<<16)+(E<<8)+E).toString(16).toUpperCase();return"000000".substring(v.length)+v},q.rgb.gray=function(B){return[(B[0]+B[1]+B[2])/3/255*100]}},13509:(B,E,v)=>{const z=v(13518),o=v(13535),q={};Object.keys(z).forEach((B=>{q[B]={},Object.defineProperty(q[B],"channels",{value:z[B].channels}),Object.defineProperty(q[B],"labels",{value:z[B].labels});const E=o(B);Object.keys(E).forEach((v=>{const z=E[v];q[B][v]=function(B){const E=function(){for(var E=arguments.length,v=new Array(E),z=0;z<E;z++)v[z]=arguments[z];const o=v[0];if(void 0===o||null===o)return o;o.length>1&&(v=o);const q=B(v);if("object"===typeof q)for(let B=q.length,c=0;c<B;c++)q[c]=Math.round(q[c]);return q};return"conversion"in B&&(E.conversion=B.conversion),E}(z),q[B][v].raw=function(B){const E=function(){for(var E=arguments.length,v=new Array(E),z=0;z<E;z++)v[z]=arguments[z];const o=v[0];return void 0===o||null===o?o:(o.length>1&&(v=o),B(v))};return"conversion"in B&&(E.conversion=B.conversion),E}(z)}))})),B.exports=q},13535:(B,E,v)=>{const z=v(13518);function o(B){const E=function(){const B={},E=Object.keys(z);for(let v=E.length,z=0;z<v;z++)B[E[z]]={distance:-1,parent:null};return B}(),v=[B];for(E[B].distance=0;v.length;){const B=v.pop(),o=Object.keys(z[B]);for(let z=o.length,q=0;q<z;q++){const z=o[q],c=E[z];-1===c.distance&&(c.distance=E[B].distance+1,c.parent=B,v.unshift(z))}}return E}function q(B,E){return function(v){return E(B(v))}}function c(B,E){const v=[E[B].parent,B];let o=z[E[B].parent][B],c=E[B].parent;for(;E[c].parent;)v.unshift(E[c].parent),o=q(z[E[c].parent][c],o),c=E[c].parent;return o.conversion=v,o}B.exports=function(B){const E=o(B),v={},z=Object.keys(E);for(let o=z.length,q=0;q<o;q++){const B=z[q];null!==E[B].parent&&(v[B]=c(B,E))}return v}},13527:B=>{"use strict";B.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12101:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.discordURLBuilder=void 0,E.discordURLBuilder=function(B){var E;const v=(null===(E=null===window||void 0===window?void 0:window.location)||void 0===E?void 0:E.hostname)||"localhost",z=B.hostname.split("."),o=!B.hostname.includes("trycloudflare.com")&&!B.hostname.includes("discordsays.com")&&z.length>2?`/${z[0]}`:"";return B.pathname.startsWith("/.proxy")?`${B.protocol}//${v}${o}${B.pathname}${B.search}`:`${B.protocol}//${v}/.proxy/colyseus${o}${B.pathname}${B.search}`}},12093:function(B,E,v){"use strict";var z,o,q,c,S=this&&this.__awaiter||function(B,E,v,z){return new(v||(v=Promise))((function(o,q){function c(B){try{x(z.next(B))}catch(E){q(E)}}function S(B){try{x(z.throw(B))}catch(E){q(E)}}function x(B){var E;B.done?o(B.value):(E=B.value,E instanceof v?E:new v((function(B){B(E)}))).then(c,S)}x((z=z.apply(B,E||[])).next())}))},x=this&&this.__classPrivateFieldGet||function(B,E,v,z){if("a"===v&&!z)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof E?B!==E||!z:!E.has(B))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===v?z:"a"===v?z.call(B):z?z.value:E.get(B)},D=this&&this.__classPrivateFieldSet||function(B,E,v,z,o){if("m"===z)throw new TypeError("Private method is not writable");if("a"===z&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof E?B!==E||!o:!E.has(B))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===z?o.call(B,v):o?o.value=v:E.set(B,v),v};Object.defineProperty(E,"__esModule",{value:!0}),E.Auth=void 0;const h=v(12099),y=v(12070);E.Auth=class{constructor(B){this.http=B,this.settings={path:"/auth",key:"colyseus-auth-token"},z.set(this,!1),o.set(this,void 0),q.set(this,void 0),c.set(this,(0,y.createNanoEvents)()),(0,h.getItem)(this.settings.key,(B=>this.token=B))}set token(B){this.http.authToken=B}get token(){return this.http.authToken}onChange(B){const E=x(this,c,"f").on("change",B);return x(this,z,"f")||D(this,o,new Promise(((B,E)=>{this.getUserData().then((B=>{this.emitChange(Object.assign(Object.assign({},B),{token:this.token}))})).catch((B=>{this.emitChange({user:null,token:void 0})})).finally((()=>{B()}))})),"f"),D(this,z,!0,"f"),E}getUserData(){return S(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(B,E,v){return S(this,void 0,void 0,(function*(){const z=(yield this.http.post(`${this.settings.path}/register`,{body:{email:B,password:E,options:v}})).data;return this.emitChange(z),z}))}signInWithEmailAndPassword(B,E){return S(this,void 0,void 0,(function*(){const v=(yield this.http.post(`${this.settings.path}/login`,{body:{email:B,password:E}})).data;return this.emitChange(v),v}))}signInAnonymously(B){return S(this,void 0,void 0,(function*(){const E=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:B}})).data;return this.emitChange(E),E}))}sendPasswordResetEmail(B){return S(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:B}})).data}))}signInWithProvider(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return S(this,void 0,void 0,(function*(){return new Promise(((v,z)=>{const o=E.width||480,c=E.height||768,S=this.token?`?token=${this.token}`:"",h=`Login with ${B[0].toUpperCase()+B.substring(1)}`,y=this.http.client.getHttpEndpoint(`${E.prefix||`${this.settings.path}/provider`}/${B}${S}`),Q=screen.width/2-o/2,P=screen.height/2-c/2;D(this,q,window.open(y,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+c+", top="+P+", left="+Q),"f");const G=B=>{void 0===B.data.user&&void 0===B.data.token||(clearInterval(Y),x(this,q,"f").close(),D(this,q,void 0,"f"),window.removeEventListener("message",G),void 0!==B.data.error?z(B.data.error):(v(B.data),this.emitChange(B.data)))},Y=setInterval((()=>{x(this,q,"f")&&!x(this,q,"f").closed||(D(this,q,void 0,"f"),z("Kq"),window.removeEventListener("message",G))}),200);window.addEventListener("message",G)}))}))}signOut(){return S(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(B){void 0!==B.token&&(this.token=B.token,null===B.token?(0,h.removeItem)(this.settings.key):(0,h.setItem)(this.settings.key,B.token)),x(this,c,"f").emit("change",B)}},z=new WeakMap,o=new WeakMap,q=new WeakMap,c=new WeakMap},12015:function(B,E,v){"use strict";var z,o=this&&this.__awaiter||function(B,E,v,z){return new(v||(v=Promise))((function(o,q){function c(B){try{x(z.next(B))}catch(E){q(E)}}function S(B){try{x(z.throw(B))}catch(E){q(E)}}function x(B){var E;B.done?o(B.value):(E=B.value,E instanceof v?E:new v((function(B){B(E)}))).then(c,S)}x((z=z.apply(B,E||[])).next())}))};Object.defineProperty(E,"__esModule",{value:!0}),E.Client=E.MatchMakeError=void 0;const q=v(12022),c=v(12030),S=v(12083),x=v(12093),D=v(12101);class h extends Error{constructor(B,E){super(B),this.code=E,Object.setPrototypeOf(this,h.prototype)}}E.MatchMakeError=h;const y="undefined"!==typeof window&&"undefined"!==typeof(null===(z=null===window||void 0===window?void 0:window.location)||void 0===z?void 0:z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";E.Client=class{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,E=arguments.length>1?arguments[1]:void 0;var v,z;if("string"===typeof B){const E=B.startsWith("/")?new URL(B,y):new URL(B),v="https:"===E.protocol||"wss:"===E.protocol,z=Number(E.port||(v?443:80));this.settings={hostname:E.hostname,pathname:E.pathname,port:z,secure:v}}else void 0===B.port&&(B.port=B.secure?443:80),void 0===B.pathname&&(B.pathname=""),this.settings=B;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new S.HTTP(this,(null===E||void 0===E?void 0:E.headers)||{}),this.auth=new x.Auth(this.http),this.urlBuilder=null===E||void 0===E?void 0:E.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(z=null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)||void 0===z?void 0:z.includes("discordsays.com"))&&(this.urlBuilder=D.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",B,E,v)}))}create(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",B,E,v)}))}join(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",B,E,v)}))}joinById(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",B,E,v)}))}reconnect(B,E){return o(this,void 0,void 0,(function*(){if("string"===typeof B&&"string"===typeof E)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[v,z]=B.split(":");if(!v||!z)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",v,{reconnectionToken:z},E)}))}getAvailableRooms(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${B}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(B,E,v){return o(this,void 0,void 0,(function*(){const z=this.createRoom(B.room.name,E);z.roomId=B.room.roomId,z.sessionId=B.sessionId;const c={sessionId:z.sessionId};B.reconnectionToken&&(c.reconnectionToken=B.reconnectionToken);const S=v||z;return z.connect(this.buildEndpoint(B.room,c),B.devMode&&(()=>o(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${z.roomId}'...`);let v=0;const q=()=>o(this,void 0,void 0,(function*(){v++;try{yield this.consumeSeatReservation(B,E,S),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${z.roomId}'`)}catch(o){v<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${v} out of 8)`),setTimeout(q,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(q,2e3)}))),S,this.http.headers),new Promise(((B,E)=>{const v=(B,v)=>E(new q.ServerError(B,v));S.onError.once(v),S.onJoin.once((()=>{S.onError.remove(v),setTimeout((()=>{try{S.ED(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),B(S)}))}))}))}createMatchMakeRequest(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;return o(this,void 0,void 0,(function*(){const o=(yield this.http.post(`matchmake/${B}/${E}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(v)})).data;if(o.error)throw new h(o.error,o.code);return"reconnect"===B&&(o.reconnectionToken=v.reconnectionToken),yield this.consumeSeatReservation(o,z,q)}))}createRoom(B,E){return new c.Room(B,E)}buildEndpoint(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const v=[];for(const q in E)E.hasOwnProperty(q)&&v.push(`${q}=${E[q]}`);let z=this.settings.secure?"wss://":"ws://";B.publicAddress?z+=`${B.publicAddress}`:z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const o=`${z}/${B.processId}/${B.roomId}?${v.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(o)):o}getHttpEndpoint(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const E=B.startsWith("/")?B:`/${B}`,v=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${E}`;return this.urlBuilder?this.urlBuilder(new URL(v)):v}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12038:(B,E,v)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.Connection=void 0;const z=v(12040);E.Connection=class{constructor(){this.events={},this.transport=new z.WebSocketTransport(this.events)}send(B){this.transport.send(B)}connect(B,E){this.transport.connect(B,E)}close(B,E){this.transport.close(B,E)}get isOpen(){return this.transport.isOpen}}},12083:function(B,E,v){"use strict";var z=this&&this.__createBinding||(Object.create?function(B,E,v,z){void 0===z&&(z=v);var o=Object.getOwnPropertyDescriptor(E,v);o&&!("get"in o?!E.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return E[v]}}),Object.defineProperty(B,z,o)}:function(B,E,v,z){void 0===z&&(z=v),B[z]=E[v]}),o=this&&this.__setModuleDefault||(Object.create?function(B,E){Object.defineProperty(B,"default",{enumerable:!0,value:E})}:function(B,E){B.default=E}),q=this&&this.__importStar||function(B){if(B&&B.__esModule)return B;var E={};if(null!=B)for(var v in B)"default"!==v&&Object.prototype.hasOwnProperty.call(B,v)&&z(E,B,v);return o(E,B),E};Object.defineProperty(E,"__esModule",{value:!0}),E.HTTP=void 0;const c=v(12022),S=q(v(12086));E.HTTP=class{constructor(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=B,this.headers=E}get(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",B,E)}post(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",B,E)}del(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",B,E)}put(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",B,E)}request(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return S[B](this.client.getHttpEndpoint(E),this.getOptions(v)).catch((B=>{var E;const v=B.statusCode,z=(null===(E=B.data)||void 0===E?void 0:E.error)||B.statusMessage||B.message;if(!v&&!z)throw B;throw new c.ServerError(v,z)}))}getOptions(B){return B.headers=Object.assign({},this.headers,B.headers),this.authToken&&(B.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(B.withCredentials=!0),B}}},12058:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.utf8Length=E.utf8Read=E.ErrorCode=E.Protocol=void 0,function(B){B[B.HANDSHAKE=9]="HANDSHAKE",B[B.JOIN_ROOM=10]="JOIN_ROOM",B[B.ERROR=11]="ERROR",B[B.LEAVE_ROOM=12]="LEAVE_ROOM",B[B.ROOM_DATA=13]="ROOM_DATA",B[B.ROOM_STATE=14]="ROOM_STATE",B[B.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",B[B.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",B[B.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(E.Protocol||(E.Protocol={})),function(B){B[B.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",B[B.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",B[B.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",B[B.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",B[B.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",B[B.AUTH_FAILED=4215]="AUTH_FAILED",B[B.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(E.ErrorCode||(E.ErrorCode={})),E.utf8Read=function(B,E){const v=B[E++];for(var z="",o=0,q=E,c=E+v;q<c;q++){var S=B[q];if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(o=(7&S)<<18|(63&B[++q])<<12|(63&B[++q])<<6|63&B[++q])>=65536?(o-=65536,z+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):z+=String.fromCharCode(o)}else z+=String.fromCharCode((15&S)<<12|(63&B[++q])<<6|63&B[++q]);else z+=String.fromCharCode((31&S)<<6|63&B[++q]);else z+=String.fromCharCode(S)}return z},E.utf8Length=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",E=0,v=0;for(let z=0,o=B.length;z<o;z++)E=B.charCodeAt(z),E<128?v+=1:E<2048?v+=2:E<55296||E>=57344?v+=3:(z++,v+=4);return v+1}},12030:function(B,E,v){"use strict";var z=this&&this.__createBinding||(Object.create?function(B,E,v,z){void 0===z&&(z=v);var o=Object.getOwnPropertyDescriptor(E,v);o&&!("get"in o?!E.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return E[v]}}),Object.defineProperty(B,z,o)}:function(B,E,v,z){void 0===z&&(z=v),B[z]=E[v]}),o=this&&this.__setModuleDefault||(Object.create?function(B,E){Object.defineProperty(B,"default",{enumerable:!0,value:E})}:function(B,E){B.default=E}),q=this&&this.__importStar||function(B){if(B&&B.__esModule)return B;var E={};if(null!=B)for(var v in B)"default"!==v&&Object.prototype.hasOwnProperty.call(B,v)&&z(E,B,v);return o(E,B),E};Object.defineProperty(E,"__esModule",{value:!0}),E.Room=void 0;const c=q(v(12035)),S=v(12038),x=v(12058),D=v(12066),h=v(12070),y=v(12073),Q=v(12077),P=v(12022);class G{constructor(B,E){this.onStateChange=(0,y.createSignal)(),this.onError=(0,y.createSignal)(),this.onLeave=(0,y.createSignal)(),this.onJoin=(0,y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,h.createNanoEvents)(),this.roomId=null,this.name=B,E&&(this.serializer=new((0,D.getSerializer)("schema")),this.rootSchema=E,this.serializer.state=new E),this.onError(((B,E)=>{var v;return null===(v=console.warn)||void 0===v?void 0:v.call(console,`colyseus.js - onError => (${B}) ${E}`)})),this.onLeave((()=>this.oE()))}get id(){return this.roomId}connect(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,z=arguments.length>3?arguments[3]:void 0;const o=new S.Connection;v.connection=o,o.events.onmessage=G.prototype.onMessageCallback.bind(v),o.events.onclose=function(B){var z;if(!v.hasJoined)return null===(z=console.warn)||void 0===z||z.call(console,`Room connection was closed unexpectedly (${B.code}): ${B.reason}`),void v.onError.invoke(B.code,B.reason);B.code===P.CloseCode.DEVMODE_RESTART&&E?E():(v.onLeave.invoke(B.code,B.reason),v.destroy())},o.events.onerror=function(B){var E;null===(E=console.warn)||void 0===E||E.call(console,`Room, onError (${B.code}): ${B.reason}`),v.onError.invoke(B.code,B.reason)},o.connect(B,z)}WS(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((E=>{this.onLeave((B=>E(B))),this.connection?B?this.connection.send([x.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(P.CloseCode.CONSENTED)}))}dE(B,E){return this.onMessageHandlers.on(this.getMessageHandlerKey(B),E)}send(B,E){const v=[x.Protocol.ROOM_DATA];let z;if("string"===typeof B?Q.encode.string(v,B):Q.encode.number(v,B),void 0!==E){const B=c.encode(E);z=new Uint8Array(v.length+B.byteLength),z.set(new Uint8Array(v),0),z.set(new Uint8Array(B),v.length)}else z=new Uint8Array(v);this.connection.send(z.buffer)}ED(B,E){const v=[x.Protocol.ROOM_DATA_BYTES];let z;"string"===typeof B?Q.encode.string(v,B):Q.encode.number(v,B),z=new Uint8Array(v.length+(E.byteLength||E.length)),z.set(new Uint8Array(v),0),z.set(new Uint8Array(E),v.length),this.connection.send(z.buffer)}get state(){return this.serializer.getState()}oE(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(B){const E=Array.from(new Uint8Array(B.data)),v=E[0];if(v===x.Protocol.JOIN_ROOM){let B=1;const v=(0,x.utf8Read)(E,B);if(B+=(0,x.utf8Length)(v),this.serializerId=(0,x.utf8Read)(E,B),B+=(0,x.utf8Length)(this.serializerId),!this.serializer){const B=(0,D.getSerializer)(this.serializerId);this.serializer=new B}E.length>B&&this.serializer.handshake&&this.serializer.handshake(E,{offset:B}),this.reconnectionToken=`${this.roomId}:${v}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([x.Protocol.JOIN_ROOM])}else if(v===x.Protocol.ERROR){const B={offset:1},v=Q.decode.number(E,B),z=Q.decode.string(E,B);this.onError.invoke(v,z)}else if(v===x.Protocol.LEAVE_ROOM)this.WS();else if(v===x.Protocol.ROOM_DATA_SCHEMA){const B={offset:1},v=this.serializer.getState().constructor._context.get(Q.decode.number(E,B)),z=new v;z.decode(E,B),this.dispatchMessage(v,z)}else if(v===x.Protocol.ROOM_STATE)E.shift(),this.setState(E);else if(v===x.Protocol.ROOM_STATE_PATCH)E.shift(),this.patch(E);else if(v===x.Protocol.ROOM_DATA){const v={offset:1},z=Q.decode.stringCheck(E,v)?Q.decode.string(E,v):Q.decode.number(E,v),o=E.length>v.offset?c.decode(B.data,v.offset):void 0;this.dispatchMessage(z,o)}else if(v===x.Protocol.ROOM_DATA_BYTES){const B={offset:1},v=Q.decode.stringCheck(E,B)?Q.decode.string(E,B):Q.decode.number(E,B);this.dispatchMessage(v,new Uint8Array(E.slice(B.offset)))}}setState(B){this.serializer.setState(B),this.onStateChange.invoke(this.serializer.getState())}patch(B){this.serializer.patch(B),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(B,E){var v;const z=this.getMessageHandlerKey(B);this.onMessageHandlers.events[z]?this.onMessageHandlers.emit(z,E):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",B,E):null===(v=console.warn)||void 0===v||v.call(console,`colyseus.js: onMessage() not registered for type '${B}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(B){switch(typeof B){case"function":return`$${B._typeid}`;case"string":return B;case"number":return`i${B}`;default:throw new Error("invalid message type.")}}}E.Room=G},12099:(B,E)=>{"use strict";let v;function z(){if(!v)try{v="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(B){}return v||(v={cache:{},setItem:function(B,E){this.cache[B]=E},getItem:function(B){this.cache[B]},removeItem:function(B){delete this.cache[B]}}),v}Object.defineProperty(E,"__esModule",{value:!0}),E.getItem=E.removeItem=E.setItem=void 0,E.setItem=function(B,E){z().setItem(B,E)},E.removeItem=function(B){z().removeItem(B)},E.getItem=function(B,E){const v=z().getItem(B);"undefined"!==typeof Promise&&v instanceof Promise?v.then((B=>E(B))):E(v)}},12070:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createNanoEvents=void 0;E.createNanoEvents=()=>({emit(B){let E=this.events[B]||[];for(var v=arguments.length,z=new Array(v>1?v-1:0),o=1;o<v;o++)z[o-1]=arguments[o];for(let q=0,c=E.length;q<c;q++)E[q](...z)},events:{},on(B,E){var v;return(null===(v=this.events[B])||void 0===v?void 0:v.push(E))||(this.events[B]=[E]),()=>{var v;this.events[B]=null===(v=this.events[B])||void 0===v?void 0:v.filter((B=>E!==B))}}})},12073:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createSignal=E.EventEmitter=void 0;class v{constructor(){this.handlers=[]}register(B){return this.handlers.push(B),this}invoke(){for(var B=arguments.length,E=new Array(B),v=0;v<B;v++)E[v]=arguments[v];this.handlers.forEach((B=>B.apply(this,E)))}invokeAsync(){for(var B=arguments.length,E=new Array(B),v=0;v<B;v++)E[v]=arguments[v];return Promise.all(this.handlers.map((B=>B.apply(this,E))))}remove(B){const E=this.handlers.indexOf(B);this.handlers[E]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}E.EventEmitter=v,E.createSignal=function(){const B=new v;function E(E){return B.register(E,null===this)}return E.once=E=>{const v=function(){for(var z=arguments.length,o=new Array(z),q=0;q<z;q++)o[q]=arguments[q];E.apply(this,o),B.remove(v)};B.register(v)},E.remove=E=>B.remove(E),E.invoke=function(){return B.invoke(...arguments)},E.invokeAsync=function(){return B.invokeAsync(...arguments)},E.clear=()=>B.clear(),E}},12022:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.ServerError=E.CloseCode=void 0,function(B){B[B.CONSENTED=4e3]="CONSENTED",B[B.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(E.CloseCode||(E.CloseCode={}));class v extends Error{constructor(B,E){super(E),this.name="ServerError",this.code=B}}E.ServerError=v},12002:(B,E,v)=>{"use strict";E.d=void 0,v(12007);var z=v(12015);Object.defineProperty(E,"d",{enumerable:!0,get:function(){return z.Client}});var o=v(12058);var q=v(12030);var c=v(12093);const S=v(12109);const x=v(12111),D=v(12066);(0,D.registerSerializer)("schema",S.SchemaSerializer),(0,D.registerSerializer)("none",x.NoneSerializer)},12007:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=B=>null!==B&&"object"===typeof B&&B.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12035:(B,E)=>{"use strict";function v(B,E){if(this._offset=E,B instanceof ArrayBuffer)this._buffer=B,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(B))throw new Error("Invalid argument");this._buffer=B.buffer,this._view=new DataView(this._buffer,B.byteOffset,B.byteLength)}}Object.defineProperty(E,"__esModule",{value:!0}),E.decode=E.encode=void 0,v.prototype._array=function(B){for(var E=new Array(B),v=0;v<B;v++)E[v]=this._parse();return E},v.prototype._map=function(B){for(var E={},v=0;v<B;v++)E[this._parse()]=this._parse();return E},v.prototype._str=function(B){var E=function(B,E,v){for(var z="",o=0,q=E,c=E+v;q<c;q++){var S=B.getUint8(q);if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(o=(7&S)<<18|(63&B.getUint8(++q))<<12|(63&B.getUint8(++q))<<6|63&B.getUint8(++q))>=65536?(o-=65536,z+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):z+=String.fromCharCode(o)}else z+=String.fromCharCode((15&S)<<12|(63&B.getUint8(++q))<<6|63&B.getUint8(++q));else z+=String.fromCharCode((31&S)<<6|63&B.getUint8(++q));else z+=String.fromCharCode(S)}return z}(this._view,this._offset,B);return this._offset+=B,E},v.prototype._bin=function(B){var E=this._buffer.slice(this._offset,this._offset+B);return this._offset+=B,E},v.prototype._parse=function(){var B,E=this._view.getUint8(this._offset++),v=0,z=0,o=0,q=0;if(E<192)return E<128?E:E<144?this._map(15&E):E<160?this._array(15&E):this._str(31&E);if(E>223)return-1*(255-E+1);switch(E){case 192:return null;case 194:return!1;case 195:return!0;case 196:return v=this._view.getUint8(this._offset),this._offset+=1,this._bin(v);case 197:return v=this._view.getUint16(this._offset),this._offset+=2,this._bin(v);case 198:return v=this._view.getUint32(this._offset),this._offset+=4,this._bin(v);case 199:if(v=this._view.getUint8(this._offset),z=this._view.getInt8(this._offset+1),this._offset+=2,-1===z){var c=this._view.getUint32(this._offset);return o=this._view.getInt32(this._offset+4),q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*o+q)+c/1e6)}return[z,this._bin(v)];case 200:return v=this._view.getUint16(this._offset),z=this._view.getInt8(this._offset+2),this._offset+=3,[z,this._bin(v)];case 201:return v=this._view.getUint32(this._offset),z=this._view.getInt8(this._offset+4),this._offset+=5,[z,this._bin(v)];case 202:return B=this._view.getFloat32(this._offset),this._offset+=4,B;case 203:return B=this._view.getFloat64(this._offset),this._offset+=8,B;case 204:return B=this._view.getUint8(this._offset),this._offset+=1,B;case 205:return B=this._view.getUint16(this._offset),this._offset+=2,B;case 206:return B=this._view.getUint32(this._offset),this._offset+=4,B;case 207:return o=this._view.getUint32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,o+q;case 208:return B=this._view.getInt8(this._offset),this._offset+=1,B;case 209:return B=this._view.getInt16(this._offset),this._offset+=2,B;case 210:return B=this._view.getInt32(this._offset),this._offset+=4,B;case 211:return o=this._view.getInt32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,o+q;case 212:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?void(this._offset+=1):[z,this._bin(1)];case 213:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(2)];case 214:return z=this._view.getInt8(this._offset),this._offset+=1,-1===z?(B=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*B)):[z,this._bin(4)];case 215:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?(o=this._view.getInt32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(o+q)):-1===z?(o=this._view.getUint32(this._offset),q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&o)+q)+(o>>>2)/1e6)):[z,this._bin(8)];case 216:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(16)];case 217:return v=this._view.getUint8(this._offset),this._offset+=1,this._str(v);case 218:return v=this._view.getUint16(this._offset),this._offset+=2,this._str(v);case 219:return v=this._view.getUint32(this._offset),this._offset+=4,this._str(v);case 220:return v=this._view.getUint16(this._offset),this._offset+=2,this._array(v);case 221:return v=this._view.getUint32(this._offset),this._offset+=4,this._array(v);case 222:return v=this._view.getUint16(this._offset),this._offset+=2,this._map(v);case 223:return v=this._view.getUint32(this._offset),this._offset+=4,this._map(v)}throw new Error("Could not parse")},E.decode=function(B){var E=new v(B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),z=E._parse();if(E._offset!==B.byteLength)throw new Error(B.byteLength-E._offset+" trailing bytes");return z};function z(B,E,v){for(var z=0,o=0,q=v.length;o<q;o++)(z=v.charCodeAt(o))<128?B.setUint8(E++,z):z<2048?(B.setUint8(E++,192|z>>6),B.setUint8(E++,128|63&z)):z<55296||z>=57344?(B.setUint8(E++,224|z>>12),B.setUint8(E++,128|z>>6&63),B.setUint8(E++,128|63&z)):(o++,z=65536+((1023&z)<<10|1023&v.charCodeAt(o)),B.setUint8(E++,240|z>>18),B.setUint8(E++,128|z>>12&63),B.setUint8(E++,128|z>>6&63),B.setUint8(E++,128|63&z))}function o(B,E,v){var z=typeof v,q=0,c=0,S=0,x=0,D=0,h=0;if("string"===z){if(D=function(B){for(var E=0,v=0,z=0,o=B.length;z<o;z++)(E=B.charCodeAt(z))<128?v+=1:E<2048?v+=2:E<55296||E>=57344?v+=3:(z++,v+=4);return v}(v),D<32)B.push(160|D),h=1;else if(D<256)B.push(217,D),h=2;else if(D<65536)B.push(218,D>>8,D),h=3;else{if(!(D<4294967296))throw new Error("String too long");B.push(219,D>>24,D>>16,D>>8,D),h=5}return E.push({_str:v,_length:D,_offset:B.length}),h+D}if("number"===z)return Math.floor(v)===v&&isFinite(v)?v>=0?v<128?(B.push(v),1):v<256?(B.push(204,v),2):v<65536?(B.push(205,v>>8,v),3):v<4294967296?(B.push(206,v>>24,v>>16,v>>8,v),5):(S=v/Math.pow(2,32)|0,x=v>>>0,B.push(207,S>>24,S>>16,S>>8,S,x>>24,x>>16,x>>8,x),9):v>=-32?(B.push(v),1):v>=-128?(B.push(208,v),2):v>=-32768?(B.push(209,v>>8,v),3):v>=-2147483648?(B.push(210,v>>24,v>>16,v>>8,v),5):(S=Math.floor(v/Math.pow(2,32)),x=v>>>0,B.push(211,S>>24,S>>16,S>>8,S,x>>24,x>>16,x>>8,x),9):(B.push(203),E.push({_float:v,_length:8,_offset:B.length}),9);if("object"===z){if(null===v)return B.push(192),1;if(Array.isArray(v)){if((D=v.length)<16)B.push(144|D),h=1;else if(D<65536)B.push(220,D>>8,D),h=3;else{if(!(D<4294967296))throw new Error("Array too large");B.push(221,D>>24,D>>16,D>>8,D),h=5}for(q=0;q<D;q++)h+=o(B,E,v[q]);return h}if(v instanceof Date){var y=v.getTime(),Q=Math.floor(y/1e3),P=1e6*(y-1e3*Q);return Q>=0&&P>=0&&Q<=17179869183?0===P&&Q<=4294967295?(B.push(214,255,Q>>24,Q>>16,Q>>8,Q),6):(S=Q/4294967296,x=4294967295&Q,B.push(215,255,P>>22,P>>14,P>>6,S,x>>24,x>>16,x>>8,x),10):(S=Math.floor(Q/4294967296),x=Q>>>0,B.push(199,12,255,P>>24,P>>16,P>>8,P,S>>24,S>>16,S>>8,S,x>>24,x>>16,x>>8,x),15)}if(v instanceof ArrayBuffer){if((D=v.byteLength)<256)B.push(196,D),h=2;else if(D<65536)B.push(197,D>>8,D),h=3;else{if(!(D<4294967296))throw new Error("Buffer too large");B.push(198,D>>24,D>>16,D>>8,D),h=5}return E.push({_bin:v,_length:D,_offset:B.length}),h+D}if("function"===typeof v.toJSON)return o(B,E,v.toJSON());var G=[],Y="",a=Object.keys(v);for(q=0,c=a.length;q<c;q++)void 0!==v[Y=a[q]]&&"function"!==typeof v[Y]&&G.push(Y);if((D=G.length)<16)B.push(128|D),h=1;else if(D<65536)B.push(222,D>>8,D),h=3;else{if(!(D<4294967296))throw new Error("Object too large");B.push(223,D>>24,D>>16,D>>8,D),h=5}for(q=0;q<D;q++)h+=o(B,E,Y=G[q]),h+=o(B,E,v[Y]);return h}if("boolean"===z)return B.push(v?195:194),1;if("undefined"===z)return B.push(192),1;if("function"===typeof v.toJSON)return o(B,E,v.toJSON());throw new Error("Could not encode")}E.encode=function(B){var E=[],v=[],q=o(E,v,B),c=new ArrayBuffer(q),S=new DataView(c),x=0,D=0,h=-1;v.length>0&&(h=v[0]._offset);for(var y,Q=0,P=0,G=0,Y=E.length;G<Y;G++)if(S.setUint8(D+G,E[G]),G+1===h){if(Q=(y=v[x])._length,P=D+h,y._bin)for(var a=new Uint8Array(y._bin),m=0;m<Q;m++)S.setUint8(P+m,a[m]);else y._str?z(S,P,y._str):void 0!==y._float&&S.setFloat64(P,y._float);D+=Q,v[++x]&&(h=v[x]._offset)}return c}},12111:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.NoneSerializer=void 0;E.NoneSerializer=class{setState(B){}getState(){return null}patch(B){}teardown(){}handshake(B){}}},12109:(B,E,v)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.SchemaSerializer=void 0;const z=v(12077);E.SchemaSerializer=class{setState(B){return this.state.decode(B)}getState(){return this.state}patch(B){return this.state.decode(B)}teardown(){var B,E;null===(E=null===(B=this.state)||void 0===B?void 0:B.$changes)||void 0===E||E.root.clearRefs()}handshake(B,E){if(this.state){(new z.Reflection).decode(B,E)}else this.state=z.Reflection.decode(B,E)}}},12066:(B,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.getSerializer=E.registerSerializer=void 0;const v={};E.registerSerializer=function(B,E){v[B]=E},E.getSerializer=function(B){const E=v[B];if(!E)throw new Error("missing serializer: "+B);return E}},12040:function(B,E,v){"use strict";var z=this&&this.__importDefault||function(B){return B&&B.__esModule?B:{default:B}};Object.defineProperty(E,"__esModule",{value:!0}),E.WebSocketTransport=void 0;const o=z(v(12049)),q=globalThis.WebSocket||o.default;E.WebSocketTransport=class{constructor(B){this.events=B}send(B){B instanceof ArrayBuffer?this.ws.send(B):Array.isArray(B)&&this.ws.send(new Uint8Array(B).buffer)}connect(B,E){try{this.ws=new q(B,{headers:E,protocols:this.protocols})}catch(v){this.ws=new q(B,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(B,E){this.ws.close(B,E)}get isOpen(){return this.ws.readyState===q.OPEN}}},12049:B=>{"use strict";B.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12472:B=>{"use strict";B.exports=function(B){for(var E=new Array(B),v=0;v<B;++v)E[v]=v;return E}},12475:B=>{function E(B){return!!B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}B.exports=function(B){return null!=B&&(E(B)||function(B){return"function"===typeof B.readFloatLE&&"function"===typeof B.slice&&E(B.slice(0,0))}(B)||!!B._isBuffer)}},12470:(B,E,v)=>{var z=v(12472),o=v(12475),q="undefined"!==typeof Float64Array;function c(B,E){return B[0]-E[0]}function S(){var B,E=this.stride,v=new Array(E.length);for(B=0;B<v.length;++B)v[B]=[Math.abs(E[B]),B];v.sort(c);var z=new Array(v.length);for(B=0;B<z.length;++B)z[B]=v[B][1];return z}function x(B,E){var v=["View",E,"d",B].join("");E<0&&(v="View_Nil"+B);var o="generic"===B;if(-1===E){var q="function "+v+"(a){this.data=a;};var proto="+v+".prototype;proto.dtype='"+B+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+v+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+v+"(a){return new "+v+"(a);}";return new Function(q)()}if(0===E){q="function "+v+"(a,d) {this.data = a;this.offset = d};var proto="+v+".prototype;proto.dtype='"+B+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+v+"_copy() {return new "+v+"(this.data,this.offset)};proto.pick=function "+v+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+v+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+v+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+v+"(a,b,c,d){return new "+v+"(a,d)}";return new Function("TrivialArray",q)(D[B][0])}q=["'use strict'"];var c=z(E),x=c.map((function(B){return"i"+B})),h="this.offset+"+c.map((function(B){return"this.stride["+B+"]*i"+B})).join("+"),y=c.map((function(B){return"b"+B})).join(","),Q=c.map((function(B){return"c"+B})).join(",");q.push("function "+v+"(a,"+y+","+Q+",d){this.data=a","this.shape=["+y+"]","this.stride=["+Q+"]","this.offset=d|0}","var proto="+v+".prototype","proto.dtype='"+B+"'","proto.dimension="+E),q.push("Object.defineProperty(proto,'size',{get:function "+v+"_size(){return "+c.map((function(B){return"this.shape["+B+"]"})).join("*"),"}})"),1===E?q.push("proto.order=[0]"):(q.push("Object.defineProperty(proto,'order',{get:"),E<4?(q.push("function "+v+"_order(){"),2===E?q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):q.push("ORDER})")),q.push("proto.set=function "+v+"_set("+x.join(",")+",v){"),o?q.push("return this.data.set("+h+",v)}"):q.push("return this.data["+h+"]=v}"),q.push("proto.get=function "+v+"_get("+x.join(",")+"){"),o?q.push("return this.data.get("+h+")}"):q.push("return this.data["+h+"]}"),q.push("proto.index=function "+v+"_index(",x.join(),"){return "+h+"}"),q.push("proto.hi=function "+v+"_hi("+x.join(",")+"){return new "+v+"(this.data,"+c.map((function(B){return["(typeof i",B,"!=='number'||i",B,"<0)?this.shape[",B,"]:i",B,"|0"].join("")})).join(",")+","+c.map((function(B){return"this.stride["+B+"]"})).join(",")+",this.offset)}");var P=c.map((function(B){return"a"+B+"=this.shape["+B+"]"})),G=c.map((function(B){return"c"+B+"=this.stride["+B+"]"}));q.push("proto.lo=function "+v+"_lo("+x.join(",")+"){var b=this.offset,d=0,"+P.join(",")+","+G.join(","));for(var Y=0;Y<E;++Y)q.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");q.push("return new "+v+"(this.data,"+c.map((function(B){return"a"+B})).join(",")+","+c.map((function(B){return"c"+B})).join(",")+",b)}"),q.push("proto.step=function "+v+"_step("+x.join(",")+"){var "+c.map((function(B){return"a"+B+"=this.shape["+B+"]"})).join(",")+","+c.map((function(B){return"b"+B+"=this.stride["+B+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<E;++Y)q.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");q.push("return new "+v+"(this.data,"+c.map((function(B){return"a"+B})).join(",")+","+c.map((function(B){return"b"+B})).join(",")+",c)}");var a=new Array(E),m=new Array(E);for(Y=0;Y<E;++Y)a[Y]="a[i"+Y+"]",m[Y]="b[i"+Y+"]";q.push("proto.transpose=function "+v+"_transpose("+x+"){"+x.map((function(B,E){return B+"=("+B+"===undefined?"+E+":"+B+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+v+"(this.data,"+a.join(",")+","+m.join(",")+",this.offset)}"),q.push("proto.pick=function "+v+"_pick("+x+"){var a=[],b=[],c=this.offset");for(Y=0;Y<E;++Y)q.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),q.push("return function construct_"+v+"(data,shape,stride,offset){return new "+v+"(data,"+c.map((function(B){return"shape["+B+"]"})).join(",")+","+c.map((function(B){return"stride["+B+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",q.join("\n"))(D[B],S)}var D={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};B.exports=function(B,E,v,z){if(void 0===B)return(0,D.array[0])([]);"number"===typeof B&&(B=[B]),void 0===E&&(E=[B.length]);var c=E.length;if(void 0===v){v=new Array(c);for(var S=c-1,h=1;S>=0;--S)v[S]=h,h*=E[S]}if(void 0===z){z=0;for(S=0;S<c;++S)v[S]<0&&(z-=(E[S]-1)*v[S])}for(var y=function(B){if(o(B))return"buffer";if(q)switch(Object.prototype.toString.call(B)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(B)?"array":"generic"}(B),Q=D[y];Q.length<=c+1;)Q.push(x(y,Q.length-1));return(0,Q[c+1])(B,E,v,z)}},13459:B=>{var E;self,E=()=>(()=>{"use strict";var B={d:(E,v)=>{for(var z in v)B.o(v,z)&&!B.o(E,z)&&Object.defineProperty(E,z,{enumerable:!0,get:v[z]})},o:(B,E)=>Object.prototype.hasOwnProperty.call(B,E)},E={};B.d(E,{default:()=>d});var v,z=function(B,E){var v=E.x-B.x,z=E.y-B.y;return Math.sqrt(v*v+z*z)},o=function(B){return B*(Math.PI/180)},q=new Map,c=function(B){q.has(B)&&clearTimeout(q.get(B)),q.set(B,setTimeout(B,100))},S=function(B,E,v){for(var z,o=E.split(/[ ,]+/g),q=0;q<o.length;q+=1)z=o[q],B.addEventListener?B.addEventListener(z,v,!1):B.attachEvent&&B.attachEvent(z,v)},x=function(B,E,v){for(var z,o=E.split(/[ ,]+/g),q=0;q<o.length;q+=1)z=o[q],B.removeEventListener?B.removeEventListener(z,v):B.detachEvent&&B.detachEvent(z,v)},D=function(B){return B.preventDefault(),B.type.match(/^touch/)?B.changedTouches:B},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},y=function(B,E){E.top||E.right||E.bottom||E.left?(B.style.top=E.top,B.style.right=E.right,B.style.bottom=E.bottom,B.style.left=E.left):(B.style.left=E.x+"px",B.style.top=E.y+"px")},Q=function(B,E,v){var z=P(B);for(var o in z)if(z.hasOwnProperty(o))if("string"==typeof E)z[o]=E+" "+v;else{for(var q="",c=0,S=E.length;c<S;c+=1)q+=E[c]+" "+v+", ";z[o]=q.slice(0,-2)}return z},P=function(B){var E={};return E[B]="",["webkit","Moz","o"].forEach((function(v){E[v+B.charAt(0).toUpperCase()+B.slice(1)]=""})),E},G=function(B,E){for(var v in E)E.hasOwnProperty(v)&&(B[v]=E[v]);return B},Y=function(B,E){if(B.length)for(var v=0,z=B.length;v<z;v+=1)E(B[v]);else E(B)},a="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,m=window.matchMedia("(any-hover: none)").matches,g=!!("ontouchstart"in window),V=!!window.PointerEvent,T=!!window.MSPointerEvent,N={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},X={start:"mousedown",move:"mousemove",end:"mouseup"},r={};function i(){}a&&!m?v=N:V?v={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:T?v={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:g?(v=N,r=X):v=X,i.prototype.on=function(B,E){var v,z=this,o=B.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var q=0;q<o.length;q+=1)v=o[q],z._handlers_[v]=z._handlers_[v]||[],z._handlers_[v].push(E);return z},i.prototype.off=function(B,E){var v=this;return v._handlers_=v._handlers_||{},void 0===B?v._handlers_={}:void 0===E?v._handlers_[B]=null:v._handlers_[B]&&v._handlers_[B].indexOf(E)>=0&&v._handlers_[B].splice(v._handlers_[B].indexOf(E),1),v},i.prototype.trigger=function(B,E){var v,z=this,o=B.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var q=0;q<o.length;q+=1)v=o[q],z._handlers_[v]&&z._handlers_[v].length&&z._handlers_[v].forEach((function(B){B.call(z,{type:v,target:z},E)}))},i.prototype.config=function(B){var E=this;E.options=E.defaults||{},B&&(E.options=function(B,E){var v={};for(var z in B)B.hasOwnProperty(z)&&E.hasOwnProperty(z)?v[z]=E[z]:B.hasOwnProperty(z)&&(v[z]=B[z]);return v}(E.options,B))},i.prototype.bindEvt=function(B,E){var z=this;return z._domHandlers_=z._domHandlers_||{},z._domHandlers_[E]=function(){"function"==typeof z["on"+E]?z["on"+E].apply(z,arguments):console.warn('[WARNING] : Missing "on'+E+'" handler.')},S(B,v[E],z._domHandlers_[E]),r[E]&&S(B,r[E],z._domHandlers_[E]),z},i.prototype.unbindEvt=function(B,E){var z=this;return z._domHandlers_=z._domHandlers_||{},x(B,v[E],z._domHandlers_[E]),r[E]&&x(B,r[E],z._domHandlers_[E]),delete z._domHandlers_[E],this};const u=i;function I(B,E){return this.identifier=E.identifier,this.position=E.position,this.frontPosition=E.frontPosition,this.collection=B,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(E),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=I.id,I.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}I.prototype=new u,I.constructor=I,I.id=0,I.prototype.buildEl=function(B){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},I.prototype.stylize=function(){if(this.options.dataOnly)return this;var B=this.options.fadeTime+"ms",E=function(){var B=P("borderRadius");for(var E in B)B.hasOwnProperty(E)&&(B[E]="50%");return B}(),v=Q("transition","opacity",B),z={};return z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},G(z.el,v),"circle"===this.options.shape&&G(z.back,E),G(z.front,E),this.applyStyles(z),this},I.prototype.applyStyles=function(B){for(var E in this.ui)if(this.ui.hasOwnProperty(E))for(var v in B[E])this.ui[E].style[v]=B[E][v];return this},I.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},I.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},I.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},I.prototype.show=function(B){var E=this;return E.options.dataOnly||(clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.addToDom(),E.restCallback(),setTimeout((function(){E.ui.el.style.opacity=1}),0),E.showTimeout=setTimeout((function(){E.trigger("shown",E.instance),"function"==typeof B&&B.call(this)}),E.options.fadeTime)),E},I.prototype.hide=function(B){var E=this;if(E.options.dataOnly)return E;if(E.ui.el.style.opacity=E.options.restOpacity,clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.removeTimeout=setTimeout((function(){var v="dynamic"===E.options.mode?"none":"block";E.ui.el.style.display=v,"function"==typeof B&&B.call(E),E.trigger("hidden",E.instance)}),E.options.fadeTime),E.options.restJoystick){var v=E.options.restJoystick,z={};z.x=!0===v||!1!==v.x?0:E.instance.frontPosition.x,z.y=!0===v||!1!==v.y?0:E.instance.frontPosition.y,E.setPosition(B,z)}return E},I.prototype.setPosition=function(B,E){var v=this;v.frontPosition={x:E.x,y:E.y};var z=v.options.fadeTime+"ms",o={};o.front=Q("transition",["transform"],z);var q={front:{}};q.front={transform:"translate("+v.frontPosition.x+"px,"+v.frontPosition.y+"px)"},v.applyStyles(o),v.applyStyles(q),v.restTimeout=setTimeout((function(){"function"==typeof B&&B.call(v),v.restCallback()}),v.options.fadeTime)},I.prototype.restCallback=function(){var B=this,E={};E.front=Q("transition","none",""),B.applyStyles(E),B.trigger("rested",B.instance)},I.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},I.prototype.computeDirection=function(B){var E,v,z,o=B.angle.radian,q=Math.PI/4,c=Math.PI/2;if(o>q&&o<3*q&&!B.lockX?E="up":o>-q&&o<=q&&!B.lockY?E="left":o>3*-q&&o<=-q&&!B.lockX?E="down":B.lockY||(E="right"),B.lockY||(v=o>-c&&o<c?"left":"right"),B.lockX||(z=o>0?"up":"down"),B.force>this.options.threshold){var S,x={};for(S in this.direction)this.direction.hasOwnProperty(S)&&(x[S]=this.direction[S]);var D={};for(S in this.direction={x:v,y:z,angle:E},B.direction=this.direction,x)x[S]===this.direction[S]&&(D[S]=!0);if(D.x&&D.y&&D.angle)return B;D.x&&D.y||this.trigger("plain",B),D.x||this.trigger("plain:"+v,B),D.y||this.trigger("plain:"+z,B),D.angle||this.trigger("dir dir:"+E,B)}else this.resetDirection();return B};const K=I;function C(B,E){var v=this;v.nipples=[],v.idles=[],v.actives=[],v.ids=[],v.pressureIntervals={},v.manager=B,v.id=C.id,C.id+=1,v.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},v.config(E),"static"!==v.options.mode&&"semi"!==v.options.mode||(v.options.multitouch=!1),v.options.multitouch||(v.options.maxNumberOfNipples=1);var z=getComputedStyle(v.options.zone.parentElement);return z&&"flex"===z.display&&(v.parentIsFlex=!0),v.updateBox(),v.prepareNipples(),v.JQ(),v.begin(),v.nipples}C.prototype=new u,C.constructor=C,C.id=0,C.prototype.prepareNipples=function(){var B=this,E=B.nipples;E.on=B.on.bind(B),E.off=B.off.bind(B),E.options=B.options,E.destroy=B.destroy.bind(B),E.ids=B.ids,E.id=B.id,E.processOnMove=B.processOnMove.bind(B),E.processOnEnd=B.processOnEnd.bind(B),E.get=function(B){if(void 0===B)return E[0];for(var v=0,z=E.length;v<z;v+=1)if(E[v].identifier===B)return E[v];return!1}},C.prototype.JQ=function(){var B=this;B.bindEvt(B.options.zone,"start"),B.options.zone.style.touchAction="none",B.options.zone.style.msTouchAction="none"},C.prototype.begin=function(){var B=this,E=B.options;if("static"===E.mode){var v=B.createNipple(E.position,B.manager.getIdentifier());v.add(),B.idles.push(v)}},C.prototype.createNipple=function(B,E){var v=this,z=v.manager.scroll,o={},q=v.options,c=v.parentIsFlex?z.x:z.x+v.box.left,S=v.parentIsFlex?z.y:z.y+v.box.top;if(B.x&&B.y)o={x:B.x-c,y:B.y-S};else if(B.top||B.right||B.bottom||B.left){var x=document.createElement("DIV");x.style.display="hidden",x.style.top=B.top,x.style.right=B.right,x.style.bottom=B.bottom,x.style.left=B.left,x.style.position="absolute",q.zone.appendChild(x);var D=x.getBoundingClientRect();q.zone.removeChild(x),o=B,B={x:D.left+z.x,y:D.top+z.y}}var h=new K(v,{color:q.color,size:q.size,threshold:q.threshold,fadeTime:q.fadeTime,dataOnly:q.dataOnly,restJoystick:q.restJoystick,restOpacity:q.restOpacity,mode:q.mode,identifier:E,position:B,zone:q.zone,frontPosition:{x:0,y:0},shape:q.shape});return q.dataOnly||(y(h.ui.el,o),y(h.ui.front,h.frontPosition)),v.nipples.push(h),v.trigger("added "+h.identifier+":added",h),v.manager.trigger("added "+h.identifier+":added",h),v.bindNipple(h),h},C.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},C.prototype.bindNipple=function(B){var E,v=this,z=function(B,z){E=B.type+" "+z.id+":"+B.type,v.trigger(E,z)};B.on("destroyed",v.onDestroyed.bind(v)),B.on("shown hidden rested dir plain",z),B.on("dir:up dir:right dir:down dir:left",z),B.on("plain:up plain:right plain:down plain:left",z)},C.prototype.pressureFn=function(B,E,v){var z=this,o=0;clearInterval(z.pressureIntervals[v]),z.pressureIntervals[v]=setInterval(function(){var v=B.force||B.pressure||B.webkitForce||0;v!==o&&(E.trigger("pressure",v),z.trigger("pressure "+E.identifier+":pressure",v),o=v)}.bind(z),100)},C.prototype.onstart=function(B){var E=this,v=E.options,z=B;return B=D(B),E.updateBox(),Y(B,(function(o){E.actives.length<v.maxNumberOfNipples?E.processOnStart(o):z.type.match(/^touch/)&&(Object.keys(E.manager.ids).forEach((function(v){if(Object.values(z.touches).findIndex((function(B){return B.identifier===v}))<0){var o=[B[0]];o.identifier=v,E.processOnEnd(o)}})),E.actives.length<v.maxNumberOfNipples&&E.processOnStart(o))})),E.manager.bindDocument(),!1},C.prototype.processOnStart=function(B){var E,v=this,o=v.options,q=v.manager.getIdentifier(B),c=B.force||B.pressure||B.webkitForce||0,S={x:B.pageX,y:B.pageY},x=v.getOrCreate(q,S);x.identifier!==q&&v.manager.removeIdentifier(x.identifier),x.identifier=q;var D=function(E){E.trigger("start",E),v.trigger("start "+E.id+":start",E),E.show(),c>0&&v.pressureFn(B,E,E.identifier),v.processOnMove(B)};if((E=v.idles.indexOf(x))>=0&&v.idles.splice(E,1),v.actives.push(x),v.ids.push(x.identifier),"semi"!==o.mode)D(x);else{if(!(z(S,x.position)<=o.catchDistance))return x.destroy(),void v.processOnStart(B);D(x)}return x},C.prototype.getOrCreate=function(B,E){var v,z=this,o=z.options;return/(semi|static)/.test(o.mode)?(v=z.idles[0])?(z.idles.splice(0,1),v):"semi"===o.mode?z.createNipple(E,B):(console.warn("Coudln't find the needed nipple."),!1):v=z.createNipple(E,B)},C.prototype.processOnMove=function(B){var E=this,v=E.options,q=E.manager.getIdentifier(B),c=E.nipples.get(q),S=E.manager.scroll;if(function(B){return isNaN(B.buttons)?0!==B.pressure:0!==B.buttons}(B)){if(!c)return console.error("Found zombie joystick with ID "+q),void E.manager.removeIdentifier(q);if(v.dynamicPage){var x=c.el.getBoundingClientRect();c.position={x:S.x+x.left,y:S.y+x.top}}c.identifier=q;var D=c.options.size/2,h={x:B.pageX,y:B.pageY};v.lockX&&(h.y=c.position.y),v.lockY&&(h.x=c.position.x);var y,Q,P,G,Y,a,m,g,V,T,N=z(h,c.position),X=(y=h,P=(Q=c.position).x-y.x,G=Q.y-y.y,function(B){return B*(180/Math.PI)}(Math.atan2(G,P))),r=o(X),i=N/D,u={distance:N,position:h};if("circle"===c.options.shape?(Y=Math.min(N,D),m=c.position,g=Y,T={x:0,y:0},V=o(V=X),T.x=m.x-g*Math.cos(V),T.y=m.y-g*Math.sin(V),a=T):(a=function(B,E,v){return{x:Math.min(Math.max(B.x,E.x-v),E.x+v),y:Math.min(Math.max(B.y,E.y-v),E.y+v)}}(h,c.position,D),Y=z(a,c.position)),v.follow){if(N>D){var I=h.x-a.x,K=h.y-a.y;c.position.x+=I,c.position.y+=K,c.el.style.top=c.position.y-(E.box.top+S.y)+"px",c.el.style.left=c.position.x-(E.box.left+S.x)+"px",N=z(h,c.position)}}else h=a,N=Y;var C=h.x-c.position.x,f=h.y-c.position.y;c.frontPosition={x:C,y:f},v.dataOnly||(c.ui.front.style.transform="translate("+C+"px,"+f+"px)");var A={identifier:c.identifier,position:h,force:i,pressure:B.force||B.pressure||B.webkitForce||0,distance:N,angle:{radian:r,degree:X},vector:{x:C/D,y:-f/D},raw:u,instance:c,lockX:v.lockX,lockY:v.lockY};(A=c.computeDirection(A)).angle={radian:o(180-X),degree:180-X},c.trigger("move",A),E.trigger("move "+c.id+":move",A)}else this.processOnEnd(B)},C.prototype.processOnEnd=function(B){var E=this,v=E.options,z=E.manager.getIdentifier(B),o=E.nipples.get(z),q=E.manager.removeIdentifier(o.identifier);o&&(v.dataOnly||o.hide((function(){"dynamic"===v.mode&&(o.trigger("removed",o),E.trigger("removed "+o.id+":removed",o),E.manager.trigger("removed "+o.id+":removed",o),o.destroy())})),clearInterval(E.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),E.trigger("end "+o.id+":end",o),E.ids.indexOf(o.identifier)>=0&&E.ids.splice(E.ids.indexOf(o.identifier),1),E.actives.indexOf(o)>=0&&E.actives.splice(E.actives.indexOf(o),1),/(semi|static)/.test(v.mode)?E.idles.push(o):E.nipples.indexOf(o)>=0&&E.nipples.splice(E.nipples.indexOf(o),1),E.manager.unbindDocument(),/(semi|static)/.test(v.mode)&&(E.manager.ids[q.id]=q.identifier))},C.prototype.onDestroyed=function(B,E){var v=this;v.nipples.indexOf(E)>=0&&v.nipples.splice(v.nipples.indexOf(E),1),v.actives.indexOf(E)>=0&&v.actives.splice(v.actives.indexOf(E),1),v.idles.indexOf(E)>=0&&v.idles.splice(v.idles.indexOf(E),1),v.ids.indexOf(E.identifier)>=0&&v.ids.splice(v.ids.indexOf(E.identifier),1),v.manager.removeIdentifier(E.identifier),v.manager.unbindDocument()},C.prototype.destroy=function(){var B=this;for(var E in B.unbindEvt(B.options.zone,"start"),B.nipples.forEach((function(B){B.destroy()})),B.pressureIntervals)B.pressureIntervals.hasOwnProperty(E)&&clearInterval(B.pressureIntervals[E]);B.trigger("destroyed",B.nipples),B.manager.unbindDocument(),B.off()};const f=C;function A(B){var E=this;E.ids={},E.index=0,E.collections=[],E.scroll=h(),E.config(B),E.prepareCollections();var v=function(){var B;E.collections.forEach((function(v){v.forEach((function(v){B=v.el.getBoundingClientRect(),v.position={x:E.scroll.x+B.left,y:E.scroll.y+B.top}}))}))};S(window,"resize",(function(){c(v)}));var z=function(){E.scroll=h()};return S(window,"scroll",(function(){c(z)})),E.collections}A.prototype=new u,A.constructor=A,A.prototype.prepareCollections=function(){var B=this;B.collections.create=B.create.bind(B),B.collections.on=B.on.bind(B),B.collections.off=B.off.bind(B),B.collections.destroy=B.destroy.bind(B),B.collections.get=function(E){var v;return B.collections.every((function(B){return!(v=B.get(E))})),v}},A.prototype.create=function(B){return this.createCollection(B)},A.prototype.createCollection=function(B){var E=this,v=new f(E,B);return E.bindCollection(v),E.collections.push(v),v},A.prototype.bindCollection=function(B){var E,v=this,z=function(B,z){E=B.type+" "+z.id+":"+B.type,v.trigger(E,z)};B.on("destroyed",v.onDestroyed.bind(v)),B.on("shown hidden rested dir plain",z),B.on("dir:up dir:right dir:down dir:left",z),B.on("plain:up plain:right plain:down plain:left",z)},A.prototype.bindDocument=function(){var B=this;B.binded||(B.bindEvt(document,"move").bindEvt(document,"end"),B.binded=!0)},A.prototype.unbindDocument=function(B){var E=this;Object.keys(E.ids).length&&!0!==B||(E.unbindEvt(document,"move").unbindEvt(document,"end"),E.binded=!1)},A.prototype.getIdentifier=function(B){var E;return B?void 0===(E=void 0===B.identifier?B.pointerId:B.identifier)&&(E=this.latest||0):E=this.index,void 0===this.ids[E]&&(this.ids[E]=this.index,this.index+=1),this.latest=E,this.ids[E]},A.prototype.removeIdentifier=function(B){var E={};for(var v in this.ids)if(this.ids[v]===B){E.id=v,E.identifier=this.ids[v],delete this.ids[v];break}return E},A.prototype.onmove=function(B){return this.onAny("move",B),!1},A.prototype.onend=function(B){return this.onAny("end",B),!1},A.prototype.oncancel=function(B){return this.onAny("end",B),!1},A.prototype.onAny=function(B,E){var v,z=this,o="processOn"+B.charAt(0).toUpperCase()+B.slice(1);E=D(E);var q=function(B,E,v){v.ids.indexOf(E)>=0&&(v[o](B),B._found_=!0)};return Y(E,(function(B){v=z.getIdentifier(B),Y(z.collections,q.bind(null,B,v)),B._found_||z.removeIdentifier(v)})),!1},A.prototype.destroy=function(){var B=this;B.unbindDocument(!0),B.ids={},B.index=0,B.collections.forEach((function(B){B.destroy()})),B.off()},A.prototype.onDestroyed=function(B,E){var v=this;if(v.collections.indexOf(E)<0)return!1;v.collections.splice(v.collections.indexOf(E),1)};var l=new A;const d={create:function(B){return l.create(B)},factory:l};return E.default})(),B.exports=E()},12492:(B,E,v)=>{"use strict";const{Deflate:z,deflate:o,deflateRaw:q,gzip:c}=v(12500),{Inflate:S,inflate:x,inflateRaw:D,ungzip:h}=v(12558),y=v(12541);B.exports.Deflate=z,B.exports.deflate=o,B.exports.deflateRaw=q,B.exports.gzip=c,B.exports.Inflate=S,B.exports.inflate=x,B.exports.inflateRaw=D,B.exports.ungzip=h,B.exports.constants=y},12500:(B,E,v)=>{"use strict";const z=v(12508),o=v(12545),q=v(12548),c=v(12538),S=v(12552),x=Object.prototype.toString,{Z_NO_FLUSH:D,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:y,Z_FINISH:Q,Z_OK:P,Z_STREAM_END:G,Z_DEFAULT_COMPRESSION:Y,Z_DEFAULT_STRATEGY:a,Z_DEFLATED:m}=v(12541);function g(B){this.options=o.assign({level:Y,method:m,RB:16384,windowBits:15,memLevel:8,strategy:a},B||{});let E=this.options;E.raw&&E.windowBits>0?E.windowBits=-E.windowBits:E.gzip&&E.windowBits>0&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.DE="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let v=z.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(v!==P)throw new Error(c[v]);if(E.header&&z.deflateSetHeader(this.strm,E.header),E.dictionary){let B;if(B="string"===typeof E.dictionary?q.string2buf(E.dictionary):"[object ArrayBuffer]"===x.call(E.dictionary)?new Uint8Array(E.dictionary):E.dictionary,v=z.deflateSetDictionary(this.strm,B),v!==P)throw new Error(c[v]);this._dict_set=!0}}function V(B,E){const v=new g(E);if(v.push(B,!0),v.err)throw v.DE||c[v.err];return v.result}g.prototype.push=function(B,E){const v=this.strm,o=this.options.RB;let c,S;if(this.ended)return!1;for(S=E===~~E?E:!0===E?Q:D,"string"===typeof B?v.input=q.string2buf(B):"[object ArrayBuffer]"===x.call(B)?v.input=new Uint8Array(B):v.input=B,v.next_in=0,v.avail_in=v.input.length;;)if(0===v.avail_out&&(v.output=new Uint8Array(o),v.next_out=0,v.avail_out=o),(S===h||S===y)&&v.avail_out<=6)this.onData(v.output.subarray(0,v.next_out)),v.avail_out=0;else{if(c=z.deflate(v,S),c===G)return v.next_out>0&&this.onData(v.output.subarray(0,v.next_out)),c=z.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===P;if(0!==v.avail_out){if(S>0&&v.next_out>0)this.onData(v.output.subarray(0,v.next_out)),v.avail_out=0;else if(0===v.avail_in)break}else this.onData(v.output)}return!0},g.prototype.onData=function(B){this.chunks.push(B)},g.prototype.onEnd=function(B){B===P&&(this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.DE=this.strm.DE},B.exports.Deflate=g,B.exports.deflate=V,B.exports.deflateRaw=function(B,E){return(E=E||{}).raw=!0,V(B,E)},B.exports.gzip=function(B,E){return(E=E||{}).gzip=!0,V(B,E)},B.exports.constants=v(12541)},12558:(B,E,v)=>{"use strict";const z=v(12564),o=v(12545),q=v(12548),c=v(12538),S=v(12552),x=v(12581),D=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:y,Z_OK:Q,Z_STREAM_END:P,Z_NEED_DICT:G,Z_STREAM_ERROR:Y,Z_DATA_ERROR:a,Z_MEM_ERROR:m}=v(12541);function g(B){this.options=o.assign({RB:65536,windowBits:15,to:""},B||{});const E=this.options;E.raw&&E.windowBits>=0&&E.windowBits<16&&(E.windowBits=-E.windowBits,0===E.windowBits&&(E.windowBits=-15)),!(E.windowBits>=0&&E.windowBits<16)||B&&B.windowBits||(E.windowBits+=32),E.windowBits>15&&E.windowBits<48&&0===(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.DE="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let v=z.inflateInit2(this.strm,E.windowBits);if(v!==Q)throw new Error(c[v]);if(this.header=new x,z.inflateGetHeader(this.strm,this.header),E.dictionary&&("string"===typeof E.dictionary?E.dictionary=q.string2buf(E.dictionary):"[object ArrayBuffer]"===D.call(E.dictionary)&&(E.dictionary=new Uint8Array(E.dictionary)),E.raw&&(v=z.inflateSetDictionary(this.strm,E.dictionary),v!==Q)))throw new Error(c[v])}function V(B,E){const v=new g(E);if(v.push(B),v.err)throw v.DE||c[v.err];return v.result}g.prototype.push=function(B,E){const v=this.strm,o=this.options.RB,c=this.options.dictionary;let S,x,g;if(this.ended)return!1;for(x=E===~~E?E:!0===E?y:h,"[object ArrayBuffer]"===D.call(B)?v.input=new Uint8Array(B):v.input=B,v.next_in=0,v.avail_in=v.input.length;;){for(0===v.avail_out&&(v.output=new Uint8Array(o),v.next_out=0,v.avail_out=o),S=z.inflate(v,x),S===G&&c&&(S=z.inflateSetDictionary(v,c),S===Q?S=z.inflate(v,x):S===a&&(S=G));v.avail_in>0&&S===P&&v.state.wrap>0&&0!==B[v.next_in];)z.inflateReset(v),S=z.inflate(v,x);switch(S){case Y:case a:case G:case m:return this.onEnd(S),this.ended=!0,!1}if(g=v.avail_out,v.next_out&&(0===v.avail_out||S===P))if("string"===this.options.to){let B=q.utf8border(v.output,v.next_out),E=v.next_out-B,z=q.buf2string(v.output,B);v.next_out=E,v.avail_out=o-E,E&&v.output.set(v.output.subarray(B,B+E),0),this.onData(z)}else this.onData(v.output.length===v.next_out?v.output:v.output.subarray(0,v.next_out));if(S!==Q||0!==g){if(S===P)return S=z.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,!0;if(0===v.avail_in)break}}return!0},g.prototype.onData=function(B){this.chunks.push(B)},g.prototype.onEnd=function(B){B===Q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.DE=this.strm.DE},B.exports.Inflate=g,B.exports.inflate=V,B.exports.inflateRaw=function(B,E){return(E=E||{}).raw=!0,V(B,E)},B.exports.ungzip=V,B.exports.constants=v(12541)},12545:B=>{"use strict";const E=(B,E)=>Object.prototype.hasOwnProperty.call(B,E);B.exports.assign=function(B){const v=Array.prototype.slice.call(arguments,1);for(;v.length;){const z=v.shift();if(z){if("object"!==typeof z)throw new TypeError(z+"must be non-object");for(const v in z)E(z,v)&&(B[v]=z[v])}}return B},B.exports.flattenChunks=B=>{let E=0;for(let z=0,o=B.length;z<o;z++)E+=B[z].length;const v=new Uint8Array(E);for(let z=0,o=0,q=B.length;z<q;z++){let E=B[z];v.set(E,o),o+=E.length}return v}},12548:B=>{"use strict";let E=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(z){E=!1}const v=new Uint8Array(256);for(let o=0;o<256;o++)v[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;v[254]=v[254]=1,B.exports.string2buf=B=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(B);let E,v,z,o,q,c=B.length,S=0;for(o=0;o<c;o++)v=B.charCodeAt(o),55296===(64512&v)&&o+1<c&&(z=B.charCodeAt(o+1),56320===(64512&z)&&(v=65536+(v-55296<<10)+(z-56320),o++)),S+=v<128?1:v<2048?2:v<65536?3:4;for(E=new Uint8Array(S),q=0,o=0;q<S;o++)v=B.charCodeAt(o),55296===(64512&v)&&o+1<c&&(z=B.charCodeAt(o+1),56320===(64512&z)&&(v=65536+(v-55296<<10)+(z-56320),o++)),v<128?E[q++]=v:v<2048?(E[q++]=192|v>>>6,E[q++]=128|63&v):v<65536?(E[q++]=224|v>>>12,E[q++]=128|v>>>6&63,E[q++]=128|63&v):(E[q++]=240|v>>>18,E[q++]=128|v>>>12&63,E[q++]=128|v>>>6&63,E[q++]=128|63&v);return E};B.exports.buf2string=(B,z)=>{const o=z||B.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(B.subarray(0,z));let q,c;const S=new Array(2*o);for(c=0,q=0;q<o;){let E=B[q++];if(E<128){S[c++]=E;continue}let z=v[E];if(z>4)S[c++]=65533,q+=z-1;else{for(E&=2===z?31:3===z?15:7;z>1&&q<o;)E=E<<6|63&B[q++],z--;z>1?S[c++]=65533:E<65536?S[c++]=E:(E-=65536,S[c++]=55296|E>>10&1023,S[c++]=56320|1023&E)}}return((B,v)=>{if(v<65534&&B.subarray&&E)return String.fromCharCode.apply(null,B.length===v?B:B.subarray(0,v));let z="";for(let E=0;E<v;E++)z+=String.fromCharCode(B[E]);return z})(S,c)},B.exports.utf8border=(B,E)=>{(E=E||B.length)>B.length&&(E=B.length);let z=E-1;for(;z>=0&&128===(192&B[z]);)z--;return z<0||0===z?E:z+v[B[z]]>E?z:E}},12521:B=>{"use strict";B.exports=(B,E,v,z)=>{let o=65535&B,q=B>>>16&65535,c=0;for(;0!==v;){c=v>2e3?2e3:v,v-=c;do{o=o+E[z++]|0,q=q+o|0}while(--c);o%=65521,q%=65521}return o|q<<16}},12541:B=>{"use strict";B.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12530:B=>{"use strict";const E=new Uint32Array((()=>{let B,E=[];for(var v=0;v<256;v++){B=v;for(var z=0;z<8;z++)B=1&B?3988292384^B>>>1:B>>>1;E[v]=B}return E})());B.exports=(B,v,z,o)=>{const q=E,c=o+z;B^=-1;for(let E=o;E<c;E++)B=B>>>8^q[255&(B^v[E])];return~B}},12508:(B,E,v)=>{"use strict";const{_tr_init:z,_tr_stored_block:o,_tr_flush_block:q,_tr_tally:c,_tr_align:S}=v(12515),x=v(12521),D=v(12530),h=v(12538),{Z_NO_FLUSH:y,Z_PARTIAL_FLUSH:Q,Z_FULL_FLUSH:P,Z_FINISH:G,Z_BLOCK:Y,Z_OK:a,Z_STREAM_END:m,Z_STREAM_ERROR:g,Z_DATA_ERROR:V,Z_BUF_ERROR:T,Z_DEFAULT_COMPRESSION:N,Z_FILTERED:X,Z_HUFFMAN_ONLY:r,Z_RLE:i,Z_FIXED:u,Z_DEFAULT_STRATEGY:I,Z_UNKNOWN:K,Z_DEFLATED:C}=v(12541),f=258,A=262,l=103,d=113,t=666,p=(B,E)=>(B.DE=h[E],E),H=B=>(B<<1)-(B>4?9:0),j=B=>{let E=B.length;for(;--E>=0;)B[E]=0};let R=(B,E,v)=>(E<<B.hash_shift^v)&B.hash_mask;const b=B=>{const E=B.state;let v=E.pending;v>B.avail_out&&(v=B.avail_out),0!==v&&(B.output.set(E.pending_buf.subarray(E.pending_out,E.pending_out+v),B.next_out),B.next_out+=v,E.pending_out+=v,B.total_out+=v,B.avail_out-=v,E.pending-=v,0===E.pending&&(E.pending_out=0))},F=(B,E)=>{q(B,B.block_start>=0?B.block_start:-1,B.strstart-B.block_start,E),B.block_start=B.strstart,b(B.strm)},W=(B,E)=>{B.pending_buf[B.pending++]=E},w=(B,E)=>{B.pending_buf[B.pending++]=E>>>8&255,B.pending_buf[B.pending++]=255&E},n=(B,E,v,z)=>{let o=B.avail_in;return o>z&&(o=z),0===o?0:(B.avail_in-=o,E.set(B.input.subarray(B.next_in,B.next_in+o),v),1===B.state.wrap?B.adler=x(B.adler,E,o,v):2===B.state.wrap&&(B.adler=D(B.adler,E,o,v)),B.next_in+=o,B.total_in+=o,o)},U=(B,E)=>{let v,z,o=B.max_chain_length,q=B.strstart,c=B.prev_length,S=B.nice_match;const x=B.strstart>B.w_size-A?B.strstart-(B.w_size-A):0,D=B.window,h=B.w_mask,y=B.prev,Q=B.strstart+f;let P=D[q+c-1],G=D[q+c];B.prev_length>=B.good_match&&(o>>=2),S>B.lookahead&&(S=B.lookahead);do{if(v=E,D[v+c]===G&&D[v+c-1]===P&&D[v]===D[q]&&D[++v]===D[q+1]){q+=2,v++;do{}while(D[++q]===D[++v]&&D[++q]===D[++v]&&D[++q]===D[++v]&&D[++q]===D[++v]&&D[++q]===D[++v]&&D[++q]===D[++v]&&D[++q]===D[++v]&&D[++q]===D[++v]&&q<Q);if(z=f-(Q-q),q=Q-f,z>c){if(B.match_start=E,c=z,z>=S)break;P=D[q+c-1],G=D[q+c]}}}while((E=y[E&h])>x&&0!==--o);return c<=B.lookahead?c:B.lookahead},s=B=>{const E=B.w_size;let v,z,o,q,c;do{if(q=B.window_size-B.lookahead-B.strstart,B.strstart>=E+(E-A)){B.window.set(B.window.subarray(E,E+E),0),B.match_start-=E,B.strstart-=E,B.block_start-=E,z=B.hash_size,v=z;do{o=B.head[--v],B.head[v]=o>=E?o-E:0}while(--z);z=E,v=z;do{o=B.prev[--v],B.prev[v]=o>=E?o-E:0}while(--z);q+=E}if(0===B.strm.avail_in)break;if(z=n(B.strm,B.window,B.strstart+B.lookahead,q),B.lookahead+=z,B.lookahead+B.insert>=3)for(c=B.strstart-B.insert,B.ins_h=B.window[c],B.ins_h=R(B,B.ins_h,B.window[c+1]);B.insert&&(B.ins_h=R(B,B.ins_h,B.window[c+3-1]),B.prev[c&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=c,c++,B.insert--,!(B.lookahead+B.insert<3)););}while(B.lookahead<A&&0!==B.strm.avail_in)},J=(B,E)=>{let v,z;for(;;){if(B.lookahead<A){if(s(B),B.lookahead<A&&E===y)return 1;if(0===B.lookahead)break}if(v=0,B.lookahead>=3&&(B.ins_h=R(B,B.ins_h,B.window[B.strstart+3-1]),v=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),0!==v&&B.strstart-v<=B.w_size-A&&(B.match_length=U(B,v)),B.match_length>=3)if(z=c(B,B.strstart-B.match_start,B.match_length-3),B.lookahead-=B.match_length,B.match_length<=B.max_lazy_match&&B.lookahead>=3){B.match_length--;do{B.strstart++,B.ins_h=R(B,B.ins_h,B.window[B.strstart+3-1]),v=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart}while(0!==--B.match_length);B.strstart++}else B.strstart+=B.match_length,B.match_length=0,B.ins_h=B.window[B.strstart],B.ins_h=R(B,B.ins_h,B.window[B.strstart+1]);else z=c(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++;if(z&&(F(B,!1),0===B.strm.avail_out))return 1}return B.insert=B.strstart<2?B.strstart:2,E===G?(F(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(F(B,!1),0===B.strm.avail_out)?1:2},O=(B,E)=>{let v,z,o;for(;;){if(B.lookahead<A){if(s(B),B.lookahead<A&&E===y)return 1;if(0===B.lookahead)break}if(v=0,B.lookahead>=3&&(B.ins_h=R(B,B.ins_h,B.window[B.strstart+3-1]),v=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),B.prev_length=B.match_length,B.prev_match=B.match_start,B.match_length=2,0!==v&&B.prev_length<B.max_lazy_match&&B.strstart-v<=B.w_size-A&&(B.match_length=U(B,v),B.match_length<=5&&(B.strategy===X||3===B.match_length&&B.strstart-B.match_start>4096)&&(B.match_length=2)),B.prev_length>=3&&B.match_length<=B.prev_length){o=B.strstart+B.lookahead-3,z=c(B,B.strstart-1-B.prev_match,B.prev_length-3),B.lookahead-=B.prev_length-1,B.prev_length-=2;do{++B.strstart<=o&&(B.ins_h=R(B,B.ins_h,B.window[B.strstart+3-1]),v=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart)}while(0!==--B.prev_length);if(B.match_available=0,B.match_length=2,B.strstart++,z&&(F(B,!1),0===B.strm.avail_out))return 1}else if(B.match_available){if(z=c(B,0,B.window[B.strstart-1]),z&&F(B,!1),B.strstart++,B.lookahead--,0===B.strm.avail_out)return 1}else B.match_available=1,B.strstart++,B.lookahead--}return B.match_available&&(z=c(B,0,B.window[B.strstart-1]),B.match_available=0),B.insert=B.strstart<2?B.strstart:2,E===G?(F(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(F(B,!1),0===B.strm.avail_out)?1:2};function e(B,E,v,z,o){this.good_length=B,this.max_lazy=E,this.nice_length=v,this.max_chain=z,this.func=o}const k=[new e(0,0,0,0,((B,E)=>{let v=65535;for(v>B.pending_buf_size-5&&(v=B.pending_buf_size-5);;){if(B.lookahead<=1){if(s(B),0===B.lookahead&&E===y)return 1;if(0===B.lookahead)break}B.strstart+=B.lookahead,B.lookahead=0;const z=B.block_start+v;if((0===B.strstart||B.strstart>=z)&&(B.lookahead=B.strstart-z,B.strstart=z,F(B,!1),0===B.strm.avail_out))return 1;if(B.strstart-B.block_start>=B.w_size-A&&(F(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,E===G?(F(B,!0),0===B.strm.avail_out?3:4):(B.strstart>B.block_start&&(F(B,!1),B.strm.avail_out),1)})),new e(4,4,8,4,J),new e(4,5,16,8,J),new e(4,6,32,32,J),new e(4,4,16,16,O),new e(8,16,32,32,O),new e(8,16,128,128,O),new e(8,32,128,256,O),new e(32,128,258,1024,O),new e(32,258,258,4096,O)];function L(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),j(this.dyn_ltree),j(this.dyn_dtree),j(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),j(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),j(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const M=B=>{if(!B||!B.state)return p(B,g);B.total_in=B.total_out=0,B.data_type=K;const E=B.state;return E.pending=0,E.pending_out=0,E.wrap<0&&(E.wrap=-E.wrap),E.status=E.wrap?42:d,B.adler=2===E.wrap?0:1,E.last_flush=y,z(E),a},Z=B=>{const E=M(B);var v;return E===a&&((v=B.state).window_size=2*v.w_size,j(v.head),v.max_lazy_match=k[v.level].max_lazy,v.good_match=k[v.level].good_length,v.nice_match=k[v.level].nice_length,v.max_chain_length=k[v.level].max_chain,v.strstart=0,v.block_start=0,v.lookahead=0,v.insert=0,v.match_length=v.prev_length=2,v.match_available=0,v.ins_h=0),E},BB=(B,E,v,z,o,q)=>{if(!B)return g;let c=1;if(E===N&&(E=6),z<0?(c=0,z=-z):z>15&&(c=2,z-=16),o<1||o>9||v!==C||z<8||z>15||E<0||E>9||q<0||q>u)return p(B,g);8===z&&(z=9);const S=new L;return B.state=S,S.strm=B,S.wrap=c,S.gzhead=null,S.w_bits=z,S.w_size=1<<S.w_bits,S.w_mask=S.w_size-1,S.hash_bits=o+7,S.hash_size=1<<S.hash_bits,S.hash_mask=S.hash_size-1,S.hash_shift=~~((S.hash_bits+3-1)/3),S.window=new Uint8Array(2*S.w_size),S.head=new Uint16Array(S.hash_size),S.prev=new Uint16Array(S.w_size),S.lit_bufsize=1<<o+6,S.pending_buf_size=4*S.lit_bufsize,S.pending_buf=new Uint8Array(S.pending_buf_size),S.d_buf=1*S.lit_bufsize,S.l_buf=3*S.lit_bufsize,S.level=E,S.strategy=q,S.method=v,Z(B)};B.exports.deflateInit=(B,E)=>BB(B,E,C,15,8,I),B.exports.deflateInit2=BB,B.exports.deflateReset=Z,B.exports.deflateResetKeep=M,B.exports.deflateSetHeader=(B,E)=>B&&B.state?2!==B.state.wrap?g:(B.state.gzhead=E,a):g,B.exports.deflate=(B,E)=>{let v,z;if(!B||!B.state||E>Y||E<0)return B?p(B,g):g;const q=B.state;if(!B.output||!B.input&&0!==B.avail_in||q.status===t&&E!==G)return p(B,0===B.avail_out?T:g);q.strm=B;const x=q.last_flush;if(q.last_flush=E,42===q.status)if(2===q.wrap)B.adler=0,W(q,31),W(q,139),W(q,8),q.gzhead?(W(q,(q.gzhead.text?1:0)+(q.gzhead.hcrc?2:0)+(q.gzhead.extra?4:0)+(q.gzhead.name?8:0)+(q.gzhead.comment?16:0)),W(q,255&q.gzhead.time),W(q,q.gzhead.time>>8&255),W(q,q.gzhead.time>>16&255),W(q,q.gzhead.time>>24&255),W(q,9===q.level?2:q.strategy>=r||q.level<2?4:0),W(q,255&q.gzhead.os),q.gzhead.extra&&q.gzhead.extra.length&&(W(q,255&q.gzhead.extra.length),W(q,q.gzhead.extra.length>>8&255)),q.gzhead.hcrc&&(B.adler=D(B.adler,q.pending_buf,q.pending,0)),q.gzindex=0,q.status=69):(W(q,0),W(q,0),W(q,0),W(q,0),W(q,0),W(q,9===q.level?2:q.strategy>=r||q.level<2?4:0),W(q,3),q.status=d);else{let E=C+(q.w_bits-8<<4)<<8,v=-1;v=q.strategy>=r||q.level<2?0:q.level<6?1:6===q.level?2:3,E|=v<<6,0!==q.strstart&&(E|=32),E+=31-E%31,q.status=d,w(q,E),0!==q.strstart&&(w(q,B.adler>>>16),w(q,65535&B.adler)),B.adler=1}if(69===q.status)if(q.gzhead.extra){for(v=q.pending;q.gzindex<(65535&q.gzhead.extra.length)&&(q.pending!==q.pending_buf_size||(q.gzhead.hcrc&&q.pending>v&&(B.adler=D(B.adler,q.pending_buf,q.pending-v,v)),b(B),v=q.pending,q.pending!==q.pending_buf_size));)W(q,255&q.gzhead.extra[q.gzindex]),q.gzindex++;q.gzhead.hcrc&&q.pending>v&&(B.adler=D(B.adler,q.pending_buf,q.pending-v,v)),q.gzindex===q.gzhead.extra.length&&(q.gzindex=0,q.status=73)}else q.status=73;if(73===q.status)if(q.gzhead.name){v=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>v&&(B.adler=D(B.adler,q.pending_buf,q.pending-v,v)),b(B),v=q.pending,q.pending===q.pending_buf_size)){z=1;break}z=q.gzindex<q.gzhead.name.length?255&q.gzhead.name.charCodeAt(q.gzindex++):0,W(q,z)}while(0!==z);q.gzhead.hcrc&&q.pending>v&&(B.adler=D(B.adler,q.pending_buf,q.pending-v,v)),0===z&&(q.gzindex=0,q.status=91)}else q.status=91;if(91===q.status)if(q.gzhead.comment){v=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>v&&(B.adler=D(B.adler,q.pending_buf,q.pending-v,v)),b(B),v=q.pending,q.pending===q.pending_buf_size)){z=1;break}z=q.gzindex<q.gzhead.comment.length?255&q.gzhead.comment.charCodeAt(q.gzindex++):0,W(q,z)}while(0!==z);q.gzhead.hcrc&&q.pending>v&&(B.adler=D(B.adler,q.pending_buf,q.pending-v,v)),0===z&&(q.status=l)}else q.status=l;if(q.status===l&&(q.gzhead.hcrc?(q.pending+2>q.pending_buf_size&&b(B),q.pending+2<=q.pending_buf_size&&(W(q,255&B.adler),W(q,B.adler>>8&255),B.adler=0,q.status=d)):q.status=d),0!==q.pending){if(b(B),0===B.avail_out)return q.last_flush=-1,a}else if(0===B.avail_in&&H(E)<=H(x)&&E!==G)return p(B,T);if(q.status===t&&0!==B.avail_in)return p(B,T);if(0!==B.avail_in||0!==q.lookahead||E!==y&&q.status!==t){let v=q.strategy===r?((B,E)=>{let v;for(;;){if(0===B.lookahead&&(s(B),0===B.lookahead)){if(E===y)return 1;break}if(B.match_length=0,v=c(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,v&&(F(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,E===G?(F(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(F(B,!1),0===B.strm.avail_out)?1:2})(q,E):q.strategy===i?((B,E)=>{let v,z,o,q;const S=B.window;for(;;){if(B.lookahead<=f){if(s(B),B.lookahead<=f&&E===y)return 1;if(0===B.lookahead)break}if(B.match_length=0,B.lookahead>=3&&B.strstart>0&&(o=B.strstart-1,z=S[o],z===S[++o]&&z===S[++o]&&z===S[++o])){q=B.strstart+f;do{}while(z===S[++o]&&z===S[++o]&&z===S[++o]&&z===S[++o]&&z===S[++o]&&z===S[++o]&&z===S[++o]&&z===S[++o]&&o<q);B.match_length=f-(q-o),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=3?(v=c(B,1,B.match_length-3),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(v=c(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),v&&(F(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,E===G?(F(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(F(B,!1),0===B.strm.avail_out)?1:2})(q,E):k[q.level].func(q,E);if(3!==v&&4!==v||(q.status=t),1===v||3===v)return 0===B.avail_out&&(q.last_flush=-1),a;if(2===v&&(E===Q?S(q):E!==Y&&(o(q,0,0,!1),E===P&&(j(q.head),0===q.lookahead&&(q.strstart=0,q.block_start=0,q.insert=0))),b(B),0===B.avail_out))return q.last_flush=-1,a}return E!==G?a:q.wrap<=0?m:(2===q.wrap?(W(q,255&B.adler),W(q,B.adler>>8&255),W(q,B.adler>>16&255),W(q,B.adler>>24&255),W(q,255&B.total_in),W(q,B.total_in>>8&255),W(q,B.total_in>>16&255),W(q,B.total_in>>24&255)):(w(q,B.adler>>>16),w(q,65535&B.adler)),b(B),q.wrap>0&&(q.wrap=-q.wrap),0!==q.pending?a:m)},B.exports.deflateEnd=B=>{if(!B||!B.state)return g;const E=B.state.status;return 42!==E&&69!==E&&73!==E&&91!==E&&E!==l&&E!==d&&E!==t?p(B,g):(B.state=null,E===d?p(B,V):a)},B.exports.deflateSetDictionary=(B,E)=>{let v=E.length;if(!B||!B.state)return g;const z=B.state,o=z.wrap;if(2===o||1===o&&42!==z.status||z.lookahead)return g;if(1===o&&(B.adler=x(B.adler,E,v,0)),z.wrap=0,v>=z.w_size){0===o&&(j(z.head),z.strstart=0,z.block_start=0,z.insert=0);let B=new Uint8Array(z.w_size);B.set(E.subarray(v-z.w_size,v),0),E=B,v=z.w_size}const q=B.avail_in,c=B.next_in,S=B.input;for(B.avail_in=v,B.next_in=0,B.input=E,s(z);z.lookahead>=3;){let B=z.strstart,E=z.lookahead-2;do{z.ins_h=R(z,z.ins_h,z.window[B+3-1]),z.prev[B&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=B,B++}while(--E);z.strstart=B,z.lookahead=2,s(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=2,z.match_available=0,B.next_in=c,B.input=S,B.avail_in=q,z.wrap=o,a},B.exports.deflateInfo="pako deflate (from Nodeca project)"},12581:B=>{"use strict";B.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12568:B=>{"use strict";B.exports=function(B,E){let v,z,o,q,c,S,x,D,h,y,Q,P,G,Y,a,m,g,V,T,N,X,r,i,u;const I=B.state;v=B.next_in,i=B.input,z=v+(B.avail_in-5),o=B.next_out,u=B.output,q=o-(E-B.avail_out),c=o+(B.avail_out-257),S=I.dmax,x=I.wsize,D=I.whave,h=I.wnext,y=I.window,Q=I.hold,P=I.bits,G=I.lencode,Y=I.distcode,a=(1<<I.lenbits)-1,m=(1<<I.distbits)-1;B:do{P<15&&(Q+=i[v++]<<P,P+=8,Q+=i[v++]<<P,P+=8),g=G[Q&a];E:for(;;){if(V=g>>>24,Q>>>=V,P-=V,V=g>>>16&255,0===V)u[o++]=65535&g;else{if(!(16&V)){if(0===(64&V)){g=G[(65535&g)+(Q&(1<<V)-1)];continue E}if(32&V){I.mode=12;break B}B.DE="invalid literal/length code",I.mode=30;break B}T=65535&g,V&=15,V&&(P<V&&(Q+=i[v++]<<P,P+=8),T+=Q&(1<<V)-1,Q>>>=V,P-=V),P<15&&(Q+=i[v++]<<P,P+=8,Q+=i[v++]<<P,P+=8),g=Y[Q&m];v:for(;;){if(V=g>>>24,Q>>>=V,P-=V,V=g>>>16&255,!(16&V)){if(0===(64&V)){g=Y[(65535&g)+(Q&(1<<V)-1)];continue v}B.DE="invalid distance code",I.mode=30;break B}if(N=65535&g,V&=15,P<V&&(Q+=i[v++]<<P,P+=8,P<V&&(Q+=i[v++]<<P,P+=8)),N+=Q&(1<<V)-1,N>S){B.DE="invalid distance too far back",I.mode=30;break B}if(Q>>>=V,P-=V,V=o-q,N>V){if(V=N-V,V>D&&I.sane){B.DE="invalid distance too far back",I.mode=30;break B}if(X=0,r=y,0===h){if(X+=x-V,V<T){T-=V;do{u[o++]=y[X++]}while(--V);X=o-N,r=u}}else if(h<V){if(X+=x+h-V,V-=h,V<T){T-=V;do{u[o++]=y[X++]}while(--V);if(X=0,h<T){V=h,T-=V;do{u[o++]=y[X++]}while(--V);X=o-N,r=u}}}else if(X+=h-V,V<T){T-=V;do{u[o++]=y[X++]}while(--V);X=o-N,r=u}for(;T>2;)u[o++]=r[X++],u[o++]=r[X++],u[o++]=r[X++],T-=3;T&&(u[o++]=r[X++],T>1&&(u[o++]=r[X++]))}else{X=o-N;do{u[o++]=u[X++],u[o++]=u[X++],u[o++]=u[X++],T-=3}while(T>2);T&&(u[o++]=u[X++],T>1&&(u[o++]=u[X++]))}break}}break}}while(v<z&&o<c);T=P>>3,v-=T,P-=T<<3,Q&=(1<<P)-1,B.next_in=v,B.next_out=o,B.avail_in=v<z?z-v+5:5-(v-z),B.avail_out=o<c?c-o+257:257-(o-c),I.hold=Q,I.bits=P}},12564:(B,E,v)=>{"use strict";const z=v(12521),o=v(12530),q=v(12568),c=v(12576),{Z_FINISH:S,Z_BLOCK:x,Z_TREES:D,Z_OK:h,Z_STREAM_END:y,Z_NEED_DICT:Q,Z_STREAM_ERROR:P,Z_DATA_ERROR:G,Z_MEM_ERROR:Y,Z_BUF_ERROR:a,Z_DEFLATED:m}=v(12541),g=12,V=30,T=B=>(B>>>24&255)+(B>>>8&65280)+((65280&B)<<8)+((255&B)<<24);function N(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X=B=>{if(!B||!B.state)return P;const E=B.state;return B.total_in=B.total_out=E.total=0,B.DE="",E.wrap&&(B.adler=1&E.wrap),E.mode=1,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new Int32Array(852),E.distcode=E.distdyn=new Int32Array(592),E.sane=1,E.back=-1,h},r=B=>{if(!B||!B.state)return P;const E=B.state;return E.wsize=0,E.whave=0,E.wnext=0,X(B)},i=(B,E)=>{let v;if(!B||!B.state)return P;const z=B.state;return E<0?(v=0,E=-E):(v=1+(E>>4),E<48&&(E&=15)),E&&(E<8||E>15)?P:(null!==z.window&&z.wbits!==E&&(z.window=null),z.wrap=v,z.wbits=E,r(B))},u=(B,E)=>{if(!B)return P;const v=new N;B.state=v,v.window=null;const z=i(B,E);return z!==h&&(B.state=null),z};let I,K,C=!0;const f=B=>{if(C){I=new Int32Array(512),K=new Int32Array(32);let E=0;for(;E<144;)B.lens[E++]=8;for(;E<256;)B.lens[E++]=9;for(;E<280;)B.lens[E++]=7;for(;E<288;)B.lens[E++]=8;for(c(1,B.lens,0,288,I,0,B.work,{bits:9}),E=0;E<32;)B.lens[E++]=5;c(2,B.lens,0,32,K,0,B.work,{bits:5}),C=!1}B.lencode=I,B.lenbits=9,B.distcode=K,B.distbits=5},A=(B,E,v,z)=>{let o;const q=B.state;return null===q.window&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new Uint8Array(q.wsize)),z>=q.wsize?(q.window.set(E.subarray(v-q.wsize,v),0),q.wnext=0,q.whave=q.wsize):(o=q.wsize-q.wnext,o>z&&(o=z),q.window.set(E.subarray(v-z,v-z+o),q.wnext),(z-=o)?(q.window.set(E.subarray(v-z,v),0),q.wnext=z,q.whave=q.wsize):(q.wnext+=o,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=o))),0};B.exports.inflateReset=r,B.exports.inflateReset2=i,B.exports.inflateResetKeep=X,B.exports.inflateInit=B=>u(B,15),B.exports.inflateInit2=u,B.exports.inflate=(B,E)=>{let v,N,X,r,i,u,I,K,C,l,d,t,p,H,j,R,b,F,W,w,n,U,s=0;const J=new Uint8Array(4);let O,e;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!B||!B.state||!B.output||!B.input&&0!==B.avail_in)return P;v=B.state,v.mode===g&&(v.mode=13),i=B.next_out,X=B.output,I=B.avail_out,r=B.next_in,N=B.input,u=B.avail_in,K=v.hold,C=v.bits,l=u,d=I,U=h;B:for(;;)switch(v.mode){case 1:if(0===v.wrap){v.mode=13;break}for(;C<16;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(2&v.wrap&&35615===K){v.check=0,J[0]=255&K,J[1]=K>>>8&255,v.check=o(v.check,J,2,0),K=0,C=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&K)<<8)+(K>>8))%31){B.DE="incorrect header check",v.mode=V;break}if((15&K)!==m){B.DE="unknown compression method",v.mode=V;break}if(K>>>=4,C-=4,n=8+(15&K),0===v.wbits)v.wbits=n;else if(n>v.wbits){B.DE="invalid window size",v.mode=V;break}v.dmax=1<<v.wbits,B.adler=v.check=1,v.mode=512&K?10:g,K=0,C=0;break;case 2:for(;C<16;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(v.flags=K,(255&v.flags)!==m){B.DE="unknown compression method",v.mode=V;break}if(57344&v.flags){B.DE="unknown header flags set",v.mode=V;break}v.head&&(v.head.text=K>>8&1),512&v.flags&&(J[0]=255&K,J[1]=K>>>8&255,v.check=o(v.check,J,2,0)),K=0,C=0,v.mode=3;case 3:for(;C<32;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}v.head&&(v.head.time=K),512&v.flags&&(J[0]=255&K,J[1]=K>>>8&255,J[2]=K>>>16&255,J[3]=K>>>24&255,v.check=o(v.check,J,4,0)),K=0,C=0,v.mode=4;case 4:for(;C<16;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}v.head&&(v.head.xflags=255&K,v.head.os=K>>8),512&v.flags&&(J[0]=255&K,J[1]=K>>>8&255,v.check=o(v.check,J,2,0)),K=0,C=0,v.mode=5;case 5:if(1024&v.flags){for(;C<16;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}v.length=K,v.head&&(v.head.extra_len=K),512&v.flags&&(J[0]=255&K,J[1]=K>>>8&255,v.check=o(v.check,J,2,0)),K=0,C=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(t=v.length,t>u&&(t=u),t&&(v.head&&(n=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Uint8Array(v.head.extra_len)),v.head.extra.set(N.subarray(r,r+t),n)),512&v.flags&&(v.check=o(v.check,N,t,r)),u-=t,r+=t,v.length-=t),v.length))break B;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(0===u)break B;t=0;do{n=N[r+t++],v.head&&n&&v.length<65536&&(v.head.name+=String.fromCharCode(n))}while(n&&t<u);if(512&v.flags&&(v.check=o(v.check,N,t,r)),u-=t,r+=t,n)break B}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(0===u)break B;t=0;do{n=N[r+t++],v.head&&n&&v.length<65536&&(v.head.comment+=String.fromCharCode(n))}while(n&&t<u);if(512&v.flags&&(v.check=o(v.check,N,t,r)),u-=t,r+=t,n)break B}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;C<16;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(K!==(65535&v.check)){B.DE="header crc mismatch",v.mode=V;break}K=0,C=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),B.adler=v.check=0,v.mode=g;break;case 10:for(;C<32;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}B.adler=v.check=T(K),K=0,C=0,v.mode=11;case 11:if(0===v.havedict)return B.next_out=i,B.avail_out=I,B.next_in=r,B.avail_in=u,v.hold=K,v.bits=C,Q;B.adler=v.check=1,v.mode=g;case g:if(E===x||E===D)break B;case 13:if(v.last){K>>>=7&C,C-=7&C,v.mode=27;break}for(;C<3;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}switch(v.last=1&K,K>>>=1,C-=1,3&K){case 0:v.mode=14;break;case 1:if(f(v),v.mode=20,E===D){K>>>=2,C-=2;break B}break;case 2:v.mode=17;break;case 3:B.DE="invalid block type",v.mode=V}K>>>=2,C-=2;break;case 14:for(K>>>=7&C,C-=7&C;C<32;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if((65535&K)!==(K>>>16^65535)){B.DE="invalid stored block lengths",v.mode=V;break}if(v.length=65535&K,K=0,C=0,v.mode=15,E===D)break B;case 15:v.mode=16;case 16:if(t=v.length,t){if(t>u&&(t=u),t>I&&(t=I),0===t)break B;X.set(N.subarray(r,r+t),i),u-=t,r+=t,I-=t,i+=t,v.length-=t;break}v.mode=g;break;case 17:for(;C<14;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(v.nlen=257+(31&K),K>>>=5,C-=5,v.ndist=1+(31&K),K>>>=5,C-=5,v.ncode=4+(15&K),K>>>=4,C-=4,v.nlen>286||v.ndist>30){B.DE="too many length or distance symbols",v.mode=V;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;C<3;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}v.lens[k[v.have++]]=7&K,K>>>=3,C-=3}for(;v.have<19;)v.lens[k[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,O={bits:v.lenbits},U=c(0,v.lens,0,19,v.lencode,0,v.work,O),v.lenbits=O.bits,U){B.DE="invalid code lengths set",v.mode=V;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;s=v.lencode[K&(1<<v.lenbits)-1],j=s>>>24,R=s>>>16&255,b=65535&s,!(j<=C);){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(b<16)K>>>=j,C-=j,v.lens[v.have++]=b;else{if(16===b){for(e=j+2;C<e;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(K>>>=j,C-=j,0===v.have){B.DE="invalid bit length repeat",v.mode=V;break}n=v.lens[v.have-1],t=3+(3&K),K>>>=2,C-=2}else if(17===b){for(e=j+3;C<e;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}K>>>=j,C-=j,n=0,t=3+(7&K),K>>>=3,C-=3}else{for(e=j+7;C<e;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}K>>>=j,C-=j,n=0,t=11+(127&K),K>>>=7,C-=7}if(v.have+t>v.nlen+v.ndist){B.DE="invalid bit length repeat",v.mode=V;break}for(;t--;)v.lens[v.have++]=n}}if(v.mode===V)break;if(0===v.lens[256]){B.DE="invalid code -- missing end-of-block",v.mode=V;break}if(v.lenbits=9,O={bits:v.lenbits},U=c(1,v.lens,0,v.nlen,v.lencode,0,v.work,O),v.lenbits=O.bits,U){B.DE="invalid literal/lengths set",v.mode=V;break}if(v.distbits=6,v.distcode=v.distdyn,O={bits:v.distbits},U=c(2,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,O),v.distbits=O.bits,U){B.DE="invalid distances set",v.mode=V;break}if(v.mode=20,E===D)break B;case 20:v.mode=21;case 21:if(u>=6&&I>=258){B.next_out=i,B.avail_out=I,B.next_in=r,B.avail_in=u,v.hold=K,v.bits=C,q(B,d),i=B.next_out,X=B.output,I=B.avail_out,r=B.next_in,N=B.input,u=B.avail_in,K=v.hold,C=v.bits,v.mode===g&&(v.back=-1);break}for(v.back=0;s=v.lencode[K&(1<<v.lenbits)-1],j=s>>>24,R=s>>>16&255,b=65535&s,!(j<=C);){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(R&&0===(240&R)){for(F=j,W=R,w=b;s=v.lencode[w+((K&(1<<F+W)-1)>>F)],j=s>>>24,R=s>>>16&255,b=65535&s,!(F+j<=C);){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}K>>>=F,C-=F,v.back+=F}if(K>>>=j,C-=j,v.back+=j,v.length=b,0===R){v.mode=26;break}if(32&R){v.back=-1,v.mode=g;break}if(64&R){B.DE="invalid literal/length code",v.mode=V;break}v.extra=15&R,v.mode=22;case 22:if(v.extra){for(e=v.extra;C<e;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}v.length+=K&(1<<v.extra)-1,K>>>=v.extra,C-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;s=v.distcode[K&(1<<v.distbits)-1],j=s>>>24,R=s>>>16&255,b=65535&s,!(j<=C);){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(0===(240&R)){for(F=j,W=R,w=b;s=v.distcode[w+((K&(1<<F+W)-1)>>F)],j=s>>>24,R=s>>>16&255,b=65535&s,!(F+j<=C);){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}K>>>=F,C-=F,v.back+=F}if(K>>>=j,C-=j,v.back+=j,64&R){B.DE="invalid distance code",v.mode=V;break}v.offset=b,v.extra=15&R,v.mode=24;case 24:if(v.extra){for(e=v.extra;C<e;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}v.offset+=K&(1<<v.extra)-1,K>>>=v.extra,C-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){B.DE="invalid distance too far back",v.mode=V;break}v.mode=25;case 25:if(0===I)break B;if(t=d-I,v.offset>t){if(t=v.offset-t,t>v.whave&&v.sane){B.DE="invalid distance too far back",v.mode=V;break}t>v.wnext?(t-=v.wnext,p=v.wsize-t):p=v.wnext-t,t>v.length&&(t=v.length),H=v.window}else H=X,p=i-v.offset,t=v.length;t>I&&(t=I),I-=t,v.length-=t;do{X[i++]=H[p++]}while(--t);0===v.length&&(v.mode=21);break;case 26:if(0===I)break B;X[i++]=v.length,I--,v.mode=21;break;case 27:if(v.wrap){for(;C<32;){if(0===u)break B;u--,K|=N[r++]<<C,C+=8}if(d-=I,B.total_out+=d,v.total+=d,d&&(B.adler=v.check=v.flags?o(v.check,X,d,i-d):z(v.check,X,d,i-d)),d=I,(v.flags?K:T(K))!==v.check){B.DE="incorrect data check",v.mode=V;break}K=0,C=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;C<32;){if(0===u)break B;u--,K+=N[r++]<<C,C+=8}if(K!==(4294967295&v.total)){B.DE="incorrect length check",v.mode=V;break}K=0,C=0}v.mode=29;case 29:U=y;break B;case V:U=G;break B;case 31:return Y;default:return P}return B.next_out=i,B.avail_out=I,B.next_in=r,B.avail_in=u,v.hold=K,v.bits=C,(v.wsize||d!==B.avail_out&&v.mode<V&&(v.mode<27||E!==S))&&A(B,B.output,B.next_out,d-B.avail_out)?(v.mode=31,Y):(l-=B.avail_in,d-=B.avail_out,B.total_in+=l,B.total_out+=d,v.total+=d,v.wrap&&d&&(B.adler=v.check=v.flags?o(v.check,X,d,B.next_out-d):z(v.check,X,d,B.next_out-d)),B.data_type=v.bits+(v.last?64:0)+(v.mode===g?128:0)+(20===v.mode||15===v.mode?256:0),(0===l&&0===d||E===S)&&U===h&&(U=a),U)},B.exports.inflateEnd=B=>{if(!B||!B.state)return P;let E=B.state;return E.window&&(E.window=null),B.state=null,h},B.exports.inflateGetHeader=(B,E)=>{if(!B||!B.state)return P;const v=B.state;return 0===(2&v.wrap)?P:(v.head=E,E.done=!1,h)},B.exports.inflateSetDictionary=(B,E)=>{const v=E.length;let o,q,c;return B&&B.state?(o=B.state,0!==o.wrap&&11!==o.mode?P:11===o.mode&&(q=1,q=z(q,E,v,0),q!==o.check)?G:(c=A(B,E,v,v),c?(o.mode=31,Y):(o.havedict=1,h))):P},B.exports.inflateInfo="pako inflate (from Nodeca project)"},12576:B=>{"use strict";const E=15,v=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);B.exports=(B,c,S,x,D,h,y,Q)=>{const P=Q.bits;let G,Y,a,m,g,V,T=0,N=0,X=0,r=0,i=0,u=0,I=0,K=0,C=0,f=0,A=null,l=0;const d=new Uint16Array(16),t=new Uint16Array(16);let p,H,j,R=null,b=0;for(T=0;T<=E;T++)d[T]=0;for(N=0;N<x;N++)d[c[S+N]]++;for(i=P,r=E;r>=1&&0===d[r];r--);if(i>r&&(i=r),0===r)return D[h++]=20971520,D[h++]=20971520,Q.bits=1,0;for(X=1;X<r&&0===d[X];X++);for(i<X&&(i=X),K=1,T=1;T<=E;T++)if(K<<=1,K-=d[T],K<0)return-1;if(K>0&&(0===B||1!==r))return-1;for(t[1]=0,T=1;T<E;T++)t[T+1]=t[T]+d[T];for(N=0;N<x;N++)0!==c[S+N]&&(y[t[c[S+N]]++]=N);if(0===B?(A=R=y,V=19):1===B?(A=v,l-=257,R=z,b-=257,V=256):(A=o,R=q,V=-1),f=0,N=0,T=X,g=h,u=i,I=0,a=-1,C=1<<i,m=C-1,1===B&&C>852||2===B&&C>592)return 1;for(;;){p=T-I,y[N]<V?(H=0,j=y[N]):y[N]>V?(H=R[b+y[N]],j=A[l+y[N]]):(H=96,j=0),G=1<<T-I,Y=1<<u,X=Y;do{Y-=G,D[g+(f>>I)+Y]=p<<24|H<<16|j}while(0!==Y);for(G=1<<T-1;f&G;)G>>=1;if(0!==G?(f&=G-1,f+=G):f=0,N++,0===--d[T]){if(T===r)break;T=c[S+y[N]]}if(T>i&&(f&m)!==a){for(0===I&&(I=i),g+=X,u=T-I,K=1<<u;u+I<r&&(K-=d[u+I],!(K<=0));)u++,K<<=1;if(C+=1<<u,1===B&&C>852||2===B&&C>592)return 1;a=f&m,D[a]=i<<24|u<<16|g-h}}return 0!==f&&(D[g+f]=T-I<<24|64<<16),Q.bits=i,0}},12538:B=>{"use strict";B.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12515:B=>{"use strict";function E(B){let E=B.length;for(;--E>=0;)B[E]=0}const v=256,z=286,o=30,q=15,c=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),S=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),x=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);E(h);const y=new Array(60);E(y);const Q=new Array(512);E(Q);const P=new Array(256);E(P);const G=new Array(29);E(G);const Y=new Array(o);function a(B,E,v,z,o){this.static_tree=B,this.extra_bits=E,this.extra_base=v,this.elems=z,this.max_length=o,this.has_stree=B&&B.length}let m,g,V;function T(B,E){this.dyn_tree=B,this.max_code=0,this.stat_desc=E}E(Y);const N=B=>B<256?Q[B]:Q[256+(B>>>7)],X=(B,E)=>{B.pending_buf[B.pending++]=255&E,B.pending_buf[B.pending++]=E>>>8&255},r=(B,E,v)=>{B.bi_valid>16-v?(B.bi_buf|=E<<B.bi_valid&65535,X(B,B.bi_buf),B.bi_buf=E>>16-B.bi_valid,B.bi_valid+=v-16):(B.bi_buf|=E<<B.bi_valid&65535,B.bi_valid+=v)},i=(B,E,v)=>{r(B,v[2*E],v[2*E+1])},u=(B,E)=>{let v=0;do{v|=1&B,B>>>=1,v<<=1}while(--E>0);return v>>>1},I=(B,E,v)=>{const z=new Array(16);let o,c,S=0;for(o=1;o<=q;o++)z[o]=S=S+v[o-1]<<1;for(c=0;c<=E;c++){let E=B[2*c+1];0!==E&&(B[2*c]=u(z[E]++,E))}},K=B=>{let E;for(E=0;E<z;E++)B.dyn_ltree[2*E]=0;for(E=0;E<o;E++)B.dyn_dtree[2*E]=0;for(E=0;E<19;E++)B.bl_tree[2*E]=0;B.dyn_ltree[512]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0},C=B=>{B.bi_valid>8?X(B,B.bi_buf):B.bi_valid>0&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0},f=(B,E,v,z)=>{const o=2*E,q=2*v;return B[o]<B[q]||B[o]===B[q]&&z[E]<=z[v]},A=(B,E,v)=>{const z=B.heap[v];let o=v<<1;for(;o<=B.heap_len&&(o<B.heap_len&&f(E,B.heap[o+1],B.heap[o],B.depth)&&o++,!f(E,z,B.heap[o],B.depth));)B.heap[v]=B.heap[o],v=o,o<<=1;B.heap[v]=z},l=(B,E,z)=>{let o,q,x,D,h=0;if(0!==B.last_lit)do{o=B.pending_buf[B.d_buf+2*h]<<8|B.pending_buf[B.d_buf+2*h+1],q=B.pending_buf[B.l_buf+h],h++,0===o?i(B,q,E):(x=P[q],i(B,x+v+1,E),D=c[x],0!==D&&(q-=G[x],r(B,q,D)),o--,x=N(o),i(B,x,z),D=S[x],0!==D&&(o-=Y[x],r(B,o,D)))}while(h<B.last_lit);i(B,256,E)},d=(B,E)=>{const v=E.dyn_tree,z=E.stat_desc.static_tree,o=E.stat_desc.has_stree,c=E.stat_desc.elems;let S,x,D,h=-1;for(B.heap_len=0,B.heap_max=573,S=0;S<c;S++)0!==v[2*S]?(B.heap[++B.heap_len]=h=S,B.depth[S]=0):v[2*S+1]=0;for(;B.heap_len<2;)D=B.heap[++B.heap_len]=h<2?++h:0,v[2*D]=1,B.depth[D]=0,B.opt_len--,o&&(B.static_len-=z[2*D+1]);for(E.max_code=h,S=B.heap_len>>1;S>=1;S--)A(B,v,S);D=c;do{S=B.heap[1],B.heap[1]=B.heap[B.heap_len--],A(B,v,1),x=B.heap[1],B.heap[--B.heap_max]=S,B.heap[--B.heap_max]=x,v[2*D]=v[2*S]+v[2*x],B.depth[D]=(B.depth[S]>=B.depth[x]?B.depth[S]:B.depth[x])+1,v[2*S+1]=v[2*x+1]=D,B.heap[1]=D++,A(B,v,1)}while(B.heap_len>=2);B.heap[--B.heap_max]=B.heap[1],((B,E)=>{const v=E.dyn_tree,z=E.max_code,o=E.stat_desc.static_tree,c=E.stat_desc.has_stree,S=E.stat_desc.extra_bits,x=E.stat_desc.extra_base,D=E.stat_desc.max_length;let h,y,Q,P,G,Y,a=0;for(P=0;P<=q;P++)B.bl_count[P]=0;for(v[2*B.heap[B.heap_max]+1]=0,h=B.heap_max+1;h<573;h++)y=B.heap[h],P=v[2*v[2*y+1]+1]+1,P>D&&(P=D,a++),v[2*y+1]=P,y>z||(B.bl_count[P]++,G=0,y>=x&&(G=S[y-x]),Y=v[2*y],B.opt_len+=Y*(P+G),c&&(B.static_len+=Y*(o[2*y+1]+G)));if(0!==a){do{for(P=D-1;0===B.bl_count[P];)P--;B.bl_count[P]--,B.bl_count[P+1]+=2,B.bl_count[D]--,a-=2}while(a>0);for(P=D;0!==P;P--)for(y=B.bl_count[P];0!==y;)Q=B.heap[--h],Q>z||(v[2*Q+1]!==P&&(B.opt_len+=(P-v[2*Q+1])*v[2*Q],v[2*Q+1]=P),y--)}})(B,E),I(v,h,B.bl_count)},t=(B,E,v)=>{let z,o,q=-1,c=E[1],S=0,x=7,D=4;for(0===c&&(x=138,D=3),E[2*(v+1)+1]=65535,z=0;z<=v;z++)o=c,c=E[2*(z+1)+1],++S<x&&o===c||(S<D?B.bl_tree[2*o]+=S:0!==o?(o!==q&&B.bl_tree[2*o]++,B.bl_tree[32]++):S<=10?B.bl_tree[34]++:B.bl_tree[36]++,S=0,q=o,0===c?(x=138,D=3):o===c?(x=6,D=3):(x=7,D=4))},p=(B,E,v)=>{let z,o,q=-1,c=E[1],S=0,x=7,D=4;for(0===c&&(x=138,D=3),z=0;z<=v;z++)if(o=c,c=E[2*(z+1)+1],!(++S<x&&o===c)){if(S<D)do{i(B,o,B.bl_tree)}while(0!==--S);else 0!==o?(o!==q&&(i(B,o,B.bl_tree),S--),i(B,16,B.bl_tree),r(B,S-3,2)):S<=10?(i(B,17,B.bl_tree),r(B,S-3,3)):(i(B,18,B.bl_tree),r(B,S-11,7));S=0,q=o,0===c?(x=138,D=3):o===c?(x=6,D=3):(x=7,D=4)}};let H=!1;const j=(B,E,v,z)=>{r(B,0+(z?1:0),3),((B,E,v,z)=>{C(B),z&&(X(B,v),X(B,~v)),B.pending_buf.set(B.window.subarray(E,E+v),B.pending),B.pending+=v})(B,E,v,!0)};B.exports._tr_init=B=>{H||((()=>{let B,E,v,D,T;const N=new Array(16);for(v=0,D=0;D<28;D++)for(G[D]=v,B=0;B<1<<c[D];B++)P[v++]=D;for(P[v-1]=D,T=0,D=0;D<16;D++)for(Y[D]=T,B=0;B<1<<S[D];B++)Q[T++]=D;for(T>>=7;D<o;D++)for(Y[D]=T<<7,B=0;B<1<<S[D]-7;B++)Q[256+T++]=D;for(E=0;E<=q;E++)N[E]=0;for(B=0;B<=143;)h[2*B+1]=8,B++,N[8]++;for(;B<=255;)h[2*B+1]=9,B++,N[9]++;for(;B<=279;)h[2*B+1]=7,B++,N[7]++;for(;B<=287;)h[2*B+1]=8,B++,N[8]++;for(I(h,287,N),B=0;B<o;B++)y[2*B+1]=5,y[2*B]=u(B,5);m=new a(h,c,257,z,q),g=new a(y,S,0,o,q),V=new a(new Array(0),x,0,19,7)})(),H=!0),B.l_desc=new T(B.dyn_ltree,m),B.d_desc=new T(B.dyn_dtree,g),B.bl_desc=new T(B.bl_tree,V),B.bi_buf=0,B.bi_valid=0,K(B)},B.exports._tr_stored_block=j,B.exports._tr_flush_block=(B,E,z,o)=>{let q,c,S=0;B.level>0?(2===B.strm.data_type&&(B.strm.data_type=(B=>{let E,z=4093624447;for(E=0;E<=31;E++,z>>>=1)if(1&z&&0!==B.dyn_ltree[2*E])return 0;if(0!==B.dyn_ltree[18]||0!==B.dyn_ltree[20]||0!==B.dyn_ltree[26])return 1;for(E=32;E<v;E++)if(0!==B.dyn_ltree[2*E])return 1;return 0})(B)),d(B,B.l_desc),d(B,B.d_desc),S=(B=>{let E;for(t(B,B.dyn_ltree,B.l_desc.max_code),t(B,B.dyn_dtree,B.d_desc.max_code),d(B,B.bl_desc),E=18;E>=3&&0===B.bl_tree[2*D[E]+1];E--);return B.opt_len+=3*(E+1)+5+5+4,E})(B),q=B.opt_len+3+7>>>3,c=B.static_len+3+7>>>3,c<=q&&(q=c)):q=c=z+5,z+4<=q&&-1!==E?j(B,E,z,o):4===B.strategy||c===q?(r(B,2+(o?1:0),3),l(B,h,y)):(r(B,4+(o?1:0),3),((B,E,v,z)=>{let o;for(r(B,E-257,5),r(B,v-1,5),r(B,z-4,4),o=0;o<z;o++)r(B,B.bl_tree[2*D[o]+1],3);p(B,B.dyn_ltree,E-1),p(B,B.dyn_dtree,v-1)})(B,B.l_desc.max_code+1,B.d_desc.max_code+1,S+1),l(B,B.dyn_ltree,B.dyn_dtree)),K(B),o&&C(B)},B.exports._tr_tally=(B,E,z)=>(B.pending_buf[B.d_buf+2*B.last_lit]=E>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&E,B.pending_buf[B.l_buf+B.last_lit]=255&z,B.last_lit++,0===E?B.dyn_ltree[2*z]++:(B.matches++,E--,B.dyn_ltree[2*(P[z]+v+1)]++,B.dyn_dtree[2*N(E)]++),B.last_lit===B.lit_bufsize-1),B.exports._tr_align=B=>{r(B,2,3),i(B,256,h),(B=>{16===B.bi_valid?(X(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):B.bi_valid>=8&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)})(B)}},12552:B=>{"use strict";B.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.DE="",this.state=null,this.data_type=2,this.adler=0}},12176:B=>{function E(B,E,v){for(var z=B.length,o=-1/0,q=1/0,c=0;c<z;c++){var S=(v[0][c]-B[c])/E[c],x=(v[1][c]-B[c])/E[c];if(S>x){var D=S;S=x,x=D}if(x<o||S>q)return 1/0;S>o&&(o=S),x<q&&(q=x)}return o>q?1/0:o}B.exports=function(B,v,z,o){var q=E(v,z,o);if(q===1/0)B=null;else{B=B||[];for(var c=0;c<v.length;c++)B[c]=v[c]+z[c]*q}return B},B.exports.distance=E},13559:(B,E,v)=>{"use strict";v.d(E,{b:()=>c});var z=v(43);const o=z.useLayoutEffect;const q=function(B){var E=(0,z.useRef)(B);return o((function(){E.current=B})),E};var c=function(B){var E=q(B);(0,z.cE)((function(){var B=function(B){var v;if(null!=E.current&&(v=E.current(B)),B.defaultPrevented&&(B.returnValue=""),"string"===typeof v)return B.returnValue=v,v};return window.addEventListener("beforeunload",B),function(){window.removeEventListener("beforeunload",B)}}),[])}},13500:(B,E,v)=>{"use strict";var z=v(13505),o=Array.prototype.concat,q=Array.prototype.slice,c=B.exports=function(B){for(var E=[],v=0,c=B.length;v<c;v++){var S=B[v];z(S)?E=o.call(E,q.call(S)):E.push(S)}return E};c.wrap=function(B){return function(){return B(c(arguments))}}},13505:B=>{B.exports=function(B){return!(!B||"string"===typeof B)&&(B instanceof Array||Array.isArray(B)||B.length>=0&&(B.splice instanceof Function||Object.getOwnPropertyDescriptor(B,B.length-1)&&"String"!==B.constructor.name))}},12461:(B,E,v)=>{var z=v(12463);function o(B){for(var E,v,o=0,q=B.length,c=0;c<B.length;){for(E=B[c],v=0;c<q&&B[c]===E;)++c,++v;o+=z.log2(v)/7|0,o+=z.log2(E>>>0)/7|0,o+=2}return o}E.size=o,E.encode=function(B,E){E||(E=new Uint8Array(o(B)));for(var v,z,q=0,c=E.length,S=0;S<B.length;){for(v=B[S],z=0;S<B.length&&B[S]===v;)++S,++z;for(;q<c&&z>=128;)E[q++]=128+(127&z),z>>>=7;if(q>=c)throw new Error("RLE buffer overflow");for(E[q++]=z,v>>>=0;q<c&&v>=128;)E[q++]=128+(127&v),v>>>=7;if(q>=c)throw new Error("RLE buffer overflow");E[q++]=v}return E},E.decode=function(B,E){for(var v,z,o,q,c=E.length,S=B.length,x=0,D=0;D<S;){for(v=0,z=0;D<S&&B[D]>=128;)v+=(127&B[D++])<<z,z+=7;if(v+=B[D++]<<z,D>=S)throw new Error("RLE buffer underrun");if(x+v>c)throw new Error("Chunk buffer overflow");for(o=0,z=0;D<S&&B[D]>=128;)o+=(127&B[D++])<<z,z+=7;if(D>=S)throw new Error("RLE buffer underrun");for(o+=B[D++]<<z,q=0;q<v;++q)E[x++]=o}return E}},12463:(B,E)=>{"use strict";function v(B){var E=32;return(B&=-B)&&E--,65535&B&&(E-=16),16711935&B&&(E-=8),252645135&B&&(E-=4),858993459&B&&(E-=2),1431655765&B&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(B){return(B>0)-(B<0)},E.abs=function(B){var E=B>>31;return(B^E)-E},E.min=function(B,E){return E^(B^E)&-(B<E)},E.max=function(B,E){return B^(B^E)&-(B<E)},E.isPow2=function(B){return!(B&B-1)&&!!B},E.log2=function(B){var E,v;return E=(B>65535)<<4,E|=v=((B>>>=E)>255)<<3,E|=v=((B>>>=v)>15)<<2,(E|=v=((B>>>=v)>3)<<1)|(B>>>=v)>>1},E.log10=function(B){return B>=1e9?9:B>=1e8?8:B>=1e7?7:B>=1e6?6:B>=1e5?5:B>=1e4?4:B>=1e3?3:B>=100?2:B>=10?1:0},E.popCount=function(B){return 16843009*((B=(858993459&(B-=B>>>1&1431655765))+(B>>>2&858993459))+(B>>>4)&252645135)>>>24},E.countTrailingZeros=v,E.nextPow2=function(B){return B+=0===B,--B,B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)+1},E.prevPow2=function(B){return B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)-(B>>>1)},E.parity=function(B){return B^=B>>>16,B^=B>>>8,B^=B>>>4,27030>>>(B&=15)&1};var z=new Array(256);!function(B){for(var E=0;E<256;++E){var v=E,z=E,o=7;for(v>>>=1;v;v>>>=1)z<<=1,z|=1&v,--o;B[E]=z<<o&255}}(z),E.reverse=function(B){return z[255&B]<<24|z[B>>>8&255]<<16|z[B>>>16&255]<<8|z[B>>>24&255]},E.interleave2=function(B,E){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B&=65535)|B<<8))|B<<4))|B<<2))|B<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(B,E){return(B=65535&((B=16711935&((B=252645135&((B=858993459&((B=B>>>E&1431655765)|B>>>1))|B>>>2))|B>>>4))|B>>>16))<<16>>16},E.interleave3=function(B,E,v){return B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2),(B|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<2},E.deinterleave3=function(B,E){return(B=1023&((B=4278190335&((B=251719695&((B=3272356035&((B=B>>>E&1227133513)|B>>>2))|B>>>4))|B>>>8))|B>>>16))<<22>>22},E.nextCombination=function(B){var E=B|B-1;return E+1|(~E&-~E)-1>>>v(B)+1}},12489:B=>{"use strict";B.exports=function(B,E,v,z){var o=self||window;try{try{var q;try{q=new o.Blob([B])}catch(D){(q=new(o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder)).append(B),q=q.getBlob()}var c=o.URL||o.webkitURL,S=c.createObjectURL(q),x=new o[E](S,v);return c.revokeObjectURL(S),x}catch(D){return new o[E]("data:application/javascript,".concat(encodeURIComponent(B)),v)}}catch(D){if(!z)throw Error("Inline worker is not supported");return new o[E](z,v)}}},12167:(B,E,v)=>{"use strict";function z(B,E,v,z,o){var q={};return Object.keys(z).forEach((function(B){q[B]=z[B]})),q.enumerable=!!q.enumerable,q.configurable=!!q.configurable,("value"in q||q.initializer)&&(q.writable=!0),q=v.slice().reverse().reduce((function(v,z){return z(B,E,v)||v}),q),o&&void 0!==q.initializer&&(q.value=q.initializer?q.initializer.call(o):void 0,q.initializer=void 0),void 0===q.initializer&&(Object.defineProperty(B,E,q),q=null),q}v.d(E,{e:()=>z})},12164:(B,E,v)=>{"use strict";function z(B,E,v,z){v&&Object.defineProperty(B,E,{enumerable:v.enumerable,configurable:v.configurable,writable:v.writable,value:v.initializer?v.initializer.call(z):void 0})}v.d(E,{c:()=>z})},13541:(B,E,v)=>{"use strict";v.d(E,{d:()=>c,f:()=>y,j:()=>S,m:()=>q,o:()=>x,s:()=>o,w:()=>D,x:()=>h});var z=v(11578);class o{constructor(){this._easingMode=o.EASINGMODE_EASEIN}setEasingMode(B){const E=Math.min(Math.max(B,0),2);this._easingMode=E}getEasingMode(){return this._easingMode}easeInCore(B){throw new Error("You must implement this method")}ease(B){switch(this._easingMode){case o.EASINGMODE_EASEIN:return this.easeInCore(B);case o.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-B)}return B>=.5?.5*(1-this.easeInCore(2*(1-B)))+.5:.5*this.easeInCore(2*B)}}o.EASINGMODE_EASEIN=0,o.EASINGMODE_EASEOUT=1,o.EASINGMODE_EASEINOUT=2;class q extends o{easeInCore(B){return B=Math.max(0,Math.min(1,B)),1-Math.sqrt(1-B*B)}}class c extends o{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=B}easeInCore(B){const E=Math.max(0,this.amplitude);return Math.pow(B,3)-B*E*Math.sin(3.141592653589793*B)}}class S extends o{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=B,this.bounciness=E}easeInCore(B){const E=Math.max(0,this.bounces);let v=this.bounciness;v<=1&&(v=1.001);const z=Math.pow(v,E),o=1-v,q=(1-z)/o+.5*z,c=B*q,S=Math.log(-c*(1-v)+1)/Math.log(v),x=Math.floor(S),D=x+1,h=(1-Math.pow(v,x))/(o*q),y=.5*(h+(1-Math.pow(v,D))/(o*q)),Q=B-y,P=y-h;return-Math.pow(1/v,E-x)/(P*P)*(Q-P)*(Q+P)}}class x extends o{easeInCore(B){return B*B*B}}class D extends o{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=B,this.springiness=E}easeInCore(B){let E;const v=Math.max(0,this.oscillations),z=Math.max(0,this.springiness);return E=0==z?B:(Math.exp(z*B)-1)/(Math.exp(z)-1),E*Math.sin((6.283185307179586*v+1.5707963267948966)*B)}}class h extends o{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=B}easeInCore(B){return this.exponent<=0?B:(Math.exp(this.exponent*B)-1)/(Math.exp(this.exponent)-1)}}class y extends o{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=B,this.y1=E,this.x2=v,this.y2=z}easeInCore(B){return z.b.Interpolate(B,this.x1,this.y1,this.x2,this.y2)}}},13020:(B,E,v)=>{"use strict";v.d(E,{b:()=>c});var z=v(11380),o=v(11385),q=v(11808);class c extends q.e{get _matrix(){return this._compose(),this.xP}set _matrix(B){(B.updateFlag!==this.xP.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.xP.S(B),this._markAsDirtyAndDecompose())}constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(B,E.rB(),!1),this.name=B,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=E,this.xP=(null===o||void 0===o?void 0:o.clone())??z.Matrix.Identity(),this._restMatrix=q??this.xP.clone(),this._bindMatrix=c??this.xP.clone(),this._index=S,this._absoluteMatrix=new z.Matrix,this._absoluteBindMatrix=new z.Matrix,this._absoluteInverseBindMatrix=new z.Matrix,this._finalMatrix=new z.Matrix,E.bones.push(this),this.setParent(v,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(B){this.setParent(B)}setParent(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==B){if(this.parent){const B=this.parent.children.indexOf(this);-1!==B&&this.parent.children.splice(B,1)}this._parentNode=B,this.parent&&this.parent.children.push(this),E&&this._updateAbsoluteBindMatrices(),this.mh()}}getLocalMatrix(){return this._compose(),this.xP}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(B){this._restMatrix.S(B)}setRestPose(B){this.setRestMatrix(B)}getBindPose(){return this.getBindMatrix()}setBindMatrix(B){this.hc(B)}setBindPose(B){this.setBindMatrix(B)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const B=z.TmpVectors.GE[0],E=z.TmpVectors.Quaternion[0],v=z.TmpVectors.GE[1];this.getRestMatrix().decompose(B,E,v),this._linkedTransformNode.position.S(v),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??z.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.S(E),this._linkedTransformNode.ac.S(B)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(B){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=B,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Sx}set position(B){this._decompose(),this.Sx.S(B),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(B){this.setRotation(B)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(B){this.setRotationQuaternion(B)}get ac(){return this.getScale()}set ac(B){this.setScale(B)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=z.GE.Zero(),this._localRotation=z.Quaternion.Zero(),this.Sx=z.GE.Zero()),this.xP.decompose(this._localScaling,this._localRotation,this.Sx))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,z.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Sx,this.xP)):this._needToCompose=!1)}hc(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.S(B),E&&this._updateAbsoluteBindMatrices(),v?this._matrix=B:this.mh()}_updateAbsoluteBindMatrices(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(B||(B=this._bindMatrix),this.parent?B.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.S(B),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),E)for(let v=0;v<this.children.length;v++)this.children[v]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}mh(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.mh(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.mh(),this._needToDecompose=!0}_updatePosition(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=this.getLocalMatrix();if(0==E)o?(q.addAtIndex(12,B.x),q.addAtIndex(13,B.y),q.addAtIndex(14,B.z)):q.setTranslationFromFloats(B.x,B.y,B.z);else{let E=null;v&&(E=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=c._TmpMats[0],x=c._TmpVecs[0];this.parent?v&&E?(S.S(this.parent.getAbsoluteMatrix()),S.multiplyToRef(E,S)):S.S(this.parent.getAbsoluteMatrix()):z.Matrix.IdentityToRef(S),o&&S.setTranslationFromFloats(0,0,0),S.invert(),z.GE.TransformCoordinatesToRef(B,S,x),o?(q.addAtIndex(12,x.x),q.addAtIndex(13,x.y),q.addAtIndex(14,x.z)):q.setTranslationFromFloats(x.x,x.y,x.z)}this._markAsDirtyAndDecompose()}translate(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;this._updatePosition(B,E,v,!0)}setPosition(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;this._updatePosition(B,E,v,!1)}setAbsolutePosition(B,E){this.setPosition(B,1,E)}scale(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=this.getLocalMatrix(),S=c._TmpMats[0];z.Matrix.ScalingToRef(B,E,v,S),S.multiplyToRef(q,q),S.invert();for(const z of this.children){const o=z.getLocalMatrix();o.multiplyToRef(S,o),o.multiplyAtIndex(12,B),o.multiplyAtIndex(13,E),o.multiplyAtIndex(14,v),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(const z of this.children)z.scale(B,E,v,o)}setScale(B){this._decompose(),this._localScaling.S(B),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(B){this._decompose(),B.S(this._localScaling)}setYawPitchRoll(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4?arguments[4]:void 0;if(0===o){const S=c._TmpQuat;return z.Quaternion.RotationYawPitchRollToRef(B,E,v,S),void this.setRotationQuaternion(S,o,q)}const S=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,q))return;const x=c._TmpMats[1];z.Matrix.RotationYawPitchRollToRef(B,E,v,x),S.multiplyToRef(x,x),this._rotateWithMatrix(x,o,q)}rotate(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const q=c._TmpMats[0];q.setTranslationFromFloats(0,0,0),z.Matrix.RotationAxisToRef(B,E,q),this._rotateWithMatrix(q,v,o)}setAxisAngle(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;if(0===v){const q=c._TmpQuat;return z.Quaternion.RotationAxisToRef(B,E,q),void this.setRotationQuaternion(q,v,o)}const q=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,o))return;const S=c._TmpMats[1];z.Matrix.RotationAxisToRef(B,E,S),q.multiplyToRef(S,S),this._rotateWithMatrix(S,v,o)}setRotation(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(B.y,B.x,B.z,E,v)}setRotationQuaternion(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;if(0===E)return this._decompose(),this._localRotation.S(B),void this._markAsDirtyAndCompose();const o=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,v))return;const q=c._TmpMats[1];z.Matrix.FromQuaternionToRef(B,q),o.multiplyToRef(q,q),this._rotateWithMatrix(q,E,v)}setRotationMatrix(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;if(0===E){const o=c._TmpQuat;return z.Quaternion.FromRotationMatrixToRef(B,o),void this.setRotationQuaternion(o,E,v)}const o=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,v))return;const q=c._TmpMats[1];q.S(B),o.multiplyToRef(B,q),this._rotateWithMatrix(q,E,v)}_rotateWithMatrix(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;const z=this.getLocalMatrix(),o=z.m[12],q=z.m[13],S=z.m[14],x=this.getParent(),D=c._TmpMats[3],h=c._TmpMats[4];x&&1==E?(v?(D.S(v.getWorldMatrix()),x.getAbsoluteMatrix().multiplyToRef(D,D)):D.S(x.getAbsoluteMatrix()),h.S(D),h.invert(),z.multiplyToRef(D,z),z.multiplyToRef(B,z),z.multiplyToRef(h,z)):1==E&&v?(D.S(v.getWorldMatrix()),h.S(D),h.invert(),z.multiplyToRef(D,z),z.multiplyToRef(B,z),z.multiplyToRef(h,z)):z.multiplyToRef(B,z),z.setTranslationFromFloats(o,q,S),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(B,E){const v=c._TmpMats[2];return B.S(this.getAbsoluteMatrix()),E?(B.multiplyToRef(E.getWorldMatrix(),B),z.Matrix.ScalingToRef(E.ac.x,E.ac.y,E.ac.z,v)):z.Matrix.IdentityToRef(v),B.invert(),!isNaN(B.m[0])&&(v.multiplyAtIndex(0,this._scalingDeterminant),B.multiplyToRef(v,B),!0)}tz(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=z.GE.Zero();return this.getPositionToRef(B,E,v),v}getPositionToRef(){let B=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const B=this.getLocalMatrix();E.x=B.m[12],E.y=B.m[13],E.z=B.m[14]}else{let v=null;B&&(v=B.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let z=c._TmpMats[0];B&&v?(z.S(this.getAbsoluteMatrix()),z.multiplyToRef(v,z)):z=this.getAbsoluteMatrix(),E.x=z.m[12],E.y=z.m[13],E.z=z.m[14]}}getAbsolutePosition(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=z.GE.Zero();return this.getPositionToRef(1,B,E),E}getAbsolutePositionToRef(B,E){this.getPositionToRef(1,B,E)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.xP.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.S(this.xP);const B=this._skeleton.getPoseMatrix();B&&this._absoluteMatrix.multiplyToRef(B,this._absoluteMatrix)}const B=this.children,E=B.length;for(let v=0;v<E;v++)B[v].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Fx(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=z.GE.Zero();return this.getDirectionToRef(B,E,v),v}getDirectionToRef(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,o=null;E&&(o=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=c._TmpMats[0];q.S(this.getAbsoluteMatrix()),E&&o&&q.multiplyToRef(o,q),z.GE.TransformNormalToRef(B,q,v),v.normalize()}getRotation(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=z.GE.Zero();return this.getRotationToRef(B,E,v),v}getRotationToRef(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;const z=c._TmpQuat;this.getRotationQuaternionToRef(B,E,z),z.toEulerAnglesToRef(v)}getRotationQuaternion(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=z.Quaternion.Identity();return this.getRotationQuaternionToRef(B,E,v),v}getRotationQuaternionToRef(){let B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),E.S(this._localRotation);else{const v=c._TmpMats[0],z=this.getAbsoluteMatrix();B?z.multiplyToRef(B.getWorldMatrix(),v):v.S(z),v.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyAtIndex(1,this._scalingDeterminant),v.multiplyAtIndex(2,this._scalingDeterminant),v.decompose(void 0,E,void 0)}}getRotationMatrix(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1?arguments[1]:void 0;const v=z.Matrix.Identity();return this.getRotationMatrixToRef(B,E,v),v}getRotationMatrixToRef(){let B=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(E);else{const v=c._TmpMats[0],z=this.getAbsoluteMatrix();B?z.multiplyToRef(B.getWorldMatrix(),v):v.S(z),v.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyAtIndex(1,this._scalingDeterminant),v.multiplyAtIndex(2,this._scalingDeterminant),v.getRotationMatrixToRef(E)}}getAbsolutePositionFromLocal(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=z.GE.Zero();return this.getAbsolutePositionFromLocalToRef(B,E,v),v}getAbsolutePositionFromLocalToRef(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,o=null;E&&(o=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=c._TmpMats[0];q.S(this.getAbsoluteMatrix()),E&&o&&q.multiplyToRef(o,q),z.GE.TransformCoordinatesToRef(B,q,v)}getLocalPositionFromAbsolute(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=z.GE.Zero();return this.getLocalPositionFromAbsoluteToRef(B,E,v),v}getLocalPositionFromAbsoluteToRef(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,o=null;E&&(o=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=c._TmpMats[0];q.S(this.getAbsoluteMatrix()),E&&o&&q.multiplyToRef(o,q),q.invert(),z.GE.TransformCoordinatesToRef(B,q,v)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const B=this._skeleton.bones.indexOf(this);if(-1!==B&&this._skeleton.bones.splice(B,1),this._parentNode&&this._parentNode.children){const B=this._parentNode.children,E=B.indexOf(this);-1!==E&&B.splice(E,1)}super.dispose()}}c._TmpVecs=(0,o.b)(2,z.GE.Zero),c._TmpQuat=z.Quaternion.Identity(),c._TmpMats=(0,o.b)(5,z.Matrix.Identity)},13539:(B,E,v)=>{"use strict";v.d(E,{e:()=>d});var z=v(11366),o=v(11372),q=v(11202),c=v(11380),S=v(11394),x=v(11808),D=v(11833),h=v(11646),y=v(11230),Q=v(11382);class P{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(B){this._zoomStopsAnimation=B}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(B){this._idleRotationSpeed=B}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(B){this._idleRotationWaitTime=B}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(B){this._idleRotationSpinupTime=B}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(B){this._attachedCamera=B;const E=this._attachedCamera.rB();this._onPrePointerObservableObserver=E.onPrePointerObservable.add((B=>{B.type!==h.e.POINTERDOWN?B.type===h.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const B=y.e.Now;let E=0;null!=this._lastFrameTime&&(E=B-this._lastFrameTime),this._lastFrameTime=B,this._applyUserInteraction();const v=B-this._lastInteractionTime-this._idleRotationWaitTime,z=Math.max(Math.min(v/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(E/1e3))}))}detach(){if(!this._attachedCamera)return;const B=this._attachedCamera.rB();this._onPrePointerObservableObserver&&B.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(B){this._lastInteractionTime=B??y.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Q.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let B=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(B=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?B:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=y.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var G=v(13541),Y=v(11908);class a{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(B){if(this._autoTransitionRange===B)return;this._autoTransitionRange=B;const E=this._attachedCamera;E&&(B?this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((B=>{if(B&&(B.yc(!0),B.getBoundingInfo)){const E=B.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*E,this.upperRadiusTransitionRange=.05*E}})):this._onMeshTargetChangedObserver&&E.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(B){this._attachedCamera=B,this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(B){return!!this._attachedCamera&&(this._attachedCamera.radius===B&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(B){if(!this._attachedCamera)return;this._radiusBounceTransition||(a.EasingFunction.setEasingMode(a.EasingMode),this._radiusBounceTransition=Y.c.CreateAnimation("radius",Y.c.ANIMATIONTYPE_FLOAT,60,a.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const E=Y.c.TransitionTo("radius",this._attachedCamera.radius+B,this._attachedCamera,this._attachedCamera.rB(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));E&&this._animatables.push(E)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}a.EasingFunction=new G.d(.3),a.EasingMode=G.s.EASINGMODE_EASEOUT;class m{constructor(){this.onTargetFramingAnimationEndObservable=new q.e,this._mode=m.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(B){this._mode=B}get mode(){return this._mode}set radiusScale(B){this._radiusScale=B}get radiusScale(){return this._radiusScale}set positionScale(B){this._positionScale=B}get positionScale(){return this._positionScale}set defaultElevation(B){this._defaultElevation=B}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(B){this._elevationReturnTime=B}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(B){this._elevationReturnWaitTime=B}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(B){this._zoomStopsAnimation=B}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(B){this._framingTime=B}get framingTime(){return this._framingTime}init(){}attach(B){this._attachedCamera=B;const E=this._attachedCamera.rB();m.EasingFunction.setEasingMode(m.EasingMode),this._onPrePointerObservableObserver=E.onPrePointerObservable.add((B=>{B.type!==h.e.POINTERDOWN?B.type===h.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=B.onMeshTargetChangedObservable.add((B=>{B&&B.getBoundingInfo&&this.zoomOnMesh(B,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const B=this._attachedCamera.rB();this._onPrePointerObservableObserver&&B.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.yc(!0);const z=B.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(z.minimumWorld,z.maximumWorld,E,v)}zoomOnMeshHierarchy(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.yc(!0);const z=B.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(z.min,z.max,E,v)}zoomOnMeshesHierarchy(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new c.GE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new c.GE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let q=0;q<B.length;q++){const E=B[q].getHierarchyBoundingVectors(!0);c.GE.CheckExtends(E.min,z,o),c.GE.CheckExtends(E.max,z,o)}this.zoomOnBoundingInfo(z,o,E,v)}zoomOnBoundingInfo(B,E){let v,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const q=B.y,S=q+(E.y-q)*this._positionScale,x=E.YE(B).scale(.5);if(!isFinite(S))return!1;if(z)v=new c.GE(0,S,0);else{const E=B.add(x);v=new c.GE(E.x,S,E.z)}this._vectorTransition||(this._vectorTransition=Y.c.CreateAnimation("target",Y.c.ANIMATIONTYPE_VECTOR3,60,m.EasingFunction)),this._betaIsAnimating=!0;let D=Y.c.TransitionTo("target",v,this._attachedCamera,this._attachedCamera.rB(),60,this._vectorTransition,this._framingTime);D&&this._animatables.push(D);let h=0;if(this._mode===m.FitFrustumSidesMode){const v=this._calculateLowerRadiusFromModelBoundingSphere(B,E);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=x.length()+this._attachedCamera.xc),h=v}else this._mode===m.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(B,E),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.xc));if(this.autoCorrectCameraLimitsAndSensibility){const v=E.YE(B).length();this._attachedCamera.panningSensibility=5e3/v,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=Y.c.CreateAnimation("radius",Y.c.ANIMATIONTYPE_FLOAT,60,m.EasingFunction)),D=Y.c.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.rB(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),o&&o(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),D&&this._animatables.push(D),!0}_calculateLowerRadiusFromModelBoundingSphere(B,E){const v=this._attachedCamera;if(!v)return 0;let z=v._calculateLowerRadiusFromModelBoundingSphere(B,E,this._radiusScale);return v.lowerRadiusLimit&&this._mode===m.IgnoreBoundsSizeMode&&(z=z<v.lowerRadiusLimit?v.lowerRadiusLimit:z),v.upperRadiusLimit&&(z=z>v.upperRadiusLimit?v.upperRadiusLimit:z),z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const B=y.e.Now-this._lastInteractionTime,E=.5*Math.PI-this._defaultElevation,v=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>v&&B>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Y.c.CreateAnimation("beta",Y.c.ANIMATIONTYPE_FLOAT,60,m.EasingFunction));const B=Y.c.TransitionTo("beta",E,this._attachedCamera,this._attachedCamera.rB(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));B&&this._animatables.push(B)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=y.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}m.EasingFunction=new G.x,m.EasingMode=G.s.EASINGMODE_EASEINOUT,m.IgnoreBoundsSizeMode=0,m.FitFrustumSidesMode=1;var g=v(11841),V=v(11870),T=v(13018),N=v(11193);class X{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(B){B=N.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),v=E.getInputElement();let z=0,o=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=q=>{var c,S;const x=q.event,D="touch"===x.pointerType;if(q.type!==h.e.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const y=x.target;if(this._altKey=x.altKey,this._ctrlKey=x.ctrlKey,this._metaKey=x.metaKey,this._shiftKey=x.shiftKey,this._buttonsPressed=x.buttons,E.isPointerLock){const B=x.movementX,E=x.movementY;this.onTouch(null,B,E),this._pointA=null,this._pointB=null}else{if(q.type!==h.e.POINTERDOWN&&q.type!==h.e.POINTERDOUBLETAP&&D&&(null===(c=this._pointA)||void 0===c?void 0:c.pointerId)!==x.pointerId&&(null===(S=this._pointB)||void 0===S?void 0:S.pointerId)!==x.pointerId)return;if(q.type!==h.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!D)if(q.type===h.e.POINTERDOUBLETAP)this.onDoubleTap(x.pointerType);else if(q.type!==h.e.POINTERUP||this._currentMousePointerIdDown!==x.pointerId&&!D){if(q.type===h.e.POINTERMOVE)if(B||x.preventDefault(),this._pointA&&null===this._pointB){const B=x.clientX-this._pointA.x,E=x.clientY-this._pointA.y;this._pointA.x=x.clientX,this._pointA.y=x.clientY,this.onTouch(this._pointA,B,E)}else if(this._pointA&&this._pointB){const B=this._pointA.pointerId===x.pointerId?this._pointA:this._pointB;B.x=x.clientX,B.y=x.clientY;const E=this._pointA.x-this._pointB.x,v=this._pointA.y-this._pointB.y,c=E*E+v*v,S={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:x.pointerId,type:q.type};this.onMultiTouch(this._pointA,this._pointB,z,c,o,S),o=S,z=c}}else{try{null===y||void 0===y||y.releasePointerCapture(x.pointerId)}catch(Q){}D||(this._pointB=null),E._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==x.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==x.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==z||o)&&(this.onMultiTouch(this._pointA,this._pointB,z,0,o,null),z=0,o=null),this._currentMousePointerIdDown=-1,this.onButtonUp(x),B||x.preventDefault()}else{try{null===y||void 0===y||y.setPointerCapture(x.pointerId)}catch(Q){}if(null===this._pointA)this._pointA={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType};else{if(null!==this._pointB)return;this._pointB={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType}}-1!==this._currentMousePointerIdDown||D||(this._currentMousePointerIdDown=x.pointerId),this.onButtonDown(x),B||(x.preventDefault(),v&&v.focus())}}},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._pointerInput,h.e.POINTERDOWN|h.e.POINTERUP|h.e.POINTERMOVE|h.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,z=0,o=null,this.onLostFocus()},this._contextMenuBind=B=>this.onContextMenu(B),v&&v.addEventListener("contextmenu",this._contextMenuBind,!1);const q=this.camera.rB().getEngine().getHostWindow();q&&N.Tools.RegisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}VQ(){if(this._onLostFocus){const B=this.camera.rB().getEngine().getHostWindow();B&&N.Tools.UnregisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const B=this.camera.rB().getEngine().getInputElement();B&&B.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(B){}onTouch(B,E,v){}onMultiTouch(B,E,v,z,o,q){}onContextMenu(B){B.preventDefault()}onButtonDown(B){}onButtonUp(B){}onLostFocus(){}}(0,z.c)([(0,o.K)()],X.prototype,"buttons",void 0);class r extends X{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(B,E){if(0!==this.panningSensibility&&B&&E){const v=E.x-B.x,z=E.y-B.y;this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=z/this.panningSensibility}}_computePinchZoom(B,E){const v=this.camera.radius||r.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=v*Math.sqrt(B)/Math.sqrt(E):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(E-B)*v*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(E-B)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(B,E,v){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-E/this.panningSensibility,this.camera.inertialPanningY+=v/this.panningSensibility):(this.camera.inertialAlphaOffset-=E/this.angularSensibilityX,this.camera.inertialBetaOffset-=v/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(B,E,v,z,o,q){0===v&&null===o||0===z&&null===q||(this.multiTouchPanAndZoom?(this._computePinchZoom(v,z),this._computeMultiTouchPanning(o,q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(z)-Math.sqrt(v))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(v,z),this._isPinching=!0):this._computeMultiTouchPanning(o,q)):this.multiTouchPanning?this._computeMultiTouchPanning(o,q):this.pinchZoom&&this._computePinchZoom(v,z))}onButtonDown(B){this._isPanClick=B.button===this.camera._panningMouseButton}onButtonUp(B){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}r.MinimumRadiusForPinch=.001,(0,z.c)([(0,o.K)()],r.prototype,"buttons",void 0),(0,z.c)([(0,o.K)()],r.prototype,"angularSensibilityX",void 0),(0,z.c)([(0,o.K)()],r.prototype,"angularSensibilityY",void 0),(0,z.c)([(0,o.K)()],r.prototype,"pinchPrecision",void 0),(0,z.c)([(0,o.K)()],r.prototype,"pinchDeltaPercentage",void 0),(0,z.c)([(0,o.K)()],r.prototype,"useNaturalPinchZoom",void 0),(0,z.c)([(0,o.K)()],r.prototype,"pinchZoom",void 0),(0,z.c)([(0,o.K)()],r.prototype,"panningSensibility",void 0),(0,z.c)([(0,o.K)()],r.prototype,"multiTouchPanning",void 0),(0,z.c)([(0,o.K)()],r.prototype,"multiTouchPanAndZoom",void 0),T.d.ArcRotateCameraPointersInput=r;var i=v(11655);class u{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(B){B=N.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.rB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const v=E.event;if(!v.metaKey)if(E.type===i.b.KEYDOWN){if(this._ctrlPressed=v.ctrlKey,this._altPressed=v.altKey,-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysReset.indexOf(v.keyCode)){-1===this._keys.indexOf(v.keyCode)&&this._keys.push(v.keyCode),v.preventDefault&&(B||v.preventDefault())}}else if(-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysReset.indexOf(v.keyCode)){const E=this._keys.indexOf(v.keyCode);E>=0&&this._keys.splice(E,1),v.preventDefault&&(B||v.preventDefault())}})))}VQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const B=this.camera;for(let E=0;E<this._keys.length;E++){const v=this._keys[E];-1!==this.keysLeft.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningX-=1/this.panningSensibility:B.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?B.inertialRadiusOffset+=1/this.zoomingSensibility:B.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningX+=1/this.panningSensibility:B.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?B.inertialRadiusOffset-=1/this.zoomingSensibility:B.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(v)&&B.useInputToRestoreState&&B.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,z.c)([(0,o.K)()],u.prototype,"keysUp",void 0),(0,z.c)([(0,o.K)()],u.prototype,"keysDown",void 0),(0,z.c)([(0,o.K)()],u.prototype,"keysLeft",void 0),(0,z.c)([(0,o.K)()],u.prototype,"keysRight",void 0),(0,z.c)([(0,o.K)()],u.prototype,"keysReset",void 0),(0,z.c)([(0,o.K)()],u.prototype,"panningSensibility",void 0),(0,z.c)([(0,o.K)()],u.prototype,"zoomingSensibility",void 0),(0,z.c)([(0,o.K)()],u.prototype,"useAltToZoom",void 0),(0,z.c)([(0,o.K)()],u.prototype,"angularSpeed",void 0),T.d.ArcRotateCameraKeyboardMoveInput=u;var I=v(11420),K=v(11661);class C{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new c.GE(0,0,0),this._globalOffset=new c.GE(0,0,0),this._inertialPanning=c.GE.Zero()}_computeDeltaFromMouseWheelLegacyEvent(B,E){let v=0;const z=.01*B*this.wheelDeltaPercentage*E;return v=B>0?z/(1+this.wheelDeltaPercentage):z*(1+this.wheelDeltaPercentage),v}attachControl(B){B=N.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==h.e.POINTERWHEEL)return;const v=E.event;let z=0;const o=v.deltaMode===K.d.DOM_DELTA_LINE?40:1,q=-v.deltaY*o;if(this.customComputeDeltaFromMouseWheel)z=this.customComputeDeltaFromMouseWheel(q,this,v);else if(this.wheelDeltaPercentage){if(z=this._computeDeltaFromMouseWheelLegacyEvent(q,this.camera.radius),z>0){let B=this.camera.radius,E=this.camera.inertialRadiusOffset+z;for(let v=0;v<20&&!(B<=E)&&!(Math.abs(E*this.camera.inertia)<.001);v++)B-=E,E*=this.camera.inertia;B=(0,S.Clamp)(B,0,Number.MAX_VALUE),z=this._computeDeltaFromMouseWheelLegacyEvent(q,B)}}else z=q/(40*this.wheelPrecision);z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(z)):this.camera.inertialRadiusOffset+=z),v.preventDefault&&(B||v.preventDefault())},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._wheel,h.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.mc(0)}VQ(){this._observer&&(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const B=this.camera;0+B.inertialAlphaOffset+B.inertialBetaOffset+B.inertialRadiusOffset&&(this._updateHitPlane(),B.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(B.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const B=this.camera,E=B.target.YE(B.position);this._hitPlane=I.d.FromPositionAndNormal(B.target,E)}_getPosition(){const B=this.camera,E=B.rB(),v=E.createPickingRay(E.pointerX,E.pointerY,c.Matrix.Identity(),B,!1);0===B.targetScreenOffset.x&&0===B.targetScreenOffset.y||(this._viewOffset.set(B.targetScreenOffset.x,B.targetScreenOffset.y,0),B.getViewMatrix().invertToRef(B._cameraTransformMatrix),this._globalOffset=c.GE.TransformNormal(this._viewOffset,B._cameraTransformMatrix),v.origin.addInPlace(this._globalOffset));let z=0;return this._hitPlane&&(z=v.intersectsPlane(this._hitPlane)??0),v.origin.addInPlace(v.direction.scaleInPlace(z))}_zoomToMouse(B){const E=this.camera,v=1-E.inertia;if(E.lowerRadiusLimit){const z=E.lowerRadiusLimit??0;E.radius-(E.inertialRadiusOffset+B)/v<z&&(B=(E.radius-z)*v-E.inertialRadiusOffset)}if(E.upperRadiusLimit){const z=E.upperRadiusLimit??0;E.radius-(E.inertialRadiusOffset+B)/v>z&&(B=(E.radius-z)*v-E.inertialRadiusOffset)}const z=B/v/E.radius,o=this._getPosition(),q=c.TmpVectors.GE[6];o.subtractToRef(E.target,q),q.scaleInPlace(z),q.scaleInPlace(v),this._inertialPanning.addInPlace(q),E.inertialRadiusOffset+=B}_zeroIfClose(B){Math.abs(B.x)<Q.e&&(B.x=0),Math.abs(B.y)<Q.e&&(B.y=0),Math.abs(B.z)<Q.e&&(B.z=0)}}(0,z.c)([(0,o.K)()],C.prototype,"wheelPrecision",void 0),(0,z.c)([(0,o.K)()],C.prototype,"zoomToMouseLocation",void 0),(0,z.c)([(0,o.K)()],C.prototype,"wheelDeltaPercentage",void 0),T.d.ArcRotateCameraMouseWheelInput=C;class f extends T.g{constructor(B){super(B)}addMouseWheel(){return this.add(new C),this}addPointers(){return this.add(new r),this}addKeyboard(){return this.add(new u),this}}var A=v(11345);function l(B,E){return isNaN(B)?E:B}x.e.AddNodeConstructor("ArcRotateCamera",((B,E)=>()=>new d(B,0,0,1,c.GE.Zero(),E)));class d extends V.d{get target(){return this._target}set target(B){this.setTarget(B)}get targetHost(){return this._targetHost}set targetHost(B){B&&this.setTarget(B)}getTarget(){return this.target}get position(){return this._position}set position(B){this.setPosition(B)}set upVector(B){this._upToYMatrix||(this._yToUpMatrix=new c.Matrix,this._upToYMatrix=new c.Matrix,this._upVector=c.GE.Zero()),B.normalize(),this._upVector.S(B),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){c.Matrix.RotationAlignToRef(c.GE.UpReadOnly,this._upVector,this._yToUpMatrix),c.Matrix.RotationAlignToRef(this._upVector,c.GE.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const B=this.inputs.attached.pointers;return B?B.angularSensibilityX:0}set angularSensibilityX(B){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityX=B)}get angularSensibilityY(){const B=this.inputs.attached.pointers;return B?B.angularSensibilityY:0}set angularSensibilityY(B){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityY=B)}get pinchPrecision(){const B=this.inputs.attached.pointers;return B?B.pinchPrecision:0}set pinchPrecision(B){const E=this.inputs.attached.pointers;E&&(E.pinchPrecision=B)}get pinchDeltaPercentage(){const B=this.inputs.attached.pointers;return B?B.pinchDeltaPercentage:0}set pinchDeltaPercentage(B){const E=this.inputs.attached.pointers;E&&(E.pinchDeltaPercentage=B)}get useNaturalPinchZoom(){const B=this.inputs.attached.pointers;return!!B&&B.useNaturalPinchZoom}set useNaturalPinchZoom(B){const E=this.inputs.attached.pointers;E&&(E.useNaturalPinchZoom=B)}get panningSensibility(){const B=this.inputs.attached.pointers;return B?B.panningSensibility:0}set panningSensibility(B){const E=this.inputs.attached.pointers;E&&(E.panningSensibility=B)}get keysUp(){const B=this.inputs.attached.keyboard;return B?B.keysUp:[]}set keysUp(B){const E=this.inputs.attached.keyboard;E&&(E.keysUp=B)}get keysDown(){const B=this.inputs.attached.keyboard;return B?B.keysDown:[]}set keysDown(B){const E=this.inputs.attached.keyboard;E&&(E.keysDown=B)}get keysLeft(){const B=this.inputs.attached.keyboard;return B?B.keysLeft:[]}set keysLeft(B){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=B)}get keysRight(){const B=this.inputs.attached.keyboard;return B?B.keysRight:[]}set keysRight(B){const E=this.inputs.attached.keyboard;E&&(E.keysRight=B)}get wheelPrecision(){const B=this.inputs.attached.mousewheel;return B?B.wheelPrecision:0}set wheelPrecision(B){const E=this.inputs.attached.mousewheel;E&&(E.wheelPrecision=B)}get zoomToMouseLocation(){const B=this.inputs.attached.mousewheel;return!!B&&B.zoomToMouseLocation}set zoomToMouseLocation(B){const E=this.inputs.attached.mousewheel;E&&(E.zoomToMouseLocation=B)}get wheelDeltaPercentage(){const B=this.inputs.attached.mousewheel;return B?B.wheelDeltaPercentage:0}set wheelDeltaPercentage(B){const E=this.inputs.attached.mousewheel;E&&(E.wheelDeltaPercentage=B)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(B){B!==this.useBouncingBehavior&&(B?(this._bouncingBehavior=new a,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(B){B!==this.useFramingBehavior&&(B?(this._framingBehavior=new m,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(B){B!==this.useAutoRotationBehavior&&(B?(this._autoRotationBehavior=new P,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(B,E,v,z,o,S){var x;let D=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(B,c.GE.Zero(),S,D),x=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=c.GE.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=c.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new c.Matrix,this.panningAxis=new c.GE(1,1,0),this._transformedDirection=new c.GE,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new q.e,this.checkCollisions=!1,this.collisionRadius=new c.GE(.5,.5,.5),this._previousPosition=c.GE.Zero(),this._collisionVelocity=c.GE.Zero(),this._newPosition=c.GE.Zero(),this._computationVector=c.GE.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new c.GE(NaN,NaN,NaN),this._goalTargetScreenOffset=new c.Vector2(NaN,NaN),this._onCollisionPositionChange=function(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v?(x.setPosition(E),x.EG&&x.EG(v)):x._previousPosition.S(x._position);const z=Math.cos(x.alpha),o=Math.sin(x.alpha),q=Math.cos(x.beta);let c=Math.sin(x.beta);0===c&&(c=1e-4);const S=x._getTargetPosition();x._computationVector.Yc(x.radius*z*c,x.radius*q,x.radius*o*c),S.addToRef(x._computationVector,x._newPosition),x._position.S(x._newPosition);let D=x.upVector;x.allowUpsideDown&&x.beta<0&&(D=D.clone(),D=D.negate()),x._computeViewMatrix(x._position,S,D),x._viewMatrix.addAtIndex(12,x.targetScreenOffset.x),x._viewMatrix.addAtIndex(13,x.targetScreenOffset.y),x._collisionTriggered=!1},this._target=c.GE.Zero(),o&&this.setTarget(o),this.alpha=E,this.beta=v,this.radius=z,this.getViewMatrix(),this.inputs=new f(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new c.GE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=c.Vector2.Zero()}_updateCache(B){B||super._updateCache(),this._cache._target.S(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.S(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const B=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?B.addToRef(this._targetBoundingCenter,this._target):this._target.S(B)}const B=this._getLockedTargetPosition();return B||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Q.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,q=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=q?this._currentInterpolationFactor=q:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=l(B,this._goalAlpha),this._goalBeta=l(E,this._goalBeta),this._goalRadius=l(v,this._goalRadius),this._goalTarget.set(l(z.x,this._goalTarget.x),l(z.y,this._goalTarget.y),l(z.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(l(o.x,this._goalTargetScreenOffset.x),l(o.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,S.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,S.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,S.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,S.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(B,E){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const o=arguments;E=N.Tools.BackCompatCameraNoPreventDefault(o),this._useCtrlForPanning=v,this._panningMouseButton=z,"boolean"===typeof o[0]&&(o.length>1&&(this._useCtrlForPanning=o[1]),o.length>2&&(this._panningMouseButton=o[2])),this.inputs.attachElement(E),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}VQ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let B=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){B=!0;const E=this.invertRotation?-1:1,v=this._calculateHandednessMultiplier();let z=this.inertialAlphaOffset*v;this.beta<0&&(z*=-1),this.alpha+=z*E,this.beta+=this.inertialBetaOffset*E,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Q.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Q.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Q.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){B=!0;const E=new c.GE(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),E.multiplyInPlace(this.panningAxis),c.GE.TransformNormalToRef(E,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const B=this.upVector,E=c.GE.CrossToRef(this._transformedDirection,B,this._transformedDirection);c.GE.CrossToRef(B,E,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);c.GE.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.S(this._transformedDirection)}else{if(this.parent){const B=c.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(B),B.transposeToRef(B),c.GE.TransformCoordinatesToRef(this._transformedDirection,B,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Q.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Q.e&&(this.inertialPanningY=0)}if(B)this.stopInterpolation();else if(this._isInterpolating){let B=!1;const E=this._scene.getEngine().getDeltaTime()/1e3,v=1-Math.pow(2,-E/this._currentInterpolationFactor),z=l(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const E=c.TmpVectors.GE[0].set(l(this._goalTarget.x,this._target.x),l(this._goalTarget.y,this._target.y),l(this._goalTarget.z,this._target.z));c.GE.LerpToRef(this.target,E,v,this._target),10*c.GE.Distance(this.target,E)/z<Q.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.S(E),this.setTarget(this.target,!1,!0,!0)):B=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const E=c.Quaternion.RotationAlphaBetaGammaToRef(l(this._goalAlpha,this.alpha),l(this._goalBeta,this.beta),0,c.TmpVectors.Quaternion[0]),z=c.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,c.TmpVectors.Quaternion[1]),o=c.Quaternion.SlerpToRef(z,E,v,c.TmpVectors.Quaternion[2]);o.normalize();const q=o.toAlphaBetaGammaToRef(c.TmpVectors.GE[0]);if(this.alpha=q.x,this.beta=q.y,o.isApprox(E,Q.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const B=E.toAlphaBetaGammaToRef(c.TmpVectors.GE[0]);this.alpha=B.x,this.beta=B.y}else B=!0}if(isNaN(this._goalRadius)||(this.radius+=(z-this.radius)*v,Math.abs(z/this.radius-1)<Q.e?(this._goalRadius=NaN,this.radius=z):B=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const E=c.TmpVectors.Vector2[0].set(l(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),l(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));c.Vector2.LerpToRef(this.targetScreenOffset,E,v,this.targetScreenOffset),c.Vector2.Distance(this.targetScreenOffset,E)<Q.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.S(E)):B=!0}this._isInterpolating=B}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||c.GE.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const B=this.alpha;var E,v;this.alpha=function(B){let E=Math.PI/2;return 0===B.x&&0===B.z||(E=Math.acos(B.x/Math.sqrt(Math.pow(B.x,2)+Math.pow(B.z,2)))),B.z<0&&(E=2*Math.PI-E),E}(this._computationVector),this.beta=(E=this._computationVector.y,v=this.radius,Math.acos(E/v));const z=Math.round((B-this.alpha)/(2*Math.PI));this.alpha+=2*z*Math.PI,this._checkLimits()}setPosition(B){this._position.equals(B)||(this._position.S(B),this.rebuildAnglesAndRadius())}setTarget(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(z=this.overrideCloneAlphaBetaRadius??z,B.yc)E&&B.getBoundingInfo?this._targetBoundingCenter=B.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,B.yc(),this._targetHost=B,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const E=B,z=this._getTargetPosition();if(z&&!v&&z.equals(E))return;this._targetHost=null,this._target=E,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const B=Math.cos(this.alpha),E=Math.sin(this.alpha),v=Math.cos(this.beta);let z=Math.sin(this.beta);0===z&&(z=1e-4),0===this.radius&&(this.radius=1e-4);const o=this._getTargetPosition();if(this._computationVector.Yc(this.radius*B*z,this.radius*v,this.radius*E*z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||c.GE.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),o.addToRef(this._computationVector,this._newPosition),this.rB().collisionsEnabled&&this.checkCollisions){const B=this.rB().collisionCoordinator;this._collider||(this._collider=B.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,B.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.S(this._newPosition);let B=this.upVector;this.allowUpsideDown&&z<0&&(B=B.negate()),this._computeViewMatrix(this._position,o,B),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.S(o),this._viewMatrix}zoomOn(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B=B||this.rB().meshes;const v=D.e.MinMax(B);let z=this._calculateLowerRadiusFromModelBoundingSphere(v.min,v.max);if(z=Math.max(Math.min(z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=z*this.zoomOnFactor,this.mode===g.c.ORTHOGRAPHIC_CAMERA){const B=this.rB().getEngine().getAspectRatio(this),E=z*this.zoomOnFactor/2;this.orthoLeft=-E*B,this.orthoRight=E*B,this.orthoBottom=-E,this.orthoTop=E}this.focusOn({min:v.min,max:v.max,distance:z},E)}focusOn(B){let E,v,z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===B.min){const z=B||this.rB().meshes;E=D.e.MinMax(z),v=c.GE.Distance(E.min,E.max)}else{E=B,v=B.distance}this._target=D.e.Center(E),z||(this.maxZ=2*v)}createRigCamera(B,E){let v=0;switch(this.cameraRigMode){case g.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case g.c.RIG_MODE_VR:v=this._cameraRigParams.stereoHalfAngle*(0===E?1:-1);break;case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v=this._cameraRigParams.stereoHalfAngle*(0===E?-1:1)}const z=new d(B,this.alpha+v,this.beta,this.radius,this._target,this.rB());return z._cameraRigParams={},z.isRigCamera=!0,z.rigParent=this,z.upVector=this.upVector,z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoBottom=this.orthoBottom,z.orthoTop=this.orthoTop,z}_updateRigCameras(){const B=this._rigCameras[0],E=this._rigCameras[1];switch(B.beta=E.beta=this.beta,this.cameraRigMode){case g.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case g.c.RIG_MODE_VR:B.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:B.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const z=c.GE.Distance(B,E),o=this.rB().getEngine().getAspectRatio(this),q=Math.tan(this.fov/2),S=q*o,x=.5*z*v,D=x*Math.sqrt(1+1/(S*S)),h=x*Math.sqrt(1+1/(q*q));return Math.max(D,h)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,z.c)([(0,o.K)()],d.prototype,"alpha",void 0),(0,z.c)([(0,o.K)()],d.prototype,"beta",void 0),(0,z.c)([(0,o.K)()],d.prototype,"radius",void 0),(0,z.c)([(0,o.K)()],d.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,z.c)([(0,o.I)("target")],d.prototype,"_target",void 0),(0,z.c)([(0,o.w)("targetHost")],d.prototype,"_targetHost",void 0),(0,z.c)([(0,o.K)()],d.prototype,"inertialAlphaOffset",void 0),(0,z.c)([(0,o.K)()],d.prototype,"inertialBetaOffset",void 0),(0,z.c)([(0,o.K)()],d.prototype,"inertialRadiusOffset",void 0),(0,z.c)([(0,o.K)()],d.prototype,"lowerAlphaLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"upperAlphaLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"lowerBetaLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"upperBetaLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"lowerRadiusLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"upperRadiusLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"lowerTargetYLimit",void 0),(0,z.c)([(0,o.K)()],d.prototype,"inertialPanningX",void 0),(0,z.c)([(0,o.K)()],d.prototype,"inertialPanningY",void 0),(0,z.c)([(0,o.K)()],d.prototype,"pinchToPanMaxDistance",void 0),(0,z.c)([(0,o.K)()],d.prototype,"panningDistanceLimit",void 0),(0,z.c)([(0,o.I)()],d.prototype,"panningOriginTarget",void 0),(0,z.c)([(0,o.K)()],d.prototype,"panningInertia",void 0),(0,z.c)([(0,o.K)()],d.prototype,"zoomToMouseLocation",null),(0,z.c)([(0,o.K)()],d.prototype,"zoomOnFactor",void 0),(0,z.c)([(0,o.G)()],d.prototype,"targetScreenOffset",void 0),(0,z.c)([(0,o.K)()],d.prototype,"allowUpsideDown",void 0),(0,z.c)([(0,o.K)()],d.prototype,"useInputToRestoreState",void 0),(0,z.c)([(0,o.K)()],d.prototype,"restoreStateInterpolationFactor",void 0),(0,A.f)("BABYLON.ArcRotateCamera",d)},13018:(B,E,v)=>{"use strict";v.d(E,{d:()=>c,g:()=>S});var z=v(11213),o=v(11409),q=v(11841),c={};class S{constructor(B){this.attachedToElement=!1,this.attached={},this.camera=B,this.checkInputs=()=>{}}add(B){const E=B.getSimpleName();this.attached[E]?z.c.Warn("camera input of type "+E+" already exists on camera"):(this.attached[E]=B,B.camera=this.camera,B.checkInputs&&(this.checkInputs=this._addCheckInputs(B.checkInputs.bind(B))),this.attachedToElement&&B.attachControl(this.noPreventDefault))}remove(B){for(const E in this.attached){const v=this.attached[E];if(v===B)return v.VQ(),v.camera=null,delete this.attached[E],void this.rebuildInputCheck()}}removeByType(B){for(const E in this.attached){const v=this.attached[E];v.getClassName()===B&&(v.VQ(),v.camera=null,delete this.attached[E],this.rebuildInputCheck())}}_addCheckInputs(B){const E=this.checkInputs;return()=>{E(),B()}}attachInput(B){this.attachedToElement&&B.attachControl(this.noPreventDefault)}attachElement(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){B=!q.c.ForceAttachControlToAlwaysPreventDefault&&B,this.attachedToElement=!0,this.noPreventDefault=B;for(const E in this.attached)this.attached[E].attachControl(B)}}detachElement(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const E in this.attached)this.attached[E].VQ(),B&&(this.attached[E].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const B in this.attached){const E=this.attached[B];E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(B){const E={};for(const v in this.attached){const B=this.attached[v],z=o.b.Serialize(B);E[B.getClassName()]=z}B.inputsmgr=E}parse(B){const E=B.inputsmgr;if(E){this.clear();for(const B in E){const v=c[B];if(v){const z=E[B],q=o.b.Parse((()=>new v),z,null);this.add(q)}}}else for(const v in this.attached){const E=c[this.attached[v].getClassName()];if(E){const z=o.b.Parse((()=>new E),B,null);this.remove(this.attached[v]),this.add(z)}}}}},13009:(B,E,v)=>{"use strict";v.d(E,{b:()=>X});var z=v(11366),o=v(11372),q=v(11380),c=v(11870),S=v(13018),x=v(11655),D=v(11193);class h{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(B){B=D.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.rB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const v=E.event;if(!v.metaKey)if(E.type===x.b.KEYDOWN){if(-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysUpward.indexOf(v.keyCode)||-1!==this.keysDownward.indexOf(v.keyCode)||-1!==this.keysRotateLeft.indexOf(v.keyCode)||-1!==this.keysRotateRight.indexOf(v.keyCode)||-1!==this.keysRotateUp.indexOf(v.keyCode)||-1!==this.keysRotateDown.indexOf(v.keyCode)){-1===this._keys.indexOf(v.keyCode)&&this._keys.push(v.keyCode),B||v.preventDefault()}}else if(-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysUpward.indexOf(v.keyCode)||-1!==this.keysDownward.indexOf(v.keyCode)||-1!==this.keysRotateLeft.indexOf(v.keyCode)||-1!==this.keysRotateRight.indexOf(v.keyCode)||-1!==this.keysRotateUp.indexOf(v.keyCode)||-1!==this.keysRotateDown.indexOf(v.keyCode)){const E=this._keys.indexOf(v.keyCode);E>=0&&this._keys.splice(E,1),B||v.preventDefault()}})))}VQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const B=this.camera;for(let E=0;E<this._keys.length;E++){const v=this._keys[E],z=B._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(v)?B._localDirection.Yc(-z,0,0):-1!==this.keysUp.indexOf(v)?B._localDirection.Yc(0,0,z):-1!==this.keysRight.indexOf(v)?B._localDirection.Yc(z,0,0):-1!==this.keysDown.indexOf(v)?B._localDirection.Yc(0,0,-z):-1!==this.keysUpward.indexOf(v)?B._localDirection.Yc(0,z,0):-1!==this.keysDownward.indexOf(v)?B._localDirection.Yc(0,-z,0):-1!==this.keysRotateLeft.indexOf(v)?(B._localDirection.Yc(0,0,0),B.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(v)?(B._localDirection.Yc(0,0,0),B.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(v)?(B._localDirection.Yc(0,0,0),B.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(v)&&(B._localDirection.Yc(0,0,0),B.cameraRotation.x+=this._getLocalRotation()),B.rB().useRightHandedSystem&&(B._localDirection.z*=-1),B.getViewMatrix().invertToRef(B._cameraTransformMatrix),q.GE.TransformNormalToRef(B._localDirection,B._cameraTransformMatrix,B._transformedDirection),B.cameraDirection.addInPlace(B._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const B=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*B}}(0,z.c)([(0,o.K)()],h.prototype,"keysUp",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysUpward",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysDown",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysDownward",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysLeft",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysRight",void 0),(0,z.c)([(0,o.K)()],h.prototype,"rotationSpeed",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysRotateLeft",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysRotateRight",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysRotateUp",void 0),(0,z.c)([(0,o.K)()],h.prototype,"keysRotateDown",void 0),S.d.FreeCameraKeyboardMoveInput=h;var y=v(11202),Q=v(11646);class P{constructor(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=B,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new y.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(B){B=D.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),v=E.getInputElement();this._pointerInput||(this._pointerInput=z=>{const o=z.event,q="touch"===o.pointerType;if(!this.touchEnabled&&q)return;if(z.type!==Q.e.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const c=o.target;if(z.type===Q.e.POINTERDOWN){if(q&&-1!==this._activePointerId||!q&&-1!==this._currentActiveButton)return;this._activePointerId=o.pointerId;try{null===c||void 0===c||c.setPointerCapture(o.pointerId)}catch(S){}-1===this._currentActiveButton&&(this._currentActiveButton=o.button),this._previousPosition={x:o.clientX,y:o.clientY},B||(o.preventDefault(),v&&v.focus()),E.isPointerLock&&this._onMouseMove&&this._onMouseMove(z.event)}else if(z.type===Q.e.POINTERUP){if(q&&this._activePointerId!==o.pointerId||!q&&this._currentActiveButton!==o.button)return;try{null===c||void 0===c||c.releasePointerCapture(o.pointerId)}catch(S){}this._currentActiveButton=-1,this._previousPosition=null,B||o.preventDefault(),this._activePointerId=-1}else if(z.type===Q.e.POINTERMOVE&&(this._activePointerId===o.pointerId||!q))if(E.isPointerLock&&this._onMouseMove)this._onMouseMove(z.event);else if(this._previousPosition){const E=this.camera._calculateHandednessMultiplier(),v=(o.clientX-this._previousPosition.x)*E,z=o.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=v/this.angularSensibility,this.camera.cameraRotation.x+=z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:v,offsetY:z}),this._previousPosition={x:o.clientX,y:o.clientY},B||o.preventDefault()}}),this._onMouseMove=v=>{if(!E.isPointerLock)return;const z=this.camera._calculateHandednessMultiplier(),o=v.movementX*z;this.camera.cameraRotation.y+=o/this.angularSensibility;const q=v.movementY;this.camera.cameraRotation.x+=q/this.angularSensibility,this._previousPosition=null,B||v.preventDefault()},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._pointerInput,Q.e.POINTERDOWN|Q.e.POINTERUP|Q.e.POINTERMOVE),v&&(this._contextMenuBind=B=>this.onContextMenu(B),v.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(B){B.preventDefault()}VQ(){if(this._observer){if(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const B=this.camera.getEngine().getInputElement();B&&B.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,z.c)([(0,o.K)()],P.prototype,"buttons",void 0),(0,z.c)([(0,o.K)()],P.prototype,"angularSensibility",void 0),S.d.FreeCameraMouseInput=P;var G,Y=v(11661);class a{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new y.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(B){B=D.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==Q.e.POINTERWHEEL)return;const v=E.event,z=v.deltaMode===Y.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*z*v.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*z*v.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*z*v.deltaZ/this._normalize,v.preventDefault&&(B||v.preventDefault())},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._wheel,Q.e.POINTERWHEEL)}VQ(){this._observer&&(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,z.c)([(0,o.K)()],a.prototype,"wheelPrecisionX",void 0),(0,z.c)([(0,o.K)()],a.prototype,"wheelPrecisionY",void 0),(0,z.c)([(0,o.K)()],a.prototype,"wheelPrecisionZ",void 0),function(B){B[B.MoveRelative=0]="MoveRelative",B[B.RotateRelative=1]="RotateRelative",B[B.MoveScene=2]="MoveScene"}(G||(G={}));class m extends a{constructor(){super(...arguments),this._moveRelative=q.GE.Zero(),this._rotateRelative=q.GE.Zero(),this._moveScene=q.GE.Zero(),this._wheelXAction=G.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=G.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(B){null===B&&this._wheelXAction!==G.MoveRelative||(this._wheelXAction=G.MoveRelative,this._wheelXActionCoordinate=B)}get wheelXMoveRelative(){return this._wheelXAction!==G.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(B){null===B&&this._wheelYAction!==G.MoveRelative||(this._wheelYAction=G.MoveRelative,this._wheelYActionCoordinate=B)}get wheelYMoveRelative(){return this._wheelYAction!==G.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(B){null===B&&this._wheelZAction!==G.MoveRelative||(this._wheelZAction=G.MoveRelative,this._wheelZActionCoordinate=B)}get wheelZMoveRelative(){return this._wheelZAction!==G.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(B){null===B&&this._wheelXAction!==G.RotateRelative||(this._wheelXAction=G.RotateRelative,this._wheelXActionCoordinate=B)}get wheelXRotateRelative(){return this._wheelXAction!==G.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(B){null===B&&this._wheelYAction!==G.RotateRelative||(this._wheelYAction=G.RotateRelative,this._wheelYActionCoordinate=B)}get wheelYRotateRelative(){return this._wheelYAction!==G.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(B){null===B&&this._wheelZAction!==G.RotateRelative||(this._wheelZAction=G.RotateRelative,this._wheelZActionCoordinate=B)}get wheelZRotateRelative(){return this._wheelZAction!==G.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(B){null===B&&this._wheelXAction!==G.MoveScene||(this._wheelXAction=G.MoveScene,this._wheelXActionCoordinate=B)}get wheelXMoveScene(){return this._wheelXAction!==G.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(B){null===B&&this._wheelYAction!==G.MoveScene||(this._wheelYAction=G.MoveScene,this._wheelYActionCoordinate=B)}get wheelYMoveScene(){return this._wheelYAction!==G.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(B){null===B&&this._wheelZAction!==G.MoveScene||(this._wheelZAction=G.MoveScene,this._wheelZActionCoordinate=B)}get wheelZMoveScene(){return this._wheelZAction!==G.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.mc(0),this._rotateRelative.mc(0),this._moveScene.mc(0),this._updateCamera(),this.camera.rB().useRightHandedSystem&&(this._moveRelative.z*=-1);const B=q.Matrix.Zero();this.camera.getViewMatrix().invertToRef(B);const E=q.GE.Zero();q.GE.TransformNormalToRef(this._moveRelative,B,E),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(E),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(B,E,v){if(0===B)return;if(null===E||null===v)return;let z=null;switch(E){case G.MoveRelative:z=this._moveRelative;break;case G.RotateRelative:z=this._rotateRelative;break;case G.MoveScene:z=this._moveScene}switch(v){case 0:z.set(B,0,0);break;case 1:z.set(0,B,0);break;case 2:z.set(0,0,B)}}}(0,z.c)([(0,o.K)()],m.prototype,"wheelXMoveRelative",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelYMoveRelative",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelZMoveRelative",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelXRotateRelative",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelYRotateRelative",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelZRotateRelative",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelXMoveScene",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelYMoveScene",null),(0,z.c)([(0,o.K)()],m.prototype,"wheelZMoveScene",null),S.d.FreeCameraMouseWheelInput=m;class g{constructor(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=B,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=D.Tools.IsSafari()}attachControl(B){B=D.Tools.BackCompatCameraNoPreventDefault(arguments);let E=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=v=>{const z=v.event,o="mouse"===z.pointerType||this._isSafari&&"undefined"===typeof z.pointerType;if(this.allowMouse||!o)if(v.type===Q.e.POINTERDOWN){if(B||z.preventDefault(),this._pointerPressed.push(z.pointerId),1!==this._pointerPressed.length)return;E={x:z.clientX,y:z.clientY}}else if(v.type===Q.e.POINTERUP){B||z.preventDefault();const v=this._pointerPressed.indexOf(z.pointerId);if(-1===v)return;if(this._pointerPressed.splice(v,1),0!=v)return;E=null,this._offsetX=null,this._offsetY=null}else if(v.type===Q.e.POINTERMOVE){if(B||z.preventDefault(),!E)return;if(0!=this._pointerPressed.indexOf(z.pointerId))return;this._offsetX=z.clientX-E.x,this._offsetY=-(z.clientY-E.y)}}),this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._pointerInput,Q.e.POINTERDOWN|Q.e.POINTERUP|Q.e.POINTERMOVE),this._onLostFocus){const B=this.camera.getEngine().getInputElement();B&&B.addEventListener("blur",this._onLostFocus)}}VQ(){if(this._pointerInput){if(this._observer&&(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const B=this.camera.getEngine().getInputElement();B&&B.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const B=this.camera,E=B._calculateHandednessMultiplier();B.cameraRotation.y=E*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)B.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const E=B._computeLocalCameraSpeed(),v=new q.GE(0,0,0!==this.touchMoveSensibility?E*this._offsetY/this.touchMoveSensibility:0);q.Matrix.RotationYawPitchRollToRef(B.rotation.y,B.rotation.x,0,B._cameraRotationMatrix),B.cameraDirection.addInPlace(q.GE.TransformCoordinates(v,B._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,z.c)([(0,o.K)()],g.prototype,"touchAngularSensibility",void 0),(0,z.c)([(0,o.K)()],g.prototype,"touchMoveSensibility",void 0),S.d.FreeCameraTouchInput=g;class V extends S.g{constructor(B){super(B),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new h),this}addMouse(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new P(B),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new m,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new g),this}clear(){super.clear(),this._mouseInput=null}}var T=v(11345),N=v(11282);class X extends c.d{get angularSensibility(){const B=this.inputs.attached.mouse;return B?B.angularSensibility:0}set angularSensibility(B){const E=this.inputs.attached.mouse;E&&(E.angularSensibility=B)}get keysUp(){const B=this.inputs.attached.keyboard;return B?B.keysUp:[]}set keysUp(B){const E=this.inputs.attached.keyboard;E&&(E.keysUp=B)}get keysUpward(){const B=this.inputs.attached.keyboard;return B?B.keysUpward:[]}set keysUpward(B){const E=this.inputs.attached.keyboard;E&&(E.keysUpward=B)}get keysDown(){const B=this.inputs.attached.keyboard;return B?B.keysDown:[]}set keysDown(B){const E=this.inputs.attached.keyboard;E&&(E.keysDown=B)}get keysDownward(){const B=this.inputs.attached.keyboard;return B?B.keysDownward:[]}set keysDownward(B){const E=this.inputs.attached.keyboard;E&&(E.keysDownward=B)}get keysLeft(){const B=this.inputs.attached.keyboard;return B?B.keysLeft:[]}set keysLeft(B){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=B)}get keysRight(){const B=this.inputs.attached.keyboard;return B?B.keysRight:[]}set keysRight(B){const E=this.inputs.attached.keyboard;E&&(E.keysRight=B)}get keysRotateLeft(){const B=this.inputs.attached.keyboard;return B?B.keysRotateLeft:[]}set keysRotateLeft(B){const E=this.inputs.attached.keyboard;E&&(E.keysRotateLeft=B)}get keysRotateRight(){const B=this.inputs.attached.keyboard;return B?B.keysRotateRight:[]}set keysRotateRight(B){const E=this.inputs.attached.keyboard;E&&(E.keysRotateRight=B)}get keysRotateUp(){const B=this.inputs.attached.keyboard;return B?B.keysRotateUp:[]}set keysRotateUp(B){const E=this.inputs.attached.keyboard;E&&(E.keysRotateUp=B)}get keysRotateDown(){const B=this.inputs.attached.keyboard;return B?B.keysRotateDown:[]}set keysRotateDown(B){const E=this.inputs.attached.keyboard;E&&(E.keysRotateDown=B)}constructor(B,E,v){var z;super(B,E,v,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),z=this,this.ellipsoid=new q.GE(.5,1,.5),this.ellipsoidOffset=new q.GE(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=q.GE.Zero(),this._diffPosition=q.GE.Zero(),this._newPosition=q.GE.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z._newPosition.S(E),z._newPosition.subtractToRef(z._oldPosition,z._diffPosition),z._diffPosition.length()>N.b.CollisionsEpsilon&&(z.position.addToRef(z._diffPosition,z._deferredPositionUpdate),z._deferOnly?z._deferredUpdated=!0:z.position.S(z._deferredPositionUpdate),z.EG&&v&&z.EG(v))},this.inputs=new V(this),this.inputs.addKeyboard().addMouse()}attachControl(B,E){E=D.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(E)}VQ(){this.inputs.detachElement(),this.cameraDirection=new q.GE(0,0,0),this.cameraRotation=new q.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(B){this._collisionMask=isNaN(B)?-1:B}_collideWithWorld(B){let E;E=this.parent?q.GE.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,E.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const v=this.rB().collisionCoordinator;this._collider||(this._collider=v.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let z=B;this.applyGravity&&(z=B.add(this.rB().gravity)),v.getNewPosition(this._oldPosition,z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=q.GE.Zero(),this._transformedDirection=q.GE.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(B){this._needMoveForGravity=B}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.rB().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Cc"}}(0,z.c)([(0,o.I)()],X.prototype,"ellipsoid",void 0),(0,z.c)([(0,o.I)()],X.prototype,"ellipsoidOffset",void 0),(0,z.c)([(0,o.K)()],X.prototype,"checkCollisions",void 0),(0,z.c)([(0,o.K)()],X.prototype,"applyGravity",void 0),(0,T.f)("BABYLON.FreeCamera",X)},13604:(B,E,v)=>{"use strict";v.d(E,{d:()=>q});var z=v(11460),o=v(13607);class q{constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=v,this.Ry=[],this._maxBlockCapacity=E||64,this._selectionContent=new z.b(1024),this._creationFunc=B}update(B,E,v){o.e._CreateBlocks(B,E,v,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}th(B){for(let E=0;E<this.Mh.length;E++){this.Mh[E].addEntry(B)}}dh(B){for(let E=0;E<this.Mh.length;E++){this.Mh[E].removeEntry(B)}}select(B,E){this._selectionContent.reset();for(let v=0;v<this.Mh.length;v++){this.Mh[v].select(B,this._selectionContent,E)}return E?this._selectionContent.concat(this.Ry):this._selectionContent.concatWithNoDuplicate(this.Ry),this._selectionContent}intersects(B,E,v){this._selectionContent.reset();for(let z=0;z<this.Mh.length;z++){this.Mh[z].intersects(B,E,this._selectionContent,v)}return v?this._selectionContent.concat(this.Ry):this._selectionContent.concatWithNoDuplicate(this.Ry),this._selectionContent}intersectsRay(B){this._selectionContent.reset();for(let E=0;E<this.Mh.length;E++){this.Mh[E].intersectsRay(B,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ry),this._selectionContent}}q.CreationFuncForMeshes=(B,E)=>{const v=B.getBoundingInfo();!B.isBlocked&&v.boundingBox.intersectsMinMax(E.Uy,E.sy)&&E.entries.push(B)},q.CreationFuncForSubMeshes=(B,E)=>{B.getBoundingInfo().boundingBox.intersectsMinMax(E.Uy,E.sy)&&E.entries.push(B)}},13607:(B,E,v)=>{"use strict";v.d(E,{e:()=>q});var z=v(11380),o=v(11728);class q{constructor(B,E,v,z,o,q){this.entries=[],this.Jy=new Array,this._capacity=v,this._depth=z,this._maxDepth=o,this._creationFunc=q,this._minPoint=B,this._maxPoint=E,this.Jy.push(B.clone()),this.Jy.push(E.clone()),this.Jy.push(B.clone()),this.Jy[2].x=E.x,this.Jy.push(B.clone()),this.Jy[3].y=E.y,this.Jy.push(B.clone()),this.Jy[4].z=E.z,this.Jy.push(E.clone()),this.Jy[5].z=B.z,this.Jy.push(E.clone()),this.Jy[6].x=B.x,this.Jy.push(E.clone()),this.Jy[7].y=B.y}get Gv(){return this._capacity}get Uy(){return this._minPoint}get sy(){return this._maxPoint}addEntry(B){if(this.Mh)for(let E=0;E<this.Mh.length;E++){this.Mh[E].addEntry(B)}else this._creationFunc(B,this),this.entries.length>this.Gv&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(B){if(this.Mh){for(let E=0;E<this.Mh.length;E++){this.Mh[E].removeEntry(B)}return}const E=this.entries.indexOf(B);E>-1&&this.entries.splice(E,1)}addEntries(B){for(let E=0;E<B.length;E++){const v=B[E];this.addEntry(v)}}select(B,E,v){if(o.b.IsInFrustum(this.Jy,B)){if(this.Mh){for(let z=0;z<this.Mh.length;z++){this.Mh[z].select(B,E,v)}return}v?E.concat(this.entries):E.concatWithNoDuplicate(this.entries)}}intersects(B,E,v,z){if(o.b.IntersectsSphere(this._minPoint,this._maxPoint,B,E)){if(this.Mh){for(let o=0;o<this.Mh.length;o++){this.Mh[o].intersects(B,E,v,z)}return}z?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}}intersectsRay(B,E){if(B.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Mh){for(let v=0;v<this.Mh.length;v++){this.Mh[v].intersectsRay(B,E)}return}E.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){q._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(B,E,v,o,c,S,x,D){x.Mh=new Array;const h=new z.GE((E.x-B.x)/2,(E.y-B.y)/2,(E.z-B.z)/2);for(let z=0;z<2;z++)for(let E=0;E<2;E++)for(let y=0;y<2;y++){const Q=B.add(h.multiplyByFloats(z,E,y)),P=B.add(h.multiplyByFloats(z+1,E+1,y+1)),G=new q(Q,P,o,c+1,S,D);G.addEntries(v),x.Mh.push(G)}}}},13616:(B,E,v)=>{"use strict";v.d(E,{c:()=>h});var z=v(11601),o=v(11380),q=v(11815),c=v(12780),S=v(11643),x=v(13604),D=v(11242);z.c.prototype.createOrUpdateSelectionOctree=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,v=this._getComponent(S.b.NAME_OCTREE);v||(v=new h(this),this.o(v)),this.Hy||(this.Hy=new x.d(x.d.CreationFuncForMeshes,B,E));const z=this.getWorldExtends();return this.Hy.update(z.min,z.max,this.meshes),this.Hy},Object.defineProperty(z.c.prototype,"selectionOctree",{get:function(){return this.Hy},enumerable:!0,configurable:!0}),q.e.prototype.createOrUpdateSubmeshesOctree=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const v=this.rB();let z=v._getComponent(S.b.NAME_OCTREE);z||(z=new h(v),v.o(z)),this._submeshesOctree||(this._submeshesOctree=new x.d(x.d.CreationFuncForSubMeshes,B,E)),this.yc(!0);const o=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(o.minimumWorld,o.maximumWorld,this.qc),this._submeshesOctree};class h{constructor(B){this.name=S.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new c.d(o.GE.Zero(),new o.GE(1,1,1)),(B=B||D.b.LastCreatedScene)&&(this.aE=B,this.aE.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.aE.getActiveSubMeshCandidates=B=>this.getActiveSubMeshCandidates(B),this.aE.getCollidingSubMeshCandidates=(B,E)=>this.getCollidingSubMeshCandidates(B,E),this.aE.getIntersectingSubMeshCandidates=(B,E)=>this.getIntersectingSubMeshCandidates(B,E))}register(){this.aE.onMeshRemovedObservable.add((B=>{const E=this.aE.selectionOctree;if(void 0!==E&&null!==E){const v=E.Ry.indexOf(B);-1!==v&&E.Ry.splice(v,1)}})),this.aE.onMeshImportedObservable.add((B=>{const E=this.aE.selectionOctree;void 0!==E&&null!==E&&E.th(B)}))}getActiveMeshCandidates(){var B;return(null===(B=this.aE.Hy)||void 0===B?void 0:B.select(this.aE.frustumPlanes))||this.aE._getDefaultMeshCandidates()}getActiveSubMeshCandidates(B){if(B._submeshesOctree&&B.useOctreeForRenderingSelection){return B._submeshesOctree.select(this.aE.frustumPlanes)}return this.aE._getDefaultSubMeshCandidates(B)}getIntersectingSubMeshCandidates(B,E){if(B._submeshesOctree&&B.useOctreeForPicking){c.d.TransformToRef(E,B.getWorldMatrix(),this._tempRay);return B._submeshesOctree.intersectsRay(this._tempRay)}return this.aE._getDefaultSubMeshCandidates(B)}getCollidingSubMeshCandidates(B,E){if(B._submeshesOctree&&B.useOctreeForCollisions){const v=E._velocityWorldLength+Math.max(E._radius.x,E._radius.y,E._radius.z);return B._submeshesOctree.intersects(E._basePointWorld,v)}return this.aE._getDefaultSubMeshCandidates(B)}rebuild(){}dispose(){}}},12780:(B,E,v)=>{"use strict";v.d(E,{d:()=>P});var z=v(11601),o=v(11841),q=v(11382),c=v(11380),S=v(11385),x=v(11717),D=v(11637),h=v(11242),y=v(11665);const Q={internalPickerForMesh:void 0};class P{constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.e;this.origin=B,this.direction=E,this.length=v,this.epsilon=z}clone(){return new P(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=P._TmpVector3[0].Yc(B.x-v,B.y-v,B.z-v),o=P._TmpVector3[1].Yc(E.x+v,E.y+v,E.z+v);let q,c,S,x,D=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<z.x||this.origin.x>o.x)return!1}else if(q=1/this.direction.x,c=(z.x-this.origin.x)*q,S=(o.x-this.origin.x)*q,S===-1/0&&(S=1/0),c>S&&(x=c,c=S,S=x),D=Math.max(c,D),h=Math.min(S,h),D>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<z.y||this.origin.y>o.y)return!1}else if(q=1/this.direction.y,c=(z.y-this.origin.y)*q,S=(o.y-this.origin.y)*q,S===-1/0&&(S=1/0),c>S&&(x=c,c=S,S=x),D=Math.max(c,D),h=Math.min(S,h),D>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<z.z||this.origin.z>o.z)return!1}else if(q=1/this.direction.z,c=(z.z-this.origin.z)*q,S=(o.z-this.origin.z)*q,S===-1/0&&(S=1/0),c>S&&(x=c,c=S,S=x),D=Math.max(c,D),h=Math.min(S,h),D>h)return!1;return!0}intersectsBox(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(B.minimum,B.maximum,E)}intersectsSphere(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const v=B.center.x-this.origin.x,z=B.center.y-this.origin.y,o=B.center.z-this.origin.z,q=v*v+z*z+o*o,c=B.radius+E,S=c*c;if(q<=S)return!0;const x=v*this.direction.x+z*this.direction.y+o*this.direction.z;if(x<0)return!1;return q-x*x<=S}intersectsTriangle(B,E,v){const z=P._TmpVector3[0],o=P._TmpVector3[1],q=P._TmpVector3[2],S=P._TmpVector3[3],D=P._TmpVector3[4];E.subtractToRef(B,z),v.subtractToRef(B,o),c.GE.CrossToRef(this.direction,o,q);const h=c.GE.Dot(z,q);if(0===h)return null;const y=1/h;this.origin.subtractToRef(B,S);const Q=c.GE.Dot(S,q)*y;if(Q<-this.epsilon||Q>1+this.epsilon)return null;c.GE.CrossToRef(S,z,D);const G=c.GE.Dot(this.direction,D)*y;if(G<-this.epsilon||Q+G>1+this.epsilon)return null;const Y=c.GE.Dot(o,D)*y;return Y>this.length?null:new x.b(1-Q-G,Q,Y)}intersectsPlane(B){let E;const v=c.GE.Dot(B.normal,this.direction);if(Math.abs(v)<9.99999997475243e-7)return null;{const z=c.GE.Dot(B.normal,this.origin);return E=(-B.d-z)/v,E<0?E<-9.99999997475243e-7?null:0:E}}intersectsAxis(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(B){case"y":{const B=(this.origin.y-E)/this.direction.y;return B>0?null:new c.GE(this.origin.x+this.direction.x*-B,E,this.origin.z+this.direction.z*-B)}case"x":{const B=(this.origin.x-E)/this.direction.x;return B>0?null:new c.GE(E,this.origin.y+this.direction.y*-B,this.origin.z+this.direction.z*-B)}case"z":{const B=(this.origin.z-E)/this.direction.z;return B>0?null:new c.GE(this.origin.x+this.direction.x*-B,this.origin.y+this.direction.y*-B,E)}default:return null}}intersectsMesh(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=c.TmpVectors.Matrix[0];return B.getWorldMatrix().invertToRef(S),this._tmpRay?P.TransformToRef(this,S,this._tmpRay):this._tmpRay=P.Transform(this,S),B.intersects(this._tmpRay,E,v,z,o,q)}intersectsMeshes(B,E,v){v?v.length=0:v=[];for(let z=0;z<B.length;z++){const o=this.intersectsMesh(B[z],E);o.hit&&v.push(o)}return v.sort(this._comparePickingInfo),v}_comparePickingInfo(B,E){return B.distance<E.distance?-1:B.distance>E.distance?1:0}intersectionSegment(B,E,v){const z=this.origin,o=c.TmpVectors.GE[0],q=c.TmpVectors.GE[1],S=c.TmpVectors.GE[2],x=c.TmpVectors.GE[3];E.subtractToRef(B,o),this.direction.scaleToRef(P._Rayl,S),z.addToRef(S,q),B.subtractToRef(z,x);const D=c.GE.Dot(o,o),h=c.GE.Dot(o,S),y=c.GE.Dot(S,S),Q=c.GE.Dot(o,x),G=c.GE.Dot(S,x),Y=D*y-h*h;let a,m,g=Y,V=Y;Y<P._Smallnum?(a=0,g=1,m=G,V=y):(a=h*G-y*Q,m=D*G-h*Q,a<0?(a=0,m=G,V=y):a>g&&(a=g,m=G+h,V=y)),m<0?(m=0,-Q<0?a=0:-Q>D?a=g:(a=-Q,g=D)):m>V&&(m=V,-Q+h<0?a=0:-Q+h>D?a=g:(a=-Q+h,g=D));const T=Math.abs(a)<P._Smallnum?0:a/g,N=Math.abs(m)<P._Smallnum?0:m/V,X=c.TmpVectors.GE[4];S.scaleToRef(N,X);const r=c.TmpVectors.GE[5];o.scaleToRef(T,r),r.addInPlace(x);const i=c.TmpVectors.GE[6];r.subtractToRef(X,i);return N>0&&N<=this.length&&i.lengthSquared()<v*v?r.length():-1}update(B,E,v,z,o,q,S){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){P._RayDistant||(P._RayDistant=P.Zero()),P._RayDistant.unprojectRayToRef(B,E,v,z,c.Matrix.IdentityReadOnly,q,S);const x=c.TmpVectors.Matrix[0];o.invertToRef(x),P.TransformToRef(P._RayDistant,x,this)}else this.unprojectRayToRef(B,E,v,z,o,q,S);return this}static Zero(){return new P(c.GE.Zero(),c.GE.Zero())}static CreateNew(B,E,v,z,o,q,c){return P.Zero().update(B,E,v,z,o,q,c)}static CreateNewFromTo(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.Matrix.IdentityReadOnly;const z=new P(new c.GE(0,0,0),new c.GE(0,0,0));return P.CreateFromToToRef(B,E,z,v)}static CreateFromToToRef(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.Matrix.IdentityReadOnly;v.origin.S(B);const o=E.subtractToRef(B,v.direction),q=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return v.length=q,v.direction.normalize(),P.TransformToRef(v,z,v)}static Transform(B,E){const v=new P(new c.GE(0,0,0),new c.GE(0,0,0));return P.TransformToRef(B,E,v),v}static TransformToRef(B,E,v){c.GE.TransformCoordinatesToRef(B.origin,E,v.origin),c.GE.TransformNormalToRef(B.direction,E,v.direction),v.length=B.length,v.epsilon=B.epsilon;const z=v.direction,o=z.length();if(0!==o&&1!==o){const B=1/o;z.x*=B,z.y*=B,z.z*=B,v.length*=o}return v}unprojectRayToRef(B,E,v,z,o,q,S){const x=c.TmpVectors.Matrix[0];o.multiplyToRef(q,x),x.multiplyToRef(S,x),x.invert();const D=h.b.LastCreatedEngine,y=c.TmpVectors.GE[0];y.x=B/v*2-1,y.y=-(E/z*2-1),y.z=null!==D&&void 0!==D&&D.useReverseDepthBuffer?1:null!==D&&void 0!==D&&D.isNDCHalfZRange?0:-1;const Q=c.TmpVectors.GE[1].Yc(y.x,y.y,1-1e-8),P=c.TmpVectors.GE[2],G=c.TmpVectors.GE[3];c.GE._UnprojectFromInvertedMatrixToRef(y,x,P),c.GE._UnprojectFromInvertedMatrixToRef(Q,x,G),this.origin.S(P),G.subtractToRef(P,this.direction),this.direction.normalize()}}function G(B,E,v,z,o){let q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=P.Zero();return Y(B,E,v,z,c,o,q),c}function Y(B,E,v,z,o,q){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const D=B.getEngine();if(!q&&!(q=B.activeCamera))return B;const h=q.viewport,y=D.getRenderHeight(),{x:Q,y:P,width:G,height:Y}=h.toGlobal(D.getRenderWidth(),y),a=1/D.getHardwareScalingLevel();return E=E*a-Q,v=v*a-(y-P-Y),o.update(E,v,G,Y,z||c.Matrix.IdentityReadOnly,S?c.Matrix.IdentityReadOnly:q.getViewMatrix(),q.getProjectionMatrix(),x),B}function a(B,E,v,z,o){if(!D.b)return B;const q=B.getEngine();if(!o&&!(o=B.activeCamera))throw new Error("Active camera not set");const S=o.viewport,x=q.getRenderHeight(),{x:h,y:y,width:Q,height:P}=S.toGlobal(q.getRenderWidth(),x),G=c.Matrix.Identity(),Y=1/q.getHardwareScalingLevel();return E=E*Y-h,v=v*Y-(x-y-P),z.update(E,v,Q,P,G,G,o.getProjectionMatrix()),B}function m(B,E,v,z,o,q,c,S){const x=E(z,v.enableDistantPicking),D=v.intersects(x,o,c,q,z,S);return D&&D.hit?!o&&null!=B&&D.distance>=B.distance?null:D:null}function g(B,E,v,z,o,q){let S=null;const x=!!(B.activeCameras&&B.activeCameras.length>1&&B.cameraToUseForPointers!==B.activeCamera),h=B.cameraToUseForPointers||B.activeCamera,y=Q.internalPickerForMesh||m;for(let D=0;D<B.meshes.length;D++){const Q=B.meshes[D];if(v){if(!v(Q,-1))continue}else if(!Q.isEnabled()||!Q.isVisible||!Q.cD)continue;const P=x&&Q.isWorldMatrixCameraDependent(),G=Q.yc(P,h);if(Q.hasThinInstances&&Q.bD){const B=y(S,E,Q,G,!0,!0,q);if(B){if(o)return B;const x=c.TmpVectors.Matrix[1],D=Q.thinInstanceGetWorldMatrices();for(let B=0;B<D.length;B++){if(v&&!v(Q,B))continue;D[B].multiplyToRef(G,x);const c=y(S,E,Q,x,z,o,q,!0);if(c&&(S=c,S.thinInstanceIndex=B,z))return S}}}else{const B=y(S,E,Q,G,z,o,q);if(B&&(S=B,z))return S}}return S||new D.b}function V(B,E,v,z){if(!D.b)return null;const o=[],q=!!(B.activeCameras&&B.activeCameras.length>1&&B.cameraToUseForPointers!==B.activeCamera),S=B.cameraToUseForPointers||B.activeCamera,x=Q.internalPickerForMesh||m;for(let D=0;D<B.meshes.length;D++){const h=B.meshes[D];if(v){if(!v(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.cD)continue;const y=q&&h.isWorldMatrixCameraDependent(),Q=h.yc(y,S);if(h.hasThinInstances&&h.bD){if(x(null,E,h,Q,!0,!0,z)){const B=c.TmpVectors.Matrix[1],q=h.thinInstanceGetWorldMatrices();for(let c=0;c<q.length;c++){if(v&&!v(h,c))continue;q[c].multiplyToRef(Q,B);const S=x(null,E,h,B,!1,!1,z,!0);S&&(S.thinInstanceIndex=c,o.push(S))}}}else{const B=x(null,E,h,Q,!1,!1,z);B&&o.push(B)}}return o}function T(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,z=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;z||(z=B.getWorldMatrix()),E.length=v,o?E.origin.S(o):E.origin.S(B.position);const q=c.TmpVectors.GE[2];q.set(0,0,B._scene.useRightHandedSystem?-1:1);const S=c.TmpVectors.GE[3];return c.GE.TransformNormalToRef(q,z,S),c.GE.NormalizeToRef(S,E.direction),E}var N,X;P._TmpVector3=(0,S.b)(6,c.GE.Zero),P._RayDistant=P.Zero(),P._Smallnum=1e-8,P._Rayl=1e9,N=z.c,(X=o.c)&&(X.prototype.getForwardRay=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,E=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;return T(this,new P(c.GE.Zero(),c.GE.Zero(),B),B,E,v)},X.prototype.getForwardRayToRef=function(B){return T(this,B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),N&&(y.e._IsPickingAvailable=!0,N.prototype.createPickingRay=function(B,E,v,z){return G(this,B,E,v,z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),z.c.prototype.createPickingRayToRef=function(B,E,v,z,o){return Y(this,B,E,v,z,o,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},z.c.prototype.createPickingRayInCameraSpace=function(B,E,v){return function(B,E,v,z){const o=P.Zero();return a(B,E,v,o,z),o}(this,B,E,v)},z.c.prototype.createPickingRayInCameraSpaceToRef=function(B,E,v,z){return a(this,B,E,v,z)},z.c.prototype.pickWithBoundingInfo=function(B,E,v,z,o){return function(B,E,v,z,o,q){if(!D.b)return null;const S=g(B,(z=>(B._tempPickingRay||(B._tempPickingRay=P.Zero()),Y(B,E,v,z,B._tempPickingRay,q||null),B._tempPickingRay)),z,o,!0);return S&&(S.ray=G(B,E,v,c.Matrix.Identity(),q||null)),S}(this,B,E,v,z,o)},z.c.prototype.yv=function(B,E,v,z,o,q){return function(B,E,v,z,o,q,S){const x=g(B,((z,o)=>(B._tempPickingRay||(B._tempPickingRay=P.Zero()),Y(B,E,v,z,B._tempPickingRay,q||null,!1,o),B._tempPickingRay)),z,o,!1,S);return x&&(x.ray=G(B,E,v,c.Matrix.Identity(),q||null)),x}(this,B,E,v,z,o,q)},z.c.prototype.pickWithRay=function(B,E,v,z){return function(B,E,v,z,o){const q=g(B,(v=>(B._pickWithRayInverseMatrix||(B._pickWithRayInverseMatrix=c.Matrix.Identity()),v.invertToRef(B._pickWithRayInverseMatrix),B._cachedRayForTransform||(B._cachedRayForTransform=P.Zero()),P.TransformToRef(E,B._pickWithRayInverseMatrix,B._cachedRayForTransform),B._cachedRayForTransform)),v,z,!1,o);return q&&(q.ray=E),q}(this,B,E,v,z)},z.c.prototype.multiPick=function(B,E,v,z,o){return function(B,E,v,z,o,q){return V(B,(z=>G(B,E,v,z,o||null)),z,q)}(this,B,E,v,z,o)},z.c.prototype.multiPickWithRay=function(B,E,v){return function(B,E,v,z){return V(B,(v=>(B._pickWithRayInverseMatrix||(B._pickWithRayInverseMatrix=c.Matrix.Identity()),v.invertToRef(B._pickWithRayInverseMatrix),B._cachedRayForTransform||(B._cachedRayForTransform=P.Zero()),P.TransformToRef(E,B._pickWithRayInverseMatrix,B._cachedRayForTransform),B._cachedRayForTransform)),v,z)}(this,B,E,v)}},13069:(B,E,v)=>{"use strict";var z=v(11323),o=v(11213),q=v(11249),c=v(11351),S=v(11282),x=v(11334);S.b.prototype._partialLoadFile=function(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(B,(B=>{v[E]=B,v._internalCount++,6===v._internalCount&&z(v)}),void 0,void 0,!0,((B,E)=>{o&&B&&o(B.status+" "+B.statusText,E)}))},S.b.prototype._cascadeLoadFiles=function(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=[];o._internalCount=0;for(let q=0;q<6;q++)this._partialLoadFile(v[q],q,o,E,z)},S.b.prototype._cascadeLoadImgs=function(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5?arguments[5]:void 0;const c=[];c._internalCount=0;for(let S=0;S<6;S++)this._partialLoadImg(z[S],S,c,B,E,v,o,q)},S.b.prototype._partialLoadImg=function(B,E,v,z,o,S){let x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7?arguments[7]:void 0;const h=(0,c.c)();(0,q.t)(B,(B=>{v[E]=B,v._internalCount++,z&&z.removePendingData(h),6===v._internalCount&&S&&S(o,v)}),((B,E)=>{z&&z.removePendingData(h),x&&x(B,E)}),z?z.offlineProvider:null,D),z&&z.addPendingData(h)},S.b.prototype.createCubeTextureBase=function(B,E,v,q){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,P=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,a=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,m=arguments.length>14&&void 0!==arguments[14]&&arguments[14],g=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const V=G||new z.b(this,7);V.isCube=!0,V.url=B,V.generateMipMaps=!q,V._lodGenerationScale=Q,V._lodGenerationOffset=P,V._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!q),V!==G&&(V.label=B.substring(0,60)),this._doNotHandleContextLost||(V._extension=h,V._files=v,V._buffer=g);const T=B;this._transformTextureUrl&&!G&&(B=this._transformTextureUrl(B));const N=h??function(B){const E=B.split("?")[0],v=E.lastIndexOf(".");return v>-1?E.substring(v).toLowerCase():""}(B),X=(0,x.e)(N),r=(B,E)=>{V.dispose(),S?S(B,E):B&&o.c.Warn(B)},i=(z,S)=>{B===T?z&&r(z.status+" "+z.statusText,S):(o.c.Warn(`Failed to load ${B}, falling back to the ${T}`),this.createCubeTextureBase(T,E,v,!!q,c,r,D,h,y,Q,P,V,Y,a,m,g))};if(X)X.then((z=>{const o=B=>{Y&&Y(V,B),z.loadCubeData(B,V,y,c,((B,E)=>{r(B,E)}))};g?o(g):v&&6===v.length?z.supportCascades?this._cascadeLoadFiles(E,(B=>o(B.map((B=>new Uint8Array(B))))),v,r):r("Textures type does not support cascades."):this._loadFile(B,(B=>o(new Uint8Array(B))),void 0,void 0,!0,i)}));else{if(!v||0===v.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(E,V,((B,E)=>{a&&a(B,E)}),v,r)}return this._internalTexturesCache.push(V),V}},13618:(B,E,v)=>{"use strict";v(11213);var z=v(11492);v(11323),v(11445),v(11314),v(11539),v(11497);z.c},13099:(B,E,v)=>{"use strict";v.d(E,{d:()=>o});var z=v(11345);class o{constructor(B){this.value=this._toInt(B)}_toInt(B){return 0|B}add(B){return new o(this.value+B.value)}YE(B){return new o(this.value-B.value)}multiply(B){return new o(Math.imul(this.value,B.value))}divide(B){return new o(this.value/B.value)}getClassName(){return o.ClassName}equals(B){return this.value===B.value}static FromValue(B){return new o(B)}toString(){return this.value.toString()}}o.ClassName="FlowGraphInteger",(0,z.f)("FlowGraphInteger",o)},13111:(B,E,v)=>{"use strict";v.d(E,{c:()=>o,g:()=>q});var z=v(11380);class o{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Bc=B}get m(){return this.Bc}transformVector(B){return this.transformVectorToRef(B,new z.Vector2)}transformVectorToRef(B,E){return E.x=B.x*this.Bc[0]+B.y*this.Bc[1],E.y=B.x*this.Bc[2]+B.y*this.Bc[3],E}cc(){return this.toArray()}toArray(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<4;E++)B[E]=this.Bc[E];return B}Qv(B){for(let E=0;E<4;E++)this.Bc[E]=B[E];return this}multiplyToRef(B,E){const v=B.Bc,z=this.Bc,o=E.Bc;return o[0]=v[0]*z[0]+v[1]*z[2],o[1]=v[0]*z[1]+v[1]*z[3],o[2]=v[2]*z[0]+v[3]*z[2],o[3]=v[2]*z[1]+v[3]*z[3],E}multiply(B){return this.multiplyToRef(B,new o)}divideToRef(B,E){const v=this.Bc,z=B.Bc,o=E.Bc;return o[0]=v[0]/z[0],o[1]=v[1]/z[1],o[2]=v[2]/z[2],o[3]=v[3]/z[3],E}divide(B){return this.divideToRef(B,new o)}addToRef(B,E){const v=this.Bc,z=B.m,o=E.m;return o[0]=v[0]+z[0],o[1]=v[1]+z[1],o[2]=v[2]+z[2],o[3]=v[3]+z[3],E}add(B){return this.addToRef(B,new o)}subtractToRef(B,E){const v=this.Bc,z=B.m,o=E.m;return o[0]=v[0]-z[0],o[1]=v[1]-z[1],o[2]=v[2]-z[2],o[3]=v[3]-z[3],E}YE(B){return this.subtractToRef(B,new o)}transpose(){const B=this.Bc;return new o([B[0],B[2],B[1],B[3]])}determinant(){const B=this.Bc;return B[0]*B[3]-B[1]*B[2]}inverse(){const B=this.determinant();if(0===B)throw new Error("Matrix is not invertible");const E=this.Bc,v=1/B;return new o([E[3]*v,-E[1]*v,-E[2]*v,E[0]*v])}equals(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const v=this.Bc,z=B.m;return 0===E?v[0]===z[0]&&v[1]===z[1]&&v[2]===z[2]&&v[3]===z[3]:Math.abs(v[0]-z[0])<E&&Math.abs(v[1]-z[1])<E&&Math.abs(v[2]-z[2])<E&&Math.abs(v[3]-z[3])<E}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Bc.join(", ")})`}}class q{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Bc=B}get m(){return this.Bc}transformVector(B){return this.transformVectorToRef(B,new z.GE)}transformVectorToRef(B,E){const v=this.Bc;return E.x=B.x*v[0]+B.y*v[1]+B.z*v[2],E.y=B.x*v[3]+B.y*v[4]+B.z*v[5],E.z=B.x*v[6]+B.y*v[7]+B.z*v[8],E}multiplyToRef(B,E){const v=B.Bc,z=this.Bc,o=E.m;return o[0]=v[0]*z[0]+v[1]*z[3]+v[2]*z[6],o[1]=v[0]*z[1]+v[1]*z[4]+v[2]*z[7],o[2]=v[0]*z[2]+v[1]*z[5]+v[2]*z[8],o[3]=v[3]*z[0]+v[4]*z[3]+v[5]*z[6],o[4]=v[3]*z[1]+v[4]*z[4]+v[5]*z[7],o[5]=v[3]*z[2]+v[4]*z[5]+v[5]*z[8],o[6]=v[6]*z[0]+v[7]*z[3]+v[8]*z[6],o[7]=v[6]*z[1]+v[7]*z[4]+v[8]*z[7],o[8]=v[6]*z[2]+v[7]*z[5]+v[8]*z[8],E}multiply(B){return this.multiplyToRef(B,new q)}divideToRef(B,E){const v=this.Bc,z=B.m,o=E.m;return o[0]=v[0]/z[0],o[1]=v[1]/z[1],o[2]=v[2]/z[2],o[3]=v[3]/z[3],o[4]=v[4]/z[4],o[5]=v[5]/z[5],o[6]=v[6]/z[6],o[7]=v[7]/z[7],o[8]=v[8]/z[8],E}divide(B){return this.divideToRef(B,new q)}addToRef(B,E){const v=this.Bc,z=B.m,o=E.m;return o[0]=v[0]+z[0],o[1]=v[1]+z[1],o[2]=v[2]+z[2],o[3]=v[3]+z[3],o[4]=v[4]+z[4],o[5]=v[5]+z[5],o[6]=v[6]+z[6],o[7]=v[7]+z[7],o[8]=v[8]+z[8],E}add(B){return this.addToRef(B,new q)}subtractToRef(B,E){const v=this.Bc,z=B.m,o=E.m;return o[0]=v[0]-z[0],o[1]=v[1]-z[1],o[2]=v[2]-z[2],o[3]=v[3]-z[3],o[4]=v[4]-z[4],o[5]=v[5]-z[5],o[6]=v[6]-z[6],o[7]=v[7]-z[7],o[8]=v[8]-z[8],E}YE(B){return this.subtractToRef(B,new q)}toArray(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<9;E++)B[E]=this.Bc[E];return B}cc(){return this.toArray()}Qv(B){for(let E=0;E<9;E++)this.Bc[E]=B[E];return this}transpose(){const B=this.Bc;return new q([B[0],B[3],B[6],B[1],B[4],B[7],B[2],B[5],B[8]])}determinant(){const B=this.Bc;return B[0]*(B[4]*B[8]-B[5]*B[7])-B[1]*(B[3]*B[8]-B[5]*B[6])+B[2]*(B[3]*B[7]-B[4]*B[6])}inverse(){const B=this.determinant();if(0===B)throw new Error("Matrix is not invertible");const E=this.Bc,v=1/B;return new q([(E[4]*E[8]-E[5]*E[7])*v,(E[2]*E[7]-E[1]*E[8])*v,(E[1]*E[5]-E[2]*E[4])*v,(E[5]*E[6]-E[3]*E[8])*v,(E[0]*E[8]-E[2]*E[6])*v,(E[2]*E[3]-E[0]*E[5])*v,(E[3]*E[7]-E[4]*E[6])*v,(E[1]*E[6]-E[0]*E[7])*v,(E[0]*E[4]-E[1]*E[3])*v])}equals(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const v=this.Bc,z=B.m;return 0===E?v[0]===z[0]&&v[1]===z[1]&&v[2]===z[2]&&v[3]===z[3]&&v[4]===z[4]&&v[5]===z[5]&&v[6]===z[6]&&v[7]===z[7]&&v[8]===z[8]:Math.abs(v[0]-z[0])<E&&Math.abs(v[1]-z[1])<E&&Math.abs(v[2]-z[2])<E&&Math.abs(v[3]-z[3])<E&&Math.abs(v[4]-z[4])<E&&Math.abs(v[5]-z[5])<E&&Math.abs(v[6]-z[6])<E&&Math.abs(v[7]-z[7])<E&&Math.abs(v[8]-z[8])<E}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Bc.join(", ")})`}}},13114:(B,E,v)=>{"use strict";var z;function o(B,E,v,z){switch(E){case"Animation":return z?B.animations.find((B=>B.uniqueId===v))??null:B.animations[v]??null;case"AnimationGroup":return z?B.animationGroups.find((B=>B.uniqueId===v))??null:B.animationGroups[v]??null;case"Mesh":return z?B.meshes.find((B=>B.uniqueId===v))??null:B.meshes[v]??null;case"Material":return z?B.materials.find((B=>B.uniqueId===v))??null:B.materials[v]??null;case"Jh":return z?B.cameras.find((B=>B.uniqueId===v))??null:B.cameras[v]??null;case"Light":return z?B.lights.find((B=>B.uniqueId===v))??null:B.lights[v]??null;default:return null}}v.d(E,{b:()=>o}),function(B){B.Animation="Animation",B.AnimationGroup="AnimationGroup",B.Mesh="Mesh",B.Material="Material",B.Jh="Jh",B.Light="Light"}(z||(z={}))},13137:(B,E,v)=>{"use strict";v.d(E,{c:()=>o});var z=v(13142);class o extends z.d{constructor(B,E){if(super(B),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),E)for(const v of E)this._eventsSignalOutputs[v]=this._registerSignalOutput(v+"Event")}_executeOnTick(B){}_startPendingTasks(B){B._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(B),this._resetAfterCanceled(B)),this._preparePendingTasks(B),B._addPendingBlock(this),this.out._activateSignal(B),B._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(B){B._deleteExecutionVariable(this,"_initialized"),B._removePendingBlock(this)}}},13121:(B,E,v)=>{"use strict";v.d(E,{c:()=>D});var z=v(11351),o=v(11345),q=v(13128),c=v(11202),S=v(13090);class x extends q.d{constructor(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:z.defaultValue,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(B,E,v),this.richType=z,this._defaultValue=o,this._optional=q,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new c.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(B){this._isDisabled!==B&&(this._isDisabled=B,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(B,E){E._getConnectionValue(this)!==B&&(E._setConnectionValue(this,B),this.onValueChangedObservable.notifyObservers(B))}resetToDefaultValue(B){B._setConnectionValue(this,this._defaultValue)}connectTo(B){this._isDisabled||super.connectTo(B)}_getValueOrDefault(B){const E=B._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(E):E}getValue(B){if(1===this.connectionType){B._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(B);const E=this._getValueOrDefault(B);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}const E=this.isConnected()?this._connectedPoint[0].getValue(B):this._getValueOrDefault(B);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(B),B.richType={},this.richType.serialize(B.richType),B.optional=this._optional,(0,S.e)("defaultValue",this._defaultValue,B)}}(0,o.f)("FlowGraphDataConnection",x);class D{constructor(B){var E;this.config=B,this.uniqueId=(0,z.c)(),this.name=(null===(E=this.config)||void 0===E?void 0:E.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(B){}registerDataInput(B,E,v){const z=new x(B,0,this,E,v);return this.dataInputs.push(z),z}registerDataOutput(B,E,v){const z=new x(B,1,this,E,v);return this.dataOutputs.push(z),z}getDataInput(B){return this.dataInputs.find((E=>E.name===B))}getDataOutput(B){return this.dataOutputs.find((E=>E.name===B))}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.e;if(B.uniqueId=this.uniqueId,B.config={},this.config){const v=this.config,z=Object.keys(v);for(const o of z)E(o,v[o],B.config)}B.dataInputs=[],B.dataOutputs=[],B.className=this.getClassName();for(const v of this.dataInputs){const E={};v.serialize(E),B.dataInputs.push(E)}for(const v of this.dataOutputs){const E={};v.serialize(E),B.dataOutputs.push(E)}}deserialize(B){}_log(B,E,v){var z;null===(z=B.logger)||void 0===z||z.addLogItem({action:E,Pv:v,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13128:(B,E,v)=>{"use strict";v.d(E,{d:()=>q});var z,o=v(11351);!function(B){B[B.Input=0]="Input",B[B.Output=1]="Output"}(z||(z={}));class q{constructor(B,E,v){this._ownerBlock=v,this._connectedPoint=[],this.uniqueId=(0,o.c)(),this.connectedPointIds=[],this.name=B,this._connectionType=E}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(B){if(this._connectionType===B._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||B._isSingularConnection()&&B._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(B),B._connectedPoint.push(this)}disconnectFrom(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const v=this._connectedPoint.indexOf(B),z=B._connectedPoint.indexOf(this);-1!==v&&-1!==z&&(E&&this._connectedPoint.splice(v,1),B._connectedPoint.splice(z,1))}disconnectFromAll(){for(const B of this._connectedPoint)this.disconnectFrom(B,!1);this._connectedPoint.length=0}dispose(){for(const B of this._connectedPoint)this.disconnectFrom(B)}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B.uniqueId=this.uniqueId,B.name=this.name,B._connectionType=this._connectionType,B.connectedPointIds=[],B.className=this.getClassName();for(const E of this._connectedPoint)B.connectedPointIds.push(E.uniqueId)}getClassName(){return"FGConnection"}deserialize(B){this.uniqueId=B.uniqueId,this.name=B.name,this._connectionType=B._connectionType,this.connectedPointIds=B.connectedPointIds}}},13083:(B,E,v)=>{"use strict";v.d(E,{b:()=>V});var z,o=v(11202),q=v(11366),c=v(11372),S=v(11351),x=v(13090),D=v(13114),h=v(11213);!function(B){B.ExecuteBlock="ExecuteBlock",B.ExecuteEvent="ExecuteEvent",B.TriggerConnection="TriggerConnection",B.ContextVariableSet="ContextVariableSet",B.GlobalVariableSet="GlobalVariableSet",B.GlobalVariableDelete="GlobalVariableDelete",B.GlobalVariableGet="GlobalVariableGet",B.AddConnection="AddConnection",B.GetConnectionValue="GetConnectionValue",B.SetConnectionValue="SetConnectionValue",B.ActivateSignal="ActivateSignal",B.ContextVariableGet="ContextVariableGet"}(z||(z={}));class y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(B){if(B.time||(B.time=Date.now()),this.log.push(B),this.logToConsole){var E;const v=null===(E=B.Pv)||void 0===E?void 0:E.value;"object"===typeof v&&v.getClassName?h.c.Log(`[FGLog] ${B.className}:${B.uniqueId.split("-")[0]} ${B.action} - ${JSON.stringify(v.getClassName())}: ${v.toString()}`):h.c.Log(`[FGLog] ${B.className}:${B.uniqueId.split("-")[0]} ${B.action} - ${JSON.stringify(B.Pv)}`)}}getItemsOfType(B){return this.log.filter((E=>E.action===B))}}class Q{get enableLogging(){return this._enableLogging}set enableLogging(B){this._enableLogging!==B&&(this._enableLogging=B,this._enableLogging?(this.logger=new y,this.logger.logToConsole=!0):this.logger=null)}constructor(B){this.uniqueId=(0,S.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new o.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=B,this.assetsContext=B.assetsContext??B.aE}hasVariable(B){return B in this._userVariables}setVariable(B,E){var v;this._userVariables[B]=E,null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Pv:{name:B,value:E}})}getAsset(B,E){return(0,D.b)(this.assetsContext,B,E)}getVariable(B){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Pv:{name:B,value:this._userVariables[B]}}),this._userVariables[B]}get userVariables(){return this._userVariables}rB(){return this._configuration.aE}_getUniqueIdPrefixedName(B,E){return`${B.uniqueId}_${E}`}_getGlobalContextVariable(B,E){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Pv:{name:B,defaultValue:E,possibleValue:this._globalContextVariables[B]}}),this._hasGlobalContextVariable(B)?this._globalContextVariables[B]:E}_setGlobalContextVariable(B,E){var v;null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Pv:{name:B,value:E}}),this._globalContextVariables[B]=E}_deleteGlobalContextVariable(B){var E;null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Pv:{name:B}}),delete this._globalContextVariables[B]}_hasGlobalContextVariable(B){return B in this._globalContextVariables}_setExecutionVariable(B,E,v){this._executionVariables[this._getUniqueIdPrefixedName(B,E)]=v}_getExecutionVariable(B,E,v){return this._hasExecutionVariable(B,E)?this._executionVariables[this._getUniqueIdPrefixedName(B,E)]:v}_deleteExecutionVariable(B,E){delete this._executionVariables[this._getUniqueIdPrefixedName(B,E)]}_hasExecutionVariable(B,E){return this._getUniqueIdPrefixedName(B,E)in this._executionVariables}_hasConnectionValue(B){return B.uniqueId in this._connectionValues}_setConnectionValue(B,E){var v;this._connectionValues[B.uniqueId]=E,null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Pv:{connectionPointId:B.uniqueId,value:E}})}_setConnectionValueByKey(B,E){this._connectionValues[B]=E}_getConnectionValue(B){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Pv:{connectionPointId:B.uniqueId,value:this._connectionValues[B.uniqueId]}}),this._connectionValues[B.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(B){this._pendingBlocks.includes(B)||(this._pendingBlocks.push(B),this._pendingBlocks.sort(((B,E)=>B.priority-E.priority)))}_removePendingBlock(B){const E=this._pendingBlocks.indexOf(B);-1!==E&&this._pendingBlocks.splice(E,1)}_clearPendingBlocks(){for(const B of this._pendingBlocks)B._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(B){var E;this.onNodeExecutedObservable.notifyObservers(B),null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:B.getClassName(),uniqueId:B.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(B){this._setGlobalContextVariable("timeSinceStart",B.timeSinceStart),this._setGlobalContextVariable("deltaTime",B.deltaTime);for(const v of this._pendingBlocks){var E;null===(E=v._executeOnTick)||void 0===E||E.call(v,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.e;B.uniqueId=this.uniqueId,B._userVariables={};for(const z in this._userVariables)E(z,this._userVariables[z],B._userVariables);B._connectionValues={};for(const z in this._connectionValues)E(z,this._connectionValues[z],B._connectionValues);var v;this.assetsContext!==this.rB()&&(B._assetsContext={meshes:this.assetsContext.meshes.map((B=>B.id)),materials:this.assetsContext.materials.map((B=>B.id)),textures:this.assetsContext.textures.map((B=>B.name)),animations:this.assetsContext.animations.map((B=>B.name)),lights:this.assetsContext.lights.map((B=>B.id)),cameras:this.assetsContext.cameras.map((B=>B.id)),VP:null===(v=this.assetsContext.VP)||void 0===v?void 0:v.map((B=>B.name)),skeletons:this.assetsContext.skeletons.map((B=>B.id)),bQ:this.assetsContext.bQ.map((B=>B.name)),geometries:this.assetsContext.geometries.map((B=>B.id)),multiMaterials:this.assetsContext.multiMaterials.map((B=>B.id)),transformNodes:this.assetsContext.transformNodes.map((B=>B.id))})}getClassName(){return"FlowGraphContext"}}(0,q.c)([(0,c.K)()],Q.prototype,"uniqueId",void 0);var P=v(13116),G=v(11646);class Y{constructor(B){this.onEventTriggeredObservable=new o.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=B,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.eq.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const B=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Pv:{timeSinceStart:this._startingTime,deltaTime:B}}),this._startingTime+=B})),this._meshPickedObserver=this._scene.onPointerObservable.add((B=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Pv:B})}),G.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((B=>{const E=B.pointerId,v=B.mesh,z=this._pointerUnderMeshState[E];!z&&v?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Pv:{pointerId:E,mesh:v}}):z&&!v?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Pv:{pointerId:E,mesh:z}}):z&&v&&z!==v&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Pv:{pointerId:E,mesh:z,over:v}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Pv:{pointerId:E,mesh:v,out:z}})),this._pointerUnderMeshState[E]=v}),G.e.POINTERMOVE)}dispose(){var B,E,v,z,o;null===(B=this._sceneDisposeObserver)||void 0===B||B.remove(),null===(E=this._sceneReadyObserver)||void 0===E||E.remove(),null===(v=this._sceneOnBeforeRenderObserver)||void 0===v||v.remove(),null===(z=this._meshPickedObserver)||void 0===z||z.remove(),null===(o=this._meshUnderPointerObserver)||void 0===o||o.remove(),this.onEventTriggeredObservable.clear()}}var a,m=v(13133);!function(B){B[B.Stopped=0]="Stopped",B[B.Started=1]="Started"}(a||(a={}));class g{get state(){return this._state}set state(B){this._state=B,this.onStateChangedObservable.notifyObservers(B)}constructor(B){this.onStateChangedObservable=new o.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=B.aE,this._sceneEventCoordinator=new Y(this._scene),this._coordinator=B.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((B=>{for(const E of this._executionContexts){const v=this._getContextualOrder(B.type,E);for(const z of v)if(!z._executeEvent(E,B.Pv))break}switch(B.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const E of this._executionContexts)E._notifyOnTick(B.Pv);break;case"SceneDispose":this.dispose()}}))}createContext(){const B=new Q({aE:this._scene,coordinator:this._coordinator});return this._executionContexts.push(B),B}getContext(B){return this._executionContexts[B]}addEventBlock(B){if("PointerOver"!==B.type&&"PointerOut"!==B.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==B.type&&this._eventBlocks[B.type].push(B),1===this.state)for(const E of this._executionContexts)B._startPendingTasks(E);else this.onStateChangedObservable.addOnce((E=>{if(1===E)for(const v of this._executionContexts)B._startPendingTasks(v)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((B=>{1===B&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const B of this._executionContexts)for(const E in this._eventBlocks){const v=this._getContextualOrder(E,B);for(const E of v)E._startPendingTasks(B)}}_getContextualOrder(B,E){const v=this._eventBlocks[B].sort(((B,E)=>E.initPriority-B.initPriority));if("MeshPick"===B){const B=[];for(const z of v){const o=z.asset.getValue(E);let q=0;for(;q<v.length;q++){const B=v[q].asset.getValue(E);if(o&&B&&(0,m.o)(o,B))break}B.splice(q,0,z)}return B}return v}dispose(){var B;if(0!==this.state){this.state=0;for(const B of this._executionContexts)B._clearPendingBlocks();this._executionContexts.length=0;for(const B in this._eventBlocks)this._eventBlocks[B].length=0;null===(B=this._eventObserver)||void 0===B||B.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(B){const E=[],v=new Set;for(const z in this._eventBlocks)for(const B of this._eventBlocks[z])E.push(B),v.add(B.uniqueId);for(;E.length>0;){const z=E.pop();B(z);for(const B of z.dataInputs)for(const z of B._connectedPoint)v.has(z._ownerBlock.uniqueId)||(E.push(z._ownerBlock),v.add(z._ownerBlock.uniqueId));if(z instanceof P.e)for(const B of z.signalOutputs)for(const z of B._connectedPoint)v.has(z._ownerBlock.uniqueId)||(E.push(z._ownerBlock),v.add(z._ownerBlock.uniqueId))}}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;B.allBlocks=[],this.visitAllBlocks((E=>{const v={};E.serialize(v),B.allBlocks.push(v)})),B.executionContexts=[];for(const v of this._executionContexts){const z={};v.serialize(z,E),B.executionContexts.push(z)}}}class V{constructor(B){this.config=B,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.aE.eq.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.aE.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const B=this._executeOnNextFrame.slice(0);if(B.length)for(const E of B){this.notifyCustomEvent(E.id,E.data,!1);const B=this._executeOnNextFrame.findIndex((B=>B.uniqueId===E.uniqueId));-1!==B&&this._executeOnNextFrame.splice(B,1)}}));(V.SceneCoordinators.get(this.config.aE)??[]).push(this)}createGraph(){const B=new g({aE:this.config.aE,coordinator:this});return this._flowGraphs.push(B),B}removeGraph(B){const E=this._flowGraphs.indexOf(B);-1!==E&&(B.dispose(),this._flowGraphs.splice(E,1))}start(){for(const B of this._flowGraphs)B.start()}dispose(){var B,E;for(const o of this._flowGraphs)o.dispose();this._flowGraphs.length=0,null===(B=this._disposeObserver)||void 0===B||B.remove(),null===(E=this._onBeforeRenderObserver)||void 0===E||E.remove();const v=V.SceneCoordinators.get(this.config.aE)??[],z=v.indexOf(this);-1!==z&&v.splice(z,1)}serialize(B,E){B._flowGraphs=[];for(const v of this._flowGraphs){const z={};v.serialize(z,E),B._flowGraphs.push(z)}B.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(B){let E=this._customEventsMap.get(B);return E||(E=new o.e,this._customEventsMap.set(B,E)),E}notifyCustomEvent(B,E){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:B,data:E,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(B)){const E=this._eventExecutionCounter.get(B);if(this._eventExecutionCounter.set(B,E+1),E>=V.MaxEventTypeExecutionPerFrame)return void(E===V.MaxEventTypeExecutionPerFrame&&h.c.Warn(`FlowGraphCoordinator: Too many executions of event "${B}".`))}else this._eventExecutionCounter.set(B,1);const v=this._customEventsMap.get(B);v&&v.notifyObservers(E)}}V.MaxEventsPerType=30,V.MaxEventTypeExecutionPerFrame=30,V.SceneCoordinators=new Map},13135:(B,E,v)=>{"use strict";v.d(E,{b:()=>o});var z=v(13137);class o extends z.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(B){B._notifyExecuteNode(this),this.done._activateSignal(B)}}},13116:(B,E,v)=>{"use strict";v.d(E,{e:()=>S});var z=v(13121),o=v(13128),q=v(11345);class c extends o.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(B){super.connectTo(B),this._connectedPoint.sort(((B,E)=>E.priority-B.priority))}_activateSignal(B){var E;if(null===(E=B.logger)||void 0===E||E.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Pv:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)B._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(B,this),B._increaseExecutionId();else for(const v of this._connectedPoint)v._activateSignal(B)}}(0,q.f)("FlowGraphSignalConnection",c);class S extends z.c{constructor(B){super(B),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(B){const E=new c(B,0,this);return this.signalInputs.push(E),E}_registerSignalOutput(B){const E=new c(B,1,this);return this.signalOutputs.push(E),E}_unregisterSignalInput(B){const E=this.signalInputs.findIndex((E=>E.name===B));-1!==E&&(this.signalInputs[E].dispose(),this.signalInputs.splice(E,1))}_unregisterSignalOutput(B){const E=this.signalOutputs.findIndex((E=>E.name===B));-1!==E&&(this.signalOutputs[E].dispose(),this.signalOutputs.splice(E,1))}_reportError(B,E){this.error.Pv="string"===typeof E?new Error(E):E,this.error._activateSignal(B)}getSignalInput(B){return this.signalInputs.find((E=>E.name===B))}getSignalOutput(B){return this.signalOutputs.find((E=>E.name===B))}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(B),B.signalInputs=[],B.signalOutputs=[];for(const E of this.signalInputs){const v={};E.serialize(v),B.signalInputs.push(v)}for(const E of this.signalOutputs){const v={};E.serialize(v),B.signalOutputs.push(v)}}deserialize(B){for(let E=0;E<B.signalInputs.length;E++){const v=this.getSignalInput(B.signalInputs[E].name);if(!v)throw new Error("Could not find signal input with name "+B.signalInputs[E].name+" in block "+B.className);v.deserialize(B.signalInputs[E])}for(let E=0;E<B.signalOutputs.length;E++){const v=this.getSignalOutput(B.signalOutputs[E].name);if(!v)throw new Error("Could not find signal output with name "+B.signalOutputs[E].name+" in block "+B.className);v.deserialize(B.signalOutputs[E])}}getClassName(){return"FlowGraphExecutionBlock"}}},13142:(B,E,v)=>{"use strict";v.d(E,{d:()=>o});var z=v(13116);class o extends z.e{constructor(B){super(B),this.out=this._registerSignalOutput("out")}}},13102:(B,E,v)=>{"use strict";v.d(E,{C:()=>P,G:()=>G,J:()=>Y,K:()=>u,M:()=>I,Q:()=>i,U:()=>r,c:()=>D,f:()=>Q,g:()=>X,k:()=>a,o:()=>m,r:()=>g,v:()=>y,y:()=>N,z:()=>h});var z,o=v(11380),q=v(11417),c=v(13099),S=v(13111);!function(B){B.Any="any",B.String="string",B.Number="number",B.Boolean="boolean",B.Object="object",B.Integer="FlowGraphInteger",B.Vector2="Vector2",B.GE="GE",B.Vector4="Vector4",B.Quaternion="Quaternion",B.Matrix="Matrix",B.Matrix2D="Matrix2D",B.Matrix3D="Matrix3D",B.gE="gE",B.gc="gc"}(z||(z={}));class x{constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=B,this.defaultValue=E,this.animationType=v}serialize(B){B.typeName=this.typeName,B.defaultValue=this.defaultValue}}const D=new x("any",void 0),h=new x("string",""),y=new x("number",0,0),Q=new x("boolean",!1),P=new x("Vector2",o.Vector2.Zero(),5),G=new x("GE",o.GE.Zero(),1),Y=new x("Vector4",o.Vector4.Zero()),a=new x("Matrix",o.Matrix.Identity(),3),m=new x("Matrix2D",new S.c),g=new x("Matrix3D",new S.g),V=new x("gE",q.gE.Black(),4),T=new x("gc",new q.gc(0,0,0,0),7),N=new x("Quaternion",o.Quaternion.Identity(),2);N.typeTransformer=B=>{if(B.getClassName){if("Vector4"===B.getClassName())return o.Quaternion.VE(B.cc());if("GE"===B.getClassName())return o.Quaternion.FromEulerVector(B);if("Matrix"===B.getClassName())return o.Quaternion.FromRotationMatrix(B)}return B};const X=new x("FlowGraphInteger",new c.d(0),0);function r(B){const E=B;switch(typeof B){case"string":return h;case"number":return y;case"boolean":return Q;case"object":if(E.getClassName)switch(E.getClassName()){case"Vector2":return P;case"GE":return G;case"Vector4":return Y;case"Matrix":return a;case"gE":return V;case"gc":return T;case"Quaternion":return N;case"FlowGraphInteger":return X;case"Matrix2D":return m;case"Matrix3D":return g}return D;default:return D}}function i(B){switch(B){case"string":return h;case"number":return y;case"boolean":return Q;case"Vector2":return P;case"GE":return G;case"Vector4":return Y;case"Matrix":return a;case"gE":return V;case"gc":return T;case"Quaternion":return N;case"FlowGraphInteger":return X;case"Matrix2D":return m;case"Matrix3D":return g;default:return D}}function u(B){switch(B){case"number":default:return 0;case"Vector2":return 5;case"GE":return 1;case"Matrix":return 3;case"gE":return 4;case"gc":return 7;case"Quaternion":return 2}}function I(B){switch(B){case 0:return y;case 5:return P;case 1:return G;case 3:return a;case 4:return V;case 7:return T;case 2:return N;default:return D}}},13090:(B,E,v)=>{"use strict";v.d(E,{c:()=>h,e:()=>D,h:()=>y});var z=v(11417),o=v(11380),q=v(13099),c=v(13102),S=v(13111);function x(B){return"Vector2"===B||"GE"===B||"Vector4"===B||"Quaternion"===B||"gE"===B||"gc"===B}function D(B,E,v){var z;const o=(null===E||void 0===E||null===(z=E.getClassName)||void 0===z?void 0:z.call(E))??"";if(x(o)||function(B){return"Matrix"===B||"Matrix2D"===B||"Matrix3D"===B}(o))v[B]={value:E.cc(),className:o};else if("FlowGraphInteger"===o)v[B]={value:E.value,className:o};else if(o&&(E.id||E.name))v[B]={id:E.id,name:E.name,className:o};else{if("object"===typeof E)throw new Error(`Could not serialize value ${E}`);v[B]=E}}function h(B,E,v,D){const y=E[B];let Q;const P=(null===y||void 0===y?void 0:y.type)??(null===y||void 0===y?void 0:y.className);if(function(B){return"Mesh"===B||"AbstractMesh"===B||"GroundMesh"===B||"InstanceMesh"===B||"LinesMesh"===B||"GoldbergMesh"===B||"GreasedLineMesh"===B||"TrailMesh"===B}(P)){let B=D.meshes.filter((B=>y.id?B.id===y.id:B.name===y.name));0===B.length&&(B=D.transformNodes.filter((B=>y.id?B.id===y.id:B.name===y.name))),Q=y.uniqueId?B.find((B=>B.uniqueId===y.uniqueId)):B[0]}else if(x(P))Q=function(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===B)return o.Vector2.VE(E);if("GE"===B)return v&&(E[2]*=-1),o.GE.VE(E);if("Vector4"===B)return o.Vector4.VE(E);if("Quaternion"===B)return v&&(E[2]*=-1,E[3]*=-1),o.Quaternion.VE(E);if("gE"===B)return new z.gE(E[0],E[1],E[2]);if("gc"===B)return new z.gc(E[0],E[1],E[2],E[3]);throw new Error(`Unknown vector class name ${B}`)}(P,y.value);else if(function(B){return"AnimationGroup"===B}(P)){const B=D.animationGroups.filter((B=>B.name===y.name));Q=1===B.length?B[0]:B.find((B=>B.uniqueId===y.uniqueId))}else Q="Matrix"===P?o.Matrix.VE(y.value):"Matrix2D"===P?new S.c(y.value):"Matrix3D"===P?new S.g(y.value):"FlowGraphInteger"===P?q.d.FromValue(y.value):"number"===P||"string"===P||"boolean"===P?y.value[0]:y&&void 0!==y.value?y.value:Array.isArray(y)?y.reduce(((B,E)=>E.eventData?(B[E.id]={type:(0,c.Q)(E.type)},"undefined"!==typeof E.value&&(B[E.id].value=h("value",E,v,D)),B):B),{}):y;return Q}function y(B){return"FlowGraphJsonPointerParserBlock"===B}},13133:(B,E,v)=>{"use strict";function z(B,E){return!(!B.parent||B.parent!==E&&!z(B.parent,E))}function o(B){if(B.getClassName)return B.getClassName()}function q(B,E){return B===E&&("Vector2"===B||"GE"===B||"Vector4"===B||"Quaternion"===B)}function c(B,E){return B===E&&("Matrix"===B||"Matrix2D"===B||"Matrix3D"===B)}function S(B,E){return"FlowGraphInteger"===B&&"FlowGraphInteger"===E}function x(B,E){const v="number"===typeof B||"number"===typeof(null===B||void 0===B?void 0:B.value);return v&&!E?!isNaN(D(B)):v}function D(B){return"number"===typeof B?B:B.value}v.d(E,{d:()=>S,g:()=>c,i:()=>q,m:()=>o,o:()=>z,r:()=>D,s:()=>x})},12484:(B,E,v)=>{"use strict";v.r(E),v.d(E,{SceneInstrumentation:()=>q});var z=v(11193),o=v(11583);class q{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(B){B!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=B,B?(this._onBeforeActiveMeshesEvaluationObserver=this.aE.onBeforeActiveMeshesEvaluationObservable.add((()=>{z.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.aE.onAfterActiveMeshesEvaluationObservable.add((()=>{z.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.aE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.aE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(B){B!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=B,B?(this._onBeforeRenderTargetsRenderObserver=this.aE.onBeforeRenderTargetsRenderObservable.add((()=>{z.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.aE.onAfterRenderTargetsRenderObservable.add((()=>{z.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.aE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.aE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(B){B!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=B,B?(this._onBeforeParticlesRenderingObserver=this.aE.onBeforeParticlesRenderingObservable.add((()=>{z.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.aE.onAfterParticlesRenderingObservable.add((()=>{z.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.aE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.aE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(B){B!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=B,this.aE.spriteManagers&&(B?(this._onBeforeSpritesRenderingObserver=this.aE.onBeforeSpritesRenderingObservable.add((()=>{z.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.aE.onAfterSpritesRenderingObservable.add((()=>{z.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.aE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.aE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(B){B!==this._capturePhysicsTime&&this.aE.onBeforePhysicsObservable&&(this._capturePhysicsTime=B,B?(this._onBeforePhysicsObserver=this.aE.onBeforePhysicsObservable.add((()=>{z.Tools.StartPerformanceCounter("Ac"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.aE.onAfterPhysicsObservable.add((()=>{z.Tools.EndPerformanceCounter("Ac"),this._physicsTime.endMonitoring()}))):(this.aE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.aE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(B){B!==this._captureAnimationsTime&&(this._captureAnimationsTime=B,B?this._onAfterAnimationsObserver=this.aE.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.aE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(B){this._captureFrameTime=B}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(B){this._captureInterFrameTime=B}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(B){B!==this._captureRenderTime&&(this._captureRenderTime=B,B?(this._onBeforeDrawPhaseObserver=this.aE.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),z.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.aE.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),z.Tools.EndPerformanceCounter("Main render")}))):(this.aE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.aE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(B){B!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=B,B?(this._onBeforeCameraRenderObserver=this.aE.onBeforeCameraRenderObservable.add((B=>{this._cameraRenderTime.beginMonitoring(),z.Tools.StartPerformanceCounter(`Rendering camera ${B.name}`)})),this._onAfterCameraRenderObserver=this.aE.onAfterCameraRenderObservable.add((B=>{this._cameraRenderTime.endMonitoring(!1),z.Tools.EndPerformanceCounter(`Rendering camera ${B.name}`)}))):(this.aE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.aE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.aE.getEngine()._drawCalls}constructor(B){this.aE=B,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new o.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new o.b,this._captureFrameTime=!1,this._frameTime=new o.b,this._captureRenderTime=!1,this._renderTime=new o.b,this._captureInterFrameTime=!1,this._interFrameTime=new o.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new o.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new o.b,this._capturePhysicsTime=!1,this._physicsTime=new o.b,this._captureAnimationsTime=!1,this._animationsTime=new o.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new o.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=B.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(z.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.aE.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=B.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(z.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qq(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qq(),this._captureParticlesRenderTime&&this._particlesRenderTime.qq(),this._captureSpritesRenderTime&&this._spritesRenderTime.qq(),this._captureRenderTime&&this._renderTime.qq(),this._captureCameraRenderTime&&this._cameraRenderTime.qq()}))}dispose(){this._disposed||(this.aE.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.aE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.aE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.aE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.aE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.aE.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.aE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.aE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.aE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.aE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.aE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.aE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.aE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.aE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.aE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.aE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.aE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.aE=null,this._disposed=!0)}}},13080:(B,E,v)=>{"use strict";v.d(E,{d:()=>h});var z=v(11366),o=v(11372),q=v(11380),c=v(11808),S=v(11920),x=v(11991),D=v(11345);c.e.AddNodeConstructor("Light_Type_1",((B,E)=>()=>new h(B,q.GE.Zero(),E)));class h extends x.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(B){this._shadowFrustumSize=B,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(B){this._shadowOrthoScale=B,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(B){this._orthoLeft=B}get orthoRight(){return this._orthoRight}set orthoRight(B){this._orthoRight=B}get orthoTop(){return this._orthoTop}set orthoTop(B){this._orthoTop=B}get orthoBottom(){return this._orthoBottom}set orthoBottom(B){this._orthoBottom=B}constructor(B,E,v){super(B,v),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=E.scale(-1),this.direction=E}getClassName(){return"lc"}getTypeID(){return S.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(B,E,v){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(B):this._setDefaultAutoExtendShadowProjectionMatrix(B,E,v)}_setDefaultFixedFrustumShadowProjectionMatrix(B){const E=this.rB().activeCamera;E&&q.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:E.xc,void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,B,this.rB().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(B,E,v){const z=this.rB().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const B=q.GE.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let z=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let c=0;c<v.length;c++){const S=v[c];if(!S)continue;const x=S.getBoundingInfo().boundingBox;for(let v=0;v<x.vectorsWorld.length;v++)q.GE.TransformCoordinatesToRef(x.vectorsWorld[v],E,B),B.x<this._orthoLeft&&(this._orthoLeft=B.x),B.y<this._orthoBottom&&(this._orthoBottom=B.y),B.x>this._orthoRight&&(this._orthoRight=B.x),B.y>this._orthoTop&&(this._orthoTop=B.y),this.autoCalcShadowZBounds&&(B.z<z&&(z=B.z),B.z>o&&(o=B.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=z,this._shadowMaxZ=o)}const o=this._orthoRight-this._orthoLeft,c=this._orthoTop-this._orthoBottom,S=void 0!==this.shadowMinZ?this.shadowMinZ:(null===z||void 0===z?void 0:z.xc)||0,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===z||void 0===z?void 0:z.maxZ)||1e4,D=this.rB().getEngine().useReverseDepthBuffer;q.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-o*this.shadowOrthoScale,this._orthoRight+o*this.shadowOrthoScale,this._orthoBottom-c*this.shadowOrthoScale,this._orthoTop+c*this.shadowOrthoScale,D?x:S,D?S:x,B,this.rB().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(B,E){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,E),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,E),this)}transferToNodeMaterialEffect(B,E){return this.computeTransformedInformation()?(B.setFloat3(E,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(B.setFloat3(E,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(B){const E=this._scene.getEngine();return!E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}getDepthMaxZ(B){const E=this._scene.getEngine();return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}prepareLightSpecificDefines(B,E){B["DIRLIGHT"+E]=!0}}(0,z.c)([(0,o.K)()],h.prototype,"shadowFrustumSize",null),(0,z.c)([(0,o.K)()],h.prototype,"shadowOrthoScale",null),(0,z.c)([(0,o.K)()],h.prototype,"autoUpdateExtends",void 0),(0,z.c)([(0,o.K)()],h.prototype,"autoCalcShadowZBounds",void 0),(0,z.c)([(0,o.K)("orthoLeft")],h.prototype,"_orthoLeft",void 0),(0,z.c)([(0,o.K)("orthoRight")],h.prototype,"_orthoRight",void 0),(0,z.c)([(0,o.K)("orthoTop")],h.prototype,"_orthoTop",void 0),(0,z.c)([(0,o.K)("orthoBottom")],h.prototype,"_orthoBottom",void 0),(0,D.f)("BABYLON.DirectionalLight",h)},13550:(B,E,v)=>{"use strict";v.d(E,{d:()=>h});var z=v(11366),o=v(11372),q=v(11380),c=v(11417),S=v(11808),x=v(11920),D=v(11345);S.e.AddNodeConstructor("Light_Type_3",((B,E)=>()=>new h(B,q.GE.Zero(),E)));class h extends x.c{constructor(B,E,v){super(B,v),this.groundColor=new c.gE(0,0,0),this.direction=E||q.GE.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"dc"}setDirectionToTarget(B){return this.direction=q.GE.Normalize(B.YE(q.GE.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(B,E){const v=q.GE.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",v.x,v.y,v.z,0,E),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Nc),E),this}transferToNodeMaterialEffect(B,E){const v=q.GE.Normalize(this.direction);return B.setFloat3(E,v.x,v.y,v.z),this}yc(){return this._worldMatrix||(this._worldMatrix=q.Matrix.Identity()),this._worldMatrix}getTypeID(){return x.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(B,E){B["HEMILIGHT"+E]=!0}}(0,z.c)([(0,o.m)()],h.prototype,"groundColor",void 0),(0,z.c)([(0,o.I)()],h.prototype,"direction",void 0),(0,D.f)("BABYLON.HemisphericLight",h)},13043:(B,E,v)=>{"use strict";v.d(E,{e:()=>y});var z=v(11366),o=v(11372),q=v(11380),c=v(11808),S=v(11920),x=v(11991),D=v(11361),h=v(11345);c.e.AddNodeConstructor("Light_Type_2",((B,E)=>()=>new y(B,q.GE.Zero(),q.GE.Zero(),0,0,E)));class y extends x.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(B){this._iesProfileTexture!==B&&(this._iesProfileTexture=B,this._iesProfileTexture&&y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(B){this._angle=B,this._cosHalfAngle=Math.cos(.5*B),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(B){this._innerAngle=B,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(B){this._shadowAngleScale=B,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(B){this._projectionTextureLightNear=B,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(B){this._projectionTextureLightFar=B,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(B){this._projectionTextureUpDirection=B,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(B){this._projectionTexture!==B&&(this._projectionTexture=B,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(B){return void 0!==B.onGeneratedObservable}static _IsTexture(B){return void 0!==B.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(B){this._projectionTextureProjectionLightMatrix=B,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(B,E,v,z,o,c){super(B,c),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=q.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=q.GE.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=q.GE.Zero(),this._projectionTextureViewLightMatrix=q.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=q.Matrix.Zero(),this._projectionTextureScalingMatrix=q.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=E,this.direction=v,this.angle=z,this.exponent=o}getClassName(){return"SpotLight"}getTypeID(){return S.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(B){super._setDirection(B),this._projectionTextureViewLightDirty=!0}_setPosition(B){super._setPosition(B),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(B,E,v){const z=this.rB().activeCamera;if(!z)return;this._shadowAngleScale=this._shadowAngleScale||1;const o=this._shadowAngleScale*this._angle,c=void 0!==this.shadowMinZ?this.shadowMinZ:z.xc,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,x=this.rB().getEngine().useReverseDepthBuffer;q.Matrix.PerspectiveFovLHToRef(o,1,x?S:c,x?c:S,B,!0,this._scene.getEngine().isNDCHalfZRange,void 0,x)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),q.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const B=this.projectionTextureLightFar,E=this.projectionTextureLightNear,v=B/(B-E),z=-v*E,o=1/Math.tan(this._angle/2);q.Matrix.FromValuesToRef(o/1,0,0,0,0,o,0,0,0,0,v,1,0,0,z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof D.b){const B=this._projectionTexture.uScale/2,E=this._projectionTexture.vScale/2;q.Matrix.FromValuesToRef(B,0,0,0,0,E,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(B,E){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),B.setMatrix("textureProjectionMatrix"+E,this._projectionTextureMatrix),B.setTexture("projectionLightTexture"+E,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&B.setTexture("iesLightTexture"+E,this._iesProfileTexture),this}transferToEffect(B,E){let v;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,E),v=q.GE.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,E),v=q.GE.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",v.x,v.y,v.z,this._cosHalfAngle,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,E),this}transferToNodeMaterialEffect(B,E){let v;return v=this.computeTransformedInformation()?q.GE.Normalize(this.transformedDirection):q.GE.Normalize(this.direction),this.rB().useRightHandedSystem?B.setFloat3(E,-v.x,-v.y,-v.z):B.setFloat3(E,v.x,v.y,v.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(B){const E=this._scene.getEngine(),v=void 0!==this.shadowMinZ?this.shadowMinZ:(null===B||void 0===B?void 0:B.xc)??0;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?v:this._scene.getEngine().isNDCHalfZRange?0:v}getDepthMaxZ(B){const E=this._scene.getEngine(),v=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===B||void 0===B?void 0:B.maxZ)??1e4;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:v}prepareLightSpecificDefines(B,E){B["SPOTLIGHT"+E]=!0,B["PROJECTEDLIGHTTEXTURE"+E]=!(!this.projectionTexture||!this.projectionTexture.isReady()),B["IESLIGHTTEXTURE"+E]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,z.c)([(0,o.K)()],y.prototype,"angle",null),(0,z.c)([(0,o.K)()],y.prototype,"innerAngle",null),(0,z.c)([(0,o.K)()],y.prototype,"shadowAngleScale",null),(0,z.c)([(0,o.K)()],y.prototype,"exponent",void 0),(0,z.c)([(0,o.K)()],y.prototype,"projectionTextureLightNear",null),(0,z.c)([(0,o.K)()],y.prototype,"projectionTextureLightFar",null),(0,z.c)([(0,o.K)()],y.prototype,"projectionTextureUpDirection",null),(0,z.c)([(0,o.E)("projectedLightTexture")],y.prototype,"_projectionTexture",void 0),(0,h.f)("BABYLON.SpotLight",y)},12768:(B,E,v)=>{"use strict";v.d(E,{b:()=>c,e:()=>q,f:()=>S});const z={},o={};function q(B,E){z[B]=E}function c(B,E){o[B]=E}function S(B){return o[B]?o[B]:null}},12664:(B,E,v)=>{"use strict";v.d(E,{b:()=>r,f:()=>p});var z,o=v(11193),q=v(11202),c=v(11601),S=v(11242),x=v(11213),D=v(11856),h=v(11249),y=v(11256),Q=v(11351),P=v(11282),G=v(11237);!function(B){B[B.Clean=0]="Clean",B[B.Stop=1]="Stop",B[B.Sync=2]="Sync",B[B.NoSync=3]="NoSync"}(z||(z={}));const Y=new q.e,a={};let m=!1;function g(){return a[".babylon"]}function V(B,E){const v=a[B];return v||(x.c.Warn("Unable to find a plugin to load "+B+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),E?g():void 0)}function T(B,E,v){let z="Unable to load from "+(B.rawData?"binary data":B.url);return E?z+=`: ${E}`:v&&(z+=`: ${v}`),z}async function N(B,E,v,z,o,q,c,S,x){var D;const y="data:"===(Q=B.url).substring(0,5)?Q.substring(5):null;var Q;if(B.rawData&&!c)throw"When using ArrayBufferView to load data the file extension must be provided.";const m=y||c?"":function(B){const E=B.indexOf("?");-1!==E&&(B=B.substring(0,E));const v=B.lastIndexOf(".");return B.substring(v,B.length).toLowerCase()}(B.url);let T=c?V(c,!0):y?function(B){for(const E in a){const v=a[E].plugin;if(v.canDirectLoad&&v.canDirectLoad(B))return a[E]}return g()}(B.url):V(m,!1);if(!T&&m){if(B.url&&!B.url.startsWith("blob:")){const E=await async function(B,E){const v=E.method||"GET";return await new Promise(((z,o)=>{const q=new G.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const B={};if(E.responseHeaders)for(const v of E.responseHeaders)B[v]=q.getResponseHeader(v)||"";z({response:q.response,headerValues:B})}else o(`Unable to fetch data from ${B}. Error code: ${q.status}`)})),q.open(v,B),q.send()}))}(B.url,{method:"HEAD",responseHeaders:["Content-Type"]}),v=E.headerValues?E.headerValues["Content-Type"]:"";v&&(T=function(B){for(const E in a){const v=a[E];if(v.mimeType===B)return v}}(v))}T||(T=g())}if(!T)throw new Error(`No plugin or fallback for ${c??B.url}`);if(!1===(null===x||void 0===x||null===(D=x[T.plugin.name])||void 0===D?void 0:D.enabled))throw new Error(`The '${T.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(B.rawData&&!T.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(B=>{if(T.plugin.createPlugin){const E=T.plugin.createPlugin(x??{});return E instanceof Promise?(E.then(B).catch((B=>{o("Error instantiating plugin.",B)})),null):(B(E),E)}return B(T.plugin),T.plugin})((x=>{var D;if(!x)throw`The loader plugin corresponding to the '${c}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Y.notifyObservers(x),y&&(x.canDirectLoad&&x.canDirectLoad(B.url)||!(0,h.l)(B.url))){if(x.directLoad){const B=x.directLoad(E,y);B instanceof Promise?B.then((B=>{v(x,B)})).catch((B=>{o("Error in directLoad of _loadData: "+B,B)})):v(x,B)}else v(x,y);return}const Q=T.isBinary,G=(B,z)=>{E.P?o("Scene has been disposed"):v(x,B,z)};let a=null,m=!1;null===(D=x.eq)||void 0===D||D.add((()=>{m=!0,a&&(a.abort(),a=null),q()}));const g=()=>{if(m)return;const v=(B,E)=>{o(null===B||void 0===B?void 0:B.statusText,E)};if(!x.loadFile&&B.rawData)throw"Plugin does not support loading ArrayBufferView.";a=x.loadFile?x.loadFile(E,B.rawData||B.file||B.url,B.rootUrl,G,z,Q,v,S):E._loadFile(B.file||B.url,G,z,!0,Q,v)},V=E.getEngine();let N=V.enableOfflineSupport;if(N){let v=!1;for(const z of E.disableOfflineSupportExceptionRules)if(z.test(B.url)){v=!0;break}N=!v}N&&P.b.OfflineProviderFactory?E.offlineProvider=P.b.OfflineProviderFactory(B.url,g,V.disableManifestCheck):g()}))}function X(B,E){let v,z,q=null,c=null;if(E)if(E.name)v=`file:${E.name}`,z=E.name,q=E;else if(ArrayBuffer.isView(E))v="",z=(0,Q.c)(),c=E;else if(E.startsWith("data:"))v=E,z="";else if(B){const q=E;if("/"===q.substring(0,1))return o.Tools.Error("Wrong sceneFilename parameter"),null;v=B+q,z=q}else v=E,z=o.Tools.GetFilename(E),B=o.Tools.GetFolderPath(E);else v=B,z=o.Tools.GetFilename(B),B=o.Tools.GetFolderPath(B);return{url:v,rootUrl:B,name:z,file:q,rawData:c}}function r(B){if("string"===typeof B.extensions){const E=B.extensions;a[E.toLowerCase()]={plugin:B,isBinary:!1}}else{const E=B.extensions,v=Object.keys(E);for(const z of v)a[z.toLowerCase()]={plugin:B,isBinary:E[z].isBinary,mimeType:E[z].mimeType}}}async function i(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.b.LastCreatedScene,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!z)return x.c.Error("No scene available to import mesh to"),null;const P=X(E,v);if(!P)return null;const G={};z.addPendingData(G);const Y=()=>{z.removePendingData(G)},a=(B,E)=>{const v=T(P,B,E);c?c(z,v,new y.g(v,y.c.SceneLoaderError,E)):x.c.Error(v),Y()},m=q?B=>{try{q(B)}catch(E){a("Error in onProgress callback: "+E,E)}}:void 0,g=(B,E,v,q,c,S,x,D)=>{if(z.importedMeshesFiles.push(P.url),o)try{o(B,E,v,q,c,S,x,D)}catch(h){a("Error in onSuccess callback: "+h,h)}z.removePendingData(G)};return await N(P,z,((E,v,o)=>{if(E.rewriteRootURL&&(P.rootUrl=E.rewriteRootURL(P.rootUrl,o)),E.importMesh){const o=[],q=[],c=[];if(!E.importMesh(B,z,v,P.rootUrl,o,q,c,a))return;z.loadingPluginName=E.name,g(o,q,c,[],[],[],[],[])}else{E.importMeshAsync(B,z,v,P.rootUrl,m,P.name).then((B=>{z.loadingPluginName=E.name,g(B.meshes,B.bQ,B.skeletons,B.animationGroups,B.transformNodes,B.geometries,B.lights,B.spriteManagers)})).catch((B=>{a(B.message,B)}))}}),m,a,Y,D,h,Q)}async function u(B,E,v,z,o,q,c,S){return await new Promise(((x,D)=>{try{i(B,E,v,z,((B,E,v,z,o,q,c,S)=>{x({meshes:B,bQ:E,skeletons:v,animationGroups:z,transformNodes:o,geometries:q,lights:c,spriteManagers:S})}),o,((B,E,v)=>{D(v||new Error(E))}),q,c,S).catch(D)}catch(y){D(y)}}))}async function I(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedEngine,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};v?await C(B,E,new c.c(v),z,q,x,D,h,y):o.Tools.Error("No engine available")}async function K(B,E,v,z,o,q,c){return await new Promise(((S,x)=>{I(B,E,v,(B=>{S(B)}),z,((B,E,v)=>{x(v||new Error(E))}),o,q,c)}))}async function C(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!v)return x.c.Error("No scene available to append to"),null;const P=X(B,E);if(!P)return null;const G={};v.addPendingData(G);const Y=()=>{v.removePendingData(G)};D.b.ShowLoadingScreen&&!m&&(m=!0,v.getEngine().displayLoadingUI(),v.executeWhenReady((()=>{v.getEngine().hideLoadingUI(),m=!1})));const a=(B,E)=>{const z=T(P,B,E);q?q(v,z,new y.g(z,y.c.SceneLoaderError,E)):x.c.Error(z),Y()},g=o?B=>{try{o(B)}catch(E){a("Error in onProgress callback",E)}}:void 0,V=()=>{if(z)try{z(v)}catch(B){a("Error in onSuccess callback",B)}v.removePendingData(G)};return await N(P,v,((B,E)=>{if(B.load){if(!B.load(v,E,P.rootUrl,a))return;v.loadingPluginName=B.name,V()}else{B.loadAsync(v,E,P.rootUrl,g,P.name).then((()=>{v.loadingPluginName=B.name,V()})).catch((B=>{a(B.message,B)}))}}),g,a,Y,c,h,Q)}async function f(B,E,v,z,o,q,c){return await new Promise(((S,x)=>{try{C(B,E,v,(B=>{S(B)}),z,((B,E,v)=>{x(v||new Error(E))}),o,q,c).catch(x)}catch(y){x(y)}}))}async function A(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!v)return x.c.Error("No scene available to load asset container to"),null;const Q=X(B,E);if(!Q)return null;const P={};v.addPendingData(P);const G=()=>{v.removePendingData(P)},Y=(B,E)=>{const z=T(Q,B,E);q?q(v,z,new y.g(z,y.c.SceneLoaderError,E)):x.c.Error(z),G()},a=o?B=>{try{o(B)}catch(E){Y("Error in onProgress callback",E)}}:void 0,m=B=>{if(z)try{z(B)}catch(E){Y("Error in onSuccess callback",E)}v.removePendingData(P)};return await N(Q,v,((B,E)=>{if(B.loadAssetContainer){const z=B.loadAssetContainer(v,E,Q.rootUrl,Y);if(!z)return;z.populateRootNodes(),v.loadingPluginName=B.name,m(z)}else if(B.loadAssetContainerAsync){B.loadAssetContainerAsync(v,E,Q.rootUrl,a,Q.name).then((E=>{E.populateRootNodes(),v.loadingPluginName=B.name,m(E)})).catch((B=>{Y(B.message,B)}))}else Y("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),a,Y,G,c,D,h)}async function l(B,E,v,z,o,q,c){return await new Promise(((S,x)=>{try{A(B,E,v,(B=>{S(B)}),z,((B,E,v)=>{x(v||new Error(E))}),o,q,c).catch(x)}catch(y){x(y)}}))}async function d(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedScene,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!v)return void x.c.Error("No scene available to load animations to");if(z){for(const z of v.animatables)z.reset();v.stopAllAnimations();const B=v.animationGroups.slice();for(const v of B)v.dispose();const E=v.getNodes();for(const v of E)v.animations&&(v.animations=[])}else switch(o){case 0:const B=v.animationGroups.slice();for(const E of B)E.dispose();break;case 1:for(const E of v.animationGroups)E.stop();break;case 2:for(const E of v.animationGroups)E.reset(),E.restart();break;case 3:break;default:return void x.c.Error("Unknown animation group loading mode value '"+o+"'")}const G=v.animatables.length;await A(B,E,v,(B=>{B.mergeAnimationsTo(v,v.animatables.slice(G),q),B.dispose(),v.onAnimationFileImportedObservable.notifyObservers(v),c&&c(v)}),D,h,y,Q,P)}async function t(B,E,v,z,o,q,c,S,x,D){return await new Promise(((h,Q)=>{try{d(B,E,v,z,o,q,(B=>{h(B)}),c,((B,E,v)=>{Q(v||new Error(E))}),S,x,D).catch(Q)}catch(y){Q(y)}}))}class p{static get ForceFullSceneLoadingForIncremental(){return D.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(B){D.b.ForceFullSceneLoadingForIncremental=B}static get ShowLoadingScreen(){return D.b.ShowLoadingScreen}static set ShowLoadingScreen(B){D.b.ShowLoadingScreen=B}static get loggingLevel(){return D.b.loggingLevel}static set loggingLevel(B){D.b.loggingLevel=B}static get CleanBoneMatrixWeights(){return D.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(B){D.b.CleanBoneMatrixWeights=B}static GetDefaultPlugin(){return g()}static GetPluginForExtension(B){var E;return null===(E=V(B,!0))||void 0===E?void 0:E.plugin}static IsPluginForExtensionAvailable(B){return function(B){return!!a[B]}(B)}static RegisterPlugin(B){r(B)}static ImportMesh(B,E,v,z,o,q,c,x,D){i(B,E,v,z,o,q,c,x,D).catch((B=>null===c||void 0===c?void 0:c(S.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async ImportMeshAsync(B,E,v,z,o,q,c){return await u(B,E,v,z,o,q,c)}static Load(B,E,v,z,o,q,c,x){I(B,E,v,z,o,q,c,x).catch((B=>null===q||void 0===q?void 0:q(S.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async LoadAsync(B,E,v,z,o,q){return await K(B,E,v,z,o,q)}static Append(B,E,v,z,o,q,c,x){C(B,E,v,z,o,q,c,x).catch((B=>null===q||void 0===q?void 0:q(v??S.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async AppendAsync(B,E,v,z,o,q){return await f(B,E,v,z,o,q)}static LoadAssetContainer(B,E,v,z,o,q,c,x){A(B,E,v,z,o,q,c,x).catch((B=>null===q||void 0===q?void 0:q(v??S.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async LoadAssetContainerAsync(B,E,v,z,o,q){return await l(B,E,v,z,o,q)}static ImportAnimations(B,E,v,z,o,q,c,x,D,h,y){d(B,E,v,z,o,q,c,x,D,h,y).catch((B=>null===D||void 0===D?void 0:D(v??S.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async ImportAnimationsAsync(B,E,v,z,o,q,c,S,x,D,h){return await t(B,E,v,z,o,q,S,D,h)}}p.NO_LOGGING=0,p.MINIMAL_LOGGING=1,p.SUMMARY_LOGGING=2,p.DETAILED_LOGGING=3,p.OnPluginActivatedObservable=Y},13062:(B,E,v)=>{"use strict";v.d(E,{e:()=>Q});var z=v(11366),o=v(11372),q=v(11193),c=v(11380),S=v(11401),x=v(11361),D=v(11345),h=v(11202),y=v(11409);v(13069);class Q extends S.d{set boundingBoxSize(B){if(this._boundingBoxSize&&this._boundingBoxSize.equals(B))return;this._boundingBoxSize=B;const E=this.rB();E&&E.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(B){this._rotationY=B,this.setReflectionTextureMatrix(c.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(B,E,v){let z="";for(const o of B)z+=o;return new Q(z,E,null,v,B)}static CreateFromPrefilteredData(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=E.useDelayedTextureLoading;E.useDelayedTextureLoading=!1;const q=new Q(B,E,null,!1,null,null,null,void 0,!0,v,z);return E.useDelayedTextureLoading=o,q}constructor(B,E){var v;let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,G=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,a=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,m=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;super(E),this.onLoadObservable=new h.e,this.boundingBoxPosition=c.GE.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new c.Matrix,this._buffer=null,this.name=B,this.url=B,this._noMipmap=o,this.Sc=!1,this.isCube=!0,this._textureMatrix=c.Matrix.Identity(),this.coordinatesMode=x.b.CUBIC_MODE;let V=null,T=null;null===z||Array.isArray(z)?(this._noMipmap=o,this._format=y,this._createPolynomials=G,V=z,this._loaderOptions=m,this._useSRGBBuffer=g,this._lodScale=Y,this._lodOffset=a):(V=z.extensions??null,this._noMipmap=z.noMipmap??!1,q=z.files??null,T=z.buffer??null,this._format=z.format??5,Q=z.prefiltered??!1,P=z.forcedExtension??null,this._createPolynomials=z.createPolynomials??!1,this._lodScale=z.lodScale??.8,this._lodOffset=z.lodOffset??0,this._loaderOptions=z.loaderOptions,this._useSRGBBuffer=z.useSRGBBuffer,S=z.L??null,D=z.onError??null),(B||q)&&this.updateURL(B,P,S,Q,D,V,null===(v=this.rB())||void 0===v?void 0:v.useDelayedTextureLoading,q,T)}getClassName(){return"CubeTexture"}updateURL(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=B),this.url=B,E&&(this._forcedExtension=E);const D=B.lastIndexOf("."),h=E||(D>-1?B.substring(D).toLowerCase():""),y=0===h.indexOf(".dds"),Q=0===h.indexOf(".env"),P=0===h.indexOf(".basis");if(Q?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=z,z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),S)this._files=S;else if(P||Q||y||q||(q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,q){for(let E=0;E<q.length;E++)this._files.push(B+q[E]);this._extensions=q}this._buffer=x,c?(this.delayLoadState=4,this._delayedOnLoad=v,this._delayedOnError=o):this._loadTexture(v,o)}delayLoad(B){4===this.delayLoadState&&(B&&(this._forcedExtension=B),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(B){var E,v;if(B.updateFlag===this._textureMatrix.updateFlag)return;B.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(v=this.rB())||void 0===v||v.markAllMaterialsAsDirty(1,(B=>-1!==B.getActiveTextures().indexOf(this))));if(this._textureMatrix=B,null===(E=this.rB())||void 0===E||!E.useRightHandedSystem)return;const z=c.TmpVectors.GE[0],o=c.TmpVectors.Quaternion[0],q=c.TmpVectors.GE[1];this._textureMatrix.decompose(z,o,q),o.z*=-1,o.w*=-1,c.Matrix.ComposeToRef(z,o,q,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var B;return null!==(B=this.rB())&&void 0!==B&&B.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=this.rB(),z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const o=()=>{var E;(this.onLoadObservable.notifyObservers(this),z)&&(z.dispose(),null===(E=this.rB())||void 0===E||E.markAllMaterialsAsDirty(1));B&&B()},c=(B,v)=>{this._loadingError=!0,this._errorObject={message:B,exception:v},E&&E(B,v),x.b.OnTextureLoadErrorObservable.notifyObservers(this)};var S;this._texture?this._texture.isReady?q.Tools.SetImmediate((()=>o())):this._texture.onLoadedObservable.add((()=>o())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,v,this._lodScale,this._lodOffset,B,c,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,v,this._files,this._noMipmap,B,c,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(S=this._texture)||void 0===S||S.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(B,E,v){const z=y.b.Parse((()=>{let z=!1;return B.prefiltered&&(z=B.prefiltered),new Q(v+(B.url??B.name),E,B.extensions,!1,B.files||null,null,null,void 0,z,B.forcedExtension)}),B,E);if(B.boundingBoxPosition&&(z.boundingBoxPosition=c.GE.VE(B.boundingBoxPosition)),B.boundingBoxSize&&(z.boundingBoxSize=c.GE.VE(B.boundingBoxSize)),B.animations)for(let o=0;o<B.animations.length;o++){const E=B.animations[o],v=(0,D.b)("BABYLON.Animation");v&&z.animations.push(v.Parse(E))}return z}clone(){let B=0;const E=y.b.Clone((()=>{const E=new Q(this.url,this.rB()||this._getEngine(),this._extensions,this._noMipmap,this._files);return B=E.uniqueId,E}),this);return E.uniqueId=B,E}}(0,z.c)([(0,o.K)()],Q.prototype,"url",void 0),(0,z.c)([(0,o.I)()],Q.prototype,"boundingBoxPosition",void 0),(0,z.c)([(0,o.I)()],Q.prototype,"boundingBoxSize",null),(0,z.c)([(0,o.K)("rotationY")],Q.prototype,"rotationY",null),(0,z.c)([(0,o.K)("files")],Q.prototype,"_files",void 0),(0,z.c)([(0,o.K)("forcedExtension")],Q.prototype,"_forcedExtension",void 0),(0,z.c)([(0,o.K)("extensions")],Q.prototype,"_extensions",void 0),(0,z.c)([(0,o.t)("textureMatrix")],Q.prototype,"_textureMatrix",void 0),(0,z.c)([(0,o.t)("textureMatrixRefraction")],Q.prototype,"_textureMatrixRefraction",void 0),x.b._CubeTextureParser=Q.Parse,(0,D.f)("BABYLON.CubeTexture",Q)},13567:(B,E,v)=>{"use strict";v.d(E,{c:()=>x});var z=v(11213),o=v(11361),q=v(11353),c=v(11494),S=v(11323);c.ThinEngine.prototype.createDynamicTexture=function(B,E,v,z){const o=new S.b(this,4);return o.baseWidth=B,o.baseHeight=E,v&&(B=this.needPOTTextures?(0,q.g)(B,this._caps.maxTextureSize):B,E=this.needPOTTextures?(0,q.g)(E,this._caps.maxTextureSize):E),o.width=B,o.height=E,o.isReady=!1,o.generateMipMaps=v,o.samplingMode=z,this.updateTextureSamplingMode(z,o),this._internalTexturesCache.push(o),o},c.ThinEngine.prototype.updateDynamicTexture=function(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!B)return;const c=this._gl,S=c.TEXTURE_2D,x=this._bindTextureDirectly(S,B,!0,q);this._unpackFlipY(void 0===v?B.invertY:v),z&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const D=this._getWebGLTextureType(B.type),h=this._getInternalFormat(o||B.format),y=this._getRGBABufferInternalSizedFormat(B.type,h);c.texImage2D(S,0,y,h,D,E),B.generateMipMaps&&c.generateMipmap(S),x||this._bindTextureDirectly(S,null),z&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o&&(B.format=o),B._dynamicTextureSource=E,B._premulAlpha=z,B.invertY=v||!1,B.isReady=!0};class x extends o.b{constructor(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,S=arguments.length>6?arguments[6]:void 0;const x=!v||v._isScene;super(null,x?v:null===v||void 0===v?void 0:v.aE,x?!z:v,S,q,void 0,void 0,void 0,void 0,c),this.name=B,this.wrapU=o.b.CLAMP_ADDRESSMODE,this.wrapV=o.b.CLAMP_ADDRESSMODE,this._generateMipMaps=z;const D=this._getEngine();if(!D)return;if(E.getContext)this._canvas=E,this._ownCanvas=!1,this._texture=D.createDynamicTexture(this._canvas.width,this._canvas.height,z,q);else{this._canvas=D.createCanvas(1,1),this._ownCanvas=!0;const B=E;B.width||0===B.width?this._texture=D.createDynamicTexture(B.width,B.height,z,q):this._texture=D.createDynamicTexture(E,E,z,q)}const h=this.getSize();this._canvas.width!==h.width&&(this._canvas.width=h.width),this._canvas.height!==h.height&&(this._canvas.height=h.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(B){this._canvas.width=B.width,this._canvas.height=B.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(B.width,B.height,this._generateMipMaps,this.samplingMode)}scale(B){const E=this.getSize();E.width*=B,E.height*=B,this._recreate(E)}scaleTo(B,E){const v=this.getSize();v.width=B,v.height=E,this._recreate(v)}getContext(){return this._context}clear(B){const E=this.getSize();B&&(this._context.fillStyle=B),this._context.clearRect(0,0,E.width,E.height)}update(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===B||B,E,this._format||void 0,void 0,v)}drawText(B,E,v,z,o,q,c){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const x=this.getSize();if(q&&(this._context.fillStyle=q,this._context.fillRect(0,0,x.width,x.height)),this._context.font=z,null===E||void 0===E){const v=this._context.measureText(B);E=(x.width-v.width)/2}if(null===v||void 0===v){const B=parseInt(z.replace(/\D/g,""));v=x.height/2+B/3.65}this._context.fillStyle=o||"",this._context.fillText(B,E,v),S&&this.update(c)}dispose(){var B,E;(super.dispose(),this._ownCanvas)&&(null===(B=this._canvas)||void 0===B||null===(E=B.remove)||void 0===E||E.call(B));this._canvas=null,this._context=null}clone(){const B=this.rB();if(!B)return this;const E=this.getSize(),v=new x(this.name,E,B,this._generateMipMaps);return v.Sc=this.Sc,v.level=this.level,v.wrapU=this.wrapU,v.wrapV=this.wrapV,v}serialize(){const B=this.rB();B&&!B.isReady()&&z.c.Warn("The scene must be ready before serializing the dynamic texture");const E=super.serialize();return x._IsCanvasElement(this._canvas)&&(E.base64String=this._canvas.toDataURL()),E.invertY=this._invertY,E.samplingMode=this.samplingMode,E}static _IsCanvasElement(B){return void 0!==B.toDataURL}_rebuild(){this.update()}}},12966:(B,E,v)=>{"use strict";v.d(E,{b:()=>o});var z=v(11361);class o extends z.b{get depth(){return this._depth}constructor(B,E,v,o,q,c){let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:z.b.TRILINEAR_SAMPLINGMODE,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10?arguments[10]:void 0;super(null,c,!S,x),this.format=q,this._texture=c.getEngine().createRawTexture2DArray(B,E,v,o,q,S,x,D,null,h,y),this._depth=o,this.is2DArray=!0}update(B){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,B,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(B,E,v,z,q){return new o(B,E,v,z,5,q,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12785:(B,E,v)=>{"use strict";v.d(E,{d:()=>S,f:()=>x,h:()=>q,j:()=>c});var z=v(11394),o=v(11380);function q(B,E){return`{X: ${B.x.toFixed(E)} Y: ${B.y.toFixed(E)}}`}function c(B,E){return`{X: ${B._x.toFixed(E)} Y: ${B._y.toFixed(E)} Z: ${B._z.toFixed(E)}}`}function S(B,E){return 2*Math.acos((0,z.Clamp)(o.Quaternion.Dot(B,E)))}function x(B,E){const v=new o.Quaternion;return function(B,E,v){const q=o.GE.Cross(B,E),c=Math.acos((0,z.Clamp)(o.GE.Dot(B,E),-1,1));o.Quaternion.RotationAxisToRef(q,c,v)}(B,E,v),v}},12602:(B,E,v)=>{"use strict";v.d(E,{d:()=>D});var z=v(11380),o=v(11417),q=v(11833),c=v(11822),S=v(11425);v(12609);function x(B){let E=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const v=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],q=[];let x=[];const D=B.width||B.size||1,h=B.height||B.size||1,y=B.depth||B.size||1,Q=B.wrap||!1;let P=void 0===B.topBaseAt?1:B.topBaseAt,G=void 0===B.bottomBaseAt?0:B.bottomBaseAt;P=(P+4)%4,G=(G+4)%4;let Y=[2,0,3,1][P],a=[2,0,1,3][G],m=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Q){E=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],m=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let B=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],v=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const z=[17,18,19,16],o=[22,23,20,21];for(;Y>0;)B.unshift(B.pop()),z.unshift(z.pop()),Y--;for(;a>0;)v.unshift(v.pop()),o.unshift(o.pop()),a--;B=B.flat(),v=v.flat(),m=m.concat(B).concat(v),E.push(z[0],z[2],z[3],z[0],z[1],z[2]),E.push(o[0],o[2],o[3],o[0],o[1],o[2])}const g=[D/2,h/2,y/2];x=m.reduce(((B,E,v)=>B.concat(E*g[v%3])),[]);const V=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,T=B.faceUV||new Array(6),N=B.faceColors,X=[];for(let c=0;c<6;c++)void 0===T[c]&&(T[c]=new z.Vector4(0,0,1,1)),N&&void 0===N[c]&&(N[c]=new o.gc(1,1,1,1));for(let z=0;z<6;z++)if(q.push(T[z].z,S.c?1-T[z].w:T[z].w),q.push(T[z].x,S.c?1-T[z].w:T[z].w),q.push(T[z].x,S.c?1-T[z].y:T[z].y),q.push(T[z].z,S.c?1-T[z].y:T[z].y),N)for(let B=0;B<4;B++)X.push(N[z].r,N[z].g,N[z].b,N[z].a);c.c._ComputeSides(V,x,E,v,q,B.frontUVs,B.backUVs);const r=new c.c;if(r.indices=E,r.uB=x,r.IB=v,r.CB=q,N){const B=V===c.c.DOUBLESIDE?X.concat(X):X;r.KB=B}return r}function D(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new q.e(B,v);E.sideOrientation=q.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return x(E).AB(z,E.updatable),z}c.c.CreateBox=x,q.e.CreateBox=function(B,E){return D(B,{size:E,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12772:(B,E,v)=>{"use strict";v.d(E,{c:()=>S});var z=v(11833),o=v(11822),q=v(11425);function c(B){const E=[],v=[],z=[],c=[],S=B.radius||.5,x=B.tessellation||64,D=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,h=0===B.sideOrientation?0:B.sideOrientation||o.c.DEFAULTSIDE;E.push(0,0,0),c.push(.5,.5);const y=2*Math.PI*D,Q=1===D?y/x:y/(x-1);let P=0;for(let o=0;o<x;o++){const B=Math.cos(P),v=Math.sin(P),z=(B+1)/2,o=(1-v)/2;E.push(S*B,S*v,0),c.push(z,q.c?1-o:o),P+=Q}1===D&&(E.push(E[3],E[4],E[5]),c.push(c[2],q.c?1-c[3]:c[3]));const G=E.length/3;for(let o=1;o<G-1;o++)v.push(o+1,0,o);o.c.ComputeNormals(E,v,z),o.c._ComputeSides(h,E,v,z,c,B.frontUVs,B.backUVs);const Y=new o.c;return Y.indices=v,Y.uB=E,Y.IB=z,Y.CB=c,Y}function S(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new z.e(B,v);E.sideOrientation=z.e._GetDefaultSideOrientation(E.sideOrientation),o._originalBuilderSideOrientation=E.sideOrientation;return c(E).AB(o,E.updatable),o}o.c.CreateDisc=c,z.e.CreateDisc=function(B,E,v){return S(B,{radius:E,tessellation:v,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12609:(B,E,v)=>{"use strict";v.d(E,{d:()=>a,b:()=>g,h:()=>m});var z=v(11380),o=v(11417),q=v(11833),c=v(11822),S=v(11442);q.e._GroundMeshParser=(B,E)=>x.Parse(B,E);class x extends q.e{constructor(B,E){super(B,E),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=B,this._subdivisionsY=B,this.subdivide(B);const v=this;v.createOrUpdateSubmeshesOctree&&v.createOrUpdateSubmeshesOctree(E)}getHeightAtCoordinates(B,E){const v=this.getWorldMatrix(),o=z.TmpVectors.Matrix[5];v.invertToRef(o);const q=z.TmpVectors.GE[8];if(z.GE.TransformCoordinatesFromFloatsToRef(B,0,E,o,q),B=q.x,E=q.z,B<this._minX||B>=this._maxX||E<=this._minZ||E>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const c=this._getFacetAt(B,E),S=-(c.x*B+c.z*E+c.w)/c.y;return z.GE.TransformCoordinatesFromFloatsToRef(0,S,0,v,q),q.y}getNormalAtCoordinates(B,E){const v=new z.GE(0,1,0);return this.getNormalAtCoordinatesToRef(B,E,v),v}getNormalAtCoordinatesToRef(B,E,v){const o=this.getWorldMatrix(),q=z.TmpVectors.Matrix[5];o.invertToRef(q);const c=z.TmpVectors.GE[8];if(z.GE.TransformCoordinatesFromFloatsToRef(B,0,E,q,c),B=c.x,E=c.z,B<this._minX||B>this._maxX||E<this._minZ||E>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(B,E);return z.GE.TransformNormalFromFloatsToRef(S.x,S.y,S.z,o,v),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(B,E){const v=Math.floor((B+this._maxX)*this._subdivisionsX/this._width),z=Math.floor(-(E+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[z*this._subdivisionsX+v];let q;return q=E<o.slope.x*B+o.slope.y?o.facet1:o.facet2,q}_initHeightQuads(){const B=this._subdivisionsX,E=this._subdivisionsY;this._heightQuads=[];for(let v=0;v<E;v++)for(let E=0;E<B;E++){const o={slope:z.Vector2.Zero(),facet1:new z.Vector4(0,0,0,0),facet2:new z.Vector4(0,0,0,0)};this._heightQuads[v*B+E]=o}return this}_computeHeightQuads(){const B=this.getVerticesData(S.e.PositionKind);if(!B)return this;const E=z.TmpVectors.GE[3],v=z.TmpVectors.GE[2],o=z.TmpVectors.GE[1],q=z.TmpVectors.GE[0],c=z.TmpVectors.GE[4],x=z.TmpVectors.GE[5],D=z.TmpVectors.GE[6],h=z.TmpVectors.GE[7],y=z.TmpVectors.GE[8];let Q=0,P=0,G=0,Y=0,a=0,m=0,g=0;const V=this._subdivisionsX,T=this._subdivisionsY;for(let S=0;S<T;S++)for(let T=0;T<V;T++){Q=3*T,P=S*(V+1)*3,G=(S+1)*(V+1)*3,E.x=B[P+Q],E.y=B[P+Q+1],E.z=B[P+Q+2],v.x=B[P+Q+3],v.y=B[P+Q+4],v.z=B[P+Q+5],o.x=B[G+Q],o.y=B[G+Q+1],o.z=B[G+Q+2],q.x=B[G+Q+3],q.y=B[G+Q+4],q.z=B[G+Q+5],Y=(q.z-E.z)/(q.x-E.x),a=E.z-Y*E.x,v.subtractToRef(E,c),o.subtractToRef(E,x),q.subtractToRef(E,D),z.GE.CrossToRef(D,x,h),z.GE.CrossToRef(c,D,y),h.normalize(),y.normalize(),m=-(h.x*E.x+h.y*E.y+h.z*E.z),g=-(y.x*v.x+y.y*v.y+y.z*v.z);const N=this._heightQuads[S*V+T];N.slope.Yc(Y,a),N.facet1.Yc(h.x,h.y,h.z,m),N.facet2.Yc(y.x,y.y,y.z,g)}return this}serialize(B){super.serialize(B),B.subdivisionsX=this._subdivisionsX,B.subdivisionsY=this._subdivisionsY,B.minX=this._minX,B.maxX=this._maxX,B.xc=this._minZ,B.maxZ=this._maxZ,B.width=this._width,B.height=this._height}static Parse(B,E){const v=new x(B.name,E);return v._subdivisionsX=B.subdivisionsX||1,v._subdivisionsY=B.subdivisionsY||1,v._minX=B.minX,v._maxX=B.maxX,v._minZ=B.xc,v._maxZ=B.maxZ,v._width=B.width,v._height=B.height,v}}var D=v(11193),h=v(11242),y=v(11382),Q=v(11425);function P(B){const E=[],v=[],o=[],q=[];let S,x;const D=B.width||B.size||1,h=B.height||B.size||1,y=0|(B.subdivisionsX||B.subdivisions||1),P=0|(B.subdivisionsY||B.subdivisions||1);for(S=0;S<=P;S++)for(x=0;x<=y;x++){const B=new z.GE(x*D/y-D/2,0,(P-S)*h/P-h/2),E=new z.GE(0,1,0);v.push(B.x,B.y,B.z),o.push(E.x,E.y,E.z),q.push(x/y,Q.c?S/P:1-S/P)}for(S=0;S<P;S++)for(x=0;x<y;x++)E.push(x+1+(S+1)*(y+1)),E.push(x+1+S*(y+1)),E.push(x+S*(y+1)),E.push(x+(S+1)*(y+1)),E.push(x+1+(S+1)*(y+1)),E.push(x+S*(y+1));const G=new c.c;return G.indices=E,G.uB=v,G.IB=o,G.CB=q,G}function G(B){const E=void 0!==B.xmin&&null!==B.xmin?B.xmin:-1,v=void 0!==B.zmin&&null!==B.zmin?B.zmin:-1,o=void 0!==B.xmax&&null!==B.xmax?B.xmax:1,q=void 0!==B.zmax&&null!==B.zmax?B.zmax:1,S=B.subdivisions||{w:1,h:1},x=B.precision||{w:1,h:1},D=[],h=[],y=[],Q=[];let P,G,Y,a;S.h=S.h<1?1:S.h,S.w=S.w<1?1:S.w,x.w=x.w<1?1:x.w,x.h=x.h<1?1:x.h;const m=(o-E)/S.w,g=(q-v)/S.h;function V(B,E,v,o){const q=h.length/3,c=x.w+1;for(P=0;P<x.h;P++)for(G=0;G<x.w;G++){const B=[q+G+P*c,q+(G+1)+P*c,q+(G+1)+(P+1)*c,q+G+(P+1)*c];D.push(B[1]),D.push(B[2]),D.push(B[3]),D.push(B[0]),D.push(B[1]),D.push(B[3])}const S=z.GE.Zero(),Y=new z.GE(0,1,0);for(P=0;P<=x.h;P++)for(S.z=P*(o-E)/x.h+E,G=0;G<=x.w;G++)S.x=G*(v-B)/x.w+B,S.y=0,h.push(S.x,S.y,S.z),y.push(Y.x,Y.y,Y.z),Q.push(G/x.w,P/x.h)}for(Y=0;Y<S.h;Y++)for(a=0;a<S.w;a++)V(E+a*m,v+Y*g,E+(a+1)*m,v+(Y+1)*g);const T=new c.c;return T.indices=D,T.uB=h,T.IB=y,T.CB=Q,T}function Y(B){const E=[],v=[],q=[],S=[];let x,D;const h=B.colorFilter||new o.gE(.3,.59,.11),Q=B.alphaFilter||0;let P=!1;if(B.minHeight>B.maxHeight){P=!0;const E=B.maxHeight;B.maxHeight=B.minHeight,B.minHeight=E}for(x=0;x<=B.subdivisions;x++)for(D=0;D<=B.subdivisions;D++){const E=new z.GE(D*B.width/B.subdivisions-B.width/2,0,(B.subdivisions-x)*B.height/B.subdivisions-B.height/2),o=4*(((E.x+B.width/2)/B.width*(B.bufferWidth-1)|0)+((1-(E.z+B.height/2)/B.height)*(B.bufferHeight-1)|0)*B.bufferWidth);let c=B.buffer[o]/255,G=B.buffer[o+1]/255,Y=B.buffer[o+2]/255;const a=B.buffer[o+3]/255;P&&(c=1-c,G=1-G,Y=1-Y);const m=c*h.r+G*h.g+Y*h.b;E.y=a>=Q?B.minHeight+(B.maxHeight-B.minHeight)*m:B.minHeight-y.e,B.heightBuffer&&(B.heightBuffer[x*(B.subdivisions+1)+D]=E.y),v.push(E.x,E.y,E.z),q.push(0,0,0),S.push(D/B.subdivisions,1-x/B.subdivisions)}for(x=0;x<B.subdivisions;x++)for(D=0;D<B.subdivisions;D++){const z=D+1+(x+1)*(B.subdivisions+1),o=D+1+x*(B.subdivisions+1),q=D+x*(B.subdivisions+1),c=D+(x+1)*(B.subdivisions+1),S=v[3*z+1]>=B.minHeight,h=v[3*o+1]>=B.minHeight,y=v[3*q+1]>=B.minHeight;S&&h&&y&&(E.push(z),E.push(o),E.push(q));v[3*c+1]>=B.minHeight&&S&&y&&(E.push(c),E.push(z),E.push(q))}c.c.ComputeNormals(v,E,q);const G=new c.c;return G.indices=E,G.uB=v,G.IB=q,G.CB=S,G}function a(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const v=new x(B,arguments.length>2?arguments[2]:void 0);v._setReady(!1),v._subdivisionsX=E.subdivisionsX||E.subdivisions||1,v._subdivisionsY=E.subdivisionsY||E.subdivisions||1,v._width=E.width||1,v._height=E.height||1,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ;return P(E).AB(v,E.updatable),v._setReady(!0),v}function m(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new q.e(B,v);return G(E).AB(z,E.updatable),z}function g(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=v.width||10,c=v.height||10,S=v.subdivisions||1,y=v.minHeight||0,Q=v.maxHeight||1,P=v.colorFilter||new o.gE(.3,.59,.11),G=v.alphaFilter||0,a=v.updatable,m=v.onReady;z=z||h.b.LastCreatedScene;const g=new x(B,z);let V;g._subdivisionsX=S,g._subdivisionsY=S,g._width=q,g._height=c,g._maxX=g._width/2,g._maxZ=g._height/2,g._minX=-g._maxX,g._minZ=-g._maxZ,g._setReady(!1),v.passHeightBufferInCallback&&(V=new Float32Array((S+1)*(S+1)));const T=(B,E,v)=>{Y({width:q,height:c,subdivisions:S,minHeight:y,maxHeight:Q,colorFilter:P,buffer:B,bufferWidth:E,bufferHeight:v,alphaFilter:G,heightBuffer:V}).AB(g,a),m&&m(g,V),g._setReady(!0)};if("string"===typeof E){const B=B=>{var E;const v=B.width,o=B.height;if(z.P)return;const q=null===(E=z)||void 0===E?void 0:E.getEngine().resizeImageBitmap(B,v,o);T(q,v,o)};D.Tools.LoadImage(E,B,v.onError?v.onError:()=>{},z.offlineProvider)}else T(E.data,E.width,E.height);return g}c.c.CreateGround=P,c.c.CreateTiledGround=G,c.c.CreateGroundFromHeightMap=Y,q.e.CreateGround=(B,E,v,z,o,q)=>a(B,{width:E,height:v,subdivisions:z,updatable:q},o),q.e.CreateTiledGround=(B,E,v,z,o,q,c,S,x)=>m(B,{xmin:E,zmin:v,xmax:z,zmax:o,subdivisions:q,precision:c,updatable:x},S),q.e.CreateGroundFromHeightMap=(B,E,v,z,o,q,c,S,x,D,h)=>g(B,E,{width:v,height:z,subdivisions:o,minHeight:q,maxHeight:c,updatable:x,onReady:D,alphaFilter:h},S)},13268:(B,E,v)=>{"use strict";v.d(E,{b:()=>P,f:()=>y,g:()=>Q});var z=v(11380),o=v(11833),q=v(11822),c=v(11929),S=v(11442),x=v(11213);function D(B){const E=[],v=[],z=B.lines,o=B.KB,c=[];let S=0;for(let q=0;q<z.length;q++){const B=z[q];for(let z=0;z<B.length;z++){const{x:x,y:D,z:h}=B[z];if(v.push(x,D,h),o){const B=o[q],{r:E,g:v,b:S,a:x}=B[z];c.push(E,v,S,x)}z>0&&(E.push(S-1),E.push(S)),S++}}const x=new q.c;return x.indices=E,x.uB=v,o&&(x.KB=c),x}function h(B){const E=B.dashSize||3,v=B.gapSize||1,o=B.dashNb||200,c=B.points,S=[],x=[],D=z.GE.Zero();let h=0,y=0,Q=0,P=0,G=0,Y=0,a=0;for(a=0;a<c.length-1;a++)c[a+1].subtractToRef(c[a],D),h+=D.length();for(Q=h/o,P=E*Q/(E+v),a=0;a<c.length-1;a++){c[a+1].subtractToRef(c[a],D),y=Math.floor(D.length()/Q),D.normalize();for(let B=0;B<y;B++)G=Q*B,S.push(c[a].x+G*D.x,c[a].y+G*D.y,c[a].z+G*D.z),S.push(c[a].x+(G+P)*D.x,c[a].y+(G+P)*D.y,c[a].z+(G+P)*D.z),x.push(Y,Y+1),Y+=2}const m=new q.c;return m.uB=S,m.indices=x,m}function y(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.instance,o=E.lines,q=E.KB;if(z){const B=z.getVerticesData(S.e.PositionKind);let E,v;q&&(E=z.getVerticesData(S.e.ColorKind));let c=0,x=0;for(let z=0;z<o.length;z++){const S=o[z];for(let o=0;o<S.length;o++)B[c]=S[o].x,B[c+1]=S[o].y,B[c+2]=S[o].z,q&&E&&(v=q[z],E[x]=v[o].r,E[x+1]=v[o].g,E[x+2]=v[o].b,E[x+3]=v[o].a,x+=4),c+=3}return z.updateVerticesData(S.e.PositionKind,B,!1,!1),q&&E&&z.updateVerticesData(S.e.ColorKind,E,!1,!1),z.refreshBoundingInfo(),z}const x=!!q,h=new c.b(B,v,null,void 0,void 0,x,E.useVertexAlpha,E.material);return D(E).AB(h,E.updatable),h}function Q(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.KB?[E.KB]:null;return y(B,{lines:[E.points],updatable:E.updatable,instance:E.instance,KB:z,useVertexAlpha:E.useVertexAlpha,material:E.material},v)}function P(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=E.points,S=E.instance,D=E.gapSize||1,y=E.dashSize||3;if(S){const B=B=>{const E=z.GE.Zero(),v=B.length/6;let o=0,c=0,x=0,D=0,h=0,y=0,Q=0,P=0;for(Q=0;Q<q.length-1;Q++)q[Q+1].subtractToRef(q[Q],E),o+=E.length();x=o/v;const G=S._creationDataStorage.dashSize;for(D=G*x/(G+S._creationDataStorage.gapSize),Q=0;Q<q.length-1;Q++)for(q[Q+1].subtractToRef(q[Q],E),c=Math.floor(E.length()/x),E.normalize(),P=0;P<c&&y<B.length;)h=x*P,B[y]=q[Q].x+h*E.x,B[y+1]=q[Q].y+h*E.y,B[y+2]=q[Q].z+h*E.z,B[y+3]=q[Q].x+(h+D)*E.x,B[y+4]=q[Q].y+(h+D)*E.y,B[y+5]=q[Q].z+(h+D)*E.z,y+=6,P++;for(;y<B.length;)B[y]=q[Q].x,B[y+1]=q[Q].y,B[y+2]=q[Q].z,y+=3};return(E.dashNb||E.dashSize||E.gapSize||E.useVertexAlpha||E.material)&&x.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),S.updateMeshPositions(B,!1),S}const Q=new c.b(B,v,null,void 0,void 0,void 0,E.useVertexAlpha,E.material);return h(E).AB(Q,E.updatable),Q._creationDataStorage=new o.i,Q._creationDataStorage.dashSize=y,Q._creationDataStorage.gapSize=D,Q}q.c.CreateLineSystem=D,q.c.CreateDashedLines=h,o.e.RD=function(B,E){return Q(B,{points:E,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},o.e.CreateDashedLines=function(B,E,v,z,o){return P(B,{points:E,dashSize:v,gapSize:z,dashNb:o,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12671:(B,E,v)=>{"use strict";v.d(E,{d:()=>S,g:()=>x});var z=v(11833),o=v(11822),q=v(11425);function c(B){const E=[],v=[],z=[],c=[],S=void 0!==B.width?B.width:void 0!==B.size?B.size:1,x=void 0!==B.height?B.height:void 0!==B.size?B.size:1,D=0===B.sideOrientation?0:B.sideOrientation||o.c.DEFAULTSIDE,h=S/2,y=x/2;v.push(-h,-y,0),z.push(0,0,-1),c.push(0,q.c?1:0),v.push(h,-y,0),z.push(0,0,-1),c.push(1,q.c?1:0),v.push(h,y,0),z.push(0,0,-1),c.push(1,q.c?0:1),v.push(-h,y,0),z.push(0,0,-1),c.push(0,q.c?0:1),E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),o.c._ComputeSides(D,v,E,z,c,B.frontUVs,B.backUVs);const Q=new o.c;return Q.indices=E,Q.uB=v,Q.IB=z,Q.CB=c,Q}function S(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new z.e(B,v);E.sideOrientation=z.e._GetDefaultSideOrientation(E.sideOrientation),o._originalBuilderSideOrientation=E.sideOrientation;return c(E).AB(o,E.updatable),E.sourcePlane&&(o.translate(E.sourcePlane.normal,-E.sourcePlane.d),o.setDirection(E.sourcePlane.normal.scale(-1))),o}const x={WD:S};o.c.WD=c,z.e.WD=(B,E,v,z,o)=>S(B,{size:E,width:E,height:E,sideOrientation:o,updatable:z},v)},12766:(B,E,v)=>{"use strict";v.d(E,{c:()=>x});var z=v(11380),o=v(11833),q=v(11822),c=v(11425);function S(B){const E=0|(B.segments||32),v=B.diameterX||B.diameter||1,o=B.diameterY||B.diameter||1,S=B.diameterZ||B.diameter||1,x=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,D=B.slice&&B.slice<=0?1:B.slice||1,h=0===B.sideOrientation?0:B.sideOrientation||q.c.DEFAULTSIDE,y=!!B.dedupTopBottomIndices,Q=new z.GE(v/2,o/2,S/2),P=2+E,G=2*P,Y=[],a=[],m=[],g=[];for(let q=0;q<=P;q++){const B=q/P,E=B*Math.PI*D;for(let v=0;v<=G;v++){const o=v/G,q=o*Math.PI*2*x,S=z.Matrix.RotationZ(-E),D=z.Matrix.RotationY(q),h=z.GE.TransformCoordinates(z.GE.Up(),S),y=z.GE.TransformCoordinates(h,D),P=y.multiply(Q),Y=y.divide(Q).normalize();a.push(P.x,P.y,P.z),m.push(Y.x,Y.y,Y.z),g.push(o,c.c?1-B:B)}if(q>0){const B=a.length/3;for(let E=B-2*(G+1);E+G+2<B;E++)y?(q>1&&(Y.push(E),Y.push(E+1),Y.push(E+G+1)),(q<P||D<1)&&(Y.push(E+G+1),Y.push(E+1),Y.push(E+G+2))):(Y.push(E),Y.push(E+1),Y.push(E+G+1),Y.push(E+G+1),Y.push(E+1),Y.push(E+G+2))}}q.c._ComputeSides(h,a,Y,m,g,B.frontUVs,B.backUVs);const V=new q.c;return V.indices=Y,V.uB=a,V.IB=m,V.CB=g,V}function x(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return S(E).AB(z,E.updatable),z}q.c.CreateSphere=S,o.e.CreateSphere=(B,E,v,z,o,q)=>x(B,{segments:E,diameterX:v,diameterY:v,diameterZ:v,sideOrientation:q,updatable:o},z)},13579:(B,E,v)=>{"use strict";v.d(E,{e:()=>S});var z=v(11958),o=v(13078),q=v(11980),c=v(11822);class S{static get Configuration(){return{get decoder(){return o.c.DefaultConfiguration},set decoder(B){o.c.DefaultConfiguration=B}}}static set Configuration(B){o.c.DefaultConfiguration=B.decoder}static get DecoderAvailable(){return(0,z.j)(o.c.DefaultConfiguration)}static get Default(){return S._Default??(S._Default=new S),S._Default}static ResetDefault(B){S._Default&&(B||S._Default.dispose(),S._Default=null)}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.DefaultNumWorkers;const E="number"===typeof B?{...o.c.DefaultConfiguration,numWorkers:B}:{...o.c.DefaultConfiguration,...B};this._decoder=new o.c(E)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(B,E,v){return this._decoder.decodeMeshToMeshDataAsync(B,E,v)}async decodeMeshToGeometryAsync(B,E,v,z){return await this._decoder.decodeMeshToGeometryAsync(B,E,v,z)}async _decodeMeshToGeometryForGltfAsync(B,E,v,z,o,q){return await this._decoder._decodeMeshToGeometryForGltfAsync(B,E,v,z,o,q)}async decodeMeshAsync(B,E){const v=await this._decoder.decodeMeshToMeshDataAsync(B,E),z=new c.c;v.indices&&(z.indices=v.indices);for(const o of v.attributes){const B=q.e.GetFloatData(o.data,o.size,q.e.GetDataType(o.data),o.byteOffset,o.byteStride,o.normalized,v.totalVertices);z.set(B,o.kind)}return z}}S.DefaultNumWorkers=(0,z.f)(),S._Default=null},13078:(B,E,v)=>{"use strict";v.d(E,{c:()=>D});var z=v(11958),o=v(11193),q=v(11848),c=v(11980),S=v(11213),x=v(11976);class D extends z.b{static get DefaultAvailable(){return(0,z.j)(D.DefaultConfiguration)}static get Default(){return D._Default??(D._Default=new D),D._Default}static ResetDefault(B){D._Default&&(B||D._Default.dispose(),D._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(B,E){return{module:await(E||DracoDecoderModule)({wasmBinary:B})}}_getWorkerContent(){return`${x.d}(${x.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.DefaultConfiguration)}decodeMeshToMeshDataAsync(B,E,v){const z=B instanceof ArrayBuffer?new Int8Array(B):new Int8Array(B.buffer,B.byteOffset,B.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async B=>await new Promise(((o,q)=>{B.push(((B,c)=>{let x=null;const D=[],h=E=>{B.removeEventListener("error",h),B.removeEventListener("message",y),q(E),c()},y=E=>{const z=E.data;switch(z.id){case"indices":x=z.data;break;case"attribute":D.push({kind:z.kind,data:z.data,size:z.size,byteOffset:z.byteOffset,byteStride:z.byteStride,normalized:(q=z.kind,Q=z.normalized,v&&void 0!==v[q]?(Q!==v[q]&&S.c.Warn(`Normalized flag from Draco data (${Q}) does not match normalized flag from glTF accessor (${v[q]}). Using flag from glTF accessor.`),v[q]):Q)});break;case"decodeMeshDone":B.removeEventListener("error",h),B.removeEventListener("message",y),o({indices:x,attributes:D,totalVertices:z.totalVertices}),c()}var q,Q};B.addEventListener("error",h),B.addEventListener("message",y);const Q=z.slice();B.postMessage({id:"decodeMesh",dataView:Q,attributes:E},[Q.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((B=>{let v=null;const o=[],q=(0,x.d)(B.module,z,E,(B=>{v=B}),((B,E,v,z,q,c)=>{o.push({kind:B,data:E,size:v,byteOffset:z,byteStride:q,normalized:c})}));return{indices:v,attributes:o,totalVertices:q}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(B,E,v,z){const o=await this.decodeMeshToMeshDataAsync(v,z),S=new q.b(B,E);o.indices&&S.setIndices(o.indices);for(const q of o.attributes)S.setVerticesBuffer(new c.e(E.getEngine(),q.data,q.kind,!1,void 0,q.byteStride,void 0,q.byteOffset,q.size,void 0,q.normalized,!0),o.totalVertices);return S}async _decodeMeshToGeometryForGltfAsync(B,E,v,z,o,S){const x=await this.decodeMeshToMeshDataAsync(v,z,o),D=new q.b(B,E);S&&(D._boundingInfo=S,D.useBoundingInfoFromGeometry=!0),x.indices&&D.setIndices(x.indices);for(const q of x.attributes)D.setVerticesBuffer(new c.e(E.getEngine(),q.data,q.kind,!1,void 0,q.byteStride,void 0,q.byteOffset,q.size,void 0,q.normalized,!0),x.totalVertices);return D}}D.DefaultConfiguration={wasmUrl:`${o.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${o.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${o.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},D._Default=null},13264:(B,E,v)=>{"use strict";v.d(E,{b:()=>SB});var z=v(11380),o=v(11833),q=v(11442),c=v(11822),S=v(11425);function x(B){let E=B.pathArray;const v=B.closeArray||!1,z=B.closePath||!1,o=B.invertUV||!1,x=Math.floor(E[0].length/2);let D=B.offset||x;D=D>x?x:Math.floor(D);const h=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,y=B.CB,Q=B.KB,P=[],G=[],Y=[],a=[],m=[],g=[],V=[],T=[];let N;const X=[],r=[];let i,u,I;if(E.length<2){const B=[],v=[];for(u=0;u<E[0].length-D;u++)B.push(E[0][u]),v.push(E[0][u+D]);E=[B,v]}let K=0;const C=z?1:0,f=v?1:0;let A,l,d,t,p,H;for(N=E[0].length,i=0;i<E.length+f;i++){for(V[i]=0,m[i]=[0],A=i===E.length?E[0]:E[i],l=A.length,N=N<l?N:l,I=0;I<l;)P.push(A[I].x,A[I].y,A[I].z),I>0&&(d=A[I].YE(A[I-1]).length(),t=d+V[i],m[i].push(t),V[i]=t),I++;z&&(I--,P.push(A[0].x,A[0].y,A[0].z),d=A[I].YE(A[0]).length(),t=d+V[i],m[i].push(t),V[i]=t),X[i]=l+C,r[i]=K,K+=l+C}let j,R,b=null,F=null;for(u=0;u<N+C;u++)for(T[u]=0,g[u]=[0],i=0;i<E.length-1+f;i++)p=E[i],H=i===E.length-1?E[0]:E[i+1],u===N?(b=p[0],F=H[0]):(b=p[u],F=H[u]),d=F.YE(b).length(),t=d+T[u],g[u].push(t),T[u]=t;if(y)for(i=0;i<y.length;i++)a.push(y[i].x,S.c?1-y[i].y:y[i].y);else for(i=0;i<E.length+f;i++)for(u=0;u<N+C;u++)j=0!=V[i]?m[i][u]/V[i]:0,R=0!=T[u]?g[u][i]/T[u]:0,o?a.push(R,j):a.push(j,S.c?1-R:R);i=0;let W=0,w=X[i]-1,n=X[i+1]-1,U=w<n?w:n,s=r[1]-r[0];const J=X.length-1;for(;W<=U&&i<J;)G.push(W,W+s,W+1),G.push(W+s+1,W+1,W+s),W+=1,W===U&&(i++,s=r[i+1]-r[i],w=X[i]-1,n=X[i+1]-1,W=r[i],U=w<n?w+W:n+W);if(c.c.ComputeNormals(P,G,Y),z){let B=0,v=0;for(i=0;i<E.length;i++){B=3*r[i],v=i+1<E.length?3*(r[i+1]-1):Y.length-3,Y[B]=.5*(Y[B]+Y[v]),Y[B+1]=.5*(Y[B+1]+Y[v+1]),Y[B+2]=.5*(Y[B+2]+Y[v+2]);const z=Math.sqrt(Y[B]*Y[B]+Y[B+1]*Y[B+1]+Y[B+2]*Y[B+2]);Y[B]/=z,Y[B+1]/=z,Y[B+2]/=z,Y[v]=Y[B],Y[v+1]=Y[B+1],Y[v+2]=Y[B+2]}}if(v){let B=3*r[0],v=3*r[E.length];for(u=0;u<N+C;u++){Y[B]=.5*(Y[B]+Y[v]),Y[B+1]=.5*(Y[B+1]+Y[v+1]),Y[B+2]=.5*(Y[B+2]+Y[v+2]);const E=Math.sqrt(Y[B]*Y[B]+Y[B+1]*Y[B+1]+Y[B+2]*Y[B+2]);Y[B]/=E,Y[B+1]/=E,Y[B+2]/=E,Y[v]=Y[B],Y[v+1]=Y[B+1],Y[v+2]=Y[B+2],B+=3,v+=3}}c.c._ComputeSides(h,P,G,Y,a,B.frontUVs,B.backUVs);let O=null;if(Q){O=new Float32Array(4*Q.length);for(let B=0;B<Q.length;B++)O[4*B]=Q[B].r,O[4*B+1]=Q[B].g,O[4*B+2]=Q[B].b,O[4*B+3]=Q[B].a}const e=new c.c,k=new Float32Array(P),L=new Float32Array(Y),M=new Float32Array(a);return e.indices=G,e.uB=k,e.IB=L,e.CB=M,O&&e.set(O,q.e.ColorKind),z&&(e._idx=r),e}function D(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=E.pathArray,h=E.closeArray,y=E.closePath,Q=o.e._GetDefaultSideOrientation(E.sideOrientation),P=E.instance,G=E.updatable;if(P){const B=z.TmpVectors.GE[0].mc(Number.MAX_VALUE),v=z.TmpVectors.GE[1].mc(-Number.MAX_VALUE),x=E=>{let z=D[0].length;const q=P;let c=0;const S=q._originalBuilderSideOrientation===o.e.DOUBLESIDE?2:1;for(let o=1;o<=S;++o)for(let S=0;S<D.length;++S){const o=D[S],x=o.length;z=z<x?z:x;for(let q=0;q<z;++q){const z=o[q];E[c]=z.x,E[c+1]=z.y,E[c+2]=z.z,B.minimizeInPlaceFromFloats(z.x,z.y,z.z),v.maximizeInPlaceFromFloats(z.x,z.y,z.z),c+=3}if(q._creationDataStorage&&q._creationDataStorage.closePath){const B=o[0];E[c]=B.x,E[c+1]=B.y,E[c+2]=B.z,c+=3}}},h=P.getVerticesData(q.e.PositionKind);if(x(h),P.hasBoundingInfo?P.getBoundingInfo().reConstruct(B,v,P._worldMatrix):P.buildBoundingInfo(B,v,P._worldMatrix),P.updateVerticesData(q.e.PositionKind,h,!1,!1),E.KB){const B=P.getVerticesData(q.e.ColorKind);for(let v=0,z=0;v<E.KB.length;v++,z+=4){const o=E.KB[v];B[z]=o.r,B[z+1]=o.g,B[z+2]=o.b,B[z+3]=o.a}P.updateVerticesData(q.e.ColorKind,B,!1,!1)}if(E.CB){const B=P.getVerticesData(q.e.UVKind);for(let v=0;v<E.CB.length;v++)B[2*v]=E.CB[v].x,B[2*v+1]=S.c?1-E.CB[v].y:E.CB[v].y;P.updateVerticesData(q.e.UVKind,B,!1,!1)}if(!P.areNormalsFrozen||P.isFacetDataEnabled){const B=P.Pc(),E=P.getVerticesData(q.e.NormalKind),v=P.isFacetDataEnabled?P.getFacetDataParameters():null;if(c.c.ComputeNormals(h,B,E,v),P._creationDataStorage&&P._creationDataStorage.closePath){let B=0,v=0;for(let z=0;z<D.length;z++)B=3*P._creationDataStorage.idx[z],v=z+1<D.length?3*(P._creationDataStorage.idx[z+1]-1):E.length-3,E[B]=.5*(E[B]+E[v]),E[B+1]=.5*(E[B+1]+E[v+1]),E[B+2]=.5*(E[B+2]+E[v+2]),E[v]=E[B],E[v+1]=E[B+1],E[v+2]=E[B+2]}P.areNormalsFrozen||P.updateVerticesData(q.e.NormalKind,E,!1,!1)}return P}{const z=new o.e(B,v);z._originalBuilderSideOrientation=Q,z._creationDataStorage=new o.i;const q=x(E);return y&&(z._creationDataStorage.idx=q._idx),z._creationDataStorage.closePath=y,z._creationDataStorage.closeArray=h,q.AB(z,G),z}}c.c.CreateRibbon=x,o.e.CreateRibbon=function(B,E){return D(B,{pathArray:E,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var h=v(12772),y=v(12602),Q=v(11417);function P(B){const E=B.pattern||o.e.NO_FLIP,v=B.tileWidth||B.tileSize||1,z=B.tileHeight||B.tileSize||1,q=B.alignHorizontal||0,S=B.alignVertical||0,x=B.width||B.size||1,D=Math.floor(x/v);let h=x-D*v;const y=B.height||B.size||1,Q=Math.floor(y/z);let P=y-Q*z;const G=v*D/2,Y=z*Q/2;let a=0,m=0,g=0,V=0,T=0,N=0;if(h>0||P>0){switch(g=-G,V=-Y,T=G,N=Y,q){case o.e.CENTER:h/=2,g-=h,T+=h;break;case o.e.LEFT:T+=h,a=-h/2;break;case o.e.RIGHT:g-=h,a=h/2}switch(S){case o.e.CENTER:P/=2,V-=P,N+=P;break;case o.e.BOTTOM:N+=P,m=-P/2;break;case o.e.TOP:V-=P,m=P/2}}const X=[],r=[],i=[];i[0]=[0,0,1,0,1,1,0,1],i[1]=[0,0,1,0,1,1,0,1],E!==o.e.ROTATE_TILE&&E!==o.e.ROTATE_ROW||(i[1]=[1,1,0,1,0,0,1,0]),E!==o.e.FLIP_TILE&&E!==o.e.FLIP_ROW||(i[1]=[1,0,0,0,0,1,1,1]),E!==o.e.FLIP_N_ROTATE_TILE&&E!==o.e.FLIP_N_ROTATE_ROW||(i[1]=[0,1,1,1,1,0,0,0]);let u=[];const I=[],K=[];let C=0;for(let c=0;c<Q;c++)for(let B=0;B<D;B++)X.push(B*v-G+a,c*z-Y+m,0),X.push((B+1)*v-G+a,c*z-Y+m,0),X.push((B+1)*v-G+a,(c+1)*z-Y+m,0),X.push(B*v-G+a,(c+1)*z-Y+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),u=E===o.e.FLIP_TILE||E===o.e.ROTATE_TILE||E===o.e.FLIP_N_ROTATE_TILE?u.concat(i[(B%2+c%2)%2]):E===o.e.FLIP_ROW||E===o.e.ROTATE_ROW||E===o.e.FLIP_N_ROTATE_ROW?u.concat(i[c%2]):u.concat(i[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),C+=4;if(h>0||P>0){const B=P>0&&(S===o.e.CENTER||S===o.e.TOP),c=P>0&&(S===o.e.CENTER||S===o.e.BOTTOM),x=h>0&&(q===o.e.CENTER||q===o.e.RIGHT),y=h>0&&(q===o.e.CENTER||q===o.e.LEFT);let i,f,A,l,d=[];if(B&&x&&(X.push(g+a,V+m,0),X.push(-G+a,V+m,0),X.push(-G+a,V+P+m,0),X.push(g+a,V+P+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,i=1-h/v,f=1-P/z,A=1,l=1,d=[i,f,A,f,A,l,i,l],E===o.e.ROTATE_ROW&&(d=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),E===o.e.FLIP_ROW&&(d=[1-i,f,1-A,f,1-A,l,1-i,l]),E===o.e.FLIP_N_ROTATE_ROW&&(d=[i,1-f,A,1-f,A,1-l,i,1-l]),u=u.concat(d),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&y&&(X.push(G+a,V+m,0),X.push(T+a,V+m,0),X.push(T+a,V+P+m,0),X.push(G+a,V+P+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,i=0,f=1-P/z,A=h/v,l=1,d=[i,f,A,f,A,l,i,l],(E===o.e.ROTATE_ROW||E===o.e.ROTATE_TILE&&D%2===0)&&(d=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),(E===o.e.FLIP_ROW||E===o.e.FLIP_TILE&&D%2===0)&&(d=[1-i,f,1-A,f,1-A,l,1-i,l]),(E===o.e.FLIP_N_ROTATE_ROW||E===o.e.FLIP_N_ROTATE_TILE&&D%2===0)&&(d=[i,1-f,A,1-f,A,1-l,i,1-l]),u=u.concat(d),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c&&x&&(X.push(g+a,Y+m,0),X.push(-G+a,Y+m,0),X.push(-G+a,N+m,0),X.push(g+a,N+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,i=1-h/v,f=0,A=1,l=P/z,d=[i,f,A,f,A,l,i,l],(E===o.e.ROTATE_ROW&&Q%2===1||E===o.e.ROTATE_TILE&&Q%1===0)&&(d=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),(E===o.e.FLIP_ROW&&Q%2===1||E===o.e.FLIP_TILE&&Q%2===0)&&(d=[1-i,f,1-A,f,1-A,l,1-i,l]),(E===o.e.FLIP_N_ROTATE_ROW&&Q%2===1||E===o.e.FLIP_N_ROTATE_TILE&&Q%2===0)&&(d=[i,1-f,A,1-f,A,1-l,i,1-l]),u=u.concat(d),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c&&y&&(X.push(G+a,Y+m,0),X.push(T+a,Y+m,0),X.push(T+a,N+m,0),X.push(G+a,N+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,i=0,f=0,A=h/v,l=P/z,d=[i,f,A,f,A,l,i,l],(E===o.e.ROTATE_ROW&&Q%2===1||E===o.e.ROTATE_TILE&&(Q+D)%2===1)&&(d=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),(E===o.e.FLIP_ROW&&Q%2===1||E===o.e.FLIP_TILE&&(Q+D)%2===1)&&(d=[1-i,f,1-A,f,1-A,l,1-i,l]),(E===o.e.FLIP_N_ROTATE_ROW&&Q%2===1||E===o.e.FLIP_N_ROTATE_TILE&&(Q+D)%2===1)&&(d=[i,1-f,A,1-f,A,1-l,i,1-l]),u=u.concat(d),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B){const B=[];i=0,f=1-P/z,A=1,l=1,B[0]=[i,f,A,f,A,l,i,l],B[1]=[i,f,A,f,A,l,i,l],E!==o.e.ROTATE_TILE&&E!==o.e.ROTATE_ROW||(B[1]=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),E!==o.e.FLIP_TILE&&E!==o.e.FLIP_ROW||(B[1]=[1-i,f,1-A,f,1-A,l,1-i,l]),E!==o.e.FLIP_N_ROTATE_TILE&&E!==o.e.FLIP_N_ROTATE_ROW||(B[1]=[i,1-f,A,1-f,A,1-l,i,1-l]);for(let z=0;z<D;z++)X.push(z*v-G+a,V+m,0),X.push((z+1)*v-G+a,V+m,0),X.push((z+1)*v-G+a,V+P+m,0),X.push(z*v-G+a,V+P+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,u=E===o.e.FLIP_TILE||E===o.e.ROTATE_TILE||E===o.e.FLIP_N_ROTATE_TILE?u.concat(B[(z+1)%2]):E===o.e.FLIP_ROW||E===o.e.ROTATE_ROW||E===o.e.FLIP_N_ROTATE_ROW?u.concat(B[1]):u.concat(B[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const B=[];i=0,f=0,A=1,l=P/z,B[0]=[i,f,A,f,A,l,i,l],B[1]=[i,f,A,f,A,l,i,l],E!==o.e.ROTATE_TILE&&E!==o.e.ROTATE_ROW||(B[1]=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),E!==o.e.FLIP_TILE&&E!==o.e.FLIP_ROW||(B[1]=[1-i,f,1-A,f,1-A,l,1-i,l]),E!==o.e.FLIP_N_ROTATE_TILE&&E!==o.e.FLIP_N_ROTATE_ROW||(B[1]=[i,1-f,A,1-f,A,1-l,i,1-l]);for(let z=0;z<D;z++)X.push(z*v-G+a,N-P+m,0),X.push((z+1)*v-G+a,N-P+m,0),X.push((z+1)*v-G+a,N+m,0),X.push(z*v-G+a,N+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,u=E===o.e.FLIP_TILE||E===o.e.ROTATE_TILE||E===o.e.FLIP_N_ROTATE_TILE?u.concat(B[(z+Q)%2]):E===o.e.FLIP_ROW||E===o.e.ROTATE_ROW||E===o.e.FLIP_N_ROTATE_ROW?u.concat(B[Q%2]):u.concat(B[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const B=[];i=1-h/v,f=0,A=1,l=1,B[0]=[i,f,A,f,A,l,i,l],B[1]=[i,f,A,f,A,l,i,l],E!==o.e.ROTATE_TILE&&E!==o.e.ROTATE_ROW||(B[1]=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),E!==o.e.FLIP_TILE&&E!==o.e.FLIP_ROW||(B[1]=[1-i,f,1-A,f,1-A,l,1-i,l]),E!==o.e.FLIP_N_ROTATE_TILE&&E!==o.e.FLIP_N_ROTATE_ROW||(B[1]=[i,1-f,A,1-f,A,1-l,i,1-l]);for(let v=0;v<Q;v++)X.push(g+a,v*z-Y+m,0),X.push(g+h+a,v*z-Y+m,0),X.push(g+h+a,(v+1)*z-Y+m,0),X.push(g+a,(v+1)*z-Y+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,u=E===o.e.FLIP_TILE||E===o.e.ROTATE_TILE||E===o.e.FLIP_N_ROTATE_TILE?u.concat(B[(v+1)%2]):E===o.e.FLIP_ROW||E===o.e.ROTATE_ROW||E===o.e.FLIP_N_ROTATE_ROW?u.concat(B[v%2]):u.concat(B[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const B=[];i=0,f=0,A=h/z,l=1,B[0]=[i,f,A,f,A,l,i,l],B[1]=[i,f,A,f,A,l,i,l],E!==o.e.ROTATE_TILE&&E!==o.e.ROTATE_ROW||(B[1]=[1-i,1-f,1-A,1-f,1-A,1-l,1-i,1-l]),E!==o.e.FLIP_TILE&&E!==o.e.FLIP_ROW||(B[1]=[1-i,f,1-A,f,1-A,l,1-i,l]),E!==o.e.FLIP_N_ROTATE_TILE&&E!==o.e.FLIP_N_ROTATE_ROW||(B[1]=[i,1-f,A,1-f,A,1-l,i,1-l]);for(let v=0;v<Q;v++)X.push(T-h+a,v*z-Y+m,0),X.push(T+a,v*z-Y+m,0),X.push(T+a,(v+1)*z-Y+m,0),X.push(T-h+a,(v+1)*z-Y+m,0),K.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,u=E===o.e.FLIP_TILE||E===o.e.ROTATE_TILE||E===o.e.FLIP_N_ROTATE_TILE?u.concat(B[(v+D)%2]):E===o.e.FLIP_ROW||E===o.e.ROTATE_ROW||E===o.e.FLIP_N_ROTATE_ROW?u.concat(B[v%2]):u.concat(B[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const f=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE;c.c._ComputeSides(f,X,K,r,u,B.frontUVs,B.backUVs);const A=new c.c;A.indices=K,A.uB=X,A.IB=r,A.CB=u;const l=f===c.c.DOUBLESIDE?I.concat(I):I;return A.KB=l,A}function G(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return P(E).AB(z,E.updatable),z}function Y(B){const E=B.faceUV||new Array(6),v=B.faceColors,q=B.pattern||o.e.NO_FLIP,x=B.width||B.size||1,D=B.height||B.size||1,h=B.depth||B.size||1,y=B.tileWidth||B.tileSize||1,G=B.tileHeight||B.tileSize||1,Y=B.alignHorizontal||0,a=B.alignVertical||0,m=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE;for(let o=0;o<6;o++)void 0===E[o]&&(E[o]=new z.Vector4(0,0,1,1)),v&&void 0===v[o]&&(v[o]=new Q.gc(1,1,1,1));const g=x/2,V=D/2,T=h/2,N=[];for(let z=0;z<2;z++)N[z]=P({pattern:q,tileWidth:y,tileHeight:G,width:x,height:D,alignVertical:a,alignHorizontal:Y,sideOrientation:m});for(let z=2;z<4;z++)N[z]=P({pattern:q,tileWidth:y,tileHeight:G,width:h,height:D,alignVertical:a,alignHorizontal:Y,sideOrientation:m});let X=a;a===o.e.BOTTOM?X=o.e.TOP:a===o.e.TOP&&(X=o.e.BOTTOM);for(let z=4;z<6;z++)N[z]=P({pattern:q,tileWidth:y,tileHeight:G,width:x,height:h,alignVertical:X,alignHorizontal:Y,sideOrientation:m});let r=[],i=[],u=[],I=[];const K=[],C=[],f=[],A=[];let l=0,d=0;for(let o=0;o<6;o++){const B=N[o].uB.length;C[o]=[],f[o]=[];for(let E=0;E<B/3;E++)C[o].push(new z.GE(N[o].uB[3*E],N[o].uB[3*E+1],N[o].uB[3*E+2])),f[o].push(new z.GE(N[o].IB[3*E],N[o].IB[3*E+1],N[o].IB[3*E+2]));l=N[o].CB.length,A[o]=[];for(let v=0;v<l;v+=2)A[o][v]=E[o].x+(E[o].z-E[o].x)*N[o].CB[v],A[o][v+1]=E[o].y+(E[o].w-E[o].y)*N[o].CB[v+1],S.c&&(A[o][v+1]=1-A[o][v+1]);if(u=u.concat(A[o]),I=I.concat(N[o].indices.map((B=>B+d))),d+=C[o].length,v)for(let E=0;E<4;E++)K.push(v[o].r,v[o].g,v[o].b,v[o].a)}const t=new z.GE(0,0,T),p=z.Matrix.RotationY(Math.PI);r=C[0].map((B=>z.GE.TransformNormal(B,p).add(t))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[]),i=f[0].map((B=>z.GE.TransformNormal(B,p))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[]),r=r.concat(C[1].map((B=>B.YE(t))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[])),i=i.concat(f[1].map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[]));const H=new z.GE(g,0,0),j=z.Matrix.RotationY(-Math.PI/2);r=r.concat(C[2].map((B=>z.GE.TransformNormal(B,j).add(H))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[])),i=i.concat(f[2].map((B=>z.GE.TransformNormal(B,j))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[]));const R=z.Matrix.RotationY(Math.PI/2);r=r.concat(C[3].map((B=>z.GE.TransformNormal(B,R).YE(H))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[])),i=i.concat(f[3].map((B=>z.GE.TransformNormal(B,R))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[]));const b=new z.GE(0,V,0),F=z.Matrix.RotationX(Math.PI/2);r=r.concat(C[4].map((B=>z.GE.TransformNormal(B,F).add(b))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[])),i=i.concat(f[4].map((B=>z.GE.TransformNormal(B,F))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[]));const W=z.Matrix.RotationX(-Math.PI/2);r=r.concat(C[5].map((B=>z.GE.TransformNormal(B,W).YE(b))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[])),i=i.concat(f[5].map((B=>z.GE.TransformNormal(B,W))).map((B=>[B.x,B.y,B.z])).reduce(((B,E)=>B.concat(E)),[])),c.c._ComputeSides(m,r,I,i,u);const w=new c.c;if(w.indices=I,w.uB=r,w.IB=i,w.CB=u,v){const B=m===c.c.DOUBLESIDE?K.concat(K):K;w.KB=B}return w}function a(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return Y(E).AB(z,E.updatable),z}c.c.CreateTiledPlane=P;c.c.CreateTiledBox=Y;var m=v(12766),g=v(11601),V=v(11562);function T(B){const E=B.height||2;let v=0===B.diameterTop?0:B.diameterTop||B.diameter||1,q=0===B.diameterBottom?0:B.diameterBottom||B.diameter||1;v=v||1e-5,q=q||1e-5;const x=0|(B.tessellation||24),D=0|(B.subdivisions||1),h=!!B.hasRings,y=!!B.enclose,P=0===B.cap?0:B.cap||o.e.CAP_ALL,G=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,Y=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,a=B.faceUV||new Array(3),m=B.faceColors,g=2+(1+(1!==G&&y?2:0))*(h?D:1);let T;for(T=0;T<g;T++)m&&void 0===m[T]&&(m[T]=new Q.gc(1,1,1,1));for(T=0;T<g;T++)a&&void 0===a[T]&&(a[T]=new z.Vector4(0,0,1,1));const N=[],X=[],r=[],i=[],u=[],I=2*Math.PI*G/x;let K,C,f;const A=(q-v)/2/E,l=z.GE.Zero(),d=z.GE.Zero(),t=z.GE.Zero(),p=z.GE.Zero(),H=z.GE.Zero(),j=V.c.Y;let R,b,F,W=1,w=1,n=0,U=0;for(R=0;R<=D;R++)for(C=R/D,f=(C*(v-q)+q)/2,W=h&&0!==R&&R!==D?2:1,F=0;F<W;F++){for(h&&(w+=F),y&&(w+=2*F),b=0;b<=x;b++)K=b*I,l.x=Math.cos(-K)*f,l.y=-E/2+C*E,l.z=Math.sin(-K)*f,0===v&&R===D?(d.x=r[r.length-3*(x+1)],d.y=r[r.length-3*(x+1)+1],d.z=r[r.length-3*(x+1)+2]):(d.x=l.x,d.z=l.z,d.y=Math.sqrt(d.x*d.x+d.z*d.z)*A,d.normalize()),0===b&&(t.S(l),p.S(d)),X.push(l.x,l.y,l.z),r.push(d.x,d.y,d.z),U=h?n!==w?a[w].y:a[w].w:a[w].y+(a[w].w-a[w].y)*C,i.push(a[w].x+(a[w].z-a[w].x)*b/x,S.c?1-U:U),m&&u.push(m[w].r,m[w].g,m[w].b,m[w].a);1!==G&&y&&(X.push(l.x,l.y,l.z),X.push(0,l.y,0),X.push(0,l.y,0),X.push(t.x,t.y,t.z),z.GE.CrossToRef(j,d,H),H.normalize(),r.push(H.x,H.y,H.z,H.x,H.y,H.z),z.GE.CrossToRef(p,j,H),H.normalize(),r.push(H.x,H.y,H.z,H.x,H.y,H.z),U=h?n!==w?a[w+1].y:a[w+1].w:a[w+1].y+(a[w+1].w-a[w+1].y)*C,i.push(a[w+1].x,S.c?1-U:U),i.push(a[w+1].z,S.c?1-U:U),U=h?n!==w?a[w+2].y:a[w+2].w:a[w+2].y+(a[w+2].w-a[w+2].y)*C,i.push(a[w+2].x,S.c?1-U:U),i.push(a[w+2].z,S.c?1-U:U),m&&(u.push(m[w+1].r,m[w+1].g,m[w+1].b,m[w+1].a),u.push(m[w+1].r,m[w+1].g,m[w+1].b,m[w+1].a),u.push(m[w+2].r,m[w+2].g,m[w+2].b,m[w+2].a),u.push(m[w+2].r,m[w+2].g,m[w+2].b,m[w+2].a))),n!==w&&(n=w)}const s=1!==G&&y?x+4:x;for(R=0,w=0;w<D;w++){let B=0,E=0,v=0,z=0;for(b=0;b<x;b++)B=R*(s+1)+b,E=(R+1)*(s+1)+b,v=R*(s+1)+(b+1),z=(R+1)*(s+1)+(b+1),N.push(B,E,v),N.push(z,v,E);1!==G&&y&&(N.push(B+2,E+2,v+2),N.push(z+2,v+2,E+2),N.push(B+4,E+4,v+4),N.push(z+4,v+4,E+4)),R=h?R+2:R+1}const J=B=>{const o=B?v/2:q/2;if(0===o)return;let c,D,h;const y=B?a[g-1]:a[0];let Q=null;m&&(Q=B?m[g-1]:m[0]);const P=X.length/3,Y=B?E/2:-E/2,V=new z.GE(0,Y,0);X.push(V.x,V.y,V.z),r.push(0,B?1:-1,0);const T=y.y+.5*(y.w-y.y);i.push(y.x+.5*(y.z-y.x),S.c?1-T:T),Q&&u.push(Q.r,Q.g,Q.b,Q.a);const I=new z.Vector2(.5,.5);for(h=0;h<=x;h++){c=2*Math.PI*h*G/x;const E=Math.cos(-c),v=Math.sin(-c);D=new z.GE(E*o,Y,v*o);const q=new z.Vector2(E*I.x+.5,v*I.y+.5);X.push(D.x,D.y,D.z),r.push(0,B?1:-1,0);const P=y.y+(y.w-y.y)*q.y;i.push(y.x+(y.z-y.x)*q.x,S.c?1-P:P),Q&&u.push(Q.r,Q.g,Q.b,Q.a)}for(h=0;h<x;h++)B?(N.push(P),N.push(P+(h+2)),N.push(P+(h+1))):(N.push(P),N.push(P+(h+1)),N.push(P+(h+2)))};P!==o.e.CAP_START&&P!==o.e.CAP_ALL||J(!1),P!==o.e.CAP_END&&P!==o.e.CAP_ALL||J(!0),c.c._ComputeSides(Y,X,N,r,i,B.frontUVs,B.backUVs);const O=new c.c;return O.indices=N,O.uB=X,O.IB=r,O.CB=i,m&&(O.KB=u),O}function N(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return T(E).AB(z,E.updatable),z}function X(B){const E=[],v=[],o=[],q=[],x=B.diameter||1,D=B.thickness||.5,h=0|(B.tessellation||16),y=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,Q=h+1;for(let c=0;c<=h;c++){const B=c/h,y=c*Math.PI*2/h-Math.PI/2,P=z.Matrix.Translation(x/2,0,0).multiply(z.Matrix.RotationY(y));for(let x=0;x<=h;x++){const y=1-x/h,G=x*Math.PI*2/h+Math.PI,Y=Math.cos(G),a=Math.sin(G);let m=new z.GE(Y,a,0),g=m.scale(D/2);const V=new z.Vector2(B,y);g=z.GE.TransformCoordinates(g,P),m=z.GE.TransformNormal(m,P),v.push(g.x,g.y,g.z),o.push(m.x,m.y,m.z),q.push(V.x,S.c?1-V.y:V.y);const T=(c+1)%Q,N=(x+1)%Q;E.push(c*Q+x),E.push(c*Q+N),E.push(T*Q+x),E.push(c*Q+N),E.push(T*Q+N),E.push(T*Q+x)}}c.c._ComputeSides(y,v,E,o,q,B.frontUVs,B.backUVs);const P=new c.c;return P.indices=E,P.uB=v,P.IB=o,P.CB=q,P}function r(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return X(E).AB(z,E.updatable),z}c.c.CreateCylinder=T,o.e.CreateCylinder=(B,E,v,z,q,c,S,x,D)=>{void 0!==S&&S instanceof g.c||(void 0!==S&&(D=x||o.e.DEFAULTSIDE,x=S),S=c,c=1);return N(B,{height:E,diameterTop:v,diameterBottom:z,tessellation:q,subdivisions:c,sideOrientation:D,updatable:x},S)};function i(B){const E=[],v=[],o=[],q=[],x=B.radius||2,D=B.tube||.5,h=B.radialSegments||32,y=B.tubularSegments||32,Q=B.p||2,P=B.q||3,G=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,Y=B=>{const E=Math.cos(B),v=Math.sin(B),o=P/Q*B,q=Math.cos(o),c=x*(2+q)*.5*E,S=x*(2+q)*v*.5,D=x*Math.sin(o)*.5;return new z.GE(c,S,D)};let a,m;for(a=0;a<=h;a++){const B=a%h/h*2*Q*Math.PI,E=Y(B),o=Y(B+.01),c=o.YE(E);let x=o.add(E);const P=z.GE.Cross(c,x);for(x=z.GE.Cross(P,c),P.normalize(),x.normalize(),m=0;m<y;m++){const B=m%y/y*2*Math.PI,z=-D*Math.cos(B),o=D*Math.sin(B);v.push(E.x+z*x.x+o*P.x),v.push(E.y+z*x.y+o*P.y),v.push(E.z+z*x.z+o*P.z),q.push(a/h),q.push(S.c?1-m/y:m/y)}}for(a=0;a<h;a++)for(m=0;m<y;m++){const B=(m+1)%y,v=a*y+m,z=(a+1)*y+m,o=(a+1)*y+B,q=a*y+B;E.push(q),E.push(z),E.push(v),E.push(q),E.push(o),E.push(z)}c.c.ComputeNormals(v,E,o),c.c._ComputeSides(G,v,E,o,q,B.frontUVs,B.backUVs);const g=new c.c;return g.indices=E,g.uB=v,g.IB=o,g.CB=q,g}function u(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return i(E).AB(z,E.updatable),z}c.c.CreateTorus=X,o.e.CreateTorus=(B,E,v,z,o,q,c)=>r(B,{diameter:E,thickness:v,tessellation:z,sideOrientation:c,updatable:q},o);c.c.CreateTorusKnot=i,o.e.CreateTorusKnot=(B,E,v,z,o,q,c,S,x,D)=>u(B,{radius:E,tube:v,radialSegments:z,tubularSegments:o,p:q,q:c,sideOrientation:D,updatable:x},S);var I=v(13268),K=v(11943),C=v(11578);function f(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.path,q=E.shape,c=E.scale||1,S=E.rotation||0,x=0===E.cap?0:E.cap||o.e.NO_CAP,D=E.updatable,h=o.e._GetDefaultSideOrientation(E.sideOrientation),y=E.instance||null,Q=E.invertUV||!1,P=E.closeShape||!1,G=E.closePath||!1,Y=E.capFunction||null;return l(B,q,z,c,S,null,null,G,P,x,!1,v,!!D,h,y,Q,E.frontUVs||null,E.backUVs||null,E.firstNormal||null,!!E.adjustFrame,Y)}function A(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.path,q=E.shape,c=E.scaleFunction||(()=>1),S=E.rotationFunction||(()=>0),x=E.closePath||E.ribbonCloseArray||!1,D=E.closeShape||E.ribbonClosePath||!1,h=0===E.cap?0:E.cap||o.e.NO_CAP,y=E.updatable,Q=E.firstNormal||null,P=E.adjustFrame||!1,G=o.e._GetDefaultSideOrientation(E.sideOrientation),Y=E.instance,a=E.invertUV||!1,m=E.capFunction||null;return l(B,q,z,null,null,c,S,x,D,h,!0,v,!!y,G,Y||null,a,E.frontUVs||null,E.backUVs||null,Q,P,m||null)}function l(B,E,v,q,c,S,x,h,y,Q,P,G,Y,a,m,g,V,T,N,X,r){const i=(B,E,v,q,c,S,x,D,h,y,Q)=>{const P=v.getTangents(),G=v.getNormals(),Y=v.getBinormals(),a=v.getDistances();if(Q)for(let o=0;o<P.length;o++)if(0==P[o].x&&0==P[o].y&&0==P[o].z&&P[o].S(P[o-1]),0==G[o].x&&0==G[o].y&&0==G[o].z&&G[o].S(G[o-1]),0==Y[o].x&&0==Y[o].y&&0==Y[o].z&&Y[o].S(Y[o-1]),o>0){let B=P[o-1];z.GE.Dot(B,P[o])<0&&P[o].scaleInPlace(-1),B=G[o-1],z.GE.Dot(B,G[o])<0&&G[o].scaleInPlace(-1),B=Y[o-1],z.GE.Dot(B,Y[o])<0&&Y[o].scaleInPlace(-1)}let m=0;const g=y&&D?D:()=>null!==S?S:0,V=y&&x?x:()=>null!==c?c:1;let T=h===o.e.NO_CAP||h===o.e.CAP_END?0:2;const N=z.TmpVectors.Matrix[0];for(let o=0;o<E.length;o++){const v=[],c=g(o,a[o]),S=V(o,a[o]);z.Matrix.RotationAxisToRef(P[o],m,N);for(let q=0;q<B.length;q++){const c=P[o].scale(B[q].z).add(G[o].scale(B[q].x)).add(Y[o].scale(B[q].y)),x=z.GE.Zero();z.GE.TransformCoordinatesToRef(c,N,x),x.scaleInPlace(S).addInPlace(E[o]),v[q]=x}q[T]=v,m+=c,T++}const X=r||(B=>{const E=Array(),v=z.GE.Zero();let o;for(o=0;o<B.length;o++)v.addInPlace(B[o]);for(v.scaleInPlace(1/B.length),o=0;o<B.length;o++)E.push(v);return E});switch(h){case o.e.NO_CAP:break;case o.e.CAP_START:q[0]=X(q[2]),q[1]=q[2];break;case o.e.CAP_END:q[T]=q[T-1],q[T+1]=X(q[T-1]);break;case o.e.CAP_ALL:q[0]=X(q[2]),q[1]=q[2],q[T]=q[T-1],q[T+1]=X(q[T-1])}return q};let u,I;if(m){const B=m._creationDataStorage;return u=N?B.path3D.update(v,N):B.path3D.update(v),I=i(E,v,B.path3D,B.pathArray,q,c,S,x,B.cap,P,X),m=D("",{pathArray:I,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:m},G||void 0)}u=N?new C.h(v,N):new C.h(v);I=i(E,v,u,new Array,q,c,S,x,Q=Q<0||Q>3?0:Q,P,X);const K=D(B,{pathArray:I,closeArray:h,closePath:y,updatable:Y,sideOrientation:a,invertUV:g,frontUVs:V||void 0,backUVs:T||void 0},G);return K._creationDataStorage.pathArray=I,K._creationDataStorage.path3D=u,K._creationDataStorage.cap=Q,K}function d(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=E.arc?E.arc<=0||E.arc>1?1:E.arc:1,c=void 0===E.closed||E.closed,S=E.shape,x=E.radius||1,h=E.tessellation||64,y=E.clip||0,Q=E.updatable,P=o.e._GetDefaultSideOrientation(E.sideOrientation),G=E.cap||o.e.NO_CAP,Y=2*Math.PI,a=[],m=E.invertUV||!1;let g=0,V=0;const T=Y/h*q;let N,X;for(g=0;g<=h-y;g++){for(X=[],G!=o.e.CAP_START&&G!=o.e.CAP_ALL||(X.push(new z.GE(0,S[0].y,0)),X.push(new z.GE(Math.cos(g*T)*S[0].x*x,S[0].y,Math.sin(g*T)*S[0].x*x))),V=0;V<S.length;V++)N=new z.GE(Math.cos(g*T)*S[V].x*x,S[V].y,Math.sin(g*T)*S[V].x*x),X.push(N);G!=o.e.CAP_END&&G!=o.e.CAP_ALL||(X.push(new z.GE(Math.cos(g*T)*S[S.length-1].x*x,S[S.length-1].y,Math.sin(g*T)*S[S.length-1].x*x)),X.push(new z.GE(0,S[S.length-1].y,0))),a.push(X)}return D(B,{pathArray:a,closeArray:c,sideOrientation:P,updatable:Q,invertUV:m,frontUVs:E.frontUVs,backUVs:E.backUVs},v)}o.e.ExtrudeShape=function(B,E,v,z,q,c){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return f(B,{shape:E,path:v,scale:z,rotation:q,cap:0===c?0:c||o.e.NO_CAP,sideOrientation:D,instance:h,updatable:x},S)},o.e.ExtrudeShapeCustom=(B,E,v,z,q,c,S,x,D,h,y,Q)=>A(B,{shape:E,path:v,scaleFunction:z,rotationFunction:q,ribbonCloseArray:c,ribbonClosePath:S,cap:0===x?0:x||o.e.NO_CAP,sideOrientation:y,instance:Q,updatable:h},D);o.e.CreateLathe=(B,E,v,z,o,q,c)=>d(B,{shape:E,radius:v,tessellation:z,sideOrientation:c,updatable:q},o);var t=v(12671),p=v(12609);function H(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=E.path;let c=E.instance,S=1;void 0!==E.radius?S=E.radius:c&&(S=c._creationDataStorage.radius);const x=E.tessellation||64,h=E.radiusFunction||null;let y=E.cap||o.e.NO_CAP;const Q=E.invertUV||!1,P=E.updatable,G=o.e._GetDefaultSideOrientation(E.sideOrientation);E.arc=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1;const Y=(B,E,v,q,c,S,x,D)=>{const h=E.getTangents(),y=E.getNormals(),Q=E.getDistances(),P=2*Math.PI/c*D,G=S||(()=>q);let Y,a,m,g;const V=z.TmpVectors.Matrix[0];let T=x===o.e.NO_CAP||x===o.e.CAP_END?0:2;for(let o=0;o<B.length;o++){a=G(o,Q[o]),Y=Array(),m=y[o];for(let E=0;E<c;E++)z.Matrix.RotationAxisToRef(h[o],P*E,V),g=Y[E]?Y[E]:z.GE.Zero(),z.GE.TransformCoordinatesToRef(m,V,g),g.scaleInPlace(a).addInPlace(B[o]),Y[E]=g;v[T]=Y,T++}const N=(E,v)=>{const z=Array();for(let o=0;o<E;o++)z.push(B[v]);return z};switch(x){case o.e.NO_CAP:break;case o.e.CAP_START:v[0]=N(c,0),v[1]=v[2].slice(0);break;case o.e.CAP_END:v[T]=v[T-1].slice(0),v[T+1]=N(c,B.length-1);break;case o.e.CAP_ALL:v[0]=N(c,0),v[1]=v[2].slice(0),v[T]=v[T-1].slice(0),v[T+1]=N(c,B.length-1)}return v};let a,m;if(c){const B=c._creationDataStorage,v=E.arc||B.arc;return a=B.path3D.update(q),m=Y(q,a,B.pathArray,S,B.tessellation,h,B.cap,v),c=D("",{pathArray:m,instance:c}),B.path3D=a,B.pathArray=m,B.arc=v,B.radius=S,c}a=new C.h(q);y=y<0||y>3?0:y,m=Y(q,a,new Array,S,x,h,y,E.arc);const g=D(B,{pathArray:m,closePath:!0,closeArray:!1,updatable:P,sideOrientation:G,invertUV:Q,frontUVs:E.frontUVs,backUVs:E.backUVs},v);return g._creationDataStorage.pathArray=m,g._creationDataStorage.path3D=a,g._creationDataStorage.tessellation=x,g._creationDataStorage.cap=y,g._creationDataStorage.arc=E.arc,g._creationDataStorage.radius=S,g}function j(B){const E=[];E[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},E[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},E[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},E[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},E[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},E[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},E[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},E[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},E[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},E[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},E[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},E[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},E[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},E[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},E[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const v=B.type&&(B.type<0||B.type>=E.length)?0:B.type||0,o=B.size,q=B.sizeX||o||1,x=B.sizeY||o||1,D=B.sizeZ||o||1,h=B.custom||E[v],y=h.face.length,P=B.faceUV||new Array(y),G=B.faceColors,Y=void 0===B.flat||B.flat,a=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,m=[],g=[],V=[],T=[],N=[];let X=0,r=0;const i=[];let u,I,K,C,f,A,l=0,d=0;if(Y)for(d=0;d<y;d++)G&&void 0===G[d]&&(G[d]=new Q.gc(1,1,1,1)),P&&void 0===P[d]&&(P[d]=new z.Vector4(0,0,1,1));if(Y)for(d=0;d<y;d++){const B=h.face[d].length;for(K=2*Math.PI/B,C=.5*Math.tan(K/2),f=.5,l=0;l<B;l++)m.push(h.vertex[h.face[d][l]][0]*q,h.vertex[h.face[d][l]][1]*x,h.vertex[h.face[d][l]][2]*D),i.push(X),X++,u=P[d].x+(P[d].z-P[d].x)*(.5+C),I=P[d].y+(P[d].w-P[d].y)*(f-.5),T.push(u,S.c?1-I:I),A=C*Math.cos(K)-f*Math.sin(K),f=C*Math.sin(K)+f*Math.cos(K),C=A,G&&N.push(G[d].r,G[d].g,G[d].b,G[d].a);for(l=0;l<B-2;l++)g.push(i[0+r],i[l+2+r],i[l+1+r]);r+=B}else{for(l=0;l<h.vertex.length;l++)m.push(h.vertex[l][0]*q,h.vertex[l][1]*x,h.vertex[l][2]*D),T.push(0,S.c?1:0);for(d=0;d<y;d++)for(l=0;l<h.face[d].length-2;l++)g.push(h.face[d][0],h.face[d][l+2],h.face[d][l+1])}c.c.ComputeNormals(m,g,V),c.c._ComputeSides(a,m,g,V,T,B.frontUVs,B.backUVs);const t=new c.c;return t.uB=m,t.indices=g,t.IB=V,t.CB=T,G&&Y&&(t.KB=N),t}function R(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return j(E).AB(z,E.updatable),z}o.e.CreateTube=(B,E,v,z,o,q,c,S,x,D)=>H(B,{path:E,radius:v,tessellation:z,radiusFunction:o,arc:1,cap:q,updatable:S,sideOrientation:x,instance:D},c);function b(B){const E=B.sideOrientation||c.c.DEFAULTSIDE,v=B.radius||1,o=void 0===B.flat||B.flat,q=0|(B.subdivisions||4),x=B.radiusX||v,D=B.radiusY||v,h=B.radiusZ||v,y=(1+Math.sqrt(5))/2,Q=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],P=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],G=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Y=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],a=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],m=[],g=[],V=[],T=[];let N=0;const X=new Array(3),r=new Array(3);let i;for(i=0;i<3;i++)X[i]=z.GE.Zero(),r[i]=z.Vector2.Zero();for(let c=0;c<20;c++){for(i=0;i<3;i++){const B=P[3*c+i];X[i].Yc(Q[3*G[B]],Q[3*G[B]+1],Q[3*G[B]+2]),X[i].normalize(),r[i].Yc(.134765625*Y[2*B]+.05859375+-.0390625*a[c],.2333984375*Y[2*B+1]+.025390625+.01953125*a[c])}const B=(B,E,v,c)=>{const y=z.GE.Lerp(X[0],X[2],E/q),Q=z.GE.Lerp(X[1],X[2],E/q),P=q===E?X[2]:z.GE.Lerp(y,Q,B/(q-E));let G;if(P.normalize(),o){const B=z.GE.Lerp(X[0],X[2],c/q),E=z.GE.Lerp(X[1],X[2],c/q);G=z.GE.Lerp(B,E,v/(q-c))}else G=new z.GE(P.x,P.y,P.z);G.x/=x,G.y/=D,G.z/=h,G.normalize();const Y=z.Vector2.Lerp(r[0],r[2],E/q),a=z.Vector2.Lerp(r[1],r[2],E/q),i=q===E?r[2]:z.Vector2.Lerp(Y,a,B/(q-E));g.push(P.x*x,P.y*D,P.z*h),V.push(G.x,G.y,G.z),T.push(i.x,S.c?1-i.y:i.y),m.push(N),N++};for(let E=0;E<q;E++)for(let v=0;v+E<q;v++)B(v,E,v+1/3,E+1/3),B(v+1,E,v+1/3,E+1/3),B(v,E+1,v+1/3,E+1/3),v+E+1<q&&(B(v+1,E,v+2/3,E+2/3),B(v+1,E+1,v+2/3,E+2/3),B(v,E+1,v+2/3,E+2/3))}c.c._ComputeSides(E,g,m,V,T,B.frontUVs,B.backUVs);const u=new c.c;return u.indices=m,u.uB=g,u.IB=V,u.CB=T,u}function F(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new o.e(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),z._originalBuilderSideOrientation=E.sideOrientation;return b(E).AB(z,E.updatable),z}c.c.CreatePolyhedron=j,o.e.CreatePolyhedron=(B,E,v)=>R(B,E,v);c.c.CreateIcoSphere=b,o.e.CreateIcoSphere=(B,E,v)=>F(B,E,v);var W=v(11394);const w=new z.GE(1,0,0),n=new z.GE(-1,0,0),U=new z.GE(0,1,0),s=new z.GE(0,-1,0),J=new z.GE(0,0,1),O=new z.GE(0,0,-1);class e{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.GE.Zero(),E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.GE.Up(),v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.Vector2.Zero(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=B,this.normal=E,this.uv=v,this.vertexIdx=o,this.vertexIdxForBones=q,this.localPositionOverride=c,this.localNormalOverride=S,this.matrixIndicesOverride=x,this.matrixWeightsOverride=D}clone(){var B,E,v,z;return new e(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(B=this.localPositionOverride)||void 0===B?void 0:B.slice(),null===(E=this.localNormalOverride)||void 0===E?void 0:E.slice(),null===(v=this.matrixIndicesOverride)||void 0===v?void 0:v.slice(),null===(z=this.matrixWeightsOverride)||void 0===z?void 0:z.slice())}}function k(B,E,v){var x,D,h,y,Q;const P=!!E.skeleton,G=!(null===(x=E.morphTargetManager)||void 0===x||!x.numTargets),Y=v.localMode||P,a=E.Pc(),m=P||G?E.kS(!0,!0):E.getVerticesData(q.e.PositionKind),g=P||G?E.getNormalsData(!0,!0):E.getVerticesData(q.e.NormalKind),V=Y?P?E.getVerticesData(q.e.PositionKind):m:null,T=Y?P?E.getVerticesData(q.e.NormalKind):g:null,N=E.getVerticesData(q.e.UVKind),X=P?E.getVerticesData(q.e.MatricesIndicesKind):null,r=P?E.getVerticesData(q.e.MatricesWeightsKind):null,i=P?E.getVerticesData(q.e.MatricesIndicesExtraKind):null,u=P?E.getVerticesData(q.e.MatricesWeightsExtraKind):null,I=v.position||z.GE.Zero();let K=v.normal||z.GE.Up();const C=v.size||z.GE.One(),f=v.angle||0;if(!K){const B=new z.GE(0,0,1),v=E.rB().activeCamera,o=z.GE.TransformCoordinates(B,v.getWorldMatrix());K=v.globalPosition.YE(o)}const A=-Math.atan2(K.z,K.x)-Math.PI/2,l=Math.sqrt(K.x*K.x+K.z*K.z),d=Math.atan2(K.y,l),t=new c.c;t.indices=[],t.uB=[],t.IB=[],t.CB=[],t.matricesIndices=P?[]:null,t.matricesWeights=P?[]:null,t.matricesIndicesExtra=i?[]:null,t.matricesWeightsExtra=u?[]:null;let p=0;const H=(B,E)=>{const o=new e;if(!a||!m||!g)return o;const q=a[B];if(o.vertexIdx=3*q,o.vertexIdxForBones=4*q,o.position=new z.GE(m[3*q],m[3*q+1],m[3*q+2]),z.GE.TransformCoordinatesToRef(o.position,E,o.position),o.normal=new z.GE(g[3*q],g[3*q+1],g[3*q+2]),z.GE.TransformNormalToRef(o.normal,E,o.normal),v.captureUVS&&N){const B=N[2*q+1];o.uv=new z.Vector2(N[2*q],S.c?1-B:B)}return o},j=[0,0,0,0],R=(B,E)=>{if(0===B.length)return B;const v=.5*Math.abs(z.GE.Dot(C,E)),o=(B,E,v,z)=>{for(let o=0;o<z;++o)if(B[v+o]===E)return v+o;return-1},q=(B,q)=>{const c=z.GE.GetClipFactor(B.position,q.position,E,v);let S=j,x=j;if(X&&r){const E=B.matrixIndicesOverride?0:B.vertexIdxForBones,v=B.matrixIndicesOverride??X,z=B.matrixWeightsOverride??r,D=q.matrixIndicesOverride?0:q.vertexIdxForBones,h=q.matrixIndicesOverride??X,y=q.matrixWeightsOverride??r;S=[0,0,0,0],x=[0,0,0,0];let Q=0;for(let B=0;B<4;++B)if(z[E+B]>0){const q=o(h,v[E+B],D,4);S[Q]=v[E+B],x[Q]=(0,W.Lerp)(z[E+B],q>=0?y[q]:0,c),Q++}for(let B=0;B<4&&Q<4;++B){const z=h[D+B];-1===o(v,z,E,4)&&(S[Q]=z,x[Q]=(0,W.Lerp)(0,y[D+B],c),Q++)}const P=x[0]+x[1]+x[2]+x[3];x[0]/=P,x[1]/=P,x[2]/=P,x[3]/=P}const D=B.localPositionOverride?B.localPositionOverride[0]:(null===V||void 0===V?void 0:V[B.vertexIdx])??0,h=B.localPositionOverride?B.localPositionOverride[1]:(null===V||void 0===V?void 0:V[B.vertexIdx+1])??0,y=B.localPositionOverride?B.localPositionOverride[2]:(null===V||void 0===V?void 0:V[B.vertexIdx+2])??0,Q=q.localPositionOverride?q.localPositionOverride[0]:(null===V||void 0===V?void 0:V[q.vertexIdx])??0,P=q.localPositionOverride?q.localPositionOverride[1]:(null===V||void 0===V?void 0:V[q.vertexIdx+1])??0,G=q.localPositionOverride?q.localPositionOverride[2]:(null===V||void 0===V?void 0:V[q.vertexIdx+2])??0,Y=B.localNormalOverride?B.localNormalOverride[0]:(null===T||void 0===T?void 0:T[B.vertexIdx])??0,a=B.localNormalOverride?B.localNormalOverride[1]:(null===T||void 0===T?void 0:T[B.vertexIdx+1])??0,m=B.localNormalOverride?B.localNormalOverride[2]:(null===T||void 0===T?void 0:T[B.vertexIdx+2])??0,g=Y+((q.localNormalOverride?q.localNormalOverride[0]:(null===T||void 0===T?void 0:T[q.vertexIdx])??0)-Y)*c,N=a+((q.localNormalOverride?q.localNormalOverride[1]:(null===T||void 0===T?void 0:T[q.vertexIdx+1])??0)-a)*c,i=m+((q.localNormalOverride?q.localNormalOverride[2]:(null===T||void 0===T?void 0:T[q.vertexIdx+2])??0)-m)*c,u=Math.sqrt(g*g+N*N+i*i);return new e(z.GE.Lerp(B.position,q.position,c),z.GE.Lerp(B.normal,q.normal,c).normalize(),z.Vector2.Lerp(B.uv,q.uv,c),-1,-1,V?[D+(Q-D)*c,h+(P-h)*c,y+(G-y)*c]:null,T?[g/u,N/u,i/u]:null,S,x)};let c=null;B.length>3&&(c=[]);for(let S=0;S<B.length;S+=3){let o=0,x=null,D=null,h=null,y=null;const Q=z.GE.Dot(B[S].position,E)-v>0,P=z.GE.Dot(B[S+1].position,E)-v>0,G=z.GE.Dot(B[S+2].position,E)-v>0;switch(o=(Q?1:0)+(P?1:0)+(G?1:0),o){case 0:B.length>3?(c.push(B[S]),c.push(B[S+1]),c.push(B[S+2])):c=B;break;case 1:if(c=c??new Array,Q&&(x=B[S+1],D=B[S+2],h=q(B[S],x),y=q(B[S],D)),P){x=B[S],D=B[S+2],h=q(B[S+1],x),y=q(B[S+1],D),c.push(h),c.push(D.clone()),c.push(x.clone()),c.push(D.clone()),c.push(h.clone()),c.push(y);break}G&&(x=B[S],D=B[S+1],h=q(B[S+2],x),y=q(B[S+2],D)),x&&D&&h&&y&&(c.push(x.clone()),c.push(D.clone()),c.push(h),c.push(y),c.push(h.clone()),c.push(D.clone()));break;case 2:c=c??new Array,Q||(x=B[S].clone(),D=q(x,B[S+1]),h=q(x,B[S+2]),c.push(x),c.push(D),c.push(h)),P||(x=B[S+1].clone(),D=q(x,B[S+2]),h=q(x,B[S]),c.push(x),c.push(D),c.push(h)),G||(x=B[S+2].clone(),D=q(x,B[S]),h=q(x,B[S+1]),c.push(x),c.push(D),c.push(h))}}return c},b=E instanceof o.e?E:null,F=null===b||void 0===b?void 0:b._thinInstanceDataStorage.matrixData,k=(null===b||void 0===b?void 0:b.Tc)||1,L=z.TmpVectors.Matrix[0];L.S(z.Matrix.IdentityReadOnly);for(let o=0;o<k;++o){if(null!==b&&void 0!==b&&b.hasThinInstances&&F){const B=16*o;L.setRowFromFloats(0,F[B+0],F[B+1],F[B+2],F[B+3]),L.setRowFromFloats(1,F[B+4],F[B+5],F[B+6],F[B+7]),L.setRowFromFloats(2,F[B+8],F[B+9],F[B+10],F[B+11]),L.setRowFromFloats(3,F[B+12],F[B+13],F[B+14],F[B+15])}const B=z.Matrix.RotationYawPitchRoll(A,d,f).multiply(z.Matrix.Translation(I.x,I.y,I.z)),q=z.Matrix.Invert(B),c=E.getWorldMatrix(),x=L.multiply(c).multiply(q),D=new Array(3);for(let E=0;E<a.length;E+=3){let B=D;if(B[0]=H(E,x),B[1]=H(E+1,x),B[2]=H(E+2,x),!(v.cullBackFaces&&-B[0].normal.z<=0&&-B[1].normal.z<=0&&-B[2].normal.z<=0)&&(B=R(B,w),B&&(B=R(B,n),B&&(B=R(B,U),B&&(B=R(B,s),B&&(B=R(B,J),B&&(B=R(B,O),B)))))))for(let E=0;E<B.length;E++){const z=B[E];if(t.indices.push(p),Y?(z.localPositionOverride?(t.uB[3*p]=z.localPositionOverride[0],t.uB[3*p+1]=z.localPositionOverride[1],t.uB[3*p+2]=z.localPositionOverride[2]):V&&(t.uB[3*p]=V[z.vertexIdx],t.uB[3*p+1]=V[z.vertexIdx+1],t.uB[3*p+2]=V[z.vertexIdx+2]),z.localNormalOverride?(t.IB[3*p]=z.localNormalOverride[0],t.IB[3*p+1]=z.localNormalOverride[1],t.IB[3*p+2]=z.localNormalOverride[2]):T&&(t.IB[3*p]=T[z.vertexIdx],t.IB[3*p+1]=T[z.vertexIdx+1],t.IB[3*p+2]=T[z.vertexIdx+2])):(z.position.toArray(t.uB,3*p),z.normal.toArray(t.IB,3*p)),t.matricesIndices&&t.matricesWeights&&(z.matrixIndicesOverride?(t.matricesIndices[4*p]=z.matrixIndicesOverride[0],t.matricesIndices[4*p+1]=z.matrixIndicesOverride[1],t.matricesIndices[4*p+2]=z.matrixIndicesOverride[2],t.matricesIndices[4*p+3]=z.matrixIndicesOverride[3]):(X&&(t.matricesIndices[4*p]=X[z.vertexIdxForBones],t.matricesIndices[4*p+1]=X[z.vertexIdxForBones+1],t.matricesIndices[4*p+2]=X[z.vertexIdxForBones+2],t.matricesIndices[4*p+3]=X[z.vertexIdxForBones+3]),i&&t.matricesIndicesExtra&&(t.matricesIndicesExtra[4*p]=i[z.vertexIdxForBones],t.matricesIndicesExtra[4*p+1]=i[z.vertexIdxForBones+1],t.matricesIndicesExtra[4*p+2]=i[z.vertexIdxForBones+2],t.matricesIndicesExtra[4*p+3]=i[z.vertexIdxForBones+3])),z.matrixWeightsOverride?(t.matricesWeights[4*p]=z.matrixWeightsOverride[0],t.matricesWeights[4*p+1]=z.matrixWeightsOverride[1],t.matricesWeights[4*p+2]=z.matrixWeightsOverride[2],t.matricesWeights[4*p+3]=z.matrixWeightsOverride[3]):(r&&(t.matricesWeights[4*p]=r[z.vertexIdxForBones],t.matricesWeights[4*p+1]=r[z.vertexIdxForBones+1],t.matricesWeights[4*p+2]=r[z.vertexIdxForBones+2],t.matricesWeights[4*p+3]=r[z.vertexIdxForBones+3]),u&&t.matricesWeightsExtra&&(t.matricesWeightsExtra[4*p]=u[z.vertexIdxForBones],t.matricesWeightsExtra[4*p+1]=u[z.vertexIdxForBones+1],t.matricesWeightsExtra[4*p+2]=u[z.vertexIdxForBones+2],t.matricesWeightsExtra[4*p+3]=u[z.vertexIdxForBones+3]))),v.captureUVS)z.uv.toArray(t.CB,2*p);else{t.CB.push(.5+z.position.x/C.x);const B=.5+z.position.y/C.y;t.CB.push(S.c?1-B:B)}p++}}}0===t.indices.length&&(t.indices=null),0===t.uB.length&&(t.uB=null),0===t.IB.length&&(t.IB=null),0===t.CB.length&&(t.CB=null),0===(null===(D=t.matricesIndices)||void 0===D?void 0:D.length)&&(t.matricesIndices=null),0===(null===(h=t.matricesWeights)||void 0===h?void 0:h.length)&&(t.matricesWeights=null),0===(null===(y=t.matricesIndicesExtra)||void 0===y?void 0:y.length)&&(t.matricesIndicesExtra=null),0===(null===(Q=t.matricesWeightsExtra)||void 0===Q?void 0:Q.length)&&(t.matricesWeightsExtra=null);const M=new o.e(B,E.rB());return t.AB(M),Y?(M.skeleton=E.skeleton,M.parent=E):(M.position=I.clone(),M.rotation=new z.GE(d,A,f)),M.yc(!0),M.refreshBoundingInfo(!0,!0),M}function L(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const E=0|Math.max(B.subdivisions?B.subdivisions:2,1),v=0|Math.max(B.tessellation?B.tessellation:16,3),o=Math.max(B.height?B.height:1,0),q=Math.max(B.radius?B.radius:.25,0),x=0|Math.max(B.capSubdivisions?B.capSubdivisions:6,1),D=v,h=E,y=Math.max(B.radiusTop?B.radiusTop:q,0),Q=Math.max(B.radiusBottom?B.radiusBottom:q,0),P=o-(y+Q),G=2*Math.PI,Y=Math.max(B.topCapSubdivisions?B.topCapSubdivisions:x,1),a=Math.max(B.bottomCapSubdivisions?B.bottomCapSubdivisions:x,1),m=Math.acos((Q-y)/o);let g=[];const V=[],T=[],N=[];let X=0;const r=[],i=.5*P,u=.5*Math.PI;let I,K;const C=z.GE.Zero(),f=z.GE.Zero(),A=Math.cos(m),l=Math.sin(m),d=new z.Vector2(y*l,i+y*A).YE(new z.Vector2(Q*l,Q*A-i)).length(),t=y*m+d+Q*(u-m);let p=0;for(K=0;K<=Y;K++){const B=[],E=u-m*(K/Y);p+=y*m/Y;const v=Math.cos(E),z=Math.sin(E),o=v*y;for(I=0;I<=D;I++){const E=I/D,q=E*G+0,c=Math.sin(q),x=Math.cos(q);f.x=o*c,f.y=i+z*y,f.z=o*x,V.push(f.x,f.y,f.z),C.set(v*c,z,v*x),T.push(C.x,C.y,C.z),N.push(E,S.c?p/t:1-p/t),B.push(X),X++}r.push(B)}const H=o-y-Q+A*y-A*Q,j=l*(Q-y)/H;for(K=1;K<=h;K++){const B=[];p+=d/h;const E=l*(K*(Q-y)/h+y);for(I=0;I<=D;I++){const v=I/D,z=v*G+0,o=Math.sin(z),q=Math.cos(z);f.x=E*o,f.y=i+A*y-K*H/h,f.z=E*q,V.push(f.x,f.y,f.z),C.set(o,j,q).normalize(),T.push(C.x,C.y,C.z),N.push(v,S.c?p/t:1-p/t),B.push(X),X++}r.push(B)}for(K=1;K<=a;K++){const B=[],E=u-m-(Math.PI-m)*(K/a);p+=Q*m/a;const v=Math.cos(E),z=Math.sin(E),o=v*Q;for(I=0;I<=D;I++){const E=I/D,q=E*G+0,c=Math.sin(q),x=Math.cos(q);f.x=o*c,f.y=z*Q-i,f.z=o*x,V.push(f.x,f.y,f.z),C.set(v*c,z,v*x),T.push(C.x,C.y,C.z),N.push(E,S.c?p/t:1-p/t),B.push(X),X++}r.push(B)}for(I=0;I<D;I++)for(K=0;K<Y+h+a;K++){const B=r[K][I],E=r[K+1][I],v=r[K+1][I+1],z=r[K][I+1];g.push(B),g.push(E),g.push(z),g.push(E),g.push(v),g.push(z)}if(g=g.reverse(),B.orientation&&!B.orientation.equals(z.GE.Up())){const E=new z.Matrix;B.orientation.clone().scale(.5*Math.PI).cross(z.GE.Up()).toQuaternion().toRotationMatrix(E);const v=z.GE.Zero();for(let B=0;B<V.length;B+=3)v.set(V[B],V[B+1],V[B+2]),z.GE.TransformCoordinatesToRef(v.clone(),E,v),V[B]=v.x,V[B+1]=v.y,V[B+2]=v.z}const R=new c.c;return R.uB=V,R.IB=T,R.CB=N,R.indices=g,R}function M(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:z.GE.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new o.e(B,v);return L(E).AB(q,E.updatable),q}o.e.CreateDecal=(B,E,v,z,o,q)=>k(B,E,{position:v,normal:z,size:o,angle:q});o.e.CreateCapsule=(B,E,v)=>M(B,E,v),c.c.CreateCapsule=L;var Z=v(11213),BB=v(11382);class EB{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=B,this.y=E,B!==Math.floor(B)&&(B=Math.floor(B),Z.c.Warn("x is not an integer, floor(x) used")),E!==Math.floor(E)&&(E=Math.floor(E),Z.c.Warn("y is not an integer, floor(y) used"))}clone(){return new EB(this.x,this.y)}rotate60About(B){const E=this.x;return this.x=B.x+B.y-this.y,this.y=E+this.y-B.x,this}rotateNeg60About(B){const E=this.x;return this.x=E+this.y-B.y,this.y=B.x+B.y-E,this}rotate120(B,E){B!==Math.floor(B)&&(B=Math.floor(B),Z.c.Warn("m not an integer only floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),Z.c.Warn("n not an integer only floor(n) used"));const v=this.x;return this.x=B-v-this.y,this.y=E+v,this}rotateNeg120(B,E){B!==Math.floor(B)&&(B=Math.floor(B),Z.c.Warn("m is not an integer, floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),Z.c.Warn("n is not an integer,   floor(n) used"));const v=this.x;return this.x=this.y-E,this.y=B+E-v-this.y,this}toCartesianOrigin(B,E){const v=z.GE.Zero();return v.x=B.x+2*this.x*E+this.y*E,v.y=B.y+Math.sqrt(3)*this.y*E,v}static Zero(){return new EB(0,0)}}class vB{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new zB("icosahedron","Regular",[[0,BB.h,-1],[-BB.h,1,0],[-1,0,-BB.h],[1,0,-BB.h],[BB.h,1,0],[0,BB.h,1],[-1,0,BB.h],[-BB.h,-1,0],[0,-BB.h,-1],[BB.h,-1,0],[1,0,BB.h],[0,-BB.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let B=12;const E={},v=this.m,z=this.n;let o,q,c,S,x,D=v,h=1,y=0;0!==z&&(D=(0,W.HighestCommonFactor)(v,z)),h=v/D,y=z/D;const Q=EB.Zero(),P=new EB(v,z),G=new EB(-z,v+z),Y=EB.Zero(),a=EB.Zero(),m=EB.Zero();let g,V,T,N,X=[];const r=[],i=this.vertByDist,u=(v,z,o,q)=>{g=v+"|"+o,V=z+"|"+q,g in E||V in E?g in E&&!(V in E)?E[V]=E[g]:V in E&&!(g in E)&&(E[g]=E[V]):(E[g]=B,E[V]=B,B++),i[o][0]>2?r[E[g]]=[-i[o][0],i[o][1],E[g]]:r[E[g]]=[X[i[o][0]],i[o][1],E[g]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let I=0;I<20;I++){if(X=this.IDATA.face[I],c=X[2],S=X[1],x=X[0],T=Q.x+"|"+Q.y,g=I+"|"+T,g in E||(E[g]=c,r[c]=[X[i[T][0]],i[T][1]]),T=P.x+"|"+P.y,g=I+"|"+T,g in E||(E[g]=S,r[S]=[X[i[T][0]],i[T][1]]),T=G.x+"|"+G.y,g=I+"|"+T,g in E||(E[g]=x,r[x]=[X[i[T][0]],i[T][1]]),o=this.IDATA.edgematch[I][0],q=this.IDATA.edgematch[I][1],"B"===q)for(let B=1;B<D;B++)a.x=v-B*(h+y),a.y=z+B*h,m.x=-B*y,m.y=B*(h+y),T=a.x+"|"+a.y,N=m.x+"|"+m.y,u(I,o,T,N);if("O"===q)for(let B=1;B<D;B++)m.x=-B*y,m.y=B*(h+y),Y.x=B*h,Y.y=B*y,T=m.x+"|"+m.y,N=Y.x+"|"+Y.y,u(I,o,T,N);if(o=this.IDATA.edgematch[I][2],q=this.IDATA.edgematch[I][3],q&&"A"===q)for(let B=1;B<D;B++)Y.x=B*h,Y.y=B*y,a.x=v-(D-B)*(h+y),a.y=z+(D-B)*h,T=Y.x+"|"+Y.y,N=a.x+"|"+a.y,u(I,o,T,N);for(let v=0;v<this.vertices.length;v++)T=this.vertices[v].x+"|"+this.vertices[v].y,g=I+"|"+T,g in E||(E[g]=B++,i[T][0]>2?r[E[g]]=[-i[T][0],i[T][1],E[g]]:r[E[g]]=[X[i[T][0]],i[T][1],E[g]])}this.closestTo=r,this.vecToidx=E}calcCoeffs(){const B=this.m,E=this.n,v=Math.sqrt(3)/3,z=B*B+E*E+B*E;this.coau=(B+E)/z,this.cobu=-E/z,this.coav=-v*(B-E)/z,this.cobv=v*(2*B+E)/z}createInnerFacets(){const B=this.m,E=this.n;for(let v=0;v<E+B+1;v++)for(let B=this.min[v];B<this.max[v]+1;B++)B<this.max[v]&&B<this.max[v+1]+1&&this.innerFacets.push(["|"+B+"|"+v,"|"+B+"|"+(v+1),"|"+(B+1)+"|"+v]),v>0&&B<this.max[v-1]&&B+1<this.max[v]+1&&this.innerFacets.push(["|"+B+"|"+v,"|"+(B+1)+"|"+v,"|"+(B+1)+"|"+(v-1)])}edgeVecsABOB(){const B=this.m,E=this.n,v=new EB(-E,B+E);for(let z=1;z<B+E;z++){const B=new EB(this.min[z],z),E=new EB(this.min[z-1],z-1),o=new EB(this.min[z+1],z+1),q=B.clone(),c=E.clone(),S=o.clone();q.rotate60About(v),c.rotate60About(v),S.rotate60About(v);const x=new EB(this.max[q.y],q.y),D=new EB(this.max[q.y-1],q.y-1),h=new EB(this.max[q.y-1]-1,q.y-1);q.x===x.x&&q.y===x.y||(q.x!==D.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,D,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,h,x])):q.y===S.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([B,E,D]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([B,D,o])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([B,E,D]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,D,x])))}}mapABOBtoOBOA(){const B=new EB(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const v=[];for(let z=0;z<3;z++)B.x=this.isoVecsABOB[E][z].x,B.y=this.isoVecsABOB[E][z].y,0===this.vertexTypes[E][z]&&B.rotateNeg120(this.m,this.n),v.push(B.clone());this.isoVecsOBOA.push(v)}}mapABOBtoBAOA(){const B=new EB(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const v=[];for(let z=0;z<3;z++)B.x=this.isoVecsABOB[E][z].x,B.y=this.isoVecsABOB[E][z].y,1===this.vertexTypes[E][z]&&B.rotate120(this.m,this.n),v.push(B.clone());this.isoVecsBAOA.push(v)}}MapToFace(B,E){const v=this.IDATA.face[B],o=v[2],q=v[1],c=v[0],S=z.GE.VE(this.IDATA.vertex[o]),x=z.GE.VE(this.IDATA.vertex[q]),D=z.GE.VE(this.IDATA.vertex[c]),h=x.YE(S),y=D.YE(S),Q=h.scale(this.coau).add(y.scale(this.cobu)),P=h.scale(this.coav).add(y.scale(this.cobv)),G=[];let Y,a=z.TmpVectors.GE[0];for(let z=0;z<this.cartesian.length;z++)a=Q.scale(this.cartesian[z].x).add(P.scale(this.cartesian[z].y)).add(S),G[z]=[a.x,a.y,a.z],Y=B+"|"+this.vertices[z].x+"|"+this.vertices[z].y,E.vertex[this.vecToidx[Y]]=[a.x,a.y,a.z]}build(B,E){const v=[],z=EB.Zero(),o=new EB(B,E),q=new EB(-E,B+E);v.push(z,o,q);for(let T=E;T<B+1;T++)for(let E=0;E<B+1-T;E++)v.push(new EB(E,T));if(E>0){const z=(0,W.HighestCommonFactor)(B,E),o=B/z,q=E/z;for(let S=1;S<z;S++)v.push(new EB(S*o,S*q)),v.push(new EB(-S*q,S*(o+q))),v.push(new EB(B-S*(o+q),E+S*o));const c=B/E;for(let S=1;S<E;S++)for(let z=0;z<S*c;z++)v.push(new EB(z,S)),v.push(new EB(z,S).rotate120(B,E)),v.push(new EB(z,S).rotateNeg120(B,E))}v.sort(((B,E)=>B.x-E.x)),v.sort(((B,E)=>B.y-E.y));const c=new Array(B+E+1),S=new Array(B+E+1);for(let T=0;T<c.length;T++)c[T]=1/0,S[T]=-1/0;let x=0,D=0;const h=v.length;for(let T=0;T<h;T++)D=v[T].x,x=v[T].y,c[x]=Math.min(D,c[x]),S[x]=Math.max(D,S[x]);const y=(v,z)=>{const o=v.clone();return"A"===z&&o.rotateNeg120(B,E),"B"===z&&o.rotate120(B,E),o.x<0?o.y:o.x+o.y},Q=[],P=[],G=[],Y=[],a={},m=[];let g=-1,V=-1;for(let T=0;T<h;T++)Q[T]=v[T].toCartesianOrigin(new EB(0,0),.5),P[T]=y(v[T],"O"),G[T]=y(v[T],"A"),Y[T]=y(v[T],"B"),P[T]===G[T]&&G[T]===Y[T]?(g=3,V=P[T]):P[T]===G[T]?(g=4,V=P[T]):G[T]===Y[T]?(g=5,V=G[T]):Y[T]===P[T]&&(g=6,V=P[T]),P[T]<G[T]&&P[T]<Y[T]&&(g=2,V=P[T]),G[T]<P[T]&&G[T]<Y[T]&&(g=1,V=G[T]),Y[T]<G[T]&&Y[T]<P[T]&&(g=0,V=Y[T]),m.push([g,V,v[T].x,v[T].y]);m.sort(((B,E)=>B[2]-E[2])),m.sort(((B,E)=>B[3]-E[3])),m.sort(((B,E)=>B[1]-E[1])),m.sort(((B,E)=>B[0]-E[0]));for(let T=0;T<m.length;T++)a[m[T][2]+"|"+m[T][3]]=[m[T][0],m[T][1],T];return this.m=B,this.n=E,this.vertices=v,this.vertByDist=a,this.cartesian=Q,this.min=c,this.max=S,this}}class zB{constructor(B,E,v,z){this.name=B,this.category=E,this.vertex=v,this.face=z}}class oB extends zB{innerToData(B,E){for(let v=0;v<E.innerFacets.length;v++)this.face.push(E.innerFacets[v].map((v=>E.vecToidx[B+v])))}mapABOBtoDATA(B,E){const v=E.IDATA.edgematch[B][0];for(let z=0;z<E.isoVecsABOB.length;z++){const o=[];for(let q=0;q<3;q++)0===E.vertexTypes[z][q]?o.push(B+"|"+E.isoVecsABOB[z][q].x+"|"+E.isoVecsABOB[z][q].y):o.push(v+"|"+E.isoVecsABOB[z][q].x+"|"+E.isoVecsABOB[z][q].y);this.face.push([E.vecToidx[o[0]],E.vecToidx[o[1]],E.vecToidx[o[2]]])}}mapOBOAtoDATA(B,E){const v=E.IDATA.edgematch[B][0];for(let z=0;z<E.isoVecsOBOA.length;z++){const o=[];for(let q=0;q<3;q++)1===E.vertexTypes[z][q]?o.push(B+"|"+E.isoVecsOBOA[z][q].x+"|"+E.isoVecsOBOA[z][q].y):o.push(v+"|"+E.isoVecsOBOA[z][q].x+"|"+E.isoVecsOBOA[z][q].y);this.face.push([E.vecToidx[o[0]],E.vecToidx[o[1]],E.vecToidx[o[2]]])}}mapBAOAtoDATA(B,E){const v=E.IDATA.edgematch[B][2];for(let z=0;z<E.isoVecsBAOA.length;z++){const o=[];for(let q=0;q<3;q++)1===E.vertexTypes[z][q]?o.push(B+"|"+E.isoVecsBAOA[z][q].x+"|"+E.isoVecsBAOA[z][q].y):o.push(v+"|"+E.isoVecsBAOA[z][q].x+"|"+E.isoVecsBAOA[z][q].y);this.face.push([E.vecToidx[o[0]],E.vecToidx[o[1]],E.vecToidx[o[2]]])}}orderData(B){const E=[];for(let q=0;q<13;q++)E[q]=[];const v=B.closestTo;for(let q=0;q<v.length;q++)v[q][0]>-1?v[q][1]>0&&E[v[q][0]].push([q,v[q][1]]):E[12].push([q,v[q][0]]);const z=[];for(let q=0;q<12;q++)z[q]=q;let o=12;for(let q=0;q<12;q++){E[q].sort(((B,E)=>B[1]-E[1]));for(let B=0;B<E[q].length;B++)z[E[q][B][0]]=o++}for(let q=0;q<E[12].length;q++)z[E[12][q][0]]=o++;for(let q=0;q<this.vertex.length;q++)this.vertex[q].push(z[q]);this.vertex.sort(((B,E)=>B[3]-E[3]));for(let q=0;q<this.vertex.length;q++)this.vertex[q].pop();for(let q=0;q<this.face.length;q++)for(let B=0;B<this.face[q].length;B++)this.face[q][B]=z[this.face[q][B]];this.sharedNodes=E[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(B,E){const v=[],z=[];let o=E.pop();z.push(o);let q=this.face[o].indexOf(B);q=(q+2)%3;let c=this.face[o][q];v.push(c);let S=0;for(;E.length>0;)o=E[S],this.face[o].indexOf(c)>-1?(q=(this.face[o].indexOf(c)+1)%3,c=this.face[o][q],v.push(c),z.push(o),E.splice(S,1),S=0):S++;return this.adjacentFaces.push(v),z}toGoldbergPolyhedronData(){const B=new zB("GeoDual","Goldberg",[],[]);B.name="GD dual";const E=this.vertex.length,v=new Array(E);for(let x=0;x<E;x++)v[x]=[];for(let x=0;x<this.face.length;x++)for(let B=0;B<3;B++)v[this.face[x][B]].push(x);let z=0,o=0,q=0,c=[],S=[];this.adjacentFaces=[];for(let x=0;x<v.length;x++){B.face[x]=this.setOrder(x,v[x].concat([]));for(const E of v[x]){z=0,o=0,q=0,c=this.face[E];for(let B=0;B<3;B++)S=this.vertex[c[B]],z+=S[0],o+=S[1],q+=S[2];B.vertex[E]=[z/3,o/3,q/3]}}return B}static BuildGeodesicData(B){const E=new oB("Geodesic-m-n","Geodesic",[[0,BB.h,-1],[-BB.h,1,0],[-1,0,-BB.h],[1,0,-BB.h],[BB.h,1,0],[0,BB.h,1],[-1,0,BB.h],[-BB.h,-1,0],[0,-BB.h,-1],[BB.h,-1,0],[1,0,BB.h],[0,-BB.h,1]],[]);B.setIndices(),B.calcCoeffs(),B.createInnerFacets(),B.edgeVecsABOB(),B.mapABOBtoOBOA(),B.mapABOBtoBAOA();for(let v=0;v<B.IDATA.face.length;v++)B.MapToFace(v,E),E.innerToData(v,B),"B"===B.IDATA.edgematch[v][1]&&E.mapABOBtoDATA(v,B),"O"===B.IDATA.edgematch[v][1]&&E.mapOBOAtoDATA(v,B),"A"===B.IDATA.edgematch[v][3]&&E.mapBAOAtoDATA(v,B);E.orderData(B);return E.vertex=E.vertex.map((function(B){const E=B[0],v=B[1],z=B[2],o=Math.sqrt(E*E+v*v+z*z);return B[0]*=1/o,B[1]*=1/o,B[2]*=1/o,B})),E}}o.e._GoldbergMeshParser=(B,E)=>qB.Parse(B,E);class qB extends o.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(B,E){return void 0===E?(B>this.goldbergData.nbUnsharedFaces-1&&(Z.c.Warn("Maximum number of unshared faces used"),B=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+B):(B>11&&(Z.c.Warn("Last pole used"),B=11),E>this.goldbergData.nbFacesAtPole-1&&(Z.c.Warn("Maximum number of faces at a pole used"),E=this.goldbergData.nbFacesAtPole-1),12+B*this.goldbergData.nbFacesAtPole+E)}_changeGoldbergFaceColors(B){for(let v=0;v<B.length;v++){const E=B[v][0],z=B[v][1],o=B[v][2];for(let B=E;B<z+1;B++)this.goldbergData.faceColors[B]=o}const E=[];for(let v=0;v<12;v++)for(let B=0;B<5;B++)E.push(this.goldbergData.faceColors[v].r,this.goldbergData.faceColors[v].g,this.goldbergData.faceColors[v].b,this.goldbergData.faceColors[v].a);for(let v=12;v<this.goldbergData.faceColors.length;v++)for(let B=0;B<6;B++)E.push(this.goldbergData.faceColors[v].r,this.goldbergData.faceColors[v].g,this.goldbergData.faceColors[v].b,this.goldbergData.faceColors[v].a);return E}setGoldbergFaceColors(B){const E=this._changeGoldbergFaceColors(B);this.pB(q.e.ColorKind,E)}updateGoldbergFaceColors(B){const E=this._changeGoldbergFaceColors(B);this.updateVerticesData(q.e.ColorKind,E)}_changeGoldbergFaceUVs(B){const E=this.getVerticesData(q.e.UVKind);for(let v=0;v<B.length;v++){const z=B[v][0],o=B[v][1],q=B[v][2],c=B[v][3],S=B[v][4],x=[],D=[];let h,y;for(let B=0;B<5;B++)h=q.x+c*Math.cos(S+B*Math.PI/2.5),y=q.y+c*Math.sin(S+B*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),x.push(h,y);for(let B=0;B<6;B++)h=q.x+c*Math.cos(S+B*Math.PI/3),y=q.y+c*Math.sin(S+B*Math.PI/3),h<0&&(h=0),h>1&&(h=1),D.push(h,y);for(let B=z;B<Math.min(12,o+1);B++)for(let v=0;v<5;v++)E[10*B+2*v]=x[2*v],E[10*B+2*v+1]=x[2*v+1];for(let B=Math.max(12,z);B<o+1;B++)for(let v=0;v<6;v++)E[12*B-24+2*v]=D[2*v],E[12*B-23+2*v]=D[2*v+1]}return E}setGoldbergFaceUVs(B){const E=this._changeGoldbergFaceUVs(B);this.pB(q.e.UVKind,E)}updateGoldbergFaceUVs(B){const E=this._changeGoldbergFaceUVs(B);this.updateVerticesData(q.e.UVKind,E)}placeOnGoldbergFaceAt(B,E,v){const o=z.GE.RotationFromAxis(this.goldbergData.faceXaxis[E],this.goldbergData.faceYaxis[E],this.goldbergData.faceZaxis[E]);B.rotation=o,B.position=this.goldbergData.faceCenters[E].add(this.goldbergData.faceXaxis[E].scale(v.x)).add(this.goldbergData.faceYaxis[E].scale(v.y)).add(this.goldbergData.faceZaxis[E].scale(v.z))}serialize(B){super.serialize(B),B.type="GoldbergMesh";const E={};if(E.adjacentFaces=this.goldbergData.adjacentFaces,E.nbSharedFaces=this.goldbergData.nbSharedFaces,E.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,E.nbFaces=this.goldbergData.nbFaces,E.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){E.faceColors=[];for(const B of this.goldbergData.faceColors)E.faceColors.push(B.cc())}if(this.goldbergData.faceCenters){E.faceCenters=[];for(const B of this.goldbergData.faceCenters)E.faceCenters.push(B.cc())}if(this.goldbergData.faceZaxis){E.faceZaxis=[];for(const B of this.goldbergData.faceZaxis)E.faceZaxis.push(B.cc())}if(this.goldbergData.faceYaxis){E.faceYaxis=[];for(const B of this.goldbergData.faceYaxis)E.faceYaxis.push(B.cc())}if(this.goldbergData.faceXaxis){E.faceXaxis=[];for(const B of this.goldbergData.faceXaxis)E.faceXaxis.push(B.cc())}B.goldbergData=E}static Parse(B,E){const v=B.goldbergData;v.faceColors=v.faceColors.map((B=>Q.gc.VE(B))),v.faceCenters=v.faceCenters.map((B=>z.GE.VE(B))),v.faceZaxis=v.faceZaxis.map((B=>z.GE.VE(B))),v.faceXaxis=v.faceXaxis.map((B=>z.GE.VE(B))),v.faceYaxis=v.faceYaxis.map((B=>z.GE.VE(B)));const o=new qB(B.name,E);return o.goldbergData=v,o}}var cB=v(11934);const SB={CreateBox:y.d,CreateTiledBox:a,CreateSphere:m.c,CreateDisc:h.c,CreateIcoSphere:F,CreateRibbon:D,CreateCylinder:N,CreateTorus:r,CreateTorusKnot:u,CreateLineSystem:I.f,RD:I.g,CreateDashedLines:I.b,ExtrudeShape:f,ExtrudeShapeCustom:A,CreateLathe:d,CreateTiledPlane:G,WD:t.d,CreateGround:p.d,CreateTiledGround:p.h,CreateGroundFromHeightMap:p.b,CreatePolygon:K.e,ExtrudePolygon:K.h,CreateTube:H,CreatePolyhedron:R,CreateGeodesic:function(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=E.m||1;z!==Math.floor(z)&&(z=Math.floor(z),Z.c.Warn("m not an integer only floor(m) used"));let o=E.n||0;if(o!==Math.floor(o)&&(o=Math.floor(o),Z.c.Warn("n not an integer only floor(n) used")),o>z){const B=o;o=z,z=B,Z.c.Warn("n > m therefore m and n swapped")}const q=new vB;return q.build(z,o),R(B,{custom:oB.BuildGeodesicData(q),size:E.size,sizeX:E.sizeX,sizeY:E.sizeY,sizeZ:E.sizeZ,faceUV:E.faceUV,faceColors:E.faceColors,flat:E.flat,updatable:E.updatable,sideOrientation:E.sideOrientation,frontUVs:E.frontUVs,backUVs:E.backUVs},v)},CreateGoldberg:function(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=E.size,x=E.sizeX||q||1,D=E.sizeY||q||1,h=E.sizeZ||q||1;let y=E.m||1;y!==Math.floor(y)&&(y=Math.floor(y),Z.c.Warn("m not an integer only floor(m) used"));let P=E.n||0;if(P!==Math.floor(P)&&(P=Math.floor(P),Z.c.Warn("n not an integer only floor(n) used")),P>y){const B=P;P=y,y=B,Z.c.Warn("n > m therefore m and n swapped")}const G=new vB;G.build(y,P);const Y=oB.BuildGeodesicData(G),a=Y.toGoldbergPolyhedronData(),m=new qB(B,v);E.sideOrientation=o.e._GetDefaultSideOrientation(E.sideOrientation),m._originalBuilderSideOrientation=E.sideOrientation;(function(B,E){const v=B.size,o=B.sizeX||v||1,q=B.sizeY||v||1,x=B.sizeZ||v||1,D=0===B.sideOrientation?0:B.sideOrientation||c.c.DEFAULTSIDE,h=[],y=[],Q=[],P=[];let G=1/0,Y=-1/0,a=1/0,m=-1/0;for(let z=0;z<E.vertex.length;z++)G=Math.min(G,E.vertex[z][0]*o),Y=Math.max(Y,E.vertex[z][0]*o),a=Math.min(a,E.vertex[z][1]*q),m=Math.max(m,E.vertex[z][1]*q);let g=0;for(let c=0;c<E.face.length;c++){const B=E.face[c],v=z.GE.VE(E.vertex[B[0]]),D=z.GE.VE(E.vertex[B[2]]),V=z.GE.VE(E.vertex[B[1]]),T=D.YE(v),N=V.YE(v),X=z.GE.Cross(N,T).normalize();for(let z=0;z<B.length;z++){Q.push(X.x,X.y,X.z);const v=E.vertex[B[z]];h.push(v[0]*o,v[1]*q,v[2]*x);const c=(v[1]*q-a)/(m-a);P.push((v[0]*o-G)/(Y-G),S.c?1-c:c)}for(let E=0;E<B.length-2;E++)y.push(g,g+E+2,g+E+1);g+=B.length}c.c._ComputeSides(D,h,y,Q,P);const V=new c.c;return V.uB=h,V.indices=y,V.IB=Q,V.CB=P,V})(E,a).AB(m,E.updatable),m.goldbergData.nbSharedFaces=Y.sharedNodes,m.goldbergData.nbUnsharedFaces=Y.poleNodes,m.goldbergData.adjacentFaces=Y.adjacentFaces,m.goldbergData.nbFaces=m.goldbergData.nbSharedFaces+m.goldbergData.nbUnsharedFaces,m.goldbergData.nbFacesAtPole=(m.goldbergData.nbUnsharedFaces-12)/12;for(let o=0;o<Y.vertex.length;o++)m.goldbergData.faceCenters.push(z.GE.VE(Y.vertex[o])),m.goldbergData.faceCenters[o].x*=x,m.goldbergData.faceCenters[o].y*=D,m.goldbergData.faceCenters[o].z*=h,m.goldbergData.faceColors.push(new Q.gc(1,1,1,1));for(let o=0;o<a.face.length;o++){const B=a.face[o],E=z.GE.VE(a.vertex[B[0]]),v=z.GE.VE(a.vertex[B[2]]),q=z.GE.VE(a.vertex[B[1]]),c=v.YE(E),S=q.YE(E),x=z.GE.Cross(S,c).normalize(),D=z.GE.Cross(S,x).normalize();m.goldbergData.faceXaxis.push(S.normalize()),m.goldbergData.faceYaxis.push(x),m.goldbergData.faceZaxis.push(D)}return m},CreateDecal:k,CreateCapsule:M,CreateText:cB.g}},12688:(B,E,v)=>{"use strict";v.d(E,{d:()=>SE});var z=v(11380),o=v(11772);class q extends o.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var c=v(11417),S=(v(11527),v(11345));class x{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(B){this._targetStopDuration!==B&&(this._targetStopDuration=B)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(B){this._noiseTexture!==B&&(this._noiseTexture=B,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(B){this._animationSheetEnabled!==B&&(this._animationSheetEnabled=B)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(B){this._isAnimationSheetEnabled!=B&&(this._isAnimationSheetEnabled=B,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(B){this._useLogarithmicDepth=B&&this.rB().getEngine().getCaps().fragmentDepthSupported}rB(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(B){switch(B){case x.BLENDMODE_MULTIPLYADD:return;case x.BLENDMODE_ADD:B=1;break;case x.BLENDMODE_ONEONE:B=6;break;case x.BLENDMODE_STANDARD:B=2;break;case x.BLENDMODE_MULTIPLY:B=4;break;case x.BLENDMODE_SUBTRACT:B=3}this._engine.setAlphaMode(B)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:z.GE.Zero()}set direction1(B){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=B)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:z.GE.Zero()}set direction2(B){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=B)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:z.GE.Zero()}set minEmitBox(B){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=B)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:z.GE.Zero()}set maxEmitBox(B){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=B)}get billboardMode(){return this._billboardMode}set billboardMode(B){this._billboardMode!==B&&(this._billboardMode=B,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(B){this._isBillboardBased!==B&&(this._isBillboardBased=B,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(B){this._attachImageProcessingConfiguration(B)}_attachImageProcessingConfiguration(B){B!==this._imageProcessingConfiguration&&(!B&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=B)}_reset(){}_removeGradientAndTexture(B,E,v){if(!E)return this;let z=0;for(const o of E){if(o.gradient===B){E.splice(z,1);break}z++}return v&&v.dispose(),this}constructor(B){this.animations=[],this.renderingGroupId=0,this.zE=z.GE.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new z.GE(10,10,10),this.onAnimationEnd=null,this.blendMode=x.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new z.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.pD=new z.GE(0,0,0),this._useLogarithmicDepth=!1,this.gravity=z.GE.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new c.gc(1,1,1,1),this.color2=new c.gc(1,1,1,1),this.colorDead=new c.gc(0,0,0,1),this.textureMask=new c.gc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new q,this.id=B,this.name=B}createPointEmitter(B,E){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new z.GE(0,1,0),arguments.length>2&&void 0!==arguments[2]||new z.GE(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new z.GE(0,1,0),arguments.length>4&&void 0!==arguments[4]||new z.GE(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new z.GE(0,1,0),arguments.length>3&&void 0!==arguments[3]||new z.GE(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(B,E,v,z){throw new Error("Method not implemented.")}}x.BLENDMODE_ONEONE=0,x.BLENDMODE_STANDARD=1,x.BLENDMODE_ADD=2,x.BLENDMODE_MULTIPLY=3,x.BLENDMODE_MULTIPLYADD=4,x.BLENDMODE_SUBTRACT=-1,(0,S.f)("BABYLON.BaseParticleSystem",x);var D=v(11394),h=v(11222);class y{constructor(){this.direction1=new z.GE(0,1,0),this.direction2=new z.GE(0,1,0),this.minEmitBox=new z.GE(-.5,-.5,-.5),this.maxEmitBox=new z.GE(.5,.5,.5)}startDirectionFunction(B,E,v,o){const q=(0,D.RandomRange)(this.direction1.x,this.direction2.x),c=(0,D.RandomRange)(this.direction1.y,this.direction2.y),S=(0,D.RandomRange)(this.direction1.z,this.direction2.z);if(o)return E.x=q,E.y=c,void(E.z=S);z.GE.TransformNormalFromFloatsToRef(q,c,S,B,E)}startPositionFunction(B,E,v,o){const q=(0,D.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),c=(0,D.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),S=(0,D.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(o)return E.x=q,E.y=c,void(E.z=S);z.GE.TransformCoordinatesFromFloatsToRef(q,c,S,B,E)}clone(){const B=new y;return h.d.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2),B.setVector3("minEmitBox",this.minEmitBox),B.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3),B.addUniform("minEmitBox",3),B.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.direction1=this.direction1.cc(),B.direction2=this.direction2.cc(),B.minEmitBox=this.minEmitBox.cc(),B.maxEmitBox=this.maxEmitBox.cc(),B}parse(B){z.GE.FromArrayToRef(B.direction1,0,this.direction1),z.GE.FromArrayToRef(B.direction2,0,this.direction2),z.GE.FromArrayToRef(B.minEmitBox,0,this.minEmitBox),z.GE.FromArrayToRef(B.maxEmitBox,0,this.maxEmitBox)}}class Q{get radius(){return this._radius}set radius(B){this._radius=B,this._buildHeight()}get angle(){return this._angle}set angle(B){this._angle=B,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=v,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=E,this.radius=B}startDirectionFunction(B,E,v,o){o?z.TmpVectors.GE[0].S(v.Sx).normalize():v.position.subtractToRef(B.getTranslation(),z.TmpVectors.GE[0]).normalize();const q=(0,D.RandomRange)(0,this.directionRandomizer),c=(0,D.RandomRange)(0,this.directionRandomizer),S=(0,D.RandomRange)(0,this.directionRandomizer);E.x=z.TmpVectors.GE[0].x+q,E.y=z.TmpVectors.GE[0].y+c,E.z=z.TmpVectors.GE[0].z+S,E.normalize()}startPositionFunction(B,E,v,o){const q=(0,D.RandomRange)(0,2*Math.PI);let c;this.emitFromSpawnPointOnly?c=1e-4:(c=(0,D.RandomRange)(0,this.heightRange),c=1-c*c);let S=this._radius-(0,D.RandomRange)(0,this._radius*this.radiusRange);S*=c;const x=S*Math.sin(q),h=S*Math.cos(q),y=c*this._height;if(o)return E.x=x,E.y=y,void(E.z=h);z.GE.TransformCoordinatesFromFloatsToRef(x,y,h,B,E)}clone(){const B=new Q(this._radius,this._angle,this.directionRandomizer);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat2("radius",this._radius,this.radiusRange),B.setFloat("coneAngle",this._angle),B.setFloat2("height",this._height,this.heightRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",2),B.addUniform("coneAngle",1),B.addUniform("height",2),B.addUniform("directionRandomizer",1)}getEffectDefines(){let B="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(B+="\n#define CONEEMITTERSPAWNPOINT"),B}getClassName(){return"ConeParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this._radius,B.angle=this._angle,B.directionRandomizer=this.directionRandomizer,B.radiusRange=this.radiusRange,B.heightRange=this.heightRange,B.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,B}parse(B){this.radius=B.radius,this.angle=B.angle,this.directionRandomizer=B.directionRandomizer,this.radiusRange=void 0!==B.radiusRange?B.radiusRange:1,this.heightRange=void 0!==B.radiusRange?B.heightRange:1,this.emitFromSpawnPointOnly=void 0!==B.emitFromSpawnPointOnly&&B.emitFromSpawnPointOnly}}class P extends Q{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0);super(B,E),this.direction1=v,this.direction2=o}startDirectionFunction(B,E){const v=(0,D.RandomRange)(this.direction1.x,this.direction2.x),o=(0,D.RandomRange)(this.direction1.y,this.direction2.y),q=(0,D.RandomRange)(this.direction1.z,this.direction2.z);z.GE.TransformNormalFromFloatsToRef(v,o,q,B,E)}clone(){const B=new P(this.radius,this.angle,this.direction1,this.direction2);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.cc(),B.direction2=this.direction2.cc(),B}parse(B){super.parse(B),this.direction1.S(B.direction1),this.direction2.S(B.direction2)}}class G{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=B,this.height=E,this.radiusRange=v,this.directionRandomizer=o,this._tempVector=z.GE.Zero()}startDirectionFunction(B,E,v,o,q){v.position.subtractToRef(B.getTranslation(),this._tempVector),this._tempVector.normalize(),z.GE.TransformNormalToRef(this._tempVector,q,this._tempVector);const c=(0,D.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,D.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=c,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),o?E.S(this._tempVector):z.GE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,B,E)}startPositionFunction(B,E,v,o){const q=(0,D.RandomRange)(-this.height/2,this.height/2),c=(0,D.RandomRange)(0,2*Math.PI),S=(0,D.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),x=Math.sqrt(S)*this.radius,h=x*Math.cos(c),y=x*Math.sin(c);o?E.Yc(h,q,y):z.GE.TransformCoordinatesFromFloatsToRef(h,q,y,B,E)}clone(){const B=new G(this.radius,this.directionRandomizer);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("height",this.height),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("height",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.height=this.height,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.height=B.height,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class Y extends G{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0),q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.GE(0,1,0);super(B,E,v),this.direction1=o,this.direction2=q}startDirectionFunction(B,E,v,o){const q=(0,D.RandomRange)(this.direction1.x,this.direction2.x),c=(0,D.RandomRange)(this.direction1.y,this.direction2.y),S=(0,D.RandomRange)(this.direction1.z,this.direction2.z);o?E.Yc(q,c,S):z.GE.TransformNormalFromFloatsToRef(q,c,S,B,E)}clone(){const B=new Y(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("height",this.height),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("height",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.cc(),B.direction2=this.direction2.cc(),B}parse(B){super.parse(B),z.GE.FromArrayToRef(B.direction1,0,this.direction1),z.GE.FromArrayToRef(B.direction2,0,this.direction2)}}class a{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=B,this.radiusRange=E,this.directionRandomizer=v}startDirectionFunction(B,E,v,o){const q=v.position.YE(B.getTranslation()).normalize(),c=(0,D.RandomRange)(0,this.directionRandomizer),S=(0,D.RandomRange)(0,this.directionRandomizer),x=(0,D.RandomRange)(0,this.directionRandomizer);q.x+=c,q.y+=S,q.z+=x,q.normalize(),o?E.S(q):z.GE.TransformNormalFromFloatsToRef(q.x,q.y,q.z,B,E)}startPositionFunction(B,E,v,o){const q=this.radius-(0,D.RandomRange)(0,this.radius*this.radiusRange),c=(0,D.RandomRange)(0,1),S=(0,D.RandomRange)(0,2*Math.PI),x=Math.acos(2*c-1),h=q*Math.cos(S)*Math.sin(x),y=q*Math.cos(x),Q=q*Math.sin(S)*Math.sin(x);o?E.Yc(h,Math.abs(y),Q):z.GE.TransformCoordinatesFromFloatsToRef(h,Math.abs(y),Q,B,E)}clone(){const B=new a(this.radius,this.directionRandomizer);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class m{constructor(){this.direction1=new z.GE(0,1,0),this.direction2=new z.GE(0,1,0)}startDirectionFunction(B,E,v,o){const q=(0,D.RandomRange)(this.direction1.x,this.direction2.x),c=(0,D.RandomRange)(this.direction1.y,this.direction2.y),S=(0,D.RandomRange)(this.direction1.z,this.direction2.z);o?E.Yc(q,c,S):z.GE.TransformNormalFromFloatsToRef(q,c,S,B,E)}startPositionFunction(B,E,v,o){o?E.Yc(0,0,0):z.GE.TransformCoordinatesFromFloatsToRef(0,0,0,B,E)}clone(){const B=new m;return h.d.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.direction1=this.direction1.cc(),B.direction2=this.direction2.cc(),B}parse(B){z.GE.FromArrayToRef(B.direction1,0,this.direction1),z.GE.FromArrayToRef(B.direction2,0,this.direction2)}}class g{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=B,this.radiusRange=E,this.directionRandomizer=v}startDirectionFunction(B,E,v,o){const q=v.position.YE(B.getTranslation()).normalize(),c=(0,D.RandomRange)(0,this.directionRandomizer),S=(0,D.RandomRange)(0,this.directionRandomizer),x=(0,D.RandomRange)(0,this.directionRandomizer);q.x+=c,q.y+=S,q.z+=x,q.normalize(),o?E.S(q):z.GE.TransformNormalFromFloatsToRef(q.x,q.y,q.z,B,E)}startPositionFunction(B,E,v,o){const q=this.radius-(0,D.RandomRange)(0,this.radius*this.radiusRange),c=(0,D.RandomRange)(0,1),S=(0,D.RandomRange)(0,2*Math.PI),x=Math.acos(2*c-1),h=q*Math.cos(S)*Math.sin(x),y=q*Math.cos(x),Q=q*Math.sin(S)*Math.sin(x);o?E.Yc(h,y,Q):z.GE.TransformCoordinatesFromFloatsToRef(h,y,Q,B,E)}clone(){const B=new g(this.radius,this.directionRandomizer);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class V extends g{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.GE(0,1,0),v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0);super(B),this.direction1=E,this.direction2=v}startDirectionFunction(B,E){const v=(0,D.RandomRange)(this.direction1.x,this.direction2.x),o=(0,D.RandomRange)(this.direction1.y,this.direction2.y),q=(0,D.RandomRange)(this.direction1.z,this.direction2.z);z.GE.TransformNormalFromFloatsToRef(v,o,q,B,E)}clone(){const B=new V(this.radius,this.direction1,this.direction2);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.cc(),B.direction2=this.direction2.cc(),B}parse(B){super.parse(B),this.direction1.S(B.direction1),this.direction2.S(B.direction2)}}class T{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(B,E,v,o){const q=z.TmpVectors.GE[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,v,q);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,v,q);const B=z.TmpVectors.GE[1];q.subtractToRef(v.position,B),B.scaleToRef(1/v.lifeTime,q)}else q.set(0,0,0);o?E.S(q):z.GE.TransformNormalToRef(q,B,E)}startPositionFunction(B,E,v,o){const q=z.TmpVectors.GE[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,v,q):q.set(0,0,0),o?E.S(q):z.GE.TransformCoordinatesToRef(q,B,E)}clone(){const B=new T;return h.d.DeepCopy(this,B),B}applyToShader(B){}buildUniformLayout(B){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.particlePositionGenerator=this.particlePositionGenerator,B.particleDestinationGenerator=this.particleDestinationGenerator,B}parse(B){B.particlePositionGenerator&&(this.particlePositionGenerator=B.particlePositionGenerator),B.particleDestinationGenerator&&(this.particleDestinationGenerator=B.particleDestinationGenerator)}}var N=v(11442);class X{get mesh(){return this._mesh}set mesh(B){this._mesh!==B&&(this._mesh=B,B?(this._indices=B.Pc(),this._positions=B.getVerticesData(N.e.PositionKind),this._normals=B.getVerticesData(N.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=z.GE.Zero(),this._mesh=null,this.direction1=new z.GE(0,1,0),this.direction2=new z.GE(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=B}startDirectionFunction(B,E,v,o){if(this.useMeshNormalsForDirection&&this._normals)return void z.GE.TransformNormalToRef(this._storedNormal,B,E);const q=(0,D.RandomRange)(this.direction1.x,this.direction2.x),c=(0,D.RandomRange)(this.direction1.y,this.direction2.y),S=(0,D.RandomRange)(this.direction1.z,this.direction2.z);o?E.Yc(q,c,S):z.GE.TransformNormalFromFloatsToRef(q,c,S,B,E)}startPositionFunction(B,E,v,o){if(!this._indices||!this._positions)return;const q=3*(Math.random()*(this._indices.length/3)|0),c=Math.random(),S=Math.random()*(1-c),x=1-c-S,D=this._indices[q],h=this._indices[q+1],y=this._indices[q+2],Q=z.TmpVectors.GE[0],P=z.TmpVectors.GE[1],G=z.TmpVectors.GE[2],Y=z.TmpVectors.GE[3];z.GE.FromArrayToRef(this._positions,3*D,Q),z.GE.FromArrayToRef(this._positions,3*h,P),z.GE.FromArrayToRef(this._positions,3*y,G),Y.x=c*Q.x+S*P.x+x*G.x,Y.y=c*Q.y+S*P.y+x*G.y,Y.z=c*Q.z+S*P.z+x*G.z,o?E.Yc(Y.x,Y.y,Y.z):z.GE.TransformCoordinatesFromFloatsToRef(Y.x,Y.y,Y.z,B,E),this.useMeshNormalsForDirection&&this._normals&&(z.GE.FromArrayToRef(this._normals,3*D,Q),z.GE.FromArrayToRef(this._normals,3*h,P),z.GE.FromArrayToRef(this._normals,3*y,G),this._storedNormal.x=c*Q.x+S*P.x+x*G.x,this._storedNormal.y=c*Q.y+S*P.y+x*G.y,this._storedNormal.z=c*Q.z+S*P.z+x*G.z)}clone(){const B=new X(this.mesh);return h.d.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var B;const E={};return E.type=this.getClassName(),E.direction1=this.direction1.cc(),E.direction2=this.direction2.cc(),E.meshId=null===(B=this.mesh)||void 0===B?void 0:B.id,E.useMeshNormalsForDirection=this.useMeshNormalsForDirection,E}parse(B,E){z.GE.FromArrayToRef(B.direction1,0,this.direction1),z.GE.FromArrayToRef(B.direction2,0,this.direction2),B.meshId&&E&&(this.mesh=E.getLastMeshById(B.meshId)),this.useMeshNormalsForDirection=B.useMeshNormalsForDirection}}class r{_isUbo(B){return void 0!==B.addUniform}constructor(B){this._isUbo(B)?(this.setMatrix3x3=B.updateMatrix3x3.bind(B),this.setMatrix2x2=B.updateMatrix2x2.bind(B),this.setFloat=B.updateFloat.bind(B),this.setFloat2=B.updateFloat2.bind(B),this.setFloat3=B.updateFloat3.bind(B),this.setFloat4=B.updateFloat4.bind(B),this.setFloatArray=B.updateFloatArray.bind(B),this.setArray=B.updateArray.bind(B),this.setIntArray=B.updateIntArray.bind(B),this.setMatrix=B.hc.bind(B),this.setMatrices=B.updateMatrices.bind(B),this.setVector3=B.updateVector3.bind(B),this.setVector4=B.updateVector4.bind(B),this.setColor3=B.updateColor3.bind(B),this.setColor4=B.updateColor4.bind(B),this.setDirectColor4=B.updateDirectColor4.bind(B),this.setInt=B.updateInt.bind(B),this.setInt2=B.updateInt2.bind(B),this.setInt3=B.updateInt3.bind(B),this.setInt4=B.updateInt4.bind(B)):(this.setMatrix3x3=B.setMatrix3x3.bind(B),this.setMatrix2x2=B.setMatrix2x2.bind(B),this.setFloat=B.setFloat.bind(B),this.setFloat2=B.setFloat2.bind(B),this.setFloat3=B.setFloat3.bind(B),this.setFloat4=B.setFloat4.bind(B),this.setFloatArray=B.setFloatArray.bind(B),this.setArray=B.setArray.bind(B),this.setIntArray=B.setIntArray.bind(B),this.setMatrix=B.setMatrix.bind(B),this.setMatrices=B.setMatrices.bind(B),this.setVector3=B.setVector3.bind(B),this.setVector4=B.setVector4.bind(B),this.setColor3=B.setColor3.bind(B),this.setColor4=B.setColor4.bind(B),this.setDirectColor4=B.setDirectColor4.bind(B),this.setInt=B.setInt.bind(B),this.setInt2=B.setInt2.bind(B),this.setInt3=B.setInt3.bind(B),this.setInt4=B.setInt4.bind(B))}}var i=v(11291);const u="gpuUpdateParticlesPixelShader",I="#version 300 es\nvoid main() {discard;}\n";i.c.ShadersStore[u]||(i.c.ShadersStore[u]=I);const K="gpuUpdateParticlesVertexShader",C="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";i.c.ShadersStore[K]||(i.c.ShadersStore[K]=C);(0,S.f)("BABYLON.WebGL2ParticleSystem",class{constructor(B,E){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=B,this._engine=E,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var B;return(null===(B=this._updateEffect)||void 0===B?void 0:B.isReady())??!1}createUpdateBuffer(B){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof T&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=B,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new r(this._updateEffect)}createVertexBuffers(B,E){this._updateVAO.push(this._createUpdateVAO(B)),this._renderVAO.push(this._engine.recordVertexArrayObject(E,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=E}createParticleBuffer(B){return B}bindDrawBuffers(B,E,v){v?this._engine.bindBuffers(this._renderVertexBuffers,v,E):this._engine.bindVertexArrayObject(this._renderVAO[B],null)}preUpdateParticleBuffer(){const B=this._engine;if(this._engine.enableEffect(this._updateEffect),!B.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(B,E,v){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[B],null);const z=this._engine;z.bindTransformFeedbackBuffer(E.getBuffer()),z.setRasterizerState(!1),z.beginTransformFeedback(!0),z.drawArraysType(3,0,v),z.endTransformFeedback(),z.setRasterizerState(!0),z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let B=0;B<this._updateVAO.length;B++)this._engine.releaseVertexArrayObject(this._updateVAO[B]);this._updateVAO.length=0;for(let B=0;B<this._renderVAO.length;B++)this._engine.releaseVertexArrayObject(this._renderVAO[B]);this._renderVAO.length=0}_createUpdateVAO(B){const E={};E.position=B.createVertexBuffer("position",0,3);let v=3;E.age=B.createVertexBuffer("age",v,1),v+=1,E.size=B.createVertexBuffer("size",v,3),v+=3,E.life=B.createVertexBuffer("life",v,1),v+=1,E.seed=B.createVertexBuffer("seed",v,4),v+=4,E.direction=B.createVertexBuffer("direction",v,3),v+=3,this._parent.particleEmitterType instanceof T&&(E.initialPosition=B.createVertexBuffer("initialPosition",v,3),v+=3),this._parent._colorGradientsTexture||(E.color=B.createVertexBuffer("color",v,4),v+=4),this._parent._isBillboardBased||(E.initialDirection=B.createVertexBuffer("initialDirection",v,3),v+=3),this._parent.noiseTexture&&(E.noiseCoordinates1=B.createVertexBuffer("noiseCoordinates1",v,3),v+=3,E.noiseCoordinates2=B.createVertexBuffer("noiseCoordinates2",v,3),v+=3),this._parent._angularSpeedGradientsTexture?(E.angle=B.createVertexBuffer("angle",v,1),v+=1):(E.angle=B.createVertexBuffer("angle",v,2),v+=2),this._parent._isAnimationSheetEnabled&&(E.cellIndex=B.createVertexBuffer("cellIndex",v,1),v+=1,this._parent.spriteRandomStartCell&&(E.cellStartOffset=B.createVertexBuffer("cellStartOffset",v,1),v+=1));const z=this._engine.recordVertexArrayObject(E,null,this._updateEffect);return this._engine.bindArrayBuffer(null),z}});class f{constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,z=arguments.length>3?arguments[3]:void 0;this._engine=B,this._label=z,this._engine._storageBuffers.push(this),this._create(E,v)}_create(B,E){this._bufferSize=B,this._creationFlags=E,this._buffer=this._engine.createStorageBuffer(B,E,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(B,E,v){this._buffer&&this._engine.updateStorageBuffer(this._buffer,B,E,v)}async read(B,E,v,z){return await this._engine.readFromStorageBuffer(this._buffer,B,E,v,z)}dispose(){const B=this._engine._storageBuffers,E=B.indexOf(this);-1!==E&&(B[E]=B[B.length-1],B.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var A=v(11366),l=v(11372),d=v(11409),t=v(11361),p=v(11674),H=v(11213),j=v(11331),R=v(11583);class b{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.b}_addDuration(B,E){B<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==B?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(E,!1),this._gpuTimeInFrameId=B):this.counter.addCount(E,!1))}}var F=v(11278);class W{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=B,this._engine=E,this.uniqueId=p.b.UniqueId,E.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new b),this._engine.getCaps().supportComputeShaders?z.bindingsMapping?(this._context=E.createComputeContext(),this._shaderPath=v,this._options={bindingsMapping:{},defines:[],...z}):H.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):H.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(B,E){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this._bindings[B];this._bindings[B]={type:v?0:4,object:E,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!z||z.object!==E||z.type!==this._bindings[B].type)}setStorageTexture(B,E){const v=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==E),this._bindings[B]={type:1,object:E,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setExternalTexture(B,E){const v=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==E),this._bindings[B]={type:6,object:E,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setVideoTexture(B,E){return!!E.externalTexture&&(this.setExternalTexture(B,E.externalTexture),!0)}setUniformBuffer(B,E){const v=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==E),this._bindings[B]={type:W._BufferIsDataBuffer(E)?7:2,object:E,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setStorageBuffer(B,E){const v=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==E),this._bindings[B]={type:W._BufferIsDataBuffer(E)?7:3,object:E,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setTextureSampler(B,E){const v=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!v||!E.compareSampler(v.object)),this._bindings[B]={type:5,object:E,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}isReady(){let B=this._effect;for(const o in this._bindings){const B=this._bindings[o],E=B.type,v=B.object;switch(E){case 0:case 4:case 1:if(!v.isReady())return!1;break;case 6:if(!v.isReady())return!1;break}}const E=[],v=this._shaderPath;if(this._options.defines)for(let o=0;o<this._options.defines.length;o++)E.push(this._options.defines[o]);const z=E.join("\n");return this._cachedDefines!==z&&(this._cachedDefines=z,B=this._engine.createComputeEffect(v,{defines:z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=B),!!B.isReady()}dispatch(B,E,v){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,B,E,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const v=W._BufferIsDataBuffer(B)?B:B.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,v,E,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const E in this._bindings){const v=this._bindings[E];if(!this._options.bindingsMapping[E])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+E+"'");switch(v.type){case 0:{const z=this._samplers[E],o=v.object;var B;if(!z||!o._texture||!z.compareSampler(o._texture))this._samplers[E]=(new j.d).setParameters(o.wrapU,o.wrapV,o.wrapR,o.anisotropicFilteringLevel,o._texture.samplingMode,null===(B=o._texture)||void 0===B?void 0:B._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const B=v.object;B.getBuffer()!==v.buffer&&(v.buffer=B.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((o=>{(0,F.f)((()=>this.dispatch(B,E,v)),o,void 0,z)}))}serialize(){const B=d.b.Serialize(this);B.options=this._options,B.shaderPath=this._shaderPath,B.JQ={},B.textures={};for(const E in this._bindings){const v=this._bindings[E],z=v.object;switch(v.type){case 0:case 4:case 1:{const o=z.serialize();o&&(B.textures[E]=o,B.JQ[E]={type:v.type});break}}}return B}static Parse(B,E,v){const z=d.b.Parse((()=>new W(B.name,E.getEngine(),B.shaderPath,B.options)),B,E,v);for(const o in B.textures){const q=B.JQ[o],c=t.b.Parse(B.textures[o],E,v);0===q.type?z.setTexture(o,c):4===q.type?z.setTexture(o,c,!1):z.setStorageTexture(o,c)}return z}static _BufferIsDataBuffer(B){return void 0!==B.underlyingResource}}(0,A.c)([(0,l.K)()],W.prototype,"name",void 0),(0,A.c)([(0,l.K)()],W.prototype,"fastMode",void 0),(0,S.f)("BABYLON.ComputeShader",W);var w=v(11629);const n="gpuUpdateParticlesComputeShader",U="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";i.c.ShadersStoreWGSL[n]||(i.c.ShadersStoreWGSL[n]=U);(0,S.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(B,E){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=B,this._engine=E}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var B;return(null===(B=this._updateComputeShader)||void 0===B?void 0:B.isReady())??!1}createUpdateBuffer(B){var E;const v={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(v.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(v.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(v.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(v.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(v.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(v.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(v.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new W("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:v,defines:B.split("\n")}),null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=new w.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new r(this._simParamsComputeShader)}createVertexBuffers(B,E){this._renderVertexBuffers.push(E)}createParticleBuffer(B){const E=new f(this._engine,4*B.length,11,"ComputeShaderParticleSystemBuffer");return E.update(B),this._bufferComputeShader.push(E),E.getBuffer()}bindDrawBuffers(B,E,v){this._engine.bindBuffers(this._renderVertexBuffers[B],v,E)}preUpdateParticleBuffer(){}updateParticleBuffer(B,E,v){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[B]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^B]),this._updateComputeShader.dispatch(Math.ceil(v/64))}releaseBuffers(){var B;for(let E=0;E<this._bufferComputeShader.length;++E)this._bufferComputeShader[E].dispose();this._bufferComputeShader.length=0,null===(B=this._simParamsComputeShader)||void 0===B||B.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class s{constructor(B,E,v){this.gradient=B,this.color1=E,this.color2=v}getColorToRef(B){this.color2?c.gc.LerpToRef(this.color1,this.color2,Math.random(),B):B.S(this.color1)}}class J{constructor(B,E){this.gradient=B,this.color=E}}class O{constructor(B,E,v){this.gradient=B,this.factor1=E,this.factor2=v}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class e{static GetCurrentGradient(B,E,v){if(E[0].gradient>B)return void v(E[0],E[0],1);for(let o=0;o<E.length-1;o++){const z=E[o],q=E[o+1];if(B>=z.gradient&&B<=q.gradient){return void v(z,q,(B-z.gradient)/(q.gradient-z.gradient))}}const z=E.length-1;v(E[z],E[z],1)}}var k=v(11202),L=v(11863),M=v(11242);class Z{constructor(B){this.particleSystem=B,this.position=z.GE.Zero(),this.direction=z.GE.Zero(),this.color=new c.gc(0,0,0,0),this.colorStep=new c.gc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new z.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new c.gc(0,0,0,0),this._currentColor2=new c.gc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Z._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let B=this.age,E=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===E?(E=1,B=this._randomCellOffset):B+=this._randomCellOffset);const v=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let z;z=this._initialSpriteCellLoop?(0,D.Clamp)(B*E%this.lifeTime/this.lifeTime):(0,D.Clamp)(B*E/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+z*v|0}_inheritParticleInfoToSubEmitter(B){if(B.particleSystem.zE.position){const E=B.particleSystem.zE;if(E.position.S(this.position),B.inheritDirection){const B=z.TmpVectors.GE[0];this.direction.normalizeToRef(B),E.setDirection(B,0,Math.PI/2)}}else{B.particleSystem.zE.S(this.position)}this.direction.scaleToRef(B.inheritedVelocityAmount/2,z.TmpVectors.GE[0]),B.particleSystem._inheritedVelocityOffset.S(z.TmpVectors.GE[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const B of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(B)}_reset(){this.age=0,this.id=Z._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(B){B.position.S(this.position),this._initialDirection?B._initialDirection?B._initialDirection.S(this._initialDirection):B._initialDirection=this._initialDirection.clone():B._initialDirection=null,B.direction.S(this.direction),this.Sx&&(B.Sx?B.Sx.S(this.Sx):B.Sx=this.Sx.clone()),B.color.S(this.color),B.colorStep.S(this.colorStep),B.lifeTime=this.lifeTime,B.age=this.age,B._randomCellOffset=this._randomCellOffset,B.size=this.size,B.scale.S(this.scale),B.angle=this.angle,B.angularSpeed=this.angularSpeed,B.particleSystem=this.particleSystem,B.cellIndex=this.cellIndex,B.id=this.id,B._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(B._currentColorGradient=this._currentColorGradient,B._currentColor1.S(this._currentColor1),B._currentColor2.S(this._currentColor2)),this._currentSizeGradient&&(B._currentSizeGradient=this._currentSizeGradient,B._currentSize1=this._currentSize1,B._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(B._currentAngularSpeedGradient=this._currentAngularSpeedGradient,B._currentAngularSpeed1=this._currentAngularSpeed1,B._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(B._currentVelocityGradient=this._currentVelocityGradient,B._currentVelocity1=this._currentVelocity1,B._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(B._currentLimitVelocityGradient=this._currentLimitVelocityGradient,B._currentLimitVelocity1=this._currentLimitVelocity1,B._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(B._currentDragGradient=this._currentDragGradient,B._currentDrag1=this._currentDrag1,B._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(B._initialStartSpriteCellId=this._initialStartSpriteCellId,B._initialEndSpriteCellId=this._initialEndSpriteCellId,B._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(B.remapData&&this.remapData?B.remapData.S(this.remapData):B.remapData=new z.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(B._randomNoiseCoordinates1?(B._randomNoiseCoordinates1.S(this._randomNoiseCoordinates1),B._randomNoiseCoordinates2.S(this._randomNoiseCoordinates2)):(B._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),B._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}Z._Count=0;var BB=v(11480),EB=(v(11520),v(11752)),vB=v(11749),zB=v(11620);function oB(B,E){const v=(0,D.RandomRange)(0,1);c.gc.LerpToRef(E.color1,E.color2,v,B.color),E.colorDead.subtractToRef(B.color,E._colorDiff),E._colorDiff.scaleToRef(1/B.lifeTime,B.colorStep)}function qB(B,E){B._currentColorGradient=E._colorGradients[0],B._currentColorGradient.getColorToRef(B.color),B._currentColor1.S(B.color),E._colorGradients.length>1?E._colorGradients[1].getColorToRef(B._currentColor2):B._currentColor2.S(B.color)}function cB(B,E){const v=E._colorGradients;e.GetCurrentGradient(E._ratio,v,((E,v,z)=>{E!==B._currentColorGradient&&(B._currentColor1.S(B._currentColor2),v.getColorToRef(B._currentColor2),B._currentColorGradient=E),c.gc.LerpToRef(B._currentColor1,B._currentColor2,z,B.color)}))}function SB(B,E){B.colorStep.scaleToRef(E._scaledUpdateSpeed,E._scaledColorStep),B.color.addInPlace(E._scaledColorStep),B.color.a<0&&(B.color.a=0)}function xB(B,E){e.GetCurrentGradient(E._ratio,E._angularSpeedGradients,((E,v,z)=>{E!==B._currentAngularSpeedGradient&&(B._currentAngularSpeed1=B._currentAngularSpeed2,B._currentAngularSpeed2=v.getFactor(),B._currentAngularSpeedGradient=E),B.angularSpeed=(0,D.Lerp)(B._currentAngularSpeed1,B._currentAngularSpeed2,z)}))}function DB(B,E){B.angle+=B.angularSpeed*E._scaledUpdateSpeed}function hB(B,E){E.particleEmitterType.startDirectionFunction(E._emitterWorldMatrix,B.direction,B,E.isLocal,E._emitterInverseWorldMatrix)}function yB(B,E){E.startDirectionFunction(E._emitterWorldMatrix,B.direction,B,E.isLocal)}function QB(B,E){B._currentVelocityGradient=E._velocityGradients[0],B._currentVelocity1=B._currentVelocityGradient.getFactor(),E._velocityGradients.length>1?B._currentVelocity2=E._velocityGradients[1].getFactor():B._currentVelocity2=B._currentVelocity1}function PB(B,E){B._currentLimitVelocityGradient=E._limitVelocityGradients[0],B._currentLimitVelocity1=B._currentLimitVelocityGradient.getFactor(),E._limitVelocityGradients.length>1?B._currentLimitVelocity2=E._limitVelocityGradients[1].getFactor():B._currentLimitVelocity2=B._currentLimitVelocity1}function GB(B,E){e.GetCurrentGradient(E._ratio,E._velocityGradients,((v,z,o)=>{v!==B._currentVelocityGradient&&(B._currentVelocity1=B._currentVelocity2,B._currentVelocity2=z.getFactor(),B._currentVelocityGradient=v),E._directionScale*=(0,D.Lerp)(B._currentVelocity1,B._currentVelocity2,o)}))}function YB(B,E){e.GetCurrentGradient(E._ratio,E._limitVelocityGradients,((v,z,o)=>{v!==B._currentLimitVelocityGradient&&(B._currentLimitVelocity1=B._currentLimitVelocity2,B._currentLimitVelocity2=z.getFactor(),B._currentLimitVelocityGradient=v);const q=(0,D.Lerp)(B._currentLimitVelocity1,B._currentLimitVelocity2,o);B.direction.length()>q&&B.direction.scaleInPlace(E.limitVelocityDamping)}))}function aB(B,E){B.direction.scaleToRef(E._directionScale,E._scaledDirection)}function mB(B,E){E.particleEmitterType.startPositionFunction(E._emitterWorldMatrix,B.position,B,E.isLocal)}function gB(B,E){E.startPositionFunction(E._emitterWorldMatrix,B.position,B,E.isLocal)}function VB(B,E){B.Sx?B.Sx.S(B.position):B.Sx=B.position.clone(),z.GE.TransformCoordinatesToRef(B.Sx,E._emitterWorldMatrix,B.position)}function TB(B,E){E.isLocal&&B.Sx?(B.Sx.addInPlace(E._scaledDirection),z.GE.TransformCoordinatesToRef(B.Sx,E._emitterWorldMatrix,B.position)):B.position.addInPlace(E._scaledDirection)}function NB(B,E){B._currentDragGradient=E._dragGradients[0],B._currentDrag1=B._currentDragGradient.getFactor(),E._dragGradients.length>1?B._currentDrag2=E._dragGradients[1].getFactor():B._currentDrag2=B._currentDrag1}function XB(B,E){e.GetCurrentGradient(E._ratio,E._dragGradients,((v,z,o)=>{v!==B._currentDragGradient&&(B._currentDrag1=B._currentDrag2,B._currentDrag2=z.getFactor(),B._currentDragGradient=v);const q=(0,D.Lerp)(B._currentDrag1,B._currentDrag2,o);E._scaledDirection.scaleInPlace(1-q)}))}function rB(B,E){B._randomNoiseCoordinates1?(B._randomNoiseCoordinates1.Yc(Math.random(),Math.random(),Math.random()),B._randomNoiseCoordinates2.Yc(Math.random(),Math.random(),Math.random())):(B._randomNoiseCoordinates1=new z.GE(Math.random(),Math.random(),Math.random()),B._randomNoiseCoordinates2=new z.GE(Math.random(),Math.random(),Math.random()))}function iB(B,E){const v=E._noiseTextureData,o=E._noiseTextureSize;if(v&&o&&B._randomNoiseCoordinates1){const q=E._fetchR(B._randomNoiseCoordinates1.x,B._randomNoiseCoordinates1.y,o.width,o.height,v),c=E._fetchR(B._randomNoiseCoordinates1.z,B._randomNoiseCoordinates2.x,o.width,o.height,v),S=E._fetchR(B._randomNoiseCoordinates2.y,B._randomNoiseCoordinates2.z,o.width,o.height,v),x=z.TmpVectors.GE[0],D=z.TmpVectors.GE[1];x.Yc((2*q-1)*E.noiseStrength.x,(2*c-1)*E.noiseStrength.y,(2*S-1)*E.noiseStrength.z),x.scaleToRef(E._tempScaledUpdateSpeed,D),B.direction.addInPlace(D)}}function uB(B,E){E.gravity.scaleToRef(E._tempScaledUpdateSpeed,E._scaledGravity),B.direction.addInPlace(E._scaledGravity)}function IB(B,E){B.size=(0,D.RandomRange)(E.minSize,E.maxSize),B.scale.Yc((0,D.RandomRange)(E.minScaleX,E.maxScaleX),(0,D.RandomRange)(E.minScaleY,E.maxScaleY))}function KB(B,E){B._currentSizeGradient=E._sizeGradients[0],B._currentSize1=B._currentSizeGradient.getFactor(),B.size=B._currentSize1,E._sizeGradients.length>1?B._currentSize2=E._sizeGradients[1].getFactor():B._currentSize2=B._currentSize1,B.scale.Yc((0,D.RandomRange)(E.minScaleX,E.maxScaleX),(0,D.RandomRange)(E.minScaleY,E.maxScaleY))}function CB(B,E){const v=E._actualFrame/E.targetStopDuration;e.GetCurrentGradient(v,E._startSizeGradients,((v,z,o)=>{v!==E._currentStartSizeGradient&&(E._currentStartSize1=E._currentStartSize2,E._currentStartSize2=z.getFactor(),E._currentStartSizeGradient=v);const q=(0,D.Lerp)(E._currentStartSize1,E._currentStartSize2,o);B.scale.scaleInPlace(q)}))}function fB(B,E){e.GetCurrentGradient(E._ratio,E._sizeGradients,((E,v,z)=>{E!==B._currentSizeGradient&&(B._currentSize1=B._currentSize2,B._currentSize2=v.getFactor(),B._currentSizeGradient=E),B.size=(0,D.Lerp)(B._currentSize1,B._currentSize2,z)}))}function AB(B,E){B.remapData=new z.Vector4(0,1,0,1)}function lB(B,E){E._colorRemapGradients&&E._colorRemapGradients.length>0&&e.GetCurrentGradient(E._ratio,E._colorRemapGradients,((E,v,z)=>{const o=(0,D.Lerp)(E.factor1,v.factor1,z),q=(0,D.Lerp)(E.factor2,v.factor2,z);B.remapData.x=o,B.remapData.y=q-o})),E._alphaRemapGradients&&E._alphaRemapGradients.length>0&&e.GetCurrentGradient(E._ratio,E._alphaRemapGradients,((E,v,z)=>{const o=(0,D.Lerp)(E.factor1,v.factor1,z),q=(0,D.Lerp)(E.factor2,v.factor2,z);B.remapData.z=o,B.remapData.w=q-o}))}function dB(B,E){const v=(0,D.Clamp)(E._actualFrame/E.targetStopDuration);e.GetCurrentGradient(v,E._lifeTimeGradients,((E,z)=>{const o=E,q=z,c=o.getFactor(),S=q.getFactor(),x=(v-o.gradient)/(q.gradient-o.gradient);B.lifeTime=(0,D.Lerp)(c,S,x)})),E._emitPower=(0,D.RandomRange)(E.minEmitPower,E.maxEmitPower)}function tB(B,E){B.lifeTime=(0,D.RandomRange)(E.minLifeTime,E.maxLifeTime),E._emitPower=(0,D.RandomRange)(E.minEmitPower,E.maxEmitPower)}function pB(B,E){0===E._emitPower?(B._initialDirection?B._initialDirection.S(B.direction):B._initialDirection=B.direction.clone(),B.direction.set(0,0,0)):(B._initialDirection=null,B.direction.scaleInPlace(E._emitPower)),B.direction.addInPlace(E._inheritedVelocityOffset)}function HB(B,E){B.angularSpeed=(0,D.RandomRange)(E.minAngularSpeed,E.maxAngularSpeed),B.angle=(0,D.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function jB(B,E){B._currentAngularSpeedGradient=E._angularSpeedGradients[0],B.angularSpeed=B._currentAngularSpeedGradient.getFactor(),B._currentAngularSpeed1=B.angularSpeed,E._angularSpeedGradients.length>1?B._currentAngularSpeed2=E._angularSpeedGradients[1].getFactor():B._currentAngularSpeed2=B._currentAngularSpeed1,B.angle=(0,D.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function RB(B,E){B._initialStartSpriteCellId=E.startSpriteCellID,B._initialEndSpriteCellId=E.endSpriteCellID,B._initialSpriteCellLoop=E.spriteCellLoop}function bB(B,E){B.previousItem=E.previousItem,B.nextItem=E,E.previousItem&&(E.previousItem.nextItem=B),E.previousItem=B}function FB(B,E){B.previousItem=E,B.nextItem=E.nextItem,E.nextItem&&(E.nextItem.previousItem=B),E.nextItem=B}function WB(B,E){let v=E;for(;v.nextItem;)v=v.nextItem;B.previousItem=v,B.nextItem=v.nextItem,v.nextItem=B}function wB(B){B.previousItem&&(B.previousItem.nextItem=B.nextItem),B.nextItem&&(B.nextItem.previousItem=B.previousItem)}class nB extends x{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(B){this._startDirectionFunction!==B&&(this._startDirectionFunction=B,this._directionProcessing.process=B?yB:hB)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(B){this._startPositionFunction!==B&&(this._startPositionFunction=B,this._positionCreation.process=B?gB:mB)}set onDispose(B){this._onDisposeObserver&&this.eq.remove(this._onDisposeObserver),this._onDisposeObserver=this.eq.add(B)}get P(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(B){this._useRampGradients!==B&&(this._useRampGradients=B,this._resetEffect(),B?(this._rampCreation={process:AB,previousItem:null,nextItem:null},FB(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:lB,previousItem:null,nextItem:null},FB(this._remapGradientProcessing,this._gravityProcessing)):(wB(this._rampCreation),wB(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(B){this._isLocal!==B&&(this._isLocal=B,B?(this._isLocalCreation={process:VB,previousItem:null,nextItem:null},FB(this._isLocalCreation,this._positionCreation)):wB(this._isLocalCreation))}get particles(){return this.WQ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(B){this._animationSheetEnabled!==B&&(this._animationSheetEnabled=B,B?(this._sheetCreation={process:RB,previousItem:null,nextItem:null},FB(this._sheetCreation,this._colorCreation)):wB(this._sheetCreation),this._reset())}getActiveCount(){return this.WQ.length}getClassName(){return"rc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var B;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._customWrappers[E])||void 0===B?void 0:B.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[B]??this._customWrappers[0]}setCustomEffect(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new BB.b(this._engine),this._customWrappers[E].effect=B,this._customWrappers[E].drawContext&&(this._customWrappers[E].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(B){if(this.noiseTexture!==B){if(this._noiseTexture=B,!B)return wB(this._noiseCreation),void wB(this._noiseProcessing);this._noiseCreation={process:rB,previousItem:null,nextItem:null},FB(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:iB,previousItem:null,nextItem:null},FB(this._noiseProcessing,this._positionProcessing)}}constructor(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(B),this._emitterInverseWorldMatrix=z.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new z.GE,this.eq=new k.e,this.onStoppedObservable=new k.e,this.onStartedObservable=new k.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.WQ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new c.gc(0,0,0,0),this._colorDiff=new c.gc(0,0,0,0),this._scaledDirection=z.GE.Zero(),this._scaledGravity=z.GE.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=B=>{},this.recycleParticle=B=>{const E=this.WQ.pop();E!==B&&E.copyTo(B),this._stockParticles.push(E)},this._createParticle=()=>{let B;return 0!==this._stockParticles.length?(B=this._stockParticles.pop(),B._reset()):B=new Z(this),this._prepareParticle(B),B},this.paused=!1,this._shadersLoaded=!1,this._capacity=E,this._epsilon=S,v&&"Scene"!==v.getClassName()?(this._engine=v,this.defaultProjectionMatrix=z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=v||M.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.bQ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:tB,previousItem:null,nextItem:null},this._positionCreation={process:mB,previousItem:null,nextItem:null},FB(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:hB,previousItem:null,nextItem:null},FB(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:pB,previousItem:null,nextItem:null},FB(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:IB,previousItem:null,nextItem:null},FB(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:HB,previousItem:null,nextItem:null},FB(this._angleCreation,this._sizeCreation),this._colorCreation={process:oB,previousItem:null,nextItem:null},FB(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,x||(this._colorProcessing={process:SB,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:DB,previousItem:null,nextItem:null},FB(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:aB,previousItem:null,nextItem:null},FB(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:TB,previousItem:null,nextItem:null},FB(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:uB,previousItem:null,nextItem:null},FB(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=q,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=o,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new y,this.updateFunction=B=>{var E;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(E=this.noiseTexture.getContent())||void 0===E||E.then((B=>{this._noiseTextureData=B})));const v=B===this.WQ;for(let z=0;z<B.length;z++){const E=B[z];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const o=E.age;if(E.age+=this._tempScaledUpdateSpeed,E.age>E.lifeTime){const B=E.age-o,v=E.lifeTime-o;this._tempScaledUpdateSpeed=v*this._tempScaledUpdateSpeed/B,E.age=E.lifeTime}this._ratio=E.age/E.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let q=this._updateQueueStart;for(;q;)q.process(E,this),q=q.nextItem;if(this._isAnimationSheetEnabled&&!x&&E.updateCellIndex(),E._inheritParticleInfoToSubEmitters(),E.age>=E.lifeTime){if(this._emitFromParticle(E),E._attachedSubEmitters){for(const B of E._attachedSubEmitters)B.particleSystem.disposeOnStop=!0,B.particleSystem.stop();E._attachedSubEmitters=null}this.recycleParticle(E),v&&z--}else;}}}serialize(B){throw new Error("Method not implemented.")}clone(B,E){throw new Error("Method not implemented.")}_addFactorGradient(B,E,v,z){const o=new O(E,v,z);B.push(o),B.sort(((B,E)=>B.gradient<E.gradient?-1:B.gradient>E.gradient?1:0))}_removeFactorGradient(B,E){if(!B)return;let v=0;for(const z of B){if(z.gradient===E){B.splice(v,1);break}v++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=dB:this._lifeTimeCreation.process=tB}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:CB,previousItem:null,nextItem:null},FB(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(wB(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(B){this.targetStopDuration!==B&&(this._targetStopDuration=B,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(B,E,v){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,B,E,v),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(B){return this._removeFactorGradient(this._lifeTimeGradients,B),this._syncLifeTimeCreation(),this}addSizeGradient(B,E,v){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=KB,this._sizeGradientProcessing={process:fB,previousItem:null,nextItem:null},bB(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,B,E,v),this}removeSizeGradient(B){var E;return this._removeFactorGradient(this._sizeGradients,B),0===(null===(E=this._sizeGradients)||void 0===E?void 0:E.length)&&(wB(this._sizeGradientProcessing),this._sizeCreation.process=IB),this}addColorRemapGradient(B,E,v){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,B,E,v),this}removeColorRemapGradient(B){return this._removeFactorGradient(this._colorRemapGradients,B),this}addAlphaRemapGradient(B,E,v){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,B,E,v),this}removeAlphaRemapGradient(B){return this._removeFactorGradient(this._alphaRemapGradients,B),this}addAngularSpeedGradient(B,E,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=jB,this._angularSpeedGradientProcessing={process:xB,previousItem:null,nextItem:null},bB(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,B,E,v),this}removeAngularSpeedGradient(B){var E;return this._removeFactorGradient(this._angularSpeedGradients,B),0===(null===(E=this._angularSpeedGradients)||void 0===E?void 0:E.length)&&(this._angleCreation.process=HB,wB(this._angularSpeedGradientProcessing)),this}addVelocityGradient(B,E,v){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:QB,previousItem:null,nextItem:null},FB(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:GB,previousItem:null,nextItem:null},bB(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,B,E,v),this}removeVelocityGradient(B){var E;return this._removeFactorGradient(this._velocityGradients,B),0===(null===(E=this._velocityGradients)||void 0===E?void 0:E.length)&&(wB(this._velocityCreation),wB(this._velocityGradientProcessing)),this}addLimitVelocityGradient(B,E,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:PB,previousItem:null,nextItem:null},FB(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:YB,previousItem:null,nextItem:null},FB(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,B,E,v),this}removeLimitVelocityGradient(B){var E;return this._removeFactorGradient(this._limitVelocityGradients,B),0===(null===(E=this._limitVelocityGradients)||void 0===E?void 0:E.length)&&(wB(this._limitVelocityCreation),wB(this._limitVelocityGradientProcessing)),this}addDragGradient(B,E,v){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:NB,previousItem:null,nextItem:null},bB(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:XB,previousItem:null,nextItem:null},bB(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,B,E,v),this}removeDragGradient(B){var E;return this._removeFactorGradient(this._dragGradients,B),0===(null===(E=this._dragGradients)||void 0===E?void 0:E.length)&&(wB(this._dragCreation),wB(this._dragGradientProcessing)),this}addEmitRateGradient(B,E,v){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,B,E,v),this}removeEmitRateGradient(B){return this._removeFactorGradient(this._emitRateGradients,B),this}addStartSizeGradient(B,E,v){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,B,E,v),this._syncStartSizeCreation(),this}removeStartSizeGradient(B){return this._removeFactorGradient(this._startSizeGradients,B),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const B=new Uint8Array(4*this._rawTextureWidth),E=c.TmpColors.gE[0];for(let v=0;v<this._rawTextureWidth;v++){const z=v/this._rawTextureWidth;e.GetCurrentGradient(z,this._rampGradients,((z,o,q)=>{c.gE.LerpToRef(z.color,o.color,q,E),B[4*v]=255*E.r,B[4*v+1]=255*E.g,B[4*v+2]=255*E.b,B[4*v+3]=255}))}this._rampGradientsTexture=L.d.CreateRGBATexture(B,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((B,E)=>B.gradient<E.gradient?-1:B.gradient>E.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(B,E){this._rampGradients||(this._rampGradients=[]);const v=new J(B,E);return this._rampGradients.push(v),this._syncRampGradientTexture(),this}removeRampGradient(B){return this._removeGradientAndTexture(B,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(B,E,v){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=qB,this._colorProcessing.process=cB);const z=new s(B,E,v);return this._colorGradients.push(z),this._colorGradients.sort(((B,E)=>B.gradient<E.gradient?-1:B.gradient>E.gradient?1:0)),this}removeColorGradient(B){if(!this._colorGradients)return this;let E=0;for(const v of this._colorGradients){if(v.gradient===B){this._colorGradients.splice(E,1);break}E++}return 0===this._colorGradients.length&&(this._colorCreation.process=oB,this._colorProcessing.process=SB),this}resetDrawCache(){if(this._drawWrappers){for(const B of this._drawWrappers)if(B)for(const E of B)null===E||void 0===E||E.dispose();this._drawWrappers=[]}}_fetchR(B,E,v,z,o){return o[4*(((B=.5*Math.abs(B)+.5)*v%v|0)+((E=.5*Math.abs(E)+.5)*z%z|0)*v)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const B=this._engine,E=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*E),this._vertexBuffer=new N.d(B,this._vertexData,!0,E);let v=0;const z=this._vertexBuffer.createVertexBuffer(N.e.PositionKind,v,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[N.e.PositionKind]=z,v+=3;const o=this._vertexBuffer.createVertexBuffer(N.e.ColorKind,v,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[N.e.ColorKind]=o,v+=4;const q=this._vertexBuffer.createVertexBuffer("angle",v,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=q,v+=1;const c=this._vertexBuffer.createVertexBuffer("size",v,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=c,v+=2,this._isAnimationSheetEnabled){const B=this._vertexBuffer.createVertexBuffer("cellIndex",v,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=B,v+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const B=this._vertexBuffer.createVertexBuffer("direction",v,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=B,v+=3}if(this._useRampGradients){const B=this._vertexBuffer.createVertexBuffer("remapData",v,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=B,v+=4}let S;if(this._useInstancing){const E=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new N.d(B,E,!1,2),S=this._spriteBuffer.createVertexBuffer("offset",0,2)}else S=this._vertexBuffer.createVertexBuffer("offset",v,2,this._vertexBufferSize,this._useInstancing),v+=2;this._vertexBuffers.offset=S,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const B=[],E=[];let v=0;for(let z=0;z<this._capacity;z++)B.push(v),B.push(v+1),B.push(v+2),B.push(v),B.push(v+2),B.push(v+3),E.push(v,v+1,v+1,v+2,v+2,v+3,v+3,v,v,v+3),v+=4;this._indexBuffer=this._engine.createIndexBuffer(B),this._linesIndexBuffer=this._engine.createIndexBuffer(E)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(B)setTimeout((()=>{this.start(0)}),B);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var E;-1!==(null===(E=this.zE)||void 0===E?void 0:E.getClassName().indexOf("Mesh"))&&this.zE.yc(!0);const B=this.noiseTexture;if(B&&B.onGeneratedObservable)B.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),B.render()}))}));else for(let E=0;E<this.preWarmCycles;E++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(B))}_postStop(B){}reset(){this._stockParticles.length=0,this.WQ.length=0}_appendParticleVertex(B,E,v,o){let q=B*this._vertexBufferSize;if(this._vertexData[q++]=E.position.x+this.pD.x,this._vertexData[q++]=E.position.y+this.pD.y,this._vertexData[q++]=E.position.z+this.pD.z,this._vertexData[q++]=E.color.r,this._vertexData[q++]=E.color.g,this._vertexData[q++]=E.color.b,this._vertexData[q++]=E.color.a,this._vertexData[q++]=E.angle,this._vertexData[q++]=E.scale.x*E.size,this._vertexData[q++]=E.scale.y*E.size,this._isAnimationSheetEnabled&&(this._vertexData[q++]=E.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[q++]=E.direction.x,this._vertexData[q++]=E.direction.y,this._vertexData[q++]=E.direction.z);else if(E._initialDirection){let B=E._initialDirection;this.isLocal&&(z.GE.TransformNormalToRef(B,this._emitterWorldMatrix,z.TmpVectors.GE[0]),B=z.TmpVectors.GE[0]),0===B.x&&0===B.z&&(B.x=.001),this._vertexData[q++]=B.x,this._vertexData[q++]=B.y,this._vertexData[q++]=B.z}else{let B=E.direction;this.isLocal&&(z.GE.TransformNormalToRef(B,this._emitterWorldMatrix,z.TmpVectors.GE[0]),B=z.TmpVectors.GE[0]),0===B.x&&0===B.z&&(B.x=.001),this._vertexData[q++]=B.x,this._vertexData[q++]=B.y,this._vertexData[q++]=B.z}this._useRampGradients&&E.remapData&&(this._vertexData[q++]=E.remapData.x,this._vertexData[q++]=E.remapData.y,this._vertexData[q++]=E.remapData.z,this._vertexData[q++]=E.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===v?v=this._epsilon:1===v&&(v=1-this._epsilon),0===o?o=this._epsilon:1===o&&(o=1-this._epsilon)),this._vertexData[q++]=v,this._vertexData[q++]=o)}_prepareParticle(B){}_createNewOnes(B){let E;for(let v=0;v<B&&this.WQ.length!==this._capacity;v++){E=this._createParticle(),this.WQ.push(E);let B=this._createQueueStart;for(;B;)B.process(E,this),B=B.nextItem;E._inheritParticleInfoToSubEmitters()}}_update(B){if(this._alive=this.WQ.length>0,this.zE.position){const B=this.zE;this._emitterWorldMatrix=B.getWorldMatrix()}else{const B=this.zE;this._emitterWorldMatrix=z.Matrix.Translation(B.x,B.y,B.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.WQ),this._createNewOnes(B)}static _GetAttributeNamesOrOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=[N.e.PositionKind,N.e.ColorKind,"angle","offset","size"];return B&&z.push("cellIndex"),E||z.push("direction"),v&&z.push("remapData"),z}static _GetEffectCreationOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,EB.d)(z),B&&z.push("particlesInfos"),E&&z.push("logarithmicDepthConstant"),v&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(B,E){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,EB.i)(this,this._scene,B),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&B.push("#define FOG")),this._isAnimationSheetEnabled&&B.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&B.push("#define LOGARITHMICDEPTH"),E===x.BLENDMODE_MULTIPLY&&B.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&B.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(B.push("#define BILLBOARD"),this.billboardMode){case 2:B.push("#define BILLBOARDY");break;case 8:case 9:B.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&B.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:B.push("#define BILLBOARDMODE_ALL")}v&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),B.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(B,E,v){E.push(...nB._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),B.push(...nB._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),v.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,zB.f)(B,this._imageProcessingConfigurationDefines),(0,zB.b)(v,this._imageProcessingConfigurationDefines))}_getWrapper(B){const E=this._getCustomDrawWrapper(B);if(null!==E&&void 0!==E&&E.effect)return E;const v=[];this.fillDefines(v,B);const z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let o=this._drawWrappers[z];o||(o=this._drawWrappers[z]=[]);let q=o[B];q||(q=new BB.b(this._engine),q.drawContext&&(q.drawContext.useInstancing=this._useInstancing),o[B]=q);const c=v.join("\n");if(q.defines!==c){const B=[],E=[],v=[];this.fillUniformsAttributesAndSamplerNames(E,B,v),q.setEffect(this._engine.createEffect("particles",B,E,v,c,void 0,void 0,void 0,void 0,this._shaderLanguage),c)}return q}animate(){var B;let E,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!v&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(v?this.preWarmStepOffset:(null===(B=this._scene)||void 0===B?void 0:B.getAnimationRatio())||1),this.manualEmitCount>-1)E=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let B=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const E=this._actualFrame/this.targetStopDuration;e.GetCurrentGradient(E,this._emitRateGradients,((E,v,z)=>{E!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=v.getFactor(),this._currentEmitRateGradient=E),B=(0,D.Lerp)(this._currentEmitRate1,this._currentEmitRate2,z)}))}E=B*this._scaledUpdateSpeed|0,this._newPartsExcess+=B*this._scaledUpdateSpeed-E}if(this._newPartsExcess>1&&(E+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?E=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(E),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!v){let B=0;for(let E=0;E<this.WQ.length;E++){const v=this.WQ[E];this._appendParticleVertices(B,v),B+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.WQ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(B,E){this._appendParticleVertex(B++,E,0,0),this._useInstancing||(this._appendParticleVertex(B++,E,1,0),this._appendParticleVertex(B++,E,1,1),this._appendParticleVertex(B++,E,0,1))}rebuild(){var B;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(B=this._spriteBuffer)||void 0===B||B._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!nB.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(v.bind(v,12858)),Promise.resolve().then(v.bind(v,12803))])):await Promise.all([Promise.resolve().then(v.bind(v,12795)),Promise.resolve().then(v.bind(v,12787))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.zE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==x.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(x.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(x.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(B){const E=this._getWrapper(B),v=E.effect,o=this._engine;o.enableEffect(E);const q=this.defaultViewMatrix??this._scene.getViewMatrix();if(v.setTexture("diffuseSampler",this.particleTexture),v.setMatrix("view",q),v.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const B=this.particleTexture.getBaseSize();v.setFloat3("particlesInfos",this.spriteCellWidth/B.width,this.spriteCellHeight/B.height,this.spriteCellWidth/B.width)}if(v.setVector2("translationPivot",this.translationPivot),v.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const B=this._scene.activeCamera;v.setVector3("eyePosition",B.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),v.setTexture("rampSampler",this._rampGradientsTexture));const c=v.defines;var S,x,D,h,y,Q;(this._scene&&((0,EB.f)(v,this,this._scene),this.applyFog&&(0,vB.g)(this._scene,void 0,v)),c.indexOf("#define BILLBOARDMODE_ALL")>=0&&(q.invertToRef(z.TmpVectors.Matrix[0]),v.setMatrix("invView",z.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?o.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,v):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,v)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?o.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBuffer:this._indexBuffer,v):o.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null,v);(this.useLogarithmicDepth&&this._scene&&(0,vB.k)(c,v,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(v),this._setEngineBasedOnBlendMode(B),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(v),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?o.drawElementsType(6,0,10,this.WQ.length):o.drawArraysType(7,0,4,this.WQ.length):null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?o.drawElementsType(1,0,10*this.WQ.length):o.drawElementsType(0,0,6*this.WQ.length);return this.WQ.length}render(){if(!this.isReady()||!this.WQ.length)return 0;const B=this._engine;B.setState&&(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0));let E=0;return E=this.blendMode===x.BLENDMODE_MULTIPLYADD?this._render(x.BLENDMODE_MULTIPLY)+this._render(x.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),E}_onDispose(){}dispose(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),B&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),B&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(E,v),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const B=this._scene.bQ.indexOf(this);B>-1&&this._scene.bQ.splice(B,1),this._scene._activeParticleSystems.dispose()}this.eq.notifyObservers(this),this.eq.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}nB.ForceGLSL=!1;var UB,sB=v(11235);!function(B){B[B.ATTACHED=0]="ATTACHED",B[B.END=1]="END"}(UB||(UB={}));class JB{constructor(B){if(this.particleSystem=B,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!B.zE||!B.zE.dispose){const E=(0,S.b)("BABYLON.AbstractMesh");B.zE=new E("SubemitterSystemEmitter",B.rB()),B._disposeEmitterOnDispose=!0}}clone(){let B=this.particleSystem.zE;if(B){if(B instanceof z.GE)B=B.clone();else if(-1!==B.getClassName().indexOf("Mesh")){B=new((0,S.b)("BABYLON.Mesh"))("",B.rB()),B.isVisible=!1}}else B=new z.GE;const E=new JB(this.particleSystem.clone(this.particleSystem.name,B));return E.particleSystem.name+="Clone",E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem._disposeEmitterOnDispose=!0,E.particleSystem.disposeOnStop=!0,E}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem=this.particleSystem.serialize(B),E}static _ParseParticleSystem(B,E,v){throw(0,sB.e)("ParseParticle")}static Parse(B,E,v){const z=B.particleSystem,o=new JB(JB._ParseParticleSystem(z,E,v,!0));return o.type=B.type,o.inheritDirection=B.inheritDirection,o.inheritedVelocityAmount=B.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o}dispose(){this.particleSystem.dispose()}}var OB=v(11282);function eB(B,E){const v=new m;return v.direction1=B,v.direction2=E,v}function kB(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function LB(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function MB(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.GE(0,1,0),v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0);return new V(B,E,v)}function ZB(){return new G(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function BE(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0),q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.GE(0,1,0);return new Y(B,E,v,o,q)}function EE(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Q(B,E)}function vE(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0);return new P(B,E,v,o)}const zE=z.GE.Zero(),oE=z.GE.Zero(),qE=z.GE.Zero();class cE{constructor(){this.strength=0,this.position=z.GE.Zero()}_processParticle(B,E){this.position.subtractToRef(B.position,zE);const v=zE.lengthSquared()+1;zE.normalize().scaleToRef(this.strength/v,oE),oE.scaleToRef(E._tempScaledUpdateSpeed,qE),B.direction.addInPlace(qE)}serialize(){return{position:this.position.cc(),strength:this.strength}}}class SE extends nB{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=B=>{if(!this._subEmitters||0===this._subEmitters.length)return;const E=Math.floor(Math.random()*this._subEmitters.length);for(const v of this._subEmitters[E])if(1===v.type){const E=v.clone();B._inheritParticleInfoToSubEmitter(E),E.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(E.particleSystem),E.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(B,E){const v=eB(B,E);return this.particleEmitterType=v,v}get flowMap(){return this._flowMap}set flowMap(B){this._flowMap!==B&&(this._flowMap=B,this._flowMapUpdate&&(wB(this._flowMapUpdate),this._flowMapUpdate=null),B&&(this._flowMapUpdate={process:B=>{var E;const v=null===(E=this.rB())||void 0===E?void 0:E.getTransformMatrix();this._flowMap._processParticle(B,this.flowMapStrength*this._tempScaledUpdateSpeed,v)},previousItem:null,nextItem:null},FB(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(B){this._attractors.push(B),1===this._attractors.length&&(this._attractorUpdate={process:B=>{for(const E of this._attractors)E._processParticle(B,this)},previousItem:null,nextItem:null},FB(this._attractorUpdate,this._directionProcessing))}removeAttractor(B){const E=this._attractors.indexOf(B);-1!==E&&this._attractors.splice(E,1),0===this._attractors.length&&wB(this._attractorUpdate)}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(B)}createHemisphericEmitter(){const B=kB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createSphereEmitter(){const B=LB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createDirectedSphereEmitter(){const B=MB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.GE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0));return this.particleEmitterType=B,B}createCylinderEmitter(){const B=ZB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=B,B}createDirectedCylinderEmitter(){const B=BE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.GE(0,1,0));return this.particleEmitterType=B,B}createConeEmitter(){const B=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=B,B}createDirectedConeEmitter(){const B=vE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0));return this.particleEmitterType=B,B}createBoxEmitter(B,E,v,z){const o=new y;return this.particleEmitterType=o,this.direction1=B,this.direction2=E,this.minEmitBox=v,this.maxEmitBox=z,o}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const B of this.subEmitters)B instanceof SE?this._subEmitters.push([new JB(B)]):B instanceof JB?this._subEmitters.push([B]):B instanceof Array&&this._subEmitters.push(B)}_stopSubEmitters(){if(this.activeSubSystems){for(const B of this.activeSubSystems)B.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const B=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==B&&this._rootParticleSystem.activeSubSystems.splice(B,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(B){B&&this._stopSubEmitters()}_prepareParticle(B){if(this._subEmitters&&this._subEmitters.length>0){const E=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];B._attachedSubEmitters=[];for(const v of E)if(0===v.type){const E=v.clone();B._attachedSubEmitters.push(E),E.particleSystem.start()}}}_onDispose(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),B&&this.particles)for(const v of this.particles)if(v._attachedSubEmitters)for(let B=v._attachedSubEmitters.length-1;B>=0;B-=1)v._attachedSubEmitters[B].dispose();if(E&&this.activeSubSystems)for(let v=this.activeSubSystems.length-1;v>=0;v-=1)this.activeSubSystems[v].dispose();if(this._subEmitters&&this._subEmitters.length){for(let B=0;B<this._subEmitters.length;B++)for(const E of this._subEmitters[B])E.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.zE&&this.zE.dispose&&this.zE.dispose(!0)}static _Parse(B,E,v,o){let q;q=v instanceof OB.b?null:v;const x=(0,S.b)("BABYLON.Texture");if(x&&q&&(B.texture?E.particleTexture=x.Parse(B.texture,q,o):B.textureName&&(E.particleTexture=new x(o+B.textureName,q,!1,void 0===B.invertY||B.invertY),E.particleTexture.name=B.textureName)),B.emitterId||0===B.emitterId||void 0!==B.zE?B.emitterId&&q?E.zE=q.getLastMeshById(B.emitterId):E.zE=z.GE.VE(B.zE):E.zE=z.GE.Zero(),E.isLocal=!!B.isLocal,void 0!==B.renderingGroupId&&(E.renderingGroupId=B.renderingGroupId),void 0!==B.isBillboardBased&&(E.isBillboardBased=B.isBillboardBased),void 0!==B.billboardMode&&(E.billboardMode=B.billboardMode),void 0!==B.useLogarithmicDepth&&(E.useLogarithmicDepth=B.useLogarithmicDepth),B.animations){for(let v=0;v<B.animations.length;v++){const z=B.animations[v],o=(0,S.b)("BABYLON.Animation");o&&E.animations.push(o.Parse(z))}E.beginAnimationOnStart=B.beginAnimationOnStart,E.beginAnimationFrom=B.beginAnimationFrom,E.beginAnimationTo=B.beginAnimationTo,E.beginAnimationLoop=B.beginAnimationLoop}if(B.autoAnimate&&q&&q.beginAnimation(E,B.autoAnimateFrom,B.autoAnimateTo,B.autoAnimateLoop,B.autoAnimateSpeed||1),E.startDelay=0|B.startDelay,E.minAngularSpeed=B.minAngularSpeed,E.maxAngularSpeed=B.maxAngularSpeed,E.minSize=B.minSize,E.maxSize=B.maxSize,B.minScaleX&&(E.minScaleX=B.minScaleX,E.maxScaleX=B.maxScaleX,E.minScaleY=B.minScaleY,E.maxScaleY=B.maxScaleY),void 0!==B.preWarmCycles&&(E.preWarmCycles=B.preWarmCycles,E.preWarmStepOffset=B.preWarmStepOffset),void 0!==B.minInitialRotation&&(E.minInitialRotation=B.minInitialRotation,E.maxInitialRotation=B.maxInitialRotation),E.minLifeTime=B.minLifeTime,E.maxLifeTime=B.maxLifeTime,E.minEmitPower=B.minEmitPower,E.maxEmitPower=B.maxEmitPower,E.emitRate=B.emitRate,E.gravity=z.GE.VE(B.gravity),B.noiseStrength&&(E.noiseStrength=z.GE.VE(B.noiseStrength)),E.color1=c.gc.VE(B.color1),E.color2=c.gc.VE(B.color2),E.colorDead=c.gc.VE(B.colorDead),E.updateSpeed=B.updateSpeed,E.targetStopDuration=B.targetStopDuration,E.blendMode=B.blendMode,B.colorGradients)for(const z of B.colorGradients)E.addColorGradient(z.gradient,c.gc.VE(z.color1),z.color2?c.gc.VE(z.color2):void 0);if(B.rampGradients){for(const v of B.rampGradients)E.addRampGradient(v.gradient,c.gE.VE(v.color));E.useRampGradients=B.useRampGradients}if(B.colorRemapGradients)for(const z of B.colorRemapGradients)E.addColorRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.alphaRemapGradients)for(const z of B.alphaRemapGradients)E.addAlphaRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.sizeGradients)for(const z of B.sizeGradients)E.addSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.angularSpeedGradients)for(const z of B.angularSpeedGradients)E.addAngularSpeedGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.velocityGradients)for(const z of B.velocityGradients)E.addVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.dragGradients)for(const z of B.dragGradients)E.addDragGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.emitRateGradients)for(const z of B.emitRateGradients)E.addEmitRateGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.startSizeGradients)for(const z of B.startSizeGradients)E.addStartSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.lifeTimeGradients)for(const z of B.lifeTimeGradients)E.addLifeTimeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(B.limitVelocityGradients){for(const v of B.limitVelocityGradients)E.addLimitVelocityGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);E.limitVelocityDamping=B.limitVelocityDamping}if(B.noiseTexture&&q){const v=(0,S.b)("BABYLON.ProceduralTexture");E.noiseTexture=v.Parse(B.noiseTexture,q,o)}let D;if(B.particleEmitterType){switch(B.particleEmitterType.type){case"SphereParticleEmitter":D=new g;break;case"SphereDirectedParticleEmitter":D=new V;break;case"ConeEmitter":case"ConeParticleEmitter":D=new Q;break;case"ConeDirectedParticleEmitter":D=new P;break;case"CylinderParticleEmitter":D=new G;break;case"CylinderDirectedParticleEmitter":D=new Y;break;case"HemisphericParticleEmitter":D=new a;break;case"PointParticleEmitter":D=new m;break;case"MeshParticleEmitter":D=new X;break;case"CustomParticleEmitter":D=new T;break;default:D=new y}D.parse(B.particleEmitterType,q)}else D=new y,D.parse(B,q);E.particleEmitterType=D,E.startSpriteCellID=B.startSpriteCellID,E.endSpriteCellID=B.endSpriteCellID,E.spriteCellLoop=B.spriteCellLoop??!0,E.spriteCellWidth=B.spriteCellWidth,E.spriteCellHeight=B.spriteCellHeight,E.spriteCellChangeSpeed=B.spriteCellChangeSpeed,E.spriteRandomStartCell=B.spriteRandomStartCell,E.disposeOnStop=B.disposeOnStop??!1,E.manualEmitCount=B.manualEmitCount??-1}static Parse(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const S=B.name;let x,D,h=null,y=null;if(E instanceof OB.b?x=E:(D=E,x=D.getEngine()),B.customShader&&x.createEffectForParticles){y=B.customShader;const E=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";h=x.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,E)}const Q=new SE(S,q||B.Gv,E,h,B.isAnimationSheetEnabled);if(Q.customShader=y,Q._rootUrl=v,B.id&&(Q.id=B.id),B.subEmitters){Q.subEmitters=[];for(const z of B.subEmitters){const B=[];for(const o of z)B.push(JB.Parse(o,E,v));Q.subEmitters.push(B)}}if(B.attractors)for(const c of B.attractors){const B=new cE;B.position=z.GE.VE(c.position),B.strength=c.strength,Q.addAttractor(B)}return SE._Parse(B,Q,E,v),B.textureMask&&(Q.textureMask=c.gc.VE(B.textureMask)),B.pD&&(Q.pD=z.GE.VE(B.pD)),B.preventAutoStart&&(Q.preventAutoStart=B.preventAutoStart),o||Q.preventAutoStart||Q.start(),Q}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};if(SE._Serialize(E,this,B),E.textureMask=this.textureMask.cc(),E.customShader=this.customShader,E.preventAutoStart=this.preventAutoStart,E.pD=this.pD.cc(),this.subEmitters){E.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const v of this._subEmitters){const z=[];for(const E of v)z.push(E.serialize(B));E.subEmitters.push(z)}}if(this._attractors&&this._attractors.length){E.attractors=[];for(const B of this._attractors)E.attractors.push(B.serialize())}return E}static _Serialize(B,E,v){if(B.name=E.name,B.id=E.id,B.Gv=E.getCapacity(),B.disposeOnStop=E.disposeOnStop,B.manualEmitCount=E.manualEmitCount,E.zE.position){const v=E.zE;B.emitterId=v.id}else{const v=E.zE;B.zE=v.cc()}E.particleEmitterType&&(B.particleEmitterType=E.particleEmitterType.serialize()),E.particleTexture&&(v?B.texture=E.particleTexture.serialize():(B.textureName=E.particleTexture.name,B.invertY=!!E.particleTexture._invertY)),B.isLocal=E.isLocal,d.b.AppendSerializedAnimations(E,B),B.beginAnimationOnStart=E.beginAnimationOnStart,B.beginAnimationFrom=E.beginAnimationFrom,B.beginAnimationTo=E.beginAnimationTo,B.beginAnimationLoop=E.beginAnimationLoop,B.startDelay=E.startDelay,B.renderingGroupId=E.renderingGroupId,B.isBillboardBased=E.isBillboardBased,B.billboardMode=E.billboardMode,B.minAngularSpeed=E.minAngularSpeed,B.maxAngularSpeed=E.maxAngularSpeed,B.minSize=E.minSize,B.maxSize=E.maxSize,B.minScaleX=E.minScaleX,B.maxScaleX=E.maxScaleX,B.minScaleY=E.minScaleY,B.maxScaleY=E.maxScaleY,B.minEmitPower=E.minEmitPower,B.maxEmitPower=E.maxEmitPower,B.minLifeTime=E.minLifeTime,B.maxLifeTime=E.maxLifeTime,B.emitRate=E.emitRate,B.gravity=E.gravity.cc(),B.noiseStrength=E.noiseStrength.cc(),B.color1=E.color1.cc(),B.color2=E.color2.cc(),B.colorDead=E.colorDead.cc(),B.updateSpeed=E.updateSpeed,B.targetStopDuration=E.targetStopDuration,B.blendMode=E.blendMode,B.preWarmCycles=E.preWarmCycles,B.preWarmStepOffset=E.preWarmStepOffset,B.minInitialRotation=E.minInitialRotation,B.maxInitialRotation=E.maxInitialRotation,B.startSpriteCellID=E.startSpriteCellID,B.spriteCellLoop=E.spriteCellLoop,B.endSpriteCellID=E.endSpriteCellID,B.spriteCellChangeSpeed=E.spriteCellChangeSpeed,B.spriteCellWidth=E.spriteCellWidth,B.spriteCellHeight=E.spriteCellHeight,B.spriteRandomStartCell=E.spriteRandomStartCell,B.isAnimationSheetEnabled=E.isAnimationSheetEnabled,B.useLogarithmicDepth=E.useLogarithmicDepth;const z=E.getColorGradients();if(z){B.colorGradients=[];for(const E of z){const v={gradient:E.gradient,color1:E.color1.cc()};E.color2?v.color2=E.color2.cc():v.color2=E.color1.cc(),B.colorGradients.push(v)}}const o=E.getRampGradients();if(o){B.rampGradients=[];for(const E of o){const v={gradient:E.gradient,color:E.color.cc()};B.rampGradients.push(v)}B.useRampGradients=E.useRampGradients}const q=E.getColorRemapGradients();if(q){B.colorRemapGradients=[];for(const E of q){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.colorRemapGradients.push(v)}}const c=E.getAlphaRemapGradients();if(c){B.alphaRemapGradients=[];for(const E of c){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.alphaRemapGradients.push(v)}}const S=E.getSizeGradients();if(S){B.sizeGradients=[];for(const E of S){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.sizeGradients.push(v)}}const x=E.getAngularSpeedGradients();if(x){B.angularSpeedGradients=[];for(const E of x){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.angularSpeedGradients.push(v)}}const D=E.getVelocityGradients();if(D){B.velocityGradients=[];for(const E of D){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.velocityGradients.push(v)}}const h=E.getDragGradients();if(h){B.dragGradients=[];for(const E of h){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.dragGradients.push(v)}}const y=E.getEmitRateGradients();if(y){B.emitRateGradients=[];for(const E of y){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.emitRateGradients.push(v)}}const Q=E.getStartSizeGradients();if(Q){B.startSizeGradients=[];for(const E of Q){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.startSizeGradients.push(v)}}const P=E.getLifeTimeGradients();if(P){B.lifeTimeGradients=[];for(const E of P){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.lifeTimeGradients.push(v)}}const G=E.getLimitVelocityGradients();if(G){B.limitVelocityGradients=[];for(const E of G){const v={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?v.factor2=E.factor2:v.factor2=E.factor1,B.limitVelocityGradients.push(v)}B.limitVelocityDamping=E.limitVelocityDamping}E.noiseTexture&&(B.noiseTexture=E.noiseTexture.serialize())}clone(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let o=null;const q=this._engine;if(q.createEffectForParticles&&null!=this.customShader){o=this.customShader;const B=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"",E=q.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,B);z[0]?z[0].effect=E:this.setCustomEffect(E,0)}const c=this.serialize(v),S=SE.Parse(c,this._scene||this._engine,this._rootUrl);return S.name=B,S.customShader=o,S._customWrappers=z,void 0===E&&(E=this.zE),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.zE=E,this.preventAutoStart||S.start(),S}}SE.BILLBOARDMODE_Y=2,SE.BILLBOARDMODE_ALL=7,SE.BILLBOARDMODE_STRETCHED=8,SE.BILLBOARDMODE_STRETCHED_LOCAL=9,JB._ParseParticleSystem=SE.Parse;var xE=v(11605),DE=v(11601),hE=v(11492);hE.c.prototype.createTransformFeedback=function(){const B=this._gl.createTransformFeedback();if(!B)throw new Error("Unable to create Transform Feedback");return B},hE.c.prototype.deleteTransformFeedback=function(B){this._gl.deleteTransformFeedback(B)},hE.c.prototype.bindTransformFeedback=function(B){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,B)},hE.c.prototype.beginTransformFeedback=function(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(B?this._gl.POINTS:this._gl.TRIANGLES)},hE.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},hE.c.prototype.setTranformFeedbackVaryings=function(B,E){this._gl.transformFeedbackVaryings(B,E,this._gl.INTERLEAVED_ATTRIBS)},hE.c.prototype.bindTransformFeedbackBuffer=function(B){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,B?B.underlyingResource:null)},hE.c.prototype.readTransformFeedbackBuffer=function(B){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,B)};const yE="clipPlaneFragmentDeclaration2",QE="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";i.c.IncludesShadersStore[yE]||(i.c.IncludesShadersStore[yE]=QE);v(12694),v(12696),v(12704),v(12711),v(12720),v(12729),v(12734),v(12743);const PE="gpuRenderParticlesPixelShader",GE="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";i.c.ShadersStore[PE]||(i.c.ShadersStore[PE]=GE);const YE="clipPlaneVertexDeclaration2",aE="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";i.c.IncludesShadersStore[YE]||(i.c.IncludesShadersStore[YE]=aE);v(12745),v(12749),v(12757),v(12763);const mE="gpuRenderParticlesVertexShader",gE="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";i.c.ShadersStore[mE]||(i.c.ShadersStore[mE]=gE);class VE extends x{static get IsSupported(){if(!M.b.LastCreatedEngine)return!1;const B=M.b.LastCreatedEngine.getCaps();return B.supportTransformFeedbacks||B.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(B){this._maxActiveParticleCount=Math.min(B,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(B){this.maxActiveParticleCount=B}createPointEmitter(B,E){const v=eB(B,E);return this.particleEmitterType=v,v}createHemisphericEmitter(){const B=kB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createSphereEmitter(){const B=LB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createDirectedSphereEmitter(){const B=MB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.GE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0));return this.particleEmitterType=B,B}createCylinderEmitter(){const B=ZB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=B,B}createDirectedCylinderEmitter(){const B=BE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.GE(0,1,0));return this.particleEmitterType=B,B}createConeEmitter(){const B=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=B,B}createDirectedConeEmitter(){const B=vE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.GE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.GE(0,1,0));return this.particleEmitterType=B,B}createBoxEmitter(B,E,v,z){const o=new y;return this.particleEmitterType=o,this.direction1=B,this.direction2=E,this.minEmitBox=v,this.maxEmitBox=z,o}get flowMap(){return this._flowMap}set flowMap(B){this._flowMap!==B&&(this._flowMap=B)}isReady(){if(!this.zE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==SE.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(SE.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(SE.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";B?setTimeout((()=>{this.start(0)}),B):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var B;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._customWrappers[E])||void 0===B?void 0:B.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[B]??this._customWrappers[0]}setCustomEffect(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new BB.b(this._engine),this._customWrappers[E].effect=B}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(B,E,v){return super._removeGradientAndTexture(B,E,v),this._releaseBuffers(),this}addColorGradient(B,E){this._colorGradients||(this._colorGradients=[]);const v=new s(B,E);return this._colorGradients.push(v),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(B&&this._colorGradients.sort(((B,E)=>B.gradient<E.gradient?-1:B.gradient>E.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(B){return this._removeGradientAndTexture(B,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const E in this._drawWrappers){var B;null===(B=this._drawWrappers[E].drawContext)||void 0===B||B.reset()}}_addFactorGradient(B,E,v){const z=new O(E,v);B.push(z),this._releaseBuffers()}addSizeGradient(B,E){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,B,E),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(B){return this._removeGradientAndTexture(B,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(B,E){if(!B)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&B.sort(((B,E)=>B.gradient<E.gradient?-1:B.gradient>E.gradient?1:0));const v=this;v[E]&&(v[E].dispose(),v[E]=null)}addAngularSpeedGradient(B,E){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,B,E),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(B){return this._removeGradientAndTexture(B,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(B,E){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,B,E),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(B){return this._removeGradientAndTexture(B,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(B,E){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,B,E),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(B){return this._removeGradientAndTexture(B,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(B,E){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,B,E),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(B){return this._removeGradientAndTexture(B,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(B){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(B),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.eq=new k.e,this.onStoppedObservable=new k.e,this.onStartedObservable=new k.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,v&&"Scene"!==v.getClassName()?(this._engine=v,this.defaultProjectionMatrix=z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=v||M.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.bQ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,S.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,S.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=o,this._drawWrappers={0:new BB.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(E=E??{}).randomTextureSize||delete E.randomTextureSize;const c={Gv:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...E},x=E;isFinite(x)&&(c.Gv=x),this._capacity=c.Gv,this._maxActiveParticleCount=c.Gv,this._currentActiveCount=0,this._isAnimationSheetEnabled=q,this.particleEmitterType=new y;const D=Math.min(this._engine.getCaps().maxTextureSize,c.randomTextureSize);let h=[];for(let z=0;z<D;++z)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new L.d(new Float32Array(h),D,1,5,v,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let z=0;z<D;++z)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new L.d(new Float32Array(h),D,1,5,v,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=D}_reset(){this._releaseBuffers()}_createVertexBuffers(B,E,v){const z={};z.position=E.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let o=3;z.age=E.createVertexBuffer("age",o,1,this._attributesStrideSize,!0),o+=1,z.size=E.createVertexBuffer("size",o,3,this._attributesStrideSize,!0),o+=3,z.life=E.createVertexBuffer("life",o,1,this._attributesStrideSize,!0),o+=1,o+=4,this.billboardMode===SE.BILLBOARDMODE_STRETCHED&&(z.direction=E.createVertexBuffer("direction",o,3,this._attributesStrideSize,!0)),o+=3,this._platform.alignDataInBuffer&&(o+=1),this.particleEmitterType instanceof T&&(o+=3,this._platform.alignDataInBuffer&&(o+=1)),this._colorGradientsTexture||(z.color=E.createVertexBuffer("color",o,4,this._attributesStrideSize,!0),o+=4),this._isBillboardBased||(z.initialDirection=E.createVertexBuffer("initialDirection",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1)),this.noiseTexture&&(z.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1),z.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1)),z.angle=E.createVertexBuffer("angle",o,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?o++:o+=2,this._isAnimationSheetEnabled&&(z.cellIndex=E.createVertexBuffer("cellIndex",o,1,this._attributesStrideSize,!0),o+=1,this.spriteRandomStartCell&&(z.cellStartOffset=E.createVertexBuffer("cellStartOffset",o,1,this._attributesStrideSize,!0),o+=1)),z.offset=v.createVertexBuffer("offset",0,2),z.uv=v.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(z),this._platform.createVertexBuffers(B,z),this.resetDrawCache()}_initialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!B)return;const E=this._engine,v=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof T&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const o=this.particleEmitterType instanceof T,q=z.TmpVectors.GE[0];let c=0;for(let z=0;z<this._capacity;z++)if(v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),o?(this.particleEmitterType.particleDestinationGenerator(z,null,q),v.push(q.x),v.push(q.y),v.push(q.z)):(v.push(0),v.push(0),v.push(0)),this._platform.alignDataInBuffer&&v.push(0),c+=16,o&&(this.particleEmitterType.particlePositionGenerator(z,null,q),v.push(q.x),v.push(q.y),v.push(q.z),this._platform.alignDataInBuffer&&v.push(0),c+=4),this._colorGradientsTexture||(v.push(0),v.push(0),v.push(0),v.push(0),c+=4),this.isBillboardBased||(v.push(0),v.push(0),v.push(0),this._platform.alignDataInBuffer&&v.push(0),c+=4),this.noiseTexture&&(v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),this._platform.alignDataInBuffer&&v.push(0),v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),this._platform.alignDataInBuffer&&v.push(0),c+=8),v.push(0),c+=1,this._angularSpeedGradientsTexture||(v.push(0),c+=1),this._isAnimationSheetEnabled&&(v.push(0),c+=1,this.spriteRandomStartCell&&(v.push(0),c+=1)),this._platform.alignDataInBuffer){let B=3-(c+3&3);for(c+=B;B-- >0;)v.push(0)}const S=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),x=this._platform.createParticleBuffer(v),D=this._platform.createParticleBuffer(v);this._buffer0=new N.d(E,x,!1,this._attributesStrideSize),this._buffer1=new N.d(E,D,!1,this._attributesStrideSize),this._spriteBuffer=new N.d(E,S,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let B=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(B+="\n#define BILLBOARD"),this._colorGradientsTexture&&(B+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(B+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(B+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(B+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(B+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(B+="\n#define DRAGGRADIENTS"),this._flowMap&&(B+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(B+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(B+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(B+="\n#define NOISE"),this.isLocal&&(B+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===B||(this._cachedUpdateDefines=B,this._updateBuffer=this._platform.createUpdateBuffer(B)),this._platform.isUpdateBufferReady()}_getWrapper(B){const E=this._getCustomDrawWrapper(B);if(null!==E&&void 0!==E&&E.effect)return E;const v=[];this.fillDefines(v,B);let z=this._drawWrappers[B];z||(z=new BB.b(this._engine),z.drawContext&&(z.drawContext.useInstancing=!0),this._drawWrappers[B]=z);const o=v.join("\n");if(z.defines!==o){const B=[],E=[],v=[];this.fillUniformsAttributesAndSamplerNames(E,B,v),z.setEffect(this._engine.createEffect("gpuRenderParticles",B,E,v,o),o)}return z}static _GetAttributeNamesOrOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=[N.e.PositionKind,"age","life","size","angle"];return B||o.push(N.e.ColorKind),E&&o.push("cellIndex"),v||o.push("initialDirection"),z&&o.push("direction"),o.push("offset",N.e.UVKind),o}static _GetEffectCreationOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["emitterWM","pD","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,EB.d)(z),B&&z.push("sheetInfos"),E&&z.push("logarithmicDepthConstant"),v&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,EB.i)(this,this._scene,B),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==DE.c.FOGMODE_NONE&&B.push("#define FOG")),E===SE.BLENDMODE_MULTIPLY&&B.push("#define BLENDMULTIPLYMODE"),this.isLocal&&B.push("#define LOCAL"),this.useLogarithmicDepth&&B.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(B.push("#define BILLBOARD"),this.billboardMode){case SE.BILLBOARDMODE_Y:B.push("#define BILLBOARDY");break;case SE.BILLBOARDMODE_STRETCHED:B.push("#define BILLBOARDSTRETCHED");break;case SE.BILLBOARDMODE_ALL:B.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&B.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&B.push("#define ANIMATESHEET"),v&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),B.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(B,E,v){E.push(...VE._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===SE.BILLBOARDMODE_STRETCHED)),B.push(...VE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),v.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(xE.d.PrepareUniforms(B,this._imageProcessingConfigurationDefines),xE.d.PrepareSamplers(v,this._imageProcessingConfigurationDefines))}animate(){var B;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(E?this.preWarmStepOffset:(null===(B=this._scene)||void 0===B?void 0:B.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(B,E){const v=this[E];if(!B||!B.length||v)return;const z=new Float32Array(this._rawTextureWidth);for(let o=0;o<this._rawTextureWidth;o++){const E=o/this._rawTextureWidth;e.GetCurrentGradient(E,B,((B,E,v)=>{z[o]=(0,D.Lerp)(B.factor1,E.factor1,v)}))}this[E]=L.d.CreateRTexture(z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[E].name=E.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const B=new Uint8Array(4*this._rawTextureWidth),E=c.TmpColors.gc[0];for(let v=0;v<this._rawTextureWidth;v++){const z=v/this._rawTextureWidth;e.GetCurrentGradient(z,this._colorGradients,((z,o,q)=>{c.gc.LerpToRef(z.color1,o.color1,q,E),B[4*v]=255*E.r,B[4*v+1]=255*E.g,B[4*v+2]=255*E.b,B[4*v+3]=255*E.a}))}this._colorGradientsTexture=L.d.CreateRGBATexture(B,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(B,E){var v,o,q,c;const S=this._getWrapper(B),x=S.effect;this._engine.enableEffect(S);const D=(null===(v=this._scene)||void 0===v?void 0:v.getViewMatrix())||z.Matrix.IdentityReadOnly;if(x.setMatrix("view",D),x.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),x.setTexture("diffuseSampler",this.particleTexture),x.setVector2("translationPivot",this.translationPivot),x.setVector3("pD",this.pD),this.isLocal&&x.setMatrix("emitterWM",E),this._colorGradientsTexture?x.setTexture("colorGradientSampler",this._colorGradientsTexture):x.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const B=this.particleTexture.getBaseSize();x.setFloat3("sheetInfos",this.spriteCellWidth/B.width,this.spriteCellHeight/B.height,B.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const B=this._scene.activeCamera;x.setVector3("eyePosition",B.globalPosition)}const h=x.defines;if(this._scene&&((0,EB.f)(x,this,this._scene),this.applyFog&&(0,vB.g)(this._scene,void 0,x)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const B=D.clone();B.invert(),x.setMatrix("invView",B)}return this.useLogarithmicDepth&&this._scene&&(0,vB.k)(h,x,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(x),this._setEngineBasedOnBlendMode(B),this._platform.bindDrawBuffers(this._targetIndex,x,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(x),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(c=this._scene)&&void 0!==c&&c.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(B){if(!this.zE||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!B)if(this.zE.position){B=this.zE.getWorldMatrix()}else{const E=this.zE;B=z.TmpVectors.Matrix[0],z.Matrix.TranslationToRef(E.x,E.y,E.z,B)}const E=this._engine,v=E.getDepthWrite();if(E.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const B=this.rB();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",B.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",B),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const o=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=o,E.setDepthWrite(v)}render(){let B,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!E&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let B=0;B<this.preWarmCycles;B++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const B=0|this._accumulatedCount;this._accumulatedCount-=B,this._currentActiveCount+=B}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.zE.position){B=this.zE.getWorldMatrix()}else{const E=this.zE;B=z.TmpVectors.Matrix[0],z.Matrix.TranslationToRef(E.x,E.y,E.z,B)}const o=this._engine;this.updateInAnimate||this._update(B);let q=0;return E||v||(o.setState(!1),this.forceDepthWrite&&o.setDepthWrite(!0),q=this.blendMode===SE.BLENDMODE_MULTIPLYADD?this._render(SE.BLENDMODE_MULTIPLY,B)+this._render(SE.BLENDMODE_ADD,B):this._render(this.blendMode,B),this._engine.setAlphaMode(0)),q}rebuild(){const B=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(B,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,B()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const E in this._drawWrappers){this._drawWrappers[E].dispose()}if(this._drawWrappers={},this._scene){const B=this._scene.bQ.indexOf(this);B>-1&&this._scene.bQ.splice(B,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let E=0;E<this._renderVertexBuffers.length;++E){const B=this._renderVertexBuffers[E];for(const E in B)B[E].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),B&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),B&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.eq.notifyObservers(this),this.eq.clear()}clone(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let o=null;const q=this._engine;if(q.createEffectForParticles&&null!=this.customShader){o=this.customShader;const B=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"";z[0]=q.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,B,void 0,void 0,void 0,this)}const c=this.serialize(v),S=VE.Parse(c,this._scene||this._engine,this._rootUrl);return S.name=B,S.customShader=o,S._customWrappers=z,void 0===E&&(E=this.zE),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.zE=E,S}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return SE._Serialize(E,this,B),E.activeParticleCount=this.activeParticleCount,E.randomTextureSize=this._randomTextureSize,E.customShader=this.customShader,E}static Parse(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;const q=B.name;let c,S;E instanceof OB.b?c=E:(S=E,c=S.getEngine());const x=new VE(q,{Gv:o||B.Gv,randomTextureSize:B.randomTextureSize},E,null,B.isAnimationSheetEnabled);if(x._rootUrl=v,B.customShader&&c.createEffectForParticles){const E=B.customShader,v=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",z=c.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,v,void 0,void 0,void 0,x);x.setCustomEffect(z,0),x.customShader=E}return B.id&&(x.id=B.id),B.activeParticleCount&&(x.activeParticleCount=B.activeParticleCount),SE._Parse(B,x,E,v),B.preventAutoStart&&(x.preventAutoStart=B.preventAutoStart),z||x.preventAutoStart||x.start(),x}}var TE=v(11193),NE=v(12766),XE=v(11756);class rE{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(B){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const E of this.systems)E.zE=B;this._emitterNode=B}setEmitterAsSphere(B,E,v){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:B,renderingGroupId:E};const z=(0,NE.c)("emitterSphere",{diameter:B.diameter,segments:B.segments},v);z.renderingGroupId=E;const o=new XE.mE("emitterSphereMaterial",v);o.emissiveColor=B.color,z.material=o;for(const q of this.systems)q.zE=z;this._emitterNode=z}start(B){for(const E of this.systems)B&&(E.zE=B),E.start()}dispose(){for(const B of this.systems)B.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={systems:[]};for(const v of this.systems)E.systems.push(v.serialize(B));return this._emitterNode&&(E.zE=this._emitterCreationOptions),E}static Parse(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;const o=new rE,q=this.BaseAssetsUrl+"/textures/";E=E||M.b.LastCreatedScene;for(const c of B.systems)o.systems.push(v?VE.Parse(c,E,q,!0,z):SE.Parse(c,E,q,!0,z));if(B.zE){const v=B.zE.options;if("Sphere"===B.zE.kind)o.setEmitterAsSphere({diameter:v.diameter,segments:v.segments,color:c.gE.VE(v.color)},B.zE.renderingGroupId,E)}return o}}rE.BaseAssetsUrl="https://assets.babylonjs.com/particles";var iE=v(11237);class uE{static CreateDefault(B){let E,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,z=arguments.length>2?arguments[2]:void 0;E=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new VE("default system",{Gv:v},z):new SE("default system",v,z),E.zE=B;const o=TE.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return E.particleTexture=new t.b(o,E.rB()),E.createConeEmitter(.1,Math.PI/4),E.color1=new c.gc(1,1,1,1),E.color2=new c.gc(1,1,1,1),E.colorDead=new c.gc(1,1,1,0),E.minSize=.1,E.maxSize=.1,E.minEmitPower=2,E.maxEmitPower=2,E.updateSpeed=1/60,E.emitRate=30,E}static CreateAsync(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;E||(E=M.b.LastCreatedScene);const o={};return E.addPendingData(o),new Promise(((q,c)=>{if(v&&!VE.IsSupported)return E.removePendingData(o),c("Particle system with GPU is not supported.");TE.Tools.LoadFile(`${uE.BaseAssetsUrl}/systems/${B}.json`,(B=>{E.removePendingData(o);const c=JSON.parse(B.toString());return q(rE.Parse(c,E,v,z))}),void 0,void 0,void 0,(()=>(E.removePendingData(o),c(`An error occurred with the creation of your particle system. Check if your type '${B}' exists.`))))}))}static ExportSet(B){const E=new rE;for(const v of B)E.systems.push(v);return E}static ParseFromFileAsync(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",q=arguments.length>5?arguments[5]:void 0;return new Promise(((c,S)=>{const x=new iE.b;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const E=JSON.parse(x.responseText);let S;S=z?VE.Parse(E,v,o,!1,q):SE.Parse(E,v,o,!1,q),B&&(S.name=B),c(S)}else S("Unable to load the particle system")})),x.open("GET",E),x.send()}))}static ParseFromSnippetAsync(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;if("_BLANK"===B){const B=this.CreateDefault(null);return B.start(),Promise.resolve(B)}return new Promise(((q,c)=>{const S=new iE.b;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const c=JSON.parse(JSON.parse(S.responseText).jsonPayload),x=JSON.parse(c.particleSystem);let D;D=v?VE.Parse(x,E,z,!1,o):SE.Parse(x,E,z,!1,o),D.snippetId=B,q(D)}else c("Unable to load the snippet "+B)})),S.open("GET",this.SnippetUrl+"/"+B.replace(/#/g,"/")),S.send()}))}}uE.BaseAssetsUrl=rE.BaseAssetsUrl,uE.SnippetUrl="https://snippet.babylonjs.com",uE.CreateFromSnippetAsync=uE.ParseFromSnippetAsync;var IE=v(11833),KE=v(11643),CE=v(12768);(0,CE.e)(KE.b.NAME_PARTICLESYSTEM,((B,E,v,z)=>{const o=(0,CE.f)(KE.b.NAME_PARTICLESYSTEM);if(o&&void 0!==B.bQ&&null!==B.bQ)for(let q=0,c=B.bQ.length;q<c;q++){const c=B.bQ[q];v.bQ.push(o(c,E,z))}})),(0,CE.b)(KE.b.NAME_PARTICLESYSTEM,((B,E,v)=>{if(B.activeParticleCount){return VE.Parse(B,E,v)}return SE.Parse(B,E,v)})),OB.b.prototype.createEffectForParticles=function(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,x=arguments.length>7?arguments[7]:void 0,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,y=[],Q=[];const P=[];return x?x.fillUniformsAttributesAndSamplerNames(Q,y,P):(y=SE._GetAttributeNamesOrOptions(),Q=SE._GetEffectCreationOptions()),-1===o.indexOf(" BILLBOARD")&&(o+="\n#define BILLBOARD\n"),null!==x&&void 0!==x&&x.isAnimationSheetEnabled&&-1===o.indexOf(" ANIMATESHEET")&&(o+="\n#define ANIMATESHEET\n"),-1===z.indexOf("diffuseSampler")&&z.push("diffuseSampler"),this.createEffect({vertex:h??(null===x||void 0===x?void 0:x.vertexShaderName)??"particles",fragmentElement:B},y,Q.concat(E),P.concat(z),o,q,c,S,void 0,D,(async()=>{0===D?await Promise.resolve().then(v.bind(v,12795)):await Promise.resolve().then(v.bind(v,12858))}))},IE.e.prototype.getEmittedParticleSystems=function(){const B=[];for(let E=0;E<this.rB().bQ.length;E++){const v=this.rB().bQ[E];v.zE===this&&B.push(v)}return B},IE.e.prototype.getHierarchyEmittedParticleSystems=function(){const B=[],E=this.getDescendants();E.push(this);for(let v=0;v<this.rB().bQ.length;v++){const z=this.rB().bQ[v],o=z.zE;o.position&&-1!==E.indexOf(o)&&B.push(z)}return B};v(11722),v(11737),v(11815);v(11822),v(12772),v(11562),v(11714),v(11858);v(11555);var fE;v(12780),v(11401);!function(B){B[B.Color=2]="Color",B[B.UV=1]="UV",B[B.Random=0]="Random",B[B.Stated=3]="Stated"}(fE||(fE={}));var AE=v(11594);const lE=new z.GE(0,0,0),dE=new z.GE(0,0,0),tE=new z.GE(0,0,0);class pE{constructor(B,E,v){this.width=B,this.height=E,this.data=v}processFlowable(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2?arguments[2]:void 0;if(!v)return;v instanceof z.Matrix?z.GE.TransformCoordinatesToRef(B.position,v,tE):(tE.x=v.x,tE.y=v.y,tE.z=v.z);const o=.5*tE.x+.5,q=1-(.5*tE.y+.5),c=Math.floor(o*this.width),S=Math.floor(q*this.height);if(c<0||c>=this.width||S<0||S>=this.height)return;const x=4*(S*this.width+c),D=this.data[x]/255*2-1,h=this.data[x+1]/255*2-1,y=this.data[x+2]/255*2-1,Q=this.data[x+3]/255;lE.set(D,h,y),lE.scaleToRef(E*Q,dE),B.direction.addInPlace(dE)}_processParticle(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2?arguments[2]:void 0;this.processFlowable(B,E,v)}static async FromUrlAsync(B){return await new Promise(((E,v)=>{const z=document.createElement("canvas"),o=z.getContext("2d");let q=null;const c=new Image;c.crossOrigin="anonymous",c.src=B,c.onerror=E=>{v(new Error(`Failed to load image: ${B} : ${E}`))},c.onload=()=>{z.width=c.width,z.height=c.height,o.drawImage(c,0,0),q=o.getImageData(0,0,z.width,z.height),E(new pE(z.width,z.height,q.data))}}))}static async ExtractFromTextureAsync(B){return await new Promise(((E,v)=>{if(!B.isReady())return void B.onLoadObservable.addOnce((async()=>{try{const v=await this.ExtractFromTextureAsync(B);E(v)}catch(z){v(z)}}));const z=B.getSize();AE.i.GetTextureDataAsync(B,z.width,z.height).then((B=>{E(new pE(z.width,z.height,new Uint8ClampedArray(B)))})).catch(v)}))}}var HE,jE,RE,bE,FE,WE,wE,nE,UE;!function(B){B[B.Int=1]="Int",B[B.Float=2]="Float",B[B.Vector2=4]="Vector2",B[B.GE=8]="GE",B[B.Matrix=16]="Matrix",B[B.Particle=32]="Particle",B[B.Texture=64]="Texture",B[B.gc=128]="gc",B[B.FloatGradient=256]="FloatGradient",B[B.Vector2Gradient=512]="Vector2Gradient",B[B.Vector3Gradient=1024]="Vector3Gradient",B[B.Color4Gradient=2048]="Color4Gradient",B[B.System=4096]="System",B[B.AutoDetect=8192]="AutoDetect",B[B.BasedOnInput=16384]="BasedOnInput",B[B.Undefined=32768]="Undefined",B[B.All=65535]="All"}(HE||(HE={})),function(B){B[B.Compatible=0]="Compatible",B[B.TypeIncompatible=1]="TypeIncompatible",B[B.HierarchyIssue=2]="HierarchyIssue"}(jE||(jE={})),function(B){B[B.Input=0]="Input",B[B.Output=1]="Output"}(RE||(RE={}));class sE{get direction(){return this._direction}get type(){if(this._type===HE.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===HE.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(B){this._type=B}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((B=>B.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(B,E,v){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=HE.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new k.e,this.onDisconnectionObservable=new k.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=E,this.name=B,this._direction=v}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(B){var E;return this.isConnected?null!==(E=this._connectedPoint)&&void 0!==E&&E._storedFunction?this._connectedPoint._storedFunction(B):this._connectedPoint._storedValue:this.value}canConnectTo(B){return 0===this.checkCompatibilityState(B)}checkCompatibilityState(B){const E=this._ownerBlock,v=B.ownerBlock;if(this.type!==B.type&&B.innerType!==HE.AutoDetect)return B.acceptedConnectionPointTypes&&-1!==B.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(B.excludedConnectionPointTypes&&-1!==B.excludedConnectionPointTypes.indexOf(this.type))return 1;let z=v,o=E;return 0===this.direction&&(z=E,o=v),z.isAnAncestorOf(o)?2:0}connectTo(B){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(B))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${B.ownerBlock.name}".${B.name}`;return this._endpoints.push(B),B._connectedPoint=this,this.onConnectionObservable.notifyObservers(B),B.onConnectionObservable.notifyObservers(this),this}disconnectFrom(B){const E=this._endpoints.indexOf(B);return-1===E||(this._endpoints.splice(E,1),B._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(B),B.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(B){let E=1;for(;E<HE.All;)B&E||this.excludedConnectionPointTypes.push(E),E<<=1}serialize(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E={};return E.name=this.name,E.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.cc?(E.valueType="BABYLON."+this.value.getClassName(),E.value=this.value.cc()):(E.valueType="number",E.value=this.value)),B&&this.connectedPoint&&(E.inputName=this.name,E.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,E.targetConnectionName=this.connectedPoint.name,E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),E}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class JE{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(B){this._name=B}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(B){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new k.e,this.eq=new k.e,this.onInputChangedObservable=new k.e,this.visibleOnFrame=!1,this._name=B,this.uniqueId=p.b.UniqueId}_inputRename(B){return B}_outputRename(B){return B}isAnAncestorOf(B){for(const E of this._outputs)if(E.hasEndpoints)for(const v of E.endpoints){if(v.ownerBlock===B)return!0;if(v.ownerBlock.isAnAncestorOf(B))return!0}return!1}isAnAncestorOfType(B){if(this.getClassName()===B)return!0;for(const E of this._outputs)if(E.hasEndpoints)for(const v of E.endpoints)if(v.ownerBlock.isAnAncestorOfType(B))return!0;return!1}getInputByName(B){const E=this._inputs.filter((E=>E.name===B));return E.length?E[0]:null}_linkConnectionTypes(B,E){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[E]._acceptedConnectionPointType=this._inputs[B]:(this._inputs[B]._linkedConnectionSource=this._inputs[E],this._inputs[B]._isMainLinkSource=!0),this._inputs[E]._linkedConnectionSource=this._inputs[B]}registerInput(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const c=new sE(B,this,0);return c.type=E,c.isOptional=v,c.defaultValue=z,c.value=z,c.valueMin=o,c.valueMax=q,this._inputs.push(c),this.onInputChangedObservable.notifyObservers(c),this}registerOutput(B,E,v){return(v=v??new sE(B,this,1)).type=E,this._outputs.push(v),this}_build(B){}_customBuildStep(B){}build(B){if(this._buildId===B.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((B=>B.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=B.buildId;for(const E of this._inputs){if(!E.connectedPoint){E.isOptional||B.notConnectedNonOptionalInputs.push(E);continue}const v=E.connectedPoint.ownerBlock;v&&v!==this&&!v.isSystem&&v.build(B)}return this._customBuildStep(B),B.verbose&&H.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(B),this.onBuildObservable.notifyObservers(this),!1}serialize(){const B={};B.customType="BABYLON."+this.getClassName(),B.id=this.uniqueId,B.name=this.name,B.visibleOnFrame=this.visibleOnFrame,B.inputs=[],B.outputs=[];for(const E of this.inputs)B.inputs.push(E.serialize());for(const E of this.outputs)B.outputs.push(E.serialize(!1));return B}_deserialize(B){this._name=B.name,this.comments=B.comments,this.visibleOnFrame=!!B.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(B)}_deserializePortDisplayNamesAndExposedOnFrame(B){const E=B.inputs,v=B.outputs;if(E)for(const z of E){const B=this.inputs.find((B=>B.name===z.name));if(!B)return;if(z.displayName&&(B.displayName=z.displayName),z.isExposedOnFrame&&(B.isExposedOnFrame=z.isExposedOnFrame,B.exposedPortPosition=z.exposedPortPosition),void 0!==z.value&&null!==z.value)if("number"===z.valueType)B.value=z.value;else{const E=(0,S.b)(z.valueType);E&&(B.value=E.VE(z.value))}}if(v)for(let z=0;z<v.length;z++){const B=v[z];B.displayName&&(this.outputs[z].displayName=B.displayName),B.isExposedOnFrame&&(this.outputs[z].isExposedOnFrame=B.isExposedOnFrame,this.outputs[z].exposedPortPosition=B.exposedPortPosition)}}clone(){const B=this.serialize(),E=(0,S.b)(B.customType);if(E){const v=new E;return v._deserialize(B),v}return null}dispose(){this.eq.notifyObservers(this),this.eq.clear();for(const B of this.inputs)B.dispose();for(const B of this.outputs)B.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function OE(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",z=arguments.length>3?arguments[3]:void 0;return(o,q)=>{let c=o._propStore;c||(c=[],o._propStore=c),c.push({propertyName:q,displayName:B,type:E,groupName:v,options:z??{},className:o.getClassName()})}}(0,A.c)([(0,l.K)("comment")],JE.prototype,"comments",void 0),function(B){B[B.Boolean=0]="Boolean",B[B.Float=1]="Float",B[B.Int=2]="Int",B[B.Vector2=3]="Vector2",B[B.List=4]="List",B[B.gc=5]="gc",B[B.SamplingMode=6]="SamplingMode",B[B.TextureFormat=7]="TextureFormat",B[B.TextureType=8]="TextureType"}(bE||(bE={})),function(B){B[B.None=0]="None",B[B.Position=1]="Position",B[B.Direction=2]="Direction",B[B.Age=3]="Age",B[B.Lifetime=4]="Lifetime",B[B.Color=5]="Color",B[B.ScaledDirection=6]="ScaledDirection",B[B.Scale=7]="Scale",B[B.AgeGradient=8]="AgeGradient",B[B.Angle=9]="Angle",B[B.SpriteCellIndex=16]="SpriteCellIndex",B[B.SpriteCellStart=17]="SpriteCellStart",B[B.SpriteCellEnd=18]="SpriteCellEnd"}(FE||(FE={})),function(B){B[B.None=0]="None",B[B.Time=1]="Time",B[B.Delta=2]="Delta",B[B.Emitter=3]="Emitter"}(WE||(WE={}));class eE{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let B="";for(const E of this.notConnectedNonOptionalInputs)B+=`input ${E.name} from block ${E.ownerBlock.name}[${E.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(B)throw"Build of Node Particle System Set failed:\n"+B}adapt(B,E){const v=B.getConnectedValue(this)||0;if(B.type===E)return v;switch(E){case HE.Vector2:return new z.Vector2(v,v);case HE.GE:return new z.GE(v,v,v);case HE.gc:return new c.gc(v,v,v,v)}return null}getContextualValue(B){if(!this.particleContext||!this.systemContext)return null;switch(B){case FE.Position:return this.particleContext.position;case FE.Direction:return this.particleContext.direction;case FE.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case FE.Color:return this.particleContext.color;case FE.Age:return this.particleContext.age;case FE.Lifetime:return this.particleContext.lifeTime;case FE.Angle:return this.particleContext.angle;case FE.Scale:return this.particleContext.scale;case FE.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case FE.SpriteCellEnd:return this.systemContext.endSpriteCellID;case FE.SpriteCellIndex:return this.particleContext.cellIndex;case FE.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.zE.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.zE.absolutePosition:this.systemContext.zE:null}getSystemValue(B){if(!this.particleContext||!this.systemContext)return null;switch(B){case WE.Time:return this.systemContext._actualFrame;case WE.Delta:return this.systemContext._scaledUpdateSpeed;case WE.Emitter:if(this.isEmitterTransformNode){return this.systemContext.zE.absolutePosition}return this.systemContext.zE}return null}}function kE(B,E,v){const z=new eE;z.aE=E;const o=B.createSystem(z);return o.canStart=()=>!0,o.zE=v.clone(),o.disposeOnStop=!0,o.start(),o}class LE extends JE{constructor(B){super(B),this.blendMode=x.BLENDMODE_ONEONE,this.Gv=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",HE.Particle),this.registerInput("texture",HE.Texture),this.registerInput("onStart",HE.System,!0),this.registerInput("onEnd",HE.System,!0),this.registerOutput("system",HE.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(B){B.Gv=this.Gv,B.buildId=this._buildId++,this.build(B);const E=this.particle.getConnectedValue(B);return E.particleTexture=this.texture.getConnectedValue(B),E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.name=this.name,E._nodeGenerated=!0,E._targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,this.system._storedValue=this,E.canStart=()=>!this.doNoStart,E.onStartedObservable.add((v=>{const z=this.onStart.getConnectedValue(B);z&&v.onStartedObservable.addOnce((()=>{B.systemContext=E;const v=kE(z,B.aE,B.emitterPosition);this.eq.addOnce((()=>{v.dispose()}))}));const o=this.onEnd.getConnectedValue(B);o&&v.onStoppedObservable.addOnce((()=>{B.systemContext=E;const v=kE(o,B.aE,B.emitterPosition);this.eq.addOnce((()=>{v.dispose()}))}))})),this.eq.addOnce((()=>{E.dispose()})),E}serialize(){const B=super.serialize();return B.Gv=this.Gv,B.emitRate=this.emitRate,B.blendMode=this.blendMode,B.doNoStart=this.doNoStart,B.targetStopDuration=this.targetStopDuration,B.startDelay=this.startDelay,B}_deserialize(B){super._deserialize(B),this.Gv=B.Gv,this.emitRate=B.emitRate,this.doNoStart=!!B.doNoStart,void 0!==B.blendMode&&(this.blendMode=B.blendMode),void 0!==B.targetStopDuration&&(this.targetStopDuration=B.targetStopDuration),void 0!==B.startDelay&&(this.startDelay=B.startDelay)}}(0,A.c)([OE("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:x.BLENDMODE_ONEONE},{label:"Standard",value:x.BLENDMODE_STANDARD},{label:"Add",value:x.BLENDMODE_ADD},{label:"Multiply",value:x.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:x.BLENDMODE_MULTIPLYADD}]})],LE.prototype,"blendMode",void 0),(0,A.c)([OE("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],LE.prototype,"Gv",void 0),(0,A.c)([OE("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LE.prototype,"emitRate",void 0),(0,A.c)([OE("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LE.prototype,"targetStopDuration",void 0),(0,A.c)([OE("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LE.prototype,"startDelay",void 0),(0,A.c)([OE("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],LE.prototype,"doNoStart",void 0),(0,S.f)("BABYLON.SystemBlock",LE);class ME extends JE{get type(){if(this._type===HE.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=HE.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=HE.Vector2,this._type;case"GE":return this._type=HE.GE,this._type;case"gc":return this._type=HE.gc,this._type;case"Matrix":return this._type=HE.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===FE.None&&this._systemSource!==WE.None}get systemSource(){return this._systemSource}set systemSource(B){if(this._systemSource=B,B!==WE.None){switch(this._contextualSource=FE.None,this._type=HE.Float,B){case WE.Time:case WE.Delta:this._type=HE.Float;break;case WE.Emitter:this._type=HE.GE}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==FE.None}get contextualValue(){return this._contextualSource}set contextualValue(B){if(this._contextualSource=B,B!==FE.None){switch(this._systemSource=WE.None,B){case FE.Scale:this._type=HE.Vector2;break;case FE.Position:case FE.Direction:case FE.ScaledDirection:this._type=HE.GE;break;case FE.Color:this._type=HE.gc;break;case FE.Age:case FE.Lifetime:case FE.Angle:case FE.AgeGradient:this._type=HE.Float;break;case FE.SpriteCellEnd:case FE.SpriteCellStart:case FE.SpriteCellIndex:this._type=HE.Int}this.output&&(this.output.type=this._type)}}constructor(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:HE.AutoDetect;super(B),this._type=HE.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new k.e,this._systemSource=WE.None,this._contextualSource=FE.None,this._type=E,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",E)}get value(){return this._storedValue}set value(B){this.type===HE.Float&&this.min!==this.max&&(B=Math.max(this.min,B),B=Math.min(this.max,B)),this._storedValue=B,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(B){this._valueCallback=B}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case HE.Int:case HE.Float:this.value=0;break;case HE.Vector2:this.value=z.Vector2.Zero();break;case HE.GE:this.value=z.GE.Zero();break;case HE.gc:this.value=new c.gc(1,1,1,1);break;case HE.Matrix:this.value=z.Matrix.Identity()}}_build(B){super._build(B),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=B=>B.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=B=>B.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const B=super.serialize();return B.type=this.type,B.contextualValue=this.contextualValue,B.systemSource=this.systemSource,B.min=this.min,B.max=this.max,B.groupInInspector=this.groupInInspector,B.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.cc?(B.valueType="BABYLON."+this._storedValue.getClassName(),B.value=this._storedValue.cc()):(B.valueType="number",B.value=this._storedValue)),B}_deserialize(B){if(super._deserialize(B),this._type=B.type,this.contextualValue=B.contextualValue,this.systemSource=B.systemSource||WE.None,this.min=B.min||0,this.max=B.max||0,this.groupInInspector=B.groupInInspector||"",void 0!==B.displayInInspector&&(this.displayInInspector=B.displayInInspector),B.valueType)if("number"===B.valueType)this._storedValue=B.value;else{const E=(0,S.b)(B.valueType);E&&(this._storedValue=E.VE(B.value))}}}(0,S.f)("BABYLON.ParticleInputBlock",ME);class ZE extends JE{get url(){return this._url}set url(B){this._url!==B&&(this._cachedData=null,this._url=B,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(B){this._textureDataUrl!==B&&(this._cachedData=null,this._textureDataUrl=B,this._url="",this._sourceTexture=null)}set sourceTexture(B){this._sourceTexture!==B&&(this._cachedData=null,this._sourceTexture=B,this._url="",this._textureDataUrl="")}constructor(B){super(B),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",HE.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const B=this.texture._storedValue;return await new Promise(((E,v)=>{if(!B.isReady())return void B.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),E(this._cachedData)}catch(B){v(B)}}));const z=B.getSize();AE.i.GetTextureDataAsync(B,z.width,z.height).then((v=>{this._cachedData={width:z.width,height:z.height,data:new Uint8ClampedArray(v)},B.dispose(),E(this._cachedData)})).catch(v)}))}_build(B){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new t.b(this._textureDataUrl,B.aE):this.texture._storedValue=new t.b(this._url,B.aE):this.texture._storedValue=null}serialize(){const B=super.serialize();return B.url=this.url,B.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(B.textureDataUrl=this.textureDataUrl),B}_deserialize(B){super._deserialize(B),this.url=B.url,this.serializedCachedData=!!B.serializedCachedData,B.textureDataUrl&&(this.textureDataUrl=B.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,S.f)("BABYLON.ParticleTextureSourceBlock",ZE);class Bv extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("position",HE.GE),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(B){const E=this.particle.getConnectedValue(B);if(this.output._storedValue=E,!this.position.isConnected)return;const v={process:v=>{B.particleContext=v,B.systemContext=E,v.position.S(this.position.getConnectedValue(B))},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v}}(0,S.f)("BABYLON.UpdatePositionBlock",Bv),function(B){B[B.Add=0]="Add",B[B.Subtract=1]="Subtract",B[B.Multiply=2]="Multiply",B[B.Divide=3]="Divide",B[B.Max=4]="Max",B[B.Min=5]="Min"}(wE||(wE={}));class Ev extends JE{constructor(B){super(B),this.operation=wE.Add,this.registerInput("left",HE.AutoDetect),this.registerInput("right",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this.output._typeConnectionSource=this.left;const E=[HE.Matrix,HE.Particle,HE.Texture,HE.System,HE.FloatGradient,HE.Color4Gradient,HE.Vector2Gradient,HE.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...E),this.right.excludedConnectionPointTypes.push(...E),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(B){let E;const v=this.left,o=this.right;if(!v.isConnected||!o.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=v.type===HE.Float||v.type===HE.Int,S=o.type===HE.Float||o.type===HE.Int,x=q&&S;switch(this.operation){case wE.Add:E=x?B=>v.getConnectedValue(B)+o.getConnectedValue(B):q?B=>B.adapt(v,o.type).add(o.getConnectedValue(B)):B=>v.getConnectedValue(B).add(B.adapt(o,v.type));break;case wE.Subtract:E=x?B=>v.getConnectedValue(B)-o.getConnectedValue(B):q?B=>B.adapt(v,o.type).YE(o.getConnectedValue(B)):B=>v.getConnectedValue(B).YE(B.adapt(o,v.type));break;case wE.Multiply:E=x?B=>v.getConnectedValue(B)*o.getConnectedValue(B):q?B=>B.adapt(v,o.type).multiply(o.getConnectedValue(B)):B=>v.getConnectedValue(B).multiply(B.adapt(o,v.type));break;case wE.Divide:E=x?B=>v.getConnectedValue(B)/o.getConnectedValue(B):q?B=>B.adapt(v,o.type).divide(o.getConnectedValue(B)):B=>v.getConnectedValue(B).divide(B.adapt(o,v.type));break;case wE.Min:if(x)E=B=>Math.min(v.getConnectedValue(B),o.getConnectedValue(B));else{const[B,S]=q?[o,v]:[v,o];switch(B.type){case HE.Vector2:E=E=>z.Vector2.Minimize(B.getConnectedValue(E),E.adapt(S,B.type));break;case HE.GE:E=E=>z.GE.Minimize(B.getConnectedValue(E),E.adapt(S,B.type));break;case HE.gc:E=E=>{const v=B.getConnectedValue(E),{r:z,g:o,b:q,a:x}=E.adapt(S,B.type);return new c.gc(Math.min(v.r,z),Math.min(v.g,o),Math.min(v.b,q),Math.min(v.a,x))}}}break;case wE.Max:if(!x){const[B,S]=q?[o,v]:[v,o];switch(B.type){case HE.Vector2:E=E=>z.Vector2.Maximize(B.getConnectedValue(E),E.adapt(S,B.type));break;case HE.GE:E=E=>z.GE.Maximize(B.getConnectedValue(E),E.adapt(S,B.type));break;case HE.gc:E=E=>{const v=B.getConnectedValue(E),{r:z,g:o,b:q,a:x}=E.adapt(S,B.type);return new c.gc(Math.max(v.r,z),Math.min(v.g,o),Math.min(v.b,q),Math.min(v.a,x))}}break}E=B=>Math.max(v.getConnectedValue(B),o.getConnectedValue(B))}this.output._storedFunction=B=>v.type===HE.Int?0|E(B):E(B)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===HE.Int||this.left.type===HE.Float&&this.right.type!==HE.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[B,E]of[[this.left,this.right],[this.right,this.left]])B.acceptedConnectionPointTypes=[HE.Int,HE.Float],E.isConnected&&(B.acceptedConnectionPointTypes.push(E.type),E.type!==HE.Int&&E.type!==HE.Float||B.acceptedConnectionPointTypes.push(HE.Vector2,HE.GE,HE.gc))}dispose(){super.dispose();for(const B of this._connectionObservers)B.remove();this._connectionObservers.length=0}serialize(){const B=super.serialize();return B.operation=this.operation,B}_deserialize(B){super._deserialize(B),this.operation=B.operation}}(0,A.c)([OE("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:wE.Add},{label:"Subtract",value:wE.Subtract},{label:"Multiply",value:wE.Multiply},{label:"Divide",value:wE.Divide},{label:"Max",value:wE.Max},{label:"Min",value:wE.Min}]})],Ev.prototype,"operation",void 0),(0,S.f)("BABYLON.ParticleMathBlock",Ev);class vv extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("direction1",HE.GE,!0,new z.GE(0,1,0)),this.registerInput("direction2",HE.GE,!0,new z.GE(0,1,0)),this.registerInput("minEmitBox",HE.GE,!0,new z.GE(-.5,-.5,-.5)),this.registerInput("maxEmitBox",HE.GE,!0,new z.GE(.5,.5,.5)),this.registerOutput("output",HE.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(B){const E=this.particle.getConnectedValue(B);E._directionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.direction1.getConnectedValue(B),q=this.direction2.getConnectedValue(B),c=(0,D.RandomRange)(o.x,q.x),S=(0,D.RandomRange)(o.y,q.y),x=(0,D.RandomRange)(o.z,q.z);B.isEmitterTransformNode?z.GE.TransformNormalFromFloatsToRef(c,S,x,B.emitterWorldMatrix,v.direction):v.direction.Yc(c,S,x)},E._positionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.minEmitBox.getConnectedValue(B),q=this.maxEmitBox.getConnectedValue(B),c=(0,D.RandomRange)(o.x,q.x),S=(0,D.RandomRange)(o.y,q.y),x=(0,D.RandomRange)(o.z,q.z);B.isEmitterTransformNode?z.GE.TransformCoordinatesFromFloatsToRef(c,S,x,B.emitterWorldMatrix,v.position):(v.position.Yc(c,S,x),v.position.addInPlace(B.emitterPosition))},this.output._storedValue=E}}(0,S.f)("BABYLON.BoxShapeBlock",vv);class zv extends JE{constructor(B){super(B),this.registerInput("emitPower",HE.Float,!0,1),this.registerInput("lifeTime",HE.Float,!0,1),this.registerInput("color",HE.gc,!0,new c.gc(1,1,1,1)),this.registerInput("scale",HE.Vector2,!0,new z.Vector2(1,1)),this.registerInput("angle",HE.Float,!0,0),this.registerOutput("particle",HE.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(B){const E=new SE(this.name,B.Gv,B.aE,null,!1,void 0,!0);E.particleEmitterType=new m,E._lifeTimeCreation.process=(E,v)=>{B.particleContext=E,E.lifeTime=this.lifeTime.getConnectedValue(B),v._emitPower=this.emitPower.getConnectedValue(B)},E._colorCreation.process=E=>{B.particleContext=E,E.color.S(this.color.getConnectedValue(B))},E._sizeCreation.process=E=>{B.particleContext=E,E.size=1,E.scale.S(this.scale.getConnectedValue(B))},E._angleCreation.process=E=>{B.particleContext=E,E.angle=this.angle.getConnectedValue(B)},this.particle._storedValue=E}}(0,S.f)("BABYLON.CreateParticleBlock",zv);class ov{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const B=[];for(const E of this.attachedBlocks)E.isInput&&B.push(E);return B}constructor(B){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new k.e,this.name=B}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(B)&&this.attachedBlocks.push(B);for(const v of B.inputs){const z=v.connectedPoint;if(z){const v=z.ownerBlock;v!==B&&this._initializeBlock(v,E)}}}async buildAsync(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((v=>{const z=new rE;for(const B of this._systemBlocks)this._initializeBlock(B);for(const o of this.systemBlocks){const v=new eE;v.buildId=this._buildId++,v.aE=B,v.verbose=E;const q=o.createSystem(v);v.emitErrors(),z.systems.push(q)}this.onBuildObservable.notifyObservers(this),v(z)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const B=new LE("Particle system"),E=new Bv("Update position");E.output.connectTo(B.particle);const v=new ME("Position");v.contextualValue=FE.Position;const z=new ME("Scaled direction");z.contextualValue=FE.ScaledDirection;const o=new Ev("Add");o.operation=wE.Add,v.output.connectTo(o.left),z.output.connectTo(o.right),o.output.connectTo(E.position);const q=new zv("Create particle"),c=new vv("Box shape");q.particle.connectTo(c.particle),c.output.connectTo(E.particle);const S=new ZE("Texture");S.texture.connectTo(B.texture),S.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(B)}removeBlock(B){const E=this.attachedBlocks.indexOf(B);if(E>-1&&this.attachedBlocks.splice(E,1),B.isSystem){const E=this._systemBlocks.indexOf(B);E>-1&&this._systemBlocks.splice(E,1)}}parseSerializedObject(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E||this.clear();const v={};for(const z of B.Mh){const B=(0,S.b)(z.customType);if(B){const E=new B;E._deserialize(z),v[z.id]=E,this.attachedBlocks.push(E),E.isSystem&&this._systemBlocks.push(E)}}for(const z of this.attachedBlocks)if(z.isTeleportOut){const B=z,E=B._tempEntryPointUniqueId;if(E){const z=v[E];z&&z.attachToEndpoint(B)}}for(let z=0;z<B.Mh.length;z++){const o=B.Mh[z],q=v[o.id];q&&(q.inputs.length&&o.inputs.some((B=>B.targetConnectionName))&&!E||this._restoreConnections(q,B,v))}if(B.locations||B.editorData&&B.editorData.locations){const z=B.locations||B.editorData.locations;for(const B of z)v[B.po]&&(B.po=v[B.po].uniqueId);E&&this.editorData&&this.editorData.locations&&z.concat(this.editorData.locations),B.locations?this.editorData={locations:z}:(this.editorData=B.editorData,this.editorData.locations=z);const o=[];for(const B in v)o[B]=v[B].uniqueId;this.editorData.map=o}this.comment=B.comment}_restoreConnections(B,E,v){for(const z of B.outputs)for(const o of E.Mh){const q=v[o.id];if(q)for(const c of o.inputs)if(v[c.targetBlockId]!==B||c.targetConnectionName!==z.name);else{const B=q.getInputByName(c.inputName);if(!B||B.isConnected)continue;z.connectTo(B,!0),this._restoreConnections(q,E,v)}}}serialize(B){const E=B?{}:d.b.Serialize(this);E.editorData=JSON.parse(JSON.stringify(this.editorData));let v=[];B?v=B:E.customType="BABYLON.NodeParticleSystemSet",E.Mh=[];for(const z of v)E.Mh.push(z.serialize());if(!B)for(const z of this.attachedBlocks)-1===v.indexOf(z)&&E.Mh.push(z.serialize());return E}dispose(){for(const B of this.attachedBlocks)B.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(B){const E=new ov(B);return E.setToDefault(),E}static Parse(B){const E=d.b.Parse((()=>new ov(B.name)),B,null);return E.parseSerializedObject(B),E}static ParseFromSnippetAsync(B,E){return"_BLANK"===B?Promise.resolve(ov.CreateDefault("blank")):new Promise(((v,z)=>{const o=new iE.b;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const c=JSON.parse(JSON.parse(o.responseText).jsonPayload),S=JSON.parse(c.nodeParticle);E||(E=d.b.Parse((()=>new ov(B)),S,null)),E.parseSerializedObject(S),E.snippetId=B;try{v(E)}catch(q){z(q)}}else z("Unable to load the snippet "+B)})),o.open("GET",this.SnippetUrl+"/"+B.replace(/#/g,"/")),o.send()}))}}ov.EditorURL=`${TE.Tools._DefaultCdnUrl}/v${OB.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,ov.SnippetUrl="https://snippet.babylonjs.com",(0,A.c)([(0,l.K)()],ov.prototype,"name",void 0),(0,A.c)([(0,l.K)("comment")],ov.prototype,"comment",void 0),function(B){B[B.None=0]="None",B[B.PerParticle=1]="PerParticle",B[B.PerSystem=2]="PerSystem"}(nE||(nE={}));class qv extends JE{constructor(B){super(B),this._currentLockId=-2,this.lockMode=nE.PerParticle,this.registerInput("min",HE.AutoDetect,!0,0),this.registerInput("max",HE.AutoDetect,!0,1),this.registerOutput("output",HE.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HE.Float|HE.Int|HE.Vector2|HE.GE|HE.gc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(HE.Float|HE.Int|HE.Vector2|HE.GE|HE.gc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=HE.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let B=null;switch(this._currentLockId=-2,this.min.type){case HE.AutoDetect:case HE.Int:case HE.Float:B=B=>{const E=this.min.getConnectedValue(B)||0,v=this.max.getConnectedValue(B)||1;return E+Math.random()*(v-E)};break;case HE.Vector2:B=B=>{const E=this.min.getConnectedValue(B)||z.Vector2.Zero(),v=this.max.getConnectedValue(B)||z.Vector2.One();return new z.Vector2(E.x+Math.random()*(v.x-E.x),E.y+Math.random()*(v.y-E.y))};break;case HE.GE:B=B=>{const E=this.min.getConnectedValue(B)||z.GE.Zero(),v=this.max.getConnectedValue(B)||z.GE.One();return new z.GE(E.x+Math.random()*(v.x-E.x),E.y+Math.random()*(v.y-E.y),E.z+Math.random()*(v.z-E.z))};break;case HE.gc:B=B=>{const E=this.min.getConnectedValue(B)||new c.gc(0,0,0,0),v=this.max.getConnectedValue(B)||new c.gc(1,1,1,1);return new c.gc(E.x+Math.random()*(v.x-E.x),E.y+Math.random()*(v.y-E.y),E.z+Math.random()*(v.z-E.z),E.w+Math.random()*(v.w-E.w))}}this.output._storedFunction=E=>{var v;let z=0;switch(this.lockMode){case nE.PerParticle:z=(null===(v=E.particleContext)||void 0===v?void 0:v.id)||-1;break;case nE.PerSystem:z=E.buildId||0}return this._currentLockId!==z&&(this.lockMode!==nE.None&&(this._currentLockId=z),this.output._storedValue=B(E)),this.output._storedValue}}serialize(){const B=super.serialize();return B.lockMode=this.lockMode,B}_deserialize(B){super._deserialize(B),this.lockMode=B.lockMode}}(0,A.c)([OE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:nE.None},{label:"Per particle",value:nE.PerParticle},{label:"Per system",value:nE.PerSystem}]})],qv.prototype,"lockMode",void 0),(0,S.f)("BABYLON.ParticleRandomBlock",qv);class cv extends JE{constructor(B){super(B),this._currentLockId=-2,this.lockMode=nE.PerParticle,this.registerInput("min",HE.AutoDetect),this.registerInput("max",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const E=[HE.Matrix,HE.Particle,HE.Texture,HE.System,HE.FloatGradient,HE.Color4Gradient,HE.Vector2Gradient,HE.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...E),this.max.excludedConnectionPointTypes.push(...E)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let B=null;switch(this._currentLockId=-2,this.min.type){case HE.Float:case HE.Int:B=B=>{const E=this.min.getConnectedValue(B),v=this.max.getConnectedValue(B);return Math.random()*(v-E)+E};break;case HE.Vector2:B=B=>{const E=this.min.getConnectedValue(B),v=this.max.getConnectedValue(B);return new z.Vector2(Math.random()*(v.x-E.x)+E.x,Math.random()*(v.y-E.y)+E.y)};break;case HE.GE:B=B=>{const E=this.min.getConnectedValue(B),v=this.max.getConnectedValue(B);return new z.GE(Math.random()*(v.x-E.x)+E.x,Math.random()*(v.y-E.y)+E.y,Math.random()*(v.z-E.z)+E.z)};break;case HE.gc:B=B=>{const E=this.min.getConnectedValue(B),v=this.max.getConnectedValue(B);return new c.gc(Math.random()*(v.r-E.r)+E.r,Math.random()*(v.g-E.g)+E.g,Math.random()*(v.b-E.b)+E.b,Math.random()*(v.a-E.a)+E.a)}}this.output._storedFunction=E=>{var v;let z=0;switch(this.lockMode){case nE.PerParticle:z=(null===(v=E.particleContext)||void 0===v?void 0:v.id)||-1;break;case nE.PerSystem:z=E.buildId||0}return this._currentLockId!==z&&(this.lockMode!==nE.None&&(this._currentLockId=z),this.output._storedValue=B(E)),this.output._storedValue}}serialize(){const B=super.serialize();return B.lockMode=this.lockMode,B}_deserialize(B){super._deserialize(B),void 0!==B.lockMode&&(this.lockMode=B.lockMode)}}(0,A.c)([OE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:nE.None},{label:"Per particle",value:nE.PerParticle},{label:"Per system",value:nE.PerSystem}]})],cv.prototype,"lockMode",void 0),(0,S.f)("BABYLON.RandomRangeBlock",cv);(0,S.f)("BABYLON.ParticleLerpBlock",class extends JE{constructor(B){super(B),this.registerInput("left",HE.AutoDetect),this.registerInput("right",HE.AutoDetect),this.registerInput("gradient",HE.Float,!0,0,0,1),this.registerOutput("output",HE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HE.Float|HE.Int|HE.Vector2|HE.GE|HE.gc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const B=(B,E,v)=>(1-B)*E+B*v;this.output._storedFunction=E=>{const v=this.left.getConnectedValue(E),o=this.right.getConnectedValue(E),q=this.gradient.getConnectedValue(E);switch(this.left.type){case HE.Int:case HE.Float:return B(q,v,o);case HE.Vector2:return new z.Vector2(B(q,v.x,o.x),B(q,v.y,o.y));case HE.GE:return new z.GE(B(q,v.x,o.x),B(q,v.y,o.y),B(q,v.z,o.z));case HE.gc:return new c.gc(B(q,v.r,o.r),B(q,v.g,o.g),B(q,v.b,o.b),B(q,v.a,o.a))}return 0}}});(0,S.f)("BABYLON.UpdateDirectionBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("direction",HE.GE),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(B){const E=this.particle.getConnectedValue(B);if(this.output._storedValue=E,!this.direction.isConnected)return;const v={process:v=>{B.particleContext=v,B.systemContext=E,v.direction.S(this.direction.getConnectedValue(B))},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v}});(0,S.f)("BABYLON.UpdateColorBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("color",HE.gc),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(B){const E=this.particle.getConnectedValue(B);if(this.output._storedValue=E,!this.color.isConnected)return;const v={process:v=>{B.particleContext=v,B.systemContext=E,v.color.S(this.color.getConnectedValue(B))},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v}});(0,S.f)("BABYLON.UpdateScaleBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("scale",HE.Vector2),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(B){const E=this.particle.getConnectedValue(B);if(this.output._storedValue=E,!this.scale.isConnected)return;const v={process:v=>{B.particleContext=v,B.systemContext=E,v.scale.S(this.scale.getConnectedValue(B))},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v}});(0,S.f)("BABYLON.UpdateAngleBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("angle",HE.Float),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(B){const E=this.particle.getConnectedValue(B);if(this.output._storedValue=E,!this.angle.isConnected)return;const v={process:v=>{B.particleContext=v,B.systemContext=E,v.angle=this.angle.getConnectedValue(B)},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v}});(0,S.f)("BABYLON.BasicPositionUpdateBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(B){const E=this.particle.getConnectedValue(B),v={process:v=>{B.particleContext=v,B.systemContext=E,v.direction.scaleToRef(E._directionScale,E._scaledDirection),v.position.addInPlace(E._scaledDirection)},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v,this.output._storedValue=E}});(0,S.f)("BABYLON.BasicSpriteUpdateBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(B){const E=this.particle.getConnectedValue(B),v={process:v=>{B.particleContext=v,B.systemContext=E,v.updateCellIndex()},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v,this.output._storedValue=E}});(0,S.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("cellIndex",HE.Int),this.registerOutput("output",HE.Particle),this.cellIndex.acceptedConnectionPointTypes=[HE.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(B){const E=this.particle.getConnectedValue(B);if(this.output._storedValue=E,!this.cellIndex.isConnected)return;const v={process:v=>{B.particleContext=v,B.systemContext=E,v.cellIndex=Math.floor(this.cellIndex.getConnectedValue(B))},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v}});class Sv extends JE{constructor(B){super(B),this.strength=1,this.registerInput("particle",HE.Particle),this.registerInput("flowMap",HE.Texture),this.registerOutput("output",HE.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(B){var E;const v=this.particle.getConnectedValue(B),z=B.aE;let o;(null===(E=this.flowMap.connectedPoint)||void 0===E?void 0:E.ownerBlock).extractTextureContentAsync().then((B=>{B&&(o=new pE(B.width,B.height,B.data))}));const q={process:B=>{const E=z.getTransformMatrix();o&&o._processParticle(B,this.strength*v._tempScaledUpdateSpeed,E)},previousItem:null,nextItem:null};v._updateQueueStart?WB(q,v._updateQueueStart):v._updateQueueStart=q,this.output._storedValue=v}serialize(){const B=super.serialize();return B.strength=this.strength,B}_deserialize(B){super._deserialize(B),this.strength=B.strength}}(0,A.c)([OE("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sv.prototype,"strength",void 0),(0,S.f)("BABYLON.UpdateFlowMapBlock",Sv);(0,S.f)("BABYLON.SphereShapeBlock",class extends JE{constructor(B){super(B),this.registerInput("input",HE.Particle),this.registerInput("radius",HE.Float,!0,1),this.registerInput("radiusRange",HE.Float,!0,1,0,1),this.registerInput("directionRandomizer",HE.Float,!0,0,0,1),this.registerOutput("output",HE.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(B){const E=this.input.getConnectedValue(B);E._directionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.directionRandomizer.getConnectedValue(B),q=v.position.YE(B.emitterPosition).normalize(),c=(0,D.RandomRange)(0,o),S=(0,D.RandomRange)(0,o),x=(0,D.RandomRange)(0,o);q.x+=c,q.y+=S,q.z+=x,q.normalize(),B.isEmitterTransformNode?z.GE.TransformNormalFromFloatsToRef(c,S,x,B.emitterWorldMatrix,v.direction):v.direction.Yc(c,S,x)},E._positionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.radius.getConnectedValue(B),q=this.radiusRange.getConnectedValue(B),c=o-(0,D.RandomRange)(0,o*q),S=(0,D.RandomRange)(0,1),x=(0,D.RandomRange)(0,2*Math.PI),h=Math.acos(2*S-1),y=c*Math.cos(x)*Math.sin(h),Q=c*Math.cos(h),P=c*Math.sin(x)*Math.sin(h);B.isEmitterTransformNode?z.GE.TransformCoordinatesFromFloatsToRef(y,Q,P,B.emitterWorldMatrix,v.position):(v.position.Yc(y,Q,P),v.position.addInPlace(B.emitterPosition))},this.output._storedValue=E}});(0,S.f)("BABYLON.PointShapeBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("direction1",HE.GE,!0,new z.GE(0,1,0)),this.registerInput("direction2",HE.GE,!0,new z.GE(0,1,0)),this.registerOutput("output",HE.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){const E=this.particle.getConnectedValue(B);E._directionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.direction1.getConnectedValue(B),q=this.direction2.getConnectedValue(B),c=(0,D.RandomRange)(o.x,q.x),S=(0,D.RandomRange)(o.y,q.y),x=(0,D.RandomRange)(o.z,q.z);B.isEmitterTransformNode?z.GE.TransformNormalFromFloatsToRef(c,S,x,B.emitterWorldMatrix,v.direction):v.direction.Yc(c,S,x)},E._positionCreation.process=v=>{B.systemContext=E,B.isEmitterTransformNode?z.GE.TransformCoordinatesFromFloatsToRef(0,0,0,B.emitterWorldMatrix,v.position):v.position.S(B.emitterPosition)},this.output._storedValue=E}});(0,S.f)("BABYLON.CustomShapeBlock",class extends JE{constructor(B){super(B),this.registerInput("particle",HE.Particle),this.registerInput("position",HE.GE,!0,new z.GE(0,0,0)),this.registerInput("direction",HE.GE,!0,new z.GE(0,1,0)),this.registerOutput("output",HE.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){const E=this.particle.getConnectedValue(B);E._directionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.direction.getConnectedValue(B);B.isEmitterTransformNode?z.GE.TransformNormalToRef(o,B.emitterWorldMatrix,v.direction):v.direction.S(o)},E._positionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.position.getConnectedValue(B);B.isEmitterTransformNode?z.GE.TransformCoordinatesToRef(o,B.emitterWorldMatrix,v.position):(v.position.S(o),v.position.addInPlace(B.emitterPosition))},this.output._storedValue=E}});(0,S.f)("BABYLON.CylinderShapeBlock",class extends JE{constructor(B){super(B),this._tempVector=z.GE.Zero(),this.registerInput("particle",HE.Particle),this.registerInput("radius",HE.Float,!0,1),this.registerInput("height",HE.Float,!0,1,0),this.registerInput("radiusRange",HE.Float,!0,1,0,1),this.registerInput("directionRandomizer",HE.Float,!0,0,0,1),this.registerOutput("output",HE.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(B){const E=this.particle.getConnectedValue(B);E._directionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.directionRandomizer.getConnectedValue(B);v.position.subtractToRef(B.emitterPosition,this._tempVector),this._tempVector.normalize(),B.isEmitterTransformNode&&z.GE.TransformNormalToRef(this._tempVector,B.emitterInverseWorldMatrix,this._tempVector);const q=(0,D.RandomRange)(-o/2,o/2);let c=Math.atan2(this._tempVector.x,this._tempVector.z);c+=(0,D.RandomRange)(-Math.PI/2,Math.PI/2)*o,this._tempVector.y=q,this._tempVector.x=Math.sin(c),this._tempVector.z=Math.cos(c),this._tempVector.normalize(),B.isEmitterTransformNode?z.GE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,B.emitterWorldMatrix,v.direction):v.direction.S(this._tempVector)},E._positionCreation.process=v=>{B.particleContext=v,B.systemContext=E;const o=this.height.getConnectedValue(B),q=this.radiusRange.getConnectedValue(B),c=this.radius.getConnectedValue(B),S=(0,D.RandomRange)(-o/2,o/2),x=(0,D.RandomRange)(0,2*Math.PI),h=(0,D.RandomRange)((1-q)*(1-q),1),y=Math.sqrt(h)*c,Q=y*Math.cos(x),P=y*Math.sin(x);B.isEmitterTransformNode?z.GE.TransformCoordinatesFromFloatsToRef(Q,S,P,B.emitterWorldMatrix,v.position):(v.position.Yc(Q,S,P),v.position.addInPlace(B.emitterPosition))},this.output._storedValue=E}});class xv extends JE{constructor(B){super(B),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",HE.Particle),this.registerOutput("output",HE.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);const E=this.particle.getConnectedValue(B);E._isAnimationSheetEnabled=!0,E.spriteCellWidth=this.width,E.spriteCellHeight=this.height,E.startSpriteCellID=this.start,E.endSpriteCellID=this.end,E.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=E}serialize(){const B=super.serialize();return B.width=this.width,B.height=this.height,B.start=this.start,B.end=this.end,B.randomStartCell=this.randomStartCell,B}_deserialize(B){super._deserialize(B),this.width=B.width,this.height=B.height,this.start=B.start,this.end=B.end,this.randomStartCell=B.randomStartCell}}(0,A.c)([OE("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xv.prototype,"start",void 0),(0,A.c)([OE("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xv.prototype,"end",void 0),(0,A.c)([OE("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xv.prototype,"width",void 0),(0,A.c)([OE("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xv.prototype,"height",void 0),(0,A.c)([OE("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],xv.prototype,"loop",void 0),(0,A.c)([OE("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],xv.prototype,"randomStartCell",void 0),(0,S.f)("BABYLON.SetupSpriteSheetBlock",xv);class Dv extends JE{constructor(B){super(B),this.reference=0,this.registerInput("value",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=B=>{switch(B){case HE.Float:return HE.FloatGradient;case HE.Vector2:return HE.Vector2Gradient;case HE.GE:return HE.Vector3Gradient;case HE.gc:return HE.Color4Gradient}return B},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HE.Float|HE.Vector2|HE.GE|HE.gc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=B=>null}serialize(){const B=super.serialize();return B.reference=this.reference,B}_deserialize(B){super._deserialize(B),this.reference=B.reference}}(0,A.c)([OE("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Dv.prototype,"reference",void 0),(0,S.f)("BABYLON.ParticleGradientValueBlock",Dv);(0,S.f)("BABYLON.ParticleGradientBlock",class extends JE{constructor(B){super(B),this._entryCount=1,this.registerInput("gradient",HE.Float,!0,1,0,1),this.registerInput("value0",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=B=>{switch(B){case HE.FloatGradient:return HE.Float;case HE.Vector2Gradient:return HE.Vector2;case HE.Vector3Gradient:return HE.GE;case HE.Color4Gradient:return HE.gc}return B},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(HE.FloatGradient|HE.Vector2Gradient|HE.Vector3Gradient|HE.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(B){this._inputs[B].onConnectionObservable.add((()=>{this._entryCount>B||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),HE.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const B=[];for(let v=1;v<this._inputs.length;v++){var E;if(this._inputs[v].isConnected)B.push(null===(E=this._inputs[v].connectedPoint)||void 0===E?void 0:E.ownerBlock)}B.sort(((B,E)=>B.reference-E.reference)),this.output._storedFunction=E=>{const v=this.gradient.getConnectedValue(E);if(1===B.length)return B[0].value.getConnectedValue(E);let o=null;for(let q=B.length-1;q>=0;q--){const S=B[q];if(S.reference<=v){const B=S.value.getConnectedValue(E);if(o){const q=o.value.getConnectedValue(E),x=o.reference,h=S.reference,y=Math.max(0,Math.min(1,(v-h)/(x-h)));switch(this.output.type){case HE.Float:return(0,D.Lerp)(B,q,y);case HE.Vector2:return z.Vector2.Lerp(B,q,y);case HE.GE:return z.GE.Lerp(B,q,y);case HE.gc:return c.gc.Lerp(B,q,y)}}return B}o=S}return 0}}});(0,S.f)("BABYLON.ParticleConverterBlock",class extends JE{constructor(B){super(B),this.registerInput("color ",HE.gc,!0),this.registerInput("xyz ",HE.GE,!0),this.registerInput("xy ",HE.Vector2,!0),this.registerInput("zw ",HE.Vector2,!0),this.registerInput("x ",HE.Float,!0),this.registerInput("y ",HE.Float,!0),this.registerInput("z ",HE.Float,!0),this.registerInput("w ",HE.Float,!0),this.registerOutput("color",HE.gc),this.registerOutput("xyz",HE.GE),this.registerOutput("xy",HE.Vector2),this.registerOutput("zw",HE.Vector2),this.registerOutput("x",HE.Float),this.registerOutput("y",HE.Float),this.registerOutput("z",HE.Float),this.registerOutput("w",HE.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(B){return"color "===B?"colorIn":"xyz "===B?"xyzIn":"xy "===B?"xyIn":"zw "===B?"zwIn":"x "===B?"xIn":"y "===B?"yIn":"z "===B?"zIn":"w "===B?"wIn":B}_outputRename(B){switch(B){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return B}}_build(B){super._build(B);const E=this.xIn,v=this.yIn,o=this.zIn,q=this.wIn,S=this.xyIn,x=this.zwIn,D=this.xyzIn,h=this.colorIn,y=this.colorOut,Q=this.xyzOut,P=this.xyOut,G=this.zwOut,Y=this.xOut,a=this.yOut,m=this.zOut,g=this.wOut,V=B=>{if(h.isConnected)return h.getConnectedValue(B);let z=0,y=0,Q=0,P=0;if(E.isConnected&&(z=E.getConnectedValue(B)),v.isConnected&&(y=v.getConnectedValue(B)),o.isConnected&&(Q=o.getConnectedValue(B)),q.isConnected&&(P=q.getConnectedValue(B)),S.isConnected){const E=S.getConnectedValue(B);E&&(z=E.x,y=E.y)}if(x.isConnected){const E=x.getConnectedValue(B);E&&(Q=E.x,P=E.y)}if(D.isConnected){const E=D.getConnectedValue(B);E&&(z=E.x,y=E.y,Q=E.z)}return new c.gc(z,y,Q,P)};y._storedFunction=B=>V(B),Q._storedFunction=B=>{const E=V(B);return new z.GE(E.r,E.g,E.b)},P._storedFunction=B=>{const E=V(B);return new z.Vector2(E.r,E.g)},G._storedFunction=B=>{const E=V(B);return new z.Vector2(E.b,E.a)},Y._storedFunction=B=>V(B).r,a._storedFunction=B=>V(B).g,m._storedFunction=B=>V(B).b,g._storedFunction=B=>V(B).a}}),function(B){B[B.Cos=0]="Cos",B[B.Sin=1]="Sin",B[B.Abs=2]="Abs",B[B.Exp=3]="Exp",B[B.Exp2=4]="Exp2",B[B.Round=5]="Round",B[B.Floor=6]="Floor",B[B.Ceiling=7]="Ceiling",B[B.Sqrt=8]="Sqrt",B[B.Log=9]="Log",B[B.Tan=10]="Tan",B[B.ArcTan=11]="ArcTan",B[B.ArcCos=12]="ArcCos",B[B.ArcSin=13]="ArcSin",B[B.Sign=14]="Sign",B[B.Negate=15]="Negate",B[B.OneMinus=16]="OneMinus",B[B.Reciprocal=17]="Reciprocal",B[B.ToDegrees=18]="ToDegrees",B[B.ToRadians=19]="ToRadians",B[B.Fract=20]="Fract"}(UE||(UE={}));class hv extends JE{constructor(B){super(B),this.operation=UE.Cos,this.registerInput("input",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HE.Float|HE.Int|HE.Vector2|HE.GE|HE.gc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);let E=null;switch(this.operation){case UE.Cos:E=B=>Math.cos(B);break;case UE.Sin:E=B=>Math.sin(B);break;case UE.Abs:E=B=>Math.abs(B);break;case UE.Exp:E=B=>Math.exp(B);break;case UE.Exp2:E=B=>Math.pow(2,B);break;case UE.Round:E=B=>Math.round(B);break;case UE.Floor:E=B=>Math.floor(B);break;case UE.Ceiling:E=B=>Math.ceil(B);break;case UE.Sqrt:E=B=>Math.sqrt(B);break;case UE.Log:E=B=>Math.log(B);break;case UE.Tan:E=B=>Math.tan(B);break;case UE.ArcTan:E=B=>Math.atan(B);break;case UE.ArcCos:E=B=>Math.acos(B);break;case UE.ArcSin:E=B=>Math.asin(B);break;case UE.Sign:E=B=>Math.sign(B);break;case UE.Negate:E=B=>-B;break;case UE.OneMinus:E=B=>1-B;break;case UE.Reciprocal:E=B=>1/B;break;case UE.ToRadians:E=B=>B*Math.PI/180;break;case UE.ToDegrees:E=B=>180*B/Math.PI;break;case UE.Fract:E=B=>B>=0?B-Math.floor(B):B-Math.ceil(B)}if(!E)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case HE.Int:case HE.Float:this.output._storedFunction=B=>{const v=this.input.getConnectedValue(B);return E(v)};break;case HE.Vector2:this.output._storedFunction=B=>{const v=this.input.getConnectedValue(B);return new z.Vector2(E(v.x),E(v.y))};break;case HE.GE:this.output._storedFunction=B=>{const v=this.input.getConnectedValue(B);return new z.GE(E(v.x),E(v.y),E(v.z))};break;case HE.gc:this.output._storedFunction=B=>{const v=this.input.getConnectedValue(B);return new c.gc(E(v.r),E(v.g),E(v.b),E(v.a))}}return this}serialize(){const B=super.serialize();return B.operation=this.operation,B}_deserialize(B){super._deserialize(B),this.operation=B.operation}}(0,A.c)([OE("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:UE.Cos},{label:"Sin",value:UE.Sin},{label:"Abs",value:UE.Abs},{label:"Exp",value:UE.Exp},{label:"Exp2",value:UE.Exp2},{label:"Round",value:UE.Round},{label:"Floor",value:UE.Floor},{label:"Ceiling",value:UE.Ceiling},{label:"Sqrt",value:UE.Sqrt},{label:"Log",value:UE.Log},{label:"Tan",value:UE.Tan},{label:"ArcTan",value:UE.ArcTan},{label:"ArcCos",value:UE.ArcCos},{label:"ArcSin",value:UE.ArcSin},{label:"Sign",value:UE.Sign},{label:"Negate",value:UE.Negate},{label:"OneMinus",value:UE.OneMinus},{label:"Reciprocal",value:UE.Reciprocal},{label:"ToDegrees",value:UE.ToDegrees},{label:"ToRadians",value:UE.ToRadians},{label:"Fract",value:UE.Fract}]})],hv.prototype,"operation",void 0),(0,S.f)("BABYLON.ParticleTrigonometryBlock",hv);var yv,Qv=v(12785);class Pv extends JE{constructor(B){super(B),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(HE.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(HE.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(HE.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(HE.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(HE.System),this._inputs[0].excludedConnectionPointTypes.push(HE.Particle),this._inputs[0].excludedConnectionPointTypes.push(HE.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const E=B=>{const E=this.input.getConnectedValue(B);if(this.log.length>=this.stackSize)return E;if(null===E||void 0===E)return this.log.push(["null",""]),E;switch(this.input.type){case HE.Vector2:this.log.push([(0,Qv.h)(E,4),E.toString()]);break;case HE.GE:this.log.push([(0,Qv.j)(E,4),E.toString()]);break;case HE.gc:this.log.push([`{R: ${E.r.toFixed(4)} G: ${E.g.toFixed(4)} B: ${E.b.toFixed(4)} A: ${E.a.toFixed(4)}}`,E.toString()]);break;default:this.log.push([E.toString(),E.toString()])}return E};this.output.isConnected?this.output._storedFunction=E:this.output._storedValue=E(B)}serialize(){const B=super.serialize();return B.stackSize=this.stackSize,B}_deserialize(B){super._deserialize(B),this.stackSize=B.stackSize}}(0,A.c)([OE("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Pv.prototype,"stackSize",void 0),(0,S.f)("BABYLON.ParticleDebugBlock",Pv);(0,S.f)("BABYLON.ParticleElbowBlock",class extends JE{constructor(B){super(B),this.registerInput("input",HE.AutoDetect),this.registerOutput("output",HE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);const E=this._outputs[0],v=this._inputs[0];E._storedFunction=B=>v.getConnectedValue(B)}});(0,S.f)("BABYLON.ParticleTeleportInBlock",class extends JE{get endpoints(){return this._endpoints}constructor(B){super(B),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",HE.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(B){if(this.getClassName()===B)return!0;for(const E of this.endpoints)if(E.isAnAncestorOfType(B))return!0;return!1}isAnAncestorOf(B){for(const E of this.endpoints){if(E===B)return!0;if(E.isAnAncestorOf(B))return!0}return!1}attachToEndpoint(B){B.detach(),this._endpoints.push(B),B._entryPoint=this,B._outputs[0]._typeConnectionSource=this._inputs[0],B._tempEntryPointUniqueId=null,B.name="> "+this.name}detachFromEndpoint(B){const E=this._endpoints.indexOf(B);-1!==E&&(this._endpoints.splice(E,1),B._outputs[0]._typeConnectionSource=null,B._entryPoint=null)}_build(){for(const B of this._endpoints)B.output._storedFunction=B=>this.input.getConnectedValue(B)}});(0,S.f)("BABYLON.ParticleTeleportOutBlock",class extends JE{constructor(B){super(B),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",HE.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(B){this.entryPoint&&this.entryPoint.build(B)}clone(){const B=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(B),B}serialize(){var B;const E=super.serialize();return E.entryPoint=(null===(B=this.entryPoint)||void 0===B?void 0:B.uniqueId)??"",E}_deserialize(B){super._deserialize(B),this._tempEntryPointUniqueId=B.entryPoint}}),function(B){B[B.Equal=0]="Equal",B[B.NotEqual=1]="NotEqual",B[B.LessThan=2]="LessThan",B[B.GreaterThan=3]="GreaterThan",B[B.LessOrEqual=4]="LessOrEqual",B[B.GreaterOrEqual=5]="GreaterOrEqual",B[B.Xor=6]="Xor",B[B.Or=7]="Or",B[B.And=8]="And"}(yv||(yv={}));class Gv extends JE{constructor(B){super(B),this.test=yv.Equal,this.epsilon=0,this.registerInput("left",HE.Float),this.registerInput("right",HE.Float,!0,0),this.registerInput("ifTrue",HE.AutoDetect,!0,1),this.registerInput("ifFalse",HE.AutoDetect,!0,0),this.registerOutput("output",HE.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=HE.Float,this._inputs[0].acceptedConnectionPointTypes.push(HE.Int),this._inputs[1].acceptedConnectionPointTypes.push(HE.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const B=B=>{const E=this.left.getConnectedValue(B),v=this.right.getConnectedValue(B);let z=!1;switch(this.test){case yv.Equal:z=(0,D.WithinEpsilon)(E,v,this.epsilon);break;case yv.NotEqual:z=!(0,D.WithinEpsilon)(E,v,this.epsilon);break;case yv.LessThan:z=E<v+this.epsilon;break;case yv.GreaterThan:z=E>v-this.epsilon;break;case yv.LessOrEqual:z=E<=v+this.epsilon;break;case yv.GreaterOrEqual:z=E>=v-this.epsilon;break;case yv.Xor:z=!!E&&!v||!E&&!!v;break;case yv.Or:z=!!E||!!v;break;case yv.And:z=!!E&&!!v}return z};this.output._storedFunction=E=>B(E)?this.ifTrue.getConnectedValue(E):this.ifFalse.getConnectedValue(E)}serialize(){const B=super.serialize();return B.test=this.test,B.epsilon=this.epsilon,B}_deserialize(B){super._deserialize(B),this.test=B.test,void 0!==B.epsilon&&(this.epsilon=B.epsilon)}}(0,A.c)([OE("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:yv.Equal},{label:"NotEqual",value:yv.NotEqual},{label:"LessThan",value:yv.LessThan},{label:"GreaterThan",value:yv.GreaterThan},{label:"LessOrEqual",value:yv.LessOrEqual},{label:"GreaterOrEqual",value:yv.GreaterOrEqual},{label:"Xor",value:yv.Xor},{label:"Or",value:yv.Or},{label:"And",value:yv.And}]})],Gv.prototype,"test",void 0),(0,A.c)([OE("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gv.prototype,"epsilon",void 0),(0,S.f)("BABYLON.ParticleConditionBlock",Gv);class Yv extends JE{constructor(B){super(B),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",HE.Particle),this.registerInput("condition",HE.Float,!0,0),this.registerInput("system",HE.System),this.registerOutput("output",HE.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){this._triggerCount=0;const E=this.input.getConnectedValue(B),v={process:v=>{if(B.particleContext=v,B.systemContext=E,0!==this.condition.getConnectedValue(B)&&(0===this.limit||this._triggerCount<this.limit)){const z=(new Date).getTime();if(this._previousOne&&z-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=z;const o=this.system.getConnectedValue(B);if(o){const z=kE(o,B.aE,v.position);z.eq.addOnce((()=>{this._triggerCount--})),E.eq.addOnce((()=>{z.dispose()}))}}},previousItem:null,nextItem:null};E._updateQueueStart?WB(v,E._updateQueueStart):E._updateQueueStart=v,this.output._storedValue=E}serialize(){const B=super.serialize();return B.limit=this.limit,B.delay=this.delay,B}_deserialize(B){super._deserialize(B),void 0!==B.limit&&(this.limit=B.limit),void 0!==B.delay&&(this.delay=B.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,A.c)([OE("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yv.prototype,"limit",void 0),(0,A.c)([OE("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yv.prototype,"delay",void 0),(0,S.f)("BABYLON.ParticleTriggerBlock",Yv);v(12787),v(12795),v(12803),v(12858)},12842:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneFragment",q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12810:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneFragmentDeclaration",q="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12875:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneVertex",q="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12865:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneVertexDeclaration",q="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12853:(B,E,v)=>{"use strict";var z=v(11291);const o="fogFragment",q="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12836:(B,E,v)=>{"use strict";var z=v(11291);const o="fogFragmentDeclaration",q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12880:(B,E,v)=>{"use strict";var z=v(11291);const o="fogVertex",q="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12868:(B,E,v)=>{"use strict";var z=v(11291);const o="fogVertexDeclaration",q="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12824:(B,E,v)=>{"use strict";var z=v(11291);const o="helperFunctions",q="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12813:(B,E,v)=>{"use strict";var z=v(11291);const o="imageProcessingDeclaration",q="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12833:(B,E,v)=>{"use strict";var z=v(11291);const o="imageProcessingFunctions",q="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12819:(B,E,v)=>{"use strict";var z=v(11291);const o="logDepthDeclaration",q="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12847:(B,E,v)=>{"use strict";var z=v(11291);const o="logDepthFragment",q="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12889:(B,E,v)=>{"use strict";var z=v(11291);const o="logDepthVertex",q="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";z.c.IncludesShadersStoreWGSL[o]||(z.c.IncludesShadersStoreWGSL[o]=q)},12803:(B,E,v)=>{"use strict";v.r(E),v.d(E,{particlesPixelShaderWGSL:()=>c});var z=v(11291);v(12810),v(12813),v(12819),v(12824),v(12833),v(12836),v(12842),v(12847),v(12853);const o="particlesPixelShader",q="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.c.ShadersStoreWGSL[o]||(z.c.ShadersStoreWGSL[o]=q);const c={name:o,shader:q}},12858:(B,E,v)=>{"use strict";v.r(E),v.d(E,{particlesVertexShaderWGSL:()=>c});var z=v(11291);v(12865),v(12868),v(12819),v(12875),v(12880),v(12889);const o="particlesVertexShader",q="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.c.ShadersStoreWGSL[o]||(z.c.ShadersStoreWGSL[o]=q);const c={name:o,shader:q}},12729:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneFragment",q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12791:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneFragmentDeclaration",q="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12749:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneVertex",q="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12798:(B,E,v)=>{"use strict";var z=v(11291);const o="clipPlaneVertexDeclaration",q="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12743:(B,E,v)=>{"use strict";var z=v(11291);const o="fogFragment",q="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12720:(B,E,v)=>{"use strict";var z=v(11291);const o="fogFragmentDeclaration",q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12757:(B,E,v)=>{"use strict";var z=v(11291);const o="fogVertex",q="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12745:(B,E,v)=>{"use strict";var z=v(11291);const o="fogVertexDeclaration",q="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12704:(B,E,v)=>{"use strict";var z=v(11291);const o="helperFunctions",q="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12694:(B,E,v)=>{"use strict";var z=v(11291);const o="imageProcessingDeclaration",q="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12711:(B,E,v)=>{"use strict";var z=v(11291);const o="imageProcessingFunctions",q="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12696:(B,E,v)=>{"use strict";var z=v(11291);const o="logDepthDeclaration",q="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12734:(B,E,v)=>{"use strict";var z=v(11291);const o="logDepthFragment",q="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12763:(B,E,v)=>{"use strict";var z=v(11291);const o="logDepthVertex",q="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";z.c.IncludesShadersStore[o]||(z.c.IncludesShadersStore[o]=q)},12787:(B,E,v)=>{"use strict";v.r(E),v.d(E,{particlesPixelShader:()=>c});var z=v(11291);v(12791),v(12694),v(12696),v(12704),v(12711),v(12720),v(12729),v(12734),v(12743);const o="particlesPixelShader",q="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.c.ShadersStore[o]||(z.c.ShadersStore[o]=q);const c={name:o,shader:q}},12795:(B,E,v)=>{"use strict";v.r(E),v.d(E,{particlesVertexShader:()=>c});var z=v(11291);v(12798),v(12745),v(12696),v(12749),v(12757),v(12763);const o="particlesVertexShader",q="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.c.ShadersStore[o]||(z.c.ShadersStore[o]=q);const c={name:o,shader:q}},13148:(B,E,v)=>{"use strict";v.r(E),v.d(E,{FlowGraphGLTFDataProvider:()=>q});var z=v(13121),o=v(13102);class q extends z.c{constructor(B){var E,v;super();const z=B.glTF,q=(null===(E=z.animations)||void 0===E?void 0:E.map((B=>B._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",o.c,q);const c=(null===(v=z.nodes)||void 0===v?void 0:v.map((B=>B._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",o.c,c)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13034:(B,E,v)=>{"use strict";v.d(E,{e:()=>a,g:()=>G,j:()=>P,l:()=>Y});var z=v(11380),o=v(11865),q=v(11417),c=v(13043);const S=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class x{constructor(B,E){this._gltf=B,this._infoTree=E}convert(B){let E,v=this._gltf,z=this._infoTree;if(!B.startsWith("/"))throw new Error("Path must start with a /");const o=B.split("/");if(o.shift(),o[o.length-1].includes(".length")){const B=o[o.length-1].split(".");o.pop(),o.push(...B)}let q=!1;for(const x of o){const o="length"===x;if(o&&!z.__array__)throw new Error(`Path ${B} is invalid`);if(z.__ignoreObjectTree__&&(q=!0),z.__array__&&!o)z=z.__array__;else if(z=z[x],!z)throw new Error(`Path ${B} is invalid`);if(!q)if(void 0===v){if(!S.find((E=>E.regex.test(B))))throw new Error(`Path ${B} is invalid`)}else if(!o){var c;v=null===(c=v)||void 0===c?void 0:c[x]}(z.__target__||o)&&(E=v)}return{object:E,info:z}}}function D(B,E,v,z){const o=h(B,E);return z?o[v][z]:o[v]}function h(B,E,v){var z,q;return null===(z=B._data)||void 0===z||null===(q=z[(null===v||void 0===v?void 0:v.fillMode)??o.d.MATERIAL_TriangleFillMode])||void 0===q?void 0:q.babylonMaterial}function y(B,E){return{offset:{componentsCount:2,type:"Vector2",get:(v,o,q)=>{const c=D(v,q,B,E);return new z.Vector2(null===c||void 0===c?void 0:c.uOffset,null===c||void 0===c?void 0:c.vOffset)},getTarget:h,set:(v,z,o,q)=>{const c=D(z,q,B,E);c.uOffset=v.x,c.vOffset=v.y},getPropertyName:[()=>`${B}${E?"."+E:""}.uOffset`,()=>`${B}${E?"."+E:""}.vOffset`]},rotation:{type:"number",get:(v,z,o)=>{var q;return null===(q=D(v,o,B,E))||void 0===q?void 0:q.wAng},getTarget:h,set:(v,z,o,q)=>D(z,q,B,E).wAng=v,getPropertyName:[()=>`${B}${E?"."+E:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(v,o,q)=>{const c=D(v,q,B,E);return new z.Vector2(null===c||void 0===c?void 0:c.uScale,null===c||void 0===c?void 0:c.vScale)},getTarget:h,set:(v,z,o,q)=>{const c=D(z,q,B,E);c.uScale=v.x,c.vScale=v.y},getPropertyName:[()=>`${B}${E?"."+E:""}.uScale`,()=>`${B}${E?"."+E:""}.vScale`]}}}const Q={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:B=>{var E,v;return new z.Vector2((null===(E=B._babylonCamera)||void 0===E?void 0:E.orthoLeft)??0,(null===(v=B._babylonCamera)||void 0===v?void 0:v.orthoRight)??0)},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.orthoLeft=B.x,E._babylonCamera.orthoRight=B.y)},getTarget:B=>B,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:B=>{var E,v;return new z.Vector2((null===(E=B._babylonCamera)||void 0===E?void 0:E.orthoBottom)??0,(null===(v=B._babylonCamera)||void 0===v?void 0:v.orthoTop)??0)},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.orthoBottom=B.x,E._babylonCamera.orthoTop=B.y)},getTarget:B=>B,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:B=>{var E;return null===(E=B._babylonCamera)||void 0===E?void 0:E.maxZ},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=B)},getTarget:B=>B,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:B=>{var E;return null===(E=B._babylonCamera)||void 0===E?void 0:E.xc},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.xc=B)},getTarget:B=>B,getPropertyName:[()=>"xc"]}},perspective:{aspectRatio:{type:"number",get:B=>{var E;return null===(E=B._babylonCamera)||void 0===E?void 0:E.getEngine().getAspectRatio(B._babylonCamera)},getTarget:B=>B,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:B=>{var E;return null===(E=B._babylonCamera)||void 0===E?void 0:E.fov},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.fov=B)},getTarget:B=>B,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:B=>{var E;return null===(E=B._babylonCamera)||void 0===E?void 0:E.maxZ},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=B)},getTarget:B=>B,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:B=>{var E;return null===(E=B._babylonCamera)||void 0===E?void 0:E.xc},set:(B,E)=>{E._babylonCamera&&(E._babylonCamera.xc=B)},getTarget:B=>B,getPropertyName:[()=>"xc"]}}}},nodes:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"GE",get:B=>{var E;return null===(E=B._babylonTransformNode)||void 0===E?void 0:E.position},set:(B,E)=>{var v;return null===(v=E._babylonTransformNode)||void 0===v?void 0:v.position.S(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:B=>{var E;return null===(E=B._babylonTransformNode)||void 0===E?void 0:E.rotationQuaternion},set:(B,E)=>{var v,z;return null===(v=E._babylonTransformNode)||void 0===v||null===(z=v.rotationQuaternion)||void 0===z?void 0:z.S(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"GE",get:B=>{var E;return null===(E=B._babylonTransformNode)||void 0===E?void 0:E.ac},set:(B,E)=>{var v;return null===(v=E._babylonTransformNode)||void 0===v?void 0:v.ac.S(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"ac"]},weights:{length:{type:"number",get:B=>B._numMorphTargets,getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(B,E)=>{var v,z;return void 0!==E?null===(v=B._primitiveBabylonMeshes)||void 0===v||null===(z=v[0].morphTargetManager)||void 0===z?void 0:z.getTarget(E).influence:void 0},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(B,E)=>[0],getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:B=>{var E,v,o;return z.Matrix.Compose(null===(E=B._babylonTransformNode)||void 0===E?void 0:E.ac,null===(v=B._babylonTransformNode)||void 0===v?void 0:v.rotationQuaternion,null===(o=B._babylonTransformNode)||void 0===o?void 0:o.position)},getTarget:B=>B._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:B=>{var E,v,o,q;const c=z.Matrix.Identity();let S=B.parent;for(;S&&S.parent;)S=S.parent;const x=(null===(E=B._babylonTransformNode)||void 0===E?void 0:E.position._isDirty)||(null===(v=B._babylonTransformNode)||void 0===v||null===(o=v.rotationQuaternion)||void 0===o?void 0:o._isDirty)||(null===(q=B._babylonTransformNode)||void 0===q?void 0:q.ac._isDirty);if(S){var D;const E=null===(D=S._babylonTransformNode)||void 0===D?void 0:D.yc(!0).invert();var h,y;if(E)null===(h=B._babylonTransformNode)||void 0===h||null===(y=h.yc(x))||void 0===y||y.multiplyToRef(E,c)}else B._babylonTransformNode&&c.S(B._babylonTransformNode.yc(x));return c},getTarget:B=>B._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:B=>{var E,v;return null===(E=B._babylonTransformNode)||void 0===E||null===(v=E.getChildren((B=>B instanceof c.e),!0)[0])||void 0===v?void 0:v.Nc},getTarget:B=>{var E;return null===(E=B._babylonTransformNode)||void 0===E?void 0:E.getChildren((B=>B instanceof c.e),!0)[0]},set:(B,E)=>{if(E._babylonTransformNode){const v=E._babylonTransformNode.getChildren((B=>B instanceof c.e),!0)[0];v&&(v.Nc=B)}}},color:{type:"gE",get:B=>{var E,v;return null===(E=B._babylonTransformNode)||void 0===E||null===(v=E.getChildren((B=>B instanceof c.e),!0)[0])||void 0===v?void 0:v.Xc},getTarget:B=>{var E;return null===(E=B._babylonTransformNode)||void 0===E?void 0:E.getChildren((B=>B instanceof c.e),!0)[0]},set:(B,E)=>{if(E._babylonTransformNode){const v=E._babylonTransformNode.getChildren((B=>B instanceof c.e),!0)[0];v&&(v.Xc=B)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"gE",get:(B,E,v)=>h(B,E,v).emissiveColor,set:(B,E,v,z)=>h(E,v,z).emissiveColor.S(B),getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(B,E,v)=>{var z;return null===(z=D(B,v,"bumpTexture"))||void 0===z?void 0:z.level},set:(B,E,v,z)=>{const o=D(E,z,"bumpTexture");o&&(o.level=B)},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(B,E,v)=>h(B,E,v).ambientTextureStrength,set:(B,E,v,z)=>{const o=h(E,v,z);o&&(o.ambientTextureStrength=B)},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"gc",get:(B,E,v)=>{const z=h(B,E,v);return q.gc.FromColor3(z.albedoColor,z.alpha)},set:(B,E,v,z)=>{const o=h(E,v,z);o.albedoColor.set(B.r,B.g,B.b),o.alpha=B.a},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:y("albedoTexture")}},metallicFactor:{type:"number",get:(B,E,v)=>h(B,E,v).metallic,set:(B,E,v,z)=>{const o=h(E,v,z);o&&(o.metallic=B)},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(B,E,v)=>h(B,E,v).roughness,set:(B,E,v,z)=>{const o=h(E,v,z);o&&(o.roughness=B)},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(B,E,v)=>h(B,E,v).anisotropy.Nc,set:(B,E,v,z)=>{h(E,v,z).anisotropy.Nc=B},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(B,E,v)=>h(B,E,v).anisotropy.angle,set:(B,E,v,z)=>{h(E,v,z).anisotropy.angle=B},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(B,E,v)=>h(B,E,v).clearCoat.Nc,set:(B,E,v,z)=>{h(E,v,z).clearCoat.Nc=B},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(B,E,v)=>h(B,E,v).clearCoat.roughness,set:(B,E,v,z)=>{h(E,v,z).clearCoat.roughness=B},getTarget:(B,E,v)=>h(B,E,v),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(B,E,v)=>{var z;return null===(z=h(B,E,v).clearCoat.bumpTexture)||void 0===z?void 0:z.level},getTarget:h,set:(B,E,v,z)=>h(E,v,z).clearCoat.bumpTexture.level=B},extensions:{KHR_texture_transform:y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(B,E,v)=>h(B,E,v).subSurface.dispersion,getTarget:h,set:(B,E,v,z)=>h(E,v,z).subSurface.dispersion=B}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(B,E,v)=>h(B,E,v).emissiveIntensity,getTarget:h,set:(B,E,v,z)=>h(E,v,z).emissiveIntensity=B}},KHR_materials_ior:{ior:{type:"number",get:(B,E,v)=>h(B,E,v).indexOfRefraction,getTarget:h,set:(B,E,v,z)=>h(E,v,z).indexOfRefraction=B}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(B,E,v)=>h(B,E,v).iridescence.Nc,getTarget:h,set:(B,E,v,z)=>h(E,v,z).iridescence.Nc=B},iridescenceIor:{type:"number",get:(B,E,v)=>h(B,E,v).iridescence.indexOfRefraction,getTarget:h,set:(B,E,v,z)=>h(E,v,z).iridescence.indexOfRefraction=B},iridescenceTexture:{extensions:{KHR_texture_transform:y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(B,E,v)=>h(B,E,v).iridescence.maximumThickness,getTarget:h,set:(B,E,v,z)=>h(E,v,z).iridescence.maximumThickness=B},iridescenceThicknessMinimum:{type:"number",get:(B,E,v)=>h(B,E,v).iridescence.minimumThickness,getTarget:h,set:(B,E,v,z)=>h(E,v,z).iridescence.minimumThickness=B},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"gE",get:(B,E,v)=>h(B,E,v).sheen.color,getTarget:h,set:(B,E,v,z)=>h(E,v,z).sheen.color.S(B)},sheenColorTexture:{extensions:{KHR_texture_transform:y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(B,E,v)=>h(B,E,v).sheen.Nc,getTarget:h,set:(B,E,v,z)=>h(E,v,z).sheen.Nc=B},sheenRoughnessTexture:{extensions:{KHR_texture_transform:y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(B,E,v)=>h(B,E,v).metallicF0Factor,getTarget:h,set:(B,E,v,z)=>h(E,v,z).metallicF0Factor=B,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"gE",get:(B,E,v)=>h(B,E,v).metallicReflectanceColor,getTarget:h,set:(B,E,v,z)=>h(E,v,z).metallicReflectanceColor.S(B),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(B,E,v)=>h(B,E,v).subSurface.refractionIntensity,getTarget:h,set:(B,E,v,z)=>h(E,v,z).subSurface.refractionIntensity=B,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(B,E,v)=>h(B,E,v).subSurface.translucencyIntensity,getTarget:h,set:(B,E,v,z)=>h(E,v,z).subSurface.translucencyIntensity=B},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"gE",get:(B,E,v)=>h(B,E,v).subSurface.translucencyColor,getTarget:h,set:(B,E,v,z)=>{var o;return B&&(null===(o=h(E,v,z).subSurface.translucencyColor)||void 0===o?void 0:o.S(B))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"gE",get:(B,E,v)=>h(B,E,v).subSurface.tintColor,getTarget:h,set:(B,E,v,z)=>h(E,v,z).subSurface.tintColor.S(B)},attenuationDistance:{type:"number",get:(B,E,v)=>h(B,E,v).subSurface.tintColorAtDistance,getTarget:h,set:(B,E,v,z)=>h(E,v,z).subSurface.tintColorAtDistance=B},thicknessFactor:{type:"number",get:(B,E,v)=>h(B,E,v).subSurface.maximumThickness,getTarget:h,set:(B,E,v,z)=>h(E,v,z).subSurface.maximumThickness=B},thicknessTexture:{extensions:{KHR_texture_transform:y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonLight)),getPropertyName:[B=>"length"]},__array__:{__target__:!0,color:{type:"gE",get:B=>{var E;return null===(E=B._babylonLight)||void 0===E?void 0:E.Xc},set:(B,E)=>{var v;return null===(v=E._babylonLight)||void 0===v?void 0:v.Xc.S(B)},getTarget:B=>B._babylonLight,getPropertyName:[B=>"diffuse"]},Nc:{type:"number",get:B=>{var E;return null===(E=B._babylonLight)||void 0===E?void 0:E.Nc},set:(B,E)=>E._babylonLight?E._babylonLight.Nc=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"intensity"]},range:{type:"number",get:B=>{var E;return null===(E=B._babylonLight)||void 0===E?void 0:E.range},set:(B,E)=>E._babylonLight?E._babylonLight.range=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"range"]},spot:{innerConeAngle:{type:"number",get:B=>{var E;return null===(E=B._babylonLight)||void 0===E?void 0:E.innerAngle},set:(B,E)=>E._babylonLight?E._babylonLight.innerAngle=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"innerConeAngle"]},outerConeAngle:{type:"number",get:B=>{var E;return null===(E=B._babylonLight)||void 0===E?void 0:E.angle},set:(B,E)=>E._babylonLight?E._babylonLight.angle=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonLight)),getPropertyName:[B=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonTexture)),getPropertyName:[B=>"length"]},__array__:{__target__:!0,Nc:{type:"number",get:B=>{var E;return null===(E=B._babylonTexture)||void 0===E?void 0:E.level},set:(B,E)=>{E._babylonTexture&&(E._babylonTexture.level=B)},getTarget:B=>B._babylonTexture},rotation:{type:"Quaternion",get:B=>{var E;return B._babylonTexture&&z.Quaternion.FromRotationMatrix(null===(E=B._babylonTexture)||void 0===E?void 0:E.getReflectionTextureMatrix())},set:(B,E)=>{var v;E._babylonTexture&&(null!==(v=E._babylonTexture.rB())&&void 0!==v&&v.useRightHandedSystem||(B=z.Quaternion.Inverse(B)),z.Matrix.FromQuaternionToRef(B,E._babylonTexture.getReflectionTextureMatrix()))},getTarget:B=>B._babylonTexture}}}}},animations:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>{var E;return null===(E=B.primitives[0]._instanceData)||void 0===E?void 0:E.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function P(B){return new x(B,Q)}function G(B){const E=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let v=Q;for(const z of E)z&&(v=v[z]);if(v&&v.type&&v.get)return v}function Y(B,E){const v=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let z=Q;for(const o of v)o&&(z=z[o]);z&&z.type&&z.get&&(z.interpolation=E)}function a(B,E){const v=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let z=Q;for(const o of v)if(o){if(!z[o]){if("?"===o){z.__ignoreObjectTree__=!0;continue}z[o]={},"__array__"===o&&(z[o].__target__=!0)}z=z[o]}Object.assign(z,E)}},13049:(B,E,v)=>{"use strict";v.r(E),v.d(E,{AnimationPropertyInfo:()=>D,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>y,getQuaternion:()=>S,getVector3:()=>c,getWeights:()=>x});var z=v(11908),o=v(11380),q=v(13034);function c(B,E,v,z){return o.GE.VE(E,v).scaleInPlace(z)}function S(B,E,v,z){return o.Quaternion.VE(E,v).scaleInPlace(z)}function x(B,E,v,z){const o=new Array(B._numMorphTargets);for(let q=0;q<o.length;q++)o[q]=E[v++]*z;return o}class D{constructor(B,E,v,z){this.type=B,this.name=E,this.getValue=v,this.getStride=z}_buildAnimation(B,E,v){const o=new z.c(B,this.name,E,this.type);return o.setKeys(v),o}}class h extends D{buildAnimations(B,E,v,z){const o=[];return o.push({babylonAnimatable:B._babylonTransformNode,babylonAnimation:this._buildAnimation(E,v,z)}),o}}class y extends D{buildAnimations(B,E,v,o){const q=[];if(B._numMorphTargets)for(let c=0;c<B._numMorphTargets;c++){const S=new z.c(`${E}_${c}`,this.name,v,this.type);if(S.setKeys(o.map((B=>({frame:B.frame,inTangent:B.inTangent?B.inTangent[c]:void 0,value:B.value[c],outTangent:B.outTangent?B.outTangent[c]:void 0,interpolation:B.interpolation})))),B._primitiveBabylonMeshes)for(const E of B._primitiveBabylonMeshes)if(E.morphTargetManager){const B=E.morphTargetManager.getTarget(c),v=S.clone();B.animations.push(v),q.push({babylonAnimatable:B,babylonAnimation:v})}}return q}}(0,q.l)("/nodes/{}/translation",[new h(z.c.ANIMATIONTYPE_VECTOR3,"position",c,(()=>3))]),(0,q.l)("/nodes/{}/rotation",[new h(z.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",S,(()=>4))]),(0,q.l)("/nodes/{}/scale",[new h(z.c.ANIMATIONTYPE_VECTOR3,"ac",c,(()=>3))]),(0,q.l)("/nodes/{}/weights",[new y(z.c.ANIMATIONTYPE_FLOAT,"influence",x,(B=>B._numMorphTargets))])},13001:(B,E,v)=>{"use strict";class z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((B,E)=>{this._resolve=B,this._reject=E}))}}var o=v(11380),q=v(11417),c=v(11193),S=v(11841),x=v(13009),D=v(13020),h=v(11202),y=v(11863),Q=v(11908),P=v(11913),G=v(11242),Y=v(11213),a=v(11222);class m{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(B){this._useTextureToStoreBoneMatrices=B,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(B){this._animationPropertiesOverride=B}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(B,E,v){this.name=B,this.id=E,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=o.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new h.e,this.bones=[],this._scene=v||G.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const z=this._scene.getEngine().getCaps();this._canUseTextureForBones=z.textureFloat&&z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((B=>!B.getParent()))}getTransformMatrices(B){if(this.needInitialSkinMatrix){if(!B)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return B._bonesTransformMatrices||this.prepare(!0),B._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(B){return this.needInitialSkinMatrix&&B._transformMatrixTexture?B._transformMatrixTexture:this._transformMatrixTexture}rB(){return this._scene}toString(B){let E=`Name: ${this.name}, nBones: ${this.bones.length}`;if(E+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,B){E+=", Ranges: {";let B=!0;for(const v in this._ranges)B&&(E+=", ",B=!1),E+=v;E+="}"}return E}getBoneIndexByName(B){for(let E=0,v=this.bones.length;E<v;E++)if(this.bones[E].name===B)return E;return-1}createAnimationRange(B,E,v){if(!this._ranges[B]){this._ranges[B]=new P.d(B,E,v);for(let z=0,o=this.bones.length;z<o;z++)this.bones[z].animations[0]&&this.bones[z].animations[0].createRange(B,E,v)}}deleteAnimationRange(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let v=0,z=this.bones.length;v<z;v++)this.bones[v].animations[0]&&this.bones[v].animations[0].deleteRange(B,E);this._ranges[B]=null}getAnimationRange(B){return this._ranges[B]||null}getAnimationRanges(){const B=[];let E;for(E in this._ranges)B.push(this._ranges[E]);return B}copyAnimationRange(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[E]||!B.getAnimationRange(E))return!1;let z=!0;const o=this._getHighestAnimationFrame()+1,q={},c=B.bones;let S,x;for(x=0,S=c.length;x<S;x++)q[c[x].name]=c[x];this.bones.length!==c.length&&(Y.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${c.length}`),z=!1);const D=v&&this.dimensionsAtRest&&B.dimensionsAtRest?this.dimensionsAtRest.divide(B.dimensionsAtRest):null;for(x=0,S=this.bones.length;x<S;x++){const B=this.bones[x].name,c=q[B];c?z=z&&this.bones[x].copyAnimationRange(c,E,o,v,D):(Y.c.Warn("copyAnimationRange: not same rig, missing source bone "+B),z=!1)}const h=B.getAnimationRange(E);return h&&(this._ranges[E]=new P.d(E,h.from+o,h.to+o)),z}returnToRest(){for(const B of this.bones)-1!==B._index&&B.returnToRest()}_getHighestAnimationFrame(){let B=0;for(let E=0,v=this.bones.length;E<v;E++)if(this.bones[E].animations[0]){const v=this.bones[E].animations[0].getHighestFrame();B<v&&(B=v)}return B}beginAnimation(B,E,v,z){const o=this.getAnimationRange(B);return o?this._scene.beginAnimation(this,o.from,o.to,E,v,z):null}static MakeAnimationAdditive(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;const z=B.getAnimationRange(v);if(!z)return null;const o=B._scene.getAllAnimatablesByTarget(B);let q=null;for(let S=0;S<o.length;S++){const B=o[S];if(B.fromFrame===(null===z||void 0===z?void 0:z.from)&&B.toFrame===(null===z||void 0===z?void 0:z.to)){q=B;break}}const c=B.getAnimatables();for(let S=0;S<c.length;S++){const B=c[S].animations;if(B)for(let z=0;z<B.length;z++)Q.c.MakeAnimationAdditive(B[z],E,v)}return q&&(q.isAdditive=!0),B}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(B){this._meshesWithPoseMatrix.push(B)}_unregisterMeshWithPoseMatrix(B){const E=this._meshesWithPoseMatrix.indexOf(B);E>-1&&this._meshesWithPoseMatrix.splice(E,1)}_computeTransformMatrices(B,E){this.onBeforeComputeObservable.notifyObservers(this);for(let v=0;v<this.bones.length;v++){const z=this.bones[v];z._childUpdateId++;const o=z.getParent();if(o?z.getLocalMatrix().multiplyToRef(o.getFinalMatrix(),z.getFinalMatrix()):E?z.getLocalMatrix().multiplyToRef(E,z.getFinalMatrix()):z.getFinalMatrix().S(z.getLocalMatrix()),-1!==z._index){const E=null===z._index?v:z._index;z.getAbsoluteInverseBindMatrix().multiplyToArray(z.getFinalMatrix(),B,16*E)}}this._identity.copyToArray(B,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const B=this.rB().getRenderId();if(this._currentRenderId===B)return;this._currentRenderId=B}if(this._numBonesWithLinkedTransformNode>0)for(const B of this.bones)if(B._linkedTransformNode){const E=B._linkedTransformNode;B.position=E.position,E.rotationQuaternion?B.rotationQuaternion=E.rotationQuaternion:B.rotation=E.rotation,B.ac=E.ac}if(this.needInitialSkinMatrix)for(const B of this._meshesWithPoseMatrix){const E=B.getPoseMatrix();let v=this._isDirty;if(B._bonesTransformMatrices&&B._bonesTransformMatrices.length===16*(this.bones.length+1)||(B._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),v=!0),v){if(this._synchronizedWithMesh!==B){this._synchronizedWithMesh=B;for(const B of this.bones)if(!B.getParent()){B.getBindMatrix().multiplyToRef(E,o.TmpVectors.Matrix[1]),B._updateAbsoluteBindMatrices(o.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const E=4*(this.bones.length+1);B._transformMatrixTexture&&B._transformMatrixTexture.getSize().width===E||(B._transformMatrixTexture&&B._transformMatrixTexture.dispose(),B._transformMatrixTexture=y.d.CreateRGBATexture(B._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(B._bonesTransformMatrices,E),this.isUsingTextureForMatrices&&B._transformMatrixTexture&&B._transformMatrixTexture.update(B._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=y.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let B=0;B<this.bones.length;B++)this._animatables.push(this.bones[B])}return this._animatables}clone(B,E){const v=new m(B,E||B,this._scene);v.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let z=0;z<this.bones.length;z++){const B=this.bones[z];let E=null;const o=B.getParent();if(o){const B=this.bones.indexOf(o);E=v.bones[B]}const q=new D.b(B.name,v,E,B.getBindMatrix().clone(),B.getRestMatrix().clone());q._index=B._index,B._linkedTransformNode&&q.linkTransformNode(B._linkedTransformNode),a.d.DeepCopy(B.animations,q.animations)}if(this._ranges){v._ranges={};for(const B in this._ranges){const E=this._ranges[B];E&&(v._ranges[B]=E.clone())}}return this._isDirty=!0,v.prepare(!0),v}enableBlending(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const E of this.bones)for(const v of E.animations)v.enableBlending=!0,v.blendingSpeed=B}dispose(){if(this._meshesWithPoseMatrix.length=0,this.rB().stopAnimation(this),this.rB().removeSkeleton(this),this._parentContainer){const B=this._parentContainer.skeletons.indexOf(this);B>-1&&this._parentContainer.skeletons.splice(B,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const B={};B.name=this.name,B.id=this.id,this.dimensionsAtRest&&(B.dimensionsAtRest=this.dimensionsAtRest.cc()),B.bones=[],B.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let v=0;v<this.bones.length;v++){var E;const z=this.bones[v],o=z.getParent(),q={parentBoneIndex:o?this.bones.indexOf(o):-1,index:z.getIndex(),name:z.name,id:z.id,matrix:z.getBindMatrix().cc(),rest:z.getRestMatrix().cc(),linkedTransformNodeId:null===(E=z.getTransformNode())||void 0===E?void 0:E.id};B.bones.push(q),z.length&&(q.length=z.length),z.metadata&&(q.metadata=z.metadata),z.animations&&z.animations.length>0&&(q.animation=z.animations[0].serialize()),B.ranges=[];for(const E in this._ranges){const v=this._ranges[E];if(!v)continue;const z={};z.name=E,z.from=v.from,z.to=v.to,B.ranges.push(z)}}return B}static Parse(B,E){const v=new m(B.name,B.id,E);let z;for(B.dimensionsAtRest&&(v.dimensionsAtRest=o.GE.VE(B.dimensionsAtRest)),v.needInitialSkinMatrix=B.needInitialSkinMatrix,z=0;z<B.bones.length;z++){const E=B.bones[z],q=B.bones[z].index;let c=null;E.parentBoneIndex>-1&&(c=v.bones[E.parentBoneIndex]);const S=E.rest?o.Matrix.VE(E.rest):null,x=new D.b(E.name,v,c,o.Matrix.VE(E.matrix),S,null,q);void 0!==E.id&&null!==E.id&&(x.id=E.id),E.length&&(x.length=E.length),E.metadata&&(x.metadata=E.metadata),E.animation&&x.animations.push(Q.c.Parse(E.animation)),void 0!==E.linkedTransformNodeId&&null!==E.linkedTransformNodeId&&(v._hasWaitingData=!0,x._waitingTransformNodeId=E.linkedTransformNodeId)}if(B.ranges)for(z=0;z<B.ranges.length;z++){const E=B.ranges[z];v.createAnimationRange(E.name,E.from,E.to)}return v}computeAbsoluteMatrices(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||B)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(B)}getPoseMatrix(){let B=null;return this._meshesWithPoseMatrix.length>0&&(B=this._meshesWithPoseMatrix[0].getPoseMatrix()),B}sortBones(){const B=[],E=new Array(this.bones.length);for(let v=0;v<this.bones.length;v++)this._sortBones(v,B,E);this.bones=B}_sortBones(B,E,v){if(v[B])return;v[B]=!0;const z=this.bones[B];if(!z)return;void 0===z._index&&(z._index=B);const o=z.getParent();o&&this._sortBones(this.bones.indexOf(o),E,v),E.push(z)}setCurrentPoseAsRest(){for(const B of this.bones)B.setCurrentPoseAsRest()}}var g=v(11706),V=v(11874),T=v(11361),N=v(11802),X=v(11442),r=v(11848),i=v(11815),u=v(11833),I=v(11917),K=v(11460),C=v(12966);class f{set areUpdatesFrozen(B){B?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new K.c(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,B||(B=G.b.LastCreatedScene),this._scene=B,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const B=this._scene.getEngine().getCaps();this._canUseTextureForTargets=B.canUseGLVertexID&&B.textureFloat&&B.maxVertexTextureImageUnits>0&&B.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return f.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?f.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(B){this._numMaxInfluencers!==B&&(this._numMaxInfluencers=B,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(B){this._useTextureToStoreTargets!==B&&(this._useTextureToStoreTargets=B,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var B;return f.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(B=this._scene)&&void 0!==B&&B.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(B){return this._activeTargets.data[B]}getTarget(B){return this._targets[B]}getTargetByName(B){for(const E of this._targets)if(E.name===B)return E;return null}addTarget(B){this._targets.push(B),this._targetInfluenceChangedObservers.push(B.onInfluenceChanged.add((B=>{this.areUpdatesFrozen&&B&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(B)}))),this._targetDataLayoutChangedObservers.push(B._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(B){const E=this._targets.indexOf(B);E>=0&&(this._targets.splice(E,1),B.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(E,1)[0]),B._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(E,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(B)}_bind(B){B.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),B.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),B.setTexture("morphTargets",this._targetStoreTexture),B.setInt("morphTargetCount",this.numInfluencers)}clone(){const B=new f(this._scene);for(const E of this._targets)B.addTarget(E.clone());return B.enablePositionMorphing=this.enablePositionMorphing,B.enableNormalMorphing=this.enableNormalMorphing,B.enableTangentMorphing=this.enableTangentMorphing,B.enableUVMorphing=this.enableUVMorphing,B.enableUV2Morphing=this.enableUV2Morphing,B.enableColorMorphing=this.enableColorMorphing,B}serialize(){const B={};B.id=this.uniqueId,B.targets=[];for(const E of this._targets)B.targets.push(E.serialize());return B}_syncActiveTargets(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const E=!!this._targetStoreTexture,v=this.isUsingTextureForTargets;(this._mustSynchronize||E!==v)&&(this._mustSynchronize=!1,this.synchronize());let z=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let o=-1;for(const q of this._targets)if(o++,0!==q.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=f.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(q),this._morphTargetTextureIndices[z]=o,this._tempInfluences[z++]=q.influence}this._morphTargetTextureIndices.length!==z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,z)),this._influences&&this._influences.length===z||(this._influences=new Float32Array(z));for(let q=0;q<z;q++)this._influences[q]=this._tempInfluences[q];if(B&&this._scene)for(const q of this._scene.meshes)q.morphTargetManager===this&&(v?q._markSubMeshesAsAttributesDirty():q._syncGeometryWithMorphTargetManager())}synchronize(){var B;if(!this._scene||this.areUpdatesFrozen)return;const E=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(B=this._targetStoreTexture)||void 0===B||B.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>E.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const v of this._targets){this._supportsPositions=this._supportsPositions&&v.hasPositions,this._supportsNormals=this._supportsNormals&&v.hasNormals,this._supportsTangents=this._supportsTangents&&v.hasTangents,this._supportsUVs=this._supportsUVs&&v.hasUVs,this._supportsUV2s=this._supportsUV2s&&v.hasUV2s,this._supportsColors=this._supportsColors&&v.hasColors;const B=v.vertexCount;if(0===this._vertexCount)this._vertexCount=B;else if(this._vertexCount!==B)return void Y.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${v.name}": ${B}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const B=E.getCaps().maxTextureSize;this._textureWidth>B&&(this._textureHeight=Math.ceil(this._textureWidth/B),this._textureWidth=B);const v=this._targets.length,z=new Float32Array(v*this._textureWidth*this._textureHeight*4);let o=0;for(let E=0;E<v;E++){const B=this._targets[E],v=B.getPositions(),q=B.getNormals(),c=B.getUVs(),S=B.getTangents(),x=B.getUV2s(),D=B.getColors();o=E*this._textureWidth*this._textureHeight*4;for(let E=0;E<this._vertexCount;E++)this._supportsPositions&&v&&(z[o]=v[3*E],z[o+1]=v[3*E+1],z[o+2]=v[3*E+2],o+=4),this._supportsNormals&&q&&(z[o]=q[3*E],z[o+1]=q[3*E+1],z[o+2]=q[3*E+2],o+=4),this._supportsUVs&&c&&(z[o]=c[2*E],z[o+1]=c[2*E+1],o+=4),this._supportsTangents&&S&&(z[o]=S[3*E],z[o+1]=S[3*E+1],z[o+2]=S[3*E+2],o+=4),this._supportsUV2s&&x&&(z[o]=x[2*E],z[o+1]=x[2*E+1],o+=4),this._supportsColors&&D&&(z[o]=D[4*E],z[o+1]=D[4*E+1],z[o+2]=D[4*E+2],z[o+3]=D[4*E+3],o+=4)}this._targetStoreTexture=C.b.CreateRGBATexture(z,this._textureWidth,this._textureHeight,v,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const v of this._scene.meshes)v.morphTargetManager===this&&v._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const B=this._parentContainer.morphTargetManagers.indexOf(this);B>-1&&this._parentContainer.morphTargetManagers.splice(B,1),this._parentContainer=null}for(const B of this._targets)this._scene.stopAnimation(B)}}static Parse(B,E){const v=new f(E);for(const z of B.targets)v.addTarget(I.d.Parse(z,E));return v}}f.EnableTextureStorage=!0,f.MaxActiveMorphTargetsInVertexAttributeMode=8,f.ConstantTargetCountForTextureMode=0;var A=v(13026),l=v(11249),d=v(11722);const t=new Map,p=t;function H(B,E,v){j(B)&&Y.c.Warn(`Extension with the name '${B}' already exists`),t.set(B,{isGLTFExtension:E,factory:v})}function j(B){return t.delete(B)}var R=v(13034),b=v(11989),F=v(11453);class W{static Get(B,E,v){if(!E||void 0==v||!E[v])throw new Error(`${B}: Failed to find index (${v})`);return E[v]}static TryGet(B,E){return B&&void 0!=E&&B[E]?B[E]:null}static Assign(B){if(B)for(let E=0;E<B.length;E++)B[E].index=E}}function w(B){if(B.min&&B.max){const E=B.min,v=B.max,z=o.TmpVectors.GE[0].Yc(E[0],E[1],E[2]),q=o.TmpVectors.GE[1].Yc(v[0],v[1],v[2]);if(B.normalized&&5126!==B.componentType){let E=1;switch(B.componentType){case 5120:E=127;break;case 5121:E=255;break;case 5122:E=32767;break;case 5123:E=65535}const v=1/E;z.scaleInPlace(v),q.scaleInPlace(v)}return new d.c(z,q)}return null}class n{static RegisterExtension(B,E){H(B,!1,E)}static UnregisterExtension(B){return j(B)}get vc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(B){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=B}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((B=>B.dispose&&B.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(B,E,v,z,o,q){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=E,this._assetContainer=v,this._loadData(z);let q=null;if(B){const E={};if(this._gltf.nodes)for(const B of this._gltf.nodes)B.name&&(E[B.name]=B.index);q=(B instanceof Array?B:[B]).map((B=>{const v=E[B];if(void 0===v)throw new Error(`Failed to find node '${B}'`);return v}))}return await this._loadAsync(o,c,q,(()=>({meshes:this._getMeshes(),bQ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=B,this._loadData(E),await this._loadAsync(v,o,null,(()=>{}))}async _loadAsync(B,E,v,z){return await Promise.resolve().then((async()=>{this._rootUrl=B,this._uniqueRootUrl=!B.startsWith("file:")&&E?B:`${B}${Date.now()}/`,this._fileName=E,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const o=`${A.l[A.l.LOADING]} => ${A.l[A.l.READY]}`,q=`${A.l[A.l.LOADING]} => ${A.l[A.l.COMPLETE]}`;this._parent._startPerformanceCounter(o),this._parent._startPerformanceCounter(q),this._parent._setState(A.l.LOADING),this._extensionsOnLoading();const S=new Array;if(!this.parent.loadOnlyMaterials)if(v)S.push(this.loadSceneAsync("/nodes",{nodes:v,index:-1}));else if(void 0!=this._gltf.aE||this._gltf.scenes&&this._gltf.scenes[0]){const B=W.Get("/scene",this._gltf.scenes,this._gltf.aE||0);S.push(this.loadSceneAsync(`/scenes/${B.index}`,B))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let B=0;B<this._gltf.materials.length;++B){const E=this._gltf.materials[B],v="/materials/"+B,z=g.c.TriangleFillMode;S.push(this._loadMaterialAsync(v,E,null,z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&S.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&S.push(this._compileShadowGeneratorsAsync());const x=Promise.all(S).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ox(!0);for(const B of this._babylonScene.materials){const E=B;void 0!==E.maxSimultaneousLights&&(E.maxSimultaneousLights=Math.max(E.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(A.l.READY),this._skipStartAnimationStep||this._startAnimations(),z()}));return await x.then((B=>(this._parent._endPerformanceCounter(o),c.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(q),this._parent._setState(A.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(B=>{this._parent.onErrorObservable.notifyObservers(B),this._parent.onErrorObservable.clear(),this.dispose()}))})),B)))})).catch((B=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(B),this._parent.onErrorObservable.clear(),this.dispose()),B}))}_loadData(B){if(this._gltf=B.json,this._setupData(),B.bin){const E=this._gltf.buffers;if(E&&E[0]&&!E[0].uri){const v=E[0];(v.byteLength<B.bin.byteLength-3||v.byteLength>B.bin.byteLength)&&Y.c.Warn(`Binary buffer length (${v.byteLength}) from JSON does not match chunk length (${B.bin.byteLength})`),this._bin=B.bin}else Y.c.Warn("Unexpected BIN chunk")}}_setupData(){if(W.Assign(this._gltf.accessors),W.Assign(this._gltf.animations),W.Assign(this._gltf.buffers),W.Assign(this._gltf.bufferViews),W.Assign(this._gltf.cameras),W.Assign(this._gltf.images),W.Assign(this._gltf.materials),W.Assign(this._gltf.meshes),W.Assign(this._gltf.nodes),W.Assign(this._gltf.samplers),W.Assign(this._gltf.scenes),W.Assign(this._gltf.skins),W.Assign(this._gltf.textures),this._gltf.nodes){const B={};for(const v of this._gltf.nodes)if(v.children)for(const E of v.children)B[E]=v.index;const E=this._createRootNode();for(const v of this._gltf.nodes){const z=B[v.index];v.parent=void 0===z?E:this._gltf.nodes[z]}}}async _loadExtensionsAsync(){const B=[];if(p.forEach(((E,v)=>{var z;!1===(null===(z=this.parent.extensionOptions[v])||void 0===z?void 0:z.enabled)?E.isGLTFExtension&&this.isExtensionUsed(v)&&Y.c.Warn(`Extension ${v} is used but has been explicitly disabled.`):E.isGLTFExtension&&!this.isExtensionUsed(v)||B.push((async()=>{const B=await E.factory(this);return B.name!==v&&Y.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${B.name} !== ${v}`),this._parent.onExtensionLoadedObservable.notifyObservers(B),B})())})),this._extensions.push(...await Promise.all(B)),this._extensions.sort(((B,E)=>(B.order||Number.MAX_VALUE)-(E.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const v of this._gltf.extensionsRequired){if(!this._extensions.some((B=>B.name===v&&B.enabled))){var E;if(!1===(null===(E=this.parent.extensionOptions[v])||void 0===E?void 0:E.enabled))throw new Error(`Required extension ${v} is disabled`);throw new Error(`Required extension ${v} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new u.e("__root__",this._babylonScene);this._rootBabylonMesh=B,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ox(!1);const E={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.h.AUTO:this._babylonScene.useRightHandedSystem||(E.rotation=[0,1,0,0],E.scale=[1,1,-1],n._LoadTransform(E,this._rootBabylonMesh));break;case A.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(B),E}loadSceneAsync(B,E){const v=this._extensionsLoadSceneAsync(B,E);if(v)return v;const z=new Array;if(this.logOpen(`${B} ${E.name||""}`),E.nodes)for(const o of E.nodes){const E=W.Get(`${B}/nodes/${o}`,this._gltf.nodes,o);z.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(B=>{B.parent=this._rootBabylonMesh})))}for(const o of this._postSceneLoadActions)o();return z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(z).then((()=>{}))}_forEachPrimitive(B,E){if(B._primitiveBabylonMeshes)for(const v of B._primitiveBabylonMeshes)E(v)}_getGeometries(){const B=[],E=this._gltf.nodes;if(E)for(const v of E)this._forEachPrimitive(v,(E=>{const v=E.Qc;v&&-1===B.indexOf(v)&&B.push(v)}));return B}_getMeshes(){const B=[];this._rootBabylonMesh instanceof i.e&&B.push(this._rootBabylonMesh);const E=this._gltf.nodes;if(E)for(const v of E)this._forEachPrimitive(v,(E=>{B.push(E)}));return B}_getTransformNodes(){const B=[],E=this._gltf.nodes;if(E)for(const v of E)v._babylonTransformNode&&"Kc"===v._babylonTransformNode.getClassName()&&B.push(v._babylonTransformNode),v._babylonTransformNodeForSkin&&B.push(v._babylonTransformNodeForSkin);return B}_getSkeletons(){const B=[],E=this._gltf.skins;if(E)for(const v of E)v._data&&B.push(v._data.babylonSkeleton);return B}_getAnimationGroups(){const B=[],E=this._gltf.animations;if(E)for(const v of E)v._babylonAnimationGroup&&B.push(v._babylonAnimationGroup);return B}_startAnimations(){switch(this._parent.animationStartMode){case A.f.NONE:break;case A.f.FIRST:{const B=this._getAnimationGroups();0!==B.length&&B[0].start(!0);break}case A.f.ALL:{const B=this._getAnimationGroups();for(const E of B)E.start(!0);break}default:return void Y.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadNodeAsync(B,E,v);if(z)return z;if(E._babylonTransformNode)throw new Error(`${B}: Invalid recursive node hierarchy`);const o=new Array;this.logOpen(`${B} ${E.name||""}`);const q=z=>{if(n.AddPointerMetadata(z,B),n._LoadTransform(E,z),void 0!=E.camera){const v=W.Get(`${B}/camera`,this._gltf.cameras,E.camera);o.push(this.loadCameraAsync(`/cameras/${v.index}`,v,(B=>{B.parent=z,this._babylonScene.useRightHandedSystem||(z.ac.x=-1)})))}if(E.children)for(const v of E.children){const E=W.Get(`${B}/children/${v}`,this._gltf.nodes,v);o.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(B=>{B.parent=z})))}v(z)},c=void 0!=E.mesh,S=this._parent.loadSkins&&void 0!=E.skin;if(!c||S){const B=E.name||`node${E.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new N.e(B,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==E.mesh?E._babylonTransformNode=v:E._babylonTransformNodeForSkin=v,q(v)}if(c)if(S){const v=W.Get(`${B}/mesh`,this._gltf.meshes,E.mesh);o.push(this._loadMeshAsync(`/meshes/${v.index}`,E,v,(v=>{const z=E._babylonTransformNodeForSkin;v.metadata=(0,b.b)(z.metadata,v.metadata||{});const q=W.Get(`${B}/skin`,this._gltf.skins,E.skin);o.push(this._loadSkinAsync(`/skins/${q.index}`,E,q,(B=>{this._forEachPrimitive(E,(E=>{E.skeleton=B})),this._postSceneLoadActions.push((()=>{if(void 0!=q.skeleton){const B=W.Get(`/skins/${q.index}/skeleton`,this._gltf.nodes,q.skeleton).parent;E.index===B.index?v.parent=z.parent:v.parent=B._babylonTransformNode}else v.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:z,skinnedNode:v})}))})))})))}else{const v=W.Get(`${B}/mesh`,this._gltf.meshes,E.mesh);o.push(this._loadMeshAsync(`/meshes/${v.index}`,E,v,q))}return this.logClose(),Promise.all(o).then((()=>(this._forEachPrimitive(E,(B=>{const E=B;!E.isAnInstance&&E.Qc&&E.Qc.useBoundingInfoFromGeometry?B.dB():B.refreshBoundingInfo(!0,!0)})),E._babylonTransformNode)))}_loadMeshAsync(B,E,v,z){const o=v.primitives;if(!o||!o.length)throw new Error(`${B}: Primitives are missing`);void 0==o[0].index&&W.Assign(o);const q=new Array;this.logOpen(`${B} ${v.name||""}`);const c=E.name||`node${E.index}`;if(1===o.length){const z=v.primitives[0];q.push(this._loadMeshPrimitiveAsync(`${B}/primitives/${z.index}`,c,E,v,z,(B=>{E._babylonTransformNode=B,E._primitiveBabylonMeshes=[B]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,E._babylonTransformNode=new N.e(c,this._babylonScene),E._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._primitiveBabylonMeshes=[];for(const z of o)q.push(this._loadMeshPrimitiveAsync(`${B}/primitives/${z.index}`,`${c}_primitive${z.index}`,E,v,z,(B=>{B.parent=E._babylonTransformNode,E._primitiveBabylonMeshes.push(B)})))}return z(E._babylonTransformNode),this.logClose(),Promise.all(q).then((()=>E._babylonTransformNode))}_loadMeshPrimitiveAsync(B,E,v,z,o,q){const c=this._extensionsLoadMeshPrimitiveAsync(B,E,v,z,o,q);if(c)return c;this.logOpen(`${B}`);const S=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==v.skin&&!z.primitives[0].targets;let x,D;if(S&&o._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,x=o._instanceData.babylonSourceMesh.createInstance(E),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D=o._instanceData.promise;else{const q=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new u.e(E,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.sideOrientation=this._babylonScene.useRightHandedSystem?g.c.CounterClockWiseSideOrientation:g.c.ClockWiseSideOrientation,this._createMorphTargets(B,v,z,o,c),q.push(this._loadVertexDataAsync(B,o,c).then((async E=>await this._loadMorphTargetsAsync(B,o,c,E).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,E.AB(c),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=n._GetDrawMode(B,o.mode);if(void 0==o.material){let B=this._defaultBabylonMaterialData[h];B||(B=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(B),this._defaultBabylonMaterialData[h]=B),c.material=B}else if(!this.parent.skipMaterials){const E=W.Get(`${B}/material`,this._gltf.materials,o.material);q.push(this._loadMaterialAsync(`/materials/${E.index}`,E,c,h,(B=>{c.material=B})))}D=Promise.all(q),S&&(o._instanceData={babylonSourceMesh:c,promise:D}),x=c}return n.AddPointerMetadata(x,B),this._parent.onMeshLoadedObservable.notifyObservers(x),q(x),this.logClose(),D.then((()=>x))}_loadVertexDataAsync(B,E,v){const z=this._extensionsLoadVertexDataAsync(B,E,v);if(z)return z;const o=E.attributes;if(!o)throw new Error(`${B}: Attributes are missing`);const q=new Array,c=new r.b(v.name,this._babylonScene);if(void 0==E.indices)v.isUnIndexed=!0;else{const v=W.Get(`${B}/indices`,this._gltf.accessors,E.indices);q.push(this._loadIndicesAccessorAsync(`/accessors/${v.index}`,v).then((B=>{c.setIndices(B)})))}const S=(E,z,S)=>{if(void 0==o[E])return;v._delayInfo=v._delayInfo||[],-1===v._delayInfo.indexOf(z)&&v._delayInfo.push(z);const x=W.Get(`${B}/attributes/${E}`,this._gltf.accessors,o[E]);q.push(this._loadVertexAccessorAsync(`/accessors/${x.index}`,x,z).then((B=>{if(B.getKind()===X.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!v.skeleton){const B=w(x);B&&(c._boundingInfo=B,c.useBoundingInfoFromGeometry=!0)}c.setVerticesBuffer(B,x.count)}))),z==X.e.MatricesIndicesExtraKind&&(v.numBoneInfluencers=8),S&&S(x)};return S("POSITION",X.e.PositionKind),S("NORMAL",X.e.NormalKind),S("TANGENT",X.e.TangentKind),S("TEXCOORD_0",X.e.UVKind),S("TEXCOORD_1",X.e.UV2Kind),S("TEXCOORD_2",X.e.UV3Kind),S("TEXCOORD_3",X.e.UV4Kind),S("TEXCOORD_4",X.e.UV5Kind),S("TEXCOORD_5",X.e.UV6Kind),S("JOINTS_0",X.e.MatricesIndicesKind),S("WEIGHTS_0",X.e.MatricesWeightsKind),S("JOINTS_1",X.e.MatricesIndicesExtraKind),S("WEIGHTS_1",X.e.MatricesWeightsExtraKind),S("COLOR_0",X.e.ColorKind,(B=>{"VEC4"===B.type&&(v.hasVertexAlpha=!0)})),Promise.all(q).then((()=>c))}_createMorphTargets(B,E,v,z,o){if(!z.targets||!this._parent.loadMorphTargets)return;if(void 0==E._numMorphTargets)E._numMorphTargets=z.targets.length;else if(z.targets.length!==E._numMorphTargets)throw new Error(`${B}: Primitives do not have the same number of targets`);const q=v.extras?v.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,o.morphTargetManager=new f(this._babylonScene),o.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.morphTargetManager.areUpdatesFrozen=!0;for(let c=0;c<z.targets.length;c++){const B=E.weights?E.weights[c]:v.weights?v.weights[c]:0,z=q?q[c]:`morphTarget${c}`;o.morphTargetManager.addTarget(new I.d(z,B,o.rB()))}}_loadMorphTargetsAsync(B,E,v,z){if(!E.targets||!this._parent.loadMorphTargets)return Promise.resolve();const o=new Array,q=v.morphTargetManager;for(let c=0;c<q.numTargets;c++){const v=q.getTarget(c);o.push(this._loadMorphTargetVertexDataAsync(`${B}/targets/${c}`,z,E.targets[c],v))}return Promise.all(o).then((()=>{q.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(B,E,v,z){const o=new Array,q=(z,q,c)=>{if(void 0==v[z])return;const S=E.getVertexBuffer(q);if(!S)return;const x=W.Get(`${B}/${z}`,this._gltf.accessors,v[z]);o.push(this._loadFloatAccessorAsync(`/accessors/${x.index}`,x).then((B=>{c(S,B)})))};return q("POSITION",X.e.PositionKind,((B,E)=>{const v=new Float32Array(E.length);B.forEach(E.length,((B,z)=>{v[z]=E[z]+B})),z.setPositions(v)})),q("NORMAL",X.e.NormalKind,((B,E)=>{const v=new Float32Array(E.length);B.forEach(v.length,((B,z)=>{v[z]=E[z]+B})),z.setNormals(v)})),q("TANGENT",X.e.TangentKind,((B,E)=>{const v=new Float32Array(E.length/3*4);let o=0;B.forEach(E.length/3*4,((B,z)=>{(z+1)%4!==0&&(v[o]=E[o]+B,o++)})),z.setTangents(v)})),q("TEXCOORD_0",X.e.UVKind,((B,E)=>{const v=new Float32Array(E.length);B.forEach(E.length,((B,z)=>{v[z]=E[z]+B})),z.setUVs(v)})),q("TEXCOORD_1",X.e.UV2Kind,((B,E)=>{const v=new Float32Array(E.length);B.forEach(E.length,((B,z)=>{v[z]=E[z]+B})),z.setUV2s(v)})),q("COLOR_0",X.e.ColorKind,((E,v)=>{let o=null;const q=E.getSize();if(3===q){o=new Float32Array(v.length/3*4),E.forEach(v.length,((B,E)=>{const z=Math.floor(E/3),q=E%3;o[4*z+q]=v[3*z+q]+B}));for(let B=0;B<v.length/3;++B)o[4*B+3]=1}else{if(4!==q)throw new Error(`${B}: Invalid number of components (${q}) for COLOR_0 attribute`);o=new Float32Array(v.length),E.forEach(v.length,((B,E)=>{o[E]=v[E]+B}))}z.setColors(o)})),await Promise.all(o).then((()=>{}))}static _LoadTransform(B,E){if(void 0!=B.skin)return;let v=o.GE.Zero(),z=o.Quaternion.Identity(),q=o.GE.One();if(B.matrix){o.Matrix.VE(B.matrix).decompose(q,z,v)}else B.translation&&(v=o.GE.VE(B.translation)),B.rotation&&(z=o.Quaternion.VE(B.rotation)),B.scale&&(q=o.GE.VE(B.scale));E.position=v,E.rotationQuaternion=z,E.ac=q}_loadSkinAsync(B,E,v,z){if(!this._parent.loadSkins)return Promise.resolve();const o=this._extensionsLoadSkinAsync(B,E,v);if(o)return o;if(v._data)return z(v._data.babylonSkeleton),v._data.promise;const q=`skeleton${v.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new m(v.name||q,q,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(B,v,c);const S=this._loadSkinInverseBindMatricesDataAsync(B,v).then((B=>{this._updateBoneMatrices(c,B)}));return v._data={babylonSkeleton:c,promise:S},z(c),S}_loadBones(B,E,v){if(void 0==E.skeleton||this._parent.alwaysComputeSkeletonRootNode){const v=this._findSkeletonRootNode(`${B}/joints`,E.joints);if(v)if(void 0===E.skeleton)E.skeleton=v.index;else{const z=(B,E)=>{for(;E.parent;E=E.parent)if(E.parent===B)return!0;return!1},o=W.Get(`${B}/skeleton`,this._gltf.nodes,E.skeleton);o===v||z(o,v)||(Y.c.Warn(`${B}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),E.skeleton=v.index)}else Y.c.Warn(`${B}: Failed to find common root`)}const z={};for(const o of E.joints){const q=W.Get(`${B}/joints/${o}`,this._gltf.nodes,o);this._loadBone(q,E,v,z)}}_findSkeletonRootNode(B,E){if(0===E.length)return null;const v={};for(const o of E){const E=[];let z=W.Get(`${B}/${o}`,this._gltf.nodes,o);for(;-1!==z.index;)E.unshift(z),z=z.parent;v[o]=E}let z=null;for(let o=0;;++o){let B=v[E[0]];if(o>=B.length)return z;const q=B[o];for(let c=1;c<E.length;++c)if(B=v[E[c]],o>=B.length||q!==B[o])return z;z=q}}_loadBone(B,E,v,z){B._isJoint=!0;let o=z[B.index];if(o)return o;let q=null;B.index!==E.skeleton&&(B.parent&&-1!==B.parent.index?q=this._loadBone(B.parent,E,v,z):void 0!==E.skeleton&&Y.c.Warn(`/skins/${E.index}/skeleton: Skeleton node is not a common root`));const c=E.joints.indexOf(B.index);return o=new D.b(B.name||`joint${B.index}`,v,q,this._getNodeMatrix(B),null,null,c),z[B.index]=o,this._postSceneLoadActions.push((()=>{o.linkTransformNode(B._babylonTransformNode)})),o}_loadSkinInverseBindMatricesDataAsync(B,E){if(void 0==E.inverseBindMatrices)return Promise.resolve(null);const v=W.Get(`${B}/inverseBindMatrices`,this._gltf.accessors,E.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${v.index}`,v)}_updateBoneMatrices(B,E){for(const v of B.bones){const B=o.Matrix.Identity(),z=v._index;E&&-1!==z&&(o.Matrix.FromArrayToRef(E,16*z,B),B.invertToRef(B));const q=v.getParent();q&&B.multiplyToRef(q.getAbsoluteInverseBindMatrix(),B),v.hc(B,!1,!1),v._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(B){return B.matrix?o.Matrix.VE(B.matrix):o.Matrix.Compose(B.scale?o.GE.VE(B.scale):o.GE.One(),B.rotation?o.Quaternion.VE(B.rotation):o.Quaternion.Identity(),B.translation?o.GE.VE(B.translation):o.GE.Zero())}loadCameraAsync(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadCameraAsync(B,E,v);if(z)return z;const q=new Array;this.logOpen(`${B} ${E.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new x.b(E.name||`camera${E.index}`,o.GE.Zero(),this._babylonScene,!1);switch(c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonCamera=c,c.setTarget(new o.GE(0,0,-1)),E.type){case"perspective":{const v=E.perspective;if(!v)throw new Error(`${B}: Camera perspective properties are missing`);c.fov=v.yfov,c.xc=v.znear,c.maxZ=v.zfar||0;break}case"orthographic":if(!E.orthographic)throw new Error(`${B}: Camera orthographic properties are missing`);c.mode=S.c.ORTHOGRAPHIC_CAMERA,c.orthoLeft=-E.orthographic.xmag,c.orthoRight=E.orthographic.xmag,c.orthoBottom=-E.orthographic.ymag,c.orthoTop=E.orthographic.ymag,c.xc=E.orthographic.znear,c.maxZ=E.orthographic.zfar;break;default:throw new Error(`${B}: Invalid camera type (${E.type})`)}return n.AddPointerMetadata(c,B),this._parent.onCameraLoadedObservable.notifyObservers(c),v(c),this.logClose(),Promise.all(q).then((()=>c))}_loadAnimationsAsync(){const B=this._gltf.animations;if(!B)return Promise.resolve();const E=new Array;for(let v=0;v<B.length;v++){const z=B[v];E.push(this.loadAnimationAsync(`/animations/${z.index}`,z).then((B=>{0===B.targetedAnimations.length&&B.dispose()})))}return Promise.all(E).then((()=>{}))}loadAnimationAsync(B,E){const z=this._extensionsLoadAnimationAsync(B,E);return z||v.e(78).then(v.bind(v,14509)).then((v=>{let{AnimationGroup:z}=v;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new z(E.name||`animation${E.index}`,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonAnimationGroup=o;const q=new Array;W.Assign(E.channels),W.Assign(E.samplers);for(const c of E.channels)q.push(this._loadAnimationChannelAsync(`${B}/channels/${c.index}`,B,E,c,((B,E)=>{B.animations=B.animations||[],B.animations.push(E),o.addTargetedAnimation(E,B)})));return Promise.all(q).then((()=>(o.normalize(0),o)))}))}async _loadAnimationChannelAsync(B,E,z,o,q){const c=this._extensionsLoadAnimationChannelAsync(B,E,z,o,q);if(c)return await c;if(void 0==o.target.node)return await Promise.resolve();const S=W.Get(`${B}/target/node`,this._gltf.nodes,o.target.node),x=o.target.path,D="weights"===x;if(D&&!S._numMorphTargets||!D&&!S._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!D&&!S._isJoint)return await Promise.resolve();let h;switch(await Promise.resolve().then(v.bind(v,13049)),x){case"translation":var y;h=null===(y=(0,R.g)("/nodes/{}/translation"))||void 0===y?void 0:y.interpolation;break;case"rotation":var Q;h=null===(Q=(0,R.g)("/nodes/{}/rotation"))||void 0===Q?void 0:Q.interpolation;break;case"scale":var P;h=null===(P=(0,R.g)("/nodes/{}/scale"))||void 0===P?void 0:P.interpolation;break;case"weights":var G;h=null===(G=(0,R.g)("/nodes/{}/weights"))||void 0===G?void 0:G.interpolation;break;default:throw new Error(`${B}/target/path: Invalid value (${o.target.path})`)}if(!h)throw new Error(`${B}/target/path: Could not find interpolation properties for target path (${o.target.path})`);const Y={object:S,info:h};return await this._loadAnimationChannelFromTargetInfoAsync(B,E,z,o,Y,q)}_loadAnimationChannelFromTargetInfoAsync(B,E,v,z,o,q){const c=this.parent.targetFps,S=1/c,x=W.Get(`${B}/sampler`,v.samplers,z.sampler);return this._loadAnimationSamplerAsync(`${E}/samplers/${z.sampler}`,x).then((B=>{let E=0;const x=o.object,D=o.info;for(const o of D){const D=o.getStride(x),h=B.input,y=B.output,Q=new Array(h.length);let P=0;switch(B.interpolation){case"STEP":for(let B=0;B<h.length;B++){const E=o.getValue(x,y,P,1);P+=D,Q[B]={frame:h[B]*c,value:E,interpolation:1}}break;case"CUBICSPLINE":for(let B=0;B<h.length;B++){const E=o.getValue(x,y,P,S);P+=D;const v=o.getValue(x,y,P,1);P+=D;const z=o.getValue(x,y,P,S);P+=D,Q[B]={frame:h[B]*c,inTangent:E,value:v,outTangent:z}}break;case"LINEAR":for(let B=0;B<h.length;B++){const E=o.getValue(x,y,P,1);P+=D,Q[B]={frame:h[B]*c,value:E}}}if(P>0){const B=`${v.name||`animation${v.index}`}_channel${z.index}_${E}`,S=o.buildAnimations(x,B,c,Q);for(const v of S)E++,q(v.babylonAnimatable,v.babylonAnimation)}}}))}_loadAnimationSamplerAsync(B,E){if(E._data)return E._data;const v=E.interpolation||"LINEAR";switch(v){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${B}/interpolation: Invalid value (${E.interpolation})`)}const z=W.Get(`${B}/input`,this._gltf.accessors,E.input),o=W.Get(`${B}/output`,this._gltf.accessors,E.output);return E._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${z.index}`,z),this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)]).then((B=>{let[E,z]=B;return{input:E,interpolation:v,output:z}})),E._data}loadBufferAsync(B,E,v,z){const o=this._extensionsLoadBufferAsync(B,E,v,z);if(o)return o;if(!E._data)if(E.uri)E._data=this.loadUriAsync(`${B}/uri`,E,E.uri);else{if(!this._bin)throw new Error(`${B}: Uri is missing or the binary glTF is missing its binary chunk`);E._data=this._bin.readAsync(0,E.byteLength)}return E._data.then((E=>{try{return new Uint8Array(E.buffer,E.byteOffset+v,z)}catch(o){throw new Error(`${B}: ${o.message}`)}}))}loadBufferViewAsync(B,E){const v=this._extensionsLoadBufferViewAsync(B,E);if(v)return v;if(E._data)return E._data;const z=W.Get(`${B}/buffer`,this._gltf.buffers,E.buffer);return E._data=this.loadBufferAsync(`/buffers/${z.index}`,z,E.byteOffset||0,E.byteLength),E._data}_loadAccessorAsync(B,E,v){if(E._data)return E._data;const z=n._GetNumComponents(B,E.type),o=z*X.e.GetTypeByteLength(E.componentType),q=z*E.count;if(void 0==E.bufferView)E._data=Promise.resolve(new v(q));else{const c=W.Get(`${B}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((S=>{if(5126!==E.componentType||E.normalized||c.byteStride&&c.byteStride!==o){const B=new v(q);return X.e.ForEach(S,E.byteOffset||0,c.byteStride||o,z,E.componentType,B.length,E.normalized||!1,((E,v)=>{B[v]=E})),B}return n._GetTypedArray(B,E.componentType,S,E.byteOffset,q)}))}if(E.sparse){const q=E.sparse;E._data=E._data.then((c=>{const S=c,x=W.Get(`${B}/sparse/indices/bufferView`,this._gltf.bufferViews,q.indices.bufferView),D=W.Get(`${B}/sparse/values/bufferView`,this._gltf.bufferViews,q.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${x.index}`,x),this.loadBufferViewAsync(`/bufferViews/${D.index}`,D)]).then((c=>{let[x,D]=c;const h=n._GetTypedArray(`${B}/sparse/indices`,q.indices.componentType,x,q.indices.byteOffset,q.count),y=z*q.count;let Q;if(5126!==E.componentType||E.normalized){const c=n._GetTypedArray(`${B}/sparse/values`,E.componentType,D,q.values.byteOffset,y);Q=new v(y),X.e.ForEach(c,0,o,z,E.componentType,Q.length,E.normalized||!1,((B,E)=>{Q[E]=B}))}else Q=n._GetTypedArray(`${B}/sparse/values`,E.componentType,D,q.values.byteOffset,y);let P=0;for(let B=0;B<h.length;B++){let E=h[B]*z;for(let B=0;B<z;B++)S[E++]=Q[P++]}return S}))}))}return E._data}_loadFloatAccessorAsync(B,E){return this._loadAccessorAsync(B,E,Float32Array)}_loadIndicesAccessorAsync(B,E){if("SCALAR"!==E.type)throw new Error(`${B}/type: Invalid value ${E.type}`);if(5121!==E.componentType&&5123!==E.componentType&&5125!==E.componentType)throw new Error(`${B}/componentType: Invalid value ${E.componentType}`);if(E._data)return E._data;if(E.sparse){const v=n._GetTypedArrayConstructor(`${B}/componentType`,E.componentType);E._data=this._loadAccessorAsync(B,E,v)}else{const v=W.Get(`${B}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((v=>n._GetTypedArray(B,E.componentType,v,E.byteOffset,E.count)))}return E._data}_loadVertexBufferViewAsync(B){if(B._babylonBuffer)return B._babylonBuffer;const E=this._babylonScene.getEngine();return B._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((B=>new X.d(E,B,!1))),B._babylonBuffer}_loadVertexAccessorAsync(B,E,v){var z;if(null!==(z=E._babylonVertexBuffer)&&void 0!==z&&z[v])return E._babylonVertexBuffer[v];E._babylonVertexBuffer||(E._babylonVertexBuffer={});const o=this._babylonScene.getEngine();if(E.sparse||void 0==E.bufferView)E._babylonVertexBuffer[v]=this._loadFloatAccessorAsync(B,E).then((B=>new X.e(o,B,v,!1)));else{const z=W.Get(`${B}/bufferView`,this._gltf.bufferViews,E.bufferView);E._babylonVertexBuffer[v]=this._loadVertexBufferViewAsync(z).then((q=>{const c=n._GetNumComponents(B,E.type);return new X.e(o,q,v,!1,void 0,z.byteStride,void 0,E.byteOffset,c,E.componentType,E.normalized,!0,void 0,!0)}))}return E._babylonVertexBuffer[v]}_loadMaterialMetallicRoughnessPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return E&&(E.baseColorFactor?(v.albedoColor=q.gE.VE(E.baseColorFactor),v.alpha=E.baseColorFactor[3]):v.albedoColor=q.gE.White(),v.metallic=void 0==E.metallicFactor?1:E.metallicFactor,v.roughness=void 0==E.roughnessFactor?1:E.roughnessFactor,E.baseColorTexture&&z.push(this.loadTextureInfoAsync(`${B}/baseColorTexture`,E.baseColorTexture,(B=>{B.name=`${v.name} (Base Color)`,v.albedoTexture=B}))),E.metallicRoughnessTexture&&(E.metallicRoughnessTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${B}/metallicRoughnessTexture`,E.metallicRoughnessTexture,(B=>{B.name=`${v.name} (Metallic Roughness)`,v.metallicTexture=B}))),v.useMetallnessFromMetallicTextureBlue=!0,v.useRoughnessFromMetallicTextureGreen=!0,v.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(z).then((()=>{}))}_loadMaterialAsync(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const q=this._extensionsLoadMaterialAsync(B,E,v,z,o);if(q)return q;E._data=E._data||{};let c=E._data[z];if(!c){this.logOpen(`${B} ${E.name||""}`);const v=this.createMaterial(B,E,z);c={babylonMaterial:v,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(B,E,v)},E._data[z]=c,n.AddPointerMetadata(v,B),this._parent.onMaterialLoadedObservable.notifyObservers(v),this.logClose()}return v&&(c.babylonMeshes.push(v),v.eq.addOnce((()=>{const B=c.babylonMeshes.indexOf(v);-1!==B&&c.babylonMeshes.splice(B,1)}))),o(c.babylonMaterial),c.promise.then((()=>c.babylonMaterial))}_createDefaultMaterial(B,E){this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new V.c(B,this._babylonScene);return v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.fillMode=E,v.enableSpecularAntiAliasing=!0,v.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,v.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,v.transparencyMode=V.c.PBRMATERIAL_OPAQUE,v.metallic=1,v.roughness=1,v}createMaterial(B,E,v){const z=this._extensionsCreateMaterial(B,E,v);if(z)return z;const o=E.name||`material${E.index}`;return this._createDefaultMaterial(o,v)}loadMaterialPropertiesAsync(B,E,v){const z=this._extensionsLoadMaterialPropertiesAsync(B,E,v);if(z)return z;const o=new Array;return o.push(this.loadMaterialBasePropertiesAsync(B,E,v)),E.pbrMetallicRoughness&&o.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${B}/pbrMetallicRoughness`,E.pbrMetallicRoughness,v)),this.loadMaterialAlphaProperties(B,E,v),Promise.all(o).then((()=>{}))}loadMaterialBasePropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return v.emissiveColor=E.emissiveFactor?q.gE.VE(E.emissiveFactor):new q.gE(0,0,0),E.doubleSided&&(v.Gc=!1,v.twoSidedLighting=!0),E.normalTexture&&(E.normalTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${B}/normalTexture`,E.normalTexture,(B=>{B.name=`${v.name} (Normal)`,v.bumpTexture=B}))),v.invertNormalMapX=!this._babylonScene.useRightHandedSystem,v.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=E.normalTexture.scale&&v.bumpTexture&&(v.bumpTexture.level=E.normalTexture.scale),v.forceIrradianceInFragment=!0),E.occlusionTexture&&(E.occlusionTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${B}/occlusionTexture`,E.occlusionTexture,(B=>{B.name=`${v.name} (Occlusion)`,v.ambientTexture=B}))),v.useAmbientInGrayScale=!0,void 0!=E.occlusionTexture.strength&&(v.ambientTextureStrength=E.occlusionTexture.strength)),E.emissiveTexture&&z.push(this.loadTextureInfoAsync(`${B}/emissiveTexture`,E.emissiveTexture,(B=>{B.name=`${v.name} (Emissive)`,v.emissiveTexture=B}))),Promise.all(z).then((()=>{}))}loadMaterialAlphaProperties(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);switch(E.alphaMode||"OPAQUE"){case"OPAQUE":v.transparencyMode=V.c.PBRMATERIAL_OPAQUE,v.alpha=1;break;case"MASK":v.transparencyMode=V.c.PBRMATERIAL_ALPHATEST,v.alphaCutOff=void 0==E.alphaCutoff?.5:E.alphaCutoff,v.albedoTexture&&(v.albedoTexture.Sc=!0);break;case"BLEND":v.transparencyMode=V.c.PBRMATERIAL_ALPHABLEND,v.albedoTexture&&(v.albedoTexture.Sc=!0,v.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${B}/alphaMode: Invalid value (${E.alphaMode})`)}}loadTextureInfoAsync(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureInfoAsync(B,E,v);if(z)return z;if(this.logOpen(`${B}`),E.texCoord>=6)throw new Error(`${B}/texCoord: Invalid value (${E.texCoord})`);const o=W.Get(`${B}/index`,this._gltf.textures,E.index);o._textureInfo=E;const q=this._loadTextureAsync(`/textures/${E.index}`,o,(z=>{z.coordinatesIndex=E.texCoord||0,n.AddPointerMetadata(z,B),this._parent.onTextureLoadedObservable.notifyObservers(z),v(z)}));return this.logClose(),q}_loadTextureAsync(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureAsync(B,E,v);if(z)return z;this.logOpen(`${B} ${E.name||""}`);const o=void 0==E.sampler?n.DefaultSampler:W.Get(`${B}/sampler`,this._gltf.samplers,E.sampler),q=W.Get(`${B}/source`,this._gltf.images,E.source),c=this._createTextureAsync(B,o,q,v,void 0,!E._textureInfo.nonColorData);return this.logClose(),c}_createTextureAsync(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},q=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;const S=this._loadSampler(`/samplers/${E.index}`,E),x=new Array,D=new z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:S.noMipMaps,invertY:!1,samplingMode:S.samplingMode,L:()=>{this._disposed||D.resolve()},onError:(E,v)=>{this._disposed||D.reject(new Error(`${B}: ${v&&v.message?v.message:E||"Failed to load texture"}`))},mimeType:v.mimeType??(0,l.j)(v.uri??""),loaderOptions:q,useSRGBBuffer:!!c&&this._parent.useSRGBBuffers},y=new T.b(null,this._babylonScene,h);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.push(D.promise),x.push(this.loadImageAsync(`/images/${v.index}`,v).then((B=>{const E=v.uri||`${this._fileName}#image${v.index}`,z=`data:${this._uniqueRootUrl}${E}`;y.updateURL(z,B);const o=y.getInternalTexture();o&&(o.label=v.name)}))),y.wrapU=S.wrapU,y.wrapV=S.wrapV,o(y),this._parent.useGltfTextureNames&&(y.name=v.name||v.uri||`image${v.index}`),Promise.all(x).then((()=>y))}_loadSampler(B,E){return E._data||(E._data={noMipMaps:9728===E.minFilter||9729===E.minFilter,samplingMode:n._GetTextureSamplingMode(B,E),wrapU:n._GetTextureWrapMode(`${B}/wrapS`,E.wrapS),wrapV:n._GetTextureWrapMode(`${B}/wrapT`,E.wrapT)}),E._data}loadImageAsync(B,E){if(!E._data){if(this.logOpen(`${B} ${E.name||""}`),E.uri)E._data=this.loadUriAsync(`${B}/uri`,E,E.uri);else{const v=W.Get(`${B}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}this.logClose()}return E._data}loadUriAsync(B,E,v){const z=this._extensionsLoadUriAsync(B,E,v);if(z)return z;if(!n._ValidateUri(v))throw new Error(`${B}: '${v}' is invalid`);if((0,l.l)(v)){const E=new Uint8Array((0,l.e)(v));return this.log(`${B}: Decoded ${v.substring(0,64)}... (${E.length} bytes)`),Promise.resolve(E)}return this.log(`${B}: Loading ${v}`),this._parent.preprocessUrlAsync(this._rootUrl+v).then((E=>new Promise(((z,o)=>{this._parent._loadFile(this._babylonScene,E,(E=>{this._disposed||(this.log(`${B}: Loaded ${v} (${E.byteLength} bytes)`),z(new Uint8Array(E)))}),!0,(E=>{o(new l.p(`${B}: Failed to load '${v}'${E?": "+E.status+" "+E.statusText:""}`,E))}))}))))}static AddPointerMetadata(B,E){B.metadata=B.metadata||{};const v=B._internalMetadata=B._internalMetadata||{},z=v.vc=v.vc||{};(z.pointers=z.pointers||[]).push(E)}static _GetTextureWrapMode(B,E){switch(E=void 0==E?10497:E){case 33071:return T.b.CLAMP_ADDRESSMODE;case 33648:return T.b.MIRROR_ADDRESSMODE;case 10497:return T.b.WRAP_ADDRESSMODE;default:return Y.c.Warn(`${B}: Invalid value (${E})`),T.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(B,E){const v=void 0==E.magFilter?9729:E.magFilter,z=void 0==E.minFilter?9987:E.minFilter;if(9729===v)switch(z){case 9728:return T.b.LINEAR_NEAREST;case 9729:return T.b.LINEAR_LINEAR;case 9984:return T.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return T.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return T.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return T.b.LINEAR_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${B}/minFilter: Invalid value (${z})`),T.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==v&&Y.c.Warn(`${B}/magFilter: Invalid value (${v})`),z){case 9728:return T.b.NEAREST_NEAREST;case 9729:return T.b.NEAREST_LINEAR;case 9984:return T.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return T.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return T.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return T.b.NEAREST_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${B}/minFilter: Invalid value (${z})`),T.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(B,E){try{return(0,F.o)(E)}catch(v){throw new Error(`${B}: ${v.message}`)}}static _GetTypedArray(B,E,v,z,o){const q=v.buffer;z=v.byteOffset+(z||0);const c=n._GetTypedArrayConstructor(`${B}/componentType`,E),S=X.e.GetTypeByteLength(E);return z%S!==0?(Y.c.Warn(`${B}: Copying buffer as byte offset (${z}) is not a multiple of component type byte length (${S})`),new c(q.slice(z,z+o*S),0)):new c(q,z,o)}static _GetNumComponents(B,E){switch(E){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${B}: Invalid type (${E})`)}static _ValidateUri(B){return c.Tools.IsBase64(B)||-1===B.indexOf("..")}static _GetDrawMode(B,E){switch(void 0==E&&(E=4),E){case 0:return g.c.PointListDrawMode;case 1:return g.c.LineListDrawMode;case 2:return g.c.LineLoopDrawMode;case 3:return g.c.LineStripDrawMode;case 4:return g.c.TriangleFillMode;case 5:return g.c.TriangleStripDrawMode;case 6:return g.c.TriangleFanDrawMode}throw new Error(`${B}: Invalid mesh primitive mode (${E})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const B=new Array;if(this._gltf.materials)for(const E of this._gltf.materials)if(E._data)for(const v in E._data){const z=E._data[v];for(const E of z.babylonMeshes){E.yc(!0);const v=z.babylonMaterial;B.push(v.forceCompilationAsync(E)),B.push(v.forceCompilationAsync(E,{useInstances:!0})),this._parent.useClipPlane&&(B.push(v.forceCompilationAsync(E,{clipPlane:!0})),B.push(v.forceCompilationAsync(E,{clipPlane:!0,useInstances:!0})))}}return Promise.all(B).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const B=new Array,E=this._babylonScene.lights;for(const v of E){const E=v.getShadowGenerator();E&&B.push(E.forceCompilationAsync())}return Promise.all(B).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(B){for(const E of this._extensions)E.enabled&&B(E)}_applyExtensions(B,E,v){for(const z of this._extensions)if(z.enabled){const o=`${z.name}.${E}`,q=B;q._activeLoaderExtensionFunctions=q._activeLoaderExtensionFunctions||{};const c=q._activeLoaderExtensionFunctions;if(!c[o]){c[o]=!0;try{const B=v(z);if(B)return B}finally{delete c[o]}}}return null}_extensionsOnLoading(){this._forEachExtensions((B=>B.onLoading&&B.onLoading()))}_extensionsOnReady(){this._forEachExtensions((B=>B.onReady&&B.onReady()))}_extensionsLoadSceneAsync(B,E){return this._applyExtensions(E,"loadScene",(v=>v.loadSceneAsync&&v.loadSceneAsync(B,E)))}_extensionsLoadNodeAsync(B,E,v){return this._applyExtensions(E,"loadNode",(z=>z.loadNodeAsync&&z.loadNodeAsync(B,E,v)))}_extensionsLoadCameraAsync(B,E,v){return this._applyExtensions(E,"loadCamera",(z=>z.loadCameraAsync&&z.loadCameraAsync(B,E,v)))}_extensionsLoadVertexDataAsync(B,E,v){return this._applyExtensions(E,"loadVertexData",(z=>z._loadVertexDataAsync&&z._loadVertexDataAsync(B,E,v)))}_extensionsLoadMeshPrimitiveAsync(B,E,v,z,o,q){return this._applyExtensions(o,"loadMeshPrimitive",(c=>c._loadMeshPrimitiveAsync&&c._loadMeshPrimitiveAsync(B,E,v,z,o,q)))}_extensionsLoadMaterialAsync(B,E,v,z,o){return this._applyExtensions(E,"loadMaterial",(q=>q._loadMaterialAsync&&q._loadMaterialAsync(B,E,v,z,o)))}_extensionsCreateMaterial(B,E,v){return this._applyExtensions(E,"createMaterial",(z=>z.createMaterial&&z.createMaterial(B,E,v)))}_extensionsLoadMaterialPropertiesAsync(B,E,v){return this._applyExtensions(E,"loadMaterialProperties",(z=>z.loadMaterialPropertiesAsync&&z.loadMaterialPropertiesAsync(B,E,v)))}_extensionsLoadTextureInfoAsync(B,E,v){return this._applyExtensions(E,"loadTextureInfo",(z=>z.loadTextureInfoAsync&&z.loadTextureInfoAsync(B,E,v)))}_extensionsLoadTextureAsync(B,E,v){return this._applyExtensions(E,"loadTexture",(z=>z._loadTextureAsync&&z._loadTextureAsync(B,E,v)))}_extensionsLoadAnimationAsync(B,E){return this._applyExtensions(E,"loadAnimation",(v=>v.loadAnimationAsync&&v.loadAnimationAsync(B,E)))}_extensionsLoadAnimationChannelAsync(B,E,v,z,o){return this._applyExtensions(v,"loadAnimationChannel",(q=>q._loadAnimationChannelAsync&&q._loadAnimationChannelAsync(B,E,v,z,o)))}_extensionsLoadSkinAsync(B,E,v){return this._applyExtensions(v,"loadSkin",(z=>z._loadSkinAsync&&z._loadSkinAsync(B,E,v)))}_extensionsLoadUriAsync(B,E,v){return this._applyExtensions(E,"loadUri",(z=>z._loadUriAsync&&z._loadUriAsync(B,E,v)))}_extensionsLoadBufferViewAsync(B,E){return this._applyExtensions(E,"loadBufferView",(v=>v.loadBufferViewAsync&&v.loadBufferViewAsync(B,E)))}_extensionsLoadBufferAsync(B,E,v,z){return this._applyExtensions(E,"loadBuffer",(o=>o.loadBufferAsync&&o.loadBufferAsync(B,E,v,z)))}static LoadExtensionAsync(B,E,v,z){if(!E.extensions)return null;const o=E.extensions[v];return o?z(`${B}/extensions/${v}`,o):null}static LoadExtraAsync(B,E,v,z){if(!E.extras)return null;const o=E.extras[v];return o?z(`${B}/extras/${v}`,o):null}isExtensionUsed(B){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(B)}logOpen(B){this._parent._logOpen(B)}logClose(){this._parent._logClose()}log(B){this._parent._log(B)}startPerformanceCounter(B){this._parent._startPerformanceCounter(B)}endPerformanceCounter(B){this._parent._endPerformanceCounter(B)}}n.DefaultSampler={index:-1},A.d._CreateGLTF2Loader=B=>new n(B);var U=v(13049),s=v(11552),J=v(11409),O=v(13055),e=v(13062);class k extends e.e{constructor(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",B),this._texture=B.getEngine().createRawCubeTexture(E,v,z,o,q,c,S,x)}update(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,B,E,v,z,o)}updateRGBDAsync(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,O.k)(this._texture,B,E,v,z).then((()=>{}))}clone(){return J.b.Clone((()=>{const B=this.rB(),E=this._texture,v=new k(B,E._bufferViewArray,E.width,E.format,E.type,E.generateMipMaps,E.invertY,E.samplingMode,E._compression);return 13===E.source&&v.updateRGBDAsync(E._bufferViewArrayArray,E._sphericalPolynomial,E._lodGenerationScale,E._lodGenerationOffset),v}),this)}}const L="EXT_lights_image_based";class M{constructor(B){this.name=L,this._loader=B,this.enabled=this._loader.isExtensionUsed(L)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.vc.extensions;if(B&&B[this.name]){const E=B[this.name];this._lights=E.lights}}loadSceneAsync(B,E){return n.LoadExtensionAsync(B,E,this.name,(async(v,z)=>{this._loader._allMaterialsDirtyRequired=!0;const o=new Array;o.push(this._loader.loadSceneAsync(B,E)),this._loader.logOpen(`${v}`);const q=W.Get(`${v}/light`,this._lights,z.pz);return o.push(this._loadLightAsync(`/extensions/${this.name}/lights/${z.pz}`,q).then((B=>{this._loader.babylonScene.environmentTexture=B}))),this._loader.logClose(),await Promise.all(o).then((()=>{}))}))}_loadLightAsync(B,E){if(!E._loaded){const v=new Array;this._loader.logOpen(`${B}`);const z=new Array(E.specularImages.length);for(let o=0;o<E.specularImages.length;o++){const q=E.specularImages[o];z[o]=new Array(q.length);for(let E=0;E<q.length;E++){const c=`${B}/specularImages/${o}/${E}`;this._loader.logOpen(`${c}`);const S=q[E],x=W.Get(c,this._loader.vc.images,S);v.push(this._loader.loadImageAsync(`/images/${S}`,x).then((B=>{z[o][E]=B}))),this._loader.logClose()}}this._loader.logClose(),E._loaded=Promise.all(v).then((async()=>{const v=new k(this._loader.babylonScene,null,E.specularImageSize);if(v.name=E.name||"environment",E._babylonTexture=v,void 0!=E.Nc&&(v.level=E.Nc),E.rotation){let B=o.Quaternion.VE(E.rotation);this._loader.babylonScene.useRightHandedSystem||(B=o.Quaternion.Inverse(B)),o.Matrix.FromQuaternionToRef(B,v.getReflectionTextureMatrix())}if(!E.irradianceCoefficients)throw new Error(`${B}: Irradiance coefficients are missing`);const q=s.d.VE(E.irradianceCoefficients);q.scaleInPlace(E.Nc),q.convertIrradianceToLambertianRadiance();const c=s.g.FromHarmonics(q),S=(z.length-1)/Math.log2(E.specularImageSize);return await v.updateRGBDAsync(z,c,S)}))}return E._loaded.then((()=>E._babylonTexture))}}j(L),H(L,!0,(B=>new M(B)));v(11952);const Z="EXT_mesh_gpu_instancing";class BB{constructor(B){this.name=Z,this._loader=B,this.enabled=this._loader.isExtensionUsed(Z)}dispose(){this._loader=null}loadNodeAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(B,z)=>{this._loader._disableInstancedMesh++;const q=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,v);if(this._loader._disableInstancedMesh--,!E._primitiveBabylonMeshes)return await q;const c=new Array;let S=0;const x=E=>{if(void 0==z.attributes[E])return void c.push(Promise.resolve(null));const v=W.Get(`${B}/attributes/${E}`,this._loader.vc.accessors,z.attributes[E]);if(c.push(this._loader._loadFloatAccessorAsync(`/accessors/${v.bufferView}`,v)),0===S)S=v.count;else if(S!==v.count)throw new Error(`${B}/attributes: Instance buffer accessors do not have the same count.`)};return x("TRANSLATION"),x("ROTATION"),x("SCALE"),await q.then((async B=>{const[v,z,q]=await Promise.all(c),x=new Float32Array(16*S);o.TmpVectors.GE[0].Yc(0,0,0),o.TmpVectors.Quaternion[0].Yc(0,0,0,1),o.TmpVectors.GE[1].Yc(1,1,1);for(let E=0;E<S;++E)v&&o.GE.FromArrayToRef(v,3*E,o.TmpVectors.GE[0]),z&&o.Quaternion.FromArrayToRef(z,4*E,o.TmpVectors.Quaternion[0]),q&&o.GE.FromArrayToRef(q,3*E,o.TmpVectors.GE[1]),o.Matrix.ComposeToRef(o.TmpVectors.GE[1],o.TmpVectors.Quaternion[0],o.TmpVectors.GE[0],o.TmpVectors.Matrix[0]),o.TmpVectors.Matrix[0].copyToArray(x,16*E);for(const o of E._primitiveBabylonMeshes)o.cQ("matrix",x,16,!0);return B}))}))}}j(Z),H(Z,!0,(B=>new BB(B)));let EB=0,vB=null;class zB{static get Default(){return zB._Default||(zB._Default=new zB),zB._Default}constructor(){const B=zB.Configuration.decoder;this._decoderModulePromise=c.Tools.LoadBabylonScriptAsync(B.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(B,E,v,z,o){await this._decoderModulePromise,0===EB&&(MeshoptDecoder.useWorkers(1),EB=1);const q=await MeshoptDecoder.decodeGltfBufferAsync(E,v,B,z,o);return null!==vB&&clearTimeout(vB),vB=setTimeout((()=>{MeshoptDecoder.useWorkers(0),EB=0,vB=null}),1e3),q}}zB.Configuration={decoder:{url:`${c.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},zB._Default=null;const oB="EXT_meshopt_compression";class qB{constructor(B){this.name=oB,this.enabled=B.isExtensionUsed(oB),this._loader=B}dispose(){this._loader=null}loadBufferViewAsync(B,E){return n.LoadExtensionAsync(B,E,this.name,(async(v,z)=>{const o=E;if(o._meshOptData)return await o._meshOptData;const q=W.Get(`${B}/buffer`,this._loader.vc.buffers,z.buffer);return o._meshOptData=this._loader.loadBufferAsync(`/buffers/${q.index}`,q,z.byteOffset||0,z.byteLength).then((async B=>await zB.Default.decodeGltfBufferAsync(B,z.count,z.byteStride,z.mode,z.filter))),await o._meshOptData}))}}j(oB),H(oB,!0,(B=>new qB(B)));const cB="EXT_texture_webp";class SB{constructor(B){this.name=cB,this._loader=B,this.enabled=B.isExtensionUsed(cB)}dispose(){this._loader=null}_loadTextureAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=void 0==E.sampler?n.DefaultSampler:W.Get(`${B}/sampler`,this._loader.vc.samplers,E.sampler),c=W.Get(`${z}/source`,this._loader.vc.images,o.source);return await this._loader._createTextureAsync(B,q,c,(B=>{v(B)}),void 0,!E._textureInfo.nonColorData)}))}}j(cB),H(cB,!0,(B=>new SB(B)));const xB="EXT_texture_avif";class DB{constructor(B){this.name=xB,this._loader=B,this.enabled=B.isExtensionUsed(xB)}dispose(){this._loader=null}_loadTextureAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=void 0==E.sampler?n.DefaultSampler:W.Get(`${B}/sampler`,this._loader.vc.samplers,E.sampler),c=W.Get(`${z}/source`,this._loader.vc.images,o.source);return await this._loader._createTextureAsync(B,q,c,(B=>{v(B)}),void 0,!E._textureInfo.nonColorData)}))}}j(xB),H(xB,!0,(B=>new DB(B)));var hB=v(13043),yB=v(11920);const QB="EXT_lights_ies";class PB{constructor(B){this.name=QB,this._loader=B,this.enabled=this._loader.isExtensionUsed(QB)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.vc.extensions;if(B&&B[this.name]){const E=B[this.name];this._lights=E.lights,W.Assign(this._lights)}}loadNodeAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,c)=>{let S,x;this._loader._allMaterialsDirtyRequired=!0;const D=await this._loader.loadNodeAsync(B,E,(B=>{x=W.Get(z,this._lights,c.pz);const E=x.name||B.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S=new hB.e(E,o.GE.Zero(),o.GE.Backward(),0,1,this._loader.babylonScene),S.angle=Math.PI/2,S.innerAngle=0,S._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,x._babylonLight=S,S.falloffType=yB.c.FALLOFF_GLTF,S.Xc=c.color?q.gE.VE(c.color):q.gE.White(),S.Nc=c.multiplier||1,S.range=Number.MAX_VALUE,S.parent=B,this._loader._babylonLights.push(S),n.AddPointerMetadata(S,z),v(B)}));let h;if(x.uri)h=await this._loader.loadUriAsync(B,x,x.uri);else{const E=W.Get(`${B}/bufferView`,this._loader.vc.bufferViews,x.bufferView);h=await this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E)}return S.iesProfileTexture=new T.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,h,!0,void 0,void 0,void 0,void 0,".ies"),D}))}}j(QB),H(QB,!0,(B=>new PB(B)));var GB=v(13078);const YB="KHR_draco_mesh_compression";class aB{constructor(B){this.name=YB,this.useNormalizedFlagFromAccessor=!0,this._loader=B,this.enabled=GB.c.DefaultAvailable&&this._loader.isExtensionUsed(YB)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{if(void 0!=E.mode&&4!==E.mode&&5!==E.mode)throw new Error(`${B}: Unsupported mode ${E.mode}`);const q={},c={},S=(B,z)=>{const S=o.attributes[B];if(void 0!=S&&(v._delayInfo=v._delayInfo||[],-1===v._delayInfo.indexOf(z)&&v._delayInfo.push(z),q[z]=S,this.useNormalizedFlagFromAccessor)){const v=W.TryGet(this._loader.vc.accessors,E.attributes[B]);v&&(c[z]=v.normalized||!1)}};S("POSITION",X.e.PositionKind),S("NORMAL",X.e.NormalKind),S("TANGENT",X.e.TangentKind),S("TEXCOORD_0",X.e.UVKind),S("TEXCOORD_1",X.e.UV2Kind),S("TEXCOORD_2",X.e.UV3Kind),S("TEXCOORD_3",X.e.UV4Kind),S("TEXCOORD_4",X.e.UV5Kind),S("TEXCOORD_5",X.e.UV6Kind),S("JOINTS_0",X.e.MatricesIndicesKind),S("WEIGHTS_0",X.e.MatricesWeightsKind),S("COLOR_0",X.e.ColorKind);const x=W.Get(z,this._loader.vc.bufferViews,o.bufferView);return x._dracoBabylonGeometry||(x._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((async z=>{const o=this.dracoDecoder||GB.c.Default,S=W.TryGet(this._loader.vc.accessors,E.attributes.POSITION),x=this._loader.parent.alwaysComputeBoundingBox||v.skeleton||!S?null:w(S);return await o._decodeMeshToGeometryForGltfAsync(v.name,this._loader.babylonScene,z,q,c,x).catch((E=>{throw new Error(`${B}: ${E.message}`)}))}))),await x._dracoBabylonGeometry}))}}j(YB),H(YB,!0,(B=>new aB(B)));var mB=v(13080),gB=v(11366),VB=v(11372),TB=v(11808),NB=v(11991),XB=v(11345);TB.e.AddNodeConstructor("Light_Type_0",((B,E)=>()=>new rB(B,o.GE.Zero(),E)));class rB extends NB.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(B){this._shadowAngle=B,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(B){const E=this.needCube();if(this._direction=B,this.needCube()!==E&&this._shadowGenerators){const B=this._shadowGenerators.values();for(let E=B.next();!0!==E.done;E=B.next()){E.value.recreateShadowMap()}}}constructor(B,E,v){super(B,v),this._shadowAngle=Math.PI/2,this.position=E}getClassName(){return"PointLight"}getTypeID(){return yB.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(B){if(this.direction)return super.getShadowDirection(B);switch(B){case 0:return new o.GE(1,0,0);case 1:return new o.GE(-1,0,0);case 2:return new o.GE(0,-1,0);case 3:return new o.GE(0,1,0);case 4:return new o.GE(0,0,1);case 5:return new o.GE(0,0,-1)}return o.GE.Zero()}_setDefaultShadowProjectionMatrix(B,E,v){const z=this.rB().activeCamera;if(!z)return;const q=void 0!==this.shadowMinZ?this.shadowMinZ:z.xc,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,S=this.rB().getEngine().useReverseDepthBuffer;o.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,S?c:q,S?q:c,B,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(B,E){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,E):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,E),this}transferToNodeMaterialEffect(B,E){return this.computeTransformedInformation()?B.setFloat3(E,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):B.setFloat3(E,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(B,E){B["POINTLIGHT"+E]=!0}}(0,gB.c)([(0,VB.K)()],rB.prototype,"shadowAngle",null),(0,XB.f)("BABYLON.PointLight",rB);const iB="KHR_lights_punctual";class uB{constructor(B){this.name=iB,this._loader=B,this.enabled=this._loader.isExtensionUsed(iB)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.vc.extensions;if(B&&B[this.name]){const E=B[this.name];this._lights=E.lights,W.Assign(this._lights)}}loadNodeAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,c)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(B,E,(B=>{let E;const S=W.Get(z,this._lights,c.pz),x=S.name||B.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S.type){case"directional":{const B=new mB.d(x,o.GE.Backward(),this._loader.babylonScene);B.position.mc(0),E=B;break}case"point":E=new rB(x,o.GE.Zero(),this._loader.babylonScene);break;case"spot":{const B=new hB.e(x,o.GE.Zero(),o.GE.Backward(),0,1,this._loader.babylonScene);B.angle=2*(S.spot&&S.spot.outerConeAngle||Math.PI/4),B.innerAngle=2*(S.spot&&S.spot.innerConeAngle||0),E=B;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${z}: Invalid light type (${S.type})`)}E._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,S._babylonLight=E,E.falloffType=yB.c.FALLOFF_GLTF,E.Xc=S.color?q.gE.VE(S.color):q.gE.White(),E.Nc=void 0==S.Nc?1:S.Nc,E.range=void 0==S.range?Number.MAX_VALUE:S.range,E.parent=B,this._loader._babylonLights.push(E),n.AddPointerMetadata(E,z),v(B)})))))}}j(iB),H(iB,!0,(B=>new uB(B)));const IB="KHR_materials_pbrSpecularGlossiness";class KB{constructor(B){this.name=IB,this.order=200,this._loader=B,this.enabled=this._loader.isExtensionUsed(IB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialBasePropertiesAsync(B,E,v)),q.push(this._loadSpecularGlossinessPropertiesAsync(z,o,v)),this._loader.loadMaterialAlphaProperties(B,E,v),await Promise.all(q).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return v.metallic=null,v.roughness=null,E.diffuseFactor?(v.albedoColor=q.gE.VE(E.diffuseFactor),v.alpha=E.diffuseFactor[3]):v.albedoColor=q.gE.White(),v.reflectivityColor=E.specularFactor?q.gE.VE(E.specularFactor):q.gE.White(),v.microSurface=void 0==E.glossinessFactor?1:E.glossinessFactor,E.diffuseTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTexture`,E.diffuseTexture,(B=>{B.name=`${v.name} (Diffuse)`,v.albedoTexture=B}))),E.specularGlossinessTexture&&(z.push(this._loader.loadTextureInfoAsync(`${B}/specularGlossinessTexture`,E.specularGlossinessTexture,(B=>{B.name=`${v.name} (Specular Glossiness)`,v.reflectivityTexture=B,v.reflectivityTexture.Sc=!0}))),v.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(z).then((()=>{}))}}j(IB),H(IB,!0,(B=>new KB(B)));const CB="KHR_materials_unlit";class fB{constructor(B){this.name=CB,this.order=210,this._loader=B,this.enabled=this._loader.isExtensionUsed(CB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async()=>await this._loadUnlitPropertiesAsync(B,E,v)))}_loadUnlitPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;v.unlit=!0;const o=E.pbrMetallicRoughness;return o&&(o.baseColorFactor?(v.albedoColor=q.gE.VE(o.baseColorFactor),v.alpha=o.baseColorFactor[3]):v.albedoColor=q.gE.White(),o.baseColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/baseColorTexture`,o.baseColorTexture,(B=>{B.name=`${v.name} (Base Color)`,v.albedoTexture=B})))),E.doubleSided&&(v.Gc=!1,v.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(B,E,v),Promise.all(z).then((()=>{}))}}j(CB),H(CB,!0,(B=>new fB(B)));const AB="KHR_materials_clearcoat";class lB{constructor(B){this.name=AB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(AB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadClearCoatPropertiesAsync(z,o,v)),await Promise.all(q)}))}_loadClearCoatPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return v.clearCoat.isEnabled=!0,v.clearCoat.useRoughnessFromMainTexture=!1,v.clearCoat.remapF0OnInterfaceChange=!1,void 0!=E.clearcoatFactor?v.clearCoat.Nc=E.clearcoatFactor:v.clearCoat.Nc=0,E.clearcoatTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatTexture`,E.clearcoatTexture,(B=>{B.name=`${v.name} (ClearCoat)`,v.clearCoat.texture=B}))),void 0!=E.clearcoatRoughnessFactor?v.clearCoat.roughness=E.clearcoatRoughnessFactor:v.clearCoat.roughness=0,E.clearcoatRoughnessTexture&&(E.clearcoatRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatRoughnessTexture`,E.clearcoatRoughnessTexture,(B=>{B.name=`${v.name} (ClearCoat Roughness)`,v.clearCoat.textureRoughness=B})))),E.clearcoatNormalTexture&&(E.clearcoatNormalTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatNormalTexture`,E.clearcoatNormalTexture,(B=>{B.name=`${v.name} (ClearCoat Normal)`,v.clearCoat.bumpTexture=B}))),v.invertNormalMapX=!v.rB().useRightHandedSystem,v.invertNormalMapY=v.rB().useRightHandedSystem,void 0!=E.clearcoatNormalTexture.scale&&(v.clearCoat.bumpTexture.level=E.clearcoatNormalTexture.scale)),Promise.all(z).then((()=>{}))}}j(AB),H(AB,!0,(B=>new lB(B)));const dB="KHR_materials_iridescence";class tB{constructor(B){this.name=dB,this.order=195,this._loader=B,this.enabled=this._loader.isExtensionUsed(dB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadIridescencePropertiesAsync(z,o,v)),await Promise.all(q).then((()=>{}))}))}_loadIridescencePropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return v.iridescence.isEnabled=!0,v.iridescence.Nc=E.iridescenceFactor??0,v.iridescence.indexOfRefraction=E.iridescenceIor??E.iridescenceIOR??1.3,v.iridescence.minimumThickness=E.iridescenceThicknessMinimum??100,v.iridescence.maximumThickness=E.iridescenceThicknessMaximum??400,E.iridescenceTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/iridescenceTexture`,E.iridescenceTexture,(B=>{B.name=`${v.name} (Iridescence)`,v.iridescence.texture=B}))),E.iridescenceThicknessTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/iridescenceThicknessTexture`,E.iridescenceThicknessTexture,(B=>{B.name=`${v.name} (Iridescence Thickness)`,v.iridescence.thicknessTexture=B}))),Promise.all(z).then((()=>{}))}}j(dB),H(dB,!0,(B=>new tB(B)));const pB="KHR_materials_anisotropy";class HB{constructor(B){this.name=pB,this.order=195,this._loader=B,this.enabled=this._loader.isExtensionUsed(pB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadIridescencePropertiesAsync(z,o,v)),await Promise.all(q)}))}async _loadIridescencePropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;v.anisotropy.isEnabled=!0,v.anisotropy.Nc=E.anisotropyStrength??0,v.anisotropy.angle=E.anisotropyRotation??0,E.anisotropyTexture&&(E.anisotropyTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${B}/anisotropyTexture`,E.anisotropyTexture,(B=>{B.name=`${v.name} (Anisotropy Intensity)`,v.anisotropy.texture=B})))),await Promise.all(z)}}j(pB),H(pB,!0,(B=>new HB(B)));const jB="KHR_materials_emissive_strength";class RB{constructor(B){this.name=jB,this.order=170,this._loader=B,this.enabled=this._loader.isExtensionUsed(jB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>await this._loader.loadMaterialPropertiesAsync(B,E,v).then((()=>{this._loadEmissiveProperties(z,o,v)}))))}_loadEmissiveProperties(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);void 0!==E.emissiveStrength&&(v.emissiveIntensity=E.emissiveStrength)}}j(jB),H(jB,!0,(B=>new RB(B)));const bB="KHR_materials_sheen";class FB{constructor(B){this.name=bB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(bB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadSheenPropertiesAsync(z,o,v)),await Promise.all(q).then((()=>{}))}))}_loadSheenPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return v.sheen.isEnabled=!0,v.sheen.Nc=1,void 0!=E.sheenColorFactor?v.sheen.color=q.gE.VE(E.sheenColorFactor):v.sheen.color=q.gE.Black(),E.sheenColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/sheenColorTexture`,E.sheenColorTexture,(B=>{B.name=`${v.name} (Sheen Color)`,v.sheen.texture=B}))),void 0!==E.sheenRoughnessFactor?v.sheen.roughness=E.sheenRoughnessFactor:v.sheen.roughness=0,E.sheenRoughnessTexture&&(E.sheenRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${B}/sheenRoughnessTexture`,E.sheenRoughnessTexture,(B=>{B.name=`${v.name} (Sheen Roughness)`,v.sheen.textureRoughness=B})))),v.sheen.albedoScaling=!0,v.sheen.useRoughnessFromMainTexture=!1,Promise.all(z).then((()=>{}))}}j(bB),H(bB,!0,(B=>new FB(B)));var WB=v(11865);const wB="KHR_materials_specular";class nB{constructor(B){this.name=wB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(wB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;if(q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadSpecularPropertiesAsync(z,o,v)),o.extensions&&o.extensions.EXT_materials_specular_edge_color&&v instanceof V.c){o.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(v.brdf.dielectricSpecularModel=WB.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,v.brdf.conductorSpecularModel=WB.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(q).then((()=>{}))}))}_loadSpecularPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return void 0!==E.specularFactor&&(v.metallicF0Factor=E.specularFactor),void 0!==E.specularColorFactor&&(v.metallicReflectanceColor=q.gE.VE(E.specularColorFactor)),E.specularTexture&&(E.specularTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${B}/specularTexture`,E.specularTexture,(B=>{B.name=`${v.name} (Specular)`,v.metallicReflectanceTexture=B,v.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),E.specularColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/specularColorTexture`,E.specularColorTexture,(B=>{B.name=`${v.name} (Specular Color)`,v.reflectanceTexture=B}))),Promise.all(z).then((()=>{}))}}j(wB),H(wB,!0,(B=>new nB(B)));const UB="KHR_materials_ior";class sB{constructor(B){this.name=UB,this.order=180,this._loader=B,this.enabled=this._loader.isExtensionUsed(UB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadIorPropertiesAsync(z,o,v)),await Promise.all(q).then((()=>{}))}))}_loadIorPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);return void 0!==E.ior?v.indexOfRefraction=E.ior:v.indexOfRefraction=sB._DEFAULT_IOR,Promise.resolve()}}sB._DEFAULT_IOR=1.5,j(UB),H(UB,!0,(B=>new sB(B)));const JB="KHR_materials_variants";class OB{constructor(B){this.name=JB,this._loader=B,this.enabled=this._loader.isExtensionUsed(JB)}dispose(){this._loader=null}static GetAvailableVariants(B){const E=this._GetExtensionMetadata(B);return E?Object.keys(E.variants):[]}getAvailableVariants(B){return OB.GetAvailableVariants(B)}static SelectVariant(B,E){const v=this._GetExtensionMetadata(B);if(!v)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${JB} extension`);const z=B=>{const E=v.variants[B];if(E)for(const v of E)v.mesh.material=v.material};if(E instanceof Array)for(const o of E)z(o);else z(E);v.lastSelected=E}selectVariant(B,E){OB.SelectVariant(B,E)}static Reset(B){const E=this._GetExtensionMetadata(B);if(!E)throw new Error(`Cannot reset on a glTF mesh that does not have the ${JB} extension`);for(const v of E.original)v.mesh.material=v.material;E.lastSelected=null}reset(B){OB.Reset(B)}static GetLastSelectedVariant(B){const E=this._GetExtensionMetadata(B);if(!E)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${JB} extension`);return E.lastSelected}getLastSelectedVariant(B){return OB.GetLastSelectedVariant(B)}static _GetExtensionMetadata(B){var E,v;return(null===B||void 0===B||null===(E=B._internalMetadata)||void 0===E||null===(v=E.vc)||void 0===v?void 0:v[JB])||null}onLoading(){const B=this._loader.vc.extensions;if(B&&B[this.name]){const E=B[this.name];this._variants=E.variants}}onReady(){const B=this._loader.rootBabylonMesh;if(B){var E;const v=this._loader.parent.extensionOptions[JB];null!==v&&void 0!==v&&v.defaultVariant&&OB.SelectVariant(B,v.defaultVariant),null===v||void 0===v||null===(E=v.onLoaded)||void 0===E||E.call(v,{get variants(){return OB.GetAvailableVariants(B)},get selectedVariant(){const E=OB.GetLastSelectedVariant(B);return E?Array.isArray(E)?E[0]:E:OB.GetAvailableVariants(B)[0]},set selectedVariant(E){OB.SelectVariant(B,E)}})}}_loadMeshPrimitiveAsync(B,E,v,z,o,q){return n.LoadExtensionAsync(B,o,this.name,(async(c,S)=>{const x=new Array;return x.push(this._loader._loadMeshPrimitiveAsync(B,E,v,z,o,(E=>{if(q(E),E instanceof u.e){const v=n._GetDrawMode(B,o.mode),z=this._loader.rootBabylonMesh,q=z?z._internalMetadata=z._internalMetadata||{}:{},D=q.vc=q.vc||{},h=D[JB]=D[JB]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:E,material:E.material});for(let B=0;B<S.mappings.length;++B){const o=S.mappings[B],q=W.Get(`${c}/mappings/${B}/material`,this._loader.vc.materials,o.material);x.push(this._loader._loadMaterialAsync(`#/materials/${o.material}`,q,E,v,(B=>{for(let v=0;v<o.variants.length;++v){const q=o.variants[v],c=W.Get(`/extensions/${JB}/variants/${q}`,this._variants,q);h.variants[c.name]=h.variants[c.name]||[],h.variants[c.name].push({mesh:E,material:B}),E.onClonedObservable.add((B=>{const v=B;let o=null,q=v;do{if(q=q.parent,!q)return;o=OB._GetExtensionMetadata(q)}while(null===o);if(z&&o===OB._GetExtensionMetadata(z)){q._internalMetadata={};for(const B in z._internalMetadata)q._internalMetadata[B]=z._internalMetadata[B];q._internalMetadata.vc=[];for(const B in z._internalMetadata.vc)q._internalMetadata.vc[B]=z._internalMetadata.vc[B];q._internalMetadata.vc[JB]={lastSelected:null,original:[],variants:{}};for(const B of o.original)q._internalMetadata.vc[JB].original.push({mesh:B.mesh,material:B.material});for(const B in o.variants)if(Object.prototype.hasOwnProperty.call(o.variants,B)){q._internalMetadata.vc[JB].variants[B]=[];for(const E of o.variants[B])q._internalMetadata.vc[JB].variants[B].push({mesh:E.mesh,material:E.material})}o=q._internalMetadata.vc[JB]}for(const z of o.original)z.mesh===E&&(z.mesh=v);for(const z of o.variants[c.name])z.mesh===E&&(z.mesh=v)}))}})))}}}))),await Promise.all(x).then((B=>{let[E]=B;return E}))}))}}j(JB),H(JB,!0,(B=>new OB(B)));var eB=v(11434);class kB{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:WB.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(B,E){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...kB._GetDefaultOptions(),...B},this._scene=E,this._scene._transmissionHelper=this,this.onErrorObservable=new h.e,this._scene.eq.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(B){if(!Object.keys(B).filter((E=>this._options[E]!==B[E])).length)return;const E={...this._options,...B},v=this._options;this._options=E,E.renderSize===v.renderSize&&E.renderTargetTextureType===v.renderTargetTextureType&&E.generateMipmaps===v.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=E.samples,this._opaqueRenderTarget.lodGenerationScale=E.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=E.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(B){return!!B&&!!(B instanceof V.c&&B.subSurface.isRefractionEnabled)}_addMesh(B){this._materialObservers[B.uniqueId]=B.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),c.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(B.material)?(B.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(B)&&this._transparentMeshesCache.push(B)):-1===this._opaqueMeshesCache.indexOf(B)&&this._opaqueMeshesCache.push(B)}))}_removeMesh(B){B.onMaterialChangedObservable.remove(this._materialObservers[B.uniqueId]),delete this._materialObservers[B.uniqueId];let E=this._transparentMeshesCache.indexOf(B);-1!==E&&this._transparentMeshesCache.splice(E,1),E=this._opaqueMeshesCache.indexOf(B),-1!==E&&this._opaqueMeshesCache.splice(E,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(B){const E=this._transparentMeshesCache.indexOf(B),v=this._opaqueMeshesCache.indexOf(B);this._shouldRenderAsTransmission(B.material)?(B.material instanceof V.c&&(B.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==v?(this._opaqueMeshesCache.splice(v,1),this._transparentMeshesCache.push(B)):-1===E&&this._transparentMeshesCache.push(B)):-1!==E?(this._transparentMeshesCache.splice(E,1),this._opaqueMeshesCache.push(B)):-1===v&&this._opaqueMeshesCache.push(B)}_isRenderTargetValid(){var B;return null!==(null===(B=this._opaqueRenderTarget)||void 0===B?void 0:B.getInternalTexture())}_setupRenderTargets(){var B;let E;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new eB.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(B=this._options.clearColor)||void 0===B?void 0:B.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((B=>{E=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?B.clearColor.S(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(B.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=E}));for(const v of this._transparentMeshesCache)this._shouldRenderAsTransmission(v.material)&&(v.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const LB="KHR_materials_transmission";class MB{constructor(B){this.name=LB,this.order=175,this._loader=B,this.enabled=this._loader.isExtensionUsed(LB),this.enabled&&(B.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadTransparentPropertiesAsync(z,E,v,o)),await Promise.all(q).then((()=>{}))}))}_loadTransparentPropertiesAsync(B,E,v,z){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const o=v;if(o.subSurface.isRefractionEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.useAlbedoToTintRefraction=!0,void 0===z.transmissionFactor)return o.subSurface.refractionIntensity=0,o.subSurface.isRefractionEnabled=!1,Promise.resolve();{var q;o.subSurface.refractionIntensity=z.transmissionFactor;const B=o.rB();if(o.subSurface.refractionIntensity&&!B._transmissionHelper)new kB({},o.rB());else if(o.subSurface.refractionIntensity&&(null===(q=B._transmissionHelper)||void 0===q||!q._isRenderTargetValid())){var c;null===(c=B._transmissionHelper)||void 0===c||c._setupRenderTargets()}}return o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,z.transmissionTexture?(z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${B}/transmissionTexture`,z.transmissionTexture,void 0).then((B=>{B.name=`${v.name} (Transmission)`,o.subSurface.refractionIntensityTexture=B,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(LB),H(LB,!0,(B=>new MB(B)));const ZB="KHR_materials_diffuse_transmission";class BE{constructor(B){this.name=ZB,this.order=174,this._loader=B,this.enabled=this._loader.isExtensionUsed(ZB),this.enabled&&(B.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadTranslucentPropertiesAsync(z,E,v,o)),await Promise.all(q).then((()=>{}))}))}_loadTranslucentPropertiesAsync(B,E,v,z){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const o=v;if(o.subSurface.isTranslucencyEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,o.subSurface.useAlbedoToTintTranslucency=!1,void 0===z.diffuseTransmissionFactor)return o.subSurface.translucencyIntensity=0,o.subSurface.isTranslucencyEnabled=!1,Promise.resolve();o.subSurface.translucencyIntensity=z.diffuseTransmissionFactor;const c=new Array;return o.subSurface.useGltfStyleTextures=!0,z.diffuseTransmissionTexture&&(z.diffuseTransmissionTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTransmissionTexture`,z.diffuseTransmissionTexture).then((B=>{B.name=`${v.name} (Diffuse Transmission)`,o.subSurface.translucencyIntensityTexture=B})))),void 0!==z.diffuseTransmissionColorFactor?o.subSurface.translucencyColor=q.gE.VE(z.diffuseTransmissionColorFactor):o.subSurface.translucencyColor=q.gE.White(),z.diffuseTransmissionColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTransmissionColorTexture`,z.diffuseTransmissionColorTexture).then((B=>{B.name=`${v.name} (Diffuse Transmission Color)`,o.subSurface.translucencyColorTexture=B}))),Promise.all(c).then((()=>{}))}}j(ZB),H(ZB,!0,(B=>new BE(B)));const EE="KHR_materials_volume";class vE{constructor(B){this.name=EE,this.order=173,this._loader=B,this.enabled=this._loader.isExtensionUsed(EE),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadVolumePropertiesAsync(z,E,v,o)),await Promise.all(q).then((()=>{}))}))}_loadVolumePropertiesAsync(B,E,v,z){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);if(!v.subSurface.isRefractionEnabled&&!v.subSurface.isTranslucencyEnabled||!z.thicknessFactor)return Promise.resolve();v.subSurface.volumeIndexOfRefraction=v.indexOfRefraction;const o=void 0!==z.attenuationDistance?z.attenuationDistance:Number.MAX_VALUE;return v.subSurface.tintColorAtDistance=o,void 0!==z.attenuationColor&&3==z.attenuationColor.length&&v.subSurface.tintColor.Yc(z.attenuationColor[0],z.attenuationColor[1],z.attenuationColor[2]),v.subSurface.minimumThickness=0,v.subSurface.maximumThickness=z.thicknessFactor,v.subSurface.useThicknessAsDepth=!0,z.thicknessTexture?(z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${B}/thicknessTexture`,z.thicknessTexture).then((B=>{B.name=`${v.name} (Thickness)`,v.subSurface.thicknessTexture=B,v.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(EE),H(EE,!0,(B=>new vE(B)));const zE="KHR_materials_dispersion";class oE{constructor(B){this.name=zE,this.order=174,this._loader=B,this.enabled=this._loader.isExtensionUsed(zE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadDispersionPropertiesAsync(z,E,v,o)),await Promise.all(q).then((()=>{}))}))}_loadDispersionPropertiesAsync(B,E,v,z){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);return v.subSurface.isRefractionEnabled&&z.dispersion?(v.subSurface.isDispersionEnabled=!0,v.subSurface.dispersion=z.dispersion,Promise.resolve()):Promise.resolve()}}j(zE),H(zE,!0,(B=>new oE(B)));const qE="EXT_materials_diffuse_roughness";class cE{constructor(B){this.name=qE,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(qE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(B,E,v)),q.push(this._loadDiffuseRoughnessPropertiesAsync(z,o,v)),await Promise.all(q).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(B,E,v){if(!(v instanceof V.c))throw new Error(`${B}: Material type not supported`);const z=new Array;return v.brdf.baseDiffuseModel=WB.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=E.diffuseRoughnessFactor?v.baseDiffuseRoughness=E.diffuseRoughnessFactor:v.baseDiffuseRoughness=0,E.diffuseRoughnessTexture&&z.push(this._loader.loadTextureInfoAsync(`${B}/diffuseRoughnessTexture`,E.diffuseRoughnessTexture,(B=>{B.name=`${v.name} (Diffuse Roughness)`,v.baseDiffuseRoughnessTexture=B}))),Promise.all(z).then((()=>{}))}}j(qE),H(qE,!0,(B=>new cE(B)));const SE="KHR_mesh_quantization";class xE{constructor(B){this.name=SE,this.enabled=B.isExtensionUsed(SE)}dispose(){}}j(SE),H(SE,!0,(B=>new xE(B)));const DE="KHR_texture_basisu";class hE{constructor(B){this.name=DE,this._loader=B,this.enabled=B.isExtensionUsed(DE)}dispose(){this._loader=null}_loadTextureAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>{const q=void 0==E.sampler?n.DefaultSampler:W.Get(`${B}/sampler`,this._loader.vc.samplers,E.sampler),c=W.Get(`${z}/source`,this._loader.vc.images,o.source);return await this._loader._createTextureAsync(B,q,c,(B=>{v(B)}),E._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!E._textureInfo.nonColorData)}))}}j(DE),H(DE,!0,(B=>new hE(B)));const yE="KHR_texture_transform";class QE{constructor(B){this.name=yE,this._loader=B,this.enabled=this._loader.isExtensionUsed(yE)}dispose(){this._loader=null}loadTextureInfoAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(z,o)=>await this._loader.loadTextureInfoAsync(B,E,(B=>{if(!(B instanceof T.b))throw new Error(`${z}: Texture type not supported`);o.offset&&(B.uOffset=o.offset[0],B.vOffset=o.offset[1]),B.uRotationCenter=0,B.vRotationCenter=0,o.rotation&&(B.wAng=-o.rotation),o.scale&&(B.uScale=o.scale[0],B.vScale=o.scale[1]),void 0!=o.texCoord&&(B.coordinatesIndex=o.texCoord),v(B)}))))}}j(yE),H(yE,!0,(B=>new QE(B)));const PE="KHR_xmp_json_ld";class GE{constructor(B){this.name=PE,this.order=100,this._loader=B,this.enabled=this._loader.isExtensionUsed(PE)}dispose(){this._loader=null}onLoading(){var B,E,v;if(null===this._loader.rootBabylonMesh)return;const z=null===(B=this._loader.vc.extensions)||void 0===B?void 0:B.KHR_xmp_json_ld,o=null===(E=this._loader.vc.asset)||void 0===E||null===(v=E.extensions)||void 0===v?void 0:v.KHR_xmp_json_ld;if(z&&o){const B=+o.packet;z.packets&&B<z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=z.packets[B])}}}function YE(B,E,v,z){return q.gE.VE(E,v).scale(z)}function aE(B,E,v,z){return E[v]*z}function mE(B,E,v,z){return-E[v]*z}function gE(B,E,v,z){return E[v+1]*z}function VE(B,E,v,z){return E[v]*z*2}function TE(B){return{scale:[new XE(Q.c.ANIMATIONTYPE_FLOAT,`${B}.uScale`,aE,(()=>2)),new XE(Q.c.ANIMATIONTYPE_FLOAT,`${B}.vScale`,gE,(()=>2))],offset:[new XE(Q.c.ANIMATIONTYPE_FLOAT,`${B}.uOffset`,aE,(()=>2)),new XE(Q.c.ANIMATIONTYPE_FLOAT,`${B}.vOffset`,gE,(()=>2))],rotation:[new XE(Q.c.ANIMATIONTYPE_FLOAT,`${B}.wAng`,mE,(()=>1))]}}j(PE),H(PE,!0,(B=>new GE(B)));class NE extends U.AnimationPropertyInfo{buildAnimations(B,E,v,z){return[{babylonAnimatable:B._babylonCamera,babylonAnimation:this._buildAnimation(E,v,z)}]}}class XE extends U.AnimationPropertyInfo{buildAnimations(B,E,v,z){const o=[];for(const q in B._data)o.push({babylonAnimatable:B._data[q].babylonMaterial,babylonAnimation:this._buildAnimation(E,v,z)});return o}}class rE extends U.AnimationPropertyInfo{buildAnimations(B,E,v,z){return[{babylonAnimatable:B._babylonLight,babylonAnimation:this._buildAnimation(E,v,z)}]}}(0,R.l)("/cameras/{}/orthographic/xmag",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"orthoLeft",mE,(()=>1)),new NE(Q.c.ANIMATIONTYPE_FLOAT,"orthoRight",gE,(()=>1))]),(0,R.l)("/cameras/{}/orthographic/ymag",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"orthoBottom",mE,(()=>1)),new NE(Q.c.ANIMATIONTYPE_FLOAT,"orthoTop",gE,(()=>1))]),(0,R.l)("/cameras/{}/orthographic/zfar",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"maxZ",aE,(()=>1))]),(0,R.l)("/cameras/{}/orthographic/znear",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"xc",aE,(()=>1))]),(0,R.l)("/cameras/{}/perspective/yfov",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"fov",aE,(()=>1))]),(0,R.l)("/cameras/{}/perspective/zfar",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"maxZ",aE,(()=>1))]),(0,R.l)("/cameras/{}/perspective/znear",[new NE(Q.c.ANIMATIONTYPE_FLOAT,"xc",aE,(()=>1))]),(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new XE(Q.c.ANIMATIONTYPE_COLOR3,"albedoColor",YE,(()=>4)),new XE(Q.c.ANIMATIONTYPE_FLOAT,"alpha",(function(B,E,v,z){return E[v+3]*z}),(()=>4))]),(0,R.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"metallic",aE,(()=>1))]),(0,R.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"roughness",aE,(()=>1))]);const iE=TE("albedoTexture");(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",iE.scale),(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",iE.offset),(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",iE.rotation);const uE=TE("metallicTexture");(0,R.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",uE.scale),(0,R.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",uE.offset),(0,R.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",uE.rotation),(0,R.l)("/materials/{}/emissiveFactor",[new XE(Q.c.ANIMATIONTYPE_COLOR3,"emissiveColor",YE,(()=>3))]);const IE=TE("bumpTexture");(0,R.l)("/materials/{}/normalTexture/scale",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",aE,(()=>1))]),(0,R.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",IE.scale),(0,R.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",IE.offset),(0,R.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",IE.rotation),(0,R.l)("/materials/{}/occlusionTexture/strength",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",aE,(()=>1))]);const KE=TE("ambientTexture");(0,R.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",KE.scale),(0,R.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",KE.offset),(0,R.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",KE.rotation);const CE=TE("emissiveTexture");(0,R.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",CE.scale),(0,R.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",CE.offset),(0,R.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",CE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",aE,(()=>1))]);const fE=TE("anisotropy.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",fE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",fE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",fE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",aE,(()=>1))]);const AE=TE("clearCoat.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",AE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",AE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",AE.rotation);const lE=TE("clearCoat.bumpTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",lE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",lE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",lE.rotation);const dE=TE("clearCoat.textureRoughness");(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",dE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",dE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",dE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",aE,(()=>1))]);const tE=TE("iridescence.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",tE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",tE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",tE.rotation);const pE=TE("iridescence.thicknessTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",pE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",pE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",pE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new XE(Q.c.ANIMATIONTYPE_COLOR3,"sheen.color",YE,(()=>3))]),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",aE,(()=>1))]);const HE=TE("sheen.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",HE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",HE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",HE.rotation);const jE=TE("sheen.textureRoughness");(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",jE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",jE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",jE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new XE(Q.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",YE,(()=>3))]);const RE=TE("metallicReflectanceTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",RE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",RE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",RE.rotation);const bE=TE("reflectanceTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",bE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",bE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",bE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",aE,(()=>1))]);const FE=TE("subSurface.refractionIntensityTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",FE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",FE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",FE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new XE(Q.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",YE,(()=>3))]),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",aE,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",aE,(()=>1))]);const WE=TE("subSurface.thicknessTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",WE.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",WE.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",WE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new XE(Q.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",aE,(()=>1))]);const wE=TE("subSurface.translucencyIntensityTexture");(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",wE.scale),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",wE.offset),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",wE.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new XE(Q.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",YE,(()=>3))]);const nE=TE("subSurface.translucencyColorTexture");(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",nE.scale),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",nE.offset),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",nE.rotation),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new rE(Q.c.ANIMATIONTYPE_COLOR3,"diffuse",YE,(()=>3))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new rE(Q.c.ANIMATIONTYPE_FLOAT,"intensity",aE,(()=>1))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new rE(Q.c.ANIMATIONTYPE_FLOAT,"range",aE,(()=>1))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new rE(Q.c.ANIMATIONTYPE_FLOAT,"innerAngle",VE,(()=>1))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new rE(Q.c.ANIMATIONTYPE_FLOAT,"angle",VE,(()=>1))]),(0,R.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new rE(Q.c.ANIMATIONTYPE_COLOR3,"diffuse",YE,(()=>3))]),(0,R.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new rE(Q.c.ANIMATIONTYPE_FLOAT,"intensity",aE,(()=>1))]);const UE="KHR_animation_pointer";class sE{constructor(B){this.name=UE,this._loader=B,this._pathToObjectConverter=(0,R.j)(this._loader.vc)}get enabled(){return this._loader.isExtensionUsed(UE)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(B,E,v,z,o){var q;const c=null===(q=z.target.extensions)||void 0===q?void 0:q.KHR_animation_pointer;if(!c||!this._pathToObjectConverter)return null;"pointer"!==z.target.path&&Y.c.Warn(`${B}/target/path: Value (${z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=z.target.node&&Y.c.Warn(`${B}/target/node: Value (${z.target.node}) must not be present when using the ${this.name} extension`);const S=`${B}/extensions/${this.name}`,x=c.pointer;if(!x)throw new Error(`${S}: Pointer is missing`);try{const q=this._pathToObjectConverter.convert(x);if(!q.info.interpolation)throw new Error(`${S}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(B,E,v,z,{object:q.object,info:q.info.interpolation},o)}catch(D){return Y.c.Warn(`${S}/pointer: Invalid pointer (${x}) skipped`),null}}}j(UE),H(UE,!0,(B=>new sE(B)));class JE{constructor(B,E,v){this.frame=B,this.action=E,this.onlyOnce=v,this.isDone=!1}_clone(){return new JE(this.frame,this.action,this.onlyOnce)}}var OE=v(11235),eE=v(11282),kE=v(11278);class LE{get loop(){return this._loop}set loop(B){B!==this._loop&&(this._loop=B,this.updateOptions({loop:B}))}get currentTime(){var B;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(B=eE.b.audioEngine)&&void 0!==B&&B.audioContext&&(this.isPlaying||this.isPaused)){const B=this.isPaused?0:eE.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+B}return 0}get spatialSound(){return this._spatialSound}set spatialSound(B){if(B==this._spatialSound)return;const E=this.isPlaying;this.pause(),B?(this._spatialSound=B,this._updateSpatialParameters()):this._disableSpatialSound(),E&&this.play()}constructor(B,E,v){var z;let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new h.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=o.GE.Zero(),this._localDirection=new o.GE(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=B,v=v||G.b.LastCreatedScene)if(this._scene=v,LE._SceneComponentInitialization(v),this._readyToPlayCallback=q,this._customAttenuationFunction=(B,E,v,z,o)=>E<v?B*(1-E/v):0,S&&(this.autoplay=S.autoplay||!1,this._loop=S.loop||!1,void 0!==S.volume&&(this._volume=S.volume),this._spatialSound=S.spatialSound??!1,this.maxDistance=S.maxDistance??100,this.useCustomAttenuation=S.useCustomAttenuation??!1,this.rolloffFactor=S.rolloffFactor||1,this.refDistance=S.refDistance||1,this.distanceModel=S.distanceModel||"linear",this._playbackRate=S.playbackRate||1,this._streaming=S.streaming??!1,this._length=S.length,this._offset=S.offset),null!==(z=eE.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&eE.b.audioEngine.audioContext){this._soundGain=eE.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let B=!0;if(E)try{"string"===typeof E?(this._urlType="String",this._url=E):E instanceof ArrayBuffer?this._urlType="ArrayBuffer":E instanceof HTMLMediaElement?this._urlType="MediaElement":E instanceof MediaStream?this._urlType="MediaStream":E instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(E)&&(this._urlType="Array");let v=[],z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eE.b.audioEngine.audioContext.createMediaElementSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eE.b.audioEngine.audioContext.createMediaStreamSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":E.byteLength>0&&(z=!0,this._soundLoaded(E));break;case"AudioBuffer":this._audioBufferLoaded(E);break;case"String":v.push(E);case"Array":0===v.length&&(v=E);for(let B=0;B<v.length;B++){const E=v[B];if(z=S&&S.skipCodecCheck||-1!==E.indexOf(".mp3",E.length-4)&&eE.b.audioEngine.isMP3supported||-1!==E.indexOf(".ogg",E.length-4)&&eE.b.audioEngine.isOGGsupported||-1!==E.indexOf(".wav",E.length-4)||-1!==E.indexOf(".m4a",E.length-4)||-1!==E.indexOf(".mp4",E.length-4)||-1!==E.indexOf("blob:"),z){this._streaming?(this._htmlAudioElement=new Audio(E),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,c.Tools.SetCorsBehavior(E,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(E,(B=>{this._soundLoaded(B)}),void 0,!0,!0,(B=>{B&&Y.c.Error("XHR "+B.status+" error on: "+E+"."),Y.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:B=!1}B?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Y.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(x){Y.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),eE.b.audioEngine&&!eE.b.audioEngine.WarnedWebAudioUnsupported&&(Y.c.Error("Web Audio is not supported by your browser."),eE.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var B;null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(B){var E;null!==(E=eE.b.audioEngine)&&void 0!==E&&E.audioContext&&(this._audioBuffer=B,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(B){var E;null!==(E=eE.b.audioEngine)&&void 0!==E&&E.audioContext&&eE.b.audioEngine.audioContext.decodeAudioData(B,(B=>{this._audioBufferLoaded(B)}),(B=>{Y.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+B)}))}setAudioBuffer(B){var E;null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this._audioBuffer=B,this._isReadyToPlay=!0)}updateOptions(B){B&&(this.loop=B.loop??this.loop,this.maxDistance=B.maxDistance??this.maxDistance,this.useCustomAttenuation=B.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=B.rolloffFactor??this.rolloffFactor,this.refDistance=B.refDistance??this.refDistance,this.distanceModel=B.distanceModel??this.distanceModel,this._playbackRate=B.playbackRate??this._playbackRate,this._length=B.length??void 0,this.spatialSound=B.spatialSound??this._spatialSound,this._setOffset(B.offset??void 0),this.setVolume(B.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var B;null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio&&eE.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??eE.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var B;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(B=this._soundPanner)||void 0===B||B.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var B;null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(B){var E;null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(B),this._isOutputConnected=!0)}setDirectionalCone(B,E,v){E<B?Y.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=B,this._coneOuterAngle=E,this._coneOuterGain=v,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(B){if(B!=this._coneInnerAngle){var E;if(this._coneOuterAngle<B)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=B,null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(B){if(B!=this._coneOuterAngle){var E;if(B<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=B,null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(B){var E;B.equals(this._position)||(this._position.S(B),null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(B){var E;this._localDirection=B,null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const B=this._connectedTransformNode.getWorldMatrix(),E=o.GE.TransformNormal(this._localDirection,B);E.normalize(),this._soundPanner.orientationX.value=E.x,this._soundPanner.orientationY.value=E.y,this._soundPanner.orientationZ.value=E.z}updateDistanceFromListener(){var B;if(null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const B=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.YE(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,B,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(B){this._customAttenuationFunction=B}play(B,E,v){var z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(z=eE.b.audioEngine)&&void 0!==z&&z.audioContext)try{var o,q;this._clearTimeoutsAndObservers();let z=B?(null===(o=eE.b.audioEngine)||void 0===o?void 0:o.audioContext.currentTime)+B:null===(q=eE.b.audioEngine)||void 0===q?void 0:q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=eE.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const B=()=>{var v;if(null!==(v=eE.b.audioEngine)&&void 0!==v&&v.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=E??0;const v=this._htmlAudioElement.play();void 0!==v&&v.catch((()=>{var E,v;(null===(E=eE.b.audioEngine)||void 0===E||E.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(v=eE.b.audioEngine)||void 0===v?void 0:v.onAudioUnlockedObservable.addOnce((()=>{B()})))}))}else{var z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(z=eE.b.audioEngine)||void 0===z?void 0:z.onAudioUnlockedObservable.addOnce((()=>{B()}))}};B()}}else{var c;const o=()=>{var o;if(null!==(o=eE.b.audioEngine)&&void 0!==o&&o.audioContext){var q;if(v=v||this._length,void 0!==E&&this._setOffset(E),this._soundSource){const B=this._soundSource;B.onended=()=>{B.disconnect()}}if(this._soundSource=null===(q=eE.b.audioEngine)||void 0===q?void 0:q.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var c;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==E&&(this._soundSource.loopStart=E),void 0!==v&&(this._soundSource.loopEnd=(0|E)+v),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},z=B?(null===(c=eE.b.audioEngine)||void 0===c?void 0:c.audioContext.currentTime)+B:eE.b.audioEngine.audioContext.currentTime;const o=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(z,o,this.loop?void 0:v)}}};"suspended"===(null===(c=eE.b.audioEngine)||void 0===c?void 0:c.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var B;"suspended"===(null===(B=eE.b.audioEngine)||void 0===B?void 0:B.audioContext.state)?(eE.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=eE.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{o()})))):o()}),500):o()}this._startTime=z,this.isPlaying=!0,this.isPaused=!1}catch(S){Y.c.Error("Error while trying to play audio: "+this.name+", "+S.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(B){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var v;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(v=this._streamingSource)||void 0===v||v.disconnect();this.isPlaying=!1}else if(null!==(E=eE.b.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource){const E=B?eE.b.audioEngine.audioContext.currentTime+B:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(E)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var B;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var E;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(E=this._streamingSource)||void 0===E||E.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(B=eE.b.audioEngine)&&void 0!==B&&B.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=eE.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(B,E){var v;null!==(v=eE.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._soundGain&&(E&&eE.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(eE.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,eE.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(B,eE.b.audioEngine.audioContext.currentTime+E)):this._soundGain.gain.value=B),this._volume=B}setPlaybackRate(B){this._playbackRate=B,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(B){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=B,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=B=>this._onRegisterAfterWorldMatrixUpdate(B),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(B){var E;if(B.getBoundingInfo){const E=B.getBoundingInfo();this.setPosition(E.boundingSphere.centerWorld)}else this.setPosition(B.absolutePosition);null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const B=()=>{(0,kE.f)((()=>this._isReadyToPlay),(()=>{v._audioBuffer=this.getAudioBuffer(),v._isReadyToPlay=!0,v.autoplay&&v.play(0,this._offset,this._length)}),void 0,300)},E={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},v=new LE(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,E);return this.useCustomAttenuation&&v.setAttenuationFunction(this._customAttenuationFunction),v.setPosition(this._position),v.setPlaybackRate(this._playbackRate),B(),v}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const B={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(B.connectedMeshId=this._connectedTransformNode.id),B.position=this._position.cc(),B.refDistance=this.refDistance,B.distanceModel=this.distanceModel,B.isDirectional=this._isDirectional,B.localDirectionToMesh=this._localDirection.cc(),B.coneInnerAngle=this._coneInnerAngle,B.coneOuterAngle=this._coneOuterAngle,B.coneOuterGain=this._coneOuterGain),B}static Parse(B,E,v,z){const q=B.name;let c;c=B.url?v+B.url:v+q;const S={autoplay:B.autoplay,loop:B.loop,volume:B.volume,spatialSound:B.spatialSound,maxDistance:B.maxDistance,rolloffFactor:B.rolloffFactor,refDistance:B.refDistance,distanceModel:B.distanceModel,playbackRate:B.playbackRate};let x;if(z){const B=()=>{(0,kE.f)((()=>z._isReadyToPlay),(()=>{x._audioBuffer=z.getAudioBuffer(),x._isReadyToPlay=!0,x.autoplay&&x.play(0,x._offset,x._length)}),void 0,300)};x=new LE(q,new ArrayBuffer(0),E,null,S),B()}else x=new LE(q,c,E,(()=>{E.removePendingData(x)}),S),E.addPendingData(x);if(B.position){const E=o.GE.VE(B.position);x.setPosition(E)}if(B.isDirectional&&(x.setDirectionalCone(B.coneInnerAngle||360,B.coneOuterAngle||360,B.coneOuterGain||0),B.localDirectionToMesh)){const E=o.GE.VE(B.localDirectionToMesh);x.setLocalDirectionToMesh(E)}if(B.connectedMeshId){const v=E.getMeshById(B.connectedMeshId);v&&x.attachToMesh(v)}return B.metadata&&(x.metadata=B.metadata),x}_setOffset(B){this._offset!==B&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=B)}_clearTimeoutsAndObservers(){var B;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(B=eE.b.audioEngine)||void 0===B||B.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}LE._SceneComponentInitialization=B=>{throw(0,OE.e)("AudioSceneComponent")},(0,XB.f)("BABYLON.Sound",LE);class ME{constructor(B,E,v){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],E.length!==v.length)throw new Error("Sounds length does not equal weights length");this.loop=B,this._weights=v;let z=0;for(const q of v)z+=q;const o=z>0?1/z:0;for(let q=0;q<this._weights.length;q++)this._weights[q]*=o;this._sounds=E;for(const q of this._sounds)q.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(B){if(B!==this._coneInnerAngle){if(this._coneOuterAngle<B)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=B;for(const E of this._sounds)E.directionalConeInnerAngle=B}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(B){if(B!==this._coneOuterAngle){if(B<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=B;for(const E of this._sounds)E.directionalConeOuterAngle=B}}get volume(){return this._volume}set volume(B){if(B!==this._volume)for(const E of this._sounds)E.setVolume(B)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(B){if(!this.isPaused){this.stop();const B=Math.random();let E=0;for(let v=0;v<this._weights.length;v++)if(E+=this._weights[v],B<=E){this._currentIndex=v;break}}const E=this._sounds[this._currentIndex??0];E.isReady()?E.play(0,this.isPaused?void 0:B):E.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class ZE{constructor(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(B=B||G.b.LastCreatedScene)&&(this._scene=B,this.soundCollection=[],this._options=E,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var B;null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio&&eE.b.audioEngine.audioContext&&(this._outputAudioNode=eE.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(eE.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(eE.b.audioEngine&&eE.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(B){var E;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&B.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==B.soundTrackId&&(-1===B.soundTrackId?this._scene.mainSoundTrack.removeSound(B):this._scene.soundTracks&&this._scene.soundTracks[B.soundTrackId].removeSound(B)),this.soundCollection.push(B),B.soundTrackId=this.id}removeSound(B){const E=this.soundCollection.indexOf(B);-1!==E&&this.soundCollection.splice(E,1)}setVolume(B){var E;null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=B)}switchPanningModelToHRTF(){var B;if(null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var B;if(null!==(B=eE.b.audioEngine)&&void 0!==B&&B.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToEqualPower()}connectToAnalyser(B){var E;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=B,null!==(E=eE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,eE.b.audioEngine.masterGain))}}var Bv=v(11643),Ev=v(11601),vv=v(11211);eE.b.AudioEngineFactory=(B,E,v)=>new zv(B,E,v);class zv{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new h.e,this.onAudioLockedObservable=new h.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,vv.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const z=document.createElement("audio");this._hostElement=B,this._audioContext=E,this._audioDestination=v;try{z&&z.canPlayType&&(z.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||z.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(o){}try{z&&z.canPlayType&&z.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(o){}}lock(){this._triggerSuspendedState()}unlock(){var B,E;if("running"===(null===(B=this._audioContext)||void 0===B?void 0:B.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(E=this._audioContext)||void 0===E||E.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Y.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var B;null===(B=this._audioContext)||void 0===B||B.addEventListener("statechange",(()=>{var B;this.unlocked&&"running"!==(null===(B=this._audioContext)||void 0===B?void 0:B.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var B;return null!==(B=this._audioContext)&&void 0!==B&&B.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(B){this.canUseWebAudio=!1,Y.c.Error("Web Audio: "+B.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(B){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const B=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",E=document.createElement("style");E.appendChild(document.createTextNode(B)),document.getElementsByTagName("head")[0].appendChild(E),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var B;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(B=this._audioContext)||void 0===B||B.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(B){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=B)}connectToAnalyser(B){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=B,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var ov=v(11230);(0,v(12768).e)(Bv.b.NAME_AUDIO,((B,E,v,z)=>{let o,q=[];if(v.VP=v.VP||[],void 0!==B.VP&&null!==B.VP)for(let S=0,x=B.VP.length;S<x;S++){var c;const x=B.VP[S];null!==(c=eE.b.audioEngine)&&void 0!==c&&c.canUseWebAudio?(x.url||(x.url=x.name),q[x.url]?v.VP.push(LE.Parse(x,E,z,q[x.url])):(o=LE.Parse(x,E,z),q[x.url]=o,v.VP.push(o))):v.VP.push(new LE(x.name,null,E))}q=[]})),Object.defineProperty(Ev.c.prototype,"mainSoundTrack",{get:function(){let B=this._getComponent(Bv.b.NAME_AUDIO);return B||(B=new qv(this),this.o(B)),this._mainSoundTrack||(this._mainSoundTrack=new ZE(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Ev.c.prototype.getSoundByName=function(B){let E;for(E=0;E<this.mainSoundTrack.soundCollection.length;E++)if(this.mainSoundTrack.soundCollection[E].name===B)return this.mainSoundTrack.soundCollection[E];if(this.soundTracks)for(let v=0;v<this.soundTracks.length;v++)for(E=0;E<this.soundTracks[v].soundCollection.length;E++)if(this.soundTracks[v].soundCollection[E].name===B)return this.soundTracks[v].soundCollection[E];return null},Object.defineProperty(Ev.c.prototype,"audioEnabled",{get:function(){let B=this._getComponent(Bv.b.NAME_AUDIO);return B||(B=new qv(this),this.o(B)),B.audioEnabled},set:function(B){let E=this._getComponent(Bv.b.NAME_AUDIO);E||(E=new qv(this),this.o(E)),B?E.enableAudio():E.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Ev.c.prototype,"headphone",{get:function(){let B=this._getComponent(Bv.b.NAME_AUDIO);return B||(B=new qv(this),this.o(B)),B.headphone},set:function(B){let E=this._getComponent(Bv.b.NAME_AUDIO);E||(E=new qv(this),this.o(E)),B?E.switchAudioModeForHeadphones():E.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Ev.c.prototype,"audioListenerPositionProvider",{get:function(){let B=this._getComponent(Bv.b.NAME_AUDIO);return B||(B=new qv(this),this.o(B)),B.audioListenerPositionProvider},set:function(B){let E=this._getComponent(Bv.b.NAME_AUDIO);if(E||(E=new qv(this),this.o(E)),B&&"function"!==typeof B)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");E.audioListenerPositionProvider=B},enumerable:!0,configurable:!0}),Object.defineProperty(Ev.c.prototype,"audioListenerRotationProvider",{get:function(){let B=this._getComponent(Bv.b.NAME_AUDIO);return B||(B=new qv(this),this.o(B)),B.audioListenerRotationProvider},set:function(B){let E=this._getComponent(Bv.b.NAME_AUDIO);if(E||(E=new qv(this),this.o(E)),B&&"function"!==typeof B)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");E.audioListenerRotationProvider=B},enumerable:!0,configurable:!0}),Object.defineProperty(Ev.c.prototype,"audioPositioningRefreshRate",{get:function(){let B=this._getComponent(Bv.b.NAME_AUDIO);return B||(B=new qv(this),this.o(B)),B.audioPositioningRefreshRate},set:function(B){let E=this._getComponent(Bv.b.NAME_AUDIO);E||(E=new qv(this),this.o(E)),E.audioPositioningRefreshRate=B},enumerable:!0,configurable:!0});class qv{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(B){this.name=Bv.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new o.GE,this._cachedCameraPosition=new o.GE,this._lastCheck=0,this._invertMatrixTemp=new o.Matrix,this._cameraDirectionTemp=new o.GE,(B=B||G.b.LastCreatedScene)&&(this.aE=B,B.soundTracks=[],B.VP=[])}register(){this.aE._afterRenderStage.registerStep(Bv.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(B){if(B.VP=[],this.aE.soundTracks)for(let E=0;E<this.aE.soundTracks.length;E++){const v=this.aE.soundTracks[E];for(let E=0;E<v.soundCollection.length;E++)B.VP.push(v.soundCollection[E].serialize())}}addFromContainer(B){if(B.VP)for(const E of B.VP)E.play(),E.autoplay=!0,this.aE.mainSoundTrack.addSound(E)}removeFromContainer(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(B.VP)for(const v of B.VP)v.stop(),v.autoplay=!1,this.aE.mainSoundTrack.removeSound(v),E&&v.dispose()}dispose(){const B=this.aE;if(B._mainSoundTrack&&B.mainSoundTrack.dispose(),B.soundTracks)for(let E=0;E<B.soundTracks.length;E++)B.soundTracks[E].dispose()}disableAudio(){const B=this.aE;let E;for(this._audioEnabled=!1,eE.b.audioEngine&&eE.b.audioEngine.audioContext&&eE.b.audioEngine.audioContext.suspend(),E=0;E<B.mainSoundTrack.soundCollection.length;E++)B.mainSoundTrack.soundCollection[E].pause();if(B.soundTracks)for(E=0;E<B.soundTracks.length;E++)for(let v=0;v<B.soundTracks[E].soundCollection.length;v++)B.soundTracks[E].soundCollection[v].pause()}enableAudio(){const B=this.aE;let E;for(this._audioEnabled=!0,eE.b.audioEngine&&eE.b.audioEngine.audioContext&&eE.b.audioEngine.audioContext.resume(),E=0;E<B.mainSoundTrack.soundCollection.length;E++)B.mainSoundTrack.soundCollection[E].isPaused&&B.mainSoundTrack.soundCollection[E].play();if(B.soundTracks)for(E=0;E<B.soundTracks.length;E++)for(let v=0;v<B.soundTracks[E].soundCollection.length;v++)B.soundTracks[E].soundCollection[v].isPaused&&B.soundTracks[E].soundCollection[v].play()}switchAudioModeForHeadphones(){const B=this.aE;if(this._headphone=!0,B.mainSoundTrack.switchPanningModelToHRTF(),B.soundTracks)for(let E=0;E<B.soundTracks.length;E++)B.soundTracks[E].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const B=this.aE;if(this._headphone=!1,B.mainSoundTrack.switchPanningModelToEqualPower(),B.soundTracks)for(let E=0;E<B.soundTracks.length;E++)B.soundTracks[E].switchPanningModelToEqualPower()}_afterRender(){const B=ov.e.Now;if(this._lastCheck&&B-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=B;const E=this.aE;if(!this._audioEnabled||!E._mainSoundTrack||!E.soundTracks||0===E._mainSoundTrack.soundCollection.length&&1===E.soundTracks.length)return;const v=eE.b.audioEngine;if(v&&v.audioContext){let B,z=E.activeCamera;if(E.activeCameras&&E.activeCameras.length>0&&(z=E.activeCameras[0]),this.audioListenerPositionProvider){const B=this.audioListenerPositionProvider();v.audioContext.listener.setPosition(B.x||0,B.y||0,B.z||0)}else z?this._cachedCameraPosition.equals(z.globalPosition)||(this._cachedCameraPosition.S(z.globalPosition),v.audioContext.listener.setPosition(z.globalPosition.x,z.globalPosition.y,z.globalPosition.z)):v.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const B=this.audioListenerRotationProvider();v.audioContext.listener.setOrientation(B.x||0,B.y||0,B.z||0,0,1,0)}else z?(z.rigCameras&&z.rigCameras.length>0&&(z=z.rigCameras[0]),z.getViewMatrix().invertToRef(this._invertMatrixTemp),o.GE.TransformNormalToRef(qv._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.S(this._cameraDirectionTemp),v.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):v.audioContext.listener.setOrientation(0,0,0,0,1,0);for(B=0;B<E.mainSoundTrack.soundCollection.length;B++){const v=E.mainSoundTrack.soundCollection[B];v.useCustomAttenuation&&v.updateDistanceFromListener()}if(E.soundTracks)for(B=0;B<E.soundTracks.length;B++)for(let v=0;v<E.soundTracks[B].soundCollection.length;v++){const z=E.soundTracks[B].soundCollection[v];z.useCustomAttenuation&&z.updateDistanceFromListener()}}}}qv._CameraDirection=new o.GE(0,0,-1),LE._SceneComponentInitialization=B=>{let E=B._getComponent(Bv.b.NAME_AUDIO);E||(E=new qv(B),B.o(E))};const cv="MSFT_audio_emitter";class Sv{constructor(B){this.name=cv,this._loader=B,this.enabled=this._loader.isExtensionUsed(cv)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const B=this._loader.vc.extensions;if(B&&B[this.name]){const E=B[this.name];this._clips=E.clips,this._emitters=E.emitters,W.Assign(this._clips),W.Assign(this._emitters)}}loadSceneAsync(B,E){return n.LoadExtensionAsync(B,E,this.name,(async(v,z)=>{const o=new Array;o.push(this._loader.loadSceneAsync(B,E));for(const B of z.emitters){const E=W.Get(`${v}/emitters`,this._emitters,B);if(void 0!=E.refDistance||void 0!=E.maxDistance||void 0!=E.rolloffFactor||void 0!=E.distanceModel||void 0!=E.innerAngle||void 0!=E.outerAngle)throw new Error(`${v}: Direction or Distance properties are not allowed on emitters attached to a scene`);o.push(this._loadEmitterAsync(`${v}/emitters/${E.index}`,E))}await Promise.all(o)}))}loadNodeAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(B,z)=>{const q=new Array,S=await this._loader.loadNodeAsync(B,E,(E=>{for(const v of z.emitters){const z=W.Get(`${B}/emitters`,this._emitters,v);q.push(this._loadEmitterAsync(`${B}/emitters/${z.index}`,z).then((()=>{for(const B of z._babylonSounds)B.attachToMesh(E),void 0==z.innerAngle&&void 0==z.outerAngle||(B.setLocalDirectionToMesh(o.GE.Forward()),B.setDirectionalCone(2*c.Tools.ToDegrees(void 0==z.innerAngle?Math.PI:z.innerAngle),2*c.Tools.ToDegrees(void 0==z.outerAngle?Math.PI:z.outerAngle),0))})))}v(E)}));return await Promise.all(q),S}))}loadAnimationAsync(B,E){return n.LoadExtensionAsync(B,E,this.name,(async(v,z)=>{const o=await this._loader.loadAnimationAsync(B,E),q=new Array;W.Assign(z.events);for(const c of z.events)q.push(this._loadAnimationEventAsync(`${v}/events/${c.index}`,B,E,c,o));return await Promise.all(q),o}))}_loadClipAsync(B,E){if(E._objectURL)return E._objectURL;let v;if(E.uri)v=this._loader.loadUriAsync(B,E,E.uri);else{const z=W.Get(`${B}/bufferView`,this._loader.vc.bufferViews,E.bufferView);v=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z)}return E._objectURL=v.then((B=>URL.createObjectURL(new Blob([B],{type:E.mimeType})))),E._objectURL}_loadEmitterAsync(B,E){if(E._babylonSounds=E._babylonSounds||[],!E._babylonData){const B=new Array,v=E.name||`emitter${E.index}`,z={loop:!1,autoplay:!1,volume:void 0==E.volume?1:E.volume};for(let q=0;q<E.clips.length;q++){const o=`/extensions/${this.name}/clips`,c=W.Get(o,this._clips,E.clips[q].clip);B.push(this._loadClipAsync(`${o}/${E.clips[q].clip}`,c).then((B=>{const o=E._babylonSounds[q]=new LE(v,B,this._loader.babylonScene,null,z);o.refDistance=E.refDistance||1,o.maxDistance=E.maxDistance||256,o.rolloffFactor=E.rolloffFactor||1,o.distanceModel=E.distanceModel||"exponential"})))}const o=Promise.all(B).then((()=>{const B=E.clips.map((B=>B.weight||1)),v=new ME(E.loop||!1,E._babylonSounds,B);E.innerAngle&&(v.directionalConeInnerAngle=2*c.Tools.ToDegrees(E.innerAngle)),E.outerAngle&&(v.directionalConeOuterAngle=2*c.Tools.ToDegrees(E.outerAngle)),E.volume&&(v.volume=E.volume),E._babylonData.sound=v}));E._babylonData={loaded:o}}return E._babylonData.loaded}_getEventAction(B,E,v,z,o){switch(v){case"play":return B=>{const v=(o||0)+(B-z);E.play(v)};case"stop":return()=>{E.stop()};case"pause":return()=>{E.pause()};default:throw new Error(`${B}: Unsupported action ${v}`)}}_loadAnimationEventAsync(B,E,v,z,o){if(0==o.targetedAnimations.length)return Promise.resolve();const q=o.targetedAnimations[0],c=z.zE,S=W.Get(`/extensions/${this.name}/emitters`,this._emitters,c);return this._loadEmitterAsync(B,S).then((()=>{const E=S._babylonData.sound;if(E){const v=new JE(z.time,this._getEventAction(B,E,z.action,z.time,z.startOffset));q.animation.addEvent(v),o.onAnimationGroupEndObservable.add((()=>{E.stop()})),o.onAnimationGroupPauseObservable.add((()=>{E.pause()}))}}))}}j(cv),H(cv,!0,(B=>new Sv(B)));const xv="MSFT_lod";class Dv{constructor(B){var E;this.name=xv,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new h.e,this.onMaterialLODsLoadedObservable=new h.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=B,this.maxLODsToLoad=(null===(E=this._loader.parent.extensionOptions[xv])||void 0===E?void 0:E.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(xv)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let B=0;B<this._nodePromiseLODs.length;B++){const E=Promise.all(this._nodePromiseLODs[B]).then((()=>{0!==B&&(this._loader.endPerformanceCounter(`Node LOD ${B}`),this._loader.log(`Loaded node LOD ${B}`)),this.onNodeLODsLoadedObservable.notifyObservers(B),B!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${B+1}`),this._loadBufferLOD(this._nodeBufferLODs,B+1),this._nodeSignalLODs[B]&&this._nodeSignalLODs[B].resolve())}));this._loader._completePromises.push(E)}for(let B=0;B<this._materialPromiseLODs.length;B++){const E=Promise.all(this._materialPromiseLODs[B]).then((()=>{0!==B&&(this._loader.endPerformanceCounter(`Material LOD ${B}`),this._loader.log(`Loaded material LOD ${B}`)),this.onMaterialLODsLoadedObservable.notifyObservers(B),B!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${B+1}`),this._loadBufferLOD(this._materialBufferLODs,B+1),this._materialSignalLODs[B]&&this._materialSignalLODs[B].resolve())}));this._loader._completePromises.push(E)}}loadSceneAsync(B,E){const v=this._loader.loadSceneAsync(B,E);return this._loadBufferLOD(this._bufferLODs,0),v}loadNodeAsync(B,E,v){return n.LoadExtensionAsync(B,E,this.name,(async(B,o)=>{let q;const c=this._getLODs(B,E,this._loader.vc.nodes,o.ids);this._loader.logOpen(`${B}`);for(let E=0;E<c.length;E++){const B=c[E];0!==E&&(this._nodeIndexLOD=E,this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new z);const o=B=>{v(B),B.ox(!1)},S=this._loader.loadNodeAsync(`/nodes/${B.index}`,B,o).then((B=>{if(0!==E){const B=c[E-1];B._babylonTransformNode&&(this._disposeTransformNode(B._babylonTransformNode),delete B._babylonTransformNode)}return B.ox(!0),B}));this._nodePromiseLODs[E]=this._nodePromiseLODs[E]||[],0===E?q=S:(this._nodeIndexLOD=null,this._nodePromiseLODs[E].push(S))}return this._loader.logClose(),await q}))}_loadMaterialAsync(B,E,v,z,o){return this._nodeIndexLOD?null:n.LoadExtensionAsync(B,E,this.name,(async(B,q)=>{let c;const S=this._getLODs(B,E,this._loader.vc.materials,q.ids);this._loader.logOpen(`${B}`);for(let E=0;E<S.length;E++){const B=S[E];0!==E&&(this._materialIndexLOD=E);const q=this._loader._loadMaterialAsync(`/materials/${B.index}`,B,v,z,(B=>{0===E&&o(B)})).then((B=>{if(0!==E){o(B);const v=S[E-1]._data;v[z]&&(this._disposeMaterials([v[z].babylonMaterial]),delete v[z])}return B}));this._materialPromiseLODs[E]=this._materialPromiseLODs[E]||[],0===E?c=q:(this._materialIndexLOD=null,this._materialPromiseLODs[E].push(q))}return this._loader.logClose(),await c}))}_loadUriAsync(B,E,v){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const o=this._nodeIndexLOD-1;return this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(B,E,v)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const o=this._materialIndexLOD-1;return this._materialSignalLODs[o]=this._materialSignalLODs[o]||new z,this._materialSignalLODs[o].promise.then((async()=>await this._loader.loadUriAsync(B,E,v)))}return null}loadBufferAsync(B,E,v,o){if(this._loader.parent.useRangeRequests&&!E.uri){if(!this._loader.bin)throw new Error(`${B}: Uri is missing or the binary glTF is missing its binary chunk`);const E=async(B,E)=>{const q=v,c=q+o-1;let S=B[E];return S?(S.start=Math.min(S.start,q),S.end=Math.max(S.end,c)):(S={start:q,end:c,loaded:new z},B[E]=S),await S.loaded.promise.then((B=>new Uint8Array(B.buffer,B.byteOffset+v-S.start,o)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?E(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?E(this._materialBufferLODs,this._materialIndexLOD):E(this._bufferLODs,0)}return null}_loadBufferLOD(B,E){const v=B[E];v&&(this._loader.log(`Loading buffer range [${v.start}-${v.end}]`),this._loader.bin.readAsync(v.start,v.end-v.start+1).then((B=>{v.loaded.resolve(B)}),(B=>{v.loaded.reject(B)})))}_getLODs(B,E,v,z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const o=[];for(let q=z.length-1;q>=0;q--)if(o.push(W.Get(`${B}/ids/${z[q]}`,v,z[q])),o.length===this.maxLODsToLoad)return o;return o.push(E),o}_disposeTransformNode(B){const E=[],v=B.material;v&&E.push(v);for(const o of B.getChildMeshes())o.material&&E.push(o.material);B.dispose();const z=E.filter((B=>this._loader.babylonScene.meshes.every((E=>E.material!=B))));this._disposeMaterials(z)}_disposeMaterials(B){const E={};for(const v of B){for(const B of v.getActiveTextures())E[B.uniqueId]=B;v.dispose()}for(const v in E)for(const B of this._loader.babylonScene.materials)B.hasTexture(E[v])&&delete E[v];for(const v in E)E[v].dispose()}}j(xv),H(xv,!0,(B=>new Dv(B)));const hv="MSFT_minecraftMesh";class yv{constructor(B){this.name=hv,this._loader=B,this.enabled=this._loader.isExtensionUsed(hv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtraAsync(B,E,this.name,(async(z,o)=>{if(o){if(!(v instanceof V.c))throw new Error(`${z}: Material type not supported`);const o=this._loader.loadMaterialPropertiesAsync(B,E,v);return v.needAlphaBlending()&&(v.forceDepthWrite=!0,v.separateCullingPass=!0),v.Gc=v.forceDepthWrite,v.twoSidedLighting=!0,await o}}))}}j(hv),H(hv,!0,(B=>new yv(B)));const Qv="MSFT_sRGBFactors";class Pv{constructor(B){this.name=Qv,this._loader=B,this.enabled=this._loader.isExtensionUsed(Qv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,E,v){return n.LoadExtraAsync(B,E,this.name,(async(z,o)=>{if(o){if(!(v instanceof V.c))throw new Error(`${z}: Material type not supported`);const o=this._loader.loadMaterialPropertiesAsync(B,E,v),q=v.rB().getEngine().useExactSrgbConversions;return v.albedoTexture||v.albedoColor.toLinearSpaceToRef(v.albedoColor,q),v.reflectivityTexture||v.reflectivityColor.toLinearSpaceToRef(v.reflectivityColor,q),await o}}))}}j(Qv),H(Qv,!0,(B=>new Pv(B)));var Gv=v(13083);const Yv={};var av=v(13135),mv=v(13116),gv=v(13090),Vv=v(13102);function Tv(B,E){for(const v of B)for(const B of v.dataOutputs)if(B.uniqueId===E)return B;throw new Error("Could not find data out connection with unique id "+E)}function Nv(B,E){for(const v of B)if(v instanceof mv.e)for(const B of v.signalInputs)if(B.uniqueId===E)return B;throw new Error("Could not find signal in connection with unique id "+E)}async function Xv(B,E){const z=await Promise.all(B.allBlocks.map((async B=>{const E=function(B){switch(B){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([v.e(78),v.e(79)]).then(v.bind(v,14517))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await v.e(80).then(v.bind(v,14526))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await v.e(81).then(v.bind(v,14529))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await v.e(82).then(v.bind(v,14536))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await v.e(83).then(v.bind(v,14541))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await v.e(84).then(v.bind(v,14550))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await v.e(85).then(v.bind(v,14556))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await v.e(86).then(v.bind(v,14562))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await v.e(87).then(v.bind(v,14564))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await v.e(90).then(v.bind(v,14600))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await v.e(90).then(v.bind(v,14600))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await v.e(90).then(v.bind(v,14600))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await v.e(90).then(v.bind(v,14600))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await v.e(95).then(v.bind(v,14604))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await v.e(96).then(v.bind(v,14606))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await v.e(97).then(v.bind(v,14611))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await v.e(98).then(v.bind(v,14619))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await v.e(99).then(v.bind(v,14621))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await v.e(100).then(v.bind(v,14629))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await v.e(101).then(v.bind(v,14635))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await v.e(102).then(v.bind(v,14641))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await v.e(103).then(v.bind(v,14650))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await v.e(104).then(v.bind(v,14659))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await v.e(105).then(v.bind(v,14664))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await v.e(106).then(v.bind(v,14669))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await v.e(107).then(v.bind(v,14671))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await v.e(108).then(v.bind(v,14680))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await v.e(109).then(v.bind(v,14688))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await v.e(110).then(v.bind(v,14694))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await v.e(111).then(v.bind(v,14698))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await v.e(112).then(v.bind(v,14703))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await v.e(113).then(v.bind(v,14705))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await v.e(92).then(v.bind(v,14707))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await v.e(114).then(v.bind(v,14711))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await v.e(115).then(v.bind(v,14713))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await v.e(116).then(v.bind(v,14722))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await v.e(93).then(v.bind(v,14731))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await v.e(88).then(v.bind(v,14571))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await v.e(94).then(v.bind(v,14740))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await v.e(89).then(v.bind(v,14597))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await v.e(90).then(v.bind(v,14600))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await v.e(90).then(v.bind(v,14600))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await v.e(91).then(v.bind(v,14743))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await v.e(91).then(v.bind(v,14743))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await v.e(91).then(v.bind(v,14743))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await v.e(91).then(v.bind(v,14743))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await v.e(91).then(v.bind(v,14743))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await v.e(91).then(v.bind(v,14743))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await v.e(117).then(v.bind(v,14745))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await v.e(118).then(v.bind(v,14753))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await v.e(119).then(v.bind(v,14755))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await v.e(120).then(v.bind(v,14761))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await v.e(121).then(v.bind(v,14770))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await v.e(122).then(v.bind(v,14779))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await v.e(123).then(v.bind(v,14781))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await v.e(124).then(v.bind(v,14789))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await v.e(125).then(v.bind(v,14797))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await v.e(126).then(v.bind(v,14803))).FlowGraphDataSwitchBlock;default:if(Yv[B])return Yv[B];throw new Error(`Unknown block name ${B}`)}}(B.className);return await E()})));return function(B,E,v){const z=E.coordinator.createGraph(),o=[],q=E.valueParseFunction??gv.c;for(let c=0;c<B.allBlocks.length;c++){const S=iv(B.allBlocks[c],{aE:E.coordinator.config.aE,pathConverter:E.pathConverter,assetsContainer:E.coordinator.config.aE,valueParseFunction:q},v[c]);o.push(S),S instanceof av.b&&z.addEventBlock(S)}for(const c of o){for(const B of c.dataInputs)for(const E of B.connectedPointIds){const v=Tv(o,E);B.connectTo(v)}if(c instanceof mv.e)for(const B of c.signalOutputs)for(const E of B.connectedPointIds){const v=Nv(o,E);B.connectTo(v)}}for(const c of B.executionContexts)rv(c,{graph:z,valueParseFunction:q},B.rightHanded);return z}(B,E,z)}function rv(B,E,v){const z=E.graph.createContext();B.enableLogging&&(z.enableLogging=!0),z.treatDataAsRightHanded=v||!1;const o=E.valueParseFunction??gv.c;z.uniqueId=B.uniqueId;const q=z.rB();if(B._assetsContext){var c,S,x,D,h,y,Q,P,G,Y;const E=B._assetsContext,v={meshes:null===(c=E.meshes)||void 0===c?void 0:c.map((B=>q.getMeshById(B))),lights:null===(S=E.lights)||void 0===S?void 0:S.map((B=>q.getLightByName(B))),cameras:null===(x=E.cameras)||void 0===x?void 0:x.map((B=>q.getCameraByName(B))),materials:null===(D=E.materials)||void 0===D?void 0:D.map((B=>q.getMaterialById(B))),textures:null===(h=E.textures)||void 0===h?void 0:h.map((B=>q.getTextureByName(B))),animations:null===(y=E.animations)||void 0===y?void 0:y.map((B=>q.animations.find((E=>E.name===B)))),skeletons:null===(Q=E.skeletons)||void 0===Q?void 0:Q.map((B=>q.getSkeletonByName(B))),bQ:null===(P=E.bQ)||void 0===P?void 0:P.map((B=>q.getParticleSystemById(B))),animationGroups:null===(G=E.animationGroups)||void 0===G?void 0:G.map((B=>q.getAnimationGroupByName(B))),transformNodes:null===(Y=E.transformNodes)||void 0===Y?void 0:Y.map((B=>q.getTransformNodeById(B))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],VP:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};z.assetsContext=v}for(const a in B._userVariables){const E=o(a,B._userVariables,z.assetsContext,q);z.userVariables[a]=E}for(const a in B._connectionValues){const E=o(a,B._connectionValues,z.assetsContext,q);z._setConnectionValueByKey(a,E)}return z}function iv(B,E,v){const z={},o=E.valueParseFunction??gv.c;if(B.config)for(const c in B.config)z[c]=o(c,B.config,E.assetsContainer||E.aE,E.aE);if((0,gv.h)(B.className)){if(!E.pathConverter)throw new Error("Path converter is required for this block");z.pathConverter=E.pathConverter}const q=new v(z);q.uniqueId=B.uniqueId;for(let c=0;c<B.dataInputs.length;c++){const E=q.getDataInput(B.dataInputs[c].name);if(!E)throw new Error("Could not find data input with name "+B.dataInputs[c].name+" in block "+B.className);E.deserialize(B.dataInputs[c])}for(let c=0;c<B.dataOutputs.length;c++){const E=q.getDataOutput(B.dataOutputs[c].name);if(!E)throw new Error("Could not find data output with name "+B.dataOutputs[c].name+" in block "+B.className);E.deserialize(B.dataOutputs[c])}return q.metadata=B.metadata,q.deserialize&&q.deserialize(B),q}function uv(B){const[E,v]=B.split(":");return Iv({op:E,extension:v})}function Iv(B){var E;let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const z=B.extension?null===(E=Cv[B.extension])||void 0===E?void 0:E[B.op]:fv[B.op];if(!z&&(Y.c.Warn(`No mapping found for operation ${B.op} and extension ${B.extension||"KHR_interactivity"}`),v)){const E={},v={flows:{}};if(B.inputValueSockets){E.values={};for(const v in B.inputValueSockets)E.values[v]={name:v}}return B.outputValueSockets&&(v.values={},Object.keys(B.outputValueSockets).forEach((B=>{v.values[B]={name:B}}))),{Mh:[],inputs:E,outputs:v}}return z}function Kv(B,E,v){Cv[E]||(Cv[E]={}),Cv[E][B]=v}const Cv={BABYLON:{"flow/log":{Mh:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},fv={"event/onStart":{Mh:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Mh:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Mh:["FlowGraphSendCustomEventBlock"],extraProcessor(B,E,v,z,o){if("event/send"!==E.op||!B.configuration||1!==Object.keys(B.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const q=B.configuration.event.value[0];if("number"!==typeof q)throw new Error("Event id should be a number");const c=z.arrays.events[q],S=o[0];return S.config||(S.config={}),S.config.eventId=c.eventId,S.config.eventData=c.eventData,o}},"event/receive":{Mh:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(B,E){var v;if(!B.configuration)return Y.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const z=B.configuration.event;if(!z)return Y.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const o=z.value[0];if("number"!==typeof o)return Y.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(v=E.events)||void 0===v?void 0:v[o])?{valid:!0}:(Y.c.Error(`Event with id ${o} not found`),{valid:!1,error:`Event with id ${o} not found`})},extraProcessor(B,E,v,z,o){if("event/receive"!==E.op||!B.configuration||1!==Object.keys(B.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const q=B.configuration.event.value[0];if("number"!==typeof q)throw new Error("Event id should be a number");const c=z.arrays.events[q],S=o[0];return S.config||(S.config={}),S.config.eventId=c.eventId,S.config.eventData=c.eventData,o}},"math/e":Av("FlowGraphEBlock"),"math/pi":Av("FlowGraphPIBlock"),"math/inf":Av("FlowGraphInfBlock"),"math/nan":Av("FlowGraphNaNBlock"),"math/abs":Av("FlowGraphAbsBlock"),"math/sign":Av("FlowGraphSignBlock"),"math/trunc":Av("FlowGraphTruncBlock"),"math/floor":Av("FlowGraphFloorBlock"),"math/ceil":Av("FlowGraphCeilBlock"),"math/round":{Mh:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o){var q;return(q=o[0]).config||(q.config={}),o[0].config.roundHalfAwayFromZero=!0,o}},"math/fract":Av("FlowGraphFractBlock"),"math/neg":Av("FlowGraphNegationBlock"),"math/add":Av("FlowGraphAddBlock",["a","b"],!0),"math/sub":Av("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Mh:["FlowGraphMultiplyBlock"],extraProcessor(B,E,v,z,o){var q;(q=o[0]).config||(q.config={}),o[0].config.useMatrixPerComponent=!0,o[0].config.preventIntegerFloatArithmetic=!0;let c=-1;return Object.keys(B.values||{}).find((E=>{var v;return void 0!==(null===(v=B.values)||void 0===v?void 0:v[E].type)&&(c=B.values[E].type,!0)})),-1!==c&&(o[0].config.type=z.arrays.types[c].flowGraphType),o},validation:B=>B.values?lv(B):{valid:!0}},"math/div":Av("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Av("FlowGraphModuloBlock",["a","b"]),"math/min":Av("FlowGraphMinBlock",["a","b"]),"math/max":Av("FlowGraphMaxBlock",["a","b"]),"math/clamp":Av("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Av("FlowGraphSaturateBlock"),"math/mix":Av("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Av("FlowGraphEqualityBlock",["a","b"]),"math/lt":Av("FlowGraphLessThanBlock",["a","b"]),"math/le":Av("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Av("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Av("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Av("FlowGraphIsNaNBlock"),"math/isinf":Av("FlowGraphIsInfBlock"),"math/select":{Mh:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Mh:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Av("FlowGraphSinBlock"),"math/cos":Av("FlowGraphCosBlock"),"math/tan":Av("FlowGraphTanBlock"),"math/asin":Av("FlowGraphASinBlock"),"math/acos":Av("FlowGraphACosBlock"),"math/atan":Av("FlowGraphATanBlock"),"math/atan2":Av("FlowGraphATan2Block",["a","b"]),"math/sinh":Av("FlowGraphSinhBlock"),"math/cosh":Av("FlowGraphCoshBlock"),"math/tanh":Av("FlowGraphTanhBlock"),"math/asinh":Av("FlowGraphASinhBlock"),"math/acosh":Av("FlowGraphACoshBlock"),"math/atanh":Av("FlowGraphATanhBlock"),"math/exp":Av("FlowGraphExponentialBlock"),"math/log":Av("FlowGraphLogBlock"),"math/log2":Av("FlowGraphLog2Block"),"math/log10":Av("FlowGraphLog10Block"),"math/sqrt":Av("FlowGraphSquareRootBlock"),"math/cbrt":Av("FlowGraphCubeRootBlock"),"math/pow":Av("FlowGraphPowerBlock",["a","b"]),"math/length":Av("FlowGraphLengthBlock"),"math/normalize":Av("FlowGraphNormalizeBlock"),"math/dot":Av("FlowGraphDotBlock",["a","b"]),"math/cross":Av("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Av("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Av("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Mh:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Mh:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Mh:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Mh:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Mh:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Mh:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Mh:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Av("FlowGraphTransposeBlock"),"math/determinant":Av("FlowGraphDeterminantBlock"),"math/inverse":Av("FlowGraphInvertMatrixBlock"),"math/matmul":Av("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Mh:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ac",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o,q){const c=o[0].dataInputs.find((B=>"rotationQuaternion"===B.name));if(!c)throw new Error("Rotation quaternion input not found");return q._connectionValues[c.uniqueId]&&(q._connectionValues[c.uniqueId].type="Quaternion"),o}},"math/matDecompose":{Mh:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ac"}}}},"math/quatConjugate":Av("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Mh:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o){var q;return(q=o[0]).config||(q.config={}),o[0].config.type="Quaternion",o}},"math/quatAngleBetween":Av("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Mh:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Av("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Av("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Mh:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o){var q;return(q=o[0]).config||(q.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract2x2":{Mh:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Mh:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o){var q;return(q=o[0]).config||(q.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract3x3":{Mh:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Mh:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o){var q;return(q=o[0]).config||(q.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract4x4":{Mh:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Mh:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o,q){var c,S;(S=o[0]).config||(S.config={});const x=o[0].dataInputs[0];return o[0].config.valueType=(null===(c=q._connectionValues[x.uniqueId])||void 0===c?void 0:c.type)??"FlowGraphInteger",o}},"math/and":{Mh:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o,q){var c,S,x;(x=o[0]).config||(x.config={});const D=o[0].dataInputs[0],h=o[0].dataInputs[1];return o[0].config.valueType=(null===(c=q._connectionValues[D.uniqueId])||void 0===c?void 0:c.type)??(null===(S=q._connectionValues[h.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",o}},"math/or":{Mh:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o,q){var c,S,x;(x=o[0]).config||(x.config={});const D=o[0].dataInputs[0],h=o[0].dataInputs[1];return o[0].config.valueType=(null===(c=q._connectionValues[D.uniqueId])||void 0===c?void 0:c.type)??(null===(S=q._connectionValues[h.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",o}},"math/xor":{Mh:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,E,v,z,o,q){var c,S,x;(x=o[0]).config||(x.config={});const D=o[0].dataInputs[0],h=o[0].dataInputs[1];return o[0].config.valueType=(null===(c=q._connectionValues[D.uniqueId])||void 0===c?void 0:c.type)??(null===(S=q._connectionValues[h.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",o}},"math/asr":Av("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Av("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Av("FlowGraphLeadingZerosBlock"),"math/ctz":Av("FlowGraphTrailingZerosBlock"),"math/popcnt":Av("FlowGraphOneBitsCounterBlock"),"math/rad":Av("FlowGraphDegToRadBlock"),"math/deg":Av("FlowGraphRadToDegBlock"),"type/boolToInt":Av("FlowGraphBooleanToInt"),"type/boolToFloat":Av("FlowGraphBooleanToFloat"),"type/intToBool":Av("FlowGraphIntToBoolean"),"type/intToFloat":Av("FlowGraphIntToFloat"),"type/floatToInt":Av("FlowGraphFloatToInt"),"type/floatToBool":Av("FlowGraphFloatToBoolean"),"flow/sequence":{Mh:["FlowGraphSequenceBlock"],extraProcessor(B,E,v,z,o){const q=o[0];return q.config||(q.config={}),q.config.outputSignalCount=Object.keys(B.flows||[]).length,q.signalOutputs.forEach(((B,E)=>{B.name="out_"+E})),o}},"flow/branch":{Mh:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Mh:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(B){if(B.configuration&&B.configuration.cases){const E=B.configuration.cases.value;if(!E.every((B=>"number"===typeof B&&/^-?\d+$/.test(B.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),B.configuration.cases.value=[],{valid:!0};const v=new Set(E);B.configuration.cases.value=Array.from(v)}return{valid:!0}},extraProcessor(B,E,v,z,o){if("flow/switch"!==E.op||!B.flows||0===Object.keys(B.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return o[0].signalOutputs.forEach((B=>{"default"!==B.name&&(B.name="out_"+B.name)})),o}},"flow/while":{Mh:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Mh:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(B,E,v,z,o){const q=o[0];return q.config||(q.config={}),q.config.incrementIndexWhenLoopDone=!0,o}},"flow/doN":{Mh:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Mh:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(B,E,v,z,o){if("flow/multiGate"!==E.op||!B.flows||0===Object.keys(B.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const q=o[0];return q.config||(q.config={}),q.config.outputSignalCount=Object.keys(B.flows).length,q.signalOutputs.forEach(((B,E)=>{B.name="out_"+E})),o}},"flow/waitAll":{Mh:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(B){var E,v;return"number"!==typeof(null===(E=B.configuration)||void 0===E||null===(v=E.inputFlows)||void 0===v?void 0:v.value[0])&&(B.configuration=B.configuration||{inputFlows:{value:[0]}},B.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Mh:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Mh:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Mh:["FlowGraphCancelDelayBlock"]},"variable/get":{Mh:["FlowGraphGetVariableBlock"],validation(B){var E,v;return null!==(E=B.configuration)&&void 0!==E&&null!==(v=E.variable)&&void 0!==v&&v.value?{valid:!0}:(Y.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(B,E)=>[E.getVariableName(B[0])]}}},"variable/set":{Mh:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(B,E)=>[E.getVariableName(B[0])]}}},"variable/setMultiple":{Mh:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(B,E)=>[B[0].map((B=>E.getVariableName(B)))]}},extraProcessor:(B,E,v,z,o)=>(o[0].dataInputs.forEach((B=>{B.name=z.getVariableName(+B.name)})),o)},"variable/interpolate":{Mh:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(B,E)=>[E.getVariableName(B[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:B=>!0===B[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Xv:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Xv:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Xv:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Xv:"FlowGraphPlayAnimationBlock"},out:{name:"out",Xv:"FlowGraphPlayAnimationBlock"},done:{name:"done",Xv:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(B,E,v,z,o){var q,c,S;const x=o[0],D=null===(q=B.configuration)||void 0===q?void 0:q.variable.value[0];if("number"!==typeof D)throw Y.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const h=z.arrays.staticVariables[D];"undefined"===typeof x.config.animationType.value&&(z.arrays.staticVariables,x.config.animationType.value=(0,Vv.K)(h.type));const y=o[4];return y.config||(y.config={}),(c=y.config).variable||(c.variable={}),y.config.variable.value=z.getVariableName(D),(S=o[3]).config||(S.config={}),o}},"pointer/get":{Mh:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Xv:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Xv:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,E,v,z,o)=>(o.forEach((B=>{"FlowGraphJsonPointerParserBlock"===B.className&&(B.config||(B.config={}),B.config.outputValue=!0)})),o)},"pointer/set":{Mh:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Xv:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Xv:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,E,v,z,o)=>(o.forEach((B=>{"FlowGraphJsonPointerParserBlock"===B.className&&(B.config||(B.config={}),B.config.outputValue=!0)})),o)},"pointer/interpolate":{Mh:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Xv:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Xv:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Xv:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Xv:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Xv:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Xv:"FlowGraphPlayAnimationBlock"},out:{name:"out",Xv:"FlowGraphPlayAnimationBlock"},done:{name:"done",Xv:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,E,v,z,o)=>(o.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className?(E.config||(E.config={}),E.config.outputValue=!0):"FlowGraphInterpolationBlock"===E.className&&(E.config||(E.config={}),Object.keys(B.values||[]).forEach((v=>{var o;const q=null===(o=B.values)||void 0===o?void 0:o[v];if("value"===v&&q){const B=q.type;void 0!==B&&(E.config.animationType=z.arrays.types[B].flowGraphType)}})))})),o)},"animation/start":{Mh:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Xv:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(B,E)=>[B[0]*E._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(B,E)=>[B[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,E,v,z,o,q,c){const S=o[o.length-1];return S.config||(S.config={}),S.config.glTF=c,o}},"animation/stop":{Mh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Xv:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,E,v,z,o,q,c){const S=o[o.length-1];return S.config||(S.config={}),S.config.glTF=c,o}},"animation/stopAt":{Mh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Xv:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(B,E)=>[B[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,E,v,z,o,q,c){const S=o[o.length-1];return S.config||(S.config={}),S.config.glTF=c,o}},"math/switch":{Mh:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(B){if(B.configuration&&B.configuration.cases){const E=B.configuration.cases.value;if(!E.every((B=>"number"===typeof B&&/^-?\d+$/.test(B.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),B.configuration.cases.value=[],{valid:!0};const v=new Set(E);B.configuration.cases.value=Array.from(v)}return{valid:!0}},extraProcessor(B,E,v,z,o){const q=o[0];return q.dataInputs.forEach((B=>{"default"!==B.name&&"case"!==B.name&&(B.name="in_"+B.name)})),q.config||(q.config={}),q.config.treatCasesAsIntegers=!0,o}},"debug/log":{Mh:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Av(B){let E=arguments.length>2?arguments[2]:void 0;return{Mh:[B],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((B,E)=>(B[E]={name:E},B)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(B,v,z,o,q){var c;if(E){(c=q[0]).config||(c.config={}),q[0].config.preventIntegerFloatArithmetic=!0;let E=-1;Object.keys(B.values||{}).find((v=>{var z;return void 0!==(null===(z=B.values)||void 0===z?void 0:z[v].type)&&(E=B.values[v].type,!0)})),-1!==E&&(q[0].config.type=o.arrays.types[E].flowGraphType)}return q},validation:B=>E?lv(B):{valid:!0}}}function lv(B){if(B.values){const E=Object.keys(B.values).map((E=>B.values[E].type)).filter((B=>void 0!==B));if(!E.every((B=>B===E[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}fv["math/compose"]=fv["math/matCompose"],fv["math/decompose"]=fv["math/matDecompose"];var dv=v(11351);const tv={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"GE",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class pv{constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=B,this._gltf=E,this._animationTargetFps=v,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const B of this._interactivityGraph.types)this._types.push(tv[B.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const B of this._interactivityGraph.declarations){const E=Iv(B);if(!E)throw Y.c.Error(["No mapping found for declaration",B]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:E,fullOperationName:B.extension?B.op+":"+B.extension:B.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const B of this._interactivityGraph.variables){const E=this._parseVariable(B);this._staticVariables.push(E)}}_parseVariable(B,E){const v=this._types[B.type];if(!v)throw Y.c.Error(["No type found for variable",B]),new Error("Error parsing variables");if(B.value&&B.value.length!==v.length)throw Y.c.Error(["Invalid value length for variable",B,v]),new Error("Error parsing variables");const z=B.value||[];if(!z.length)switch(v.flowGraphType){case"boolean":z.push(!1);break;case"FlowGraphInteger":z.push(0);break;case"number":z.push(NaN);break;case"Vector2":z.push(NaN,NaN);break;case"GE":z.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":z.fill(NaN,0,4);break;case"Matrix":z.fill(NaN,0,16);break;case"Matrix3D":z.fill(NaN,0,9)}return"number"===v.elementType&&"string"===typeof z[0]&&(z[0]=parseFloat(z[0])),{type:v.flowGraphType,value:E?E(z,this):z}}_parseEvents(){if(this._interactivityGraph.events)for(const B of this._interactivityGraph.events){const E={eventId:B.id||"internalEvent_"+this._internalEventsCounter++};B.values&&(E.eventData=Object.keys(B.values).map((E=>{var v;const z=null===(v=B.values)||void 0===v?void 0:v[E];if(!z)throw Y.c.Error(["No value found for event key",E]),new Error("Error parsing events");const o=this._types[z.type];if(!o)throw Y.c.Error(["No type found for event value",z]),new Error("Error parsing events");const q="undefined"!==typeof z.value?this._parseVariable(z):void 0;return{id:E,type:o.flowGraphType,eventData:!0,value:q}}))),this._events.push(E)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const E of this._interactivityGraph.nodes){if("number"!==typeof E.declaration)throw Y.c.Error(["No declaration found for node",E]),new Error("Error parsing nodes");const v=this._mappings[E.declaration];if(!v)throw Y.c.Error(["No mapping found for node",E]),new Error("Error parsing nodes");if(v.flowGraphMapping.validation){const z=v.flowGraphMapping.validation(E,this._interactivityGraph,this._gltf);var B;if(!z.valid)throw new Error(`Error validating interactivity node ${null===(B=this._interactivityGraph.declarations)||void 0===B?void 0:B[E.declaration].op} - ${z.error}`)}const z=[];for(const B of v.flowGraphMapping.Mh){const o=this._getEmptyBlock(B,v.fullOperationName);this._parseNodeConfiguration(E,o,v.flowGraphMapping,B),z.push(o)}this._nodes.push({Mh:z,fullOperationName:v.fullOperationName})}}_getEmptyBlock(B,E){return{uniqueId:(0,dv.c)(),className:B,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:E,metadata:{}}}_parseNodeConfiguration(B,E,v,z){const o=E.config;if(B.configuration){const E=Object.keys(B.configuration);for(const S of E){var q,c;const E=null===(q=B.configuration)||void 0===q?void 0:q[S];if(!E)throw Y.c.Error(["No value found for node configuration",S]),new Error("Error parsing node configuration");const x=null===(c=v.configuration)||void 0===c?void 0:c[S];if(x&&x.Xv?x.Xv===z:0===v.Mh.indexOf(z)){const B=(null===x||void 0===x?void 0:x.name)||S;E&&"undefined"!==typeof E.value||"undefined"===typeof(null===x||void 0===x?void 0:x.defaultValue)?E.value.length>=0?o[B]={value:1===E.value.length?E.value[0]:E.value}:Y.c.Warn(["Invalid value for node configuration",E]):o[B]={value:x.defaultValue},x&&x.dataTransformer&&(o[B].value=x.dataTransformer([o[B].value],this)[0])}}}}_parseNodeConnections(B){for(let X=0;X<this._nodes.length;X++){var E;const r=null===(E=this._interactivityGraph.nodes)||void 0===E?void 0:E[X];if(!r)throw Y.c.Error(["No node found for interactivity node",this._nodes[X]]),new Error("Error parsing node connections");const i=this._nodes[X],u=this._mappings[r.declaration];if(!u)throw Y.c.Error(["No mapping found for node",r]),new Error("Error parsing node connections");const I=r.flows||{},K=Object.keys(I).sort();for(const B of K){var v,z,o,q;const E=I[B],D=null===(v=u.flowGraphMapping.outputs)||void 0===v||null===(z=v.flows)||void 0===z?void 0:z[B],h=(null===D||void 0===D?void 0:D.name)||B,y=this._createNewSocketConnection(h,!0);(D&&D.Xv&&i.Mh.find((B=>B.className===D.Xv))||i.Mh[0]).signalOutputs.push(y);const Q=E.node,P=this._nodes[Q];if(!P)throw Y.c.Error(["No node found for input node id",Q]),new Error("Error parsing node connections");const G=uv(P.fullOperationName);if(!G)throw Y.c.Error(["No mapping found for input node",P]),new Error("Error parsing node connections");let a=null===(o=G.inputs)||void 0===o||null===(q=o.flows)||void 0===q?void 0:q[E.socket||"in"],m=!1;if(!a)for(const B in null===(c=G.inputs)||void 0===c?void 0:c.flows){var c,S,x;if(B.startsWith("[")&&B.endsWith("]"))m=!0,a=null===(S=G.inputs)||void 0===S||null===(x=S.flows)||void 0===x?void 0:x[B]}const g=a?m?a.name.replace("$1",E.socket||""):a.name:E.socket||"in",V=a&&a.Xv&&P.Mh.find((B=>B.className===a.Xv))||P.Mh[0];let T=V.signalInputs.find((B=>B.name===g));T||(T=this._createNewSocketConnection(g),V.signalInputs.push(T)),T.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(T.uniqueId)}const C=r.values||{},f=Object.keys(C);for(const E of f){var D,h;const v=C[E];let z=null===(D=u.flowGraphMapping.inputs)||void 0===D||null===(h=D.values)||void 0===h?void 0:h[E],o=!1;if(!z)for(const B in null===(y=u.flowGraphMapping.inputs)||void 0===y?void 0:y.values){var y,Q,P;if(B.startsWith("[")&&B.endsWith("]"))o=!0,z=null===(Q=u.flowGraphMapping.inputs)||void 0===Q||null===(P=Q.values)||void 0===P?void 0:P[B]}const q=z?o?z.name.replace("$1",E):z.name:E,c=this._createNewSocketConnection(q);if((z&&z.Xv&&i.Mh.find((B=>B.className===z.Xv))||i.Mh[0]).dataInputs.push(c),void 0!==v.value){const E=this._parseVariable(v,z&&z.dataTransformer);B._connectionValues[c.uniqueId]=E}else{if("undefined"===typeof v.node)throw Y.c.Error(["Invalid value for value connection",v]),new Error("Error parsing node connections");{var G,a,m;const B=v.node,E=v.socket||"value",z=this._nodes[B];if(!z)throw Y.c.Error(["No node found for output socket reference",v]),new Error("Error parsing node connections");const o=uv(z.fullOperationName);if(!o)throw Y.c.Error(["No mapping found for output socket reference",v]),new Error("Error parsing node connections");let q=null===(G=o.outputs)||void 0===G||null===(a=G.values)||void 0===a?void 0:a[E],S=!1;if(!q)for(const v in null===(g=o.outputs)||void 0===g?void 0:g.values){var g,V,T;if(v.startsWith("[")&&v.endsWith("]"))S=!0,q=null===(V=o.outputs)||void 0===V||null===(T=V.values)||void 0===T?void 0:T[v]}const x=q?S?q.name.replace("$1",E):null===(m=q)||void 0===m?void 0:m.name:E,D=q&&q.Xv&&z.Mh.find((B=>B.className===q.Xv))||z.Mh[0];let h=D.dataOutputs.find((B=>B.name===x));h||(h=this._createNewSocketConnection(x,!0),D.dataOutputs.push(h)),c.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(c.uniqueId)}}}if(u.flowGraphMapping.interBlockConnectors)for(const B of u.flowGraphMapping.interBlockConnectors){const E=B.input,v=B.output,z=B.isVariable;this._connectFlowGraphNodes(E,v,i.Mh[B.inputBlockIndex],i.Mh[B.outputBlockIndex],z)}if(u.flowGraphMapping.extraProcessor){var N;const E=null===(N=this._interactivityGraph.declarations)||void 0===N?void 0:N[r.declaration];if(!E)throw Y.c.Error(["No declaration found for extra processor",r]),new Error("Error parsing node connections");i.Mh=u.flowGraphMapping.extraProcessor(r,E,u.flowGraphMapping,this,i.Mh,B,this._gltf)}}}_createNewSocketConnection(B,E){return{uniqueId:(0,dv.c)(),name:B,_connectionType:E?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(B,E,v,z,o){const q=o?v.dataInputs:v.signalInputs,c=o?z.dataOutputs:z.signalOutputs,S=q.find((E=>E.name===B))||this._createNewSocketConnection(B),x=c.find((B=>B.name===E))||this._createNewSocketConnection(E,!0);q.find((E=>E.name===B))||q.push(S),c.find((B=>B.name===E))||c.push(x),S.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(S.uniqueId)}getVariableName(B){return"staticVariable_"+B}serializeToFlowGraph(){const B={uniqueId:(0,dv.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(B);for(let E=0;E<this._staticVariables.length;E++){const v=this._staticVariables[E];B._userVariables[this.getVariableName(E)]=v}return{rightHanded:!0,allBlocks:this._nodes.reduce(((B,E)=>B.concat(E.Mh)),[]),executionContexts:[B]}}}const Hv="KHR_interactivity";class jv{constructor(B){this._loader=B,this.name=Hv,this.enabled=this._loader.isExtensionUsed(Hv),this._pathConverter=(0,R.j)(this._loader.vc),B._skipStartAnimationStep=!0;const E=B.babylonScene;E&&function(B){(0,R.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!B.activeCamera)return new o.Quaternion(NaN,NaN,NaN,NaN);const E=o.Quaternion.FromRotationMatrix(B.activeCamera.getWorldMatrix()).normalize();return B.useRightHandedSystem||(E.w*=-1,E.x*=-1),E},type:"Quaternion",getTarget:()=>B.activeCamera}),(0,R.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!B.activeCamera)return new o.GE(NaN,NaN,NaN);const E=B.activeCamera.getWorldMatrix().getTranslation();return B.useRightHandedSystem||(E.x*=-1),E},type:"GE",getTarget:()=>B.activeCamera}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:B=>{var E;return(null===(E=B._babylonAnimationGroup)||void 0===E?void 0:E.isPlaying)??!1},type:"boolean",getTarget:B=>B._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:B=>{var E;return((null===(E=B._babylonAnimationGroup)||void 0===E?void 0:E.from)??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:B=>{var E;return((null===(E=B._babylonAnimationGroup)||void 0===E?void 0:E.to)??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:B=>{var E;return((null===(E=B._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:B=>{var E;return((null===(E=B._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup})}(E)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var B;if(!this._loader.babylonScene||!this._pathConverter)return;const E=this._loader.babylonScene,v=null===(B=this._loader.vc.extensions)||void 0===B?void 0:B.KHR_interactivity;if(!v)return;const z=new Gv.b({aE:E});z.dispatchEventsSynchronously=!1;const o=v.graphs.map((B=>new pv(B,this._loader.vc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(o.map((async B=>await Xv(B,{coordinator:z,pathConverter:this._pathConverter})))),z.start()}}var Rv;Rv=async()=>(await Promise.resolve().then(v.bind(v,13148))).FlowGraphGLTFDataProvider,Yv[`${Hv}/${"FlowGraphGLTFDataProvider"}`]=Rv,j(Hv),H(Hv,!0,(B=>new jv(B)));const bv="KHR_node_visibility";(0,R.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:B=>{const E=B._babylonTransformNode;return!E||void 0===E.isVisible||E.isVisible},set:(B,E)=>{var v,z;null===(v=E._primitiveBabylonMeshes)||void 0===v||v.forEach((B=>{B.inheritVisibility=!0})),E._babylonTransformNode&&(E._babylonTransformNode.isVisible=B),null===(z=E._primitiveBabylonMeshes)||void 0===z||z.forEach((E=>{E.isVisible=B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Fv{constructor(B){this.name=bv,this._loader=B,this.enabled=B.isExtensionUsed(bv)}async onReady(){var B;null===(B=this._loader.vc.nodes)||void 0===B||B.forEach((B=>{var E,v,z,o;(null===(E=B._primitiveBabylonMeshes)||void 0===E||E.forEach((B=>{B.inheritVisibility=!0})),null!==(v=B.extensions)&&void 0!==v&&v.KHR_node_visibility)&&(!1===(null===(z=B.extensions)||void 0===z?void 0:z.KHR_node_visibility.visible)&&(B._babylonTransformNode&&(B._babylonTransformNode.isVisible=!1),null===(o=B._primitiveBabylonMeshes)||void 0===o||o.forEach((B=>{B.isVisible=!1}))))}))}dispose(){this._loader=null}}j(bv),H(bv,!0,(B=>new Fv(B)));const Wv="KHR_node_selectability";Kv("event/onSelect",Wv,{Mh:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Xv:"FlowGraphGetVariableBlock",dataTransformer:B=>["pickedMesh_"+B[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Xv:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,E,v,z,o,q,c){var S,x,D,h,y,Q;const P=o[o.length-1];P.config=P.config||{},P.config.glTF=c;const G=null===(S=B.configuration)||void 0===S||null===(x=S.nodeIndex)||void 0===x?void 0:x.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const Y="pickedMesh_"+G;return o[1].config.variable=Y,q._userVariables[Y]={className:"Mesh",id:null===c||void 0===c||null===(D=c.nodes)||void 0===D||null===(h=D[G]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===c||void 0===c||null===(y=c.nodes)||void 0===y||null===(Q=y[G]._babylonTransformNode)||void 0===Q?void 0:Q.uniqueId},o}}),(0,R.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:B=>{const E=B._babylonTransformNode;return!E||void 0===E.cD||E.cD},set:(B,E)=>{var v;null===(v=E._primitiveBabylonMeshes)||void 0===v||v.forEach((E=>{E.cD=B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"cD"],type:"boolean"});class wv{constructor(B){this.name=Wv,this._loader=B,this.enabled=B.isExtensionUsed(Wv)}async onReady(){var B;null===(B=this._loader.vc.nodes)||void 0===B||B.forEach((B=>{var E,v,z;null!==(E=B.extensions)&&void 0!==E&&E.KHR_node_selectability&&!1===(null===(v=B.extensions)||void 0===v?void 0:v.KHR_node_selectability.selectable)&&(null===(z=B._babylonTransformNode)||void 0===z||z.getChildMeshes().forEach((B=>{B.cD=!1})))}))}dispose(){this._loader=null}}j(Wv),H(Wv,!0,(B=>new wv(B)));const nv="KHR_node_hoverability",Uv="targetMeshPointerOver_";Kv("event/onHoverIn",nv,{Mh:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Xv:"FlowGraphGetVariableBlock",dataTransformer:B=>[Uv+B[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Xv:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,E,v,z,o,q,c){var S,x,D,h,y,Q;const P=o[o.length-1];P.config=P.config||{},P.config.glTF=c;const G=null===(S=B.configuration)||void 0===S||null===(x=S.nodeIndex)||void 0===x?void 0:x.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const Y=Uv+G;return o[1].config.variable=Y,q._userVariables[Y]={className:"Mesh",id:null===c||void 0===c||null===(D=c.nodes)||void 0===D||null===(h=D[G]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===c||void 0===c||null===(y=c.nodes)||void 0===y||null===(Q=y[G]._babylonTransformNode)||void 0===Q?void 0:Q.uniqueId},o}});const sv="targetMeshPointerOut_";Kv("event/onHoverOut",nv,{Mh:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Xv:"FlowGraphGetVariableBlock",dataTransformer:B=>[sv+B[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Xv:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,E,v,z,o,q,c){var S,x,D,h,y,Q;const P=o[o.length-1];P.config=P.config||{},P.config.glTF=c;const G=null===(S=B.configuration)||void 0===S||null===(x=S.nodeIndex)||void 0===x?void 0:x.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const Y=sv+G;return o[1].config.variable=Y,q._userVariables[Y]={className:"Mesh",id:null===c||void 0===c||null===(D=c.nodes)||void 0===D||null===(h=D[G]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===c||void 0===c||null===(y=c.nodes)||void 0===y||null===(Q=y[G]._babylonTransformNode)||void 0===Q?void 0:Q.uniqueId},o}}),(0,R.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:B=>{const E=B._babylonTransformNode;return!E||void 0===E.pointerOverDisableMeshTesting||E.pointerOverDisableMeshTesting},set:(B,E)=>{var v;null===(v=E._primitiveBabylonMeshes)||void 0===v||v.forEach((E=>{E.pointerOverDisableMeshTesting=!B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Jv{constructor(B){this.name=nv,this._loader=B,this.enabled=B.isExtensionUsed(nv)}async onReady(){var B;null===(B=this._loader.vc.nodes)||void 0===B||B.forEach((B=>{var E,v,z;null!==(E=B.extensions)&&void 0!==E&&E.KHR_node_hoverability&&!1===(null===(v=B.extensions)||void 0===v?void 0:v.KHR_node_hoverability.hoverable)&&(null===(z=B._babylonTransformNode)||void 0===z||z.getChildMeshes().forEach((B=>{B.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}j(nv),H(nv,!0,(B=>new Jv(B)));const Ov="ExtrasAsMetadata";class ev{_assignExtras(B,E){if(E.extras&&Object.keys(E.extras).length>0){const v=B.metadata=B.metadata||{};(v.vc=v.vc||{}).extras=E.extras}}constructor(B){this.name=Ov,this.enabled=!0,this._loader=B}dispose(){this._loader=null}loadNodeAsync(B,E,v){return this._loader.loadNodeAsync(B,E,(B=>{this._assignExtras(B,E),v(B)}))}loadCameraAsync(B,E,v){return this._loader.loadCameraAsync(B,E,(B=>{this._assignExtras(B,E),v(B)}))}createMaterial(B,E,v){const z=this._loader.createMaterial(B,E,v);return this._assignExtras(z,E),z}}j(Ov),H(Ov,!1,(B=>new ev(B)));v(13148)},13026:(B,E,v)=>{"use strict";v.d(E,{d:()=>l,f:()=>u,h:()=>i,l:()=>I});var z=v(11202),o=v(11193),q=v(12664),c=v(11833),S=v(11802),x=v(11815),D=v(11213),h=v(11242),y=v(11831),Q=v(11920),P=v(11841),G=v(11414);class Y{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.bQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.VP=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(B){this._environmentTexture=B}getNodes(){let B=[];B=B.concat(this.meshes),B=B.concat(this.lights),B=B.concat(this.cameras),B=B.concat(this.transformNodes);for(const E of this.skeletons)B=B.concat(E.bones);return B}}class a extends Y{}class m{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const B=this.rootNodes;for(const z of B)z.dispose();B.length=0;const E=this.skeletons;for(const z of E)z.dispose();E.length=0;const v=this.animationGroups;for(const z of v)z.dispose();v.length=0}}class g extends Y{constructor(B){super(),this._wasAddedToScene=!1,(B=B||h.b.LastCreatedScene)&&(this.aE=B,this.proceduralTextures=[],B.eq.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=B.getEngine().onContextRestoredObservable.add((()=>{for(const B of this.geometries)B._rebuild();for(const B of this.meshes)B._rebuild();for(const B of this.bQ)B.rebuild();for(const B of this.textures)B._rebuild()})))}_topologicalSort(B){const E=new Map;for(const c of B)E.set(c.uniqueId,c);const v={dependsOn:new Map,dependedBy:new Map};for(const c of B){const B=c.uniqueId;v.dependsOn.set(B,new Set),v.dependedBy.set(B,new Set)}for(const c of B){const B=c.uniqueId,z=v.dependsOn.get(B);if(c instanceof y.b){const o=c.sourceMesh;E.has(o.uniqueId)&&(z.add(o.uniqueId),v.dependedBy.get(o.uniqueId).add(B))}const o=v.dependedBy.get(B);for(const q of c.getDescendants()){const z=q.uniqueId;if(E.has(z)){o.add(z);v.dependsOn.get(z).add(B)}}}const z=[],o=[];for(const c of B){const B=c.uniqueId;0===v.dependsOn.get(B).size&&(o.push(c),E.delete(B))}const q=o;for(;q.length>0;){const B=q.shift();z.push(B);const o=v.dependedBy.get(B.uniqueId);for(const z of Array.from(o.values())){const o=v.dependsOn.get(z);o.delete(B.uniqueId),0===o.size&&E.get(z)&&(q.push(E.get(z)),E.delete(z))}}return E.size>0&&(D.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),E.forEach((B=>{D.c.Error(B.name)}))),z}_addNodeAndDescendantsToList(B,E,v,z){if(v&&(!z||z(v))&&!E.has(v.uniqueId)){B.push(v),E.add(v.uniqueId);for(const o of v.getDescendants(!0))this._addNodeAndDescendantsToList(B,E,o,z)}}_isNodeInContainer(B){return B instanceof x.e&&-1!==this.meshes.indexOf(B)||(B instanceof S.e&&-1!==this.transformNodes.indexOf(B)||(B instanceof Q.c&&-1!==this.lights.indexOf(B)||B instanceof P.c&&-1!==this.cameras.indexOf(B)))}_isValidHierarchy(){for(const B of this.meshes)if(B.parent&&!this._isNodeInContainer(B.parent))return D.c.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.transformNodes)if(B.parent&&!this._isNodeInContainer(B.parent))return D.c.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.lights)if(B.parent&&!this._isNodeInContainer(B.parent))return D.c.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.cameras)if(B.parent&&!this._isNodeInContainer(B.parent))return D.c.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||o.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const z={},q={},S=new m,x=[],D=[],h={doNotInstantiate:!0,...v},y=[],Q=new Set;for(const o of this.transformNodes)null===o.parent&&this._addNodeAndDescendantsToList(y,Q,o,h.predicate);for(const o of this.meshes)null===o.parent&&this._addNodeAndDescendantsToList(y,Q,o,h.predicate);const P=this._topologicalSort(y),G=(v,o)=>{if(((E,v)=>{if(z[E.uniqueId]=v.uniqueId,q[v.uniqueId]=v,B&&(v.name=B(E.name)),v instanceof c.e){const B=v;if(B.morphTargetManager){const v=E.morphTargetManager;B.morphTargetManager=v.clone();for(let E=0;E<v.numTargets;E++){const o=v.getTarget(E),c=B.morphTargetManager.getTarget(E);z[o.uniqueId]=c.uniqueId,q[c.uniqueId]=c}}}})(v,o),v.parent){const B=z[v.parent.uniqueId],E=q[B];o.parent=E||v.parent}if(o.position&&v.position&&o.position.S(v.position),o.rotationQuaternion&&v.rotationQuaternion&&o.rotationQuaternion.S(v.rotationQuaternion),o.rotation&&v.rotation&&o.rotation.S(v.rotation),o.ac&&v.ac&&o.ac.S(v.ac),o.material){const c=o;if(c.material)if(E){const E=v.material;if(-1===D.indexOf(E)){let v=E.clone(B?B(E.name):"Clone of "+E.name);if(D.push(E),z[E.uniqueId]=v.uniqueId,q[v.uniqueId]=v,"MultiMaterial"===E.getClassName()){const o=E;for(const E of o.Vc)E&&(v=E.clone(B?B(E.name):"Clone of "+E.name),D.push(E),z[E.uniqueId]=v.uniqueId,q[v.uniqueId]=v);o.Vc=o.Vc.map((B=>B&&q[z[B.uniqueId]]))}}"InstancedMesh"!==c.getClassName()&&(c.material=q[z[E.uniqueId]])}else"MultiMaterial"===c.material.getClassName()?-1===this.aE.multiMaterials.indexOf(c.material)&&this.aE.addMultiMaterial(c.material):-1===this.aE.materials.indexOf(c.material)&&this.aE.addMaterial(c.material)}null===o.parent&&S.rootNodes.push(o)};for(const o of P)if("InstancedMesh"===o.getClassName()){const B=o,E=B.sourceMesh,v=z[E.uniqueId];G(B,("number"===typeof v?q[v]:E).createInstance(B.name))}else{let B=!0;"Kc"===o.getClassName()||"Node"===o.getClassName()||o.skeleton||!o.getTotalVertices||0===o.getTotalVertices()?B=!1:h.doNotInstantiate&&(B="function"===typeof h.doNotInstantiate?!h.doNotInstantiate(o):!h.doNotInstantiate);const E=B?o.createInstance(`instance of ${o.name}`):o.clone(`Clone of ${o.name}`,null,!0);if(!E)throw new Error(`Could not clone or instantiate node on Asset Container ${o.name}`);G(o,E)}for(const o of this.skeletons){if(h.predicate&&!h.predicate(o))continue;const E=o.clone(B?B(o.name):"Clone of "+o.name);for(const B of this.meshes)if(B.skeleton===o&&!B.isAnInstance){const v=q[z[B.uniqueId]];if(!v||v.isAnInstance)continue;if(v.skeleton=E,-1!==x.indexOf(E))continue;x.push(E);for(const B of E.bones)B._linkedTransformNode&&(B._linkedTransformNode=q[z[B._linkedTransformNode.uniqueId]])}S.skeletons.push(E)}for(const o of this.animationGroups){if(h.predicate&&!h.predicate(o))continue;const E=o.clone(B?B(o.name):"Clone of "+o.name,(B=>q[z[B.uniqueId]]||B));S.animationGroups.push(E)}return S}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||o.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.aE.environmentTexture=this.environmentTexture);for(const B of this.aE._serializableComponents)B.addFromContainer(this);this.aE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=[];for(const v of this.cameras)B&&!B(v)||(this.aE.addCamera(v),E.push(v));for(const v of this.lights)B&&!B(v)||(this.aE.addLight(v),E.push(v));for(const v of this.meshes)B&&!B(v)||(this.aE.th(v),E.push(v));for(const v of this.skeletons)B&&!B(v)||this.aE.addSkeleton(v);for(const v of this.animations)B&&!B(v)||this.aE.addAnimation(v);for(const v of this.animationGroups)B&&!B(v)||this.aE.addAnimationGroup(v);for(const v of this.multiMaterials)B&&!B(v)||this.aE.addMultiMaterial(v);for(const v of this.materials)B&&!B(v)||this.aE.addMaterial(v);for(const v of this.morphTargetManagers)B&&!B(v)||this.aE.addMorphTargetManager(v);for(const v of this.geometries)B&&!B(v)||this.aE.addGeometry(v);for(const v of this.transformNodes)B&&!B(v)||(this.aE.addTransformNode(v),E.push(v));for(const v of this.actionManagers)B&&!B(v)||this.aE.addActionManager(v);for(const v of this.textures)B&&!B(v)||this.aE.addTexture(v);for(const v of this.reflectionProbes)B&&!B(v)||this.aE.addReflectionProbe(v);for(const v of E)v.parent&&-1===this.aE.getNodes().indexOf(v.parent)&&(v.setParent?v.setParent(null):v.parent=null)}removeAllFromScene(){this._isValidHierarchy()||o.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.aE.environmentTexture&&(this.aE.environmentTexture=null);for(const B of this.aE._serializableComponents)B.removeFromContainer(this)}removeFromScene(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const E of this.cameras)B&&!B(E)||this.aE.removeCamera(E);for(const E of this.lights)B&&!B(E)||this.aE.removeLight(E);for(const E of this.meshes)B&&!B(E)||this.aE.dh(E,!0);for(const E of this.skeletons)B&&!B(E)||this.aE.removeSkeleton(E);for(const E of this.animations)B&&!B(E)||this.aE.removeAnimation(E);for(const E of this.animationGroups)B&&!B(E)||this.aE.removeAnimationGroup(E);for(const E of this.multiMaterials)B&&!B(E)||this.aE.removeMultiMaterial(E);for(const E of this.materials)B&&!B(E)||this.aE.removeMaterial(E);for(const E of this.morphTargetManagers)B&&!B(E)||this.aE.removeMorphTargetManager(E);for(const E of this.geometries)B&&!B(E)||this.aE.removeGeometry(E);for(const E of this.transformNodes)B&&!B(E)||this.aE.removeTransformNode(E);for(const E of this.actionManagers)B&&!B(E)||this.aE.removeActionManager(E);for(const E of this.textures)B&&!B(E)||this.aE.removeTexture(E);for(const E of this.reflectionProbes)B&&!B(E)||this.aE.removeReflectionProbe(E)}dispose(){const B=this.cameras.slice(0);for(const P of B)P.dispose();this.cameras.length=0;const E=this.lights.slice(0);for(const P of E)P.dispose();this.lights.length=0;const v=this.meshes.slice(0);for(const P of v)P.dispose();this.meshes.length=0;const z=this.skeletons.slice(0);for(const P of z)P.dispose();this.skeletons.length=0;const o=this.animationGroups.slice(0);for(const P of o)P.dispose();this.animationGroups.length=0;const q=this.multiMaterials.slice(0);for(const P of q)P.dispose();this.multiMaterials.length=0;const c=this.materials.slice(0);for(const P of c)P.dispose();this.materials.length=0;const S=this.geometries.slice(0);for(const P of S)P.dispose();this.geometries.length=0;const x=this.transformNodes.slice(0);for(const P of x)P.dispose();this.transformNodes.length=0;const D=this.actionManagers.slice(0);for(const P of D)P.dispose();this.actionManagers.length=0;const h=this.textures.slice(0);for(const P of h)P.dispose();this.textures.length=0;const y=this.reflectionProbes.slice(0);for(const P of y)P.dispose();this.reflectionProbes.length=0;const Q=this.morphTargetManagers.slice(0);for(const P of Q)P.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const P of this.aE._serializableComponents)P.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.aE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(B,E,v){if(B&&E)for(const z of B){let B=!0;if(v)for(const E of v)if(z===E){B=!1;break}B&&(E.push(z),z._parentContainer=this)}}moveAllFromScene(B){this._wasAddedToScene=!1,void 0===B&&(B=new a);for(const E in this)Object.prototype.hasOwnProperty.call(this,E)&&(this[E]=this[E]||("_environmentTexture"===E?null:[]),this._moveAssets(this.aE[E],this[E],B[E]));this.environmentTexture=this.aE.environmentTexture,this.removeAllFromScene()}createRootMesh(){const B=new c.e("assetContainerRootMesh",this.aE);for(const E of this.meshes)E.parent||B.addChild(E);return this.meshes.unshift(B),B}mergeAnimationsTo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.b.LastCreatedScene,E=arguments.length>1?arguments[1]:void 0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!B)return D.c.Error("No scene available to merge animations to"),[];const z=v||(E=>{let v=null;const z=E.animations.length?E.animations[0].targetProperty:"",o=E.name.split(".").join("").split("_primitive")[0];switch(z){case"position":case"rotationQuaternion":v=B.getTransformNodeByName(E.name)||B.getTransformNodeByName(o);break;case"influence":v=B.getMorphTargetByName(E.name)||B.getMorphTargetByName(o);break;default:v=B.getNodeByName(E.name)||B.getNodeByName(o)}return v}),o=this.getNodes();for(const S of o){const B=z(S);if(null!==B){for(const E of S.animations){const v=B.animations.filter((B=>B.targetProperty===E.targetProperty));for(const E of v){const v=B.animations.indexOf(E,0);v>-1&&B.animations.splice(v,1)}}B.animations=B.animations.concat(S.animations)}}const q=[],c=this.animationGroups.slice();for(const S of c){q.push(S.clone(S.name,z));for(const B of S.animatables)B.stop()}for(const S of E){const E=z(S.target);E&&(B.beginAnimation(E,S.fromFrame,S.toFrame,S.loopAnimation,S.speedRatio,S.onAnimationEnd?S.onAnimationEnd:void 0,void 0,!0,void 0,S.onAnimationLoop?S.onAnimationLoop:void 0),B.stopAnimation(S.target))}return q}populateRootNodes(){this.rootNodes.length=0;for(const B of this.meshes)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.transformNodes)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.lights)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.cameras)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B)}addAllAssetsToContainer(B){if(!B)return;const E=[],v=new Set;for(E.push(B);E.length>0;){const B=E.pop();if(B instanceof c.e?(B.Qc&&-1===this.geometries.indexOf(B.Qc)&&this.geometries.push(B.Qc),this.meshes.push(B)):B instanceof y.b?this.meshes.push(B):B instanceof S.e?this.transformNodes.push(B):B instanceof Q.c?this.lights.push(B):B instanceof P.c&&this.cameras.push(B),B instanceof x.e){if(B.material&&-1===this.materials.indexOf(B.material)){this.materials.push(B.material);for(const E of B.material.getActiveTextures())-1===this.textures.indexOf(E)&&this.textures.push(E)}B.skeleton&&-1===this.skeletons.indexOf(B.skeleton)&&this.skeletons.push(B.skeleton),B.morphTargetManager&&-1===this.morphTargetManagers.indexOf(B.morphTargetManager)&&this.morphTargetManagers.push(B.morphTargetManager)}for(const z of B.getChildren())v.has(z)||E.push(z);v.add(B)}this.populateRootNodes()}_getByTags(B,E,v){if(void 0===E)return B;const z=[];for(const o in B){const q=B[o];G.c&&G.c.MatchesQuery(q,E)&&(!v||v(q))&&z.push(q)}return z}getMeshesByTags(B,E){return this._getByTags(this.meshes,B,E)}getCamerasByTags(B,E){return this._getByTags(this.cameras,B,E)}getLightsByTags(B,E){return this._getByTags(this.lights,B,E)}getMaterialsByTags(B,E){return this._getByTags(this.materials,B,E).concat(this._getByTags(this.multiMaterials,B,E))}getTransformNodesByTags(B,E){return this._getByTags(this.transformNodes,B,E)}}var V=v(11263);class T{constructor(B){this.byteOffset=0,this.buffer=B}async loadAsync(B){const E=await this.buffer.readAsync(this.byteOffset,B);this._dataView=new DataView(E.buffer,E.byteOffset,E.byteLength),this._dataByteOffset=0}readUint32(){const B=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,B}readUint8Array(B){const E=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,B);return this._dataByteOffset+=B,this.byteOffset+=B,E}readString(B){return(0,V.h)(this.readUint8Array(B))}skipBytes(B){this._dataByteOffset+=B,this.byteOffset+=B}}var N=v(13032);const X="Z2xURg",r={name:"vc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:B=>-1!==B.indexOf("asset")&&-1!==B.indexOf("version")||B.startsWith("data:base64,"+X)||B.startsWith("data:;base64,"+X)||B.startsWith("data:application/octet-stream;base64,"+X)||B.startsWith("data:model/gltf-binary;base64,"+X)};var i,u,I,K=v(11249),C=v(11256);function f(B,E,v){try{return Promise.resolve(new Uint8Array(B,E,v))}catch(z){return Promise.reject(z)}}!function(B){B[B.AUTO=0]="AUTO",B[B.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(i||(i={})),function(B){B[B.NONE=0]="NONE",B[B.FIRST=1]="FIRST",B[B.ALL=2]="ALL"}(u||(u={})),function(B){B[B.LOADING=0]="LOADING",B[B.READY=1]="READY",B[B.COMPLETE=2]="COMPLETE"}(I||(I={}));class A{constructor(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=u.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=B=>Promise.resolve(B),this.extensionOptions={}}S(B){B&&(this.onParsed=B.onParsed,this.coordinateSystemMode=B.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=B.animationStartMode??this.animationStartMode,this.loadNodeAnimations=B.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=B.loadSkins??this.loadSkins,this.loadMorphTargets=B.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=B.compileMaterials??this.compileMaterials,this.useClipPlane=B.useClipPlane??this.useClipPlane,this.compileShadowGenerators=B.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=B.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=B.useRangeRequests??this.useRangeRequests,this.createInstances=B.createInstances??this.createInstances,this.alwaysComputeBoundingBox=B.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=B.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=B.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=B.skipMaterials??this.skipMaterials,this.useSRGBBuffers=B.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=B.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=B.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=B.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=B.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=B.customRootNode,this.onMeshLoaded=B.onMeshLoaded,this.onSkinLoaded=B.onSkinLoaded,this.onTextureLoaded=B.onTextureLoaded,this.onMaterialLoaded=B.onMaterialLoaded,this.onCameraLoaded=B.onCameraLoaded,this.extensionOptions=B.extensionOptions??this.extensionOptions)}}class l extends A{constructor(B){super(),this.onParsedObservable=new z.e,this.onMeshLoadedObservable=new z.e,this.onSkinLoadedObservable=new z.e,this.onTextureLoadedObservable=new z.e,this.onMaterialLoadedObservable=new z.e,this.onCameraLoadedObservable=new z.e,this.onCompleteObservable=new z.e,this.onErrorObservable=new z.e,this.eq=new z.e,this.onExtensionLoadedObservable=new z.e,this.validate=!1,this.onValidatedObservable=new z.e,this._loader=null,this._state=null,this._requests=new Array,this.name=r.name,this.extensions=r.extensions,this.onLoaderStateChangedObservable=new z.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.S(B)}set onParsed(B){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),B&&(this._onParsedObserver=this.onParsedObservable.add(B))}set onMeshLoaded(B){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),B&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(B))}set onSkinLoaded(B){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),B&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((E=>B(E.node,E.skinnedNode))))}set onTextureLoaded(B){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),B&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(B))}set onMaterialLoaded(B){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),B&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(B))}set onCameraLoaded(B){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),B&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(B))}set onComplete(B){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(B)}set onError(B){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(B)}set onDispose(B){this._onDisposeObserver&&this.eq.remove(this._onDisposeObserver),this._onDisposeObserver=this.eq.add(B)}set onExtensionLoaded(B){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(B)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(B){this._loggingEnabled!==B&&(this._loggingEnabled=B,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(B){this._capturePerformanceCounters!==B&&(this._capturePerformanceCounters=B,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(B){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(B)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const B of this._requests)B.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=B=>Promise.resolve(B),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.eq.notifyObservers(void 0),this.eq.clear()}loadFile(B,E,v,q,c,S,x,h){if(ArrayBuffer.isView(E))return this._loadBinary(B,E,v,q,x,h),null;this._progressCallback=c;const y=E.name||o.Tools.GetFilename(E);if(S){if(this.useRangeRequests){this.validate&&D.c.Warn("glTF validation is not supported when range requests are enabled");const v={abort:()=>{},onCompleteObservable:new z.e},o={readAsync:(v,z)=>new Promise(((o,q)=>{this._loadFile(B,E,(B=>{o(new Uint8Array(B))}),!0,(B=>{q(B)}),(B=>{B.setRequestHeader("Range",`bytes=${v}-${v+z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new T(o)).then((B=>{v.onCompleteObservable.notifyObservers(v),q(B)}),x?B=>x(void 0,B):void 0),v}return this._loadFile(B,E,(E=>{this._validate(B,new Uint8Array(E,0,E.byteLength),v,y),this._unpackBinaryAsync(new T({readAsync:(B,v)=>f(E,B,v),byteLength:E.byteLength})).then((B=>{q(B)}),x?B=>x(void 0,B):void 0)}),!0,x)}return this._loadFile(B,E,(E=>{try{this._validate(B,E,v,y),q({json:this._parseJson(E)})}catch{x&&x()}}),!1,x)}_loadBinary(B,E,v,z,o,q){this._validate(B,new Uint8Array(E.buffer,E.byteOffset,E.byteLength),v,q),this._unpackBinaryAsync(new T({readAsync:(B,v)=>function(B,E,v){try{if(E<0||E>=B.byteLength)throw new RangeError("Offset is out of range.");if(E+v>B.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(B.buffer,B.byteOffset+E,v))}catch(z){return Promise.reject(z)}}(E,B,v),byteLength:E.byteLength})).then((B=>{z(B)}),o?B=>o(void 0,B):void 0)}importMeshAsync(B,E,v,z,o,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(v),this._loader.importMeshAsync(B,E,null,v,z,o,q))))}loadAsync(B,E,v,z,o){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(E),this._loader.loadAsync(B,E,v,z,o))))}loadAssetContainerAsync(B,E,v,z,o){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(E);const q=new g(B),c=[];this.onMaterialLoadedObservable.add((B=>{c.push(B)}));const S=[];this.onTextureLoadedObservable.add((B=>{S.push(B)}));const x=[];this.onCameraLoadedObservable.add((B=>{x.push(B)}));const D=[];return this.onMeshLoadedObservable.add((B=>{B.morphTargetManager&&D.push(B.morphTargetManager)})),this._loader.importMeshAsync(null,B,q,E,v,z,o).then((B=>(Array.prototype.push.apply(q.geometries,B.geometries),Array.prototype.push.apply(q.meshes,B.meshes),Array.prototype.push.apply(q.bQ,B.bQ),Array.prototype.push.apply(q.skeletons,B.skeletons),Array.prototype.push.apply(q.animationGroups,B.animationGroups),Array.prototype.push.apply(q.materials,c),Array.prototype.push.apply(q.textures,S),Array.prototype.push.apply(q.lights,B.lights),Array.prototype.push.apply(q.transformNodes,B.transformNodes),Array.prototype.push.apply(q.cameras,x),Array.prototype.push.apply(q.morphTargetManagers,D),q)))}))}canDirectLoad(B){return r.canDirectLoad(B)}directLoad(B,E){if(E.startsWith("base64,"+X)||E.startsWith(";base64,"+X)||E.startsWith("application/octet-stream;base64,"+X)||E.startsWith("model/gltf-binary;base64,"+X)){const v=(0,K.e)(E);return this._validate(B,new Uint8Array(v,0,v.byteLength)),this._unpackBinaryAsync(new T({readAsync:(B,E)=>f(v,B,E),byteLength:v.byteLength}))}return this._validate(B,E),Promise.resolve({json:this._parseJson(E)})}createPlugin(B){return new l(B[r.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((B,E)=>{this.onCompleteObservable.addOnce((()=>{B()})),this.onErrorObservable.addOnce((B=>{E(B)}))}))}_setState(B){this._state!==B&&(this._state=B,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(I[this._state]))}_loadFile(B,E,v,z,o,q){const c=B._loadFile(E,v,(B=>{this._onProgress(B,c)}),!0,z,o,q);return c.onCompleteObservable.add((()=>{c._lengthComputable=!0,c._total=c._loaded})),this._requests.push(c),c}_onProgress(B,E){if(!this._progressCallback)return;E._lengthComputable=B.lengthComputable,E._loaded=B.loaded,E._total=B.total;let v=!0,z=0,o=0;for(const q of this._requests){if(void 0===q._lengthComputable||void 0===q._loaded||void 0===q._total)return;v=v&&q._lengthComputable,z+=q._loaded,o+=q._total}this._progressCallback({lengthComputable:v,loaded:z,total:v?o:0})}_validate(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),N.c.ValidateAsync(E,v,z,(E=>this.preprocessUrlAsync(v+E).then((E=>B._loadFileAsync(E,void 0,!0,!0).then((B=>new Uint8Array(B,0,B.byteLength))))))).then((B=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(B),this.onValidatedObservable.clear()}),(B=>{this._endPerformanceCounter("Validate JSON"),o.Tools.Warn(`Failed to validate: ${B.message}`),this.onValidatedObservable.clear()})))}_getLoader(B){const E=B.json.asset||{};this._log(`Asset version: ${E.version}`),E.minVersion&&this._log(`Asset minimum version: ${E.minVersion}`),E.generator&&this._log(`Asset generator: ${E.generator}`);const v=l._parseVersion(E.version);if(!v)throw new Error("Invalid version: "+E.version);if(void 0!==E.minVersion){const B=l._parseVersion(E.minVersion);if(!B)throw new Error("Invalid minimum version: "+E.minVersion);if(l._compareVersion(B,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+E.minVersion)}const z={1:l._CreateGLTF1Loader,2:l._CreateGLTF2Loader}[v.major];if(!z)throw new Error("Unsupported version: "+E.version);return z(this)}_parseJson(B){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${B.length}`);const E=JSON.parse(B);return this._endPerformanceCounter("Parse JSON"),E}_unpackBinaryAsync(B){return this._startPerformanceCounter("Unpack Binary"),B.loadAsync(20).then((()=>{const E=B.readUint32();if(1179937895!==E)throw new C.g("Unexpected magic: "+E,C.c.GLTFLoaderUnexpectedMagicError);const v=B.readUint32();this.loggingEnabled&&this._log(`Binary version: ${v}`);const z=B.readUint32();let o;switch(this.useRangeRequests||z===B.buffer.byteLength||D.c.Warn(`Length in header does not match actual data length: ${z} != ${B.buffer.byteLength}`),v){case 1:o=this._unpackBinaryV1Async(B,z);break;case 2:o=this._unpackBinaryV2Async(B,z);break;default:throw new Error("Unsupported version: "+v)}return this._endPerformanceCounter("Unpack Binary"),o}))}_unpackBinaryV1Async(B,E){const v=B.readUint32(),z=B.readUint32();if(0!==z)throw new Error(`Unexpected content format: ${z}`);const o=E-B.byteOffset,q={json:this._parseJson(B.readString(v)),bin:null};if(0!==o){const E=B.byteOffset;q.bin={readAsync:(v,z)=>B.buffer.readAsync(E+v,z),byteLength:o}}return Promise.resolve(q)}_unpackBinaryV2Async(B,E){const v=1313821514,z=5130562,o=B.readUint32();if(B.readUint32()!==v)throw new Error("First chunk format is not JSON");return B.byteOffset+o===E?B.loadAsync(o).then((()=>({json:this._parseJson(B.readString(o)),bin:null}))):B.loadAsync(o+8).then((()=>{const q={json:this._parseJson(B.readString(o)),bin:null},c=()=>{const o=B.readUint32();switch(B.readUint32()){case v:throw new Error("Unexpected JSON chunk");case z:{const E=B.byteOffset;q.bin={readAsync:(v,z)=>B.buffer.readAsync(E+v,z),byteLength:o},B.skipBytes(o);break}default:B.skipBytes(o)}return B.byteOffset!==E?B.loadAsync(8).then(c):Promise.resolve(q)};return c()}))}static _parseVersion(B){if("1.0"===B||"1.0.1"===B)return{major:1,minor:0};const E=(B+"").match(/^(\d+)\.(\d+)/);return E?{major:parseInt(E[1]),minor:parseInt(E[2])}:null}static _compareVersion(B,E){return B.major>E.major?1:B.major<E.major?-1:B.minor>E.minor?1:B.minor<E.minor?-1:0}_logOpen(B){this._log(B),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(B){const E=l._logSpaces.substring(0,2*this._logIndentLevel);D.c.Log(`${E}${B}`)}_logDisabled(B){}_startPerformanceCounterEnabled(B){o.Tools.StartPerformanceCounter(B)}_startPerformanceCounterDisabled(B){}_endPerformanceCounterEnabled(B){o.Tools.EndPerformanceCounter(B)}_endPerformanceCounterDisabled(B){}}l.IncrementalLoading=!0,l.HomogeneousCoordinates=!1,l._logSpaces="                                ",(0,q.b)(new l)},13032:(B,E,v)=>{"use strict";v.d(E,{c:()=>c});var z=v(11193);function o(B,E,v,z){const o={externalResourceFunction:z};return v&&(o.uri="file:"===E?v:E+v),ArrayBuffer.isView(B)?GLTFValidator.validateBytes(B,o):GLTFValidator.validateString(B,o)}function q(){const B=[];onmessage=E=>{const v=E.data;switch(v.id){case"init":importScripts(v.url);break;case"validate":o(v.data,v.rootUrl,v.fileName,(E=>new Promise(((v,z)=>{const o=B.length;B.push({resolve:v,reject:z}),postMessage({id:"getExternalResource",index:o,uri:E})})))).then((B=>{postMessage({id:"validate.resolve",value:B})}),(B=>{postMessage({id:"validate.reject",reason:B})}));break;case"getExternalResource.resolve":B[v.index].resolve(v.value);break;case"getExternalResource.reject":B[v.index].reject(v.reason)}}}class c{static ValidateAsync(B,E,v,c){return"function"===typeof Worker?new Promise(((S,x)=>{const D=`${o}(${q})()`,h=URL.createObjectURL(new Blob([D],{type:"application/javascript"})),y=new Worker(h),Q=B=>{y.removeEventListener("error",Q),y.removeEventListener("message",P),x(B)},P=B=>{const E=B.data;switch(E.id){case"getExternalResource":c(E.uri).then((B=>{y.postMessage({id:"getExternalResource.resolve",index:E.index,value:B},[B.buffer])}),(B=>{y.postMessage({id:"getExternalResource.reject",index:E.index,reason:B})}));break;case"validate.resolve":y.removeEventListener("error",Q),y.removeEventListener("message",P),S(E.value),y.terminate();break;case"validate.reject":y.removeEventListener("error",Q),y.removeEventListener("message",P),x(E.reason),y.terminate()}};if(y.addEventListener("error",Q),y.addEventListener("message",P),y.postMessage({id:"init",url:z.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(B)){const z=B.slice();y.postMessage({id:"validate",data:z,rootUrl:E,fileName:v},[z.buffer])}else y.postMessage({id:"validate",data:B,rootUrl:E,fileName:v})})):(this._LoadScriptPromise||(this._LoadScriptPromise=z.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>o(B,E,v,c))))}}c.Configuration={url:`${z.Tools._DefaultCdnUrl}/gltf_validator.js`}},13576:(B,E,v)=>{"use strict";v.d(E,{b:()=>r});var z=v(11366),o=v(11372),q=v(11409),c=v(11380),S=v(11772),x=v(11697),D=v(11442),h=v(11601),y=v(11345),Q=v(11291);v(12791),v(12696),v(12720),v(12704),v(12729),v(12734),v(12743);const P="imageProcessingCompatibility",G="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Q.c.IncludesShadersStore[P]||(Q.c.IncludesShadersStore[P]=G);const Y="skyPixelShader",a="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Q.c.ShadersStore[Y]||(Q.c.ShadersStore[Y]=a);v(12798),v(12745),v(12749),v(12763),v(12757);const m="skyVertexShader",g="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Q.c.ShadersStore[m]||(Q.c.ShadersStore[m]=g);var V=v(11688),T=v(11752),N=v(11749);class X extends S.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class r extends x.e{constructor(B,E){super(B,E),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new c.GE(0,100,0),this.useSunPosition=!1,this.cameraOffset=c.GE.Zero(),this.up=c.GE.Up(),this.dithering=!1,this._cameraPosition=c.GE.Zero(),this._skyOrientation=new c.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(B,E){const v=E._drawWrapper;if(this.isFrozen&&v.effect&&v._wasPreviouslyReady)return!0;E.materialDefines||(E.materialDefines=new X);const z=E.materialDefines,o=this.rB();if(this._isReadyForSubMesh(E))return!0;if((0,N.W)(B,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,z),(0,N.K)(B,z,!0,!1),z.IMAGEPROCESSINGPOSTPROCESS!==o.imageProcessingConfiguration.applyByPostProcess&&z.markAsMiscDirty(),z.DITHER!==this.dithering&&z.markAsMiscDirty(),z.isDirty){z.markAsProcessed(),o.resetCachedMaterial();const B=new V.c;z.FOG&&B.addFallback(1,"FOG"),z.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess,z.DITHER=this.dithering;const v=[D.e.PositionKind];z.VERTEXCOLOR&&v.push(D.e.ColorKind);const q="sky",c=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,T.d)(c);const S=z.toString();E.setEffect(o.getEngine().createEffect(q,v,c,[],S,B,this.onCompiled,this.onError),z,this._materialContext)}return!(!E.effect||!E.effect.isReady())&&(z._renderId=o.getRenderId(),v._wasPreviouslyReady=!0,!0)}bindForSubMesh(B,E,v){const z=this.rB(),o=v.materialDefines;if(!o)return;const q=v.effect;if(!q)return;this._activeEffect=q,this.bindOnlyWorldMatrix(B),this._activeEffect.setMatrix("viewProjection",z.getTransformMatrix()),this._mustRebind(z,q,v)&&((0,T.f)(q,this,z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,N.k)(o,q,z)),z.fogEnabled&&E.applyFog&&z.fogMode!==h.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",z.getViewMatrix()),(0,N.g)(z,E,this._activeEffect);const S=z.activeCamera;if(S){const B=S.getWorldMatrix();this._cameraPosition.x=B.m[12],this._cameraPosition.y=B.m[13],this._cameraPosition.z=B.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const B=Math.PI*(this.inclination-.5),E=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(E)*Math.cos(B),this.sunPosition.y=this.distance*Math.sin(-B),this.sunPosition.z=this.distance*Math.sin(E)*Math.cos(B),c.Quaternion.FromUnitVectorsToRef(c.GE.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(E,this._activeEffect,v)}getAnimatables(){return[]}dispose(B){super.dispose(B)}clone(B){return q.b.Clone((()=>new r(B,this.rB())),this)}serialize(){const B=super.serialize();return B.customType="BABYLON.SkyMaterial",B}getClassName(){return"SkyMaterial"}static Parse(B,E,v){return q.b.Parse((()=>new r(B.name,E)),B,E,v)}}(0,z.c)([(0,o.K)()],r.prototype,"luminance",void 0),(0,z.c)([(0,o.K)()],r.prototype,"turbidity",void 0),(0,z.c)([(0,o.K)()],r.prototype,"rayleigh",void 0),(0,z.c)([(0,o.K)()],r.prototype,"mieCoefficient",void 0),(0,z.c)([(0,o.K)()],r.prototype,"mieDirectionalG",void 0),(0,z.c)([(0,o.K)()],r.prototype,"distance",void 0),(0,z.c)([(0,o.K)()],r.prototype,"inclination",void 0),(0,z.c)([(0,o.K)()],r.prototype,"azimuth",void 0),(0,z.c)([(0,o.I)()],r.prototype,"sunPosition",void 0),(0,z.c)([(0,o.K)()],r.prototype,"useSunPosition",void 0),(0,z.c)([(0,o.I)()],r.prototype,"cameraOffset",void 0),(0,z.c)([(0,o.I)()],r.prototype,"up",void 0),(0,z.c)([(0,o.K)()],r.prototype,"dithering",void 0),(0,y.f)("BABYLON.SkyMaterial",r)},12086:(B,E,v)=>{"use strict";function z(B,E){E.headers=B.headers||{},E.statusMessage=B.statusText,E.statusCode=B.status,E.data=B.response}function o(B,E,v){return new Promise((function(o,q){v=v||{};var c,S,x,D=new XMLHttpRequest,h=v.body,y=v.headers||{};for(c in v.timeout&&(D.timeout=v.timeout),D.ontimeout=D.onerror=function(B){B.timeout="timeout"==B.type,q(B)},D.open(B,E.href||E),D.onload=function(){for(x=D.getAllResponseHeaders().trim().split(/[\r\n]+/),z(D,D);S=x.shift();)S=S.split(": "),D.headers[S.shift().toLowerCase()]=S.join(": ");if((S=D.headers["content-type"])&&~S.indexOf("application/json"))try{D.data=JSON.parse(D.data,v.reviver)}catch(B){return z(D,B),q(B)}(D.status>=400?q:o)(D)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(y["content-type"]="application/json",h=JSON.stringify(h)),D.withCredentials=!!v.withCredentials,y)D.setRequestHeader(c,y[c]);D.send(h)}))}v.r(E),v.d(E,{del:()=>x,get:()=>q,patch:()=>S,post:()=>c,put:()=>D,send:()=>o});var q=o.bind(o,"GET"),c=o.bind(o,"POST"),S=o.bind(o,"PATCH"),x=o.bind(o,"DELETE"),D=o.bind(o,"PUT")},13670:(B,E,v)=>{"use strict";v.d(E,{d:()=>y});const z=.5*(Math.sqrt(3)-1),o=(3-Math.sqrt(3))/6,q=1/3,c=1/6,S=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,D=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),h=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const y=class{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const E="function"==typeof B?B:function(B){let E=0,v=0,z=0,o=1;const q=function(){let B=4022871197;return function(E){E=E.toString();for(let v=0;v<E.length;v++){B+=E.charCodeAt(v);let z=.02519603282416938*B;B=z>>>0,z-=B,z*=B,B=z>>>0,z-=B,B+=4294967296*z}return 2.3283064365386963e-10*(B>>>0)}}();E=q(" "),v=q(" "),z=q(" "),E-=q(B),E<0&&(E+=1);v-=q(B),v<0&&(v+=1);z-=q(B),z<0&&(z+=1);return function(){const B=2091639*E+2.3283064365386963e-10*o;return E=v,v=z,z=B-(o=0|B)}}(B);this.p=function(B){const E=new Uint8Array(256);for(let v=0;v<256;v++)E[v]=v;for(let v=0;v<255;v++){const z=v+~~(B()*(256-v)),o=E[v];E[v]=E[z],E[z]=o}return E}(E),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let v=0;v<512;v++)this.perm[v]=this.p[255&v],this.permMod12[v]=this.perm[v]%12}noise2D(B,E){const v=this.permMod12,q=this.perm;let c=0,S=0,x=0;const h=(B+E)*z,y=Math.floor(B+h),Q=Math.floor(E+h),P=(y+Q)*o,G=B-(y-P),Y=E-(Q-P);let a,m;G>Y?(a=1,m=0):(a=0,m=1);const g=G-a+o,V=Y-m+o,T=G-1+2*o,N=Y-1+2*o,X=255&y,r=255&Q;let i=.5-G*G-Y*Y;if(i>=0){const B=3*v[X+q[r]];i*=i,c=i*i*(D[B]*G+D[B+1]*Y)}let u=.5-g*g-V*V;if(u>=0){const B=3*v[X+a+q[r+m]];u*=u,S=u*u*(D[B]*g+D[B+1]*V)}let I=.5-T*T-N*N;if(I>=0){const B=3*v[X+1+q[r+1]];I*=I,x=I*I*(D[B]*T+D[B+1]*N)}return 70*(c+S+x)}noise3D(B,E,v){const z=this.permMod12,o=this.perm;let S,x,h,y;const Q=(B+E+v)*q,P=Math.floor(B+Q),G=Math.floor(E+Q),Y=Math.floor(v+Q),a=(P+G+Y)*c,m=B-(P-a),g=E-(G-a),V=v-(Y-a);let T,N,X,r,i,u;m>=g?g>=V?(T=1,N=0,X=0,r=1,i=1,u=0):m>=V?(T=1,N=0,X=0,r=1,i=0,u=1):(T=0,N=0,X=1,r=1,i=0,u=1):g<V?(T=0,N=0,X=1,r=0,i=1,u=1):m<V?(T=0,N=1,X=0,r=0,i=1,u=1):(T=0,N=1,X=0,r=1,i=1,u=0);const I=m-T+c,K=g-N+c,C=V-X+c,f=m-r+2*c,A=g-i+2*c,l=V-u+2*c,d=m-1+.5,t=g-1+.5,p=V-1+.5,H=255&P,j=255&G,R=255&Y;let b=.6-m*m-g*g-V*V;if(b<0)S=0;else{const B=3*z[H+o[j+o[R]]];b*=b,S=b*b*(D[B]*m+D[B+1]*g+D[B+2]*V)}let F=.6-I*I-K*K-C*C;if(F<0)x=0;else{const B=3*z[H+T+o[j+N+o[R+X]]];F*=F,x=F*F*(D[B]*I+D[B+1]*K+D[B+2]*C)}let W=.6-f*f-A*A-l*l;if(W<0)h=0;else{const B=3*z[H+r+o[j+i+o[R+u]]];W*=W,h=W*W*(D[B]*f+D[B+1]*A+D[B+2]*l)}let w=.6-d*d-t*t-p*p;if(w<0)y=0;else{const B=3*z[H+1+o[j+1+o[R+1]]];w*=w,y=w*w*(D[B]*d+D[B+1]*t+D[B+2]*p)}return 32*(S+x+h+y)}noise4D(B,E,v,z){const o=this.perm;let q,c,D,y,Q;const P=(B+E+v+z)*S,G=Math.floor(B+P),Y=Math.floor(E+P),a=Math.floor(v+P),m=Math.floor(z+P),g=(G+Y+a+m)*x,V=B-(G-g),T=E-(Y-g),N=v-(a-g),X=z-(m-g);let r=0,i=0,u=0,I=0;V>T?r++:i++,V>N?r++:u++,V>X?r++:I++,T>N?i++:u++,T>X?i++:I++,N>X?u++:I++;const K=r>=3?1:0,C=i>=3?1:0,f=u>=3?1:0,A=I>=3?1:0,l=r>=2?1:0,d=i>=2?1:0,t=u>=2?1:0,p=I>=2?1:0,H=r>=1?1:0,j=i>=1?1:0,R=u>=1?1:0,b=I>=1?1:0,F=V-K+x,W=T-C+x,w=N-f+x,n=X-A+x,U=V-l+2*x,s=T-d+2*x,J=N-t+2*x,O=X-p+2*x,e=V-H+3*x,k=T-j+3*x,L=N-R+3*x,M=X-b+3*x,Z=V-1+4*x,BB=T-1+4*x,EB=N-1+4*x,vB=X-1+4*x,zB=255&G,oB=255&Y,qB=255&a,cB=255&m;let SB=.6-V*V-T*T-N*N-X*X;if(SB<0)q=0;else{const B=o[zB+o[oB+o[qB+o[cB]]]]%32*4;SB*=SB,q=SB*SB*(h[B]*V+h[B+1]*T+h[B+2]*N+h[B+3]*X)}let xB=.6-F*F-W*W-w*w-n*n;if(xB<0)c=0;else{const B=o[zB+K+o[oB+C+o[qB+f+o[cB+A]]]]%32*4;xB*=xB,c=xB*xB*(h[B]*F+h[B+1]*W+h[B+2]*w+h[B+3]*n)}let DB=.6-U*U-s*s-J*J-O*O;if(DB<0)D=0;else{const B=o[zB+l+o[oB+d+o[qB+t+o[cB+p]]]]%32*4;DB*=DB,D=DB*DB*(h[B]*U+h[B+1]*s+h[B+2]*J+h[B+3]*O)}let hB=.6-e*e-k*k-L*L-M*M;if(hB<0)y=0;else{const B=o[zB+H+o[oB+j+o[qB+R+o[cB+b]]]]%32*4;hB*=hB,y=hB*hB*(h[B]*e+h[B+1]*k+h[B+2]*L+h[B+3]*M)}let yB=.6-Z*Z-BB*BB-EB*EB-vB*vB;if(yB<0)Q=0;else{const B=o[zB+1+o[oB+1+o[qB+1+o[cB+1]]]]%32*4;yB*=yB,Q=yB*yB*(h[B]*Z+h[B+1]*BB+h[B+2]*EB+h[B+3]*vB)}return 27*(q+c+D+y+Q)}}}}]);