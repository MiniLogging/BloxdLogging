/*! For license information please see 417g2w.32.129d1925.chunk.js.LICENSE.txt */
(self.ozi0exxand9=self.ozi0exxand9||[]).push([[32],{13371:(f,v,Z)=>{"use strict";var V=Z(13380),h=Z(13383),J=Z(13386);Z.g.__TYPEDARRAY_POOL||(Z.g.__TYPEDARRAY_POOL={UINT8:h([32,0]),UINT16:h([32,0]),UINT32:h([32,0]),INT8:h([32,0]),INT16:h([32,0]),INT32:h([32,0]),FLOAT:h([32,0]),DOUBLE:h([32,0]),DATA:h([32,0]),UINT8C:h([32,0]),BUFFER:h([32,0])});var l="undefined"!==typeof Uint8ClampedArray,e=Z.g.__TYPEDARRAY_POOL;e.UINT8C||(e.UINT8C=h([32,0])),e.BUFFER||(e.BUFFER=h([32,0]));var C=e.DATA,H=e.BUFFER;function O(f){if(f){var v=f.length||f.byteLength,Z=V.log2(v);C[Z].push(f)}}function u(f){f=V.nextPow2(f);var v=V.log2(f),Z=C[v];return Z.length>0?Z.pop():new ArrayBuffer(f)}function W(f){return new Uint8Array(u(f),0,f)}function a(f){return new Uint16Array(u(2*f),0,f)}function b(f){return new Uint32Array(u(4*f),0,f)}function X(f){return new Int8Array(u(f),0,f)}function F(f){return new Int16Array(u(2*f),0,f)}function U(f){return new Int32Array(u(4*f),0,f)}function K(f){return new Float32Array(u(4*f),0,f)}function M(f){return new Float64Array(u(8*f),0,f)}function A(f){return l?new Uint8ClampedArray(u(f),0,f):W(f)}function s(f){return new DataView(u(f),0,f)}v.free=function(f){if(J(f))H[V.log2(f.length)].push(f);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(f)&&(f=f.buffer),!f)return;var v=f.length||f.byteLength,Z=0|V.log2(v);C[Z].push(f)}},v.freeUint8=v.freeUint16=v.freeUint32=v.freeInt8=v.freeInt16=v.freeInt32=v.freeFloat32=v.freeFloat=v.freeFloat64=v.freeDouble=v.freeUint8Clamped=v.freeDataView=function(f){O(f.buffer)},v.freeArrayBuffer=O,v.freeBuffer=function(f){H[V.log2(f.length)].push(f)},v.malloc=function(f,v){if(void 0===v||"arraybuffer"===v)return u(f);switch(v){case"uint8":return W(f);case"uint16":return a(f);case"uint32":return b(f);case"int8":return X(f);case"int16":return F(f);case"int32":return U(f);case"float":case"float32":return K(f);case"double":case"float64":return M(f);case"uint8_clamped":return A(f);case"buffer":throw"Buffer not supported";case"data":case"dataview":return s(f);default:return null}return null},v.mallocArrayBuffer=u,v.mallocUint8=W,v.mallocUint16=a,v.mallocUint32=b,v.mallocInt8=X,v.mallocInt16=F,v.mallocInt32=U,v.mallocFloat32=v.mallocFloat=K,v.mallocFloat64=v.mallocDouble=M,v.mallocUint8Clamped=A,v.mallocDataView=s,v.clearCache=function(){for(var f=0;f<32;++f)e.UINT8[f].length=0,e.UINT16[f].length=0,e.UINT32[f].length=0,e.INT8[f].length=0,e.INT16[f].length=0,e.INT32[f].length=0,e.FLOAT[f].length=0,e.DOUBLE[f].length=0,e.UINT8C[f].length=0,C[f].length=0,H[f].length=0}},13456:(f,v,Z)=>{f.exports=h;var V=Z(12217);function h(f,v){if(!(this instanceof h))return new h(f,v);var Z=V.create();V.add(Z,f,v),this.base=V.min(V.create(),f,Z),this.ZO=V.clone(v),this.max=V.max(V.create(),f,Z),this.mag=V.length(this.ZO)}var J=h.prototype;J.width=function(){return this.ZO[0]},J.height=function(){return this.ZO[1]},J.depth=function(){return this.ZO[2]},J.x0=function(){return this.base[0]},J.y0=function(){return this.base[1]},J.z0=function(){return this.base[2]},J.x1=function(){return this.max[0]},J.y1=function(){return this.max[1]},J.z1=function(){return this.max[2]},J.translate=function(f){return V.add(this.max,this.max,f),V.add(this.base,this.base,f),this},J.setPosition=function(f){return V.add(this.max,f,this.ZO),V.k(this.base,f),this},J.expand=function(f){var v=V.create(),Z=V.create();return V.max(v,f.max,this.max),V.min(Z,f.base,this.base),V.Fv(v,v,Z),new h(Z,v)},J.intersects=function(f){return!(f.base[0]>this.max[0])&&(!(f.base[1]>this.max[1])&&(!(f.base[2]>this.max[2])&&(!(f.max[0]<this.base[0])&&(!(f.max[1]<this.base[1])&&!(f.max[2]<this.base[2])))))},J.touches=function(f){var v=this.union(f);return null!==v&&(0==v.width()||0==v.height()||0==v.depth())},J.union=function(f){if(!this.intersects(f))return null;var v=Math.max(f.base[0],this.base[0]),Z=Math.max(f.base[1],this.base[1]),V=Math.max(f.base[2],this.base[2]);return new h([v,Z,V],[Math.min(f.max[0],this.max[0])-v,Math.min(f.max[1],this.max[1])-Z,Math.min(f.max[2],this.max[2])-V])}},13380:(f,v)=>{"use strict";function Z(f){var v=32;return(f&=-f)&&v--,65535&f&&(v-=16),16711935&f&&(v-=8),252645135&f&&(v-=4),858993459&f&&(v-=2),1431655765&f&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(f){return(f>0)-(f<0)},v.abs=function(f){var v=f>>31;return(f^v)-v},v.min=function(f,v){return v^(f^v)&-(f<v)},v.max=function(f,v){return f^(f^v)&-(f<v)},v.isPow2=function(f){return!(f&f-1)&&!!f},v.log2=function(f){var v,Z;return v=(f>65535)<<4,v|=Z=((f>>>=v)>255)<<3,v|=Z=((f>>>=Z)>15)<<2,(v|=Z=((f>>>=Z)>3)<<1)|(f>>>=Z)>>1},v.log10=function(f){return f>=1e9?9:f>=1e8?8:f>=1e7?7:f>=1e6?6:f>=1e5?5:f>=1e4?4:f>=1e3?3:f>=100?2:f>=10?1:0},v.popCount=function(f){return 16843009*((f=(858993459&(f-=f>>>1&1431655765))+(f>>>2&858993459))+(f>>>4)&252645135)>>>24},v.countTrailingZeros=Z,v.nextPow2=function(f){return f+=0===f,--f,f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)+1},v.prevPow2=function(f){return f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)-(f>>>1)},v.parity=function(f){return f^=f>>>16,f^=f>>>8,f^=f>>>4,27030>>>(f&=15)&1};var V=new Array(256);!function(f){for(var v=0;v<256;++v){var Z=v,V=v,h=7;for(Z>>>=1;Z;Z>>>=1)V<<=1,V|=1&Z,--h;f[v]=V<<h&255}}(V),v.reverse=function(f){return V[255&f]<<24|V[f>>>8&255]<<16|V[f>>>16&255]<<8|V[f>>>24&255]},v.interleave2=function(f,v){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(f,v){return(f=65535&((f=16711935&((f=252645135&((f=858993459&((f=f>>>v&1431655765)|f>>>1))|f>>>2))|f>>>4))|f>>>16))<<16>>16},v.interleave3=function(f,v,Z){return f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2),(f|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<2},v.deinterleave3=function(f,v){return(f=1023&((f=4278190335&((f=251719695&((f=3272356035&((f=f>>>v&1227133513)|f>>>2))|f>>>4))|f>>>8))|f>>>16))<<22>>22},v.nextCombination=function(f){var v=f|f-1;return v+1|(~v&-~v)-1>>>Z(f)+1}},13368:(f,v,Z)=>{"use strict";f.exports=function(f,v,Z){switch(arguments.length){case 1:return V=[],H(h=f,h,O,!0),V;case 2:return"function"===typeof v?H(f,f,v,!0):function(f,v){return V=[],H(f,v,O,!1),V}(f,v);case 3:return H(f,v,Z,!1);default:throw new Error("box-intersect: Invalid arguments")}var h};var V,h=Z(13371),J=Z(13391),l=Z(13409);function e(f,v){for(var Z=0;Z<f;++Z)if(!(v[Z]<=v[Z+f]))return!0;return!1}function C(f,v,Z,V){for(var h=0,J=0,l=0,C=f.length;l<C;++l){var H=f[l];if(!e(v,H)){for(var O=0;O<2*v;++O)Z[h++]=H[O];V[J++]=l}}return J}function H(f,v,Z,V){var e=f.length,H=v.length;if(!(e<=0||H<=0)){var O=f[0].length>>>1;if(!(O<=0)){var u,W=h.mallocDouble(2*O*e),a=h.mallocInt32(e);if((e=C(f,O,W,a))>0){if(1===O&&V)J.init(e),u=J.sweepComplete(O,Z,0,e,W,a,0,e,W,a);else{var b=h.mallocDouble(2*O*H),X=h.mallocInt32(H);(H=C(v,O,b,X))>0&&(J.init(e+H),u=1===O?J.sweepBipartite(O,Z,0,e,W,a,0,H,b,X):l(O,Z,V,e,W,a,H,b,X),h.free(b),h.free(X))}h.free(W),h.free(a)}return u}}}function O(f,v){V.push([f,v])}},13415:(f,v)=>{"use strict";var Z="d",V="ax",h="fp",J="es",l="rs",e="re",C="rb",H="bs",O="be",u="bb",W=[Z,V,"vv",l,e,C,"ri",H,O,u,"bi"];function a(f){var v="bruteForce"+(f?"Full":"Partial"),V=[],l=W.slice();f||l.splice(3,0,h);var e=["function "+v+"("+l.join()+"){"];function C(v,h){var l=function(f,v,V){var h="bruteForce"+(f?"Red":"Blue")+(v?"Flip":"")+(V?"Full":""),l=["function ",h,"(",W.join(),"){","var ",J,"=2*",Z,";"],e="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",C="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(V?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return f?l.push(e,"Q",":",C):l.push(C,"Q",":",e),V?l.push("if(y1<x0||x1<y0)continue;"):v?l.push("if(y0<=x0||x1<y0)continue;"):l.push("if(y0<x0||x1<y0)continue;"),l.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),v?l.push("yi,xi"):l.push("xi,yi"),l.push(");if(rv!==void 0)return rv;}}}"),{name:h,code:l.join("")}}(v,h,f);V.push(l.code),e.push("return "+l.name+"("+W.join()+");")}e.push("if(re-rs>be-bs){"),f?(C(!0,!1),e.push("}else{"),C(!1,!1)):(e.push("if(fp){"),C(!0,!0),e.push("}else{"),C(!0,!1),e.push("}}else{if(fp){"),C(!1,!0),e.push("}else{"),C(!1,!1),e.push("}")),e.push("}}return "+v);var H=V.join("")+e.join("");return new Function(H)()}v.partial=a(!1),v.full=a(!0)},13409:(f,v,Z)=>{"use strict";f.exports=function(f,v,Z,J,O,I,T,B,P){!function(f,v){var Z=8*h.log2(v+1)*(f+1)|0,J=h.nextPow2(A*Z);z.length<J&&(V.free(z),z=V.mallocInt32(J));var l=h.nextPow2(s*Z);Y.length<l&&(V.free(Y),Y=V.mallocDouble(l))}(f,J+T);var g,w=0,t=2*f;y(w++,0,0,J,0,T,Z?16:0,-1/0,1/0),Z||y(w++,0,0,T,0,J,1,-1/0,1/0);for(;w>0;){var L=(w-=1)*A,E=z[L],j=z[L+1],q=z[L+2],c=z[L+3],m=z[L+4],p=z[L+5],k=w*s,r=Y[k],o=Y[k+1],G=1&p,Q=!!(16&p),d=O,x=I,R=B,n=P;if(G&&(d=B,x=P,R=O,n=I),!(2&p&&j>=(q=F(f,E,j,q,d,x,o)))&&!(4&p&&(j=U(f,E,j,q,d,x,r))>=q)){var S=q-j,D=m-c;if(Q){if(f*S*(S+D)<a){if(void 0!==(g=C.scanComplete(f,E,v,j,q,d,x,c,m,R,n)))return g;continue}}else{if(f*Math.min(S,D)<u){if(void 0!==(g=l(f,E,v,G,j,q,d,x,c,m,R,n)))return g;continue}if(f*S*D<W){if(void 0!==(g=C.scanBipartite(f,E,v,G,j,q,d,x,c,m,R,n)))return g;continue}}var ff=b(f,E,j,q,d,x,r,o);if(j<ff)if(f*(ff-j)<u){if(void 0!==(g=e(f,E+1,v,j,ff,d,x,c,m,R,n)))return g}else if(E===f-2){if(void 0!==(g=G?C.sweepBipartite(f,v,c,m,R,n,j,ff,d,x):C.sweepBipartite(f,v,j,ff,d,x,c,m,R,n)))return g}else y(w++,E+1,j,ff,c,m,G,-1/0,1/0),y(w++,E+1,c,m,j,ff,1^G,-1/0,1/0);if(ff<q){var vf=H(f,E,c,m,R,n),Zf=R[t*vf+E],Vf=X(f,E,vf,m,R,n,Zf);if(Vf<m&&y(w++,E,ff,q,Vf,m,(4|G)+(Q?16:0),Zf,o),c<vf&&y(w++,E,ff,q,c,vf,(2|G)+(Q?16:0),r,Zf),vf+1===Vf){if(void 0!==(g=Q?i(f,E,v,ff,q,d,x,vf,R,n[vf]):N(f,E,v,G,ff,q,d,x,vf,R,n[vf])))return g}else if(vf<Vf){var hf;if(Q){if(ff<(hf=K(f,E,ff,q,d,x,Zf))){var Jf=X(f,E,ff,hf,d,x,Zf);if(E===f-2){if(ff<Jf&&void 0!==(g=C.sweepComplete(f,v,ff,Jf,d,x,vf,Vf,R,n)))return g;if(Jf<hf&&void 0!==(g=C.sweepBipartite(f,v,Jf,hf,d,x,vf,Vf,R,n)))return g}else ff<Jf&&y(w++,E+1,ff,Jf,vf,Vf,16,-1/0,1/0),Jf<hf&&(y(w++,E+1,Jf,hf,vf,Vf,0,-1/0,1/0),y(w++,E+1,vf,Vf,Jf,hf,1,-1/0,1/0))}}else ff<(hf=G?M(f,E,ff,q,d,x,Zf):K(f,E,ff,q,d,x,Zf))&&(E===f-2?g=G?C.sweepBipartite(f,v,vf,Vf,R,n,ff,hf,d,x):C.sweepBipartite(f,v,ff,hf,d,x,vf,Vf,R,n):(y(w++,E+1,ff,hf,vf,Vf,G,-1/0,1/0),y(w++,E+1,vf,Vf,ff,hf,1^G,-1/0,1/0)))}}}}};var V=Z(13371),h=Z(13380),J=Z(13415),l=J.partial,e=J.full,C=Z(13391),H=Z(13417),O=Z(13420),u=128,W=1<<22,a=1<<22,b=O("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),X=O("lo===p0",["p0"]),F=O("lo<p0",["p0"]),U=O("hi<=p0",["p0"]),K=O("lo<=p0&&p0<=hi",["p0"]),M=O("lo<p0&&p0<=hi",["p0"]),A=6,s=2,z=V.mallocInt32(1024),Y=V.mallocDouble(1024);function y(f,v,Z,V,h,J,l,e,C){var H=A*f;z[H]=v,z[H+1]=Z,z[H+2]=V,z[H+3]=h,z[H+4]=J,z[H+5]=l;var O=s*f;Y[O]=e,Y[O+1]=C}function N(f,v,Z,V,h,J,l,e,C,H,O){var u=2*f,W=C*u,a=H[W+v];f:for(var b=h,X=h*u;b<J;++b,X+=u){var F=l[X+v],U=l[X+v+f];if(!(a<F||U<a)&&(!V||a!==F)){for(var K,M=e[b],A=v+1;A<f;++A){F=l[X+A],U=l[X+A+f];var s=H[W+A],z=H[W+A+f];if(U<s||z<F)continue f}if(void 0!==(K=V?Z(O,M):Z(M,O)))return K}}}function i(f,v,Z,V,h,J,l,e,C,H){var O=2*f,u=e*O,W=C[u+v];f:for(var a=V,b=V*O;a<h;++a,b+=O){var X=l[a];if(X!==H){var F=J[b+v],U=J[b+v+f];if(!(W<F||U<W)){for(var K=v+1;K<f;++K){F=J[b+K],U=J[b+K+f];var M=C[u+K],A=C[u+K+f];if(U<M||A<F)continue f}var s=Z(X,H);if(void 0!==s)return s}}}}},13417:(f,v,Z)=>{"use strict";f.exports=function(f,v,Z,l,e,C){if(l<=Z+1)return Z;var H=Z,O=l,u=l+Z>>>1,W=2*f,a=u,b=e[W*u+v];for(;H<O;){if(O-H<h){J(f,v,H,O,e,C),b=e[W*u+v];break}var X=O-H,F=Math.random()*X+H|0,U=e[W*F+v],K=Math.random()*X+H|0,M=e[W*K+v],A=Math.random()*X+H|0,s=e[W*A+v];U<=M?s>=M?(a=K,b=M):U>=s?(a=F,b=U):(a=A,b=s):M>=s?(a=K,b=M):s>=U?(a=F,b=U):(a=A,b=s);for(var z=W*(O-1),Y=W*a,y=0;y<W;++y,++z,++Y){var N=e[z];e[z]=e[Y],e[Y]=N}var i=C[O-1];C[O-1]=C[a],C[a]=i;for(z=W*(O-1),Y=W*(a=V(f,v,H,O-1,e,C,b)),y=0;y<W;++y,++z,++Y){N=e[z];e[z]=e[Y],e[Y]=N}i=C[O-1];if(C[O-1]=C[a],C[a]=i,u<a){for(O=a-1;H<O&&e[W*(O-1)+v]===b;)O-=1;O+=1}else{if(!(a<u))break;for(H=a+1;H<O&&e[W*H+v]===b;)H+=1}}return V(f,v,Z,u,e,C,e[W*u+v])};var V=Z(13420)("lo<p0",["p0"]),h=8;function J(f,v,Z,V,h,J){for(var l=2*f,e=l*(Z+1)+v,C=Z+1;C<V;++C,e+=l)for(var H=h[e],O=C,u=l*(C-1);O>Z&&h[u+v]>H;--O,u-=l){for(var W=u,a=u+l,b=0;b<l;++b,++W,++a){var X=h[W];h[W]=h[a],h[a]=X}var F=J[O];J[O]=J[O-1],J[O-1]=F}}},13420:f=>{"use strict";f.exports=function(f,Z){var V="abcdef".split("").concat(Z),h=[];f.indexOf("lo")>=0&&h.push("lo=e[k+n]");f.indexOf("hi")>=0&&h.push("hi=e[k+o]");return V.push(v.replace("_",h.join()).replace("$",f)),Function.apply(void 0,V)};var v="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13400:f=>{"use strict";f.exports=function(f,V){V<=4*v?Z(0,V-1,f):H(0,V-1,f)};var v=32;function Z(f,v,Z){for(var V=2*(f+1),h=f+1;h<=v;++h){for(var J=Z[V++],l=Z[V++],e=h,C=V-2;e-- >f;){var H=Z[C-2],O=Z[C-1];if(H<J)break;if(H===J&&O<l)break;Z[C]=H,Z[C+1]=O,C-=2}Z[C]=J,Z[C+1]=l}}function V(f,v,Z){v*=2;var V=Z[f*=2],h=Z[f+1];Z[f]=Z[v],Z[f+1]=Z[v+1],Z[v]=V,Z[v+1]=h}function h(f,v,Z){v*=2,Z[f*=2]=Z[v],Z[f+1]=Z[v+1]}function J(f,v,Z,V){v*=2,Z*=2;var h=V[f*=2],J=V[f+1];V[f]=V[v],V[f+1]=V[v+1],V[v]=V[Z],V[v+1]=V[Z+1],V[Z]=h,V[Z+1]=J}function l(f,v,Z,V,h){v*=2,h[f*=2]=h[v],h[v]=Z,h[f+1]=h[v+1],h[v+1]=V}function e(f,v,Z){v*=2;var V=Z[f*=2],h=Z[v];return!(V<h)&&(V!==h||Z[f+1]>Z[v+1])}function C(f,v,Z,V){var h=V[f*=2];return h<v||h===v&&V[f+1]<Z}function H(f,O,u){var W=(O-f+1)/6|0,a=f+W,b=O-W,X=f+O>>1,F=X-W,U=X+W,K=a,M=F,A=X,s=U,z=b,Y=f+1,y=O-1,N=0;e(K,M,u)&&(N=K,K=M,M=N),e(s,z,u)&&(N=s,s=z,z=N),e(K,A,u)&&(N=K,K=A,A=N),e(M,A,u)&&(N=M,M=A,A=N),e(K,s,u)&&(N=K,K=s,s=N),e(A,s,u)&&(N=A,A=s,s=N),e(M,z,u)&&(N=M,M=z,z=N),e(M,A,u)&&(N=M,M=A,A=N),e(s,z,u)&&(N=s,s=z,z=N);for(var i=u[2*M],I=u[2*M+1],T=u[2*s],B=u[2*s+1],P=2*K,g=2*A,w=2*z,t=2*a,L=2*X,E=2*b,j=0;j<2;++j){var q=u[P+j],c=u[g+j],m=u[w+j];u[t+j]=q,u[L+j]=c,u[E+j]=m}h(F,f,u),h(U,O,u);for(var p=Y;p<=y;++p)if(C(p,i,I,u))p!==Y&&V(p,Y,u),++Y;else if(!C(p,T,B,u))for(;;){if(C(y,T,B,u)){C(y,i,I,u)?(J(p,Y,y,u),++Y,--y):(V(p,y,u),--y);break}if(--y<p)break}l(f,Y-1,i,I,u),l(O,y+1,T,B,u),Y-2-f<=v?Z(f,Y-2,u):H(f,Y-2,u),O-(y+2)<=v?Z(y+2,O,u):H(y+2,O,u),y-Y<=v?Z(Y,y,u):H(Y,y,u)}},13391:(f,v,Z)=>{"use strict";f.exports={init:function(f){var v=h.nextPow2(f);C.length<v&&(V.free(C),C=V.mallocInt32(v));H.length<v&&(V.free(H),H=V.mallocInt32(v));O.length<v&&(V.free(O),O=V.mallocInt32(v));u.length<v&&(V.free(u),u=V.mallocInt32(v));W.length<v&&(V.free(W),W=V.mallocInt32(v));a.length<v&&(V.free(a),a=V.mallocInt32(v));var Z=8*v;b.length<Z&&(V.free(b),b=V.mallocDouble(Z))},sweepBipartite:function(f,v,Z,V,h,e,W,a,U,K){for(var M=0,A=2*f,s=f-1,z=A-1,Y=Z;Y<V;++Y){var y=e[Y],N=A*Y;b[M++]=h[N+s],b[M++]=-(y+1),b[M++]=h[N+z],b[M++]=y}for(Y=W;Y<a;++Y){y=K[Y]+l;var i=A*Y;b[M++]=U[i+s],b[M++]=-y,b[M++]=U[i+z],b[M++]=y}var I=M>>>1;J(b,I);var T=0,B=0;for(Y=0;Y<I;++Y){var P=0|b[2*Y+1];if(P>=l)X(O,u,B--,P=P-l|0);else if(P>=0)X(C,H,T--,P);else if(P<=-l){P=-P-l|0;for(var g=0;g<T;++g){if(void 0!==(w=v(C[g],P)))return w}F(O,u,B++,P)}else{P=-P-1|0;for(g=0;g<B;++g){var w;if(void 0!==(w=v(P,O[g])))return w}F(C,H,T++,P)}}},sweepComplete:function(f,v,Z,V,h,l,e,U,K,M){for(var A=0,s=2*f,z=f-1,Y=s-1,y=Z;y<V;++y){var N=l[y]+1<<1,i=s*y;b[A++]=h[i+z],b[A++]=-N,b[A++]=h[i+Y],b[A++]=N}for(y=e;y<U;++y){N=M[y]+1<<1;var I=s*y;b[A++]=K[I+z],b[A++]=1|-N,b[A++]=K[I+Y],b[A++]=1|N}var T=A>>>1;J(b,T);var B=0,P=0,g=0;for(y=0;y<T;++y){var w=0|b[2*y+1],t=1&w;if(y<T-1&&w>>1===b[2*y+3]>>1&&(t=2,y+=1),w<0){for(var L=-(w>>1)-1,E=0;E<g;++E){if(void 0!==(j=v(W[E],L)))return j}if(0!==t)for(E=0;E<B;++E){if(void 0!==(j=v(C[E],L)))return j}if(1!==t)for(E=0;E<P;++E){var j;if(void 0!==(j=v(O[E],L)))return j}0===t?F(C,H,B++,L):1===t?F(O,u,P++,L):2===t&&F(W,a,g++,L)}else{L=(w>>1)-1;0===t?X(C,H,B--,L):1===t?X(O,u,P--,L):2===t&&X(W,a,g--,L)}}},scanBipartite:function(f,v,Z,V,h,e,O,u,W,a,U,K){var M=0,A=2*f,s=v,z=v+f,Y=1,y=1;V?y=l:Y=l;for(var N=h;N<e;++N){var i=N+Y,I=A*N;b[M++]=O[I+s],b[M++]=-i,b[M++]=O[I+z],b[M++]=i}for(N=W;N<a;++N){i=N+y;var T=A*N;b[M++]=U[T+s],b[M++]=-i}var B=M>>>1;J(b,B);var P=0;for(N=0;N<B;++N){var g=0|b[2*N+1];if(g<0){var w=!1;if((i=-g)>=l?(w=!V,i-=l):(w=!!V,i-=1),w)F(C,H,P++,i);else{var t=K[i],L=A*i,E=U[L+v+1],j=U[L+v+1+f];f:for(var q=0;q<P;++q){var c=C[q],m=A*c;if(!(j<O[m+v+1]||O[m+v+1+f]<E)){for(var p=v+2;p<f;++p)if(U[L+p+f]<O[m+p]||O[m+p+f]<U[L+p])continue f;var k,r=u[c];if(void 0!==(k=V?Z(t,r):Z(r,t)))return k}}}}else X(C,H,P--,g-Y)}},scanComplete:function(f,v,Z,V,h,e,H,O,u,W,a){for(var X=0,F=2*f,U=v,K=v+f,M=V;M<h;++M){var A=M+l,s=F*M;b[X++]=e[s+U],b[X++]=-A,b[X++]=e[s+K],b[X++]=A}for(M=O;M<u;++M){A=M+1;var z=F*M;b[X++]=W[z+U],b[X++]=-A}var Y=X>>>1;J(b,Y);var y=0;for(M=0;M<Y;++M){var N=0|b[2*M+1];if(N<0){if((A=-N)>=l)C[y++]=A-l;else{var i=a[A-=1],I=F*A,T=W[I+v+1],B=W[I+v+1+f];f:for(var P=0;P<y;++P){var g=C[P],w=H[g];if(w===i)break;var t=F*g;if(!(B<e[t+v+1]||e[t+v+1+f]<T)){for(var L=v+2;L<f;++L)if(W[I+L+f]<e[t+L]||e[t+L+f]<W[I+L])continue f;var E=Z(w,i);if(void 0!==E)return E}}}}else{for(A=N-l,P=y-1;P>=0;--P)if(C[P]===A){for(L=P+1;L<y;++L)C[L-1]=C[L];break}--y}}}};var V=Z(13371),h=Z(13380),J=Z(13400),l=1<<28,e=1024,C=V.mallocInt32(e),H=V.mallocInt32(e),O=V.mallocInt32(e),u=V.mallocInt32(e),W=V.mallocInt32(e),a=V.mallocInt32(e),b=V.mallocDouble(8192);function X(f,v,Z,V){var h=v[V],J=f[Z-1];f[h]=J,v[J]=h}function F(f,v,Z,V){f[Z]=V,v[V]=Z}},13383:f=>{"use strict";function v(f,Z,V){var h=0|f[V];if(h<=0)return[];var J,l=new Array(h);if(V===f.length-1)for(J=0;J<h;++J)l[J]=Z;else for(J=0;J<h;++J)l[J]=v(f,Z,V+1);return l}f.exports=function(f,Z){switch("undefined"===typeof Z&&(Z=0),typeof f){case"number":if(f>0)return function(f,v){var Z,V;for(Z=new Array(f),V=0;V<f;++V)Z[V]=v;return Z}(0|f,Z);break;case"object":if("number"===typeof f.length)return v(f,Z,0)}return[]}},13350:(f,v,Z)=>{f.exports=function(){var f=this;this.components={},this.comps=this.components;var v=this.components,Z=1,h={},J=[],l=[],e={timeout:!1,removals:[],multiComps:[]};function C(f,Z){var V=v[Z],J=h[Z],l=J.hash[f];l&&(J.remove(f),V.tv&&(V.multi?(l.forEach((v=>{v&&V.tv(f,v)})),l.length=0):V.tv(f,l)),e.removals.push(J),H())}function H(){e.timeout||(e.timeout=!0,setTimeout(O,1))}function O(){e.timeout=!1,u()}function u(){e.multiComps.length&&function(f){for(var v=0;v<f.length;v++){var{entID:Z,data:V}=f[v],h=V.hash[Z];if(h){for(var J=0;J<h.length;J++)h[J]||(h.splice(J,1),J--);0===h.length&&(V.remove(Z),e.removals.push(V))}}f.length=0}(e.multiComps),e.removals.length&&function(f){for(var v=0;v<f.length;v++){f[v].flush()}f.length=0}(e.removals)}this.Fu=h,this._systems=J,this._renderSystems=l,this.JO=function(v){var V=Z++;return Array.isArray(v)&&v.forEach((v=>f.kC(V,v))),V},this.deleteEntity=function(v){return Object.keys(h).forEach((f=>{h[f].hash[v]&&C(v,f)})),f},this.AO=function(f){if(!f)throw new Error("Missing component definition");var Z=f.name;if(!Z)throw new Error("Component definition must have a name property.");if("string"!==typeof Z)throw new Error("Component name must be a string.");if(""===Z)throw new Error("Component name must be a non-empty string.");if(h[Z])throw new Error(`Component ${Z} already exists.`);var e={};return e.name=Z,e.multi=!!f.multi,e.order=isNaN(f.order)?99:f.order,e.stateConstructor=f.stateConstructor||null,e.state=f.state||{},e.we=f.we||null,e.tv=f.tv||null,e.system=f.system||null,e.pe=f.pe||null,v[Z]=e,h[Z]=new V,h[Z]._pendingMultiCleanup=!1,h[Z]._multiCleanupIDs=e.multi?[]:null,e.system&&(J.push(Z),J.sort(((f,Z)=>v[f].order-v[Z].order))),e.pe&&(l.push(Z),l.sort(((f,Z)=>v[f].order-v[Z].order))),Z},this.overwriteComponent=function(f,Z){var V=v[f];if(!V)throw new Error(`Unknown component: ${f}`);if(!Z)throw new Error("Missing component definition");if(V.name!==Z.name)throw new Error("Overwriting component must use the same name property.");var e={};e.name=f,e.multi=!!Z.multi,e.order=isNaN(Z.order)?99:Z.order,e.state=Z.state||{},e.we=Z.we||null,e.tv=Z.tv||null,e.system=Z.system||null,e.pe=Z.pe||null,v[f]=e,h[f]._pendingMultiCleanup=!1,h[f]._multiCleanupIDs=e.multi?[]:null;var C=J.indexOf(f);e.system&&C<0&&J.push(f),!e.system&&C>=0&&J.splice(C,1),J.sort(((f,Z)=>v[f].order-v[Z].order));var H=l.indexOf(f);e.pe&&H<0&&l.push(f),!e.pe&&H>=0&&l.splice(H,1),l.sort(((f,Z)=>v[f].order-v[Z].order));var O=e.state;return this.mH(f).forEach((f=>{for(var v in O)v in f||(f[v]=O[v]);e.we&&e.we(f.ce,f)})),f},this.deleteComponent=function(Z){var V=h[Z];if(!V)throw new Error(`Unknown component: ${Z}`);V.flush(),V.list.forEach((f=>{f&&C(f.ce||f[0].ce,Z)}));var e=J.indexOf(Z),H=l.indexOf(Z);return e>-1&&J.splice(e,1),H>-1&&l.splice(H,1),h[Z].dispose(),delete h[Z],delete v[Z],f},this.kC=function(f,Z,V){var J,l=v[Z],e=h[Z];if(!e)throw new Error(`Unknown component: ${Z}.`);if(e.hash[f]&&!l.multi)throw new Error(`Entity ${f} already has component: ${Z}.`);if(l.stateConstructor){if(!(J=new l.stateConstructor).hasOwnProperty("ce"))throw new Error(`Component ${l.name} stateConstructor type does not have property __id`)}else J=Object.assign({},{ce:f},l.state,V);if(J.ce=f,l.multi){var C=e.hash[f];C||(C=[],e.add(f,C)),C.push(J)}else e.add(f,J);return l.we&&l.we(f,J),this},this.DC=function(f,v){var Z=h[v];if(!Z)throw new Error(`Unknown component: ${v}.`);return!!Z.hash[f]},this.QC=function(v,Z){if(!h[Z])throw new Error(`Unknown component: ${Z}.`);return C(v,Z),f},this.getState=function(f,v){var Z=h[v];if(!Z)throw new Error(`Unknown component: ${v}.`);return Z.hash[f]},this.mH=function(f){var v=h[f];if(!v)throw new Error(`Unknown component: ${f}.`);return u(),v.list},this.Ja=function(f){if(!h[f])throw new Error(`Unknown component: ${f}.`);var v=h[f].hash;return f=>v[f]},this.Ca=function(f){if(!h[f])throw new Error(`Unknown component: ${f}.`);var v=h[f].hash;return f=>!!v[f]},this.Ue=function(Z){u();for(var V=0;V<J.length;V++){var l=J[V],e=v[l],C=h[l];e.system(Z,C.list),u()}return f},this.render=function(Z){u();for(var V=0;V<l.length;V++){var J=l[V],e=v[J],C=h[J];e.pe(Z,C.list),u()}return f},this.removeMultiComponent=function(Z,V,J){var l=v[V],C=h[V];if(!C)throw new Error(`Unknown component: ${V}.`);if(!l.multi)throw new Error("removeMultiComponent called on non-multi component");return function(f,v,Z,V){var h=Z.hash[f];if(h){var J=h[V];J&&(h[V]=null,v.tv&&v.tv(f,J),e.multiComps.push({entID:f,data:Z}),H())}}(Z,l,C,J),f}};var V=Z(13352)},13352:f=>{function v(f,v){var Z=f._map[v];if(delete f.hash[v],delete f._map[v],Z===f.list.length-1)f.list.pop();else{var V=f.list.pop();if(f.list[Z]=V,null===V||null===V[0]){var h=f.list.length;for(var J in f._map)if(f._map[J]===h)return void(f._map[J]=Z)}else{var l=V.ce||V[0].ce;f._map[l]=Z}}}f.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(f,v){if("number"===typeof this._map[f]){var Z=this._map[f];this.hash[f]=v,this.list[Z]=v}else this._map[f]=this.list.length,this.hash[f]=v,this.list.push(v)}remove(f){var v=this._map[f];this.hash[f]=null,this.list[v]=null,this._pendingRemovals.push(f)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var f=0;f<this._pendingRemovals.length;f++){var Z=this._pendingRemovals[f];null===this.hash[Z]&&v(this,Z)}this._pendingRemovals.length=0}}},13313:f=>{"use strict";var v,Z="object"===typeof Reflect?Reflect:null,V=function(f,v,Z){return Function.prototype.apply.call(f,v,Z)};v=Z&&"function"===typeof Z.ownKeys?Z.ownKeys:Object.getOwnPropertySymbols?function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:function(f){return Object.getOwnPropertyNames(f)};var h=Number.isNaN||function(f){return f!==f};function J(){J.init.call(this)}f.exports=J,f.exports.once=function(f,v){return new Promise((function(Z,V){function h(Z){f.removeListener(v,J),V(Z)}function J(){"function"===typeof f.removeListener&&f.removeListener("error",h),Z([].slice.call(arguments))}X(f,v,J,{once:!0}),"error"!==v&&function(f,v,Z){"function"===typeof f.on&&X(f,"error",v,Z)}(f,h,{once:!0})}))},J.EventEmitter=J,J.prototype._events=void 0,J.prototype._eventsCount=0,J.prototype._maxListeners=void 0;var l=10;function e(f){if("function"!==typeof f)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}function C(f){return void 0===f._maxListeners?J.defaultMaxListeners:f._maxListeners}function H(f,v,Z,V){var h,J,l,H;if(e(Z),void 0===(J=f._events)?(J=f._events=Object.create(null),f._eventsCount=0):(void 0!==J.newListener&&(f.emit("newListener",v,Z.listener?Z.listener:Z),J=f._events),l=J[v]),void 0===l)l=J[v]=Z,++f._eventsCount;else if("function"===typeof l?l=J[v]=V?[Z,l]:[l,Z]:V?l.unshift(Z):l.push(Z),(h=C(f))>0&&l.length>h&&!l.warned){l.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.hv=f,O.type=v,O.count=l.length,H=O,console&&console.warn&&console.warn(H)}return f}function O(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(f,v,Z){var V={fired:!1,wrapFn:void 0,target:f,type:v,listener:Z},h=O.bind(V);return h.listener=Z,V.wrapFn=h,h}function W(f,v,Z){var V=f._events;if(void 0===V)return[];var h=V[v];return void 0===h?[]:"function"===typeof h?Z?[h.listener||h]:[h]:Z?function(f){for(var v=new Array(f.length),Z=0;Z<v.length;++Z)v[Z]=f[Z].listener||f[Z];return v}(h):b(h,h.length)}function a(f){var v=this._events;if(void 0!==v){var Z=v[f];if("function"===typeof Z)return 1;if(void 0!==Z)return Z.length}return 0}function b(f,v){for(var Z=new Array(v),V=0;V<v;++V)Z[V]=f[V];return Z}function X(f,v,Z,V){if("function"===typeof f.on)V.once?f.once(v,Z):f.on(v,Z);else{if("function"!==typeof f.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f);f.addEventListener(v,(function h(J){V.once&&f.removeEventListener(v,h),Z(J)}))}}Object.defineProperty(J,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(f){if("number"!==typeof f||f<0||h(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");l=f}}),J.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},J.prototype.setMaxListeners=function(f){if("number"!==typeof f||f<0||h(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this},J.prototype.getMaxListeners=function(){return C(this)},J.prototype.emit=function(f){for(var v=[],Z=1;Z<arguments.length;Z++)v.push(arguments[Z]);var h="error"===f,J=this._events;if(void 0!==J)h=h&&void 0===J.error;else if(!h)return!1;if(h){var l;if(v.length>0&&(l=v[0]),l instanceof Error)throw l;var e=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw e.context=l,e}var C=J[f];if(void 0===C)return!1;if("function"===typeof C)V(C,this,v);else{var H=C.length,O=b(C,H);for(Z=0;Z<H;++Z)V(O[Z],this,v)}return!0},J.prototype.addListener=function(f,v){return H(this,f,v,!1)},J.prototype.on=J.prototype.addListener,J.prototype.prependListener=function(f,v){return H(this,f,v,!0)},J.prototype.once=function(f,v){return e(v),this.on(f,u(this,f,v)),this},J.prototype.prependOnceListener=function(f,v){return e(v),this.prependListener(f,u(this,f,v)),this},J.prototype.removeListener=function(f,v){var Z,V,h,J,l;if(e(v),void 0===(V=this._events))return this;if(void 0===(Z=V[f]))return this;if(Z===v||Z.listener===v)0===--this._eventsCount?this._events=Object.create(null):(delete V[f],V.removeListener&&this.emit("removeListener",f,Z.listener||v));else if("function"!==typeof Z){for(h=-1,J=Z.length-1;J>=0;J--)if(Z[J]===v||Z[J].listener===v){l=Z[J].listener,h=J;break}if(h<0)return this;0===h?Z.shift():function(f,v){for(;v+1<f.length;v++)f[v]=f[v+1];f.pop()}(Z,h),1===Z.length&&(V[f]=Z[0]),void 0!==V.removeListener&&this.emit("removeListener",f,l||v)}return this},J.prototype.off=J.prototype.removeListener,J.prototype.Jv=function(f){var v,Z,V;if(void 0===(Z=this._events))return this;if(void 0===Z.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Z[f]&&(0===--this._eventsCount?this._events=Object.create(null):delete Z[f]),this;if(0===arguments.length){var h,J=Object.keys(Z);for(V=0;V<J.length;++V)"removeListener"!==(h=J[V])&&this.Jv(h);return this.Jv("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(v=Z[f]))this.removeListener(f,v);else if(void 0!==v)for(V=v.length-1;V>=0;V--)this.removeListener(f,v[V]);return this},J.prototype.listeners=function(f){return W(this,f,!0)},J.prototype.rawListeners=function(f){return W(this,f,!1)},J.listenerCount=function(f,v){return"function"===typeof f.listenerCount?f.listenerCount(v):a.call(f,v)},J.prototype.listenerCount=a,J.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]}},13591:f=>{"use strict";f.exports=function(f,v,Z,V,h,J){var l=+v[0],e=+v[1],C=+v[2],H=+Z[0],O=+Z[1],u=+Z[2],W=Math.sqrt(H*H+O*O+u*u);if(0===W)throw new Error("Can't raycast along a zero vector");return function(f,v,Z,V,h,J,l,e,C,H){for(var O=0,u=Math.floor,W=0|u(v),a=0|u(Z),b=0|u(V),X=h>0?1:-1,F=J>0?1:-1,U=l>0?1:-1,K=Math.abs(1/h),M=Math.abs(1/J),A=Math.abs(1/l),s=K<1/0?K*(X>0?W+1-v:v-W):1/0,z=M<1/0?M*(F>0?a+1-Z:Z-a):1/0,Y=A<1/0?A*(U>0?b+1-V:V-b):1/0,y=-1;O<=e;){var N=f(W,a,b);if(N)return C&&(C[0]=v+O*h,C[1]=Z+O*J,C[2]=V+O*l),H&&(H[0]=H[1]=H[2]=0,0===y&&(H[0]=-X),1===y&&(H[1]=-F),2===y&&(H[2]=-U)),N;s<z?s<Y?(W+=X,O=s,s+=K,y=0):(b+=U,O=Y,Y+=A,y=2):z<Y?(a+=F,O=z,z+=M,y=1):(b+=U,O=Y,Y+=A,y=2)}return C&&(C[0]=v+O*h,C[1]=Z+O*J,C[2]=V+O*l),H&&(H[0]=H[1]=H[2]=0),0}(f,l,e,C,H/=W,O/=W,u/=W,V="undefined"===typeof V?64:+V,h,J)}},13628:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>J});var V=Z(13313);function h(){this.JW=!1,this.stopPropagation=!1,this.lW=!1,this.disabled=!1}class J{constructor(f,v){this.version="0.7.0";var Z=Object.assign({},new h,v||{});this.element=f||document,this.JW=!!Z.JW,this.stopPropagation=!!Z.stopPropagation,this.lW=!!Z.lW,this.disabled=!!Z.disabled,this.filterEvents=(f,v)=>!0,this.down=new V.EventEmitter,this.up=new V.EventEmitter,this.state={},this.tH={dx:0,dy:0,RW:0,wH:0,nW:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?e(this):document.addEventListener("DOMContentLoaded",(f=>{e(this)}),{once:!0})}bind(f){for(var v=arguments.length,Z=new Array(v>1?v-1:0),V=1;V<v;V++)Z[V-1]=arguments[V];Z.forEach((v=>{var Z=this._keyBindmap[v]||[];Z.includes(f)||(Z.push(f),this._keyBindmap[v]=Z)})),this.state[f]=!!this.state[f],this.pressCount[f]=this.pressCount[f]||0,this.releaseCount[f]=this.releaseCount[f]||0}unbind(f){for(var v in this._keyBindmap){var Z=this._keyBindmap[v],V=Z.indexOf(f);V>-1&&Z.splice(V,1)}}getBindings(){var f={};for(var v in this._keyBindmap){this._keyBindmap[v].forEach((Z=>{f[Z]=f[Z]||[],f[Z].push(v)}))}return f}Ue(){l(this.tH),l(this.pressCount),l(this.releaseCount)}}function l(f){for(var v in f)f[v]=0}function e(f){window.addEventListener("keydown",b.bind(null,f,!0),!1),window.addEventListener("keyup",b.bind(null,f,!1),!1);var v={passive:!0};f.element.addEventListener("touchstart",u.bind(void 0,f),{passive:!1}),f.element.addEventListener("touchend",a.bind(void 0,f),v),f.element.addEventListener("mousedown",X.bind(null,f,!0),v),window.document.addEventListener("mouseup",X.bind(null,f,!1),v),f.element.addEventListener("touchmove",F.bind(null,f),v),f.element.addEventListener("mousemove",F.bind(null,f),v),window.PointerEvent,f.element.addEventListener("wheel",U.bind(null,f),v),f.element.addEventListener("contextmenu",K.bind(null,f),!1),window.addEventListener("blur",M.bind(null,f),!1)}var C=0,H=0,O=null;function u(f,v){v.preventDefault(),W(v)}function W(f){let v=!1;for(let Z=0;Z<f.touches.length;++Z)if(f.touches[Z].identifier===O){v=!0;break}if(!v){const v=f.changedTouches[0];C=v.clientX,H=v.clientY,O=v.identifier}}function a(f,v){for(var Z=v.changedTouches,V=0;V<Z.length;++V)Z[V].identifier===O&&(O=null)}function b(f,v,Z){A(Z.code,v,f,Z)}function X(f,v,Z){if("pointerId"in Z)if(v){if(null!==f._touches.currID)return;f._touches.currID=Z.pointerId}else{if(f._touches.currID!==Z.pointerId)return;f._touches.currID=null}return A("Mouse"+("button"in Z?Z.button+1:1),v,f,Z),!1}function F(f,v){var Z=v.movementX||v.mozMovementX||0,V=v.movementY||v.mozMovementY||0;if(v.touches&&0===(Z|V)){var h=function(f){W(f);for(let v=0;v<f.changedTouches.length;++v)if(f.changedTouches[v].identifier==O){const Z=f.changedTouches[v],V=[Z.clientX-C,Z.clientY-H];return C=Z.clientX,H=Z.clientY,V}return console.error(`Did not find touch id ${O}`),[0,0]}(v);Z=h[0],V=h[1]}f.tH.dx+=Z,f.tH.dy+=V}function U(f,v){var Z=1;switch(v.deltaMode){case 0:Z=1;break;case 1:Z=12;break;case 2:Z=f.element.clientHeight||window.innerHeight}f.tH.RW+=(v.deltaX||0)*Z,f.tH.wH+=(v.deltaY||0)*Z,f.tH.nW+=(v.deltaZ||0)*Z}function K(f,v){if(!f.lW)return v.preventDefault(),!1}function M(f){for(var v in f._keyStates)f._keyStates[v]&&(/^Mouse\d/.test(v)||A(v,!1,f,{code:v,note:"i1hn6czh6ye",preventDefault:()=>{},stopPropagation:()=>{}}))}function A(f,v,Z,V){var h=Z._keyBindmap[f];h&&(s(Z._keyStates[f],v)&&(Z._keyStates[f]=v,h.forEach((f=>{(!Z.filterEvents||Z.filterEvents(V,f))&&function(f,v,Z,V){var h=v?Z.pressCount:Z.releaseCount;h[f]=(h[f]||0)+1;var J=Z._bindPressCount[f]||0;(J+=v?1:-1)<0&&(J=0);Z._bindPressCount[f]=J;var l=Z.state[f];if(s(l,J)){Z.state[f]=J>0;var e=v?Z.down:Z.up;Z.disabled||e.emit(f,V)}}(f,v,Z,V)}))),"button"in V||(Z.JW&&!V.defaultPrevented&&V.preventDefault(),Z.stopPropagation&&V.stopPropagation()))}function s(f,v){return f?!v:v}},12290:f=>{f.exports=function(f,v,Z){return f[0]=v[0]+Z[0],f[1]=v[1]+Z[1],f[2]=v[2]+Z[2],f}},12247:(f,v,Z)=>{f.exports=function(f,v){var Z=V(f[0],f[1],f[2]),l=V(v[0],v[1],v[2]);h(Z,Z),h(l,l);var e=J(Z,l);return e>1?0:Math.acos(e)};var V=Z(12251),h=Z(12259),J=Z(12267)},12347:f=>{f.exports=function(f,v){return f[0]=Math.ceil(v[0]),f[1]=Math.ceil(v[1]),f[2]=Math.ceil(v[2]),f}},12238:f=>{f.exports=function(f){var v=new Float32Array(3);return v[0]=f[0],v[1]=f[1],v[2]=f[2],v}},12269:f=>{f.exports=function(f,v){return f[0]=v[0],f[1]=v[1],f[2]=v[2],f}},12232:f=>{f.exports=function(){var f=new Float32Array(3);return f[0]=0,f[1]=0,f[2]=0,f}},12431:f=>{f.exports=function(f,v,Z){var V=v[0],h=v[1],J=v[2],l=Z[0],e=Z[1],C=Z[2];return f[0]=h*C-J*e,f[1]=J*l-V*C,f[2]=V*e-h*l,f}},12381:(f,v,Z)=>{f.exports=Z(12372)},12372:f=>{f.exports=function(f,v){var Z=v[0]-f[0],V=v[1]-f[1],h=v[2]-f[2];return Math.sqrt(Z*Z+V*V+h*h)}},12328:(f,v,Z)=>{f.exports=Z(12319)},12319:f=>{f.exports=function(f,v,Z){return f[0]=v[0]/Z[0],f[1]=v[1]/Z[1],f[2]=v[2]/Z[2],f}},12267:f=>{f.exports=function(f,v){return f[0]*v[0]+f[1]*v[1]+f[2]*v[2]}},12226:f=>{f.exports=1e-6},12279:(f,v,Z)=>{f.exports=function(f,v){var Z=f[0],h=f[1],J=f[2],l=v[0],e=v[1],C=v[2];return Math.abs(Z-l)<=V*Math.max(1,Math.abs(Z),Math.abs(l))&&Math.abs(h-e)<=V*Math.max(1,Math.abs(h),Math.abs(e))&&Math.abs(J-C)<=V*Math.max(1,Math.abs(J),Math.abs(C))};var V=Z(12226)},12283:f=>{f.exports=function(f,v){return f[0]===v[0]&&f[1]===v[1]&&f[2]===v[2]}},12339:f=>{f.exports=function(f,v){return f[0]=Math.floor(v[0]),f[1]=Math.floor(v[1]),f[2]=Math.floor(v[2]),f}},12491:(f,v,Z)=>{f.exports=function(f,v,Z,h,J,l){var e,C;v||(v=3);Z||(Z=0);C=h?Math.min(h*v+Z,f.length):f.length;for(e=Z;e<C;e+=v)V[0]=f[e],V[1]=f[e+1],V[2]=f[e+2],J(V,V,l),f[e]=V[0],f[e+1]=V[1],f[e+2]=V[2];return f};var V=Z(12232)()},12251:f=>{f.exports=function(f,v,Z){var V=new Float32Array(3);return V[0]=f,V[1]=v,V[2]=Z,V}},12217:(f,v,Z)=>{f.exports={EPSILON:Z(12226),create:Z(12232),clone:Z(12238),angle:Z(12247),le:Z(12251),k:Z(12269),set:Z(12276),equals:Z(12279),exactEquals:Z(12283),add:Z(12290),Fv:Z(12294),sub:Z(12302),multiply:Z(12306),mul:Z(12312),divide:Z(12319),div:Z(12328),min:Z(12331),max:Z(12337),floor:Z(12339),ceil:Z(12347),round:Z(12350),scale:Z(12358),ee:Z(12364),distance:Z(12372),i:Z(12381),squaredDistance:Z(12389),sqrDist:Z(12394),length:Z(12397),len:Z(12404),squaredLength:Z(12413),Ce:Z(12422),negate:Z(12424),inverse:Z(12427),normalize:Z(12259),dot:Z(12267),cross:Z(12431),Dl:Z(12440),random:Z(12443),transformMat4:Z(12450),transformMat3:Z(12453),transformQuat:Z(12462),He:Z(12467),Oe:Z(12474),We:Z(12483),forEach:Z(12491)}},12427:f=>{f.exports=function(f,v){return f[0]=1/v[0],f[1]=1/v[1],f[2]=1/v[2],f}},12404:(f,v,Z)=>{f.exports=Z(12397)},12397:f=>{f.exports=function(f){var v=f[0],Z=f[1],V=f[2];return Math.sqrt(v*v+Z*Z+V*V)}},12440:f=>{f.exports=function(f,v,Z,V){var h=v[0],J=v[1],l=v[2];return f[0]=h+V*(Z[0]-h),f[1]=J+V*(Z[1]-J),f[2]=l+V*(Z[2]-l),f}},12337:f=>{f.exports=function(f,v,Z){return f[0]=Math.max(v[0],Z[0]),f[1]=Math.max(v[1],Z[1]),f[2]=Math.max(v[2],Z[2]),f}},12331:f=>{f.exports=function(f,v,Z){return f[0]=Math.min(v[0],Z[0]),f[1]=Math.min(v[1],Z[1]),f[2]=Math.min(v[2],Z[2]),f}},12312:(f,v,Z)=>{f.exports=Z(12306)},12306:f=>{f.exports=function(f,v,Z){return f[0]=v[0]*Z[0],f[1]=v[1]*Z[1],f[2]=v[2]*Z[2],f}},12424:f=>{f.exports=function(f,v){return f[0]=-v[0],f[1]=-v[1],f[2]=-v[2],f}},12259:f=>{f.exports=function(f,v){var Z=v[0],V=v[1],h=v[2],J=Z*Z+V*V+h*h;J>0&&(J=1/Math.sqrt(J),f[0]=v[0]*J,f[1]=v[1]*J,f[2]=v[2]*J);return f}},12443:f=>{f.exports=function(f,v){v=v||1;var Z=2*Math.random()*Math.PI,V=2*Math.random()-1,h=Math.sqrt(1-V*V)*v;return f[0]=Math.cos(Z)*h,f[1]=Math.sin(Z)*h,f[2]=V*v,f}},12467:f=>{f.exports=function(f,v,Z,V){var h=Z[1],J=Z[2],l=v[1]-h,e=v[2]-J,C=Math.sin(V),H=Math.cos(V);return f[0]=v[0],f[1]=h+l*H-e*C,f[2]=J+l*C+e*H,f}},12474:f=>{f.exports=function(f,v,Z,V){var h=Z[0],J=Z[2],l=v[0]-h,e=v[2]-J,C=Math.sin(V),H=Math.cos(V);return f[0]=h+e*C+l*H,f[1]=v[1],f[2]=J+e*H-l*C,f}},12483:f=>{f.exports=function(f,v,Z,V){var h=Z[0],J=Z[1],l=v[0]-h,e=v[1]-J,C=Math.sin(V),H=Math.cos(V);return f[0]=h+l*H-e*C,f[1]=J+l*C+e*H,f[2]=v[2],f}},12350:f=>{f.exports=function(f,v){return f[0]=Math.round(v[0]),f[1]=Math.round(v[1]),f[2]=Math.round(v[2]),f}},12358:f=>{f.exports=function(f,v,Z){return f[0]=v[0]*Z,f[1]=v[1]*Z,f[2]=v[2]*Z,f}},12364:f=>{f.exports=function(f,v,Z,V){return f[0]=v[0]+Z[0]*V,f[1]=v[1]+Z[1]*V,f[2]=v[2]+Z[2]*V,f}},12276:f=>{f.exports=function(f,v,Z,V){return f[0]=v,f[1]=Z,f[2]=V,f}},12394:(f,v,Z)=>{f.exports=Z(12389)},12422:(f,v,Z)=>{f.exports=Z(12413)},12389:f=>{f.exports=function(f,v){var Z=v[0]-f[0],V=v[1]-f[1],h=v[2]-f[2];return Z*Z+V*V+h*h}},12413:f=>{f.exports=function(f){var v=f[0],Z=f[1],V=f[2];return v*v+Z*Z+V*V}},12302:(f,v,Z)=>{f.exports=Z(12294)},12294:f=>{f.exports=function(f,v,Z){return f[0]=v[0]-Z[0],f[1]=v[1]-Z[1],f[2]=v[2]-Z[2],f}},12453:f=>{f.exports=function(f,v,Z){var V=v[0],h=v[1],J=v[2];return f[0]=V*Z[0]+h*Z[3]+J*Z[6],f[1]=V*Z[1]+h*Z[4]+J*Z[7],f[2]=V*Z[2]+h*Z[5]+J*Z[8],f}},12450:f=>{f.exports=function(f,v,Z){var V=v[0],h=v[1],J=v[2],l=Z[3]*V+Z[7]*h+Z[11]*J+Z[15];return l=l||1,f[0]=(Z[0]*V+Z[4]*h+Z[8]*J+Z[12])/l,f[1]=(Z[1]*V+Z[5]*h+Z[9]*J+Z[13])/l,f[2]=(Z[2]*V+Z[6]*h+Z[10]*J+Z[14])/l,f}},12462:f=>{f.exports=function(f,v,Z){var V=v[0],h=v[1],J=v[2],l=Z[0],e=Z[1],C=Z[2],H=Z[3],O=H*V+e*J-C*h,u=H*h+C*V-l*J,W=H*J+l*h-e*V,a=-l*V-e*h-C*J;return f[0]=O*H+a*-l+u*-C-W*-e,f[1]=u*H+a*-e+W*-l-O*-C,f[2]=W*H+a*-C+O*-e-u*-l,f}},13341:f=>{"use strict";f.exports=function(f){for(var v=new Array(f),Z=0;Z<f;++Z)v[Z]=Z;return v}},13386:f=>{f.exports=function(f){return null!=f&&null!=f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}},13594:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>V});class V{constructor(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.pO=!1,this.kO=!1,this.cO=30,this.mO=0,this.nO=!1,this.fullscreen=!1,this.oO=function(f){},this.GO=function(){},this.xO=function(){},this.IV=function(){},this.QO=function(f){},this.onFullscreenChanged=function(f){},H((()=>{!function(f,v){f._nowObject=performance||Date,f._lastTick=0,f._renderAccum=0,f._rt=0,f._frameCB=e.bind(null,f),requestAnimationFrame(f._frameCB),v>0&&(f._intervalCB=l.bind(null,f),f._interval=setInterval(f._intervalCB,Math.max(v,1e3/f.cO/2)))}(this,v),function(f,v){if(!v)return;var Z=!1,V=!1;document.addEventListener("pointerlockchange",(V=>{Z=document.pointerLockElement===v,f.QO(Z)})),document.addEventListener("fullscreenchange",(Z=>{V=document.fullscreenElement===v,f.onFullscreenChanged(V)})),Object.defineProperty(f,"nO",{get:()=>Z,set:f=>{f&&!Z?C(v):Z&&!f&&function(f){f.exitPointerLock&&f.exitPointerLock()}(document)}}),Object.defineProperty(f,"fullscreen",{get:()=>V,set:f=>{f&&!V?v.requestFullscreen():V&&!f&&document.exitFullscreen()}}),v.addEventListener("click",(h=>{f.pO&&!Z&&C(v),f.kO&&!V&&v.requestFullscreen()}));var h=()=>f.IV();if(window.ResizeObserver){new ResizeObserver(h).observe(v)}else window.addEventListener("resize",h)}(this,f),this.xO()}))}}var h=3,J=20;function l(f){for(var v=1e3/f.cO,Z=f._nowObject.now()+J,V=0;f._nowObject.now()>=f._lastTick+v&&f._nowObject.now()<Z&&++V<=h;)f.oO(v),f._lastTick+=v;var l=5*(v+5),e=f._nowObject.now();if(e-f._lastTick>l)for(;e>=f._lastTick+v;)f._lastTick+=v}function e(f){requestAnimationFrame(f._frameCB),l(f);var v=f._nowObject.now(),Z=v-f._rt;if(f._rt=v,f.mO>0){f._renderAccum+=Z;var V=1e3/f.mO;if(f._renderAccum<V)return;f._renderAccum=Math.min(f._renderAccum-V,V)}var h=1e3/f.cO,J=(v-f._lastTick)/h;f.GO(Z,J,h)}function C(f){f.requestPointerLock&&f.requestPointerLock()}var H=f=>{if("loading"===document.readyState){var v=()=>{document.removeEventListener("readystatechange",v),f()};document.addEventListener("readystatechange",v)}else setTimeout(f,1)}},13333:(f,v,Z)=>{var V=Z(13341),h=Z(13344),J="undefined"!==typeof Float64Array;function l(f,v){return f[0]-v[0]}function e(){var f,v=this.stride,Z=new Array(v.length);for(f=0;f<Z.length;++f)Z[f]=[Math.abs(v[f]),f];Z.sort(l);var V=new Array(Z.length);for(f=0;f<V.length;++f)V[f]=Z[f][1];return V}function C(f,v){var Z=["View",v,"d",f].join("");v<0&&(Z="View_Nil"+f);var h="generic"===f;if(-1===v){var J="function "+Z+"(a){this.data=a;};var proto="+Z+".prototype;proto.dtype='"+f+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Z+"(a){return new "+Z+"(a);}";return new Function(J)()}if(0===v){J="function "+Z+"(a,d) {this.data = a;this.offset = d};var proto="+Z+".prototype;proto.dtype='"+f+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Z+"_copy() {return new "+Z+"(this.data,this.offset)};proto.pick=function "+Z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Z+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Z+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Z+"(a,b,c,d){return new "+Z+"(a,d)}";return new Function("TrivialArray",J)(H[f][0])}J=["'use strict'"];var l=V(v),C=l.map((function(f){return"i"+f})),O="this.offset+"+l.map((function(f){return"this.stride["+f+"]*i"+f})).join("+"),u=l.map((function(f){return"b"+f})).join(","),W=l.map((function(f){return"c"+f})).join(",");J.push("function "+Z+"(a,"+u+","+W+",d){this.data=a","this.shape=["+u+"]","this.stride=["+W+"]","this.offset=d|0}","var proto="+Z+".prototype","proto.dtype='"+f+"'","proto.dimension="+v),J.push("Object.defineProperty(proto,'size',{get:function "+Z+"_size(){return "+l.map((function(f){return"this.shape["+f+"]"})).join("*"),"}})"),1===v?J.push("proto.order=[0]"):(J.push("Object.defineProperty(proto,'order',{get:"),v<4?(J.push("function "+Z+"_order(){"),2===v?J.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&J.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):J.push("ORDER})")),J.push("proto.set=function "+Z+"_set("+C.join(",")+",v){"),h?J.push("return this.data.set("+O+",v)}"):J.push("return this.data["+O+"]=v}"),J.push("proto.get=function "+Z+"_get("+C.join(",")+"){"),h?J.push("return this.data.get("+O+")}"):J.push("return this.data["+O+"]}"),J.push("proto.index=function "+Z+"_index(",C.join(),"){return "+O+"}"),J.push("proto.hi=function "+Z+"_hi("+C.join(",")+"){return new "+Z+"(this.data,"+l.map((function(f){return["(typeof i",f,"!=='number'||i",f,"<0)?this.shape[",f,"]:i",f,"|0"].join("")})).join(",")+","+l.map((function(f){return"this.stride["+f+"]"})).join(",")+",this.offset)}");var a=l.map((function(f){return"a"+f+"=this.shape["+f+"]"})),b=l.map((function(f){return"c"+f+"=this.stride["+f+"]"}));J.push("proto.lo=function "+Z+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+b.join(","));for(var X=0;X<v;++X)J.push("if(typeof i"+X+"==='number'&&i"+X+">=0){d=i"+X+"|0;b+=c"+X+"*d;a"+X+"-=d}");J.push("return new "+Z+"(this.data,"+l.map((function(f){return"a"+f})).join(",")+","+l.map((function(f){return"c"+f})).join(",")+",b)}"),J.push("proto.step=function "+Z+"_step("+C.join(",")+"){var "+l.map((function(f){return"a"+f+"=this.shape["+f+"]"})).join(",")+","+l.map((function(f){return"b"+f+"=this.stride["+f+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(X=0;X<v;++X)J.push("if(typeof i"+X+"==='number'){d=i"+X+"|0;if(d<0){c+=b"+X+"*(a"+X+"-1);a"+X+"=ceil(-a"+X+"/d)}else{a"+X+"=ceil(a"+X+"/d)}b"+X+"*=d}");J.push("return new "+Z+"(this.data,"+l.map((function(f){return"a"+f})).join(",")+","+l.map((function(f){return"b"+f})).join(",")+",c)}");var F=new Array(v),U=new Array(v);for(X=0;X<v;++X)F[X]="a[i"+X+"]",U[X]="b[i"+X+"]";J.push("proto.transpose=function "+Z+"_transpose("+C+"){"+C.map((function(f,v){return f+"=("+f+"===undefined?"+v+":"+f+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Z+"(this.data,"+F.join(",")+","+U.join(",")+",this.offset)}"),J.push("proto.pick=function "+Z+"_pick("+C+"){var a=[],b=[],c=this.offset");for(X=0;X<v;++X)J.push("if(typeof i"+X+"==='number'&&i"+X+">=0){c=(c+this.stride["+X+"]*i"+X+")|0}else{a.push(this.shape["+X+"]);b.push(this.stride["+X+"])}");return J.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),J.push("return function construct_"+Z+"(data,shape,stride,offset){return new "+Z+"(data,"+l.map((function(f){return"shape["+f+"]"})).join(",")+","+l.map((function(f){return"stride["+f+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",J.join("\n"))(H[f],e)}var H={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};f.exports=function(f,v,Z,V){if(void 0===f)return(0,H.array[0])([]);"number"===typeof f&&(f=[f]),void 0===v&&(v=[f.length]);var l=v.length;if(void 0===Z){Z=new Array(l);for(var e=l-1,O=1;e>=0;--e)Z[e]=O,O*=v[e]}if(void 0===V){V=0;for(e=0;e<l;++e)Z[e]<0&&(V-=(v[e]-1)*Z[e])}for(var u=function(f){if(h(f))return"buffer";if(J)switch(Object.prototype.toString.call(f)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(f)?"array":"generic"}(f),W=H[u];W.length<=l+1;)W.push(C(u,W.length-1));return(0,W[l+1])(f,v,Z,V)}},13344:f=>{function v(f){return!!f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}f.exports=function(f){return null!=f&&(v(f)||function(f){return"function"===typeof f.readFloatLE&&"function"===typeof f.slice&&v(f.slice(0,0))}(f)||!!f._isBuffer)}},13459:f=>{"use strict";var v=[],Z=[],V=[],h=[],J=[],l=[],e=[],C=[],H=[],O=[],u=[],W=[];f.exports=function(f,a,b,X,F,U){for(var K=e,M=H,A=O,s=W,z=0;z<3;z++)K[z]=+b[z],A[z]=+a.max[z],M[z]=+a.base[z];U||(U=1e-10);var Y=function(f,e,H,O,W,a){var b=v,X=Z,F=V,U=h,K=J,M=l,A=C,s=Math.floor,z=0,Y=0,y=0,N=0,i=0;if(I(),0===y)return 0;for(N=P();Y<=y;){if(T(N)&&B())return z;N=P()}for(z+=y,i=0;i<3;i++)O[i]+=H[i],W[i]+=H[i];return z;function I(){if(Y=0,0!==(y=Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2])))for(var f=0;f<3;f++){var v=H[f]>=0;U[f]=v?1:-1;var Z=v?W[f]:O[f];b[f]=v?O[f]:W[f],X[f]=g(Z,U[f]),F[f]=w(b[f],U[f]),A[f]=H[f]/y,K[f]=Math.abs(1/A[f]);var V=v?X[f]+1-Z:Z-X[f];M[f]=K[f]<1/0?K[f]*V:1/0}}function T(v){for(var Z=U[0],V=0===v?X[0]:F[0],h=X[0]+Z,J=U[1],l=1===v?X[1]:F[1],e=X[1]+J,C=U[2],H=2===v?X[2]:F[2],O=X[2]+C,u=V;u!=h;u+=Z)for(var W=l;W!=e;W+=J)for(var a=H;a!=O;a+=C)if(f(u,W,a))return!0;return!1}function B(){z+=Y;var f=U[N],v=Y/y,Z=u;for(i=0;i<3;i++){var V=H[i]*v;O[i]+=V,W[i]+=V,Z[i]=H[i]-V}if(f>0?W[N]=Math.round(W[N]):O[N]=Math.round(O[N]),e(z,N,f,Z))return!0;for(i=0;i<3;i++)H[i]=Z[i];return I(),0===y}function P(){var f=M[0]<M[1]?M[0]<M[2]?0:2:M[1]<M[2]?1:2,v=M[f]-Y;for(Y=M[f],X[f]+=U[f],M[f]+=K[f],i=0;i<3;i++)b[i]+=v*A[i],F[i]=w(b[i],U[i]);return f}function g(f,v){return s(f-v*a)}function w(f,v){return s(f+v*a)}}(f,X,K,M,A,U);if(!F){for(z=0;z<3;z++)s[z]=b[z]>0?A[z]-a.max[z]:M[z]-a.base[z];a.translate(s)}return Y}},13635:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>u});var V=Z(13456),h=Z(12217);class J{constructor(f,v,Z,J,l,e,C){this.cH=new V(f.base,f.ZO),this.wV=v,this.friction=Z,this.restitution=J,this.Gl=l,this.Ua=e,this.Ql=!!C,this.vO=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Nb=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.bH=h.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=h.create(),this._impulses=h.create(),this._sleepFrameCount=10}loadFromCopy(f){h.k(this.cH.base,f.cH.base),h.k(this.cH.ZO,f.cH.ZO),h.k(this.cH.max,f.cH.max),this.cH.mag=f.cH.mag,this.wV=f.wV,this.friction=f.friction,this.restitution=f.restitution,this.Gl=f.Gl,this.Ua=f.Ua,this.Ql=f.Ql,this.vO=f.vO,this.fluidDrag=f.fluidDrag,this.Nb=f.Nb,this.preventFallOffEdge=f.preventFallOffEdge,this.rolledBackLastTick=f.rolledBackLastTick,h.k(this.bH,f.bH),h.k(this.resting,f.resting),this.inFluid=f.inFluid,this._ratioInFluid=f._ratioInFluid,h.k(this._forces,f._forces),h.k(this._impulses,f._impulses),this._sleepFrameCount=f._sleepFrameCount}setPosition(f){l(f),h.Fv(f,f,this.cH.base),this.cH.translate(f),this.UH()}Zh(){return h.clone(this.cH.base)}applyForce(f){l(f),h.add(this._forces,this._forces,f),this.UH()}applyImpulse(f){l(f),h.add(this._impulses,this._impulses,f),this.UH()}UH(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var l=f=>{};var e=Z(13456),C=Z(12217),H=Z(13459);function O(){this.vO=.1,this.fluidDrag=.4,this.Sl=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function u(f,v,Z){f=Object.assign(new O,f),this.gravity=f.gravity||[0,-10,0],this.vO=f.vO||.1,this.Sl=f.Sl||2,this.fluidDrag=f.fluidDrag||.4,this.minBounceImpulse=f.minBounceImpulse,this.bodies=[],this.cW=f.cW,this.testSolid=v,this.testFluid=Z}u.prototype.Na=function(f,v,Z,V,h,l){f=f||new e([0,0,0],[1,1,1]),"undefined"==typeof v&&(v=1),"undefined"==typeof Z&&(Z=1),"undefined"==typeof V&&(V=0),"undefined"==typeof h&&(h=1);var C=new J(f,v,Z,V,h,l);return this.bodies.push(C),C},u.prototype.ia=function(f){var v=this.bodies.indexOf(f);v<0||(this.bodies.splice(v,1),f.cH=f.Ua=null)};var W=C.create(),a=C.create(),b=C.create(),X=C.create(),F=C.create(),U=C.create(),K=C.create(),M=new e([0,0,0],[1,1,1]),A=new J(M,1,1,0,1,(()=>{}),!1);function s(f,v,Z){return v=Z,v*=1-(1-f.ratioInFluid)**2}u.prototype.Ue=function(f){f/=1e3;var v=q(0,C.squaredLength(this.gravity));this.bodies.forEach((Z=>function(f,v,Z,V){C.k(F,v.resting),f.cW&&A.loadFromCopy(v);if(v.wV<=0)return C.set(v.bH,0,0,0),C.set(v._forces,0,0,0),void C.set(v._impulses,0,0,0);var h=V||0===v.Gl;if(function(f,v,Z,V){if(v._sleepFrameCount>0)return!1;if(V)return!0;var h=!1,J=.5*Z*Z*v.Gl;return C.scale(j,f.gravity,J),H(f.testSolid,v.cH,j,(function(){return h=!0,!0}),!0),h}(f,v,Z,h))return;v._sleepFrameCount--,function(f,v){var Z=v.cH,V=Math.floor(Z.base[0]),h=Math.floor(Z.base[2]),J=Math.floor(Z.base[1]),l=Math.floor(Z.max[1]);if(!f.testFluid(V,J,h))return v.inFluid=!1,void(v.ratioInFluid=0);var e=1,H=J+1;for(;H<=l&&f.testFluid(V,H,h);)e++,H++;var O=(J+e-Z.base[1])/Z.ZO[1];O>1&&(O=1);var u=Z.ZO[0]*Z.ZO[1]*Z.ZO[2]*O,W=Y;C.scale(W,f.gravity,-f.Sl*u*v.Gl),v.applyForce(W),v.inFluid=!0,v.ratioInFluid=O}(f,v),m(v._forces),m(v._impulses),m(v.bH),m(v.resting),C.scale(W,v._forces,1/v.wV),C.ee(W,W,f.gravity,v.Gl),C.scale(a,v._impulses,1/v.wV),C.ee(a,a,W,Z),C.add(v.bH,v.bH,a),v.friction&&(y(f,0,v,a,Z),y(f,1,v,a,Z),y(f,2,v,a,Z));var J=v.fluidDrag>=0?v.fluidDrag:f.fluidDrag,l=v.vO>=0?v.vO:f.vO,e=l,O=l;v.inFluid&&(e=s(v,e,v.fluidDragHoriz>=0?v.fluidDragHoriz:J),O=s(v,O,v.fluidDragVert>=0?v.fluidDragVert:J));e=Math.max(1-e*Z/v.wV,0),O=Math.max(1-O*Z/v.wV,0),C.set(z,e,O,e),C.multiply(v.bH,v.bH,z),C.scale(b,v.bH,Z),C.set(v._forces,0,0,0),C.set(v._impulses,0,0,0),v.Ql&&c(I,v.cH);C.k(U,b),C.set(K,0,0,0),v.preventFallOffEdge&&function(f,v,Z,V){if(!v.resting[1]||Z[1]>0)return;var h=t;c(h,v.cH);for(var J=0;J<3;J+=2){C.set(w,0,0,0),w[J]=Z[J];var l=!0;(l=(l=(l=(l=l&&!E(f,h.base[0]+w[0]+1e-5,h.base[1],h.base[2]+w[2]+1e-5))&&!E(f,h.max[0]+w[0]-1e-5,h.base[1],h.base[2]+w[2]+1e-5))&&!E(f,h.base[0]+w[0]+1e-5,h.base[1],h.max[2]+w[2]-1e-5))&&!E(f,h.max[0]+w[0]-1e-5,h.base[1],h.max[2]+w[2]-1e-5))?(V[J]=Z[J]>0?1:-1,Z[J]=0):0===J&&(C.set(L,Z[0],0,0),i(f,h,L,V,v.slideOnCollision))}}(f,v,b,K);i(f,v.cH,b,v.resting,v.slideOnCollision),v.Ql&&function(f,v,Z,V){if(v.resting[1]>=0&&!v.inFluid)return;var h=0!==v.resting[0],J=0!==v.resting[2];if(!h&&!J)return;var l=Math.abs(V[0]/V[2]),e=4;if(!h&&l>e)return;if(!J&&l<1/e)return;C.add(B,Z.base,V);var O=f.testSolid;H(O,Z,V,(function(f,v,Z,V){if(1!==v)return!0;V[v]=0}));var u=Z.base[1],W=v.inFluid?1.951:1.001,a=Math.floor(u+W)-u;C.set(P,0,a,0);var b=!1;if(H(O,Z,P,(function(f,v,Z,V){return b=!0,!0})),b)return;C.Fv(g,B,Z.base),g[1]=0,i(f,Z,g,T,!0);var X=q(Z.base[0],B[0]),F=q(Z.base[2],B[2]);if(h&&!X&&(!F||!J))return;if(J&&(!X||!h)&&!F)return;var U=!0;if(U=U&&!E(f,Z.base[0]+1e-5,Z.base[1],Z.base[2]+1e-5),U=U&&!E(f,Z.max[0]-1e-5,Z.base[1],Z.base[2]+1e-5),U=U&&!E(f,Z.base[0]+1e-5,Z.base[1],Z.max[2]-1e-5),U=U&&!E(f,Z.max[0]-1e-5,Z.base[1],Z.max[2]-1e-5),U)return;c(v.cH,Z),v.resting[0]=T[0],v.resting[2]=T[2],v.Nb&&v.Nb()}(f,v,I,U);for(var u=0;u<3;++u)v.resting[u]=v.resting[u]||K[u],X[u]=0,v.resting[u]&&(F[u]||(X[u]=-v.bH[u]),v.bH[u]=0);var M=C.length(X);M>.001&&(C.scale(X,X,v.wV),v.Ua&&v.Ua(X),v.restitution>0&&M>f.minBounceImpulse&&(C.scale(X,X,v.restitution),v.applyImpulse(X)));var N=C.squaredLength(v.bH);N>1e-5&&v.UH();f.cW&&f.cW(v)?(v.loadFromCopy(A),v.rolledBackLastTick=!0):v.rolledBackLastTick=!1}(this,Z,f,v)))};var z=C.create([0,0,0]);var Y=C.create();function y(f,v,Z,V,h){var J=Z.resting[v],l=V[v];if(!Z.alwaysApplyHorizFriction||1!==v){if(0===J)return;if(J*l<=0)return}C.k(N,Z.bH),N[v]=0;var e=C.length(N);if(!q(e,0)){var H=Math.abs(Z.friction*f.gravity[v]*h),O=e>H?(e-H)/e:0;Z.bH[(v+1)%3]*=O,Z.bH[(v+2)%3]*=O}}var N=C.create();function i(f,v,Z,V,h){return C.set(V,0,0,0),H(f.testSolid,v,Z,(function(f,v,Z,J){V[v]=Z,J[v]=0,h||(J[0]=0,J[1]=0,J[2]=0)}))}var I=new e([],[]),T=C.create(),B=C.create(),P=C.create(),g=C.create();var w=C.create(),t=new e([],[]),L=C.create();function E(f,v,Z,V){return f.testSolid(Math.floor(v),Math.floor(Z-1),Math.floor(V))}var j=C.create();function q(f,v){return Math.abs(f-v)<1e-5}function c(f,v){for(var Z=0;Z<3;Z++)f.base[Z]=v.base[Z],f.max[Z]=v.max[Z],f.ZO[Z]=v.ZO[Z]}var m=function(f){}},12078:function(f,v){!function(f){"use strict";var v=function(f,Z){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var Z in v)Object.prototype.hasOwnProperty.call(v,Z)&&(f[Z]=v[Z])},v(f,Z)};function Z(f,Z){if("function"!==typeof Z&&null!==Z)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");function V(){this.constructor=f}v(f,Z),f.prototype=null===Z?Object.create(Z):(V.prototype=Z.prototype,new V)}function V(f,v,Z,V){var h,J=arguments.length,l=J<3?v:null===V?V=Object.getOwnPropertyDescriptor(v,Z):V;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)l=Reflect.decorate(f,v,Z,V);else for(var e=f.length-1;e>=0;e--)(h=f[e])&&(l=(J<3?h(l):J>3?h(v,Z,l):h(v,Z))||l);return J>3&&l&&Object.defineProperty(v,Z,l),l}function h(f,v,Z){if(Z||2===arguments.length)for(var V,h=0,J=v.length;h<J;h++)!V&&h in v||(V||(V=Array.prototype.slice.call(v,0,h)),V[h]=v[h]);return f.concat(V||Array.prototype.slice.call(v))}var J,l=255,e=213;f.OPERATION=void 0,(J=f.OPERATION||(f.OPERATION={}))[J.ADD=128]="ADD",J[J.REPLACE=0]="REPLACE",J[J.DELETE=64]="DELETE",J[J.DELETE_AND_ADD=192]="DELETE_AND_ADD",J[J.TOUCH=1]="TOUCH",J[J.CLEAR=10]="CLEAR";var C=function(){function v(f,v,Z){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=f,this.setParent(v,Z)}return v.prototype.setParent=function(f,v,Z){var V=this;if(this.indexes||(this.indexes=this.ref instanceof wf?this.ref._definition.indexes:{}),this.parent=f,this.parentIndex=Z,v)if(this.root=v,this.ref instanceof wf){var h=this.ref._definition;for(var J in h.schema){var l=this.ref[J];if(l&&l.$changes){var e=h.indexes[J];l.$changes.setParent(this.ref,v,e)}}}else"object"===typeof this.ref&&this.ref.forEach((function(f,v){if(f instanceof wf){var Z=f.$changes,h=V.ref.$changes.indexes[v];Z.setParent(V.ref,V.root,h)}}))},v.prototype.operation=function(f){this.changes.set(--this.currentCustomOperation,f)},v.prototype.change=function(v,Z){void 0===Z&&(Z=f.OPERATION.ADD);var V="number"===typeof v?v:this.indexes[v];this.assertValidIndex(V,v);var h=this.changes.get(V);h&&h.op!==f.OPERATION.DELETE&&h.op!==f.OPERATION.TOUCH||this.changes.set(V,{op:h&&h.op===f.OPERATION.DELETE?f.OPERATION.DELETE_AND_ADD:Z,index:V}),this.allChanges.add(V),this.changed=!0,this.touchParents()},v.prototype.touch=function(v){var Z="number"===typeof v?v:this.indexes[v];this.assertValidIndex(Z,v),this.changes.has(Z)||this.changes.set(Z,{op:f.OPERATION.TOUCH,index:Z}),this.allChanges.add(Z),this.touchParents()},v.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},v.prototype.getType=function(f){if(this.ref._definition)return(v=this.ref._definition).schema[v.fieldsByIndex[f]];var v,Z=(v=this.parent._definition).schema[v.fieldsByIndex[this.parentIndex]];return Object.values(Z)[0]},v.prototype.getChildrenFilter=function(){var f=this.parent._definition.childFilters;return f&&f[this.parentIndex]},v.prototype.getValue=function(f){return this.ref.getByIndex(f)},v.prototype.delete=function(v){var Z="number"===typeof v?v:this.indexes[v];if(void 0!==Z){var V=this.getValue(Z);this.changes.set(Z,{op:f.OPERATION.DELETE,index:Z}),this.allChanges.delete(Z),delete this.caches[Z],V&&V.$changes&&(V.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(v," (").concat(Z,")"))},v.prototype.discard=function(v,Z){var V=this;void 0===v&&(v=!1),void 0===Z&&(Z=!1),this.ref instanceof wf||this.changes.forEach((function(v){if(v.op===f.OPERATION.DELETE){var Z=V.ref.getIndex(v.index);delete V.indexes[Z]}})),this.changes.clear(),this.changed=v,Z&&this.allChanges.clear(),this.currentCustomOperation=0},v.prototype.discardAll=function(){var f=this;this.changes.forEach((function(v){var Z=f.getValue(v.index);Z&&Z.$changes&&Z.$changes.discardAll()})),this.discard()},v.prototype.cache=function(f,v){this.caches[f]=v},v.prototype.clone=function(){return new v(this.ref,this.parent,this.root)},v.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},v.prototype.assertValidIndex=function(f,v){if(void 0===f)throw new Error('ChangeTree: missing index for field "'.concat(v,'"'))},v}();function H(f,v,Z,V){return f[v]||(f[v]=[]),f[v].push(Z),null===V||void 0===V||V.forEach((function(f,v){return Z(f,v)})),function(){return u(f[v],f[v].indexOf(Z))}}function O(v){var Z=this,V="string"!==typeof this.$changes.getType();this.$items.forEach((function(h,J){v.push({refId:Z.$changes.refId,op:f.OPERATION.DELETE,field:J,value:void 0,previousValue:h}),V&&Z.$changes.root.removeRef(h.$changes.refId)}))}function u(f,v){if(-1===v||v>=f.length)return!1;for(var Z=f.length-1,V=v;V<Z;V++)f[V]=f[V+1];return f.length=Z,!0}var W=function(f,v){var Z=f.toString(),V=v.toString();return Z<V?-1:Z>V?1:0};function a(f){return f.$proxy=!0,f=new Proxy(f,{get:function(f,v){return"symbol"===typeof v||isNaN(v)?f[v]:f.at(v)},set:function(f,v,Z){if("symbol"===typeof v||isNaN(v))f[v]=Z;else{var V=Array.from(f.$items.keys()),h=parseInt(V[v]||v);void 0===Z||null===Z?f.deleteAt(h):f.setAt(h,Z)}return!0},deleteProperty:function(f,v){return"number"===typeof v?f.deleteAt(v):delete f[v],!0}})}var b=function(){function v(){for(var f=[],v=0;v<arguments.length;v++)f[v]=arguments[v];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,f)}return v.prototype.we=function(v,Z){return void 0===Z&&(Z=!0),H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,v,Z?this.$items:void 0)},v.prototype.tv=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,v)},v.is=function(f){return Array.isArray(f)||void 0!==f.array},Object.defineProperty(v.prototype,"length",{get:function(){return this.$items.size},set:function(f){0===f?this.clear():this.splice(f,this.length-f)},enumerable:!1,configurable:!0}),v.prototype.push=function(){for(var f,v=this,Z=[],V=0;V<arguments.length;V++)Z[V]=arguments[V];return Z.forEach((function(Z){f=v.$refId++,v.setAt(f,Z)})),f},v.prototype.pop=function(){var f=Array.from(this.$indexes.values()).pop();if(void 0!==f){this.$changes.delete(f),this.$indexes.delete(f);var v=this.$items.get(f);return this.$items.delete(f),v}},v.prototype.at=function(f){var v=Array.from(this.$items.keys())[f];return this.$items.get(v)},v.prototype.setAt=function(v,Z){var V,h;if(void 0!==Z&&null!==Z){if(this.$items.get(v)!==Z){void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,v);var J=null!==(h=null===(V=this.$changes.indexes[v])||void 0===V?void 0:V.op)&&void 0!==h?h:f.OPERATION.ADD;this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,Z),this.$changes.change(v,J)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},v.prototype.deleteAt=function(f){var v=Array.from(this.$items.keys())[f];return void 0!==v&&this.$deleteAt(v)},v.prototype.$deleteAt=function(f){return this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&O.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.concat=function(){for(var f,Z=[],V=0;V<arguments.length;V++)Z[V]=arguments[V];return new(v.bind.apply(v,h([void 0],(f=Array.from(this.$items.values())).concat.apply(f,Z),!1)))},v.prototype.join=function(f){return Array.from(this.$items.values()).join(f)},v.prototype.reverse=function(){var f=this,v=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Z,V){f.setAt(v[V],Z)})),this},v.prototype.shift=function(){var f=Array.from(this.$items.keys()).shift();if(void 0!==f){var v=this.$items.get(f);return this.$deleteAt(f),v}},v.prototype.slice=function(f,Z){var V=new v;return V.push.apply(V,Array.from(this.$items.values()).slice(f,Z)),V},v.prototype.sort=function(f){var v=this;void 0===f&&(f=W);var Z=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(f).forEach((function(f,V){v.setAt(Z[V],f)})),this},v.prototype.splice=function(f,v){void 0===v&&(v=this.length-f);for(var Z=Array.from(this.$items.keys()),V=[],h=f;h<f+v;h++)V.push(this.$items.get(Z[h])),this.$deleteAt(Z[h]);return V},v.prototype.unshift=function(){for(var f=this,v=[],Z=0;Z<arguments.length;Z++)v[Z]=arguments[Z];var V=this.length,h=v.length,J=Array.from(this.$items.values());return v.forEach((function(v,Z){f.setAt(Z,v)})),J.forEach((function(v,Z){f.setAt(h+Z,v)})),V+h},v.prototype.indexOf=function(f,v){return Array.from(this.$items.values()).indexOf(f,v)},v.prototype.lastIndexOf=function(f,v){return void 0===v&&(v=this.length-1),Array.from(this.$items.values()).lastIndexOf(f,v)},v.prototype.every=function(f,v){return Array.from(this.$items.values()).every(f,v)},v.prototype.some=function(f,v){return Array.from(this.$items.values()).some(f,v)},v.prototype.forEach=function(f,v){Array.from(this.$items.values()).forEach(f,v)},v.prototype.map=function(f,v){return Array.from(this.$items.values()).map(f,v)},v.prototype.filter=function(f,v){return Array.from(this.$items.values()).filter(f,v)},v.prototype.reduce=function(f,v){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},v.prototype.reduceRight=function(f,v){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},v.prototype.find=function(f,v){return Array.from(this.$items.values()).find(f,v)},v.prototype.findIndex=function(f,v){return Array.from(this.$items.values()).findIndex(f,v)},v.prototype.fill=function(f,v,Z){throw new Error("ArraySchema#fill() not implemented")},v.prototype.copyWithin=function(f,v,Z){throw new Error("ArraySchema#copyWithin() not implemented")},v.prototype.toString=function(){return this.$items.toString()},v.prototype.toLocaleString=function(){return this.$items.toLocaleString()},v.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},v.prototype.includes=function(f,v){return Array.from(this.$items.values()).includes(f,v)},v.prototype.flatMap=function(f,v){throw new Error("ArraySchema#flatMap() is not supported.")},v.prototype.flat=function(f){throw new Error("ArraySchema#flat() is not supported.")},v.prototype.findLast=function(){var f=Array.from(this.$items.values());return f.findLast.apply(f,arguments)},v.prototype.findLastIndex=function(){var f=Array.from(this.$items.values());return f.findLastIndex.apply(f,arguments)},v.prototype.setIndex=function(f,v){this.$indexes.set(f,v)},v.prototype.getIndex=function(f){return this.$indexes.get(f)},v.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},v.prototype.deleteByIndex=function(f){var v=this.$indexes.get(f);this.$items.delete(v),this.$indexes.delete(f)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){return this.toArray().map((function(f){return"function"===typeof f.toJSON?f.toJSON():f}))},v.prototype.clone=function(f){return f?new(v.bind.apply(v,h([void 0],Array.from(this.$items.values()),!1))):new(v.bind.apply(v,h([void 0],this.map((function(f){return f.$changes?f.clone():f})),!1)))},v}();function X(f){return f.$proxy=!0,f=new Proxy(f,{get:function(f,v){return"symbol"!==typeof v&&"undefined"===typeof f[v]?f.get(v):f[v]},set:function(f,v,Z){return"symbol"!==typeof v&&-1===v.indexOf("$")&&"we"!==v&&"tv"!==v&&"onChange"!==v?f.set(v,Z):f[v]=Z,!0},deleteProperty:function(f,v){return f.delete(v),!0}})}var F=function(){function v(f){var Z=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f)if(f instanceof Map||f instanceof v)f.forEach((function(f,v){return Z.set(v,f)}));else for(var V in f)this.set(V,f[V])}return v.prototype.we=function(v,Z){return void 0===Z&&(Z=!0),H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,v,Z?this.$items:void 0)},v.prototype.tv=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,v)},v.is=function(f){return void 0!==f.map},v.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(v.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.set=function(v,Z){if(void 0===Z||null===Z)throw new Error("MapSchema#set('".concat(v,"', ").concat(Z,"): trying to set ").concat(Z," value on '").concat(v,"'."));v=v.toString();var V="undefined"!==typeof this.$changes.indexes[v],h=V?this.$changes.indexes[v]:this.$refId++,J=V?f.OPERATION.REPLACE:f.OPERATION.ADD,l=void 0!==Z.$changes;if(l&&Z.$changes.setParent(this,this.$changes.root,h),V){if(!l&&this.$items.get(v)===Z)return;l&&this.$items.get(v)!==Z&&(J=f.OPERATION.ADD)}else this.$changes.indexes[v]=h,this.$indexes.set(h,v);return this.$items.set(v,Z),this.$changes.change(v,J),this},v.prototype.get=function(f){return this.$items.get(f)},v.prototype.delete=function(f){return this.$changes.delete(f),this.$items.delete(f)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&O.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(f){return this.$items.has(f)},v.prototype.forEach=function(f){this.$items.forEach(f)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(f,v){this.$indexes.set(f,v)},v.prototype.getIndex=function(f){return this.$indexes.get(f)},v.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},v.prototype.deleteByIndex=function(f){var v=this.$indexes.get(f);this.$items.delete(v),this.$indexes.delete(f)},v.prototype.toJSON=function(){var f={};return this.forEach((function(v,Z){f[Z]="function"===typeof v.toJSON?v.toJSON():v})),f},v.prototype.clone=function(f){var Z;return f?Z=Object.assign(new v,this):(Z=new v,this.forEach((function(f,v){f.$changes?Z.set(v,f.clone()):Z.set(v,f)}))),Z},v}(),U={};function K(f,v){U[f]=v}function M(f){return U[f]}var A=function(){function f(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return f.create=function(v){var Z=new f;return Z.schema=Object.assign({},v&&v.schema||{}),Z.indexes=Object.assign({},v&&v.indexes||{}),Z.fieldsByIndex=Object.assign({},v&&v.fieldsByIndex||{}),Z.descriptors=Object.assign({},v&&v.descriptors||{}),Z.deprecated=Object.assign({},v&&v.deprecated||{}),Z},f.prototype.addField=function(f,v){var Z=this.getNextFieldIndex();this.fieldsByIndex[Z]=f,this.indexes[f]=Z,this.schema[f]=Array.isArray(v)?{array:v[0]}:v},f.prototype.hasField=function(f){return void 0!==this.indexes[f]},f.prototype.addFilter=function(f,v){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[f]]=v,this.indexesWithFilters.push(this.indexes[f]),!0},f.prototype.addChildrenFilter=function(f,v){var Z=this.indexes[f],V=this.schema[f];if(M(Object.keys(V)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Z]=v,!0;console.warn("@filterChildren: field '".concat(f,"' can't have children. Ignoring filter."))},f.prototype.getChildrenFilter=function(f){return this.childFilters&&this.childFilters[this.indexes[f]]},f.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},f}();function s(f){return f._context&&f._context.useFilters}var z=function(){function f(){this.types={},this.schemas=new Map,this.useFilters=!1}return f.prototype.has=function(f){return this.schemas.has(f)},f.prototype.get=function(f){return this.types[f]},f.prototype.add=function(f,v){void 0===v&&(v=this.schemas.size),f._definition=A.create(f._definition),f._typeid=v,this.types[v]=f,this.schemas.set(f,v)},f.create=function(v){return void 0===v&&(v={}),function(Z){return v.context||(v.context=new f),y(Z,v)}},f}(),Y=new z;function y(f,v){return void 0===v&&(v={}),function(Z,V){var J=v.context||Y,l=Z.constructor;if(l._context=J,!f)throw new Error("".concat(l.name,': @type() reference provided for "').concat(V,"\" is undefined. Make sure you don't have any circular dependencies."));J.has(l)||J.add(l);var e=l._definition;if(e.addField(V,f),e.descriptors[V]){if(e.deprecated[V])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(V,"' definition on '").concat(l.name,"'.\nCheck @type() annotation"))}catch(U){var C=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(C))}}var H=b.is(f),O=!H&&F.is(f);if("string"!==typeof f&&!wf.is(f)){var u=Object.values(f)[0];"string"===typeof u||J.has(u)||J.add(u)}if(v.manual)e.descriptors[V]={enumerable:!0,configurable:!0,writable:!0};else{var W="_".concat(V);e.descriptors[W]={enumerable:!1,configurable:!1,writable:!0},e.descriptors[V]={get:function(){return this[W]},set:function(f){f!==this[W]&&(void 0!==f&&null!==f?(!H||f instanceof b||(f=new(b.bind.apply(b,h([void 0],f,!1)))),!O||f instanceof F||(f=new F(f)),void 0===f.$proxy&&(O?f=X(f):H&&(f=a(f))),this.$changes.change(V),f.$changes&&f.$changes.setParent(this,this.$changes.root,this._definition.indexes[V])):this[W]&&this.$changes.delete(V),this[W]=f)},enumerable:!0,configurable:!0}}}}function N(f){return function(v,Z){var V=v.constructor;V._definition.addFilter(Z,f)&&(V._context.useFilters=!0)}}function i(f){return function(v,Z){var V=v.constructor;V._definition.addChildrenFilter(Z,f)&&(V._context.useFilters=!0)}}function I(f){return void 0===f&&(f=!0),function(v,Z){var V=v.constructor._definition;V.deprecated[Z]=!0,f&&(V.descriptors[Z]={get:function(){throw new Error("".concat(Z," is deprecated."))},set:function(f){},enumerable:!1,configurable:!0})}}function T(f,v,Z){for(var V in void 0===Z&&(Z={}),Z.context||(Z.context=f._context||Z.context||Y),v)y(v[V],Z)(f.prototype,V);return f}function B(f){for(var v=0,Z=0,V=0,h=f.length;V<h;V++)(v=f.charCodeAt(V))<128?Z+=1:v<2048?Z+=2:v<55296||v>=57344?Z+=3:(V++,Z+=4);return Z}function P(f,v,Z){for(var V=0,h=0,J=Z.length;h<J;h++)(V=Z.charCodeAt(h))<128?f[v++]=V:V<2048?(f[v++]=192|V>>6,f[v++]=128|63&V):V<55296||V>=57344?(f[v++]=224|V>>12,f[v++]=128|V>>6&63,f[v++]=128|63&V):(h++,V=65536+((1023&V)<<10|1023&Z.charCodeAt(h)),f[v++]=240|V>>18,f[v++]=128|V>>12&63,f[v++]=128|V>>6&63,f[v++]=128|63&V)}function g(f,v){f.push(255&v)}function w(f,v){f.push(255&v)}function t(f,v){f.push(255&v),f.push(v>>8&255)}function L(f,v){f.push(255&v),f.push(v>>8&255)}function E(f,v){f.push(255&v),f.push(v>>8&255),f.push(v>>16&255),f.push(v>>24&255)}function j(f,v){var Z=v>>24,V=v>>16,h=v>>8,J=v;f.push(255&J),f.push(255&h),f.push(255&V),f.push(255&Z)}function q(f,v){var Z=Math.floor(v/Math.pow(2,32));j(f,v>>>0),j(f,Z)}function c(f,v){var Z=v/Math.pow(2,32)|0;j(f,v>>>0),j(f,Z)}function m(f,v){G(f,v)}function p(f,v){Q(f,v)}var k=new Int32Array(2),r=new Float32Array(k.buffer),o=new Float64Array(k.buffer);function G(f,v){r[0]=v,E(f,k[0])}function Q(f,v){o[0]=v,E(f,k[0]),E(f,k[1])}function d(f,v){return w(f,v?1:0)}function x(f,v){v||(v="");var Z=B(v),V=0;if(Z<32)f.push(160|Z),V=1;else if(Z<256)f.push(217),w(f,Z),V=2;else if(Z<65536)f.push(218),L(f,Z),V=3;else{if(!(Z<4294967296))throw new Error("String too long");f.push(219),j(f,Z),V=5}return P(f,f.length,v),V+Z}function R(f,v){return isNaN(v)?R(f,0):isFinite(v)?v!==(0|v)?(f.push(203),Q(f,v),9):v>=0?v<128?(w(f,v),1):v<256?(f.push(204),w(f,v),2):v<65536?(f.push(205),L(f,v),3):v<4294967296?(f.push(206),j(f,v),5):(f.push(207),c(f,v),9):v>=-32?(f.push(224|v+32),1):v>=-128?(f.push(208),g(f,v),2):v>=-32768?(f.push(209),t(f,v),3):v>=-2147483648?(f.push(210),E(f,v),5):(f.push(211),q(f,v),9):R(f,v>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var n=Object.freeze({__proto__:null,utf8Write:P,int8:g,uint8:w,int16:t,uint16:L,int32:E,uint32:j,int64:q,uint64:c,float32:m,float64:p,writeFloat32:G,writeFloat64:Q,boolean:d,string:x,number:R});function S(f,v,Z){for(var V="",h=0,J=v,l=v+Z;J<l;J++){var e=f[J];0!==(128&e)?192!==(224&e)?224!==(240&e)?240!==(248&e)?console.error("Invalid byte "+e.toString(16)):(h=(7&e)<<18|(63&f[++J])<<12|(63&f[++J])<<6|63&f[++J])>=65536?(h-=65536,V+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):V+=String.fromCharCode(h):V+=String.fromCharCode((15&e)<<12|(63&f[++J])<<6|63&f[++J]):V+=String.fromCharCode((31&e)<<6|63&f[++J]):V+=String.fromCharCode(e)}return V}function D(f,v){return ff(f,v)<<24>>24}function ff(f,v){return f[v.offset++]}function vf(f,v){return Zf(f,v)<<16>>16}function Zf(f,v){return f[v.offset++]|f[v.offset++]<<8}function Vf(f,v){return f[v.offset++]|f[v.offset++]<<8|f[v.offset++]<<16|f[v.offset++]<<24}function hf(f,v){return Vf(f,v)>>>0}function Jf(f,v){return Wf(f,v)}function lf(f,v){return af(f,v)}function ef(f,v){var Z=hf(f,v);return Vf(f,v)*Math.pow(2,32)+Z}function Cf(f,v){var Z=hf(f,v);return hf(f,v)*Math.pow(2,32)+Z}var Hf=new Int32Array(2),Of=new Float32Array(Hf.buffer),uf=new Float64Array(Hf.buffer);function Wf(f,v){return Hf[0]=Vf(f,v),Of[0]}function af(f,v){return Hf[0]=Vf(f,v),Hf[1]=Vf(f,v),uf[0]}function bf(f,v){return ff(f,v)>0}function Xf(f,v){var Z,V=f[v.offset++];V<192?Z=31&V:217===V?Z=ff(f,v):218===V?Z=Zf(f,v):219===V&&(Z=hf(f,v));var h=S(f,v.offset,Z);return v.offset+=Z,h}function Ff(f,v){var Z=f[v.offset];return Z<192&&Z>160||217===Z||218===Z||219===Z}function Uf(f,v){var Z=f[v.offset++];return Z<128?Z:202===Z?Wf(f,v):203===Z?af(f,v):204===Z?ff(f,v):205===Z?Zf(f,v):206===Z?hf(f,v):207===Z?Cf(f,v):208===Z?D(f,v):209===Z?vf(f,v):210===Z?Vf(f,v):211===Z?ef(f,v):Z>223?-1*(255-Z+1):void 0}function Kf(f,v){var Z=f[v.offset];return Z<128||Z>=202&&Z<=211}function Mf(f,v){return f[v.offset]<160}function Af(f,v){return f[v.offset-1]===l&&(f[v.offset]<128||f[v.offset]>=202&&f[v.offset]<=211)}var sf=Object.freeze({__proto__:null,int8:D,uint8:ff,int16:vf,uint16:Zf,int32:Vf,uint32:hf,float32:Jf,float64:lf,int64:ef,uint64:Cf,readFloat32:Wf,readFloat64:af,boolean:bf,string:Xf,stringCheck:Ff,number:Uf,numberCheck:Kf,arrayCheck:Mf,switchStructureCheck:Af}),zf=function(){function v(f){var v=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f&&f.forEach((function(f){return v.add(f)}))}return v.prototype.we=function(v,Z){return void 0===Z&&(Z=!0),H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,v,Z?this.$items:void 0)},v.prototype.tv=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,v)},v.is=function(f){return void 0!==f.collection},v.prototype.add=function(f){var v=this.$refId++;return void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,v),this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,f),this.$changes.change(v),v},v.prototype.at=function(f){var v=Array.from(this.$items.keys())[f];return this.$items.get(v)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(f){for(var v,Z,V=this.$items.entries();(Z=V.next())&&!Z.done;)if(f===Z.value[1]){v=Z.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&O.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(f){return Array.from(this.$items.values()).some((function(v){return v===f}))},v.prototype.forEach=function(f){var v=this;this.$items.forEach((function(Z,V,h){return f(Z,V,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(f,v){this.$indexes.set(f,v)},v.prototype.getIndex=function(f){return this.$indexes.get(f)},v.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},v.prototype.deleteByIndex=function(f){var v=this.$indexes.get(f);this.$items.delete(v),this.$indexes.delete(f)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var f=[];return this.forEach((function(v,Z){f.push("function"===typeof v.toJSON?v.toJSON():v)})),f},v.prototype.clone=function(f){var Z;return f?Z=Object.assign(new v,this):(Z=new v,this.forEach((function(f){f.$changes?Z.add(f.clone()):Z.add(f)}))),Z},v}(),Yf=function(){function v(f){var v=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f&&f.forEach((function(f){return v.add(f)}))}return v.prototype.we=function(v,Z){return void 0===Z&&(Z=!0),H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,v,Z?this.$items:void 0)},v.prototype.tv=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,v)},v.is=function(f){return void 0!==f.set},v.prototype.add=function(v){var Z,V;if(this.has(v))return!1;var h=this.$refId++;void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,h);var J=null!==(V=null===(Z=this.$changes.indexes[h])||void 0===Z?void 0:Z.op)&&void 0!==V?V:f.OPERATION.ADD;return this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,v),this.$changes.change(h,J),h},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(f){for(var v,Z,V=this.$items.entries();(Z=V.next())&&!Z.done;)if(f===Z.value[1]){v=Z.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&O.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(f){for(var v,Z=this.$items.values(),V=!1;(v=Z.next())&&!v.done;)if(f===v.value){V=!0;break}return V},v.prototype.forEach=function(f){var v=this;this.$items.forEach((function(Z,V,h){return f(Z,V,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(f,v){this.$indexes.set(f,v)},v.prototype.getIndex=function(f){return this.$indexes.get(f)},v.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},v.prototype.deleteByIndex=function(f){var v=this.$indexes.get(f);this.$items.delete(v),this.$indexes.delete(f)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var f=[];return this.forEach((function(v,Z){f.push("function"===typeof v.toJSON?v.toJSON():v)})),f},v.prototype.clone=function(f){var Z;return f?Z=Object.assign(new v,this):(Z=new v,this.forEach((function(f){f.$changes?Z.add(f.clone()):Z.add(f)}))),Z},v}(),yf=function(){function f(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return f.prototype.addRefId=function(f){this.refIds.has(f)||(this.refIds.add(f),this.containerIndexes.set(f,new Set))},f.get=function(v){return void 0===v.$filterState&&(v.$filterState=new f),v.$filterState},f}(),Nf=function(){function f(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return f.prototype.getNextUniqueId=function(){return this.nextUniqueId++},f.prototype.addRef=function(f,v,Z){void 0===Z&&(Z=!0),this.refs.set(f,v),Z&&(this.refCounts[f]=(this.refCounts[f]||0)+1)},f.prototype.removeRef=function(f){this.refCounts[f]=this.refCounts[f]-1,this.deletedRefs.add(f)},f.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},f.prototype.garbageCollectDeletedRefs=function(){var f=this;this.deletedRefs.forEach((function(v){if(!(f.refCounts[v]>0)){var Z=f.refs.get(v);if(Z instanceof wf)for(var V in Z._definition.schema)"string"!==typeof Z._definition.schema[V]&&Z[V]&&Z[V].$changes&&f.removeRef(Z[V].$changes.refId);else{var h=Z.$changes.parent._definition,J=h.schema[h.fieldsByIndex[Z.$changes.parentIndex]];"function"===typeof Object.values(J)[0]&&Array.from(Z.values()).forEach((function(v){return f.removeRef(v.$changes.refId)}))}f.refs.delete(v),delete f.refCounts[v]}})),this.deletedRefs.clear()},f}(),If=function(f){function v(){return null!==f&&f.apply(this,arguments)||this}return Z(v,f),v}(Error);function Tf(f,v,Z,V){var h,J=!1;switch(v){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":h="number",isNaN(f)&&console.log('trying to encode "NaN" in '.concat(Z.constructor.name,"#").concat(V));break;case"string":h="string",J=!0;break;case"boolean":return}if(typeof f!==h&&(!J||J&&null!==f)){var l="'".concat(JSON.stringify(f),"'").concat(f&&f.constructor&&" (".concat(f.constructor.name,")")||"");throw new If("a '".concat(h,"' was expected, but ").concat(l," was provided in ").concat(Z.constructor.name,"#").concat(V))}}function Bf(f,v,Z,V){if(!(f instanceof v))throw new If("a '".concat(v.name,"' was expected, but '").concat(f.constructor.name,"' was provided in ").concat(Z.constructor.name,"#").concat(V))}function Pf(f,v,Z,V,h){Tf(Z,f,V,h);var J=n[f];if(!J)throw new If("a '".concat(f,"' was expected, but ").concat(Z," was provided in ").concat(V.constructor.name,"#").concat(h));J(v,Z)}function gf(f,v,Z){return sf[f](v,Z)}var wf=function(){function v(){for(var f=[],v=0;v<arguments.length;v++)f[v]=arguments[v];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new Nf),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Z=this._definition.descriptors;Z&&Object.defineProperties(this,Z),f[0]&&this.assign(f[0])}return v.onError=function(f){console.error(f)},v.is=function(f){return f._definition&&void 0!==f._definition.schema},v.prototype.onChange=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,v)},v.prototype.tv=function(v){return H(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,v)},v.prototype.assign=function(f){return Object.assign(this,f),this},Object.defineProperty(v.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),v.prototype.setDirty=function(f,v){this.$changes.change(f,v)},v.prototype.listen=function(f,v,Z){var V=this;return void 0===Z&&(Z=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[f]||(this.$callbacks[f]=[]),this.$callbacks[f].push(v),Z&&void 0!==this[f]&&v(this[f],void 0),function(){return u(V.$callbacks[f],V.$callbacks[f].indexOf(v))}},v.prototype.decode=function(Z,V,h){var J;void 0===V&&(V={offset:0}),void 0===h&&(h=this);var e=[],C=this.$changes.root,H=Z.length,O=0;for(C.refs.set(O,this);V.offset<H;){var u=Z[V.offset++];if(u!=l){var W=h.$changes,a=void 0!==h._definition,X=a?u>>6<<6:u;if(X!==f.OPERATION.CLEAR){var U=a?u%(X||255):Uf(Z,V),K=a?h._definition.fieldsByIndex[U]:"",A=W.getType(U),s=void 0,z=void 0,Y=void 0;if(a?z=h["_".concat(K)]:(z=h.getByIndex(U),(X&f.OPERATION.ADD)===f.OPERATION.ADD?(Y=h instanceof F?Xf(Z,V):U,h.setIndex(U,Y)):Y=h.getIndex(U)),(X&f.OPERATION.DELETE)===f.OPERATION.DELETE&&(X!==f.OPERATION.DELETE_AND_ADD&&h.deleteByIndex(U),z&&z.$changes&&C.removeRef(z.$changes.refId),s=null),void 0!==K){if(X===f.OPERATION.DELETE);else if(v.is(A)){var y=Uf(Z,V);if(s=C.refs.get(y),X!==f.OPERATION.REPLACE){var N=this.getSchemaType(Z,V,A);s||((s=this.createTypeInstance(N)).$changes.refId=y,z&&(s.$callbacks=z.$callbacks,z.$changes.refId&&y!==z.$changes.refId&&C.removeRef(z.$changes.refId))),C.addRef(y,s,s!==z)}}else if("string"===typeof A)s=gf(A,Z,V);else{var i=M(Object.keys(A)[0]),I=Uf(Z,V),T=C.refs.has(I)?z||C.refs.get(I):new i.constructor;if((s=T.clone(!0)).$changes.refId=I,z&&(s.$callbacks=z.$callbacks,z.$changes.refId&&I!==z.$changes.refId)){C.removeRef(z.$changes.refId);for(var B=z.entries(),P=void 0;(P=B.next())&&!P.done;){var g=(J=P.value)[0],w=J[1];e.push({refId:I,op:f.OPERATION.DELETE,field:g,value:void 0,previousValue:w})}}C.addRef(I,s,T!==z)}if(null!==s&&void 0!==s)if(s.$changes&&s.$changes.setParent(W.ref,W.root,U),h instanceof v)h[K]=s;else if(h instanceof F)g=Y,h.$items.set(g,s),h.$changes.allChanges.add(U);else if(h instanceof b)h.setAt(U,s);else if(h instanceof zf){var t=h.add(s);h.setIndex(U,t)}else h instanceof Yf&&!1!==(t=h.add(s))&&h.setIndex(U,t);z!==s&&e.push({refId:O,op:X,field:K,dynamicIndex:Y,value:s,previousValue:z})}else{console.warn("@colyseus/schema: definition mismatch");for(var L={offset:V.offset};V.offset<H&&(!Af(Z,V)||(L.offset=V.offset+1,!C.refs.has(Uf(Z,L))));)V.offset++}}else h.clear(e)}else{O=Uf(Z,V);var E=C.refs.get(O);if(!E)throw new Error('"refId" not found: '.concat(O));h=E}}return this._triggerChanges(e),C.garbageCollectDeletedRefs(),e},v.prototype.encode=function(Z,V,h){void 0===Z&&(Z=!1),void 0===V&&(V=[]),void 0===h&&(h=!1);for(var J=this.$changes,e=new WeakSet,C=[J],H=1,O=0;O<H;O++){var u=C[O],W=u.ref,a=W instanceof v;u.ensureRefId(),e.add(u),u!==J&&(u.changed||Z)&&(w(V,l),R(V,u.refId));for(var b=Z?Array.from(u.allChanges):Array.from(u.changes.values()),X=0,U=b.length;X<U;X++){var K=Z?{op:f.OPERATION.ADD,index:b[X]}:b[X],A=K.index,s=a?W._definition.fieldsByIndex&&W._definition.fieldsByIndex[A]:A,z=V.length;if(K.op!==f.OPERATION.TOUCH)if(a)w(V,A|K.op);else{if(w(V,K.op),K.op===f.OPERATION.CLEAR)continue;R(V,A)}if(a||(K.op&f.OPERATION.ADD)!=f.OPERATION.ADD||W instanceof F&&x(V,u.ref.$indexes.get(A)),K.op!==f.OPERATION.DELETE){var Y=u.getType(A),y=u.getValue(A);if(y&&y.$changes&&!e.has(y.$changes)&&(C.push(y.$changes),y.$changes.ensureRefId(),H++),K.op!==f.OPERATION.TOUCH){if(v.is(Y))Bf(y,Y,W,s),R(V,y.$changes.refId),(K.op&f.OPERATION.ADD)===f.OPERATION.ADD&&this.tryEncodeTypeId(V,Y,y.constructor);else if("string"===typeof Y)Pf(Y,V,y,W,s);else{var N=M(Object.keys(Y)[0]);Bf(W["_".concat(s)],N.constructor,W,s),R(V,y.$changes.refId)}h&&u.cache(A,V.slice(z))}}}Z||h||u.discard()}return V},v.prototype.encodeAll=function(f){return this.encode(!0,[],f)},v.prototype.applyFilters=function(Z,V){var h,J;void 0===V&&(V=!1);for(var e=this,C=new Set,H=yf.get(Z),O=[this.$changes],u=1,W=[],a=function(a){var b=O[a];if(C.has(b.refId))return"continue";var X=b.ref,U=X instanceof v;w(W,l),R(W,b.refId);var K=H.refIds.has(b),M=V||!K;H.addRefId(b);var A=H.containerIndexes.get(b),s=M?Array.from(b.allChanges):Array.from(b.changes.values());!V&&U&&X._definition.indexesWithFilters&&X._definition.indexesWithFilters.forEach((function(v){!A.has(v)&&b.allChanges.has(v)&&(M?s.push(v):s.push({op:f.OPERATION.ADD,index:v}))}));for(var z=0,Y=s.length;z<Y;z++){var y=M?{op:f.OPERATION.ADD,index:s[z]}:s[z];if(y.op!==f.OPERATION.CLEAR){var N=y.index;if(y.op!==f.OPERATION.DELETE){var i=b.getValue(N),I=b.getType(N);if(U){if((T=X._definition.filters&&X._definition.filters[N])&&!T.call(X,Z,i,e)){i&&i.$changes&&C.add(i.$changes.refId);continue}}else{var T,B=b.parent;if((T=b.getChildrenFilter())&&!T.call(B,Z,X.$indexes.get(N),i,e)){i&&i.$changes&&C.add(i.$changes.refId);continue}}if(i.$changes&&(O.push(i.$changes),u++),y.op!==f.OPERATION.TOUCH)if(y.op===f.OPERATION.ADD||U)W.push.apply(W,null!==(h=b.caches[N])&&void 0!==h?h:[]),A.add(N);else if(A.has(N))W.push.apply(W,null!==(J=b.caches[N])&&void 0!==J?J:[]);else{if(A.add(N),w(W,f.OPERATION.ADD),R(W,N),X instanceof F){var P=b.ref.$indexes.get(N);x(W,P)}i.$changes?R(W,i.$changes.refId):n[I](W,i)}else i.$changes&&!U&&(w(W,f.OPERATION.ADD),R(W,N),X instanceof F&&(P=b.ref.$indexes.get(N),x(W,P)),R(W,i.$changes.refId))}else U?w(W,y.op|N):(w(W,y.op),R(W,N))}else w(W,y.op)}},b=0;b<u;b++)a(b);return W},v.prototype.clone=function(){var f,v=new this.constructor,Z=this._definition.schema;for(var V in Z)"object"===typeof this[V]&&"function"===typeof(null===(f=this[V])||void 0===f?void 0:f.clone)?v[V]=this[V].clone():v[V]=this[V];return v},v.prototype.toJSON=function(){var f=this._definition.schema,v=this._definition.deprecated,Z={};for(var V in f)v[V]||null===this[V]||"undefined"===typeof this[V]||(Z[V]="function"===typeof this[V].toJSON?this[V].toJSON():this["_".concat(V)]);return Z},v.prototype.discardAllChanges=function(){this.$changes.discardAll()},v.prototype.getByIndex=function(f){return this[this._definition.fieldsByIndex[f]]},v.prototype.deleteByIndex=function(f){this[this._definition.fieldsByIndex[f]]=void 0},v.prototype.tryEncodeTypeId=function(f,v,Z){v._typeid!==Z._typeid&&(w(f,e),R(f,Z._typeid))},v.prototype.getSchemaType=function(f,v,Z){var V;return f[v.offset]===e&&(v.offset++,V=this.constructor._context.get(Uf(f,v))),V||Z},v.prototype.createTypeInstance=function(f){var v=new f;return v.$changes.root=this.$changes.root,v},v.prototype._triggerChanges=function(Z){for(var V,h,J,l,e,C,H,O,u,W=new Set,a=this.$changes.root.refs,b=function(b){var X=Z[b],F=X.refId,U=a.get(F),K=U.$callbacks;if((X.op&f.OPERATION.DELETE)===f.OPERATION.DELETE&&X.previousValue instanceof v&&(null===(h=null===(V=X.previousValue.$callbacks)||void 0===V?void 0:V[f.OPERATION.DELETE])||void 0===h||h.forEach((function(f){return f()}))),!K)return"continue";if(U instanceof v){if(!W.has(F))try{null===(J=null===K||void 0===K?void 0:K[f.OPERATION.REPLACE])||void 0===J||J.forEach((function(f){return f()}))}catch(M){v.onError(M)}try{K.hasOwnProperty(X.field)&&(null===(l=K[X.field])||void 0===l||l.forEach((function(f){return f(X.value,X.previousValue)})))}catch(M){v.onError(M)}}else X.op===f.OPERATION.ADD&&void 0===X.previousValue?null===(e=K[f.OPERATION.ADD])||void 0===e||e.forEach((function(f){var v;return f(X.value,null!==(v=X.dynamicIndex)&&void 0!==v?v:X.field)})):X.op===f.OPERATION.DELETE?void 0!==X.previousValue&&(null===(C=K[f.OPERATION.DELETE])||void 0===C||C.forEach((function(f){var v;return f(X.previousValue,null!==(v=X.dynamicIndex)&&void 0!==v?v:X.field)}))):X.op===f.OPERATION.DELETE_AND_ADD&&(void 0!==X.previousValue&&(null===(H=K[f.OPERATION.DELETE])||void 0===H||H.forEach((function(f){var v;return f(X.previousValue,null!==(v=X.dynamicIndex)&&void 0!==v?v:X.field)}))),null===(O=K[f.OPERATION.ADD])||void 0===O||O.forEach((function(f){var v;return f(X.value,null!==(v=X.dynamicIndex)&&void 0!==v?v:X.field)}))),X.value!==X.previousValue&&(null===(u=K[f.OPERATION.REPLACE])||void 0===u||u.forEach((function(f){var v;return f(X.value,null!==(v=X.dynamicIndex)&&void 0!==v?v:X.field)})));W.add(F)},X=0;X<Z.length;X++)b(X)},v._definition=A.create(),v}();function tf(f){for(var v=[f.$changes],Z=1,V={},h=V,J=function(f){var Z=v[f];Z.changes.forEach((function(f){var v=Z.ref,V=f.index,J=v._definition?v._definition.fieldsByIndex[V]:v.$indexes.get(V);h[J]=Z.getValue(V)}))},l=0;l<Z;l++)J(l);return V}var Lf={context:new z},Ef=function(f){function v(){return null!==f&&f.apply(this,arguments)||this}return Z(v,f),V([y("string",Lf)],v.prototype,"name",void 0),V([y("string",Lf)],v.prototype,"type",void 0),V([y("number",Lf)],v.prototype,"referencedType",void 0),v}(wf),jf=function(f){function v(){var v=null!==f&&f.apply(this,arguments)||this;return v.fields=new b,v}return Z(v,f),V([y("number",Lf)],v.prototype,"id",void 0),V([y([Ef],Lf)],v.prototype,"fields",void 0),v}(wf),qf=function(f){function v(){var v=null!==f&&f.apply(this,arguments)||this;return v.types=new b,v}return Z(v,f),v.encode=function(f){var Z=f.constructor,V=new v;V.rootType=Z._typeid;var h=function(f,v){for(var Z in v){var h=new Ef;h.name=Z;var J=void 0;if("string"===typeof v[Z])J=v[Z];else{var l=v[Z],e=void 0;wf.is(l)?(J="ref",e=v[Z]):"string"===typeof l[J=Object.keys(l)[0]]?J+=":"+l[J]:e=l[J],h.referencedType=e?e._typeid:-1}h.type=J,f.fields.push(h)}V.types.push(f)},J=Z._context.types;for(var l in J){var e=new jf;e.id=Number(l),h(e,J[l]._definition.schema)}return V.encodeAll()},v.decode=function(f,V){var h=new z,J=new v;J.decode(f,V);var l=J.types.reduce((function(f,v){var V=function(f){function v(){return null!==f&&f.apply(this,arguments)||this}return Z(v,f),v}(wf),J=v.id;return f[J]=V,h.add(V,J),f}),{});J.types.forEach((function(f){var v=l[f.id];f.fields.forEach((function(f){var Z;if(void 0!==f.referencedType){var V=f.type,J=l[f.referencedType];if(!J){var e=f.type.split(":");V=e[0],J=e[1]}"ref"===V?y(J,{context:h})(v.prototype,f.name):y(((Z={})[V]=J,Z),{context:h})(v.prototype,f.name)}else y(f.type,{context:h})(v.prototype,f.name)}))}));var e=l[J.rootType],C=new e;for(var H in e._definition.schema){var O=e._definition.schema[H];"string"!==typeof O&&(C[H]="function"===typeof O?new O:new(M(Object.keys(O)[0]).constructor))}return C},V([y([jf],Lf)],v.prototype,"types",void 0),V([y("number",Lf)],v.prototype,"rootType",void 0),v}(wf);K("map",{constructor:F}),K("array",{constructor:b}),K("set",{constructor:Yf}),K("collection",{constructor:zf}),f.ArraySchema=b,f.CollectionSchema=zf,f.Context=z,f.MapSchema=F,f.Reflection=qf,f.ReflectionField=Ef,f.ReflectionType=jf,f.Schema=wf,f.SchemaDefinition=A,f.SetSchema=Yf,f.decode=sf,f.defineTypes=T,f.deprecated=I,f.dumpChanges=tf,f.encode=n,f.filter=N,f.filterChildren=i,f.hasFilter=s,f.registerType=K,f.type=y,Object.defineProperty(f,"__esModule",{value:!0})}(v)},13506:f=>{"use strict";f.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13499:(f,v,Z)=>{var V=Z(13506),h=Z(13513),J=Object.hasOwnProperty,l=Object.create(null);for(var e in V)J.call(V,e)&&(l[V[e]]=e);var C=f.exports={to:{},get:{}};function H(f,v,Z){return Math.min(Math.max(v,f),Z)}function O(f){var v=Math.round(f).toString(16).toUpperCase();return v.length<2?"0"+v:v}C.get=function(f){var v,Z;switch(f.substring(0,3).toLowerCase()){case"hsl":v=C.get.hsl(f),Z="hsl";break;case"hwb":v=C.get.hwb(f),Z="hwb";break;default:v=C.get.rgb(f),Z="rgb"}return v?{model:Z,value:v}:null},C.get.rgb=function(f){if(!f)return null;var v,Z,h,l=[0,0,0,1];if(v=f.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(h=v[2],v=v[1],Z=0;Z<3;Z++){var e=2*Z;l[Z]=parseInt(v.slice(e,e+2),16)}h&&(l[3]=parseInt(h,16)/255)}else if(v=f.match(/^#([a-f0-9]{3,4})$/i)){for(h=(v=v[1])[3],Z=0;Z<3;Z++)l[Z]=parseInt(v[Z]+v[Z],16);h&&(l[3]=parseInt(h+h,16)/255)}else if(v=f.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Z=0;Z<3;Z++)l[Z]=parseInt(v[Z+1],0);v[4]&&(v[5]?l[3]=.01*parseFloat(v[4]):l[3]=parseFloat(v[4]))}else{if(!(v=f.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(v=f.match(/^(\w+)$/))?"transparent"===v[1]?[0,0,0,0]:J.call(V,v[1])?((l=V[v[1]])[3]=1,l):null:null;for(Z=0;Z<3;Z++)l[Z]=Math.round(2.55*parseFloat(v[Z+1]));v[4]&&(v[5]?l[3]=.01*parseFloat(v[4]):l[3]=parseFloat(v[4]))}for(Z=0;Z<3;Z++)l[Z]=H(l[Z],0,255);return l[3]=H(l[3],0,1),l},C.get.hsl=function(f){if(!f)return null;var v=f.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var Z=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,H(parseFloat(v[2]),0,100),H(parseFloat(v[3]),0,100),H(isNaN(Z)?1:Z,0,1)]}return null},C.get.hwb=function(f){if(!f)return null;var v=f.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var Z=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,H(parseFloat(v[2]),0,100),H(parseFloat(v[3]),0,100),H(isNaN(Z)?1:Z,0,1)]}return null},C.to.hex=function(){var f=h(arguments);return"#"+O(f[0])+O(f[1])+O(f[2])+(f[3]<1?O(Math.round(255*f[3])):"")},C.to.rgb=function(){var f=h(arguments);return f.length<4||1===f[3]?"rgb("+Math.round(f[0])+", "+Math.round(f[1])+", "+Math.round(f[2])+")":"rgba("+Math.round(f[0])+", "+Math.round(f[1])+", "+Math.round(f[2])+", "+f[3]+")"},C.to.rgb.percent=function(){var f=h(arguments),v=Math.round(f[0]/255*100),Z=Math.round(f[1]/255*100),V=Math.round(f[2]/255*100);return f.length<4||1===f[3]?"rgb("+v+"%, "+Z+"%, "+V+"%)":"rgba("+v+"%, "+Z+"%, "+V+"%, "+f[3]+")"},C.to.hsl=function(){var f=h(arguments);return f.length<4||1===f[3]?"hsl("+f[0]+", "+f[1]+"%, "+f[2]+"%)":"hsla("+f[0]+", "+f[1]+"%, "+f[2]+"%, "+f[3]+")"},C.to.hwb=function(){var f=h(arguments),v="";return f.length>=4&&1!==f[3]&&(v=", "+f[3]),"hwb("+f[0]+", "+f[1]+"%, "+f[2]+"%"+v+")"},C.to.keyword=function(f){return l[f.slice(0,3)]}},13491:(f,v,Z)=>{const V=Z(13499),h=Z(13528),J=["keyword","gray","hex"],l={};for(const a of Object.keys(h))l[[...h[a].labels].sort().join("")]=a;const e={};function C(f,v){if(!(this instanceof C))return new C(f,v);if(v&&v in J&&(v=null),v&&!(v in h))throw new Error("Unknown model: "+v);let Z,H;if(null==f)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(f instanceof C)this.model=f.model,this.color=[...f.color],this.valpha=f.valpha;else if("string"===typeof f){const v=V.get(f);if(null===v)throw new Error("Unable to parse color from string: "+f);this.model=v.model,H=h[this.model].channels,this.color=v.value.slice(0,H),this.valpha="number"===typeof v.value[H]?v.value[H]:1}else if(f.length>0){this.model=v||"rgb",H=h[this.model].channels;const Z=Array.prototype.slice.call(f,0,H);this.color=W(Z,H),this.valpha="number"===typeof f[H]?f[H]:1}else if("number"===typeof f)this.model="rgb",this.color=[f>>16&255,f>>8&255,255&f],this.valpha=1;else{this.valpha=1;const v=Object.keys(f);"alpha"in f&&(v.splice(v.indexOf("alpha"),1),this.valpha="number"===typeof f.alpha?f.alpha:0);const V=v.sort().join("");if(!(V in l))throw new Error("Unable to parse color from object: "+JSON.stringify(f));this.model=l[V];const{labels:J}=h[this.model],e=[];for(Z=0;Z<J.length;Z++)e.push(f[J[Z]]);this.color=W(e)}if(e[this.model])for(H=h[this.model].channels,Z=0;Z<H;Z++){const f=e[this.model][Z];f&&(this.color[Z]=f(this.color[Z]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(f){let v=this.model in V.to?this:this.rgb();v=v.round("number"===typeof f?f:1);const Z=1===v.valpha?v.color:[...v.color,this.valpha];return V.to[v.model](Z)},percentString(f){const v=this.rgb().round("number"===typeof f?f:1),Z=1===v.valpha?v.color:[...v.color,this.valpha];return V.to.rgb.percent(Z)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const f={},{channels:v}=h[this.model],{labels:Z}=h[this.model];for(let V=0;V<v;V++)f[Z[V]]=this.color[V];return 1!==this.valpha&&(f.alpha=this.valpha),f},unitArray(){const f=this.rgb().color;return f[0]/=255,f[1]/=255,f[2]/=255,1!==this.valpha&&f.push(this.valpha),f},unitObject(){const f=this.rgb().object();return f.r/=255,f.g/=255,f.b/=255,1!==this.valpha&&(f.alpha=this.valpha),f},round(f){return f=Math.max(f||0,0),new C([...this.color.map(H(f)),this.valpha],this.model)},alpha(f){return void 0!==f?new C([...this.color,Math.max(0,Math.min(1,f))],this.model):this.valpha},red:O("rgb",0,u(255)),green:O("rgb",1,u(255)),blue:O("rgb",2,u(255)),hue:O(["hsl","hsv","hsl","hwb","hcg"],0,(f=>(f%360+360)%360)),saturationl:O("hsl",1,u(100)),lightness:O("hsl",2,u(100)),saturationv:O("hsv",1,u(100)),value:O("hsv",2,u(100)),chroma:O("hcg",1,u(100)),gray:O("hcg",2,u(100)),white:O("hwb",1,u(100)),wblack:O("hwb",2,u(100)),cyan:O("cmyk",0,u(100)),magenta:O("cmyk",1,u(100)),yellow:O("cmyk",2,u(100)),black:O("cmyk",3,u(100)),x:O("xyz",0,u(95.047)),y:O("xyz",1,u(100)),z:O("xyz",2,u(108.833)),l:O("lab",0,u(100)),a:O("lab",1),b:O("lab",2),keyword(f){return void 0!==f?new C(f):h[this.model].keyword(this.color)},hex(f){return void 0!==f?new C(f):V.to.hex(this.rgb().round().color)},hexa(f){if(void 0!==f)return new C(f);const v=this.rgb().round().color;let Z=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Z.length&&(Z="0"+Z),V.to.hex(v)+Z},rgbNumber(){const f=this.rgb().color;return(255&f[0])<<16|(255&f[1])<<8|255&f[2]},luminosity(){const f=this.rgb().color,v=[];for(const[Z,V]of f.entries()){const f=V/255;v[Z]=f<=.04045?f/12.92:((f+.055)/1.055)**2.4}return.2126*v[0]+.7152*v[1]+.0722*v[2]},contrast(f){const v=this.luminosity(),Z=f.luminosity();return v>Z?(v+.05)/(Z+.05):(Z+.05)/(v+.05)},level(f){const v=this.contrast(f);return v>=7?"AAA":v>=4.5?"AA":""},isDark(){const f=this.rgb().color;return(2126*f[0]+7152*f[1]+722*f[2])/1e4<128},isLight(){return!this.isDark()},negate(){const f=this.rgb();for(let v=0;v<3;v++)f.color[v]=255-f.color[v];return f},lighten(f){const v=this.hsl();return v.color[2]+=v.color[2]*f,v},darken(f){const v=this.hsl();return v.color[2]-=v.color[2]*f,v},saturate(f){const v=this.hsl();return v.color[1]+=v.color[1]*f,v},desaturate(f){const v=this.hsl();return v.color[1]-=v.color[1]*f,v},whiten(f){const v=this.hwb();return v.color[1]+=v.color[1]*f,v},blacken(f){const v=this.hwb();return v.color[2]+=v.color[2]*f,v},grayscale(){const f=this.rgb().color,v=.3*f[0]+.59*f[1]+.11*f[2];return C.rgb(v,v,v)},fade(f){return this.alpha(this.valpha-this.valpha*f)},opaquer(f){return this.alpha(this.valpha+this.valpha*f)},rotate(f){const v=this.hsl();let Z=v.color[0];return Z=(Z+f)%360,Z=Z<0?360+Z:Z,v.color[0]=Z,v},mix(f,v){if(!f||!f.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof f);const Z=f.rgb(),V=this.rgb(),h=void 0===v?.5:v,J=2*h-1,l=Z.alpha()-V.alpha(),e=((J*l===-1?J:(J+l)/(1+J*l))+1)/2,H=1-e;return C.rgb(e*Z.red()+H*V.red(),e*Z.green()+H*V.green(),e*Z.blue()+H*V.blue(),Z.alpha()*h+V.alpha()*(1-h))}};for(const a of Object.keys(h)){if(J.includes(a))continue;const{channels:f}=h[a];C.prototype[a]=function(){if(this.model===a)return new C(this);for(var f=arguments.length,v=new Array(f),Z=0;Z<f;Z++)v[Z]=arguments[Z];return v.length>0?new C(v,a):new C([...(V=h[this.model][a].raw(this.color),Array.isArray(V)?V:[V]),this.valpha],a);var V},C[a]=function(){for(var v=arguments.length,Z=new Array(v),V=0;V<v;V++)Z[V]=arguments[V];let h=Z[0];return"number"===typeof h&&(h=W(Z,f)),new C(h,a)}}function H(f){return function(v){return function(f,v){return Number(f.toFixed(v))}(v,f)}}function O(f,v,Z){f=Array.isArray(f)?f:[f];for(const V of f)(e[V]||(e[V]=[]))[v]=Z;return f=f[0],function(V){let h;return void 0!==V?(Z&&(V=Z(V)),h=this[f](),h.color[v]=V,h):(h=this[f]().color[v],Z&&(h=Z(h)),h)}}function u(f){return function(v){return Math.max(0,Math.min(f,v))}}function W(f,v){for(let Z=0;Z<v;Z++)"number"!==typeof f[Z]&&(f[Z]=0);return f}f.exports=C},13535:(f,v,Z)=>{const V=Z(13541),h={};for(const l of Object.keys(V))h[V[l]]=l;const J={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};f.exports=J;for(const l of Object.keys(J)){if(!("channels"in J[l]))throw new Error("missing channels property: "+l);if(!("labels"in J[l]))throw new Error("missing channel labels property: "+l);if(J[l].labels.length!==J[l].channels)throw new Error("channel and label counts mismatch: "+l);const{channels:f,labels:v}=J[l];delete J[l].channels,delete J[l].labels,Object.defineProperty(J[l],"channels",{value:f}),Object.defineProperty(J[l],"labels",{value:v})}J.rgb.hsl=function(f){const v=f[0]/255,Z=f[1]/255,V=f[2]/255,h=Math.min(v,Z,V),J=Math.max(v,Z,V),l=J-h;let e,C;J===h?e=0:v===J?e=(Z-V)/l:Z===J?e=2+(V-v)/l:V===J&&(e=4+(v-Z)/l),e=Math.min(60*e,360),e<0&&(e+=360);const H=(h+J)/2;return C=J===h?0:H<=.5?l/(J+h):l/(2-J-h),[e,100*C,100*H]},J.rgb.hsv=function(f){let v,Z,V,h,J;const l=f[0]/255,e=f[1]/255,C=f[2]/255,H=Math.max(l,e,C),O=H-Math.min(l,e,C),u=function(f){return(H-f)/6/O+.5};return 0===O?(h=0,J=0):(J=O/H,v=u(l),Z=u(e),V=u(C),l===H?h=V-Z:e===H?h=1/3+v-V:C===H&&(h=2/3+Z-v),h<0?h+=1:h>1&&(h-=1)),[360*h,100*J,100*H]},J.rgb.hwb=function(f){const v=f[0],Z=f[1];let V=f[2];const h=J.rgb.hsl(f)[0],l=1/255*Math.min(v,Math.min(Z,V));return V=1-1/255*Math.max(v,Math.max(Z,V)),[h,100*l,100*V]},J.rgb.cmyk=function(f){const v=f[0]/255,Z=f[1]/255,V=f[2]/255,h=Math.min(1-v,1-Z,1-V);return[100*((1-v-h)/(1-h)||0),100*((1-Z-h)/(1-h)||0),100*((1-V-h)/(1-h)||0),100*h]},J.rgb.keyword=function(f){const v=h[f];if(v)return v;let Z,J=1/0;for(const h of Object.keys(V)){const v=V[h],C=(e=v,((l=f)[0]-e[0])**2+(l[1]-e[1])**2+(l[2]-e[2])**2);C<J&&(J=C,Z=h)}var l,e;return Z},J.keyword.rgb=function(f){return V[f]},J.rgb.xyz=function(f){let v=f[0]/255,Z=f[1]/255,V=f[2]/255;v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92;return[100*(.4124*v+.3576*Z+.1805*V),100*(.2126*v+.7152*Z+.0722*V),100*(.0193*v+.1192*Z+.9505*V)]},J.rgb.lab=function(f){const v=J.rgb.xyz(f);let Z=v[0],V=v[1],h=v[2];Z/=95.047,V/=100,h/=108.883,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,h=h>.008856?h**(1/3):7.787*h+16/116;return[116*V-16,500*(Z-V),200*(V-h)]},J.hsl.rgb=function(f){const v=f[0]/360,Z=f[1]/100,V=f[2]/100;let h,J,l;if(0===Z)return l=255*V,[l,l,l];h=V<.5?V*(1+Z):V+Z-V*Z;const e=2*V-h,C=[0,0,0];for(let H=0;H<3;H++)J=v+1/3*-(H-1),J<0&&J++,J>1&&J--,l=6*J<1?e+6*(h-e)*J:2*J<1?h:3*J<2?e+(h-e)*(2/3-J)*6:e,C[H]=255*l;return C},J.hsl.hsv=function(f){const v=f[0];let Z=f[1]/100,V=f[2]/100,h=Z;const J=Math.max(V,.01);V*=2,Z*=V<=1?V:2-V,h*=J<=1?J:2-J;return[v,100*(0===V?2*h/(J+h):2*Z/(V+Z)),100*((V+Z)/2)]},J.hsv.rgb=function(f){const v=f[0]/60,Z=f[1]/100;let V=f[2]/100;const h=Math.floor(v)%6,J=v-Math.floor(v),l=255*V*(1-Z),e=255*V*(1-Z*J),C=255*V*(1-Z*(1-J));switch(V*=255,h){case 0:return[V,C,l];case 1:return[e,V,l];case 2:return[l,V,C];case 3:return[l,e,V];case 4:return[C,l,V];case 5:return[V,l,e]}},J.hsv.hsl=function(f){const v=f[0],Z=f[1]/100,V=f[2]/100,h=Math.max(V,.01);let J,l;l=(2-Z)*V;const e=(2-Z)*h;return J=Z*h,J/=e<=1?e:2-e,J=J||0,l/=2,[v,100*J,100*l]},J.hwb.rgb=function(f){const v=f[0]/360;let Z=f[1]/100,V=f[2]/100;const h=Z+V;let J;h>1&&(Z/=h,V/=h);const l=Math.floor(6*v),e=1-V;J=6*v-l,0!==(1&l)&&(J=1-J);const C=Z+J*(e-Z);let H,O,u;switch(l){default:case 6:case 0:H=e,O=C,u=Z;break;case 1:H=C,O=e,u=Z;break;case 2:H=Z,O=e,u=C;break;case 3:H=Z,O=C,u=e;break;case 4:H=C,O=Z,u=e;break;case 5:H=e,O=Z,u=C}return[255*H,255*O,255*u]},J.cmyk.rgb=function(f){const v=f[0]/100,Z=f[1]/100,V=f[2]/100,h=f[3]/100;return[255*(1-Math.min(1,v*(1-h)+h)),255*(1-Math.min(1,Z*(1-h)+h)),255*(1-Math.min(1,V*(1-h)+h))]},J.xyz.rgb=function(f){const v=f[0]/100,Z=f[1]/100,V=f[2]/100;let h,J,l;return h=3.2406*v+-1.5372*Z+-.4986*V,J=-.9689*v+1.8758*Z+.0415*V,l=.0557*v+-.204*Z+1.057*V,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,J=J>.0031308?1.055*J**(1/2.4)-.055:12.92*J,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,h=Math.min(Math.max(0,h),1),J=Math.min(Math.max(0,J),1),l=Math.min(Math.max(0,l),1),[255*h,255*J,255*l]},J.xyz.lab=function(f){let v=f[0],Z=f[1],V=f[2];v/=95.047,Z/=100,V/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,V=V>.008856?V**(1/3):7.787*V+16/116;return[116*Z-16,500*(v-Z),200*(Z-V)]},J.lab.xyz=function(f){let v,Z,V;Z=(f[0]+16)/116,v=f[1]/500+Z,V=Z-f[2]/200;const h=Z**3,J=v**3,l=V**3;return Z=h>.008856?h:(Z-16/116)/7.787,v=J>.008856?J:(v-16/116)/7.787,V=l>.008856?l:(V-16/116)/7.787,v*=95.047,Z*=100,V*=108.883,[v,Z,V]},J.lab.lch=function(f){const v=f[0],Z=f[1],V=f[2];let h;h=360*Math.atan2(V,Z)/2/Math.PI,h<0&&(h+=360);return[v,Math.sqrt(Z*Z+V*V),h]},J.lch.lab=function(f){const v=f[0],Z=f[1],V=f[2]/360*2*Math.PI;return[v,Z*Math.cos(V),Z*Math.sin(V)]},J.rgb.ansi16=function(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Z,V,h]=f;let l=null===v?J.rgb.hsv(f)[2]:v;if(l=Math.round(l/50),0===l)return 30;let e=30+(Math.round(h/255)<<2|Math.round(V/255)<<1|Math.round(Z/255));return 2===l&&(e+=60),e},J.hsv.ansi16=function(f){return J.rgb.ansi16(J.hsv.rgb(f),f[2])},J.rgb.ansi256=function(f){const v=f[0],Z=f[1],V=f[2];if(v===Z&&Z===V)return v<8?16:v>248?231:Math.round((v-8)/247*24)+232;return 16+36*Math.round(v/255*5)+6*Math.round(Z/255*5)+Math.round(V/255*5)},J.ansi16.rgb=function(f){let v=f%10;if(0===v||7===v)return f>50&&(v+=3.5),v=v/10.5*255,[v,v,v];const Z=.5*(1+~~(f>50));return[(1&v)*Z*255,(v>>1&1)*Z*255,(v>>2&1)*Z*255]},J.ansi256.rgb=function(f){if(f>=232){const v=10*(f-232)+8;return[v,v,v]}let v;f-=16;return[Math.floor(f/36)/5*255,Math.floor((v=f%36)/6)/5*255,v%6/5*255]},J.rgb.hex=function(f){const v=(((255&Math.round(f[0]))<<16)+((255&Math.round(f[1]))<<8)+(255&Math.round(f[2]))).toString(16).toUpperCase();return"000000".substring(v.length)+v},J.hex.rgb=function(f){const v=f.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!v)return[0,0,0];let Z=v[0];3===v[0].length&&(Z=Z.split("").map((f=>f+f)).join(""));const V=parseInt(Z,16);return[V>>16&255,V>>8&255,255&V]},J.rgb.hcg=function(f){const v=f[0]/255,Z=f[1]/255,V=f[2]/255,h=Math.max(Math.max(v,Z),V),J=Math.min(Math.min(v,Z),V),l=h-J;let e,C;return e=l<1?J/(1-l):0,C=l<=0?0:h===v?(Z-V)/l%6:h===Z?2+(V-v)/l:4+(v-Z)/l,C/=6,C%=1,[360*C,100*l,100*e]},J.hsl.hcg=function(f){const v=f[1]/100,Z=f[2]/100,V=Z<.5?2*v*Z:2*v*(1-Z);let h=0;return V<1&&(h=(Z-.5*V)/(1-V)),[f[0],100*V,100*h]},J.hsv.hcg=function(f){const v=f[1]/100,Z=f[2]/100,V=v*Z;let h=0;return V<1&&(h=(Z-V)/(1-V)),[f[0],100*V,100*h]},J.hcg.rgb=function(f){const v=f[0]/360,Z=f[1]/100,V=f[2]/100;if(0===Z)return[255*V,255*V,255*V];const h=[0,0,0],J=v%1*6,l=J%1,e=1-l;let C=0;switch(Math.floor(J)){case 0:h[0]=1,h[1]=l,h[2]=0;break;case 1:h[0]=e,h[1]=1,h[2]=0;break;case 2:h[0]=0,h[1]=1,h[2]=l;break;case 3:h[0]=0,h[1]=e,h[2]=1;break;case 4:h[0]=l,h[1]=0,h[2]=1;break;default:h[0]=1,h[1]=0,h[2]=e}return C=(1-Z)*V,[255*(Z*h[0]+C),255*(Z*h[1]+C),255*(Z*h[2]+C)]},J.hcg.hsv=function(f){const v=f[1]/100,Z=v+f[2]/100*(1-v);let V=0;return Z>0&&(V=v/Z),[f[0],100*V,100*Z]},J.hcg.hsl=function(f){const v=f[1]/100,Z=f[2]/100*(1-v)+.5*v;let V=0;return Z>0&&Z<.5?V=v/(2*Z):Z>=.5&&Z<1&&(V=v/(2*(1-Z))),[f[0],100*V,100*Z]},J.hcg.hwb=function(f){const v=f[1]/100,Z=v+f[2]/100*(1-v);return[f[0],100*(Z-v),100*(1-Z)]},J.hwb.hcg=function(f){const v=f[1]/100,Z=1-f[2]/100,V=Z-v;let h=0;return V<1&&(h=(Z-V)/(1-V)),[f[0],100*V,100*h]},J.apple.rgb=function(f){return[f[0]/65535*255,f[1]/65535*255,f[2]/65535*255]},J.rgb.apple=function(f){return[f[0]/255*65535,f[1]/255*65535,f[2]/255*65535]},J.gray.rgb=function(f){return[f[0]/100*255,f[0]/100*255,f[0]/100*255]},J.gray.hsl=function(f){return[0,0,f[0]]},J.gray.hsv=J.gray.hsl,J.gray.hwb=function(f){return[0,100,f[0]]},J.gray.cmyk=function(f){return[0,0,0,f[0]]},J.gray.lab=function(f){return[f[0],0,0]},J.gray.hex=function(f){const v=255&Math.round(f[0]/100*255),Z=((v<<16)+(v<<8)+v).toString(16).toUpperCase();return"000000".substring(Z.length)+Z},J.rgb.gray=function(f){return[(f[0]+f[1]+f[2])/3/255*100]}},13528:(f,v,Z)=>{const V=Z(13535),h=Z(13544),J={};Object.keys(V).forEach((f=>{J[f]={},Object.defineProperty(J[f],"channels",{value:V[f].channels}),Object.defineProperty(J[f],"labels",{value:V[f].labels});const v=h(f);Object.keys(v).forEach((Z=>{const V=v[Z];J[f][Z]=function(f){const v=function(){for(var v=arguments.length,Z=new Array(v),V=0;V<v;V++)Z[V]=arguments[V];const h=Z[0];if(void 0===h||null===h)return h;h.length>1&&(Z=h);const J=f(Z);if("object"===typeof J)for(let f=J.length,l=0;l<f;l++)J[l]=Math.round(J[l]);return J};return"conversion"in f&&(v.conversion=f.conversion),v}(V),J[f][Z].raw=function(f){const v=function(){for(var v=arguments.length,Z=new Array(v),V=0;V<v;V++)Z[V]=arguments[V];const h=Z[0];return void 0===h||null===h?h:(h.length>1&&(Z=h),f(Z))};return"conversion"in f&&(v.conversion=f.conversion),v}(V)}))})),f.exports=J},13544:(f,v,Z)=>{const V=Z(13535);function h(f){const v=function(){const f={},v=Object.keys(V);for(let Z=v.length,V=0;V<Z;V++)f[v[V]]={distance:-1,parent:null};return f}(),Z=[f];for(v[f].distance=0;Z.length;){const f=Z.pop(),h=Object.keys(V[f]);for(let V=h.length,J=0;J<V;J++){const V=h[J],l=v[V];-1===l.distance&&(l.distance=v[f].distance+1,l.parent=f,Z.unshift(V))}}return v}function J(f,v){return function(Z){return v(f(Z))}}function l(f,v){const Z=[v[f].parent,f];let h=V[v[f].parent][f],l=v[f].parent;for(;v[l].parent;)Z.unshift(v[l].parent),h=J(V[v[l].parent][l],h),l=v[l].parent;return h.conversion=Z,h}f.exports=function(f){const v=h(f),Z={},V=Object.keys(v);for(let h=V.length,J=0;J<h;J++){const f=V[J];null!==v[f].parent&&(Z[f]=l(f,v))}return Z}},13541:f=>{"use strict";f.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12106:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.discordURLBuilder=void 0,v.discordURLBuilder=function(f){var v;const Z=(null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)||"localhost",V=f.hostname.split("."),h=!f.hostname.includes("trycloudflare.com")&&!f.hostname.includes("discordsays.com")&&V.length>2?`/${V[0]}`:"";return f.pathname.startsWith("/.proxy")?`${f.protocol}//${Z}${h}${f.pathname}${f.search}`:`${f.protocol}//${Z}/.proxy/colyseus${h}${f.pathname}${f.search}`}},12094:function(f,v,Z){"use strict";var V,h,J,l,e=this&&this.__awaiter||function(f,v,Z,V){return new(Z||(Z=Promise))((function(h,J){function l(f){try{C(V.next(f))}catch(v){J(v)}}function e(f){try{C(V.throw(f))}catch(v){J(v)}}function C(f){var v;f.done?h(f.value):(v=f.value,v instanceof Z?v:new Z((function(f){f(v)}))).then(l,e)}C((V=V.apply(f,v||[])).next())}))},C=this&&this.__classPrivateFieldGet||function(f,v,Z,V){if("a"===Z&&!V)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof v?f!==v||!V:!v.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===Z?V:"a"===Z?V.call(f):V?V.value:v.get(f)},H=this&&this.__classPrivateFieldSet||function(f,v,Z,V,h){if("m"===V)throw new TypeError("Private method is not writable");if("a"===V&&!h)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof v?f!==v||!h:!v.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===V?h.call(f,Z):h?h.value=Z:v.set(f,Z),Z};Object.defineProperty(v,"__esModule",{value:!0}),v.Auth=void 0;const O=Z(12097),u=Z(12067);v.Auth=class{constructor(f){this.http=f,this.settings={path:"/auth",key:"colyseus-auth-token"},V.set(this,!1),h.set(this,void 0),J.set(this,void 0),l.set(this,(0,u.createNanoEvents)()),(0,O.getItem)(this.settings.key,(f=>this.token=f))}set token(f){this.http.authToken=f}get token(){return this.http.authToken}onChange(f){const v=C(this,l,"f").on("change",f);return C(this,V,"f")||H(this,h,new Promise(((f,v)=>{this.getUserData().then((f=>{this.emitChange(Object.assign(Object.assign({},f),{token:this.token}))})).catch((f=>{this.emitChange({user:null,token:void 0})})).finally((()=>{f()}))})),"f"),H(this,V,!0,"f"),v}getUserData(){return e(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(f,v,Z){return e(this,void 0,void 0,(function*(){const V=(yield this.http.post(`${this.settings.path}/register`,{body:{email:f,password:v,options:Z}})).data;return this.emitChange(V),V}))}signInWithEmailAndPassword(f,v){return e(this,void 0,void 0,(function*(){const Z=(yield this.http.post(`${this.settings.path}/login`,{body:{email:f,password:v}})).data;return this.emitChange(Z),Z}))}signInAnonymously(f){return e(this,void 0,void 0,(function*(){const v=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:f}})).data;return this.emitChange(v),v}))}sendPasswordResetEmail(f){return e(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:f}})).data}))}signInWithProvider(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e(this,void 0,void 0,(function*(){return new Promise(((Z,V)=>{const h=v.width||480,l=v.height||768,e=this.token?`?token=${this.token}`:"",O=`Login with ${f[0].toUpperCase()+f.substring(1)}`,u=this.http.client.getHttpEndpoint(`${v.prefix||`${this.settings.path}/provider`}/${f}${e}`),W=screen.width/2-h/2,a=screen.height/2-l/2;H(this,J,window.open(u,O,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+h+", height="+l+", top="+a+", left="+W),"f");const b=f=>{void 0===f.data.user&&void 0===f.data.token||(clearInterval(X),C(this,J,"f").close(),H(this,J,void 0,"f"),window.removeEventListener("message",b),void 0!==f.data.error?V(f.data.error):(Z(f.data),this.emitChange(f.data)))},X=setInterval((()=>{C(this,J,"f")&&!C(this,J,"f").closed||(H(this,J,void 0,"f"),V("sJ"),window.removeEventListener("message",b))}),200);window.addEventListener("message",b)}))}))}signOut(){return e(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(f){void 0!==f.token&&(this.token=f.token,null===f.token?(0,O.removeItem)(this.settings.key):(0,O.setItem)(this.settings.key,f.token)),C(this,l,"f").emit("change",f)}},V=new WeakMap,h=new WeakMap,J=new WeakMap,l=new WeakMap},12013:function(f,v,Z){"use strict";var V,h=this&&this.__awaiter||function(f,v,Z,V){return new(Z||(Z=Promise))((function(h,J){function l(f){try{C(V.next(f))}catch(v){J(v)}}function e(f){try{C(V.throw(f))}catch(v){J(v)}}function C(f){var v;f.done?h(f.value):(v=f.value,v instanceof Z?v:new Z((function(f){f(v)}))).then(l,e)}C((V=V.apply(f,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Client=v.MatchMakeError=void 0;const J=Z(12016),l=Z(12024),e=Z(12085),C=Z(12094),H=Z(12106);class O extends Error{constructor(f,v){super(f),this.code=v,Object.setPrototypeOf(this,O.prototype)}}v.MatchMakeError=O;const u="undefined"!==typeof window&&"undefined"!==typeof(null===(V=null===window||void 0===window?void 0:window.location)||void 0===V?void 0:V.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";v.Client=class{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,v=arguments.length>1?arguments[1]:void 0;var Z,V;if("string"===typeof f){const v=f.startsWith("/")?new URL(f,u):new URL(f),Z="https:"===v.protocol||"wss:"===v.protocol,V=Number(v.port||(Z?443:80));this.settings={hostname:v.hostname,pathname:v.pathname,port:V,secure:Z}}else void 0===f.port&&(f.port=f.secure?443:80),void 0===f.pathname&&(f.pathname=""),this.settings=f;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new e.HTTP(this,(null===v||void 0===v?void 0:v.headers)||{}),this.auth=new C.Auth(this.http),this.urlBuilder=null===v||void 0===v?void 0:v.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(V=null===(Z=null===window||void 0===window?void 0:window.location)||void 0===Z?void 0:Z.hostname)||void 0===V?void 0:V.includes("discordsays.com"))&&(this.urlBuilder=H.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",f,v,Z)}))}create(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",f,v,Z)}))}join(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",f,v,Z)}))}joinById(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",f,v,Z)}))}reconnect(f,v){return h(this,void 0,void 0,(function*(){if("string"===typeof f&&"string"===typeof v)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Z,V]=f.split(":");if(!Z||!V)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",Z,{reconnectionToken:V},v)}))}getAvailableRooms(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return h(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${f}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(f,v,Z){return h(this,void 0,void 0,(function*(){const V=this.createRoom(f.room.name,v);V.roomId=f.room.roomId,V.sessionId=f.sessionId;const l={sessionId:V.sessionId};f.reconnectionToken&&(l.reconnectionToken=f.reconnectionToken);const e=Z||V;return V.connect(this.buildEndpoint(f.room,l),f.devMode&&(()=>h(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${V.roomId}'...`);let Z=0;const J=()=>h(this,void 0,void 0,(function*(){Z++;try{yield this.consumeSeatReservation(f,v,e),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${V.roomId}'`)}catch(h){Z<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Z} out of 8)`),setTimeout(J,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(J,2e3)}))),e,this.http.headers),new Promise(((f,v)=>{const Z=(f,Z)=>v(new J.ServerError(f,Z));e.onError.once(Z),e.onJoin.once((()=>{e.onError.remove(Z),setTimeout((()=>{try{e.cC(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),f(e)}))}))}))}createMatchMakeRequest(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},V=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0;return h(this,void 0,void 0,(function*(){const h=(yield this.http.post(`matchmake/${f}/${v}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Z)})).data;if(h.error)throw new O(h.error,h.code);return"reconnect"===f&&(h.reconnectionToken=Z.reconnectionToken),yield this.consumeSeatReservation(h,V,J)}))}createRoom(f,v){return new l.Room(f,v)}buildEndpoint(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Z=[];for(const J in v)v.hasOwnProperty(J)&&Z.push(`${J}=${v[J]}`);let V=this.settings.secure?"wss://":"ws://";f.publicAddress?V+=`${f.publicAddress}`:V+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const h=`${V}/${f.processId}/${f.roomId}?${Z.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(h)):h}getHttpEndpoint(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const v=f.startsWith("/")?f:`/${f}`,Z=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${v}`;return this.urlBuilder?this.urlBuilder(new URL(Z)):Z}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12038:(f,v,Z)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.Connection=void 0;const V=Z(12046);v.Connection=class{constructor(){this.events={},this.transport=new V.WebSocketTransport(this.events)}send(f){this.transport.send(f)}connect(f,v){this.transport.connect(f,v)}close(f,v){this.transport.close(f,v)}get isOpen(){return this.transport.isOpen}}},12085:function(f,v,Z){"use strict";var V=this&&this.__createBinding||(Object.create?function(f,v,Z,V){void 0===V&&(V=Z);var h=Object.getOwnPropertyDescriptor(v,Z);h&&!("get"in h?!v.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return v[Z]}}),Object.defineProperty(f,V,h)}:function(f,v,Z,V){void 0===V&&(V=Z),f[V]=v[Z]}),h=this&&this.__setModuleDefault||(Object.create?function(f,v){Object.defineProperty(f,"default",{enumerable:!0,value:v})}:function(f,v){f.default=v}),J=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var v={};if(null!=f)for(var Z in f)"default"!==Z&&Object.prototype.hasOwnProperty.call(f,Z)&&V(v,f,Z);return h(v,f),v};Object.defineProperty(v,"__esModule",{value:!0}),v.HTTP=void 0;const l=Z(12016),e=J(Z(12091));v.HTTP=class{constructor(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=f,this.headers=v}get(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",f,v)}post(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",f,v)}del(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",f,v)}put(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",f,v)}request(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e[f](this.client.getHttpEndpoint(v),this.getOptions(Z)).catch((f=>{var v;const Z=f.statusCode,V=(null===(v=f.data)||void 0===v?void 0:v.error)||f.statusMessage||f.message;if(!Z&&!V)throw f;throw new l.ServerError(Z,V)}))}getOptions(f){return f.headers=Object.assign({},this.headers,f.headers),this.authToken&&(f.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(f.withCredentials=!0),f}}},12056:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.utf8Length=v.utf8Read=v.ErrorCode=v.Protocol=void 0,function(f){f[f.HANDSHAKE=9]="HANDSHAKE",f[f.JOIN_ROOM=10]="JOIN_ROOM",f[f.ERROR=11]="ERROR",f[f.LEAVE_ROOM=12]="LEAVE_ROOM",f[f.ROOM_DATA=13]="ROOM_DATA",f[f.ROOM_STATE=14]="ROOM_STATE",f[f.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",f[f.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",f[f.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(v.Protocol||(v.Protocol={})),function(f){f[f.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",f[f.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",f[f.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",f[f.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",f[f.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",f[f.AUTH_FAILED=4215]="AUTH_FAILED",f[f.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(v.ErrorCode||(v.ErrorCode={})),v.utf8Read=function(f,v){const Z=f[v++];for(var V="",h=0,J=v,l=v+Z;J<l;J++){var e=f[J];if(0!==(128&e))if(192!==(224&e))if(224!==(240&e)){if(240!==(248&e))throw new Error("Invalid byte "+e.toString(16));(h=(7&e)<<18|(63&f[++J])<<12|(63&f[++J])<<6|63&f[++J])>=65536?(h-=65536,V+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):V+=String.fromCharCode(h)}else V+=String.fromCharCode((15&e)<<12|(63&f[++J])<<6|63&f[++J]);else V+=String.fromCharCode((31&e)<<6|63&f[++J]);else V+=String.fromCharCode(e)}return V},v.utf8Length=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",v=0,Z=0;for(let V=0,h=f.length;V<h;V++)v=f.charCodeAt(V),v<128?Z+=1:v<2048?Z+=2:v<55296||v>=57344?Z+=3:(V++,Z+=4);return Z+1}},12024:function(f,v,Z){"use strict";var V=this&&this.__createBinding||(Object.create?function(f,v,Z,V){void 0===V&&(V=Z);var h=Object.getOwnPropertyDescriptor(v,Z);h&&!("get"in h?!v.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return v[Z]}}),Object.defineProperty(f,V,h)}:function(f,v,Z,V){void 0===V&&(V=Z),f[V]=v[Z]}),h=this&&this.__setModuleDefault||(Object.create?function(f,v){Object.defineProperty(f,"default",{enumerable:!0,value:v})}:function(f,v){f.default=v}),J=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var v={};if(null!=f)for(var Z in f)"default"!==Z&&Object.prototype.hasOwnProperty.call(f,Z)&&V(v,f,Z);return h(v,f),v};Object.defineProperty(v,"__esModule",{value:!0}),v.Room=void 0;const l=J(Z(12030)),e=Z(12038),C=Z(12056),H=Z(12064),O=Z(12067),u=Z(12069),W=Z(12078),a=Z(12016);class b{constructor(f,v){this.onStateChange=(0,u.createSignal)(),this.onError=(0,u.createSignal)(),this.onLeave=(0,u.createSignal)(),this.onJoin=(0,u.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,O.createNanoEvents)(),this.roomId=null,this.name=f,v&&(this.serializer=new((0,H.getSerializer)("schema")),this.rootSchema=v,this.serializer.state=new v),this.onError(((f,v)=>{var Z;return null===(Z=console.warn)||void 0===Z?void 0:Z.call(console,`colyseus.js - onError => (${f}) ${v}`)})),this.onLeave((()=>this.Jv()))}get id(){return this.roomId}connect(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,V=arguments.length>3?arguments[3]:void 0;const h=new e.Connection;Z.connection=h,h.events.onmessage=b.prototype.onMessageCallback.bind(Z),h.events.onclose=function(f){var V;if(!Z.hasJoined)return null===(V=console.warn)||void 0===V||V.call(console,`Room connection was closed unexpectedly (${f.code}): ${f.reason}`),void Z.onError.invoke(f.code,f.reason);f.code===a.CloseCode.DEVMODE_RESTART&&v?v():(Z.onLeave.invoke(f.code,f.reason),Z.destroy())},h.events.onerror=function(f){var v;null===(v=console.warn)||void 0===v||v.call(console,`Room, onError (${f.code}): ${f.reason}`),Z.onError.invoke(f.code,f.reason)},h.connect(f,V)}be(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((v=>{this.onLeave((f=>v(f))),this.connection?f?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(a.CloseCode.CONSENTED)}))}Lv(f,v){return this.onMessageHandlers.on(this.getMessageHandlerKey(f),v)}send(f,v){const Z=[C.Protocol.ROOM_DATA];let V;if("string"===typeof f?W.encode.string(Z,f):W.encode.number(Z,f),void 0!==v){const f=l.encode(v);V=new Uint8Array(Z.length+f.byteLength),V.set(new Uint8Array(Z),0),V.set(new Uint8Array(f),Z.length)}else V=new Uint8Array(Z);this.connection.send(V.buffer)}cC(f,v){const Z=[C.Protocol.ROOM_DATA_BYTES];let V;"string"===typeof f?W.encode.string(Z,f):W.encode.number(Z,f),V=new Uint8Array(Z.length+(v.byteLength||v.length)),V.set(new Uint8Array(Z),0),V.set(new Uint8Array(v),Z.length),this.connection.send(V.buffer)}get state(){return this.serializer.getState()}Jv(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(f){const v=Array.from(new Uint8Array(f.data)),Z=v[0];if(Z===C.Protocol.JOIN_ROOM){let f=1;const Z=(0,C.utf8Read)(v,f);if(f+=(0,C.utf8Length)(Z),this.serializerId=(0,C.utf8Read)(v,f),f+=(0,C.utf8Length)(this.serializerId),!this.serializer){const f=(0,H.getSerializer)(this.serializerId);this.serializer=new f}v.length>f&&this.serializer.handshake&&this.serializer.handshake(v,{offset:f}),this.reconnectionToken=`${this.roomId}:${Z}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(Z===C.Protocol.ERROR){const f={offset:1},Z=W.decode.number(v,f),V=W.decode.string(v,f);this.onError.invoke(Z,V)}else if(Z===C.Protocol.LEAVE_ROOM)this.be();else if(Z===C.Protocol.ROOM_DATA_SCHEMA){const f={offset:1},Z=this.serializer.getState().constructor._context.get(W.decode.number(v,f)),V=new Z;V.decode(v,f),this.dispatchMessage(Z,V)}else if(Z===C.Protocol.ROOM_STATE)v.shift(),this.setState(v);else if(Z===C.Protocol.ROOM_STATE_PATCH)v.shift(),this.patch(v);else if(Z===C.Protocol.ROOM_DATA){const Z={offset:1},V=W.decode.stringCheck(v,Z)?W.decode.string(v,Z):W.decode.number(v,Z),h=v.length>Z.offset?l.decode(f.data,Z.offset):void 0;this.dispatchMessage(V,h)}else if(Z===C.Protocol.ROOM_DATA_BYTES){const f={offset:1},Z=W.decode.stringCheck(v,f)?W.decode.string(v,f):W.decode.number(v,f);this.dispatchMessage(Z,new Uint8Array(v.slice(f.offset)))}}setState(f){this.serializer.setState(f),this.onStateChange.invoke(this.serializer.getState())}patch(f){this.serializer.patch(f),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(f,v){var Z;const V=this.getMessageHandlerKey(f);this.onMessageHandlers.events[V]?this.onMessageHandlers.emit(V,v):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",f,v):null===(Z=console.warn)||void 0===Z||Z.call(console,`colyseus.js: onMessage() not registered for type '${f}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(f){switch(typeof f){case"function":return`$${f._typeid}`;case"string":return f;case"number":return`i${f}`;default:throw new Error("invalid message type.")}}}v.Room=b},12097:(f,v)=>{"use strict";let Z;function V(){if(!Z)try{Z="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(f){}return Z||(Z={cache:{},setItem:function(f,v){this.cache[f]=v},getItem:function(f){this.cache[f]},removeItem:function(f){delete this.cache[f]}}),Z}Object.defineProperty(v,"__esModule",{value:!0}),v.getItem=v.removeItem=v.setItem=void 0,v.setItem=function(f,v){V().setItem(f,v)},v.removeItem=function(f){V().removeItem(f)},v.getItem=function(f,v){const Z=V().getItem(f);"undefined"!==typeof Promise&&Z instanceof Promise?Z.then((f=>v(f))):v(Z)}},12067:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createNanoEvents=void 0;v.createNanoEvents=()=>({emit(f){let v=this.events[f]||[];for(var Z=arguments.length,V=new Array(Z>1?Z-1:0),h=1;h<Z;h++)V[h-1]=arguments[h];for(let J=0,l=v.length;J<l;J++)v[J](...V)},events:{},on(f,v){var Z;return(null===(Z=this.events[f])||void 0===Z?void 0:Z.push(v))||(this.events[f]=[v]),()=>{var Z;this.events[f]=null===(Z=this.events[f])||void 0===Z?void 0:Z.filter((f=>v!==f))}}})},12069:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createSignal=v.EventEmitter=void 0;class Z{constructor(){this.handlers=[]}register(f){return this.handlers.push(f),this}invoke(){for(var f=arguments.length,v=new Array(f),Z=0;Z<f;Z++)v[Z]=arguments[Z];this.handlers.forEach((f=>f.apply(this,v)))}invokeAsync(){for(var f=arguments.length,v=new Array(f),Z=0;Z<f;Z++)v[Z]=arguments[Z];return Promise.all(this.handlers.map((f=>f.apply(this,v))))}remove(f){const v=this.handlers.indexOf(f);this.handlers[v]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}v.EventEmitter=Z,v.createSignal=function(){const f=new Z;function v(v){return f.register(v,null===this)}return v.once=v=>{const Z=function(){for(var V=arguments.length,h=new Array(V),J=0;J<V;J++)h[J]=arguments[J];v.apply(this,h),f.remove(Z)};f.register(Z)},v.remove=v=>f.remove(v),v.invoke=function(){return f.invoke(...arguments)},v.invokeAsync=function(){return f.invokeAsync(...arguments)},v.clear=()=>f.clear(),v}},12016:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.ServerError=v.CloseCode=void 0,function(f){f[f.CONSENTED=4e3]="CONSENTED",f[f.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(v.CloseCode||(v.CloseCode={}));class Z extends Error{constructor(f,v){super(v),this.name="ServerError",this.code=f}}v.ServerError=Z},12e3:(f,v,Z)=>{"use strict";v.d=void 0,Z(12005);var V=Z(12013);Object.defineProperty(v,"d",{enumerable:!0,get:function(){return V.Client}});var h=Z(12056);var J=Z(12024);var l=Z(12094);const e=Z(12114);const C=Z(12122),H=Z(12064);(0,H.registerSerializer)("schema",e.SchemaSerializer),(0,H.registerSerializer)("none",C.NoneSerializer)},12005:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=f=>null!==f&&"object"===typeof f&&f.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12030:(f,v)=>{"use strict";function Z(f,v){if(this._offset=v,f instanceof ArrayBuffer)this._buffer=f,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(f))throw new Error("Invalid argument");this._buffer=f.buffer,this._view=new DataView(this._buffer,f.byteOffset,f.byteLength)}}Object.defineProperty(v,"__esModule",{value:!0}),v.decode=v.encode=void 0,Z.prototype._array=function(f){for(var v=new Array(f),Z=0;Z<f;Z++)v[Z]=this._parse();return v},Z.prototype._map=function(f){for(var v={},Z=0;Z<f;Z++)v[this._parse()]=this._parse();return v},Z.prototype._str=function(f){var v=function(f,v,Z){for(var V="",h=0,J=v,l=v+Z;J<l;J++){var e=f.getUint8(J);if(0!==(128&e))if(192!==(224&e))if(224!==(240&e)){if(240!==(248&e))throw new Error("Invalid byte "+e.toString(16));(h=(7&e)<<18|(63&f.getUint8(++J))<<12|(63&f.getUint8(++J))<<6|63&f.getUint8(++J))>=65536?(h-=65536,V+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):V+=String.fromCharCode(h)}else V+=String.fromCharCode((15&e)<<12|(63&f.getUint8(++J))<<6|63&f.getUint8(++J));else V+=String.fromCharCode((31&e)<<6|63&f.getUint8(++J));else V+=String.fromCharCode(e)}return V}(this._view,this._offset,f);return this._offset+=f,v},Z.prototype._bin=function(f){var v=this._buffer.slice(this._offset,this._offset+f);return this._offset+=f,v},Z.prototype._parse=function(){var f,v=this._view.getUint8(this._offset++),Z=0,V=0,h=0,J=0;if(v<192)return v<128?v:v<144?this._map(15&v):v<160?this._array(15&v):this._str(31&v);if(v>223)return-1*(255-v+1);switch(v){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Z=this._view.getUint8(this._offset),this._offset+=1,this._bin(Z);case 197:return Z=this._view.getUint16(this._offset),this._offset+=2,this._bin(Z);case 198:return Z=this._view.getUint32(this._offset),this._offset+=4,this._bin(Z);case 199:if(Z=this._view.getUint8(this._offset),V=this._view.getInt8(this._offset+1),this._offset+=2,-1===V){var l=this._view.getUint32(this._offset);return h=this._view.getInt32(this._offset+4),J=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*h+J)+l/1e6)}return[V,this._bin(Z)];case 200:return Z=this._view.getUint16(this._offset),V=this._view.getInt8(this._offset+2),this._offset+=3,[V,this._bin(Z)];case 201:return Z=this._view.getUint32(this._offset),V=this._view.getInt8(this._offset+4),this._offset+=5,[V,this._bin(Z)];case 202:return f=this._view.getFloat32(this._offset),this._offset+=4,f;case 203:return f=this._view.getFloat64(this._offset),this._offset+=8,f;case 204:return f=this._view.getUint8(this._offset),this._offset+=1,f;case 205:return f=this._view.getUint16(this._offset),this._offset+=2,f;case 206:return f=this._view.getUint32(this._offset),this._offset+=4,f;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),J=this._view.getUint32(this._offset+4),this._offset+=8,h+J;case 208:return f=this._view.getInt8(this._offset),this._offset+=1,f;case 209:return f=this._view.getInt16(this._offset),this._offset+=2,f;case 210:return f=this._view.getInt32(this._offset),this._offset+=4,f;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),J=this._view.getUint32(this._offset+4),this._offset+=8,h+J;case 212:return V=this._view.getInt8(this._offset),this._offset+=1,0===V?void(this._offset+=1):[V,this._bin(1)];case 213:return V=this._view.getInt8(this._offset),this._offset+=1,[V,this._bin(2)];case 214:return V=this._view.getInt8(this._offset),this._offset+=1,-1===V?(f=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*f)):[V,this._bin(4)];case 215:return V=this._view.getInt8(this._offset),this._offset+=1,0===V?(h=this._view.getInt32(this._offset)*Math.pow(2,32),J=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+J)):-1===V?(h=this._view.getUint32(this._offset),J=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&h)+J)+(h>>>2)/1e6)):[V,this._bin(8)];case 216:return V=this._view.getInt8(this._offset),this._offset+=1,[V,this._bin(16)];case 217:return Z=this._view.getUint8(this._offset),this._offset+=1,this._str(Z);case 218:return Z=this._view.getUint16(this._offset),this._offset+=2,this._str(Z);case 219:return Z=this._view.getUint32(this._offset),this._offset+=4,this._str(Z);case 220:return Z=this._view.getUint16(this._offset),this._offset+=2,this._array(Z);case 221:return Z=this._view.getUint32(this._offset),this._offset+=4,this._array(Z);case 222:return Z=this._view.getUint16(this._offset),this._offset+=2,this._map(Z);case 223:return Z=this._view.getUint32(this._offset),this._offset+=4,this._map(Z)}throw new Error("Could not parse")},v.decode=function(f){var v=new Z(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),V=v._parse();if(v._offset!==f.byteLength)throw new Error(f.byteLength-v._offset+" trailing bytes");return V};function V(f,v,Z){for(var V=0,h=0,J=Z.length;h<J;h++)(V=Z.charCodeAt(h))<128?f.setUint8(v++,V):V<2048?(f.setUint8(v++,192|V>>6),f.setUint8(v++,128|63&V)):V<55296||V>=57344?(f.setUint8(v++,224|V>>12),f.setUint8(v++,128|V>>6&63),f.setUint8(v++,128|63&V)):(h++,V=65536+((1023&V)<<10|1023&Z.charCodeAt(h)),f.setUint8(v++,240|V>>18),f.setUint8(v++,128|V>>12&63),f.setUint8(v++,128|V>>6&63),f.setUint8(v++,128|63&V))}function h(f,v,Z){var V=typeof Z,J=0,l=0,e=0,C=0,H=0,O=0;if("string"===V){if(H=function(f){for(var v=0,Z=0,V=0,h=f.length;V<h;V++)(v=f.charCodeAt(V))<128?Z+=1:v<2048?Z+=2:v<55296||v>=57344?Z+=3:(V++,Z+=4);return Z}(Z),H<32)f.push(160|H),O=1;else if(H<256)f.push(217,H),O=2;else if(H<65536)f.push(218,H>>8,H),O=3;else{if(!(H<4294967296))throw new Error("String too long");f.push(219,H>>24,H>>16,H>>8,H),O=5}return v.push({_str:Z,_length:H,_offset:f.length}),O+H}if("number"===V)return Math.floor(Z)===Z&&isFinite(Z)?Z>=0?Z<128?(f.push(Z),1):Z<256?(f.push(204,Z),2):Z<65536?(f.push(205,Z>>8,Z),3):Z<4294967296?(f.push(206,Z>>24,Z>>16,Z>>8,Z),5):(e=Z/Math.pow(2,32)|0,C=Z>>>0,f.push(207,e>>24,e>>16,e>>8,e,C>>24,C>>16,C>>8,C),9):Z>=-32?(f.push(Z),1):Z>=-128?(f.push(208,Z),2):Z>=-32768?(f.push(209,Z>>8,Z),3):Z>=-2147483648?(f.push(210,Z>>24,Z>>16,Z>>8,Z),5):(e=Math.floor(Z/Math.pow(2,32)),C=Z>>>0,f.push(211,e>>24,e>>16,e>>8,e,C>>24,C>>16,C>>8,C),9):(f.push(203),v.push({_float:Z,_length:8,_offset:f.length}),9);if("object"===V){if(null===Z)return f.push(192),1;if(Array.isArray(Z)){if((H=Z.length)<16)f.push(144|H),O=1;else if(H<65536)f.push(220,H>>8,H),O=3;else{if(!(H<4294967296))throw new Error("Array too large");f.push(221,H>>24,H>>16,H>>8,H),O=5}for(J=0;J<H;J++)O+=h(f,v,Z[J]);return O}if(Z instanceof Date){var u=Z.getTime(),W=Math.floor(u/1e3),a=1e6*(u-1e3*W);return W>=0&&a>=0&&W<=17179869183?0===a&&W<=4294967295?(f.push(214,255,W>>24,W>>16,W>>8,W),6):(e=W/4294967296,C=4294967295&W,f.push(215,255,a>>22,a>>14,a>>6,e,C>>24,C>>16,C>>8,C),10):(e=Math.floor(W/4294967296),C=W>>>0,f.push(199,12,255,a>>24,a>>16,a>>8,a,e>>24,e>>16,e>>8,e,C>>24,C>>16,C>>8,C),15)}if(Z instanceof ArrayBuffer){if((H=Z.byteLength)<256)f.push(196,H),O=2;else if(H<65536)f.push(197,H>>8,H),O=3;else{if(!(H<4294967296))throw new Error("Buffer too large");f.push(198,H>>24,H>>16,H>>8,H),O=5}return v.push({_bin:Z,_length:H,_offset:f.length}),O+H}if("function"===typeof Z.toJSON)return h(f,v,Z.toJSON());var b=[],X="",F=Object.keys(Z);for(J=0,l=F.length;J<l;J++)void 0!==Z[X=F[J]]&&"function"!==typeof Z[X]&&b.push(X);if((H=b.length)<16)f.push(128|H),O=1;else if(H<65536)f.push(222,H>>8,H),O=3;else{if(!(H<4294967296))throw new Error("Object too large");f.push(223,H>>24,H>>16,H>>8,H),O=5}for(J=0;J<H;J++)O+=h(f,v,X=b[J]),O+=h(f,v,Z[X]);return O}if("boolean"===V)return f.push(Z?195:194),1;if("undefined"===V)return f.push(192),1;if("function"===typeof Z.toJSON)return h(f,v,Z.toJSON());throw new Error("Could not encode")}v.encode=function(f){var v=[],Z=[],J=h(v,Z,f),l=new ArrayBuffer(J),e=new DataView(l),C=0,H=0,O=-1;Z.length>0&&(O=Z[0]._offset);for(var u,W=0,a=0,b=0,X=v.length;b<X;b++)if(e.setUint8(H+b,v[b]),b+1===O){if(W=(u=Z[C])._length,a=H+O,u._bin)for(var F=new Uint8Array(u._bin),U=0;U<W;U++)e.setUint8(a+U,F[U]);else u._str?V(e,a,u._str):void 0!==u._float&&e.setFloat64(a,u._float);H+=W,Z[++C]&&(O=Z[C]._offset)}return l}},12122:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.NoneSerializer=void 0;v.NoneSerializer=class{setState(f){}getState(){return null}patch(f){}teardown(){}handshake(f){}}},12114:(f,v,Z)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.SchemaSerializer=void 0;const V=Z(12078);v.SchemaSerializer=class{setState(f){return this.state.decode(f)}getState(){return this.state}patch(f){return this.state.decode(f)}teardown(){var f,v;null===(v=null===(f=this.state)||void 0===f?void 0:f.$changes)||void 0===v||v.root.clearRefs()}handshake(f,v){if(this.state){(new V.Reflection).decode(f,v)}else this.state=V.Reflection.decode(f,v)}}},12064:(f,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.getSerializer=v.registerSerializer=void 0;const Z={};v.registerSerializer=function(f,v){Z[f]=v},v.getSerializer=function(f){const v=Z[f];if(!v)throw new Error("missing serializer: "+f);return v}},12046:function(f,v,Z){"use strict";var V=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(v,"__esModule",{value:!0}),v.WebSocketTransport=void 0;const h=V(Z(12053)),J=globalThis.WebSocket||h.default;v.WebSocketTransport=class{constructor(f){this.events=f}send(f){f instanceof ArrayBuffer?this.ws.send(f):Array.isArray(f)&&this.ws.send(new Uint8Array(f).buffer)}connect(f,v){try{this.ws=new J(f,{headers:v,protocols:this.protocols})}catch(Z){this.ws=new J(f,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(f,v){this.ws.close(f,v)}get isOpen(){return this.ws.readyState===J.OPEN}}},12053:f=>{"use strict";f.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12526:f=>{"use strict";f.exports=function(f){for(var v=new Array(f),Z=0;Z<f;++Z)v[Z]=Z;return v}},12535:f=>{function v(f){return!!f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}f.exports=function(f){return null!=f&&(v(f)||function(f){return"function"===typeof f.readFloatLE&&"function"===typeof f.slice&&v(f.slice(0,0))}(f)||!!f._isBuffer)}},12523:(f,v,Z)=>{var V=Z(12526),h=Z(12535),J="undefined"!==typeof Float64Array;function l(f,v){return f[0]-v[0]}function e(){var f,v=this.stride,Z=new Array(v.length);for(f=0;f<Z.length;++f)Z[f]=[Math.abs(v[f]),f];Z.sort(l);var V=new Array(Z.length);for(f=0;f<V.length;++f)V[f]=Z[f][1];return V}function C(f,v){var Z=["View",v,"d",f].join("");v<0&&(Z="View_Nil"+f);var h="generic"===f;if(-1===v){var J="function "+Z+"(a){this.data=a;};var proto="+Z+".prototype;proto.dtype='"+f+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Z+"(a){return new "+Z+"(a);}";return new Function(J)()}if(0===v){J="function "+Z+"(a,d) {this.data = a;this.offset = d};var proto="+Z+".prototype;proto.dtype='"+f+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Z+"_copy() {return new "+Z+"(this.data,this.offset)};proto.pick=function "+Z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Z+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Z+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Z+"(a,b,c,d){return new "+Z+"(a,d)}";return new Function("TrivialArray",J)(H[f][0])}J=["'use strict'"];var l=V(v),C=l.map((function(f){return"i"+f})),O="this.offset+"+l.map((function(f){return"this.stride["+f+"]*i"+f})).join("+"),u=l.map((function(f){return"b"+f})).join(","),W=l.map((function(f){return"c"+f})).join(",");J.push("function "+Z+"(a,"+u+","+W+",d){this.data=a","this.shape=["+u+"]","this.stride=["+W+"]","this.offset=d|0}","var proto="+Z+".prototype","proto.dtype='"+f+"'","proto.dimension="+v),J.push("Object.defineProperty(proto,'size',{get:function "+Z+"_size(){return "+l.map((function(f){return"this.shape["+f+"]"})).join("*"),"}})"),1===v?J.push("proto.order=[0]"):(J.push("Object.defineProperty(proto,'order',{get:"),v<4?(J.push("function "+Z+"_order(){"),2===v?J.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&J.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):J.push("ORDER})")),J.push("proto.set=function "+Z+"_set("+C.join(",")+",v){"),h?J.push("return this.data.set("+O+",v)}"):J.push("return this.data["+O+"]=v}"),J.push("proto.get=function "+Z+"_get("+C.join(",")+"){"),h?J.push("return this.data.get("+O+")}"):J.push("return this.data["+O+"]}"),J.push("proto.index=function "+Z+"_index(",C.join(),"){return "+O+"}"),J.push("proto.hi=function "+Z+"_hi("+C.join(",")+"){return new "+Z+"(this.data,"+l.map((function(f){return["(typeof i",f,"!=='number'||i",f,"<0)?this.shape[",f,"]:i",f,"|0"].join("")})).join(",")+","+l.map((function(f){return"this.stride["+f+"]"})).join(",")+",this.offset)}");var a=l.map((function(f){return"a"+f+"=this.shape["+f+"]"})),b=l.map((function(f){return"c"+f+"=this.stride["+f+"]"}));J.push("proto.lo=function "+Z+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+b.join(","));for(var X=0;X<v;++X)J.push("if(typeof i"+X+"==='number'&&i"+X+">=0){d=i"+X+"|0;b+=c"+X+"*d;a"+X+"-=d}");J.push("return new "+Z+"(this.data,"+l.map((function(f){return"a"+f})).join(",")+","+l.map((function(f){return"c"+f})).join(",")+",b)}"),J.push("proto.step=function "+Z+"_step("+C.join(",")+"){var "+l.map((function(f){return"a"+f+"=this.shape["+f+"]"})).join(",")+","+l.map((function(f){return"b"+f+"=this.stride["+f+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(X=0;X<v;++X)J.push("if(typeof i"+X+"==='number'){d=i"+X+"|0;if(d<0){c+=b"+X+"*(a"+X+"-1);a"+X+"=ceil(-a"+X+"/d)}else{a"+X+"=ceil(a"+X+"/d)}b"+X+"*=d}");J.push("return new "+Z+"(this.data,"+l.map((function(f){return"a"+f})).join(",")+","+l.map((function(f){return"b"+f})).join(",")+",c)}");var F=new Array(v),U=new Array(v);for(X=0;X<v;++X)F[X]="a[i"+X+"]",U[X]="b[i"+X+"]";J.push("proto.transpose=function "+Z+"_transpose("+C+"){"+C.map((function(f,v){return f+"=("+f+"===undefined?"+v+":"+f+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Z+"(this.data,"+F.join(",")+","+U.join(",")+",this.offset)}"),J.push("proto.pick=function "+Z+"_pick("+C+"){var a=[],b=[],c=this.offset");for(X=0;X<v;++X)J.push("if(typeof i"+X+"==='number'&&i"+X+">=0){c=(c+this.stride["+X+"]*i"+X+")|0}else{a.push(this.shape["+X+"]);b.push(this.stride["+X+"])}");return J.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),J.push("return function construct_"+Z+"(data,shape,stride,offset){return new "+Z+"(data,"+l.map((function(f){return"shape["+f+"]"})).join(",")+","+l.map((function(f){return"stride["+f+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",J.join("\n"))(H[f],e)}var H={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};f.exports=function(f,v,Z,V){if(void 0===f)return(0,H.array[0])([]);"number"===typeof f&&(f=[f]),void 0===v&&(v=[f.length]);var l=v.length;if(void 0===Z){Z=new Array(l);for(var e=l-1,O=1;e>=0;--e)Z[e]=O,O*=v[e]}if(void 0===V){V=0;for(e=0;e<l;++e)Z[e]<0&&(V-=(v[e]-1)*Z[e])}for(var u=function(f){if(h(f))return"buffer";if(J)switch(Object.prototype.toString.call(f)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(f)?"array":"generic"}(f),W=H[u];W.length<=l+1;)W.push(C(u,W.length-1));return(0,W[l+1])(f,v,Z,V)}},13475:f=>{var v;self,v=()=>(()=>{"use strict";var f={d:(v,Z)=>{for(var V in Z)f.o(Z,V)&&!f.o(v,V)&&Object.defineProperty(v,V,{enumerable:!0,get:Z[V]})},o:(f,v)=>Object.prototype.hasOwnProperty.call(f,v)},v={};f.d(v,{default:()=>w});var Z,V=function(f,v){var Z=v.x-f.x,V=v.y-f.y;return Math.sqrt(Z*Z+V*V)},h=function(f){return f*(Math.PI/180)},J=new Map,l=function(f){J.has(f)&&clearTimeout(J.get(f)),J.set(f,setTimeout(f,100))},e=function(f,v,Z){for(var V,h=v.split(/[ ,]+/g),J=0;J<h.length;J+=1)V=h[J],f.addEventListener?f.addEventListener(V,Z,!1):f.attachEvent&&f.attachEvent(V,Z)},C=function(f,v,Z){for(var V,h=v.split(/[ ,]+/g),J=0;J<h.length;J+=1)V=h[J],f.removeEventListener?f.removeEventListener(V,Z):f.detachEvent&&f.detachEvent(V,Z)},H=function(f){return f.preventDefault(),f.type.match(/^touch/)?f.changedTouches:f},O=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(f,v){v.top||v.right||v.bottom||v.left?(f.style.top=v.top,f.style.right=v.right,f.style.bottom=v.bottom,f.style.left=v.left):(f.style.left=v.x+"px",f.style.top=v.y+"px")},W=function(f,v,Z){var V=a(f);for(var h in V)if(V.hasOwnProperty(h))if("string"==typeof v)V[h]=v+" "+Z;else{for(var J="",l=0,e=v.length;l<e;l+=1)J+=v[l]+" "+Z+", ";V[h]=J.slice(0,-2)}return V},a=function(f){var v={};return v[f]="",["webkit","Moz","o"].forEach((function(Z){v[Z+f.charAt(0).toUpperCase()+f.slice(1)]=""})),v},b=function(f,v){for(var Z in v)v.hasOwnProperty(Z)&&(f[Z]=v[Z]);return f},X=function(f,v){if(f.length)for(var Z=0,V=f.length;Z<V;Z+=1)v(f[Z]);else v(f)},F="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,K=!!("ontouchstart"in window),M=!!window.PointerEvent,A=!!window.MSPointerEvent,s={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},z={start:"mousedown",move:"mousemove",end:"mouseup"},Y={};function y(){}F&&!U?Z=s:M?Z={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:A?Z={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:K?(Z=s,Y=z):Z=z,y.prototype.on=function(f,v){var Z,V=this,h=f.split(/[ ,]+/g);V._handlers_=V._handlers_||{};for(var J=0;J<h.length;J+=1)Z=h[J],V._handlers_[Z]=V._handlers_[Z]||[],V._handlers_[Z].push(v);return V},y.prototype.off=function(f,v){var Z=this;return Z._handlers_=Z._handlers_||{},void 0===f?Z._handlers_={}:void 0===v?Z._handlers_[f]=null:Z._handlers_[f]&&Z._handlers_[f].indexOf(v)>=0&&Z._handlers_[f].splice(Z._handlers_[f].indexOf(v),1),Z},y.prototype.trigger=function(f,v){var Z,V=this,h=f.split(/[ ,]+/g);V._handlers_=V._handlers_||{};for(var J=0;J<h.length;J+=1)Z=h[J],V._handlers_[Z]&&V._handlers_[Z].length&&V._handlers_[Z].forEach((function(f){f.call(V,{type:Z,target:V},v)}))},y.prototype.config=function(f){var v=this;v.options=v.defaults||{},f&&(v.options=function(f,v){var Z={};for(var V in f)f.hasOwnProperty(V)&&v.hasOwnProperty(V)?Z[V]=v[V]:f.hasOwnProperty(V)&&(Z[V]=f[V]);return Z}(v.options,f))},y.prototype.bindEvt=function(f,v){var V=this;return V._domHandlers_=V._domHandlers_||{},V._domHandlers_[v]=function(){"function"==typeof V["on"+v]?V["on"+v].apply(V,arguments):console.warn('[WARNING] : Missing "on'+v+'" handler.')},e(f,Z[v],V._domHandlers_[v]),Y[v]&&e(f,Y[v],V._domHandlers_[v]),V},y.prototype.unbindEvt=function(f,v){var V=this;return V._domHandlers_=V._domHandlers_||{},C(f,Z[v],V._domHandlers_[v]),Y[v]&&C(f,Y[v],V._domHandlers_[v]),delete V._domHandlers_[v],this};const N=y;function i(f,v){return this.identifier=v.identifier,this.position=v.position,this.frontPosition=v.frontPosition,this.collection=f,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(v),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=i.id,i.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}i.prototype=new N,i.constructor=i,i.id=0,i.prototype.buildEl=function(f){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},i.prototype.stylize=function(){if(this.options.dataOnly)return this;var f=this.options.fadeTime+"ms",v=function(){var f=a("borderRadius");for(var v in f)f.hasOwnProperty(v)&&(f[v]="50%");return f}(),Z=W("transition","opacity",f),V={};return V.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},V.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},V.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},b(V.el,Z),"circle"===this.options.shape&&b(V.back,v),b(V.front,v),this.applyStyles(V),this},i.prototype.applyStyles=function(f){for(var v in this.ui)if(this.ui.hasOwnProperty(v))for(var Z in f[v])this.ui[v].style[Z]=f[v][Z];return this},i.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},i.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},i.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},i.prototype.show=function(f){var v=this;return v.options.dataOnly||(clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.addToDom(),v.restCallback(),setTimeout((function(){v.ui.el.style.opacity=1}),0),v.showTimeout=setTimeout((function(){v.trigger("shown",v.instance),"function"==typeof f&&f.call(this)}),v.options.fadeTime)),v},i.prototype.hide=function(f){var v=this;if(v.options.dataOnly)return v;if(v.ui.el.style.opacity=v.options.restOpacity,clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.removeTimeout=setTimeout((function(){var Z="dynamic"===v.options.mode?"none":"block";v.ui.el.style.display=Z,"function"==typeof f&&f.call(v),v.trigger("hidden",v.instance)}),v.options.fadeTime),v.options.restJoystick){var Z=v.options.restJoystick,V={};V.x=!0===Z||!1!==Z.x?0:v.instance.frontPosition.x,V.y=!0===Z||!1!==Z.y?0:v.instance.frontPosition.y,v.setPosition(f,V)}return v},i.prototype.setPosition=function(f,v){var Z=this;Z.frontPosition={x:v.x,y:v.y};var V=Z.options.fadeTime+"ms",h={};h.front=W("transition",["transform"],V);var J={front:{}};J.front={transform:"translate("+Z.frontPosition.x+"px,"+Z.frontPosition.y+"px)"},Z.applyStyles(h),Z.applyStyles(J),Z.restTimeout=setTimeout((function(){"function"==typeof f&&f.call(Z),Z.restCallback()}),Z.options.fadeTime)},i.prototype.restCallback=function(){var f=this,v={};v.front=W("transition","none",""),f.applyStyles(v),f.trigger("rested",f.instance)},i.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},i.prototype.computeDirection=function(f){var v,Z,V,h=f.angle.radian,J=Math.PI/4,l=Math.PI/2;if(h>J&&h<3*J&&!f.lockX?v="up":h>-J&&h<=J&&!f.lockY?v="left":h>3*-J&&h<=-J&&!f.lockX?v="down":f.lockY||(v="right"),f.lockY||(Z=h>-l&&h<l?"left":"right"),f.lockX||(V=h>0?"up":"down"),f.force>this.options.threshold){var e,C={};for(e in this.direction)this.direction.hasOwnProperty(e)&&(C[e]=this.direction[e]);var H={};for(e in this.direction={x:Z,y:V,angle:v},f.direction=this.direction,C)C[e]===this.direction[e]&&(H[e]=!0);if(H.x&&H.y&&H.angle)return f;H.x&&H.y||this.trigger("plain",f),H.x||this.trigger("plain:"+Z,f),H.y||this.trigger("plain:"+V,f),H.angle||this.trigger("dir dir:"+v,f)}else this.resetDirection();return f};const I=i;function T(f,v){var Z=this;Z.nipples=[],Z.idles=[],Z.actives=[],Z.ids=[],Z.pressureIntervals={},Z.manager=f,Z.id=T.id,T.id+=1,Z.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Z.config(v),"static"!==Z.options.mode&&"semi"!==Z.options.mode||(Z.options.multitouch=!1),Z.options.multitouch||(Z.options.maxNumberOfNipples=1);var V=getComputedStyle(Z.options.zone.parentElement);return V&&"flex"===V.display&&(Z.parentIsFlex=!0),Z.updateBox(),Z.prepareNipples(),Z.eW(),Z.begin(),Z.nipples}T.prototype=new N,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var f=this,v=f.nipples;v.on=f.on.bind(f),v.off=f.off.bind(f),v.options=f.options,v.destroy=f.destroy.bind(f),v.ids=f.ids,v.id=f.id,v.processOnMove=f.processOnMove.bind(f),v.processOnEnd=f.processOnEnd.bind(f),v.get=function(f){if(void 0===f)return v[0];for(var Z=0,V=v.length;Z<V;Z+=1)if(v[Z].identifier===f)return v[Z];return!1}},T.prototype.eW=function(){var f=this;f.bindEvt(f.options.zone,"start"),f.options.zone.style.touchAction="none",f.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var f=this,v=f.options;if("static"===v.mode){var Z=f.createNipple(v.position,f.manager.getIdentifier());Z.add(),f.idles.push(Z)}},T.prototype.createNipple=function(f,v){var Z=this,V=Z.manager.scroll,h={},J=Z.options,l=Z.parentIsFlex?V.x:V.x+Z.box.left,e=Z.parentIsFlex?V.y:V.y+Z.box.top;if(f.x&&f.y)h={x:f.x-l,y:f.y-e};else if(f.top||f.right||f.bottom||f.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=f.top,C.style.right=f.right,C.style.bottom=f.bottom,C.style.left=f.left,C.style.position="absolute",J.zone.appendChild(C);var H=C.getBoundingClientRect();J.zone.removeChild(C),h=f,f={x:H.left+V.x,y:H.top+V.y}}var O=new I(Z,{color:J.color,size:J.size,threshold:J.threshold,fadeTime:J.fadeTime,dataOnly:J.dataOnly,restJoystick:J.restJoystick,restOpacity:J.restOpacity,mode:J.mode,identifier:v,position:f,zone:J.zone,frontPosition:{x:0,y:0},shape:J.shape});return J.dataOnly||(u(O.ui.el,h),u(O.ui.front,O.frontPosition)),Z.nipples.push(O),Z.trigger("added "+O.identifier+":added",O),Z.manager.trigger("added "+O.identifier+":added",O),Z.bindNipple(O),O},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(f){var v,Z=this,V=function(f,V){v=f.type+" "+V.id+":"+f.type,Z.trigger(v,V)};f.on("destroyed",Z.onDestroyed.bind(Z)),f.on("shown hidden rested dir plain",V),f.on("dir:up dir:right dir:down dir:left",V),f.on("plain:up plain:right plain:down plain:left",V)},T.prototype.pressureFn=function(f,v,Z){var V=this,h=0;clearInterval(V.pressureIntervals[Z]),V.pressureIntervals[Z]=setInterval(function(){var Z=f.force||f.pressure||f.webkitForce||0;Z!==h&&(v.trigger("pressure",Z),V.trigger("pressure "+v.identifier+":pressure",Z),h=Z)}.bind(V),100)},T.prototype.onstart=function(f){var v=this,Z=v.options,V=f;return f=H(f),v.updateBox(),X(f,(function(h){v.actives.length<Z.maxNumberOfNipples?v.processOnStart(h):V.type.match(/^touch/)&&(Object.keys(v.manager.ids).forEach((function(Z){if(Object.values(V.touches).findIndex((function(f){return f.identifier===Z}))<0){var h=[f[0]];h.identifier=Z,v.processOnEnd(h)}})),v.actives.length<Z.maxNumberOfNipples&&v.processOnStart(h))})),v.manager.bindDocument(),!1},T.prototype.processOnStart=function(f){var v,Z=this,h=Z.options,J=Z.manager.getIdentifier(f),l=f.force||f.pressure||f.webkitForce||0,e={x:f.pageX,y:f.pageY},C=Z.getOrCreate(J,e);C.identifier!==J&&Z.manager.removeIdentifier(C.identifier),C.identifier=J;var H=function(v){v.trigger("start",v),Z.trigger("start "+v.id+":start",v),v.show(),l>0&&Z.pressureFn(f,v,v.identifier),Z.processOnMove(f)};if((v=Z.idles.indexOf(C))>=0&&Z.idles.splice(v,1),Z.actives.push(C),Z.ids.push(C.identifier),"semi"!==h.mode)H(C);else{if(!(V(e,C.position)<=h.catchDistance))return C.destroy(),void Z.processOnStart(f);H(C)}return C},T.prototype.getOrCreate=function(f,v){var Z,V=this,h=V.options;return/(semi|static)/.test(h.mode)?(Z=V.idles[0])?(V.idles.splice(0,1),Z):"semi"===h.mode?V.createNipple(v,f):(console.warn("Coudln't find the needed nipple."),!1):Z=V.createNipple(v,f)},T.prototype.processOnMove=function(f){var v=this,Z=v.options,J=v.manager.getIdentifier(f),l=v.nipples.get(J),e=v.manager.scroll;if(function(f){return isNaN(f.buttons)?0!==f.pressure:0!==f.buttons}(f)){if(!l)return console.error("Found zombie joystick with ID "+J),void v.manager.removeIdentifier(J);if(Z.dynamicPage){var C=l.el.getBoundingClientRect();l.position={x:e.x+C.left,y:e.y+C.top}}l.identifier=J;var H=l.options.size/2,O={x:f.pageX,y:f.pageY};Z.lockX&&(O.y=l.position.y),Z.lockY&&(O.x=l.position.x);var u,W,a,b,X,F,U,K,M,A,s=V(O,l.position),z=(u=O,a=(W=l.position).x-u.x,b=W.y-u.y,function(f){return f*(180/Math.PI)}(Math.atan2(b,a))),Y=h(z),y=s/H,N={distance:s,position:O};if("circle"===l.options.shape?(X=Math.min(s,H),U=l.position,K=X,A={x:0,y:0},M=h(M=z),A.x=U.x-K*Math.cos(M),A.y=U.y-K*Math.sin(M),F=A):(F=function(f,v,Z){return{x:Math.min(Math.max(f.x,v.x-Z),v.x+Z),y:Math.min(Math.max(f.y,v.y-Z),v.y+Z)}}(O,l.position,H),X=V(F,l.position)),Z.follow){if(s>H){var i=O.x-F.x,I=O.y-F.y;l.position.x+=i,l.position.y+=I,l.el.style.top=l.position.y-(v.box.top+e.y)+"px",l.el.style.left=l.position.x-(v.box.left+e.x)+"px",s=V(O,l.position)}}else O=F,s=X;var T=O.x-l.position.x,B=O.y-l.position.y;l.frontPosition={x:T,y:B},Z.dataOnly||(l.ui.front.style.transform="translate("+T+"px,"+B+"px)");var P={identifier:l.identifier,position:O,force:y,pressure:f.force||f.pressure||f.webkitForce||0,distance:s,angle:{radian:Y,degree:z},vector:{x:T/H,y:-B/H},raw:N,instance:l,lockX:Z.lockX,lockY:Z.lockY};(P=l.computeDirection(P)).angle={radian:h(180-z),degree:180-z},l.trigger("move",P),v.trigger("move "+l.id+":move",P)}else this.processOnEnd(f)},T.prototype.processOnEnd=function(f){var v=this,Z=v.options,V=v.manager.getIdentifier(f),h=v.nipples.get(V),J=v.manager.removeIdentifier(h.identifier);h&&(Z.dataOnly||h.hide((function(){"dynamic"===Z.mode&&(h.trigger("removed",h),v.trigger("removed "+h.id+":removed",h),v.manager.trigger("removed "+h.id+":removed",h),h.destroy())})),clearInterval(v.pressureIntervals[h.identifier]),h.resetDirection(),h.trigger("end",h),v.trigger("end "+h.id+":end",h),v.ids.indexOf(h.identifier)>=0&&v.ids.splice(v.ids.indexOf(h.identifier),1),v.actives.indexOf(h)>=0&&v.actives.splice(v.actives.indexOf(h),1),/(semi|static)/.test(Z.mode)?v.idles.push(h):v.nipples.indexOf(h)>=0&&v.nipples.splice(v.nipples.indexOf(h),1),v.manager.unbindDocument(),/(semi|static)/.test(Z.mode)&&(v.manager.ids[J.id]=J.identifier))},T.prototype.onDestroyed=function(f,v){var Z=this;Z.nipples.indexOf(v)>=0&&Z.nipples.splice(Z.nipples.indexOf(v),1),Z.actives.indexOf(v)>=0&&Z.actives.splice(Z.actives.indexOf(v),1),Z.idles.indexOf(v)>=0&&Z.idles.splice(Z.idles.indexOf(v),1),Z.ids.indexOf(v.identifier)>=0&&Z.ids.splice(Z.ids.indexOf(v.identifier),1),Z.manager.removeIdentifier(v.identifier),Z.manager.unbindDocument()},T.prototype.destroy=function(){var f=this;for(var v in f.unbindEvt(f.options.zone,"start"),f.nipples.forEach((function(f){f.destroy()})),f.pressureIntervals)f.pressureIntervals.hasOwnProperty(v)&&clearInterval(f.pressureIntervals[v]);f.trigger("destroyed",f.nipples),f.manager.unbindDocument(),f.off()};const B=T;function P(f){var v=this;v.ids={},v.index=0,v.collections=[],v.scroll=O(),v.config(f),v.prepareCollections();var Z=function(){var f;v.collections.forEach((function(Z){Z.forEach((function(Z){f=Z.el.getBoundingClientRect(),Z.position={x:v.scroll.x+f.left,y:v.scroll.y+f.top}}))}))};e(window,"resize",(function(){l(Z)}));var V=function(){v.scroll=O()};return e(window,"scroll",(function(){l(V)})),v.collections}P.prototype=new N,P.constructor=P,P.prototype.prepareCollections=function(){var f=this;f.collections.create=f.create.bind(f),f.collections.on=f.on.bind(f),f.collections.off=f.off.bind(f),f.collections.destroy=f.destroy.bind(f),f.collections.get=function(v){var Z;return f.collections.every((function(f){return!(Z=f.get(v))})),Z}},P.prototype.create=function(f){return this.createCollection(f)},P.prototype.createCollection=function(f){var v=this,Z=new B(v,f);return v.bindCollection(Z),v.collections.push(Z),Z},P.prototype.bindCollection=function(f){var v,Z=this,V=function(f,V){v=f.type+" "+V.id+":"+f.type,Z.trigger(v,V)};f.on("destroyed",Z.onDestroyed.bind(Z)),f.on("shown hidden rested dir plain",V),f.on("dir:up dir:right dir:down dir:left",V),f.on("plain:up plain:right plain:down plain:left",V)},P.prototype.bindDocument=function(){var f=this;f.binded||(f.bindEvt(document,"move").bindEvt(document,"end"),f.binded=!0)},P.prototype.unbindDocument=function(f){var v=this;Object.keys(v.ids).length&&!0!==f||(v.unbindEvt(document,"move").unbindEvt(document,"end"),v.binded=!1)},P.prototype.getIdentifier=function(f){var v;return f?void 0===(v=void 0===f.identifier?f.pointerId:f.identifier)&&(v=this.latest||0):v=this.index,void 0===this.ids[v]&&(this.ids[v]=this.index,this.index+=1),this.latest=v,this.ids[v]},P.prototype.removeIdentifier=function(f){var v={};for(var Z in this.ids)if(this.ids[Z]===f){v.id=Z,v.identifier=this.ids[Z],delete this.ids[Z];break}return v},P.prototype.onmove=function(f){return this.onAny("move",f),!1},P.prototype.onend=function(f){return this.onAny("end",f),!1},P.prototype.oncancel=function(f){return this.onAny("end",f),!1},P.prototype.onAny=function(f,v){var Z,V=this,h="processOn"+f.charAt(0).toUpperCase()+f.slice(1);v=H(v);var J=function(f,v,Z){Z.ids.indexOf(v)>=0&&(Z[h](f),f._found_=!0)};return X(v,(function(f){Z=V.getIdentifier(f),X(V.collections,J.bind(null,f,Z)),f._found_||V.removeIdentifier(Z)})),!1},P.prototype.destroy=function(){var f=this;f.unbindDocument(!0),f.ids={},f.index=0,f.collections.forEach((function(f){f.destroy()})),f.off()},P.prototype.onDestroyed=function(f,v){var Z=this;if(Z.collections.indexOf(v)<0)return!1;Z.collections.splice(Z.collections.indexOf(v),1)};var g=new P;const w={create:function(f){return g.create(f)},factory:g};return v.default})(),f.exports=v()},12553:(f,v,Z)=>{"use strict";const{Deflate:V,deflate:h,deflateRaw:J,gzip:l}=Z(12559),{Inflate:e,inflate:C,inflateRaw:H,ungzip:O}=Z(12613),u=Z(12591);f.exports.Deflate=V,f.exports.deflate=h,f.exports.deflateRaw=J,f.exports.gzip=l,f.exports.Inflate=e,f.exports.inflate=C,f.exports.inflateRaw=H,f.exports.ungzip=O,f.exports.constants=u},12559:(f,v,Z)=>{"use strict";const V=Z(12563),h=Z(12596),J=Z(12603),l=Z(12585),e=Z(12606),C=Object.prototype.toString,{Z_NO_FLUSH:H,Z_SYNC_FLUSH:O,Z_FULL_FLUSH:u,Z_FINISH:W,Z_OK:a,Z_STREAM_END:b,Z_DEFAULT_COMPRESSION:X,Z_DEFAULT_STRATEGY:F,Z_DEFLATED:U}=Z(12591);function K(f){this.options=h.assign({level:X,method:U,qf:16384,windowBits:15,memLevel:8,strategy:F},f||{});let v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.Ov="",this.ended=!1,this.chunks=[],this.strm=new e,this.strm.avail_out=0;let Z=V.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(Z!==a)throw new Error(l[Z]);if(v.header&&V.deflateSetHeader(this.strm,v.header),v.dictionary){let f;if(f="string"===typeof v.dictionary?J.string2buf(v.dictionary):"[object ArrayBuffer]"===C.call(v.dictionary)?new Uint8Array(v.dictionary):v.dictionary,Z=V.deflateSetDictionary(this.strm,f),Z!==a)throw new Error(l[Z]);this._dict_set=!0}}function M(f,v){const Z=new K(v);if(Z.push(f,!0),Z.err)throw Z.Ov||l[Z.err];return Z.result}K.prototype.push=function(f,v){const Z=this.strm,h=this.options.qf;let l,e;if(this.ended)return!1;for(e=v===~~v?v:!0===v?W:H,"string"===typeof f?Z.input=J.string2buf(f):"[object ArrayBuffer]"===C.call(f)?Z.input=new Uint8Array(f):Z.input=f,Z.next_in=0,Z.avail_in=Z.input.length;;)if(0===Z.avail_out&&(Z.output=new Uint8Array(h),Z.next_out=0,Z.avail_out=h),(e===O||e===u)&&Z.avail_out<=6)this.onData(Z.output.subarray(0,Z.next_out)),Z.avail_out=0;else{if(l=V.deflate(Z,e),l===b)return Z.next_out>0&&this.onData(Z.output.subarray(0,Z.next_out)),l=V.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===a;if(0!==Z.avail_out){if(e>0&&Z.next_out>0)this.onData(Z.output.subarray(0,Z.next_out)),Z.avail_out=0;else if(0===Z.avail_in)break}else this.onData(Z.output)}return!0},K.prototype.onData=function(f){this.chunks.push(f)},K.prototype.onEnd=function(f){f===a&&(this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.Ov=this.strm.Ov},f.exports.Deflate=K,f.exports.deflate=M,f.exports.deflateRaw=function(f,v){return(v=v||{}).raw=!0,M(f,v)},f.exports.gzip=function(f,v){return(v=v||{}).gzip=!0,M(f,v)},f.exports.constants=Z(12591)},12613:(f,v,Z)=>{"use strict";const V=Z(12615),h=Z(12596),J=Z(12603),l=Z(12585),e=Z(12606),C=Z(12629),H=Object.prototype.toString,{Z_NO_FLUSH:O,Z_FINISH:u,Z_OK:W,Z_STREAM_END:a,Z_NEED_DICT:b,Z_STREAM_ERROR:X,Z_DATA_ERROR:F,Z_MEM_ERROR:U}=Z(12591);function K(f){this.options=h.assign({qf:65536,windowBits:15,to:""},f||{});const v=this.options;v.raw&&v.windowBits>=0&&v.windowBits<16&&(v.windowBits=-v.windowBits,0===v.windowBits&&(v.windowBits=-15)),!(v.windowBits>=0&&v.windowBits<16)||f&&f.windowBits||(v.windowBits+=32),v.windowBits>15&&v.windowBits<48&&0===(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.Ov="",this.ended=!1,this.chunks=[],this.strm=new e,this.strm.avail_out=0;let Z=V.inflateInit2(this.strm,v.windowBits);if(Z!==W)throw new Error(l[Z]);if(this.header=new C,V.inflateGetHeader(this.strm,this.header),v.dictionary&&("string"===typeof v.dictionary?v.dictionary=J.string2buf(v.dictionary):"[object ArrayBuffer]"===H.call(v.dictionary)&&(v.dictionary=new Uint8Array(v.dictionary)),v.raw&&(Z=V.inflateSetDictionary(this.strm,v.dictionary),Z!==W)))throw new Error(l[Z])}function M(f,v){const Z=new K(v);if(Z.push(f),Z.err)throw Z.Ov||l[Z.err];return Z.result}K.prototype.push=function(f,v){const Z=this.strm,h=this.options.qf,l=this.options.dictionary;let e,C,K;if(this.ended)return!1;for(C=v===~~v?v:!0===v?u:O,"[object ArrayBuffer]"===H.call(f)?Z.input=new Uint8Array(f):Z.input=f,Z.next_in=0,Z.avail_in=Z.input.length;;){for(0===Z.avail_out&&(Z.output=new Uint8Array(h),Z.next_out=0,Z.avail_out=h),e=V.inflate(Z,C),e===b&&l&&(e=V.inflateSetDictionary(Z,l),e===W?e=V.inflate(Z,C):e===F&&(e=b));Z.avail_in>0&&e===a&&Z.state.wrap>0&&0!==f[Z.next_in];)V.inflateReset(Z),e=V.inflate(Z,C);switch(e){case X:case F:case b:case U:return this.onEnd(e),this.ended=!0,!1}if(K=Z.avail_out,Z.next_out&&(0===Z.avail_out||e===a))if("string"===this.options.to){let f=J.utf8border(Z.output,Z.next_out),v=Z.next_out-f,V=J.buf2string(Z.output,f);Z.next_out=v,Z.avail_out=h-v,v&&Z.output.set(Z.output.subarray(f,f+v),0),this.onData(V)}else this.onData(Z.output.length===Z.next_out?Z.output:Z.output.subarray(0,Z.next_out));if(e!==W||0!==K){if(e===a)return e=V.inflateEnd(this.strm),this.onEnd(e),this.ended=!0,!0;if(0===Z.avail_in)break}}return!0},K.prototype.onData=function(f){this.chunks.push(f)},K.prototype.onEnd=function(f){f===W&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.Ov=this.strm.Ov},f.exports.Inflate=K,f.exports.inflate=M,f.exports.inflateRaw=function(f,v){return(v=v||{}).raw=!0,M(f,v)},f.exports.ungzip=M,f.exports.constants=Z(12591)},12596:f=>{"use strict";const v=(f,v)=>Object.prototype.hasOwnProperty.call(f,v);f.exports.assign=function(f){const Z=Array.prototype.slice.call(arguments,1);for(;Z.length;){const V=Z.shift();if(V){if("object"!==typeof V)throw new TypeError(V+"must be non-object");for(const Z in V)v(V,Z)&&(f[Z]=V[Z])}}return f},f.exports.flattenChunks=f=>{let v=0;for(let V=0,h=f.length;V<h;V++)v+=f[V].length;const Z=new Uint8Array(v);for(let V=0,h=0,J=f.length;V<J;V++){let v=f[V];Z.set(v,h),h+=v.length}return Z}},12603:f=>{"use strict";let v=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(V){v=!1}const Z=new Uint8Array(256);for(let h=0;h<256;h++)Z[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;Z[254]=Z[254]=1,f.exports.string2buf=f=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(f);let v,Z,V,h,J,l=f.length,e=0;for(h=0;h<l;h++)Z=f.charCodeAt(h),55296===(64512&Z)&&h+1<l&&(V=f.charCodeAt(h+1),56320===(64512&V)&&(Z=65536+(Z-55296<<10)+(V-56320),h++)),e+=Z<128?1:Z<2048?2:Z<65536?3:4;for(v=new Uint8Array(e),J=0,h=0;J<e;h++)Z=f.charCodeAt(h),55296===(64512&Z)&&h+1<l&&(V=f.charCodeAt(h+1),56320===(64512&V)&&(Z=65536+(Z-55296<<10)+(V-56320),h++)),Z<128?v[J++]=Z:Z<2048?(v[J++]=192|Z>>>6,v[J++]=128|63&Z):Z<65536?(v[J++]=224|Z>>>12,v[J++]=128|Z>>>6&63,v[J++]=128|63&Z):(v[J++]=240|Z>>>18,v[J++]=128|Z>>>12&63,v[J++]=128|Z>>>6&63,v[J++]=128|63&Z);return v};f.exports.buf2string=(f,V)=>{const h=V||f.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(f.subarray(0,V));let J,l;const e=new Array(2*h);for(l=0,J=0;J<h;){let v=f[J++];if(v<128){e[l++]=v;continue}let V=Z[v];if(V>4)e[l++]=65533,J+=V-1;else{for(v&=2===V?31:3===V?15:7;V>1&&J<h;)v=v<<6|63&f[J++],V--;V>1?e[l++]=65533:v<65536?e[l++]=v:(v-=65536,e[l++]=55296|v>>10&1023,e[l++]=56320|1023&v)}}return((f,Z)=>{if(Z<65534&&f.subarray&&v)return String.fromCharCode.apply(null,f.length===Z?f:f.subarray(0,Z));let V="";for(let v=0;v<Z;v++)V+=String.fromCharCode(f[v]);return V})(e,l)},f.exports.utf8border=(f,v)=>{(v=v||f.length)>f.length&&(v=f.length);let V=v-1;for(;V>=0&&128===(192&f[V]);)V--;return V<0||0===V?v:V+Z[f[V]]>v?V:v}},12577:f=>{"use strict";f.exports=(f,v,Z,V)=>{let h=65535&f,J=f>>>16&65535,l=0;for(;0!==Z;){l=Z>2e3?2e3:Z,Z-=l;do{h=h+v[V++]|0,J=J+h|0}while(--l);h%=65521,J%=65521}return h|J<<16}},12591:f=>{"use strict";f.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12579:f=>{"use strict";const v=new Uint32Array((()=>{let f,v=[];for(var Z=0;Z<256;Z++){f=Z;for(var V=0;V<8;V++)f=1&f?3988292384^f>>>1:f>>>1;v[Z]=f}return v})());f.exports=(f,Z,V,h)=>{const J=v,l=h+V;f^=-1;for(let v=h;v<l;v++)f=f>>>8^J[255&(f^Z[v])];return~f}},12563:(f,v,Z)=>{"use strict";const{_tr_init:V,_tr_stored_block:h,_tr_flush_block:J,_tr_tally:l,_tr_align:e}=Z(12570),C=Z(12577),H=Z(12579),O=Z(12585),{Z_NO_FLUSH:u,Z_PARTIAL_FLUSH:W,Z_FULL_FLUSH:a,Z_FINISH:b,Z_BLOCK:X,Z_OK:F,Z_STREAM_END:U,Z_STREAM_ERROR:K,Z_DATA_ERROR:M,Z_BUF_ERROR:A,Z_DEFAULT_COMPRESSION:s,Z_FILTERED:z,Z_HUFFMAN_ONLY:Y,Z_RLE:y,Z_FIXED:N,Z_DEFAULT_STRATEGY:i,Z_UNKNOWN:I,Z_DEFLATED:T}=Z(12591),B=258,P=262,g=103,w=113,t=666,L=(f,v)=>(f.Ov=O[v],v),E=f=>(f<<1)-(f>4?9:0),j=f=>{let v=f.length;for(;--v>=0;)f[v]=0};let q=(f,v,Z)=>(v<<f.hash_shift^Z)&f.hash_mask;const c=f=>{const v=f.state;let Z=v.pending;Z>f.avail_out&&(Z=f.avail_out),0!==Z&&(f.output.set(v.pending_buf.subarray(v.pending_out,v.pending_out+Z),f.next_out),f.next_out+=Z,v.pending_out+=Z,f.total_out+=Z,f.avail_out-=Z,v.pending-=Z,0===v.pending&&(v.pending_out=0))},m=(f,v)=>{J(f,f.block_start>=0?f.block_start:-1,f.strstart-f.block_start,v),f.block_start=f.strstart,c(f.strm)},p=(f,v)=>{f.pending_buf[f.pending++]=v},k=(f,v)=>{f.pending_buf[f.pending++]=v>>>8&255,f.pending_buf[f.pending++]=255&v},r=(f,v,Z,V)=>{let h=f.avail_in;return h>V&&(h=V),0===h?0:(f.avail_in-=h,v.set(f.input.subarray(f.next_in,f.next_in+h),Z),1===f.state.wrap?f.adler=C(f.adler,v,h,Z):2===f.state.wrap&&(f.adler=H(f.adler,v,h,Z)),f.next_in+=h,f.total_in+=h,h)},o=(f,v)=>{let Z,V,h=f.max_chain_length,J=f.strstart,l=f.prev_length,e=f.nice_match;const C=f.strstart>f.w_size-P?f.strstart-(f.w_size-P):0,H=f.window,O=f.w_mask,u=f.prev,W=f.strstart+B;let a=H[J+l-1],b=H[J+l];f.prev_length>=f.good_match&&(h>>=2),e>f.lookahead&&(e=f.lookahead);do{if(Z=v,H[Z+l]===b&&H[Z+l-1]===a&&H[Z]===H[J]&&H[++Z]===H[J+1]){J+=2,Z++;do{}while(H[++J]===H[++Z]&&H[++J]===H[++Z]&&H[++J]===H[++Z]&&H[++J]===H[++Z]&&H[++J]===H[++Z]&&H[++J]===H[++Z]&&H[++J]===H[++Z]&&H[++J]===H[++Z]&&J<W);if(V=B-(W-J),J=W-B,V>l){if(f.match_start=v,l=V,V>=e)break;a=H[J+l-1],b=H[J+l]}}}while((v=u[v&O])>C&&0!==--h);return l<=f.lookahead?l:f.lookahead},G=f=>{const v=f.w_size;let Z,V,h,J,l;do{if(J=f.window_size-f.lookahead-f.strstart,f.strstart>=v+(v-P)){f.window.set(f.window.subarray(v,v+v),0),f.match_start-=v,f.strstart-=v,f.block_start-=v,V=f.hash_size,Z=V;do{h=f.head[--Z],f.head[Z]=h>=v?h-v:0}while(--V);V=v,Z=V;do{h=f.prev[--Z],f.prev[Z]=h>=v?h-v:0}while(--V);J+=v}if(0===f.strm.avail_in)break;if(V=r(f.strm,f.window,f.strstart+f.lookahead,J),f.lookahead+=V,f.lookahead+f.insert>=3)for(l=f.strstart-f.insert,f.ins_h=f.window[l],f.ins_h=q(f,f.ins_h,f.window[l+1]);f.insert&&(f.ins_h=q(f,f.ins_h,f.window[l+3-1]),f.prev[l&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=l,l++,f.insert--,!(f.lookahead+f.insert<3)););}while(f.lookahead<P&&0!==f.strm.avail_in)},Q=(f,v)=>{let Z,V;for(;;){if(f.lookahead<P){if(G(f),f.lookahead<P&&v===u)return 1;if(0===f.lookahead)break}if(Z=0,f.lookahead>=3&&(f.ins_h=q(f,f.ins_h,f.window[f.strstart+3-1]),Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),0!==Z&&f.strstart-Z<=f.w_size-P&&(f.match_length=o(f,Z)),f.match_length>=3)if(V=l(f,f.strstart-f.match_start,f.match_length-3),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=3){f.match_length--;do{f.strstart++,f.ins_h=q(f,f.ins_h,f.window[f.strstart+3-1]),Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart}while(0!==--f.match_length);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=q(f,f.ins_h,f.window[f.strstart+1]);else V=l(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(V&&(m(f,!1),0===f.strm.avail_out))return 1}return f.insert=f.strstart<2?f.strstart:2,v===b?(m(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(m(f,!1),0===f.strm.avail_out)?1:2},d=(f,v)=>{let Z,V,h;for(;;){if(f.lookahead<P){if(G(f),f.lookahead<P&&v===u)return 1;if(0===f.lookahead)break}if(Z=0,f.lookahead>=3&&(f.ins_h=q(f,f.ins_h,f.window[f.strstart+3-1]),Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=2,0!==Z&&f.prev_length<f.max_lazy_match&&f.strstart-Z<=f.w_size-P&&(f.match_length=o(f,Z),f.match_length<=5&&(f.strategy===z||3===f.match_length&&f.strstart-f.match_start>4096)&&(f.match_length=2)),f.prev_length>=3&&f.match_length<=f.prev_length){h=f.strstart+f.lookahead-3,V=l(f,f.strstart-1-f.prev_match,f.prev_length-3),f.lookahead-=f.prev_length-1,f.prev_length-=2;do{++f.strstart<=h&&(f.ins_h=q(f,f.ins_h,f.window[f.strstart+3-1]),Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart)}while(0!==--f.prev_length);if(f.match_available=0,f.match_length=2,f.strstart++,V&&(m(f,!1),0===f.strm.avail_out))return 1}else if(f.match_available){if(V=l(f,0,f.window[f.strstart-1]),V&&m(f,!1),f.strstart++,f.lookahead--,0===f.strm.avail_out)return 1}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(V=l(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<2?f.strstart:2,v===b?(m(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(m(f,!1),0===f.strm.avail_out)?1:2};function x(f,v,Z,V,h){this.good_length=f,this.max_lazy=v,this.nice_length=Z,this.max_chain=V,this.func=h}const R=[new x(0,0,0,0,((f,v)=>{let Z=65535;for(Z>f.pending_buf_size-5&&(Z=f.pending_buf_size-5);;){if(f.lookahead<=1){if(G(f),0===f.lookahead&&v===u)return 1;if(0===f.lookahead)break}f.strstart+=f.lookahead,f.lookahead=0;const V=f.block_start+Z;if((0===f.strstart||f.strstart>=V)&&(f.lookahead=f.strstart-V,f.strstart=V,m(f,!1),0===f.strm.avail_out))return 1;if(f.strstart-f.block_start>=f.w_size-P&&(m(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,v===b?(m(f,!0),0===f.strm.avail_out?3:4):(f.strstart>f.block_start&&(m(f,!1),f.strm.avail_out),1)})),new x(4,4,8,4,Q),new x(4,5,16,8,Q),new x(4,6,32,32,Q),new x(4,4,16,16,d),new x(8,16,32,32,d),new x(8,16,128,128,d),new x(8,32,128,256,d),new x(32,128,258,1024,d),new x(32,258,258,4096,d)];function n(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),j(this.dyn_ltree),j(this.dyn_dtree),j(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),j(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),j(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const S=f=>{if(!f||!f.state)return L(f,K);f.total_in=f.total_out=0,f.data_type=I;const v=f.state;return v.pending=0,v.pending_out=0,v.wrap<0&&(v.wrap=-v.wrap),v.status=v.wrap?42:w,f.adler=2===v.wrap?0:1,v.last_flush=u,V(v),F},D=f=>{const v=S(f);var Z;return v===F&&((Z=f.state).window_size=2*Z.w_size,j(Z.head),Z.max_lazy_match=R[Z.level].max_lazy,Z.good_match=R[Z.level].good_length,Z.nice_match=R[Z.level].nice_length,Z.max_chain_length=R[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=2,Z.match_available=0,Z.ins_h=0),v},ff=(f,v,Z,V,h,J)=>{if(!f)return K;let l=1;if(v===s&&(v=6),V<0?(l=0,V=-V):V>15&&(l=2,V-=16),h<1||h>9||Z!==T||V<8||V>15||v<0||v>9||J<0||J>N)return L(f,K);8===V&&(V=9);const e=new n;return f.state=e,e.strm=f,e.wrap=l,e.gzhead=null,e.w_bits=V,e.w_size=1<<e.w_bits,e.w_mask=e.w_size-1,e.hash_bits=h+7,e.hash_size=1<<e.hash_bits,e.hash_mask=e.hash_size-1,e.hash_shift=~~((e.hash_bits+3-1)/3),e.window=new Uint8Array(2*e.w_size),e.head=new Uint16Array(e.hash_size),e.prev=new Uint16Array(e.w_size),e.lit_bufsize=1<<h+6,e.pending_buf_size=4*e.lit_bufsize,e.pending_buf=new Uint8Array(e.pending_buf_size),e.d_buf=1*e.lit_bufsize,e.l_buf=3*e.lit_bufsize,e.level=v,e.strategy=J,e.method=Z,D(f)};f.exports.deflateInit=(f,v)=>ff(f,v,T,15,8,i),f.exports.deflateInit2=ff,f.exports.deflateReset=D,f.exports.deflateResetKeep=S,f.exports.deflateSetHeader=(f,v)=>f&&f.state?2!==f.state.wrap?K:(f.state.gzhead=v,F):K,f.exports.deflate=(f,v)=>{let Z,V;if(!f||!f.state||v>X||v<0)return f?L(f,K):K;const J=f.state;if(!f.output||!f.input&&0!==f.avail_in||J.status===t&&v!==b)return L(f,0===f.avail_out?A:K);J.strm=f;const C=J.last_flush;if(J.last_flush=v,42===J.status)if(2===J.wrap)f.adler=0,p(J,31),p(J,139),p(J,8),J.gzhead?(p(J,(J.gzhead.text?1:0)+(J.gzhead.hcrc?2:0)+(J.gzhead.extra?4:0)+(J.gzhead.name?8:0)+(J.gzhead.comment?16:0)),p(J,255&J.gzhead.time),p(J,J.gzhead.time>>8&255),p(J,J.gzhead.time>>16&255),p(J,J.gzhead.time>>24&255),p(J,9===J.level?2:J.strategy>=Y||J.level<2?4:0),p(J,255&J.gzhead.os),J.gzhead.extra&&J.gzhead.extra.length&&(p(J,255&J.gzhead.extra.length),p(J,J.gzhead.extra.length>>8&255)),J.gzhead.hcrc&&(f.adler=H(f.adler,J.pending_buf,J.pending,0)),J.gzindex=0,J.status=69):(p(J,0),p(J,0),p(J,0),p(J,0),p(J,0),p(J,9===J.level?2:J.strategy>=Y||J.level<2?4:0),p(J,3),J.status=w);else{let v=T+(J.w_bits-8<<4)<<8,Z=-1;Z=J.strategy>=Y||J.level<2?0:J.level<6?1:6===J.level?2:3,v|=Z<<6,0!==J.strstart&&(v|=32),v+=31-v%31,J.status=w,k(J,v),0!==J.strstart&&(k(J,f.adler>>>16),k(J,65535&f.adler)),f.adler=1}if(69===J.status)if(J.gzhead.extra){for(Z=J.pending;J.gzindex<(65535&J.gzhead.extra.length)&&(J.pending!==J.pending_buf_size||(J.gzhead.hcrc&&J.pending>Z&&(f.adler=H(f.adler,J.pending_buf,J.pending-Z,Z)),c(f),Z=J.pending,J.pending!==J.pending_buf_size));)p(J,255&J.gzhead.extra[J.gzindex]),J.gzindex++;J.gzhead.hcrc&&J.pending>Z&&(f.adler=H(f.adler,J.pending_buf,J.pending-Z,Z)),J.gzindex===J.gzhead.extra.length&&(J.gzindex=0,J.status=73)}else J.status=73;if(73===J.status)if(J.gzhead.name){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(f.adler=H(f.adler,J.pending_buf,J.pending-Z,Z)),c(f),Z=J.pending,J.pending===J.pending_buf_size)){V=1;break}V=J.gzindex<J.gzhead.name.length?255&J.gzhead.name.charCodeAt(J.gzindex++):0,p(J,V)}while(0!==V);J.gzhead.hcrc&&J.pending>Z&&(f.adler=H(f.adler,J.pending_buf,J.pending-Z,Z)),0===V&&(J.gzindex=0,J.status=91)}else J.status=91;if(91===J.status)if(J.gzhead.comment){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(f.adler=H(f.adler,J.pending_buf,J.pending-Z,Z)),c(f),Z=J.pending,J.pending===J.pending_buf_size)){V=1;break}V=J.gzindex<J.gzhead.comment.length?255&J.gzhead.comment.charCodeAt(J.gzindex++):0,p(J,V)}while(0!==V);J.gzhead.hcrc&&J.pending>Z&&(f.adler=H(f.adler,J.pending_buf,J.pending-Z,Z)),0===V&&(J.status=g)}else J.status=g;if(J.status===g&&(J.gzhead.hcrc?(J.pending+2>J.pending_buf_size&&c(f),J.pending+2<=J.pending_buf_size&&(p(J,255&f.adler),p(J,f.adler>>8&255),f.adler=0,J.status=w)):J.status=w),0!==J.pending){if(c(f),0===f.avail_out)return J.last_flush=-1,F}else if(0===f.avail_in&&E(v)<=E(C)&&v!==b)return L(f,A);if(J.status===t&&0!==f.avail_in)return L(f,A);if(0!==f.avail_in||0!==J.lookahead||v!==u&&J.status!==t){let Z=J.strategy===Y?((f,v)=>{let Z;for(;;){if(0===f.lookahead&&(G(f),0===f.lookahead)){if(v===u)return 1;break}if(f.match_length=0,Z=l(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++,Z&&(m(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,v===b?(m(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(m(f,!1),0===f.strm.avail_out)?1:2})(J,v):J.strategy===y?((f,v)=>{let Z,V,h,J;const e=f.window;for(;;){if(f.lookahead<=B){if(G(f),f.lookahead<=B&&v===u)return 1;if(0===f.lookahead)break}if(f.match_length=0,f.lookahead>=3&&f.strstart>0&&(h=f.strstart-1,V=e[h],V===e[++h]&&V===e[++h]&&V===e[++h])){J=f.strstart+B;do{}while(V===e[++h]&&V===e[++h]&&V===e[++h]&&V===e[++h]&&V===e[++h]&&V===e[++h]&&V===e[++h]&&V===e[++h]&&h<J);f.match_length=B-(J-h),f.match_length>f.lookahead&&(f.match_length=f.lookahead)}if(f.match_length>=3?(Z=l(f,1,f.match_length-3),f.lookahead-=f.match_length,f.strstart+=f.match_length,f.match_length=0):(Z=l(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++),Z&&(m(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,v===b?(m(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(m(f,!1),0===f.strm.avail_out)?1:2})(J,v):R[J.level].func(J,v);if(3!==Z&&4!==Z||(J.status=t),1===Z||3===Z)return 0===f.avail_out&&(J.last_flush=-1),F;if(2===Z&&(v===W?e(J):v!==X&&(h(J,0,0,!1),v===a&&(j(J.head),0===J.lookahead&&(J.strstart=0,J.block_start=0,J.insert=0))),c(f),0===f.avail_out))return J.last_flush=-1,F}return v!==b?F:J.wrap<=0?U:(2===J.wrap?(p(J,255&f.adler),p(J,f.adler>>8&255),p(J,f.adler>>16&255),p(J,f.adler>>24&255),p(J,255&f.total_in),p(J,f.total_in>>8&255),p(J,f.total_in>>16&255),p(J,f.total_in>>24&255)):(k(J,f.adler>>>16),k(J,65535&f.adler)),c(f),J.wrap>0&&(J.wrap=-J.wrap),0!==J.pending?F:U)},f.exports.deflateEnd=f=>{if(!f||!f.state)return K;const v=f.state.status;return 42!==v&&69!==v&&73!==v&&91!==v&&v!==g&&v!==w&&v!==t?L(f,K):(f.state=null,v===w?L(f,M):F)},f.exports.deflateSetDictionary=(f,v)=>{let Z=v.length;if(!f||!f.state)return K;const V=f.state,h=V.wrap;if(2===h||1===h&&42!==V.status||V.lookahead)return K;if(1===h&&(f.adler=C(f.adler,v,Z,0)),V.wrap=0,Z>=V.w_size){0===h&&(j(V.head),V.strstart=0,V.block_start=0,V.insert=0);let f=new Uint8Array(V.w_size);f.set(v.subarray(Z-V.w_size,Z),0),v=f,Z=V.w_size}const J=f.avail_in,l=f.next_in,e=f.input;for(f.avail_in=Z,f.next_in=0,f.input=v,G(V);V.lookahead>=3;){let f=V.strstart,v=V.lookahead-2;do{V.ins_h=q(V,V.ins_h,V.window[f+3-1]),V.prev[f&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=f,f++}while(--v);V.strstart=f,V.lookahead=2,G(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=2,V.match_available=0,f.next_in=l,f.input=e,f.avail_in=J,V.wrap=h,F},f.exports.deflateInfo="pako deflate (from Nodeca project)"},12629:f=>{"use strict";f.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12618:f=>{"use strict";f.exports=function(f,v){let Z,V,h,J,l,e,C,H,O,u,W,a,b,X,F,U,K,M,A,s,z,Y,y,N;const i=f.state;Z=f.next_in,y=f.input,V=Z+(f.avail_in-5),h=f.next_out,N=f.output,J=h-(v-f.avail_out),l=h+(f.avail_out-257),e=i.dmax,C=i.wsize,H=i.whave,O=i.wnext,u=i.window,W=i.hold,a=i.bits,b=i.lencode,X=i.distcode,F=(1<<i.lenbits)-1,U=(1<<i.distbits)-1;f:do{a<15&&(W+=y[Z++]<<a,a+=8,W+=y[Z++]<<a,a+=8),K=b[W&F];v:for(;;){if(M=K>>>24,W>>>=M,a-=M,M=K>>>16&255,0===M)N[h++]=65535&K;else{if(!(16&M)){if(0===(64&M)){K=b[(65535&K)+(W&(1<<M)-1)];continue v}if(32&M){i.mode=12;break f}f.Ov="invalid literal/length code",i.mode=30;break f}A=65535&K,M&=15,M&&(a<M&&(W+=y[Z++]<<a,a+=8),A+=W&(1<<M)-1,W>>>=M,a-=M),a<15&&(W+=y[Z++]<<a,a+=8,W+=y[Z++]<<a,a+=8),K=X[W&U];Z:for(;;){if(M=K>>>24,W>>>=M,a-=M,M=K>>>16&255,!(16&M)){if(0===(64&M)){K=X[(65535&K)+(W&(1<<M)-1)];continue Z}f.Ov="invalid distance code",i.mode=30;break f}if(s=65535&K,M&=15,a<M&&(W+=y[Z++]<<a,a+=8,a<M&&(W+=y[Z++]<<a,a+=8)),s+=W&(1<<M)-1,s>e){f.Ov="invalid distance too far back",i.mode=30;break f}if(W>>>=M,a-=M,M=h-J,s>M){if(M=s-M,M>H&&i.sane){f.Ov="invalid distance too far back",i.mode=30;break f}if(z=0,Y=u,0===O){if(z+=C-M,M<A){A-=M;do{N[h++]=u[z++]}while(--M);z=h-s,Y=N}}else if(O<M){if(z+=C+O-M,M-=O,M<A){A-=M;do{N[h++]=u[z++]}while(--M);if(z=0,O<A){M=O,A-=M;do{N[h++]=u[z++]}while(--M);z=h-s,Y=N}}}else if(z+=O-M,M<A){A-=M;do{N[h++]=u[z++]}while(--M);z=h-s,Y=N}for(;A>2;)N[h++]=Y[z++],N[h++]=Y[z++],N[h++]=Y[z++],A-=3;A&&(N[h++]=Y[z++],A>1&&(N[h++]=Y[z++]))}else{z=h-s;do{N[h++]=N[z++],N[h++]=N[z++],N[h++]=N[z++],A-=3}while(A>2);A&&(N[h++]=N[z++],A>1&&(N[h++]=N[z++]))}break}}break}}while(Z<V&&h<l);A=a>>3,Z-=A,a-=A<<3,W&=(1<<a)-1,f.next_in=Z,f.next_out=h,f.avail_in=Z<V?V-Z+5:5-(Z-V),f.avail_out=h<l?l-h+257:257-(h-l),i.hold=W,i.bits=a}},12615:(f,v,Z)=>{"use strict";const V=Z(12577),h=Z(12579),J=Z(12618),l=Z(12620),{Z_FINISH:e,Z_BLOCK:C,Z_TREES:H,Z_OK:O,Z_STREAM_END:u,Z_NEED_DICT:W,Z_STREAM_ERROR:a,Z_DATA_ERROR:b,Z_MEM_ERROR:X,Z_BUF_ERROR:F,Z_DEFLATED:U}=Z(12591),K=12,M=30,A=f=>(f>>>24&255)+(f>>>8&65280)+((65280&f)<<8)+((255&f)<<24);function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z=f=>{if(!f||!f.state)return a;const v=f.state;return f.total_in=f.total_out=v.total=0,f.Ov="",v.wrap&&(f.adler=1&v.wrap),v.mode=1,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new Int32Array(852),v.distcode=v.distdyn=new Int32Array(592),v.sane=1,v.back=-1,O},Y=f=>{if(!f||!f.state)return a;const v=f.state;return v.wsize=0,v.whave=0,v.wnext=0,z(f)},y=(f,v)=>{let Z;if(!f||!f.state)return a;const V=f.state;return v<0?(Z=0,v=-v):(Z=1+(v>>4),v<48&&(v&=15)),v&&(v<8||v>15)?a:(null!==V.window&&V.wbits!==v&&(V.window=null),V.wrap=Z,V.wbits=v,Y(f))},N=(f,v)=>{if(!f)return a;const Z=new s;f.state=Z,Z.window=null;const V=y(f,v);return V!==O&&(f.state=null),V};let i,I,T=!0;const B=f=>{if(T){i=new Int32Array(512),I=new Int32Array(32);let v=0;for(;v<144;)f.lens[v++]=8;for(;v<256;)f.lens[v++]=9;for(;v<280;)f.lens[v++]=7;for(;v<288;)f.lens[v++]=8;for(l(1,f.lens,0,288,i,0,f.work,{bits:9}),v=0;v<32;)f.lens[v++]=5;l(2,f.lens,0,32,I,0,f.work,{bits:5}),T=!1}f.lencode=i,f.lenbits=9,f.distcode=I,f.distbits=5},P=(f,v,Z,V)=>{let h;const J=f.state;return null===J.window&&(J.wsize=1<<J.wbits,J.wnext=0,J.whave=0,J.window=new Uint8Array(J.wsize)),V>=J.wsize?(J.window.set(v.subarray(Z-J.wsize,Z),0),J.wnext=0,J.whave=J.wsize):(h=J.wsize-J.wnext,h>V&&(h=V),J.window.set(v.subarray(Z-V,Z-V+h),J.wnext),(V-=h)?(J.window.set(v.subarray(Z-V,Z),0),J.wnext=V,J.whave=J.wsize):(J.wnext+=h,J.wnext===J.wsize&&(J.wnext=0),J.whave<J.wsize&&(J.whave+=h))),0};f.exports.inflateReset=Y,f.exports.inflateReset2=y,f.exports.inflateResetKeep=z,f.exports.inflateInit=f=>N(f,15),f.exports.inflateInit2=N,f.exports.inflate=(f,v)=>{let Z,s,z,Y,y,N,i,I,T,g,w,t,L,E,j,q,c,m,p,k,r,o,G=0;const Q=new Uint8Array(4);let d,x;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!f||!f.state||!f.output||!f.input&&0!==f.avail_in)return a;Z=f.state,Z.mode===K&&(Z.mode=13),y=f.next_out,z=f.output,i=f.avail_out,Y=f.next_in,s=f.input,N=f.avail_in,I=Z.hold,T=Z.bits,g=N,w=i,o=O;f:for(;;)switch(Z.mode){case 1:if(0===Z.wrap){Z.mode=13;break}for(;T<16;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(2&Z.wrap&&35615===I){Z.check=0,Q[0]=255&I,Q[1]=I>>>8&255,Z.check=h(Z.check,Q,2,0),I=0,T=0,Z.mode=2;break}if(Z.flags=0,Z.head&&(Z.head.done=!1),!(1&Z.wrap)||(((255&I)<<8)+(I>>8))%31){f.Ov="incorrect header check",Z.mode=M;break}if((15&I)!==U){f.Ov="unknown compression method",Z.mode=M;break}if(I>>>=4,T-=4,r=8+(15&I),0===Z.wbits)Z.wbits=r;else if(r>Z.wbits){f.Ov="invalid window size",Z.mode=M;break}Z.dmax=1<<Z.wbits,f.adler=Z.check=1,Z.mode=512&I?10:K,I=0,T=0;break;case 2:for(;T<16;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(Z.flags=I,(255&Z.flags)!==U){f.Ov="unknown compression method",Z.mode=M;break}if(57344&Z.flags){f.Ov="unknown header flags set",Z.mode=M;break}Z.head&&(Z.head.text=I>>8&1),512&Z.flags&&(Q[0]=255&I,Q[1]=I>>>8&255,Z.check=h(Z.check,Q,2,0)),I=0,T=0,Z.mode=3;case 3:for(;T<32;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}Z.head&&(Z.head.time=I),512&Z.flags&&(Q[0]=255&I,Q[1]=I>>>8&255,Q[2]=I>>>16&255,Q[3]=I>>>24&255,Z.check=h(Z.check,Q,4,0)),I=0,T=0,Z.mode=4;case 4:for(;T<16;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}Z.head&&(Z.head.xflags=255&I,Z.head.os=I>>8),512&Z.flags&&(Q[0]=255&I,Q[1]=I>>>8&255,Z.check=h(Z.check,Q,2,0)),I=0,T=0,Z.mode=5;case 5:if(1024&Z.flags){for(;T<16;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}Z.length=I,Z.head&&(Z.head.extra_len=I),512&Z.flags&&(Q[0]=255&I,Q[1]=I>>>8&255,Z.check=h(Z.check,Q,2,0)),I=0,T=0}else Z.head&&(Z.head.extra=null);Z.mode=6;case 6:if(1024&Z.flags&&(t=Z.length,t>N&&(t=N),t&&(Z.head&&(r=Z.head.extra_len-Z.length,Z.head.extra||(Z.head.extra=new Uint8Array(Z.head.extra_len)),Z.head.extra.set(s.subarray(Y,Y+t),r)),512&Z.flags&&(Z.check=h(Z.check,s,t,Y)),N-=t,Y+=t,Z.length-=t),Z.length))break f;Z.length=0,Z.mode=7;case 7:if(2048&Z.flags){if(0===N)break f;t=0;do{r=s[Y+t++],Z.head&&r&&Z.length<65536&&(Z.head.name+=String.fromCharCode(r))}while(r&&t<N);if(512&Z.flags&&(Z.check=h(Z.check,s,t,Y)),N-=t,Y+=t,r)break f}else Z.head&&(Z.head.name=null);Z.length=0,Z.mode=8;case 8:if(4096&Z.flags){if(0===N)break f;t=0;do{r=s[Y+t++],Z.head&&r&&Z.length<65536&&(Z.head.comment+=String.fromCharCode(r))}while(r&&t<N);if(512&Z.flags&&(Z.check=h(Z.check,s,t,Y)),N-=t,Y+=t,r)break f}else Z.head&&(Z.head.comment=null);Z.mode=9;case 9:if(512&Z.flags){for(;T<16;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(I!==(65535&Z.check)){f.Ov="header crc mismatch",Z.mode=M;break}I=0,T=0}Z.head&&(Z.head.hcrc=Z.flags>>9&1,Z.head.done=!0),f.adler=Z.check=0,Z.mode=K;break;case 10:for(;T<32;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}f.adler=Z.check=A(I),I=0,T=0,Z.mode=11;case 11:if(0===Z.havedict)return f.next_out=y,f.avail_out=i,f.next_in=Y,f.avail_in=N,Z.hold=I,Z.bits=T,W;f.adler=Z.check=1,Z.mode=K;case K:if(v===C||v===H)break f;case 13:if(Z.last){I>>>=7&T,T-=7&T,Z.mode=27;break}for(;T<3;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}switch(Z.last=1&I,I>>>=1,T-=1,3&I){case 0:Z.mode=14;break;case 1:if(B(Z),Z.mode=20,v===H){I>>>=2,T-=2;break f}break;case 2:Z.mode=17;break;case 3:f.Ov="invalid block type",Z.mode=M}I>>>=2,T-=2;break;case 14:for(I>>>=7&T,T-=7&T;T<32;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if((65535&I)!==(I>>>16^65535)){f.Ov="invalid stored block lengths",Z.mode=M;break}if(Z.length=65535&I,I=0,T=0,Z.mode=15,v===H)break f;case 15:Z.mode=16;case 16:if(t=Z.length,t){if(t>N&&(t=N),t>i&&(t=i),0===t)break f;z.set(s.subarray(Y,Y+t),y),N-=t,Y+=t,i-=t,y+=t,Z.length-=t;break}Z.mode=K;break;case 17:for(;T<14;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(Z.nlen=257+(31&I),I>>>=5,T-=5,Z.ndist=1+(31&I),I>>>=5,T-=5,Z.ncode=4+(15&I),I>>>=4,T-=4,Z.nlen>286||Z.ndist>30){f.Ov="too many length or distance symbols",Z.mode=M;break}Z.have=0,Z.mode=18;case 18:for(;Z.have<Z.ncode;){for(;T<3;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}Z.lens[R[Z.have++]]=7&I,I>>>=3,T-=3}for(;Z.have<19;)Z.lens[R[Z.have++]]=0;if(Z.lencode=Z.lendyn,Z.lenbits=7,d={bits:Z.lenbits},o=l(0,Z.lens,0,19,Z.lencode,0,Z.work,d),Z.lenbits=d.bits,o){f.Ov="invalid code lengths set",Z.mode=M;break}Z.have=0,Z.mode=19;case 19:for(;Z.have<Z.nlen+Z.ndist;){for(;G=Z.lencode[I&(1<<Z.lenbits)-1],j=G>>>24,q=G>>>16&255,c=65535&G,!(j<=T);){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(c<16)I>>>=j,T-=j,Z.lens[Z.have++]=c;else{if(16===c){for(x=j+2;T<x;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(I>>>=j,T-=j,0===Z.have){f.Ov="invalid bit length repeat",Z.mode=M;break}r=Z.lens[Z.have-1],t=3+(3&I),I>>>=2,T-=2}else if(17===c){for(x=j+3;T<x;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}I>>>=j,T-=j,r=0,t=3+(7&I),I>>>=3,T-=3}else{for(x=j+7;T<x;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}I>>>=j,T-=j,r=0,t=11+(127&I),I>>>=7,T-=7}if(Z.have+t>Z.nlen+Z.ndist){f.Ov="invalid bit length repeat",Z.mode=M;break}for(;t--;)Z.lens[Z.have++]=r}}if(Z.mode===M)break;if(0===Z.lens[256]){f.Ov="invalid code -- missing end-of-block",Z.mode=M;break}if(Z.lenbits=9,d={bits:Z.lenbits},o=l(1,Z.lens,0,Z.nlen,Z.lencode,0,Z.work,d),Z.lenbits=d.bits,o){f.Ov="invalid literal/lengths set",Z.mode=M;break}if(Z.distbits=6,Z.distcode=Z.distdyn,d={bits:Z.distbits},o=l(2,Z.lens,Z.nlen,Z.ndist,Z.distcode,0,Z.work,d),Z.distbits=d.bits,o){f.Ov="invalid distances set",Z.mode=M;break}if(Z.mode=20,v===H)break f;case 20:Z.mode=21;case 21:if(N>=6&&i>=258){f.next_out=y,f.avail_out=i,f.next_in=Y,f.avail_in=N,Z.hold=I,Z.bits=T,J(f,w),y=f.next_out,z=f.output,i=f.avail_out,Y=f.next_in,s=f.input,N=f.avail_in,I=Z.hold,T=Z.bits,Z.mode===K&&(Z.back=-1);break}for(Z.back=0;G=Z.lencode[I&(1<<Z.lenbits)-1],j=G>>>24,q=G>>>16&255,c=65535&G,!(j<=T);){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(q&&0===(240&q)){for(m=j,p=q,k=c;G=Z.lencode[k+((I&(1<<m+p)-1)>>m)],j=G>>>24,q=G>>>16&255,c=65535&G,!(m+j<=T);){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}I>>>=m,T-=m,Z.back+=m}if(I>>>=j,T-=j,Z.back+=j,Z.length=c,0===q){Z.mode=26;break}if(32&q){Z.back=-1,Z.mode=K;break}if(64&q){f.Ov="invalid literal/length code",Z.mode=M;break}Z.extra=15&q,Z.mode=22;case 22:if(Z.extra){for(x=Z.extra;T<x;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}Z.length+=I&(1<<Z.extra)-1,I>>>=Z.extra,T-=Z.extra,Z.back+=Z.extra}Z.was=Z.length,Z.mode=23;case 23:for(;G=Z.distcode[I&(1<<Z.distbits)-1],j=G>>>24,q=G>>>16&255,c=65535&G,!(j<=T);){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(0===(240&q)){for(m=j,p=q,k=c;G=Z.distcode[k+((I&(1<<m+p)-1)>>m)],j=G>>>24,q=G>>>16&255,c=65535&G,!(m+j<=T);){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}I>>>=m,T-=m,Z.back+=m}if(I>>>=j,T-=j,Z.back+=j,64&q){f.Ov="invalid distance code",Z.mode=M;break}Z.offset=c,Z.extra=15&q,Z.mode=24;case 24:if(Z.extra){for(x=Z.extra;T<x;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}Z.offset+=I&(1<<Z.extra)-1,I>>>=Z.extra,T-=Z.extra,Z.back+=Z.extra}if(Z.offset>Z.dmax){f.Ov="invalid distance too far back",Z.mode=M;break}Z.mode=25;case 25:if(0===i)break f;if(t=w-i,Z.offset>t){if(t=Z.offset-t,t>Z.whave&&Z.sane){f.Ov="invalid distance too far back",Z.mode=M;break}t>Z.wnext?(t-=Z.wnext,L=Z.wsize-t):L=Z.wnext-t,t>Z.length&&(t=Z.length),E=Z.window}else E=z,L=y-Z.offset,t=Z.length;t>i&&(t=i),i-=t,Z.length-=t;do{z[y++]=E[L++]}while(--t);0===Z.length&&(Z.mode=21);break;case 26:if(0===i)break f;z[y++]=Z.length,i--,Z.mode=21;break;case 27:if(Z.wrap){for(;T<32;){if(0===N)break f;N--,I|=s[Y++]<<T,T+=8}if(w-=i,f.total_out+=w,Z.total+=w,w&&(f.adler=Z.check=Z.flags?h(Z.check,z,w,y-w):V(Z.check,z,w,y-w)),w=i,(Z.flags?I:A(I))!==Z.check){f.Ov="incorrect data check",Z.mode=M;break}I=0,T=0}Z.mode=28;case 28:if(Z.wrap&&Z.flags){for(;T<32;){if(0===N)break f;N--,I+=s[Y++]<<T,T+=8}if(I!==(4294967295&Z.total)){f.Ov="incorrect length check",Z.mode=M;break}I=0,T=0}Z.mode=29;case 29:o=u;break f;case M:o=b;break f;case 31:return X;default:return a}return f.next_out=y,f.avail_out=i,f.next_in=Y,f.avail_in=N,Z.hold=I,Z.bits=T,(Z.wsize||w!==f.avail_out&&Z.mode<M&&(Z.mode<27||v!==e))&&P(f,f.output,f.next_out,w-f.avail_out)?(Z.mode=31,X):(g-=f.avail_in,w-=f.avail_out,f.total_in+=g,f.total_out+=w,Z.total+=w,Z.wrap&&w&&(f.adler=Z.check=Z.flags?h(Z.check,z,w,f.next_out-w):V(Z.check,z,w,f.next_out-w)),f.data_type=Z.bits+(Z.last?64:0)+(Z.mode===K?128:0)+(20===Z.mode||15===Z.mode?256:0),(0===g&&0===w||v===e)&&o===O&&(o=F),o)},f.exports.inflateEnd=f=>{if(!f||!f.state)return a;let v=f.state;return v.window&&(v.window=null),f.state=null,O},f.exports.inflateGetHeader=(f,v)=>{if(!f||!f.state)return a;const Z=f.state;return 0===(2&Z.wrap)?a:(Z.head=v,v.done=!1,O)},f.exports.inflateSetDictionary=(f,v)=>{const Z=v.length;let h,J,l;return f&&f.state?(h=f.state,0!==h.wrap&&11!==h.mode?a:11===h.mode&&(J=1,J=V(J,v,Z,0),J!==h.check)?b:(l=P(f,v,Z,Z),l?(h.mode=31,X):(h.havedict=1,O))):a},f.exports.inflateInfo="pako inflate (from Nodeca project)"},12620:f=>{"use strict";const v=15,Z=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),V=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),J=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);f.exports=(f,l,e,C,H,O,u,W)=>{const a=W.bits;let b,X,F,U,K,M,A=0,s=0,z=0,Y=0,y=0,N=0,i=0,I=0,T=0,B=0,P=null,g=0;const w=new Uint16Array(16),t=new Uint16Array(16);let L,E,j,q=null,c=0;for(A=0;A<=v;A++)w[A]=0;for(s=0;s<C;s++)w[l[e+s]]++;for(y=a,Y=v;Y>=1&&0===w[Y];Y--);if(y>Y&&(y=Y),0===Y)return H[O++]=20971520,H[O++]=20971520,W.bits=1,0;for(z=1;z<Y&&0===w[z];z++);for(y<z&&(y=z),I=1,A=1;A<=v;A++)if(I<<=1,I-=w[A],I<0)return-1;if(I>0&&(0===f||1!==Y))return-1;for(t[1]=0,A=1;A<v;A++)t[A+1]=t[A]+w[A];for(s=0;s<C;s++)0!==l[e+s]&&(u[t[l[e+s]]++]=s);if(0===f?(P=q=u,M=19):1===f?(P=Z,g-=257,q=V,c-=257,M=256):(P=h,q=J,M=-1),B=0,s=0,A=z,K=O,N=y,i=0,F=-1,T=1<<y,U=T-1,1===f&&T>852||2===f&&T>592)return 1;for(;;){L=A-i,u[s]<M?(E=0,j=u[s]):u[s]>M?(E=q[c+u[s]],j=P[g+u[s]]):(E=96,j=0),b=1<<A-i,X=1<<N,z=X;do{X-=b,H[K+(B>>i)+X]=L<<24|E<<16|j}while(0!==X);for(b=1<<A-1;B&b;)b>>=1;if(0!==b?(B&=b-1,B+=b):B=0,s++,0===--w[A]){if(A===Y)break;A=l[e+u[s]]}if(A>y&&(B&U)!==F){for(0===i&&(i=y),K+=z,N=A-i,I=1<<N;N+i<Y&&(I-=w[N+i],!(I<=0));)N++,I<<=1;if(T+=1<<N,1===f&&T>852||2===f&&T>592)return 1;F=B&U,H[F]=y<<24|N<<16|K-O}}return 0!==B&&(H[K+B]=A-i<<24|64<<16),W.bits=y,0}},12585:f=>{"use strict";f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12570:f=>{"use strict";function v(f){let v=f.length;for(;--v>=0;)f[v]=0}const Z=256,V=286,h=30,J=15,l=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),e=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O=new Array(576);v(O);const u=new Array(60);v(u);const W=new Array(512);v(W);const a=new Array(256);v(a);const b=new Array(29);v(b);const X=new Array(h);function F(f,v,Z,V,h){this.static_tree=f,this.extra_bits=v,this.extra_base=Z,this.elems=V,this.max_length=h,this.has_stree=f&&f.length}let U,K,M;function A(f,v){this.dyn_tree=f,this.max_code=0,this.stat_desc=v}v(X);const s=f=>f<256?W[f]:W[256+(f>>>7)],z=(f,v)=>{f.pending_buf[f.pending++]=255&v,f.pending_buf[f.pending++]=v>>>8&255},Y=(f,v,Z)=>{f.bi_valid>16-Z?(f.bi_buf|=v<<f.bi_valid&65535,z(f,f.bi_buf),f.bi_buf=v>>16-f.bi_valid,f.bi_valid+=Z-16):(f.bi_buf|=v<<f.bi_valid&65535,f.bi_valid+=Z)},y=(f,v,Z)=>{Y(f,Z[2*v],Z[2*v+1])},N=(f,v)=>{let Z=0;do{Z|=1&f,f>>>=1,Z<<=1}while(--v>0);return Z>>>1},i=(f,v,Z)=>{const V=new Array(16);let h,l,e=0;for(h=1;h<=J;h++)V[h]=e=e+Z[h-1]<<1;for(l=0;l<=v;l++){let v=f[2*l+1];0!==v&&(f[2*l]=N(V[v]++,v))}},I=f=>{let v;for(v=0;v<V;v++)f.dyn_ltree[2*v]=0;for(v=0;v<h;v++)f.dyn_dtree[2*v]=0;for(v=0;v<19;v++)f.bl_tree[2*v]=0;f.dyn_ltree[512]=1,f.opt_len=f.static_len=0,f.last_lit=f.matches=0},T=f=>{f.bi_valid>8?z(f,f.bi_buf):f.bi_valid>0&&(f.pending_buf[f.pending++]=f.bi_buf),f.bi_buf=0,f.bi_valid=0},B=(f,v,Z,V)=>{const h=2*v,J=2*Z;return f[h]<f[J]||f[h]===f[J]&&V[v]<=V[Z]},P=(f,v,Z)=>{const V=f.heap[Z];let h=Z<<1;for(;h<=f.heap_len&&(h<f.heap_len&&B(v,f.heap[h+1],f.heap[h],f.depth)&&h++,!B(v,V,f.heap[h],f.depth));)f.heap[Z]=f.heap[h],Z=h,h<<=1;f.heap[Z]=V},g=(f,v,V)=>{let h,J,C,H,O=0;if(0!==f.last_lit)do{h=f.pending_buf[f.d_buf+2*O]<<8|f.pending_buf[f.d_buf+2*O+1],J=f.pending_buf[f.l_buf+O],O++,0===h?y(f,J,v):(C=a[J],y(f,C+Z+1,v),H=l[C],0!==H&&(J-=b[C],Y(f,J,H)),h--,C=s(h),y(f,C,V),H=e[C],0!==H&&(h-=X[C],Y(f,h,H)))}while(O<f.last_lit);y(f,256,v)},w=(f,v)=>{const Z=v.dyn_tree,V=v.stat_desc.static_tree,h=v.stat_desc.has_stree,l=v.stat_desc.elems;let e,C,H,O=-1;for(f.heap_len=0,f.heap_max=573,e=0;e<l;e++)0!==Z[2*e]?(f.heap[++f.heap_len]=O=e,f.depth[e]=0):Z[2*e+1]=0;for(;f.heap_len<2;)H=f.heap[++f.heap_len]=O<2?++O:0,Z[2*H]=1,f.depth[H]=0,f.opt_len--,h&&(f.static_len-=V[2*H+1]);for(v.max_code=O,e=f.heap_len>>1;e>=1;e--)P(f,Z,e);H=l;do{e=f.heap[1],f.heap[1]=f.heap[f.heap_len--],P(f,Z,1),C=f.heap[1],f.heap[--f.heap_max]=e,f.heap[--f.heap_max]=C,Z[2*H]=Z[2*e]+Z[2*C],f.depth[H]=(f.depth[e]>=f.depth[C]?f.depth[e]:f.depth[C])+1,Z[2*e+1]=Z[2*C+1]=H,f.heap[1]=H++,P(f,Z,1)}while(f.heap_len>=2);f.heap[--f.heap_max]=f.heap[1],((f,v)=>{const Z=v.dyn_tree,V=v.max_code,h=v.stat_desc.static_tree,l=v.stat_desc.has_stree,e=v.stat_desc.extra_bits,C=v.stat_desc.extra_base,H=v.stat_desc.max_length;let O,u,W,a,b,X,F=0;for(a=0;a<=J;a++)f.bl_count[a]=0;for(Z[2*f.heap[f.heap_max]+1]=0,O=f.heap_max+1;O<573;O++)u=f.heap[O],a=Z[2*Z[2*u+1]+1]+1,a>H&&(a=H,F++),Z[2*u+1]=a,u>V||(f.bl_count[a]++,b=0,u>=C&&(b=e[u-C]),X=Z[2*u],f.opt_len+=X*(a+b),l&&(f.static_len+=X*(h[2*u+1]+b)));if(0!==F){do{for(a=H-1;0===f.bl_count[a];)a--;f.bl_count[a]--,f.bl_count[a+1]+=2,f.bl_count[H]--,F-=2}while(F>0);for(a=H;0!==a;a--)for(u=f.bl_count[a];0!==u;)W=f.heap[--O],W>V||(Z[2*W+1]!==a&&(f.opt_len+=(a-Z[2*W+1])*Z[2*W],Z[2*W+1]=a),u--)}})(f,v),i(Z,O,f.bl_count)},t=(f,v,Z)=>{let V,h,J=-1,l=v[1],e=0,C=7,H=4;for(0===l&&(C=138,H=3),v[2*(Z+1)+1]=65535,V=0;V<=Z;V++)h=l,l=v[2*(V+1)+1],++e<C&&h===l||(e<H?f.bl_tree[2*h]+=e:0!==h?(h!==J&&f.bl_tree[2*h]++,f.bl_tree[32]++):e<=10?f.bl_tree[34]++:f.bl_tree[36]++,e=0,J=h,0===l?(C=138,H=3):h===l?(C=6,H=3):(C=7,H=4))},L=(f,v,Z)=>{let V,h,J=-1,l=v[1],e=0,C=7,H=4;for(0===l&&(C=138,H=3),V=0;V<=Z;V++)if(h=l,l=v[2*(V+1)+1],!(++e<C&&h===l)){if(e<H)do{y(f,h,f.bl_tree)}while(0!==--e);else 0!==h?(h!==J&&(y(f,h,f.bl_tree),e--),y(f,16,f.bl_tree),Y(f,e-3,2)):e<=10?(y(f,17,f.bl_tree),Y(f,e-3,3)):(y(f,18,f.bl_tree),Y(f,e-11,7));e=0,J=h,0===l?(C=138,H=3):h===l?(C=6,H=3):(C=7,H=4)}};let E=!1;const j=(f,v,Z,V)=>{Y(f,0+(V?1:0),3),((f,v,Z,V)=>{T(f),V&&(z(f,Z),z(f,~Z)),f.pending_buf.set(f.window.subarray(v,v+Z),f.pending),f.pending+=Z})(f,v,Z,!0)};f.exports._tr_init=f=>{E||((()=>{let f,v,Z,H,A;const s=new Array(16);for(Z=0,H=0;H<28;H++)for(b[H]=Z,f=0;f<1<<l[H];f++)a[Z++]=H;for(a[Z-1]=H,A=0,H=0;H<16;H++)for(X[H]=A,f=0;f<1<<e[H];f++)W[A++]=H;for(A>>=7;H<h;H++)for(X[H]=A<<7,f=0;f<1<<e[H]-7;f++)W[256+A++]=H;for(v=0;v<=J;v++)s[v]=0;for(f=0;f<=143;)O[2*f+1]=8,f++,s[8]++;for(;f<=255;)O[2*f+1]=9,f++,s[9]++;for(;f<=279;)O[2*f+1]=7,f++,s[7]++;for(;f<=287;)O[2*f+1]=8,f++,s[8]++;for(i(O,287,s),f=0;f<h;f++)u[2*f+1]=5,u[2*f]=N(f,5);U=new F(O,l,257,V,J),K=new F(u,e,0,h,J),M=new F(new Array(0),C,0,19,7)})(),E=!0),f.l_desc=new A(f.dyn_ltree,U),f.d_desc=new A(f.dyn_dtree,K),f.bl_desc=new A(f.bl_tree,M),f.bi_buf=0,f.bi_valid=0,I(f)},f.exports._tr_stored_block=j,f.exports._tr_flush_block=(f,v,V,h)=>{let J,l,e=0;f.level>0?(2===f.strm.data_type&&(f.strm.data_type=(f=>{let v,V=4093624447;for(v=0;v<=31;v++,V>>>=1)if(1&V&&0!==f.dyn_ltree[2*v])return 0;if(0!==f.dyn_ltree[18]||0!==f.dyn_ltree[20]||0!==f.dyn_ltree[26])return 1;for(v=32;v<Z;v++)if(0!==f.dyn_ltree[2*v])return 1;return 0})(f)),w(f,f.l_desc),w(f,f.d_desc),e=(f=>{let v;for(t(f,f.dyn_ltree,f.l_desc.max_code),t(f,f.dyn_dtree,f.d_desc.max_code),w(f,f.bl_desc),v=18;v>=3&&0===f.bl_tree[2*H[v]+1];v--);return f.opt_len+=3*(v+1)+5+5+4,v})(f),J=f.opt_len+3+7>>>3,l=f.static_len+3+7>>>3,l<=J&&(J=l)):J=l=V+5,V+4<=J&&-1!==v?j(f,v,V,h):4===f.strategy||l===J?(Y(f,2+(h?1:0),3),g(f,O,u)):(Y(f,4+(h?1:0),3),((f,v,Z,V)=>{let h;for(Y(f,v-257,5),Y(f,Z-1,5),Y(f,V-4,4),h=0;h<V;h++)Y(f,f.bl_tree[2*H[h]+1],3);L(f,f.dyn_ltree,v-1),L(f,f.dyn_dtree,Z-1)})(f,f.l_desc.max_code+1,f.d_desc.max_code+1,e+1),g(f,f.dyn_ltree,f.dyn_dtree)),I(f),h&&T(f)},f.exports._tr_tally=(f,v,V)=>(f.pending_buf[f.d_buf+2*f.last_lit]=v>>>8&255,f.pending_buf[f.d_buf+2*f.last_lit+1]=255&v,f.pending_buf[f.l_buf+f.last_lit]=255&V,f.last_lit++,0===v?f.dyn_ltree[2*V]++:(f.matches++,v--,f.dyn_ltree[2*(a[V]+Z+1)]++,f.dyn_dtree[2*s(v)]++),f.last_lit===f.lit_bufsize-1),f.exports._tr_align=f=>{Y(f,2,3),y(f,256,O),(f=>{16===f.bi_valid?(z(f,f.bi_buf),f.bi_buf=0,f.bi_valid=0):f.bi_valid>=8&&(f.pending_buf[f.pending++]=255&f.bi_buf,f.bi_buf>>=8,f.bi_valid-=8)})(f)}},12606:f=>{"use strict";f.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Ov="",this.state=null,this.data_type=2,this.adler=0}},12202:f=>{function v(f,v,Z){for(var V=f.length,h=-1/0,J=1/0,l=0;l<V;l++){var e=(Z[0][l]-f[l])/v[l],C=(Z[1][l]-f[l])/v[l];if(e>C){var H=e;e=C,C=H}if(C<h||e>J)return 1/0;e>h&&(h=e),C<J&&(J=C)}return h>J?1/0:h}f.exports=function(f,Z,V,h){var J=v(Z,V,h);if(J===1/0)f=null;else{f=f||[];for(var l=0;l<Z.length;l++)f[l]=Z[l]+V[l]*J}return f},f.exports.distance=v},13562:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>l});var V=Z(38);const h=V.useLayoutEffect;const J=function(f){var v=(0,V.useRef)(f);return h((function(){v.current=f})),v};var l=function(f){var v=J(f);(0,V.ev)((function(){var f=function(f){var Z;if(null!=v.current&&(Z=v.current(f)),f.defaultPrevented&&(f.returnValue=""),"string"===typeof Z)return f.returnValue=Z,Z};return window.addEventListener("beforeunload",f),function(){window.removeEventListener("beforeunload",f)}}),[])}},13513:(f,v,Z)=>{"use strict";var V=Z(13521),h=Array.prototype.concat,J=Array.prototype.slice,l=f.exports=function(f){for(var v=[],Z=0,l=f.length;Z<l;Z++){var e=f[Z];V(e)?v=h.call(v,J.call(e)):v.push(e)}return v};l.wrap=function(f){return function(){return f(l(arguments))}}},13521:f=>{f.exports=function(f){return!(!f||"string"===typeof f)&&(f instanceof Array||Array.isArray(f)||f.length>=0&&(f.splice instanceof Function||Object.getOwnPropertyDescriptor(f,f.length-1)&&"String"!==f.constructor.name))}},12506:(f,v,Z)=>{var V=Z(12515);function h(f){for(var v,Z,h=0,J=f.length,l=0;l<f.length;){for(v=f[l],Z=0;l<J&&f[l]===v;)++l,++Z;h+=V.log2(Z)/7|0,h+=V.log2(v>>>0)/7|0,h+=2}return h}v.size=h,v.encode=function(f,v){v||(v=new Uint8Array(h(f)));for(var Z,V,J=0,l=v.length,e=0;e<f.length;){for(Z=f[e],V=0;e<f.length&&f[e]===Z;)++e,++V;for(;J<l&&V>=128;)v[J++]=128+(127&V),V>>>=7;if(J>=l)throw new Error("RLE buffer overflow");for(v[J++]=V,Z>>>=0;J<l&&Z>=128;)v[J++]=128+(127&Z),Z>>>=7;if(J>=l)throw new Error("RLE buffer overflow");v[J++]=Z}return v},v.decode=function(f,v){for(var Z,V,h,J,l=v.length,e=f.length,C=0,H=0;H<e;){for(Z=0,V=0;H<e&&f[H]>=128;)Z+=(127&f[H++])<<V,V+=7;if(Z+=f[H++]<<V,H>=e)throw new Error("RLE buffer underrun");if(C+Z>l)throw new Error("Chunk buffer overflow");for(h=0,V=0;H<e&&f[H]>=128;)h+=(127&f[H++])<<V,V+=7;if(H>=e)throw new Error("RLE buffer underrun");for(h+=f[H++]<<V,J=0;J<Z;++J)v[C++]=h}return v}},12515:(f,v)=>{"use strict";function Z(f){var v=32;return(f&=-f)&&v--,65535&f&&(v-=16),16711935&f&&(v-=8),252645135&f&&(v-=4),858993459&f&&(v-=2),1431655765&f&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(f){return(f>0)-(f<0)},v.abs=function(f){var v=f>>31;return(f^v)-v},v.min=function(f,v){return v^(f^v)&-(f<v)},v.max=function(f,v){return f^(f^v)&-(f<v)},v.isPow2=function(f){return!(f&f-1)&&!!f},v.log2=function(f){var v,Z;return v=(f>65535)<<4,v|=Z=((f>>>=v)>255)<<3,v|=Z=((f>>>=Z)>15)<<2,(v|=Z=((f>>>=Z)>3)<<1)|(f>>>=Z)>>1},v.log10=function(f){return f>=1e9?9:f>=1e8?8:f>=1e7?7:f>=1e6?6:f>=1e5?5:f>=1e4?4:f>=1e3?3:f>=100?2:f>=10?1:0},v.popCount=function(f){return 16843009*((f=(858993459&(f-=f>>>1&1431655765))+(f>>>2&858993459))+(f>>>4)&252645135)>>>24},v.countTrailingZeros=Z,v.nextPow2=function(f){return f+=0===f,--f,f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)+1},v.prevPow2=function(f){return f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)-(f>>>1)},v.parity=function(f){return f^=f>>>16,f^=f>>>8,f^=f>>>4,27030>>>(f&=15)&1};var V=new Array(256);!function(f){for(var v=0;v<256;++v){var Z=v,V=v,h=7;for(Z>>>=1;Z;Z>>>=1)V<<=1,V|=1&Z,--h;f[v]=V<<h&255}}(V),v.reverse=function(f){return V[255&f]<<24|V[f>>>8&255]<<16|V[f>>>16&255]<<8|V[f>>>24&255]},v.interleave2=function(f,v){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(f,v){return(f=65535&((f=16711935&((f=252645135&((f=858993459&((f=f>>>v&1431655765)|f>>>1))|f>>>2))|f>>>4))|f>>>16))<<16>>16},v.interleave3=function(f,v,Z){return f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2),(f|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<2},v.deinterleave3=function(f,v){return(f=1023&((f=4278190335&((f=251719695&((f=3272356035&((f=f>>>v&1227133513)|f>>>2))|f>>>4))|f>>>8))|f>>>16))<<22>>22},v.nextCombination=function(f){var v=f|f-1;return v+1|(~v&-~v)-1>>>Z(f)+1}},12545:f=>{"use strict";f.exports=function(f,v,Z,V){var h=self||window;try{try{var J;try{J=new h.Blob([f])}catch(H){(J=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(f),J=J.getBlob()}var l=h.URL||h.webkitURL,e=l.createObjectURL(J),C=new h[v](e,Z);return l.revokeObjectURL(e),C}catch(H){return new h[v]("data:application/javascript,".concat(encodeURIComponent(f)),Z)}}catch(H){if(!V)throw Error("Inline worker is not supported");return new h[v](V,Z)}}},12182:(f,v,Z)=>{"use strict";function V(f,v,Z,V,h){var J={};return Object.keys(V).forEach((function(f){J[f]=V[f]})),J.enumerable=!!J.enumerable,J.configurable=!!J.configurable,("value"in J||J.initializer)&&(J.writable=!0),J=Z.slice().reverse().reduce((function(Z,V){return V(f,v,Z)||Z}),J),h&&void 0!==J.initializer&&(J.value=J.initializer?J.initializer.call(h):void 0,J.initializer=void 0),void 0===J.initializer&&(Object.defineProperty(f,v,J),J=null),J}Z.d(v,{d:()=>V})},12180:(f,v,Z)=>{"use strict";function V(f,v,Z,V){Z&&Object.defineProperty(f,v,{enumerable:Z.enumerable,configurable:Z.configurable,writable:Z.writable,value:Z.initializer?Z.initializer.call(V):void 0})}Z.d(v,{d:()=>V})},13550:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>l,e:()=>u,g:()=>e,k:()=>J,m:()=>C,p:()=>h,r:()=>H,s:()=>O});var V=Z(11609);class h{constructor(){this._easingMode=h.EASINGMODE_EASEIN}setEasingMode(f){const v=Math.min(Math.max(f,0),2);this._easingMode=v}getEasingMode(){return this._easingMode}easeInCore(f){throw new Error("You must implement this method")}ease(f){switch(this._easingMode){case h.EASINGMODE_EASEIN:return this.easeInCore(f);case h.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-f)}return f>=.5?.5*(1-this.easeInCore(2*(1-f)))+.5:.5*this.easeInCore(2*f)}}h.EASINGMODE_EASEIN=0,h.EASINGMODE_EASEOUT=1,h.EASINGMODE_EASEINOUT=2;class J extends h{easeInCore(f){return f=Math.max(0,Math.min(1,f)),1-Math.sqrt(1-f*f)}}class l extends h{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=f}easeInCore(f){const v=Math.max(0,this.amplitude);return Math.pow(f,3)-f*v*Math.sin(3.141592653589793*f)}}class e extends h{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=f,this.bounciness=v}easeInCore(f){const v=Math.max(0,this.bounces);let Z=this.bounciness;Z<=1&&(Z=1.001);const V=Math.pow(Z,v),h=1-Z,J=(1-V)/h+.5*V,l=f*J,e=Math.log(-l*(1-Z)+1)/Math.log(Z),C=Math.floor(e),H=C+1,O=(1-Math.pow(Z,C))/(h*J),u=.5*(O+(1-Math.pow(Z,H))/(h*J)),W=f-u,a=u-O;return-Math.pow(1/Z,v-C)/(a*a)*(W-a)*(W+a)}}class C extends h{easeInCore(f){return f*f*f}}class H extends h{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=f,this.springiness=v}easeInCore(f){let v;const Z=Math.max(0,this.oscillations),V=Math.max(0,this.springiness);return v=0==V?f:(Math.exp(V*f)-1)/(Math.exp(V)-1),v*Math.sin((6.283185307179586*Z+1.5707963267948966)*f)}}class O extends h{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=f}easeInCore(f){return this.exponent<=0?f:(Math.exp(this.exponent*f)-1)/(Math.exp(this.exponent)-1)}}class u extends h{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=f,this.y1=v,this.x2=Z,this.y2=V}easeInCore(f){return V.e.Interpolate(f,this.x1,this.y1,this.x2,this.y2)}}},13048:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>l});var V=Z(11421),h=Z(11437),J=Z(11824);class l extends J.c{get _matrix(){return this._compose(),this.YW}set _matrix(f){(f.updateFlag!==this.YW.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.YW.h(f),this._markAsDirtyAndDecompose())}constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(f,v.Yf(),!1),this.name=f,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=v,this.YW=(null===h||void 0===h?void 0:h.clone())??V.Matrix.Identity(),this._restMatrix=J??this.YW.clone(),this._bindMatrix=l??this.YW.clone(),this._index=e,this._absoluteMatrix=new V.Matrix,this._absoluteBindMatrix=new V.Matrix,this._absoluteInverseBindMatrix=new V.Matrix,this._finalMatrix=new V.Matrix,v.bones.push(this),this.setParent(Z,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(f){this.setParent(f)}setParent(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==f){if(this.parent){const f=this.parent.children.indexOf(this);-1!==f&&this.parent.children.splice(f,1)}this._parentNode=f,this.parent&&this.parent.children.push(this),v&&this._updateAbsoluteBindMatrices(),this.dH()}}getLocalMatrix(){return this._compose(),this.YW}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(f){this._restMatrix.h(f)}setRestPose(f){this.setRestMatrix(f)}getBindPose(){return this.getBindMatrix()}setBindMatrix(f){this.Eh(f)}setBindPose(f){this.setBindMatrix(f)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const f=V.TmpVectors.Xv[0],v=V.TmpVectors.Quaternion[0],Z=V.TmpVectors.Xv[1];this.getRestMatrix().decompose(f,v,Z),this._linkedTransformNode.position.h(Z),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??V.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.h(v),this._linkedTransformNode.Ze.h(f)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(f){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=f,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.De}set position(f){this._decompose(),this.De.h(f),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(f){this.setRotation(f)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(f){this.setRotationQuaternion(f)}get Ze(){return this.getScale()}set Ze(f){this.setScale(f)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=V.Xv.Zero(),this._localRotation=V.Quaternion.Zero(),this.De=V.Xv.Zero()),this.YW.decompose(this._localScaling,this._localRotation,this.De))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,V.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.De,this.YW)):this._needToCompose=!1)}Eh(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.h(f),v&&this._updateAbsoluteBindMatrices(),Z?this._matrix=f:this.dH()}_updateAbsoluteBindMatrices(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f||(f=this._bindMatrix),this.parent?f.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.h(f),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),v)for(let Z=0;Z<this.children.length;Z++)this.children[Z]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}dH(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.dH(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.dH(),this._needToDecompose=!0}_updatePosition(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const J=this.getLocalMatrix();if(0==v)h?(J.addAtIndex(12,f.x),J.addAtIndex(13,f.y),J.addAtIndex(14,f.z)):J.setTranslationFromFloats(f.x,f.y,f.z);else{let v=null;Z&&(v=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const e=l._TmpMats[0],C=l._TmpVecs[0];this.parent?Z&&v?(e.h(this.parent.getAbsoluteMatrix()),e.multiplyToRef(v,e)):e.h(this.parent.getAbsoluteMatrix()):V.Matrix.IdentityToRef(e),h&&e.setTranslationFromFloats(0,0,0),e.invert(),V.Xv.TransformCoordinatesToRef(f,e,C),h?(J.addAtIndex(12,C.x),J.addAtIndex(13,C.y),J.addAtIndex(14,C.z)):J.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this._updatePosition(f,v,Z,!0)}setPosition(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this._updatePosition(f,v,Z,!1)}setAbsolutePosition(f,v){this.setPosition(f,1,v)}scale(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const J=this.getLocalMatrix(),e=l._TmpMats[0];V.Matrix.ScalingToRef(f,v,Z,e),e.multiplyToRef(J,J),e.invert();for(const V of this.children){const h=V.getLocalMatrix();h.multiplyToRef(e,h),h.multiplyAtIndex(12,f),h.multiplyAtIndex(13,v),h.multiplyAtIndex(14,Z),V._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),h)for(const V of this.children)V.scale(f,v,Z,h)}setScale(f){this._decompose(),this._localScaling.h(f),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(f){this._decompose(),f.h(this._localScaling)}setYawPitchRoll(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4?arguments[4]:void 0;if(0===h){const e=l._TmpQuat;return V.Quaternion.RotationYawPitchRollToRef(f,v,Z,e),void this.setRotationQuaternion(e,h,J)}const e=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(e,J))return;const C=l._TmpMats[1];V.Matrix.RotationYawPitchRollToRef(f,v,Z,C),e.multiplyToRef(C,C),this._rotateWithMatrix(C,h,J)}rotate(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;const J=l._TmpMats[0];J.setTranslationFromFloats(0,0,0),V.Matrix.RotationAxisToRef(f,v,J),this._rotateWithMatrix(J,Z,h)}setAxisAngle(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;if(0===Z){const J=l._TmpQuat;return V.Quaternion.RotationAxisToRef(f,v,J),void this.setRotationQuaternion(J,Z,h)}const J=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,h))return;const e=l._TmpMats[1];V.Matrix.RotationAxisToRef(f,v,e),J.multiplyToRef(e,e),this._rotateWithMatrix(e,Z,h)}setRotation(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(f.y,f.x,f.z,v,Z)}setRotationQuaternion(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;if(0===v)return this._decompose(),this._localRotation.h(f),void this._markAsDirtyAndCompose();const h=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,Z))return;const J=l._TmpMats[1];V.Matrix.FromQuaternionToRef(f,J),h.multiplyToRef(J,J),this._rotateWithMatrix(J,v,Z)}setRotationMatrix(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;if(0===v){const h=l._TmpQuat;return V.Quaternion.FromRotationMatrixToRef(f,h),void this.setRotationQuaternion(h,v,Z)}const h=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,Z))return;const J=l._TmpMats[1];J.h(f),h.multiplyToRef(f,J),this._rotateWithMatrix(J,v,Z)}_rotateWithMatrix(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;const V=this.getLocalMatrix(),h=V.m[12],J=V.m[13],e=V.m[14],C=this.getParent(),H=l._TmpMats[3],O=l._TmpMats[4];C&&1==v?(Z?(H.h(Z.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(H,H)):H.h(C.getAbsoluteMatrix()),O.h(H),O.invert(),V.multiplyToRef(H,V),V.multiplyToRef(f,V),V.multiplyToRef(O,V)):1==v&&Z?(H.h(Z.getWorldMatrix()),O.h(H),O.invert(),V.multiplyToRef(H,V),V.multiplyToRef(f,V),V.multiplyToRef(O,V)):V.multiplyToRef(f,V),V.setTranslationFromFloats(h,J,e),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(f,v){const Z=l._TmpMats[2];return f.h(this.getAbsoluteMatrix()),v?(f.multiplyToRef(v.getWorldMatrix(),f),V.Matrix.ScalingToRef(v.Ze.x,v.Ze.y,v.Ze.z,Z)):V.Matrix.IdentityToRef(Z),f.invert(),!isNaN(f.m[0])&&(Z.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyToRef(Z,f),!0)}Zh(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=V.Xv.Zero();return this.getPositionToRef(f,v,Z),Z}getPositionToRef(){let f=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const f=this.getLocalMatrix();v.x=f.m[12],v.y=f.m[13],v.z=f.m[14]}else{let Z=null;f&&(Z=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let V=l._TmpMats[0];f&&Z?(V.h(this.getAbsoluteMatrix()),V.multiplyToRef(Z,V)):V=this.getAbsoluteMatrix(),v.x=V.m[12],v.y=V.m[13],v.z=V.m[14]}}getAbsolutePosition(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=V.Xv.Zero();return this.getPositionToRef(1,f,v),v}getAbsolutePositionToRef(f,v){this.getPositionToRef(1,f,v)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.YW.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.h(this.YW);const f=this._skeleton.getPoseMatrix();f&&this._absoluteMatrix.multiplyToRef(f,this._absoluteMatrix)}const f=this.children,v=f.length;for(let Z=0;Z<v;Z++)f[Z].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}iC(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=V.Xv.Zero();return this.getDirectionToRef(f,v,Z),Z}getDirectionToRef(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,h=null;v&&(h=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=l._TmpMats[0];J.h(this.getAbsoluteMatrix()),v&&h&&J.multiplyToRef(h,J),V.Xv.TransformNormalToRef(f,J,Z),Z.normalize()}getRotation(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=V.Xv.Zero();return this.getRotationToRef(f,v,Z),Z}getRotationToRef(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;const V=l._TmpQuat;this.getRotationQuaternionToRef(f,v,V),V.toEulerAnglesToRef(Z)}getRotationQuaternion(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=V.Quaternion.Identity();return this.getRotationQuaternionToRef(f,v,Z),Z}getRotationQuaternionToRef(){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),v.h(this._localRotation);else{const Z=l._TmpMats[0],V=this.getAbsoluteMatrix();f?V.multiplyToRef(f.getWorldMatrix(),Z):Z.h(V),Z.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyAtIndex(1,this._scalingDeterminant),Z.multiplyAtIndex(2,this._scalingDeterminant),Z.decompose(void 0,v,void 0)}}getRotationMatrix(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1?arguments[1]:void 0;const Z=V.Matrix.Identity();return this.getRotationMatrixToRef(f,v,Z),Z}getRotationMatrixToRef(){let f=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(v);else{const Z=l._TmpMats[0],V=this.getAbsoluteMatrix();f?V.multiplyToRef(f.getWorldMatrix(),Z):Z.h(V),Z.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyAtIndex(1,this._scalingDeterminant),Z.multiplyAtIndex(2,this._scalingDeterminant),Z.getRotationMatrixToRef(v)}}getAbsolutePositionFromLocal(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=V.Xv.Zero();return this.getAbsolutePositionFromLocalToRef(f,v,Z),Z}getAbsolutePositionFromLocalToRef(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,h=null;v&&(h=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=l._TmpMats[0];J.h(this.getAbsoluteMatrix()),v&&h&&J.multiplyToRef(h,J),V.Xv.TransformCoordinatesToRef(f,J,Z)}getLocalPositionFromAbsolute(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=V.Xv.Zero();return this.getLocalPositionFromAbsoluteToRef(f,v,Z),Z}getLocalPositionFromAbsoluteToRef(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,h=null;v&&(h=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=l._TmpMats[0];J.h(this.getAbsoluteMatrix()),v&&h&&J.multiplyToRef(h,J),J.invert(),V.Xv.TransformCoordinatesToRef(f,J,Z)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const f=this._skeleton.bones.indexOf(this);if(-1!==f&&this._skeleton.bones.splice(f,1),this._parentNode&&this._parentNode.children){const f=this._parentNode.children,v=f.indexOf(this);-1!==v&&f.splice(v,1)}super.dispose()}}l._TmpVecs=(0,h.c)(2,V.Xv.Zero),l._TmpQuat=V.Quaternion.Identity(),l._TmpMats=(0,h.c)(5,V.Matrix.Identity)},13548:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>w});var V=Z(11405),h=Z(11410),J=Z(11235),l=Z(11421),e=Z(11440),C=Z(11824),H=Z(11859),O=Z(11690),u=Z(11254),W=Z(11428);class a{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(f){this._zoomStopsAnimation=f}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(f){this._idleRotationSpeed=f}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(f){this._idleRotationWaitTime=f}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(f){this._idleRotationSpinupTime=f}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(f){this._attachedCamera=f;const v=this._attachedCamera.Yf();this._onPrePointerObservableObserver=v.onPrePointerObservable.add((f=>{f.type!==O.c.POINTERDOWN?f.type===O.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const f=u.b.Now;let v=0;null!=this._lastFrameTime&&(v=f-this._lastFrameTime),this._lastFrameTime=f,this._applyUserInteraction();const Z=f-this._lastInteractionTime-this._idleRotationWaitTime,V=Math.max(Math.min(Z/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*V,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(v/1e3))}))}detach(){if(!this._attachedCamera)return;const f=this._attachedCamera.Yf();this._onPrePointerObservableObserver&&f.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(f){this._lastInteractionTime=f??u.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<W.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let f=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(f=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?f:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=u.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var b=Z(13550),X=Z(11921);class F{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(f){if(this._autoTransitionRange===f)return;this._autoTransitionRange=f;const v=this._attachedCamera;v&&(f?this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((f=>{if(f&&(f.jh(!0),f.getBoundingInfo)){const v=f.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*v,this.upperRadiusTransitionRange=.05*v}})):this._onMeshTargetChangedObserver&&v.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(f){this._attachedCamera=f,this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(f){return!!this._attachedCamera&&(this._attachedCamera.radius===f&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(f){if(!this._attachedCamera)return;this._radiusBounceTransition||(F.EasingFunction.setEasingMode(F.EasingMode),this._radiusBounceTransition=X.b.CreateAnimation("radius",X.b.ANIMATIONTYPE_FLOAT,60,F.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const v=X.b.TransitionTo("radius",this._attachedCamera.radius+f,this._attachedCamera,this._attachedCamera.Yf(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));v&&this._animatables.push(v)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}F.EasingFunction=new b.c(.3),F.EasingMode=b.p.EASINGMODE_EASEOUT;class U{constructor(){this.onTargetFramingAnimationEndObservable=new J.c,this._mode=U.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(f){this._mode=f}get mode(){return this._mode}set radiusScale(f){this._radiusScale=f}get radiusScale(){return this._radiusScale}set positionScale(f){this._positionScale=f}get positionScale(){return this._positionScale}set defaultElevation(f){this._defaultElevation=f}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(f){this._elevationReturnTime=f}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(f){this._elevationReturnWaitTime=f}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(f){this._zoomStopsAnimation=f}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(f){this._framingTime=f}get framingTime(){return this._framingTime}init(){}attach(f){this._attachedCamera=f;const v=this._attachedCamera.Yf();U.EasingFunction.setEasingMode(U.EasingMode),this._onPrePointerObservableObserver=v.onPrePointerObservable.add((f=>{f.type!==O.c.POINTERDOWN?f.type===O.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=f.onMeshTargetChangedObservable.add((f=>{f&&f.getBoundingInfo&&this.zoomOnMesh(f,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const f=this._attachedCamera.Yf();this._onPrePointerObservableObserver&&f.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.jh(!0);const V=f.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(V.minimumWorld,V.maximumWorld,v,Z)}zoomOnMeshHierarchy(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.jh(!0);const V=f.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(V.min,V.max,v,Z)}zoomOnMeshesHierarchy(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new l.Xv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new l.Xv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let J=0;J<f.length;J++){const v=f[J].getHierarchyBoundingVectors(!0);l.Xv.CheckExtends(v.min,V,h),l.Xv.CheckExtends(v.max,V,h)}this.zoomOnBoundingInfo(V,h,v,Z)}zoomOnBoundingInfo(f,v){let Z,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const J=f.y,e=J+(v.y-J)*this._positionScale,C=v.Fv(f).scale(.5);if(!isFinite(e))return!1;if(V)Z=new l.Xv(0,e,0);else{const v=f.add(C);Z=new l.Xv(v.x,e,v.z)}this._vectorTransition||(this._vectorTransition=X.b.CreateAnimation("target",X.b.ANIMATIONTYPE_VECTOR3,60,U.EasingFunction)),this._betaIsAnimating=!0;let H=X.b.TransitionTo("target",Z,this._attachedCamera,this._attachedCamera.Yf(),60,this._vectorTransition,this._framingTime);H&&this._animatables.push(H);let O=0;if(this._mode===U.FitFrustumSidesMode){const Z=this._calculateLowerRadiusFromModelBoundingSphere(f,v);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.Lh),O=Z}else this._mode===U.IgnoreBoundsSizeMode&&(O=this._calculateLowerRadiusFromModelBoundingSphere(f,v),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Lh));if(this.autoCorrectCameraLimitsAndSensibility){const Z=v.Fv(f).length();this._attachedCamera.panningSensibility=5e3/Z,this._attachedCamera.wheelPrecision=100/O}return this._radiusTransition||(this._radiusTransition=X.b.CreateAnimation("radius",X.b.ANIMATIONTYPE_FLOAT,60,U.EasingFunction)),H=X.b.TransitionTo("radius",O,this._attachedCamera,this._attachedCamera.Yf(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),h&&h(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),H&&this._animatables.push(H),!0}_calculateLowerRadiusFromModelBoundingSphere(f,v){const Z=this._attachedCamera;if(!Z)return 0;let V=Z._calculateLowerRadiusFromModelBoundingSphere(f,v,this._radiusScale);return Z.lowerRadiusLimit&&this._mode===U.IgnoreBoundsSizeMode&&(V=V<Z.lowerRadiusLimit?Z.lowerRadiusLimit:V),Z.upperRadiusLimit&&(V=V>Z.upperRadiusLimit?Z.upperRadiusLimit:V),V}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const f=u.b.Now-this._lastInteractionTime,v=.5*Math.PI-this._defaultElevation,Z=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Z&&f>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=X.b.CreateAnimation("beta",X.b.ANIMATIONTYPE_FLOAT,60,U.EasingFunction));const f=X.b.TransitionTo("beta",v,this._attachedCamera,this._attachedCamera.Yf(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));f&&this._animatables.push(f)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=u.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}U.EasingFunction=new b.s,U.EasingMode=b.p.EASINGMODE_EASEINOUT,U.IgnoreBoundsSizeMode=0,U.FitFrustumSidesMode=1;var K=Z(11863),M=Z(11889),A=Z(13046),s=Z(11230);class z{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(f){f=s.Tools.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),Z=v.getInputElement();let V=0,h=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=J=>{var l,e;const C=J.event,H="touch"===C.pointerType;if(J.type!==O.c.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const u=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,v.isPointerLock){const f=C.movementX,v=C.movementY;this.onTouch(null,f,v),this._pointA=null,this._pointB=null}else{if(J.type!==O.c.POINTERDOWN&&J.type!==O.c.POINTERDOUBLETAP&&H&&(null===(l=this._pointA)||void 0===l?void 0:l.pointerId)!==C.pointerId&&(null===(e=this._pointB)||void 0===e?void 0:e.pointerId)!==C.pointerId)return;if(J.type!==O.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!H)if(J.type===O.c.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(J.type!==O.c.POINTERUP||this._currentMousePointerIdDown!==C.pointerId&&!H){if(J.type===O.c.POINTERMOVE)if(f||C.preventDefault(),this._pointA&&null===this._pointB){const f=C.clientX-this._pointA.x,v=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,f,v)}else if(this._pointA&&this._pointB){const f=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;f.x=C.clientX,f.y=C.clientY;const v=this._pointA.x-this._pointB.x,Z=this._pointA.y-this._pointB.y,l=v*v+Z*Z,e={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:J.type};this.onMultiTouch(this._pointA,this._pointB,V,l,h,e),h=e,V=l}}else{try{null===u||void 0===u||u.releasePointerCapture(C.pointerId)}catch(W){}H||(this._pointB=null),v._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==V||h)&&(this.onMultiTouch(this._pointA,this._pointB,V,0,h,null),V=0,h=null),this._currentMousePointerIdDown=-1,this.onButtonUp(C),f||C.preventDefault()}else{try{null===u||void 0===u||u.setPointerCapture(C.pointerId)}catch(W){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentMousePointerIdDown||H||(this._currentMousePointerIdDown=C.pointerId),this.onButtonDown(C),f||(C.preventDefault(),Z&&Z.focus())}}},this._observer=this.camera.Yf()._inputManager._addCameraPointerObserver(this._pointerInput,O.c.POINTERDOWN|O.c.POINTERUP|O.c.POINTERMOVE|O.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,V=0,h=null,this.onLostFocus()},this._contextMenuBind=f=>this.onContextMenu(f),Z&&Z.addEventListener("contextmenu",this._contextMenuBind,!1);const J=this.camera.Yf().getEngine().getHostWindow();J&&s.Tools.RegisterTopRootEvents(J,[{name:"blur",handler:this._onLostFocus}])}tu(){if(this._onLostFocus){const f=this.camera.Yf().getEngine().getHostWindow();f&&s.Tools.UnregisterTopRootEvents(f,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Yf()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const f=this.camera.Yf().getEngine().getInputElement();f&&f.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(f){}onTouch(f,v,Z){}onMultiTouch(f,v,Z,V,h,J){}onContextMenu(f){f.preventDefault()}onButtonDown(f){}onButtonUp(f){}onLostFocus(){}}(0,V.d)([(0,h.F)()],z.prototype,"buttons",void 0);class Y extends z{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(f,v){if(0!==this.panningSensibility&&f&&v){const Z=v.x-f.x,V=v.y-f.y;this.camera.inertialPanningX+=-Z/this.panningSensibility,this.camera.inertialPanningY+=V/this.panningSensibility}}_computePinchZoom(f,v){const Z=this.camera.radius||Y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Z*Math.sqrt(f)/Math.sqrt(v):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(v-f)*Z*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(v-f)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(f,v,Z){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=Z/this.panningSensibility):(this.camera.inertialAlphaOffset-=v/this.angularSensibilityX,this.camera.inertialBetaOffset-=Z/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(f,v,Z,V,h,J){0===Z&&null===h||0===V&&null===J||(this.multiTouchPanAndZoom?(this._computePinchZoom(Z,V),this._computeMultiTouchPanning(h,J)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(V)-Math.sqrt(Z))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Z,V),this._isPinching=!0):this._computeMultiTouchPanning(h,J)):this.multiTouchPanning?this._computeMultiTouchPanning(h,J):this.pinchZoom&&this._computePinchZoom(Z,V))}onButtonDown(f){this._isPanClick=f.button===this.camera._panningMouseButton}onButtonUp(f){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Y.MinimumRadiusForPinch=.001,(0,V.d)([(0,h.F)()],Y.prototype,"buttons",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"angularSensibilityX",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"angularSensibilityY",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"pinchPrecision",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"pinchDeltaPercentage",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"useNaturalPinchZoom",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"pinchZoom",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"panningSensibility",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"multiTouchPanning",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"multiTouchPanAndZoom",void 0),A.c.ArcRotateCameraPointersInput=Y;var y=Z(11697);class N{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(f){f=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Yf(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const Z=v.event;if(!Z.metaKey)if(v.type===y.d.KEYDOWN){if(this._ctrlPressed=Z.ctrlKey,this._altPressed=Z.altKey,-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysReset.indexOf(Z.keyCode)){-1===this._keys.indexOf(Z.keyCode)&&this._keys.push(Z.keyCode),Z.preventDefault&&(f||Z.preventDefault())}}else if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysReset.indexOf(Z.keyCode)){const v=this._keys.indexOf(Z.keyCode);v>=0&&this._keys.splice(v,1),Z.preventDefault&&(f||Z.preventDefault())}})))}tu(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const f=this.camera;for(let v=0;v<this._keys.length;v++){const Z=this._keys[v];-1!==this.keysLeft.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningX-=1/this.panningSensibility:f.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?f.inertialRadiusOffset+=1/this.zoomingSensibility:f.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningX+=1/this.panningSensibility:f.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?f.inertialRadiusOffset-=1/this.zoomingSensibility:f.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Z)&&f.useInputToRestoreState&&f.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,V.d)([(0,h.F)()],N.prototype,"keysUp",void 0),(0,V.d)([(0,h.F)()],N.prototype,"keysDown",void 0),(0,V.d)([(0,h.F)()],N.prototype,"keysLeft",void 0),(0,V.d)([(0,h.F)()],N.prototype,"keysRight",void 0),(0,V.d)([(0,h.F)()],N.prototype,"keysReset",void 0),(0,V.d)([(0,h.F)()],N.prototype,"panningSensibility",void 0),(0,V.d)([(0,h.F)()],N.prototype,"zoomingSensibility",void 0),(0,V.d)([(0,h.F)()],N.prototype,"useAltToZoom",void 0),(0,V.d)([(0,h.F)()],N.prototype,"angularSpeed",void 0),A.c.ArcRotateCameraKeyboardMoveInput=N;var i=Z(11478),I=Z(11702);class T{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new l.Xv(0,0,0),this._globalOffset=new l.Xv(0,0,0),this._inertialPanning=l.Xv.Zero()}_computeDeltaFromMouseWheelLegacyEvent(f,v){let Z=0;const V=.01*f*this.wheelDeltaPercentage*v;return Z=f>0?V/(1+this.wheelDeltaPercentage):V*(1+this.wheelDeltaPercentage),Z}attachControl(f){f=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==O.c.POINTERWHEEL)return;const Z=v.event;let V=0;const h=Z.deltaMode===I.e.DOM_DELTA_LINE?40:1,J=-Z.deltaY*h;if(this.customComputeDeltaFromMouseWheel)V=this.customComputeDeltaFromMouseWheel(J,this,Z);else if(this.wheelDeltaPercentage){if(V=this._computeDeltaFromMouseWheelLegacyEvent(J,this.camera.radius),V>0){let f=this.camera.radius,v=this.camera.inertialRadiusOffset+V;for(let Z=0;Z<20&&!(f<=v)&&!(Math.abs(v*this.camera.inertia)<.001);Z++)f-=v,v*=this.camera.inertia;f=(0,e.Clamp)(f,0,Number.MAX_VALUE),V=this._computeDeltaFromMouseWheelLegacyEvent(J,f)}}else V=J/(40*this.wheelPrecision);V&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(V)):this.camera.inertialRadiusOffset+=V),Z.preventDefault&&(f||Z.preventDefault())},this._observer=this.camera.Yf()._inputManager._addCameraPointerObserver(this._wheel,O.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Ve(0)}tu(){this._observer&&(this.camera.Yf()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const f=this.camera;0+f.inertialAlphaOffset+f.inertialBetaOffset+f.inertialRadiusOffset&&(this._updateHitPlane(),f.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(f.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const f=this.camera,v=f.target.Fv(f.position);this._hitPlane=i.e.FromPositionAndNormal(f.target,v)}_getPosition(){const f=this.camera,v=f.Yf(),Z=v.createPickingRay(v.pointerX,v.pointerY,l.Matrix.Identity(),f,!1);0===f.targetScreenOffset.x&&0===f.targetScreenOffset.y||(this._viewOffset.set(f.targetScreenOffset.x,f.targetScreenOffset.y,0),f.getViewMatrix().invertToRef(f._cameraTransformMatrix),this._globalOffset=l.Xv.TransformNormal(this._viewOffset,f._cameraTransformMatrix),Z.origin.addInPlace(this._globalOffset));let V=0;return this._hitPlane&&(V=Z.intersectsPlane(this._hitPlane)??0),Z.origin.addInPlace(Z.direction.scaleInPlace(V))}_zoomToMouse(f){const v=this.camera,Z=1-v.inertia;if(v.lowerRadiusLimit){const V=v.lowerRadiusLimit??0;v.radius-(v.inertialRadiusOffset+f)/Z<V&&(f=(v.radius-V)*Z-v.inertialRadiusOffset)}if(v.upperRadiusLimit){const V=v.upperRadiusLimit??0;v.radius-(v.inertialRadiusOffset+f)/Z>V&&(f=(v.radius-V)*Z-v.inertialRadiusOffset)}const V=f/Z/v.radius,h=this._getPosition(),J=l.TmpVectors.Xv[6];h.subtractToRef(v.target,J),J.scaleInPlace(V),J.scaleInPlace(Z),this._inertialPanning.addInPlace(J),v.inertialRadiusOffset+=f}_zeroIfClose(f){Math.abs(f.x)<W.c&&(f.x=0),Math.abs(f.y)<W.c&&(f.y=0),Math.abs(f.z)<W.c&&(f.z=0)}}(0,V.d)([(0,h.F)()],T.prototype,"wheelPrecision",void 0),(0,V.d)([(0,h.F)()],T.prototype,"zoomToMouseLocation",void 0),(0,V.d)([(0,h.F)()],T.prototype,"wheelDeltaPercentage",void 0),A.c.ArcRotateCameraMouseWheelInput=T;class B extends A.d{constructor(f){super(f)}addMouseWheel(){return this.add(new T),this}addPointers(){return this.add(new Y),this}addKeyboard(){return this.add(new N),this}}var P=Z(11372);function g(f,v){return isNaN(f)?v:f}C.c.AddNodeConstructor("ArcRotateCamera",((f,v)=>()=>new w(f,0,0,1,l.Xv.Zero(),v)));class w extends M.e{get target(){return this._target}set target(f){this.setTarget(f)}get targetHost(){return this._targetHost}set targetHost(f){f&&this.setTarget(f)}getTarget(){return this.target}get position(){return this._position}set position(f){this.setPosition(f)}set upVector(f){this._upToYMatrix||(this._yToUpMatrix=new l.Matrix,this._upToYMatrix=new l.Matrix,this._upVector=l.Xv.Zero()),f.normalize(),this._upVector.h(f),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){l.Matrix.RotationAlignToRef(l.Xv.UpReadOnly,this._upVector,this._yToUpMatrix),l.Matrix.RotationAlignToRef(this._upVector,l.Xv.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const f=this.inputs.attached.pointers;return f?f.angularSensibilityX:0}set angularSensibilityX(f){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityX=f)}get angularSensibilityY(){const f=this.inputs.attached.pointers;return f?f.angularSensibilityY:0}set angularSensibilityY(f){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityY=f)}get pinchPrecision(){const f=this.inputs.attached.pointers;return f?f.pinchPrecision:0}set pinchPrecision(f){const v=this.inputs.attached.pointers;v&&(v.pinchPrecision=f)}get pinchDeltaPercentage(){const f=this.inputs.attached.pointers;return f?f.pinchDeltaPercentage:0}set pinchDeltaPercentage(f){const v=this.inputs.attached.pointers;v&&(v.pinchDeltaPercentage=f)}get useNaturalPinchZoom(){const f=this.inputs.attached.pointers;return!!f&&f.useNaturalPinchZoom}set useNaturalPinchZoom(f){const v=this.inputs.attached.pointers;v&&(v.useNaturalPinchZoom=f)}get panningSensibility(){const f=this.inputs.attached.pointers;return f?f.panningSensibility:0}set panningSensibility(f){const v=this.inputs.attached.pointers;v&&(v.panningSensibility=f)}get keysUp(){const f=this.inputs.attached.keyboard;return f?f.keysUp:[]}set keysUp(f){const v=this.inputs.attached.keyboard;v&&(v.keysUp=f)}get keysDown(){const f=this.inputs.attached.keyboard;return f?f.keysDown:[]}set keysDown(f){const v=this.inputs.attached.keyboard;v&&(v.keysDown=f)}get keysLeft(){const f=this.inputs.attached.keyboard;return f?f.keysLeft:[]}set keysLeft(f){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=f)}get keysRight(){const f=this.inputs.attached.keyboard;return f?f.keysRight:[]}set keysRight(f){const v=this.inputs.attached.keyboard;v&&(v.keysRight=f)}get wheelPrecision(){const f=this.inputs.attached.mousewheel;return f?f.wheelPrecision:0}set wheelPrecision(f){const v=this.inputs.attached.mousewheel;v&&(v.wheelPrecision=f)}get zoomToMouseLocation(){const f=this.inputs.attached.mousewheel;return!!f&&f.zoomToMouseLocation}set zoomToMouseLocation(f){const v=this.inputs.attached.mousewheel;v&&(v.zoomToMouseLocation=f)}get wheelDeltaPercentage(){const f=this.inputs.attached.mousewheel;return f?f.wheelDeltaPercentage:0}set wheelDeltaPercentage(f){const v=this.inputs.attached.mousewheel;v&&(v.wheelDeltaPercentage=f)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(f){f!==this.useBouncingBehavior&&(f?(this._bouncingBehavior=new F,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(f){f!==this.useFramingBehavior&&(f?(this._framingBehavior=new U,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(f){f!==this.useAutoRotationBehavior&&(f?(this._autoRotationBehavior=new a,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(f,v,Z,V,h,e){var C;let H=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(f,l.Xv.Zero(),e,H),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=l.Xv.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=l.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new l.Matrix,this.panningAxis=new l.Xv(1,1,0),this._transformedDirection=new l.Xv,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new J.c,this.checkCollisions=!1,this.collisionRadius=new l.Xv(.5,.5,.5),this._previousPosition=l.Xv.Zero(),this._collisionVelocity=l.Xv.Zero(),this._newPosition=l.Xv.Zero(),this._computationVector=l.Xv.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new l.Xv(NaN,NaN,NaN),this._goalTargetScreenOffset=new l.Vector2(NaN,NaN),this._onCollisionPositionChange=function(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z?(C.setPosition(v),C.Ua&&C.Ua(Z)):C._previousPosition.h(C._position);const V=Math.cos(C.alpha),h=Math.sin(C.alpha),J=Math.cos(C.beta);let l=Math.sin(C.beta);0===l&&(l=1e-4);const e=C._getTargetPosition();C._computationVector.fe(C.radius*V*l,C.radius*J,C.radius*h*l),e.addToRef(C._computationVector,C._newPosition),C._position.h(C._newPosition);let H=C.upVector;C.allowUpsideDown&&C.beta<0&&(H=H.clone(),H=H.negate()),C._computeViewMatrix(C._position,e,H),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=l.Xv.Zero(),h&&this.setTarget(h),this.alpha=v,this.beta=Z,this.radius=V,this.getViewMatrix(),this.inputs=new B(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new l.Xv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=l.Vector2.Zero()}_updateCache(f){f||super._updateCache(),this._cache._target.h(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.h(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const f=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?f.addToRef(this._targetBoundingCenter,this._target):this._target.h(f)}const f=this._getLockedTargetPosition();return f||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>W.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,J=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=J?this._currentInterpolationFactor=J:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=g(f,this._goalAlpha),this._goalBeta=g(v,this._goalBeta),this._goalRadius=g(Z,this._goalRadius),this._goalTarget.set(g(V.x,this._goalTarget.x),g(V.y,this._goalTarget.y),g(V.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(g(h.x,this._goalTargetScreenOffset.x),g(h.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,e.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,e.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,e.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,e.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(f,v){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const h=arguments;v=s.Tools.BackCompatCameraNoPreventDefault(h),this._useCtrlForPanning=Z,this._panningMouseButton=V,"boolean"===typeof h[0]&&(h.length>1&&(this._useCtrlForPanning=h[1]),h.length>2&&(this._panningMouseButton=h[2])),this.inputs.attachElement(v),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}tu(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let f=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){f=!0;const v=this.invertRotation?-1:1,Z=this._calculateHandednessMultiplier();let V=this.inertialAlphaOffset*Z;this.beta<0&&(V*=-1),this.alpha+=V*v,this.beta+=this.inertialBetaOffset*v,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<W.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<W.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*W.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){f=!0;const v=new l.Xv(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),v.multiplyInPlace(this.panningAxis),l.Xv.TransformNormalToRef(v,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const f=this.upVector,v=l.Xv.CrossToRef(this._transformedDirection,f,this._transformedDirection);l.Xv.CrossToRef(f,v,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);l.Xv.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.h(this._transformedDirection)}else{if(this.parent){const f=l.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.transposeToRef(f),l.Xv.TransformCoordinatesToRef(this._transformedDirection,f,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*W.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*W.c&&(this.inertialPanningY=0)}if(f)this.stopInterpolation();else if(this._isInterpolating){let f=!1;const v=this._scene.getEngine().getDeltaTime()/1e3,Z=1-Math.pow(2,-v/this._currentInterpolationFactor),V=g(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const v=l.TmpVectors.Xv[0].set(g(this._goalTarget.x,this._target.x),g(this._goalTarget.y,this._target.y),g(this._goalTarget.z,this._target.z));l.Xv.LerpToRef(this.target,v,Z,this._target),10*l.Xv.Distance(this.target,v)/V<W.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.h(v),this.setTarget(this.target,!1,!0,!0)):f=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const v=l.Quaternion.RotationAlphaBetaGammaToRef(g(this._goalAlpha,this.alpha),g(this._goalBeta,this.beta),0,l.TmpVectors.Quaternion[0]),V=l.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,l.TmpVectors.Quaternion[1]),h=l.Quaternion.SlerpToRef(V,v,Z,l.TmpVectors.Quaternion[2]);h.normalize();const J=h.toAlphaBetaGammaToRef(l.TmpVectors.Xv[0]);if(this.alpha=J.x,this.beta=J.y,h.isApprox(v,W.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const f=v.toAlphaBetaGammaToRef(l.TmpVectors.Xv[0]);this.alpha=f.x,this.beta=f.y}else f=!0}if(isNaN(this._goalRadius)||(this.radius+=(V-this.radius)*Z,Math.abs(V/this.radius-1)<W.c?(this._goalRadius=NaN,this.radius=V):f=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const v=l.TmpVectors.Vector2[0].set(g(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),g(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));l.Vector2.LerpToRef(this.targetScreenOffset,v,Z,this.targetScreenOffset),l.Vector2.Distance(this.targetScreenOffset,v)<W.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.h(v)):f=!0}this._isInterpolating=f}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||l.Xv.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const f=this.alpha;var v,Z;this.alpha=function(f){let v=Math.PI/2;return 0===f.x&&0===f.z||(v=Math.acos(f.x/Math.sqrt(Math.pow(f.x,2)+Math.pow(f.z,2)))),f.z<0&&(v=2*Math.PI-v),v}(this._computationVector),this.beta=(v=this._computationVector.y,Z=this.radius,Math.acos(v/Z));const V=Math.round((f-this.alpha)/(2*Math.PI));this.alpha+=2*V*Math.PI,this._checkLimits()}setPosition(f){this._position.equals(f)||(this._position.h(f),this.rebuildAnglesAndRadius())}setTarget(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(V=this.overrideCloneAlphaBetaRadius??V,f.jh)v&&f.getBoundingInfo?this._targetBoundingCenter=f.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,f.jh(),this._targetHost=f,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const v=f,V=this._getTargetPosition();if(V&&!Z&&V.equals(v))return;this._targetHost=null,this._target=v,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}V||this.rebuildAnglesAndRadius()}_getViewMatrix(){const f=Math.cos(this.alpha),v=Math.sin(this.alpha),Z=Math.cos(this.beta);let V=Math.sin(this.beta);0===V&&(V=1e-4),0===this.radius&&(this.radius=1e-4);const h=this._getTargetPosition();if(this._computationVector.fe(this.radius*f*V,this.radius*Z,this.radius*v*V),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||l.Xv.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),h.addToRef(this._computationVector,this._newPosition),this.Yf().collisionsEnabled&&this.checkCollisions){const f=this.Yf().collisionCoordinator;this._collider||(this._collider=f.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,f.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.h(this._newPosition);let f=this.upVector;this.allowUpsideDown&&V<0&&(f=f.negate()),this._computeViewMatrix(this._position,h,f),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.h(h),this._viewMatrix}zoomOn(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f=f||this.Yf().meshes;const Z=H.d.MinMax(f);let V=this._calculateLowerRadiusFromModelBoundingSphere(Z.min,Z.max);if(V=Math.max(Math.min(V,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=V*this.zoomOnFactor,this.mode===K.d.ORTHOGRAPHIC_CAMERA){const f=this.Yf().getEngine().getAspectRatio(this),v=V*this.zoomOnFactor/2;this.orthoLeft=-v*f,this.orthoRight=v*f,this.orthoBottom=-v,this.orthoTop=v}this.focusOn({min:Z.min,max:Z.max,distance:V},v)}focusOn(f){let v,Z,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===f.min){const V=f||this.Yf().meshes;v=H.d.MinMax(V),Z=l.Xv.Distance(v.min,v.max)}else{v=f,Z=f.distance}this._target=H.d.Center(v),V||(this.maxZ=2*Z)}createRigCamera(f,v){let Z=0;switch(this.cameraRigMode){case K.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case K.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case K.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case K.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case K.d.RIG_MODE_VR:Z=this._cameraRigParams.stereoHalfAngle*(0===v?1:-1);break;case K.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z=this._cameraRigParams.stereoHalfAngle*(0===v?-1:1)}const V=new w(f,this.alpha+Z,this.beta,this.radius,this._target,this.Yf());return V._cameraRigParams={},V.isRigCamera=!0,V.rigParent=this,V.upVector=this.upVector,V.mode=this.mode,V.orthoLeft=this.orthoLeft,V.orthoRight=this.orthoRight,V.orthoBottom=this.orthoBottom,V.orthoTop=this.orthoTop,V}_updateRigCameras(){const f=this._rigCameras[0],v=this._rigCameras[1];switch(f.beta=v.beta=this.beta,this.cameraRigMode){case K.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case K.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case K.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case K.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case K.d.RIG_MODE_VR:f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case K.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const V=l.Xv.Distance(f,v),h=this.Yf().getEngine().getAspectRatio(this),J=Math.tan(this.fov/2),e=J*h,C=.5*V*Z,H=C*Math.sqrt(1+1/(e*e)),O=C*Math.sqrt(1+1/(J*J));return Math.max(H,O)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,V.d)([(0,h.F)()],w.prototype,"alpha",void 0),(0,V.d)([(0,h.F)()],w.prototype,"beta",void 0),(0,V.d)([(0,h.F)()],w.prototype,"radius",void 0),(0,V.d)([(0,h.F)()],w.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,V.d)([(0,h.E)("target")],w.prototype,"_target",void 0),(0,V.d)([(0,h.s)("targetHost")],w.prototype,"_targetHost",void 0),(0,V.d)([(0,h.F)()],w.prototype,"inertialAlphaOffset",void 0),(0,V.d)([(0,h.F)()],w.prototype,"inertialBetaOffset",void 0),(0,V.d)([(0,h.F)()],w.prototype,"inertialRadiusOffset",void 0),(0,V.d)([(0,h.F)()],w.prototype,"lowerAlphaLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"upperAlphaLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"lowerBetaLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"upperBetaLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"lowerRadiusLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"upperRadiusLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"lowerTargetYLimit",void 0),(0,V.d)([(0,h.F)()],w.prototype,"inertialPanningX",void 0),(0,V.d)([(0,h.F)()],w.prototype,"inertialPanningY",void 0),(0,V.d)([(0,h.F)()],w.prototype,"pinchToPanMaxDistance",void 0),(0,V.d)([(0,h.F)()],w.prototype,"panningDistanceLimit",void 0),(0,V.d)([(0,h.E)()],w.prototype,"panningOriginTarget",void 0),(0,V.d)([(0,h.F)()],w.prototype,"panningInertia",void 0),(0,V.d)([(0,h.F)()],w.prototype,"zoomToMouseLocation",null),(0,V.d)([(0,h.F)()],w.prototype,"zoomOnFactor",void 0),(0,V.d)([(0,h.B)()],w.prototype,"targetScreenOffset",void 0),(0,V.d)([(0,h.F)()],w.prototype,"allowUpsideDown",void 0),(0,V.d)([(0,h.F)()],w.prototype,"useInputToRestoreState",void 0),(0,V.d)([(0,h.F)()],w.prototype,"restoreStateInterpolationFactor",void 0),(0,P.h)("BABYLON.ArcRotateCamera",w)},13046:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>l,d:()=>e});var V=Z(11247),h=Z(11462),J=Z(11863),l={};class e{constructor(f){this.attachedToElement=!1,this.attached={},this.camera=f,this.checkInputs=()=>{}}add(f){const v=f.getSimpleName();this.attached[v]?V.e.Warn("camera input of type "+v+" already exists on camera"):(this.attached[v]=f,f.camera=this.camera,f.checkInputs&&(this.checkInputs=this._addCheckInputs(f.checkInputs.bind(f))),this.attachedToElement&&f.attachControl(this.noPreventDefault))}remove(f){for(const v in this.attached){const Z=this.attached[v];if(Z===f)return Z.tu(),Z.camera=null,delete this.attached[v],void this.rebuildInputCheck()}}removeByType(f){for(const v in this.attached){const Z=this.attached[v];Z.getClassName()===f&&(Z.tu(),Z.camera=null,delete this.attached[v],this.rebuildInputCheck())}}_addCheckInputs(f){const v=this.checkInputs;return()=>{v(),f()}}attachInput(f){this.attachedToElement&&f.attachControl(this.noPreventDefault)}attachElement(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){f=!J.d.ForceAttachControlToAlwaysPreventDefault&&f,this.attachedToElement=!0,this.noPreventDefault=f;for(const v in this.attached)this.attached[v].attachControl(f)}}detachElement(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const v in this.attached)this.attached[v].tu(),f&&(this.attached[v].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const f in this.attached){const v=this.attached[f];v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(f){const v={};for(const Z in this.attached){const f=this.attached[Z],V=h.b.Serialize(f);v[f.getClassName()]=V}f.inputsmgr=v}parse(f){const v=f.inputsmgr;if(v){this.clear();for(const f in v){const Z=l[f];if(Z){const V=v[f],J=h.b.Parse((()=>new Z),V,null);this.add(J)}}}else for(const Z in this.attached){const v=l[this.attached[Z].getClassName()];if(v){const V=h.b.Parse((()=>new v),f,null);this.remove(this.attached[Z]),this.add(V)}}}}},13041:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>z});var V=Z(11405),h=Z(11410),J=Z(11421),l=Z(11889),e=Z(13046),C=Z(11697),H=Z(11230);class O{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(f){f=H.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Yf(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const Z=v.event;if(!Z.metaKey)if(v.type===C.d.KEYDOWN){if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysUpward.indexOf(Z.keyCode)||-1!==this.keysDownward.indexOf(Z.keyCode)||-1!==this.keysRotateLeft.indexOf(Z.keyCode)||-1!==this.keysRotateRight.indexOf(Z.keyCode)||-1!==this.keysRotateUp.indexOf(Z.keyCode)||-1!==this.keysRotateDown.indexOf(Z.keyCode)){-1===this._keys.indexOf(Z.keyCode)&&this._keys.push(Z.keyCode),f||Z.preventDefault()}}else if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysUpward.indexOf(Z.keyCode)||-1!==this.keysDownward.indexOf(Z.keyCode)||-1!==this.keysRotateLeft.indexOf(Z.keyCode)||-1!==this.keysRotateRight.indexOf(Z.keyCode)||-1!==this.keysRotateUp.indexOf(Z.keyCode)||-1!==this.keysRotateDown.indexOf(Z.keyCode)){const v=this._keys.indexOf(Z.keyCode);v>=0&&this._keys.splice(v,1),f||Z.preventDefault()}})))}tu(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const f=this.camera;for(let v=0;v<this._keys.length;v++){const Z=this._keys[v],V=f._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Z)?f._localDirection.fe(-V,0,0):-1!==this.keysUp.indexOf(Z)?f._localDirection.fe(0,0,V):-1!==this.keysRight.indexOf(Z)?f._localDirection.fe(V,0,0):-1!==this.keysDown.indexOf(Z)?f._localDirection.fe(0,0,-V):-1!==this.keysUpward.indexOf(Z)?f._localDirection.fe(0,V,0):-1!==this.keysDownward.indexOf(Z)?f._localDirection.fe(0,-V,0):-1!==this.keysRotateLeft.indexOf(Z)?(f._localDirection.fe(0,0,0),f.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Z)?(f._localDirection.fe(0,0,0),f.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Z)?(f._localDirection.fe(0,0,0),f.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Z)&&(f._localDirection.fe(0,0,0),f.cameraRotation.x+=this._getLocalRotation()),f.Yf().useRightHandedSystem&&(f._localDirection.z*=-1),f.getViewMatrix().invertToRef(f._cameraTransformMatrix),J.Xv.TransformNormalToRef(f._localDirection,f._cameraTransformMatrix,f._transformedDirection),f.cameraDirection.addInPlace(f._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const f=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*f}}(0,V.d)([(0,h.F)()],O.prototype,"keysUp",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysUpward",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysDown",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysDownward",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysLeft",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysRight",void 0),(0,V.d)([(0,h.F)()],O.prototype,"rotationSpeed",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysRotateLeft",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysRotateRight",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysRotateUp",void 0),(0,V.d)([(0,h.F)()],O.prototype,"keysRotateDown",void 0),e.c.FreeCameraKeyboardMoveInput=O;var u=Z(11235),W=Z(11690);class a{constructor(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=f,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new u.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(f){f=H.Tools.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),Z=v.getInputElement();this._pointerInput||(this._pointerInput=V=>{const h=V.event,J="touch"===h.pointerType;if(!this.touchEnabled&&J)return;if(V.type!==W.c.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const l=h.target;if(V.type===W.c.POINTERDOWN){if(J&&-1!==this._activePointerId||!J&&-1!==this._currentActiveButton)return;this._activePointerId=h.pointerId;try{null===l||void 0===l||l.setPointerCapture(h.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=h.button),this._previousPosition={x:h.clientX,y:h.clientY},f||(h.preventDefault(),Z&&Z.focus()),v.isPointerLock&&this._onMouseMove&&this._onMouseMove(V.event)}else if(V.type===W.c.POINTERUP){if(J&&this._activePointerId!==h.pointerId||!J&&this._currentActiveButton!==h.button)return;try{null===l||void 0===l||l.releasePointerCapture(h.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,f||h.preventDefault(),this._activePointerId=-1}else if(V.type===W.c.POINTERMOVE&&(this._activePointerId===h.pointerId||!J))if(v.isPointerLock&&this._onMouseMove)this._onMouseMove(V.event);else if(this._previousPosition){const v=this.camera._calculateHandednessMultiplier(),Z=(h.clientX-this._previousPosition.x)*v,V=h.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Z/this.angularSensibility,this.camera.cameraRotation.x+=V/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Z,offsetY:V}),this._previousPosition={x:h.clientX,y:h.clientY},f||h.preventDefault()}}),this._onMouseMove=Z=>{if(!v.isPointerLock)return;const V=this.camera._calculateHandednessMultiplier(),h=Z.movementX*V;this.camera.cameraRotation.y+=h/this.angularSensibility;const J=Z.movementY;this.camera.cameraRotation.x+=J/this.angularSensibility,this._previousPosition=null,f||Z.preventDefault()},this._observer=this.camera.Yf()._inputManager._addCameraPointerObserver(this._pointerInput,W.c.POINTERDOWN|W.c.POINTERUP|W.c.POINTERMOVE),Z&&(this._contextMenuBind=f=>this.onContextMenu(f),Z.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(f){f.preventDefault()}tu(){if(this._observer){if(this.camera.Yf()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const f=this.camera.getEngine().getInputElement();f&&f.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,V.d)([(0,h.F)()],a.prototype,"buttons",void 0),(0,V.d)([(0,h.F)()],a.prototype,"angularSensibility",void 0),e.c.FreeCameraMouseInput=a;var b,X=Z(11702);class F{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new u.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(f){f=H.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==W.c.POINTERWHEEL)return;const Z=v.event,V=Z.deltaMode===X.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*V*Z.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*V*Z.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*V*Z.deltaZ/this._normalize,Z.preventDefault&&(f||Z.preventDefault())},this._observer=this.camera.Yf()._inputManager._addCameraPointerObserver(this._wheel,W.c.POINTERWHEEL)}tu(){this._observer&&(this.camera.Yf()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,V.d)([(0,h.F)()],F.prototype,"wheelPrecisionX",void 0),(0,V.d)([(0,h.F)()],F.prototype,"wheelPrecisionY",void 0),(0,V.d)([(0,h.F)()],F.prototype,"wheelPrecisionZ",void 0),function(f){f[f.MoveRelative=0]="MoveRelative",f[f.RotateRelative=1]="RotateRelative",f[f.MoveScene=2]="MoveScene"}(b||(b={}));class U extends F{constructor(){super(...arguments),this._moveRelative=J.Xv.Zero(),this._rotateRelative=J.Xv.Zero(),this._moveScene=J.Xv.Zero(),this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(f){null===f&&this._wheelXAction!==b.MoveRelative||(this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=f)}get wheelXMoveRelative(){return this._wheelXAction!==b.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(f){null===f&&this._wheelYAction!==b.MoveRelative||(this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=f)}get wheelYMoveRelative(){return this._wheelYAction!==b.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(f){null===f&&this._wheelZAction!==b.MoveRelative||(this._wheelZAction=b.MoveRelative,this._wheelZActionCoordinate=f)}get wheelZMoveRelative(){return this._wheelZAction!==b.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(f){null===f&&this._wheelXAction!==b.RotateRelative||(this._wheelXAction=b.RotateRelative,this._wheelXActionCoordinate=f)}get wheelXRotateRelative(){return this._wheelXAction!==b.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(f){null===f&&this._wheelYAction!==b.RotateRelative||(this._wheelYAction=b.RotateRelative,this._wheelYActionCoordinate=f)}get wheelYRotateRelative(){return this._wheelYAction!==b.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(f){null===f&&this._wheelZAction!==b.RotateRelative||(this._wheelZAction=b.RotateRelative,this._wheelZActionCoordinate=f)}get wheelZRotateRelative(){return this._wheelZAction!==b.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(f){null===f&&this._wheelXAction!==b.MoveScene||(this._wheelXAction=b.MoveScene,this._wheelXActionCoordinate=f)}get wheelXMoveScene(){return this._wheelXAction!==b.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(f){null===f&&this._wheelYAction!==b.MoveScene||(this._wheelYAction=b.MoveScene,this._wheelYActionCoordinate=f)}get wheelYMoveScene(){return this._wheelYAction!==b.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(f){null===f&&this._wheelZAction!==b.MoveScene||(this._wheelZAction=b.MoveScene,this._wheelZActionCoordinate=f)}get wheelZMoveScene(){return this._wheelZAction!==b.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Ve(0),this._rotateRelative.Ve(0),this._moveScene.Ve(0),this._updateCamera(),this.camera.Yf().useRightHandedSystem&&(this._moveRelative.z*=-1);const f=J.Matrix.Zero();this.camera.getViewMatrix().invertToRef(f);const v=J.Xv.Zero();J.Xv.TransformNormalToRef(this._moveRelative,f,v),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(v),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(f,v,Z){if(0===f)return;if(null===v||null===Z)return;let V=null;switch(v){case b.MoveRelative:V=this._moveRelative;break;case b.RotateRelative:V=this._rotateRelative;break;case b.MoveScene:V=this._moveScene}switch(Z){case 0:V.set(f,0,0);break;case 1:V.set(0,f,0);break;case 2:V.set(0,0,f)}}}(0,V.d)([(0,h.F)()],U.prototype,"wheelXMoveRelative",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelYMoveRelative",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelZMoveRelative",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelXRotateRelative",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelYRotateRelative",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelZRotateRelative",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelXMoveScene",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelYMoveScene",null),(0,V.d)([(0,h.F)()],U.prototype,"wheelZMoveScene",null),e.c.FreeCameraMouseWheelInput=U;class K{constructor(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=f,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=H.Tools.IsSafari()}attachControl(f){f=H.Tools.BackCompatCameraNoPreventDefault(arguments);let v=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Z=>{const V=Z.event,h="mouse"===V.pointerType||this._isSafari&&"undefined"===typeof V.pointerType;if(this.allowMouse||!h)if(Z.type===W.c.POINTERDOWN){if(f||V.preventDefault(),this._pointerPressed.push(V.pointerId),1!==this._pointerPressed.length)return;v={x:V.clientX,y:V.clientY}}else if(Z.type===W.c.POINTERUP){f||V.preventDefault();const Z=this._pointerPressed.indexOf(V.pointerId);if(-1===Z)return;if(this._pointerPressed.splice(Z,1),0!=Z)return;v=null,this._offsetX=null,this._offsetY=null}else if(Z.type===W.c.POINTERMOVE){if(f||V.preventDefault(),!v)return;if(0!=this._pointerPressed.indexOf(V.pointerId))return;this._offsetX=V.clientX-v.x,this._offsetY=-(V.clientY-v.y)}}),this._observer=this.camera.Yf()._inputManager._addCameraPointerObserver(this._pointerInput,W.c.POINTERDOWN|W.c.POINTERUP|W.c.POINTERMOVE),this._onLostFocus){const f=this.camera.getEngine().getInputElement();f&&f.addEventListener("blur",this._onLostFocus)}}tu(){if(this._pointerInput){if(this._observer&&(this.camera.Yf()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const f=this.camera.getEngine().getInputElement();f&&f.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const f=this.camera,v=f._calculateHandednessMultiplier();f.cameraRotation.y=v*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)f.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const v=f._computeLocalCameraSpeed(),Z=new J.Xv(0,0,0!==this.touchMoveSensibility?v*this._offsetY/this.touchMoveSensibility:0);J.Matrix.RotationYawPitchRollToRef(f.rotation.y,f.rotation.x,0,f._cameraRotationMatrix),f.cameraDirection.addInPlace(J.Xv.TransformCoordinates(Z,f._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,V.d)([(0,h.F)()],K.prototype,"touchAngularSensibility",void 0),(0,V.d)([(0,h.F)()],K.prototype,"touchMoveSensibility",void 0),e.c.FreeCameraTouchInput=K;class M extends e.d{constructor(f){super(f),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new O),this}addMouse(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new a(f),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new K),this}clear(){super.clear(),this._mouseInput=null}}var A=Z(11372),s=Z(11318);class z extends l.e{get angularSensibility(){const f=this.inputs.attached.mouse;return f?f.angularSensibility:0}set angularSensibility(f){const v=this.inputs.attached.mouse;v&&(v.angularSensibility=f)}get keysUp(){const f=this.inputs.attached.keyboard;return f?f.keysUp:[]}set keysUp(f){const v=this.inputs.attached.keyboard;v&&(v.keysUp=f)}get keysUpward(){const f=this.inputs.attached.keyboard;return f?f.keysUpward:[]}set keysUpward(f){const v=this.inputs.attached.keyboard;v&&(v.keysUpward=f)}get keysDown(){const f=this.inputs.attached.keyboard;return f?f.keysDown:[]}set keysDown(f){const v=this.inputs.attached.keyboard;v&&(v.keysDown=f)}get keysDownward(){const f=this.inputs.attached.keyboard;return f?f.keysDownward:[]}set keysDownward(f){const v=this.inputs.attached.keyboard;v&&(v.keysDownward=f)}get keysLeft(){const f=this.inputs.attached.keyboard;return f?f.keysLeft:[]}set keysLeft(f){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=f)}get keysRight(){const f=this.inputs.attached.keyboard;return f?f.keysRight:[]}set keysRight(f){const v=this.inputs.attached.keyboard;v&&(v.keysRight=f)}get keysRotateLeft(){const f=this.inputs.attached.keyboard;return f?f.keysRotateLeft:[]}set keysRotateLeft(f){const v=this.inputs.attached.keyboard;v&&(v.keysRotateLeft=f)}get keysRotateRight(){const f=this.inputs.attached.keyboard;return f?f.keysRotateRight:[]}set keysRotateRight(f){const v=this.inputs.attached.keyboard;v&&(v.keysRotateRight=f)}get keysRotateUp(){const f=this.inputs.attached.keyboard;return f?f.keysRotateUp:[]}set keysRotateUp(f){const v=this.inputs.attached.keyboard;v&&(v.keysRotateUp=f)}get keysRotateDown(){const f=this.inputs.attached.keyboard;return f?f.keysRotateDown:[]}set keysRotateDown(f){const v=this.inputs.attached.keyboard;v&&(v.keysRotateDown=f)}constructor(f,v,Z){var V;super(f,v,Z,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),V=this,this.ellipsoid=new J.Xv(.5,1,.5),this.ellipsoidOffset=new J.Xv(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=J.Xv.Zero(),this._diffPosition=J.Xv.Zero(),this._newPosition=J.Xv.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V._newPosition.h(v),V._newPosition.subtractToRef(V._oldPosition,V._diffPosition),V._diffPosition.length()>s.b.CollisionsEpsilon&&(V.position.addToRef(V._diffPosition,V._deferredPositionUpdate),V._deferOnly?V._deferredUpdated=!0:V.position.h(V._deferredPositionUpdate),V.Ua&&Z&&V.Ua(Z))},this.inputs=new M(this),this.inputs.addKeyboard().addMouse()}attachControl(f,v){v=H.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(v)}tu(){this.inputs.detachElement(),this.cameraDirection=new J.Xv(0,0,0),this.cameraRotation=new J.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(f){this._collisionMask=isNaN(f)?-1:f}_collideWithWorld(f){let v;v=this.parent?J.Xv.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,v.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Z=this.Yf().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let V=f;this.applyGravity&&(V=f.add(this.Yf().gravity)),Z.getNewPosition(this._oldPosition,V,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=J.Xv.Zero(),this._transformedDirection=J.Xv.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(f){this._needMoveForGravity=f}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Yf().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Te"}}(0,V.d)([(0,h.E)()],z.prototype,"ellipsoid",void 0),(0,V.d)([(0,h.E)()],z.prototype,"ellipsoidOffset",void 0),(0,V.d)([(0,h.F)()],z.prototype,"checkCollisions",void 0),(0,V.d)([(0,h.F)()],z.prototype,"applyGravity",void 0),(0,A.h)("BABYLON.FreeCamera",z)},13598:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>J});var V=Z(11513),h=Z(13607);class J{constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Z,this.fu=[],this._maxBlockCapacity=v||64,this._selectionContent=new V.d(1024),this._creationFunc=f}update(f,v,Z){h.e._CreateBlocks(f,v,Z,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}eO(f){for(let v=0;v<this.MO.length;v++){this.MO[v].addEntry(f)}}lO(f){for(let v=0;v<this.MO.length;v++){this.MO[v].removeEntry(f)}}select(f,v){this._selectionContent.reset();for(let Z=0;Z<this.MO.length;Z++){this.MO[Z].select(f,this._selectionContent,v)}return v?this._selectionContent.concat(this.fu):this._selectionContent.concatWithNoDuplicate(this.fu),this._selectionContent}intersects(f,v,Z){this._selectionContent.reset();for(let V=0;V<this.MO.length;V++){this.MO[V].intersects(f,v,this._selectionContent,Z)}return Z?this._selectionContent.concat(this.fu):this._selectionContent.concatWithNoDuplicate(this.fu),this._selectionContent}intersectsRay(f){this._selectionContent.reset();for(let v=0;v<this.MO.length;v++){this.MO[v].intersectsRay(f,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.fu),this._selectionContent}}J.CreationFuncForMeshes=(f,v)=>{const Z=f.getBoundingInfo();!f.isBlocked&&Z.boundingBox.intersectsMinMax(v.Ju,v.lu)&&v.entries.push(f)},J.CreationFuncForSubMeshes=(f,v)=>{f.getBoundingInfo().boundingBox.intersectsMinMax(v.Ju,v.lu)&&v.entries.push(f)}},13607:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>J});var V=Z(11421),h=Z(11744);class J{constructor(f,v,Z,V,h,J){this.entries=[],this.eu=new Array,this._capacity=Z,this._depth=V,this._maxDepth=h,this._creationFunc=J,this._minPoint=f,this._maxPoint=v,this.eu.push(f.clone()),this.eu.push(v.clone()),this.eu.push(f.clone()),this.eu[2].x=v.x,this.eu.push(f.clone()),this.eu[3].y=v.y,this.eu.push(f.clone()),this.eu[4].z=v.z,this.eu.push(v.clone()),this.eu[5].z=f.z,this.eu.push(v.clone()),this.eu[6].x=f.x,this.eu.push(v.clone()),this.eu[7].y=f.y}get Ne(){return this._capacity}get Ju(){return this._minPoint}get lu(){return this._maxPoint}addEntry(f){if(this.MO)for(let v=0;v<this.MO.length;v++){this.MO[v].addEntry(f)}else this._creationFunc(f,this),this.entries.length>this.Ne&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(f){if(this.MO){for(let v=0;v<this.MO.length;v++){this.MO[v].removeEntry(f)}return}const v=this.entries.indexOf(f);v>-1&&this.entries.splice(v,1)}addEntries(f){for(let v=0;v<f.length;v++){const Z=f[v];this.addEntry(Z)}}select(f,v,Z){if(h.b.IsInFrustum(this.eu,f)){if(this.MO){for(let V=0;V<this.MO.length;V++){this.MO[V].select(f,v,Z)}return}Z?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}}intersects(f,v,Z,V){if(h.b.IntersectsSphere(this._minPoint,this._maxPoint,f,v)){if(this.MO){for(let h=0;h<this.MO.length;h++){this.MO[h].intersects(f,v,Z,V)}return}V?Z.concat(this.entries):Z.concatWithNoDuplicate(this.entries)}}intersectsRay(f,v){if(f.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.MO){for(let Z=0;Z<this.MO.length;Z++){this.MO[Z].intersectsRay(f,v)}return}v.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){J._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(f,v,Z,h,l,e,C,H){C.MO=new Array;const O=new V.Xv((v.x-f.x)/2,(v.y-f.y)/2,(v.z-f.z)/2);for(let V=0;V<2;V++)for(let v=0;v<2;v++)for(let u=0;u<2;u++){const W=f.add(O.multiplyByFloats(V,v,u)),a=f.add(O.multiplyByFloats(V+1,v+1,u+1)),b=new J(W,a,h,l+1,e,H);b.addEntries(Z),C.MO.push(b)}}}},13611:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>O});var V=Z(11646),h=Z(11421),J=Z(11833),l=Z(12797),e=Z(11683),C=Z(13598),H=Z(11281);V.b.prototype.createOrUpdateSelectionOctree=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Z=this._getComponent(e.c.NAME_OCTREE);Z||(Z=new O(this),this.hh(Z)),this.SO||(this.SO=new C.b(C.b.CreationFuncForMeshes,f,v));const V=this.getWorldExtends();return this.SO.update(V.min,V.max,this.meshes),this.SO},Object.defineProperty(V.b.prototype,"selectionOctree",{get:function(){return this.SO},enumerable:!0,configurable:!0}),J.e.prototype.createOrUpdateSubmeshesOctree=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Z=this.Yf();let V=Z._getComponent(e.c.NAME_OCTREE);V||(V=new O(Z),Z.hh(V)),this._submeshesOctree||(this._submeshesOctree=new C.b(C.b.CreationFuncForSubMeshes,f,v)),this.jh(!0);const h=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(h.minimumWorld,h.maximumWorld,this.Bh),this._submeshesOctree};class O{constructor(f){this.name=e.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new l.d(h.Xv.Zero(),new h.Xv(1,1,1)),(f=f||H.c.LastCreatedScene)&&(this.Uv=f,this.Uv.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Uv.getActiveSubMeshCandidates=f=>this.getActiveSubMeshCandidates(f),this.Uv.getCollidingSubMeshCandidates=(f,v)=>this.getCollidingSubMeshCandidates(f,v),this.Uv.getIntersectingSubMeshCandidates=(f,v)=>this.getIntersectingSubMeshCandidates(f,v))}register(){this.Uv.onMeshRemovedObservable.add((f=>{const v=this.Uv.selectionOctree;if(void 0!==v&&null!==v){const Z=v.fu.indexOf(f);-1!==Z&&v.fu.splice(Z,1)}})),this.Uv.onMeshImportedObservable.add((f=>{const v=this.Uv.selectionOctree;void 0!==v&&null!==v&&v.eO(f)}))}getActiveMeshCandidates(){var f;return(null===(f=this.Uv.SO)||void 0===f?void 0:f.select(this.Uv.frustumPlanes))||this.Uv._getDefaultMeshCandidates()}getActiveSubMeshCandidates(f){if(f._submeshesOctree&&f.useOctreeForRenderingSelection){return f._submeshesOctree.select(this.Uv.frustumPlanes)}return this.Uv._getDefaultSubMeshCandidates(f)}getIntersectingSubMeshCandidates(f,v){if(f._submeshesOctree&&f.useOctreeForPicking){l.d.TransformToRef(v,f.getWorldMatrix(),this._tempRay);return f._submeshesOctree.intersectsRay(this._tempRay)}return this.Uv._getDefaultSubMeshCandidates(f)}getCollidingSubMeshCandidates(f,v){if(f._submeshesOctree&&f.useOctreeForCollisions){const Z=v._velocityWorldLength+Math.max(v._radius.x,v._radius.y,v._radius.z);return f._submeshesOctree.intersects(v._basePointWorld,Z)}return this.Uv._getDefaultSubMeshCandidates(f)}rebuild(){}dispose(){}}},12797:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>a});var V=Z(11646),h=Z(11863),J=Z(11428),l=Z(11421),e=Z(11437),C=Z(11738),H=Z(11678),O=Z(11281),u=Z(11704);const W={internalPickerForMesh:void 0};class a{constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.c;this.origin=f,this.direction=v,this.length=Z,this.epsilon=V}clone(){return new a(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const V=a._TmpVector3[0].fe(f.x-Z,f.y-Z,f.z-Z),h=a._TmpVector3[1].fe(v.x+Z,v.y+Z,v.z+Z);let J,l,e,C,H=0,O=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<V.x||this.origin.x>h.x)return!1}else if(J=1/this.direction.x,l=(V.x-this.origin.x)*J,e=(h.x-this.origin.x)*J,e===-1/0&&(e=1/0),l>e&&(C=l,l=e,e=C),H=Math.max(l,H),O=Math.min(e,O),H>O)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<V.y||this.origin.y>h.y)return!1}else if(J=1/this.direction.y,l=(V.y-this.origin.y)*J,e=(h.y-this.origin.y)*J,e===-1/0&&(e=1/0),l>e&&(C=l,l=e,e=C),H=Math.max(l,H),O=Math.min(e,O),H>O)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<V.z||this.origin.z>h.z)return!1}else if(J=1/this.direction.z,l=(V.z-this.origin.z)*J,e=(h.z-this.origin.z)*J,e===-1/0&&(e=1/0),l>e&&(C=l,l=e,e=C),H=Math.max(l,H),O=Math.min(e,O),H>O)return!1;return!0}intersectsBox(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(f.minimum,f.maximum,v)}intersectsSphere(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=f.center.x-this.origin.x,V=f.center.y-this.origin.y,h=f.center.z-this.origin.z,J=Z*Z+V*V+h*h,l=f.radius+v,e=l*l;if(J<=e)return!0;const C=Z*this.direction.x+V*this.direction.y+h*this.direction.z;if(C<0)return!1;return J-C*C<=e}intersectsTriangle(f,v,Z){const V=a._TmpVector3[0],h=a._TmpVector3[1],J=a._TmpVector3[2],e=a._TmpVector3[3],H=a._TmpVector3[4];v.subtractToRef(f,V),Z.subtractToRef(f,h),l.Xv.CrossToRef(this.direction,h,J);const O=l.Xv.Dot(V,J);if(0===O)return null;const u=1/O;this.origin.subtractToRef(f,e);const W=l.Xv.Dot(e,J)*u;if(W<-this.epsilon||W>1+this.epsilon)return null;l.Xv.CrossToRef(e,V,H);const b=l.Xv.Dot(this.direction,H)*u;if(b<-this.epsilon||W+b>1+this.epsilon)return null;const X=l.Xv.Dot(h,H)*u;return X>this.length?null:new C.c(1-W-b,W,X)}intersectsPlane(f){let v;const Z=l.Xv.Dot(f.normal,this.direction);if(Math.abs(Z)<9.99999997475243e-7)return null;{const V=l.Xv.Dot(f.normal,this.origin);return v=(-f.d-V)/Z,v<0?v<-9.99999997475243e-7?null:0:v}}intersectsAxis(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(f){case"y":{const f=(this.origin.y-v)/this.direction.y;return f>0?null:new l.Xv(this.origin.x+this.direction.x*-f,v,this.origin.z+this.direction.z*-f)}case"x":{const f=(this.origin.x-v)/this.direction.x;return f>0?null:new l.Xv(v,this.origin.y+this.direction.y*-f,this.origin.z+this.direction.z*-f)}case"z":{const f=(this.origin.z-v)/this.direction.z;return f>0?null:new l.Xv(this.origin.x+this.direction.x*-f,this.origin.y+this.direction.y*-f,v)}default:return null}}intersectsMesh(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const e=l.TmpVectors.Matrix[0];return f.getWorldMatrix().invertToRef(e),this._tmpRay?a.TransformToRef(this,e,this._tmpRay):this._tmpRay=a.Transform(this,e),f.intersects(this._tmpRay,v,Z,V,h,J)}intersectsMeshes(f,v,Z){Z?Z.length=0:Z=[];for(let V=0;V<f.length;V++){const h=this.intersectsMesh(f[V],v);h.hit&&Z.push(h)}return Z.sort(this._comparePickingInfo),Z}_comparePickingInfo(f,v){return f.distance<v.distance?-1:f.distance>v.distance?1:0}intersectionSegment(f,v,Z){const V=this.origin,h=l.TmpVectors.Xv[0],J=l.TmpVectors.Xv[1],e=l.TmpVectors.Xv[2],C=l.TmpVectors.Xv[3];v.subtractToRef(f,h),this.direction.scaleToRef(a._Rayl,e),V.addToRef(e,J),f.subtractToRef(V,C);const H=l.Xv.Dot(h,h),O=l.Xv.Dot(h,e),u=l.Xv.Dot(e,e),W=l.Xv.Dot(h,C),b=l.Xv.Dot(e,C),X=H*u-O*O;let F,U,K=X,M=X;X<a._Smallnum?(F=0,K=1,U=b,M=u):(F=O*b-u*W,U=H*b-O*W,F<0?(F=0,U=b,M=u):F>K&&(F=K,U=b+O,M=u)),U<0?(U=0,-W<0?F=0:-W>H?F=K:(F=-W,K=H)):U>M&&(U=M,-W+O<0?F=0:-W+O>H?F=K:(F=-W+O,K=H));const A=Math.abs(F)<a._Smallnum?0:F/K,s=Math.abs(U)<a._Smallnum?0:U/M,z=l.TmpVectors.Xv[4];e.scaleToRef(s,z);const Y=l.TmpVectors.Xv[5];h.scaleToRef(A,Y),Y.addInPlace(C);const y=l.TmpVectors.Xv[6];Y.subtractToRef(z,y);return s>0&&s<=this.length&&y.lengthSquared()<Z*Z?Y.length():-1}update(f,v,Z,V,h,J,e){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){a._RayDistant||(a._RayDistant=a.Zero()),a._RayDistant.unprojectRayToRef(f,v,Z,V,l.Matrix.IdentityReadOnly,J,e);const C=l.TmpVectors.Matrix[0];h.invertToRef(C),a.TransformToRef(a._RayDistant,C,this)}else this.unprojectRayToRef(f,v,Z,V,h,J,e);return this}static Zero(){return new a(l.Xv.Zero(),l.Xv.Zero())}static CreateNew(f,v,Z,V,h,J,l){return a.Zero().update(f,v,Z,V,h,J,l)}static CreateNewFromTo(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Matrix.IdentityReadOnly;const V=new a(new l.Xv(0,0,0),new l.Xv(0,0,0));return a.CreateFromToToRef(f,v,V,Z)}static CreateFromToToRef(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.Matrix.IdentityReadOnly;Z.origin.h(f);const h=v.subtractToRef(f,Z.direction),J=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);return Z.length=J,Z.direction.normalize(),a.TransformToRef(Z,V,Z)}static Transform(f,v){const Z=new a(new l.Xv(0,0,0),new l.Xv(0,0,0));return a.TransformToRef(f,v,Z),Z}static TransformToRef(f,v,Z){l.Xv.TransformCoordinatesToRef(f.origin,v,Z.origin),l.Xv.TransformNormalToRef(f.direction,v,Z.direction),Z.length=f.length,Z.epsilon=f.epsilon;const V=Z.direction,h=V.length();if(0!==h&&1!==h){const f=1/h;V.x*=f,V.y*=f,V.z*=f,Z.length*=h}return Z}unprojectRayToRef(f,v,Z,V,h,J,e){const C=l.TmpVectors.Matrix[0];h.multiplyToRef(J,C),C.multiplyToRef(e,C),C.invert();const H=O.c.LastCreatedEngine,u=l.TmpVectors.Xv[0];u.x=f/Z*2-1,u.y=-(v/V*2-1),u.z=null!==H&&void 0!==H&&H.useReverseDepthBuffer?1:null!==H&&void 0!==H&&H.isNDCHalfZRange?0:-1;const W=l.TmpVectors.Xv[1].fe(u.x,u.y,1-1e-8),a=l.TmpVectors.Xv[2],b=l.TmpVectors.Xv[3];l.Xv._UnprojectFromInvertedMatrixToRef(u,C,a),l.Xv._UnprojectFromInvertedMatrixToRef(W,C,b),this.origin.h(a),b.subtractToRef(a,this.direction),this.direction.normalize()}}function b(f,v,Z,V,h){let J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=a.Zero();return X(f,v,Z,V,l,h,J),l}function X(f,v,Z,V,h,J){let e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const H=f.getEngine();if(!J&&!(J=f.activeCamera))return f;const O=J.viewport,u=H.getRenderHeight(),{x:W,y:a,width:b,height:X}=O.toGlobal(H.getRenderWidth(),u),F=1/H.getHardwareScalingLevel();return v=v*F-W,Z=Z*F-(u-a-X),h.update(v,Z,b,X,V||l.Matrix.IdentityReadOnly,e?l.Matrix.IdentityReadOnly:J.getViewMatrix(),J.getProjectionMatrix(),C),f}function F(f,v,Z,V,h){if(!H.b)return f;const J=f.getEngine();if(!h&&!(h=f.activeCamera))throw new Error("Active camera not set");const e=h.viewport,C=J.getRenderHeight(),{x:O,y:u,width:W,height:a}=e.toGlobal(J.getRenderWidth(),C),b=l.Matrix.Identity(),X=1/J.getHardwareScalingLevel();return v=v*X-O,Z=Z*X-(C-u-a),V.update(v,Z,W,a,b,b,h.getProjectionMatrix()),f}function U(f,v,Z,V,h,J,l,e){const C=v(V,Z.enableDistantPicking),H=Z.intersects(C,h,l,J,V,e);return H&&H.hit?!h&&null!=f&&H.distance>=f.distance?null:H:null}function K(f,v,Z,V,h,J){let e=null;const C=!!(f.activeCameras&&f.activeCameras.length>1&&f.cameraToUseForPointers!==f.activeCamera),O=f.cameraToUseForPointers||f.activeCamera,u=W.internalPickerForMesh||U;for(let H=0;H<f.meshes.length;H++){const W=f.meshes[H];if(Z){if(!Z(W,-1))continue}else if(!W.isEnabled()||!W.isVisible||!W.oC)continue;const a=C&&W.isWorldMatrixCameraDependent(),b=W.jh(a,O);if(W.hasThinInstances&&W.YH){const f=u(e,v,W,b,!0,!0,J);if(f){if(h)return f;const C=l.TmpVectors.Matrix[1],H=W.thinInstanceGetWorldMatrices();for(let f=0;f<H.length;f++){if(Z&&!Z(W,f))continue;H[f].multiplyToRef(b,C);const l=u(e,v,W,C,V,h,J,!0);if(l&&(e=l,e.thinInstanceIndex=f,V))return e}}}else{const f=u(e,v,W,b,V,h,J);if(f&&(e=f,V))return e}}return e||new H.b}function M(f,v,Z,V){if(!H.b)return null;const h=[],J=!!(f.activeCameras&&f.activeCameras.length>1&&f.cameraToUseForPointers!==f.activeCamera),e=f.cameraToUseForPointers||f.activeCamera,C=W.internalPickerForMesh||U;for(let H=0;H<f.meshes.length;H++){const O=f.meshes[H];if(Z){if(!Z(O,-1))continue}else if(!O.isEnabled()||!O.isVisible||!O.oC)continue;const u=J&&O.isWorldMatrixCameraDependent(),W=O.jh(u,e);if(O.hasThinInstances&&O.YH){if(C(null,v,O,W,!0,!0,V)){const f=l.TmpVectors.Matrix[1],J=O.thinInstanceGetWorldMatrices();for(let l=0;l<J.length;l++){if(Z&&!Z(O,l))continue;J[l].multiplyToRef(W,f);const e=C(null,v,O,f,!1,!1,V,!0);e&&(e.thinInstanceIndex=l,h.push(e))}}}else{const f=C(null,v,O,W,!1,!1,V);f&&h.push(f)}}return h}function A(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,V=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;V||(V=f.getWorldMatrix()),v.length=Z,h?v.origin.h(h):v.origin.h(f.position);const J=l.TmpVectors.Xv[2];J.set(0,0,f._scene.useRightHandedSystem?-1:1);const e=l.TmpVectors.Xv[3];return l.Xv.TransformNormalToRef(J,V,e),l.Xv.NormalizeToRef(e,v.direction),v}var s,z;a._TmpVector3=(0,e.c)(6,l.Xv.Zero),a._RayDistant=a.Zero(),a._Smallnum=1e-8,a._Rayl=1e9,s=V.b,(z=h.d)&&(z.prototype.getForwardRay=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,v=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;return A(this,new a(l.Xv.Zero(),l.Xv.Zero(),f),f,v,Z)},z.prototype.getForwardRayToRef=function(f){return A(this,f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),s&&(u.d._IsPickingAvailable=!0,s.prototype.createPickingRay=function(f,v,Z,V){return b(this,f,v,Z,V,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),V.b.prototype.createPickingRayToRef=function(f,v,Z,V,h){return X(this,f,v,Z,V,h,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},V.b.prototype.createPickingRayInCameraSpace=function(f,v,Z){return function(f,v,Z,V){const h=a.Zero();return F(f,v,Z,h,V),h}(this,f,v,Z)},V.b.prototype.createPickingRayInCameraSpaceToRef=function(f,v,Z,V){return F(this,f,v,Z,V)},V.b.prototype.pickWithBoundingInfo=function(f,v,Z,V,h){return function(f,v,Z,V,h,J){if(!H.b)return null;const e=K(f,(V=>(f._tempPickingRay||(f._tempPickingRay=a.Zero()),X(f,v,Z,V,f._tempPickingRay,J||null),f._tempPickingRay)),V,h,!0);return e&&(e.ray=b(f,v,Z,l.Matrix.Identity(),J||null)),e}(this,f,v,Z,V,h)},V.b.prototype.aZ=function(f,v,Z,V,h,J){return function(f,v,Z,V,h,J,e){const C=K(f,((V,h)=>(f._tempPickingRay||(f._tempPickingRay=a.Zero()),X(f,v,Z,V,f._tempPickingRay,J||null,!1,h),f._tempPickingRay)),V,h,!1,e);return C&&(C.ray=b(f,v,Z,l.Matrix.Identity(),J||null)),C}(this,f,v,Z,V,h,J)},V.b.prototype.pickWithRay=function(f,v,Z,V){return function(f,v,Z,V,h){const J=K(f,(Z=>(f._pickWithRayInverseMatrix||(f._pickWithRayInverseMatrix=l.Matrix.Identity()),Z.invertToRef(f._pickWithRayInverseMatrix),f._cachedRayForTransform||(f._cachedRayForTransform=a.Zero()),a.TransformToRef(v,f._pickWithRayInverseMatrix,f._cachedRayForTransform),f._cachedRayForTransform)),Z,V,!1,h);return J&&(J.ray=v),J}(this,f,v,Z,V)},V.b.prototype.multiPick=function(f,v,Z,V,h){return function(f,v,Z,V,h,J){return M(f,(V=>b(f,v,Z,V,h||null)),V,J)}(this,f,v,Z,V,h)},V.b.prototype.multiPickWithRay=function(f,v,Z){return function(f,v,Z,V){return M(f,(Z=>(f._pickWithRayInverseMatrix||(f._pickWithRayInverseMatrix=l.Matrix.Identity()),Z.invertToRef(f._pickWithRayInverseMatrix),f._cachedRayForTransform||(f._cachedRayForTransform=a.Zero()),a.TransformToRef(v,f._pickWithRayInverseMatrix,f._cachedRayForTransform),f._cachedRayForTransform)),Z,V)}(this,f,v,Z)}},13091:(f,v,Z)=>{"use strict";var V=Z(11360),h=Z(11247),J=Z(11290),l=Z(11378),e=Z(11318),C=Z(11366);e.b.prototype._partialLoadFile=function(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(f,(f=>{Z[v]=f,Z._internalCount++,6===Z._internalCount&&V(Z)}),void 0,void 0,!0,((f,v)=>{h&&f&&h(f.status+" "+f.statusText,v)}))},e.b.prototype._cascadeLoadFiles=function(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=[];h._internalCount=0;for(let J=0;J<6;J++)this._partialLoadFile(Z[J],J,h,v,V)},e.b.prototype._cascadeLoadImgs=function(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5?arguments[5]:void 0;const l=[];l._internalCount=0;for(let e=0;e<6;e++)this._partialLoadImg(V[e],e,l,f,v,Z,h,J)},e.b.prototype._partialLoadImg=function(f,v,Z,V,h,e){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7?arguments[7]:void 0;const O=(0,l.c)();(0,J.x)(f,(f=>{Z[v]=f,Z._internalCount++,V&&V.removePendingData(O),6===Z._internalCount&&e&&e(h,Z)}),((f,v)=>{V&&V.removePendingData(O),C&&C(f,v)}),V?V.offlineProvider:null,H),V&&V.addPendingData(O)},e.b.prototype.createCubeTextureBase=function(f,v,Z,J){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,X=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,F=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,U=arguments.length>14&&void 0!==arguments[14]&&arguments[14],K=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const M=b||new V.c(this,7);M.isCube=!0,M.url=f,M.generateMipMaps=!J,M._lodGenerationScale=W,M._lodGenerationOffset=a,M._useSRGBBuffer=!!U&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!J),M!==b&&(M.label=f.substring(0,60)),this._doNotHandleContextLost||(M._extension=O,M._files=Z,M._buffer=K);const A=f;this._transformTextureUrl&&!b&&(f=this._transformTextureUrl(f));const s=O??function(f){const v=f.split("?")[0],Z=v.lastIndexOf(".");return Z>-1?v.substring(Z).toLowerCase():""}(f),z=(0,C.d)(s),Y=(f,v)=>{M.dispose(),e?e(f,v):f&&h.e.Warn(f)},y=(V,e)=>{f===A?V&&Y(V.status+" "+V.statusText,e):(h.e.Warn(`Failed to load ${f}, falling back to the ${A}`),this.createCubeTextureBase(A,v,Z,!!J,l,Y,H,O,u,W,a,M,X,F,U,K))};if(z)z.then((V=>{const h=f=>{X&&X(M,f),V.loadCubeData(f,M,u,l,((f,v)=>{Y(f,v)}))};K?h(K):Z&&6===Z.length?V.supportCascades?this._cascadeLoadFiles(v,(f=>h(f.map((f=>new Uint8Array(f))))),Z,Y):Y("Textures type does not support cascades."):this._loadFile(f,(f=>h(new Uint8Array(f))),void 0,void 0,!0,y)}));else{if(!Z||0===Z.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(v,M,((f,v)=>{F&&F(f,v)}),Z,Y)}return this._internalTexturesCache.push(M),M}},13619:(f,v,Z)=>{"use strict";Z(11247);var V=Z(11543);Z(11360),Z(11498),Z(11354),Z(11590),Z(11559);V.d},13115:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>h});var V=Z(11372);class h{constructor(f){this.value=this._toInt(f)}_toInt(f){return 0|f}add(f){return new h(this.value+f.value)}Fv(f){return new h(this.value-f.value)}multiply(f){return new h(Math.imul(this.value,f.value))}divide(f){return new h(this.value/f.value)}getClassName(){return h.ClassName}equals(f){return this.value===f.value}static FromValue(f){return new h(f)}toString(){return this.value.toString()}}h.ClassName="FlowGraphInteger",(0,V.h)("FlowGraphInteger",h)},13130:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>h,h:()=>J});var V=Z(11421);class h{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Mh=f}get m(){return this.Mh}transformVector(f){return this.transformVectorToRef(f,new V.Vector2)}transformVectorToRef(f,v){return v.x=f.x*this.Mh[0]+f.y*this.Mh[1],v.y=f.x*this.Mh[2]+f.y*this.Mh[3],v}Ph(){return this.toArray()}toArray(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let v=0;v<4;v++)f[v]=this.Mh[v];return f}bZ(f){for(let v=0;v<4;v++)this.Mh[v]=f[v];return this}multiplyToRef(f,v){const Z=f.Mh,V=this.Mh,h=v.Mh;return h[0]=Z[0]*V[0]+Z[1]*V[2],h[1]=Z[0]*V[1]+Z[1]*V[3],h[2]=Z[2]*V[0]+Z[3]*V[2],h[3]=Z[2]*V[1]+Z[3]*V[3],v}multiply(f){return this.multiplyToRef(f,new h)}divideToRef(f,v){const Z=this.Mh,V=f.Mh,h=v.Mh;return h[0]=Z[0]/V[0],h[1]=Z[1]/V[1],h[2]=Z[2]/V[2],h[3]=Z[3]/V[3],v}divide(f){return this.divideToRef(f,new h)}addToRef(f,v){const Z=this.Mh,V=f.m,h=v.m;return h[0]=Z[0]+V[0],h[1]=Z[1]+V[1],h[2]=Z[2]+V[2],h[3]=Z[3]+V[3],v}add(f){return this.addToRef(f,new h)}subtractToRef(f,v){const Z=this.Mh,V=f.m,h=v.m;return h[0]=Z[0]-V[0],h[1]=Z[1]-V[1],h[2]=Z[2]-V[2],h[3]=Z[3]-V[3],v}Fv(f){return this.subtractToRef(f,new h)}transpose(){const f=this.Mh;return new h([f[0],f[2],f[1],f[3]])}determinant(){const f=this.Mh;return f[0]*f[3]-f[1]*f[2]}inverse(){const f=this.determinant();if(0===f)throw new Error("Matrix is not invertible");const v=this.Mh,Z=1/f;return new h([v[3]*Z,-v[1]*Z,-v[2]*Z,v[0]*Z])}equals(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.Mh,V=f.m;return 0===v?Z[0]===V[0]&&Z[1]===V[1]&&Z[2]===V[2]&&Z[3]===V[3]:Math.abs(Z[0]-V[0])<v&&Math.abs(Z[1]-V[1])<v&&Math.abs(Z[2]-V[2])<v&&Math.abs(Z[3]-V[3])<v}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Mh.join(", ")})`}}class J{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Mh=f}get m(){return this.Mh}transformVector(f){return this.transformVectorToRef(f,new V.Xv)}transformVectorToRef(f,v){const Z=this.Mh;return v.x=f.x*Z[0]+f.y*Z[1]+f.z*Z[2],v.y=f.x*Z[3]+f.y*Z[4]+f.z*Z[5],v.z=f.x*Z[6]+f.y*Z[7]+f.z*Z[8],v}multiplyToRef(f,v){const Z=f.Mh,V=this.Mh,h=v.m;return h[0]=Z[0]*V[0]+Z[1]*V[3]+Z[2]*V[6],h[1]=Z[0]*V[1]+Z[1]*V[4]+Z[2]*V[7],h[2]=Z[0]*V[2]+Z[1]*V[5]+Z[2]*V[8],h[3]=Z[3]*V[0]+Z[4]*V[3]+Z[5]*V[6],h[4]=Z[3]*V[1]+Z[4]*V[4]+Z[5]*V[7],h[5]=Z[3]*V[2]+Z[4]*V[5]+Z[5]*V[8],h[6]=Z[6]*V[0]+Z[7]*V[3]+Z[8]*V[6],h[7]=Z[6]*V[1]+Z[7]*V[4]+Z[8]*V[7],h[8]=Z[6]*V[2]+Z[7]*V[5]+Z[8]*V[8],v}multiply(f){return this.multiplyToRef(f,new J)}divideToRef(f,v){const Z=this.Mh,V=f.m,h=v.m;return h[0]=Z[0]/V[0],h[1]=Z[1]/V[1],h[2]=Z[2]/V[2],h[3]=Z[3]/V[3],h[4]=Z[4]/V[4],h[5]=Z[5]/V[5],h[6]=Z[6]/V[6],h[7]=Z[7]/V[7],h[8]=Z[8]/V[8],v}divide(f){return this.divideToRef(f,new J)}addToRef(f,v){const Z=this.Mh,V=f.m,h=v.m;return h[0]=Z[0]+V[0],h[1]=Z[1]+V[1],h[2]=Z[2]+V[2],h[3]=Z[3]+V[3],h[4]=Z[4]+V[4],h[5]=Z[5]+V[5],h[6]=Z[6]+V[6],h[7]=Z[7]+V[7],h[8]=Z[8]+V[8],v}add(f){return this.addToRef(f,new J)}subtractToRef(f,v){const Z=this.Mh,V=f.m,h=v.m;return h[0]=Z[0]-V[0],h[1]=Z[1]-V[1],h[2]=Z[2]-V[2],h[3]=Z[3]-V[3],h[4]=Z[4]-V[4],h[5]=Z[5]-V[5],h[6]=Z[6]-V[6],h[7]=Z[7]-V[7],h[8]=Z[8]-V[8],v}Fv(f){return this.subtractToRef(f,new J)}toArray(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let v=0;v<9;v++)f[v]=this.Mh[v];return f}Ph(){return this.toArray()}bZ(f){for(let v=0;v<9;v++)this.Mh[v]=f[v];return this}transpose(){const f=this.Mh;return new J([f[0],f[3],f[6],f[1],f[4],f[7],f[2],f[5],f[8]])}determinant(){const f=this.Mh;return f[0]*(f[4]*f[8]-f[5]*f[7])-f[1]*(f[3]*f[8]-f[5]*f[6])+f[2]*(f[3]*f[7]-f[4]*f[6])}inverse(){const f=this.determinant();if(0===f)throw new Error("Matrix is not invertible");const v=this.Mh,Z=1/f;return new J([(v[4]*v[8]-v[5]*v[7])*Z,(v[2]*v[7]-v[1]*v[8])*Z,(v[1]*v[5]-v[2]*v[4])*Z,(v[5]*v[6]-v[3]*v[8])*Z,(v[0]*v[8]-v[2]*v[6])*Z,(v[2]*v[3]-v[0]*v[5])*Z,(v[3]*v[7]-v[4]*v[6])*Z,(v[1]*v[6]-v[0]*v[7])*Z,(v[0]*v[4]-v[1]*v[3])*Z])}equals(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.Mh,V=f.m;return 0===v?Z[0]===V[0]&&Z[1]===V[1]&&Z[2]===V[2]&&Z[3]===V[3]&&Z[4]===V[4]&&Z[5]===V[5]&&Z[6]===V[6]&&Z[7]===V[7]&&Z[8]===V[8]:Math.abs(Z[0]-V[0])<v&&Math.abs(Z[1]-V[1])<v&&Math.abs(Z[2]-V[2])<v&&Math.abs(Z[3]-V[3])<v&&Math.abs(Z[4]-V[4])<v&&Math.abs(Z[5]-V[5])<v&&Math.abs(Z[6]-V[6])<v&&Math.abs(Z[7]-V[7])<v&&Math.abs(Z[8]-V[8])<v}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Mh.join(", ")})`}}},13138:(f,v,Z)=>{"use strict";var V;function h(f,v,Z,V){switch(v){case"Animation":return V?f.animations.find((f=>f.uniqueId===Z))??null:f.animations[Z]??null;case"AnimationGroup":return V?f.animationGroups.find((f=>f.uniqueId===Z))??null:f.animationGroups[Z]??null;case"Mesh":return V?f.meshes.find((f=>f.uniqueId===Z))??null:f.meshes[Z]??null;case"Material":return V?f.materials.find((f=>f.uniqueId===Z))??null:f.materials[Z]??null;case"XO":return V?f.cameras.find((f=>f.uniqueId===Z))??null:f.cameras[Z]??null;case"Light":return V?f.lights.find((f=>f.uniqueId===Z))??null:f.lights[Z]??null;default:return null}}Z.d(v,{d:()=>h}),function(f){f.Animation="Animation",f.AnimationGroup="AnimationGroup",f.Mesh="Mesh",f.Material="Material",f.XO="XO",f.Light="Light"}(V||(V={}))},13169:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>h});var V=Z(13173);class h extends V.c{constructor(f,v){if(super(f),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),v)for(const Z of v)this._eventsSignalOutputs[Z]=this._registerSignalOutput(Z+"Event")}_executeOnTick(f){}_startPendingTasks(f){f._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(f),this._resetAfterCanceled(f)),this._preparePendingTasks(f),f._addPendingBlock(this),this.out._activateSignal(f),f._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(f){f._deleteExecutionVariable(this,"_initialized"),f._removePendingBlock(this)}}},13149:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>H});var V=Z(11378),h=Z(11372),J=Z(13158),l=Z(11235),e=Z(13110);class C extends J.d{constructor(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:V.defaultValue,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(f,v,Z),this.richType=V,this._defaultValue=h,this._optional=J,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new l.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(f){this._isDisabled!==f&&(this._isDisabled=f,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(f,v){v._getConnectionValue(this)!==f&&(v._setConnectionValue(this,f),this.onValueChangedObservable.notifyObservers(f))}resetToDefaultValue(f){f._setConnectionValue(this,this._defaultValue)}connectTo(f){this._isDisabled||super.connectTo(f)}_getValueOrDefault(f){const v=f._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(v):v}getValue(f){if(1===this.connectionType){f._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(f);const v=this._getValueOrDefault(f);return this._lastValue=v,this.richType.typeTransformer?this.richType.typeTransformer(v):v}const v=this.isConnected()?this._connectedPoint[0].getValue(f):this._getValueOrDefault(f);return this._lastValue=v,this.richType.typeTransformer?this.richType.typeTransformer(v):v}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.richType={},this.richType.serialize(f.richType),f.optional=this._optional,(0,e.g)("defaultValue",this._defaultValue,f)}}(0,h.h)("FlowGraphDataConnection",C);class H{constructor(f){var v;this.config=f,this.uniqueId=(0,V.c)(),this.name=(null===(v=this.config)||void 0===v?void 0:v.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(f){}registerDataInput(f,v,Z){const V=new C(f,0,this,v,Z);return this.dataInputs.push(V),V}registerDataOutput(f,v,Z){const V=new C(f,1,this,v,Z);return this.dataOutputs.push(V),V}getDataInput(f){return this.dataInputs.find((v=>v.name===f))}getDataOutput(f){return this.dataOutputs.find((v=>v.name===f))}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.g;if(f.uniqueId=this.uniqueId,f.config={},this.config){const Z=this.config,V=Object.keys(Z);for(const h of V)v(h,Z[h],f.config)}f.dataInputs=[],f.dataOutputs=[],f.className=this.getClassName();for(const Z of this.dataInputs){const v={};Z.serialize(v),f.dataInputs.push(v)}for(const Z of this.dataOutputs){const v={};Z.serialize(v),f.dataOutputs.push(v)}}deserialize(f){}_log(f,v,Z){var V;null===(V=f.logger)||void 0===V||V.addLogItem({action:v,XZ:Z,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13158:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>J});var V,h=Z(11378);!function(f){f[f.Input=0]="Input",f[f.Output=1]="Output"}(V||(V={}));class J{constructor(f,v,Z){this._ownerBlock=Z,this._connectedPoint=[],this.uniqueId=(0,h.c)(),this.connectedPointIds=[],this.name=f,this._connectionType=v}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(f){if(this._connectionType===f._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||f._isSingularConnection()&&f._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(f),f._connectedPoint.push(this)}disconnectFrom(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=this._connectedPoint.indexOf(f),V=f._connectedPoint.indexOf(this);-1!==Z&&-1!==V&&(v&&this._connectedPoint.splice(Z,1),f._connectedPoint.splice(V,1))}disconnectFromAll(){for(const f of this._connectedPoint)this.disconnectFrom(f,!1);this._connectedPoint.length=0}dispose(){for(const f of this._connectedPoint)this.disconnectFrom(f)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f.uniqueId=this.uniqueId,f.name=this.name,f._connectionType=this._connectionType,f.connectedPointIds=[],f.className=this.getClassName();for(const v of this._connectedPoint)f.connectedPointIds.push(v.uniqueId)}getClassName(){return"FGConnection"}deserialize(f){this.uniqueId=f.uniqueId,this.name=f.name,this._connectionType=f._connectionType,this.connectedPointIds=f.connectedPointIds}}},13107:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>M});var V,h=Z(11235),J=Z(11405),l=Z(11410),e=Z(11378),C=Z(13110),H=Z(13138),O=Z(11247);!function(f){f.ExecuteBlock="ExecuteBlock",f.ExecuteEvent="ExecuteEvent",f.TriggerConnection="TriggerConnection",f.ContextVariableSet="ContextVariableSet",f.GlobalVariableSet="GlobalVariableSet",f.GlobalVariableDelete="GlobalVariableDelete",f.GlobalVariableGet="GlobalVariableGet",f.AddConnection="AddConnection",f.GetConnectionValue="GetConnectionValue",f.SetConnectionValue="SetConnectionValue",f.ActivateSignal="ActivateSignal",f.ContextVariableGet="ContextVariableGet"}(V||(V={}));class u{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(f){if(f.time||(f.time=Date.now()),this.log.push(f),this.logToConsole){var v;const Z=null===(v=f.XZ)||void 0===v?void 0:v.value;"object"===typeof Z&&Z.getClassName?O.e.Log(`[FGLog] ${f.className}:${f.uniqueId.split("-")[0]} ${f.action} - ${JSON.stringify(Z.getClassName())}: ${Z.toString()}`):O.e.Log(`[FGLog] ${f.className}:${f.uniqueId.split("-")[0]} ${f.action} - ${JSON.stringify(f.XZ)}`)}}getItemsOfType(f){return this.log.filter((v=>v.action===f))}}class W{get enableLogging(){return this._enableLogging}set enableLogging(f){this._enableLogging!==f&&(this._enableLogging=f,this._enableLogging?(this.logger=new u,this.logger.logToConsole=!0):this.logger=null)}constructor(f){this.uniqueId=(0,e.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new h.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=f,this.assetsContext=f.assetsContext??f.Uv}hasVariable(f){return f in this._userVariables}setVariable(f,v){var Z;this._userVariables[f]=v,null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",XZ:{name:f,value:v}})}getAsset(f,v){return(0,H.d)(this.assetsContext,f,v)}getVariable(f){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",XZ:{name:f,value:this._userVariables[f]}}),this._userVariables[f]}get userVariables(){return this._userVariables}Yf(){return this._configuration.Uv}_getUniqueIdPrefixedName(f,v){return`${f.uniqueId}_${v}`}_getGlobalContextVariable(f,v){var Z;return null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",XZ:{name:f,defaultValue:v,possibleValue:this._globalContextVariables[f]}}),this._hasGlobalContextVariable(f)?this._globalContextVariables[f]:v}_setGlobalContextVariable(f,v){var Z;null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",XZ:{name:f,value:v}}),this._globalContextVariables[f]=v}_deleteGlobalContextVariable(f){var v;null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",XZ:{name:f}}),delete this._globalContextVariables[f]}_hasGlobalContextVariable(f){return f in this._globalContextVariables}_setExecutionVariable(f,v,Z){this._executionVariables[this._getUniqueIdPrefixedName(f,v)]=Z}_getExecutionVariable(f,v,Z){return this._hasExecutionVariable(f,v)?this._executionVariables[this._getUniqueIdPrefixedName(f,v)]:Z}_deleteExecutionVariable(f,v){delete this._executionVariables[this._getUniqueIdPrefixedName(f,v)]}_hasExecutionVariable(f,v){return this._getUniqueIdPrefixedName(f,v)in this._executionVariables}_hasConnectionValue(f){return f.uniqueId in this._connectionValues}_setConnectionValue(f,v){var Z;this._connectionValues[f.uniqueId]=v,null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",XZ:{connectionPointId:f.uniqueId,value:v}})}_setConnectionValueByKey(f,v){this._connectionValues[f]=v}_getConnectionValue(f){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",XZ:{connectionPointId:f.uniqueId,value:this._connectionValues[f.uniqueId]}}),this._connectionValues[f.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(f){this._pendingBlocks.includes(f)||(this._pendingBlocks.push(f),this._pendingBlocks.sort(((f,v)=>f.priority-v.priority)))}_removePendingBlock(f){const v=this._pendingBlocks.indexOf(f);-1!==v&&this._pendingBlocks.splice(v,1)}_clearPendingBlocks(){for(const f of this._pendingBlocks)f._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(f){var v;this.onNodeExecutedObservable.notifyObservers(f),null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:f.getClassName(),uniqueId:f.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(f){this._setGlobalContextVariable("timeSinceStart",f.timeSinceStart),this._setGlobalContextVariable("deltaTime",f.deltaTime);for(const Z of this._pendingBlocks){var v;null===(v=Z._executeOnTick)||void 0===v||v.call(Z,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.g;f.uniqueId=this.uniqueId,f._userVariables={};for(const V in this._userVariables)v(V,this._userVariables[V],f._userVariables);f._connectionValues={};for(const V in this._connectionValues)v(V,this._connectionValues[V],f._connectionValues);var Z;this.assetsContext!==this.Yf()&&(f._assetsContext={meshes:this.assetsContext.meshes.map((f=>f.id)),materials:this.assetsContext.materials.map((f=>f.id)),textures:this.assetsContext.textures.map((f=>f.name)),animations:this.assetsContext.animations.map((f=>f.name)),lights:this.assetsContext.lights.map((f=>f.id)),cameras:this.assetsContext.cameras.map((f=>f.id)),LW:null===(Z=this.assetsContext.LW)||void 0===Z?void 0:Z.map((f=>f.name)),skeletons:this.assetsContext.skeletons.map((f=>f.id)),fW:this.assetsContext.fW.map((f=>f.name)),geometries:this.assetsContext.geometries.map((f=>f.id)),multiMaterials:this.assetsContext.multiMaterials.map((f=>f.id)),transformNodes:this.assetsContext.transformNodes.map((f=>f.id))})}getClassName(){return"FlowGraphContext"}}(0,J.d)([(0,l.F)()],W.prototype,"uniqueId",void 0);var a=Z(13146),b=Z(11690);class X{constructor(f){this.onEventTriggeredObservable=new h.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=f,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Kh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const f=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",XZ:{timeSinceStart:this._startingTime,deltaTime:f}}),this._startingTime+=f})),this._meshPickedObserver=this._scene.onPointerObservable.add((f=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",XZ:f})}),b.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((f=>{const v=f.pointerId,Z=f.mesh,V=this._pointerUnderMeshState[v];!V&&Z?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",XZ:{pointerId:v,mesh:Z}}):V&&!Z?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",XZ:{pointerId:v,mesh:V}}):V&&Z&&V!==Z&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",XZ:{pointerId:v,mesh:V,over:Z}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",XZ:{pointerId:v,mesh:Z,out:V}})),this._pointerUnderMeshState[v]=Z}),b.c.POINTERMOVE)}dispose(){var f,v,Z,V,h;null===(f=this._sceneDisposeObserver)||void 0===f||f.remove(),null===(v=this._sceneReadyObserver)||void 0===v||v.remove(),null===(Z=this._sceneOnBeforeRenderObserver)||void 0===Z||Z.remove(),null===(V=this._meshPickedObserver)||void 0===V||V.remove(),null===(h=this._meshUnderPointerObserver)||void 0===h||h.remove(),this.onEventTriggeredObservable.clear()}}var F,U=Z(13163);!function(f){f[f.Stopped=0]="Stopped",f[f.Started=1]="Started"}(F||(F={}));class K{get state(){return this._state}set state(f){this._state=f,this.onStateChangedObservable.notifyObservers(f)}constructor(f){this.onStateChangedObservable=new h.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=f.Uv,this._sceneEventCoordinator=new X(this._scene),this._coordinator=f.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((f=>{for(const v of this._executionContexts){const Z=this._getContextualOrder(f.type,v);for(const V of Z)if(!V._executeEvent(v,f.XZ))break}switch(f.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const v of this._executionContexts)v._notifyOnTick(f.XZ);break;case"SceneDispose":this.dispose()}}))}createContext(){const f=new W({Uv:this._scene,coordinator:this._coordinator});return this._executionContexts.push(f),f}getContext(f){return this._executionContexts[f]}addEventBlock(f){if("PointerOver"!==f.type&&"PointerOut"!==f.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==f.type&&this._eventBlocks[f.type].push(f),1===this.state)for(const v of this._executionContexts)f._startPendingTasks(v);else this.onStateChangedObservable.addOnce((v=>{if(1===v)for(const Z of this._executionContexts)f._startPendingTasks(Z)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((f=>{1===f&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const f of this._executionContexts)for(const v in this._eventBlocks){const Z=this._getContextualOrder(v,f);for(const v of Z)v._startPendingTasks(f)}}_getContextualOrder(f,v){const Z=this._eventBlocks[f].sort(((f,v)=>v.initPriority-f.initPriority));if("MeshPick"===f){const f=[];for(const V of Z){const h=V.asset.getValue(v);let J=0;for(;J<Z.length;J++){const f=Z[J].asset.getValue(v);if(h&&f&&(0,U.l)(h,f))break}f.splice(J,0,V)}return f}return Z}dispose(){var f;if(0!==this.state){this.state=0;for(const f of this._executionContexts)f._clearPendingBlocks();this._executionContexts.length=0;for(const f in this._eventBlocks)this._eventBlocks[f].length=0;null===(f=this._eventObserver)||void 0===f||f.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(f){const v=[],Z=new Set;for(const V in this._eventBlocks)for(const f of this._eventBlocks[V])v.push(f),Z.add(f.uniqueId);for(;v.length>0;){const V=v.pop();f(V);for(const f of V.dataInputs)for(const V of f._connectedPoint)Z.has(V._ownerBlock.uniqueId)||(v.push(V._ownerBlock),Z.add(V._ownerBlock.uniqueId));if(V instanceof a.e)for(const f of V.signalOutputs)for(const V of f._connectedPoint)Z.has(V._ownerBlock.uniqueId)||(v.push(V._ownerBlock),Z.add(V._ownerBlock.uniqueId))}}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1?arguments[1]:void 0;f.allBlocks=[],this.visitAllBlocks((v=>{const Z={};v.serialize(Z),f.allBlocks.push(Z)})),f.executionContexts=[];for(const Z of this._executionContexts){const V={};Z.serialize(V,v),f.executionContexts.push(V)}}}class M{constructor(f){this.config=f,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Uv.Kh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Uv.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const f=this._executeOnNextFrame.slice(0);if(f.length)for(const v of f){this.notifyCustomEvent(v.id,v.data,!1);const f=this._executeOnNextFrame.findIndex((f=>f.uniqueId===v.uniqueId));-1!==f&&this._executeOnNextFrame.splice(f,1)}}));(M.SceneCoordinators.get(this.config.Uv)??[]).push(this)}createGraph(){const f=new K({Uv:this.config.Uv,coordinator:this});return this._flowGraphs.push(f),f}removeGraph(f){const v=this._flowGraphs.indexOf(f);-1!==v&&(f.dispose(),this._flowGraphs.splice(v,1))}start(){for(const f of this._flowGraphs)f.start()}dispose(){var f,v;for(const h of this._flowGraphs)h.dispose();this._flowGraphs.length=0,null===(f=this._disposeObserver)||void 0===f||f.remove(),null===(v=this._onBeforeRenderObserver)||void 0===v||v.remove();const Z=M.SceneCoordinators.get(this.config.Uv)??[],V=Z.indexOf(this);-1!==V&&Z.splice(V,1)}serialize(f,v){f._flowGraphs=[];for(const Z of this._flowGraphs){const V={};Z.serialize(V,v),f._flowGraphs.push(V)}f.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(f){let v=this._customEventsMap.get(f);return v||(v=new h.c,this._customEventsMap.set(f,v)),v}notifyCustomEvent(f,v){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:f,data:v,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(f)){const v=this._eventExecutionCounter.get(f);if(this._eventExecutionCounter.set(f,v+1),v>=M.MaxEventTypeExecutionPerFrame)return void(v===M.MaxEventTypeExecutionPerFrame&&O.e.Warn(`FlowGraphCoordinator: Too many executions of event "${f}".`))}else this._eventExecutionCounter.set(f,1);const Z=this._customEventsMap.get(f);Z&&Z.notifyObservers(v)}}M.MaxEventsPerType=30,M.MaxEventTypeExecutionPerFrame=30,M.SceneCoordinators=new Map},13165:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>h});var V=Z(13169);class h extends V.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(f){f._notifyExecuteNode(this),this.done._activateSignal(f)}}},13146:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>e});var V=Z(13149),h=Z(13158),J=Z(11372);class l extends h.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(f){super.connectTo(f),this._connectedPoint.sort(((f,v)=>v.priority-f.priority))}_activateSignal(f){var v;if(null===(v=f.logger)||void 0===v||v.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,XZ:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)f._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(f,this),f._increaseExecutionId();else for(const Z of this._connectedPoint)Z._activateSignal(f)}}(0,J.h)("FlowGraphSignalConnection",l);class e extends V.c{constructor(f){super(f),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(f){const v=new l(f,0,this);return this.signalInputs.push(v),v}_registerSignalOutput(f){const v=new l(f,1,this);return this.signalOutputs.push(v),v}_unregisterSignalInput(f){const v=this.signalInputs.findIndex((v=>v.name===f));-1!==v&&(this.signalInputs[v].dispose(),this.signalInputs.splice(v,1))}_unregisterSignalOutput(f){const v=this.signalOutputs.findIndex((v=>v.name===f));-1!==v&&(this.signalOutputs[v].dispose(),this.signalOutputs.splice(v,1))}_reportError(f,v){this.error.XZ="string"===typeof v?new Error(v):v,this.error._activateSignal(f)}getSignalInput(f){return this.signalInputs.find((v=>v.name===f))}getSignalOutput(f){return this.signalOutputs.find((v=>v.name===f))}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.signalInputs=[],f.signalOutputs=[];for(const v of this.signalInputs){const Z={};v.serialize(Z),f.signalInputs.push(Z)}for(const v of this.signalOutputs){const Z={};v.serialize(Z),f.signalOutputs.push(Z)}}deserialize(f){for(let v=0;v<f.signalInputs.length;v++){const Z=this.getSignalInput(f.signalInputs[v].name);if(!Z)throw new Error("Could not find signal input with name "+f.signalInputs[v].name+" in block "+f.className);Z.deserialize(f.signalInputs[v])}for(let v=0;v<f.signalOutputs.length;v++){const Z=this.getSignalOutput(f.signalOutputs[v].name);if(!Z)throw new Error("Could not find signal output with name "+f.signalOutputs[v].name+" in block "+f.className);Z.deserialize(f.signalOutputs[v])}}getClassName(){return"FlowGraphExecutionBlock"}}},13173:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>h});var V=Z(13146);class h extends V.e{constructor(f){super(f),this.out=this._registerSignalOutput("out")}}},13123:(f,v,Z)=>{"use strict";Z.d(v,{B:()=>O,F:()=>a,J:()=>b,K:()=>X,N:()=>N,R:()=>i,S:()=>y,W:()=>Y,d:()=>H,g:()=>W,k:()=>z,o:()=>F,q:()=>U,s:()=>K,v:()=>u,x:()=>s});var V,h=Z(11421),J=Z(11472),l=Z(13115),e=Z(13130);!function(f){f.Any="any",f.String="string",f.Number="number",f.Boolean="boolean",f.Object="object",f.Integer="FlowGraphInteger",f.Vector2="Vector2",f.Xv="Xv",f.Vector4="Vector4",f.Quaternion="Quaternion",f.Matrix="Matrix",f.Matrix2D="Matrix2D",f.Matrix3D="Matrix3D",f.Mv="Mv",f.he="he"}(V||(V={}));class C{constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=f,this.defaultValue=v,this.animationType=Z}serialize(f){f.typeName=this.typeName,f.defaultValue=this.defaultValue}}const H=new C("any",void 0),O=new C("string",""),u=new C("number",0,0),W=new C("boolean",!1),a=new C("Vector2",h.Vector2.Zero(),5),b=new C("Xv",h.Xv.Zero(),1),X=new C("Vector4",h.Vector4.Zero()),F=new C("Matrix",h.Matrix.Identity(),3),U=new C("Matrix2D",new e.e),K=new C("Matrix3D",new e.h),M=new C("Mv",J.Mv.Black(),4),A=new C("he",new J.he(0,0,0,0),7),s=new C("Quaternion",h.Quaternion.Identity(),2);s.typeTransformer=f=>{if(f.getClassName){if("Vector4"===f.getClassName())return h.Quaternion.Av(f.Ph());if("Xv"===f.getClassName())return h.Quaternion.FromEulerVector(f);if("Matrix"===f.getClassName())return h.Quaternion.FromRotationMatrix(f)}return f};const z=new C("FlowGraphInteger",new l.b(0),0);function Y(f){const v=f;switch(typeof f){case"string":return O;case"number":return u;case"boolean":return W;case"object":if(v.getClassName)switch(v.getClassName()){case"Vector2":return a;case"Xv":return b;case"Vector4":return X;case"Matrix":return F;case"Mv":return M;case"he":return A;case"Quaternion":return s;case"FlowGraphInteger":return z;case"Matrix2D":return U;case"Matrix3D":return K}return H;default:return H}}function y(f){switch(f){case"string":return O;case"number":return u;case"boolean":return W;case"Vector2":return a;case"Xv":return b;case"Vector4":return X;case"Matrix":return F;case"Mv":return M;case"he":return A;case"Quaternion":return s;case"FlowGraphInteger":return z;case"Matrix2D":return U;case"Matrix3D":return K;default:return H}}function N(f){switch(f){case"number":default:return 0;case"Vector2":return 5;case"Xv":return 1;case"Matrix":return 3;case"Mv":return 4;case"he":return 7;case"Quaternion":return 2}}function i(f){switch(f){case 0:return u;case 5:return a;case 1:return b;case 3:return F;case 4:return M;case 7:return A;case 2:return s;default:return H}}},13110:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>O,g:()=>H,h:()=>u});var V=Z(11472),h=Z(11421),J=Z(13115),l=Z(13123),e=Z(13130);function C(f){return"Vector2"===f||"Xv"===f||"Vector4"===f||"Quaternion"===f||"Mv"===f||"he"===f}function H(f,v,Z){var V;const h=(null===v||void 0===v||null===(V=v.getClassName)||void 0===V?void 0:V.call(v))??"";if(C(h)||function(f){return"Matrix"===f||"Matrix2D"===f||"Matrix3D"===f}(h))Z[f]={value:v.Ph(),className:h};else if("FlowGraphInteger"===h)Z[f]={value:v.value,className:h};else if(h&&(v.id||v.name))Z[f]={id:v.id,name:v.name,className:h};else{if("object"===typeof v)throw new Error(`Could not serialize value ${v}`);Z[f]=v}}function O(f,v,Z,H){const u=v[f];let W;const a=(null===u||void 0===u?void 0:u.type)??(null===u||void 0===u?void 0:u.className);if(function(f){return"Mesh"===f||"AbstractMesh"===f||"GroundMesh"===f||"InstanceMesh"===f||"LinesMesh"===f||"GoldbergMesh"===f||"GreasedLineMesh"===f||"TrailMesh"===f}(a)){let f=H.meshes.filter((f=>u.id?f.id===u.id:f.name===u.name));0===f.length&&(f=H.transformNodes.filter((f=>u.id?f.id===u.id:f.name===u.name))),W=u.uniqueId?f.find((f=>f.uniqueId===u.uniqueId)):f[0]}else if(C(a))W=function(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===f)return h.Vector2.Av(v);if("Xv"===f)return Z&&(v[2]*=-1),h.Xv.Av(v);if("Vector4"===f)return h.Vector4.Av(v);if("Quaternion"===f)return Z&&(v[2]*=-1,v[3]*=-1),h.Quaternion.Av(v);if("Mv"===f)return new V.Mv(v[0],v[1],v[2]);if("he"===f)return new V.he(v[0],v[1],v[2],v[3]);throw new Error(`Unknown vector class name ${f}`)}(a,u.value);else if(function(f){return"AnimationGroup"===f}(a)){const f=H.animationGroups.filter((f=>f.name===u.name));W=1===f.length?f[0]:f.find((f=>f.uniqueId===u.uniqueId))}else W="Matrix"===a?h.Matrix.Av(u.value):"Matrix2D"===a?new e.e(u.value):"Matrix3D"===a?new e.h(u.value):"FlowGraphInteger"===a?J.b.FromValue(u.value):"number"===a||"string"===a||"boolean"===a?u.value[0]:u&&void 0!==u.value?u.value:Array.isArray(u)?u.reduce(((f,v)=>v.eventData?(f[v.id]={type:(0,l.S)(v.type)},"undefined"!==typeof v.value&&(f[v.id].value=O("value",v,Z,H)),f):f),{}):u;return W}function u(f){return"FlowGraphJsonPointerParserBlock"===f}},13163:(f,v,Z)=>{"use strict";function V(f,v){return!(!f.parent||f.parent!==v&&!V(f.parent,v))}function h(f){if(f.getClassName)return f.getClassName()}function J(f,v){return f===v&&("Vector2"===f||"Xv"===f||"Vector4"===f||"Quaternion"===f)}function l(f,v){return f===v&&("Matrix"===f||"Matrix2D"===f||"Matrix3D"===f)}function e(f,v){return"FlowGraphInteger"===f&&"FlowGraphInteger"===v}function C(f,v){const Z="number"===typeof f||"number"===typeof(null===f||void 0===f?void 0:f.value);return Z&&!v?!isNaN(H(f)):Z}function H(f){return"number"===typeof f?f:f.value}Z.d(v,{d:()=>e,f:()=>l,i:()=>J,j:()=>h,l:()=>V,n:()=>H,p:()=>C})},12543:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{SceneInstrumentation:()=>J});var V=Z(11230),h=Z(11614);class J{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(f){f!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=f,f?(this._onBeforeActiveMeshesEvaluationObserver=this.Uv.onBeforeActiveMeshesEvaluationObservable.add((()=>{V.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Uv.onAfterActiveMeshesEvaluationObservable.add((()=>{V.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Uv.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Uv.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(f){f!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=f,f?(this._onBeforeRenderTargetsRenderObserver=this.Uv.onBeforeRenderTargetsRenderObservable.add((()=>{V.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Uv.onAfterRenderTargetsRenderObservable.add((()=>{V.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Uv.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Uv.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(f){f!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=f,f?(this._onBeforeParticlesRenderingObserver=this.Uv.onBeforeParticlesRenderingObservable.add((()=>{V.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Uv.onAfterParticlesRenderingObservable.add((()=>{V.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Uv.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Uv.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(f){f!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=f,this.Uv.spriteManagers&&(f?(this._onBeforeSpritesRenderingObserver=this.Uv.onBeforeSpritesRenderingObservable.add((()=>{V.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Uv.onAfterSpritesRenderingObservable.add((()=>{V.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Uv.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Uv.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(f){f!==this._capturePhysicsTime&&this.Uv.onBeforePhysicsObservable&&(this._capturePhysicsTime=f,f?(this._onBeforePhysicsObserver=this.Uv.onBeforePhysicsObservable.add((()=>{V.Tools.StartPerformanceCounter("Be"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Uv.onAfterPhysicsObservable.add((()=>{V.Tools.EndPerformanceCounter("Be"),this._physicsTime.endMonitoring()}))):(this.Uv.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Uv.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(f){f!==this._captureAnimationsTime&&(this._captureAnimationsTime=f,f?this._onAfterAnimationsObserver=this.Uv.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Uv.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(f){this._captureFrameTime=f}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(f){this._captureInterFrameTime=f}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(f){f!==this._captureRenderTime&&(this._captureRenderTime=f,f?(this._onBeforeDrawPhaseObserver=this.Uv.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),V.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Uv.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),V.Tools.EndPerformanceCounter("Main render")}))):(this.Uv.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Uv.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(f){f!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=f,f?(this._onBeforeCameraRenderObserver=this.Uv.onBeforeCameraRenderObservable.add((f=>{this._cameraRenderTime.beginMonitoring(),V.Tools.StartPerformanceCounter(`Rendering camera ${f.name}`)})),this._onAfterCameraRenderObserver=this.Uv.onAfterCameraRenderObservable.add((f=>{this._cameraRenderTime.endMonitoring(!1),V.Tools.EndPerformanceCounter(`Rendering camera ${f.name}`)}))):(this.Uv.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Uv.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Uv.getEngine()._drawCalls}constructor(f){this.Uv=f,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new h.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new h.d,this._captureFrameTime=!1,this._frameTime=new h.d,this._captureRenderTime=!1,this._renderTime=new h.d,this._captureInterFrameTime=!1,this._interFrameTime=new h.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new h.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new h.d,this._capturePhysicsTime=!1,this._physicsTime=new h.d,this._captureAnimationsTime=!1,this._animationsTime=new h.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new h.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=f.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(V.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Uv.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=f.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(V.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ah(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ah(),this._captureParticlesRenderTime&&this._particlesRenderTime.ah(),this._captureSpritesRenderTime&&this._spritesRenderTime.ah(),this._captureRenderTime&&this._renderTime.ah(),this._captureCameraRenderTime&&this._cameraRenderTime.ah()}))}dispose(){this._disposed||(this.Uv.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Uv.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Uv.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Uv.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Uv.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Uv.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Uv.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Uv.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Uv.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Uv.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Uv.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Uv.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Uv.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Uv.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Uv.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Uv.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Uv.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Uv=null,this._disposed=!0)}}},13103:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>O});var V=Z(11405),h=Z(11410),J=Z(11421),l=Z(11824),e=Z(11942),C=Z(11984),H=Z(11372);l.c.AddNodeConstructor("Light_Type_1",((f,v)=>()=>new O(f,J.Xv.Zero(),v)));class O extends C.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(f){this._shadowFrustumSize=f,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(f){this._shadowOrthoScale=f,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(f){this._orthoLeft=f}get orthoRight(){return this._orthoRight}set orthoRight(f){this._orthoRight=f}get orthoTop(){return this._orthoTop}set orthoTop(f){this._orthoTop=f}get orthoBottom(){return this._orthoBottom}set orthoBottom(f){this._orthoBottom=f}constructor(f,v,Z){super(f,Z),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=v.scale(-1),this.direction=v}getClassName(){return"Pe"}getTypeID(){return e.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(f,v,Z){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(f):this._setDefaultAutoExtendShadowProjectionMatrix(f,v,Z)}_setDefaultFixedFrustumShadowProjectionMatrix(f){const v=this.Yf().activeCamera;v&&J.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:v.Lh,void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,f,this.Yf().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(f,v,Z){const V=this.Yf().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const f=J.Xv.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let V=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let l=0;l<Z.length;l++){const e=Z[l];if(!e)continue;const C=e.getBoundingInfo().boundingBox;for(let Z=0;Z<C.vectorsWorld.length;Z++)J.Xv.TransformCoordinatesToRef(C.vectorsWorld[Z],v,f),f.x<this._orthoLeft&&(this._orthoLeft=f.x),f.y<this._orthoBottom&&(this._orthoBottom=f.y),f.x>this._orthoRight&&(this._orthoRight=f.x),f.y>this._orthoTop&&(this._orthoTop=f.y),this.autoCalcShadowZBounds&&(f.z<V&&(V=f.z),f.z>h&&(h=f.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=V,this._shadowMaxZ=h)}const h=this._orthoRight-this._orthoLeft,l=this._orthoTop-this._orthoBottom,e=void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.Lh)||0,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)||1e4,H=this.Yf().getEngine().useReverseDepthBuffer;J.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-h*this.shadowOrthoScale,this._orthoRight+h*this.shadowOrthoScale,this._orthoBottom-l*this.shadowOrthoScale,this._orthoTop+l*this.shadowOrthoScale,H?C:e,H?e:C,f,this.Yf().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(f,v){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,v),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,v),this)}transferToNodeMaterialEffect(f,v){return this.computeTransformedInformation()?(f.setFloat3(v,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(f.setFloat3(v,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(f){const v=this._scene.getEngine();return!v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1}getDepthMaxZ(f){const v=this._scene.getEngine();return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1}prepareLightSpecificDefines(f,v){f["DIRLIGHT"+v]=!0}}(0,V.d)([(0,h.F)()],O.prototype,"shadowFrustumSize",null),(0,V.d)([(0,h.F)()],O.prototype,"shadowOrthoScale",null),(0,V.d)([(0,h.F)()],O.prototype,"autoUpdateExtends",void 0),(0,V.d)([(0,h.F)()],O.prototype,"autoCalcShadowZBounds",void 0),(0,V.d)([(0,h.F)("orthoLeft")],O.prototype,"_orthoLeft",void 0),(0,V.d)([(0,h.F)("orthoRight")],O.prototype,"_orthoRight",void 0),(0,V.d)([(0,h.F)("orthoTop")],O.prototype,"_orthoTop",void 0),(0,V.d)([(0,h.F)("orthoBottom")],O.prototype,"_orthoBottom",void 0),(0,H.h)("BABYLON.DirectionalLight",O)},13553:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>O});var V=Z(11405),h=Z(11410),J=Z(11421),l=Z(11472),e=Z(11824),C=Z(11942),H=Z(11372);e.c.AddNodeConstructor("Light_Type_3",((f,v)=>()=>new O(f,J.Xv.Zero(),v)));class O extends C.c{constructor(f,v,Z){super(f,Z),this.groundColor=new l.Mv(0,0,0),this.direction=v||J.Xv.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Le"}setDirectionToTarget(f){return this.direction=J.Xv.Normalize(f.Fv(J.Xv.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(f,v){const Z=J.Xv.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Z.x,Z.y,Z.z,0,v),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ke),v),this}transferToNodeMaterialEffect(f,v){const Z=J.Xv.Normalize(this.direction);return f.setFloat3(v,Z.x,Z.y,Z.z),this}jh(){return this._worldMatrix||(this._worldMatrix=J.Matrix.Identity()),this._worldMatrix}getTypeID(){return C.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(f,v){f["HEMILIGHT"+v]=!0}}(0,V.d)([(0,h.g)()],O.prototype,"groundColor",void 0),(0,V.d)([(0,h.E)()],O.prototype,"direction",void 0),(0,H.h)("BABYLON.HemisphericLight",O)},13067:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>u});var V=Z(11405),h=Z(11410),J=Z(11421),l=Z(11824),e=Z(11942),C=Z(11984),H=Z(11401),O=Z(11372);l.c.AddNodeConstructor("Light_Type_2",((f,v)=>()=>new u(f,J.Xv.Zero(),J.Xv.Zero(),0,0,v)));class u extends C.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(f){this._iesProfileTexture!==f&&(this._iesProfileTexture=f,this._iesProfileTexture&&u._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(f){this._angle=f,this._cosHalfAngle=Math.cos(.5*f),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(f){this._innerAngle=f,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(f){this._shadowAngleScale=f,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(f){this._projectionTextureLightNear=f,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(f){this._projectionTextureLightFar=f,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(f){this._projectionTextureUpDirection=f,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(f){this._projectionTexture!==f&&(this._projectionTexture=f,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(u._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):u._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(f){return void 0!==f.onGeneratedObservable}static _IsTexture(f){return void 0!==f.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(f){this._projectionTextureProjectionLightMatrix=f,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(f,v,Z,V,h,l){super(f,l),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=J.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=J.Xv.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=J.Xv.Zero(),this._projectionTextureViewLightMatrix=J.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=J.Matrix.Zero(),this._projectionTextureScalingMatrix=J.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=v,this.direction=Z,this.angle=V,this.exponent=h}getClassName(){return"SpotLight"}getTypeID(){return e.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(f){super._setDirection(f),this._projectionTextureViewLightDirty=!0}_setPosition(f){super._setPosition(f),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(f,v,Z){const V=this.Yf().activeCamera;if(!V)return;this._shadowAngleScale=this._shadowAngleScale||1;const h=this._shadowAngleScale*this._angle,l=void 0!==this.shadowMinZ?this.shadowMinZ:V.Lh,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,C=this.Yf().getEngine().useReverseDepthBuffer;J.Matrix.PerspectiveFovLHToRef(h,1,C?e:l,C?l:e,f,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),J.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const f=this.projectionTextureLightFar,v=this.projectionTextureLightNear,Z=f/(f-v),V=-Z*v,h=1/Math.tan(this._angle/2);J.Matrix.FromValuesToRef(h/1,0,0,0,0,h,0,0,0,0,Z,1,0,0,V,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof H.e){const f=this._projectionTexture.uScale/2,v=this._projectionTexture.vScale/2;J.Matrix.FromValuesToRef(f,0,0,0,0,v,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(f,v){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),f.setMatrix("textureProjectionMatrix"+v,this._projectionTextureMatrix),f.setTexture("projectionLightTexture"+v,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&f.setTexture("iesLightTexture"+v,this._iesProfileTexture),this}transferToEffect(f,v){let Z;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,v),Z=J.Xv.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,v),Z=J.Xv.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Z.x,Z.y,Z.z,this._cosHalfAngle,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,v),this}transferToNodeMaterialEffect(f,v){let Z;return Z=this.computeTransformedInformation()?J.Xv.Normalize(this.transformedDirection):J.Xv.Normalize(this.direction),this.Yf().useRightHandedSystem?f.setFloat3(v,-Z.x,-Z.y,-Z.z):f.setFloat3(v,Z.x,Z.y,Z.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(f){const v=this._scene.getEngine(),Z=void 0!==this.shadowMinZ?this.shadowMinZ:(null===f||void 0===f?void 0:f.Lh)??0;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?Z:this._scene.getEngine().isNDCHalfZRange?0:Z}getDepthMaxZ(f){const v=this._scene.getEngine(),Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===f||void 0===f?void 0:f.maxZ)??1e4;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:Z}prepareLightSpecificDefines(f,v){f["SPOTLIGHT"+v]=!0,f["PROJECTEDLIGHTTEXTURE"+v]=!(!this.projectionTexture||!this.projectionTexture.isReady()),f["IESLIGHTTEXTURE"+v]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,V.d)([(0,h.F)()],u.prototype,"angle",null),(0,V.d)([(0,h.F)()],u.prototype,"innerAngle",null),(0,V.d)([(0,h.F)()],u.prototype,"shadowAngleScale",null),(0,V.d)([(0,h.F)()],u.prototype,"exponent",void 0),(0,V.d)([(0,h.F)()],u.prototype,"projectionTextureLightNear",null),(0,V.d)([(0,h.F)()],u.prototype,"projectionTextureLightFar",null),(0,V.d)([(0,h.F)()],u.prototype,"projectionTextureUpDirection",null),(0,V.d)([(0,h.x)("projectedLightTexture")],u.prototype,"_projectionTexture",void 0),(0,O.h)("BABYLON.SpotLight",u)},12786:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>l,f:()=>J,i:()=>e});const V={},h={};function J(f,v){V[f]=v}function l(f,v){h[f]=v}function e(f){return h[f]?h[f]:null}},12700:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>Y,g:()=>L});var V,h=Z(11230),J=Z(11235),l=Z(11646),e=Z(11281),C=Z(11247),H=Z(11873),O=Z(11290),u=Z(11294),W=Z(11378),a=Z(11318),b=Z(11272);!function(f){f[f.Clean=0]="Clean",f[f.Stop=1]="Stop",f[f.Sync=2]="Sync",f[f.NoSync=3]="NoSync"}(V||(V={}));const X=new J.c,F={};let U=!1;function K(){return F[".babylon"]}function M(f,v){const Z=F[f];return Z||(C.e.Warn("Unable to find a plugin to load "+f+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),v?K():void 0)}function A(f,v,Z){let V="Unable to load from "+(f.rawData?"binary data":f.url);return v?V+=`: ${v}`:Z&&(V+=`: ${Z}`),V}async function s(f,v,Z,V,h,J,l,e,C){var H;const u="data:"===(W=f.url).substring(0,5)?W.substring(5):null;var W;if(f.rawData&&!l)throw"When using ArrayBufferView to load data the file extension must be provided.";const U=u||l?"":function(f){const v=f.indexOf("?");-1!==v&&(f=f.substring(0,v));const Z=f.lastIndexOf(".");return f.substring(Z,f.length).toLowerCase()}(f.url);let A=l?M(l,!0):u?function(f){for(const v in F){const Z=F[v].plugin;if(Z.canDirectLoad&&Z.canDirectLoad(f))return F[v]}return K()}(f.url):M(U,!1);if(!A&&U){if(f.url&&!f.url.startsWith("blob:")){const v=await async function(f,v){const Z=v.method||"GET";return await new Promise(((V,h)=>{const J=new b.c;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const f={};if(v.responseHeaders)for(const Z of v.responseHeaders)f[Z]=J.getResponseHeader(Z)||"";V({response:J.response,headerValues:f})}else h(`Unable to fetch data from ${f}. Error code: ${J.status}`)})),J.open(Z,f),J.send()}))}(f.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Z=v.headerValues?v.headerValues["Content-Type"]:"";Z&&(A=function(f){for(const v in F){const Z=F[v];if(Z.mimeType===f)return Z}}(Z))}A||(A=K())}if(!A)throw new Error(`No plugin or fallback for ${l??f.url}`);if(!1===(null===C||void 0===C||null===(H=C[A.plugin.name])||void 0===H?void 0:H.enabled))throw new Error(`The '${A.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(f.rawData&&!A.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(f=>{if(A.plugin.createPlugin){const v=A.plugin.createPlugin(C??{});return v instanceof Promise?(v.then(f).catch((f=>{h("Error instantiating plugin.",f)})),null):(f(v),v)}return f(A.plugin),A.plugin})((C=>{var H;if(!C)throw`The loader plugin corresponding to the '${l}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(X.notifyObservers(C),u&&(C.canDirectLoad&&C.canDirectLoad(f.url)||!(0,O.m)(f.url))){if(C.directLoad){const f=C.directLoad(v,u);f instanceof Promise?f.then((f=>{Z(C,f)})).catch((f=>{h("Error in directLoad of _loadData: "+f,f)})):Z(C,f)}else Z(C,u);return}const W=A.isBinary,b=(f,V)=>{v.C?h("Scene has been disposed"):Z(C,f,V)};let F=null,U=!1;null===(H=C.Kh)||void 0===H||H.add((()=>{U=!0,F&&(F.abort(),F=null),J()}));const K=()=>{if(U)return;const Z=(f,v)=>{h(null===f||void 0===f?void 0:f.statusText,v)};if(!C.loadFile&&f.rawData)throw"Plugin does not support loading ArrayBufferView.";F=C.loadFile?C.loadFile(v,f.rawData||f.file||f.url,f.rootUrl,b,V,W,Z,e):v._loadFile(f.file||f.url,b,V,!0,W,Z)},M=v.getEngine();let s=M.enableOfflineSupport;if(s){let Z=!1;for(const V of v.disableOfflineSupportExceptionRules)if(V.test(f.url)){Z=!0;break}s=!Z}s&&a.b.OfflineProviderFactory?v.offlineProvider=a.b.OfflineProviderFactory(f.url,K,M.disableManifestCheck):K()}))}function z(f,v){let Z,V,J=null,l=null;if(v)if(v.name)Z=`file:${v.name}`,V=v.name,J=v;else if(ArrayBuffer.isView(v))Z="",V=(0,W.c)(),l=v;else if(v.startsWith("data:"))Z=v,V="";else if(f){const J=v;if("/"===J.substring(0,1))return h.Tools.Error("Wrong sceneFilename parameter"),null;Z=f+J,V=J}else Z=v,V=h.Tools.GetFilename(v),f=h.Tools.GetFolderPath(v);else Z=f,V=h.Tools.GetFilename(f),f=h.Tools.GetFolderPath(f);return{url:Z,rootUrl:f,name:V,file:J,rawData:l}}function Y(f){if("string"===typeof f.extensions){const v=f.extensions;F[v.toLowerCase()]={plugin:f,isBinary:!1}}else{const v=f.extensions,Z=Object.keys(v);for(const V of Z)F[V.toLowerCase()]={plugin:f,isBinary:v[V].isBinary,mimeType:v[V].mimeType}}}async function y(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.c.LastCreatedScene,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!V)return C.e.Error("No scene available to import mesh to"),null;const a=z(v,Z);if(!a)return null;const b={};V.addPendingData(b);const X=()=>{V.removePendingData(b)},F=(f,v)=>{const Z=A(a,f,v);l?l(V,Z,new u.h(Z,u.g.SceneLoaderError,v)):C.e.Error(Z),X()},U=J?f=>{try{J(f)}catch(v){F("Error in onProgress callback: "+v,v)}}:void 0,K=(f,v,Z,J,l,e,C,H)=>{if(V.importedMeshesFiles.push(a.url),h)try{h(f,v,Z,J,l,e,C,H)}catch(O){F("Error in onSuccess callback: "+O,O)}V.removePendingData(b)};return await s(a,V,((v,Z,h)=>{if(v.rewriteRootURL&&(a.rootUrl=v.rewriteRootURL(a.rootUrl,h)),v.importMesh){const h=[],J=[],l=[];if(!v.importMesh(f,V,Z,a.rootUrl,h,J,l,F))return;V.loadingPluginName=v.name,K(h,J,l,[],[],[],[],[])}else{v.importMeshAsync(f,V,Z,a.rootUrl,U,a.name).then((f=>{V.loadingPluginName=v.name,K(f.meshes,f.fW,f.skeletons,f.animationGroups,f.transformNodes,f.geometries,f.lights,f.spriteManagers)})).catch((f=>{F(f.message,f)}))}}),U,F,X,H,O,W)}async function N(f,v,Z,V,h,J,l,e){return await new Promise(((C,H)=>{try{y(f,v,Z,V,((f,v,Z,V,h,J,l,e)=>{C({meshes:f,fW:v,skeletons:Z,animationGroups:V,transformNodes:h,geometries:J,lights:l,spriteManagers:e})}),h,((f,v,Z)=>{H(Z||new Error(v))}),J,l,e).catch(H)}catch(u){H(u)}}))}async function i(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedEngine,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Z?await T(f,v,new l.b(Z),V,J,C,H,O,u):h.Tools.Error("No engine available")}async function I(f,v,Z,V,h,J,l){return await new Promise(((e,C)=>{i(f,v,Z,(f=>{e(f)}),V,((f,v,Z)=>{C(Z||new Error(v))}),h,J,l)}))}async function T(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedScene,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Z)return C.e.Error("No scene available to append to"),null;const a=z(f,v);if(!a)return null;const b={};Z.addPendingData(b);const X=()=>{Z.removePendingData(b)};H.d.ShowLoadingScreen&&!U&&(U=!0,Z.getEngine().displayLoadingUI(),Z.executeWhenReady((()=>{Z.getEngine().hideLoadingUI(),U=!1})));const F=(f,v)=>{const V=A(a,f,v);J?J(Z,V,new u.h(V,u.g.SceneLoaderError,v)):C.e.Error(V),X()},K=h?f=>{try{h(f)}catch(v){F("Error in onProgress callback",v)}}:void 0,M=()=>{if(V)try{V(Z)}catch(f){F("Error in onSuccess callback",f)}Z.removePendingData(b)};return await s(a,Z,((f,v)=>{if(f.load){if(!f.load(Z,v,a.rootUrl,F))return;Z.loadingPluginName=f.name,M()}else{f.loadAsync(Z,v,a.rootUrl,K,a.name).then((()=>{Z.loadingPluginName=f.name,M()})).catch((f=>{F(f.message,f)}))}}),K,F,X,l,O,W)}async function B(f,v,Z,V,h,J,l){return await new Promise(((e,C)=>{try{T(f,v,Z,(f=>{e(f)}),V,((f,v,Z)=>{C(Z||new Error(v))}),h,J,l).catch(C)}catch(u){C(u)}}))}async function P(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedScene,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Z)return C.e.Error("No scene available to load asset container to"),null;const W=z(f,v);if(!W)return null;const a={};Z.addPendingData(a);const b=()=>{Z.removePendingData(a)},X=(f,v)=>{const V=A(W,f,v);J?J(Z,V,new u.h(V,u.g.SceneLoaderError,v)):C.e.Error(V),b()},F=h?f=>{try{h(f)}catch(v){X("Error in onProgress callback",v)}}:void 0,U=f=>{if(V)try{V(f)}catch(v){X("Error in onSuccess callback",v)}Z.removePendingData(a)};return await s(W,Z,((f,v)=>{if(f.loadAssetContainer){const V=f.loadAssetContainer(Z,v,W.rootUrl,X);if(!V)return;V.populateRootNodes(),Z.loadingPluginName=f.name,U(V)}else if(f.loadAssetContainerAsync){f.loadAssetContainerAsync(Z,v,W.rootUrl,F,W.name).then((v=>{v.populateRootNodes(),Z.loadingPluginName=f.name,U(v)})).catch((f=>{X(f.message,f)}))}else X("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),F,X,b,l,H,O)}async function g(f,v,Z,V,h,J,l){return await new Promise(((e,C)=>{try{P(f,v,Z,(f=>{e(f)}),V,((f,v,Z)=>{C(Z||new Error(v))}),h,J,l).catch(C)}catch(u){C(u)}}))}async function w(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedScene,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Z)return void C.e.Error("No scene available to load animations to");if(V){for(const V of Z.animatables)V.reset();Z.stopAllAnimations();const f=Z.animationGroups.slice();for(const Z of f)Z.dispose();const v=Z.getNodes();for(const Z of v)Z.animations&&(Z.animations=[])}else switch(h){case 0:const f=Z.animationGroups.slice();for(const v of f)v.dispose();break;case 1:for(const v of Z.animationGroups)v.stop();break;case 2:for(const v of Z.animationGroups)v.reset(),v.restart();break;case 3:break;default:return void C.e.Error("Unknown animation group loading mode value '"+h+"'")}const b=Z.animatables.length;await P(f,v,Z,(f=>{f.mergeAnimationsTo(Z,Z.animatables.slice(b),J),f.dispose(),Z.onAnimationFileImportedObservable.notifyObservers(Z),l&&l(Z)}),H,O,u,W,a)}async function t(f,v,Z,V,h,J,l,e,C,H){return await new Promise(((O,W)=>{try{w(f,v,Z,V,h,J,(f=>{O(f)}),l,((f,v,Z)=>{W(Z||new Error(v))}),e,C,H).catch(W)}catch(u){W(u)}}))}class L{static get ForceFullSceneLoadingForIncremental(){return H.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(f){H.d.ForceFullSceneLoadingForIncremental=f}static get ShowLoadingScreen(){return H.d.ShowLoadingScreen}static set ShowLoadingScreen(f){H.d.ShowLoadingScreen=f}static get loggingLevel(){return H.d.loggingLevel}static set loggingLevel(f){H.d.loggingLevel=f}static get CleanBoneMatrixWeights(){return H.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(f){H.d.CleanBoneMatrixWeights=f}static GetDefaultPlugin(){return K()}static GetPluginForExtension(f){var v;return null===(v=M(f,!0))||void 0===v?void 0:v.plugin}static IsPluginForExtensionAvailable(f){return function(f){return!!F[f]}(f)}static RegisterPlugin(f){Y(f)}static ImportMesh(f,v,Z,V,h,J,l,C,H){y(f,v,Z,V,h,J,l,C,H).catch((f=>null===l||void 0===l?void 0:l(e.c.LastCreatedScene,null===f||void 0===f?void 0:f.message,f)))}static async ImportMeshAsync(f,v,Z,V,h,J,l){return await N(f,v,Z,V,h,J,l)}static Load(f,v,Z,V,h,J,l,C){i(f,v,Z,V,h,J,l,C).catch((f=>null===J||void 0===J?void 0:J(e.c.LastCreatedScene,null===f||void 0===f?void 0:f.message,f)))}static async LoadAsync(f,v,Z,V,h,J){return await I(f,v,Z,V,h,J)}static Append(f,v,Z,V,h,J,l,C){T(f,v,Z,V,h,J,l,C).catch((f=>null===J||void 0===J?void 0:J(Z??e.c.LastCreatedScene,null===f||void 0===f?void 0:f.message,f)))}static async AppendAsync(f,v,Z,V,h,J){return await B(f,v,Z,V,h,J)}static LoadAssetContainer(f,v,Z,V,h,J,l,C){P(f,v,Z,V,h,J,l,C).catch((f=>null===J||void 0===J?void 0:J(Z??e.c.LastCreatedScene,null===f||void 0===f?void 0:f.message,f)))}static async LoadAssetContainerAsync(f,v,Z,V,h,J){return await g(f,v,Z,V,h,J)}static ImportAnimations(f,v,Z,V,h,J,l,C,H,O,u){w(f,v,Z,V,h,J,l,C,H,O,u).catch((f=>null===H||void 0===H?void 0:H(Z??e.c.LastCreatedScene,null===f||void 0===f?void 0:f.message,f)))}static async ImportAnimationsAsync(f,v,Z,V,h,J,l,e,C,H,O){return await t(f,v,Z,V,h,J,e,H,O)}}L.NO_LOGGING=0,L.MINIMAL_LOGGING=1,L.SUMMARY_LOGGING=2,L.DETAILED_LOGGING=3,L.OnPluginActivatedObservable=X},13082:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>W});var V=Z(11405),h=Z(11410),J=Z(11230),l=Z(11421),e=Z(11446),C=Z(11401),H=Z(11372),O=Z(11235),u=Z(11462);Z(13091);class W extends e.b{set boundingBoxSize(f){if(this._boundingBoxSize&&this._boundingBoxSize.equals(f))return;this._boundingBoxSize=f;const v=this.Yf();v&&v.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(f){this._rotationY=f,this.setReflectionTextureMatrix(l.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(f,v,Z){let V="";for(const h of f)V+=h;return new W(V,v,null,Z,f)}static CreateFromPrefilteredData(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=v.useDelayedTextureLoading;v.useDelayedTextureLoading=!1;const J=new W(f,v,null,!1,null,null,null,void 0,!0,Z,V);return v.useDelayedTextureLoading=h,J}constructor(f,v){var Z;let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]&&arguments[10],X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,K=arguments.length>14?arguments[14]:void 0;super(v),this.onLoadObservable=new O.c,this.boundingBoxPosition=l.Xv.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new l.Matrix,this._buffer=null,this.name=f,this.url=f,this._noMipmap=h,this.th=!1,this.isCube=!0,this._textureMatrix=l.Matrix.Identity(),this.coordinatesMode=C.e.CUBIC_MODE;let M=null,A=null;null===V||Array.isArray(V)?(this._noMipmap=h,this._format=u,this._createPolynomials=b,M=V,this._loaderOptions=U,this._useSRGBBuffer=K,this._lodScale=X,this._lodOffset=F):(M=V.extensions??null,this._noMipmap=V.noMipmap??!1,J=V.files??null,A=V.buffer??null,this._format=V.format??5,W=V.prefiltered??!1,a=V.forcedExtension??null,this._createPolynomials=V.createPolynomials??!1,this._lodScale=V.lodScale??.8,this._lodOffset=V.lodOffset??0,this._loaderOptions=V.loaderOptions,this._useSRGBBuffer=V.useSRGBBuffer,e=V.R??null,H=V.onError??null),(f||J)&&this.updateURL(f,a,e,W,H,M,null===(Z=this.Yf())||void 0===Z?void 0:Z.useDelayedTextureLoading,J,A)}getClassName(){return"CubeTexture"}updateURL(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=f),this.url=f,v&&(this._forcedExtension=v);const H=f.lastIndexOf("."),O=v||(H>-1?f.substring(H).toLowerCase():""),u=0===O.indexOf(".dds"),W=0===O.indexOf(".env"),a=0===O.indexOf(".basis");if(W?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=V,V&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),e)this._files=e;else if(a||W||u||J||(J=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,J){for(let v=0;v<J.length;v++)this._files.push(f+J[v]);this._extensions=J}this._buffer=C,l?(this.delayLoadState=4,this._delayedOnLoad=Z,this._delayedOnError=h):this._loadTexture(Z,h)}delayLoad(f){4===this.delayLoadState&&(f&&(this._forcedExtension=f),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(f){var v,Z;if(f.updateFlag===this._textureMatrix.updateFlag)return;f.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Z=this.Yf())||void 0===Z||Z.markAllMaterialsAsDirty(1,(f=>-1!==f.getActiveTextures().indexOf(this))));if(this._textureMatrix=f,null===(v=this.Yf())||void 0===v||!v.useRightHandedSystem)return;const V=l.TmpVectors.Xv[0],h=l.TmpVectors.Quaternion[0],J=l.TmpVectors.Xv[1];this._textureMatrix.decompose(V,h,J),h.z*=-1,h.w*=-1,l.Matrix.ComposeToRef(V,h,J,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var f;return null!==(f=this.Yf())&&void 0!==f&&f.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this.Yf(),V=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const h=()=>{var v;(this.onLoadObservable.notifyObservers(this),V)&&(V.dispose(),null===(v=this.Yf())||void 0===v||v.markAllMaterialsAsDirty(1));f&&f()},l=(f,Z)=>{this._loadingError=!0,this._errorObject={message:f,exception:Z},v&&v(f,Z),C.e.OnTextureLoadErrorObservable.notifyObservers(this)};var e;this._texture?this._texture.isReady?J.Tools.SetImmediate((()=>h())):this._texture.onLoadedObservable.add((()=>h())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Z,this._lodScale,this._lodOffset,f,l,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Z,this._files,this._noMipmap,f,l,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(e=this._texture)||void 0===e||e.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(f,v,Z){const V=u.b.Parse((()=>{let V=!1;return f.prefiltered&&(V=f.prefiltered),new W(Z+(f.url??f.name),v,f.extensions,!1,f.files||null,null,null,void 0,V,f.forcedExtension)}),f,v);if(f.boundingBoxPosition&&(V.boundingBoxPosition=l.Xv.Av(f.boundingBoxPosition)),f.boundingBoxSize&&(V.boundingBoxSize=l.Xv.Av(f.boundingBoxSize)),f.animations)for(let h=0;h<f.animations.length;h++){const v=f.animations[h],Z=(0,H.e)("BABYLON.Animation");Z&&V.animations.push(Z.Parse(v))}return V}clone(){let f=0;const v=u.b.Clone((()=>{const v=new W(this.url,this.Yf()||this._getEngine(),this._extensions,this._noMipmap,this._files);return f=v.uniqueId,v}),this);return v.uniqueId=f,v}}(0,V.d)([(0,h.F)()],W.prototype,"url",void 0),(0,V.d)([(0,h.E)()],W.prototype,"boundingBoxPosition",void 0),(0,V.d)([(0,h.E)()],W.prototype,"boundingBoxSize",null),(0,V.d)([(0,h.F)("rotationY")],W.prototype,"rotationY",null),(0,V.d)([(0,h.F)("files")],W.prototype,"_files",void 0),(0,V.d)([(0,h.F)("forcedExtension")],W.prototype,"_forcedExtension",void 0),(0,V.d)([(0,h.F)("extensions")],W.prototype,"_extensions",void 0),(0,V.d)([(0,h.p)("textureMatrix")],W.prototype,"_textureMatrix",void 0),(0,V.d)([(0,h.p)("textureMatrixRefraction")],W.prototype,"_textureMatrixRefraction",void 0),C.e._CubeTextureParser=W.Parse,(0,H.h)("BABYLON.CubeTexture",W)},13565:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>C});var V=Z(11247),h=Z(11401),J=Z(11385),l=Z(11551),e=Z(11360);l.ThinEngine.prototype.createDynamicTexture=function(f,v,Z,V){const h=new e.c(this,4);return h.baseWidth=f,h.baseHeight=v,Z&&(f=this.needPOTTextures?(0,J.h)(f,this._caps.maxTextureSize):f,v=this.needPOTTextures?(0,J.h)(v,this._caps.maxTextureSize):v),h.width=f,h.height=v,h.isReady=!1,h.generateMipMaps=Z,h.samplingMode=V,this.updateTextureSamplingMode(V,h),this._internalTexturesCache.push(h),h},l.ThinEngine.prototype.updateDynamicTexture=function(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!f)return;const l=this._gl,e=l.TEXTURE_2D,C=this._bindTextureDirectly(e,f,!0,J);this._unpackFlipY(void 0===Z?f.invertY:Z),V&&l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const H=this._getWebGLTextureType(f.type),O=this._getInternalFormat(h||f.format),u=this._getRGBABufferInternalSizedFormat(f.type,O);l.texImage2D(e,0,u,O,H,v),f.generateMipMaps&&l.generateMipmap(e),C||this._bindTextureDirectly(e,null),V&&l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),h&&(f.format=h),f._dynamicTextureSource=v,f._premulAlpha=V,f.invertY=Z||!1,f.isReady=!0};class C extends h.e{constructor(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,e=arguments.length>6?arguments[6]:void 0;const C=!Z||Z._isScene;super(null,C?Z:null===Z||void 0===Z?void 0:Z.Uv,C?!V:Z,e,J,void 0,void 0,void 0,void 0,l),this.name=f,this.wrapU=h.e.CLAMP_ADDRESSMODE,this.wrapV=h.e.CLAMP_ADDRESSMODE,this._generateMipMaps=V;const H=this._getEngine();if(!H)return;if(v.getContext)this._canvas=v,this._ownCanvas=!1,this._texture=H.createDynamicTexture(this._canvas.width,this._canvas.height,V,J);else{this._canvas=H.createCanvas(1,1),this._ownCanvas=!0;const f=v;f.width||0===f.width?this._texture=H.createDynamicTexture(f.width,f.height,V,J):this._texture=H.createDynamicTexture(v,v,V,J)}const O=this.getSize();this._canvas.width!==O.width&&(this._canvas.width=O.width),this._canvas.height!==O.height&&(this._canvas.height=O.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(f){this._canvas.width=f.width,this._canvas.height=f.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(f.width,f.height,this._generateMipMaps,this.samplingMode)}scale(f){const v=this.getSize();v.width*=f,v.height*=f,this._recreate(v)}scaleTo(f,v){const Z=this.getSize();Z.width=f,Z.height=v,this._recreate(Z)}getContext(){return this._context}clear(f){const v=this.getSize();f&&(this._context.fillStyle=f),this._context.clearRect(0,0,v.width,v.height)}update(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===f||f,v,this._format||void 0,void 0,Z)}drawText(f,v,Z,V,h,J,l){let e=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(J&&(this._context.fillStyle=J,this._context.fillRect(0,0,C.width,C.height)),this._context.font=V,null===v||void 0===v){const Z=this._context.measureText(f);v=(C.width-Z.width)/2}if(null===Z||void 0===Z){const f=parseInt(V.replace(/\D/g,""));Z=C.height/2+f/3.65}this._context.fillStyle=h||"",this._context.fillText(f,v,Z),e&&this.update(l)}dispose(){var f,v;(super.dispose(),this._ownCanvas)&&(null===(f=this._canvas)||void 0===f||null===(v=f.remove)||void 0===v||v.call(f));this._canvas=null,this._context=null}clone(){const f=this.Yf();if(!f)return this;const v=this.getSize(),Z=new C(this.name,v,f,this._generateMipMaps);return Z.th=this.th,Z.level=this.level,Z.wrapU=this.wrapU,Z.wrapV=this.wrapV,Z}serialize(){const f=this.Yf();f&&!f.isReady()&&V.e.Warn("The scene must be ready before serializing the dynamic texture");const v=super.serialize();return C._IsCanvasElement(this._canvas)&&(v.base64String=this._canvas.toDataURL()),v.invertY=this._invertY,v.samplingMode=this.samplingMode,v}static _IsCanvasElement(f){return void 0!==f.toDataURL}_rebuild(){this.update()}}},12998:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>h});var V=Z(11401);class h extends V.e{get depth(){return this._depth}constructor(f,v,Z,h,J,l){let e=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:V.e.TRILINEAR_SAMPLINGMODE,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;super(null,l,!e,C),this.format=J,this._texture=l.getEngine().createRawTexture2DArray(f,v,Z,h,J,e,C,H,null,O,u),this._depth=h,this.is2DArray=!0}update(f){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,f,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(f,v,Z,V,J){return new h(f,v,Z,V,5,J,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12804:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>e,f:()=>C,i:()=>J,j:()=>l});var V=Z(11440),h=Z(11421);function J(f,v){return`{X: ${f.x.toFixed(v)} Y: ${f.y.toFixed(v)}}`}function l(f,v){return`{X: ${f._x.toFixed(v)} Y: ${f._y.toFixed(v)} Z: ${f._z.toFixed(v)}}`}function e(f,v){return 2*Math.acos((0,V.Clamp)(h.Quaternion.Dot(f,v)))}function C(f,v){const Z=new h.Quaternion;return function(f,v,Z){const J=h.Xv.Cross(f,v),l=Math.acos((0,V.Clamp)(h.Xv.Dot(f,v),-1,1));h.Quaternion.RotationAxisToRef(J,l,Z)}(f,v,Z),Z}},12652:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>H});var V=Z(11421),h=Z(11472),J=Z(11859),l=Z(11837),e=Z(11486);Z(12654);function C(f){let v=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Z=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],J=[];let C=[];const H=f.width||f.size||1,O=f.height||f.size||1,u=f.depth||f.size||1,W=f.wrap||!1;let a=void 0===f.topBaseAt?1:f.topBaseAt,b=void 0===f.bottomBaseAt?0:f.bottomBaseAt;a=(a+4)%4,b=(b+4)%4;let X=[2,0,3,1][a],F=[2,0,1,3][b],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(W){v=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let f=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Z=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const V=[17,18,19,16],h=[22,23,20,21];for(;X>0;)f.unshift(f.pop()),V.unshift(V.pop()),X--;for(;F>0;)Z.unshift(Z.pop()),h.unshift(h.pop()),F--;f=f.flat(),Z=Z.flat(),U=U.concat(f).concat(Z),v.push(V[0],V[2],V[3],V[0],V[1],V[2]),v.push(h[0],h[2],h[3],h[0],h[1],h[2])}const K=[H/2,O/2,u/2];C=U.reduce(((f,v,Z)=>f.concat(v*K[Z%3])),[]);const M=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,A=f.faceUV||new Array(6),s=f.faceColors,z=[];for(let l=0;l<6;l++)void 0===A[l]&&(A[l]=new V.Vector4(0,0,1,1)),s&&void 0===s[l]&&(s[l]=new h.he(1,1,1,1));for(let V=0;V<6;V++)if(J.push(A[V].z,e.b?1-A[V].w:A[V].w),J.push(A[V].x,e.b?1-A[V].w:A[V].w),J.push(A[V].x,e.b?1-A[V].y:A[V].y),J.push(A[V].z,e.b?1-A[V].y:A[V].y),s)for(let f=0;f<4;f++)z.push(s[V].r,s[V].g,s[V].b,s[V].a);l.b._ComputeSides(M,C,v,Z,J,f.frontUVs,f.backUVs);const Y=new l.b;if(Y.indices=v,Y.Nf=C,Y.if=Z,Y.Tf=J,s){const f=M===l.b.DOUBLESIDE?z.concat(z):z;Y.If=f}return Y}function H(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new J.d(f,Z);v.sideOrientation=J.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return C(v).Pf(V,v.updatable),V}l.b.CreateBox=C,J.d.CreateBox=function(f,v){return H(f,{size:v,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12794:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>e});var V=Z(11859),h=Z(11837),J=Z(11486);function l(f){const v=[],Z=[],V=[],l=[],e=f.radius||.5,C=f.tessellation||64,H=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,O=0===f.sideOrientation?0:f.sideOrientation||h.b.DEFAULTSIDE;v.push(0,0,0),l.push(.5,.5);const u=2*Math.PI*H,W=1===H?u/C:u/(C-1);let a=0;for(let h=0;h<C;h++){const f=Math.cos(a),Z=Math.sin(a),V=(f+1)/2,h=(1-Z)/2;v.push(e*f,e*Z,0),l.push(V,J.b?1-h:h),a+=W}1===H&&(v.push(v[3],v[4],v[5]),l.push(l[2],J.b?1-l[3]:l[3]));const b=v.length/3;for(let h=1;h<b-1;h++)Z.push(h+1,0,h);h.b.ComputeNormals(v,Z,V),h.b._ComputeSides(O,v,Z,V,l,f.frontUVs,f.backUVs);const X=new h.b;return X.indices=Z,X.Nf=v,X.if=V,X.Tf=l,X}function e(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new V.d(f,Z);v.sideOrientation=V.d._GetDefaultSideOrientation(v.sideOrientation),h._originalBuilderSideOrientation=v.sideOrientation;return l(v).Pf(h,v.updatable),h}h.b.CreateDisc=l,V.d.CreateDisc=function(f,v,Z){return e(f,{radius:v,tessellation:Z,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12654:(f,v,Z)=>{"use strict";Z.d(v,{i:()=>F,e:()=>K,j:()=>U});var V=Z(11421),h=Z(11472),J=Z(11859),l=Z(11837),e=Z(11494);J.d._GroundMeshParser=(f,v)=>C.Parse(f,v);class C extends J.d{constructor(f,v){super(f,v),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=f,this._subdivisionsY=f,this.subdivide(f);const Z=this;Z.createOrUpdateSubmeshesOctree&&Z.createOrUpdateSubmeshesOctree(v)}getHeightAtCoordinates(f,v){const Z=this.getWorldMatrix(),h=V.TmpVectors.Matrix[5];Z.invertToRef(h);const J=V.TmpVectors.Xv[8];if(V.Xv.TransformCoordinatesFromFloatsToRef(f,0,v,h,J),f=J.x,v=J.z,f<this._minX||f>=this._maxX||v<=this._minZ||v>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const l=this._getFacetAt(f,v),e=-(l.x*f+l.z*v+l.w)/l.y;return V.Xv.TransformCoordinatesFromFloatsToRef(0,e,0,Z,J),J.y}getNormalAtCoordinates(f,v){const Z=new V.Xv(0,1,0);return this.getNormalAtCoordinatesToRef(f,v,Z),Z}getNormalAtCoordinatesToRef(f,v,Z){const h=this.getWorldMatrix(),J=V.TmpVectors.Matrix[5];h.invertToRef(J);const l=V.TmpVectors.Xv[8];if(V.Xv.TransformCoordinatesFromFloatsToRef(f,0,v,J,l),f=l.x,v=l.z,f<this._minX||f>this._maxX||v<this._minZ||v>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const e=this._getFacetAt(f,v);return V.Xv.TransformNormalFromFloatsToRef(e.x,e.y,e.z,h,Z),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(f,v){const Z=Math.floor((f+this._maxX)*this._subdivisionsX/this._width),V=Math.floor(-(v+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),h=this._heightQuads[V*this._subdivisionsX+Z];let J;return J=v<h.slope.x*f+h.slope.y?h.facet1:h.facet2,J}_initHeightQuads(){const f=this._subdivisionsX,v=this._subdivisionsY;this._heightQuads=[];for(let Z=0;Z<v;Z++)for(let v=0;v<f;v++){const h={slope:V.Vector2.Zero(),facet1:new V.Vector4(0,0,0,0),facet2:new V.Vector4(0,0,0,0)};this._heightQuads[Z*f+v]=h}return this}_computeHeightQuads(){const f=this.getVerticesData(e.g.PositionKind);if(!f)return this;const v=V.TmpVectors.Xv[3],Z=V.TmpVectors.Xv[2],h=V.TmpVectors.Xv[1],J=V.TmpVectors.Xv[0],l=V.TmpVectors.Xv[4],C=V.TmpVectors.Xv[5],H=V.TmpVectors.Xv[6],O=V.TmpVectors.Xv[7],u=V.TmpVectors.Xv[8];let W=0,a=0,b=0,X=0,F=0,U=0,K=0;const M=this._subdivisionsX,A=this._subdivisionsY;for(let e=0;e<A;e++)for(let A=0;A<M;A++){W=3*A,a=e*(M+1)*3,b=(e+1)*(M+1)*3,v.x=f[a+W],v.y=f[a+W+1],v.z=f[a+W+2],Z.x=f[a+W+3],Z.y=f[a+W+4],Z.z=f[a+W+5],h.x=f[b+W],h.y=f[b+W+1],h.z=f[b+W+2],J.x=f[b+W+3],J.y=f[b+W+4],J.z=f[b+W+5],X=(J.z-v.z)/(J.x-v.x),F=v.z-X*v.x,Z.subtractToRef(v,l),h.subtractToRef(v,C),J.subtractToRef(v,H),V.Xv.CrossToRef(H,C,O),V.Xv.CrossToRef(l,H,u),O.normalize(),u.normalize(),U=-(O.x*v.x+O.y*v.y+O.z*v.z),K=-(u.x*Z.x+u.y*Z.y+u.z*Z.z);const s=this._heightQuads[e*M+A];s.slope.fe(X,F),s.facet1.fe(O.x,O.y,O.z,U),s.facet2.fe(u.x,u.y,u.z,K)}return this}serialize(f){super.serialize(f),f.subdivisionsX=this._subdivisionsX,f.subdivisionsY=this._subdivisionsY,f.minX=this._minX,f.maxX=this._maxX,f.Lh=this._minZ,f.maxZ=this._maxZ,f.width=this._width,f.height=this._height}static Parse(f,v){const Z=new C(f.name,v);return Z._subdivisionsX=f.subdivisionsX||1,Z._subdivisionsY=f.subdivisionsY||1,Z._minX=f.minX,Z._maxX=f.maxX,Z._minZ=f.Lh,Z._maxZ=f.maxZ,Z._width=f.width,Z._height=f.height,Z}}var H=Z(11230),O=Z(11281),u=Z(11428),W=Z(11486);function a(f){const v=[],Z=[],h=[],J=[];let e,C;const H=f.width||f.size||1,O=f.height||f.size||1,u=0|(f.subdivisionsX||f.subdivisions||1),a=0|(f.subdivisionsY||f.subdivisions||1);for(e=0;e<=a;e++)for(C=0;C<=u;C++){const f=new V.Xv(C*H/u-H/2,0,(a-e)*O/a-O/2),v=new V.Xv(0,1,0);Z.push(f.x,f.y,f.z),h.push(v.x,v.y,v.z),J.push(C/u,W.b?e/a:1-e/a)}for(e=0;e<a;e++)for(C=0;C<u;C++)v.push(C+1+(e+1)*(u+1)),v.push(C+1+e*(u+1)),v.push(C+e*(u+1)),v.push(C+(e+1)*(u+1)),v.push(C+1+(e+1)*(u+1)),v.push(C+e*(u+1));const b=new l.b;return b.indices=v,b.Nf=Z,b.if=h,b.Tf=J,b}function b(f){const v=void 0!==f.xmin&&null!==f.xmin?f.xmin:-1,Z=void 0!==f.zmin&&null!==f.zmin?f.zmin:-1,h=void 0!==f.xmax&&null!==f.xmax?f.xmax:1,J=void 0!==f.zmax&&null!==f.zmax?f.zmax:1,e=f.subdivisions||{w:1,h:1},C=f.precision||{w:1,h:1},H=[],O=[],u=[],W=[];let a,b,X,F;e.h=e.h<1?1:e.h,e.w=e.w<1?1:e.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const U=(h-v)/e.w,K=(J-Z)/e.h;function M(f,v,Z,h){const J=O.length/3,l=C.w+1;for(a=0;a<C.h;a++)for(b=0;b<C.w;b++){const f=[J+b+a*l,J+(b+1)+a*l,J+(b+1)+(a+1)*l,J+b+(a+1)*l];H.push(f[1]),H.push(f[2]),H.push(f[3]),H.push(f[0]),H.push(f[1]),H.push(f[3])}const e=V.Xv.Zero(),X=new V.Xv(0,1,0);for(a=0;a<=C.h;a++)for(e.z=a*(h-v)/C.h+v,b=0;b<=C.w;b++)e.x=b*(Z-f)/C.w+f,e.y=0,O.push(e.x,e.y,e.z),u.push(X.x,X.y,X.z),W.push(b/C.w,a/C.h)}for(X=0;X<e.h;X++)for(F=0;F<e.w;F++)M(v+F*U,Z+X*K,v+(F+1)*U,Z+(X+1)*K);const A=new l.b;return A.indices=H,A.Nf=O,A.if=u,A.Tf=W,A}function X(f){const v=[],Z=[],J=[],e=[];let C,H;const O=f.colorFilter||new h.Mv(.3,.59,.11),W=f.alphaFilter||0;let a=!1;if(f.minHeight>f.maxHeight){a=!0;const v=f.maxHeight;f.maxHeight=f.minHeight,f.minHeight=v}for(C=0;C<=f.subdivisions;C++)for(H=0;H<=f.subdivisions;H++){const v=new V.Xv(H*f.width/f.subdivisions-f.width/2,0,(f.subdivisions-C)*f.height/f.subdivisions-f.height/2),h=4*(((v.x+f.width/2)/f.width*(f.bufferWidth-1)|0)+((1-(v.z+f.height/2)/f.height)*(f.bufferHeight-1)|0)*f.bufferWidth);let l=f.buffer[h]/255,b=f.buffer[h+1]/255,X=f.buffer[h+2]/255;const F=f.buffer[h+3]/255;a&&(l=1-l,b=1-b,X=1-X);const U=l*O.r+b*O.g+X*O.b;v.y=F>=W?f.minHeight+(f.maxHeight-f.minHeight)*U:f.minHeight-u.c,f.heightBuffer&&(f.heightBuffer[C*(f.subdivisions+1)+H]=v.y),Z.push(v.x,v.y,v.z),J.push(0,0,0),e.push(H/f.subdivisions,1-C/f.subdivisions)}for(C=0;C<f.subdivisions;C++)for(H=0;H<f.subdivisions;H++){const V=H+1+(C+1)*(f.subdivisions+1),h=H+1+C*(f.subdivisions+1),J=H+C*(f.subdivisions+1),l=H+(C+1)*(f.subdivisions+1),e=Z[3*V+1]>=f.minHeight,O=Z[3*h+1]>=f.minHeight,u=Z[3*J+1]>=f.minHeight;e&&O&&u&&(v.push(V),v.push(h),v.push(J));Z[3*l+1]>=f.minHeight&&e&&u&&(v.push(l),v.push(V),v.push(J))}l.b.ComputeNormals(Z,v,J);const b=new l.b;return b.indices=v,b.Nf=Z,b.if=J,b.Tf=e,b}function F(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Z=new C(f,arguments.length>2?arguments[2]:void 0);Z._setReady(!1),Z._subdivisionsX=v.subdivisionsX||v.subdivisions||1,Z._subdivisionsY=v.subdivisionsY||v.subdivisions||1,Z._width=v.width||1,Z._height=v.height||1,Z._maxX=Z._width/2,Z._maxZ=Z._height/2,Z._minX=-Z._maxX,Z._minZ=-Z._maxZ;return a(v).Pf(Z,v.updatable),Z._setReady(!0),Z}function U(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new J.d(f,Z);return b(v).Pf(V,v.updatable),V}function K(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const J=Z.width||10,l=Z.height||10,e=Z.subdivisions||1,u=Z.minHeight||0,W=Z.maxHeight||1,a=Z.colorFilter||new h.Mv(.3,.59,.11),b=Z.alphaFilter||0,F=Z.updatable,U=Z.onReady;V=V||O.c.LastCreatedScene;const K=new C(f,V);let M;K._subdivisionsX=e,K._subdivisionsY=e,K._width=J,K._height=l,K._maxX=K._width/2,K._maxZ=K._height/2,K._minX=-K._maxX,K._minZ=-K._maxZ,K._setReady(!1),Z.passHeightBufferInCallback&&(M=new Float32Array((e+1)*(e+1)));const A=(f,v,Z)=>{X({width:J,height:l,subdivisions:e,minHeight:u,maxHeight:W,colorFilter:a,buffer:f,bufferWidth:v,bufferHeight:Z,alphaFilter:b,heightBuffer:M}).Pf(K,F),U&&U(K,M),K._setReady(!0)};if("string"===typeof v){const f=f=>{var v;const Z=f.width,h=f.height;if(V.C)return;const J=null===(v=V)||void 0===v?void 0:v.getEngine().resizeImageBitmap(f,Z,h);A(J,Z,h)};H.Tools.LoadImage(v,f,Z.onError?Z.onError:()=>{},V.offlineProvider)}else A(v.data,v.width,v.height);return K}l.b.CreateGround=a,l.b.CreateTiledGround=b,l.b.CreateGroundFromHeightMap=X,J.d.CreateGround=(f,v,Z,V,h,J)=>F(f,{width:v,height:Z,subdivisions:V,updatable:J},h),J.d.CreateTiledGround=(f,v,Z,V,h,J,l,e,C)=>U(f,{xmin:v,zmin:Z,xmax:V,zmax:h,subdivisions:J,precision:l,updatable:C},e),J.d.CreateGroundFromHeightMap=(f,v,Z,V,h,J,l,e,C,H,O)=>K(f,v,{width:Z,height:V,subdivisions:h,minHeight:J,maxHeight:l,updatable:C,onReady:H,alphaFilter:O},e)},13289:(f,v,Z)=>{"use strict";Z.d(v,{b:()=>a,f:()=>u,g:()=>W});var V=Z(11421),h=Z(11859),J=Z(11837),l=Z(11947),e=Z(11494),C=Z(11247);function H(f){const v=[],Z=[],V=f.lines,h=f.If,l=[];let e=0;for(let J=0;J<V.length;J++){const f=V[J];for(let V=0;V<f.length;V++){const{x:C,y:H,z:O}=f[V];if(Z.push(C,H,O),h){const f=h[J],{r:v,g:Z,b:e,a:C}=f[V];l.push(v,Z,e,C)}V>0&&(v.push(e-1),v.push(e)),e++}}const C=new J.b;return C.indices=v,C.Nf=Z,h&&(C.If=l),C}function O(f){const v=f.dashSize||3,Z=f.gapSize||1,h=f.dashNb||200,l=f.points,e=[],C=[],H=V.Xv.Zero();let O=0,u=0,W=0,a=0,b=0,X=0,F=0;for(F=0;F<l.length-1;F++)l[F+1].subtractToRef(l[F],H),O+=H.length();for(W=O/h,a=v*W/(v+Z),F=0;F<l.length-1;F++){l[F+1].subtractToRef(l[F],H),u=Math.floor(H.length()/W),H.normalize();for(let f=0;f<u;f++)b=W*f,e.push(l[F].x+b*H.x,l[F].y+b*H.y,l[F].z+b*H.z),e.push(l[F].x+(b+a)*H.x,l[F].y+(b+a)*H.y,l[F].z+(b+a)*H.z),C.push(X,X+1),X+=2}const U=new J.b;return U.Nf=e,U.indices=C,U}function u(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=v.instance,h=v.lines,J=v.If;if(V){const f=V.getVerticesData(e.g.PositionKind);let v,Z;J&&(v=V.getVerticesData(e.g.ColorKind));let l=0,C=0;for(let V=0;V<h.length;V++){const e=h[V];for(let h=0;h<e.length;h++)f[l]=e[h].x,f[l+1]=e[h].y,f[l+2]=e[h].z,J&&v&&(Z=J[V],v[C]=Z[h].r,v[C+1]=Z[h].g,v[C+2]=Z[h].b,v[C+3]=Z[h].a,C+=4),l+=3}return V.updateVerticesData(e.g.PositionKind,f,!1,!1),J&&v&&V.updateVerticesData(e.g.ColorKind,v,!1,!1),V.refreshBoundingInfo(),V}const C=!!J,O=new l.e(f,Z,null,void 0,void 0,C,v.useVertexAlpha,v.material);return H(v).Pf(O,v.updatable),O}function W(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=v.If?[v.If]:null;return u(f,{lines:[v.points],updatable:v.updatable,instance:v.instance,If:V,useVertexAlpha:v.useVertexAlpha,material:v.material},Z)}function a(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=v.points,e=v.instance,H=v.gapSize||1,u=v.dashSize||3;if(e){const f=f=>{const v=V.Xv.Zero(),Z=f.length/6;let h=0,l=0,C=0,H=0,O=0,u=0,W=0,a=0;for(W=0;W<J.length-1;W++)J[W+1].subtractToRef(J[W],v),h+=v.length();C=h/Z;const b=e._creationDataStorage.dashSize;for(H=b*C/(b+e._creationDataStorage.gapSize),W=0;W<J.length-1;W++)for(J[W+1].subtractToRef(J[W],v),l=Math.floor(v.length()/C),v.normalize(),a=0;a<l&&u<f.length;)O=C*a,f[u]=J[W].x+O*v.x,f[u+1]=J[W].y+O*v.y,f[u+2]=J[W].z+O*v.z,f[u+3]=J[W].x+(O+H)*v.x,f[u+4]=J[W].y+(O+H)*v.y,f[u+5]=J[W].z+(O+H)*v.z,u+=6,a++;for(;u<f.length;)f[u]=J[W].x,f[u+1]=J[W].y,f[u+2]=J[W].z,u+=3};return(v.dashNb||v.dashSize||v.gapSize||v.useVertexAlpha||v.material)&&C.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),e.updateMeshPositions(f,!1),e}const W=new l.e(f,Z,null,void 0,void 0,void 0,v.useVertexAlpha,v.material);return O(v).Pf(W,v.updatable),W._creationDataStorage=new h.f,W._creationDataStorage.dashSize=u,W._creationDataStorage.gapSize=H,W}J.b.CreateLineSystem=H,J.b.CreateDashedLines=O,h.d.zH=function(f,v){return W(f,{points:v,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},h.d.CreateDashedLines=function(f,v,Z,V,h){return a(f,{points:v,dashSize:Z,gapSize:V,dashNb:h,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12702:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>e,h:()=>C});var V=Z(11859),h=Z(11837),J=Z(11486);function l(f){const v=[],Z=[],V=[],l=[],e=void 0!==f.width?f.width:void 0!==f.size?f.size:1,C=void 0!==f.height?f.height:void 0!==f.size?f.size:1,H=0===f.sideOrientation?0:f.sideOrientation||h.b.DEFAULTSIDE,O=e/2,u=C/2;Z.push(-O,-u,0),V.push(0,0,-1),l.push(0,J.b?1:0),Z.push(O,-u,0),V.push(0,0,-1),l.push(1,J.b?1:0),Z.push(O,u,0),V.push(0,0,-1),l.push(1,J.b?0:1),Z.push(-O,u,0),V.push(0,0,-1),l.push(0,J.b?0:1),v.push(0),v.push(1),v.push(2),v.push(0),v.push(2),v.push(3),h.b._ComputeSides(H,Z,v,V,l,f.frontUVs,f.backUVs);const W=new h.b;return W.indices=v,W.Nf=Z,W.if=V,W.Tf=l,W}function e(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new V.d(f,Z);v.sideOrientation=V.d._GetDefaultSideOrientation(v.sideOrientation),h._originalBuilderSideOrientation=v.sideOrientation;return l(v).Pf(h,v.updatable),v.sourcePlane&&(h.translate(v.sourcePlane.normal,-v.sourcePlane.d),h.setDirection(v.sourcePlane.normal.scale(-1))),h}const C={NH:e};h.b.NH=l,V.d.NH=(f,v,Z,V,h)=>e(f,{size:v,width:v,height:v,sideOrientation:h,updatable:V},Z)},12783:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>C});var V=Z(11421),h=Z(11859),J=Z(11837),l=Z(11486);function e(f){const v=0|(f.segments||32),Z=f.diameterX||f.diameter||1,h=f.diameterY||f.diameter||1,e=f.diameterZ||f.diameter||1,C=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,H=f.slice&&f.slice<=0?1:f.slice||1,O=0===f.sideOrientation?0:f.sideOrientation||J.b.DEFAULTSIDE,u=!!f.dedupTopBottomIndices,W=new V.Xv(Z/2,h/2,e/2),a=2+v,b=2*a,X=[],F=[],U=[],K=[];for(let J=0;J<=a;J++){const f=J/a,v=f*Math.PI*H;for(let Z=0;Z<=b;Z++){const h=Z/b,J=h*Math.PI*2*C,e=V.Matrix.RotationZ(-v),H=V.Matrix.RotationY(J),O=V.Xv.TransformCoordinates(V.Xv.Up(),e),u=V.Xv.TransformCoordinates(O,H),a=u.multiply(W),X=u.divide(W).normalize();F.push(a.x,a.y,a.z),U.push(X.x,X.y,X.z),K.push(h,l.b?1-f:f)}if(J>0){const f=F.length/3;for(let v=f-2*(b+1);v+b+2<f;v++)u?(J>1&&(X.push(v),X.push(v+1),X.push(v+b+1)),(J<a||H<1)&&(X.push(v+b+1),X.push(v+1),X.push(v+b+2))):(X.push(v),X.push(v+1),X.push(v+b+1),X.push(v+b+1),X.push(v+1),X.push(v+b+2))}}J.b._ComputeSides(O,F,X,U,K,f.frontUVs,f.backUVs);const M=new J.b;return M.indices=X,M.Nf=F,M.if=U,M.Tf=K,M}function C(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return e(v).Pf(V,v.updatable),V}J.b.CreateSphere=e,h.d.CreateSphere=(f,v,Z,V,h,J)=>C(f,{segments:v,diameterX:Z,diameterY:Z,diameterZ:Z,sideOrientation:J,updatable:h},V)},13582:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>e});var V=Z(11962),h=Z(13097),J=Z(11978),l=Z(11837);class e{static get Configuration(){return{get decoder(){return h.c.DefaultConfiguration},set decoder(f){h.c.DefaultConfiguration=f}}}static set Configuration(f){h.c.DefaultConfiguration=f.decoder}static get DecoderAvailable(){return(0,V.k)(h.c.DefaultConfiguration)}static get Default(){return e._Default??(e._Default=new e),e._Default}static ResetDefault(f){e._Default&&(f||e._Default.dispose(),e._Default=null)}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DefaultNumWorkers;const v="number"===typeof f?{...h.c.DefaultConfiguration,numWorkers:f}:{...h.c.DefaultConfiguration,...f};this._decoder=new h.c(v)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(f,v,Z){return this._decoder.decodeMeshToMeshDataAsync(f,v,Z)}async decodeMeshToGeometryAsync(f,v,Z,V){return await this._decoder.decodeMeshToGeometryAsync(f,v,Z,V)}async _decodeMeshToGeometryForGltfAsync(f,v,Z,V,h,J){return await this._decoder._decodeMeshToGeometryForGltfAsync(f,v,Z,V,h,J)}async decodeMeshAsync(f,v){const Z=await this._decoder.decodeMeshToMeshDataAsync(f,v),V=new l.b;Z.indices&&(V.indices=Z.indices);for(const h of Z.attributes){const f=J.c.GetFloatData(h.data,h.size,J.c.GetDataType(h.data),h.byteOffset,h.byteStride,h.normalized,Z.totalVertices);V.set(f,h.kind)}return V}}e.DefaultNumWorkers=(0,V.i)(),e._Default=null},13097:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>H});var V=Z(11962),h=Z(11230),J=Z(11868),l=Z(11978),e=Z(11247),C=Z(11976);class H extends V.e{static get DefaultAvailable(){return(0,V.k)(H.DefaultConfiguration)}static get Default(){return H._Default??(H._Default=new H),H._Default}static ResetDefault(f){H._Default&&(f||H._Default.dispose(),H._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(f,v){return{module:await(v||DracoDecoderModule)({wasmBinary:f})}}_getWorkerContent(){return`${C.e}(${C.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.DefaultConfiguration)}decodeMeshToMeshDataAsync(f,v,Z){const V=f instanceof ArrayBuffer?new Int8Array(f):new Int8Array(f.buffer,f.byteOffset,f.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async f=>await new Promise(((h,J)=>{f.push(((f,l)=>{let C=null;const H=[],O=v=>{f.removeEventListener("error",O),f.removeEventListener("message",u),J(v),l()},u=v=>{const V=v.data;switch(V.id){case"indices":C=V.data;break;case"attribute":H.push({kind:V.kind,data:V.data,size:V.size,byteOffset:V.byteOffset,byteStride:V.byteStride,normalized:(J=V.kind,W=V.normalized,Z&&void 0!==Z[J]?(W!==Z[J]&&e.e.Warn(`Normalized flag from Draco data (${W}) does not match normalized flag from glTF accessor (${Z[J]}). Using flag from glTF accessor.`),Z[J]):W)});break;case"decodeMeshDone":f.removeEventListener("error",O),f.removeEventListener("message",u),h({indices:C,attributes:H,totalVertices:V.totalVertices}),l()}var J,W};f.addEventListener("error",O),f.addEventListener("message",u);const W=V.slice();f.postMessage({id:"decodeMesh",dataView:W,attributes:v},[W.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((f=>{let Z=null;const h=[],J=(0,C.e)(f.module,V,v,(f=>{Z=f}),((f,v,Z,V,J,l)=>{h.push({kind:f,data:v,size:Z,byteOffset:V,byteStride:J,normalized:l})}));return{indices:Z,attributes:h,totalVertices:J}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(f,v,Z,V){const h=await this.decodeMeshToMeshDataAsync(Z,V),e=new J.c(f,v);h.indices&&e.setIndices(h.indices);for(const J of h.attributes)e.setVerticesBuffer(new l.c(v.getEngine(),J.data,J.kind,!1,void 0,J.byteStride,void 0,J.byteOffset,J.size,void 0,J.normalized,!0),h.totalVertices);return e}async _decodeMeshToGeometryForGltfAsync(f,v,Z,V,h,e){const C=await this.decodeMeshToMeshDataAsync(Z,V,h),H=new J.c(f,v);e&&(H._boundingInfo=e,H.useBoundingInfoFromGeometry=!0),C.indices&&H.setIndices(C.indices);for(const J of C.attributes)H.setVerticesBuffer(new l.c(v.getEngine(),J.data,J.kind,!1,void 0,J.byteStride,void 0,J.byteOffset,J.size,void 0,J.normalized,!0),C.totalVertices);return H}}H.DefaultConfiguration={wasmUrl:`${h.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${h.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${h.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},H._Default=null},13283:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>ef});var V=Z(11421),h=Z(11859),J=Z(11494),l=Z(11837),e=Z(11486);function C(f){let v=f.pathArray;const Z=f.closeArray||!1,V=f.closePath||!1,h=f.invertUV||!1,C=Math.floor(v[0].length/2);let H=f.offset||C;H=H>C?C:Math.floor(H);const O=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,u=f.Tf,W=f.If,a=[],b=[],X=[],F=[],U=[],K=[],M=[],A=[];let s;const z=[],Y=[];let y,N,i;if(v.length<2){const f=[],Z=[];for(N=0;N<v[0].length-H;N++)f.push(v[0][N]),Z.push(v[0][N+H]);v=[f,Z]}let I=0;const T=V?1:0,B=Z?1:0;let P,g,w,t,L,E;for(s=v[0].length,y=0;y<v.length+B;y++){for(M[y]=0,U[y]=[0],P=y===v.length?v[0]:v[y],g=P.length,s=s<g?s:g,i=0;i<g;)a.push(P[i].x,P[i].y,P[i].z),i>0&&(w=P[i].Fv(P[i-1]).length(),t=w+M[y],U[y].push(t),M[y]=t),i++;V&&(i--,a.push(P[0].x,P[0].y,P[0].z),w=P[i].Fv(P[0]).length(),t=w+M[y],U[y].push(t),M[y]=t),z[y]=g+T,Y[y]=I,I+=g+T}let j,q,c=null,m=null;for(N=0;N<s+T;N++)for(A[N]=0,K[N]=[0],y=0;y<v.length-1+B;y++)L=v[y],E=y===v.length-1?v[0]:v[y+1],N===s?(c=L[0],m=E[0]):(c=L[N],m=E[N]),w=m.Fv(c).length(),t=w+A[N],K[N].push(t),A[N]=t;if(u)for(y=0;y<u.length;y++)F.push(u[y].x,e.b?1-u[y].y:u[y].y);else for(y=0;y<v.length+B;y++)for(N=0;N<s+T;N++)j=0!=M[y]?U[y][N]/M[y]:0,q=0!=A[N]?K[N][y]/A[N]:0,h?F.push(q,j):F.push(j,e.b?1-q:q);y=0;let p=0,k=z[y]-1,r=z[y+1]-1,o=k<r?k:r,G=Y[1]-Y[0];const Q=z.length-1;for(;p<=o&&y<Q;)b.push(p,p+G,p+1),b.push(p+G+1,p+1,p+G),p+=1,p===o&&(y++,G=Y[y+1]-Y[y],k=z[y]-1,r=z[y+1]-1,p=Y[y],o=k<r?k+p:r+p);if(l.b.ComputeNormals(a,b,X),V){let f=0,Z=0;for(y=0;y<v.length;y++){f=3*Y[y],Z=y+1<v.length?3*(Y[y+1]-1):X.length-3,X[f]=.5*(X[f]+X[Z]),X[f+1]=.5*(X[f+1]+X[Z+1]),X[f+2]=.5*(X[f+2]+X[Z+2]);const V=Math.sqrt(X[f]*X[f]+X[f+1]*X[f+1]+X[f+2]*X[f+2]);X[f]/=V,X[f+1]/=V,X[f+2]/=V,X[Z]=X[f],X[Z+1]=X[f+1],X[Z+2]=X[f+2]}}if(Z){let f=3*Y[0],Z=3*Y[v.length];for(N=0;N<s+T;N++){X[f]=.5*(X[f]+X[Z]),X[f+1]=.5*(X[f+1]+X[Z+1]),X[f+2]=.5*(X[f+2]+X[Z+2]);const v=Math.sqrt(X[f]*X[f]+X[f+1]*X[f+1]+X[f+2]*X[f+2]);X[f]/=v,X[f+1]/=v,X[f+2]/=v,X[Z]=X[f],X[Z+1]=X[f+1],X[Z+2]=X[f+2],f+=3,Z+=3}}l.b._ComputeSides(O,a,b,X,F,f.frontUVs,f.backUVs);let d=null;if(W){d=new Float32Array(4*W.length);for(let f=0;f<W.length;f++)d[4*f]=W[f].r,d[4*f+1]=W[f].g,d[4*f+2]=W[f].b,d[4*f+3]=W[f].a}const x=new l.b,R=new Float32Array(a),n=new Float32Array(X),S=new Float32Array(F);return x.indices=b,x.Nf=R,x.if=n,x.Tf=S,d&&x.set(d,J.g.ColorKind),V&&(x._idx=Y),x}function H(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=v.pathArray,O=v.closeArray,u=v.closePath,W=h.d._GetDefaultSideOrientation(v.sideOrientation),a=v.instance,b=v.updatable;if(a){const f=V.TmpVectors.Xv[0].Ve(Number.MAX_VALUE),Z=V.TmpVectors.Xv[1].Ve(-Number.MAX_VALUE),C=v=>{let V=H[0].length;const J=a;let l=0;const e=J._originalBuilderSideOrientation===h.d.DOUBLESIDE?2:1;for(let h=1;h<=e;++h)for(let e=0;e<H.length;++e){const h=H[e],C=h.length;V=V<C?V:C;for(let J=0;J<V;++J){const V=h[J];v[l]=V.x,v[l+1]=V.y,v[l+2]=V.z,f.minimizeInPlaceFromFloats(V.x,V.y,V.z),Z.maximizeInPlaceFromFloats(V.x,V.y,V.z),l+=3}if(J._creationDataStorage&&J._creationDataStorage.closePath){const f=h[0];v[l]=f.x,v[l+1]=f.y,v[l+2]=f.z,l+=3}}},O=a.getVerticesData(J.g.PositionKind);if(C(O),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(f,Z,a._worldMatrix):a.buildBoundingInfo(f,Z,a._worldMatrix),a.updateVerticesData(J.g.PositionKind,O,!1,!1),v.If){const f=a.getVerticesData(J.g.ColorKind);for(let Z=0,V=0;Z<v.If.length;Z++,V+=4){const h=v.If[Z];f[V]=h.r,f[V+1]=h.g,f[V+2]=h.b,f[V+3]=h.a}a.updateVerticesData(J.g.ColorKind,f,!1,!1)}if(v.Tf){const f=a.getVerticesData(J.g.UVKind);for(let Z=0;Z<v.Tf.length;Z++)f[2*Z]=v.Tf[Z].x,f[2*Z+1]=e.b?1-v.Tf[Z].y:v.Tf[Z].y;a.updateVerticesData(J.g.UVKind,f,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){const f=a.dh(),v=a.getVerticesData(J.g.NormalKind),Z=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(l.b.ComputeNormals(O,f,v,Z),a._creationDataStorage&&a._creationDataStorage.closePath){let f=0,Z=0;for(let V=0;V<H.length;V++)f=3*a._creationDataStorage.idx[V],Z=V+1<H.length?3*(a._creationDataStorage.idx[V+1]-1):v.length-3,v[f]=.5*(v[f]+v[Z]),v[f+1]=.5*(v[f+1]+v[Z+1]),v[f+2]=.5*(v[f+2]+v[Z+2]),v[Z]=v[f],v[Z+1]=v[f+1],v[Z+2]=v[f+2]}a.areNormalsFrozen||a.updateVerticesData(J.g.NormalKind,v,!1,!1)}return a}{const V=new h.d(f,Z);V._originalBuilderSideOrientation=W,V._creationDataStorage=new h.f;const J=C(v);return u&&(V._creationDataStorage.idx=J._idx),V._creationDataStorage.closePath=u,V._creationDataStorage.closeArray=O,J.Pf(V,b),V}}l.b.CreateRibbon=C,h.d.CreateRibbon=function(f,v){return H(f,{pathArray:v,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var O=Z(12794),u=Z(12652),W=Z(11472);function a(f){const v=f.pattern||h.d.NO_FLIP,Z=f.tileWidth||f.tileSize||1,V=f.tileHeight||f.tileSize||1,J=f.alignHorizontal||0,e=f.alignVertical||0,C=f.width||f.size||1,H=Math.floor(C/Z);let O=C-H*Z;const u=f.height||f.size||1,W=Math.floor(u/V);let a=u-W*V;const b=Z*H/2,X=V*W/2;let F=0,U=0,K=0,M=0,A=0,s=0;if(O>0||a>0){switch(K=-b,M=-X,A=b,s=X,J){case h.d.CENTER:O/=2,K-=O,A+=O;break;case h.d.LEFT:A+=O,F=-O/2;break;case h.d.RIGHT:K-=O,F=O/2}switch(e){case h.d.CENTER:a/=2,M-=a,s+=a;break;case h.d.BOTTOM:s+=a,U=-a/2;break;case h.d.TOP:M-=a,U=a/2}}const z=[],Y=[],y=[];y[0]=[0,0,1,0,1,1,0,1],y[1]=[0,0,1,0,1,1,0,1],v!==h.d.ROTATE_TILE&&v!==h.d.ROTATE_ROW||(y[1]=[1,1,0,1,0,0,1,0]),v!==h.d.FLIP_TILE&&v!==h.d.FLIP_ROW||(y[1]=[1,0,0,0,0,1,1,1]),v!==h.d.FLIP_N_ROTATE_TILE&&v!==h.d.FLIP_N_ROTATE_ROW||(y[1]=[0,1,1,1,1,0,0,0]);let N=[];const i=[],I=[];let T=0;for(let l=0;l<W;l++)for(let f=0;f<H;f++)z.push(f*Z-b+F,l*V-X+U,0),z.push((f+1)*Z-b+F,l*V-X+U,0),z.push((f+1)*Z-b+F,(l+1)*V-X+U,0),z.push(f*Z-b+F,(l+1)*V-X+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),N=v===h.d.FLIP_TILE||v===h.d.ROTATE_TILE||v===h.d.FLIP_N_ROTATE_TILE?N.concat(y[(f%2+l%2)%2]):v===h.d.FLIP_ROW||v===h.d.ROTATE_ROW||v===h.d.FLIP_N_ROTATE_ROW?N.concat(y[l%2]):N.concat(y[0]),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(O>0||a>0){const f=a>0&&(e===h.d.CENTER||e===h.d.TOP),l=a>0&&(e===h.d.CENTER||e===h.d.BOTTOM),C=O>0&&(J===h.d.CENTER||J===h.d.RIGHT),u=O>0&&(J===h.d.CENTER||J===h.d.LEFT);let y,B,P,g,w=[];if(f&&C&&(z.push(K+F,M+U,0),z.push(-b+F,M+U,0),z.push(-b+F,M+a+U,0),z.push(K+F,M+a+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,y=1-O/Z,B=1-a/V,P=1,g=1,w=[y,B,P,B,P,g,y,g],v===h.d.ROTATE_ROW&&(w=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),v===h.d.FLIP_ROW&&(w=[1-y,B,1-P,B,1-P,g,1-y,g]),v===h.d.FLIP_N_ROTATE_ROW&&(w=[y,1-B,P,1-B,P,1-g,y,1-g]),N=N.concat(w),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&u&&(z.push(b+F,M+U,0),z.push(A+F,M+U,0),z.push(A+F,M+a+U,0),z.push(b+F,M+a+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,y=0,B=1-a/V,P=O/Z,g=1,w=[y,B,P,B,P,g,y,g],(v===h.d.ROTATE_ROW||v===h.d.ROTATE_TILE&&H%2===0)&&(w=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),(v===h.d.FLIP_ROW||v===h.d.FLIP_TILE&&H%2===0)&&(w=[1-y,B,1-P,B,1-P,g,1-y,g]),(v===h.d.FLIP_N_ROTATE_ROW||v===h.d.FLIP_N_ROTATE_TILE&&H%2===0)&&(w=[y,1-B,P,1-B,P,1-g,y,1-g]),N=N.concat(w),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),l&&C&&(z.push(K+F,X+U,0),z.push(-b+F,X+U,0),z.push(-b+F,s+U,0),z.push(K+F,s+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,y=1-O/Z,B=0,P=1,g=a/V,w=[y,B,P,B,P,g,y,g],(v===h.d.ROTATE_ROW&&W%2===1||v===h.d.ROTATE_TILE&&W%1===0)&&(w=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),(v===h.d.FLIP_ROW&&W%2===1||v===h.d.FLIP_TILE&&W%2===0)&&(w=[1-y,B,1-P,B,1-P,g,1-y,g]),(v===h.d.FLIP_N_ROTATE_ROW&&W%2===1||v===h.d.FLIP_N_ROTATE_TILE&&W%2===0)&&(w=[y,1-B,P,1-B,P,1-g,y,1-g]),N=N.concat(w),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),l&&u&&(z.push(b+F,X+U,0),z.push(A+F,X+U,0),z.push(A+F,s+U,0),z.push(b+F,s+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,y=0,B=0,P=O/Z,g=a/V,w=[y,B,P,B,P,g,y,g],(v===h.d.ROTATE_ROW&&W%2===1||v===h.d.ROTATE_TILE&&(W+H)%2===1)&&(w=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),(v===h.d.FLIP_ROW&&W%2===1||v===h.d.FLIP_TILE&&(W+H)%2===1)&&(w=[1-y,B,1-P,B,1-P,g,1-y,g]),(v===h.d.FLIP_N_ROTATE_ROW&&W%2===1||v===h.d.FLIP_N_ROTATE_TILE&&(W+H)%2===1)&&(w=[y,1-B,P,1-B,P,1-g,y,1-g]),N=N.concat(w),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f){const f=[];y=0,B=1-a/V,P=1,g=1,f[0]=[y,B,P,B,P,g,y,g],f[1]=[y,B,P,B,P,g,y,g],v!==h.d.ROTATE_TILE&&v!==h.d.ROTATE_ROW||(f[1]=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),v!==h.d.FLIP_TILE&&v!==h.d.FLIP_ROW||(f[1]=[1-y,B,1-P,B,1-P,g,1-y,g]),v!==h.d.FLIP_N_ROTATE_TILE&&v!==h.d.FLIP_N_ROTATE_ROW||(f[1]=[y,1-B,P,1-B,P,1-g,y,1-g]);for(let V=0;V<H;V++)z.push(V*Z-b+F,M+U,0),z.push((V+1)*Z-b+F,M+U,0),z.push((V+1)*Z-b+F,M+a+U,0),z.push(V*Z-b+F,M+a+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,N=v===h.d.FLIP_TILE||v===h.d.ROTATE_TILE||v===h.d.FLIP_N_ROTATE_TILE?N.concat(f[(V+1)%2]):v===h.d.FLIP_ROW||v===h.d.ROTATE_ROW||v===h.d.FLIP_N_ROTATE_ROW?N.concat(f[1]):N.concat(f[0]),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const f=[];y=0,B=0,P=1,g=a/V,f[0]=[y,B,P,B,P,g,y,g],f[1]=[y,B,P,B,P,g,y,g],v!==h.d.ROTATE_TILE&&v!==h.d.ROTATE_ROW||(f[1]=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),v!==h.d.FLIP_TILE&&v!==h.d.FLIP_ROW||(f[1]=[1-y,B,1-P,B,1-P,g,1-y,g]),v!==h.d.FLIP_N_ROTATE_TILE&&v!==h.d.FLIP_N_ROTATE_ROW||(f[1]=[y,1-B,P,1-B,P,1-g,y,1-g]);for(let V=0;V<H;V++)z.push(V*Z-b+F,s-a+U,0),z.push((V+1)*Z-b+F,s-a+U,0),z.push((V+1)*Z-b+F,s+U,0),z.push(V*Z-b+F,s+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,N=v===h.d.FLIP_TILE||v===h.d.ROTATE_TILE||v===h.d.FLIP_N_ROTATE_TILE?N.concat(f[(V+W)%2]):v===h.d.FLIP_ROW||v===h.d.ROTATE_ROW||v===h.d.FLIP_N_ROTATE_ROW?N.concat(f[W%2]):N.concat(f[0]),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const f=[];y=1-O/Z,B=0,P=1,g=1,f[0]=[y,B,P,B,P,g,y,g],f[1]=[y,B,P,B,P,g,y,g],v!==h.d.ROTATE_TILE&&v!==h.d.ROTATE_ROW||(f[1]=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),v!==h.d.FLIP_TILE&&v!==h.d.FLIP_ROW||(f[1]=[1-y,B,1-P,B,1-P,g,1-y,g]),v!==h.d.FLIP_N_ROTATE_TILE&&v!==h.d.FLIP_N_ROTATE_ROW||(f[1]=[y,1-B,P,1-B,P,1-g,y,1-g]);for(let Z=0;Z<W;Z++)z.push(K+F,Z*V-X+U,0),z.push(K+O+F,Z*V-X+U,0),z.push(K+O+F,(Z+1)*V-X+U,0),z.push(K+F,(Z+1)*V-X+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,N=v===h.d.FLIP_TILE||v===h.d.ROTATE_TILE||v===h.d.FLIP_N_ROTATE_TILE?N.concat(f[(Z+1)%2]):v===h.d.FLIP_ROW||v===h.d.ROTATE_ROW||v===h.d.FLIP_N_ROTATE_ROW?N.concat(f[Z%2]):N.concat(f[0]),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const f=[];y=0,B=0,P=O/V,g=1,f[0]=[y,B,P,B,P,g,y,g],f[1]=[y,B,P,B,P,g,y,g],v!==h.d.ROTATE_TILE&&v!==h.d.ROTATE_ROW||(f[1]=[1-y,1-B,1-P,1-B,1-P,1-g,1-y,1-g]),v!==h.d.FLIP_TILE&&v!==h.d.FLIP_ROW||(f[1]=[1-y,B,1-P,B,1-P,g,1-y,g]),v!==h.d.FLIP_N_ROTATE_TILE&&v!==h.d.FLIP_N_ROTATE_ROW||(f[1]=[y,1-B,P,1-B,P,1-g,y,1-g]);for(let Z=0;Z<W;Z++)z.push(A-O+F,Z*V-X+U,0),z.push(A+F,Z*V-X+U,0),z.push(A+F,(Z+1)*V-X+U,0),z.push(A-O+F,(Z+1)*V-X+U,0),I.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,N=v===h.d.FLIP_TILE||v===h.d.ROTATE_TILE||v===h.d.FLIP_N_ROTATE_TILE?N.concat(f[(Z+H)%2]):v===h.d.FLIP_ROW||v===h.d.ROTATE_ROW||v===h.d.FLIP_N_ROTATE_ROW?N.concat(f[Z%2]):N.concat(f[0]),i.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const B=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE;l.b._ComputeSides(B,z,I,Y,N,f.frontUVs,f.backUVs);const P=new l.b;P.indices=I,P.Nf=z,P.if=Y,P.Tf=N;const g=B===l.b.DOUBLESIDE?i.concat(i):i;return P.If=g,P}function b(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return a(v).Pf(V,v.updatable),V}function X(f){const v=f.faceUV||new Array(6),Z=f.faceColors,J=f.pattern||h.d.NO_FLIP,C=f.width||f.size||1,H=f.height||f.size||1,O=f.depth||f.size||1,u=f.tileWidth||f.tileSize||1,b=f.tileHeight||f.tileSize||1,X=f.alignHorizontal||0,F=f.alignVertical||0,U=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE;for(let h=0;h<6;h++)void 0===v[h]&&(v[h]=new V.Vector4(0,0,1,1)),Z&&void 0===Z[h]&&(Z[h]=new W.he(1,1,1,1));const K=C/2,M=H/2,A=O/2,s=[];for(let V=0;V<2;V++)s[V]=a({pattern:J,tileWidth:u,tileHeight:b,width:C,height:H,alignVertical:F,alignHorizontal:X,sideOrientation:U});for(let V=2;V<4;V++)s[V]=a({pattern:J,tileWidth:u,tileHeight:b,width:O,height:H,alignVertical:F,alignHorizontal:X,sideOrientation:U});let z=F;F===h.d.BOTTOM?z=h.d.TOP:F===h.d.TOP&&(z=h.d.BOTTOM);for(let V=4;V<6;V++)s[V]=a({pattern:J,tileWidth:u,tileHeight:b,width:C,height:O,alignVertical:z,alignHorizontal:X,sideOrientation:U});let Y=[],y=[],N=[],i=[];const I=[],T=[],B=[],P=[];let g=0,w=0;for(let h=0;h<6;h++){const f=s[h].Nf.length;T[h]=[],B[h]=[];for(let v=0;v<f/3;v++)T[h].push(new V.Xv(s[h].Nf[3*v],s[h].Nf[3*v+1],s[h].Nf[3*v+2])),B[h].push(new V.Xv(s[h].if[3*v],s[h].if[3*v+1],s[h].if[3*v+2]));g=s[h].Tf.length,P[h]=[];for(let Z=0;Z<g;Z+=2)P[h][Z]=v[h].x+(v[h].z-v[h].x)*s[h].Tf[Z],P[h][Z+1]=v[h].y+(v[h].w-v[h].y)*s[h].Tf[Z+1],e.b&&(P[h][Z+1]=1-P[h][Z+1]);if(N=N.concat(P[h]),i=i.concat(s[h].indices.map((f=>f+w))),w+=T[h].length,Z)for(let v=0;v<4;v++)I.push(Z[h].r,Z[h].g,Z[h].b,Z[h].a)}const t=new V.Xv(0,0,A),L=V.Matrix.RotationY(Math.PI);Y=T[0].map((f=>V.Xv.TransformNormal(f,L).add(t))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[]),y=B[0].map((f=>V.Xv.TransformNormal(f,L))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[]),Y=Y.concat(T[1].map((f=>f.Fv(t))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[])),y=y.concat(B[1].map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[]));const E=new V.Xv(K,0,0),j=V.Matrix.RotationY(-Math.PI/2);Y=Y.concat(T[2].map((f=>V.Xv.TransformNormal(f,j).add(E))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[])),y=y.concat(B[2].map((f=>V.Xv.TransformNormal(f,j))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[]));const q=V.Matrix.RotationY(Math.PI/2);Y=Y.concat(T[3].map((f=>V.Xv.TransformNormal(f,q).Fv(E))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[])),y=y.concat(B[3].map((f=>V.Xv.TransformNormal(f,q))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[]));const c=new V.Xv(0,M,0),m=V.Matrix.RotationX(Math.PI/2);Y=Y.concat(T[4].map((f=>V.Xv.TransformNormal(f,m).add(c))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[])),y=y.concat(B[4].map((f=>V.Xv.TransformNormal(f,m))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[]));const p=V.Matrix.RotationX(-Math.PI/2);Y=Y.concat(T[5].map((f=>V.Xv.TransformNormal(f,p).Fv(c))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[])),y=y.concat(B[5].map((f=>V.Xv.TransformNormal(f,p))).map((f=>[f.x,f.y,f.z])).reduce(((f,v)=>f.concat(v)),[])),l.b._ComputeSides(U,Y,i,y,N);const k=new l.b;if(k.indices=i,k.Nf=Y,k.if=y,k.Tf=N,Z){const f=U===l.b.DOUBLESIDE?I.concat(I):I;k.If=f}return k}function F(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return X(v).Pf(V,v.updatable),V}l.b.CreateTiledPlane=a;l.b.CreateTiledBox=X;var U=Z(12783),K=Z(11646),M=Z(11603);function A(f){const v=f.height||2;let Z=0===f.diameterTop?0:f.diameterTop||f.diameter||1,J=0===f.diameterBottom?0:f.diameterBottom||f.diameter||1;Z=Z||1e-5,J=J||1e-5;const C=0|(f.tessellation||24),H=0|(f.subdivisions||1),O=!!f.hasRings,u=!!f.enclose,a=0===f.cap?0:f.cap||h.d.CAP_ALL,b=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,X=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,F=f.faceUV||new Array(3),U=f.faceColors,K=2+(1+(1!==b&&u?2:0))*(O?H:1);let A;for(A=0;A<K;A++)U&&void 0===U[A]&&(U[A]=new W.he(1,1,1,1));for(A=0;A<K;A++)F&&void 0===F[A]&&(F[A]=new V.Vector4(0,0,1,1));const s=[],z=[],Y=[],y=[],N=[],i=2*Math.PI*b/C;let I,T,B;const P=(J-Z)/2/v,g=V.Xv.Zero(),w=V.Xv.Zero(),t=V.Xv.Zero(),L=V.Xv.Zero(),E=V.Xv.Zero(),j=M.c.Y;let q,c,m,p=1,k=1,r=0,o=0;for(q=0;q<=H;q++)for(T=q/H,B=(T*(Z-J)+J)/2,p=O&&0!==q&&q!==H?2:1,m=0;m<p;m++){for(O&&(k+=m),u&&(k+=2*m),c=0;c<=C;c++)I=c*i,g.x=Math.cos(-I)*B,g.y=-v/2+T*v,g.z=Math.sin(-I)*B,0===Z&&q===H?(w.x=Y[Y.length-3*(C+1)],w.y=Y[Y.length-3*(C+1)+1],w.z=Y[Y.length-3*(C+1)+2]):(w.x=g.x,w.z=g.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*P,w.normalize()),0===c&&(t.h(g),L.h(w)),z.push(g.x,g.y,g.z),Y.push(w.x,w.y,w.z),o=O?r!==k?F[k].y:F[k].w:F[k].y+(F[k].w-F[k].y)*T,y.push(F[k].x+(F[k].z-F[k].x)*c/C,e.b?1-o:o),U&&N.push(U[k].r,U[k].g,U[k].b,U[k].a);1!==b&&u&&(z.push(g.x,g.y,g.z),z.push(0,g.y,0),z.push(0,g.y,0),z.push(t.x,t.y,t.z),V.Xv.CrossToRef(j,w,E),E.normalize(),Y.push(E.x,E.y,E.z,E.x,E.y,E.z),V.Xv.CrossToRef(L,j,E),E.normalize(),Y.push(E.x,E.y,E.z,E.x,E.y,E.z),o=O?r!==k?F[k+1].y:F[k+1].w:F[k+1].y+(F[k+1].w-F[k+1].y)*T,y.push(F[k+1].x,e.b?1-o:o),y.push(F[k+1].z,e.b?1-o:o),o=O?r!==k?F[k+2].y:F[k+2].w:F[k+2].y+(F[k+2].w-F[k+2].y)*T,y.push(F[k+2].x,e.b?1-o:o),y.push(F[k+2].z,e.b?1-o:o),U&&(N.push(U[k+1].r,U[k+1].g,U[k+1].b,U[k+1].a),N.push(U[k+1].r,U[k+1].g,U[k+1].b,U[k+1].a),N.push(U[k+2].r,U[k+2].g,U[k+2].b,U[k+2].a),N.push(U[k+2].r,U[k+2].g,U[k+2].b,U[k+2].a))),r!==k&&(r=k)}const G=1!==b&&u?C+4:C;for(q=0,k=0;k<H;k++){let f=0,v=0,Z=0,V=0;for(c=0;c<C;c++)f=q*(G+1)+c,v=(q+1)*(G+1)+c,Z=q*(G+1)+(c+1),V=(q+1)*(G+1)+(c+1),s.push(f,v,Z),s.push(V,Z,v);1!==b&&u&&(s.push(f+2,v+2,Z+2),s.push(V+2,Z+2,v+2),s.push(f+4,v+4,Z+4),s.push(V+4,Z+4,v+4)),q=O?q+2:q+1}const Q=f=>{const h=f?Z/2:J/2;if(0===h)return;let l,H,O;const u=f?F[K-1]:F[0];let W=null;U&&(W=f?U[K-1]:U[0]);const a=z.length/3,X=f?v/2:-v/2,M=new V.Xv(0,X,0);z.push(M.x,M.y,M.z),Y.push(0,f?1:-1,0);const A=u.y+.5*(u.w-u.y);y.push(u.x+.5*(u.z-u.x),e.b?1-A:A),W&&N.push(W.r,W.g,W.b,W.a);const i=new V.Vector2(.5,.5);for(O=0;O<=C;O++){l=2*Math.PI*O*b/C;const v=Math.cos(-l),Z=Math.sin(-l);H=new V.Xv(v*h,X,Z*h);const J=new V.Vector2(v*i.x+.5,Z*i.y+.5);z.push(H.x,H.y,H.z),Y.push(0,f?1:-1,0);const a=u.y+(u.w-u.y)*J.y;y.push(u.x+(u.z-u.x)*J.x,e.b?1-a:a),W&&N.push(W.r,W.g,W.b,W.a)}for(O=0;O<C;O++)f?(s.push(a),s.push(a+(O+2)),s.push(a+(O+1))):(s.push(a),s.push(a+(O+1)),s.push(a+(O+2)))};a!==h.d.CAP_START&&a!==h.d.CAP_ALL||Q(!1),a!==h.d.CAP_END&&a!==h.d.CAP_ALL||Q(!0),l.b._ComputeSides(X,z,s,Y,y,f.frontUVs,f.backUVs);const d=new l.b;return d.indices=s,d.Nf=z,d.if=Y,d.Tf=y,U&&(d.If=N),d}function s(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return A(v).Pf(V,v.updatable),V}function z(f){const v=[],Z=[],h=[],J=[],C=f.diameter||1,H=f.thickness||.5,O=0|(f.tessellation||16),u=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,W=O+1;for(let l=0;l<=O;l++){const f=l/O,u=l*Math.PI*2/O-Math.PI/2,a=V.Matrix.Translation(C/2,0,0).multiply(V.Matrix.RotationY(u));for(let C=0;C<=O;C++){const u=1-C/O,b=C*Math.PI*2/O+Math.PI,X=Math.cos(b),F=Math.sin(b);let U=new V.Xv(X,F,0),K=U.scale(H/2);const M=new V.Vector2(f,u);K=V.Xv.TransformCoordinates(K,a),U=V.Xv.TransformNormal(U,a),Z.push(K.x,K.y,K.z),h.push(U.x,U.y,U.z),J.push(M.x,e.b?1-M.y:M.y);const A=(l+1)%W,s=(C+1)%W;v.push(l*W+C),v.push(l*W+s),v.push(A*W+C),v.push(l*W+s),v.push(A*W+s),v.push(A*W+C)}}l.b._ComputeSides(u,Z,v,h,J,f.frontUVs,f.backUVs);const a=new l.b;return a.indices=v,a.Nf=Z,a.if=h,a.Tf=J,a}function Y(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return z(v).Pf(V,v.updatable),V}l.b.CreateCylinder=A,h.d.CreateCylinder=(f,v,Z,V,J,l,e,C,H)=>{void 0!==e&&e instanceof K.b||(void 0!==e&&(H=C||h.d.DEFAULTSIDE,C=e),e=l,l=1);return s(f,{height:v,diameterTop:Z,diameterBottom:V,tessellation:J,subdivisions:l,sideOrientation:H,updatable:C},e)};function y(f){const v=[],Z=[],h=[],J=[],C=f.radius||2,H=f.tube||.5,O=f.radialSegments||32,u=f.tubularSegments||32,W=f.p||2,a=f.q||3,b=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,X=f=>{const v=Math.cos(f),Z=Math.sin(f),h=a/W*f,J=Math.cos(h),l=C*(2+J)*.5*v,e=C*(2+J)*Z*.5,H=C*Math.sin(h)*.5;return new V.Xv(l,e,H)};let F,U;for(F=0;F<=O;F++){const f=F%O/O*2*W*Math.PI,v=X(f),h=X(f+.01),l=h.Fv(v);let C=h.add(v);const a=V.Xv.Cross(l,C);for(C=V.Xv.Cross(a,l),a.normalize(),C.normalize(),U=0;U<u;U++){const f=U%u/u*2*Math.PI,V=-H*Math.cos(f),h=H*Math.sin(f);Z.push(v.x+V*C.x+h*a.x),Z.push(v.y+V*C.y+h*a.y),Z.push(v.z+V*C.z+h*a.z),J.push(F/O),J.push(e.b?1-U/u:U/u)}}for(F=0;F<O;F++)for(U=0;U<u;U++){const f=(U+1)%u,Z=F*u+U,V=(F+1)*u+U,h=(F+1)*u+f,J=F*u+f;v.push(J),v.push(V),v.push(Z),v.push(J),v.push(h),v.push(V)}l.b.ComputeNormals(Z,v,h),l.b._ComputeSides(b,Z,v,h,J,f.frontUVs,f.backUVs);const K=new l.b;return K.indices=v,K.Nf=Z,K.if=h,K.Tf=J,K}function N(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return y(v).Pf(V,v.updatable),V}l.b.CreateTorus=z,h.d.CreateTorus=(f,v,Z,V,h,J,l)=>Y(f,{diameter:v,thickness:Z,tessellation:V,sideOrientation:l,updatable:J},h);l.b.CreateTorusKnot=y,h.d.CreateTorusKnot=(f,v,Z,V,h,J,l,e,C,H)=>N(f,{radius:v,tube:Z,radialSegments:V,tubularSegments:h,p:J,q:l,sideOrientation:H,updatable:C},e);var i=Z(13289),I=Z(11957),T=Z(11609);function B(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=v.path,J=v.shape,l=v.scale||1,e=v.rotation||0,C=0===v.cap?0:v.cap||h.d.NO_CAP,H=v.updatable,O=h.d._GetDefaultSideOrientation(v.sideOrientation),u=v.instance||null,W=v.invertUV||!1,a=v.closeShape||!1,b=v.closePath||!1,X=v.capFunction||null;return g(f,J,V,l,e,null,null,b,a,C,!1,Z,!!H,O,u,W,v.frontUVs||null,v.backUVs||null,v.firstNormal||null,!!v.adjustFrame,X)}function P(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=v.path,J=v.shape,l=v.scaleFunction||(()=>1),e=v.rotationFunction||(()=>0),C=v.closePath||v.ribbonCloseArray||!1,H=v.closeShape||v.ribbonClosePath||!1,O=0===v.cap?0:v.cap||h.d.NO_CAP,u=v.updatable,W=v.firstNormal||null,a=v.adjustFrame||!1,b=h.d._GetDefaultSideOrientation(v.sideOrientation),X=v.instance,F=v.invertUV||!1,U=v.capFunction||null;return g(f,J,V,null,null,l,e,C,H,O,!0,Z,!!u,b,X||null,F,v.frontUVs||null,v.backUVs||null,W,a,U||null)}function g(f,v,Z,J,l,e,C,O,u,W,a,b,X,F,U,K,M,A,s,z,Y){const y=(f,v,Z,J,l,e,C,H,O,u,W)=>{const a=Z.getTangents(),b=Z.getNormals(),X=Z.getBinormals(),F=Z.getDistances();if(W)for(let h=0;h<a.length;h++)if(0==a[h].x&&0==a[h].y&&0==a[h].z&&a[h].h(a[h-1]),0==b[h].x&&0==b[h].y&&0==b[h].z&&b[h].h(b[h-1]),0==X[h].x&&0==X[h].y&&0==X[h].z&&X[h].h(X[h-1]),h>0){let f=a[h-1];V.Xv.Dot(f,a[h])<0&&a[h].scaleInPlace(-1),f=b[h-1],V.Xv.Dot(f,b[h])<0&&b[h].scaleInPlace(-1),f=X[h-1],V.Xv.Dot(f,X[h])<0&&X[h].scaleInPlace(-1)}let U=0;const K=u&&H?H:()=>null!==e?e:0,M=u&&C?C:()=>null!==l?l:1;let A=O===h.d.NO_CAP||O===h.d.CAP_END?0:2;const s=V.TmpVectors.Matrix[0];for(let h=0;h<v.length;h++){const Z=[],l=K(h,F[h]),e=M(h,F[h]);V.Matrix.RotationAxisToRef(a[h],U,s);for(let J=0;J<f.length;J++){const l=a[h].scale(f[J].z).add(b[h].scale(f[J].x)).add(X[h].scale(f[J].y)),C=V.Xv.Zero();V.Xv.TransformCoordinatesToRef(l,s,C),C.scaleInPlace(e).addInPlace(v[h]),Z[J]=C}J[A]=Z,U+=l,A++}const z=Y||(f=>{const v=Array(),Z=V.Xv.Zero();let h;for(h=0;h<f.length;h++)Z.addInPlace(f[h]);for(Z.scaleInPlace(1/f.length),h=0;h<f.length;h++)v.push(Z);return v});switch(O){case h.d.NO_CAP:break;case h.d.CAP_START:J[0]=z(J[2]),J[1]=J[2];break;case h.d.CAP_END:J[A]=J[A-1],J[A+1]=z(J[A-1]);break;case h.d.CAP_ALL:J[0]=z(J[2]),J[1]=J[2],J[A]=J[A-1],J[A+1]=z(J[A-1])}return J};let N,i;if(U){const f=U._creationDataStorage;return N=s?f.path3D.update(Z,s):f.path3D.update(Z),i=y(v,Z,f.path3D,f.pathArray,J,l,e,C,f.cap,a,z),U=H("",{pathArray:i,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},b||void 0)}N=s?new T.j(Z,s):new T.j(Z);i=y(v,Z,N,new Array,J,l,e,C,W=W<0||W>3?0:W,a,z);const I=H(f,{pathArray:i,closeArray:O,closePath:u,updatable:X,sideOrientation:F,invertUV:K,frontUVs:M||void 0,backUVs:A||void 0},b);return I._creationDataStorage.pathArray=i,I._creationDataStorage.path3D=N,I._creationDataStorage.cap=W,I}function w(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=v.arc?v.arc<=0||v.arc>1?1:v.arc:1,l=void 0===v.closed||v.closed,e=v.shape,C=v.radius||1,O=v.tessellation||64,u=v.clip||0,W=v.updatable,a=h.d._GetDefaultSideOrientation(v.sideOrientation),b=v.cap||h.d.NO_CAP,X=2*Math.PI,F=[],U=v.invertUV||!1;let K=0,M=0;const A=X/O*J;let s,z;for(K=0;K<=O-u;K++){for(z=[],b!=h.d.CAP_START&&b!=h.d.CAP_ALL||(z.push(new V.Xv(0,e[0].y,0)),z.push(new V.Xv(Math.cos(K*A)*e[0].x*C,e[0].y,Math.sin(K*A)*e[0].x*C))),M=0;M<e.length;M++)s=new V.Xv(Math.cos(K*A)*e[M].x*C,e[M].y,Math.sin(K*A)*e[M].x*C),z.push(s);b!=h.d.CAP_END&&b!=h.d.CAP_ALL||(z.push(new V.Xv(Math.cos(K*A)*e[e.length-1].x*C,e[e.length-1].y,Math.sin(K*A)*e[e.length-1].x*C)),z.push(new V.Xv(0,e[e.length-1].y,0))),F.push(z)}return H(f,{pathArray:F,closeArray:l,sideOrientation:a,updatable:W,invertUV:U,frontUVs:v.frontUVs,backUVs:v.backUVs},Z)}h.d.ExtrudeShape=function(f,v,Z,V,J,l){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,H=arguments.length>8?arguments[8]:void 0,O=arguments.length>9?arguments[9]:void 0;return B(f,{shape:v,path:Z,scale:V,rotation:J,cap:0===l?0:l||h.d.NO_CAP,sideOrientation:H,instance:O,updatable:C},e)},h.d.ExtrudeShapeCustom=(f,v,Z,V,J,l,e,C,H,O,u,W)=>P(f,{shape:v,path:Z,scaleFunction:V,rotationFunction:J,ribbonCloseArray:l,ribbonClosePath:e,cap:0===C?0:C||h.d.NO_CAP,sideOrientation:u,instance:W,updatable:O},H);h.d.CreateLathe=(f,v,Z,V,h,J,l)=>w(f,{shape:v,radius:Z,tessellation:V,sideOrientation:l,updatable:J},h);var t=Z(12702),L=Z(12654);function E(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=v.path;let l=v.instance,e=1;void 0!==v.radius?e=v.radius:l&&(e=l._creationDataStorage.radius);const C=v.tessellation||64,O=v.radiusFunction||null;let u=v.cap||h.d.NO_CAP;const W=v.invertUV||!1,a=v.updatable,b=h.d._GetDefaultSideOrientation(v.sideOrientation);v.arc=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1;const X=(f,v,Z,J,l,e,C,H)=>{const O=v.getTangents(),u=v.getNormals(),W=v.getDistances(),a=2*Math.PI/l*H,b=e||(()=>J);let X,F,U,K;const M=V.TmpVectors.Matrix[0];let A=C===h.d.NO_CAP||C===h.d.CAP_END?0:2;for(let h=0;h<f.length;h++){F=b(h,W[h]),X=Array(),U=u[h];for(let v=0;v<l;v++)V.Matrix.RotationAxisToRef(O[h],a*v,M),K=X[v]?X[v]:V.Xv.Zero(),V.Xv.TransformCoordinatesToRef(U,M,K),K.scaleInPlace(F).addInPlace(f[h]),X[v]=K;Z[A]=X,A++}const s=(v,Z)=>{const V=Array();for(let h=0;h<v;h++)V.push(f[Z]);return V};switch(C){case h.d.NO_CAP:break;case h.d.CAP_START:Z[0]=s(l,0),Z[1]=Z[2].slice(0);break;case h.d.CAP_END:Z[A]=Z[A-1].slice(0),Z[A+1]=s(l,f.length-1);break;case h.d.CAP_ALL:Z[0]=s(l,0),Z[1]=Z[2].slice(0),Z[A]=Z[A-1].slice(0),Z[A+1]=s(l,f.length-1)}return Z};let F,U;if(l){const f=l._creationDataStorage,Z=v.arc||f.arc;return F=f.path3D.update(J),U=X(J,F,f.pathArray,e,f.tessellation,O,f.cap,Z),l=H("",{pathArray:U,instance:l}),f.path3D=F,f.pathArray=U,f.arc=Z,f.radius=e,l}F=new T.j(J);u=u<0||u>3?0:u,U=X(J,F,new Array,e,C,O,u,v.arc);const K=H(f,{pathArray:U,closePath:!0,closeArray:!1,updatable:a,sideOrientation:b,invertUV:W,frontUVs:v.frontUVs,backUVs:v.backUVs},Z);return K._creationDataStorage.pathArray=U,K._creationDataStorage.path3D=F,K._creationDataStorage.tessellation=C,K._creationDataStorage.cap=u,K._creationDataStorage.arc=v.arc,K._creationDataStorage.radius=e,K}function j(f){const v=[];v[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},v[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},v[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},v[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},v[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},v[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},v[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},v[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},v[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},v[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},v[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},v[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},v[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},v[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},v[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Z=f.type&&(f.type<0||f.type>=v.length)?0:f.type||0,h=f.size,J=f.sizeX||h||1,C=f.sizeY||h||1,H=f.sizeZ||h||1,O=f.custom||v[Z],u=O.face.length,a=f.faceUV||new Array(u),b=f.faceColors,X=void 0===f.flat||f.flat,F=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,U=[],K=[],M=[],A=[],s=[];let z=0,Y=0;const y=[];let N,i,I,T,B,P,g=0,w=0;if(X)for(w=0;w<u;w++)b&&void 0===b[w]&&(b[w]=new W.he(1,1,1,1)),a&&void 0===a[w]&&(a[w]=new V.Vector4(0,0,1,1));if(X)for(w=0;w<u;w++){const f=O.face[w].length;for(I=2*Math.PI/f,T=.5*Math.tan(I/2),B=.5,g=0;g<f;g++)U.push(O.vertex[O.face[w][g]][0]*J,O.vertex[O.face[w][g]][1]*C,O.vertex[O.face[w][g]][2]*H),y.push(z),z++,N=a[w].x+(a[w].z-a[w].x)*(.5+T),i=a[w].y+(a[w].w-a[w].y)*(B-.5),A.push(N,e.b?1-i:i),P=T*Math.cos(I)-B*Math.sin(I),B=T*Math.sin(I)+B*Math.cos(I),T=P,b&&s.push(b[w].r,b[w].g,b[w].b,b[w].a);for(g=0;g<f-2;g++)K.push(y[0+Y],y[g+2+Y],y[g+1+Y]);Y+=f}else{for(g=0;g<O.vertex.length;g++)U.push(O.vertex[g][0]*J,O.vertex[g][1]*C,O.vertex[g][2]*H),A.push(0,e.b?1:0);for(w=0;w<u;w++)for(g=0;g<O.face[w].length-2;g++)K.push(O.face[w][0],O.face[w][g+2],O.face[w][g+1])}l.b.ComputeNormals(U,K,M),l.b._ComputeSides(F,U,K,M,A,f.frontUVs,f.backUVs);const t=new l.b;return t.Nf=U,t.indices=K,t.if=M,t.Tf=A,b&&X&&(t.If=s),t}function q(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return j(v).Pf(V,v.updatable),V}h.d.CreateTube=(f,v,Z,V,h,J,l,e,C,H)=>E(f,{path:v,radius:Z,tessellation:V,radiusFunction:h,arc:1,cap:J,updatable:e,sideOrientation:C,instance:H},l);function c(f){const v=f.sideOrientation||l.b.DEFAULTSIDE,Z=f.radius||1,h=void 0===f.flat||f.flat,J=0|(f.subdivisions||4),C=f.radiusX||Z,H=f.radiusY||Z,O=f.radiusZ||Z,u=(1+Math.sqrt(5))/2,W=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],a=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],b=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],X=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],F=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],K=[],M=[],A=[];let s=0;const z=new Array(3),Y=new Array(3);let y;for(y=0;y<3;y++)z[y]=V.Xv.Zero(),Y[y]=V.Vector2.Zero();for(let l=0;l<20;l++){for(y=0;y<3;y++){const f=a[3*l+y];z[y].fe(W[3*b[f]],W[3*b[f]+1],W[3*b[f]+2]),z[y].normalize(),Y[y].fe(.134765625*X[2*f]+.05859375+-.0390625*F[l],.2333984375*X[2*f+1]+.025390625+.01953125*F[l])}const f=(f,v,Z,l)=>{const u=V.Xv.Lerp(z[0],z[2],v/J),W=V.Xv.Lerp(z[1],z[2],v/J),a=J===v?z[2]:V.Xv.Lerp(u,W,f/(J-v));let b;if(a.normalize(),h){const f=V.Xv.Lerp(z[0],z[2],l/J),v=V.Xv.Lerp(z[1],z[2],l/J);b=V.Xv.Lerp(f,v,Z/(J-l))}else b=new V.Xv(a.x,a.y,a.z);b.x/=C,b.y/=H,b.z/=O,b.normalize();const X=V.Vector2.Lerp(Y[0],Y[2],v/J),F=V.Vector2.Lerp(Y[1],Y[2],v/J),y=J===v?Y[2]:V.Vector2.Lerp(X,F,f/(J-v));K.push(a.x*C,a.y*H,a.z*O),M.push(b.x,b.y,b.z),A.push(y.x,e.b?1-y.y:y.y),U.push(s),s++};for(let v=0;v<J;v++)for(let Z=0;Z+v<J;Z++)f(Z,v,Z+1/3,v+1/3),f(Z+1,v,Z+1/3,v+1/3),f(Z,v+1,Z+1/3,v+1/3),Z+v+1<J&&(f(Z+1,v,Z+2/3,v+2/3),f(Z+1,v+1,Z+2/3,v+2/3),f(Z,v+1,Z+2/3,v+2/3))}l.b._ComputeSides(v,K,U,M,A,f.frontUVs,f.backUVs);const N=new l.b;return N.indices=U,N.Nf=K,N.if=M,N.Tf=A,N}function m(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new h.d(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),V._originalBuilderSideOrientation=v.sideOrientation;return c(v).Pf(V,v.updatable),V}l.b.CreatePolyhedron=j,h.d.CreatePolyhedron=(f,v,Z)=>q(f,v,Z);l.b.CreateIcoSphere=c,h.d.CreateIcoSphere=(f,v,Z)=>m(f,v,Z);var p=Z(11440);const k=new V.Xv(1,0,0),r=new V.Xv(-1,0,0),o=new V.Xv(0,1,0),G=new V.Xv(0,-1,0),Q=new V.Xv(0,0,1),d=new V.Xv(0,0,-1);class x{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.Xv.Zero(),v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.Xv.Up(),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.Vector2.Zero(),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=f,this.normal=v,this.uv=Z,this.vertexIdx=h,this.vertexIdxForBones=J,this.localPositionOverride=l,this.localNormalOverride=e,this.matrixIndicesOverride=C,this.matrixWeightsOverride=H}clone(){var f,v,Z,V;return new x(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(f=this.localPositionOverride)||void 0===f?void 0:f.slice(),null===(v=this.localNormalOverride)||void 0===v?void 0:v.slice(),null===(Z=this.matrixIndicesOverride)||void 0===Z?void 0:Z.slice(),null===(V=this.matrixWeightsOverride)||void 0===V?void 0:V.slice())}}function R(f,v,Z){var C,H,O,u,W;const a=!!v.skeleton,b=!(null===(C=v.morphTargetManager)||void 0===C||!C.numTargets),X=Z.localMode||a,F=v.dh(),U=a||b?v.Ee(!0,!0):v.getVerticesData(J.g.PositionKind),K=a||b?v.getNormalsData(!0,!0):v.getVerticesData(J.g.NormalKind),M=X?a?v.getVerticesData(J.g.PositionKind):U:null,A=X?a?v.getVerticesData(J.g.NormalKind):K:null,s=v.getVerticesData(J.g.UVKind),z=a?v.getVerticesData(J.g.MatricesIndicesKind):null,Y=a?v.getVerticesData(J.g.MatricesWeightsKind):null,y=a?v.getVerticesData(J.g.MatricesIndicesExtraKind):null,N=a?v.getVerticesData(J.g.MatricesWeightsExtraKind):null,i=Z.position||V.Xv.Zero();let I=Z.normal||V.Xv.Up();const T=Z.size||V.Xv.One(),B=Z.angle||0;if(!I){const f=new V.Xv(0,0,1),Z=v.Yf().activeCamera,h=V.Xv.TransformCoordinates(f,Z.getWorldMatrix());I=Z.globalPosition.Fv(h)}const P=-Math.atan2(I.z,I.x)-Math.PI/2,g=Math.sqrt(I.x*I.x+I.z*I.z),w=Math.atan2(I.y,g),t=new l.b;t.indices=[],t.Nf=[],t.if=[],t.Tf=[],t.matricesIndices=a?[]:null,t.matricesWeights=a?[]:null,t.matricesIndicesExtra=y?[]:null,t.matricesWeightsExtra=N?[]:null;let L=0;const E=(f,v)=>{const h=new x;if(!F||!U||!K)return h;const J=F[f];if(h.vertexIdx=3*J,h.vertexIdxForBones=4*J,h.position=new V.Xv(U[3*J],U[3*J+1],U[3*J+2]),V.Xv.TransformCoordinatesToRef(h.position,v,h.position),h.normal=new V.Xv(K[3*J],K[3*J+1],K[3*J+2]),V.Xv.TransformNormalToRef(h.normal,v,h.normal),Z.captureUVS&&s){const f=s[2*J+1];h.uv=new V.Vector2(s[2*J],e.b?1-f:f)}return h},j=[0,0,0,0],q=(f,v)=>{if(0===f.length)return f;const Z=.5*Math.abs(V.Xv.Dot(T,v)),h=(f,v,Z,V)=>{for(let h=0;h<V;++h)if(f[Z+h]===v)return Z+h;return-1},J=(f,J)=>{const l=V.Xv.GetClipFactor(f.position,J.position,v,Z);let e=j,C=j;if(z&&Y){const v=f.matrixIndicesOverride?0:f.vertexIdxForBones,Z=f.matrixIndicesOverride??z,V=f.matrixWeightsOverride??Y,H=J.matrixIndicesOverride?0:J.vertexIdxForBones,O=J.matrixIndicesOverride??z,u=J.matrixWeightsOverride??Y;e=[0,0,0,0],C=[0,0,0,0];let W=0;for(let f=0;f<4;++f)if(V[v+f]>0){const J=h(O,Z[v+f],H,4);e[W]=Z[v+f],C[W]=(0,p.Lerp)(V[v+f],J>=0?u[J]:0,l),W++}for(let f=0;f<4&&W<4;++f){const V=O[H+f];-1===h(Z,V,v,4)&&(e[W]=V,C[W]=(0,p.Lerp)(0,u[H+f],l),W++)}const a=C[0]+C[1]+C[2]+C[3];C[0]/=a,C[1]/=a,C[2]/=a,C[3]/=a}const H=f.localPositionOverride?f.localPositionOverride[0]:(null===M||void 0===M?void 0:M[f.vertexIdx])??0,O=f.localPositionOverride?f.localPositionOverride[1]:(null===M||void 0===M?void 0:M[f.vertexIdx+1])??0,u=f.localPositionOverride?f.localPositionOverride[2]:(null===M||void 0===M?void 0:M[f.vertexIdx+2])??0,W=J.localPositionOverride?J.localPositionOverride[0]:(null===M||void 0===M?void 0:M[J.vertexIdx])??0,a=J.localPositionOverride?J.localPositionOverride[1]:(null===M||void 0===M?void 0:M[J.vertexIdx+1])??0,b=J.localPositionOverride?J.localPositionOverride[2]:(null===M||void 0===M?void 0:M[J.vertexIdx+2])??0,X=f.localNormalOverride?f.localNormalOverride[0]:(null===A||void 0===A?void 0:A[f.vertexIdx])??0,F=f.localNormalOverride?f.localNormalOverride[1]:(null===A||void 0===A?void 0:A[f.vertexIdx+1])??0,U=f.localNormalOverride?f.localNormalOverride[2]:(null===A||void 0===A?void 0:A[f.vertexIdx+2])??0,K=X+((J.localNormalOverride?J.localNormalOverride[0]:(null===A||void 0===A?void 0:A[J.vertexIdx])??0)-X)*l,s=F+((J.localNormalOverride?J.localNormalOverride[1]:(null===A||void 0===A?void 0:A[J.vertexIdx+1])??0)-F)*l,y=U+((J.localNormalOverride?J.localNormalOverride[2]:(null===A||void 0===A?void 0:A[J.vertexIdx+2])??0)-U)*l,N=Math.sqrt(K*K+s*s+y*y);return new x(V.Xv.Lerp(f.position,J.position,l),V.Xv.Lerp(f.normal,J.normal,l).normalize(),V.Vector2.Lerp(f.uv,J.uv,l),-1,-1,M?[H+(W-H)*l,O+(a-O)*l,u+(b-u)*l]:null,A?[K/N,s/N,y/N]:null,e,C)};let l=null;f.length>3&&(l=[]);for(let e=0;e<f.length;e+=3){let h=0,C=null,H=null,O=null,u=null;const W=V.Xv.Dot(f[e].position,v)-Z>0,a=V.Xv.Dot(f[e+1].position,v)-Z>0,b=V.Xv.Dot(f[e+2].position,v)-Z>0;switch(h=(W?1:0)+(a?1:0)+(b?1:0),h){case 0:f.length>3?(l.push(f[e]),l.push(f[e+1]),l.push(f[e+2])):l=f;break;case 1:if(l=l??new Array,W&&(C=f[e+1],H=f[e+2],O=J(f[e],C),u=J(f[e],H)),a){C=f[e],H=f[e+2],O=J(f[e+1],C),u=J(f[e+1],H),l.push(O),l.push(H.clone()),l.push(C.clone()),l.push(H.clone()),l.push(O.clone()),l.push(u);break}b&&(C=f[e],H=f[e+1],O=J(f[e+2],C),u=J(f[e+2],H)),C&&H&&O&&u&&(l.push(C.clone()),l.push(H.clone()),l.push(O),l.push(u),l.push(O.clone()),l.push(H.clone()));break;case 2:l=l??new Array,W||(C=f[e].clone(),H=J(C,f[e+1]),O=J(C,f[e+2]),l.push(C),l.push(H),l.push(O)),a||(C=f[e+1].clone(),H=J(C,f[e+2]),O=J(C,f[e]),l.push(C),l.push(H),l.push(O)),b||(C=f[e+2].clone(),H=J(C,f[e]),O=J(C,f[e+1]),l.push(C),l.push(H),l.push(O))}}return l},c=v instanceof h.d?v:null,m=null===c||void 0===c?void 0:c._thinInstanceDataStorage.matrixData,R=(null===c||void 0===c?void 0:c.Fe)||1,n=V.TmpVectors.Matrix[0];n.h(V.Matrix.IdentityReadOnly);for(let h=0;h<R;++h){if(null!==c&&void 0!==c&&c.hasThinInstances&&m){const f=16*h;n.setRowFromFloats(0,m[f+0],m[f+1],m[f+2],m[f+3]),n.setRowFromFloats(1,m[f+4],m[f+5],m[f+6],m[f+7]),n.setRowFromFloats(2,m[f+8],m[f+9],m[f+10],m[f+11]),n.setRowFromFloats(3,m[f+12],m[f+13],m[f+14],m[f+15])}const f=V.Matrix.RotationYawPitchRoll(P,w,B).multiply(V.Matrix.Translation(i.x,i.y,i.z)),J=V.Matrix.Invert(f),l=v.getWorldMatrix(),C=n.multiply(l).multiply(J),H=new Array(3);for(let v=0;v<F.length;v+=3){let f=H;if(f[0]=E(v,C),f[1]=E(v+1,C),f[2]=E(v+2,C),!(Z.cullBackFaces&&-f[0].normal.z<=0&&-f[1].normal.z<=0&&-f[2].normal.z<=0)&&(f=q(f,k),f&&(f=q(f,r),f&&(f=q(f,o),f&&(f=q(f,G),f&&(f=q(f,Q),f&&(f=q(f,d),f)))))))for(let v=0;v<f.length;v++){const V=f[v];if(t.indices.push(L),X?(V.localPositionOverride?(t.Nf[3*L]=V.localPositionOverride[0],t.Nf[3*L+1]=V.localPositionOverride[1],t.Nf[3*L+2]=V.localPositionOverride[2]):M&&(t.Nf[3*L]=M[V.vertexIdx],t.Nf[3*L+1]=M[V.vertexIdx+1],t.Nf[3*L+2]=M[V.vertexIdx+2]),V.localNormalOverride?(t.if[3*L]=V.localNormalOverride[0],t.if[3*L+1]=V.localNormalOverride[1],t.if[3*L+2]=V.localNormalOverride[2]):A&&(t.if[3*L]=A[V.vertexIdx],t.if[3*L+1]=A[V.vertexIdx+1],t.if[3*L+2]=A[V.vertexIdx+2])):(V.position.toArray(t.Nf,3*L),V.normal.toArray(t.if,3*L)),t.matricesIndices&&t.matricesWeights&&(V.matrixIndicesOverride?(t.matricesIndices[4*L]=V.matrixIndicesOverride[0],t.matricesIndices[4*L+1]=V.matrixIndicesOverride[1],t.matricesIndices[4*L+2]=V.matrixIndicesOverride[2],t.matricesIndices[4*L+3]=V.matrixIndicesOverride[3]):(z&&(t.matricesIndices[4*L]=z[V.vertexIdxForBones],t.matricesIndices[4*L+1]=z[V.vertexIdxForBones+1],t.matricesIndices[4*L+2]=z[V.vertexIdxForBones+2],t.matricesIndices[4*L+3]=z[V.vertexIdxForBones+3]),y&&t.matricesIndicesExtra&&(t.matricesIndicesExtra[4*L]=y[V.vertexIdxForBones],t.matricesIndicesExtra[4*L+1]=y[V.vertexIdxForBones+1],t.matricesIndicesExtra[4*L+2]=y[V.vertexIdxForBones+2],t.matricesIndicesExtra[4*L+3]=y[V.vertexIdxForBones+3])),V.matrixWeightsOverride?(t.matricesWeights[4*L]=V.matrixWeightsOverride[0],t.matricesWeights[4*L+1]=V.matrixWeightsOverride[1],t.matricesWeights[4*L+2]=V.matrixWeightsOverride[2],t.matricesWeights[4*L+3]=V.matrixWeightsOverride[3]):(Y&&(t.matricesWeights[4*L]=Y[V.vertexIdxForBones],t.matricesWeights[4*L+1]=Y[V.vertexIdxForBones+1],t.matricesWeights[4*L+2]=Y[V.vertexIdxForBones+2],t.matricesWeights[4*L+3]=Y[V.vertexIdxForBones+3]),N&&t.matricesWeightsExtra&&(t.matricesWeightsExtra[4*L]=N[V.vertexIdxForBones],t.matricesWeightsExtra[4*L+1]=N[V.vertexIdxForBones+1],t.matricesWeightsExtra[4*L+2]=N[V.vertexIdxForBones+2],t.matricesWeightsExtra[4*L+3]=N[V.vertexIdxForBones+3]))),Z.captureUVS)V.uv.toArray(t.Tf,2*L);else{t.Tf.push(.5+V.position.x/T.x);const f=.5+V.position.y/T.y;t.Tf.push(e.b?1-f:f)}L++}}}0===t.indices.length&&(t.indices=null),0===t.Nf.length&&(t.Nf=null),0===t.if.length&&(t.if=null),0===t.Tf.length&&(t.Tf=null),0===(null===(H=t.matricesIndices)||void 0===H?void 0:H.length)&&(t.matricesIndices=null),0===(null===(O=t.matricesWeights)||void 0===O?void 0:O.length)&&(t.matricesWeights=null),0===(null===(u=t.matricesIndicesExtra)||void 0===u?void 0:u.length)&&(t.matricesIndicesExtra=null),0===(null===(W=t.matricesWeightsExtra)||void 0===W?void 0:W.length)&&(t.matricesWeightsExtra=null);const S=new h.d(f,v.Yf());return t.Pf(S),X?(S.skeleton=v.skeleton,S.parent=v):(S.position=i.clone(),S.rotation=new V.Xv(w,P,B)),S.jh(!0),S.refreshBoundingInfo(!0,!0),S}function n(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const v=0|Math.max(f.subdivisions?f.subdivisions:2,1),Z=0|Math.max(f.tessellation?f.tessellation:16,3),h=Math.max(f.height?f.height:1,0),J=Math.max(f.radius?f.radius:.25,0),C=0|Math.max(f.capSubdivisions?f.capSubdivisions:6,1),H=Z,O=v,u=Math.max(f.radiusTop?f.radiusTop:J,0),W=Math.max(f.radiusBottom?f.radiusBottom:J,0),a=h-(u+W),b=2*Math.PI,X=Math.max(f.topCapSubdivisions?f.topCapSubdivisions:C,1),F=Math.max(f.bottomCapSubdivisions?f.bottomCapSubdivisions:C,1),U=Math.acos((W-u)/h);let K=[];const M=[],A=[],s=[];let z=0;const Y=[],y=.5*a,N=.5*Math.PI;let i,I;const T=V.Xv.Zero(),B=V.Xv.Zero(),P=Math.cos(U),g=Math.sin(U),w=new V.Vector2(u*g,y+u*P).Fv(new V.Vector2(W*g,W*P-y)).length(),t=u*U+w+W*(N-U);let L=0;for(I=0;I<=X;I++){const f=[],v=N-U*(I/X);L+=u*U/X;const Z=Math.cos(v),V=Math.sin(v),h=Z*u;for(i=0;i<=H;i++){const v=i/H,J=v*b+0,l=Math.sin(J),C=Math.cos(J);B.x=h*l,B.y=y+V*u,B.z=h*C,M.push(B.x,B.y,B.z),T.set(Z*l,V,Z*C),A.push(T.x,T.y,T.z),s.push(v,e.b?L/t:1-L/t),f.push(z),z++}Y.push(f)}const E=h-u-W+P*u-P*W,j=g*(W-u)/E;for(I=1;I<=O;I++){const f=[];L+=w/O;const v=g*(I*(W-u)/O+u);for(i=0;i<=H;i++){const Z=i/H,V=Z*b+0,h=Math.sin(V),J=Math.cos(V);B.x=v*h,B.y=y+P*u-I*E/O,B.z=v*J,M.push(B.x,B.y,B.z),T.set(h,j,J).normalize(),A.push(T.x,T.y,T.z),s.push(Z,e.b?L/t:1-L/t),f.push(z),z++}Y.push(f)}for(I=1;I<=F;I++){const f=[],v=N-U-(Math.PI-U)*(I/F);L+=W*U/F;const Z=Math.cos(v),V=Math.sin(v),h=Z*W;for(i=0;i<=H;i++){const v=i/H,J=v*b+0,l=Math.sin(J),C=Math.cos(J);B.x=h*l,B.y=V*W-y,B.z=h*C,M.push(B.x,B.y,B.z),T.set(Z*l,V,Z*C),A.push(T.x,T.y,T.z),s.push(v,e.b?L/t:1-L/t),f.push(z),z++}Y.push(f)}for(i=0;i<H;i++)for(I=0;I<X+O+F;I++){const f=Y[I][i],v=Y[I+1][i],Z=Y[I+1][i+1],V=Y[I][i+1];K.push(f),K.push(v),K.push(V),K.push(v),K.push(Z),K.push(V)}if(K=K.reverse(),f.orientation&&!f.orientation.equals(V.Xv.Up())){const v=new V.Matrix;f.orientation.clone().scale(.5*Math.PI).cross(V.Xv.Up()).toQuaternion().toRotationMatrix(v);const Z=V.Xv.Zero();for(let f=0;f<M.length;f+=3)Z.set(M[f],M[f+1],M[f+2]),V.Xv.TransformCoordinatesToRef(Z.clone(),v,Z),M[f]=Z.x,M[f+1]=Z.y,M[f+2]=Z.z}const q=new l.b;return q.Nf=M,q.if=A,q.Tf=s,q.indices=K,q}function S(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:V.Xv.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new h.d(f,Z);return n(v).Pf(J,v.updatable),J}h.d.CreateDecal=(f,v,Z,V,h,J)=>R(f,v,{position:Z,normal:V,size:h,angle:J});h.d.CreateCapsule=(f,v,Z)=>S(f,v,Z),l.b.CreateCapsule=n;var D=Z(11247),ff=Z(11428);class vf{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=f,this.y=v,f!==Math.floor(f)&&(f=Math.floor(f),D.e.Warn("x is not an integer, floor(x) used")),v!==Math.floor(v)&&(v=Math.floor(v),D.e.Warn("y is not an integer, floor(y) used"))}clone(){return new vf(this.x,this.y)}rotate60About(f){const v=this.x;return this.x=f.x+f.y-this.y,this.y=v+this.y-f.x,this}rotateNeg60About(f){const v=this.x;return this.x=v+this.y-f.y,this.y=f.x+f.y-v,this}rotate120(f,v){f!==Math.floor(f)&&(f=Math.floor(f),D.e.Warn("m not an integer only floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),D.e.Warn("n not an integer only floor(n) used"));const Z=this.x;return this.x=f-Z-this.y,this.y=v+Z,this}rotateNeg120(f,v){f!==Math.floor(f)&&(f=Math.floor(f),D.e.Warn("m is not an integer, floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),D.e.Warn("n is not an integer,   floor(n) used"));const Z=this.x;return this.x=this.y-v,this.y=f+v-Z-this.y,this}toCartesianOrigin(f,v){const Z=V.Xv.Zero();return Z.x=f.x+2*this.x*v+this.y*v,Z.y=f.y+Math.sqrt(3)*this.y*v,Z}static Zero(){return new vf(0,0)}}class Zf{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Vf("icosahedron","Regular",[[0,ff.e,-1],[-ff.e,1,0],[-1,0,-ff.e],[1,0,-ff.e],[ff.e,1,0],[0,ff.e,1],[-1,0,ff.e],[-ff.e,-1,0],[0,-ff.e,-1],[ff.e,-1,0],[1,0,ff.e],[0,-ff.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let f=12;const v={},Z=this.m,V=this.n;let h,J,l,e,C,H=Z,O=1,u=0;0!==V&&(H=(0,p.HighestCommonFactor)(Z,V)),O=Z/H,u=V/H;const W=vf.Zero(),a=new vf(Z,V),b=new vf(-V,Z+V),X=vf.Zero(),F=vf.Zero(),U=vf.Zero();let K,M,A,s,z=[];const Y=[],y=this.vertByDist,N=(Z,V,h,J)=>{K=Z+"|"+h,M=V+"|"+J,K in v||M in v?K in v&&!(M in v)?v[M]=v[K]:M in v&&!(K in v)&&(v[K]=v[M]):(v[K]=f,v[M]=f,f++),y[h][0]>2?Y[v[K]]=[-y[h][0],y[h][1],v[K]]:Y[v[K]]=[z[y[h][0]],y[h][1],v[K]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let i=0;i<20;i++){if(z=this.IDATA.face[i],l=z[2],e=z[1],C=z[0],A=W.x+"|"+W.y,K=i+"|"+A,K in v||(v[K]=l,Y[l]=[z[y[A][0]],y[A][1]]),A=a.x+"|"+a.y,K=i+"|"+A,K in v||(v[K]=e,Y[e]=[z[y[A][0]],y[A][1]]),A=b.x+"|"+b.y,K=i+"|"+A,K in v||(v[K]=C,Y[C]=[z[y[A][0]],y[A][1]]),h=this.IDATA.edgematch[i][0],J=this.IDATA.edgematch[i][1],"B"===J)for(let f=1;f<H;f++)F.x=Z-f*(O+u),F.y=V+f*O,U.x=-f*u,U.y=f*(O+u),A=F.x+"|"+F.y,s=U.x+"|"+U.y,N(i,h,A,s);if("O"===J)for(let f=1;f<H;f++)U.x=-f*u,U.y=f*(O+u),X.x=f*O,X.y=f*u,A=U.x+"|"+U.y,s=X.x+"|"+X.y,N(i,h,A,s);if(h=this.IDATA.edgematch[i][2],J=this.IDATA.edgematch[i][3],J&&"A"===J)for(let f=1;f<H;f++)X.x=f*O,X.y=f*u,F.x=Z-(H-f)*(O+u),F.y=V+(H-f)*O,A=X.x+"|"+X.y,s=F.x+"|"+F.y,N(i,h,A,s);for(let Z=0;Z<this.vertices.length;Z++)A=this.vertices[Z].x+"|"+this.vertices[Z].y,K=i+"|"+A,K in v||(v[K]=f++,y[A][0]>2?Y[v[K]]=[-y[A][0],y[A][1],v[K]]:Y[v[K]]=[z[y[A][0]],y[A][1],v[K]])}this.closestTo=Y,this.vecToidx=v}calcCoeffs(){const f=this.m,v=this.n,Z=Math.sqrt(3)/3,V=f*f+v*v+f*v;this.coau=(f+v)/V,this.cobu=-v/V,this.coav=-Z*(f-v)/V,this.cobv=Z*(2*f+v)/V}createInnerFacets(){const f=this.m,v=this.n;for(let Z=0;Z<v+f+1;Z++)for(let f=this.min[Z];f<this.max[Z]+1;f++)f<this.max[Z]&&f<this.max[Z+1]+1&&this.innerFacets.push(["|"+f+"|"+Z,"|"+f+"|"+(Z+1),"|"+(f+1)+"|"+Z]),Z>0&&f<this.max[Z-1]&&f+1<this.max[Z]+1&&this.innerFacets.push(["|"+f+"|"+Z,"|"+(f+1)+"|"+Z,"|"+(f+1)+"|"+(Z-1)])}edgeVecsABOB(){const f=this.m,v=this.n,Z=new vf(-v,f+v);for(let V=1;V<f+v;V++){const f=new vf(this.min[V],V),v=new vf(this.min[V-1],V-1),h=new vf(this.min[V+1],V+1),J=f.clone(),l=v.clone(),e=h.clone();J.rotate60About(Z),l.rotate60About(Z),e.rotate60About(Z);const C=new vf(this.max[J.y],J.y),H=new vf(this.max[J.y-1],J.y-1),O=new vf(this.max[J.y-1]-1,J.y-1);J.x===C.x&&J.y===C.y||(J.x!==H.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,H,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,O,C])):J.y===e.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([f,v,H]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([f,H,h])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([f,v,H]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,H,C])))}}mapABOBtoOBOA(){const f=new vf(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const Z=[];for(let V=0;V<3;V++)f.x=this.isoVecsABOB[v][V].x,f.y=this.isoVecsABOB[v][V].y,0===this.vertexTypes[v][V]&&f.rotateNeg120(this.m,this.n),Z.push(f.clone());this.isoVecsOBOA.push(Z)}}mapABOBtoBAOA(){const f=new vf(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const Z=[];for(let V=0;V<3;V++)f.x=this.isoVecsABOB[v][V].x,f.y=this.isoVecsABOB[v][V].y,1===this.vertexTypes[v][V]&&f.rotate120(this.m,this.n),Z.push(f.clone());this.isoVecsBAOA.push(Z)}}MapToFace(f,v){const Z=this.IDATA.face[f],h=Z[2],J=Z[1],l=Z[0],e=V.Xv.Av(this.IDATA.vertex[h]),C=V.Xv.Av(this.IDATA.vertex[J]),H=V.Xv.Av(this.IDATA.vertex[l]),O=C.Fv(e),u=H.Fv(e),W=O.scale(this.coau).add(u.scale(this.cobu)),a=O.scale(this.coav).add(u.scale(this.cobv)),b=[];let X,F=V.TmpVectors.Xv[0];for(let V=0;V<this.cartesian.length;V++)F=W.scale(this.cartesian[V].x).add(a.scale(this.cartesian[V].y)).add(e),b[V]=[F.x,F.y,F.z],X=f+"|"+this.vertices[V].x+"|"+this.vertices[V].y,v.vertex[this.vecToidx[X]]=[F.x,F.y,F.z]}build(f,v){const Z=[],V=vf.Zero(),h=new vf(f,v),J=new vf(-v,f+v);Z.push(V,h,J);for(let A=v;A<f+1;A++)for(let v=0;v<f+1-A;v++)Z.push(new vf(v,A));if(v>0){const V=(0,p.HighestCommonFactor)(f,v),h=f/V,J=v/V;for(let e=1;e<V;e++)Z.push(new vf(e*h,e*J)),Z.push(new vf(-e*J,e*(h+J))),Z.push(new vf(f-e*(h+J),v+e*h));const l=f/v;for(let e=1;e<v;e++)for(let V=0;V<e*l;V++)Z.push(new vf(V,e)),Z.push(new vf(V,e).rotate120(f,v)),Z.push(new vf(V,e).rotateNeg120(f,v))}Z.sort(((f,v)=>f.x-v.x)),Z.sort(((f,v)=>f.y-v.y));const l=new Array(f+v+1),e=new Array(f+v+1);for(let A=0;A<l.length;A++)l[A]=1/0,e[A]=-1/0;let C=0,H=0;const O=Z.length;for(let A=0;A<O;A++)H=Z[A].x,C=Z[A].y,l[C]=Math.min(H,l[C]),e[C]=Math.max(H,e[C]);const u=(Z,V)=>{const h=Z.clone();return"A"===V&&h.rotateNeg120(f,v),"B"===V&&h.rotate120(f,v),h.x<0?h.y:h.x+h.y},W=[],a=[],b=[],X=[],F={},U=[];let K=-1,M=-1;for(let A=0;A<O;A++)W[A]=Z[A].toCartesianOrigin(new vf(0,0),.5),a[A]=u(Z[A],"O"),b[A]=u(Z[A],"A"),X[A]=u(Z[A],"B"),a[A]===b[A]&&b[A]===X[A]?(K=3,M=a[A]):a[A]===b[A]?(K=4,M=a[A]):b[A]===X[A]?(K=5,M=b[A]):X[A]===a[A]&&(K=6,M=a[A]),a[A]<b[A]&&a[A]<X[A]&&(K=2,M=a[A]),b[A]<a[A]&&b[A]<X[A]&&(K=1,M=b[A]),X[A]<b[A]&&X[A]<a[A]&&(K=0,M=X[A]),U.push([K,M,Z[A].x,Z[A].y]);U.sort(((f,v)=>f[2]-v[2])),U.sort(((f,v)=>f[3]-v[3])),U.sort(((f,v)=>f[1]-v[1])),U.sort(((f,v)=>f[0]-v[0]));for(let A=0;A<U.length;A++)F[U[A][2]+"|"+U[A][3]]=[U[A][0],U[A][1],A];return this.m=f,this.n=v,this.vertices=Z,this.vertByDist=F,this.cartesian=W,this.min=l,this.max=e,this}}class Vf{constructor(f,v,Z,V){this.name=f,this.category=v,this.vertex=Z,this.face=V}}class hf extends Vf{innerToData(f,v){for(let Z=0;Z<v.innerFacets.length;Z++)this.face.push(v.innerFacets[Z].map((Z=>v.vecToidx[f+Z])))}mapABOBtoDATA(f,v){const Z=v.IDATA.edgematch[f][0];for(let V=0;V<v.isoVecsABOB.length;V++){const h=[];for(let J=0;J<3;J++)0===v.vertexTypes[V][J]?h.push(f+"|"+v.isoVecsABOB[V][J].x+"|"+v.isoVecsABOB[V][J].y):h.push(Z+"|"+v.isoVecsABOB[V][J].x+"|"+v.isoVecsABOB[V][J].y);this.face.push([v.vecToidx[h[0]],v.vecToidx[h[1]],v.vecToidx[h[2]]])}}mapOBOAtoDATA(f,v){const Z=v.IDATA.edgematch[f][0];for(let V=0;V<v.isoVecsOBOA.length;V++){const h=[];for(let J=0;J<3;J++)1===v.vertexTypes[V][J]?h.push(f+"|"+v.isoVecsOBOA[V][J].x+"|"+v.isoVecsOBOA[V][J].y):h.push(Z+"|"+v.isoVecsOBOA[V][J].x+"|"+v.isoVecsOBOA[V][J].y);this.face.push([v.vecToidx[h[0]],v.vecToidx[h[1]],v.vecToidx[h[2]]])}}mapBAOAtoDATA(f,v){const Z=v.IDATA.edgematch[f][2];for(let V=0;V<v.isoVecsBAOA.length;V++){const h=[];for(let J=0;J<3;J++)1===v.vertexTypes[V][J]?h.push(f+"|"+v.isoVecsBAOA[V][J].x+"|"+v.isoVecsBAOA[V][J].y):h.push(Z+"|"+v.isoVecsBAOA[V][J].x+"|"+v.isoVecsBAOA[V][J].y);this.face.push([v.vecToidx[h[0]],v.vecToidx[h[1]],v.vecToidx[h[2]]])}}orderData(f){const v=[];for(let J=0;J<13;J++)v[J]=[];const Z=f.closestTo;for(let J=0;J<Z.length;J++)Z[J][0]>-1?Z[J][1]>0&&v[Z[J][0]].push([J,Z[J][1]]):v[12].push([J,Z[J][0]]);const V=[];for(let J=0;J<12;J++)V[J]=J;let h=12;for(let J=0;J<12;J++){v[J].sort(((f,v)=>f[1]-v[1]));for(let f=0;f<v[J].length;f++)V[v[J][f][0]]=h++}for(let J=0;J<v[12].length;J++)V[v[12][J][0]]=h++;for(let J=0;J<this.vertex.length;J++)this.vertex[J].push(V[J]);this.vertex.sort(((f,v)=>f[3]-v[3]));for(let J=0;J<this.vertex.length;J++)this.vertex[J].pop();for(let J=0;J<this.face.length;J++)for(let f=0;f<this.face[J].length;f++)this.face[J][f]=V[this.face[J][f]];this.sharedNodes=v[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(f,v){const Z=[],V=[];let h=v.pop();V.push(h);let J=this.face[h].indexOf(f);J=(J+2)%3;let l=this.face[h][J];Z.push(l);let e=0;for(;v.length>0;)h=v[e],this.face[h].indexOf(l)>-1?(J=(this.face[h].indexOf(l)+1)%3,l=this.face[h][J],Z.push(l),V.push(h),v.splice(e,1),e=0):e++;return this.adjacentFaces.push(Z),V}toGoldbergPolyhedronData(){const f=new Vf("GeoDual","Goldberg",[],[]);f.name="GD dual";const v=this.vertex.length,Z=new Array(v);for(let C=0;C<v;C++)Z[C]=[];for(let C=0;C<this.face.length;C++)for(let f=0;f<3;f++)Z[this.face[C][f]].push(C);let V=0,h=0,J=0,l=[],e=[];this.adjacentFaces=[];for(let C=0;C<Z.length;C++){f.face[C]=this.setOrder(C,Z[C].concat([]));for(const v of Z[C]){V=0,h=0,J=0,l=this.face[v];for(let f=0;f<3;f++)e=this.vertex[l[f]],V+=e[0],h+=e[1],J+=e[2];f.vertex[v]=[V/3,h/3,J/3]}}return f}static BuildGeodesicData(f){const v=new hf("Geodesic-m-n","Geodesic",[[0,ff.e,-1],[-ff.e,1,0],[-1,0,-ff.e],[1,0,-ff.e],[ff.e,1,0],[0,ff.e,1],[-1,0,ff.e],[-ff.e,-1,0],[0,-ff.e,-1],[ff.e,-1,0],[1,0,ff.e],[0,-ff.e,1]],[]);f.setIndices(),f.calcCoeffs(),f.createInnerFacets(),f.edgeVecsABOB(),f.mapABOBtoOBOA(),f.mapABOBtoBAOA();for(let Z=0;Z<f.IDATA.face.length;Z++)f.MapToFace(Z,v),v.innerToData(Z,f),"B"===f.IDATA.edgematch[Z][1]&&v.mapABOBtoDATA(Z,f),"O"===f.IDATA.edgematch[Z][1]&&v.mapOBOAtoDATA(Z,f),"A"===f.IDATA.edgematch[Z][3]&&v.mapBAOAtoDATA(Z,f);v.orderData(f);return v.vertex=v.vertex.map((function(f){const v=f[0],Z=f[1],V=f[2],h=Math.sqrt(v*v+Z*Z+V*V);return f[0]*=1/h,f[1]*=1/h,f[2]*=1/h,f})),v}}h.d._GoldbergMeshParser=(f,v)=>Jf.Parse(f,v);class Jf extends h.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(f,v){return void 0===v?(f>this.goldbergData.nbUnsharedFaces-1&&(D.e.Warn("Maximum number of unshared faces used"),f=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+f):(f>11&&(D.e.Warn("Last pole used"),f=11),v>this.goldbergData.nbFacesAtPole-1&&(D.e.Warn("Maximum number of faces at a pole used"),v=this.goldbergData.nbFacesAtPole-1),12+f*this.goldbergData.nbFacesAtPole+v)}_changeGoldbergFaceColors(f){for(let Z=0;Z<f.length;Z++){const v=f[Z][0],V=f[Z][1],h=f[Z][2];for(let f=v;f<V+1;f++)this.goldbergData.faceColors[f]=h}const v=[];for(let Z=0;Z<12;Z++)for(let f=0;f<5;f++)v.push(this.goldbergData.faceColors[Z].r,this.goldbergData.faceColors[Z].g,this.goldbergData.faceColors[Z].b,this.goldbergData.faceColors[Z].a);for(let Z=12;Z<this.goldbergData.faceColors.length;Z++)for(let f=0;f<6;f++)v.push(this.goldbergData.faceColors[Z].r,this.goldbergData.faceColors[Z].g,this.goldbergData.faceColors[Z].b,this.goldbergData.faceColors[Z].a);return v}setGoldbergFaceColors(f){const v=this._changeGoldbergFaceColors(f);this.Lf(J.g.ColorKind,v)}updateGoldbergFaceColors(f){const v=this._changeGoldbergFaceColors(f);this.updateVerticesData(J.g.ColorKind,v)}_changeGoldbergFaceUVs(f){const v=this.getVerticesData(J.g.UVKind);for(let Z=0;Z<f.length;Z++){const V=f[Z][0],h=f[Z][1],J=f[Z][2],l=f[Z][3],e=f[Z][4],C=[],H=[];let O,u;for(let f=0;f<5;f++)O=J.x+l*Math.cos(e+f*Math.PI/2.5),u=J.y+l*Math.sin(e+f*Math.PI/2.5),O<0&&(O=0),O>1&&(O=1),C.push(O,u);for(let f=0;f<6;f++)O=J.x+l*Math.cos(e+f*Math.PI/3),u=J.y+l*Math.sin(e+f*Math.PI/3),O<0&&(O=0),O>1&&(O=1),H.push(O,u);for(let f=V;f<Math.min(12,h+1);f++)for(let Z=0;Z<5;Z++)v[10*f+2*Z]=C[2*Z],v[10*f+2*Z+1]=C[2*Z+1];for(let f=Math.max(12,V);f<h+1;f++)for(let Z=0;Z<6;Z++)v[12*f-24+2*Z]=H[2*Z],v[12*f-23+2*Z]=H[2*Z+1]}return v}setGoldbergFaceUVs(f){const v=this._changeGoldbergFaceUVs(f);this.Lf(J.g.UVKind,v)}updateGoldbergFaceUVs(f){const v=this._changeGoldbergFaceUVs(f);this.updateVerticesData(J.g.UVKind,v)}placeOnGoldbergFaceAt(f,v,Z){const h=V.Xv.RotationFromAxis(this.goldbergData.faceXaxis[v],this.goldbergData.faceYaxis[v],this.goldbergData.faceZaxis[v]);f.rotation=h,f.position=this.goldbergData.faceCenters[v].add(this.goldbergData.faceXaxis[v].scale(Z.x)).add(this.goldbergData.faceYaxis[v].scale(Z.y)).add(this.goldbergData.faceZaxis[v].scale(Z.z))}serialize(f){super.serialize(f),f.type="GoldbergMesh";const v={};if(v.adjacentFaces=this.goldbergData.adjacentFaces,v.nbSharedFaces=this.goldbergData.nbSharedFaces,v.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,v.nbFaces=this.goldbergData.nbFaces,v.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){v.faceColors=[];for(const f of this.goldbergData.faceColors)v.faceColors.push(f.Ph())}if(this.goldbergData.faceCenters){v.faceCenters=[];for(const f of this.goldbergData.faceCenters)v.faceCenters.push(f.Ph())}if(this.goldbergData.faceZaxis){v.faceZaxis=[];for(const f of this.goldbergData.faceZaxis)v.faceZaxis.push(f.Ph())}if(this.goldbergData.faceYaxis){v.faceYaxis=[];for(const f of this.goldbergData.faceYaxis)v.faceYaxis.push(f.Ph())}if(this.goldbergData.faceXaxis){v.faceXaxis=[];for(const f of this.goldbergData.faceXaxis)v.faceXaxis.push(f.Ph())}f.goldbergData=v}static Parse(f,v){const Z=f.goldbergData;Z.faceColors=Z.faceColors.map((f=>W.he.Av(f))),Z.faceCenters=Z.faceCenters.map((f=>V.Xv.Av(f))),Z.faceZaxis=Z.faceZaxis.map((f=>V.Xv.Av(f))),Z.faceXaxis=Z.faceXaxis.map((f=>V.Xv.Av(f))),Z.faceYaxis=Z.faceYaxis.map((f=>V.Xv.Av(f)));const h=new Jf(f.name,v);return h.goldbergData=Z,h}}var lf=Z(11950);const ef={CreateBox:u.c,CreateTiledBox:F,CreateSphere:U.d,CreateDisc:O.e,CreateIcoSphere:m,CreateRibbon:H,CreateCylinder:s,CreateTorus:Y,CreateTorusKnot:N,CreateLineSystem:i.f,zH:i.g,CreateDashedLines:i.b,ExtrudeShape:B,ExtrudeShapeCustom:P,CreateLathe:w,CreateTiledPlane:b,NH:t.d,CreateGround:L.i,CreateTiledGround:L.j,CreateGroundFromHeightMap:L.e,CreatePolygon:I.c,ExtrudePolygon:I.e,CreateTube:E,CreatePolyhedron:q,CreateGeodesic:function(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=v.m||1;V!==Math.floor(V)&&(V=Math.floor(V),D.e.Warn("m not an integer only floor(m) used"));let h=v.n||0;if(h!==Math.floor(h)&&(h=Math.floor(h),D.e.Warn("n not an integer only floor(n) used")),h>V){const f=h;h=V,V=f,D.e.Warn("n > m therefore m and n swapped")}const J=new Zf;return J.build(V,h),q(f,{custom:hf.BuildGeodesicData(J),size:v.size,sizeX:v.sizeX,sizeY:v.sizeY,sizeZ:v.sizeZ,faceUV:v.faceUV,faceColors:v.faceColors,flat:v.flat,updatable:v.updatable,sideOrientation:v.sideOrientation,frontUVs:v.frontUVs,backUVs:v.backUVs},Z)},CreateGoldberg:function(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=v.size,C=v.sizeX||J||1,H=v.sizeY||J||1,O=v.sizeZ||J||1;let u=v.m||1;u!==Math.floor(u)&&(u=Math.floor(u),D.e.Warn("m not an integer only floor(m) used"));let a=v.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),D.e.Warn("n not an integer only floor(n) used")),a>u){const f=a;a=u,u=f,D.e.Warn("n > m therefore m and n swapped")}const b=new Zf;b.build(u,a);const X=hf.BuildGeodesicData(b),F=X.toGoldbergPolyhedronData(),U=new Jf(f,Z);v.sideOrientation=h.d._GetDefaultSideOrientation(v.sideOrientation),U._originalBuilderSideOrientation=v.sideOrientation;(function(f,v){const Z=f.size,h=f.sizeX||Z||1,J=f.sizeY||Z||1,C=f.sizeZ||Z||1,H=0===f.sideOrientation?0:f.sideOrientation||l.b.DEFAULTSIDE,O=[],u=[],W=[],a=[];let b=1/0,X=-1/0,F=1/0,U=-1/0;for(let V=0;V<v.vertex.length;V++)b=Math.min(b,v.vertex[V][0]*h),X=Math.max(X,v.vertex[V][0]*h),F=Math.min(F,v.vertex[V][1]*J),U=Math.max(U,v.vertex[V][1]*J);let K=0;for(let l=0;l<v.face.length;l++){const f=v.face[l],Z=V.Xv.Av(v.vertex[f[0]]),H=V.Xv.Av(v.vertex[f[2]]),M=V.Xv.Av(v.vertex[f[1]]),A=H.Fv(Z),s=M.Fv(Z),z=V.Xv.Cross(s,A).normalize();for(let V=0;V<f.length;V++){W.push(z.x,z.y,z.z);const Z=v.vertex[f[V]];O.push(Z[0]*h,Z[1]*J,Z[2]*C);const l=(Z[1]*J-F)/(U-F);a.push((Z[0]*h-b)/(X-b),e.b?1-l:l)}for(let v=0;v<f.length-2;v++)u.push(K,K+v+2,K+v+1);K+=f.length}l.b._ComputeSides(H,O,u,W,a);const M=new l.b;return M.Nf=O,M.indices=u,M.if=W,M.Tf=a,M})(v,F).Pf(U,v.updatable),U.goldbergData.nbSharedFaces=X.sharedNodes,U.goldbergData.nbUnsharedFaces=X.poleNodes,U.goldbergData.adjacentFaces=X.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let h=0;h<X.vertex.length;h++)U.goldbergData.faceCenters.push(V.Xv.Av(X.vertex[h])),U.goldbergData.faceCenters[h].x*=C,U.goldbergData.faceCenters[h].y*=H,U.goldbergData.faceCenters[h].z*=O,U.goldbergData.faceColors.push(new W.he(1,1,1,1));for(let h=0;h<F.face.length;h++){const f=F.face[h],v=V.Xv.Av(F.vertex[f[0]]),Z=V.Xv.Av(F.vertex[f[2]]),J=V.Xv.Av(F.vertex[f[1]]),l=Z.Fv(v),e=J.Fv(v),C=V.Xv.Cross(e,l).normalize(),H=V.Xv.Cross(e,C).normalize();U.goldbergData.faceXaxis.push(e.normalize()),U.goldbergData.faceYaxis.push(C),U.goldbergData.faceZaxis.push(H)}return U},CreateDecal:R,CreateCapsule:S,CreateText:lf.d}},12718:(f,v,Z)=>{"use strict";Z.d(v,{e:()=>Cv});var V=Z(11421),h=Z(11786);class J extends h.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var l=Z(11472),e=(Z(11582),Z(11372));class C{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(f){this._targetStopDuration!==f&&(this._targetStopDuration=f)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(f){this._noiseTexture!==f&&(this._noiseTexture=f,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(f){this._animationSheetEnabled!==f&&(this._animationSheetEnabled=f)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(f){this._isAnimationSheetEnabled!=f&&(this._isAnimationSheetEnabled=f,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(f){this._useLogarithmicDepth=f&&this.Yf().getEngine().getCaps().fragmentDepthSupported}Yf(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(f){switch(f){case C.BLENDMODE_MULTIPLYADD:return;case C.BLENDMODE_ADD:f=1;break;case C.BLENDMODE_ONEONE:f=6;break;case C.BLENDMODE_STANDARD:f=2;break;case C.BLENDMODE_MULTIPLY:f=4;break;case C.BLENDMODE_SUBTRACT:f=3}this._engine.setAlphaMode(f)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:V.Xv.Zero()}set direction1(f){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=f)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:V.Xv.Zero()}set direction2(f){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=f)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:V.Xv.Zero()}set minEmitBox(f){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=f)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:V.Xv.Zero()}set maxEmitBox(f){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=f)}get billboardMode(){return this._billboardMode}set billboardMode(f){this._billboardMode!==f&&(this._billboardMode=f,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(f){this._isBillboardBased!==f&&(this._isBillboardBased=f,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(f){this._attachImageProcessingConfiguration(f)}_attachImageProcessingConfiguration(f){f!==this._imageProcessingConfiguration&&(!f&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=f)}_reset(){}_removeGradientAndTexture(f,v,Z){if(!v)return this;let V=0;for(const h of v){if(h.gradient===f){v.splice(V,1);break}V++}return Z&&Z.dispose(),this}constructor(f){this.animations=[],this.renderingGroupId=0,this.hv=V.Xv.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new V.Xv(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new V.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.MH=new V.Xv(0,0,0),this._useLogarithmicDepth=!1,this.gravity=V.Xv.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new l.he(1,1,1,1),this.color2=new l.he(1,1,1,1),this.colorDead=new l.he(0,0,0,1),this.textureMask=new l.he(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new J,this.id=f,this.name=f}createPointEmitter(f,v){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new V.Xv(0,1,0),arguments.length>2&&void 0!==arguments[2]||new V.Xv(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new V.Xv(0,1,0),arguments.length>4&&void 0!==arguments[4]||new V.Xv(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new V.Xv(0,1,0),arguments.length>3&&void 0!==arguments[3]||new V.Xv(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(f,v,Z,V){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,C.BLENDMODE_SUBTRACT=-1,(0,e.h)("BABYLON.BaseParticleSystem",C);var H=Z(11440),O=Z(11251);class u{constructor(){this.direction1=new V.Xv(0,1,0),this.direction2=new V.Xv(0,1,0),this.minEmitBox=new V.Xv(-.5,-.5,-.5),this.maxEmitBox=new V.Xv(.5,.5,.5)}startDirectionFunction(f,v,Z,h){const J=(0,H.RandomRange)(this.direction1.x,this.direction2.x),l=(0,H.RandomRange)(this.direction1.y,this.direction2.y),e=(0,H.RandomRange)(this.direction1.z,this.direction2.z);if(h)return v.x=J,v.y=l,void(v.z=e);V.Xv.TransformNormalFromFloatsToRef(J,l,e,f,v)}startPositionFunction(f,v,Z,h){const J=(0,H.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),l=(0,H.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),e=(0,H.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(h)return v.x=J,v.y=l,void(v.z=e);V.Xv.TransformCoordinatesFromFloatsToRef(J,l,e,f,v)}clone(){const f=new u;return O.c.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2),f.setVector3("minEmitBox",this.minEmitBox),f.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3),f.addUniform("minEmitBox",3),f.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.direction1=this.direction1.Ph(),f.direction2=this.direction2.Ph(),f.minEmitBox=this.minEmitBox.Ph(),f.maxEmitBox=this.maxEmitBox.Ph(),f}parse(f){V.Xv.FromArrayToRef(f.direction1,0,this.direction1),V.Xv.FromArrayToRef(f.direction2,0,this.direction2),V.Xv.FromArrayToRef(f.minEmitBox,0,this.minEmitBox),V.Xv.FromArrayToRef(f.maxEmitBox,0,this.maxEmitBox)}}class W{get radius(){return this._radius}set radius(f){this._radius=f,this._buildHeight()}get angle(){return this._angle}set angle(f){this._angle=f,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Z,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=v,this.radius=f}startDirectionFunction(f,v,Z,h){h?V.TmpVectors.Xv[0].h(Z.De).normalize():Z.position.subtractToRef(f.getTranslation(),V.TmpVectors.Xv[0]).normalize();const J=(0,H.RandomRange)(0,this.directionRandomizer),l=(0,H.RandomRange)(0,this.directionRandomizer),e=(0,H.RandomRange)(0,this.directionRandomizer);v.x=V.TmpVectors.Xv[0].x+J,v.y=V.TmpVectors.Xv[0].y+l,v.z=V.TmpVectors.Xv[0].z+e,v.normalize()}startPositionFunction(f,v,Z,h){const J=(0,H.RandomRange)(0,2*Math.PI);let l;this.emitFromSpawnPointOnly?l=1e-4:(l=(0,H.RandomRange)(0,this.heightRange),l=1-l*l);let e=this._radius-(0,H.RandomRange)(0,this._radius*this.radiusRange);e*=l;const C=e*Math.sin(J),O=e*Math.cos(J),u=l*this._height;if(h)return v.x=C,v.y=u,void(v.z=O);V.Xv.TransformCoordinatesFromFloatsToRef(C,u,O,f,v)}clone(){const f=new W(this._radius,this._angle,this.directionRandomizer);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat2("radius",this._radius,this.radiusRange),f.setFloat("coneAngle",this._angle),f.setFloat2("height",this._height,this.heightRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",2),f.addUniform("coneAngle",1),f.addUniform("height",2),f.addUniform("directionRandomizer",1)}getEffectDefines(){let f="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(f+="\n#define CONEEMITTERSPAWNPOINT"),f}getClassName(){return"ConeParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this._radius,f.angle=this._angle,f.directionRandomizer=this.directionRandomizer,f.radiusRange=this.radiusRange,f.heightRange=this.heightRange,f.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,f}parse(f){this.radius=f.radius,this.angle=f.angle,this.directionRandomizer=f.directionRandomizer,this.radiusRange=void 0!==f.radiusRange?f.radiusRange:1,this.heightRange=void 0!==f.radiusRange?f.heightRange:1,this.emitFromSpawnPointOnly=void 0!==f.emitFromSpawnPointOnly&&f.emitFromSpawnPointOnly}}class a extends W{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0);super(f,v),this.direction1=Z,this.direction2=h}startDirectionFunction(f,v){const Z=(0,H.RandomRange)(this.direction1.x,this.direction2.x),h=(0,H.RandomRange)(this.direction1.y,this.direction2.y),J=(0,H.RandomRange)(this.direction1.z,this.direction2.z);V.Xv.TransformNormalFromFloatsToRef(Z,h,J,f,v)}clone(){const f=new a(this.radius,this.angle,this.direction1,this.direction2);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.Ph(),f.direction2=this.direction2.Ph(),f}parse(f){super.parse(f),this.direction1.h(f.direction1),this.direction2.h(f.direction2)}}class b{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=f,this.height=v,this.radiusRange=Z,this.directionRandomizer=h,this._tempVector=V.Xv.Zero()}startDirectionFunction(f,v,Z,h,J){Z.position.subtractToRef(f.getTranslation(),this._tempVector),this._tempVector.normalize(),V.Xv.TransformNormalToRef(this._tempVector,J,this._tempVector);const l=(0,H.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let e=Math.atan2(this._tempVector.x,this._tempVector.z);e+=(0,H.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=l,this._tempVector.x=Math.sin(e),this._tempVector.z=Math.cos(e),this._tempVector.normalize(),h?v.h(this._tempVector):V.Xv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,f,v)}startPositionFunction(f,v,Z,h){const J=(0,H.RandomRange)(-this.height/2,this.height/2),l=(0,H.RandomRange)(0,2*Math.PI),e=(0,H.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(e)*this.radius,O=C*Math.cos(l),u=C*Math.sin(l);h?v.fe(O,J,u):V.Xv.TransformCoordinatesFromFloatsToRef(O,J,u,f,v)}clone(){const f=new b(this.radius,this.directionRandomizer);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("height",this.height),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("height",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this.radius,f.height=this.height,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.radius=f.radius,this.height=f.height,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class X extends b{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0),J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Xv(0,1,0);super(f,v,Z),this.direction1=h,this.direction2=J}startDirectionFunction(f,v,Z,h){const J=(0,H.RandomRange)(this.direction1.x,this.direction2.x),l=(0,H.RandomRange)(this.direction1.y,this.direction2.y),e=(0,H.RandomRange)(this.direction1.z,this.direction2.z);h?v.fe(J,l,e):V.Xv.TransformNormalFromFloatsToRef(J,l,e,f,v)}clone(){const f=new X(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("height",this.height),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("height",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.Ph(),f.direction2=this.direction2.Ph(),f}parse(f){super.parse(f),V.Xv.FromArrayToRef(f.direction1,0,this.direction1),V.Xv.FromArrayToRef(f.direction2,0,this.direction2)}}class F{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=f,this.radiusRange=v,this.directionRandomizer=Z}startDirectionFunction(f,v,Z,h){const J=Z.position.Fv(f.getTranslation()).normalize(),l=(0,H.RandomRange)(0,this.directionRandomizer),e=(0,H.RandomRange)(0,this.directionRandomizer),C=(0,H.RandomRange)(0,this.directionRandomizer);J.x+=l,J.y+=e,J.z+=C,J.normalize(),h?v.h(J):V.Xv.TransformNormalFromFloatsToRef(J.x,J.y,J.z,f,v)}startPositionFunction(f,v,Z,h){const J=this.radius-(0,H.RandomRange)(0,this.radius*this.radiusRange),l=(0,H.RandomRange)(0,1),e=(0,H.RandomRange)(0,2*Math.PI),C=Math.acos(2*l-1),O=J*Math.cos(e)*Math.sin(C),u=J*Math.cos(C),W=J*Math.sin(e)*Math.sin(C);h?v.fe(O,Math.abs(u),W):V.Xv.TransformCoordinatesFromFloatsToRef(O,Math.abs(u),W,f,v)}clone(){const f=new F(this.radius,this.directionRandomizer);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this.radius,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.radius=f.radius,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class U{constructor(){this.direction1=new V.Xv(0,1,0),this.direction2=new V.Xv(0,1,0)}startDirectionFunction(f,v,Z,h){const J=(0,H.RandomRange)(this.direction1.x,this.direction2.x),l=(0,H.RandomRange)(this.direction1.y,this.direction2.y),e=(0,H.RandomRange)(this.direction1.z,this.direction2.z);h?v.fe(J,l,e):V.Xv.TransformNormalFromFloatsToRef(J,l,e,f,v)}startPositionFunction(f,v,Z,h){h?v.fe(0,0,0):V.Xv.TransformCoordinatesFromFloatsToRef(0,0,0,f,v)}clone(){const f=new U;return O.c.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.direction1=this.direction1.Ph(),f.direction2=this.direction2.Ph(),f}parse(f){V.Xv.FromArrayToRef(f.direction1,0,this.direction1),V.Xv.FromArrayToRef(f.direction2,0,this.direction2)}}class K{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=f,this.radiusRange=v,this.directionRandomizer=Z}startDirectionFunction(f,v,Z,h){const J=Z.position.Fv(f.getTranslation()).normalize(),l=(0,H.RandomRange)(0,this.directionRandomizer),e=(0,H.RandomRange)(0,this.directionRandomizer),C=(0,H.RandomRange)(0,this.directionRandomizer);J.x+=l,J.y+=e,J.z+=C,J.normalize(),h?v.h(J):V.Xv.TransformNormalFromFloatsToRef(J.x,J.y,J.z,f,v)}startPositionFunction(f,v,Z,h){const J=this.radius-(0,H.RandomRange)(0,this.radius*this.radiusRange),l=(0,H.RandomRange)(0,1),e=(0,H.RandomRange)(0,2*Math.PI),C=Math.acos(2*l-1),O=J*Math.cos(e)*Math.sin(C),u=J*Math.cos(C),W=J*Math.sin(e)*Math.sin(C);h?v.fe(O,u,W):V.Xv.TransformCoordinatesFromFloatsToRef(O,u,W,f,v)}clone(){const f=new K(this.radius,this.directionRandomizer);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this.radius,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.radius=f.radius,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class M extends K{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Xv(0,1,0),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0);super(f),this.direction1=v,this.direction2=Z}startDirectionFunction(f,v){const Z=(0,H.RandomRange)(this.direction1.x,this.direction2.x),h=(0,H.RandomRange)(this.direction1.y,this.direction2.y),J=(0,H.RandomRange)(this.direction1.z,this.direction2.z);V.Xv.TransformNormalFromFloatsToRef(Z,h,J,f,v)}clone(){const f=new M(this.radius,this.direction1,this.direction2);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.Ph(),f.direction2=this.direction2.Ph(),f}parse(f){super.parse(f),this.direction1.h(f.direction1),this.direction2.h(f.direction2)}}class A{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(f,v,Z,h){const J=V.TmpVectors.Xv[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Z,J);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Z,J);const f=V.TmpVectors.Xv[1];J.subtractToRef(Z.position,f),f.scaleToRef(1/Z.lifeTime,J)}else J.set(0,0,0);h?v.h(J):V.Xv.TransformNormalToRef(J,f,v)}startPositionFunction(f,v,Z,h){const J=V.TmpVectors.Xv[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Z,J):J.set(0,0,0),h?v.h(J):V.Xv.TransformCoordinatesToRef(J,f,v)}clone(){const f=new A;return O.c.DeepCopy(this,f),f}applyToShader(f){}buildUniformLayout(f){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.particlePositionGenerator=this.particlePositionGenerator,f.particleDestinationGenerator=this.particleDestinationGenerator,f}parse(f){f.particlePositionGenerator&&(this.particlePositionGenerator=f.particlePositionGenerator),f.particleDestinationGenerator&&(this.particleDestinationGenerator=f.particleDestinationGenerator)}}var s=Z(11494);class z{get mesh(){return this._mesh}set mesh(f){this._mesh!==f&&(this._mesh=f,f?(this._indices=f.dh(),this._positions=f.getVerticesData(s.g.PositionKind),this._normals=f.getVerticesData(s.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=V.Xv.Zero(),this._mesh=null,this.direction1=new V.Xv(0,1,0),this.direction2=new V.Xv(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=f}startDirectionFunction(f,v,Z,h){if(this.useMeshNormalsForDirection&&this._normals)return void V.Xv.TransformNormalToRef(this._storedNormal,f,v);const J=(0,H.RandomRange)(this.direction1.x,this.direction2.x),l=(0,H.RandomRange)(this.direction1.y,this.direction2.y),e=(0,H.RandomRange)(this.direction1.z,this.direction2.z);h?v.fe(J,l,e):V.Xv.TransformNormalFromFloatsToRef(J,l,e,f,v)}startPositionFunction(f,v,Z,h){if(!this._indices||!this._positions)return;const J=3*(Math.random()*(this._indices.length/3)|0),l=Math.random(),e=Math.random()*(1-l),C=1-l-e,H=this._indices[J],O=this._indices[J+1],u=this._indices[J+2],W=V.TmpVectors.Xv[0],a=V.TmpVectors.Xv[1],b=V.TmpVectors.Xv[2],X=V.TmpVectors.Xv[3];V.Xv.FromArrayToRef(this._positions,3*H,W),V.Xv.FromArrayToRef(this._positions,3*O,a),V.Xv.FromArrayToRef(this._positions,3*u,b),X.x=l*W.x+e*a.x+C*b.x,X.y=l*W.y+e*a.y+C*b.y,X.z=l*W.z+e*a.z+C*b.z,h?v.fe(X.x,X.y,X.z):V.Xv.TransformCoordinatesFromFloatsToRef(X.x,X.y,X.z,f,v),this.useMeshNormalsForDirection&&this._normals&&(V.Xv.FromArrayToRef(this._normals,3*H,W),V.Xv.FromArrayToRef(this._normals,3*O,a),V.Xv.FromArrayToRef(this._normals,3*u,b),this._storedNormal.x=l*W.x+e*a.x+C*b.x,this._storedNormal.y=l*W.y+e*a.y+C*b.y,this._storedNormal.z=l*W.z+e*a.z+C*b.z)}clone(){const f=new z(this.mesh);return O.c.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var f;const v={};return v.type=this.getClassName(),v.direction1=this.direction1.Ph(),v.direction2=this.direction2.Ph(),v.meshId=null===(f=this.mesh)||void 0===f?void 0:f.id,v.useMeshNormalsForDirection=this.useMeshNormalsForDirection,v}parse(f,v){V.Xv.FromArrayToRef(f.direction1,0,this.direction1),V.Xv.FromArrayToRef(f.direction2,0,this.direction2),f.meshId&&v&&(this.mesh=v.getLastMeshById(f.meshId)),this.useMeshNormalsForDirection=f.useMeshNormalsForDirection}}class Y{_isUbo(f){return void 0!==f.addUniform}constructor(f){this._isUbo(f)?(this.setMatrix3x3=f.updateMatrix3x3.bind(f),this.setMatrix2x2=f.updateMatrix2x2.bind(f),this.setFloat=f.updateFloat.bind(f),this.setFloat2=f.updateFloat2.bind(f),this.setFloat3=f.updateFloat3.bind(f),this.setFloat4=f.updateFloat4.bind(f),this.setFloatArray=f.updateFloatArray.bind(f),this.setArray=f.updateArray.bind(f),this.setIntArray=f.updateIntArray.bind(f),this.setMatrix=f.Eh.bind(f),this.setMatrices=f.updateMatrices.bind(f),this.setVector3=f.updateVector3.bind(f),this.setVector4=f.updateVector4.bind(f),this.setColor3=f.updateColor3.bind(f),this.setColor4=f.updateColor4.bind(f),this.setDirectColor4=f.updateDirectColor4.bind(f),this.setInt=f.updateInt.bind(f),this.setInt2=f.updateInt2.bind(f),this.setInt3=f.updateInt3.bind(f),this.setInt4=f.updateInt4.bind(f)):(this.setMatrix3x3=f.setMatrix3x3.bind(f),this.setMatrix2x2=f.setMatrix2x2.bind(f),this.setFloat=f.setFloat.bind(f),this.setFloat2=f.setFloat2.bind(f),this.setFloat3=f.setFloat3.bind(f),this.setFloat4=f.setFloat4.bind(f),this.setFloatArray=f.setFloatArray.bind(f),this.setArray=f.setArray.bind(f),this.setIntArray=f.setIntArray.bind(f),this.setMatrix=f.setMatrix.bind(f),this.setMatrices=f.setMatrices.bind(f),this.setVector3=f.setVector3.bind(f),this.setVector4=f.setVector4.bind(f),this.setColor3=f.setColor3.bind(f),this.setColor4=f.setColor4.bind(f),this.setDirectColor4=f.setDirectColor4.bind(f),this.setInt=f.setInt.bind(f),this.setInt2=f.setInt2.bind(f),this.setInt3=f.setInt3.bind(f),this.setInt4=f.setInt4.bind(f))}}var y=Z(11333);const N="gpuUpdateParticlesPixelShader",i="#version 300 es\nvoid main() {discard;}\n";y.c.ShadersStore[N]||(y.c.ShadersStore[N]=i);const I="gpuUpdateParticlesVertexShader",T="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";y.c.ShadersStore[I]||(y.c.ShadersStore[I]=T);(0,e.h)("BABYLON.WebGL2ParticleSystem",class{constructor(f,v){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=f,this._engine=v,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var f;return(null===(f=this._updateEffect)||void 0===f?void 0:f.isReady())??!1}createUpdateBuffer(f){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof A&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=f,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Y(this._updateEffect)}createVertexBuffers(f,v){this._updateVAO.push(this._createUpdateVAO(f)),this._renderVAO.push(this._engine.recordVertexArrayObject(v,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=v}createParticleBuffer(f){return f}bindDrawBuffers(f,v,Z){Z?this._engine.bindBuffers(this._renderVertexBuffers,Z,v):this._engine.bindVertexArrayObject(this._renderVAO[f],null)}preUpdateParticleBuffer(){const f=this._engine;if(this._engine.enableEffect(this._updateEffect),!f.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(f,v,Z){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[f],null);const V=this._engine;V.bindTransformFeedbackBuffer(v.getBuffer()),V.setRasterizerState(!1),V.beginTransformFeedback(!0),V.drawArraysType(3,0,Z),V.endTransformFeedback(),V.setRasterizerState(!0),V.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let f=0;f<this._updateVAO.length;f++)this._engine.releaseVertexArrayObject(this._updateVAO[f]);this._updateVAO.length=0;for(let f=0;f<this._renderVAO.length;f++)this._engine.releaseVertexArrayObject(this._renderVAO[f]);this._renderVAO.length=0}_createUpdateVAO(f){const v={};v.position=f.createVertexBuffer("position",0,3);let Z=3;v.age=f.createVertexBuffer("age",Z,1),Z+=1,v.size=f.createVertexBuffer("size",Z,3),Z+=3,v.life=f.createVertexBuffer("life",Z,1),Z+=1,v.seed=f.createVertexBuffer("seed",Z,4),Z+=4,v.direction=f.createVertexBuffer("direction",Z,3),Z+=3,this._parent.particleEmitterType instanceof A&&(v.initialPosition=f.createVertexBuffer("initialPosition",Z,3),Z+=3),this._parent._colorGradientsTexture||(v.color=f.createVertexBuffer("color",Z,4),Z+=4),this._parent._isBillboardBased||(v.initialDirection=f.createVertexBuffer("initialDirection",Z,3),Z+=3),this._parent.noiseTexture&&(v.noiseCoordinates1=f.createVertexBuffer("noiseCoordinates1",Z,3),Z+=3,v.noiseCoordinates2=f.createVertexBuffer("noiseCoordinates2",Z,3),Z+=3),this._parent._angularSpeedGradientsTexture?(v.angle=f.createVertexBuffer("angle",Z,1),Z+=1):(v.angle=f.createVertexBuffer("angle",Z,2),Z+=2),this._parent._isAnimationSheetEnabled&&(v.cellIndex=f.createVertexBuffer("cellIndex",Z,1),Z+=1,this._parent.spriteRandomStartCell&&(v.cellStartOffset=f.createVertexBuffer("cellStartOffset",Z,1),Z+=1));const V=this._engine.recordVertexArrayObject(v,null,this._updateEffect);return this._engine.bindArrayBuffer(null),V}});class B{constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,V=arguments.length>3?arguments[3]:void 0;this._engine=f,this._label=V,this._engine._storageBuffers.push(this),this._create(v,Z)}_create(f,v){this._bufferSize=f,this._creationFlags=v,this._buffer=this._engine.createStorageBuffer(f,v,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(f,v,Z){this._buffer&&this._engine.updateStorageBuffer(this._buffer,f,v,Z)}async read(f,v,Z,V){return await this._engine.readFromStorageBuffer(this._buffer,f,v,Z,V)}dispose(){const f=this._engine._storageBuffers,v=f.indexOf(this);-1!==v&&(f[v]=f[f.length-1],f.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=Z(11405),g=Z(11410),w=Z(11462),t=Z(11401),L=Z(11707),E=Z(11247),j=Z(11362),q=Z(11614);class c{constructor(){this._gpuTimeInFrameId=-1,this.counter=new q.d}_addDuration(f,v){f<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==f?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(v,!1),this._gpuTimeInFrameId=f):this.counter.addCount(v,!1))}}var m=Z(11316);class p{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=f,this._engine=v,this.uniqueId=L.b.UniqueId,v.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new c),this._engine.getCaps().supportComputeShaders?V.bindingsMapping?(this._context=v.createComputeContext(),this._shaderPath=Z,this._options={bindingsMapping:{},defines:[],...V}):E.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):E.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(f,v){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const V=this._bindings[f];this._bindings[f]={type:Z?0:4,object:v,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!V||V.object!==v||V.type!==this._bindings[f].type)}setStorageTexture(f,v){const Z=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==v),this._bindings[f]={type:1,object:v,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setExternalTexture(f,v){const Z=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==v),this._bindings[f]={type:6,object:v,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setVideoTexture(f,v){return!!v.externalTexture&&(this.setExternalTexture(f,v.externalTexture),!0)}setUniformBuffer(f,v){const Z=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==v),this._bindings[f]={type:p._BufferIsDataBuffer(v)?7:2,object:v,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setStorageBuffer(f,v){const Z=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==v),this._bindings[f]={type:p._BufferIsDataBuffer(v)?7:3,object:v,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setTextureSampler(f,v){const Z=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!Z||!v.compareSampler(Z.object)),this._bindings[f]={type:5,object:v,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}isReady(){let f=this._effect;for(const h in this._bindings){const f=this._bindings[h],v=f.type,Z=f.object;switch(v){case 0:case 4:case 1:if(!Z.isReady())return!1;break;case 6:if(!Z.isReady())return!1;break}}const v=[],Z=this._shaderPath;if(this._options.defines)for(let h=0;h<this._options.defines.length;h++)v.push(this._options.defines[h]);const V=v.join("\n");return this._cachedDefines!==V&&(this._cachedDefines=V,f=this._engine.createComputeEffect(Z,{defines:V,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=f),!!f.isReady()}dispatch(f,v,Z){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,f,v,Z,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Z=p._BufferIsDataBuffer(f)?f:f.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Z,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const v in this._bindings){const Z=this._bindings[v];if(!this._options.bindingsMapping[v])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+v+"'");switch(Z.type){case 0:{const V=this._samplers[v],h=Z.object;var f;if(!V||!h._texture||!V.compareSampler(h._texture))this._samplers[v]=(new j.d).setParameters(h.wrapU,h.wrapV,h.wrapR,h.anisotropicFilteringLevel,h._texture.samplingMode,null===(f=h._texture)||void 0===f?void 0:f._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const f=Z.object;f.getBuffer()!==Z.buffer&&(Z.buffer=f.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((h=>{(0,m.f)((()=>this.dispatch(f,v,Z)),h,void 0,V)}))}serialize(){const f=w.b.Serialize(this);f.options=this._options,f.shaderPath=this._shaderPath,f.eW={},f.textures={};for(const v in this._bindings){const Z=this._bindings[v],V=Z.object;switch(Z.type){case 0:case 4:case 1:{const h=V.serialize();h&&(f.textures[v]=h,f.eW[v]={type:Z.type});break}}}return f}static Parse(f,v,Z){const V=w.b.Parse((()=>new p(f.name,v.getEngine(),f.shaderPath,f.options)),f,v,Z);for(const h in f.textures){const J=f.eW[h],l=t.e.Parse(f.textures[h],v,Z);0===J.type?V.setTexture(h,l):4===J.type?V.setTexture(h,l,!1):V.setStorageTexture(h,l)}return V}static _BufferIsDataBuffer(f){return void 0!==f.underlyingResource}}(0,P.d)([(0,g.F)()],p.prototype,"name",void 0),(0,P.d)([(0,g.F)()],p.prototype,"fastMode",void 0),(0,e.h)("BABYLON.ComputeShader",p);var k=Z(11673);const r="gpuUpdateParticlesComputeShader",o="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";y.c.ShadersStoreWGSL[r]||(y.c.ShadersStoreWGSL[r]=o);(0,e.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(f,v){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=f,this._engine=v}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var f;return(null===(f=this._updateComputeShader)||void 0===f?void 0:f.isReady())??!1}createUpdateBuffer(f){var v;const Z={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Z.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Z.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Z.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Z.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Z.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Z.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Z.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new p("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Z,defines:f.split("\n")}),null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=new k.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Y(this._simParamsComputeShader)}createVertexBuffers(f,v){this._renderVertexBuffers.push(v)}createParticleBuffer(f){const v=new B(this._engine,4*f.length,11,"ComputeShaderParticleSystemBuffer");return v.update(f),this._bufferComputeShader.push(v),v.getBuffer()}bindDrawBuffers(f,v,Z){this._engine.bindBuffers(this._renderVertexBuffers[f],Z,v)}preUpdateParticleBuffer(){}updateParticleBuffer(f,v,Z){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[f]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^f]),this._updateComputeShader.dispatch(Math.ceil(Z/64))}releaseBuffers(){var f;for(let v=0;v<this._bufferComputeShader.length;++v)this._bufferComputeShader[v].dispose();this._bufferComputeShader.length=0,null===(f=this._simParamsComputeShader)||void 0===f||f.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class G{constructor(f,v,Z){this.gradient=f,this.color1=v,this.color2=Z}getColorToRef(f){this.color2?l.he.LerpToRef(this.color1,this.color2,Math.random(),f):f.h(this.color1)}}class Q{constructor(f,v){this.gradient=f,this.color=v}}class d{constructor(f,v,Z){this.gradient=f,this.factor1=v,this.factor2=Z}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class x{static GetCurrentGradient(f,v,Z){if(v[0].gradient>f)return void Z(v[0],v[0],1);for(let h=0;h<v.length-1;h++){const V=v[h],J=v[h+1];if(f>=V.gradient&&f<=J.gradient){return void Z(V,J,(f-V.gradient)/(J.gradient-V.gradient))}}const V=v.length-1;Z(v[V],v[V],1)}}var R=Z(11235),n=Z(11885),S=Z(11281);class D{constructor(f){this.particleSystem=f,this.position=V.Xv.Zero(),this.direction=V.Xv.Zero(),this.color=new l.he(0,0,0,0),this.colorStep=new l.he(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new V.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new l.he(0,0,0,0),this._currentColor2=new l.he(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=D._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let f=this.age,v=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===v?(v=1,f=this._randomCellOffset):f+=this._randomCellOffset);const Z=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let V;V=this._initialSpriteCellLoop?(0,H.Clamp)(f*v%this.lifeTime/this.lifeTime):(0,H.Clamp)(f*v/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+V*Z|0}_inheritParticleInfoToSubEmitter(f){if(f.particleSystem.hv.position){const v=f.particleSystem.hv;if(v.position.h(this.position),f.inheritDirection){const f=V.TmpVectors.Xv[0];this.direction.normalizeToRef(f),v.setDirection(f,0,Math.PI/2)}}else{f.particleSystem.hv.h(this.position)}this.direction.scaleToRef(f.inheritedVelocityAmount/2,V.TmpVectors.Xv[0]),f.particleSystem._inheritedVelocityOffset.h(V.TmpVectors.Xv[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const f of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(f)}_reset(){this.age=0,this.id=D._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(f){f.position.h(this.position),this._initialDirection?f._initialDirection?f._initialDirection.h(this._initialDirection):f._initialDirection=this._initialDirection.clone():f._initialDirection=null,f.direction.h(this.direction),this.De&&(f.De?f.De.h(this.De):f.De=this.De.clone()),f.color.h(this.color),f.colorStep.h(this.colorStep),f.lifeTime=this.lifeTime,f.age=this.age,f._randomCellOffset=this._randomCellOffset,f.size=this.size,f.scale.h(this.scale),f.angle=this.angle,f.angularSpeed=this.angularSpeed,f.particleSystem=this.particleSystem,f.cellIndex=this.cellIndex,f.id=this.id,f._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(f._currentColorGradient=this._currentColorGradient,f._currentColor1.h(this._currentColor1),f._currentColor2.h(this._currentColor2)),this._currentSizeGradient&&(f._currentSizeGradient=this._currentSizeGradient,f._currentSize1=this._currentSize1,f._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(f._currentAngularSpeedGradient=this._currentAngularSpeedGradient,f._currentAngularSpeed1=this._currentAngularSpeed1,f._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(f._currentVelocityGradient=this._currentVelocityGradient,f._currentVelocity1=this._currentVelocity1,f._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(f._currentLimitVelocityGradient=this._currentLimitVelocityGradient,f._currentLimitVelocity1=this._currentLimitVelocity1,f._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(f._currentDragGradient=this._currentDragGradient,f._currentDrag1=this._currentDrag1,f._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(f._initialStartSpriteCellId=this._initialStartSpriteCellId,f._initialEndSpriteCellId=this._initialEndSpriteCellId,f._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(f.remapData&&this.remapData?f.remapData.h(this.remapData):f.remapData=new V.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(f._randomNoiseCoordinates1?(f._randomNoiseCoordinates1.h(this._randomNoiseCoordinates1),f._randomNoiseCoordinates2.h(this._randomNoiseCoordinates2)):(f._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),f._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}D._Count=0;var ff=Z(11534),vf=(Z(11577),Z(11768)),Zf=Z(11760),Vf=Z(11664);function hf(f,v){const Z=(0,H.RandomRange)(0,1);l.he.LerpToRef(v.color1,v.color2,Z,f.color),v.colorDead.subtractToRef(f.color,v._colorDiff),v._colorDiff.scaleToRef(1/f.lifeTime,f.colorStep)}function Jf(f,v){f._currentColorGradient=v._colorGradients[0],f._currentColorGradient.getColorToRef(f.color),f._currentColor1.h(f.color),v._colorGradients.length>1?v._colorGradients[1].getColorToRef(f._currentColor2):f._currentColor2.h(f.color)}function lf(f,v){const Z=v._colorGradients;x.GetCurrentGradient(v._ratio,Z,((v,Z,V)=>{v!==f._currentColorGradient&&(f._currentColor1.h(f._currentColor2),Z.getColorToRef(f._currentColor2),f._currentColorGradient=v),l.he.LerpToRef(f._currentColor1,f._currentColor2,V,f.color)}))}function ef(f,v){f.colorStep.scaleToRef(v._scaledUpdateSpeed,v._scaledColorStep),f.color.addInPlace(v._scaledColorStep),f.color.a<0&&(f.color.a=0)}function Cf(f,v){x.GetCurrentGradient(v._ratio,v._angularSpeedGradients,((v,Z,V)=>{v!==f._currentAngularSpeedGradient&&(f._currentAngularSpeed1=f._currentAngularSpeed2,f._currentAngularSpeed2=Z.getFactor(),f._currentAngularSpeedGradient=v),f.angularSpeed=(0,H.Lerp)(f._currentAngularSpeed1,f._currentAngularSpeed2,V)}))}function Hf(f,v){f.angle+=f.angularSpeed*v._scaledUpdateSpeed}function Of(f,v){v.particleEmitterType.startDirectionFunction(v._emitterWorldMatrix,f.direction,f,v.isLocal,v._emitterInverseWorldMatrix)}function uf(f,v){v.startDirectionFunction(v._emitterWorldMatrix,f.direction,f,v.isLocal)}function Wf(f,v){f._currentVelocityGradient=v._velocityGradients[0],f._currentVelocity1=f._currentVelocityGradient.getFactor(),v._velocityGradients.length>1?f._currentVelocity2=v._velocityGradients[1].getFactor():f._currentVelocity2=f._currentVelocity1}function af(f,v){f._currentLimitVelocityGradient=v._limitVelocityGradients[0],f._currentLimitVelocity1=f._currentLimitVelocityGradient.getFactor(),v._limitVelocityGradients.length>1?f._currentLimitVelocity2=v._limitVelocityGradients[1].getFactor():f._currentLimitVelocity2=f._currentLimitVelocity1}function bf(f,v){x.GetCurrentGradient(v._ratio,v._velocityGradients,((Z,V,h)=>{Z!==f._currentVelocityGradient&&(f._currentVelocity1=f._currentVelocity2,f._currentVelocity2=V.getFactor(),f._currentVelocityGradient=Z),v._directionScale*=(0,H.Lerp)(f._currentVelocity1,f._currentVelocity2,h)}))}function Xf(f,v){x.GetCurrentGradient(v._ratio,v._limitVelocityGradients,((Z,V,h)=>{Z!==f._currentLimitVelocityGradient&&(f._currentLimitVelocity1=f._currentLimitVelocity2,f._currentLimitVelocity2=V.getFactor(),f._currentLimitVelocityGradient=Z);const J=(0,H.Lerp)(f._currentLimitVelocity1,f._currentLimitVelocity2,h);f.direction.length()>J&&f.direction.scaleInPlace(v.limitVelocityDamping)}))}function Ff(f,v){f.direction.scaleToRef(v._directionScale,v._scaledDirection)}function Uf(f,v){v.particleEmitterType.startPositionFunction(v._emitterWorldMatrix,f.position,f,v.isLocal)}function Kf(f,v){v.startPositionFunction(v._emitterWorldMatrix,f.position,f,v.isLocal)}function Mf(f,v){f.De?f.De.h(f.position):f.De=f.position.clone(),V.Xv.TransformCoordinatesToRef(f.De,v._emitterWorldMatrix,f.position)}function Af(f,v){v.isLocal&&f.De?(f.De.addInPlace(v._scaledDirection),V.Xv.TransformCoordinatesToRef(f.De,v._emitterWorldMatrix,f.position)):f.position.addInPlace(v._scaledDirection)}function sf(f,v){f._currentDragGradient=v._dragGradients[0],f._currentDrag1=f._currentDragGradient.getFactor(),v._dragGradients.length>1?f._currentDrag2=v._dragGradients[1].getFactor():f._currentDrag2=f._currentDrag1}function zf(f,v){x.GetCurrentGradient(v._ratio,v._dragGradients,((Z,V,h)=>{Z!==f._currentDragGradient&&(f._currentDrag1=f._currentDrag2,f._currentDrag2=V.getFactor(),f._currentDragGradient=Z);const J=(0,H.Lerp)(f._currentDrag1,f._currentDrag2,h);v._scaledDirection.scaleInPlace(1-J)}))}function Yf(f,v){f._randomNoiseCoordinates1?(f._randomNoiseCoordinates1.fe(Math.random(),Math.random(),Math.random()),f._randomNoiseCoordinates2.fe(Math.random(),Math.random(),Math.random())):(f._randomNoiseCoordinates1=new V.Xv(Math.random(),Math.random(),Math.random()),f._randomNoiseCoordinates2=new V.Xv(Math.random(),Math.random(),Math.random()))}function yf(f,v){const Z=v._noiseTextureData,h=v._noiseTextureSize;if(Z&&h&&f._randomNoiseCoordinates1){const J=v._fetchR(f._randomNoiseCoordinates1.x,f._randomNoiseCoordinates1.y,h.width,h.height,Z),l=v._fetchR(f._randomNoiseCoordinates1.z,f._randomNoiseCoordinates2.x,h.width,h.height,Z),e=v._fetchR(f._randomNoiseCoordinates2.y,f._randomNoiseCoordinates2.z,h.width,h.height,Z),C=V.TmpVectors.Xv[0],H=V.TmpVectors.Xv[1];C.fe((2*J-1)*v.noiseStrength.x,(2*l-1)*v.noiseStrength.y,(2*e-1)*v.noiseStrength.z),C.scaleToRef(v._tempScaledUpdateSpeed,H),f.direction.addInPlace(H)}}function Nf(f,v){v.gravity.scaleToRef(v._tempScaledUpdateSpeed,v._scaledGravity),f.direction.addInPlace(v._scaledGravity)}function If(f,v){f.size=(0,H.RandomRange)(v.minSize,v.maxSize),f.scale.fe((0,H.RandomRange)(v.minScaleX,v.maxScaleX),(0,H.RandomRange)(v.minScaleY,v.maxScaleY))}function Tf(f,v){f._currentSizeGradient=v._sizeGradients[0],f._currentSize1=f._currentSizeGradient.getFactor(),f.size=f._currentSize1,v._sizeGradients.length>1?f._currentSize2=v._sizeGradients[1].getFactor():f._currentSize2=f._currentSize1,f.scale.fe((0,H.RandomRange)(v.minScaleX,v.maxScaleX),(0,H.RandomRange)(v.minScaleY,v.maxScaleY))}function Bf(f,v){const Z=v._actualFrame/v.targetStopDuration;x.GetCurrentGradient(Z,v._startSizeGradients,((Z,V,h)=>{Z!==v._currentStartSizeGradient&&(v._currentStartSize1=v._currentStartSize2,v._currentStartSize2=V.getFactor(),v._currentStartSizeGradient=Z);const J=(0,H.Lerp)(v._currentStartSize1,v._currentStartSize2,h);f.scale.scaleInPlace(J)}))}function Pf(f,v){x.GetCurrentGradient(v._ratio,v._sizeGradients,((v,Z,V)=>{v!==f._currentSizeGradient&&(f._currentSize1=f._currentSize2,f._currentSize2=Z.getFactor(),f._currentSizeGradient=v),f.size=(0,H.Lerp)(f._currentSize1,f._currentSize2,V)}))}function gf(f,v){f.remapData=new V.Vector4(0,1,0,1)}function wf(f,v){v._colorRemapGradients&&v._colorRemapGradients.length>0&&x.GetCurrentGradient(v._ratio,v._colorRemapGradients,((v,Z,V)=>{const h=(0,H.Lerp)(v.factor1,Z.factor1,V),J=(0,H.Lerp)(v.factor2,Z.factor2,V);f.remapData.x=h,f.remapData.y=J-h})),v._alphaRemapGradients&&v._alphaRemapGradients.length>0&&x.GetCurrentGradient(v._ratio,v._alphaRemapGradients,((v,Z,V)=>{const h=(0,H.Lerp)(v.factor1,Z.factor1,V),J=(0,H.Lerp)(v.factor2,Z.factor2,V);f.remapData.z=h,f.remapData.w=J-h}))}function tf(f,v){const Z=(0,H.Clamp)(v._actualFrame/v.targetStopDuration);x.GetCurrentGradient(Z,v._lifeTimeGradients,((v,V)=>{const h=v,J=V,l=h.getFactor(),e=J.getFactor(),C=(Z-h.gradient)/(J.gradient-h.gradient);f.lifeTime=(0,H.Lerp)(l,e,C)})),v._emitPower=(0,H.RandomRange)(v.minEmitPower,v.maxEmitPower)}function Lf(f,v){f.lifeTime=(0,H.RandomRange)(v.minLifeTime,v.maxLifeTime),v._emitPower=(0,H.RandomRange)(v.minEmitPower,v.maxEmitPower)}function Ef(f,v){0===v._emitPower?(f._initialDirection?f._initialDirection.h(f.direction):f._initialDirection=f.direction.clone(),f.direction.set(0,0,0)):(f._initialDirection=null,f.direction.scaleInPlace(v._emitPower)),f.direction.addInPlace(v._inheritedVelocityOffset)}function jf(f,v){f.angularSpeed=(0,H.RandomRange)(v.minAngularSpeed,v.maxAngularSpeed),f.angle=(0,H.RandomRange)(v.minInitialRotation,v.maxInitialRotation)}function qf(f,v){f._currentAngularSpeedGradient=v._angularSpeedGradients[0],f.angularSpeed=f._currentAngularSpeedGradient.getFactor(),f._currentAngularSpeed1=f.angularSpeed,v._angularSpeedGradients.length>1?f._currentAngularSpeed2=v._angularSpeedGradients[1].getFactor():f._currentAngularSpeed2=f._currentAngularSpeed1,f.angle=(0,H.RandomRange)(v.minInitialRotation,v.maxInitialRotation)}function cf(f,v){f._initialStartSpriteCellId=v.startSpriteCellID,f._initialEndSpriteCellId=v.endSpriteCellID,f._initialSpriteCellLoop=v.spriteCellLoop}function mf(f,v){f.previousItem=v.previousItem,f.nextItem=v,v.previousItem&&(v.previousItem.nextItem=f),v.previousItem=f}function pf(f,v){f.previousItem=v,f.nextItem=v.nextItem,v.nextItem&&(v.nextItem.previousItem=f),v.nextItem=f}function kf(f,v){let Z=v;for(;Z.nextItem;)Z=Z.nextItem;f.previousItem=Z,f.nextItem=Z.nextItem,Z.nextItem=f}function rf(f){f.previousItem&&(f.previousItem.nextItem=f.nextItem),f.nextItem&&(f.nextItem.previousItem=f.previousItem)}class of extends C{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(f){this._startDirectionFunction!==f&&(this._startDirectionFunction=f,this._directionProcessing.process=f?uf:Of)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(f){this._startPositionFunction!==f&&(this._startPositionFunction=f,this._positionCreation.process=f?Kf:Uf)}set onDispose(f){this._onDisposeObserver&&this.Kh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Kh.add(f)}get C(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(f){this._useRampGradients!==f&&(this._useRampGradients=f,this._resetEffect(),f?(this._rampCreation={process:gf,previousItem:null,nextItem:null},pf(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:wf,previousItem:null,nextItem:null},pf(this._remapGradientProcessing,this._gravityProcessing)):(rf(this._rampCreation),rf(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(f){this._isLocal!==f&&(this._isLocal=f,f?(this._isLocalCreation={process:Mf,previousItem:null,nextItem:null},pf(this._isLocalCreation,this._positionCreation)):rf(this._isLocalCreation))}get particles(){return this.ZW}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(f){this._animationSheetEnabled!==f&&(this._animationSheetEnabled=f,f?(this._sheetCreation={process:cf,previousItem:null,nextItem:null},pf(this._sheetCreation,this._colorCreation)):rf(this._sheetCreation),this._reset())}getActiveCount(){return this.ZW.length}getClassName(){return"se"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var f;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._customWrappers[v])||void 0===f?void 0:f.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[f]??this._customWrappers[0]}setCustomEffect(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new ff.d(this._engine),this._customWrappers[v].effect=f,this._customWrappers[v].drawContext&&(this._customWrappers[v].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(f){if(this.noiseTexture!==f){if(this._noiseTexture=f,!f)return rf(this._noiseCreation),void rf(this._noiseProcessing);this._noiseCreation={process:Yf,previousItem:null,nextItem:null},pf(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:yf,previousItem:null,nextItem:null},pf(this._noiseProcessing,this._positionProcessing)}}constructor(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(f),this._emitterInverseWorldMatrix=V.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new V.Xv,this.Kh=new R.c,this.onStoppedObservable=new R.c,this.onStartedObservable=new R.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.ZW=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new l.he(0,0,0,0),this._colorDiff=new l.he(0,0,0,0),this._scaledDirection=V.Xv.Zero(),this._scaledGravity=V.Xv.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=f=>{},this.recycleParticle=f=>{const v=this.ZW.pop();v!==f&&v.copyTo(f),this._stockParticles.push(v)},this._createParticle=()=>{let f;return 0!==this._stockParticles.length?(f=this._stockParticles.pop(),f._reset()):f=new D(this),this._prepareParticle(f),f},this.paused=!1,this._shadersLoaded=!1,this._capacity=v,this._epsilon=e,Z&&"Scene"!==Z.getClassName()?(this._engine=Z,this.defaultProjectionMatrix=V.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Z||S.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fW.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Lf,previousItem:null,nextItem:null},this._positionCreation={process:Uf,previousItem:null,nextItem:null},pf(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Of,previousItem:null,nextItem:null},pf(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Ef,previousItem:null,nextItem:null},pf(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:If,previousItem:null,nextItem:null},pf(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:jf,previousItem:null,nextItem:null},pf(this._angleCreation,this._sizeCreation),this._colorCreation={process:hf,previousItem:null,nextItem:null},pf(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,C||(this._colorProcessing={process:ef,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Hf,previousItem:null,nextItem:null},pf(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Ff,previousItem:null,nextItem:null},pf(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Af,previousItem:null,nextItem:null},pf(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Nf,previousItem:null,nextItem:null},pf(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=J,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ff.d(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new u,this.updateFunction=f=>{var v;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(v=this.noiseTexture.getContent())||void 0===v||v.then((f=>{this._noiseTextureData=f})));const Z=f===this.ZW;for(let V=0;V<f.length;V++){const v=f[V];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const h=v.age;if(v.age+=this._tempScaledUpdateSpeed,v.age>v.lifeTime){const f=v.age-h,Z=v.lifeTime-h;this._tempScaledUpdateSpeed=Z*this._tempScaledUpdateSpeed/f,v.age=v.lifeTime}this._ratio=v.age/v.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let J=this._updateQueueStart;for(;J;)J.process(v,this),J=J.nextItem;if(this._isAnimationSheetEnabled&&!C&&v.updateCellIndex(),v._inheritParticleInfoToSubEmitters(),v.age>=v.lifeTime){if(this._emitFromParticle(v),v._attachedSubEmitters){for(const f of v._attachedSubEmitters)f.particleSystem.disposeOnStop=!0,f.particleSystem.stop();v._attachedSubEmitters=null}this.recycleParticle(v),Z&&V--}else;}}}serialize(f){throw new Error("Method not implemented.")}clone(f,v){throw new Error("Method not implemented.")}_addFactorGradient(f,v,Z,V){const h=new d(v,Z,V);f.push(h),f.sort(((f,v)=>f.gradient<v.gradient?-1:f.gradient>v.gradient?1:0))}_removeFactorGradient(f,v){if(!f)return;let Z=0;for(const V of f){if(V.gradient===v){f.splice(Z,1);break}Z++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=tf:this._lifeTimeCreation.process=Lf}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Bf,previousItem:null,nextItem:null},pf(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(rf(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(f){this.targetStopDuration!==f&&(this._targetStopDuration=f,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(f,v,Z){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,f,v,Z),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(f){return this._removeFactorGradient(this._lifeTimeGradients,f),this._syncLifeTimeCreation(),this}addSizeGradient(f,v,Z){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Tf,this._sizeGradientProcessing={process:Pf,previousItem:null,nextItem:null},mf(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,f,v,Z),this}removeSizeGradient(f){var v;return this._removeFactorGradient(this._sizeGradients,f),0===(null===(v=this._sizeGradients)||void 0===v?void 0:v.length)&&(rf(this._sizeGradientProcessing),this._sizeCreation.process=If),this}addColorRemapGradient(f,v,Z){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,f,v,Z),this}removeColorRemapGradient(f){return this._removeFactorGradient(this._colorRemapGradients,f),this}addAlphaRemapGradient(f,v,Z){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,f,v,Z),this}removeAlphaRemapGradient(f){return this._removeFactorGradient(this._alphaRemapGradients,f),this}addAngularSpeedGradient(f,v,Z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=qf,this._angularSpeedGradientProcessing={process:Cf,previousItem:null,nextItem:null},mf(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,f,v,Z),this}removeAngularSpeedGradient(f){var v;return this._removeFactorGradient(this._angularSpeedGradients,f),0===(null===(v=this._angularSpeedGradients)||void 0===v?void 0:v.length)&&(this._angleCreation.process=jf,rf(this._angularSpeedGradientProcessing)),this}addVelocityGradient(f,v,Z){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Wf,previousItem:null,nextItem:null},pf(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:bf,previousItem:null,nextItem:null},mf(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,f,v,Z),this}removeVelocityGradient(f){var v;return this._removeFactorGradient(this._velocityGradients,f),0===(null===(v=this._velocityGradients)||void 0===v?void 0:v.length)&&(rf(this._velocityCreation),rf(this._velocityGradientProcessing)),this}addLimitVelocityGradient(f,v,Z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:af,previousItem:null,nextItem:null},pf(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Xf,previousItem:null,nextItem:null},pf(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,f,v,Z),this}removeLimitVelocityGradient(f){var v;return this._removeFactorGradient(this._limitVelocityGradients,f),0===(null===(v=this._limitVelocityGradients)||void 0===v?void 0:v.length)&&(rf(this._limitVelocityCreation),rf(this._limitVelocityGradientProcessing)),this}addDragGradient(f,v,Z){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:sf,previousItem:null,nextItem:null},mf(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:zf,previousItem:null,nextItem:null},mf(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,f,v,Z),this}removeDragGradient(f){var v;return this._removeFactorGradient(this._dragGradients,f),0===(null===(v=this._dragGradients)||void 0===v?void 0:v.length)&&(rf(this._dragCreation),rf(this._dragGradientProcessing)),this}addEmitRateGradient(f,v,Z){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,f,v,Z),this}removeEmitRateGradient(f){return this._removeFactorGradient(this._emitRateGradients,f),this}addStartSizeGradient(f,v,Z){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,f,v,Z),this._syncStartSizeCreation(),this}removeStartSizeGradient(f){return this._removeFactorGradient(this._startSizeGradients,f),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const f=new Uint8Array(4*this._rawTextureWidth),v=l.TmpColors.Mv[0];for(let Z=0;Z<this._rawTextureWidth;Z++){const V=Z/this._rawTextureWidth;x.GetCurrentGradient(V,this._rampGradients,((V,h,J)=>{l.Mv.LerpToRef(V.color,h.color,J,v),f[4*Z]=255*v.r,f[4*Z+1]=255*v.g,f[4*Z+2]=255*v.b,f[4*Z+3]=255}))}this._rampGradientsTexture=n.c.CreateRGBATexture(f,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((f,v)=>f.gradient<v.gradient?-1:f.gradient>v.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(f,v){this._rampGradients||(this._rampGradients=[]);const Z=new Q(f,v);return this._rampGradients.push(Z),this._syncRampGradientTexture(),this}removeRampGradient(f){return this._removeGradientAndTexture(f,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(f,v,Z){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Jf,this._colorProcessing.process=lf);const V=new G(f,v,Z);return this._colorGradients.push(V),this._colorGradients.sort(((f,v)=>f.gradient<v.gradient?-1:f.gradient>v.gradient?1:0)),this}removeColorGradient(f){if(!this._colorGradients)return this;let v=0;for(const Z of this._colorGradients){if(Z.gradient===f){this._colorGradients.splice(v,1);break}v++}return 0===this._colorGradients.length&&(this._colorCreation.process=hf,this._colorProcessing.process=ef),this}resetDrawCache(){if(this._drawWrappers){for(const f of this._drawWrappers)if(f)for(const v of f)null===v||void 0===v||v.dispose();this._drawWrappers=[]}}_fetchR(f,v,Z,V,h){return h[4*(((f=.5*Math.abs(f)+.5)*Z%Z|0)+((v=.5*Math.abs(v)+.5)*V%V|0)*Z)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const f=this._engine,v=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*v),this._vertexBuffer=new s.e(f,this._vertexData,!0,v);let Z=0;const V=this._vertexBuffer.createVertexBuffer(s.g.PositionKind,Z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.g.PositionKind]=V,Z+=3;const h=this._vertexBuffer.createVertexBuffer(s.g.ColorKind,Z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.g.ColorKind]=h,Z+=4;const J=this._vertexBuffer.createVertexBuffer("angle",Z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=J,Z+=1;const l=this._vertexBuffer.createVertexBuffer("size",Z,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=l,Z+=2,this._isAnimationSheetEnabled){const f=this._vertexBuffer.createVertexBuffer("cellIndex",Z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=f,Z+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const f=this._vertexBuffer.createVertexBuffer("direction",Z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=f,Z+=3}if(this._useRampGradients){const f=this._vertexBuffer.createVertexBuffer("remapData",Z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=f,Z+=4}let e;if(this._useInstancing){const v=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new s.e(f,v,!1,2),e=this._spriteBuffer.createVertexBuffer("offset",0,2)}else e=this._vertexBuffer.createVertexBuffer("offset",Z,2,this._vertexBufferSize,this._useInstancing),Z+=2;this._vertexBuffers.offset=e,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const f=[],v=[];let Z=0;for(let V=0;V<this._capacity;V++)f.push(Z),f.push(Z+1),f.push(Z+2),f.push(Z),f.push(Z+2),f.push(Z+3),v.push(Z,Z+1,Z+1,Z+2,Z+2,Z+3,Z+3,Z,Z,Z+3),Z+=4;this._indexBuffer=this._engine.createIndexBuffer(f),this._linesIndexBuffer=this._engine.createIndexBuffer(v)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(f)setTimeout((()=>{this.start(0)}),f);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var v;-1!==(null===(v=this.hv)||void 0===v?void 0:v.getClassName().indexOf("Mesh"))&&this.hv.jh(!0);const f=this.noiseTexture;if(f&&f.onGeneratedObservable)f.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),f.render()}))}));else for(let v=0;v<this.preWarmCycles;v++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(f))}_postStop(f){}reset(){this._stockParticles.length=0,this.ZW.length=0}_appendParticleVertex(f,v,Z,h){let J=f*this._vertexBufferSize;if(this._vertexData[J++]=v.position.x+this.MH.x,this._vertexData[J++]=v.position.y+this.MH.y,this._vertexData[J++]=v.position.z+this.MH.z,this._vertexData[J++]=v.color.r,this._vertexData[J++]=v.color.g,this._vertexData[J++]=v.color.b,this._vertexData[J++]=v.color.a,this._vertexData[J++]=v.angle,this._vertexData[J++]=v.scale.x*v.size,this._vertexData[J++]=v.scale.y*v.size,this._isAnimationSheetEnabled&&(this._vertexData[J++]=v.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[J++]=v.direction.x,this._vertexData[J++]=v.direction.y,this._vertexData[J++]=v.direction.z);else if(v._initialDirection){let f=v._initialDirection;this.isLocal&&(V.Xv.TransformNormalToRef(f,this._emitterWorldMatrix,V.TmpVectors.Xv[0]),f=V.TmpVectors.Xv[0]),0===f.x&&0===f.z&&(f.x=.001),this._vertexData[J++]=f.x,this._vertexData[J++]=f.y,this._vertexData[J++]=f.z}else{let f=v.direction;this.isLocal&&(V.Xv.TransformNormalToRef(f,this._emitterWorldMatrix,V.TmpVectors.Xv[0]),f=V.TmpVectors.Xv[0]),0===f.x&&0===f.z&&(f.x=.001),this._vertexData[J++]=f.x,this._vertexData[J++]=f.y,this._vertexData[J++]=f.z}this._useRampGradients&&v.remapData&&(this._vertexData[J++]=v.remapData.x,this._vertexData[J++]=v.remapData.y,this._vertexData[J++]=v.remapData.z,this._vertexData[J++]=v.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Z?Z=this._epsilon:1===Z&&(Z=1-this._epsilon),0===h?h=this._epsilon:1===h&&(h=1-this._epsilon)),this._vertexData[J++]=Z,this._vertexData[J++]=h)}_prepareParticle(f){}_createNewOnes(f){let v;for(let Z=0;Z<f&&this.ZW.length!==this._capacity;Z++){v=this._createParticle(),this.ZW.push(v);let f=this._createQueueStart;for(;f;)f.process(v,this),f=f.nextItem;v._inheritParticleInfoToSubEmitters()}}_update(f){if(this._alive=this.ZW.length>0,this.hv.position){const f=this.hv;this._emitterWorldMatrix=f.getWorldMatrix()}else{const f=this.hv;this._emitterWorldMatrix=V.Matrix.Translation(f.x,f.y,f.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.ZW),this._createNewOnes(f)}static _GetAttributeNamesOrOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=[s.g.PositionKind,s.g.ColorKind,"angle","offset","size"];return f&&V.push("cellIndex"),v||V.push("direction"),Z&&V.push("remapData"),V}static _GetEffectCreationOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,vf.b)(V),f&&V.push("particlesInfos"),v&&V.push("logarithmicDepthConstant"),Z&&(V.push("vFogInfos"),V.push("vFogColor")),V}fillDefines(f,v){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,vf.g)(this,this._scene,f),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&f.push("#define FOG")),this._isAnimationSheetEnabled&&f.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&f.push("#define LOGARITHMICDEPTH"),v===C.BLENDMODE_MULTIPLY&&f.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&f.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(f.push("#define BILLBOARD"),this.billboardMode){case 2:f.push("#define BILLBOARDY");break;case 8:case 9:f.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&f.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:f.push("#define BILLBOARDMODE_ALL")}Z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),f.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(f,v,Z){v.push(...of._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),f.push(...of._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Z.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Vf.e)(f,this._imageProcessingConfigurationDefines),(0,Vf.c)(Z,this._imageProcessingConfigurationDefines))}_getWrapper(f){const v=this._getCustomDrawWrapper(f);if(null!==v&&void 0!==v&&v.effect)return v;const Z=[];this.fillDefines(Z,f);const V=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let h=this._drawWrappers[V];h||(h=this._drawWrappers[V]=[]);let J=h[f];J||(J=new ff.d(this._engine),J.drawContext&&(J.drawContext.useInstancing=this._useInstancing),h[f]=J);const l=Z.join("\n");if(J.defines!==l){const f=[],v=[],Z=[];this.fillUniformsAttributesAndSamplerNames(v,f,Z),J.setEffect(this._engine.createEffect("particles",f,v,Z,l,void 0,void 0,void 0,void 0,this._shaderLanguage),l)}return J}animate(){var f;let v,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Z&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(f=this._scene)||void 0===f?void 0:f.getAnimationRatio())||1),this.manualEmitCount>-1)v=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let f=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const v=this._actualFrame/this.targetStopDuration;x.GetCurrentGradient(v,this._emitRateGradients,((v,Z,V)=>{v!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Z.getFactor(),this._currentEmitRateGradient=v),f=(0,H.Lerp)(this._currentEmitRate1,this._currentEmitRate2,V)}))}v=f*this._scaledUpdateSpeed|0,this._newPartsExcess+=f*this._scaledUpdateSpeed-v}if(this._newPartsExcess>1&&(v+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?v=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(v),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Z){let f=0;for(let v=0;v<this.ZW.length;v++){const Z=this.ZW[v];this._appendParticleVertices(f,Z),f+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.ZW.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(f,v){this._appendParticleVertex(f++,v,0,0),this._useInstancing||(this._appendParticleVertex(f++,v,1,0),this._appendParticleVertex(f++,v,1,1),this._appendParticleVertex(f++,v,0,1))}rebuild(){var f;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(f=this._spriteBuffer)||void 0===f||f._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!of.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Z.bind(Z,12899)),Promise.resolve().then(Z.bind(Z,12827))])):await Promise.all([Promise.resolve().then(Z.bind(Z,12822)),Promise.resolve().then(Z.bind(Z,12806))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.hv||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(f){const v=this._getWrapper(f),Z=v.effect,h=this._engine;h.enableEffect(v);const J=this.defaultViewMatrix??this._scene.getViewMatrix();if(Z.setTexture("diffuseSampler",this.particleTexture),Z.setMatrix("view",J),Z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const f=this.particleTexture.getBaseSize();Z.setFloat3("particlesInfos",this.spriteCellWidth/f.width,this.spriteCellHeight/f.height,this.spriteCellWidth/f.width)}if(Z.setVector2("translationPivot",this.translationPivot),Z.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const f=this._scene.activeCamera;Z.setVector3("eyePosition",f.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Z.setTexture("rampSampler",this._rampGradientsTexture));const l=Z.defines;var e,C,H,O,u,W;(this._scene&&((0,vf.c)(Z,this,this._scene),this.applyFog&&(0,Zf.d)(this._scene,void 0,Z)),l.indexOf("#define BILLBOARDMODE_ALL")>=0&&(J.invertToRef(V.TmpVectors.Matrix[0]),Z.setMatrix("invView",V.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?h.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Z):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Z)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?h.bindBuffers(this._vertexBuffers,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Z):h.bindBuffers(this._vertexBuffers,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBufferUseInstancing:null,Z);(this.useLogarithmicDepth&&this._scene&&(0,Zf.h)(l,Z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Z),this._setEngineBasedOnBlendMode(f),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Z),this._useInstancing)?null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?h.drawElementsType(6,0,10,this.ZW.length):h.drawArraysType(7,0,4,this.ZW.length):null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?h.drawElementsType(1,0,10*this.ZW.length):h.drawElementsType(0,0,6*this.ZW.length);return this.ZW.length}render(){if(!this.isReady()||!this.ZW.length)return 0;const f=this._engine;f.setState&&(f.setState(!1),this.forceDepthWrite&&f.setDepthWrite(!0));let v=0;return v=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),v}_onDispose(){}dispose(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),f&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),f&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(v,Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const f=this._scene.fW.indexOf(this);f>-1&&this._scene.fW.splice(f,1),this._scene._activeParticleSystems.dispose()}this.Kh.notifyObservers(this),this.Kh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}of.ForceGLSL=!1;var Gf,Qf=Z(11263);!function(f){f[f.ATTACHED=0]="ATTACHED",f[f.END=1]="END"}(Gf||(Gf={}));class df{constructor(f){if(this.particleSystem=f,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!f.hv||!f.hv.dispose){const v=(0,e.e)("BABYLON.AbstractMesh");f.hv=new v("SubemitterSystemEmitter",f.Yf()),f._disposeEmitterOnDispose=!0}}clone(){let f=this.particleSystem.hv;if(f){if(f instanceof V.Xv)f=f.clone();else if(-1!==f.getClassName().indexOf("Mesh")){f=new((0,e.e)("BABYLON.Mesh"))("",f.Yf()),f.isVisible=!1}}else f=new V.Xv;const v=new df(this.particleSystem.clone(this.particleSystem.name,f));return v.particleSystem.name+="Clone",v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem._disposeEmitterOnDispose=!0,v.particleSystem.disposeOnStop=!0,v}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem=this.particleSystem.serialize(f),v}static _ParseParticleSystem(f,v,Z){throw(0,Qf.e)("ParseParticle")}static Parse(f,v,Z){const V=f.particleSystem,h=new df(df._ParseParticleSystem(V,v,Z,!0));return h.type=f.type,h.inheritDirection=f.inheritDirection,h.inheritedVelocityAmount=f.inheritedVelocityAmount,h.particleSystem._isSubEmitter=!0,h}dispose(){this.particleSystem.dispose()}}var xf=Z(11318);function Rf(f,v){const Z=new U;return Z.direction1=f,Z.direction2=v,Z}function nf(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Sf(){return new K(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Df(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Xv(0,1,0),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0);return new M(f,v,Z)}function fv(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function vv(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0),J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Xv(0,1,0);return new X(f,v,Z,h,J)}function Zv(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new W(f,v)}function Vv(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0);return new a(f,v,Z,h)}const hv=V.Xv.Zero(),Jv=V.Xv.Zero(),lv=V.Xv.Zero();class ev{constructor(){this.strength=0,this.position=V.Xv.Zero()}_processParticle(f,v){this.position.subtractToRef(f.position,hv);const Z=hv.lengthSquared()+1;hv.normalize().scaleToRef(this.strength/Z,Jv),Jv.scaleToRef(v._tempScaledUpdateSpeed,lv),f.direction.addInPlace(lv)}serialize(){return{position:this.position.Ph(),strength:this.strength}}}class Cv extends of{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=f=>{if(!this._subEmitters||0===this._subEmitters.length)return;const v=Math.floor(Math.random()*this._subEmitters.length);for(const Z of this._subEmitters[v])if(1===Z.type){const v=Z.clone();f._inheritParticleInfoToSubEmitter(v),v.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(v.particleSystem),v.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(f,v){const Z=Rf(f,v);return this.particleEmitterType=Z,Z}get flowMap(){return this._flowMap}set flowMap(f){this._flowMap!==f&&(this._flowMap=f,this._flowMapUpdate&&(rf(this._flowMapUpdate),this._flowMapUpdate=null),f&&(this._flowMapUpdate={process:f=>{var v;const Z=null===(v=this.Yf())||void 0===v?void 0:v.getTransformMatrix();this._flowMap._processParticle(f,this.flowMapStrength*this._tempScaledUpdateSpeed,Z)},previousItem:null,nextItem:null},pf(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(f){this._attractors.push(f),1===this._attractors.length&&(this._attractorUpdate={process:f=>{for(const v of this._attractors)v._processParticle(f,this)},previousItem:null,nextItem:null},pf(this._attractorUpdate,this._directionProcessing))}removeAttractor(f){const v=this._attractors.indexOf(f);-1!==v&&this._attractors.splice(v,1),0===this._attractors.length&&rf(this._attractorUpdate)}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(f)}createHemisphericEmitter(){const f=nf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createSphereEmitter(){const f=Sf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createDirectedSphereEmitter(){const f=Df(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Xv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0));return this.particleEmitterType=f,f}createCylinderEmitter(){const f=fv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=f,f}createDirectedCylinderEmitter(){const f=vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Xv(0,1,0));return this.particleEmitterType=f,f}createConeEmitter(){const f=Zv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=f,f}createDirectedConeEmitter(){const f=Vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0));return this.particleEmitterType=f,f}createBoxEmitter(f,v,Z,V){const h=new u;return this.particleEmitterType=h,this.direction1=f,this.direction2=v,this.minEmitBox=Z,this.maxEmitBox=V,h}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const f of this.subEmitters)f instanceof Cv?this._subEmitters.push([new df(f)]):f instanceof df?this._subEmitters.push([f]):f instanceof Array&&this._subEmitters.push(f)}_stopSubEmitters(){if(this.activeSubSystems){for(const f of this.activeSubSystems)f.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const f=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==f&&this._rootParticleSystem.activeSubSystems.splice(f,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(f){f&&this._stopSubEmitters()}_prepareParticle(f){if(this._subEmitters&&this._subEmitters.length>0){const v=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];f._attachedSubEmitters=[];for(const Z of v)if(0===Z.type){const v=Z.clone();f._attachedSubEmitters.push(v),v.particleSystem.start()}}}_onDispose(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),f&&this.particles)for(const Z of this.particles)if(Z._attachedSubEmitters)for(let f=Z._attachedSubEmitters.length-1;f>=0;f-=1)Z._attachedSubEmitters[f].dispose();if(v&&this.activeSubSystems)for(let Z=this.activeSubSystems.length-1;Z>=0;Z-=1)this.activeSubSystems[Z].dispose();if(this._subEmitters&&this._subEmitters.length){for(let f=0;f<this._subEmitters.length;f++)for(const v of this._subEmitters[f])v.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.hv&&this.hv.dispose&&this.hv.dispose(!0)}static _Parse(f,v,Z,h){let J;J=Z instanceof xf.b?null:Z;const C=(0,e.e)("BABYLON.Texture");if(C&&J&&(f.texture?v.particleTexture=C.Parse(f.texture,J,h):f.textureName&&(v.particleTexture=new C(h+f.textureName,J,!1,void 0===f.invertY||f.invertY),v.particleTexture.name=f.textureName)),f.emitterId||0===f.emitterId||void 0!==f.hv?f.emitterId&&J?v.hv=J.getLastMeshById(f.emitterId):v.hv=V.Xv.Av(f.hv):v.hv=V.Xv.Zero(),v.isLocal=!!f.isLocal,void 0!==f.renderingGroupId&&(v.renderingGroupId=f.renderingGroupId),void 0!==f.isBillboardBased&&(v.isBillboardBased=f.isBillboardBased),void 0!==f.billboardMode&&(v.billboardMode=f.billboardMode),void 0!==f.useLogarithmicDepth&&(v.useLogarithmicDepth=f.useLogarithmicDepth),f.animations){for(let Z=0;Z<f.animations.length;Z++){const V=f.animations[Z],h=(0,e.e)("BABYLON.Animation");h&&v.animations.push(h.Parse(V))}v.beginAnimationOnStart=f.beginAnimationOnStart,v.beginAnimationFrom=f.beginAnimationFrom,v.beginAnimationTo=f.beginAnimationTo,v.beginAnimationLoop=f.beginAnimationLoop}if(f.autoAnimate&&J&&J.beginAnimation(v,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),v.startDelay=0|f.startDelay,v.minAngularSpeed=f.minAngularSpeed,v.maxAngularSpeed=f.maxAngularSpeed,v.minSize=f.minSize,v.maxSize=f.maxSize,f.minScaleX&&(v.minScaleX=f.minScaleX,v.maxScaleX=f.maxScaleX,v.minScaleY=f.minScaleY,v.maxScaleY=f.maxScaleY),void 0!==f.preWarmCycles&&(v.preWarmCycles=f.preWarmCycles,v.preWarmStepOffset=f.preWarmStepOffset),void 0!==f.minInitialRotation&&(v.minInitialRotation=f.minInitialRotation,v.maxInitialRotation=f.maxInitialRotation),v.minLifeTime=f.minLifeTime,v.maxLifeTime=f.maxLifeTime,v.minEmitPower=f.minEmitPower,v.maxEmitPower=f.maxEmitPower,v.emitRate=f.emitRate,v.gravity=V.Xv.Av(f.gravity),f.noiseStrength&&(v.noiseStrength=V.Xv.Av(f.noiseStrength)),v.color1=l.he.Av(f.color1),v.color2=l.he.Av(f.color2),v.colorDead=l.he.Av(f.colorDead),v.updateSpeed=f.updateSpeed,v.targetStopDuration=f.targetStopDuration,v.blendMode=f.blendMode,f.colorGradients)for(const V of f.colorGradients)v.addColorGradient(V.gradient,l.he.Av(V.color1),V.color2?l.he.Av(V.color2):void 0);if(f.rampGradients){for(const Z of f.rampGradients)v.addRampGradient(Z.gradient,l.Mv.Av(Z.color));v.useRampGradients=f.useRampGradients}if(f.colorRemapGradients)for(const V of f.colorRemapGradients)v.addColorRemapGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.alphaRemapGradients)for(const V of f.alphaRemapGradients)v.addAlphaRemapGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.sizeGradients)for(const V of f.sizeGradients)v.addSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.angularSpeedGradients)for(const V of f.angularSpeedGradients)v.addAngularSpeedGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.velocityGradients)for(const V of f.velocityGradients)v.addVelocityGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.dragGradients)for(const V of f.dragGradients)v.addDragGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.emitRateGradients)for(const V of f.emitRateGradients)v.addEmitRateGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.startSizeGradients)for(const V of f.startSizeGradients)v.addStartSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.lifeTimeGradients)for(const V of f.lifeTimeGradients)v.addLifeTimeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(f.limitVelocityGradients){for(const Z of f.limitVelocityGradients)v.addLimitVelocityGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);v.limitVelocityDamping=f.limitVelocityDamping}if(f.noiseTexture&&J){const Z=(0,e.e)("BABYLON.ProceduralTexture");v.noiseTexture=Z.Parse(f.noiseTexture,J,h)}let H;if(f.particleEmitterType){switch(f.particleEmitterType.type){case"SphereParticleEmitter":H=new K;break;case"SphereDirectedParticleEmitter":H=new M;break;case"ConeEmitter":case"ConeParticleEmitter":H=new W;break;case"ConeDirectedParticleEmitter":H=new a;break;case"CylinderParticleEmitter":H=new b;break;case"CylinderDirectedParticleEmitter":H=new X;break;case"HemisphericParticleEmitter":H=new F;break;case"PointParticleEmitter":H=new U;break;case"MeshParticleEmitter":H=new z;break;case"CustomParticleEmitter":H=new A;break;default:H=new u}H.parse(f.particleEmitterType,J)}else H=new u,H.parse(f,J);v.particleEmitterType=H,v.startSpriteCellID=f.startSpriteCellID,v.endSpriteCellID=f.endSpriteCellID,v.spriteCellLoop=f.spriteCellLoop??!0,v.spriteCellWidth=f.spriteCellWidth,v.spriteCellHeight=f.spriteCellHeight,v.spriteCellChangeSpeed=f.spriteCellChangeSpeed,v.spriteRandomStartCell=f.spriteRandomStartCell,v.disposeOnStop=f.disposeOnStop??!1,v.manualEmitCount=f.manualEmitCount??-1}static Parse(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0;const e=f.name;let C,H,O=null,u=null;if(v instanceof xf.b?C=v:(H=v,C=H.getEngine()),f.customShader&&C.createEffectForParticles){u=f.customShader;const v=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";O=C.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,v)}const W=new Cv(e,J||f.Ne,v,O,f.isAnimationSheetEnabled);if(W.customShader=u,W._rootUrl=Z,f.id&&(W.id=f.id),f.subEmitters){W.subEmitters=[];for(const V of f.subEmitters){const f=[];for(const h of V)f.push(df.Parse(h,v,Z));W.subEmitters.push(f)}}if(f.attractors)for(const l of f.attractors){const f=new ev;f.position=V.Xv.Av(l.position),f.strength=l.strength,W.addAttractor(f)}return Cv._Parse(f,W,v,Z),f.textureMask&&(W.textureMask=l.he.Av(f.textureMask)),f.MH&&(W.MH=V.Xv.Av(f.MH)),f.preventAutoStart&&(W.preventAutoStart=f.preventAutoStart),h||W.preventAutoStart||W.start(),W}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};if(Cv._Serialize(v,this,f),v.textureMask=this.textureMask.Ph(),v.customShader=this.customShader,v.preventAutoStart=this.preventAutoStart,v.MH=this.MH.Ph(),this.subEmitters){v.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Z of this._subEmitters){const V=[];for(const v of Z)V.push(v.serialize(f));v.subEmitters.push(V)}}if(this._attractors&&this._attractors.length){v.attractors=[];for(const f of this._attractors)v.attractors.push(f.serialize())}return v}static _Serialize(f,v,Z){if(f.name=v.name,f.id=v.id,f.Ne=v.getCapacity(),f.disposeOnStop=v.disposeOnStop,f.manualEmitCount=v.manualEmitCount,v.hv.position){const Z=v.hv;f.emitterId=Z.id}else{const Z=v.hv;f.hv=Z.Ph()}v.particleEmitterType&&(f.particleEmitterType=v.particleEmitterType.serialize()),v.particleTexture&&(Z?f.texture=v.particleTexture.serialize():(f.textureName=v.particleTexture.name,f.invertY=!!v.particleTexture._invertY)),f.isLocal=v.isLocal,w.b.AppendSerializedAnimations(v,f),f.beginAnimationOnStart=v.beginAnimationOnStart,f.beginAnimationFrom=v.beginAnimationFrom,f.beginAnimationTo=v.beginAnimationTo,f.beginAnimationLoop=v.beginAnimationLoop,f.startDelay=v.startDelay,f.renderingGroupId=v.renderingGroupId,f.isBillboardBased=v.isBillboardBased,f.billboardMode=v.billboardMode,f.minAngularSpeed=v.minAngularSpeed,f.maxAngularSpeed=v.maxAngularSpeed,f.minSize=v.minSize,f.maxSize=v.maxSize,f.minScaleX=v.minScaleX,f.maxScaleX=v.maxScaleX,f.minScaleY=v.minScaleY,f.maxScaleY=v.maxScaleY,f.minEmitPower=v.minEmitPower,f.maxEmitPower=v.maxEmitPower,f.minLifeTime=v.minLifeTime,f.maxLifeTime=v.maxLifeTime,f.emitRate=v.emitRate,f.gravity=v.gravity.Ph(),f.noiseStrength=v.noiseStrength.Ph(),f.color1=v.color1.Ph(),f.color2=v.color2.Ph(),f.colorDead=v.colorDead.Ph(),f.updateSpeed=v.updateSpeed,f.targetStopDuration=v.targetStopDuration,f.blendMode=v.blendMode,f.preWarmCycles=v.preWarmCycles,f.preWarmStepOffset=v.preWarmStepOffset,f.minInitialRotation=v.minInitialRotation,f.maxInitialRotation=v.maxInitialRotation,f.startSpriteCellID=v.startSpriteCellID,f.spriteCellLoop=v.spriteCellLoop,f.endSpriteCellID=v.endSpriteCellID,f.spriteCellChangeSpeed=v.spriteCellChangeSpeed,f.spriteCellWidth=v.spriteCellWidth,f.spriteCellHeight=v.spriteCellHeight,f.spriteRandomStartCell=v.spriteRandomStartCell,f.isAnimationSheetEnabled=v.isAnimationSheetEnabled,f.useLogarithmicDepth=v.useLogarithmicDepth;const V=v.getColorGradients();if(V){f.colorGradients=[];for(const v of V){const Z={gradient:v.gradient,color1:v.color1.Ph()};v.color2?Z.color2=v.color2.Ph():Z.color2=v.color1.Ph(),f.colorGradients.push(Z)}}const h=v.getRampGradients();if(h){f.rampGradients=[];for(const v of h){const Z={gradient:v.gradient,color:v.color.Ph()};f.rampGradients.push(Z)}f.useRampGradients=v.useRampGradients}const J=v.getColorRemapGradients();if(J){f.colorRemapGradients=[];for(const v of J){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.colorRemapGradients.push(Z)}}const l=v.getAlphaRemapGradients();if(l){f.alphaRemapGradients=[];for(const v of l){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.alphaRemapGradients.push(Z)}}const e=v.getSizeGradients();if(e){f.sizeGradients=[];for(const v of e){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.sizeGradients.push(Z)}}const C=v.getAngularSpeedGradients();if(C){f.angularSpeedGradients=[];for(const v of C){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.angularSpeedGradients.push(Z)}}const H=v.getVelocityGradients();if(H){f.velocityGradients=[];for(const v of H){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.velocityGradients.push(Z)}}const O=v.getDragGradients();if(O){f.dragGradients=[];for(const v of O){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.dragGradients.push(Z)}}const u=v.getEmitRateGradients();if(u){f.emitRateGradients=[];for(const v of u){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.emitRateGradients.push(Z)}}const W=v.getStartSizeGradients();if(W){f.startSizeGradients=[];for(const v of W){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.startSizeGradients.push(Z)}}const a=v.getLifeTimeGradients();if(a){f.lifeTimeGradients=[];for(const v of a){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.lifeTimeGradients.push(Z)}}const b=v.getLimitVelocityGradients();if(b){f.limitVelocityGradients=[];for(const v of b){const Z={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?Z.factor2=v.factor2:Z.factor2=v.factor1,f.limitVelocityGradients.push(Z)}f.limitVelocityDamping=v.limitVelocityDamping}v.noiseTexture&&(f.noiseTexture=v.noiseTexture.serialize())}clone(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V={...this._customWrappers};let h=null;const J=this._engine;if(J.createEffectForParticles&&null!=this.customShader){h=this.customShader;const f=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",v=J.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,f);V[0]?V[0].effect=v:this.setCustomEffect(v,0)}const l=this.serialize(Z),e=Cv.Parse(l,this._scene||this._engine,this._rootUrl);return e.name=f,e.customShader=h,e._customWrappers=V,void 0===v&&(v=this.hv),this.noiseTexture&&(e.noiseTexture=this.noiseTexture.clone()),e.hv=v,this.preventAutoStart||e.start(),e}}Cv.BILLBOARDMODE_Y=2,Cv.BILLBOARDMODE_ALL=7,Cv.BILLBOARDMODE_STRETCHED=8,Cv.BILLBOARDMODE_STRETCHED_LOCAL=9,df._ParseParticleSystem=Cv.Parse;var Hv=Z(11655),Ov=Z(11646),uv=Z(11543);uv.d.prototype.createTransformFeedback=function(){const f=this._gl.createTransformFeedback();if(!f)throw new Error("Unable to create Transform Feedback");return f},uv.d.prototype.deleteTransformFeedback=function(f){this._gl.deleteTransformFeedback(f)},uv.d.prototype.bindTransformFeedback=function(f){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,f)},uv.d.prototype.beginTransformFeedback=function(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(f?this._gl.POINTS:this._gl.TRIANGLES)},uv.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},uv.d.prototype.setTranformFeedbackVaryings=function(f,v){this._gl.transformFeedbackVaryings(f,v,this._gl.INTERLEAVED_ATTRIBS)},uv.d.prototype.bindTransformFeedbackBuffer=function(f){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f?f.underlyingResource:null)},uv.d.prototype.readTransformFeedbackBuffer=function(f){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f)};const Wv="clipPlaneFragmentDeclaration2",av="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";y.c.IncludesShadersStore[Wv]||(y.c.IncludesShadersStore[Wv]=av);Z(12723),Z(12731),Z(12735),Z(12740),Z(12743),Z(12748),Z(12753),Z(12762);const bv="gpuRenderParticlesPixelShader",Xv="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";y.c.ShadersStore[bv]||(y.c.ShadersStore[bv]=Xv);const Fv="clipPlaneVertexDeclaration2",Uv="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";y.c.IncludesShadersStore[Fv]||(y.c.IncludesShadersStore[Fv]=Uv);Z(12765),Z(12769),Z(12772),Z(12775);const Kv="gpuRenderParticlesVertexShader",Mv="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";y.c.ShadersStore[Kv]||(y.c.ShadersStore[Kv]=Mv);class Av extends C{static get IsSupported(){if(!S.c.LastCreatedEngine)return!1;const f=S.c.LastCreatedEngine.getCaps();return f.supportTransformFeedbacks||f.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(f){this._maxActiveParticleCount=Math.min(f,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(f){this.maxActiveParticleCount=f}createPointEmitter(f,v){const Z=Rf(f,v);return this.particleEmitterType=Z,Z}createHemisphericEmitter(){const f=nf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createSphereEmitter(){const f=Sf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createDirectedSphereEmitter(){const f=Df(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Xv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0));return this.particleEmitterType=f,f}createCylinderEmitter(){const f=fv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=f,f}createDirectedCylinderEmitter(){const f=vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Xv(0,1,0));return this.particleEmitterType=f,f}createConeEmitter(){const f=Zv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=f,f}createDirectedConeEmitter(){const f=Vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Xv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Xv(0,1,0));return this.particleEmitterType=f,f}createBoxEmitter(f,v,Z,V){const h=new u;return this.particleEmitterType=h,this.direction1=f,this.direction2=v,this.minEmitBox=Z,this.maxEmitBox=V,h}get flowMap(){return this._flowMap}set flowMap(f){this._flowMap!==f&&(this._flowMap=f)}isReady(){if(!this.hv||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Cv.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Cv.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Cv.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";f?setTimeout((()=>{this.start(0)}),f):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var f;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._customWrappers[v])||void 0===f?void 0:f.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[f]??this._customWrappers[0]}setCustomEffect(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new ff.d(this._engine),this._customWrappers[v].effect=f}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(f,v,Z){return super._removeGradientAndTexture(f,v,Z),this._releaseBuffers(),this}addColorGradient(f,v){this._colorGradients||(this._colorGradients=[]);const Z=new G(f,v);return this._colorGradients.push(Z),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(f&&this._colorGradients.sort(((f,v)=>f.gradient<v.gradient?-1:f.gradient>v.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(f){return this._removeGradientAndTexture(f,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const v in this._drawWrappers){var f;null===(f=this._drawWrappers[v].drawContext)||void 0===f||f.reset()}}_addFactorGradient(f,v,Z){const V=new d(v,Z);f.push(V),this._releaseBuffers()}addSizeGradient(f,v){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,f,v),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(f){return this._removeGradientAndTexture(f,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(f,v){if(!f)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&f.sort(((f,v)=>f.gradient<v.gradient?-1:f.gradient>v.gradient?1:0));const Z=this;Z[v]&&(Z[v].dispose(),Z[v]=null)}addAngularSpeedGradient(f,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,f,v),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(f){return this._removeGradientAndTexture(f,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(f,v){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,f,v),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(f){return this._removeGradientAndTexture(f,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(f,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,f,v),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(f){return this._removeGradientAndTexture(f,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(f,v){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,f,v),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(f){return this._removeGradientAndTexture(f,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(f){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(f),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Kh=new R.c,this.onStoppedObservable=new R.c,this.onStartedObservable=new R.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Z&&"Scene"!==Z.getClassName()?(this._engine=Z,this.defaultProjectionMatrix=V.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Z||S.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fW.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,e.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,e.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,e.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,e.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ff.d(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers={0:new ff.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(v=v??{}).randomTextureSize||delete v.randomTextureSize;const l={Ne:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...v},C=v;isFinite(C)&&(l.Ne=C),this._capacity=l.Ne,this._maxActiveParticleCount=l.Ne,this._currentActiveCount=0,this._isAnimationSheetEnabled=J,this.particleEmitterType=new u;const H=Math.min(this._engine.getCaps().maxTextureSize,l.randomTextureSize);let O=[];for(let V=0;V<H;++V)O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),O.push(Math.random());this._randomTexture=new n.c(new Float32Array(O),H,1,5,Z,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,O=[];for(let V=0;V<H;++V)O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),O.push(Math.random());this._randomTexture2=new n.c(new Float32Array(O),H,1,5,Z,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=H}_reset(){this._releaseBuffers()}_createVertexBuffers(f,v,Z){const V={};V.position=v.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let h=3;V.age=v.createVertexBuffer("age",h,1,this._attributesStrideSize,!0),h+=1,V.size=v.createVertexBuffer("size",h,3,this._attributesStrideSize,!0),h+=3,V.life=v.createVertexBuffer("life",h,1,this._attributesStrideSize,!0),h+=1,h+=4,this.billboardMode===Cv.BILLBOARDMODE_STRETCHED&&(V.direction=v.createVertexBuffer("direction",h,3,this._attributesStrideSize,!0)),h+=3,this._platform.alignDataInBuffer&&(h+=1),this.particleEmitterType instanceof A&&(h+=3,this._platform.alignDataInBuffer&&(h+=1)),this._colorGradientsTexture||(V.color=v.createVertexBuffer("color",h,4,this._attributesStrideSize,!0),h+=4),this._isBillboardBased||(V.initialDirection=v.createVertexBuffer("initialDirection",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),this.noiseTexture&&(V.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1),V.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),V.angle=v.createVertexBuffer("angle",h,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?h++:h+=2,this._isAnimationSheetEnabled&&(V.cellIndex=v.createVertexBuffer("cellIndex",h,1,this._attributesStrideSize,!0),h+=1,this.spriteRandomStartCell&&(V.cellStartOffset=v.createVertexBuffer("cellStartOffset",h,1,this._attributesStrideSize,!0),h+=1)),V.offset=Z.createVertexBuffer("offset",0,2),V.uv=Z.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(V),this._platform.createVertexBuffers(f,V),this.resetDrawCache()}_initialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!f)return;const v=this._engine,Z=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof A&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const h=this.particleEmitterType instanceof A,J=V.TmpVectors.Xv[0];let l=0;for(let V=0;V<this._capacity;V++)if(Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),h?(this.particleEmitterType.particleDestinationGenerator(V,null,J),Z.push(J.x),Z.push(J.y),Z.push(J.z)):(Z.push(0),Z.push(0),Z.push(0)),this._platform.alignDataInBuffer&&Z.push(0),l+=16,h&&(this.particleEmitterType.particlePositionGenerator(V,null,J),Z.push(J.x),Z.push(J.y),Z.push(J.z),this._platform.alignDataInBuffer&&Z.push(0),l+=4),this._colorGradientsTexture||(Z.push(0),Z.push(0),Z.push(0),Z.push(0),l+=4),this.isBillboardBased||(Z.push(0),Z.push(0),Z.push(0),this._platform.alignDataInBuffer&&Z.push(0),l+=4),this.noiseTexture&&(Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),this._platform.alignDataInBuffer&&Z.push(0),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),this._platform.alignDataInBuffer&&Z.push(0),l+=8),Z.push(0),l+=1,this._angularSpeedGradientsTexture||(Z.push(0),l+=1),this._isAnimationSheetEnabled&&(Z.push(0),l+=1,this.spriteRandomStartCell&&(Z.push(0),l+=1)),this._platform.alignDataInBuffer){let f=3-(l+3&3);for(l+=f;f-- >0;)Z.push(0)}const e=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(Z),H=this._platform.createParticleBuffer(Z);this._buffer0=new s.e(v,C,!1,this._attributesStrideSize),this._buffer1=new s.e(v,H,!1,this._attributesStrideSize),this._spriteBuffer=new s.e(v,e,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let f=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(f+="\n#define BILLBOARD"),this._colorGradientsTexture&&(f+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(f+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(f+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(f+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(f+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(f+="\n#define DRAGGRADIENTS"),this._flowMap&&(f+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(f+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(f+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(f+="\n#define NOISE"),this.isLocal&&(f+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===f||(this._cachedUpdateDefines=f,this._updateBuffer=this._platform.createUpdateBuffer(f)),this._platform.isUpdateBufferReady()}_getWrapper(f){const v=this._getCustomDrawWrapper(f);if(null!==v&&void 0!==v&&v.effect)return v;const Z=[];this.fillDefines(Z,f);let V=this._drawWrappers[f];V||(V=new ff.d(this._engine),V.drawContext&&(V.drawContext.useInstancing=!0),this._drawWrappers[f]=V);const h=Z.join("\n");if(V.defines!==h){const f=[],v=[],Z=[];this.fillUniformsAttributesAndSamplerNames(v,f,Z),V.setEffect(this._engine.createEffect("gpuRenderParticles",f,v,Z,h),h)}return V}static _GetAttributeNamesOrOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=[s.g.PositionKind,"age","life","size","angle"];return f||h.push(s.g.ColorKind),v&&h.push("cellIndex"),Z||h.push("initialDirection"),V&&h.push("direction"),h.push("offset",s.g.UVKind),h}static _GetEffectCreationOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=["emitterWM","MH","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,vf.b)(V),f&&V.push("sheetInfos"),v&&V.push("logarithmicDepthConstant"),Z&&(V.push("vFogInfos"),V.push("vFogColor")),V}fillDefines(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,vf.g)(this,this._scene,f),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ov.b.FOGMODE_NONE&&f.push("#define FOG")),v===Cv.BLENDMODE_MULTIPLY&&f.push("#define BLENDMULTIPLYMODE"),this.isLocal&&f.push("#define LOCAL"),this.useLogarithmicDepth&&f.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(f.push("#define BILLBOARD"),this.billboardMode){case Cv.BILLBOARDMODE_Y:f.push("#define BILLBOARDY");break;case Cv.BILLBOARDMODE_STRETCHED:f.push("#define BILLBOARDSTRETCHED");break;case Cv.BILLBOARDMODE_ALL:f.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&f.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&f.push("#define ANIMATESHEET"),Z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),f.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(f,v,Z){v.push(...Av._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Cv.BILLBOARDMODE_STRETCHED)),f.push(...Av._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Z.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Hv.b.PrepareUniforms(f,this._imageProcessingConfigurationDefines),Hv.b.PrepareSamplers(Z,this._imageProcessingConfigurationDefines))}animate(){var f;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(v?this.preWarmStepOffset:(null===(f=this._scene)||void 0===f?void 0:f.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(f,v){const Z=this[v];if(!f||!f.length||Z)return;const V=new Float32Array(this._rawTextureWidth);for(let h=0;h<this._rawTextureWidth;h++){const v=h/this._rawTextureWidth;x.GetCurrentGradient(v,f,((f,v,Z)=>{V[h]=(0,H.Lerp)(f.factor1,v.factor1,Z)}))}this[v]=n.c.CreateRTexture(V,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[v].name=v.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const f=new Uint8Array(4*this._rawTextureWidth),v=l.TmpColors.he[0];for(let Z=0;Z<this._rawTextureWidth;Z++){const V=Z/this._rawTextureWidth;x.GetCurrentGradient(V,this._colorGradients,((V,h,J)=>{l.he.LerpToRef(V.color1,h.color1,J,v),f[4*Z]=255*v.r,f[4*Z+1]=255*v.g,f[4*Z+2]=255*v.b,f[4*Z+3]=255*v.a}))}this._colorGradientsTexture=n.c.CreateRGBATexture(f,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(f,v){var Z,h,J,l;const e=this._getWrapper(f),C=e.effect;this._engine.enableEffect(e);const H=(null===(Z=this._scene)||void 0===Z?void 0:Z.getViewMatrix())||V.Matrix.IdentityReadOnly;if(C.setMatrix("view",H),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("MH",this.MH),this.isLocal&&C.setMatrix("emitterWM",v),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const f=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/f.width,this.spriteCellHeight/f.height,f.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const f=this._scene.activeCamera;C.setVector3("eyePosition",f.globalPosition)}const O=C.defines;if(this._scene&&((0,vf.c)(C,this,this._scene),this.applyFog&&(0,Zf.d)(this._scene,void 0,C)),O.indexOf("#define BILLBOARDMODE_ALL")>=0){const f=H.clone();f.invert(),C.setMatrix("invView",f)}return this.useLogarithmicDepth&&this._scene&&(0,Zf.h)(O,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(f),this._platform.bindDrawBuffers(this._targetIndex,C,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(l=this._scene)&&void 0!==l&&l.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(f){if(!this.hv||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!f)if(this.hv.position){f=this.hv.getWorldMatrix()}else{const v=this.hv;f=V.TmpVectors.Matrix[0],V.Matrix.TranslationToRef(v.x,v.y,v.z,f)}const v=this._engine,Z=v.getDepthWrite();if(v.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const f=this.Yf();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",f.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",f),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const h=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=h,v.setDepthWrite(Z)}render(){let f,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!v&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let f=0;f<this.preWarmCycles;f++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const f=0|this._accumulatedCount;this._accumulatedCount-=f,this._currentActiveCount+=f}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.hv.position){f=this.hv.getWorldMatrix()}else{const v=this.hv;f=V.TmpVectors.Matrix[0],V.Matrix.TranslationToRef(v.x,v.y,v.z,f)}const h=this._engine;this.updateInAnimate||this._update(f);let J=0;return v||Z||(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0),J=this.blendMode===Cv.BLENDMODE_MULTIPLYADD?this._render(Cv.BLENDMODE_MULTIPLY,f)+this._render(Cv.BLENDMODE_ADD,f):this._render(this.blendMode,f),this._engine.setAlphaMode(0)),J}rebuild(){const f=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(f,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,f()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const v in this._drawWrappers){this._drawWrappers[v].dispose()}if(this._drawWrappers={},this._scene){const f=this._scene.fW.indexOf(this);f>-1&&this._scene.fW.splice(f,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let v=0;v<this._renderVertexBuffers.length;++v){const f=this._renderVertexBuffers[v];for(const v in f)f[v].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),f&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),f&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Kh.notifyObservers(this),this.Kh.clear()}clone(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V={...this._customWrappers};let h=null;const J=this._engine;if(J.createEffectForParticles&&null!=this.customShader){h=this.customShader;const f=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";V[0]=J.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,f,void 0,void 0,void 0,this)}const l=this.serialize(Z),e=Av.Parse(l,this._scene||this._engine,this._rootUrl);return e.name=f,e.customShader=h,e._customWrappers=V,void 0===v&&(v=this.hv),this.noiseTexture&&(e.noiseTexture=this.noiseTexture.clone()),e.hv=v,e}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return Cv._Serialize(v,this,f),v.activeParticleCount=this.activeParticleCount,v.randomTextureSize=this._randomTextureSize,v.customShader=this.customShader,v}static Parse(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const J=f.name;let l,e;v instanceof xf.b?l=v:(e=v,l=e.getEngine());const C=new Av(J,{Ne:h||f.Ne,randomTextureSize:f.randomTextureSize},v,null,f.isAnimationSheetEnabled);if(C._rootUrl=Z,f.customShader&&l.createEffectForParticles){const v=f.customShader,Z=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"",V=l.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,Z,void 0,void 0,void 0,C);C.setCustomEffect(V,0),C.customShader=v}return f.id&&(C.id=f.id),f.activeParticleCount&&(C.activeParticleCount=f.activeParticleCount),Cv._Parse(f,C,v,Z),f.preventAutoStart&&(C.preventAutoStart=f.preventAutoStart),V||C.preventAutoStart||C.start(),C}}var sv=Z(11230),zv=Z(12783),Yv=Z(11777);class yv{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(f){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const v of this.systems)v.hv=f;this._emitterNode=f}setEmitterAsSphere(f,v,Z){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:f,renderingGroupId:v};const V=(0,zv.d)("emitterSphere",{diameter:f.diameter,segments:f.segments},Z);V.renderingGroupId=v;const h=new Yv.Kv("emitterSphereMaterial",Z);h.emissiveColor=f.color,V.material=h;for(const J of this.systems)J.hv=V;this._emitterNode=V}start(f){for(const v of this.systems)f&&(v.hv=f),v.start()}dispose(){for(const f of this.systems)f.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={systems:[]};for(const Z of this.systems)v.systems.push(Z.serialize(f));return this._emitterNode&&(v.hv=this._emitterCreationOptions),v}static Parse(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;const h=new yv,J=this.BaseAssetsUrl+"/textures/";v=v||S.c.LastCreatedScene;for(const l of f.systems)h.systems.push(Z?Av.Parse(l,v,J,!0,V):Cv.Parse(l,v,J,!0,V));if(f.hv){const Z=f.hv.options;if("Sphere"===f.hv.kind)h.setEmitterAsSphere({diameter:Z.diameter,segments:Z.segments,color:l.Mv.Av(Z.color)},f.hv.renderingGroupId,v)}return h}}yv.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Nv=Z(11272);class iv{static CreateDefault(f){let v,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,V=arguments.length>2?arguments[2]:void 0;v=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Av("default system",{Ne:Z},V):new Cv("default system",Z,V),v.hv=f;const h=sv.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return v.particleTexture=new t.e(h,v.Yf()),v.createConeEmitter(.1,Math.PI/4),v.color1=new l.he(1,1,1,1),v.color2=new l.he(1,1,1,1),v.colorDead=new l.he(1,1,1,0),v.minSize=.1,v.maxSize=.1,v.minEmitPower=2,v.maxEmitPower=2,v.updateSpeed=1/60,v.emitRate=30,v}static CreateAsync(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;v||(v=S.c.LastCreatedScene);const h={};return v.addPendingData(h),new Promise(((J,l)=>{if(Z&&!Av.IsSupported)return v.removePendingData(h),l("Particle system with GPU is not supported.");sv.Tools.LoadFile(`${iv.BaseAssetsUrl}/systems/${f}.json`,(f=>{v.removePendingData(h);const l=JSON.parse(f.toString());return J(yv.Parse(l,v,Z,V))}),void 0,void 0,void 0,(()=>(v.removePendingData(h),l(`An error occurred with the creation of your particle system. Check if your type '${f}' exists.`))))}))}static ExportSet(f){const v=new yv;for(const Z of f)v.systems.push(Z);return v}static ParseFromFileAsync(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",J=arguments.length>5?arguments[5]:void 0;return new Promise(((l,e)=>{const C=new Nv.c;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const v=JSON.parse(C.responseText);let e;e=V?Av.Parse(v,Z,h,!1,J):Cv.Parse(v,Z,h,!1,J),f&&(e.name=f),l(e)}else e("Unable to load the particle system")})),C.open("GET",v),C.send()}))}static ParseFromSnippetAsync(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0;if("_BLANK"===f){const f=this.CreateDefault(null);return f.start(),Promise.resolve(f)}return new Promise(((J,l)=>{const e=new Nv.c;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const l=JSON.parse(JSON.parse(e.responseText).jsonPayload),C=JSON.parse(l.particleSystem);let H;H=Z?Av.Parse(C,v,V,!1,h):Cv.Parse(C,v,V,!1,h),H.snippetId=f,J(H)}else l("Unable to load the snippet "+f)})),e.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),e.send()}))}}iv.BaseAssetsUrl=yv.BaseAssetsUrl,iv.SnippetUrl="https://snippet.babylonjs.com",iv.CreateFromSnippetAsync=iv.ParseFromSnippetAsync;var Iv=Z(11859),Tv=Z(11683),Bv=Z(12786);(0,Bv.f)(Tv.c.NAME_PARTICLESYSTEM,((f,v,Z,V)=>{const h=(0,Bv.i)(Tv.c.NAME_PARTICLESYSTEM);if(h&&void 0!==f.fW&&null!==f.fW)for(let J=0,l=f.fW.length;J<l;J++){const l=f.fW[J];Z.fW.push(h(l,v,V))}})),(0,Bv.e)(Tv.c.NAME_PARTICLESYSTEM,((f,v,Z)=>{if(f.activeParticleCount){return Av.Parse(f,v,Z)}return Cv.Parse(f,v,Z)})),xf.b.prototype.createEffectForParticles=function(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",J=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,e=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,O=arguments.length>9?arguments[9]:void 0,u=[],W=[];const a=[];return C?C.fillUniformsAttributesAndSamplerNames(W,u,a):(u=Cv._GetAttributeNamesOrOptions(),W=Cv._GetEffectCreationOptions()),-1===h.indexOf(" BILLBOARD")&&(h+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===h.indexOf(" ANIMATESHEET")&&(h+="\n#define ANIMATESHEET\n"),-1===V.indexOf("diffuseSampler")&&V.push("diffuseSampler"),this.createEffect({vertex:O??(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:f},u,W.concat(v),a.concat(V),h,J,l,e,void 0,H,(async()=>{0===H?await Promise.resolve().then(Z.bind(Z,12822)):await Promise.resolve().then(Z.bind(Z,12899))}))},Iv.d.prototype.getEmittedParticleSystems=function(){const f=[];for(let v=0;v<this.Yf().fW.length;v++){const Z=this.Yf().fW[v];Z.hv===this&&f.push(Z)}return f},Iv.d.prototype.getHierarchyEmittedParticleSystems=function(){const f=[],v=this.getDescendants();v.push(this);for(let Z=0;Z<this.Yf().fW.length;Z++){const V=this.Yf().fW[Z],h=V.hv;h.position&&-1!==v.indexOf(h)&&f.push(V)}return f};Z(11741),Z(11750),Z(11833);Z(11837),Z(12794),Z(11603),Z(11733),Z(11876);Z(11601);var Pv;Z(12797),Z(11446);!function(f){f[f.Color=2]="Color",f[f.UV=1]="UV",f[f.Random=0]="Random",f[f.Stated=3]="Stated"}(Pv||(Pv={}));var gv=Z(11628);const wv=new V.Xv(0,0,0),tv=new V.Xv(0,0,0),Lv=new V.Xv(0,0,0);class Ev{constructor(f,v,Z){this.width=f,this.height=v,this.data=Z}processFlowable(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;if(!Z)return;Z instanceof V.Matrix?V.Xv.TransformCoordinatesToRef(f.position,Z,Lv):(Lv.x=Z.x,Lv.y=Z.y,Lv.z=Z.z);const h=.5*Lv.x+.5,J=1-(.5*Lv.y+.5),l=Math.floor(h*this.width),e=Math.floor(J*this.height);if(l<0||l>=this.width||e<0||e>=this.height)return;const C=4*(e*this.width+l),H=this.data[C]/255*2-1,O=this.data[C+1]/255*2-1,u=this.data[C+2]/255*2-1,W=this.data[C+3]/255;wv.set(H,O,u),wv.scaleToRef(v*W,tv),f.direction.addInPlace(tv)}_processParticle(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;this.processFlowable(f,v,Z)}static async FromUrlAsync(f){return await new Promise(((v,Z)=>{const V=document.createElement("canvas"),h=V.getContext("2d");let J=null;const l=new Image;l.crossOrigin="anonymous",l.src=f,l.onerror=v=>{Z(new Error(`Failed to load image: ${f} : ${v}`))},l.onload=()=>{V.width=l.width,V.height=l.height,h.drawImage(l,0,0),J=h.getImageData(0,0,V.width,V.height),v(new Ev(V.width,V.height,J.data))}}))}static async ExtractFromTextureAsync(f){return await new Promise(((v,Z)=>{if(!f.isReady())return void f.onLoadObservable.addOnce((async()=>{try{const Z=await this.ExtractFromTextureAsync(f);v(Z)}catch(V){Z(V)}}));const V=f.getSize();gv.o.GetTextureDataAsync(f,V.width,V.height).then((f=>{v(new Ev(V.width,V.height,new Uint8ClampedArray(f)))})).catch(Z)}))}}var jv,qv,cv,mv,pv,kv,rv,ov,Gv;!function(f){f[f.Int=1]="Int",f[f.Float=2]="Float",f[f.Vector2=4]="Vector2",f[f.Xv=8]="Xv",f[f.Matrix=16]="Matrix",f[f.Particle=32]="Particle",f[f.Texture=64]="Texture",f[f.he=128]="he",f[f.FloatGradient=256]="FloatGradient",f[f.Vector2Gradient=512]="Vector2Gradient",f[f.Vector3Gradient=1024]="Vector3Gradient",f[f.Color4Gradient=2048]="Color4Gradient",f[f.System=4096]="System",f[f.AutoDetect=8192]="AutoDetect",f[f.BasedOnInput=16384]="BasedOnInput",f[f.Undefined=32768]="Undefined",f[f.All=65535]="All"}(jv||(jv={})),function(f){f[f.Compatible=0]="Compatible",f[f.TypeIncompatible=1]="TypeIncompatible",f[f.HierarchyIssue=2]="HierarchyIssue"}(qv||(qv={})),function(f){f[f.Input=0]="Input",f[f.Output=1]="Output"}(cv||(cv={}));class Qv{get direction(){return this._direction}get type(){if(this._type===jv.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===jv.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(f){this._type=f}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((f=>f.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(f,v,Z){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=jv.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new R.c,this.onDisconnectionObservable=new R.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=v,this.name=f,this._direction=Z}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(f){var v;return this.isConnected?null!==(v=this._connectedPoint)&&void 0!==v&&v._storedFunction?this._connectedPoint._storedFunction(f):this._connectedPoint._storedValue:this.value}canConnectTo(f){return 0===this.checkCompatibilityState(f)}checkCompatibilityState(f){const v=this._ownerBlock,Z=f.ownerBlock;if(this.type!==f.type&&f.innerType!==jv.AutoDetect)return f.acceptedConnectionPointTypes&&-1!==f.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(f.excludedConnectionPointTypes&&-1!==f.excludedConnectionPointTypes.indexOf(this.type))return 1;let V=Z,h=v;return 0===this.direction&&(V=v,h=Z),V.isAnAncestorOf(h)?2:0}connectTo(f){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(f))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${f.ownerBlock.name}".${f.name}`;return this._endpoints.push(f),f._connectedPoint=this,this.onConnectionObservable.notifyObservers(f),f.onConnectionObservable.notifyObservers(this),this}disconnectFrom(f){const v=this._endpoints.indexOf(f);return-1===v||(this._endpoints.splice(v,1),f._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(f),f.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(f){let v=1;for(;v<jv.All;)f&v||this.excludedConnectionPointTypes.push(v),v<<=1}serialize(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const v={};return v.name=this.name,v.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ph?(v.valueType="BABYLON."+this.value.getClassName(),v.value=this.value.Ph()):(v.valueType="number",v.value=this.value)),f&&this.connectedPoint&&(v.inputName=this.name,v.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,v.targetConnectionName=this.connectedPoint.name,v.isExposedOnFrame=!0,v.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(v.isExposedOnFrame=!0,v.exposedPortPosition=this.exposedPortPosition),v}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class dv{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(f){this._name=f}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(f){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new R.c,this.Kh=new R.c,this.onInputChangedObservable=new R.c,this.visibleOnFrame=!1,this._name=f,this.uniqueId=L.b.UniqueId}_inputRename(f){return f}_outputRename(f){return f}isAnAncestorOf(f){for(const v of this._outputs)if(v.hasEndpoints)for(const Z of v.endpoints){if(Z.ownerBlock===f)return!0;if(Z.ownerBlock.isAnAncestorOf(f))return!0}return!1}isAnAncestorOfType(f){if(this.getClassName()===f)return!0;for(const v of this._outputs)if(v.hasEndpoints)for(const Z of v.endpoints)if(Z.ownerBlock.isAnAncestorOfType(f))return!0;return!1}getInputByName(f){const v=this._inputs.filter((v=>v.name===f));return v.length?v[0]:null}_linkConnectionTypes(f,v){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[v]._acceptedConnectionPointType=this._inputs[f]:(this._inputs[f]._linkedConnectionSource=this._inputs[v],this._inputs[f]._isMainLinkSource=!0),this._inputs[v]._linkedConnectionSource=this._inputs[f]}registerInput(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0;const l=new Qv(f,this,0);return l.type=v,l.isOptional=Z,l.defaultValue=V,l.value=V,l.valueMin=h,l.valueMax=J,this._inputs.push(l),this.onInputChangedObservable.notifyObservers(l),this}registerOutput(f,v,Z){return(Z=Z??new Qv(f,this,1)).type=v,this._outputs.push(Z),this}_build(f){}_customBuildStep(f){}build(f){if(this._buildId===f.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((f=>f.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=f.buildId;for(const v of this._inputs){if(!v.connectedPoint){v.isOptional||f.notConnectedNonOptionalInputs.push(v);continue}const Z=v.connectedPoint.ownerBlock;Z&&Z!==this&&!Z.isSystem&&Z.build(f)}return this._customBuildStep(f),f.verbose&&E.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(f),this.onBuildObservable.notifyObservers(this),!1}serialize(){const f={};f.customType="BABYLON."+this.getClassName(),f.id=this.uniqueId,f.name=this.name,f.visibleOnFrame=this.visibleOnFrame,f.inputs=[],f.outputs=[];for(const v of this.inputs)f.inputs.push(v.serialize());for(const v of this.outputs)f.outputs.push(v.serialize(!1));return f}_deserialize(f){this._name=f.name,this.comments=f.comments,this.visibleOnFrame=!!f.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(f)}_deserializePortDisplayNamesAndExposedOnFrame(f){const v=f.inputs,Z=f.outputs;if(v)for(const V of v){const f=this.inputs.find((f=>f.name===V.name));if(!f)return;if(V.displayName&&(f.displayName=V.displayName),V.isExposedOnFrame&&(f.isExposedOnFrame=V.isExposedOnFrame,f.exposedPortPosition=V.exposedPortPosition),void 0!==V.value&&null!==V.value)if("number"===V.valueType)f.value=V.value;else{const v=(0,e.e)(V.valueType);v&&(f.value=v.Av(V.value))}}if(Z)for(let V=0;V<Z.length;V++){const f=Z[V];f.displayName&&(this.outputs[V].displayName=f.displayName),f.isExposedOnFrame&&(this.outputs[V].isExposedOnFrame=f.isExposedOnFrame,this.outputs[V].exposedPortPosition=f.exposedPortPosition)}}clone(){const f=this.serialize(),v=(0,e.e)(f.customType);if(v){const Z=new v;return Z._deserialize(f),Z}return null}dispose(){this.Kh.notifyObservers(this),this.Kh.clear();for(const f of this.inputs)f.dispose();for(const f of this.outputs)f.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function xv(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",V=arguments.length>3?arguments[3]:void 0;return(h,J)=>{let l=h._propStore;l||(l=[],h._propStore=l),l.push({propertyName:J,displayName:f,type:v,groupName:Z,options:V??{},className:h.getClassName()})}}(0,P.d)([(0,g.F)("comment")],dv.prototype,"comments",void 0),function(f){f[f.Boolean=0]="Boolean",f[f.Float=1]="Float",f[f.Int=2]="Int",f[f.Vector2=3]="Vector2",f[f.List=4]="List",f[f.he=5]="he",f[f.SamplingMode=6]="SamplingMode",f[f.TextureFormat=7]="TextureFormat",f[f.TextureType=8]="TextureType"}(mv||(mv={})),function(f){f[f.None=0]="None",f[f.Position=1]="Position",f[f.Direction=2]="Direction",f[f.Age=3]="Age",f[f.Lifetime=4]="Lifetime",f[f.Color=5]="Color",f[f.ScaledDirection=6]="ScaledDirection",f[f.Scale=7]="Scale",f[f.AgeGradient=8]="AgeGradient",f[f.Angle=9]="Angle",f[f.SpriteCellIndex=16]="SpriteCellIndex",f[f.SpriteCellStart=17]="SpriteCellStart",f[f.SpriteCellEnd=18]="SpriteCellEnd"}(pv||(pv={})),function(f){f[f.None=0]="None",f[f.Time=1]="Time",f[f.Delta=2]="Delta",f[f.Emitter=3]="Emitter"}(kv||(kv={}));class Rv{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let f="";for(const v of this.notConnectedNonOptionalInputs)f+=`input ${v.name} from block ${v.ownerBlock.name}[${v.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(f)throw"Build of Node Particle System Set failed:\n"+f}adapt(f,v){const Z=f.getConnectedValue(this)||0;if(f.type===v)return Z;switch(v){case jv.Vector2:return new V.Vector2(Z,Z);case jv.Xv:return new V.Xv(Z,Z,Z);case jv.he:return new l.he(Z,Z,Z,Z)}return null}getContextualValue(f){if(!this.particleContext||!this.systemContext)return null;switch(f){case pv.Position:return this.particleContext.position;case pv.Direction:return this.particleContext.direction;case pv.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case pv.Color:return this.particleContext.color;case pv.Age:return this.particleContext.age;case pv.Lifetime:return this.particleContext.lifeTime;case pv.Angle:return this.particleContext.angle;case pv.Scale:return this.particleContext.scale;case pv.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case pv.SpriteCellEnd:return this.systemContext.endSpriteCellID;case pv.SpriteCellIndex:return this.particleContext.cellIndex;case pv.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.hv.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.hv.absolutePosition:this.systemContext.hv:null}getSystemValue(f){if(!this.particleContext||!this.systemContext)return null;switch(f){case kv.Time:return this.systemContext._actualFrame;case kv.Delta:return this.systemContext._scaledUpdateSpeed;case kv.Emitter:if(this.isEmitterTransformNode){return this.systemContext.hv.absolutePosition}return this.systemContext.hv}return null}}function nv(f,v,Z){const V=new Rv;V.Uv=v;const h=f.createSystem(V);return h.canStart=()=>!0,h.hv=Z.clone(),h.disposeOnStop=!0,h.start(),h}class Sv extends dv{constructor(f){super(f),this.blendMode=C.BLENDMODE_ONEONE,this.Ne=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",jv.Particle),this.registerInput("texture",jv.Texture),this.registerInput("onStart",jv.System,!0),this.registerInput("onEnd",jv.System,!0),this.registerOutput("system",jv.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(f){f.Ne=this.Ne,f.buildId=this._buildId++,this.build(f);const v=this.particle.getConnectedValue(f);return v.particleTexture=this.texture.getConnectedValue(f),v.emitRate=this.emitRate,v.blendMode=this.blendMode,v.name=this.name,v._nodeGenerated=!0,v._targetStopDuration=this.targetStopDuration,v.startDelay=this.startDelay,this.system._storedValue=this,v.canStart=()=>!this.doNoStart,v.onStartedObservable.add((Z=>{const V=this.onStart.getConnectedValue(f);V&&Z.onStartedObservable.addOnce((()=>{f.systemContext=v;const Z=nv(V,f.Uv,f.emitterPosition);this.Kh.addOnce((()=>{Z.dispose()}))}));const h=this.onEnd.getConnectedValue(f);h&&Z.onStoppedObservable.addOnce((()=>{f.systemContext=v;const Z=nv(h,f.Uv,f.emitterPosition);this.Kh.addOnce((()=>{Z.dispose()}))}))})),this.Kh.addOnce((()=>{v.dispose()})),v}serialize(){const f=super.serialize();return f.Ne=this.Ne,f.emitRate=this.emitRate,f.blendMode=this.blendMode,f.doNoStart=this.doNoStart,f.targetStopDuration=this.targetStopDuration,f.startDelay=this.startDelay,f}_deserialize(f){super._deserialize(f),this.Ne=f.Ne,this.emitRate=f.emitRate,this.doNoStart=!!f.doNoStart,void 0!==f.blendMode&&(this.blendMode=f.blendMode),void 0!==f.targetStopDuration&&(this.targetStopDuration=f.targetStopDuration),void 0!==f.startDelay&&(this.startDelay=f.startDelay)}}(0,P.d)([xv("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:C.BLENDMODE_ONEONE},{label:"Standard",value:C.BLENDMODE_STANDARD},{label:"Add",value:C.BLENDMODE_ADD},{label:"Multiply",value:C.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:C.BLENDMODE_MULTIPLYADD}]})],Sv.prototype,"blendMode",void 0),(0,P.d)([xv("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Sv.prototype,"Ne",void 0),(0,P.d)([xv("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sv.prototype,"emitRate",void 0),(0,P.d)([xv("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sv.prototype,"targetStopDuration",void 0),(0,P.d)([xv("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sv.prototype,"startDelay",void 0),(0,P.d)([xv("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Sv.prototype,"doNoStart",void 0),(0,e.h)("BABYLON.SystemBlock",Sv);class Dv extends dv{get type(){if(this._type===jv.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=jv.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=jv.Vector2,this._type;case"Xv":return this._type=jv.Xv,this._type;case"he":return this._type=jv.he,this._type;case"Matrix":return this._type=jv.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===pv.None&&this._systemSource!==kv.None}get systemSource(){return this._systemSource}set systemSource(f){if(this._systemSource=f,f!==kv.None){switch(this._contextualSource=pv.None,this._type=jv.Float,f){case kv.Time:case kv.Delta:this._type=jv.Float;break;case kv.Emitter:this._type=jv.Xv}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==pv.None}get contextualValue(){return this._contextualSource}set contextualValue(f){if(this._contextualSource=f,f!==pv.None){switch(this._systemSource=kv.None,f){case pv.Scale:this._type=jv.Vector2;break;case pv.Position:case pv.Direction:case pv.ScaledDirection:this._type=jv.Xv;break;case pv.Color:this._type=jv.he;break;case pv.Age:case pv.Lifetime:case pv.Angle:case pv.AgeGradient:this._type=jv.Float;break;case pv.SpriteCellEnd:case pv.SpriteCellStart:case pv.SpriteCellIndex:this._type=jv.Int}this.output&&(this.output.type=this._type)}}constructor(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jv.AutoDetect;super(f),this._type=jv.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new R.c,this._systemSource=kv.None,this._contextualSource=pv.None,this._type=v,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",v)}get value(){return this._storedValue}set value(f){this.type===jv.Float&&this.min!==this.max&&(f=Math.max(this.min,f),f=Math.min(this.max,f)),this._storedValue=f,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(f){this._valueCallback=f}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case jv.Int:case jv.Float:this.value=0;break;case jv.Vector2:this.value=V.Vector2.Zero();break;case jv.Xv:this.value=V.Xv.Zero();break;case jv.he:this.value=new l.he(1,1,1,1);break;case jv.Matrix:this.value=V.Matrix.Identity()}}_build(f){super._build(f),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=f=>f.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=f=>f.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const f=super.serialize();return f.type=this.type,f.contextualValue=this.contextualValue,f.systemSource=this.systemSource,f.min=this.min,f.max=this.max,f.groupInInspector=this.groupInInspector,f.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ph?(f.valueType="BABYLON."+this._storedValue.getClassName(),f.value=this._storedValue.Ph()):(f.valueType="number",f.value=this._storedValue)),f}_deserialize(f){if(super._deserialize(f),this._type=f.type,this.contextualValue=f.contextualValue,this.systemSource=f.systemSource||kv.None,this.min=f.min||0,this.max=f.max||0,this.groupInInspector=f.groupInInspector||"",void 0!==f.displayInInspector&&(this.displayInInspector=f.displayInInspector),f.valueType)if("number"===f.valueType)this._storedValue=f.value;else{const v=(0,e.e)(f.valueType);v&&(this._storedValue=v.Av(f.value))}}}(0,e.h)("BABYLON.ParticleInputBlock",Dv);class fZ extends dv{get url(){return this._url}set url(f){this._url!==f&&(this._cachedData=null,this._url=f,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(f){this._textureDataUrl!==f&&(this._cachedData=null,this._textureDataUrl=f,this._url="",this._sourceTexture=null)}set sourceTexture(f){this._sourceTexture!==f&&(this._cachedData=null,this._sourceTexture=f,this._url="",this._textureDataUrl="")}constructor(f){super(f),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",jv.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const f=this.texture._storedValue;return await new Promise(((v,Z)=>{if(!f.isReady())return void f.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),v(this._cachedData)}catch(f){Z(f)}}));const V=f.getSize();gv.o.GetTextureDataAsync(f,V.width,V.height).then((Z=>{this._cachedData={width:V.width,height:V.height,data:new Uint8ClampedArray(Z)},f.dispose(),v(this._cachedData)})).catch(Z)}))}_build(f){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new t.e(this._textureDataUrl,f.Uv):this.texture._storedValue=new t.e(this._url,f.Uv):this.texture._storedValue=null}serialize(){const f=super.serialize();return f.url=this.url,f.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(f.textureDataUrl=this.textureDataUrl),f}_deserialize(f){super._deserialize(f),this.url=f.url,this.serializedCachedData=!!f.serializedCachedData,f.textureDataUrl&&(this.textureDataUrl=f.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,e.h)("BABYLON.ParticleTextureSourceBlock",fZ);class vZ extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("position",jv.Xv),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(f){const v=this.particle.getConnectedValue(f);if(this.output._storedValue=v,!this.position.isConnected)return;const Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.position.h(this.position.getConnectedValue(f))},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z}}(0,e.h)("BABYLON.UpdatePositionBlock",vZ),function(f){f[f.Add=0]="Add",f[f.Subtract=1]="Subtract",f[f.Multiply=2]="Multiply",f[f.Divide=3]="Divide",f[f.Max=4]="Max",f[f.Min=5]="Min"}(rv||(rv={}));class ZZ extends dv{constructor(f){super(f),this.operation=rv.Add,this.registerInput("left",jv.AutoDetect),this.registerInput("right",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this.output._typeConnectionSource=this.left;const v=[jv.Matrix,jv.Particle,jv.Texture,jv.System,jv.FloatGradient,jv.Color4Gradient,jv.Vector2Gradient,jv.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...v),this.right.excludedConnectionPointTypes.push(...v),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(f){let v;const Z=this.left,h=this.right;if(!Z.isConnected||!h.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const J=Z.type===jv.Float||Z.type===jv.Int,e=h.type===jv.Float||h.type===jv.Int,C=J&&e;switch(this.operation){case rv.Add:v=C?f=>Z.getConnectedValue(f)+h.getConnectedValue(f):J?f=>f.adapt(Z,h.type).add(h.getConnectedValue(f)):f=>Z.getConnectedValue(f).add(f.adapt(h,Z.type));break;case rv.Subtract:v=C?f=>Z.getConnectedValue(f)-h.getConnectedValue(f):J?f=>f.adapt(Z,h.type).Fv(h.getConnectedValue(f)):f=>Z.getConnectedValue(f).Fv(f.adapt(h,Z.type));break;case rv.Multiply:v=C?f=>Z.getConnectedValue(f)*h.getConnectedValue(f):J?f=>f.adapt(Z,h.type).multiply(h.getConnectedValue(f)):f=>Z.getConnectedValue(f).multiply(f.adapt(h,Z.type));break;case rv.Divide:v=C?f=>Z.getConnectedValue(f)/h.getConnectedValue(f):J?f=>f.adapt(Z,h.type).divide(h.getConnectedValue(f)):f=>Z.getConnectedValue(f).divide(f.adapt(h,Z.type));break;case rv.Min:if(C)v=f=>Math.min(Z.getConnectedValue(f),h.getConnectedValue(f));else{const[f,e]=J?[h,Z]:[Z,h];switch(f.type){case jv.Vector2:v=v=>V.Vector2.Minimize(f.getConnectedValue(v),v.adapt(e,f.type));break;case jv.Xv:v=v=>V.Xv.Minimize(f.getConnectedValue(v),v.adapt(e,f.type));break;case jv.he:v=v=>{const Z=f.getConnectedValue(v),{r:V,g:h,b:J,a:C}=v.adapt(e,f.type);return new l.he(Math.min(Z.r,V),Math.min(Z.g,h),Math.min(Z.b,J),Math.min(Z.a,C))}}}break;case rv.Max:if(!C){const[f,e]=J?[h,Z]:[Z,h];switch(f.type){case jv.Vector2:v=v=>V.Vector2.Maximize(f.getConnectedValue(v),v.adapt(e,f.type));break;case jv.Xv:v=v=>V.Xv.Maximize(f.getConnectedValue(v),v.adapt(e,f.type));break;case jv.he:v=v=>{const Z=f.getConnectedValue(v),{r:V,g:h,b:J,a:C}=v.adapt(e,f.type);return new l.he(Math.max(Z.r,V),Math.min(Z.g,h),Math.min(Z.b,J),Math.min(Z.a,C))}}break}v=f=>Math.max(Z.getConnectedValue(f),h.getConnectedValue(f))}this.output._storedFunction=f=>Z.type===jv.Int?0|v(f):v(f)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===jv.Int||this.left.type===jv.Float&&this.right.type!==jv.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[f,v]of[[this.left,this.right],[this.right,this.left]])f.acceptedConnectionPointTypes=[jv.Int,jv.Float],v.isConnected&&(f.acceptedConnectionPointTypes.push(v.type),v.type!==jv.Int&&v.type!==jv.Float||f.acceptedConnectionPointTypes.push(jv.Vector2,jv.Xv,jv.he))}dispose(){super.dispose();for(const f of this._connectionObservers)f.remove();this._connectionObservers.length=0}serialize(){const f=super.serialize();return f.operation=this.operation,f}_deserialize(f){super._deserialize(f),this.operation=f.operation}}(0,P.d)([xv("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:rv.Add},{label:"Subtract",value:rv.Subtract},{label:"Multiply",value:rv.Multiply},{label:"Divide",value:rv.Divide},{label:"Max",value:rv.Max},{label:"Min",value:rv.Min}]})],ZZ.prototype,"operation",void 0),(0,e.h)("BABYLON.ParticleMathBlock",ZZ);class VZ extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("direction1",jv.Xv,!0,new V.Xv(0,1,0)),this.registerInput("direction2",jv.Xv,!0,new V.Xv(0,1,0)),this.registerInput("minEmitBox",jv.Xv,!0,new V.Xv(-.5,-.5,-.5)),this.registerInput("maxEmitBox",jv.Xv,!0,new V.Xv(.5,.5,.5)),this.registerOutput("output",jv.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(f){const v=this.particle.getConnectedValue(f);v._directionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.direction1.getConnectedValue(f),J=this.direction2.getConnectedValue(f),l=(0,H.RandomRange)(h.x,J.x),e=(0,H.RandomRange)(h.y,J.y),C=(0,H.RandomRange)(h.z,J.z);f.isEmitterTransformNode?V.Xv.TransformNormalFromFloatsToRef(l,e,C,f.emitterWorldMatrix,Z.direction):Z.direction.fe(l,e,C)},v._positionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.minEmitBox.getConnectedValue(f),J=this.maxEmitBox.getConnectedValue(f),l=(0,H.RandomRange)(h.x,J.x),e=(0,H.RandomRange)(h.y,J.y),C=(0,H.RandomRange)(h.z,J.z);f.isEmitterTransformNode?V.Xv.TransformCoordinatesFromFloatsToRef(l,e,C,f.emitterWorldMatrix,Z.position):(Z.position.fe(l,e,C),Z.position.addInPlace(f.emitterPosition))},this.output._storedValue=v}}(0,e.h)("BABYLON.BoxShapeBlock",VZ);class hZ extends dv{constructor(f){super(f),this.registerInput("emitPower",jv.Float,!0,1),this.registerInput("lifeTime",jv.Float,!0,1),this.registerInput("color",jv.he,!0,new l.he(1,1,1,1)),this.registerInput("scale",jv.Vector2,!0,new V.Vector2(1,1)),this.registerInput("angle",jv.Float,!0,0),this.registerOutput("particle",jv.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(f){const v=new Cv(this.name,f.Ne,f.Uv,null,!1,void 0,!0);v.particleEmitterType=new U,v._lifeTimeCreation.process=(v,Z)=>{f.particleContext=v,v.lifeTime=this.lifeTime.getConnectedValue(f),Z._emitPower=this.emitPower.getConnectedValue(f)},v._colorCreation.process=v=>{f.particleContext=v,v.color.h(this.color.getConnectedValue(f))},v._sizeCreation.process=v=>{f.particleContext=v,v.size=1,v.scale.h(this.scale.getConnectedValue(f))},v._angleCreation.process=v=>{f.particleContext=v,v.angle=this.angle.getConnectedValue(f)},this.particle._storedValue=v}}(0,e.h)("BABYLON.CreateParticleBlock",hZ);class JZ{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const f=[];for(const v of this.attachedBlocks)v.isInput&&f.push(v);return f}constructor(f){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new R.c,this.name=f}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(f)&&this.attachedBlocks.push(f);for(const Z of f.inputs){const V=Z.connectedPoint;if(V){const Z=V.ownerBlock;Z!==f&&this._initializeBlock(Z,v)}}}async buildAsync(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Z=>{const V=new yv;for(const f of this._systemBlocks)this._initializeBlock(f);for(const h of this.systemBlocks){const Z=new Rv;Z.buildId=this._buildId++,Z.Uv=f,Z.verbose=v;const J=h.createSystem(Z);Z.emitErrors(),V.systems.push(J)}this.onBuildObservable.notifyObservers(this),Z(V)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const f=new Sv("Particle system"),v=new vZ("Update position");v.output.connectTo(f.particle);const Z=new Dv("Position");Z.contextualValue=pv.Position;const V=new Dv("Scaled direction");V.contextualValue=pv.ScaledDirection;const h=new ZZ("Add");h.operation=rv.Add,Z.output.connectTo(h.left),V.output.connectTo(h.right),h.output.connectTo(v.position);const J=new hZ("Create particle"),l=new VZ("Box shape");J.particle.connectTo(l.particle),l.output.connectTo(v.particle);const e=new fZ("Texture");e.texture.connectTo(f.texture),e.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(f)}removeBlock(f){const v=this.attachedBlocks.indexOf(f);if(v>-1&&this.attachedBlocks.splice(v,1),f.isSystem){const v=this._systemBlocks.indexOf(f);v>-1&&this._systemBlocks.splice(v,1)}}parseSerializedObject(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v||this.clear();const Z={};for(const V of f.MO){const f=(0,e.e)(V.customType);if(f){const v=new f;v._deserialize(V),Z[V.id]=v,this.attachedBlocks.push(v),v.isSystem&&this._systemBlocks.push(v)}}for(const V of this.attachedBlocks)if(V.isTeleportOut){const f=V,v=f._tempEntryPointUniqueId;if(v){const V=Z[v];V&&V.attachToEndpoint(f)}}for(let V=0;V<f.MO.length;V++){const h=f.MO[V],J=Z[h.id];J&&(J.inputs.length&&h.inputs.some((f=>f.targetConnectionName))&&!v||this._restoreConnections(J,f,Z))}if(f.locations||f.editorData&&f.editorData.locations){const V=f.locations||f.editorData.locations;for(const f of V)Z[f.fh]&&(f.fh=Z[f.fh].uniqueId);v&&this.editorData&&this.editorData.locations&&V.concat(this.editorData.locations),f.locations?this.editorData={locations:V}:(this.editorData=f.editorData,this.editorData.locations=V);const h=[];for(const f in Z)h[f]=Z[f].uniqueId;this.editorData.map=h}this.comment=f.comment}_restoreConnections(f,v,Z){for(const V of f.outputs)for(const h of v.MO){const J=Z[h.id];if(J)for(const l of h.inputs)if(Z[l.targetBlockId]!==f||l.targetConnectionName!==V.name);else{const f=J.getInputByName(l.inputName);if(!f||f.isConnected)continue;V.connectTo(f,!0),this._restoreConnections(J,v,Z)}}}serialize(f){const v=f?{}:w.b.Serialize(this);v.editorData=JSON.parse(JSON.stringify(this.editorData));let Z=[];f?Z=f:v.customType="BABYLON.NodeParticleSystemSet",v.MO=[];for(const V of Z)v.MO.push(V.serialize());if(!f)for(const V of this.attachedBlocks)-1===Z.indexOf(V)&&v.MO.push(V.serialize());return v}dispose(){for(const f of this.attachedBlocks)f.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(f){const v=new JZ(f);return v.setToDefault(),v}static Parse(f){const v=w.b.Parse((()=>new JZ(f.name)),f,null);return v.parseSerializedObject(f),v}static ParseFromSnippetAsync(f,v){return"_BLANK"===f?Promise.resolve(JZ.CreateDefault("blank")):new Promise(((Z,V)=>{const h=new Nv.c;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const l=JSON.parse(JSON.parse(h.responseText).jsonPayload),e=JSON.parse(l.nodeParticle);v||(v=w.b.Parse((()=>new JZ(f)),e,null)),v.parseSerializedObject(e),v.snippetId=f;try{Z(v)}catch(J){V(J)}}else V("Unable to load the snippet "+f)})),h.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),h.send()}))}}JZ.EditorURL=`${sv.Tools._DefaultCdnUrl}/v${xf.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,JZ.SnippetUrl="https://snippet.babylonjs.com",(0,P.d)([(0,g.F)()],JZ.prototype,"name",void 0),(0,P.d)([(0,g.F)("comment")],JZ.prototype,"comment",void 0),function(f){f[f.None=0]="None",f[f.PerParticle=1]="PerParticle",f[f.PerSystem=2]="PerSystem"}(ov||(ov={}));class lZ extends dv{constructor(f){super(f),this._currentLockId=-2,this.lockMode=ov.PerParticle,this.registerInput("min",jv.AutoDetect,!0,0),this.registerInput("max",jv.AutoDetect,!0,1),this.registerOutput("output",jv.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jv.Float|jv.Int|jv.Vector2|jv.Xv|jv.he),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(jv.Float|jv.Int|jv.Vector2|jv.Xv|jv.he),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=jv.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let f=null;switch(this._currentLockId=-2,this.min.type){case jv.AutoDetect:case jv.Int:case jv.Float:f=f=>{const v=this.min.getConnectedValue(f)||0,Z=this.max.getConnectedValue(f)||1;return v+Math.random()*(Z-v)};break;case jv.Vector2:f=f=>{const v=this.min.getConnectedValue(f)||V.Vector2.Zero(),Z=this.max.getConnectedValue(f)||V.Vector2.One();return new V.Vector2(v.x+Math.random()*(Z.x-v.x),v.y+Math.random()*(Z.y-v.y))};break;case jv.Xv:f=f=>{const v=this.min.getConnectedValue(f)||V.Xv.Zero(),Z=this.max.getConnectedValue(f)||V.Xv.One();return new V.Xv(v.x+Math.random()*(Z.x-v.x),v.y+Math.random()*(Z.y-v.y),v.z+Math.random()*(Z.z-v.z))};break;case jv.he:f=f=>{const v=this.min.getConnectedValue(f)||new l.he(0,0,0,0),Z=this.max.getConnectedValue(f)||new l.he(1,1,1,1);return new l.he(v.x+Math.random()*(Z.x-v.x),v.y+Math.random()*(Z.y-v.y),v.z+Math.random()*(Z.z-v.z),v.w+Math.random()*(Z.w-v.w))}}this.output._storedFunction=v=>{var Z;let V=0;switch(this.lockMode){case ov.PerParticle:V=(null===(Z=v.particleContext)||void 0===Z?void 0:Z.id)||-1;break;case ov.PerSystem:V=v.buildId||0}return this._currentLockId!==V&&(this.lockMode!==ov.None&&(this._currentLockId=V),this.output._storedValue=f(v)),this.output._storedValue}}serialize(){const f=super.serialize();return f.lockMode=this.lockMode,f}_deserialize(f){super._deserialize(f),this.lockMode=f.lockMode}}(0,P.d)([xv("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ov.None},{label:"Per particle",value:ov.PerParticle},{label:"Per system",value:ov.PerSystem}]})],lZ.prototype,"lockMode",void 0),(0,e.h)("BABYLON.ParticleRandomBlock",lZ);class eZ extends dv{constructor(f){super(f),this._currentLockId=-2,this.lockMode=ov.PerParticle,this.registerInput("min",jv.AutoDetect),this.registerInput("max",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const v=[jv.Matrix,jv.Particle,jv.Texture,jv.System,jv.FloatGradient,jv.Color4Gradient,jv.Vector2Gradient,jv.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...v),this.max.excludedConnectionPointTypes.push(...v)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let f=null;switch(this._currentLockId=-2,this.min.type){case jv.Float:case jv.Int:f=f=>{const v=this.min.getConnectedValue(f),Z=this.max.getConnectedValue(f);return Math.random()*(Z-v)+v};break;case jv.Vector2:f=f=>{const v=this.min.getConnectedValue(f),Z=this.max.getConnectedValue(f);return new V.Vector2(Math.random()*(Z.x-v.x)+v.x,Math.random()*(Z.y-v.y)+v.y)};break;case jv.Xv:f=f=>{const v=this.min.getConnectedValue(f),Z=this.max.getConnectedValue(f);return new V.Xv(Math.random()*(Z.x-v.x)+v.x,Math.random()*(Z.y-v.y)+v.y,Math.random()*(Z.z-v.z)+v.z)};break;case jv.he:f=f=>{const v=this.min.getConnectedValue(f),Z=this.max.getConnectedValue(f);return new l.he(Math.random()*(Z.r-v.r)+v.r,Math.random()*(Z.g-v.g)+v.g,Math.random()*(Z.b-v.b)+v.b,Math.random()*(Z.a-v.a)+v.a)}}this.output._storedFunction=v=>{var Z;let V=0;switch(this.lockMode){case ov.PerParticle:V=(null===(Z=v.particleContext)||void 0===Z?void 0:Z.id)||-1;break;case ov.PerSystem:V=v.buildId||0}return this._currentLockId!==V&&(this.lockMode!==ov.None&&(this._currentLockId=V),this.output._storedValue=f(v)),this.output._storedValue}}serialize(){const f=super.serialize();return f.lockMode=this.lockMode,f}_deserialize(f){super._deserialize(f),void 0!==f.lockMode&&(this.lockMode=f.lockMode)}}(0,P.d)([xv("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ov.None},{label:"Per particle",value:ov.PerParticle},{label:"Per system",value:ov.PerSystem}]})],eZ.prototype,"lockMode",void 0),(0,e.h)("BABYLON.RandomRangeBlock",eZ);(0,e.h)("BABYLON.ParticleLerpBlock",class extends dv{constructor(f){super(f),this.registerInput("left",jv.AutoDetect),this.registerInput("right",jv.AutoDetect),this.registerInput("gradient",jv.Float,!0,0,0,1),this.registerOutput("output",jv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jv.Float|jv.Int|jv.Vector2|jv.Xv|jv.he)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const f=(f,v,Z)=>(1-f)*v+f*Z;this.output._storedFunction=v=>{const Z=this.left.getConnectedValue(v),h=this.right.getConnectedValue(v),J=this.gradient.getConnectedValue(v);switch(this.left.type){case jv.Int:case jv.Float:return f(J,Z,h);case jv.Vector2:return new V.Vector2(f(J,Z.x,h.x),f(J,Z.y,h.y));case jv.Xv:return new V.Xv(f(J,Z.x,h.x),f(J,Z.y,h.y),f(J,Z.z,h.z));case jv.he:return new l.he(f(J,Z.r,h.r),f(J,Z.g,h.g),f(J,Z.b,h.b),f(J,Z.a,h.a))}return 0}}});(0,e.h)("BABYLON.UpdateDirectionBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("direction",jv.Xv),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(f){const v=this.particle.getConnectedValue(f);if(this.output._storedValue=v,!this.direction.isConnected)return;const Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.direction.h(this.direction.getConnectedValue(f))},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z}});(0,e.h)("BABYLON.UpdateColorBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("color",jv.he),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(f){const v=this.particle.getConnectedValue(f);if(this.output._storedValue=v,!this.color.isConnected)return;const Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.color.h(this.color.getConnectedValue(f))},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z}});(0,e.h)("BABYLON.UpdateScaleBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("scale",jv.Vector2),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(f){const v=this.particle.getConnectedValue(f);if(this.output._storedValue=v,!this.scale.isConnected)return;const Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.scale.h(this.scale.getConnectedValue(f))},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z}});(0,e.h)("BABYLON.UpdateAngleBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("angle",jv.Float),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(f){const v=this.particle.getConnectedValue(f);if(this.output._storedValue=v,!this.angle.isConnected)return;const Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.angle=this.angle.getConnectedValue(f)},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z}});(0,e.h)("BABYLON.BasicPositionUpdateBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(f){const v=this.particle.getConnectedValue(f),Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.direction.scaleToRef(v._directionScale,v._scaledDirection),Z.position.addInPlace(v._scaledDirection)},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z,this.output._storedValue=v}});(0,e.h)("BABYLON.BasicSpriteUpdateBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(f){const v=this.particle.getConnectedValue(f),Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.updateCellIndex()},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z,this.output._storedValue=v}});(0,e.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("cellIndex",jv.Int),this.registerOutput("output",jv.Particle),this.cellIndex.acceptedConnectionPointTypes=[jv.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(f){const v=this.particle.getConnectedValue(f);if(this.output._storedValue=v,!this.cellIndex.isConnected)return;const Z={process:Z=>{f.particleContext=Z,f.systemContext=v,Z.cellIndex=Math.floor(this.cellIndex.getConnectedValue(f))},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z}});class CZ extends dv{constructor(f){super(f),this.strength=1,this.registerInput("particle",jv.Particle),this.registerInput("flowMap",jv.Texture),this.registerOutput("output",jv.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(f){var v;const Z=this.particle.getConnectedValue(f),V=f.Uv;let h;(null===(v=this.flowMap.connectedPoint)||void 0===v?void 0:v.ownerBlock).extractTextureContentAsync().then((f=>{f&&(h=new Ev(f.width,f.height,f.data))}));const J={process:f=>{const v=V.getTransformMatrix();h&&h._processParticle(f,this.strength*Z._tempScaledUpdateSpeed,v)},previousItem:null,nextItem:null};Z._updateQueueStart?kf(J,Z._updateQueueStart):Z._updateQueueStart=J,this.output._storedValue=Z}serialize(){const f=super.serialize();return f.strength=this.strength,f}_deserialize(f){super._deserialize(f),this.strength=f.strength}}(0,P.d)([xv("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CZ.prototype,"strength",void 0),(0,e.h)("BABYLON.UpdateFlowMapBlock",CZ);(0,e.h)("BABYLON.SphereShapeBlock",class extends dv{constructor(f){super(f),this.registerInput("input",jv.Particle),this.registerInput("radius",jv.Float,!0,1),this.registerInput("radiusRange",jv.Float,!0,1,0,1),this.registerInput("directionRandomizer",jv.Float,!0,0,0,1),this.registerOutput("output",jv.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(f){const v=this.input.getConnectedValue(f);v._directionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.directionRandomizer.getConnectedValue(f),J=Z.position.Fv(f.emitterPosition).normalize(),l=(0,H.RandomRange)(0,h),e=(0,H.RandomRange)(0,h),C=(0,H.RandomRange)(0,h);J.x+=l,J.y+=e,J.z+=C,J.normalize(),f.isEmitterTransformNode?V.Xv.TransformNormalFromFloatsToRef(l,e,C,f.emitterWorldMatrix,Z.direction):Z.direction.fe(l,e,C)},v._positionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.radius.getConnectedValue(f),J=this.radiusRange.getConnectedValue(f),l=h-(0,H.RandomRange)(0,h*J),e=(0,H.RandomRange)(0,1),C=(0,H.RandomRange)(0,2*Math.PI),O=Math.acos(2*e-1),u=l*Math.cos(C)*Math.sin(O),W=l*Math.cos(O),a=l*Math.sin(C)*Math.sin(O);f.isEmitterTransformNode?V.Xv.TransformCoordinatesFromFloatsToRef(u,W,a,f.emitterWorldMatrix,Z.position):(Z.position.fe(u,W,a),Z.position.addInPlace(f.emitterPosition))},this.output._storedValue=v}});(0,e.h)("BABYLON.PointShapeBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("direction1",jv.Xv,!0,new V.Xv(0,1,0)),this.registerInput("direction2",jv.Xv,!0,new V.Xv(0,1,0)),this.registerOutput("output",jv.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(f){const v=this.particle.getConnectedValue(f);v._directionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.direction1.getConnectedValue(f),J=this.direction2.getConnectedValue(f),l=(0,H.RandomRange)(h.x,J.x),e=(0,H.RandomRange)(h.y,J.y),C=(0,H.RandomRange)(h.z,J.z);f.isEmitterTransformNode?V.Xv.TransformNormalFromFloatsToRef(l,e,C,f.emitterWorldMatrix,Z.direction):Z.direction.fe(l,e,C)},v._positionCreation.process=Z=>{f.systemContext=v,f.isEmitterTransformNode?V.Xv.TransformCoordinatesFromFloatsToRef(0,0,0,f.emitterWorldMatrix,Z.position):Z.position.h(f.emitterPosition)},this.output._storedValue=v}});(0,e.h)("BABYLON.CustomShapeBlock",class extends dv{constructor(f){super(f),this.registerInput("particle",jv.Particle),this.registerInput("position",jv.Xv,!0,new V.Xv(0,0,0)),this.registerInput("direction",jv.Xv,!0,new V.Xv(0,1,0)),this.registerOutput("output",jv.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(f){const v=this.particle.getConnectedValue(f);v._directionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.direction.getConnectedValue(f);f.isEmitterTransformNode?V.Xv.TransformNormalToRef(h,f.emitterWorldMatrix,Z.direction):Z.direction.h(h)},v._positionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.position.getConnectedValue(f);f.isEmitterTransformNode?V.Xv.TransformCoordinatesToRef(h,f.emitterWorldMatrix,Z.position):(Z.position.h(h),Z.position.addInPlace(f.emitterPosition))},this.output._storedValue=v}});(0,e.h)("BABYLON.CylinderShapeBlock",class extends dv{constructor(f){super(f),this._tempVector=V.Xv.Zero(),this.registerInput("particle",jv.Particle),this.registerInput("radius",jv.Float,!0,1),this.registerInput("height",jv.Float,!0,1,0),this.registerInput("radiusRange",jv.Float,!0,1,0,1),this.registerInput("directionRandomizer",jv.Float,!0,0,0,1),this.registerOutput("output",jv.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(f){const v=this.particle.getConnectedValue(f);v._directionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.directionRandomizer.getConnectedValue(f);Z.position.subtractToRef(f.emitterPosition,this._tempVector),this._tempVector.normalize(),f.isEmitterTransformNode&&V.Xv.TransformNormalToRef(this._tempVector,f.emitterInverseWorldMatrix,this._tempVector);const J=(0,H.RandomRange)(-h/2,h/2);let l=Math.atan2(this._tempVector.x,this._tempVector.z);l+=(0,H.RandomRange)(-Math.PI/2,Math.PI/2)*h,this._tempVector.y=J,this._tempVector.x=Math.sin(l),this._tempVector.z=Math.cos(l),this._tempVector.normalize(),f.isEmitterTransformNode?V.Xv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,f.emitterWorldMatrix,Z.direction):Z.direction.h(this._tempVector)},v._positionCreation.process=Z=>{f.particleContext=Z,f.systemContext=v;const h=this.height.getConnectedValue(f),J=this.radiusRange.getConnectedValue(f),l=this.radius.getConnectedValue(f),e=(0,H.RandomRange)(-h/2,h/2),C=(0,H.RandomRange)(0,2*Math.PI),O=(0,H.RandomRange)((1-J)*(1-J),1),u=Math.sqrt(O)*l,W=u*Math.cos(C),a=u*Math.sin(C);f.isEmitterTransformNode?V.Xv.TransformCoordinatesFromFloatsToRef(W,e,a,f.emitterWorldMatrix,Z.position):(Z.position.fe(W,e,a),Z.position.addInPlace(f.emitterPosition))},this.output._storedValue=v}});class HZ extends dv{constructor(f){super(f),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",jv.Particle),this.registerOutput("output",jv.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(f){super._build(f);const v=this.particle.getConnectedValue(f);v._isAnimationSheetEnabled=!0,v.spriteCellWidth=this.width,v.spriteCellHeight=this.height,v.startSpriteCellID=this.start,v.endSpriteCellID=this.end,v.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=v}serialize(){const f=super.serialize();return f.width=this.width,f.height=this.height,f.start=this.start,f.end=this.end,f.randomStartCell=this.randomStartCell,f}_deserialize(f){super._deserialize(f),this.width=f.width,this.height=f.height,this.start=f.start,this.end=f.end,this.randomStartCell=f.randomStartCell}}(0,P.d)([xv("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HZ.prototype,"start",void 0),(0,P.d)([xv("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HZ.prototype,"end",void 0),(0,P.d)([xv("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HZ.prototype,"width",void 0),(0,P.d)([xv("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HZ.prototype,"height",void 0),(0,P.d)([xv("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HZ.prototype,"loop",void 0),(0,P.d)([xv("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HZ.prototype,"randomStartCell",void 0),(0,e.h)("BABYLON.SetupSpriteSheetBlock",HZ);class OZ extends dv{constructor(f){super(f),this.reference=0,this.registerInput("value",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=f=>{switch(f){case jv.Float:return jv.FloatGradient;case jv.Vector2:return jv.Vector2Gradient;case jv.Xv:return jv.Vector3Gradient;case jv.he:return jv.Color4Gradient}return f},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jv.Float|jv.Vector2|jv.Xv|jv.he)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=f=>null}serialize(){const f=super.serialize();return f.reference=this.reference,f}_deserialize(f){super._deserialize(f),this.reference=f.reference}}(0,P.d)([xv("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],OZ.prototype,"reference",void 0),(0,e.h)("BABYLON.ParticleGradientValueBlock",OZ);(0,e.h)("BABYLON.ParticleGradientBlock",class extends dv{constructor(f){super(f),this._entryCount=1,this.registerInput("gradient",jv.Float,!0,1,0,1),this.registerInput("value0",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=f=>{switch(f){case jv.FloatGradient:return jv.Float;case jv.Vector2Gradient:return jv.Vector2;case jv.Vector3Gradient:return jv.Xv;case jv.Color4Gradient:return jv.he}return f},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(jv.FloatGradient|jv.Vector2Gradient|jv.Vector3Gradient|jv.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(f){this._inputs[f].onConnectionObservable.add((()=>{this._entryCount>f||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),jv.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const f=[];for(let Z=1;Z<this._inputs.length;Z++){var v;if(this._inputs[Z].isConnected)f.push(null===(v=this._inputs[Z].connectedPoint)||void 0===v?void 0:v.ownerBlock)}f.sort(((f,v)=>f.reference-v.reference)),this.output._storedFunction=v=>{const Z=this.gradient.getConnectedValue(v);if(1===f.length)return f[0].value.getConnectedValue(v);let h=null;for(let J=f.length-1;J>=0;J--){const e=f[J];if(e.reference<=Z){const f=e.value.getConnectedValue(v);if(h){const J=h.value.getConnectedValue(v),C=h.reference,O=e.reference,u=Math.max(0,Math.min(1,(Z-O)/(C-O)));switch(this.output.type){case jv.Float:return(0,H.Lerp)(f,J,u);case jv.Vector2:return V.Vector2.Lerp(f,J,u);case jv.Xv:return V.Xv.Lerp(f,J,u);case jv.he:return l.he.Lerp(f,J,u)}}return f}h=e}return 0}}});(0,e.h)("BABYLON.ParticleConverterBlock",class extends dv{constructor(f){super(f),this.registerInput("color ",jv.he,!0),this.registerInput("xyz ",jv.Xv,!0),this.registerInput("xy ",jv.Vector2,!0),this.registerInput("zw ",jv.Vector2,!0),this.registerInput("x ",jv.Float,!0),this.registerInput("y ",jv.Float,!0),this.registerInput("z ",jv.Float,!0),this.registerInput("w ",jv.Float,!0),this.registerOutput("color",jv.he),this.registerOutput("xyz",jv.Xv),this.registerOutput("xy",jv.Vector2),this.registerOutput("zw",jv.Vector2),this.registerOutput("x",jv.Float),this.registerOutput("y",jv.Float),this.registerOutput("z",jv.Float),this.registerOutput("w",jv.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(f){return"color "===f?"colorIn":"xyz "===f?"xyzIn":"xy "===f?"xyIn":"zw "===f?"zwIn":"x "===f?"xIn":"y "===f?"yIn":"z "===f?"zIn":"w "===f?"wIn":f}_outputRename(f){switch(f){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return f}}_build(f){super._build(f);const v=this.xIn,Z=this.yIn,h=this.zIn,J=this.wIn,e=this.xyIn,C=this.zwIn,H=this.xyzIn,O=this.colorIn,u=this.colorOut,W=this.xyzOut,a=this.xyOut,b=this.zwOut,X=this.xOut,F=this.yOut,U=this.zOut,K=this.wOut,M=f=>{if(O.isConnected)return O.getConnectedValue(f);let V=0,u=0,W=0,a=0;if(v.isConnected&&(V=v.getConnectedValue(f)),Z.isConnected&&(u=Z.getConnectedValue(f)),h.isConnected&&(W=h.getConnectedValue(f)),J.isConnected&&(a=J.getConnectedValue(f)),e.isConnected){const v=e.getConnectedValue(f);v&&(V=v.x,u=v.y)}if(C.isConnected){const v=C.getConnectedValue(f);v&&(W=v.x,a=v.y)}if(H.isConnected){const v=H.getConnectedValue(f);v&&(V=v.x,u=v.y,W=v.z)}return new l.he(V,u,W,a)};u._storedFunction=f=>M(f),W._storedFunction=f=>{const v=M(f);return new V.Xv(v.r,v.g,v.b)},a._storedFunction=f=>{const v=M(f);return new V.Vector2(v.r,v.g)},b._storedFunction=f=>{const v=M(f);return new V.Vector2(v.b,v.a)},X._storedFunction=f=>M(f).r,F._storedFunction=f=>M(f).g,U._storedFunction=f=>M(f).b,K._storedFunction=f=>M(f).a}}),function(f){f[f.Cos=0]="Cos",f[f.Sin=1]="Sin",f[f.Abs=2]="Abs",f[f.Exp=3]="Exp",f[f.Exp2=4]="Exp2",f[f.Round=5]="Round",f[f.Floor=6]="Floor",f[f.Ceiling=7]="Ceiling",f[f.Sqrt=8]="Sqrt",f[f.Log=9]="Log",f[f.Tan=10]="Tan",f[f.ArcTan=11]="ArcTan",f[f.ArcCos=12]="ArcCos",f[f.ArcSin=13]="ArcSin",f[f.Sign=14]="Sign",f[f.Negate=15]="Negate",f[f.OneMinus=16]="OneMinus",f[f.Reciprocal=17]="Reciprocal",f[f.ToDegrees=18]="ToDegrees",f[f.ToRadians=19]="ToRadians",f[f.Fract=20]="Fract"}(Gv||(Gv={}));class uZ extends dv{constructor(f){super(f),this.operation=Gv.Cos,this.registerInput("input",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jv.Float|jv.Int|jv.Vector2|jv.Xv|jv.he)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(f){super._build(f);let v=null;switch(this.operation){case Gv.Cos:v=f=>Math.cos(f);break;case Gv.Sin:v=f=>Math.sin(f);break;case Gv.Abs:v=f=>Math.abs(f);break;case Gv.Exp:v=f=>Math.exp(f);break;case Gv.Exp2:v=f=>Math.pow(2,f);break;case Gv.Round:v=f=>Math.round(f);break;case Gv.Floor:v=f=>Math.floor(f);break;case Gv.Ceiling:v=f=>Math.ceil(f);break;case Gv.Sqrt:v=f=>Math.sqrt(f);break;case Gv.Log:v=f=>Math.log(f);break;case Gv.Tan:v=f=>Math.tan(f);break;case Gv.ArcTan:v=f=>Math.atan(f);break;case Gv.ArcCos:v=f=>Math.acos(f);break;case Gv.ArcSin:v=f=>Math.asin(f);break;case Gv.Sign:v=f=>Math.sign(f);break;case Gv.Negate:v=f=>-f;break;case Gv.OneMinus:v=f=>1-f;break;case Gv.Reciprocal:v=f=>1/f;break;case Gv.ToRadians:v=f=>f*Math.PI/180;break;case Gv.ToDegrees:v=f=>180*f/Math.PI;break;case Gv.Fract:v=f=>f>=0?f-Math.floor(f):f-Math.ceil(f)}if(!v)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case jv.Int:case jv.Float:this.output._storedFunction=f=>{const Z=this.input.getConnectedValue(f);return v(Z)};break;case jv.Vector2:this.output._storedFunction=f=>{const Z=this.input.getConnectedValue(f);return new V.Vector2(v(Z.x),v(Z.y))};break;case jv.Xv:this.output._storedFunction=f=>{const Z=this.input.getConnectedValue(f);return new V.Xv(v(Z.x),v(Z.y),v(Z.z))};break;case jv.he:this.output._storedFunction=f=>{const Z=this.input.getConnectedValue(f);return new l.he(v(Z.r),v(Z.g),v(Z.b),v(Z.a))}}return this}serialize(){const f=super.serialize();return f.operation=this.operation,f}_deserialize(f){super._deserialize(f),this.operation=f.operation}}(0,P.d)([xv("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Gv.Cos},{label:"Sin",value:Gv.Sin},{label:"Abs",value:Gv.Abs},{label:"Exp",value:Gv.Exp},{label:"Exp2",value:Gv.Exp2},{label:"Round",value:Gv.Round},{label:"Floor",value:Gv.Floor},{label:"Ceiling",value:Gv.Ceiling},{label:"Sqrt",value:Gv.Sqrt},{label:"Log",value:Gv.Log},{label:"Tan",value:Gv.Tan},{label:"ArcTan",value:Gv.ArcTan},{label:"ArcCos",value:Gv.ArcCos},{label:"ArcSin",value:Gv.ArcSin},{label:"Sign",value:Gv.Sign},{label:"Negate",value:Gv.Negate},{label:"OneMinus",value:Gv.OneMinus},{label:"Reciprocal",value:Gv.Reciprocal},{label:"ToDegrees",value:Gv.ToDegrees},{label:"ToRadians",value:Gv.ToRadians},{label:"Fract",value:Gv.Fract}]})],uZ.prototype,"operation",void 0),(0,e.h)("BABYLON.ParticleTrigonometryBlock",uZ);var WZ,aZ=Z(12804);class bZ extends dv{constructor(f){super(f),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(jv.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(jv.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(jv.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(jv.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(jv.System),this._inputs[0].excludedConnectionPointTypes.push(jv.Particle),this._inputs[0].excludedConnectionPointTypes.push(jv.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(f){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const v=f=>{const v=this.input.getConnectedValue(f);if(this.log.length>=this.stackSize)return v;if(null===v||void 0===v)return this.log.push(["null",""]),v;switch(this.input.type){case jv.Vector2:this.log.push([(0,aZ.i)(v,4),v.toString()]);break;case jv.Xv:this.log.push([(0,aZ.j)(v,4),v.toString()]);break;case jv.he:this.log.push([`{R: ${v.r.toFixed(4)} G: ${v.g.toFixed(4)} B: ${v.b.toFixed(4)} A: ${v.a.toFixed(4)}}`,v.toString()]);break;default:this.log.push([v.toString(),v.toString()])}return v};this.output.isConnected?this.output._storedFunction=v:this.output._storedValue=v(f)}serialize(){const f=super.serialize();return f.stackSize=this.stackSize,f}_deserialize(f){super._deserialize(f),this.stackSize=f.stackSize}}(0,P.d)([xv("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],bZ.prototype,"stackSize",void 0),(0,e.h)("BABYLON.ParticleDebugBlock",bZ);(0,e.h)("BABYLON.ParticleElbowBlock",class extends dv{constructor(f){super(f),this.registerInput("input",jv.AutoDetect),this.registerOutput("output",jv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(f){super._build(f);const v=this._outputs[0],Z=this._inputs[0];v._storedFunction=f=>Z.getConnectedValue(f)}});(0,e.h)("BABYLON.ParticleTeleportInBlock",class extends dv{get endpoints(){return this._endpoints}constructor(f){super(f),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",jv.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(f){if(this.getClassName()===f)return!0;for(const v of this.endpoints)if(v.isAnAncestorOfType(f))return!0;return!1}isAnAncestorOf(f){for(const v of this.endpoints){if(v===f)return!0;if(v.isAnAncestorOf(f))return!0}return!1}attachToEndpoint(f){f.detach(),this._endpoints.push(f),f._entryPoint=this,f._outputs[0]._typeConnectionSource=this._inputs[0],f._tempEntryPointUniqueId=null,f.name="> "+this.name}detachFromEndpoint(f){const v=this._endpoints.indexOf(f);-1!==v&&(this._endpoints.splice(v,1),f._outputs[0]._typeConnectionSource=null,f._entryPoint=null)}_build(){for(const f of this._endpoints)f.output._storedFunction=f=>this.input.getConnectedValue(f)}});(0,e.h)("BABYLON.ParticleTeleportOutBlock",class extends dv{constructor(f){super(f),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",jv.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(f){this.entryPoint&&this.entryPoint.build(f)}clone(){const f=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(f),f}serialize(){var f;const v=super.serialize();return v.entryPoint=(null===(f=this.entryPoint)||void 0===f?void 0:f.uniqueId)??"",v}_deserialize(f){super._deserialize(f),this._tempEntryPointUniqueId=f.entryPoint}}),function(f){f[f.Equal=0]="Equal",f[f.NotEqual=1]="NotEqual",f[f.LessThan=2]="LessThan",f[f.GreaterThan=3]="GreaterThan",f[f.LessOrEqual=4]="LessOrEqual",f[f.GreaterOrEqual=5]="GreaterOrEqual",f[f.Xor=6]="Xor",f[f.Or=7]="Or",f[f.And=8]="And"}(WZ||(WZ={}));class XZ extends dv{constructor(f){super(f),this.test=WZ.Equal,this.epsilon=0,this.registerInput("left",jv.Float),this.registerInput("right",jv.Float,!0,0),this.registerInput("ifTrue",jv.AutoDetect,!0,1),this.registerInput("ifFalse",jv.AutoDetect,!0,0),this.registerOutput("output",jv.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=jv.Float,this._inputs[0].acceptedConnectionPointTypes.push(jv.Int),this._inputs[1].acceptedConnectionPointTypes.push(jv.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const f=f=>{const v=this.left.getConnectedValue(f),Z=this.right.getConnectedValue(f);let V=!1;switch(this.test){case WZ.Equal:V=(0,H.WithinEpsilon)(v,Z,this.epsilon);break;case WZ.NotEqual:V=!(0,H.WithinEpsilon)(v,Z,this.epsilon);break;case WZ.LessThan:V=v<Z+this.epsilon;break;case WZ.GreaterThan:V=v>Z-this.epsilon;break;case WZ.LessOrEqual:V=v<=Z+this.epsilon;break;case WZ.GreaterOrEqual:V=v>=Z-this.epsilon;break;case WZ.Xor:V=!!v&&!Z||!v&&!!Z;break;case WZ.Or:V=!!v||!!Z;break;case WZ.And:V=!!v&&!!Z}return V};this.output._storedFunction=v=>f(v)?this.ifTrue.getConnectedValue(v):this.ifFalse.getConnectedValue(v)}serialize(){const f=super.serialize();return f.test=this.test,f.epsilon=this.epsilon,f}_deserialize(f){super._deserialize(f),this.test=f.test,void 0!==f.epsilon&&(this.epsilon=f.epsilon)}}(0,P.d)([xv("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:WZ.Equal},{label:"NotEqual",value:WZ.NotEqual},{label:"LessThan",value:WZ.LessThan},{label:"GreaterThan",value:WZ.GreaterThan},{label:"LessOrEqual",value:WZ.LessOrEqual},{label:"GreaterOrEqual",value:WZ.GreaterOrEqual},{label:"Xor",value:WZ.Xor},{label:"Or",value:WZ.Or},{label:"And",value:WZ.And}]})],XZ.prototype,"test",void 0),(0,P.d)([xv("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],XZ.prototype,"epsilon",void 0),(0,e.h)("BABYLON.ParticleConditionBlock",XZ);class FZ extends dv{constructor(f){super(f),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",jv.Particle),this.registerInput("condition",jv.Float,!0,0),this.registerInput("system",jv.System),this.registerOutput("output",jv.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(f){this._triggerCount=0;const v=this.input.getConnectedValue(f),Z={process:Z=>{if(f.particleContext=Z,f.systemContext=v,0!==this.condition.getConnectedValue(f)&&(0===this.limit||this._triggerCount<this.limit)){const V=(new Date).getTime();if(this._previousOne&&V-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=V;const h=this.system.getConnectedValue(f);if(h){const V=nv(h,f.Uv,Z.position);V.Kh.addOnce((()=>{this._triggerCount--})),v.Kh.addOnce((()=>{V.dispose()}))}}},previousItem:null,nextItem:null};v._updateQueueStart?kf(Z,v._updateQueueStart):v._updateQueueStart=Z,this.output._storedValue=v}serialize(){const f=super.serialize();return f.limit=this.limit,f.delay=this.delay,f}_deserialize(f){super._deserialize(f),void 0!==f.limit&&(this.limit=f.limit),void 0!==f.delay&&(this.delay=f.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,P.d)([xv("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FZ.prototype,"limit",void 0),(0,P.d)([xv("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FZ.prototype,"delay",void 0),(0,e.h)("BABYLON.ParticleTriggerBlock",FZ);Z(12806),Z(12822),Z(12827),Z(12899)},12873:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneFragment",J="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12835:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneFragmentDeclaration",J="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12912:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneVertex",J="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12904:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneVertexDeclaration",J="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12890:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogFragment",J="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12866:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogFragmentDeclaration",J="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12914:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogVertex",J="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12907:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogVertexDeclaration",J="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12856:(f,v,Z)=>{"use strict";var V=Z(11333);const h="helperFunctions",J="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12843:(f,v,Z)=>{"use strict";var V=Z(11333);const h="imageProcessingDeclaration",J="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12861:(f,v,Z)=>{"use strict";var V=Z(11333);const h="imageProcessingFunctions",J="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12851:(f,v,Z)=>{"use strict";var V=Z(11333);const h="logDepthDeclaration",J="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12881:(f,v,Z)=>{"use strict";var V=Z(11333);const h="logDepthFragment",J="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12921:(f,v,Z)=>{"use strict";var V=Z(11333);const h="logDepthVertex",J="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";V.c.IncludesShadersStoreWGSL[h]||(V.c.IncludesShadersStoreWGSL[h]=J)},12827:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{particlesPixelShaderWGSL:()=>l});var V=Z(11333);Z(12835),Z(12843),Z(12851),Z(12856),Z(12861),Z(12866),Z(12873),Z(12881),Z(12890);const h="particlesPixelShader",J="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";V.c.ShadersStoreWGSL[h]||(V.c.ShadersStoreWGSL[h]=J);const l={name:h,shader:J}},12899:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{particlesVertexShaderWGSL:()=>l});var V=Z(11333);Z(12904),Z(12907),Z(12851),Z(12912),Z(12914),Z(12921);const h="particlesVertexShader",J="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";V.c.ShadersStoreWGSL[h]||(V.c.ShadersStoreWGSL[h]=J);const l={name:h,shader:J}},12748:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneFragment",J="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12815:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneFragmentDeclaration",J="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12769:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneVertex",J="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12825:(f,v,Z)=>{"use strict";var V=Z(11333);const h="clipPlaneVertexDeclaration",J="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12762:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogFragment",J="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12743:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogFragmentDeclaration",J="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12772:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogVertex",J="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12765:(f,v,Z)=>{"use strict";var V=Z(11333);const h="fogVertexDeclaration",J="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12735:(f,v,Z)=>{"use strict";var V=Z(11333);const h="helperFunctions",J="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12723:(f,v,Z)=>{"use strict";var V=Z(11333);const h="imageProcessingDeclaration",J="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12740:(f,v,Z)=>{"use strict";var V=Z(11333);const h="imageProcessingFunctions",J="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12731:(f,v,Z)=>{"use strict";var V=Z(11333);const h="logDepthDeclaration",J="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12753:(f,v,Z)=>{"use strict";var V=Z(11333);const h="logDepthFragment",J="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12775:(f,v,Z)=>{"use strict";var V=Z(11333);const h="logDepthVertex",J="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";V.c.IncludesShadersStore[h]||(V.c.IncludesShadersStore[h]=J)},12806:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{particlesPixelShader:()=>l});var V=Z(11333);Z(12815),Z(12723),Z(12731),Z(12735),Z(12740),Z(12743),Z(12748),Z(12753),Z(12762);const h="particlesPixelShader",J="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";V.c.ShadersStore[h]||(V.c.ShadersStore[h]=J);const l={name:h,shader:J}},12822:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{particlesVertexShader:()=>l});var V=Z(11333);Z(12825),Z(12765),Z(12731),Z(12769),Z(12772),Z(12775);const h="particlesVertexShader",J="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";V.c.ShadersStore[h]||(V.c.ShadersStore[h]=J);const l={name:h,shader:J}},13180:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{FlowGraphGLTFDataProvider:()=>J});var V=Z(13149),h=Z(13123);class J extends V.c{constructor(f){var v,Z;super();const V=f.glTF,J=(null===(v=V.animations)||void 0===v?void 0:v.map((f=>f._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",h.d,J);const l=(null===(Z=V.nodes)||void 0===Z?void 0:Z.map((f=>f._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",h.d,l)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13064:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>F,g:()=>b,h:()=>a,j:()=>X});var V=Z(11421),h=Z(11887),J=Z(11472),l=Z(13067);const e=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class C{constructor(f,v){this._gltf=f,this._infoTree=v}convert(f){let v,Z=this._gltf,V=this._infoTree;if(!f.startsWith("/"))throw new Error("Path must start with a /");const h=f.split("/");if(h.shift(),h[h.length-1].includes(".length")){const f=h[h.length-1].split(".");h.pop(),h.push(...f)}let J=!1;for(const C of h){const h="length"===C;if(h&&!V.__array__)throw new Error(`Path ${f} is invalid`);if(V.__ignoreObjectTree__&&(J=!0),V.__array__&&!h)V=V.__array__;else if(V=V[C],!V)throw new Error(`Path ${f} is invalid`);if(!J)if(void 0===Z){if(!e.find((v=>v.regex.test(f))))throw new Error(`Path ${f} is invalid`)}else if(!h){var l;Z=null===(l=Z)||void 0===l?void 0:l[C]}(V.__target__||h)&&(v=Z)}return{object:v,info:V}}}function H(f,v,Z,V){const h=O(f,v);return V?h[Z][V]:h[Z]}function O(f,v,Z){var V,J;return null===(V=f._data)||void 0===V||null===(J=V[(null===Z||void 0===Z?void 0:Z.fillMode)??h.d.MATERIAL_TriangleFillMode])||void 0===J?void 0:J.babylonMaterial}function u(f,v){return{offset:{componentsCount:2,type:"Vector2",get:(Z,h,J)=>{const l=H(Z,J,f,v);return new V.Vector2(null===l||void 0===l?void 0:l.uOffset,null===l||void 0===l?void 0:l.vOffset)},getTarget:O,set:(Z,V,h,J)=>{const l=H(V,J,f,v);l.uOffset=Z.x,l.vOffset=Z.y},getPropertyName:[()=>`${f}${v?"."+v:""}.uOffset`,()=>`${f}${v?"."+v:""}.vOffset`]},rotation:{type:"number",get:(Z,V,h)=>{var J;return null===(J=H(Z,h,f,v))||void 0===J?void 0:J.wAng},getTarget:O,set:(Z,V,h,J)=>H(V,J,f,v).wAng=Z,getPropertyName:[()=>`${f}${v?"."+v:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Z,h,J)=>{const l=H(Z,J,f,v);return new V.Vector2(null===l||void 0===l?void 0:l.uScale,null===l||void 0===l?void 0:l.vScale)},getTarget:O,set:(Z,V,h,J)=>{const l=H(V,J,f,v);l.uScale=Z.x,l.vScale=Z.y},getPropertyName:[()=>`${f}${v?"."+v:""}.uScale`,()=>`${f}${v?"."+v:""}.vScale`]}}}const W={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:f=>{var v,Z;return new V.Vector2((null===(v=f._babylonCamera)||void 0===v?void 0:v.orthoLeft)??0,(null===(Z=f._babylonCamera)||void 0===Z?void 0:Z.orthoRight)??0)},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.orthoLeft=f.x,v._babylonCamera.orthoRight=f.y)},getTarget:f=>f,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:f=>{var v,Z;return new V.Vector2((null===(v=f._babylonCamera)||void 0===v?void 0:v.orthoBottom)??0,(null===(Z=f._babylonCamera)||void 0===Z?void 0:Z.orthoTop)??0)},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.orthoBottom=f.x,v._babylonCamera.orthoTop=f.y)},getTarget:f=>f,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:f=>{var v;return null===(v=f._babylonCamera)||void 0===v?void 0:v.maxZ},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.maxZ=f)},getTarget:f=>f,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:f=>{var v;return null===(v=f._babylonCamera)||void 0===v?void 0:v.Lh},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.Lh=f)},getTarget:f=>f,getPropertyName:[()=>"Lh"]}},perspective:{aspectRatio:{type:"number",get:f=>{var v;return null===(v=f._babylonCamera)||void 0===v?void 0:v.getEngine().getAspectRatio(f._babylonCamera)},getTarget:f=>f,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:f=>{var v;return null===(v=f._babylonCamera)||void 0===v?void 0:v.fov},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.fov=f)},getTarget:f=>f,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:f=>{var v;return null===(v=f._babylonCamera)||void 0===v?void 0:v.maxZ},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.maxZ=f)},getTarget:f=>f,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:f=>{var v;return null===(v=f._babylonCamera)||void 0===v?void 0:v.Lh},set:(f,v)=>{v._babylonCamera&&(v._babylonCamera.Lh=f)},getTarget:f=>f,getPropertyName:[()=>"Lh"]}}}},nodes:{length:{type:"number",get:f=>f.length,getTarget:f=>f.map((f=>f._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Xv",get:f=>{var v;return null===(v=f._babylonTransformNode)||void 0===v?void 0:v.position},set:(f,v)=>{var Z;return null===(Z=v._babylonTransformNode)||void 0===Z?void 0:Z.position.h(f)},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:f=>{var v;return null===(v=f._babylonTransformNode)||void 0===v?void 0:v.rotationQuaternion},set:(f,v)=>{var Z,V;return null===(Z=v._babylonTransformNode)||void 0===Z||null===(V=Z.rotationQuaternion)||void 0===V?void 0:V.h(f)},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Xv",get:f=>{var v;return null===(v=f._babylonTransformNode)||void 0===v?void 0:v.Ze},set:(f,v)=>{var Z;return null===(Z=v._babylonTransformNode)||void 0===Z?void 0:Z.Ze.h(f)},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"Ze"]},weights:{length:{type:"number",get:f=>f._numMorphTargets,getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(f,v)=>{var Z,V;return void 0!==v?null===(Z=f._primitiveBabylonMeshes)||void 0===Z||null===(V=Z[0].morphTargetManager)||void 0===V?void 0:V.getTarget(v).influence:void 0},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(f,v)=>[0],getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:f=>{var v,Z,h;return V.Matrix.Compose(null===(v=f._babylonTransformNode)||void 0===v?void 0:v.Ze,null===(Z=f._babylonTransformNode)||void 0===Z?void 0:Z.rotationQuaternion,null===(h=f._babylonTransformNode)||void 0===h?void 0:h.position)},getTarget:f=>f._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:f=>{var v,Z,h,J;const l=V.Matrix.Identity();let e=f.parent;for(;e&&e.parent;)e=e.parent;const C=(null===(v=f._babylonTransformNode)||void 0===v?void 0:v.position._isDirty)||(null===(Z=f._babylonTransformNode)||void 0===Z||null===(h=Z.rotationQuaternion)||void 0===h?void 0:h._isDirty)||(null===(J=f._babylonTransformNode)||void 0===J?void 0:J.Ze._isDirty);if(e){var H;const v=null===(H=e._babylonTransformNode)||void 0===H?void 0:H.jh(!0).invert();var O,u;if(v)null===(O=f._babylonTransformNode)||void 0===O||null===(u=O.jh(C))||void 0===u||u.multiplyToRef(v,l)}else f._babylonTransformNode&&l.h(f._babylonTransformNode.jh(C));return l},getTarget:f=>f._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:f=>{var v,Z;return null===(v=f._babylonTransformNode)||void 0===v||null===(Z=v.getChildren((f=>f instanceof l.c),!0)[0])||void 0===Z?void 0:Z.Ke},getTarget:f=>{var v;return null===(v=f._babylonTransformNode)||void 0===v?void 0:v.getChildren((f=>f instanceof l.c),!0)[0]},set:(f,v)=>{if(v._babylonTransformNode){const Z=v._babylonTransformNode.getChildren((f=>f instanceof l.c),!0)[0];Z&&(Z.Ke=f)}}},color:{type:"Mv",get:f=>{var v,Z;return null===(v=f._babylonTransformNode)||void 0===v||null===(Z=v.getChildren((f=>f instanceof l.c),!0)[0])||void 0===Z?void 0:Z.Me},getTarget:f=>{var v;return null===(v=f._babylonTransformNode)||void 0===v?void 0:v.getChildren((f=>f instanceof l.c),!0)[0]},set:(f,v)=>{if(v._babylonTransformNode){const Z=v._babylonTransformNode.getChildren((f=>f instanceof l.c),!0)[0];Z&&(Z.Me=f)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Mv",get:(f,v,Z)=>O(f,v,Z).emissiveColor,set:(f,v,Z,V)=>O(v,Z,V).emissiveColor.h(f),getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:u("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(f,v,Z)=>{var V;return null===(V=H(f,Z,"bumpTexture"))||void 0===V?void 0:V.level},set:(f,v,Z,V)=>{const h=H(v,V,"bumpTexture");h&&(h.level=f)},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:u("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(f,v,Z)=>O(f,v,Z).ambientTextureStrength,set:(f,v,Z,V)=>{const h=O(v,Z,V);h&&(h.ambientTextureStrength=f)},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:u("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"he",get:(f,v,Z)=>{const V=O(f,v,Z);return J.he.FromColor3(V.albedoColor,V.alpha)},set:(f,v,Z,V)=>{const h=O(v,Z,V);h.albedoColor.set(f.r,f.g,f.b),h.alpha=f.a},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:u("albedoTexture")}},metallicFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).metallic,set:(f,v,Z,V)=>{const h=O(v,Z,V);h&&(h.metallic=f)},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).roughness,set:(f,v,Z,V)=>{const h=O(v,Z,V);h&&(h.roughness=f)},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:u("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(f,v,Z)=>O(f,v,Z).anisotropy.Ke,set:(f,v,Z,V)=>{O(v,Z,V).anisotropy.Ke=f},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(f,v,Z)=>O(f,v,Z).anisotropy.angle,set:(f,v,Z,V)=>{O(v,Z,V).anisotropy.angle=f},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:u("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).clearCoat.Ke,set:(f,v,Z,V)=>{O(v,Z,V).clearCoat.Ke=f},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).clearCoat.roughness,set:(f,v,Z,V)=>{O(v,Z,V).clearCoat.roughness=f},getTarget:(f,v,Z)=>O(f,v,Z),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:u("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(f,v,Z)=>{var V;return null===(V=O(f,v,Z).clearCoat.bumpTexture)||void 0===V?void 0:V.level},getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).clearCoat.bumpTexture.level=f},extensions:{KHR_texture_transform:u("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:u("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(f,v,Z)=>O(f,v,Z).subSurface.dispersion,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).subSurface.dispersion=f}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(f,v,Z)=>O(f,v,Z).emissiveIntensity,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).emissiveIntensity=f}},KHR_materials_ior:{ior:{type:"number",get:(f,v,Z)=>O(f,v,Z).indexOfRefraction,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).indexOfRefraction=f}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).iridescence.Ke,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).iridescence.Ke=f},iridescenceIor:{type:"number",get:(f,v,Z)=>O(f,v,Z).iridescence.indexOfRefraction,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).iridescence.indexOfRefraction=f},iridescenceTexture:{extensions:{KHR_texture_transform:u("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(f,v,Z)=>O(f,v,Z).iridescence.maximumThickness,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).iridescence.maximumThickness=f},iridescenceThicknessMinimum:{type:"number",get:(f,v,Z)=>O(f,v,Z).iridescence.minimumThickness,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).iridescence.minimumThickness=f},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:u("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Mv",get:(f,v,Z)=>O(f,v,Z).sheen.color,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).sheen.color.h(f)},sheenColorTexture:{extensions:{KHR_texture_transform:u("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).sheen.Ke,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).sheen.Ke=f},sheenRoughnessTexture:{extensions:{KHR_texture_transform:u("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).metallicF0Factor,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).metallicF0Factor=f,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Mv",get:(f,v,Z)=>O(f,v,Z).metallicReflectanceColor,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).metallicReflectanceColor.h(f),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:u("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:u("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).subSurface.refractionIntensity,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).subSurface.refractionIntensity=f,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).subSurface.translucencyIntensity,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).subSurface.translucencyIntensity=f},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Mv",get:(f,v,Z)=>O(f,v,Z).subSurface.translucencyColor,getTarget:O,set:(f,v,Z,V)=>{var h;return f&&(null===(h=O(v,Z,V).subSurface.translucencyColor)||void 0===h?void 0:h.h(f))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Mv",get:(f,v,Z)=>O(f,v,Z).subSurface.tintColor,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).subSurface.tintColor.h(f)},attenuationDistance:{type:"number",get:(f,v,Z)=>O(f,v,Z).subSurface.tintColorAtDistance,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).subSurface.tintColorAtDistance=f},thicknessFactor:{type:"number",get:(f,v,Z)=>O(f,v,Z).subSurface.maximumThickness,getTarget:O,set:(f,v,Z,V)=>O(v,Z,V).subSurface.maximumThickness=f},thicknessTexture:{extensions:{KHR_texture_transform:u("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:f=>f.length,getTarget:f=>f.map((f=>f._babylonLight)),getPropertyName:[f=>"length"]},__array__:{__target__:!0,color:{type:"Mv",get:f=>{var v;return null===(v=f._babylonLight)||void 0===v?void 0:v.Me},set:(f,v)=>{var Z;return null===(Z=v._babylonLight)||void 0===Z?void 0:Z.Me.h(f)},getTarget:f=>f._babylonLight,getPropertyName:[f=>"diffuse"]},Ke:{type:"number",get:f=>{var v;return null===(v=f._babylonLight)||void 0===v?void 0:v.Ke},set:(f,v)=>v._babylonLight?v._babylonLight.Ke=f:void 0,getTarget:f=>f._babylonLight,getPropertyName:[f=>"intensity"]},range:{type:"number",get:f=>{var v;return null===(v=f._babylonLight)||void 0===v?void 0:v.range},set:(f,v)=>v._babylonLight?v._babylonLight.range=f:void 0,getTarget:f=>f._babylonLight,getPropertyName:[f=>"range"]},spot:{innerConeAngle:{type:"number",get:f=>{var v;return null===(v=f._babylonLight)||void 0===v?void 0:v.innerAngle},set:(f,v)=>v._babylonLight?v._babylonLight.innerAngle=f:void 0,getTarget:f=>f._babylonLight,getPropertyName:[f=>"innerConeAngle"]},outerConeAngle:{type:"number",get:f=>{var v;return null===(v=f._babylonLight)||void 0===v?void 0:v.angle},set:(f,v)=>v._babylonLight?v._babylonLight.angle=f:void 0,getTarget:f=>f._babylonLight,getPropertyName:[f=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:f=>f.length,getTarget:f=>f.map((f=>f._babylonLight)),getPropertyName:[f=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:f=>f.length,getTarget:f=>f.map((f=>f._babylonTexture)),getPropertyName:[f=>"length"]},__array__:{__target__:!0,Ke:{type:"number",get:f=>{var v;return null===(v=f._babylonTexture)||void 0===v?void 0:v.level},set:(f,v)=>{v._babylonTexture&&(v._babylonTexture.level=f)},getTarget:f=>f._babylonTexture},rotation:{type:"Quaternion",get:f=>{var v;return f._babylonTexture&&V.Quaternion.FromRotationMatrix(null===(v=f._babylonTexture)||void 0===v?void 0:v.getReflectionTextureMatrix())},set:(f,v)=>{var Z;v._babylonTexture&&(null!==(Z=v._babylonTexture.Yf())&&void 0!==Z&&Z.useRightHandedSystem||(f=V.Quaternion.Inverse(f)),V.Matrix.FromQuaternionToRef(f,v._babylonTexture.getReflectionTextureMatrix()))},getTarget:f=>f._babylonTexture}}}}},animations:{length:{type:"number",get:f=>f.length,getTarget:f=>f.map((f=>f._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:f=>f.length,getTarget:f=>f.map((f=>{var v;return null===(v=f.primitives[0]._instanceData)||void 0===v?void 0:v.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function a(f){return new C(f,W)}function b(f){const v=f.split("/").map((f=>f.replace(/{}/g,"__array__")));let Z=W;for(const V of v)V&&(Z=Z[V]);if(Z&&Z.type&&Z.get)return Z}function X(f,v){const Z=f.split("/").map((f=>f.replace(/{}/g,"__array__")));let V=W;for(const h of Z)h&&(V=V[h]);V&&V.type&&V.get&&(V.interpolation=v)}function F(f,v){const Z=f.split("/").map((f=>f.replace(/{}/g,"__array__")));let V=W;for(const h of Z)if(h){if(!V[h]){if("?"===h){V.__ignoreObjectTree__=!0;continue}V[h]={},"__array__"===h&&(V[h].__target__=!0)}V=V[h]}Object.assign(V,v)}},13072:(f,v,Z)=>{"use strict";Z.r(v),Z.d(v,{AnimationPropertyInfo:()=>H,TransformNodeAnimationPropertyInfo:()=>O,WeightAnimationPropertyInfo:()=>u,getQuaternion:()=>e,getVector3:()=>l,getWeights:()=>C});var V=Z(11921),h=Z(11421),J=Z(13064);function l(f,v,Z,V){return h.Xv.Av(v,Z).scaleInPlace(V)}function e(f,v,Z,V){return h.Quaternion.Av(v,Z).scaleInPlace(V)}function C(f,v,Z,V){const h=new Array(f._numMorphTargets);for(let J=0;J<h.length;J++)h[J]=v[Z++]*V;return h}class H{constructor(f,v,Z,V){this.type=f,this.name=v,this.getValue=Z,this.getStride=V}_buildAnimation(f,v,Z){const h=new V.b(f,this.name,v,this.type);return h.setKeys(Z),h}}class O extends H{buildAnimations(f,v,Z,V){const h=[];return h.push({babylonAnimatable:f._babylonTransformNode,babylonAnimation:this._buildAnimation(v,Z,V)}),h}}class u extends H{buildAnimations(f,v,Z,h){const J=[];if(f._numMorphTargets)for(let l=0;l<f._numMorphTargets;l++){const e=new V.b(`${v}_${l}`,this.name,Z,this.type);if(e.setKeys(h.map((f=>({frame:f.frame,inTangent:f.inTangent?f.inTangent[l]:void 0,value:f.value[l],outTangent:f.outTangent?f.outTangent[l]:void 0,interpolation:f.interpolation})))),f._primitiveBabylonMeshes)for(const v of f._primitiveBabylonMeshes)if(v.morphTargetManager){const f=v.morphTargetManager.getTarget(l),Z=e.clone();f.animations.push(Z),J.push({babylonAnimatable:f,babylonAnimation:Z})}}return J}}(0,J.j)("/nodes/{}/translation",[new O(V.b.ANIMATIONTYPE_VECTOR3,"position",l,(()=>3))]),(0,J.j)("/nodes/{}/rotation",[new O(V.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",e,(()=>4))]),(0,J.j)("/nodes/{}/scale",[new O(V.b.ANIMATIONTYPE_VECTOR3,"Ze",l,(()=>3))]),(0,J.j)("/nodes/{}/weights",[new u(V.b.ANIMATIONTYPE_FLOAT,"influence",C,(f=>f._numMorphTargets))])},13034:(f,v,Z)=>{"use strict";class V{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((f,v)=>{this._resolve=f,this._reject=v}))}}var h=Z(11421),J=Z(11472),l=Z(11230),e=Z(11863),C=Z(13041),H=Z(13048),O=Z(11235),u=Z(11885),W=Z(11921),a=Z(11930),b=Z(11281),X=Z(11247),F=Z(11251);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(f){this._useTextureToStoreBoneMatrices=f,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(f){this._animationPropertiesOverride=f}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(f,v,Z){this.name=f,this.id=v,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=h.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new O.c,this.bones=[],this._scene=Z||b.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const V=this._scene.getEngine().getCaps();this._canUseTextureForBones=V.textureFloat&&V.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((f=>!f.getParent()))}getTransformMatrices(f){if(this.needInitialSkinMatrix){if(!f)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return f._bonesTransformMatrices||this.prepare(!0),f._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(f){return this.needInitialSkinMatrix&&f._transformMatrixTexture?f._transformMatrixTexture:this._transformMatrixTexture}Yf(){return this._scene}toString(f){let v=`Name: ${this.name}, nBones: ${this.bones.length}`;if(v+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,f){v+=", Ranges: {";let f=!0;for(const Z in this._ranges)f&&(v+=", ",f=!1),v+=Z;v+="}"}return v}getBoneIndexByName(f){for(let v=0,Z=this.bones.length;v<Z;v++)if(this.bones[v].name===f)return v;return-1}createAnimationRange(f,v,Z){if(!this._ranges[f]){this._ranges[f]=new a.c(f,v,Z);for(let V=0,h=this.bones.length;V<h;V++)this.bones[V].animations[0]&&this.bones[V].animations[0].createRange(f,v,Z)}}deleteAnimationRange(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Z=0,V=this.bones.length;Z<V;Z++)this.bones[Z].animations[0]&&this.bones[Z].animations[0].deleteRange(f,v);this._ranges[f]=null}getAnimationRange(f){return this._ranges[f]||null}getAnimationRanges(){const f=[];let v;for(v in this._ranges)f.push(this._ranges[v]);return f}copyAnimationRange(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[v]||!f.getAnimationRange(v))return!1;let V=!0;const h=this._getHighestAnimationFrame()+1,J={},l=f.bones;let e,C;for(C=0,e=l.length;C<e;C++)J[l[C].name]=l[C];this.bones.length!==l.length&&(X.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${l.length}`),V=!1);const H=Z&&this.dimensionsAtRest&&f.dimensionsAtRest?this.dimensionsAtRest.divide(f.dimensionsAtRest):null;for(C=0,e=this.bones.length;C<e;C++){const f=this.bones[C].name,l=J[f];l?V=V&&this.bones[C].copyAnimationRange(l,v,h,Z,H):(X.e.Warn("copyAnimationRange: not same rig, missing source bone "+f),V=!1)}const O=f.getAnimationRange(v);return O&&(this._ranges[v]=new a.c(v,O.from+h,O.to+h)),V}returnToRest(){for(const f of this.bones)-1!==f._index&&f.returnToRest()}_getHighestAnimationFrame(){let f=0;for(let v=0,Z=this.bones.length;v<Z;v++)if(this.bones[v].animations[0]){const Z=this.bones[v].animations[0].getHighestFrame();f<Z&&(f=Z)}return f}beginAnimation(f,v,Z,V){const h=this.getAnimationRange(f);return h?this._scene.beginAnimation(this,h.from,h.to,v,Z,V):null}static MakeAnimationAdditive(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;const V=f.getAnimationRange(Z);if(!V)return null;const h=f._scene.getAllAnimatablesByTarget(f);let J=null;for(let e=0;e<h.length;e++){const f=h[e];if(f.fromFrame===(null===V||void 0===V?void 0:V.from)&&f.toFrame===(null===V||void 0===V?void 0:V.to)){J=f;break}}const l=f.getAnimatables();for(let e=0;e<l.length;e++){const f=l[e].animations;if(f)for(let V=0;V<f.length;V++)W.b.MakeAnimationAdditive(f[V],v,Z)}return J&&(J.isAdditive=!0),f}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(f){this._meshesWithPoseMatrix.push(f)}_unregisterMeshWithPoseMatrix(f){const v=this._meshesWithPoseMatrix.indexOf(f);v>-1&&this._meshesWithPoseMatrix.splice(v,1)}_computeTransformMatrices(f,v){this.onBeforeComputeObservable.notifyObservers(this);for(let Z=0;Z<this.bones.length;Z++){const V=this.bones[Z];V._childUpdateId++;const h=V.getParent();if(h?V.getLocalMatrix().multiplyToRef(h.getFinalMatrix(),V.getFinalMatrix()):v?V.getLocalMatrix().multiplyToRef(v,V.getFinalMatrix()):V.getFinalMatrix().h(V.getLocalMatrix()),-1!==V._index){const v=null===V._index?Z:V._index;V.getAbsoluteInverseBindMatrix().multiplyToArray(V.getFinalMatrix(),f,16*v)}}this._identity.copyToArray(f,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const f=this.Yf().getRenderId();if(this._currentRenderId===f)return;this._currentRenderId=f}if(this._numBonesWithLinkedTransformNode>0)for(const f of this.bones)if(f._linkedTransformNode){const v=f._linkedTransformNode;f.position=v.position,v.rotationQuaternion?f.rotationQuaternion=v.rotationQuaternion:f.rotation=v.rotation,f.Ze=v.Ze}if(this.needInitialSkinMatrix)for(const f of this._meshesWithPoseMatrix){const v=f.getPoseMatrix();let Z=this._isDirty;if(f._bonesTransformMatrices&&f._bonesTransformMatrices.length===16*(this.bones.length+1)||(f._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Z=!0),Z){if(this._synchronizedWithMesh!==f){this._synchronizedWithMesh=f;for(const f of this.bones)if(!f.getParent()){f.getBindMatrix().multiplyToRef(v,h.TmpVectors.Matrix[1]),f._updateAbsoluteBindMatrices(h.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const v=4*(this.bones.length+1);f._transformMatrixTexture&&f._transformMatrixTexture.getSize().width===v||(f._transformMatrixTexture&&f._transformMatrixTexture.dispose(),f._transformMatrixTexture=u.c.CreateRGBATexture(f._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(f._bonesTransformMatrices,v),this.isUsingTextureForMatrices&&f._transformMatrixTexture&&f._transformMatrixTexture.update(f._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=u.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let f=0;f<this.bones.length;f++)this._animatables.push(this.bones[f])}return this._animatables}clone(f,v){const Z=new U(f,v||f,this._scene);Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let V=0;V<this.bones.length;V++){const f=this.bones[V];let v=null;const h=f.getParent();if(h){const f=this.bones.indexOf(h);v=Z.bones[f]}const J=new H.d(f.name,Z,v,f.getBindMatrix().clone(),f.getRestMatrix().clone());J._index=f._index,f._linkedTransformNode&&J.linkTransformNode(f._linkedTransformNode),F.c.DeepCopy(f.animations,J.animations)}if(this._ranges){Z._ranges={};for(const f in this._ranges){const v=this._ranges[f];v&&(Z._ranges[f]=v.clone())}}return this._isDirty=!0,Z.prepare(!0),Z}enableBlending(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const v of this.bones)for(const Z of v.animations)Z.enableBlending=!0,Z.blendingSpeed=f}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Yf().stopAnimation(this),this.Yf().removeSkeleton(this),this._parentContainer){const f=this._parentContainer.skeletons.indexOf(this);f>-1&&this._parentContainer.skeletons.splice(f,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const f={};f.name=this.name,f.id=this.id,this.dimensionsAtRest&&(f.dimensionsAtRest=this.dimensionsAtRest.Ph()),f.bones=[],f.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Z=0;Z<this.bones.length;Z++){var v;const V=this.bones[Z],h=V.getParent(),J={parentBoneIndex:h?this.bones.indexOf(h):-1,index:V.getIndex(),name:V.name,id:V.id,matrix:V.getBindMatrix().Ph(),rest:V.getRestMatrix().Ph(),linkedTransformNodeId:null===(v=V.getTransformNode())||void 0===v?void 0:v.id};f.bones.push(J),V.length&&(J.length=V.length),V.metadata&&(J.metadata=V.metadata),V.animations&&V.animations.length>0&&(J.animation=V.animations[0].serialize()),f.ranges=[];for(const v in this._ranges){const Z=this._ranges[v];if(!Z)continue;const V={};V.name=v,V.from=Z.from,V.to=Z.to,f.ranges.push(V)}}return f}static Parse(f,v){const Z=new U(f.name,f.id,v);let V;for(f.dimensionsAtRest&&(Z.dimensionsAtRest=h.Xv.Av(f.dimensionsAtRest)),Z.needInitialSkinMatrix=f.needInitialSkinMatrix,V=0;V<f.bones.length;V++){const v=f.bones[V],J=f.bones[V].index;let l=null;v.parentBoneIndex>-1&&(l=Z.bones[v.parentBoneIndex]);const e=v.rest?h.Matrix.Av(v.rest):null,C=new H.d(v.name,Z,l,h.Matrix.Av(v.matrix),e,null,J);void 0!==v.id&&null!==v.id&&(C.id=v.id),v.length&&(C.length=v.length),v.metadata&&(C.metadata=v.metadata),v.animation&&C.animations.push(W.b.Parse(v.animation)),void 0!==v.linkedTransformNodeId&&null!==v.linkedTransformNodeId&&(Z._hasWaitingData=!0,C._waitingTransformNodeId=v.linkedTransformNodeId)}if(f.ranges)for(V=0;V<f.ranges.length;V++){const v=f.ranges[V];Z.createAnimationRange(v.name,v.from,v.to)}return Z}computeAbsoluteMatrices(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||f)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(f)}getPoseMatrix(){let f=null;return this._meshesWithPoseMatrix.length>0&&(f=this._meshesWithPoseMatrix[0].getPoseMatrix()),f}sortBones(){const f=[],v=new Array(this.bones.length);for(let Z=0;Z<this.bones.length;Z++)this._sortBones(Z,f,v);this.bones=f}_sortBones(f,v,Z){if(Z[f])return;Z[f]=!0;const V=this.bones[f];if(!V)return;void 0===V._index&&(V._index=f);const h=V.getParent();h&&this._sortBones(this.bones.indexOf(h),v,Z),v.push(V)}setCurrentPoseAsRest(){for(const f of this.bones)f.setCurrentPoseAsRest()}}var K=Z(11729),M=Z(11891),A=Z(11401),s=Z(11820),z=Z(11494),Y=Z(11868),y=Z(11833),N=Z(11859),i=Z(11934),I=Z(11513),T=Z(12998);class B{set areUpdatesFrozen(f){f?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new I.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,f||(f=b.c.LastCreatedScene),this._scene=f,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const f=this._scene.getEngine().getCaps();this._canUseTextureForTargets=f.canUseGLVertexID&&f.textureFloat&&f.maxVertexTextureImageUnits>0&&f.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return B.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?B.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(f){this._numMaxInfluencers!==f&&(this._numMaxInfluencers=f,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(f){this._useTextureToStoreTargets!==f&&(this._useTextureToStoreTargets=f,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var f;return B.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(f=this._scene)&&void 0!==f&&f.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(f){return this._activeTargets.data[f]}getTarget(f){return this._targets[f]}getTargetByName(f){for(const v of this._targets)if(v.name===f)return v;return null}addTarget(f){this._targets.push(f),this._targetInfluenceChangedObservers.push(f.onInfluenceChanged.add((f=>{this.areUpdatesFrozen&&f&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(f)}))),this._targetDataLayoutChangedObservers.push(f._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(f){const v=this._targets.indexOf(f);v>=0&&(this._targets.splice(v,1),f.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(v,1)[0]),f._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(v,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(f)}_bind(f){f.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),f.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),f.setTexture("morphTargets",this._targetStoreTexture),f.setInt("morphTargetCount",this.numInfluencers)}clone(){const f=new B(this._scene);for(const v of this._targets)f.addTarget(v.clone());return f.enablePositionMorphing=this.enablePositionMorphing,f.enableNormalMorphing=this.enableNormalMorphing,f.enableTangentMorphing=this.enableTangentMorphing,f.enableUVMorphing=this.enableUVMorphing,f.enableUV2Morphing=this.enableUV2Morphing,f.enableColorMorphing=this.enableColorMorphing,f}serialize(){const f={};f.id=this.uniqueId,f.targets=[];for(const v of this._targets)f.targets.push(v.serialize());return f}_syncActiveTargets(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const v=!!this._targetStoreTexture,Z=this.isUsingTextureForTargets;(this._mustSynchronize||v!==Z)&&(this._mustSynchronize=!1,this.synchronize());let V=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let h=-1;for(const J of this._targets)if(h++,0!==J.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=B.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(J),this._morphTargetTextureIndices[V]=h,this._tempInfluences[V++]=J.influence}this._morphTargetTextureIndices.length!==V&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,V)),this._influences&&this._influences.length===V||(this._influences=new Float32Array(V));for(let J=0;J<V;J++)this._influences[J]=this._tempInfluences[J];if(f&&this._scene)for(const J of this._scene.meshes)J.morphTargetManager===this&&(Z?J._markSubMeshesAsAttributesDirty():J._syncGeometryWithMorphTargetManager())}synchronize(){var f;if(!this._scene||this.areUpdatesFrozen)return;const v=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(f=this._targetStoreTexture)||void 0===f||f.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>v.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Z of this._targets){this._supportsPositions=this._supportsPositions&&Z.hasPositions,this._supportsNormals=this._supportsNormals&&Z.hasNormals,this._supportsTangents=this._supportsTangents&&Z.hasTangents,this._supportsUVs=this._supportsUVs&&Z.hasUVs,this._supportsUV2s=this._supportsUV2s&&Z.hasUV2s,this._supportsColors=this._supportsColors&&Z.hasColors;const f=Z.vertexCount;if(0===this._vertexCount)this._vertexCount=f;else if(this._vertexCount!==f)return void X.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Z.name}": ${f}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const f=v.getCaps().maxTextureSize;this._textureWidth>f&&(this._textureHeight=Math.ceil(this._textureWidth/f),this._textureWidth=f);const Z=this._targets.length,V=new Float32Array(Z*this._textureWidth*this._textureHeight*4);let h=0;for(let v=0;v<Z;v++){const f=this._targets[v],Z=f.getPositions(),J=f.getNormals(),l=f.getUVs(),e=f.getTangents(),C=f.getUV2s(),H=f.getColors();h=v*this._textureWidth*this._textureHeight*4;for(let v=0;v<this._vertexCount;v++)this._supportsPositions&&Z&&(V[h]=Z[3*v],V[h+1]=Z[3*v+1],V[h+2]=Z[3*v+2],h+=4),this._supportsNormals&&J&&(V[h]=J[3*v],V[h+1]=J[3*v+1],V[h+2]=J[3*v+2],h+=4),this._supportsUVs&&l&&(V[h]=l[2*v],V[h+1]=l[2*v+1],h+=4),this._supportsTangents&&e&&(V[h]=e[3*v],V[h+1]=e[3*v+1],V[h+2]=e[3*v+2],h+=4),this._supportsUV2s&&C&&(V[h]=C[2*v],V[h+1]=C[2*v+1],h+=4),this._supportsColors&&H&&(V[h]=H[4*v],V[h+1]=H[4*v+1],V[h+2]=H[4*v+2],V[h+3]=H[4*v+3],h+=4)}this._targetStoreTexture=T.b.CreateRGBATexture(V,this._textureWidth,this._textureHeight,Z,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Z of this._scene.meshes)Z.morphTargetManager===this&&Z._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const f=this._parentContainer.morphTargetManagers.indexOf(this);f>-1&&this._parentContainer.morphTargetManagers.splice(f,1),this._parentContainer=null}for(const f of this._targets)this._scene.stopAnimation(f)}}static Parse(f,v){const Z=new B(v);for(const V of f.targets)Z.addTarget(i.e.Parse(V,v));return Z}}B.EnableTextureStorage=!0,B.MaxActiveMorphTargetsInVertexAttributeMode=8,B.ConstantTargetCountForTextureMode=0;var P=Z(13053),g=Z(11290),w=Z(11741);const t=new Map,L=t;function E(f,v,Z){j(f)&&X.e.Warn(`Extension with the name '${f}' already exists`),t.set(f,{isGLTFExtension:v,factory:Z})}function j(f){return t.delete(f)}var q=Z(13064),c=Z(11982),m=Z(11503);class p{static Get(f,v,Z){if(!v||void 0==Z||!v[Z])throw new Error(`${f}: Failed to find index (${Z})`);return v[Z]}static TryGet(f,v){return f&&void 0!=v&&f[v]?f[v]:null}static Assign(f){if(f)for(let v=0;v<f.length;v++)f[v].index=v}}function k(f){if(f.min&&f.max){const v=f.min,Z=f.max,V=h.TmpVectors.Xv[0].fe(v[0],v[1],v[2]),J=h.TmpVectors.Xv[1].fe(Z[0],Z[1],Z[2]);if(f.normalized&&5126!==f.componentType){let v=1;switch(f.componentType){case 5120:v=127;break;case 5121:v=255;break;case 5122:v=32767;break;case 5123:v=65535}const Z=1/v;V.scaleInPlace(Z),J.scaleInPlace(Z)}return new w.e(V,J)}return null}class r{static RegisterExtension(f,v){E(f,!1,v)}static UnregisterExtension(f){return j(f)}get yh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(f){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=f}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((f=>f.dispose&&f.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(f,v,Z,V,h,J){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=v,this._assetContainer=Z,this._loadData(V);let J=null;if(f){const v={};if(this._gltf.nodes)for(const f of this._gltf.nodes)f.name&&(v[f.name]=f.index);J=(f instanceof Array?f:[f]).map((f=>{const Z=v[f];if(void 0===Z)throw new Error(`Failed to find node '${f}'`);return Z}))}return await this._loadAsync(h,l,J,(()=>({meshes:this._getMeshes(),fW:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=f,this._loadData(v),await this._loadAsync(Z,h,null,(()=>{}))}async _loadAsync(f,v,Z,V){return await Promise.resolve().then((async()=>{this._rootUrl=f,this._uniqueRootUrl=!f.startsWith("file:")&&v?f:`${f}${Date.now()}/`,this._fileName=v,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const h=`${P.k[P.k.LOADING]} => ${P.k[P.k.READY]}`,J=`${P.k[P.k.LOADING]} => ${P.k[P.k.COMPLETE]}`;this._parent._startPerformanceCounter(h),this._parent._startPerformanceCounter(J),this._parent._setState(P.k.LOADING),this._extensionsOnLoading();const e=new Array;if(!this.parent.loadOnlyMaterials)if(Z)e.push(this.loadSceneAsync("/nodes",{nodes:Z,index:-1}));else if(void 0!=this._gltf.Uv||this._gltf.scenes&&this._gltf.scenes[0]){const f=p.Get("/scene",this._gltf.scenes,this._gltf.Uv||0);e.push(this.loadSceneAsync(`/scenes/${f.index}`,f))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let f=0;f<this._gltf.materials.length;++f){const v=this._gltf.materials[f],Z="/materials/"+f,V=K.e.TriangleFillMode;e.push(this._loadMaterialAsync(Z,v,null,V,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&e.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&e.push(this._compileShadowGeneratorsAsync());const C=Promise.all(e).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ne(!0);for(const f of this._babylonScene.materials){const v=f;void 0!==v.maxSimultaneousLights&&(v.maxSimultaneousLights=Math.max(v.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(P.k.READY),this._skipStartAnimationStep||this._startAnimations(),V()}));return await C.then((f=>(this._parent._endPerformanceCounter(h),l.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(J),this._parent._setState(P.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(f=>{this._parent.onErrorObservable.notifyObservers(f),this._parent.onErrorObservable.clear(),this.dispose()}))})),f)))})).catch((f=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(f),this._parent.onErrorObservable.clear(),this.dispose()),f}))}_loadData(f){if(this._gltf=f.json,this._setupData(),f.bin){const v=this._gltf.buffers;if(v&&v[0]&&!v[0].uri){const Z=v[0];(Z.byteLength<f.bin.byteLength-3||Z.byteLength>f.bin.byteLength)&&X.e.Warn(`Binary buffer length (${Z.byteLength}) from JSON does not match chunk length (${f.bin.byteLength})`),this._bin=f.bin}else X.e.Warn("Unexpected BIN chunk")}}_setupData(){if(p.Assign(this._gltf.accessors),p.Assign(this._gltf.animations),p.Assign(this._gltf.buffers),p.Assign(this._gltf.bufferViews),p.Assign(this._gltf.cameras),p.Assign(this._gltf.images),p.Assign(this._gltf.materials),p.Assign(this._gltf.meshes),p.Assign(this._gltf.nodes),p.Assign(this._gltf.samplers),p.Assign(this._gltf.scenes),p.Assign(this._gltf.skins),p.Assign(this._gltf.textures),this._gltf.nodes){const f={};for(const Z of this._gltf.nodes)if(Z.children)for(const v of Z.children)f[v]=Z.index;const v=this._createRootNode();for(const Z of this._gltf.nodes){const V=f[Z.index];Z.parent=void 0===V?v:this._gltf.nodes[V]}}}async _loadExtensionsAsync(){const f=[];if(L.forEach(((v,Z)=>{var V;!1===(null===(V=this.parent.extensionOptions[Z])||void 0===V?void 0:V.enabled)?v.isGLTFExtension&&this.isExtensionUsed(Z)&&X.e.Warn(`Extension ${Z} is used but has been explicitly disabled.`):v.isGLTFExtension&&!this.isExtensionUsed(Z)||f.push((async()=>{const f=await v.factory(this);return f.name!==Z&&X.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${f.name} !== ${Z}`),this._parent.onExtensionLoadedObservable.notifyObservers(f),f})())})),this._extensions.push(...await Promise.all(f)),this._extensions.sort(((f,v)=>(f.order||Number.MAX_VALUE)-(v.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Z of this._gltf.extensionsRequired){if(!this._extensions.some((f=>f.name===Z&&f.enabled))){var v;if(!1===(null===(v=this.parent.extensionOptions[Z])||void 0===v?void 0:v.enabled))throw new Error(`Required extension ${Z} is disabled`);throw new Error(`Required extension ${Z} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new N.d("__root__",this._babylonScene);this._rootBabylonMesh=f,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ne(!1);const v={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case P.j.AUTO:this._babylonScene.useRightHandedSystem||(v.rotation=[0,1,0,0],v.scale=[1,1,-1],r._LoadTransform(v,this._rootBabylonMesh));break;case P.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(f),v}loadSceneAsync(f,v){const Z=this._extensionsLoadSceneAsync(f,v);if(Z)return Z;const V=new Array;if(this.logOpen(`${f} ${v.name||""}`),v.nodes)for(const h of v.nodes){const v=p.Get(`${f}/nodes/${h}`,this._gltf.nodes,h);V.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(f=>{f.parent=this._rootBabylonMesh})))}for(const h of this._postSceneLoadActions)h();return V.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(V).then((()=>{}))}_forEachPrimitive(f,v){if(f._primitiveBabylonMeshes)for(const Z of f._primitiveBabylonMeshes)v(Z)}_getGeometries(){const f=[],v=this._gltf.nodes;if(v)for(const Z of v)this._forEachPrimitive(Z,(v=>{const Z=v.qh;Z&&-1===f.indexOf(Z)&&f.push(Z)}));return f}_getMeshes(){const f=[];this._rootBabylonMesh instanceof y.e&&f.push(this._rootBabylonMesh);const v=this._gltf.nodes;if(v)for(const Z of v)this._forEachPrimitive(Z,(v=>{f.push(v)}));return f}_getTransformNodes(){const f=[],v=this._gltf.nodes;if(v)for(const Z of v)Z._babylonTransformNode&&"Ie"===Z._babylonTransformNode.getClassName()&&f.push(Z._babylonTransformNode),Z._babylonTransformNodeForSkin&&f.push(Z._babylonTransformNodeForSkin);return f}_getSkeletons(){const f=[],v=this._gltf.skins;if(v)for(const Z of v)Z._data&&f.push(Z._data.babylonSkeleton);return f}_getAnimationGroups(){const f=[],v=this._gltf.animations;if(v)for(const Z of v)Z._babylonAnimationGroup&&f.push(Z._babylonAnimationGroup);return f}_startAnimations(){switch(this._parent.animationStartMode){case P.f.NONE:break;case P.f.FIRST:{const f=this._getAnimationGroups();0!==f.length&&f[0].start(!0);break}case P.f.ALL:{const f=this._getAnimationGroups();for(const v of f)v.start(!0);break}default:return void X.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadNodeAsync(f,v,Z);if(V)return V;if(v._babylonTransformNode)throw new Error(`${f}: Invalid recursive node hierarchy`);const h=new Array;this.logOpen(`${f} ${v.name||""}`);const J=V=>{if(r.AddPointerMetadata(V,f),r._LoadTransform(v,V),void 0!=v.camera){const Z=p.Get(`${f}/camera`,this._gltf.cameras,v.camera);h.push(this.loadCameraAsync(`/cameras/${Z.index}`,Z,(f=>{f.parent=V,this._babylonScene.useRightHandedSystem||(V.Ze.x=-1)})))}if(v.children)for(const Z of v.children){const v=p.Get(`${f}/children/${Z}`,this._gltf.nodes,Z);h.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(f=>{f.parent=V})))}Z(V)},l=void 0!=v.mesh,e=this._parent.loadSkins&&void 0!=v.skin;if(!l||e){const f=v.name||`node${v.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new s.e(f,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==v.mesh?v._babylonTransformNode=Z:v._babylonTransformNodeForSkin=Z,J(Z)}if(l)if(e){const Z=p.Get(`${f}/mesh`,this._gltf.meshes,v.mesh);h.push(this._loadMeshAsync(`/meshes/${Z.index}`,v,Z,(Z=>{const V=v._babylonTransformNodeForSkin;Z.metadata=(0,c.c)(V.metadata,Z.metadata||{});const J=p.Get(`${f}/skin`,this._gltf.skins,v.skin);h.push(this._loadSkinAsync(`/skins/${J.index}`,v,J,(f=>{this._forEachPrimitive(v,(v=>{v.skeleton=f})),this._postSceneLoadActions.push((()=>{if(void 0!=J.skeleton){const f=p.Get(`/skins/${J.index}/skeleton`,this._gltf.nodes,J.skeleton).parent;v.index===f.index?Z.parent=V.parent:Z.parent=f._babylonTransformNode}else Z.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:V,skinnedNode:Z})}))})))})))}else{const Z=p.Get(`${f}/mesh`,this._gltf.meshes,v.mesh);h.push(this._loadMeshAsync(`/meshes/${Z.index}`,v,Z,J))}return this.logClose(),Promise.all(h).then((()=>(this._forEachPrimitive(v,(f=>{const v=f;!v.isAnInstance&&v.qh&&v.qh.useBoundingInfoFromGeometry?f.wf():f.refreshBoundingInfo(!0,!0)})),v._babylonTransformNode)))}_loadMeshAsync(f,v,Z,V){const h=Z.primitives;if(!h||!h.length)throw new Error(`${f}: Primitives are missing`);void 0==h[0].index&&p.Assign(h);const J=new Array;this.logOpen(`${f} ${Z.name||""}`);const l=v.name||`node${v.index}`;if(1===h.length){const V=Z.primitives[0];J.push(this._loadMeshPrimitiveAsync(`${f}/primitives/${V.index}`,l,v,Z,V,(f=>{v._babylonTransformNode=f,v._primitiveBabylonMeshes=[f]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,v._babylonTransformNode=new s.e(l,this._babylonScene),v._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._primitiveBabylonMeshes=[];for(const V of h)J.push(this._loadMeshPrimitiveAsync(`${f}/primitives/${V.index}`,`${l}_primitive${V.index}`,v,Z,V,(f=>{f.parent=v._babylonTransformNode,v._primitiveBabylonMeshes.push(f)})))}return V(v._babylonTransformNode),this.logClose(),Promise.all(J).then((()=>v._babylonTransformNode))}_loadMeshPrimitiveAsync(f,v,Z,V,h,J){const l=this._extensionsLoadMeshPrimitiveAsync(f,v,Z,V,h,J);if(l)return l;this.logOpen(`${f}`);const e=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Z.skin&&!V.primitives[0].targets;let C,H;if(e&&h._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=h._instanceData.babylonSourceMesh.createInstance(v),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H=h._instanceData.promise;else{const J=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new N.d(v,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.sideOrientation=this._babylonScene.useRightHandedSystem?K.e.CounterClockWiseSideOrientation:K.e.ClockWiseSideOrientation,this._createMorphTargets(f,Z,V,h,l),J.push(this._loadVertexDataAsync(f,h,l).then((async v=>await this._loadMorphTargetsAsync(f,h,l,v).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,v.Pf(l),v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const O=r._GetDrawMode(f,h.mode);if(void 0==h.material){let f=this._defaultBabylonMaterialData[O];f||(f=this._createDefaultMaterial("__GLTFLoader._default",O),this._parent.onMaterialLoadedObservable.notifyObservers(f),this._defaultBabylonMaterialData[O]=f),l.material=f}else if(!this.parent.skipMaterials){const v=p.Get(`${f}/material`,this._gltf.materials,h.material);J.push(this._loadMaterialAsync(`/materials/${v.index}`,v,l,O,(f=>{l.material=f})))}H=Promise.all(J),e&&(h._instanceData={babylonSourceMesh:l,promise:H}),C=l}return r.AddPointerMetadata(C,f),this._parent.onMeshLoadedObservable.notifyObservers(C),J(C),this.logClose(),H.then((()=>C))}_loadVertexDataAsync(f,v,Z){const V=this._extensionsLoadVertexDataAsync(f,v,Z);if(V)return V;const h=v.attributes;if(!h)throw new Error(`${f}: Attributes are missing`);const J=new Array,l=new Y.c(Z.name,this._babylonScene);if(void 0==v.indices)Z.isUnIndexed=!0;else{const Z=p.Get(`${f}/indices`,this._gltf.accessors,v.indices);J.push(this._loadIndicesAccessorAsync(`/accessors/${Z.index}`,Z).then((f=>{l.setIndices(f)})))}const e=(v,V,e)=>{if(void 0==h[v])return;Z._delayInfo=Z._delayInfo||[],-1===Z._delayInfo.indexOf(V)&&Z._delayInfo.push(V);const C=p.Get(`${f}/attributes/${v}`,this._gltf.accessors,h[v]);J.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,V).then((f=>{if(f.getKind()===z.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Z.skeleton){const f=k(C);f&&(l._boundingInfo=f,l.useBoundingInfoFromGeometry=!0)}l.setVerticesBuffer(f,C.count)}))),V==z.g.MatricesIndicesExtraKind&&(Z.numBoneInfluencers=8),e&&e(C)};return e("POSITION",z.g.PositionKind),e("NORMAL",z.g.NormalKind),e("TANGENT",z.g.TangentKind),e("TEXCOORD_0",z.g.UVKind),e("TEXCOORD_1",z.g.UV2Kind),e("TEXCOORD_2",z.g.UV3Kind),e("TEXCOORD_3",z.g.UV4Kind),e("TEXCOORD_4",z.g.UV5Kind),e("TEXCOORD_5",z.g.UV6Kind),e("JOINTS_0",z.g.MatricesIndicesKind),e("WEIGHTS_0",z.g.MatricesWeightsKind),e("JOINTS_1",z.g.MatricesIndicesExtraKind),e("WEIGHTS_1",z.g.MatricesWeightsExtraKind),e("COLOR_0",z.g.ColorKind,(f=>{"VEC4"===f.type&&(Z.hasVertexAlpha=!0)})),Promise.all(J).then((()=>l))}_createMorphTargets(f,v,Z,V,h){if(!V.targets||!this._parent.loadMorphTargets)return;if(void 0==v._numMorphTargets)v._numMorphTargets=V.targets.length;else if(V.targets.length!==v._numMorphTargets)throw new Error(`${f}: Primitives do not have the same number of targets`);const J=Z.extras?Z.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,h.morphTargetManager=new B(this._babylonScene),h.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.morphTargetManager.areUpdatesFrozen=!0;for(let l=0;l<V.targets.length;l++){const f=v.weights?v.weights[l]:Z.weights?Z.weights[l]:0,V=J?J[l]:`morphTarget${l}`;h.morphTargetManager.addTarget(new i.e(V,f,h.Yf()))}}_loadMorphTargetsAsync(f,v,Z,V){if(!v.targets||!this._parent.loadMorphTargets)return Promise.resolve();const h=new Array,J=Z.morphTargetManager;for(let l=0;l<J.numTargets;l++){const Z=J.getTarget(l);h.push(this._loadMorphTargetVertexDataAsync(`${f}/targets/${l}`,V,v.targets[l],Z))}return Promise.all(h).then((()=>{J.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(f,v,Z,V){const h=new Array,J=(V,J,l)=>{if(void 0==Z[V])return;const e=v.getVertexBuffer(J);if(!e)return;const C=p.Get(`${f}/${V}`,this._gltf.accessors,Z[V]);h.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((f=>{l(e,f)})))};return J("POSITION",z.g.PositionKind,((f,v)=>{const Z=new Float32Array(v.length);f.forEach(v.length,((f,V)=>{Z[V]=v[V]+f})),V.setPositions(Z)})),J("NORMAL",z.g.NormalKind,((f,v)=>{const Z=new Float32Array(v.length);f.forEach(Z.length,((f,V)=>{Z[V]=v[V]+f})),V.setNormals(Z)})),J("TANGENT",z.g.TangentKind,((f,v)=>{const Z=new Float32Array(v.length/3*4);let h=0;f.forEach(v.length/3*4,((f,V)=>{(V+1)%4!==0&&(Z[h]=v[h]+f,h++)})),V.setTangents(Z)})),J("TEXCOORD_0",z.g.UVKind,((f,v)=>{const Z=new Float32Array(v.length);f.forEach(v.length,((f,V)=>{Z[V]=v[V]+f})),V.setUVs(Z)})),J("TEXCOORD_1",z.g.UV2Kind,((f,v)=>{const Z=new Float32Array(v.length);f.forEach(v.length,((f,V)=>{Z[V]=v[V]+f})),V.setUV2s(Z)})),J("COLOR_0",z.g.ColorKind,((v,Z)=>{let h=null;const J=v.getSize();if(3===J){h=new Float32Array(Z.length/3*4),v.forEach(Z.length,((f,v)=>{const V=Math.floor(v/3),J=v%3;h[4*V+J]=Z[3*V+J]+f}));for(let f=0;f<Z.length/3;++f)h[4*f+3]=1}else{if(4!==J)throw new Error(`${f}: Invalid number of components (${J}) for COLOR_0 attribute`);h=new Float32Array(Z.length),v.forEach(Z.length,((f,v)=>{h[v]=Z[v]+f}))}V.setColors(h)})),await Promise.all(h).then((()=>{}))}static _LoadTransform(f,v){if(void 0!=f.skin)return;let Z=h.Xv.Zero(),V=h.Quaternion.Identity(),J=h.Xv.One();if(f.matrix){h.Matrix.Av(f.matrix).decompose(J,V,Z)}else f.translation&&(Z=h.Xv.Av(f.translation)),f.rotation&&(V=h.Quaternion.Av(f.rotation)),f.scale&&(J=h.Xv.Av(f.scale));v.position=Z,v.rotationQuaternion=V,v.Ze=J}_loadSkinAsync(f,v,Z,V){if(!this._parent.loadSkins)return Promise.resolve();const h=this._extensionsLoadSkinAsync(f,v,Z);if(h)return h;if(Z._data)return V(Z._data.babylonSkeleton),Z._data.promise;const J=`skeleton${Z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new U(Z.name||J,J,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(f,Z,l);const e=this._loadSkinInverseBindMatricesDataAsync(f,Z).then((f=>{this._updateBoneMatrices(l,f)}));return Z._data={babylonSkeleton:l,promise:e},V(l),e}_loadBones(f,v,Z){if(void 0==v.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Z=this._findSkeletonRootNode(`${f}/joints`,v.joints);if(Z)if(void 0===v.skeleton)v.skeleton=Z.index;else{const V=(f,v)=>{for(;v.parent;v=v.parent)if(v.parent===f)return!0;return!1},h=p.Get(`${f}/skeleton`,this._gltf.nodes,v.skeleton);h===Z||V(h,Z)||(X.e.Warn(`${f}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),v.skeleton=Z.index)}else X.e.Warn(`${f}: Failed to find common root`)}const V={};for(const h of v.joints){const J=p.Get(`${f}/joints/${h}`,this._gltf.nodes,h);this._loadBone(J,v,Z,V)}}_findSkeletonRootNode(f,v){if(0===v.length)return null;const Z={};for(const h of v){const v=[];let V=p.Get(`${f}/${h}`,this._gltf.nodes,h);for(;-1!==V.index;)v.unshift(V),V=V.parent;Z[h]=v}let V=null;for(let h=0;;++h){let f=Z[v[0]];if(h>=f.length)return V;const J=f[h];for(let l=1;l<v.length;++l)if(f=Z[v[l]],h>=f.length||J!==f[h])return V;V=J}}_loadBone(f,v,Z,V){f._isJoint=!0;let h=V[f.index];if(h)return h;let J=null;f.index!==v.skeleton&&(f.parent&&-1!==f.parent.index?J=this._loadBone(f.parent,v,Z,V):void 0!==v.skeleton&&X.e.Warn(`/skins/${v.index}/skeleton: Skeleton node is not a common root`));const l=v.joints.indexOf(f.index);return h=new H.d(f.name||`joint${f.index}`,Z,J,this._getNodeMatrix(f),null,null,l),V[f.index]=h,this._postSceneLoadActions.push((()=>{h.linkTransformNode(f._babylonTransformNode)})),h}_loadSkinInverseBindMatricesDataAsync(f,v){if(void 0==v.inverseBindMatrices)return Promise.resolve(null);const Z=p.Get(`${f}/inverseBindMatrices`,this._gltf.accessors,v.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z)}_updateBoneMatrices(f,v){for(const Z of f.bones){const f=h.Matrix.Identity(),V=Z._index;v&&-1!==V&&(h.Matrix.FromArrayToRef(v,16*V,f),f.invertToRef(f));const J=Z.getParent();J&&f.multiplyToRef(J.getAbsoluteInverseBindMatrix(),f),Z.Eh(f,!1,!1),Z._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(f){return f.matrix?h.Matrix.Av(f.matrix):h.Matrix.Compose(f.scale?h.Xv.Av(f.scale):h.Xv.One(),f.rotation?h.Quaternion.Av(f.rotation):h.Quaternion.Identity(),f.translation?h.Xv.Av(f.translation):h.Xv.Zero())}loadCameraAsync(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadCameraAsync(f,v,Z);if(V)return V;const J=new Array;this.logOpen(`${f} ${v.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new C.d(v.name||`camera${v.index}`,h.Xv.Zero(),this._babylonScene,!1);switch(l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonCamera=l,l.setTarget(new h.Xv(0,0,-1)),v.type){case"perspective":{const Z=v.perspective;if(!Z)throw new Error(`${f}: Camera perspective properties are missing`);l.fov=Z.yfov,l.Lh=Z.znear,l.maxZ=Z.zfar||0;break}case"orthographic":if(!v.orthographic)throw new Error(`${f}: Camera orthographic properties are missing`);l.mode=e.d.ORTHOGRAPHIC_CAMERA,l.orthoLeft=-v.orthographic.xmag,l.orthoRight=v.orthographic.xmag,l.orthoBottom=-v.orthographic.ymag,l.orthoTop=v.orthographic.ymag,l.Lh=v.orthographic.znear,l.maxZ=v.orthographic.zfar;break;default:throw new Error(`${f}: Invalid camera type (${v.type})`)}return r.AddPointerMetadata(l,f),this._parent.onCameraLoadedObservable.notifyObservers(l),Z(l),this.logClose(),Promise.all(J).then((()=>l))}_loadAnimationsAsync(){const f=this._gltf.animations;if(!f)return Promise.resolve();const v=new Array;for(let Z=0;Z<f.length;Z++){const V=f[Z];v.push(this.loadAnimationAsync(`/animations/${V.index}`,V).then((f=>{0===f.targetedAnimations.length&&f.dispose()})))}return Promise.all(v).then((()=>{}))}loadAnimationAsync(f,v){const V=this._extensionsLoadAnimationAsync(f,v);return V||Z.e(78).then(Z.bind(Z,14513)).then((Z=>{let{AnimationGroup:V}=Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new V(v.name||`animation${v.index}`,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonAnimationGroup=h;const J=new Array;p.Assign(v.channels),p.Assign(v.samplers);for(const l of v.channels)J.push(this._loadAnimationChannelAsync(`${f}/channels/${l.index}`,f,v,l,((f,v)=>{f.animations=f.animations||[],f.animations.push(v),h.addTargetedAnimation(v,f)})));return Promise.all(J).then((()=>(h.normalize(0),h)))}))}async _loadAnimationChannelAsync(f,v,V,h,J){const l=this._extensionsLoadAnimationChannelAsync(f,v,V,h,J);if(l)return await l;if(void 0==h.target.node)return await Promise.resolve();const e=p.Get(`${f}/target/node`,this._gltf.nodes,h.target.node),C=h.target.path,H="weights"===C;if(H&&!e._numMorphTargets||!H&&!e._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!H&&!e._isJoint)return await Promise.resolve();let O;switch(await Promise.resolve().then(Z.bind(Z,13072)),C){case"translation":var u;O=null===(u=(0,q.g)("/nodes/{}/translation"))||void 0===u?void 0:u.interpolation;break;case"rotation":var W;O=null===(W=(0,q.g)("/nodes/{}/rotation"))||void 0===W?void 0:W.interpolation;break;case"scale":var a;O=null===(a=(0,q.g)("/nodes/{}/scale"))||void 0===a?void 0:a.interpolation;break;case"weights":var b;O=null===(b=(0,q.g)("/nodes/{}/weights"))||void 0===b?void 0:b.interpolation;break;default:throw new Error(`${f}/target/path: Invalid value (${h.target.path})`)}if(!O)throw new Error(`${f}/target/path: Could not find interpolation properties for target path (${h.target.path})`);const X={object:e,info:O};return await this._loadAnimationChannelFromTargetInfoAsync(f,v,V,h,X,J)}_loadAnimationChannelFromTargetInfoAsync(f,v,Z,V,h,J){const l=this.parent.targetFps,e=1/l,C=p.Get(`${f}/sampler`,Z.samplers,V.sampler);return this._loadAnimationSamplerAsync(`${v}/samplers/${V.sampler}`,C).then((f=>{let v=0;const C=h.object,H=h.info;for(const h of H){const H=h.getStride(C),O=f.input,u=f.output,W=new Array(O.length);let a=0;switch(f.interpolation){case"STEP":for(let f=0;f<O.length;f++){const v=h.getValue(C,u,a,1);a+=H,W[f]={frame:O[f]*l,value:v,interpolation:1}}break;case"CUBICSPLINE":for(let f=0;f<O.length;f++){const v=h.getValue(C,u,a,e);a+=H;const Z=h.getValue(C,u,a,1);a+=H;const V=h.getValue(C,u,a,e);a+=H,W[f]={frame:O[f]*l,inTangent:v,value:Z,outTangent:V}}break;case"LINEAR":for(let f=0;f<O.length;f++){const v=h.getValue(C,u,a,1);a+=H,W[f]={frame:O[f]*l,value:v}}}if(a>0){const f=`${Z.name||`animation${Z.index}`}_channel${V.index}_${v}`,e=h.buildAnimations(C,f,l,W);for(const Z of e)v++,J(Z.babylonAnimatable,Z.babylonAnimation)}}}))}_loadAnimationSamplerAsync(f,v){if(v._data)return v._data;const Z=v.interpolation||"LINEAR";switch(Z){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${f}/interpolation: Invalid value (${v.interpolation})`)}const V=p.Get(`${f}/input`,this._gltf.accessors,v.input),h=p.Get(`${f}/output`,this._gltf.accessors,v.output);return v._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${V.index}`,V),this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)]).then((f=>{let[v,V]=f;return{input:v,interpolation:Z,output:V}})),v._data}loadBufferAsync(f,v,Z,V){const h=this._extensionsLoadBufferAsync(f,v,Z,V);if(h)return h;if(!v._data)if(v.uri)v._data=this.loadUriAsync(`${f}/uri`,v,v.uri);else{if(!this._bin)throw new Error(`${f}: Uri is missing or the binary glTF is missing its binary chunk`);v._data=this._bin.readAsync(0,v.byteLength)}return v._data.then((v=>{try{return new Uint8Array(v.buffer,v.byteOffset+Z,V)}catch(h){throw new Error(`${f}: ${h.message}`)}}))}loadBufferViewAsync(f,v){const Z=this._extensionsLoadBufferViewAsync(f,v);if(Z)return Z;if(v._data)return v._data;const V=p.Get(`${f}/buffer`,this._gltf.buffers,v.buffer);return v._data=this.loadBufferAsync(`/buffers/${V.index}`,V,v.byteOffset||0,v.byteLength),v._data}_loadAccessorAsync(f,v,Z){if(v._data)return v._data;const V=r._GetNumComponents(f,v.type),h=V*z.g.GetTypeByteLength(v.componentType),J=V*v.count;if(void 0==v.bufferView)v._data=Promise.resolve(new Z(J));else{const l=p.Get(`${f}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((e=>{if(5126!==v.componentType||v.normalized||l.byteStride&&l.byteStride!==h){const f=new Z(J);return z.g.ForEach(e,v.byteOffset||0,l.byteStride||h,V,v.componentType,f.length,v.normalized||!1,((v,Z)=>{f[Z]=v})),f}return r._GetTypedArray(f,v.componentType,e,v.byteOffset,J)}))}if(v.sparse){const J=v.sparse;v._data=v._data.then((l=>{const e=l,C=p.Get(`${f}/sparse/indices/bufferView`,this._gltf.bufferViews,J.indices.bufferView),H=p.Get(`${f}/sparse/values/bufferView`,this._gltf.bufferViews,J.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${H.index}`,H)]).then((l=>{let[C,H]=l;const O=r._GetTypedArray(`${f}/sparse/indices`,J.indices.componentType,C,J.indices.byteOffset,J.count),u=V*J.count;let W;if(5126!==v.componentType||v.normalized){const l=r._GetTypedArray(`${f}/sparse/values`,v.componentType,H,J.values.byteOffset,u);W=new Z(u),z.g.ForEach(l,0,h,V,v.componentType,W.length,v.normalized||!1,((f,v)=>{W[v]=f}))}else W=r._GetTypedArray(`${f}/sparse/values`,v.componentType,H,J.values.byteOffset,u);let a=0;for(let f=0;f<O.length;f++){let v=O[f]*V;for(let f=0;f<V;f++)e[v++]=W[a++]}return e}))}))}return v._data}_loadFloatAccessorAsync(f,v){return this._loadAccessorAsync(f,v,Float32Array)}_loadIndicesAccessorAsync(f,v){if("SCALAR"!==v.type)throw new Error(`${f}/type: Invalid value ${v.type}`);if(5121!==v.componentType&&5123!==v.componentType&&5125!==v.componentType)throw new Error(`${f}/componentType: Invalid value ${v.componentType}`);if(v._data)return v._data;if(v.sparse){const Z=r._GetTypedArrayConstructor(`${f}/componentType`,v.componentType);v._data=this._loadAccessorAsync(f,v,Z)}else{const Z=p.Get(`${f}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>r._GetTypedArray(f,v.componentType,Z,v.byteOffset,v.count)))}return v._data}_loadVertexBufferViewAsync(f){if(f._babylonBuffer)return f._babylonBuffer;const v=this._babylonScene.getEngine();return f._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((f=>new z.e(v,f,!1))),f._babylonBuffer}_loadVertexAccessorAsync(f,v,Z){var V;if(null!==(V=v._babylonVertexBuffer)&&void 0!==V&&V[Z])return v._babylonVertexBuffer[Z];v._babylonVertexBuffer||(v._babylonVertexBuffer={});const h=this._babylonScene.getEngine();if(v.sparse||void 0==v.bufferView)v._babylonVertexBuffer[Z]=this._loadFloatAccessorAsync(f,v).then((f=>new z.g(h,f,Z,!1)));else{const V=p.Get(`${f}/bufferView`,this._gltf.bufferViews,v.bufferView);v._babylonVertexBuffer[Z]=this._loadVertexBufferViewAsync(V).then((J=>{const l=r._GetNumComponents(f,v.type);return new z.g(h,J,Z,!1,void 0,V.byteStride,void 0,v.byteOffset,l,v.componentType,v.normalized,!0,void 0,!0)}))}return v._babylonVertexBuffer[Z]}_loadMaterialMetallicRoughnessPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return v&&(v.baseColorFactor?(Z.albedoColor=J.Mv.Av(v.baseColorFactor),Z.alpha=v.baseColorFactor[3]):Z.albedoColor=J.Mv.White(),Z.metallic=void 0==v.metallicFactor?1:v.metallicFactor,Z.roughness=void 0==v.roughnessFactor?1:v.roughnessFactor,v.baseColorTexture&&V.push(this.loadTextureInfoAsync(`${f}/baseColorTexture`,v.baseColorTexture,(f=>{f.name=`${Z.name} (Base Color)`,Z.albedoTexture=f}))),v.metallicRoughnessTexture&&(v.metallicRoughnessTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${f}/metallicRoughnessTexture`,v.metallicRoughnessTexture,(f=>{f.name=`${Z.name} (Metallic Roughness)`,Z.metallicTexture=f}))),Z.useMetallnessFromMetallicTextureBlue=!0,Z.useRoughnessFromMetallicTextureGreen=!0,Z.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(V).then((()=>{}))}_loadMaterialAsync(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const J=this._extensionsLoadMaterialAsync(f,v,Z,V,h);if(J)return J;v._data=v._data||{};let l=v._data[V];if(!l){this.logOpen(`${f} ${v.name||""}`);const Z=this.createMaterial(f,v,V);l={babylonMaterial:Z,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(f,v,Z)},v._data[V]=l,r.AddPointerMetadata(Z,f),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this.logClose()}return Z&&(l.babylonMeshes.push(Z),Z.Kh.addOnce((()=>{const f=l.babylonMeshes.indexOf(Z);-1!==f&&l.babylonMeshes.splice(f,1)}))),h(l.babylonMaterial),l.promise.then((()=>l.babylonMaterial))}_createDefaultMaterial(f,v){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new M.c(f,this._babylonScene);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.fillMode=v,Z.enableSpecularAntiAliasing=!0,Z.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Z.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Z.transparencyMode=M.c.PBRMATERIAL_OPAQUE,Z.metallic=1,Z.roughness=1,Z}createMaterial(f,v,Z){const V=this._extensionsCreateMaterial(f,v,Z);if(V)return V;const h=v.name||`material${v.index}`;return this._createDefaultMaterial(h,Z)}loadMaterialPropertiesAsync(f,v,Z){const V=this._extensionsLoadMaterialPropertiesAsync(f,v,Z);if(V)return V;const h=new Array;return h.push(this.loadMaterialBasePropertiesAsync(f,v,Z)),v.pbrMetallicRoughness&&h.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${f}/pbrMetallicRoughness`,v.pbrMetallicRoughness,Z)),this.loadMaterialAlphaProperties(f,v,Z),Promise.all(h).then((()=>{}))}loadMaterialBasePropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return Z.emissiveColor=v.emissiveFactor?J.Mv.Av(v.emissiveFactor):new J.Mv(0,0,0),v.doubleSided&&(Z.nh=!1,Z.twoSidedLighting=!0),v.normalTexture&&(v.normalTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${f}/normalTexture`,v.normalTexture,(f=>{f.name=`${Z.name} (Normal)`,Z.bumpTexture=f}))),Z.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Z.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=v.normalTexture.scale&&Z.bumpTexture&&(Z.bumpTexture.level=v.normalTexture.scale),Z.forceIrradianceInFragment=!0),v.occlusionTexture&&(v.occlusionTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${f}/occlusionTexture`,v.occlusionTexture,(f=>{f.name=`${Z.name} (Occlusion)`,Z.ambientTexture=f}))),Z.useAmbientInGrayScale=!0,void 0!=v.occlusionTexture.strength&&(Z.ambientTextureStrength=v.occlusionTexture.strength)),v.emissiveTexture&&V.push(this.loadTextureInfoAsync(`${f}/emissiveTexture`,v.emissiveTexture,(f=>{f.name=`${Z.name} (Emissive)`,Z.emissiveTexture=f}))),Promise.all(V).then((()=>{}))}loadMaterialAlphaProperties(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);switch(v.alphaMode||"OPAQUE"){case"OPAQUE":Z.transparencyMode=M.c.PBRMATERIAL_OPAQUE,Z.alpha=1;break;case"MASK":Z.transparencyMode=M.c.PBRMATERIAL_ALPHATEST,Z.alphaCutOff=void 0==v.alphaCutoff?.5:v.alphaCutoff,Z.albedoTexture&&(Z.albedoTexture.th=!0);break;case"BLEND":Z.transparencyMode=M.c.PBRMATERIAL_ALPHABLEND,Z.albedoTexture&&(Z.albedoTexture.th=!0,Z.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${f}/alphaMode: Invalid value (${v.alphaMode})`)}}loadTextureInfoAsync(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadTextureInfoAsync(f,v,Z);if(V)return V;if(this.logOpen(`${f}`),v.texCoord>=6)throw new Error(`${f}/texCoord: Invalid value (${v.texCoord})`);const h=p.Get(`${f}/index`,this._gltf.textures,v.index);h._textureInfo=v;const J=this._loadTextureAsync(`/textures/${v.index}`,h,(V=>{V.coordinatesIndex=v.texCoord||0,r.AddPointerMetadata(V,f),this._parent.onTextureLoadedObservable.notifyObservers(V),Z(V)}));return this.logClose(),J}_loadTextureAsync(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadTextureAsync(f,v,Z);if(V)return V;this.logOpen(`${f} ${v.name||""}`);const h=void 0==v.sampler?r.DefaultSampler:p.Get(`${f}/sampler`,this._gltf.samplers,v.sampler),J=p.Get(`${f}/source`,this._gltf.images,v.source),l=this._createTextureAsync(f,h,J,Z,void 0,!v._textureInfo.nonColorData);return this.logClose(),l}_createTextureAsync(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},J=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0;const e=this._loadSampler(`/samplers/${v.index}`,v),C=new Array,H=new V;this._babylonScene._blockEntityCollection=!!this._assetContainer;const O={noMipmap:e.noMipMaps,invertY:!1,samplingMode:e.samplingMode,R:()=>{this._disposed||H.resolve()},onError:(v,Z)=>{this._disposed||H.reject(new Error(`${f}: ${Z&&Z.message?Z.message:v||"Failed to load texture"}`))},mimeType:Z.mimeType??(0,g.i)(Z.uri??""),loaderOptions:J,useSRGBBuffer:!!l&&this._parent.useSRGBBuffers},u=new A.e(null,this._babylonScene,O);return u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(H.promise),C.push(this.loadImageAsync(`/images/${Z.index}`,Z).then((f=>{const v=Z.uri||`${this._fileName}#image${Z.index}`,V=`data:${this._uniqueRootUrl}${v}`;u.updateURL(V,f);const h=u.getInternalTexture();h&&(h.label=Z.name)}))),u.wrapU=e.wrapU,u.wrapV=e.wrapV,h(u),this._parent.useGltfTextureNames&&(u.name=Z.name||Z.uri||`image${Z.index}`),Promise.all(C).then((()=>u))}_loadSampler(f,v){return v._data||(v._data={noMipMaps:9728===v.minFilter||9729===v.minFilter,samplingMode:r._GetTextureSamplingMode(f,v),wrapU:r._GetTextureWrapMode(`${f}/wrapS`,v.wrapS),wrapV:r._GetTextureWrapMode(`${f}/wrapT`,v.wrapT)}),v._data}loadImageAsync(f,v){if(!v._data){if(this.logOpen(`${f} ${v.name||""}`),v.uri)v._data=this.loadUriAsync(`${f}/uri`,v,v.uri);else{const Z=p.Get(`${f}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}this.logClose()}return v._data}loadUriAsync(f,v,Z){const V=this._extensionsLoadUriAsync(f,v,Z);if(V)return V;if(!r._ValidateUri(Z))throw new Error(`${f}: '${Z}' is invalid`);if((0,g.m)(Z)){const v=new Uint8Array((0,g.d)(Z));return this.log(`${f}: Decoded ${Z.substring(0,64)}... (${v.length} bytes)`),Promise.resolve(v)}return this.log(`${f}: Loading ${Z}`),this._parent.preprocessUrlAsync(this._rootUrl+Z).then((v=>new Promise(((V,h)=>{this._parent._loadFile(this._babylonScene,v,(v=>{this._disposed||(this.log(`${f}: Loaded ${Z} (${v.byteLength} bytes)`),V(new Uint8Array(v)))}),!0,(v=>{h(new g.q(`${f}: Failed to load '${Z}'${v?": "+v.status+" "+v.statusText:""}`,v))}))}))))}static AddPointerMetadata(f,v){f.metadata=f.metadata||{};const Z=f._internalMetadata=f._internalMetadata||{},V=Z.yh=Z.yh||{};(V.pointers=V.pointers||[]).push(v)}static _GetTextureWrapMode(f,v){switch(v=void 0==v?10497:v){case 33071:return A.e.CLAMP_ADDRESSMODE;case 33648:return A.e.MIRROR_ADDRESSMODE;case 10497:return A.e.WRAP_ADDRESSMODE;default:return X.e.Warn(`${f}: Invalid value (${v})`),A.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(f,v){const Z=void 0==v.magFilter?9729:v.magFilter,V=void 0==v.minFilter?9987:v.minFilter;if(9729===Z)switch(V){case 9728:return A.e.LINEAR_NEAREST;case 9729:return A.e.LINEAR_LINEAR;case 9984:return A.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return A.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return A.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return A.e.LINEAR_LINEAR_MIPLINEAR;default:return X.e.Warn(`${f}/minFilter: Invalid value (${V})`),A.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Z&&X.e.Warn(`${f}/magFilter: Invalid value (${Z})`),V){case 9728:return A.e.NEAREST_NEAREST;case 9729:return A.e.NEAREST_LINEAR;case 9984:return A.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return A.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return A.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return A.e.NEAREST_LINEAR_MIPLINEAR;default:return X.e.Warn(`${f}/minFilter: Invalid value (${V})`),A.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(f,v){try{return(0,m.q)(v)}catch(Z){throw new Error(`${f}: ${Z.message}`)}}static _GetTypedArray(f,v,Z,V,h){const J=Z.buffer;V=Z.byteOffset+(V||0);const l=r._GetTypedArrayConstructor(`${f}/componentType`,v),e=z.g.GetTypeByteLength(v);return V%e!==0?(X.e.Warn(`${f}: Copying buffer as byte offset (${V}) is not a multiple of component type byte length (${e})`),new l(J.slice(V,V+h*e),0)):new l(J,V,h)}static _GetNumComponents(f,v){switch(v){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${f}: Invalid type (${v})`)}static _ValidateUri(f){return l.Tools.IsBase64(f)||-1===f.indexOf("..")}static _GetDrawMode(f,v){switch(void 0==v&&(v=4),v){case 0:return K.e.PointListDrawMode;case 1:return K.e.LineListDrawMode;case 2:return K.e.LineLoopDrawMode;case 3:return K.e.LineStripDrawMode;case 4:return K.e.TriangleFillMode;case 5:return K.e.TriangleStripDrawMode;case 6:return K.e.TriangleFanDrawMode}throw new Error(`${f}: Invalid mesh primitive mode (${v})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const f=new Array;if(this._gltf.materials)for(const v of this._gltf.materials)if(v._data)for(const Z in v._data){const V=v._data[Z];for(const v of V.babylonMeshes){v.jh(!0);const Z=V.babylonMaterial;f.push(Z.forceCompilationAsync(v)),f.push(Z.forceCompilationAsync(v,{useInstances:!0})),this._parent.useClipPlane&&(f.push(Z.forceCompilationAsync(v,{clipPlane:!0})),f.push(Z.forceCompilationAsync(v,{clipPlane:!0,useInstances:!0})))}}return Promise.all(f).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const f=new Array,v=this._babylonScene.lights;for(const Z of v){const v=Z.getShadowGenerator();v&&f.push(v.forceCompilationAsync())}return Promise.all(f).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(f){for(const v of this._extensions)v.enabled&&f(v)}_applyExtensions(f,v,Z){for(const V of this._extensions)if(V.enabled){const h=`${V.name}.${v}`,J=f;J._activeLoaderExtensionFunctions=J._activeLoaderExtensionFunctions||{};const l=J._activeLoaderExtensionFunctions;if(!l[h]){l[h]=!0;try{const f=Z(V);if(f)return f}finally{delete l[h]}}}return null}_extensionsOnLoading(){this._forEachExtensions((f=>f.onLoading&&f.onLoading()))}_extensionsOnReady(){this._forEachExtensions((f=>f.onReady&&f.onReady()))}_extensionsLoadSceneAsync(f,v){return this._applyExtensions(v,"loadScene",(Z=>Z.loadSceneAsync&&Z.loadSceneAsync(f,v)))}_extensionsLoadNodeAsync(f,v,Z){return this._applyExtensions(v,"loadNode",(V=>V.loadNodeAsync&&V.loadNodeAsync(f,v,Z)))}_extensionsLoadCameraAsync(f,v,Z){return this._applyExtensions(v,"loadCamera",(V=>V.loadCameraAsync&&V.loadCameraAsync(f,v,Z)))}_extensionsLoadVertexDataAsync(f,v,Z){return this._applyExtensions(v,"loadVertexData",(V=>V._loadVertexDataAsync&&V._loadVertexDataAsync(f,v,Z)))}_extensionsLoadMeshPrimitiveAsync(f,v,Z,V,h,J){return this._applyExtensions(h,"loadMeshPrimitive",(l=>l._loadMeshPrimitiveAsync&&l._loadMeshPrimitiveAsync(f,v,Z,V,h,J)))}_extensionsLoadMaterialAsync(f,v,Z,V,h){return this._applyExtensions(v,"loadMaterial",(J=>J._loadMaterialAsync&&J._loadMaterialAsync(f,v,Z,V,h)))}_extensionsCreateMaterial(f,v,Z){return this._applyExtensions(v,"createMaterial",(V=>V.createMaterial&&V.createMaterial(f,v,Z)))}_extensionsLoadMaterialPropertiesAsync(f,v,Z){return this._applyExtensions(v,"loadMaterialProperties",(V=>V.loadMaterialPropertiesAsync&&V.loadMaterialPropertiesAsync(f,v,Z)))}_extensionsLoadTextureInfoAsync(f,v,Z){return this._applyExtensions(v,"loadTextureInfo",(V=>V.loadTextureInfoAsync&&V.loadTextureInfoAsync(f,v,Z)))}_extensionsLoadTextureAsync(f,v,Z){return this._applyExtensions(v,"loadTexture",(V=>V._loadTextureAsync&&V._loadTextureAsync(f,v,Z)))}_extensionsLoadAnimationAsync(f,v){return this._applyExtensions(v,"loadAnimation",(Z=>Z.loadAnimationAsync&&Z.loadAnimationAsync(f,v)))}_extensionsLoadAnimationChannelAsync(f,v,Z,V,h){return this._applyExtensions(Z,"loadAnimationChannel",(J=>J._loadAnimationChannelAsync&&J._loadAnimationChannelAsync(f,v,Z,V,h)))}_extensionsLoadSkinAsync(f,v,Z){return this._applyExtensions(Z,"loadSkin",(V=>V._loadSkinAsync&&V._loadSkinAsync(f,v,Z)))}_extensionsLoadUriAsync(f,v,Z){return this._applyExtensions(v,"loadUri",(V=>V._loadUriAsync&&V._loadUriAsync(f,v,Z)))}_extensionsLoadBufferViewAsync(f,v){return this._applyExtensions(v,"loadBufferView",(Z=>Z.loadBufferViewAsync&&Z.loadBufferViewAsync(f,v)))}_extensionsLoadBufferAsync(f,v,Z,V){return this._applyExtensions(v,"loadBuffer",(h=>h.loadBufferAsync&&h.loadBufferAsync(f,v,Z,V)))}static LoadExtensionAsync(f,v,Z,V){if(!v.extensions)return null;const h=v.extensions[Z];return h?V(`${f}/extensions/${Z}`,h):null}static LoadExtraAsync(f,v,Z,V){if(!v.extras)return null;const h=v.extras[Z];return h?V(`${f}/extras/${Z}`,h):null}isExtensionUsed(f){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(f)}logOpen(f){this._parent._logOpen(f)}logClose(){this._parent._logClose()}log(f){this._parent._log(f)}startPerformanceCounter(f){this._parent._startPerformanceCounter(f)}endPerformanceCounter(f){this._parent._endPerformanceCounter(f)}}r.DefaultSampler={index:-1},P.c._CreateGLTF2Loader=f=>new r(f);var o=Z(13072),G=Z(11599),Q=Z(11462),d=Z(13080),x=Z(13082);class R extends x.e{constructor(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",f),this._texture=f.getEngine().createRawCubeTexture(v,Z,V,h,J,l,e,C)}update(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,f,v,Z,V,h)}updateRGBDAsync(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,d.k)(this._texture,f,v,Z,V).then((()=>{}))}clone(){return Q.b.Clone((()=>{const f=this.Yf(),v=this._texture,Z=new R(f,v._bufferViewArray,v.width,v.format,v.type,v.generateMipMaps,v.invertY,v.samplingMode,v._compression);return 13===v.source&&Z.updateRGBDAsync(v._bufferViewArrayArray,v._sphericalPolynomial,v._lodGenerationScale,v._lodGenerationOffset),Z}),this)}}const n="EXT_lights_image_based";class S{constructor(f){this.name=n,this._loader=f,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.yh.extensions;if(f&&f[this.name]){const v=f[this.name];this._lights=v.lights}}loadSceneAsync(f,v){return r.LoadExtensionAsync(f,v,this.name,(async(Z,V)=>{this._loader._allMaterialsDirtyRequired=!0;const h=new Array;h.push(this._loader.loadSceneAsync(f,v)),this._loader.logOpen(`${Z}`);const J=p.Get(`${Z}/light`,this._lights,V.Vh);return h.push(this._loadLightAsync(`/extensions/${this.name}/lights/${V.Vh}`,J).then((f=>{this._loader.babylonScene.environmentTexture=f}))),this._loader.logClose(),await Promise.all(h).then((()=>{}))}))}_loadLightAsync(f,v){if(!v._loaded){const Z=new Array;this._loader.logOpen(`${f}`);const V=new Array(v.specularImages.length);for(let h=0;h<v.specularImages.length;h++){const J=v.specularImages[h];V[h]=new Array(J.length);for(let v=0;v<J.length;v++){const l=`${f}/specularImages/${h}/${v}`;this._loader.logOpen(`${l}`);const e=J[v],C=p.Get(l,this._loader.yh.images,e);Z.push(this._loader.loadImageAsync(`/images/${e}`,C).then((f=>{V[h][v]=f}))),this._loader.logClose()}}this._loader.logClose(),v._loaded=Promise.all(Z).then((async()=>{const Z=new R(this._loader.babylonScene,null,v.specularImageSize);if(Z.name=v.name||"environment",v._babylonTexture=Z,void 0!=v.Ke&&(Z.level=v.Ke),v.rotation){let f=h.Quaternion.Av(v.rotation);this._loader.babylonScene.useRightHandedSystem||(f=h.Quaternion.Inverse(f)),h.Matrix.FromQuaternionToRef(f,Z.getReflectionTextureMatrix())}if(!v.irradianceCoefficients)throw new Error(`${f}: Irradiance coefficients are missing`);const J=G.c.Av(v.irradianceCoefficients);J.scaleInPlace(v.Ke),J.convertIrradianceToLambertianRadiance();const l=G.g.FromHarmonics(J),e=(V.length-1)/Math.log2(v.specularImageSize);return await Z.updateRGBDAsync(V,l,e)}))}return v._loaded.then((()=>v._babylonTexture))}}j(n),E(n,!0,(f=>new S(f)));Z(11960);const D="EXT_mesh_gpu_instancing";class ff{constructor(f){this.name=D,this._loader=f,this.enabled=this._loader.isExtensionUsed(D)}dispose(){this._loader=null}loadNodeAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(f,V)=>{this._loader._disableInstancedMesh++;const J=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,Z);if(this._loader._disableInstancedMesh--,!v._primitiveBabylonMeshes)return await J;const l=new Array;let e=0;const C=v=>{if(void 0==V.attributes[v])return void l.push(Promise.resolve(null));const Z=p.Get(`${f}/attributes/${v}`,this._loader.yh.accessors,V.attributes[v]);if(l.push(this._loader._loadFloatAccessorAsync(`/accessors/${Z.bufferView}`,Z)),0===e)e=Z.count;else if(e!==Z.count)throw new Error(`${f}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),await J.then((async f=>{const[Z,V,J]=await Promise.all(l),C=new Float32Array(16*e);h.TmpVectors.Xv[0].fe(0,0,0),h.TmpVectors.Quaternion[0].fe(0,0,0,1),h.TmpVectors.Xv[1].fe(1,1,1);for(let v=0;v<e;++v)Z&&h.Xv.FromArrayToRef(Z,3*v,h.TmpVectors.Xv[0]),V&&h.Quaternion.FromArrayToRef(V,4*v,h.TmpVectors.Quaternion[0]),J&&h.Xv.FromArrayToRef(J,3*v,h.TmpVectors.Xv[1]),h.Matrix.ComposeToRef(h.TmpVectors.Xv[1],h.TmpVectors.Quaternion[0],h.TmpVectors.Xv[0],h.TmpVectors.Matrix[0]),h.TmpVectors.Matrix[0].copyToArray(C,16*v);for(const h of v._primitiveBabylonMeshes)h.Au("matrix",C,16,!0);return f}))}))}}j(D),E(D,!0,(f=>new ff(f)));let vf=0,Zf=null;class Vf{static get Default(){return Vf._Default||(Vf._Default=new Vf),Vf._Default}constructor(){const f=Vf.Configuration.decoder;this._decoderModulePromise=l.Tools.LoadBabylonScriptAsync(f.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(f,v,Z,V,h){await this._decoderModulePromise,0===vf&&(MeshoptDecoder.useWorkers(1),vf=1);const J=await MeshoptDecoder.decodeGltfBufferAsync(v,Z,f,V,h);return null!==Zf&&clearTimeout(Zf),Zf=setTimeout((()=>{MeshoptDecoder.useWorkers(0),vf=0,Zf=null}),1e3),J}}Vf.Configuration={decoder:{url:`${l.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Vf._Default=null;const hf="EXT_meshopt_compression";class Jf{constructor(f){this.name=hf,this.enabled=f.isExtensionUsed(hf),this._loader=f}dispose(){this._loader=null}loadBufferViewAsync(f,v){return r.LoadExtensionAsync(f,v,this.name,(async(Z,V)=>{const h=v;if(h._meshOptData)return await h._meshOptData;const J=p.Get(`${f}/buffer`,this._loader.yh.buffers,V.buffer);return h._meshOptData=this._loader.loadBufferAsync(`/buffers/${J.index}`,J,V.byteOffset||0,V.byteLength).then((async f=>await Vf.Default.decodeGltfBufferAsync(f,V.count,V.byteStride,V.mode,V.filter))),await h._meshOptData}))}}j(hf),E(hf,!0,(f=>new Jf(f)));const lf="EXT_texture_webp";class ef{constructor(f){this.name=lf,this._loader=f,this.enabled=f.isExtensionUsed(lf)}dispose(){this._loader=null}_loadTextureAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=void 0==v.sampler?r.DefaultSampler:p.Get(`${f}/sampler`,this._loader.yh.samplers,v.sampler),l=p.Get(`${V}/source`,this._loader.yh.images,h.source);return await this._loader._createTextureAsync(f,J,l,(f=>{Z(f)}),void 0,!v._textureInfo.nonColorData)}))}}j(lf),E(lf,!0,(f=>new ef(f)));const Cf="EXT_texture_avif";class Hf{constructor(f){this.name=Cf,this._loader=f,this.enabled=f.isExtensionUsed(Cf)}dispose(){this._loader=null}_loadTextureAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=void 0==v.sampler?r.DefaultSampler:p.Get(`${f}/sampler`,this._loader.yh.samplers,v.sampler),l=p.Get(`${V}/source`,this._loader.yh.images,h.source);return await this._loader._createTextureAsync(f,J,l,(f=>{Z(f)}),void 0,!v._textureInfo.nonColorData)}))}}j(Cf),E(Cf,!0,(f=>new Hf(f)));var Of=Z(13067),uf=Z(11942);const Wf="EXT_lights_ies";class af{constructor(f){this.name=Wf,this._loader=f,this.enabled=this._loader.isExtensionUsed(Wf)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.yh.extensions;if(f&&f[this.name]){const v=f[this.name];this._lights=v.lights,p.Assign(this._lights)}}loadNodeAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,l)=>{let e,C;this._loader._allMaterialsDirtyRequired=!0;const H=await this._loader.loadNodeAsync(f,v,(f=>{C=p.Get(V,this._lights,l.Vh);const v=C.name||f.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e=new Of.c(v,h.Xv.Zero(),h.Xv.Backward(),0,1,this._loader.babylonScene),e.angle=Math.PI/2,e.innerAngle=0,e._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=e,e.falloffType=uf.c.FALLOFF_GLTF,e.Me=l.color?J.Mv.Av(l.color):J.Mv.White(),e.Ke=l.multiplier||1,e.range=Number.MAX_VALUE,e.parent=f,this._loader._babylonLights.push(e),r.AddPointerMetadata(e,V),Z(f)}));let O;if(C.uri)O=await this._loader.loadUriAsync(f,C,C.uri);else{const v=p.Get(`${f}/bufferView`,this._loader.yh.bufferViews,C.bufferView);O=await this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}return e.iesProfileTexture=new A.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,O,!0,void 0,void 0,void 0,void 0,".ies"),H}))}}j(Wf),E(Wf,!0,(f=>new af(f)));var bf=Z(13097);const Xf="KHR_draco_mesh_compression";class Ff{constructor(f){this.name=Xf,this.useNormalizedFlagFromAccessor=!0,this._loader=f,this.enabled=bf.c.DefaultAvailable&&this._loader.isExtensionUsed(Xf)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{if(void 0!=v.mode&&4!==v.mode&&5!==v.mode)throw new Error(`${f}: Unsupported mode ${v.mode}`);const J={},l={},e=(f,V)=>{const e=h.attributes[f];if(void 0!=e&&(Z._delayInfo=Z._delayInfo||[],-1===Z._delayInfo.indexOf(V)&&Z._delayInfo.push(V),J[V]=e,this.useNormalizedFlagFromAccessor)){const Z=p.TryGet(this._loader.yh.accessors,v.attributes[f]);Z&&(l[V]=Z.normalized||!1)}};e("POSITION",z.g.PositionKind),e("NORMAL",z.g.NormalKind),e("TANGENT",z.g.TangentKind),e("TEXCOORD_0",z.g.UVKind),e("TEXCOORD_1",z.g.UV2Kind),e("TEXCOORD_2",z.g.UV3Kind),e("TEXCOORD_3",z.g.UV4Kind),e("TEXCOORD_4",z.g.UV5Kind),e("TEXCOORD_5",z.g.UV6Kind),e("JOINTS_0",z.g.MatricesIndicesKind),e("WEIGHTS_0",z.g.MatricesWeightsKind),e("COLOR_0",z.g.ColorKind);const C=p.Get(V,this._loader.yh.bufferViews,h.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((async V=>{const h=this.dracoDecoder||bf.c.Default,e=p.TryGet(this._loader.yh.accessors,v.attributes.POSITION),C=this._loader.parent.alwaysComputeBoundingBox||Z.skeleton||!e?null:k(e);return await h._decodeMeshToGeometryForGltfAsync(Z.name,this._loader.babylonScene,V,J,l,C).catch((v=>{throw new Error(`${f}: ${v.message}`)}))}))),await C._dracoBabylonGeometry}))}}j(Xf),E(Xf,!0,(f=>new Ff(f)));var Uf=Z(13103),Kf=Z(11405),Mf=Z(11410),Af=Z(11824),sf=Z(11984),zf=Z(11372);Af.c.AddNodeConstructor("Light_Type_0",((f,v)=>()=>new Yf(f,h.Xv.Zero(),v)));class Yf extends sf.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(f){this._shadowAngle=f,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(f){const v=this.needCube();if(this._direction=f,this.needCube()!==v&&this._shadowGenerators){const f=this._shadowGenerators.values();for(let v=f.next();!0!==v.done;v=f.next()){v.value.recreateShadowMap()}}}constructor(f,v,Z){super(f,Z),this._shadowAngle=Math.PI/2,this.position=v}getClassName(){return"PointLight"}getTypeID(){return uf.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(f){if(this.direction)return super.getShadowDirection(f);switch(f){case 0:return new h.Xv(1,0,0);case 1:return new h.Xv(-1,0,0);case 2:return new h.Xv(0,-1,0);case 3:return new h.Xv(0,1,0);case 4:return new h.Xv(0,0,1);case 5:return new h.Xv(0,0,-1)}return h.Xv.Zero()}_setDefaultShadowProjectionMatrix(f,v,Z){const V=this.Yf().activeCamera;if(!V)return;const J=void 0!==this.shadowMinZ?this.shadowMinZ:V.Lh,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,e=this.Yf().getEngine().useReverseDepthBuffer;h.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,e?l:J,e?J:l,f,!0,this._scene.getEngine().isNDCHalfZRange,void 0,e)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(f,v){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,v):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,v),this}transferToNodeMaterialEffect(f,v){return this.computeTransformedInformation()?f.setFloat3(v,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):f.setFloat3(v,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(f,v){f["POINTLIGHT"+v]=!0}}(0,Kf.d)([(0,Mf.F)()],Yf.prototype,"shadowAngle",null),(0,zf.h)("BABYLON.PointLight",Yf);const yf="KHR_lights_punctual";class Nf{constructor(f){this.name=yf,this._loader=f,this.enabled=this._loader.isExtensionUsed(yf)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.yh.extensions;if(f&&f[this.name]){const v=f[this.name];this._lights=v.lights,p.Assign(this._lights)}}loadNodeAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,l)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(f,v,(f=>{let v;const e=p.Get(V,this._lights,l.Vh),C=e.name||f.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e.type){case"directional":{const f=new Uf.e(C,h.Xv.Backward(),this._loader.babylonScene);f.position.Ve(0),v=f;break}case"point":v=new Yf(C,h.Xv.Zero(),this._loader.babylonScene);break;case"spot":{const f=new Of.c(C,h.Xv.Zero(),h.Xv.Backward(),0,1,this._loader.babylonScene);f.angle=2*(e.spot&&e.spot.outerConeAngle||Math.PI/4),f.innerAngle=2*(e.spot&&e.spot.innerConeAngle||0),v=f;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${V}: Invalid light type (${e.type})`)}v._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=v,v.falloffType=uf.c.FALLOFF_GLTF,v.Me=e.color?J.Mv.Av(e.color):J.Mv.White(),v.Ke=void 0==e.Ke?1:e.Ke,v.range=void 0==e.range?Number.MAX_VALUE:e.range,v.parent=f,this._loader._babylonLights.push(v),r.AddPointerMetadata(v,V),Z(f)})))))}}j(yf),E(yf,!0,(f=>new Nf(f)));const If="KHR_materials_pbrSpecularGlossiness";class Tf{constructor(f){this.name=If,this.order=200,this._loader=f,this.enabled=this._loader.isExtensionUsed(If)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialBasePropertiesAsync(f,v,Z)),J.push(this._loadSpecularGlossinessPropertiesAsync(V,h,Z)),this._loader.loadMaterialAlphaProperties(f,v,Z),await Promise.all(J).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return Z.metallic=null,Z.roughness=null,v.diffuseFactor?(Z.albedoColor=J.Mv.Av(v.diffuseFactor),Z.alpha=v.diffuseFactor[3]):Z.albedoColor=J.Mv.White(),Z.reflectivityColor=v.specularFactor?J.Mv.Av(v.specularFactor):J.Mv.White(),Z.microSurface=void 0==v.glossinessFactor?1:v.glossinessFactor,v.diffuseTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTexture`,v.diffuseTexture,(f=>{f.name=`${Z.name} (Diffuse)`,Z.albedoTexture=f}))),v.specularGlossinessTexture&&(V.push(this._loader.loadTextureInfoAsync(`${f}/specularGlossinessTexture`,v.specularGlossinessTexture,(f=>{f.name=`${Z.name} (Specular Glossiness)`,Z.reflectivityTexture=f,Z.reflectivityTexture.th=!0}))),Z.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(V).then((()=>{}))}}j(If),E(If,!0,(f=>new Tf(f)));const Bf="KHR_materials_unlit";class Pf{constructor(f){this.name=Bf,this.order=210,this._loader=f,this.enabled=this._loader.isExtensionUsed(Bf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async()=>await this._loadUnlitPropertiesAsync(f,v,Z)))}_loadUnlitPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;Z.unlit=!0;const h=v.pbrMetallicRoughness;return h&&(h.baseColorFactor?(Z.albedoColor=J.Mv.Av(h.baseColorFactor),Z.alpha=h.baseColorFactor[3]):Z.albedoColor=J.Mv.White(),h.baseColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/baseColorTexture`,h.baseColorTexture,(f=>{f.name=`${Z.name} (Base Color)`,Z.albedoTexture=f})))),v.doubleSided&&(Z.nh=!1,Z.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(f,v,Z),Promise.all(V).then((()=>{}))}}j(Bf),E(Bf,!0,(f=>new Pf(f)));const gf="KHR_materials_clearcoat";class wf{constructor(f){this.name=gf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(gf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadClearCoatPropertiesAsync(V,h,Z)),await Promise.all(J)}))}_loadClearCoatPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return Z.clearCoat.isEnabled=!0,Z.clearCoat.useRoughnessFromMainTexture=!1,Z.clearCoat.remapF0OnInterfaceChange=!1,void 0!=v.clearcoatFactor?Z.clearCoat.Ke=v.clearcoatFactor:Z.clearCoat.Ke=0,v.clearcoatTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatTexture`,v.clearcoatTexture,(f=>{f.name=`${Z.name} (ClearCoat)`,Z.clearCoat.texture=f}))),void 0!=v.clearcoatRoughnessFactor?Z.clearCoat.roughness=v.clearcoatRoughnessFactor:Z.clearCoat.roughness=0,v.clearcoatRoughnessTexture&&(v.clearcoatRoughnessTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatRoughnessTexture`,v.clearcoatRoughnessTexture,(f=>{f.name=`${Z.name} (ClearCoat Roughness)`,Z.clearCoat.textureRoughness=f})))),v.clearcoatNormalTexture&&(v.clearcoatNormalTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatNormalTexture`,v.clearcoatNormalTexture,(f=>{f.name=`${Z.name} (ClearCoat Normal)`,Z.clearCoat.bumpTexture=f}))),Z.invertNormalMapX=!Z.Yf().useRightHandedSystem,Z.invertNormalMapY=Z.Yf().useRightHandedSystem,void 0!=v.clearcoatNormalTexture.scale&&(Z.clearCoat.bumpTexture.level=v.clearcoatNormalTexture.scale)),Promise.all(V).then((()=>{}))}}j(gf),E(gf,!0,(f=>new wf(f)));const tf="KHR_materials_iridescence";class Lf{constructor(f){this.name=tf,this.order=195,this._loader=f,this.enabled=this._loader.isExtensionUsed(tf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadIridescencePropertiesAsync(V,h,Z)),await Promise.all(J).then((()=>{}))}))}_loadIridescencePropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return Z.iridescence.isEnabled=!0,Z.iridescence.Ke=v.iridescenceFactor??0,Z.iridescence.indexOfRefraction=v.iridescenceIor??v.iridescenceIOR??1.3,Z.iridescence.minimumThickness=v.iridescenceThicknessMinimum??100,Z.iridescence.maximumThickness=v.iridescenceThicknessMaximum??400,v.iridescenceTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/iridescenceTexture`,v.iridescenceTexture,(f=>{f.name=`${Z.name} (Iridescence)`,Z.iridescence.texture=f}))),v.iridescenceThicknessTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/iridescenceThicknessTexture`,v.iridescenceThicknessTexture,(f=>{f.name=`${Z.name} (Iridescence Thickness)`,Z.iridescence.thicknessTexture=f}))),Promise.all(V).then((()=>{}))}}j(tf),E(tf,!0,(f=>new Lf(f)));const Ef="KHR_materials_anisotropy";class jf{constructor(f){this.name=Ef,this.order=195,this._loader=f,this.enabled=this._loader.isExtensionUsed(Ef)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadIridescencePropertiesAsync(V,h,Z)),await Promise.all(J)}))}async _loadIridescencePropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;Z.anisotropy.isEnabled=!0,Z.anisotropy.Ke=v.anisotropyStrength??0,Z.anisotropy.angle=v.anisotropyRotation??0,v.anisotropyTexture&&(v.anisotropyTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${f}/anisotropyTexture`,v.anisotropyTexture,(f=>{f.name=`${Z.name} (Anisotropy Intensity)`,Z.anisotropy.texture=f})))),await Promise.all(V)}}j(Ef),E(Ef,!0,(f=>new jf(f)));const qf="KHR_materials_emissive_strength";class cf{constructor(f){this.name=qf,this.order=170,this._loader=f,this.enabled=this._loader.isExtensionUsed(qf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>await this._loader.loadMaterialPropertiesAsync(f,v,Z).then((()=>{this._loadEmissiveProperties(V,h,Z)}))))}_loadEmissiveProperties(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);void 0!==v.emissiveStrength&&(Z.emissiveIntensity=v.emissiveStrength)}}j(qf),E(qf,!0,(f=>new cf(f)));const mf="KHR_materials_sheen";class pf{constructor(f){this.name=mf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(mf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadSheenPropertiesAsync(V,h,Z)),await Promise.all(J).then((()=>{}))}))}_loadSheenPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return Z.sheen.isEnabled=!0,Z.sheen.Ke=1,void 0!=v.sheenColorFactor?Z.sheen.color=J.Mv.Av(v.sheenColorFactor):Z.sheen.color=J.Mv.Black(),v.sheenColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/sheenColorTexture`,v.sheenColorTexture,(f=>{f.name=`${Z.name} (Sheen Color)`,Z.sheen.texture=f}))),void 0!==v.sheenRoughnessFactor?Z.sheen.roughness=v.sheenRoughnessFactor:Z.sheen.roughness=0,v.sheenRoughnessTexture&&(v.sheenRoughnessTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${f}/sheenRoughnessTexture`,v.sheenRoughnessTexture,(f=>{f.name=`${Z.name} (Sheen Roughness)`,Z.sheen.textureRoughness=f})))),Z.sheen.albedoScaling=!0,Z.sheen.useRoughnessFromMainTexture=!1,Promise.all(V).then((()=>{}))}}j(mf),E(mf,!0,(f=>new pf(f)));var kf=Z(11887);const rf="KHR_materials_specular";class of{constructor(f){this.name=rf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(rf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;if(J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadSpecularPropertiesAsync(V,h,Z)),h.extensions&&h.extensions.EXT_materials_specular_edge_color&&Z instanceof M.c){h.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Z.brdf.dielectricSpecularModel=kf.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Z.brdf.conductorSpecularModel=kf.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(J).then((()=>{}))}))}_loadSpecularPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return void 0!==v.specularFactor&&(Z.metallicF0Factor=v.specularFactor),void 0!==v.specularColorFactor&&(Z.metallicReflectanceColor=J.Mv.Av(v.specularColorFactor)),v.specularTexture&&(v.specularTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${f}/specularTexture`,v.specularTexture,(f=>{f.name=`${Z.name} (Specular)`,Z.metallicReflectanceTexture=f,Z.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),v.specularColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/specularColorTexture`,v.specularColorTexture,(f=>{f.name=`${Z.name} (Specular Color)`,Z.reflectanceTexture=f}))),Promise.all(V).then((()=>{}))}}j(rf),E(rf,!0,(f=>new of(f)));const Gf="KHR_materials_ior";class Qf{constructor(f){this.name=Gf,this.order=180,this._loader=f,this.enabled=this._loader.isExtensionUsed(Gf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadIorPropertiesAsync(V,h,Z)),await Promise.all(J).then((()=>{}))}))}_loadIorPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);return void 0!==v.ior?Z.indexOfRefraction=v.ior:Z.indexOfRefraction=Qf._DEFAULT_IOR,Promise.resolve()}}Qf._DEFAULT_IOR=1.5,j(Gf),E(Gf,!0,(f=>new Qf(f)));const df="KHR_materials_variants";class xf{constructor(f){this.name=df,this._loader=f,this.enabled=this._loader.isExtensionUsed(df)}dispose(){this._loader=null}static GetAvailableVariants(f){const v=this._GetExtensionMetadata(f);return v?Object.keys(v.variants):[]}getAvailableVariants(f){return xf.GetAvailableVariants(f)}static SelectVariant(f,v){const Z=this._GetExtensionMetadata(f);if(!Z)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${df} extension`);const V=f=>{const v=Z.variants[f];if(v)for(const Z of v)Z.mesh.material=Z.material};if(v instanceof Array)for(const h of v)V(h);else V(v);Z.lastSelected=v}selectVariant(f,v){xf.SelectVariant(f,v)}static Reset(f){const v=this._GetExtensionMetadata(f);if(!v)throw new Error(`Cannot reset on a glTF mesh that does not have the ${df} extension`);for(const Z of v.original)Z.mesh.material=Z.material;v.lastSelected=null}reset(f){xf.Reset(f)}static GetLastSelectedVariant(f){const v=this._GetExtensionMetadata(f);if(!v)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${df} extension`);return v.lastSelected}getLastSelectedVariant(f){return xf.GetLastSelectedVariant(f)}static _GetExtensionMetadata(f){var v,Z;return(null===f||void 0===f||null===(v=f._internalMetadata)||void 0===v||null===(Z=v.yh)||void 0===Z?void 0:Z[df])||null}onLoading(){const f=this._loader.yh.extensions;if(f&&f[this.name]){const v=f[this.name];this._variants=v.variants}}onReady(){const f=this._loader.rootBabylonMesh;if(f){var v;const Z=this._loader.parent.extensionOptions[df];null!==Z&&void 0!==Z&&Z.defaultVariant&&xf.SelectVariant(f,Z.defaultVariant),null===Z||void 0===Z||null===(v=Z.onLoaded)||void 0===v||v.call(Z,{get variants(){return xf.GetAvailableVariants(f)},get selectedVariant(){const v=xf.GetLastSelectedVariant(f);return v?Array.isArray(v)?v[0]:v:xf.GetAvailableVariants(f)[0]},set selectedVariant(v){xf.SelectVariant(f,v)}})}}_loadMeshPrimitiveAsync(f,v,Z,V,h,J){return r.LoadExtensionAsync(f,h,this.name,(async(l,e)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(f,v,Z,V,h,(v=>{if(J(v),v instanceof N.d){const Z=r._GetDrawMode(f,h.mode),V=this._loader.rootBabylonMesh,J=V?V._internalMetadata=V._internalMetadata||{}:{},H=J.yh=J.yh||{},O=H[df]=H[df]||{lastSelected:null,original:[],variants:{}};O.original.push({mesh:v,material:v.material});for(let f=0;f<e.mappings.length;++f){const h=e.mappings[f],J=p.Get(`${l}/mappings/${f}/material`,this._loader.yh.materials,h.material);C.push(this._loader._loadMaterialAsync(`#/materials/${h.material}`,J,v,Z,(f=>{for(let Z=0;Z<h.variants.length;++Z){const J=h.variants[Z],l=p.Get(`/extensions/${df}/variants/${J}`,this._variants,J);O.variants[l.name]=O.variants[l.name]||[],O.variants[l.name].push({mesh:v,material:f}),v.onClonedObservable.add((f=>{const Z=f;let h=null,J=Z;do{if(J=J.parent,!J)return;h=xf._GetExtensionMetadata(J)}while(null===h);if(V&&h===xf._GetExtensionMetadata(V)){J._internalMetadata={};for(const f in V._internalMetadata)J._internalMetadata[f]=V._internalMetadata[f];J._internalMetadata.yh=[];for(const f in V._internalMetadata.yh)J._internalMetadata.yh[f]=V._internalMetadata.yh[f];J._internalMetadata.yh[df]={lastSelected:null,original:[],variants:{}};for(const f of h.original)J._internalMetadata.yh[df].original.push({mesh:f.mesh,material:f.material});for(const f in h.variants)if(Object.prototype.hasOwnProperty.call(h.variants,f)){J._internalMetadata.yh[df].variants[f]=[];for(const v of h.variants[f])J._internalMetadata.yh[df].variants[f].push({mesh:v.mesh,material:v.material})}h=J._internalMetadata.yh[df]}for(const V of h.original)V.mesh===v&&(V.mesh=Z);for(const V of h.variants[l.name])V.mesh===v&&(V.mesh=Z)}))}})))}}}))),await Promise.all(C).then((f=>{let[v]=f;return v}))}))}}j(df),E(df,!0,(f=>new xf(f)));var Rf=Z(11489);class nf{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:kf.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(f,v){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...nf._GetDefaultOptions(),...f},this._scene=v,this._scene._transmissionHelper=this,this.onErrorObservable=new O.c,this._scene.Kh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(f){if(!Object.keys(f).filter((v=>this._options[v]!==f[v])).length)return;const v={...this._options,...f},Z=this._options;this._options=v,v.renderSize===Z.renderSize&&v.renderTargetTextureType===Z.renderTargetTextureType&&v.generateMipmaps===Z.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=v.samples,this._opaqueRenderTarget.lodGenerationScale=v.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=v.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(f){return!!f&&!!(f instanceof M.c&&f.subSurface.isRefractionEnabled)}_addMesh(f){this._materialObservers[f.uniqueId]=f.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),l.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(f.material)?(f.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(f)&&this._transparentMeshesCache.push(f)):-1===this._opaqueMeshesCache.indexOf(f)&&this._opaqueMeshesCache.push(f)}))}_removeMesh(f){f.onMaterialChangedObservable.remove(this._materialObservers[f.uniqueId]),delete this._materialObservers[f.uniqueId];let v=this._transparentMeshesCache.indexOf(f);-1!==v&&this._transparentMeshesCache.splice(v,1),v=this._opaqueMeshesCache.indexOf(f),-1!==v&&this._opaqueMeshesCache.splice(v,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(f){const v=this._transparentMeshesCache.indexOf(f),Z=this._opaqueMeshesCache.indexOf(f);this._shouldRenderAsTransmission(f.material)?(f.material instanceof M.c&&(f.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Z?(this._opaqueMeshesCache.splice(Z,1),this._transparentMeshesCache.push(f)):-1===v&&this._transparentMeshesCache.push(f)):-1!==v?(this._transparentMeshesCache.splice(v,1),this._opaqueMeshesCache.push(f)):-1===Z&&this._opaqueMeshesCache.push(f)}_isRenderTargetValid(){var f;return null!==(null===(f=this._opaqueRenderTarget)||void 0===f?void 0:f.getInternalTexture())}_setupRenderTargets(){var f;let v;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Rf.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(f=this._options.clearColor)||void 0===f?void 0:f.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((f=>{v=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?f.clearColor.h(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(f.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=v}));for(const Z of this._transparentMeshesCache)this._shouldRenderAsTransmission(Z.material)&&(Z.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Sf="KHR_materials_transmission";class Df{constructor(f){this.name=Sf,this.order=175,this._loader=f,this.enabled=this._loader.isExtensionUsed(Sf),this.enabled&&(f.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadTransparentPropertiesAsync(V,v,Z,h)),await Promise.all(J).then((()=>{}))}))}_loadTransparentPropertiesAsync(f,v,Z,V){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const h=Z;if(h.subSurface.isRefractionEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.useAlbedoToTintRefraction=!0,void 0===V.transmissionFactor)return h.subSurface.refractionIntensity=0,h.subSurface.isRefractionEnabled=!1,Promise.resolve();{var J;h.subSurface.refractionIntensity=V.transmissionFactor;const f=h.Yf();if(h.subSurface.refractionIntensity&&!f._transmissionHelper)new nf({},h.Yf());else if(h.subSurface.refractionIntensity&&(null===(J=f._transmissionHelper)||void 0===J||!J._isRenderTargetValid())){var l;null===(l=f._transmissionHelper)||void 0===l||l._setupRenderTargets()}}return h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,V.transmissionTexture?(V.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${f}/transmissionTexture`,V.transmissionTexture,void 0).then((f=>{f.name=`${Z.name} (Transmission)`,h.subSurface.refractionIntensityTexture=f,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(Sf),E(Sf,!0,(f=>new Df(f)));const fv="KHR_materials_diffuse_transmission";class vv{constructor(f){this.name=fv,this.order=174,this._loader=f,this.enabled=this._loader.isExtensionUsed(fv),this.enabled&&(f.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadTranslucentPropertiesAsync(V,v,Z,h)),await Promise.all(J).then((()=>{}))}))}_loadTranslucentPropertiesAsync(f,v,Z,V){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const h=Z;if(h.subSurface.isTranslucencyEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,h.subSurface.useAlbedoToTintTranslucency=!1,void 0===V.diffuseTransmissionFactor)return h.subSurface.translucencyIntensity=0,h.subSurface.isTranslucencyEnabled=!1,Promise.resolve();h.subSurface.translucencyIntensity=V.diffuseTransmissionFactor;const l=new Array;return h.subSurface.useGltfStyleTextures=!0,V.diffuseTransmissionTexture&&(V.diffuseTransmissionTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTransmissionTexture`,V.diffuseTransmissionTexture).then((f=>{f.name=`${Z.name} (Diffuse Transmission)`,h.subSurface.translucencyIntensityTexture=f})))),void 0!==V.diffuseTransmissionColorFactor?h.subSurface.translucencyColor=J.Mv.Av(V.diffuseTransmissionColorFactor):h.subSurface.translucencyColor=J.Mv.White(),V.diffuseTransmissionColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTransmissionColorTexture`,V.diffuseTransmissionColorTexture).then((f=>{f.name=`${Z.name} (Diffuse Transmission Color)`,h.subSurface.translucencyColorTexture=f}))),Promise.all(l).then((()=>{}))}}j(fv),E(fv,!0,(f=>new vv(f)));const Zv="KHR_materials_volume";class Vv{constructor(f){this.name=Zv,this.order=173,this._loader=f,this.enabled=this._loader.isExtensionUsed(Zv),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadVolumePropertiesAsync(V,v,Z,h)),await Promise.all(J).then((()=>{}))}))}_loadVolumePropertiesAsync(f,v,Z,V){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);if(!Z.subSurface.isRefractionEnabled&&!Z.subSurface.isTranslucencyEnabled||!V.thicknessFactor)return Promise.resolve();Z.subSurface.volumeIndexOfRefraction=Z.indexOfRefraction;const h=void 0!==V.attenuationDistance?V.attenuationDistance:Number.MAX_VALUE;return Z.subSurface.tintColorAtDistance=h,void 0!==V.attenuationColor&&3==V.attenuationColor.length&&Z.subSurface.tintColor.fe(V.attenuationColor[0],V.attenuationColor[1],V.attenuationColor[2]),Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=V.thicknessFactor,Z.subSurface.useThicknessAsDepth=!0,V.thicknessTexture?(V.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${f}/thicknessTexture`,V.thicknessTexture).then((f=>{f.name=`${Z.name} (Thickness)`,Z.subSurface.thicknessTexture=f,Z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(Zv),E(Zv,!0,(f=>new Vv(f)));const hv="KHR_materials_dispersion";class Jv{constructor(f){this.name=hv,this.order=174,this._loader=f,this.enabled=this._loader.isExtensionUsed(hv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadDispersionPropertiesAsync(V,v,Z,h)),await Promise.all(J).then((()=>{}))}))}_loadDispersionPropertiesAsync(f,v,Z,V){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);return Z.subSurface.isRefractionEnabled&&V.dispersion?(Z.subSurface.isDispersionEnabled=!0,Z.subSurface.dispersion=V.dispersion,Promise.resolve()):Promise.resolve()}}j(hv),E(hv,!0,(f=>new Jv(f)));const lv="EXT_materials_diffuse_roughness";class ev{constructor(f){this.name=lv,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(lv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(f,v,Z)),J.push(this._loadDiffuseRoughnessPropertiesAsync(V,h,Z)),await Promise.all(J).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(f,v,Z){if(!(Z instanceof M.c))throw new Error(`${f}: Material type not supported`);const V=new Array;return Z.brdf.baseDiffuseModel=kf.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=v.diffuseRoughnessFactor?Z.baseDiffuseRoughness=v.diffuseRoughnessFactor:Z.baseDiffuseRoughness=0,v.diffuseRoughnessTexture&&V.push(this._loader.loadTextureInfoAsync(`${f}/diffuseRoughnessTexture`,v.diffuseRoughnessTexture,(f=>{f.name=`${Z.name} (Diffuse Roughness)`,Z.baseDiffuseRoughnessTexture=f}))),Promise.all(V).then((()=>{}))}}j(lv),E(lv,!0,(f=>new ev(f)));const Cv="KHR_mesh_quantization";class Hv{constructor(f){this.name=Cv,this.enabled=f.isExtensionUsed(Cv)}dispose(){}}j(Cv),E(Cv,!0,(f=>new Hv(f)));const Ov="KHR_texture_basisu";class uv{constructor(f){this.name=Ov,this._loader=f,this.enabled=f.isExtensionUsed(Ov)}dispose(){this._loader=null}_loadTextureAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>{const J=void 0==v.sampler?r.DefaultSampler:p.Get(`${f}/sampler`,this._loader.yh.samplers,v.sampler),l=p.Get(`${V}/source`,this._loader.yh.images,h.source);return await this._loader._createTextureAsync(f,J,l,(f=>{Z(f)}),v._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!v._textureInfo.nonColorData)}))}}j(Ov),E(Ov,!0,(f=>new uv(f)));const Wv="KHR_texture_transform";class av{constructor(f){this.name=Wv,this._loader=f,this.enabled=this._loader.isExtensionUsed(Wv)}dispose(){this._loader=null}loadTextureInfoAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(V,h)=>await this._loader.loadTextureInfoAsync(f,v,(f=>{if(!(f instanceof A.e))throw new Error(`${V}: Texture type not supported`);h.offset&&(f.uOffset=h.offset[0],f.vOffset=h.offset[1]),f.uRotationCenter=0,f.vRotationCenter=0,h.rotation&&(f.wAng=-h.rotation),h.scale&&(f.uScale=h.scale[0],f.vScale=h.scale[1]),void 0!=h.texCoord&&(f.coordinatesIndex=h.texCoord),Z(f)}))))}}j(Wv),E(Wv,!0,(f=>new av(f)));const bv="KHR_xmp_json_ld";class Xv{constructor(f){this.name=bv,this.order=100,this._loader=f,this.enabled=this._loader.isExtensionUsed(bv)}dispose(){this._loader=null}onLoading(){var f,v,Z;if(null===this._loader.rootBabylonMesh)return;const V=null===(f=this._loader.yh.extensions)||void 0===f?void 0:f.KHR_xmp_json_ld,h=null===(v=this._loader.yh.asset)||void 0===v||null===(Z=v.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld;if(V&&h){const f=+h.packet;V.packets&&f<V.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=V.packets[f])}}}function Fv(f,v,Z,V){return J.Mv.Av(v,Z).scale(V)}function Uv(f,v,Z,V){return v[Z]*V}function Kv(f,v,Z,V){return-v[Z]*V}function Mv(f,v,Z,V){return v[Z+1]*V}function Av(f,v,Z,V){return v[Z]*V*2}function sv(f){return{scale:[new Yv(W.b.ANIMATIONTYPE_FLOAT,`${f}.uScale`,Uv,(()=>2)),new Yv(W.b.ANIMATIONTYPE_FLOAT,`${f}.vScale`,Mv,(()=>2))],offset:[new Yv(W.b.ANIMATIONTYPE_FLOAT,`${f}.uOffset`,Uv,(()=>2)),new Yv(W.b.ANIMATIONTYPE_FLOAT,`${f}.vOffset`,Mv,(()=>2))],rotation:[new Yv(W.b.ANIMATIONTYPE_FLOAT,`${f}.wAng`,Kv,(()=>1))]}}j(bv),E(bv,!0,(f=>new Xv(f)));class zv extends o.AnimationPropertyInfo{buildAnimations(f,v,Z,V){return[{babylonAnimatable:f._babylonCamera,babylonAnimation:this._buildAnimation(v,Z,V)}]}}class Yv extends o.AnimationPropertyInfo{buildAnimations(f,v,Z,V){const h=[];for(const J in f._data)h.push({babylonAnimatable:f._data[J].babylonMaterial,babylonAnimation:this._buildAnimation(v,Z,V)});return h}}class yv extends o.AnimationPropertyInfo{buildAnimations(f,v,Z,V){return[{babylonAnimatable:f._babylonLight,babylonAnimation:this._buildAnimation(v,Z,V)}]}}(0,q.j)("/cameras/{}/orthographic/xmag",[new zv(W.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Kv,(()=>1)),new zv(W.b.ANIMATIONTYPE_FLOAT,"orthoRight",Mv,(()=>1))]),(0,q.j)("/cameras/{}/orthographic/ymag",[new zv(W.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Kv,(()=>1)),new zv(W.b.ANIMATIONTYPE_FLOAT,"orthoTop",Mv,(()=>1))]),(0,q.j)("/cameras/{}/orthographic/zfar",[new zv(W.b.ANIMATIONTYPE_FLOAT,"maxZ",Uv,(()=>1))]),(0,q.j)("/cameras/{}/orthographic/znear",[new zv(W.b.ANIMATIONTYPE_FLOAT,"Lh",Uv,(()=>1))]),(0,q.j)("/cameras/{}/perspective/yfov",[new zv(W.b.ANIMATIONTYPE_FLOAT,"fov",Uv,(()=>1))]),(0,q.j)("/cameras/{}/perspective/zfar",[new zv(W.b.ANIMATIONTYPE_FLOAT,"maxZ",Uv,(()=>1))]),(0,q.j)("/cameras/{}/perspective/znear",[new zv(W.b.ANIMATIONTYPE_FLOAT,"Lh",Uv,(()=>1))]),(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Yv(W.b.ANIMATIONTYPE_COLOR3,"albedoColor",Fv,(()=>4)),new Yv(W.b.ANIMATIONTYPE_FLOAT,"alpha",(function(f,v,Z,V){return v[Z+3]*V}),(()=>4))]),(0,q.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"metallic",Uv,(()=>1))]),(0,q.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"roughness",Uv,(()=>1))]);const Nv=sv("albedoTexture");(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Nv.scale),(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Nv.offset),(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Nv.rotation);const iv=sv("metallicTexture");(0,q.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",iv.scale),(0,q.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",iv.offset),(0,q.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",iv.rotation),(0,q.j)("/materials/{}/emissiveFactor",[new Yv(W.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Fv,(()=>3))]);const Iv=sv("bumpTexture");(0,q.j)("/materials/{}/normalTexture/scale",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Uv,(()=>1))]),(0,q.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Iv.scale),(0,q.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Iv.offset),(0,q.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Iv.rotation),(0,q.j)("/materials/{}/occlusionTexture/strength",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Uv,(()=>1))]);const Tv=sv("ambientTexture");(0,q.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Tv.scale),(0,q.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Tv.offset),(0,q.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Tv.rotation);const Bv=sv("emissiveTexture");(0,q.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Bv.scale),(0,q.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Bv.offset),(0,q.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Bv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Uv,(()=>1))]);const Pv=sv("anisotropy.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Pv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Pv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Pv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Uv,(()=>1))]);const gv=sv("clearCoat.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",gv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",gv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",gv.rotation);const wv=sv("clearCoat.bumpTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",wv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",wv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",wv.rotation);const tv=sv("clearCoat.textureRoughness");(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",tv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",tv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",tv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Uv,(()=>1))]);const Lv=sv("iridescence.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Lv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Lv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Lv.rotation);const Ev=sv("iridescence.thicknessTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ev.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ev.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ev.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Yv(W.b.ANIMATIONTYPE_COLOR3,"sheen.color",Fv,(()=>3))]),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Uv,(()=>1))]);const jv=sv("sheen.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",jv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",jv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",jv.rotation);const qv=sv("sheen.textureRoughness");(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",qv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",qv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",qv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Yv(W.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Fv,(()=>3))]);const cv=sv("metallicReflectanceTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",cv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",cv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",cv.rotation);const mv=sv("reflectanceTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",mv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",mv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",mv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Uv,(()=>1))]);const pv=sv("subSurface.refractionIntensityTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",pv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",pv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",pv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Yv(W.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Fv,(()=>3))]),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Uv,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Uv,(()=>1))]);const kv=sv("subSurface.thicknessTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",kv.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",kv.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",kv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Yv(W.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Uv,(()=>1))]);const rv=sv("subSurface.translucencyIntensityTexture");(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",rv.scale),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",rv.offset),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",rv.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Yv(W.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Fv,(()=>3))]);const ov=sv("subSurface.translucencyColorTexture");(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",ov.scale),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",ov.offset),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",ov.rotation),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new yv(W.b.ANIMATIONTYPE_COLOR3,"diffuse",Fv,(()=>3))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new yv(W.b.ANIMATIONTYPE_FLOAT,"intensity",Uv,(()=>1))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new yv(W.b.ANIMATIONTYPE_FLOAT,"range",Uv,(()=>1))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new yv(W.b.ANIMATIONTYPE_FLOAT,"innerAngle",Av,(()=>1))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new yv(W.b.ANIMATIONTYPE_FLOAT,"angle",Av,(()=>1))]),(0,q.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new yv(W.b.ANIMATIONTYPE_COLOR3,"diffuse",Fv,(()=>3))]),(0,q.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new yv(W.b.ANIMATIONTYPE_FLOAT,"intensity",Uv,(()=>1))]);const Gv="KHR_animation_pointer";class Qv{constructor(f){this.name=Gv,this._loader=f,this._pathToObjectConverter=(0,q.h)(this._loader.yh)}get enabled(){return this._loader.isExtensionUsed(Gv)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(f,v,Z,V,h){var J;const l=null===(J=V.target.extensions)||void 0===J?void 0:J.KHR_animation_pointer;if(!l||!this._pathToObjectConverter)return null;"pointer"!==V.target.path&&X.e.Warn(`${f}/target/path: Value (${V.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=V.target.node&&X.e.Warn(`${f}/target/node: Value (${V.target.node}) must not be present when using the ${this.name} extension`);const e=`${f}/extensions/${this.name}`,C=l.pointer;if(!C)throw new Error(`${e}: Pointer is missing`);try{const J=this._pathToObjectConverter.convert(C);if(!J.info.interpolation)throw new Error(`${e}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(f,v,Z,V,{object:J.object,info:J.info.interpolation},h)}catch(H){return X.e.Warn(`${e}/pointer: Invalid pointer (${C}) skipped`),null}}}j(Gv),E(Gv,!0,(f=>new Qv(f)));class dv{constructor(f,v,Z){this.frame=f,this.action=v,this.onlyOnce=Z,this.isDone=!1}_clone(){return new dv(this.frame,this.action,this.onlyOnce)}}var xv=Z(11263),Rv=Z(11318),nv=Z(11316);class Sv{get loop(){return this._loop}set loop(f){f!==this._loop&&(this._loop=f,this.updateOptions({loop:f}))}get currentTime(){var f;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.audioContext&&(this.isPlaying||this.isPaused)){const f=this.isPaused?0:Rv.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+f}return 0}get spatialSound(){return this._spatialSound}set spatialSound(f){if(f==this._spatialSound)return;const v=this.isPlaying;this.pause(),f?(this._spatialSound=f,this._updateSpatialParameters()):this._disableSpatialSound(),v&&this.play()}constructor(f,v,Z){var V;let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new O.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=h.Xv.Zero(),this._localDirection=new h.Xv(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=f,Z=Z||b.c.LastCreatedScene)if(this._scene=Z,Sv._SceneComponentInitialization(Z),this._readyToPlayCallback=J,this._customAttenuationFunction=(f,v,Z,V,h)=>v<Z?f*(1-v/Z):0,e&&(this.autoplay=e.autoplay||!1,this._loop=e.loop||!1,void 0!==e.volume&&(this._volume=e.volume),this._spatialSound=e.spatialSound??!1,this.maxDistance=e.maxDistance??100,this.useCustomAttenuation=e.useCustomAttenuation??!1,this.rolloffFactor=e.rolloffFactor||1,this.refDistance=e.refDistance||1,this.distanceModel=e.distanceModel||"linear",this._playbackRate=e.playbackRate||1,this._streaming=e.streaming??!1,this._length=e.length,this._offset=e.offset),null!==(V=Rv.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&Rv.b.audioEngine.audioContext){this._soundGain=Rv.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let f=!0;if(v)try{"string"===typeof v?(this._urlType="String",this._url=v):v instanceof ArrayBuffer?this._urlType="ArrayBuffer":v instanceof HTMLMediaElement?this._urlType="MediaElement":v instanceof MediaStream?this._urlType="MediaStream":v instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(v)&&(this._urlType="Array");let Z=[],V=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Rv.b.audioEngine.audioContext.createMediaElementSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Rv.b.audioEngine.audioContext.createMediaStreamSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":v.byteLength>0&&(V=!0,this._soundLoaded(v));break;case"AudioBuffer":this._audioBufferLoaded(v);break;case"String":Z.push(v);case"Array":0===Z.length&&(Z=v);for(let f=0;f<Z.length;f++){const v=Z[f];if(V=e&&e.skipCodecCheck||-1!==v.indexOf(".mp3",v.length-4)&&Rv.b.audioEngine.isMP3supported||-1!==v.indexOf(".ogg",v.length-4)&&Rv.b.audioEngine.isOGGsupported||-1!==v.indexOf(".wav",v.length-4)||-1!==v.indexOf(".m4a",v.length-4)||-1!==v.indexOf(".mp4",v.length-4)||-1!==v.indexOf("blob:"),V){this._streaming?(this._htmlAudioElement=new Audio(v),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,l.Tools.SetCorsBehavior(v,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(v,(f=>{this._soundLoaded(f)}),void 0,!0,!0,(f=>{f&&X.e.Error("XHR "+f.status+" error on: "+v+"."),X.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:f=!1}f?V||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):X.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){X.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Rv.b.audioEngine&&!Rv.b.audioEngine.WarnedWebAudioUnsupported&&(X.e.Error("Web Audio is not supported by your browser."),Rv.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var f;null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(f){var v;null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.audioContext&&(this._audioBuffer=f,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(f){var v;null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.audioContext&&Rv.b.audioEngine.audioContext.decodeAudioData(f,(f=>{this._audioBufferLoaded(f)}),(f=>{X.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+f)}))}setAudioBuffer(f){var v;null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this._audioBuffer=f,this._isReadyToPlay=!0)}updateOptions(f){f&&(this.loop=f.loop??this.loop,this.maxDistance=f.maxDistance??this.maxDistance,this.useCustomAttenuation=f.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=f.rolloffFactor??this.rolloffFactor,this.refDistance=f.refDistance??this.refDistance,this.distanceModel=f.distanceModel??this.distanceModel,this._playbackRate=f.playbackRate??this._playbackRate,this._length=f.length??void 0,this.spatialSound=f.spatialSound??this._spatialSound,this._setOffset(f.offset??void 0),this.setVolume(f.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var f;null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&Rv.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Rv.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var f;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(f=this._soundPanner)||void 0===f||f.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var f;null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(f){var v;null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(f),this._isOutputConnected=!0)}setDirectionalCone(f,v,Z){v<f?X.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=f,this._coneOuterAngle=v,this._coneOuterGain=Z,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(f){if(f!=this._coneInnerAngle){var v;if(this._coneOuterAngle<f)return void X.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=f,null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(f){if(f!=this._coneOuterAngle){var v;if(f<this._coneInnerAngle)return void X.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=f,null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(f){var v;f.equals(this._position)||(this._position.h(f),null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(f){var v;this._localDirection=f,null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const f=this._connectedTransformNode.getWorldMatrix(),v=h.Xv.TransformNormal(this._localDirection,f);v.normalize(),this._soundPanner.orientationX.value=v.x,this._soundPanner.orientationY.value=v.y,this._soundPanner.orientationZ.value=v.z}updateDistanceFromListener(){var f;if(null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const f=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Fv(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,f,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(f){this._customAttenuationFunction=f}play(f,v,Z){var V;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(V=Rv.b.audioEngine)&&void 0!==V&&V.audioContext)try{var h,J;this._clearTimeoutsAndObservers();let V=f?(null===(h=Rv.b.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+f:null===(J=Rv.b.audioEngine)||void 0===J?void 0:J.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Rv.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const f=()=>{var Z;if(null!==(Z=Rv.b.audioEngine)&&void 0!==Z&&Z.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=v??0;const Z=this._htmlAudioElement.play();void 0!==Z&&Z.catch((()=>{var v,Z;(null===(v=Rv.b.audioEngine)||void 0===v||v.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Z=Rv.b.audioEngine)||void 0===Z?void 0:Z.onAudioUnlockedObservable.addOnce((()=>{f()})))}))}else{var V;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(V=Rv.b.audioEngine)||void 0===V?void 0:V.onAudioUnlockedObservable.addOnce((()=>{f()}))}};f()}}else{var l;const h=()=>{var h;if(null!==(h=Rv.b.audioEngine)&&void 0!==h&&h.audioContext){var J;if(Z=Z||this._length,void 0!==v&&this._setOffset(v),this._soundSource){const f=this._soundSource;f.onended=()=>{f.disconnect()}}if(this._soundSource=null===(J=Rv.b.audioEngine)||void 0===J?void 0:J.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var l;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==v&&(this._soundSource.loopStart=v),void 0!==Z&&(this._soundSource.loopEnd=(0|v)+Z),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},V=f?(null===(l=Rv.b.audioEngine)||void 0===l?void 0:l.audioContext.currentTime)+f:Rv.b.audioEngine.audioContext.currentTime;const h=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(V,h,this.loop?void 0:Z)}}};"suspended"===(null===(l=Rv.b.audioEngine)||void 0===l?void 0:l.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var f;"suspended"===(null===(f=Rv.b.audioEngine)||void 0===f?void 0:f.audioContext.state)?(Rv.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Rv.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{h()})))):h()}),500):h()}this._startTime=V,this.isPlaying=!0,this.isPaused=!1}catch(e){X.e.Error("Error while trying to play audio: "+this.name+", "+e.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(f){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Z;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Z=this._streamingSource)||void 0===Z||Z.disconnect();this.isPlaying=!1}else if(null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource){const v=f?Rv.b.audioEngine.audioContext.currentTime+f:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(v)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var f;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var v;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(v=this._streamingSource)||void 0===v||v.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Rv.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(f,v){var Z;null!==(Z=Rv.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._soundGain&&(v&&Rv.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Rv.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Rv.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(f,Rv.b.audioEngine.audioContext.currentTime+v)):this._soundGain.gain.value=f),this._volume=f}setPlaybackRate(f){this._playbackRate=f,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(f){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=f,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=f=>this._onRegisterAfterWorldMatrixUpdate(f),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(f){var v;if(f.getBoundingInfo){const v=f.getBoundingInfo();this.setPosition(v.boundingSphere.centerWorld)}else this.setPosition(f.absolutePosition);null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const f=()=>{(0,nv.f)((()=>this._isReadyToPlay),(()=>{Z._audioBuffer=this.getAudioBuffer(),Z._isReadyToPlay=!0,Z.autoplay&&Z.play(0,this._offset,this._length)}),void 0,300)},v={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Z=new Sv(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,v);return this.useCustomAttenuation&&Z.setAttenuationFunction(this._customAttenuationFunction),Z.setPosition(this._position),Z.setPlaybackRate(this._playbackRate),f(),Z}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const f={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(f.connectedMeshId=this._connectedTransformNode.id),f.position=this._position.Ph(),f.refDistance=this.refDistance,f.distanceModel=this.distanceModel,f.isDirectional=this._isDirectional,f.localDirectionToMesh=this._localDirection.Ph(),f.coneInnerAngle=this._coneInnerAngle,f.coneOuterAngle=this._coneOuterAngle,f.coneOuterGain=this._coneOuterGain),f}static Parse(f,v,Z,V){const J=f.name;let l;l=f.url?Z+f.url:Z+J;const e={autoplay:f.autoplay,loop:f.loop,volume:f.volume,spatialSound:f.spatialSound,maxDistance:f.maxDistance,rolloffFactor:f.rolloffFactor,refDistance:f.refDistance,distanceModel:f.distanceModel,playbackRate:f.playbackRate};let C;if(V){const f=()=>{(0,nv.f)((()=>V._isReadyToPlay),(()=>{C._audioBuffer=V.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)}),void 0,300)};C=new Sv(J,new ArrayBuffer(0),v,null,e),f()}else C=new Sv(J,l,v,(()=>{v.removePendingData(C)}),e),v.addPendingData(C);if(f.position){const v=h.Xv.Av(f.position);C.setPosition(v)}if(f.isDirectional&&(C.setDirectionalCone(f.coneInnerAngle||360,f.coneOuterAngle||360,f.coneOuterGain||0),f.localDirectionToMesh)){const v=h.Xv.Av(f.localDirectionToMesh);C.setLocalDirectionToMesh(v)}if(f.connectedMeshId){const Z=v.getMeshById(f.connectedMeshId);Z&&C.attachToMesh(Z)}return f.metadata&&(C.metadata=f.metadata),C}_setOffset(f){this._offset!==f&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=f)}_clearTimeoutsAndObservers(){var f;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(f=Rv.b.audioEngine)||void 0===f||f.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Sv._SceneComponentInitialization=f=>{throw(0,xv.e)("AudioSceneComponent")},(0,zf.h)("BABYLON.Sound",Sv);class Dv{constructor(f,v,Z){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],v.length!==Z.length)throw new Error("Sounds length does not equal weights length");this.loop=f,this._weights=Z;let V=0;for(const J of Z)V+=J;const h=V>0?1/V:0;for(let J=0;J<this._weights.length;J++)this._weights[J]*=h;this._sounds=v;for(const J of this._sounds)J.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(f){if(f!==this._coneInnerAngle){if(this._coneOuterAngle<f)return void X.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=f;for(const v of this._sounds)v.directionalConeInnerAngle=f}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(f){if(f!==this._coneOuterAngle){if(f<this._coneInnerAngle)return void X.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=f;for(const v of this._sounds)v.directionalConeOuterAngle=f}}get volume(){return this._volume}set volume(f){if(f!==this._volume)for(const v of this._sounds)v.setVolume(f)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(f){if(!this.isPaused){this.stop();const f=Math.random();let v=0;for(let Z=0;Z<this._weights.length;Z++)if(v+=this._weights[Z],f<=v){this._currentIndex=Z;break}}const v=this._sounds[this._currentIndex??0];v.isReady()?v.play(0,this.isPaused?void 0:f):v.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class fZ{constructor(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(f=f||b.c.LastCreatedScene)&&(this._scene=f,this.soundCollection=[],this._options=v,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var f;null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&Rv.b.audioEngine.audioContext&&(this._outputAudioNode=Rv.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Rv.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Rv.b.audioEngine&&Rv.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(f){var v;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&f.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==f.soundTrackId&&(-1===f.soundTrackId?this._scene.mainSoundTrack.removeSound(f):this._scene.soundTracks&&this._scene.soundTracks[f.soundTrackId].removeSound(f)),this.soundCollection.push(f),f.soundTrackId=this.id}removeSound(f){const v=this.soundCollection.indexOf(f);-1!==v&&this.soundCollection.splice(v,1)}setVolume(f){var v;null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=f)}switchPanningModelToHRTF(){var f;if(null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var f;if(null!==(f=Rv.b.audioEngine)&&void 0!==f&&f.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToEqualPower()}connectToAnalyser(f){var v;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=f,null!==(v=Rv.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Rv.b.audioEngine.masterGain))}}var vZ=Z(11683),ZZ=Z(11646),VZ=Z(11239);Rv.b.AudioEngineFactory=(f,v,Z)=>new hZ(f,v,Z);class hZ{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new O.c,this.onAudioLockedObservable=new O.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,VZ.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const V=document.createElement("audio");this._hostElement=f,this._audioContext=v,this._audioDestination=Z;try{V&&V.canPlayType&&(V.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||V.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(h){}try{V&&V.canPlayType&&V.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(h){}}lock(){this._triggerSuspendedState()}unlock(){var f,v;if("running"===(null===(f=this._audioContext)||void 0===f?void 0:f.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(v=this._audioContext)||void 0===v||v.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{X.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var f;null===(f=this._audioContext)||void 0===f||f.addEventListener("statechange",(()=>{var f;this.unlocked&&"running"!==(null===(f=this._audioContext)||void 0===f?void 0:f.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var f;return null!==(f=this._audioContext)&&void 0!==f&&f.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(f){this.canUseWebAudio=!1,X.e.Error("Web Audio: "+f.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(f){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const f=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",v=document.createElement("style");v.appendChild(document.createTextNode(f)),document.getElementsByTagName("head")[0].appendChild(v),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var f;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(f=this._audioContext)||void 0===f||f.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(f){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=f)}connectToAnalyser(f){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=f,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var JZ=Z(11254);(0,Z(12786).f)(vZ.c.NAME_AUDIO,((f,v,Z,V)=>{let h,J=[];if(Z.LW=Z.LW||[],void 0!==f.LW&&null!==f.LW)for(let e=0,C=f.LW.length;e<C;e++){var l;const C=f.LW[e];null!==(l=Rv.b.audioEngine)&&void 0!==l&&l.canUseWebAudio?(C.url||(C.url=C.name),J[C.url]?Z.LW.push(Sv.Parse(C,v,V,J[C.url])):(h=Sv.Parse(C,v,V),J[C.url]=h,Z.LW.push(h))):Z.LW.push(new Sv(C.name,null,v))}J=[]})),Object.defineProperty(ZZ.b.prototype,"mainSoundTrack",{get:function(){let f=this._getComponent(vZ.c.NAME_AUDIO);return f||(f=new lZ(this),this.hh(f)),this._mainSoundTrack||(this._mainSoundTrack=new fZ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ZZ.b.prototype.getSoundByName=function(f){let v;for(v=0;v<this.mainSoundTrack.soundCollection.length;v++)if(this.mainSoundTrack.soundCollection[v].name===f)return this.mainSoundTrack.soundCollection[v];if(this.soundTracks)for(let Z=0;Z<this.soundTracks.length;Z++)for(v=0;v<this.soundTracks[Z].soundCollection.length;v++)if(this.soundTracks[Z].soundCollection[v].name===f)return this.soundTracks[Z].soundCollection[v];return null},Object.defineProperty(ZZ.b.prototype,"audioEnabled",{get:function(){let f=this._getComponent(vZ.c.NAME_AUDIO);return f||(f=new lZ(this),this.hh(f)),f.audioEnabled},set:function(f){let v=this._getComponent(vZ.c.NAME_AUDIO);v||(v=new lZ(this),this.hh(v)),f?v.enableAudio():v.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ZZ.b.prototype,"headphone",{get:function(){let f=this._getComponent(vZ.c.NAME_AUDIO);return f||(f=new lZ(this),this.hh(f)),f.headphone},set:function(f){let v=this._getComponent(vZ.c.NAME_AUDIO);v||(v=new lZ(this),this.hh(v)),f?v.switchAudioModeForHeadphones():v.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ZZ.b.prototype,"audioListenerPositionProvider",{get:function(){let f=this._getComponent(vZ.c.NAME_AUDIO);return f||(f=new lZ(this),this.hh(f)),f.audioListenerPositionProvider},set:function(f){let v=this._getComponent(vZ.c.NAME_AUDIO);if(v||(v=new lZ(this),this.hh(v)),f&&"function"!==typeof f)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");v.audioListenerPositionProvider=f},enumerable:!0,configurable:!0}),Object.defineProperty(ZZ.b.prototype,"audioListenerRotationProvider",{get:function(){let f=this._getComponent(vZ.c.NAME_AUDIO);return f||(f=new lZ(this),this.hh(f)),f.audioListenerRotationProvider},set:function(f){let v=this._getComponent(vZ.c.NAME_AUDIO);if(v||(v=new lZ(this),this.hh(v)),f&&"function"!==typeof f)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");v.audioListenerRotationProvider=f},enumerable:!0,configurable:!0}),Object.defineProperty(ZZ.b.prototype,"audioPositioningRefreshRate",{get:function(){let f=this._getComponent(vZ.c.NAME_AUDIO);return f||(f=new lZ(this),this.hh(f)),f.audioPositioningRefreshRate},set:function(f){let v=this._getComponent(vZ.c.NAME_AUDIO);v||(v=new lZ(this),this.hh(v)),v.audioPositioningRefreshRate=f},enumerable:!0,configurable:!0});class lZ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(f){this.name=vZ.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new h.Xv,this._cachedCameraPosition=new h.Xv,this._lastCheck=0,this._invertMatrixTemp=new h.Matrix,this._cameraDirectionTemp=new h.Xv,(f=f||b.c.LastCreatedScene)&&(this.Uv=f,f.soundTracks=[],f.LW=[])}register(){this.Uv._afterRenderStage.registerStep(vZ.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(f){if(f.LW=[],this.Uv.soundTracks)for(let v=0;v<this.Uv.soundTracks.length;v++){const Z=this.Uv.soundTracks[v];for(let v=0;v<Z.soundCollection.length;v++)f.LW.push(Z.soundCollection[v].serialize())}}addFromContainer(f){if(f.LW)for(const v of f.LW)v.play(),v.autoplay=!0,this.Uv.mainSoundTrack.addSound(v)}removeFromContainer(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(f.LW)for(const Z of f.LW)Z.stop(),Z.autoplay=!1,this.Uv.mainSoundTrack.removeSound(Z),v&&Z.dispose()}dispose(){const f=this.Uv;if(f._mainSoundTrack&&f.mainSoundTrack.dispose(),f.soundTracks)for(let v=0;v<f.soundTracks.length;v++)f.soundTracks[v].dispose()}disableAudio(){const f=this.Uv;let v;for(this._audioEnabled=!1,Rv.b.audioEngine&&Rv.b.audioEngine.audioContext&&Rv.b.audioEngine.audioContext.suspend(),v=0;v<f.mainSoundTrack.soundCollection.length;v++)f.mainSoundTrack.soundCollection[v].pause();if(f.soundTracks)for(v=0;v<f.soundTracks.length;v++)for(let Z=0;Z<f.soundTracks[v].soundCollection.length;Z++)f.soundTracks[v].soundCollection[Z].pause()}enableAudio(){const f=this.Uv;let v;for(this._audioEnabled=!0,Rv.b.audioEngine&&Rv.b.audioEngine.audioContext&&Rv.b.audioEngine.audioContext.resume(),v=0;v<f.mainSoundTrack.soundCollection.length;v++)f.mainSoundTrack.soundCollection[v].isPaused&&f.mainSoundTrack.soundCollection[v].play();if(f.soundTracks)for(v=0;v<f.soundTracks.length;v++)for(let Z=0;Z<f.soundTracks[v].soundCollection.length;Z++)f.soundTracks[v].soundCollection[Z].isPaused&&f.soundTracks[v].soundCollection[Z].play()}switchAudioModeForHeadphones(){const f=this.Uv;if(this._headphone=!0,f.mainSoundTrack.switchPanningModelToHRTF(),f.soundTracks)for(let v=0;v<f.soundTracks.length;v++)f.soundTracks[v].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const f=this.Uv;if(this._headphone=!1,f.mainSoundTrack.switchPanningModelToEqualPower(),f.soundTracks)for(let v=0;v<f.soundTracks.length;v++)f.soundTracks[v].switchPanningModelToEqualPower()}_afterRender(){const f=JZ.b.Now;if(this._lastCheck&&f-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=f;const v=this.Uv;if(!this._audioEnabled||!v._mainSoundTrack||!v.soundTracks||0===v._mainSoundTrack.soundCollection.length&&1===v.soundTracks.length)return;const Z=Rv.b.audioEngine;if(Z&&Z.audioContext){let f,V=v.activeCamera;if(v.activeCameras&&v.activeCameras.length>0&&(V=v.activeCameras[0]),this.audioListenerPositionProvider){const f=this.audioListenerPositionProvider();Z.audioContext.listener.setPosition(f.x||0,f.y||0,f.z||0)}else V?this._cachedCameraPosition.equals(V.globalPosition)||(this._cachedCameraPosition.h(V.globalPosition),Z.audioContext.listener.setPosition(V.globalPosition.x,V.globalPosition.y,V.globalPosition.z)):Z.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const f=this.audioListenerRotationProvider();Z.audioContext.listener.setOrientation(f.x||0,f.y||0,f.z||0,0,1,0)}else V?(V.rigCameras&&V.rigCameras.length>0&&(V=V.rigCameras[0]),V.getViewMatrix().invertToRef(this._invertMatrixTemp),h.Xv.TransformNormalToRef(lZ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.h(this._cameraDirectionTemp),Z.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Z.audioContext.listener.setOrientation(0,0,0,0,1,0);for(f=0;f<v.mainSoundTrack.soundCollection.length;f++){const Z=v.mainSoundTrack.soundCollection[f];Z.useCustomAttenuation&&Z.updateDistanceFromListener()}if(v.soundTracks)for(f=0;f<v.soundTracks.length;f++)for(let Z=0;Z<v.soundTracks[f].soundCollection.length;Z++){const V=v.soundTracks[f].soundCollection[Z];V.useCustomAttenuation&&V.updateDistanceFromListener()}}}}lZ._CameraDirection=new h.Xv(0,0,-1),Sv._SceneComponentInitialization=f=>{let v=f._getComponent(vZ.c.NAME_AUDIO);v||(v=new lZ(f),f.hh(v))};const eZ="MSFT_audio_emitter";class CZ{constructor(f){this.name=eZ,this._loader=f,this.enabled=this._loader.isExtensionUsed(eZ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const f=this._loader.yh.extensions;if(f&&f[this.name]){const v=f[this.name];this._clips=v.clips,this._emitters=v.emitters,p.Assign(this._clips),p.Assign(this._emitters)}}loadSceneAsync(f,v){return r.LoadExtensionAsync(f,v,this.name,(async(Z,V)=>{const h=new Array;h.push(this._loader.loadSceneAsync(f,v));for(const f of V.emitters){const v=p.Get(`${Z}/emitters`,this._emitters,f);if(void 0!=v.refDistance||void 0!=v.maxDistance||void 0!=v.rolloffFactor||void 0!=v.distanceModel||void 0!=v.innerAngle||void 0!=v.outerAngle)throw new Error(`${Z}: Direction or Distance properties are not allowed on emitters attached to a scene`);h.push(this._loadEmitterAsync(`${Z}/emitters/${v.index}`,v))}await Promise.all(h)}))}loadNodeAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(f,V)=>{const J=new Array,e=await this._loader.loadNodeAsync(f,v,(v=>{for(const Z of V.emitters){const V=p.Get(`${f}/emitters`,this._emitters,Z);J.push(this._loadEmitterAsync(`${f}/emitters/${V.index}`,V).then((()=>{for(const f of V._babylonSounds)f.attachToMesh(v),void 0==V.innerAngle&&void 0==V.outerAngle||(f.setLocalDirectionToMesh(h.Xv.Forward()),f.setDirectionalCone(2*l.Tools.ToDegrees(void 0==V.innerAngle?Math.PI:V.innerAngle),2*l.Tools.ToDegrees(void 0==V.outerAngle?Math.PI:V.outerAngle),0))})))}Z(v)}));return await Promise.all(J),e}))}loadAnimationAsync(f,v){return r.LoadExtensionAsync(f,v,this.name,(async(Z,V)=>{const h=await this._loader.loadAnimationAsync(f,v),J=new Array;p.Assign(V.events);for(const l of V.events)J.push(this._loadAnimationEventAsync(`${Z}/events/${l.index}`,f,v,l,h));return await Promise.all(J),h}))}_loadClipAsync(f,v){if(v._objectURL)return v._objectURL;let Z;if(v.uri)Z=this._loader.loadUriAsync(f,v,v.uri);else{const V=p.Get(`${f}/bufferView`,this._loader.yh.bufferViews,v.bufferView);Z=this._loader.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}return v._objectURL=Z.then((f=>URL.createObjectURL(new Blob([f],{type:v.mimeType})))),v._objectURL}_loadEmitterAsync(f,v){if(v._babylonSounds=v._babylonSounds||[],!v._babylonData){const f=new Array,Z=v.name||`emitter${v.index}`,V={loop:!1,autoplay:!1,volume:void 0==v.volume?1:v.volume};for(let J=0;J<v.clips.length;J++){const h=`/extensions/${this.name}/clips`,l=p.Get(h,this._clips,v.clips[J].clip);f.push(this._loadClipAsync(`${h}/${v.clips[J].clip}`,l).then((f=>{const h=v._babylonSounds[J]=new Sv(Z,f,this._loader.babylonScene,null,V);h.refDistance=v.refDistance||1,h.maxDistance=v.maxDistance||256,h.rolloffFactor=v.rolloffFactor||1,h.distanceModel=v.distanceModel||"exponential"})))}const h=Promise.all(f).then((()=>{const f=v.clips.map((f=>f.weight||1)),Z=new Dv(v.loop||!1,v._babylonSounds,f);v.innerAngle&&(Z.directionalConeInnerAngle=2*l.Tools.ToDegrees(v.innerAngle)),v.outerAngle&&(Z.directionalConeOuterAngle=2*l.Tools.ToDegrees(v.outerAngle)),v.volume&&(Z.volume=v.volume),v._babylonData.sound=Z}));v._babylonData={loaded:h}}return v._babylonData.loaded}_getEventAction(f,v,Z,V,h){switch(Z){case"play":return f=>{const Z=(h||0)+(f-V);v.play(Z)};case"stop":return()=>{v.stop()};case"pause":return()=>{v.pause()};default:throw new Error(`${f}: Unsupported action ${Z}`)}}_loadAnimationEventAsync(f,v,Z,V,h){if(0==h.targetedAnimations.length)return Promise.resolve();const J=h.targetedAnimations[0],l=V.hv,e=p.Get(`/extensions/${this.name}/emitters`,this._emitters,l);return this._loadEmitterAsync(f,e).then((()=>{const v=e._babylonData.sound;if(v){const Z=new dv(V.time,this._getEventAction(f,v,V.action,V.time,V.startOffset));J.animation.addEvent(Z),h.onAnimationGroupEndObservable.add((()=>{v.stop()})),h.onAnimationGroupPauseObservable.add((()=>{v.pause()}))}}))}}j(eZ),E(eZ,!0,(f=>new CZ(f)));const HZ="MSFT_lod";class OZ{constructor(f){var v;this.name=HZ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new O.c,this.onMaterialLODsLoadedObservable=new O.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=f,this.maxLODsToLoad=(null===(v=this._loader.parent.extensionOptions[HZ])||void 0===v?void 0:v.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(HZ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let f=0;f<this._nodePromiseLODs.length;f++){const v=Promise.all(this._nodePromiseLODs[f]).then((()=>{0!==f&&(this._loader.endPerformanceCounter(`Node LOD ${f}`),this._loader.log(`Loaded node LOD ${f}`)),this.onNodeLODsLoadedObservable.notifyObservers(f),f!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${f+1}`),this._loadBufferLOD(this._nodeBufferLODs,f+1),this._nodeSignalLODs[f]&&this._nodeSignalLODs[f].resolve())}));this._loader._completePromises.push(v)}for(let f=0;f<this._materialPromiseLODs.length;f++){const v=Promise.all(this._materialPromiseLODs[f]).then((()=>{0!==f&&(this._loader.endPerformanceCounter(`Material LOD ${f}`),this._loader.log(`Loaded material LOD ${f}`)),this.onMaterialLODsLoadedObservable.notifyObservers(f),f!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${f+1}`),this._loadBufferLOD(this._materialBufferLODs,f+1),this._materialSignalLODs[f]&&this._materialSignalLODs[f].resolve())}));this._loader._completePromises.push(v)}}loadSceneAsync(f,v){const Z=this._loader.loadSceneAsync(f,v);return this._loadBufferLOD(this._bufferLODs,0),Z}loadNodeAsync(f,v,Z){return r.LoadExtensionAsync(f,v,this.name,(async(f,h)=>{let J;const l=this._getLODs(f,v,this._loader.yh.nodes,h.ids);this._loader.logOpen(`${f}`);for(let v=0;v<l.length;v++){const f=l[v];0!==v&&(this._nodeIndexLOD=v,this._nodeSignalLODs[v]=this._nodeSignalLODs[v]||new V);const h=f=>{Z(f),f.ne(!1)},e=this._loader.loadNodeAsync(`/nodes/${f.index}`,f,h).then((f=>{if(0!==v){const f=l[v-1];f._babylonTransformNode&&(this._disposeTransformNode(f._babylonTransformNode),delete f._babylonTransformNode)}return f.ne(!0),f}));this._nodePromiseLODs[v]=this._nodePromiseLODs[v]||[],0===v?J=e:(this._nodeIndexLOD=null,this._nodePromiseLODs[v].push(e))}return this._loader.logClose(),await J}))}_loadMaterialAsync(f,v,Z,V,h){return this._nodeIndexLOD?null:r.LoadExtensionAsync(f,v,this.name,(async(f,J)=>{let l;const e=this._getLODs(f,v,this._loader.yh.materials,J.ids);this._loader.logOpen(`${f}`);for(let v=0;v<e.length;v++){const f=e[v];0!==v&&(this._materialIndexLOD=v);const J=this._loader._loadMaterialAsync(`/materials/${f.index}`,f,Z,V,(f=>{0===v&&h(f)})).then((f=>{if(0!==v){h(f);const Z=e[v-1]._data;Z[V]&&(this._disposeMaterials([Z[V].babylonMaterial]),delete Z[V])}return f}));this._materialPromiseLODs[v]=this._materialPromiseLODs[v]||[],0===v?l=J:(this._materialIndexLOD=null,this._materialPromiseLODs[v].push(J))}return this._loader.logClose(),await l}))}_loadUriAsync(f,v,Z){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const h=this._nodeIndexLOD-1;return this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new V,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(f,v,Z)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const h=this._materialIndexLOD-1;return this._materialSignalLODs[h]=this._materialSignalLODs[h]||new V,this._materialSignalLODs[h].promise.then((async()=>await this._loader.loadUriAsync(f,v,Z)))}return null}loadBufferAsync(f,v,Z,h){if(this._loader.parent.useRangeRequests&&!v.uri){if(!this._loader.bin)throw new Error(`${f}: Uri is missing or the binary glTF is missing its binary chunk`);const v=async(f,v)=>{const J=Z,l=J+h-1;let e=f[v];return e?(e.start=Math.min(e.start,J),e.end=Math.max(e.end,l)):(e={start:J,end:l,loaded:new V},f[v]=e),await e.loaded.promise.then((f=>new Uint8Array(f.buffer,f.byteOffset+Z-e.start,h)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?v(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?v(this._materialBufferLODs,this._materialIndexLOD):v(this._bufferLODs,0)}return null}_loadBufferLOD(f,v){const Z=f[v];Z&&(this._loader.log(`Loading buffer range [${Z.start}-${Z.end}]`),this._loader.bin.readAsync(Z.start,Z.end-Z.start+1).then((f=>{Z.loaded.resolve(f)}),(f=>{Z.loaded.reject(f)})))}_getLODs(f,v,Z,V){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const h=[];for(let J=V.length-1;J>=0;J--)if(h.push(p.Get(`${f}/ids/${V[J]}`,Z,V[J])),h.length===this.maxLODsToLoad)return h;return h.push(v),h}_disposeTransformNode(f){const v=[],Z=f.material;Z&&v.push(Z);for(const h of f.getChildMeshes())h.material&&v.push(h.material);f.dispose();const V=v.filter((f=>this._loader.babylonScene.meshes.every((v=>v.material!=f))));this._disposeMaterials(V)}_disposeMaterials(f){const v={};for(const Z of f){for(const f of Z.getActiveTextures())v[f.uniqueId]=f;Z.dispose()}for(const Z in v)for(const f of this._loader.babylonScene.materials)f.hasTexture(v[Z])&&delete v[Z];for(const Z in v)v[Z].dispose()}}j(HZ),E(HZ,!0,(f=>new OZ(f)));const uZ="MSFT_minecraftMesh";class WZ{constructor(f){this.name=uZ,this._loader=f,this.enabled=this._loader.isExtensionUsed(uZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtraAsync(f,v,this.name,(async(V,h)=>{if(h){if(!(Z instanceof M.c))throw new Error(`${V}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(f,v,Z);return Z.needAlphaBlending()&&(Z.forceDepthWrite=!0,Z.separateCullingPass=!0),Z.nh=Z.forceDepthWrite,Z.twoSidedLighting=!0,await h}}))}}j(uZ),E(uZ,!0,(f=>new WZ(f)));const aZ="MSFT_sRGBFactors";class bZ{constructor(f){this.name=aZ,this._loader=f,this.enabled=this._loader.isExtensionUsed(aZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,v,Z){return r.LoadExtraAsync(f,v,this.name,(async(V,h)=>{if(h){if(!(Z instanceof M.c))throw new Error(`${V}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(f,v,Z),J=Z.Yf().getEngine().useExactSrgbConversions;return Z.albedoTexture||Z.albedoColor.toLinearSpaceToRef(Z.albedoColor,J),Z.reflectivityTexture||Z.reflectivityColor.toLinearSpaceToRef(Z.reflectivityColor,J),await h}}))}}j(aZ),E(aZ,!0,(f=>new bZ(f)));var XZ=Z(13107);const FZ={};var UZ=Z(13165),KZ=Z(13146),MZ=Z(13110),AZ=Z(13123);function sZ(f,v){for(const Z of f)for(const f of Z.dataOutputs)if(f.uniqueId===v)return f;throw new Error("Could not find data out connection with unique id "+v)}function zZ(f,v){for(const Z of f)if(Z instanceof KZ.e)for(const f of Z.signalInputs)if(f.uniqueId===v)return f;throw new Error("Could not find signal in connection with unique id "+v)}async function YZ(f,v){const V=await Promise.all(f.allBlocks.map((async f=>{const v=function(f){switch(f){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Z.e(78),Z.e(79)]).then(Z.bind(Z,14521))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Z.e(80).then(Z.bind(Z,14524))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Z.e(81).then(Z.bind(Z,14529))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Z.e(82).then(Z.bind(Z,14531))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Z.e(83).then(Z.bind(Z,14538))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Z.e(84).then(Z.bind(Z,14544))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Z.e(85).then(Z.bind(Z,14547))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Z.e(86).then(Z.bind(Z,14553))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Z.e(87).then(Z.bind(Z,14556))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Z.e(90).then(Z.bind(Z,14584))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Z.e(90).then(Z.bind(Z,14584))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Z.e(90).then(Z.bind(Z,14584))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Z.e(90).then(Z.bind(Z,14584))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Z.e(95).then(Z.bind(Z,14593))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Z.e(96).then(Z.bind(Z,14595))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Z.e(97).then(Z.bind(Z,14599))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Z.e(98).then(Z.bind(Z,14602))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Z.e(99).then(Z.bind(Z,14605))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Z.e(100).then(Z.bind(Z,14608))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Z.e(101).then(Z.bind(Z,14613))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Z.e(102).then(Z.bind(Z,14616))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Z.e(103).then(Z.bind(Z,14621))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Z.e(104).then(Z.bind(Z,14624))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Z.e(105).then(Z.bind(Z,14628))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Z.e(106).then(Z.bind(Z,14636))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Z.e(107).then(Z.bind(Z,14640))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Z.e(108).then(Z.bind(Z,14644))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Z.e(109).then(Z.bind(Z,14650))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Z.e(110).then(Z.bind(Z,14654))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Z.e(111).then(Z.bind(Z,14662))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Z.e(112).then(Z.bind(Z,14669))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Z.e(113).then(Z.bind(Z,14672))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Z.e(92).then(Z.bind(Z,14680))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Z.e(114).then(Z.bind(Z,14682))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Z.e(115).then(Z.bind(Z,14691))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Z.e(116).then(Z.bind(Z,14694))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Z.e(93).then(Z.bind(Z,14696))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Z.e(88).then(Z.bind(Z,14563))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Z.e(94).then(Z.bind(Z,14702))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Z.e(89).then(Z.bind(Z,14582))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Z.e(90).then(Z.bind(Z,14584))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Z.e(90).then(Z.bind(Z,14584))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Z.e(91).then(Z.bind(Z,14707))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Z.e(91).then(Z.bind(Z,14707))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Z.e(91).then(Z.bind(Z,14707))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Z.e(91).then(Z.bind(Z,14707))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Z.e(91).then(Z.bind(Z,14707))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Z.e(91).then(Z.bind(Z,14707))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Z.e(117).then(Z.bind(Z,14709))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Z.e(118).then(Z.bind(Z,14717))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Z.e(119).then(Z.bind(Z,14724))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Z.e(120).then(Z.bind(Z,14729))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Z.e(121).then(Z.bind(Z,14731))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Z.e(122).then(Z.bind(Z,14734))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Z.e(123).then(Z.bind(Z,14743))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Z.e(124).then(Z.bind(Z,14749))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Z.e(125).then(Z.bind(Z,14756))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Z.e(126).then(Z.bind(Z,14764))).FlowGraphDataSwitchBlock;default:if(FZ[f])return FZ[f];throw new Error(`Unknown block name ${f}`)}}(f.className);return await v()})));return function(f,v,Z){const V=v.coordinator.createGraph(),h=[],J=v.valueParseFunction??MZ.d;for(let l=0;l<f.allBlocks.length;l++){const e=NZ(f.allBlocks[l],{Uv:v.coordinator.config.Uv,pathConverter:v.pathConverter,assetsContainer:v.coordinator.config.Uv,valueParseFunction:J},Z[l]);h.push(e),e instanceof UZ.b&&V.addEventBlock(e)}for(const l of h){for(const f of l.dataInputs)for(const v of f.connectedPointIds){const Z=sZ(h,v);f.connectTo(Z)}if(l instanceof KZ.e)for(const f of l.signalOutputs)for(const v of f.connectedPointIds){const Z=zZ(h,v);f.connectTo(Z)}}for(const l of f.executionContexts)yZ(l,{graph:V,valueParseFunction:J},f.rightHanded);return V}(f,v,V)}function yZ(f,v,Z){const V=v.graph.createContext();f.enableLogging&&(V.enableLogging=!0),V.treatDataAsRightHanded=Z||!1;const h=v.valueParseFunction??MZ.d;V.uniqueId=f.uniqueId;const J=V.Yf();if(f._assetsContext){var l,e,C,H,O,u,W,a,b,X;const v=f._assetsContext,Z={meshes:null===(l=v.meshes)||void 0===l?void 0:l.map((f=>J.getMeshById(f))),lights:null===(e=v.lights)||void 0===e?void 0:e.map((f=>J.getLightByName(f))),cameras:null===(C=v.cameras)||void 0===C?void 0:C.map((f=>J.getCameraByName(f))),materials:null===(H=v.materials)||void 0===H?void 0:H.map((f=>J.getMaterialById(f))),textures:null===(O=v.textures)||void 0===O?void 0:O.map((f=>J.getTextureByName(f))),animations:null===(u=v.animations)||void 0===u?void 0:u.map((f=>J.animations.find((v=>v.name===f)))),skeletons:null===(W=v.skeletons)||void 0===W?void 0:W.map((f=>J.getSkeletonByName(f))),fW:null===(a=v.fW)||void 0===a?void 0:a.map((f=>J.getParticleSystemById(f))),animationGroups:null===(b=v.animationGroups)||void 0===b?void 0:b.map((f=>J.getAnimationGroupByName(f))),transformNodes:null===(X=v.transformNodes)||void 0===X?void 0:X.map((f=>J.getTransformNodeById(f))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],LW:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};V.assetsContext=Z}for(const F in f._userVariables){const v=h(F,f._userVariables,V.assetsContext,J);V.userVariables[F]=v}for(const F in f._connectionValues){const v=h(F,f._connectionValues,V.assetsContext,J);V._setConnectionValueByKey(F,v)}return V}function NZ(f,v,Z){const V={},h=v.valueParseFunction??MZ.d;if(f.config)for(const l in f.config)V[l]=h(l,f.config,v.assetsContainer||v.Uv,v.Uv);if((0,MZ.h)(f.className)){if(!v.pathConverter)throw new Error("Path converter is required for this block");V.pathConverter=v.pathConverter}const J=new Z(V);J.uniqueId=f.uniqueId;for(let l=0;l<f.dataInputs.length;l++){const v=J.getDataInput(f.dataInputs[l].name);if(!v)throw new Error("Could not find data input with name "+f.dataInputs[l].name+" in block "+f.className);v.deserialize(f.dataInputs[l])}for(let l=0;l<f.dataOutputs.length;l++){const v=J.getDataOutput(f.dataOutputs[l].name);if(!v)throw new Error("Could not find data output with name "+f.dataOutputs[l].name+" in block "+f.className);v.deserialize(f.dataOutputs[l])}return J.metadata=f.metadata,J.deserialize&&J.deserialize(f),J}function iZ(f){const[v,Z]=f.split(":");return IZ({op:v,extension:Z})}function IZ(f){var v;let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=f.extension?null===(v=BZ[f.extension])||void 0===v?void 0:v[f.op]:PZ[f.op];if(!V&&(X.e.Warn(`No mapping found for operation ${f.op} and extension ${f.extension||"KHR_interactivity"}`),Z)){const v={},Z={flows:{}};if(f.inputValueSockets){v.values={};for(const Z in f.inputValueSockets)v.values[Z]={name:Z}}return f.outputValueSockets&&(Z.values={},Object.keys(f.outputValueSockets).forEach((f=>{Z.values[f]={name:f}}))),{MO:[],inputs:v,outputs:Z}}return V}function TZ(f,v,Z){BZ[v]||(BZ[v]={}),BZ[v][f]=Z}const BZ={BABYLON:{"flow/log":{MO:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},PZ={"event/onStart":{MO:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{MO:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{MO:["FlowGraphSendCustomEventBlock"],extraProcessor(f,v,Z,V,h){if("event/send"!==v.op||!f.configuration||1!==Object.keys(f.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const J=f.configuration.event.value[0];if("number"!==typeof J)throw new Error("Event id should be a number");const l=V.arrays.events[J],e=h[0];return e.config||(e.config={}),e.config.eventId=l.eventId,e.config.eventData=l.eventData,h}},"event/receive":{MO:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(f,v){var Z;if(!f.configuration)return X.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const V=f.configuration.event;if(!V)return X.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const h=V.value[0];if("number"!==typeof h)return X.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Z=v.events)||void 0===Z?void 0:Z[h])?{valid:!0}:(X.e.Error(`Event with id ${h} not found`),{valid:!1,error:`Event with id ${h} not found`})},extraProcessor(f,v,Z,V,h){if("event/receive"!==v.op||!f.configuration||1!==Object.keys(f.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const J=f.configuration.event.value[0];if("number"!==typeof J)throw new Error("Event id should be a number");const l=V.arrays.events[J],e=h[0];return e.config||(e.config={}),e.config.eventId=l.eventId,e.config.eventData=l.eventData,h}},"math/e":gZ("FlowGraphEBlock"),"math/pi":gZ("FlowGraphPIBlock"),"math/inf":gZ("FlowGraphInfBlock"),"math/nan":gZ("FlowGraphNaNBlock"),"math/abs":gZ("FlowGraphAbsBlock"),"math/sign":gZ("FlowGraphSignBlock"),"math/trunc":gZ("FlowGraphTruncBlock"),"math/floor":gZ("FlowGraphFloorBlock"),"math/ceil":gZ("FlowGraphCeilBlock"),"math/round":{MO:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h){var J;return(J=h[0]).config||(J.config={}),h[0].config.roundHalfAwayFromZero=!0,h}},"math/fract":gZ("FlowGraphFractBlock"),"math/neg":gZ("FlowGraphNegationBlock"),"math/add":gZ("FlowGraphAddBlock",["a","b"],!0),"math/sub":gZ("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{MO:["FlowGraphMultiplyBlock"],extraProcessor(f,v,Z,V,h){var J;(J=h[0]).config||(J.config={}),h[0].config.useMatrixPerComponent=!0,h[0].config.preventIntegerFloatArithmetic=!0;let l=-1;return Object.keys(f.values||{}).find((v=>{var Z;return void 0!==(null===(Z=f.values)||void 0===Z?void 0:Z[v].type)&&(l=f.values[v].type,!0)})),-1!==l&&(h[0].config.type=V.arrays.types[l].flowGraphType),h},validation:f=>f.values?wZ(f):{valid:!0}},"math/div":gZ("FlowGraphDivideBlock",["a","b"],!0),"math/rem":gZ("FlowGraphModuloBlock",["a","b"]),"math/min":gZ("FlowGraphMinBlock",["a","b"]),"math/max":gZ("FlowGraphMaxBlock",["a","b"]),"math/clamp":gZ("FlowGraphClampBlock",["a","b","c"]),"math/saturate":gZ("FlowGraphSaturateBlock"),"math/mix":gZ("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":gZ("FlowGraphEqualityBlock",["a","b"]),"math/lt":gZ("FlowGraphLessThanBlock",["a","b"]),"math/le":gZ("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":gZ("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":gZ("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":gZ("FlowGraphIsNaNBlock"),"math/isinf":gZ("FlowGraphIsInfBlock"),"math/select":{MO:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{MO:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":gZ("FlowGraphSinBlock"),"math/cos":gZ("FlowGraphCosBlock"),"math/tan":gZ("FlowGraphTanBlock"),"math/asin":gZ("FlowGraphASinBlock"),"math/acos":gZ("FlowGraphACosBlock"),"math/atan":gZ("FlowGraphATanBlock"),"math/atan2":gZ("FlowGraphATan2Block",["a","b"]),"math/sinh":gZ("FlowGraphSinhBlock"),"math/cosh":gZ("FlowGraphCoshBlock"),"math/tanh":gZ("FlowGraphTanhBlock"),"math/asinh":gZ("FlowGraphASinhBlock"),"math/acosh":gZ("FlowGraphACoshBlock"),"math/atanh":gZ("FlowGraphATanhBlock"),"math/exp":gZ("FlowGraphExponentialBlock"),"math/log":gZ("FlowGraphLogBlock"),"math/log2":gZ("FlowGraphLog2Block"),"math/log10":gZ("FlowGraphLog10Block"),"math/sqrt":gZ("FlowGraphSquareRootBlock"),"math/cbrt":gZ("FlowGraphCubeRootBlock"),"math/pow":gZ("FlowGraphPowerBlock",["a","b"]),"math/length":gZ("FlowGraphLengthBlock"),"math/normalize":gZ("FlowGraphNormalizeBlock"),"math/dot":gZ("FlowGraphDotBlock",["a","b"]),"math/cross":gZ("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":gZ("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":gZ("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{MO:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{MO:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{MO:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{MO:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{MO:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{MO:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{MO:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":gZ("FlowGraphTransposeBlock"),"math/determinant":gZ("FlowGraphDeterminantBlock"),"math/inverse":gZ("FlowGraphInvertMatrixBlock"),"math/matmul":gZ("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{MO:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ze",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h,J){const l=h[0].dataInputs.find((f=>"rotationQuaternion"===f.name));if(!l)throw new Error("Rotation quaternion input not found");return J._connectionValues[l.uniqueId]&&(J._connectionValues[l.uniqueId].type="Quaternion"),h}},"math/matDecompose":{MO:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ze"}}}},"math/quatConjugate":gZ("FlowGraphConjugateBlock",["a"]),"math/quatMul":{MO:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h){var J;return(J=h[0]).config||(J.config={}),h[0].config.type="Quaternion",h}},"math/quatAngleBetween":gZ("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{MO:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":gZ("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":gZ("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{MO:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h){var J;return(J=h[0]).config||(J.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract2x2":{MO:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{MO:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h){var J;return(J=h[0]).config||(J.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract3x3":{MO:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{MO:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h){var J;return(J=h[0]).config||(J.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract4x4":{MO:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{MO:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h,J){var l,e;(e=h[0]).config||(e.config={});const C=h[0].dataInputs[0];return h[0].config.valueType=(null===(l=J._connectionValues[C.uniqueId])||void 0===l?void 0:l.type)??"FlowGraphInteger",h}},"math/and":{MO:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h,J){var l,e,C;(C=h[0]).config||(C.config={});const H=h[0].dataInputs[0],O=h[0].dataInputs[1];return h[0].config.valueType=(null===(l=J._connectionValues[H.uniqueId])||void 0===l?void 0:l.type)??(null===(e=J._connectionValues[O.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",h}},"math/or":{MO:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h,J){var l,e,C;(C=h[0]).config||(C.config={});const H=h[0].dataInputs[0],O=h[0].dataInputs[1];return h[0].config.valueType=(null===(l=J._connectionValues[H.uniqueId])||void 0===l?void 0:l.type)??(null===(e=J._connectionValues[O.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",h}},"math/xor":{MO:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(f,v,Z,V,h,J){var l,e,C;(C=h[0]).config||(C.config={});const H=h[0].dataInputs[0],O=h[0].dataInputs[1];return h[0].config.valueType=(null===(l=J._connectionValues[H.uniqueId])||void 0===l?void 0:l.type)??(null===(e=J._connectionValues[O.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",h}},"math/asr":gZ("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":gZ("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":gZ("FlowGraphLeadingZerosBlock"),"math/ctz":gZ("FlowGraphTrailingZerosBlock"),"math/popcnt":gZ("FlowGraphOneBitsCounterBlock"),"math/rad":gZ("FlowGraphDegToRadBlock"),"math/deg":gZ("FlowGraphRadToDegBlock"),"type/boolToInt":gZ("FlowGraphBooleanToInt"),"type/boolToFloat":gZ("FlowGraphBooleanToFloat"),"type/intToBool":gZ("FlowGraphIntToBoolean"),"type/intToFloat":gZ("FlowGraphIntToFloat"),"type/floatToInt":gZ("FlowGraphFloatToInt"),"type/floatToBool":gZ("FlowGraphFloatToBoolean"),"flow/sequence":{MO:["FlowGraphSequenceBlock"],extraProcessor(f,v,Z,V,h){const J=h[0];return J.config||(J.config={}),J.config.outputSignalCount=Object.keys(f.flows||[]).length,J.signalOutputs.forEach(((f,v)=>{f.name="out_"+v})),h}},"flow/branch":{MO:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{MO:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(f){if(f.configuration&&f.configuration.cases){const v=f.configuration.cases.value;if(!v.every((f=>"number"===typeof f&&/^-?\d+$/.test(f.toString()))))return X.e.Warn("Switch cases should be integers. Using empty array instead."),f.configuration.cases.value=[],{valid:!0};const Z=new Set(v);f.configuration.cases.value=Array.from(Z)}return{valid:!0}},extraProcessor(f,v,Z,V,h){if("flow/switch"!==v.op||!f.flows||0===Object.keys(f.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return h[0].signalOutputs.forEach((f=>{"default"!==f.name&&(f.name="out_"+f.name)})),h}},"flow/while":{MO:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{MO:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(f,v,Z,V,h){const J=h[0];return J.config||(J.config={}),J.config.incrementIndexWhenLoopDone=!0,h}},"flow/doN":{MO:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{MO:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(f,v,Z,V,h){if("flow/multiGate"!==v.op||!f.flows||0===Object.keys(f.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const J=h[0];return J.config||(J.config={}),J.config.outputSignalCount=Object.keys(f.flows).length,J.signalOutputs.forEach(((f,v)=>{f.name="out_"+v})),h}},"flow/waitAll":{MO:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(f){var v,Z;return"number"!==typeof(null===(v=f.configuration)||void 0===v||null===(Z=v.inputFlows)||void 0===Z?void 0:Z.value[0])&&(f.configuration=f.configuration||{inputFlows:{value:[0]}},f.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{MO:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{MO:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{MO:["FlowGraphCancelDelayBlock"]},"variable/get":{MO:["FlowGraphGetVariableBlock"],validation(f){var v,Z;return null!==(v=f.configuration)&&void 0!==v&&null!==(Z=v.variable)&&void 0!==Z&&Z.value?{valid:!0}:(X.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(f,v)=>[v.getVariableName(f[0])]}}},"variable/set":{MO:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(f,v)=>[v.getVariableName(f[0])]}}},"variable/setMultiple":{MO:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(f,v)=>[f[0].map((f=>v.getVariableName(f)))]}},extraProcessor:(f,v,Z,V,h)=>(h[0].dataInputs.forEach((f=>{f.name=V.getVariableName(+f.name)})),h)},"variable/interpolate":{MO:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(f,v)=>[v.getVariableName(f[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:f=>!0===f[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",zZ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",zZ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",zZ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",zZ:"FlowGraphPlayAnimationBlock"},out:{name:"out",zZ:"FlowGraphPlayAnimationBlock"},done:{name:"done",zZ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(f,v,Z,V,h){var J,l,e;const C=h[0],H=null===(J=f.configuration)||void 0===J?void 0:J.variable.value[0];if("number"!==typeof H)throw X.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const O=V.arrays.staticVariables[H];"undefined"===typeof C.config.animationType.value&&(V.arrays.staticVariables,C.config.animationType.value=(0,AZ.N)(O.type));const u=h[4];return u.config||(u.config={}),(l=u.config).variable||(l.variable={}),u.config.variable.value=V.getVariableName(H),(e=h[3]).config||(e.config={}),h}},"pointer/get":{MO:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",zZ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",zZ:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(f,v,Z,V,h)=>(h.forEach((f=>{"FlowGraphJsonPointerParserBlock"===f.className&&(f.config||(f.config={}),f.config.outputValue=!0)})),h)},"pointer/set":{MO:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",zZ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",zZ:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(f,v,Z,V,h)=>(h.forEach((f=>{"FlowGraphJsonPointerParserBlock"===f.className&&(f.config||(f.config={}),f.config.outputValue=!0)})),h)},"pointer/interpolate":{MO:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",zZ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",zZ:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",zZ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",zZ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",zZ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",zZ:"FlowGraphPlayAnimationBlock"},out:{name:"out",zZ:"FlowGraphPlayAnimationBlock"},done:{name:"done",zZ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(f,v,Z,V,h)=>(h.forEach((v=>{"FlowGraphJsonPointerParserBlock"===v.className?(v.config||(v.config={}),v.config.outputValue=!0):"FlowGraphInterpolationBlock"===v.className&&(v.config||(v.config={}),Object.keys(f.values||[]).forEach((Z=>{var h;const J=null===(h=f.values)||void 0===h?void 0:h[Z];if("value"===Z&&J){const f=J.type;void 0!==f&&(v.config.animationType=V.arrays.types[f].flowGraphType)}})))})),h)},"animation/start":{MO:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",zZ:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(f,v)=>[f[0]*v._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(f,v)=>[f[0]*v._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(f,v,Z,V,h,J,l){const e=h[h.length-1];return e.config||(e.config={}),e.config.glTF=l,h}},"animation/stop":{MO:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",zZ:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(f,v,Z,V,h,J,l){const e=h[h.length-1];return e.config||(e.config={}),e.config.glTF=l,h}},"animation/stopAt":{MO:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",zZ:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(f,v)=>[f[0]*v._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(f,v,Z,V,h,J,l){const e=h[h.length-1];return e.config||(e.config={}),e.config.glTF=l,h}},"math/switch":{MO:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(f){if(f.configuration&&f.configuration.cases){const v=f.configuration.cases.value;if(!v.every((f=>"number"===typeof f&&/^-?\d+$/.test(f.toString()))))return X.e.Warn("Switch cases should be integers. Using empty array instead."),f.configuration.cases.value=[],{valid:!0};const Z=new Set(v);f.configuration.cases.value=Array.from(Z)}return{valid:!0}},extraProcessor(f,v,Z,V,h){const J=h[0];return J.dataInputs.forEach((f=>{"default"!==f.name&&"case"!==f.name&&(f.name="in_"+f.name)})),J.config||(J.config={}),J.config.treatCasesAsIntegers=!0,h}},"debug/log":{MO:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function gZ(f){let v=arguments.length>2?arguments[2]:void 0;return{MO:[f],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((f,v)=>(f[v]={name:v},f)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(f,Z,V,h,J){var l;if(v){(l=J[0]).config||(l.config={}),J[0].config.preventIntegerFloatArithmetic=!0;let v=-1;Object.keys(f.values||{}).find((Z=>{var V;return void 0!==(null===(V=f.values)||void 0===V?void 0:V[Z].type)&&(v=f.values[Z].type,!0)})),-1!==v&&(J[0].config.type=h.arrays.types[v].flowGraphType)}return J},validation:f=>v?wZ(f):{valid:!0}}}function wZ(f){if(f.values){const v=Object.keys(f.values).map((v=>f.values[v].type)).filter((f=>void 0!==f));if(!v.every((f=>f===v[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}PZ["math/compose"]=PZ["math/matCompose"],PZ["math/decompose"]=PZ["math/matDecompose"];var tZ=Z(11378);const LZ={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Xv",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class EZ{constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=f,this._gltf=v,this._animationTargetFps=Z,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const f of this._interactivityGraph.types)this._types.push(LZ[f.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const f of this._interactivityGraph.declarations){const v=IZ(f);if(!v)throw X.e.Error(["No mapping found for declaration",f]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:v,fullOperationName:f.extension?f.op+":"+f.extension:f.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const f of this._interactivityGraph.variables){const v=this._parseVariable(f);this._staticVariables.push(v)}}_parseVariable(f,v){const Z=this._types[f.type];if(!Z)throw X.e.Error(["No type found for variable",f]),new Error("Error parsing variables");if(f.value&&f.value.length!==Z.length)throw X.e.Error(["Invalid value length for variable",f,Z]),new Error("Error parsing variables");const V=f.value||[];if(!V.length)switch(Z.flowGraphType){case"boolean":V.push(!1);break;case"FlowGraphInteger":V.push(0);break;case"number":V.push(NaN);break;case"Vector2":V.push(NaN,NaN);break;case"Xv":V.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":V.fill(NaN,0,4);break;case"Matrix":V.fill(NaN,0,16);break;case"Matrix3D":V.fill(NaN,0,9)}return"number"===Z.elementType&&"string"===typeof V[0]&&(V[0]=parseFloat(V[0])),{type:Z.flowGraphType,value:v?v(V,this):V}}_parseEvents(){if(this._interactivityGraph.events)for(const f of this._interactivityGraph.events){const v={eventId:f.id||"internalEvent_"+this._internalEventsCounter++};f.values&&(v.eventData=Object.keys(f.values).map((v=>{var Z;const V=null===(Z=f.values)||void 0===Z?void 0:Z[v];if(!V)throw X.e.Error(["No value found for event key",v]),new Error("Error parsing events");const h=this._types[V.type];if(!h)throw X.e.Error(["No type found for event value",V]),new Error("Error parsing events");const J="undefined"!==typeof V.value?this._parseVariable(V):void 0;return{id:v,type:h.flowGraphType,eventData:!0,value:J}}))),this._events.push(v)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const v of this._interactivityGraph.nodes){if("number"!==typeof v.declaration)throw X.e.Error(["No declaration found for node",v]),new Error("Error parsing nodes");const Z=this._mappings[v.declaration];if(!Z)throw X.e.Error(["No mapping found for node",v]),new Error("Error parsing nodes");if(Z.flowGraphMapping.validation){const V=Z.flowGraphMapping.validation(v,this._interactivityGraph,this._gltf);var f;if(!V.valid)throw new Error(`Error validating interactivity node ${null===(f=this._interactivityGraph.declarations)||void 0===f?void 0:f[v.declaration].op} - ${V.error}`)}const V=[];for(const f of Z.flowGraphMapping.MO){const h=this._getEmptyBlock(f,Z.fullOperationName);this._parseNodeConfiguration(v,h,Z.flowGraphMapping,f),V.push(h)}this._nodes.push({MO:V,fullOperationName:Z.fullOperationName})}}_getEmptyBlock(f,v){return{uniqueId:(0,tZ.c)(),className:f,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:v,metadata:{}}}_parseNodeConfiguration(f,v,Z,V){const h=v.config;if(f.configuration){const v=Object.keys(f.configuration);for(const e of v){var J,l;const v=null===(J=f.configuration)||void 0===J?void 0:J[e];if(!v)throw X.e.Error(["No value found for node configuration",e]),new Error("Error parsing node configuration");const C=null===(l=Z.configuration)||void 0===l?void 0:l[e];if(C&&C.zZ?C.zZ===V:0===Z.MO.indexOf(V)){const f=(null===C||void 0===C?void 0:C.name)||e;v&&"undefined"!==typeof v.value||"undefined"===typeof(null===C||void 0===C?void 0:C.defaultValue)?v.value.length>=0?h[f]={value:1===v.value.length?v.value[0]:v.value}:X.e.Warn(["Invalid value for node configuration",v]):h[f]={value:C.defaultValue},C&&C.dataTransformer&&(h[f].value=C.dataTransformer([h[f].value],this)[0])}}}}_parseNodeConnections(f){for(let z=0;z<this._nodes.length;z++){var v;const Y=null===(v=this._interactivityGraph.nodes)||void 0===v?void 0:v[z];if(!Y)throw X.e.Error(["No node found for interactivity node",this._nodes[z]]),new Error("Error parsing node connections");const y=this._nodes[z],N=this._mappings[Y.declaration];if(!N)throw X.e.Error(["No mapping found for node",Y]),new Error("Error parsing node connections");const i=Y.flows||{},I=Object.keys(i).sort();for(const f of I){var Z,V,h,J;const v=i[f],H=null===(Z=N.flowGraphMapping.outputs)||void 0===Z||null===(V=Z.flows)||void 0===V?void 0:V[f],O=(null===H||void 0===H?void 0:H.name)||f,u=this._createNewSocketConnection(O,!0);(H&&H.zZ&&y.MO.find((f=>f.className===H.zZ))||y.MO[0]).signalOutputs.push(u);const W=v.node,a=this._nodes[W];if(!a)throw X.e.Error(["No node found for input node id",W]),new Error("Error parsing node connections");const b=iZ(a.fullOperationName);if(!b)throw X.e.Error(["No mapping found for input node",a]),new Error("Error parsing node connections");let F=null===(h=b.inputs)||void 0===h||null===(J=h.flows)||void 0===J?void 0:J[v.socket||"in"],U=!1;if(!F)for(const f in null===(l=b.inputs)||void 0===l?void 0:l.flows){var l,e,C;if(f.startsWith("[")&&f.endsWith("]"))U=!0,F=null===(e=b.inputs)||void 0===e||null===(C=e.flows)||void 0===C?void 0:C[f]}const K=F?U?F.name.replace("$1",v.socket||""):F.name:v.socket||"in",M=F&&F.zZ&&a.MO.find((f=>f.className===F.zZ))||a.MO[0];let A=M.signalInputs.find((f=>f.name===K));A||(A=this._createNewSocketConnection(K),M.signalInputs.push(A)),A.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(A.uniqueId)}const T=Y.values||{},B=Object.keys(T);for(const v of B){var H,O;const Z=T[v];let V=null===(H=N.flowGraphMapping.inputs)||void 0===H||null===(O=H.values)||void 0===O?void 0:O[v],h=!1;if(!V)for(const f in null===(u=N.flowGraphMapping.inputs)||void 0===u?void 0:u.values){var u,W,a;if(f.startsWith("[")&&f.endsWith("]"))h=!0,V=null===(W=N.flowGraphMapping.inputs)||void 0===W||null===(a=W.values)||void 0===a?void 0:a[f]}const J=V?h?V.name.replace("$1",v):V.name:v,l=this._createNewSocketConnection(J);if((V&&V.zZ&&y.MO.find((f=>f.className===V.zZ))||y.MO[0]).dataInputs.push(l),void 0!==Z.value){const v=this._parseVariable(Z,V&&V.dataTransformer);f._connectionValues[l.uniqueId]=v}else{if("undefined"===typeof Z.node)throw X.e.Error(["Invalid value for value connection",Z]),new Error("Error parsing node connections");{var b,F,U;const f=Z.node,v=Z.socket||"value",V=this._nodes[f];if(!V)throw X.e.Error(["No node found for output socket reference",Z]),new Error("Error parsing node connections");const h=iZ(V.fullOperationName);if(!h)throw X.e.Error(["No mapping found for output socket reference",Z]),new Error("Error parsing node connections");let J=null===(b=h.outputs)||void 0===b||null===(F=b.values)||void 0===F?void 0:F[v],e=!1;if(!J)for(const Z in null===(K=h.outputs)||void 0===K?void 0:K.values){var K,M,A;if(Z.startsWith("[")&&Z.endsWith("]"))e=!0,J=null===(M=h.outputs)||void 0===M||null===(A=M.values)||void 0===A?void 0:A[Z]}const C=J?e?J.name.replace("$1",v):null===(U=J)||void 0===U?void 0:U.name:v,H=J&&J.zZ&&V.MO.find((f=>f.className===J.zZ))||V.MO[0];let O=H.dataOutputs.find((f=>f.name===C));O||(O=this._createNewSocketConnection(C,!0),H.dataOutputs.push(O)),l.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(l.uniqueId)}}}if(N.flowGraphMapping.interBlockConnectors)for(const f of N.flowGraphMapping.interBlockConnectors){const v=f.input,Z=f.output,V=f.isVariable;this._connectFlowGraphNodes(v,Z,y.MO[f.inputBlockIndex],y.MO[f.outputBlockIndex],V)}if(N.flowGraphMapping.extraProcessor){var s;const v=null===(s=this._interactivityGraph.declarations)||void 0===s?void 0:s[Y.declaration];if(!v)throw X.e.Error(["No declaration found for extra processor",Y]),new Error("Error parsing node connections");y.MO=N.flowGraphMapping.extraProcessor(Y,v,N.flowGraphMapping,this,y.MO,f,this._gltf)}}}_createNewSocketConnection(f,v){return{uniqueId:(0,tZ.c)(),name:f,_connectionType:v?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(f,v,Z,V,h){const J=h?Z.dataInputs:Z.signalInputs,l=h?V.dataOutputs:V.signalOutputs,e=J.find((v=>v.name===f))||this._createNewSocketConnection(f),C=l.find((f=>f.name===v))||this._createNewSocketConnection(v,!0);J.find((v=>v.name===f))||J.push(e),l.find((f=>f.name===v))||l.push(C),e.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(e.uniqueId)}getVariableName(f){return"staticVariable_"+f}serializeToFlowGraph(){const f={uniqueId:(0,tZ.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(f);for(let v=0;v<this._staticVariables.length;v++){const Z=this._staticVariables[v];f._userVariables[this.getVariableName(v)]=Z}return{rightHanded:!0,allBlocks:this._nodes.reduce(((f,v)=>f.concat(v.MO)),[]),executionContexts:[f]}}}const jZ="KHR_interactivity";class qZ{constructor(f){this._loader=f,this.name=jZ,this.enabled=this._loader.isExtensionUsed(jZ),this._pathConverter=(0,q.h)(this._loader.yh),f._skipStartAnimationStep=!0;const v=f.babylonScene;v&&function(f){(0,q.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!f.activeCamera)return new h.Quaternion(NaN,NaN,NaN,NaN);const v=h.Quaternion.FromRotationMatrix(f.activeCamera.getWorldMatrix()).normalize();return f.useRightHandedSystem||(v.w*=-1,v.x*=-1),v},type:"Quaternion",getTarget:()=>f.activeCamera}),(0,q.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!f.activeCamera)return new h.Xv(NaN,NaN,NaN);const v=f.activeCamera.getWorldMatrix().getTranslation();return f.useRightHandedSystem||(v.x*=-1),v},type:"Xv",getTarget:()=>f.activeCamera}),(0,q.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:f=>{var v;return(null===(v=f._babylonAnimationGroup)||void 0===v?void 0:v.isPlaying)??!1},type:"boolean",getTarget:f=>f._babylonAnimationGroup}),(0,q.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:f=>{var v;return((null===(v=f._babylonAnimationGroup)||void 0===v?void 0:v.from)??0)/60},type:"number",getTarget:f=>f._babylonAnimationGroup}),(0,q.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:f=>{var v;return((null===(v=f._babylonAnimationGroup)||void 0===v?void 0:v.to)??0)/60},type:"number",getTarget:f=>f._babylonAnimationGroup}),(0,q.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:f=>{var v;return((null===(v=f._babylonAnimationGroup)||void 0===v?void 0:v.getCurrentFrame())??0)/60},type:"number",getTarget:f=>f._babylonAnimationGroup}),(0,q.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:f=>{var v;return((null===(v=f._babylonAnimationGroup)||void 0===v?void 0:v.getCurrentFrame())??0)/60},type:"number",getTarget:f=>f._babylonAnimationGroup})}(v)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var f;if(!this._loader.babylonScene||!this._pathConverter)return;const v=this._loader.babylonScene,Z=null===(f=this._loader.yh.extensions)||void 0===f?void 0:f.KHR_interactivity;if(!Z)return;const V=new XZ.d({Uv:v});V.dispatchEventsSynchronously=!1;const h=Z.graphs.map((f=>new EZ(f,this._loader.yh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(h.map((async f=>await YZ(f,{coordinator:V,pathConverter:this._pathConverter})))),V.start()}}var cZ;cZ=async()=>(await Promise.resolve().then(Z.bind(Z,13180))).FlowGraphGLTFDataProvider,FZ[`${jZ}/${"FlowGraphGLTFDataProvider"}`]=cZ,j(jZ),E(jZ,!0,(f=>new qZ(f)));const mZ="KHR_node_visibility";(0,q.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:f=>{const v=f._babylonTransformNode;return!v||void 0===v.isVisible||v.isVisible},set:(f,v)=>{var Z,V;null===(Z=v._primitiveBabylonMeshes)||void 0===Z||Z.forEach((f=>{f.inheritVisibility=!0})),v._babylonTransformNode&&(v._babylonTransformNode.isVisible=f),null===(V=v._primitiveBabylonMeshes)||void 0===V||V.forEach((v=>{v.isVisible=f}))},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class pZ{constructor(f){this.name=mZ,this._loader=f,this.enabled=f.isExtensionUsed(mZ)}async onReady(){var f;null===(f=this._loader.yh.nodes)||void 0===f||f.forEach((f=>{var v,Z,V,h;(null===(v=f._primitiveBabylonMeshes)||void 0===v||v.forEach((f=>{f.inheritVisibility=!0})),null!==(Z=f.extensions)&&void 0!==Z&&Z.KHR_node_visibility)&&(!1===(null===(V=f.extensions)||void 0===V?void 0:V.KHR_node_visibility.visible)&&(f._babylonTransformNode&&(f._babylonTransformNode.isVisible=!1),null===(h=f._primitiveBabylonMeshes)||void 0===h||h.forEach((f=>{f.isVisible=!1}))))}))}dispose(){this._loader=null}}j(mZ),E(mZ,!0,(f=>new pZ(f)));const kZ="KHR_node_selectability";TZ("event/onSelect",kZ,{MO:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",zZ:"FlowGraphGetVariableBlock",dataTransformer:f=>["pickedMesh_"+f[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",zZ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(f,v,Z,V,h,J,l){var e,C,H,O,u,W;const a=h[h.length-1];a.config=a.config||{},a.config.glTF=l;const b=null===(e=f.configuration)||void 0===e||null===(C=e.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const X="pickedMesh_"+b;return h[1].config.variable=X,J._userVariables[X]={className:"Mesh",id:null===l||void 0===l||null===(H=l.nodes)||void 0===H||null===(O=H[b]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===l||void 0===l||null===(u=l.nodes)||void 0===u||null===(W=u[b]._babylonTransformNode)||void 0===W?void 0:W.uniqueId},h}}),(0,q.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:f=>{const v=f._babylonTransformNode;return!v||void 0===v.oC||v.oC},set:(f,v)=>{var Z;null===(Z=v._primitiveBabylonMeshes)||void 0===Z||Z.forEach((v=>{v.oC=f}))},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"oC"],type:"boolean"});class rZ{constructor(f){this.name=kZ,this._loader=f,this.enabled=f.isExtensionUsed(kZ)}async onReady(){var f;null===(f=this._loader.yh.nodes)||void 0===f||f.forEach((f=>{var v,Z,V;null!==(v=f.extensions)&&void 0!==v&&v.KHR_node_selectability&&!1===(null===(Z=f.extensions)||void 0===Z?void 0:Z.KHR_node_selectability.selectable)&&(null===(V=f._babylonTransformNode)||void 0===V||V.getChildMeshes().forEach((f=>{f.oC=!1})))}))}dispose(){this._loader=null}}j(kZ),E(kZ,!0,(f=>new rZ(f)));const oZ="KHR_node_hoverability",GZ="targetMeshPointerOver_";TZ("event/onHoverIn",oZ,{MO:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",zZ:"FlowGraphGetVariableBlock",dataTransformer:f=>[GZ+f[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",zZ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(f,v,Z,V,h,J,l){var e,C,H,O,u,W;const a=h[h.length-1];a.config=a.config||{},a.config.glTF=l;const b=null===(e=f.configuration)||void 0===e||null===(C=e.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const X=GZ+b;return h[1].config.variable=X,J._userVariables[X]={className:"Mesh",id:null===l||void 0===l||null===(H=l.nodes)||void 0===H||null===(O=H[b]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===l||void 0===l||null===(u=l.nodes)||void 0===u||null===(W=u[b]._babylonTransformNode)||void 0===W?void 0:W.uniqueId},h}});const QZ="targetMeshPointerOut_";TZ("event/onHoverOut",oZ,{MO:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",zZ:"FlowGraphGetVariableBlock",dataTransformer:f=>[QZ+f[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",zZ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(f,v,Z,V,h,J,l){var e,C,H,O,u,W;const a=h[h.length-1];a.config=a.config||{},a.config.glTF=l;const b=null===(e=f.configuration)||void 0===e||null===(C=e.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const X=QZ+b;return h[1].config.variable=X,J._userVariables[X]={className:"Mesh",id:null===l||void 0===l||null===(H=l.nodes)||void 0===H||null===(O=H[b]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===l||void 0===l||null===(u=l.nodes)||void 0===u||null===(W=u[b]._babylonTransformNode)||void 0===W?void 0:W.uniqueId},h}}),(0,q.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:f=>{const v=f._babylonTransformNode;return!v||void 0===v.pointerOverDisableMeshTesting||v.pointerOverDisableMeshTesting},set:(f,v)=>{var Z;null===(Z=v._primitiveBabylonMeshes)||void 0===Z||Z.forEach((v=>{v.pointerOverDisableMeshTesting=!f}))},getTarget:f=>f._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class dZ{constructor(f){this.name=oZ,this._loader=f,this.enabled=f.isExtensionUsed(oZ)}async onReady(){var f;null===(f=this._loader.yh.nodes)||void 0===f||f.forEach((f=>{var v,Z,V;null!==(v=f.extensions)&&void 0!==v&&v.KHR_node_hoverability&&!1===(null===(Z=f.extensions)||void 0===Z?void 0:Z.KHR_node_hoverability.hoverable)&&(null===(V=f._babylonTransformNode)||void 0===V||V.getChildMeshes().forEach((f=>{f.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}j(oZ),E(oZ,!0,(f=>new dZ(f)));const xZ="ExtrasAsMetadata";class RZ{_assignExtras(f,v){if(v.extras&&Object.keys(v.extras).length>0){const Z=f.metadata=f.metadata||{};(Z.yh=Z.yh||{}).extras=v.extras}}constructor(f){this.name=xZ,this.enabled=!0,this._loader=f}dispose(){this._loader=null}loadNodeAsync(f,v,Z){return this._loader.loadNodeAsync(f,v,(f=>{this._assignExtras(f,v),Z(f)}))}loadCameraAsync(f,v,Z){return this._loader.loadCameraAsync(f,v,(f=>{this._assignExtras(f,v),Z(f)}))}createMaterial(f,v,Z){const V=this._loader.createMaterial(f,v,Z);return this._assignExtras(V,v),V}}j(xZ),E(xZ,!1,(f=>new RZ(f)));Z(13180)},13053:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>g,f:()=>N,j:()=>y,k:()=>i});var V=Z(11235),h=Z(11230),J=Z(12700),l=Z(11859),e=Z(11820),C=Z(11833),H=Z(11247),O=Z(11281),u=Z(11851),W=Z(11942),a=Z(11863),b=Z(11466);class X{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fW=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.LW=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(f){this._environmentTexture=f}getNodes(){let f=[];f=f.concat(this.meshes),f=f.concat(this.lights),f=f.concat(this.cameras),f=f.concat(this.transformNodes);for(const v of this.skeletons)f=f.concat(v.bones);return f}}class F extends X{}class U{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const f=this.rootNodes;for(const V of f)V.dispose();f.length=0;const v=this.skeletons;for(const V of v)V.dispose();v.length=0;const Z=this.animationGroups;for(const V of Z)V.dispose();Z.length=0}}class K extends X{constructor(f){super(),this._wasAddedToScene=!1,(f=f||O.c.LastCreatedScene)&&(this.Uv=f,this.proceduralTextures=[],f.Kh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=f.getEngine().onContextRestoredObservable.add((()=>{for(const f of this.geometries)f._rebuild();for(const f of this.meshes)f._rebuild();for(const f of this.fW)f.rebuild();for(const f of this.textures)f._rebuild()})))}_topologicalSort(f){const v=new Map;for(const l of f)v.set(l.uniqueId,l);const Z={dependsOn:new Map,dependedBy:new Map};for(const l of f){const f=l.uniqueId;Z.dependsOn.set(f,new Set),Z.dependedBy.set(f,new Set)}for(const l of f){const f=l.uniqueId,V=Z.dependsOn.get(f);if(l instanceof u.c){const h=l.sourceMesh;v.has(h.uniqueId)&&(V.add(h.uniqueId),Z.dependedBy.get(h.uniqueId).add(f))}const h=Z.dependedBy.get(f);for(const J of l.getDescendants()){const V=J.uniqueId;if(v.has(V)){h.add(V);Z.dependsOn.get(V).add(f)}}}const V=[],h=[];for(const l of f){const f=l.uniqueId;0===Z.dependsOn.get(f).size&&(h.push(l),v.delete(f))}const J=h;for(;J.length>0;){const f=J.shift();V.push(f);const h=Z.dependedBy.get(f.uniqueId);for(const V of Array.from(h.values())){const h=Z.dependsOn.get(V);h.delete(f.uniqueId),0===h.size&&v.get(V)&&(J.push(v.get(V)),v.delete(V))}}return v.size>0&&(H.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),v.forEach((f=>{H.e.Error(f.name)}))),V}_addNodeAndDescendantsToList(f,v,Z,V){if(Z&&(!V||V(Z))&&!v.has(Z.uniqueId)){f.push(Z),v.add(Z.uniqueId);for(const h of Z.getDescendants(!0))this._addNodeAndDescendantsToList(f,v,h,V)}}_isNodeInContainer(f){return f instanceof C.e&&-1!==this.meshes.indexOf(f)||(f instanceof e.e&&-1!==this.transformNodes.indexOf(f)||(f instanceof W.c&&-1!==this.lights.indexOf(f)||f instanceof a.d&&-1!==this.cameras.indexOf(f)))}_isValidHierarchy(){for(const f of this.meshes)if(f.parent&&!this._isNodeInContainer(f.parent))return H.e.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.transformNodes)if(f.parent&&!this._isNodeInContainer(f.parent))return H.e.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.lights)if(f.parent&&!this._isNodeInContainer(f.parent))return H.e.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.cameras)if(f.parent&&!this._isNodeInContainer(f.parent))return H.e.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const V={},J={},e=new U,C=[],H=[],O={doNotInstantiate:!0,...Z},u=[],W=new Set;for(const h of this.transformNodes)null===h.parent&&this._addNodeAndDescendantsToList(u,W,h,O.predicate);for(const h of this.meshes)null===h.parent&&this._addNodeAndDescendantsToList(u,W,h,O.predicate);const a=this._topologicalSort(u),b=(Z,h)=>{if(((v,Z)=>{if(V[v.uniqueId]=Z.uniqueId,J[Z.uniqueId]=Z,f&&(Z.name=f(v.name)),Z instanceof l.d){const f=Z;if(f.morphTargetManager){const Z=v.morphTargetManager;f.morphTargetManager=Z.clone();for(let v=0;v<Z.numTargets;v++){const h=Z.getTarget(v),l=f.morphTargetManager.getTarget(v);V[h.uniqueId]=l.uniqueId,J[l.uniqueId]=l}}}})(Z,h),Z.parent){const f=V[Z.parent.uniqueId],v=J[f];h.parent=v||Z.parent}if(h.position&&Z.position&&h.position.h(Z.position),h.rotationQuaternion&&Z.rotationQuaternion&&h.rotationQuaternion.h(Z.rotationQuaternion),h.rotation&&Z.rotation&&h.rotation.h(Z.rotation),h.Ze&&Z.Ze&&h.Ze.h(Z.Ze),h.material){const l=h;if(l.material)if(v){const v=Z.material;if(-1===H.indexOf(v)){let Z=v.clone(f?f(v.name):"Clone of "+v.name);if(H.push(v),V[v.uniqueId]=Z.uniqueId,J[Z.uniqueId]=Z,"MultiMaterial"===v.getClassName()){const h=v;for(const v of h.ue)v&&(Z=v.clone(f?f(v.name):"Clone of "+v.name),H.push(v),V[v.uniqueId]=Z.uniqueId,J[Z.uniqueId]=Z);h.ue=h.ue.map((f=>f&&J[V[f.uniqueId]]))}}"InstancedMesh"!==l.getClassName()&&(l.material=J[V[v.uniqueId]])}else"MultiMaterial"===l.material.getClassName()?-1===this.Uv.multiMaterials.indexOf(l.material)&&this.Uv.addMultiMaterial(l.material):-1===this.Uv.materials.indexOf(l.material)&&this.Uv.addMaterial(l.material)}null===h.parent&&e.rootNodes.push(h)};for(const h of a)if("InstancedMesh"===h.getClassName()){const f=h,v=f.sourceMesh,Z=V[v.uniqueId];b(f,("number"===typeof Z?J[Z]:v).createInstance(f.name))}else{let f=!0;"Ie"===h.getClassName()||"Node"===h.getClassName()||h.skeleton||!h.getTotalVertices||0===h.getTotalVertices()?f=!1:O.doNotInstantiate&&(f="function"===typeof O.doNotInstantiate?!O.doNotInstantiate(h):!O.doNotInstantiate);const v=f?h.createInstance(`instance of ${h.name}`):h.clone(`Clone of ${h.name}`,null,!0);if(!v)throw new Error(`Could not clone or instantiate node on Asset Container ${h.name}`);b(h,v)}for(const h of this.skeletons){if(O.predicate&&!O.predicate(h))continue;const v=h.clone(f?f(h.name):"Clone of "+h.name);for(const f of this.meshes)if(f.skeleton===h&&!f.isAnInstance){const Z=J[V[f.uniqueId]];if(!Z||Z.isAnInstance)continue;if(Z.skeleton=v,-1!==C.indexOf(v))continue;C.push(v);for(const f of v.bones)f._linkedTransformNode&&(f._linkedTransformNode=J[V[f._linkedTransformNode.uniqueId]])}e.skeletons.push(v)}for(const h of this.animationGroups){if(O.predicate&&!O.predicate(h))continue;const v=h.clone(f?f(h.name):"Clone of "+h.name,(f=>J[V[f.uniqueId]]||f));e.animationGroups.push(v)}return e}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Uv.environmentTexture=this.environmentTexture);for(const f of this.Uv._serializableComponents)f.addFromContainer(this);this.Uv.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=[];for(const Z of this.cameras)f&&!f(Z)||(this.Uv.addCamera(Z),v.push(Z));for(const Z of this.lights)f&&!f(Z)||(this.Uv.addLight(Z),v.push(Z));for(const Z of this.meshes)f&&!f(Z)||(this.Uv.eO(Z),v.push(Z));for(const Z of this.skeletons)f&&!f(Z)||this.Uv.addSkeleton(Z);for(const Z of this.animations)f&&!f(Z)||this.Uv.addAnimation(Z);for(const Z of this.animationGroups)f&&!f(Z)||this.Uv.addAnimationGroup(Z);for(const Z of this.multiMaterials)f&&!f(Z)||this.Uv.addMultiMaterial(Z);for(const Z of this.materials)f&&!f(Z)||this.Uv.addMaterial(Z);for(const Z of this.morphTargetManagers)f&&!f(Z)||this.Uv.addMorphTargetManager(Z);for(const Z of this.geometries)f&&!f(Z)||this.Uv.addGeometry(Z);for(const Z of this.transformNodes)f&&!f(Z)||(this.Uv.addTransformNode(Z),v.push(Z));for(const Z of this.actionManagers)f&&!f(Z)||this.Uv.addActionManager(Z);for(const Z of this.textures)f&&!f(Z)||this.Uv.addTexture(Z);for(const Z of this.reflectionProbes)f&&!f(Z)||this.Uv.addReflectionProbe(Z);for(const Z of v)Z.parent&&-1===this.Uv.getNodes().indexOf(Z.parent)&&(Z.setParent?Z.setParent(null):Z.parent=null)}removeAllFromScene(){this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Uv.environmentTexture&&(this.Uv.environmentTexture=null);for(const f of this.Uv._serializableComponents)f.removeFromContainer(this)}removeFromScene(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const v of this.cameras)f&&!f(v)||this.Uv.removeCamera(v);for(const v of this.lights)f&&!f(v)||this.Uv.removeLight(v);for(const v of this.meshes)f&&!f(v)||this.Uv.lO(v,!0);for(const v of this.skeletons)f&&!f(v)||this.Uv.removeSkeleton(v);for(const v of this.animations)f&&!f(v)||this.Uv.removeAnimation(v);for(const v of this.animationGroups)f&&!f(v)||this.Uv.removeAnimationGroup(v);for(const v of this.multiMaterials)f&&!f(v)||this.Uv.removeMultiMaterial(v);for(const v of this.materials)f&&!f(v)||this.Uv.removeMaterial(v);for(const v of this.morphTargetManagers)f&&!f(v)||this.Uv.removeMorphTargetManager(v);for(const v of this.geometries)f&&!f(v)||this.Uv.removeGeometry(v);for(const v of this.transformNodes)f&&!f(v)||this.Uv.removeTransformNode(v);for(const v of this.actionManagers)f&&!f(v)||this.Uv.removeActionManager(v);for(const v of this.textures)f&&!f(v)||this.Uv.removeTexture(v);for(const v of this.reflectionProbes)f&&!f(v)||this.Uv.removeReflectionProbe(v)}dispose(){const f=this.cameras.slice(0);for(const a of f)a.dispose();this.cameras.length=0;const v=this.lights.slice(0);for(const a of v)a.dispose();this.lights.length=0;const Z=this.meshes.slice(0);for(const a of Z)a.dispose();this.meshes.length=0;const V=this.skeletons.slice(0);for(const a of V)a.dispose();this.skeletons.length=0;const h=this.animationGroups.slice(0);for(const a of h)a.dispose();this.animationGroups.length=0;const J=this.multiMaterials.slice(0);for(const a of J)a.dispose();this.multiMaterials.length=0;const l=this.materials.slice(0);for(const a of l)a.dispose();this.materials.length=0;const e=this.geometries.slice(0);for(const a of e)a.dispose();this.geometries.length=0;const C=this.transformNodes.slice(0);for(const a of C)a.dispose();this.transformNodes.length=0;const H=this.actionManagers.slice(0);for(const a of H)a.dispose();this.actionManagers.length=0;const O=this.textures.slice(0);for(const a of O)a.dispose();this.textures.length=0;const u=this.reflectionProbes.slice(0);for(const a of u)a.dispose();this.reflectionProbes.length=0;const W=this.morphTargetManagers.slice(0);for(const a of W)a.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const a of this.Uv._serializableComponents)a.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Uv.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(f,v,Z){if(f&&v)for(const V of f){let f=!0;if(Z)for(const v of Z)if(V===v){f=!1;break}f&&(v.push(V),V._parentContainer=this)}}moveAllFromScene(f){this._wasAddedToScene=!1,void 0===f&&(f=new F);for(const v in this)Object.prototype.hasOwnProperty.call(this,v)&&(this[v]=this[v]||("_environmentTexture"===v?null:[]),this._moveAssets(this.Uv[v],this[v],f[v]));this.environmentTexture=this.Uv.environmentTexture,this.removeAllFromScene()}createRootMesh(){const f=new l.d("assetContainerRootMesh",this.Uv);for(const v of this.meshes)v.parent||f.addChild(v);return this.meshes.unshift(f),f}mergeAnimationsTo(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.c.LastCreatedScene,v=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!f)return H.e.Error("No scene available to merge animations to"),[];const V=Z||(v=>{let Z=null;const V=v.animations.length?v.animations[0].targetProperty:"",h=v.name.split(".").join("").split("_primitive")[0];switch(V){case"position":case"rotationQuaternion":Z=f.getTransformNodeByName(v.name)||f.getTransformNodeByName(h);break;case"influence":Z=f.getMorphTargetByName(v.name)||f.getMorphTargetByName(h);break;default:Z=f.getNodeByName(v.name)||f.getNodeByName(h)}return Z}),h=this.getNodes();for(const e of h){const f=V(e);if(null!==f){for(const v of e.animations){const Z=f.animations.filter((f=>f.targetProperty===v.targetProperty));for(const v of Z){const Z=f.animations.indexOf(v,0);Z>-1&&f.animations.splice(Z,1)}}f.animations=f.animations.concat(e.animations)}}const J=[],l=this.animationGroups.slice();for(const e of l){J.push(e.clone(e.name,V));for(const f of e.animatables)f.stop()}for(const e of v){const v=V(e.target);v&&(f.beginAnimation(v,e.fromFrame,e.toFrame,e.loopAnimation,e.speedRatio,e.onAnimationEnd?e.onAnimationEnd:void 0,void 0,!0,void 0,e.onAnimationLoop?e.onAnimationLoop:void 0),f.stopAnimation(e.target))}return J}populateRootNodes(){this.rootNodes.length=0;for(const f of this.meshes)f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f);for(const f of this.transformNodes)f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f);for(const f of this.lights)f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f);for(const f of this.cameras)f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)}addAllAssetsToContainer(f){if(!f)return;const v=[],Z=new Set;for(v.push(f);v.length>0;){const f=v.pop();if(f instanceof l.d?(f.qh&&-1===this.geometries.indexOf(f.qh)&&this.geometries.push(f.qh),this.meshes.push(f)):f instanceof u.c?this.meshes.push(f):f instanceof e.e?this.transformNodes.push(f):f instanceof W.c?this.lights.push(f):f instanceof a.d&&this.cameras.push(f),f instanceof C.e){if(f.material&&-1===this.materials.indexOf(f.material)){this.materials.push(f.material);for(const v of f.material.getActiveTextures())-1===this.textures.indexOf(v)&&this.textures.push(v)}f.skeleton&&-1===this.skeletons.indexOf(f.skeleton)&&this.skeletons.push(f.skeleton),f.morphTargetManager&&-1===this.morphTargetManagers.indexOf(f.morphTargetManager)&&this.morphTargetManagers.push(f.morphTargetManager)}for(const V of f.getChildren())Z.has(V)||v.push(V);Z.add(f)}this.populateRootNodes()}_getByTags(f,v,Z){if(void 0===v)return f;const V=[];for(const h in f){const J=f[h];b.b&&b.b.MatchesQuery(J,v)&&(!Z||Z(J))&&V.push(J)}return V}getMeshesByTags(f,v){return this._getByTags(this.meshes,f,v)}getCamerasByTags(f,v){return this._getByTags(this.cameras,f,v)}getLightsByTags(f,v){return this._getByTags(this.lights,f,v)}getMaterialsByTags(f,v){return this._getByTags(this.materials,f,v).concat(this._getByTags(this.multiMaterials,f,v))}getTransformNodesByTags(f,v){return this._getByTags(this.transformNodes,f,v)}}var M=Z(11301);class A{constructor(f){this.byteOffset=0,this.buffer=f}async loadAsync(f){const v=await this.buffer.readAsync(this.byteOffset,f);this._dataView=new DataView(v.buffer,v.byteOffset,v.byteLength),this._dataByteOffset=0}readUint32(){const f=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,f}readUint8Array(f){const v=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,f);return this._dataByteOffset+=f,this.byteOffset+=f,v}readString(f){return(0,M.h)(this.readUint8Array(f))}skipBytes(f){this._dataByteOffset+=f,this.byteOffset+=f}}var s=Z(13057);const z="Z2xURg",Y={name:"yh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:f=>-1!==f.indexOf("asset")&&-1!==f.indexOf("version")||f.startsWith("data:base64,"+z)||f.startsWith("data:;base64,"+z)||f.startsWith("data:application/octet-stream;base64,"+z)||f.startsWith("data:model/gltf-binary;base64,"+z)};var y,N,i,I=Z(11290),T=Z(11294);function B(f,v,Z){try{return Promise.resolve(new Uint8Array(f,v,Z))}catch(V){return Promise.reject(V)}}!function(f){f[f.AUTO=0]="AUTO",f[f.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(y||(y={})),function(f){f[f.NONE=0]="NONE",f[f.FIRST=1]="FIRST",f[f.ALL=2]="ALL"}(N||(N={})),function(f){f[f.LOADING=0]="LOADING",f[f.READY=1]="READY",f[f.COMPLETE=2]="COMPLETE"}(i||(i={}));class P{constructor(){this.coordinateSystemMode=y.AUTO,this.animationStartMode=N.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=f=>Promise.resolve(f),this.extensionOptions={}}h(f){f&&(this.onParsed=f.onParsed,this.coordinateSystemMode=f.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=f.animationStartMode??this.animationStartMode,this.loadNodeAnimations=f.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=f.loadSkins??this.loadSkins,this.loadMorphTargets=f.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=f.compileMaterials??this.compileMaterials,this.useClipPlane=f.useClipPlane??this.useClipPlane,this.compileShadowGenerators=f.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=f.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=f.useRangeRequests??this.useRangeRequests,this.createInstances=f.createInstances??this.createInstances,this.alwaysComputeBoundingBox=f.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=f.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=f.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=f.skipMaterials??this.skipMaterials,this.useSRGBBuffers=f.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=f.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=f.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=f.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=f.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=f.customRootNode,this.onMeshLoaded=f.onMeshLoaded,this.onSkinLoaded=f.onSkinLoaded,this.onTextureLoaded=f.onTextureLoaded,this.onMaterialLoaded=f.onMaterialLoaded,this.onCameraLoaded=f.onCameraLoaded,this.extensionOptions=f.extensionOptions??this.extensionOptions)}}class g extends P{constructor(f){super(),this.onParsedObservable=new V.c,this.onMeshLoadedObservable=new V.c,this.onSkinLoadedObservable=new V.c,this.onTextureLoadedObservable=new V.c,this.onMaterialLoadedObservable=new V.c,this.onCameraLoadedObservable=new V.c,this.onCompleteObservable=new V.c,this.onErrorObservable=new V.c,this.Kh=new V.c,this.onExtensionLoadedObservable=new V.c,this.validate=!1,this.onValidatedObservable=new V.c,this._loader=null,this._state=null,this._requests=new Array,this.name=Y.name,this.extensions=Y.extensions,this.onLoaderStateChangedObservable=new V.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.h(f)}set onParsed(f){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),f&&(this._onParsedObserver=this.onParsedObservable.add(f))}set onMeshLoaded(f){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),f&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(f))}set onSkinLoaded(f){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),f&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((v=>f(v.node,v.skinnedNode))))}set onTextureLoaded(f){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),f&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(f))}set onMaterialLoaded(f){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),f&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(f))}set onCameraLoaded(f){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),f&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(f))}set onComplete(f){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(f)}set onError(f){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(f)}set onDispose(f){this._onDisposeObserver&&this.Kh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Kh.add(f)}set onExtensionLoaded(f){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(f)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(f){this._loggingEnabled!==f&&(this._loggingEnabled=f,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(f){this._capturePerformanceCounters!==f&&(this._capturePerformanceCounters=f,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(f){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(f)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const f of this._requests)f.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=f=>Promise.resolve(f),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Kh.notifyObservers(void 0),this.Kh.clear()}loadFile(f,v,Z,J,l,e,C,O){if(ArrayBuffer.isView(v))return this._loadBinary(f,v,Z,J,C,O),null;this._progressCallback=l;const u=v.name||h.Tools.GetFilename(v);if(e){if(this.useRangeRequests){this.validate&&H.e.Warn("glTF validation is not supported when range requests are enabled");const Z={abort:()=>{},onCompleteObservable:new V.c},h={readAsync:(Z,V)=>new Promise(((h,J)=>{this._loadFile(f,v,(f=>{h(new Uint8Array(f))}),!0,(f=>{J(f)}),(f=>{f.setRequestHeader("Range",`bytes=${Z}-${Z+V-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new A(h)).then((f=>{Z.onCompleteObservable.notifyObservers(Z),J(f)}),C?f=>C(void 0,f):void 0),Z}return this._loadFile(f,v,(v=>{this._validate(f,new Uint8Array(v,0,v.byteLength),Z,u),this._unpackBinaryAsync(new A({readAsync:(f,Z)=>B(v,f,Z),byteLength:v.byteLength})).then((f=>{J(f)}),C?f=>C(void 0,f):void 0)}),!0,C)}return this._loadFile(f,v,(v=>{try{this._validate(f,v,Z,u),J({json:this._parseJson(v)})}catch{C&&C()}}),!1,C)}_loadBinary(f,v,Z,V,h,J){this._validate(f,new Uint8Array(v.buffer,v.byteOffset,v.byteLength),Z,J),this._unpackBinaryAsync(new A({readAsync:(f,Z)=>function(f,v,Z){try{if(v<0||v>=f.byteLength)throw new RangeError("Offset is out of range.");if(v+Z>f.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(f.buffer,f.byteOffset+v,Z))}catch(V){return Promise.reject(V)}}(v,f,Z),byteLength:v.byteLength})).then((f=>{V(f)}),h?f=>h(void 0,f):void 0)}importMeshAsync(f,v,Z,V,h,J){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${J||""}`),this._loader=this._getLoader(Z),this._loader.importMeshAsync(f,v,null,Z,V,h,J))))}loadAsync(f,v,Z,V,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(v),this._loader.loadAsync(f,v,Z,V,h))))}loadAssetContainerAsync(f,v,Z,V,h){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(v);const J=new K(f),l=[];this.onMaterialLoadedObservable.add((f=>{l.push(f)}));const e=[];this.onTextureLoadedObservable.add((f=>{e.push(f)}));const C=[];this.onCameraLoadedObservable.add((f=>{C.push(f)}));const H=[];return this.onMeshLoadedObservable.add((f=>{f.morphTargetManager&&H.push(f.morphTargetManager)})),this._loader.importMeshAsync(null,f,J,v,Z,V,h).then((f=>(Array.prototype.push.apply(J.geometries,f.geometries),Array.prototype.push.apply(J.meshes,f.meshes),Array.prototype.push.apply(J.fW,f.fW),Array.prototype.push.apply(J.skeletons,f.skeletons),Array.prototype.push.apply(J.animationGroups,f.animationGroups),Array.prototype.push.apply(J.materials,l),Array.prototype.push.apply(J.textures,e),Array.prototype.push.apply(J.lights,f.lights),Array.prototype.push.apply(J.transformNodes,f.transformNodes),Array.prototype.push.apply(J.cameras,C),Array.prototype.push.apply(J.morphTargetManagers,H),J)))}))}canDirectLoad(f){return Y.canDirectLoad(f)}directLoad(f,v){if(v.startsWith("base64,"+z)||v.startsWith(";base64,"+z)||v.startsWith("application/octet-stream;base64,"+z)||v.startsWith("model/gltf-binary;base64,"+z)){const Z=(0,I.d)(v);return this._validate(f,new Uint8Array(Z,0,Z.byteLength)),this._unpackBinaryAsync(new A({readAsync:(f,v)=>B(Z,f,v),byteLength:Z.byteLength}))}return this._validate(f,v),Promise.resolve({json:this._parseJson(v)})}createPlugin(f){return new g(f[Y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((f,v)=>{this.onCompleteObservable.addOnce((()=>{f()})),this.onErrorObservable.addOnce((f=>{v(f)}))}))}_setState(f){this._state!==f&&(this._state=f,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(i[this._state]))}_loadFile(f,v,Z,V,h,J){const l=f._loadFile(v,Z,(f=>{this._onProgress(f,l)}),!0,V,h,J);return l.onCompleteObservable.add((()=>{l._lengthComputable=!0,l._total=l._loaded})),this._requests.push(l),l}_onProgress(f,v){if(!this._progressCallback)return;v._lengthComputable=f.lengthComputable,v._loaded=f.loaded,v._total=f.total;let Z=!0,V=0,h=0;for(const J of this._requests){if(void 0===J._lengthComputable||void 0===J._loaded||void 0===J._total)return;Z=Z&&J._lengthComputable,V+=J._loaded,h+=J._total}this._progressCallback({lengthComputable:Z,loaded:V,total:Z?h:0})}_validate(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.d.ValidateAsync(v,Z,V,(v=>this.preprocessUrlAsync(Z+v).then((v=>f._loadFileAsync(v,void 0,!0,!0).then((f=>new Uint8Array(f,0,f.byteLength))))))).then((f=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(f),this.onValidatedObservable.clear()}),(f=>{this._endPerformanceCounter("Validate JSON"),h.Tools.Warn(`Failed to validate: ${f.message}`),this.onValidatedObservable.clear()})))}_getLoader(f){const v=f.json.asset||{};this._log(`Asset version: ${v.version}`),v.minVersion&&this._log(`Asset minimum version: ${v.minVersion}`),v.generator&&this._log(`Asset generator: ${v.generator}`);const Z=g._parseVersion(v.version);if(!Z)throw new Error("Invalid version: "+v.version);if(void 0!==v.minVersion){const f=g._parseVersion(v.minVersion);if(!f)throw new Error("Invalid minimum version: "+v.minVersion);if(g._compareVersion(f,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+v.minVersion)}const V={1:g._CreateGLTF1Loader,2:g._CreateGLTF2Loader}[Z.major];if(!V)throw new Error("Unsupported version: "+v.version);return V(this)}_parseJson(f){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${f.length}`);const v=JSON.parse(f);return this._endPerformanceCounter("Parse JSON"),v}_unpackBinaryAsync(f){return this._startPerformanceCounter("Unpack Binary"),f.loadAsync(20).then((()=>{const v=f.readUint32();if(1179937895!==v)throw new T.h("Unexpected magic: "+v,T.g.GLTFLoaderUnexpectedMagicError);const Z=f.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Z}`);const V=f.readUint32();let h;switch(this.useRangeRequests||V===f.buffer.byteLength||H.e.Warn(`Length in header does not match actual data length: ${V} != ${f.buffer.byteLength}`),Z){case 1:h=this._unpackBinaryV1Async(f,V);break;case 2:h=this._unpackBinaryV2Async(f,V);break;default:throw new Error("Unsupported version: "+Z)}return this._endPerformanceCounter("Unpack Binary"),h}))}_unpackBinaryV1Async(f,v){const Z=f.readUint32(),V=f.readUint32();if(0!==V)throw new Error(`Unexpected content format: ${V}`);const h=v-f.byteOffset,J={json:this._parseJson(f.readString(Z)),bin:null};if(0!==h){const v=f.byteOffset;J.bin={readAsync:(Z,V)=>f.buffer.readAsync(v+Z,V),byteLength:h}}return Promise.resolve(J)}_unpackBinaryV2Async(f,v){const Z=1313821514,V=5130562,h=f.readUint32();if(f.readUint32()!==Z)throw new Error("First chunk format is not JSON");return f.byteOffset+h===v?f.loadAsync(h).then((()=>({json:this._parseJson(f.readString(h)),bin:null}))):f.loadAsync(h+8).then((()=>{const J={json:this._parseJson(f.readString(h)),bin:null},l=()=>{const h=f.readUint32();switch(f.readUint32()){case Z:throw new Error("Unexpected JSON chunk");case V:{const v=f.byteOffset;J.bin={readAsync:(Z,V)=>f.buffer.readAsync(v+Z,V),byteLength:h},f.skipBytes(h);break}default:f.skipBytes(h)}return f.byteOffset!==v?f.loadAsync(8).then(l):Promise.resolve(J)};return l()}))}static _parseVersion(f){if("1.0"===f||"1.0.1"===f)return{major:1,minor:0};const v=(f+"").match(/^(\d+)\.(\d+)/);return v?{major:parseInt(v[1]),minor:parseInt(v[2])}:null}static _compareVersion(f,v){return f.major>v.major?1:f.major<v.major?-1:f.minor>v.minor?1:f.minor<v.minor?-1:0}_logOpen(f){this._log(f),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(f){const v=g._logSpaces.substring(0,2*this._logIndentLevel);H.e.Log(`${v}${f}`)}_logDisabled(f){}_startPerformanceCounterEnabled(f){h.Tools.StartPerformanceCounter(f)}_startPerformanceCounterDisabled(f){}_endPerformanceCounterEnabled(f){h.Tools.EndPerformanceCounter(f)}_endPerformanceCounterDisabled(f){}}g.IncrementalLoading=!0,g.HomogeneousCoordinates=!1,g._logSpaces="                                ",(0,J.c)(new g)},13057:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>l});var V=Z(11230);function h(f,v,Z,V){const h={externalResourceFunction:V};return Z&&(h.uri="file:"===v?Z:v+Z),ArrayBuffer.isView(f)?GLTFValidator.validateBytes(f,h):GLTFValidator.validateString(f,h)}function J(){const f=[];onmessage=v=>{const Z=v.data;switch(Z.id){case"init":importScripts(Z.url);break;case"validate":h(Z.data,Z.rootUrl,Z.fileName,(v=>new Promise(((Z,V)=>{const h=f.length;f.push({resolve:Z,reject:V}),postMessage({id:"getExternalResource",index:h,uri:v})})))).then((f=>{postMessage({id:"validate.resolve",value:f})}),(f=>{postMessage({id:"validate.reject",reason:f})}));break;case"getExternalResource.resolve":f[Z.index].resolve(Z.value);break;case"getExternalResource.reject":f[Z.index].reject(Z.reason)}}}class l{static ValidateAsync(f,v,Z,l){return"function"===typeof Worker?new Promise(((e,C)=>{const H=`${h}(${J})()`,O=URL.createObjectURL(new Blob([H],{type:"application/javascript"})),u=new Worker(O),W=f=>{u.removeEventListener("error",W),u.removeEventListener("message",a),C(f)},a=f=>{const v=f.data;switch(v.id){case"getExternalResource":l(v.uri).then((f=>{u.postMessage({id:"getExternalResource.resolve",index:v.index,value:f},[f.buffer])}),(f=>{u.postMessage({id:"getExternalResource.reject",index:v.index,reason:f})}));break;case"validate.resolve":u.removeEventListener("error",W),u.removeEventListener("message",a),e(v.value),u.terminate();break;case"validate.reject":u.removeEventListener("error",W),u.removeEventListener("message",a),C(v.reason),u.terminate()}};if(u.addEventListener("error",W),u.addEventListener("message",a),u.postMessage({id:"init",url:V.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(f)){const V=f.slice();u.postMessage({id:"validate",data:V,rootUrl:v,fileName:Z},[V.buffer])}else u.postMessage({id:"validate",data:f,rootUrl:v,fileName:Z})})):(this._LoadScriptPromise||(this._LoadScriptPromise=V.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>h(f,v,Z,l))))}}l.Configuration={url:`${V.Tools._DefaultCdnUrl}/gltf_validator.js`}},13574:(f,v,Z)=>{"use strict";Z.d(v,{d:()=>Y});var V=Z(11405),h=Z(11410),J=Z(11462),l=Z(11421),e=Z(11786),C=Z(11722),H=Z(11494),O=Z(11646),u=Z(11372),W=Z(11333);Z(12815),Z(12731),Z(12743),Z(12735),Z(12748),Z(12753),Z(12762);const a="imageProcessingCompatibility",b="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";W.c.IncludesShadersStore[a]||(W.c.IncludesShadersStore[a]=b);const X="skyPixelShader",F="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";W.c.ShadersStore[X]||(W.c.ShadersStore[X]=F);Z(12825),Z(12765),Z(12769),Z(12775),Z(12772);const U="skyVertexShader",K="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";W.c.ShadersStore[U]||(W.c.ShadersStore[U]=K);var M=Z(11713),A=Z(11768),s=Z(11760);class z extends e.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Y extends C.b{constructor(f,v){super(f,v),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new l.Xv(0,100,0),this.useSunPosition=!1,this.cameraOffset=l.Xv.Zero(),this.up=l.Xv.Up(),this.dithering=!1,this._cameraPosition=l.Xv.Zero(),this._skyOrientation=new l.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(f,v){const Z=v._drawWrapper;if(this.isFrozen&&Z.effect&&Z._wasPreviouslyReady)return!0;v.materialDefines||(v.materialDefines=new z);const V=v.materialDefines,h=this.Yf();if(this._isReadyForSubMesh(v))return!0;if((0,s.W)(f,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,V),(0,s.O)(f,V,!0,!1),V.IMAGEPROCESSINGPOSTPROCESS!==h.imageProcessingConfiguration.applyByPostProcess&&V.markAsMiscDirty(),V.DITHER!==this.dithering&&V.markAsMiscDirty(),V.isDirty){V.markAsProcessed(),h.resetCachedMaterial();const f=new M.c;V.FOG&&f.addFallback(1,"FOG"),V.IMAGEPROCESSINGPOSTPROCESS=h.imageProcessingConfiguration.applyByPostProcess,V.DITHER=this.dithering;const Z=[H.g.PositionKind];V.VERTEXCOLOR&&Z.push(H.g.ColorKind);const J="sky",l=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,A.b)(l);const e=V.toString();v.setEffect(h.getEngine().createEffect(J,Z,l,[],e,f,this.onCompiled,this.onError),V,this._materialContext)}return!(!v.effect||!v.effect.isReady())&&(V._renderId=h.getRenderId(),Z._wasPreviouslyReady=!0,!0)}bindForSubMesh(f,v,Z){const V=this.Yf(),h=Z.materialDefines;if(!h)return;const J=Z.effect;if(!J)return;this._activeEffect=J,this.bindOnlyWorldMatrix(f),this._activeEffect.setMatrix("viewProjection",V.getTransformMatrix()),this._mustRebind(V,J,Z)&&((0,A.c)(J,this,V),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,s.h)(h,J,V)),V.fogEnabled&&v.applyFog&&V.fogMode!==O.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",V.getViewMatrix()),(0,s.d)(V,v,this._activeEffect);const e=V.activeCamera;if(e){const f=e.getWorldMatrix();this._cameraPosition.x=f.m[12],this._cameraPosition.y=f.m[13],this._cameraPosition.z=f.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const f=Math.PI*(this.inclination-.5),v=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(v)*Math.cos(f),this.sunPosition.y=this.distance*Math.sin(-f),this.sunPosition.z=this.distance*Math.sin(v)*Math.cos(f),l.Quaternion.FromUnitVectorsToRef(l.Xv.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(v,this._activeEffect,Z)}getAnimatables(){return[]}dispose(f){super.dispose(f)}clone(f){return J.b.Clone((()=>new Y(f,this.Yf())),this)}serialize(){const f=super.serialize();return f.customType="BABYLON.SkyMaterial",f}getClassName(){return"SkyMaterial"}static Parse(f,v,Z){return J.b.Parse((()=>new Y(f.name,v)),f,v,Z)}}(0,V.d)([(0,h.F)()],Y.prototype,"luminance",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"turbidity",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"rayleigh",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"mieCoefficient",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"mieDirectionalG",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"distance",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"inclination",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"azimuth",void 0),(0,V.d)([(0,h.E)()],Y.prototype,"sunPosition",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"useSunPosition",void 0),(0,V.d)([(0,h.E)()],Y.prototype,"cameraOffset",void 0),(0,V.d)([(0,h.E)()],Y.prototype,"up",void 0),(0,V.d)([(0,h.F)()],Y.prototype,"dithering",void 0),(0,u.h)("BABYLON.SkyMaterial",Y)},12091:(f,v,Z)=>{"use strict";function V(f,v){v.headers=f.headers||{},v.statusMessage=f.statusText,v.statusCode=f.status,v.data=f.response}function h(f,v,Z){return new Promise((function(h,J){Z=Z||{};var l,e,C,H=new XMLHttpRequest,O=Z.body,u=Z.headers||{};for(l in Z.timeout&&(H.timeout=Z.timeout),H.ontimeout=H.onerror=function(f){f.timeout="timeout"==f.type,J(f)},H.open(f,v.href||v),H.onload=function(){for(C=H.getAllResponseHeaders().trim().split(/[\r\n]+/),V(H,H);e=C.shift();)e=e.split(": "),H.headers[e.shift().toLowerCase()]=e.join(": ");if((e=H.headers["content-type"])&&~e.indexOf("application/json"))try{H.data=JSON.parse(H.data,Z.reviver)}catch(f){return V(H,f),J(f)}(H.status>=400?J:h)(H)},typeof FormData<"u"&&O instanceof FormData||O&&"object"==typeof O&&(u["content-type"]="application/json",O=JSON.stringify(O)),H.withCredentials=!!Z.withCredentials,u)H.setRequestHeader(l,u[l]);H.send(O)}))}Z.r(v),Z.d(v,{del:()=>C,get:()=>J,patch:()=>e,post:()=>l,put:()=>H,send:()=>h});var J=h.bind(h,"GET"),l=h.bind(h,"POST"),e=h.bind(h,"PATCH"),C=h.bind(h,"DELETE"),H=h.bind(h,"PUT")},13696:(f,v,Z)=>{"use strict";Z.d(v,{c:()=>u});const V=.5*(Math.sqrt(3)-1),h=(3-Math.sqrt(3))/6,J=1/3,l=1/6,e=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,H=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),O=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const u=class{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const v="function"==typeof f?f:function(f){let v=0,Z=0,V=0,h=1;const J=function(){let f=4022871197;return function(v){v=v.toString();for(let Z=0;Z<v.length;Z++){f+=v.charCodeAt(Z);let V=.02519603282416938*f;f=V>>>0,V-=f,V*=f,f=V>>>0,V-=f,f+=4294967296*V}return 2.3283064365386963e-10*(f>>>0)}}();v=J(" "),Z=J(" "),V=J(" "),v-=J(f),v<0&&(v+=1);Z-=J(f),Z<0&&(Z+=1);V-=J(f),V<0&&(V+=1);return function(){const f=2091639*v+2.3283064365386963e-10*h;return v=Z,Z=V,V=f-(h=0|f)}}(f);this.p=function(f){const v=new Uint8Array(256);for(let Z=0;Z<256;Z++)v[Z]=Z;for(let Z=0;Z<255;Z++){const V=Z+~~(f()*(256-Z)),h=v[Z];v[Z]=v[V],v[V]=h}return v}(v),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Z=0;Z<512;Z++)this.perm[Z]=this.p[255&Z],this.permMod12[Z]=this.perm[Z]%12}noise2D(f,v){const Z=this.permMod12,J=this.perm;let l=0,e=0,C=0;const O=(f+v)*V,u=Math.floor(f+O),W=Math.floor(v+O),a=(u+W)*h,b=f-(u-a),X=v-(W-a);let F,U;b>X?(F=1,U=0):(F=0,U=1);const K=b-F+h,M=X-U+h,A=b-1+2*h,s=X-1+2*h,z=255&u,Y=255&W;let y=.5-b*b-X*X;if(y>=0){const f=3*Z[z+J[Y]];y*=y,l=y*y*(H[f]*b+H[f+1]*X)}let N=.5-K*K-M*M;if(N>=0){const f=3*Z[z+F+J[Y+U]];N*=N,e=N*N*(H[f]*K+H[f+1]*M)}let i=.5-A*A-s*s;if(i>=0){const f=3*Z[z+1+J[Y+1]];i*=i,C=i*i*(H[f]*A+H[f+1]*s)}return 70*(l+e+C)}noise3D(f,v,Z){const V=this.permMod12,h=this.perm;let e,C,O,u;const W=(f+v+Z)*J,a=Math.floor(f+W),b=Math.floor(v+W),X=Math.floor(Z+W),F=(a+b+X)*l,U=f-(a-F),K=v-(b-F),M=Z-(X-F);let A,s,z,Y,y,N;U>=K?K>=M?(A=1,s=0,z=0,Y=1,y=1,N=0):U>=M?(A=1,s=0,z=0,Y=1,y=0,N=1):(A=0,s=0,z=1,Y=1,y=0,N=1):K<M?(A=0,s=0,z=1,Y=0,y=1,N=1):U<M?(A=0,s=1,z=0,Y=0,y=1,N=1):(A=0,s=1,z=0,Y=1,y=1,N=0);const i=U-A+l,I=K-s+l,T=M-z+l,B=U-Y+2*l,P=K-y+2*l,g=M-N+2*l,w=U-1+.5,t=K-1+.5,L=M-1+.5,E=255&a,j=255&b,q=255&X;let c=.6-U*U-K*K-M*M;if(c<0)e=0;else{const f=3*V[E+h[j+h[q]]];c*=c,e=c*c*(H[f]*U+H[f+1]*K+H[f+2]*M)}let m=.6-i*i-I*I-T*T;if(m<0)C=0;else{const f=3*V[E+A+h[j+s+h[q+z]]];m*=m,C=m*m*(H[f]*i+H[f+1]*I+H[f+2]*T)}let p=.6-B*B-P*P-g*g;if(p<0)O=0;else{const f=3*V[E+Y+h[j+y+h[q+N]]];p*=p,O=p*p*(H[f]*B+H[f+1]*P+H[f+2]*g)}let k=.6-w*w-t*t-L*L;if(k<0)u=0;else{const f=3*V[E+1+h[j+1+h[q+1]]];k*=k,u=k*k*(H[f]*w+H[f+1]*t+H[f+2]*L)}return 32*(e+C+O+u)}noise4D(f,v,Z,V){const h=this.perm;let J,l,H,u,W;const a=(f+v+Z+V)*e,b=Math.floor(f+a),X=Math.floor(v+a),F=Math.floor(Z+a),U=Math.floor(V+a),K=(b+X+F+U)*C,M=f-(b-K),A=v-(X-K),s=Z-(F-K),z=V-(U-K);let Y=0,y=0,N=0,i=0;M>A?Y++:y++,M>s?Y++:N++,M>z?Y++:i++,A>s?y++:N++,A>z?y++:i++,s>z?N++:i++;const I=Y>=3?1:0,T=y>=3?1:0,B=N>=3?1:0,P=i>=3?1:0,g=Y>=2?1:0,w=y>=2?1:0,t=N>=2?1:0,L=i>=2?1:0,E=Y>=1?1:0,j=y>=1?1:0,q=N>=1?1:0,c=i>=1?1:0,m=M-I+C,p=A-T+C,k=s-B+C,r=z-P+C,o=M-g+2*C,G=A-w+2*C,Q=s-t+2*C,d=z-L+2*C,x=M-E+3*C,R=A-j+3*C,n=s-q+3*C,S=z-c+3*C,D=M-1+4*C,ff=A-1+4*C,vf=s-1+4*C,Zf=z-1+4*C,Vf=255&b,hf=255&X,Jf=255&F,lf=255&U;let ef=.6-M*M-A*A-s*s-z*z;if(ef<0)J=0;else{const f=h[Vf+h[hf+h[Jf+h[lf]]]]%32*4;ef*=ef,J=ef*ef*(O[f]*M+O[f+1]*A+O[f+2]*s+O[f+3]*z)}let Cf=.6-m*m-p*p-k*k-r*r;if(Cf<0)l=0;else{const f=h[Vf+I+h[hf+T+h[Jf+B+h[lf+P]]]]%32*4;Cf*=Cf,l=Cf*Cf*(O[f]*m+O[f+1]*p+O[f+2]*k+O[f+3]*r)}let Hf=.6-o*o-G*G-Q*Q-d*d;if(Hf<0)H=0;else{const f=h[Vf+g+h[hf+w+h[Jf+t+h[lf+L]]]]%32*4;Hf*=Hf,H=Hf*Hf*(O[f]*o+O[f+1]*G+O[f+2]*Q+O[f+3]*d)}let Of=.6-x*x-R*R-n*n-S*S;if(Of<0)u=0;else{const f=h[Vf+E+h[hf+j+h[Jf+q+h[lf+c]]]]%32*4;Of*=Of,u=Of*Of*(O[f]*x+O[f+1]*R+O[f+2]*n+O[f+3]*S)}let uf=.6-D*D-ff*ff-vf*vf-Zf*Zf;if(uf<0)W=0;else{const f=h[Vf+1+h[hf+1+h[Jf+1+h[lf+1]]]]%32*4;uf*=uf,W=uf*uf*(O[f]*D+O[f+1]*ff+O[f+2]*vf+O[f+3]*Zf)}return 27*(J+l+H+u+W)}}}}]);