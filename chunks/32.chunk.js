/*! For license information please see hektwi.32.a28a63b3.chunk.js.LICENSE.txt */
(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[32],{13816:(b,n,i)=>{"use strict";var e=i(13823),V=i(13825),Q=i(13834);i.g.__TYPEDARRAY_POOL||(i.g.__TYPEDARRAY_POOL={UINT8:V([32,0]),UINT16:V([32,0]),UINT32:V([32,0]),INT8:V([32,0]),INT16:V([32,0]),INT32:V([32,0]),FLOAT:V([32,0]),DOUBLE:V([32,0]),DATA:V([32,0]),UINT8C:V([32,0]),BUFFER:V([32,0])});var U="undefined"!==typeof Uint8ClampedArray,Y=i.g.__TYPEDARRAY_POOL;Y.UINT8C||(Y.UINT8C=V([32,0])),Y.BUFFER||(Y.BUFFER=V([32,0]));var L=Y.DATA,B=Y.BUFFER;function mb(b){if(b){var n=b.length||b.byteLength,i=e.log2(n);L[i].push(b)}}function N(b){b=e.nextPow2(b);var n=e.log2(b),i=L[n];return i.length>0?i.pop():new ArrayBuffer(b)}function Z(b){return new Uint8Array(N(b),0,b)}function T(b){return new Uint16Array(N(2*b),0,b)}function z(b){return new Uint32Array(N(4*b),0,b)}function K(b){return new Int8Array(N(b),0,b)}function I(b){return new Int16Array(N(2*b),0,b)}function O(b){return new Int32Array(N(4*b),0,b)}function u(b){return new Float32Array(N(4*b),0,b)}function d(b){return new Float64Array(N(8*b),0,b)}function G(b){return U?new Uint8ClampedArray(N(b),0,b):Z(b)}function o(b){return new DataView(N(b),0,b)}n.free=function(b){if(Q(b))B[e.log2(b.length)].push(b);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(b)&&(b=b.buffer),!b)return;var n=b.length||b.byteLength,i=0|e.log2(n);L[i].push(b)}},n.freeUint8=n.freeUint16=n.freeUint32=n.freeInt8=n.freeInt16=n.freeInt32=n.freeFloat32=n.freeFloat=n.freeFloat64=n.freeDouble=n.freeUint8Clamped=n.freeDataView=function(b){mb(b.buffer)},n.freeArrayBuffer=mb,n.freeBuffer=function(b){B[e.log2(b.length)].push(b)},n.malloc=function(b,n){if(void 0===n||"arraybuffer"===n)return N(b);switch(n){case"uint8":return Z(b);case"uint16":return T(b);case"uint32":return z(b);case"int8":return K(b);case"int16":return I(b);case"int32":return O(b);case"float":case"float32":return u(b);case"double":case"float64":return d(b);case"uint8_clamped":return G(b);case"buffer":throw"Buffer not supported";case"data":case"dataview":return o(b);default:return null}return null},n.mallocArrayBuffer=N,n.mallocUint8=Z,n.mallocUint16=T,n.mallocUint32=z,n.mallocInt8=K,n.mallocInt16=I,n.mallocInt32=O,n.mallocFloat32=n.mallocFloat=u,n.mallocFloat64=n.mallocDouble=d,n.mallocUint8Clamped=G,n.mallocDataView=o,n.clearCache=function(){for(var b=0;b<32;++b)Y.UINT8[b].length=0,Y.UINT16[b].length=0,Y.UINT32[b].length=0,Y.INT8[b].length=0,Y.INT16[b].length=0,Y.INT32[b].length=0,Y.FLOAT[b].length=0,Y.DOUBLE[b].length=0,Y.UINT8C[b].length=0,L[b].length=0,B[b].length=0}},13920:(b,n,i)=>{b.exports=V;var e=i(12601);function V(b,n){if(!(this instanceof V))return new V(b,n);var i=e.create();e.add(i,b,n),this.base=e.min(e.create(),b,i),this.cB=e.clone(n),this.max=e.max(e.create(),b,i),this.mag=e.length(this.cB)}var Q=V.prototype;Q.width=function(){return this.cB[0]},Q.height=function(){return this.cB[1]},Q.depth=function(){return this.cB[2]},Q.x0=function(){return this.base[0]},Q.y0=function(){return this.base[1]},Q.z0=function(){return this.base[2]},Q.x1=function(){return this.max[0]},Q.y1=function(){return this.max[1]},Q.z1=function(){return this.max[2]},Q.translate=function(b){return e.add(this.max,this.max,b),e.add(this.base,this.base,b),this},Q.setPosition=function(b){return e.add(this.max,b,this.cB),e.k(this.base,b),this},Q.expand=function(b){var n=e.create(),i=e.create();return e.max(n,b.max,this.max),e.min(i,b.base,this.base),e.un(n,n,i),new V(i,n)},Q.intersects=function(b){return!(b.base[0]>this.max[0])&&(!(b.base[1]>this.max[1])&&(!(b.base[2]>this.max[2])&&(!(b.max[0]<this.base[0])&&(!(b.max[1]<this.base[1])&&!(b.max[2]<this.base[2])))))},Q.touches=function(b){var n=this.union(b);return null!==n&&(0==n.width()||0==n.height()||0==n.depth())},Q.union=function(b){if(!this.intersects(b))return null;var n=Math.max(b.base[0],this.base[0]),i=Math.max(b.base[1],this.base[1]),e=Math.max(b.base[2],this.base[2]);return new V([n,i,e],[Math.min(b.max[0],this.max[0])-n,Math.min(b.max[1],this.max[1])-i,Math.min(b.max[2],this.max[2])-e])}},13823:(b,n)=>{"use strict";function i(b){var n=32;return(b&=-b)&&n--,65535&b&&(n-=16),16711935&b&&(n-=8),252645135&b&&(n-=4),858993459&b&&(n-=2),1431655765&b&&(n-=1),n}n.INT_BITS=32,n.INT_MAX=2147483647,n.INT_MIN=-1<<31,n.sign=function(b){return(b>0)-(b<0)},n.abs=function(b){var n=b>>31;return(b^n)-n},n.min=function(b,n){return n^(b^n)&-(b<n)},n.max=function(b,n){return b^(b^n)&-(b<n)},n.isPow2=function(b){return!(b&b-1)&&!!b},n.log2=function(b){var n,i;return n=(b>65535)<<4,n|=i=((b>>>=n)>255)<<3,n|=i=((b>>>=i)>15)<<2,(n|=i=((b>>>=i)>3)<<1)|(b>>>=i)>>1},n.log10=function(b){return b>=1e9?9:b>=1e8?8:b>=1e7?7:b>=1e6?6:b>=1e5?5:b>=1e4?4:b>=1e3?3:b>=100?2:b>=10?1:0},n.popCount=function(b){return 16843009*((b=(858993459&(b-=b>>>1&1431655765))+(b>>>2&858993459))+(b>>>4)&252645135)>>>24},n.countTrailingZeros=i,n.nextPow2=function(b){return b+=0===b,--b,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)+1},n.prevPow2=function(b){return b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)-(b>>>1)},n.parity=function(b){return b^=b>>>16,b^=b>>>8,b^=b>>>4,27030>>>(b&=15)&1};var e=new Array(256);!function(b){for(var n=0;n<256;++n){var i=n,e=n,V=7;for(i>>>=1;i;i>>>=1)e<<=1,e|=1&i,--V;b[n]=e<<V&255}}(e),n.reverse=function(b){return e[255&b]<<24|e[b>>>8&255]<<16|e[b>>>16&255]<<8|e[b>>>24&255]},n.interleave2=function(b,n){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n&=65535)|n<<8))|n<<4))|n<<2))|n<<1))<<1},n.deinterleave2=function(b,n){return(b=65535&((b=16711935&((b=252645135&((b=858993459&((b=b>>>n&1431655765)|b>>>1))|b>>>2))|b>>>4))|b>>>16))<<16>>16},n.interleave3=function(b,n,i){return b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2),(b|=(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},n.deinterleave3=function(b,n){return(b=1023&((b=4278190335&((b=251719695&((b=3272356035&((b=b>>>n&1227133513)|b>>>2))|b>>>4))|b>>>8))|b>>>16))<<22>>22},n.nextCombination=function(b){var n=b|b-1;return n+1|(~n&-~n)-1>>>i(b)+1}},13810:(b,n,i)=>{"use strict";b.exports=function(b,n,i){switch(arguments.length){case 1:return e=[],B(V=b,V,mb,!0),e;case 2:return"function"===typeof n?B(b,b,n,!0):function(b,n){return e=[],B(b,n,mb,!1),e}(b,n);case 3:return B(b,n,i,!1);default:throw new Error("box-intersect: Invalid arguments")}var V};var e,V=i(13816),Q=i(13838),U=i(13848);function Y(b,n){for(var i=0;i<b;++i)if(!(n[i]<=n[i+b]))return!0;return!1}function L(b,n,i,e){for(var V=0,Q=0,U=0,L=b.length;U<L;++U){var B=b[U];if(!Y(n,B)){for(var mb=0;mb<2*n;++mb)i[V++]=B[mb];e[Q++]=U}}return Q}function B(b,n,i,e){var Y=b.length,B=n.length;if(!(Y<=0||B<=0)){var mb=b[0].length>>>1;if(!(mb<=0)){var N,Z=V.mallocDouble(2*mb*Y),T=V.mallocInt32(Y);if((Y=L(b,mb,Z,T))>0){if(1===mb&&e)Q.init(Y),N=Q.sweepComplete(mb,i,0,Y,Z,T,0,Y,Z,T);else{var z=V.mallocDouble(2*mb*B),K=V.mallocInt32(B);(B=L(n,mb,z,K))>0&&(Q.init(Y+B),N=1===mb?Q.sweepBipartite(mb,i,0,Y,Z,T,0,B,z,K):U(mb,i,e,Y,Z,T,B,z,K),V.free(z),V.free(K))}V.free(Z),V.free(T)}return N}}}function mb(b,n){e.push([b,n])}},13856:(b,n)=>{"use strict";var i="d",e="ax",V="fp",Q="es",U="rs",Y="re",L="rb",B="bs",mb="be",N="bb",Z=[i,e,"vv",U,Y,L,"ri",B,mb,N,"bi"];function T(b){var n="bruteForce"+(b?"Full":"Partial"),e=[],U=Z.slice();b||U.splice(3,0,V);var Y=["function "+n+"("+U.join()+"){"];function L(n,V){var U=function(b,n,e){var V="bruteForce"+(b?"Red":"Blue")+(n?"Flip":"")+(e?"Full":""),U=["function ",V,"(",Z.join(),"){","var ",Q,"=2*",i,";"],Y="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",L="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(e?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return b?U.push(Y,"Q",":",L):U.push(L,"Q",":",Y),e?U.push("if(y1<x0||x1<y0)continue;"):n?U.push("if(y0<=x0||x1<y0)continue;"):U.push("if(y0<x0||x1<y0)continue;"),U.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),n?U.push("yi,xi"):U.push("xi,yi"),U.push(");if(rv!==void 0)return rv;}}}"),{name:V,code:U.join("")}}(n,V,b);e.push(U.code),Y.push("return "+U.name+"("+Z.join()+");")}Y.push("if(re-rs>be-bs){"),b?(L(!0,!1),Y.push("}else{"),L(!1,!1)):(Y.push("if(fp){"),L(!0,!0),Y.push("}else{"),L(!0,!1),Y.push("}}else{if(fp){"),L(!1,!0),Y.push("}else{"),L(!1,!1),Y.push("}")),Y.push("}}return "+n);var B=e.join("")+Y.join("");return new Function(B)()}n.partial=T(!1),n.full=T(!0)},13848:(b,n,i)=>{"use strict";b.exports=function(b,n,i,Q,mb,y,s,A,E){!function(b,n){var i=8*V.log2(n+1)*(b+1)|0,Q=V.nextPow2(G*i);M.length<Q&&(e.free(M),M=e.mallocInt32(Q));var U=V.nextPow2(o*i);j.length<U&&(e.free(j),j=e.mallocDouble(U))}(b,Q+s);var C,t=0,w=2*b;a(t++,0,0,Q,0,s,i?16:0,-1/0,1/0),i||a(t++,0,0,s,0,Q,1,-1/0,1/0);for(;t>0;){var h=(t-=1)*G,W=M[h],J=M[h+1],R=M[h+2],k=M[h+3],r=M[h+4],X=M[h+5],g=t*o,P=j[g],c=j[g+1],q=1&X,S=!!(16&X),H=mb,l=y,v=A,p=E;if(q&&(H=A,l=E,v=mb,p=y),!(2&X&&J>=(R=I(b,W,J,R,H,l,c)))&&!(4&X&&(J=O(b,W,J,R,H,l,P))>=R)){var f=R-J,F=r-k;if(S){if(b*f*(f+F)<T){if(void 0!==(C=L.scanComplete(b,W,n,J,R,H,l,k,r,v,p)))return C;continue}}else{if(b*Math.min(f,F)<N){if(void 0!==(C=U(b,W,n,q,J,R,H,l,k,r,v,p)))return C;continue}if(b*f*F<Z){if(void 0!==(C=L.scanBipartite(b,W,n,q,J,R,H,l,k,r,v,p)))return C;continue}}var bb=z(b,W,J,R,H,l,P,c);if(J<bb)if(b*(bb-J)<N){if(void 0!==(C=Y(b,W+1,n,J,bb,H,l,k,r,v,p)))return C}else if(W===b-2){if(void 0!==(C=q?L.sweepBipartite(b,n,k,r,v,p,J,bb,H,l):L.sweepBipartite(b,n,J,bb,H,l,k,r,v,p)))return C}else a(t++,W+1,J,bb,k,r,q,-1/0,1/0),a(t++,W+1,k,r,J,bb,1^q,-1/0,1/0);if(bb<R){var nb=B(b,W,k,r,v,p),ib=v[w*nb+W],eb=K(b,W,nb,r,v,p,ib);if(eb<r&&a(t++,W,bb,R,eb,r,(4|q)+(S?16:0),ib,c),k<nb&&a(t++,W,bb,R,k,nb,(2|q)+(S?16:0),P,ib),nb+1===eb){if(void 0!==(C=S?x(b,W,n,bb,R,H,l,nb,v,p[nb]):D(b,W,n,q,bb,R,H,l,nb,v,p[nb])))return C}else if(nb<eb){var Vb;if(S){if(bb<(Vb=u(b,W,bb,R,H,l,ib))){var Qb=K(b,W,bb,Vb,H,l,ib);if(W===b-2){if(bb<Qb&&void 0!==(C=L.sweepComplete(b,n,bb,Qb,H,l,nb,eb,v,p)))return C;if(Qb<Vb&&void 0!==(C=L.sweepBipartite(b,n,Qb,Vb,H,l,nb,eb,v,p)))return C}else bb<Qb&&a(t++,W+1,bb,Qb,nb,eb,16,-1/0,1/0),Qb<Vb&&(a(t++,W+1,Qb,Vb,nb,eb,0,-1/0,1/0),a(t++,W+1,nb,eb,Qb,Vb,1,-1/0,1/0))}}else bb<(Vb=q?d(b,W,bb,R,H,l,ib):u(b,W,bb,R,H,l,ib))&&(W===b-2?C=q?L.sweepBipartite(b,n,nb,eb,v,p,bb,Vb,H,l):L.sweepBipartite(b,n,bb,Vb,H,l,nb,eb,v,p):(a(t++,W+1,bb,Vb,nb,eb,q,-1/0,1/0),a(t++,W+1,nb,eb,bb,Vb,1^q,-1/0,1/0)))}}}}};var e=i(13816),V=i(13823),Q=i(13856),U=Q.partial,Y=Q.full,L=i(13838),B=i(13863),mb=i(13865),N=128,Z=1<<22,T=1<<22,z=mb("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),K=mb("lo===p0",["p0"]),I=mb("lo<p0",["p0"]),O=mb("hi<=p0",["p0"]),u=mb("lo<=p0&&p0<=hi",["p0"]),d=mb("lo<p0&&p0<=hi",["p0"]),G=6,o=2,M=e.mallocInt32(1024),j=e.mallocDouble(1024);function a(b,n,i,e,V,Q,U,Y,L){var B=G*b;M[B]=n,M[B+1]=i,M[B+2]=e,M[B+3]=V,M[B+4]=Q,M[B+5]=U;var mb=o*b;j[mb]=Y,j[mb+1]=L}function D(b,n,i,e,V,Q,U,Y,L,B,mb){var N=2*b,Z=L*N,T=B[Z+n];b:for(var z=V,K=V*N;z<Q;++z,K+=N){var I=U[K+n],O=U[K+n+b];if(!(T<I||O<T)&&(!e||T!==I)){for(var u,d=Y[z],G=n+1;G<b;++G){I=U[K+G],O=U[K+G+b];var o=B[Z+G],M=B[Z+G+b];if(O<o||M<I)continue b}if(void 0!==(u=e?i(mb,d):i(d,mb)))return u}}}function x(b,n,i,e,V,Q,U,Y,L,B){var mb=2*b,N=Y*mb,Z=L[N+n];b:for(var T=e,z=e*mb;T<V;++T,z+=mb){var K=U[T];if(K!==B){var I=Q[z+n],O=Q[z+n+b];if(!(Z<I||O<Z)){for(var u=n+1;u<b;++u){I=Q[z+u],O=Q[z+u+b];var d=L[N+u],G=L[N+u+b];if(O<d||G<I)continue b}var o=i(K,B);if(void 0!==o)return o}}}}},13863:(b,n,i)=>{"use strict";b.exports=function(b,n,i,U,Y,L){if(U<=i+1)return i;var B=i,mb=U,N=U+i>>>1,Z=2*b,T=N,z=Y[Z*N+n];for(;B<mb;){if(mb-B<V){Q(b,n,B,mb,Y,L),z=Y[Z*N+n];break}var K=mb-B,I=Math.random()*K+B|0,O=Y[Z*I+n],u=Math.random()*K+B|0,d=Y[Z*u+n],G=Math.random()*K+B|0,o=Y[Z*G+n];O<=d?o>=d?(T=u,z=d):O>=o?(T=I,z=O):(T=G,z=o):d>=o?(T=u,z=d):o>=O?(T=I,z=O):(T=G,z=o);for(var M=Z*(mb-1),j=Z*T,a=0;a<Z;++a,++M,++j){var D=Y[M];Y[M]=Y[j],Y[j]=D}var x=L[mb-1];L[mb-1]=L[T],L[T]=x;for(M=Z*(mb-1),j=Z*(T=e(b,n,B,mb-1,Y,L,z)),a=0;a<Z;++a,++M,++j){D=Y[M];Y[M]=Y[j],Y[j]=D}x=L[mb-1];if(L[mb-1]=L[T],L[T]=x,N<T){for(mb=T-1;B<mb&&Y[Z*(mb-1)+n]===z;)mb-=1;mb+=1}else{if(!(T<N))break;for(B=T+1;B<mb&&Y[Z*B+n]===z;)B+=1}}return e(b,n,i,N,Y,L,Y[Z*N+n])};var e=i(13865)("lo<p0",["p0"]),V=8;function Q(b,n,i,e,V,Q){for(var U=2*b,Y=U*(i+1)+n,L=i+1;L<e;++L,Y+=U)for(var B=V[Y],mb=L,N=U*(L-1);mb>i&&V[N+n]>B;--mb,N-=U){for(var Z=N,T=N+U,z=0;z<U;++z,++Z,++T){var K=V[Z];V[Z]=V[T],V[T]=K}var I=Q[mb];Q[mb]=Q[mb-1],Q[mb-1]=I}}},13865:b=>{"use strict";b.exports=function(b,i){var e="abcdef".split("").concat(i),V=[];b.indexOf("lo")>=0&&V.push("lo=e[k+n]");b.indexOf("hi")>=0&&V.push("hi=e[k+o]");return e.push(n.replace("_",V.join()).replace("$",b)),Function.apply(void 0,e)};var n="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13844:b=>{"use strict";b.exports=function(b,e){e<=4*n?i(0,e-1,b):B(0,e-1,b)};var n=32;function i(b,n,i){for(var e=2*(b+1),V=b+1;V<=n;++V){for(var Q=i[e++],U=i[e++],Y=V,L=e-2;Y-- >b;){var B=i[L-2],mb=i[L-1];if(B<Q)break;if(B===Q&&mb<U)break;i[L]=B,i[L+1]=mb,L-=2}i[L]=Q,i[L+1]=U}}function e(b,n,i){n*=2;var e=i[b*=2],V=i[b+1];i[b]=i[n],i[b+1]=i[n+1],i[n]=e,i[n+1]=V}function V(b,n,i){n*=2,i[b*=2]=i[n],i[b+1]=i[n+1]}function Q(b,n,i,e){n*=2,i*=2;var V=e[b*=2],Q=e[b+1];e[b]=e[n],e[b+1]=e[n+1],e[n]=e[i],e[n+1]=e[i+1],e[i]=V,e[i+1]=Q}function U(b,n,i,e,V){n*=2,V[b*=2]=V[n],V[n]=i,V[b+1]=V[n+1],V[n+1]=e}function Y(b,n,i){n*=2;var e=i[b*=2],V=i[n];return!(e<V)&&(e!==V||i[b+1]>i[n+1])}function L(b,n,i,e){var V=e[b*=2];return V<n||V===n&&e[b+1]<i}function B(b,mb,N){var Z=(mb-b+1)/6|0,T=b+Z,z=mb-Z,K=b+mb>>1,I=K-Z,O=K+Z,u=T,d=I,G=K,o=O,M=z,j=b+1,a=mb-1,D=0;Y(u,d,N)&&(D=u,u=d,d=D),Y(o,M,N)&&(D=o,o=M,M=D),Y(u,G,N)&&(D=u,u=G,G=D),Y(d,G,N)&&(D=d,d=G,G=D),Y(u,o,N)&&(D=u,u=o,o=D),Y(G,o,N)&&(D=G,G=o,o=D),Y(d,M,N)&&(D=d,d=M,M=D),Y(d,G,N)&&(D=d,d=G,G=D),Y(o,M,N)&&(D=o,o=M,M=D);for(var x=N[2*d],y=N[2*d+1],s=N[2*o],A=N[2*o+1],E=2*u,C=2*G,t=2*M,w=2*T,h=2*K,W=2*z,J=0;J<2;++J){var R=N[E+J],k=N[C+J],r=N[t+J];N[w+J]=R,N[h+J]=k,N[W+J]=r}V(I,b,N),V(O,mb,N);for(var X=j;X<=a;++X)if(L(X,x,y,N))X!==j&&e(X,j,N),++j;else if(!L(X,s,A,N))for(;;){if(L(a,s,A,N)){L(a,x,y,N)?(Q(X,j,a,N),++j,--a):(e(X,a,N),--a);break}if(--a<X)break}U(b,j-1,x,y,N),U(mb,a+1,s,A,N),j-2-b<=n?i(b,j-2,N):B(b,j-2,N),mb-(a+2)<=n?i(a+2,mb,N):B(a+2,mb,N),a-j<=n?i(j,a,N):B(j,a,N)}},13838:(b,n,i)=>{"use strict";b.exports={init:function(b){var n=V.nextPow2(b);L.length<n&&(e.free(L),L=e.mallocInt32(n));B.length<n&&(e.free(B),B=e.mallocInt32(n));mb.length<n&&(e.free(mb),mb=e.mallocInt32(n));N.length<n&&(e.free(N),N=e.mallocInt32(n));Z.length<n&&(e.free(Z),Z=e.mallocInt32(n));T.length<n&&(e.free(T),T=e.mallocInt32(n));var i=8*n;z.length<i&&(e.free(z),z=e.mallocDouble(i))},sweepBipartite:function(b,n,i,e,V,Y,Z,T,O,u){for(var d=0,G=2*b,o=b-1,M=G-1,j=i;j<e;++j){var a=Y[j],D=G*j;z[d++]=V[D+o],z[d++]=-(a+1),z[d++]=V[D+M],z[d++]=a}for(j=Z;j<T;++j){a=u[j]+U;var x=G*j;z[d++]=O[x+o],z[d++]=-a,z[d++]=O[x+M],z[d++]=a}var y=d>>>1;Q(z,y);var s=0,A=0;for(j=0;j<y;++j){var E=0|z[2*j+1];if(E>=U)K(mb,N,A--,E=E-U|0);else if(E>=0)K(L,B,s--,E);else if(E<=-U){E=-E-U|0;for(var C=0;C<s;++C){if(void 0!==(t=n(L[C],E)))return t}I(mb,N,A++,E)}else{E=-E-1|0;for(C=0;C<A;++C){var t;if(void 0!==(t=n(E,mb[C])))return t}I(L,B,s++,E)}}},sweepComplete:function(b,n,i,e,V,U,Y,O,u,d){for(var G=0,o=2*b,M=b-1,j=o-1,a=i;a<e;++a){var D=U[a]+1<<1,x=o*a;z[G++]=V[x+M],z[G++]=-D,z[G++]=V[x+j],z[G++]=D}for(a=Y;a<O;++a){D=d[a]+1<<1;var y=o*a;z[G++]=u[y+M],z[G++]=1|-D,z[G++]=u[y+j],z[G++]=1|D}var s=G>>>1;Q(z,s);var A=0,E=0,C=0;for(a=0;a<s;++a){var t=0|z[2*a+1],w=1&t;if(a<s-1&&t>>1===z[2*a+3]>>1&&(w=2,a+=1),t<0){for(var h=-(t>>1)-1,W=0;W<C;++W){if(void 0!==(J=n(Z[W],h)))return J}if(0!==w)for(W=0;W<A;++W){if(void 0!==(J=n(L[W],h)))return J}if(1!==w)for(W=0;W<E;++W){var J;if(void 0!==(J=n(mb[W],h)))return J}0===w?I(L,B,A++,h):1===w?I(mb,N,E++,h):2===w&&I(Z,T,C++,h)}else{h=(t>>1)-1;0===w?K(L,B,A--,h):1===w?K(mb,N,E--,h):2===w&&K(Z,T,C--,h)}}},scanBipartite:function(b,n,i,e,V,Y,mb,N,Z,T,O,u){var d=0,G=2*b,o=n,M=n+b,j=1,a=1;e?a=U:j=U;for(var D=V;D<Y;++D){var x=D+j,y=G*D;z[d++]=mb[y+o],z[d++]=-x,z[d++]=mb[y+M],z[d++]=x}for(D=Z;D<T;++D){x=D+a;var s=G*D;z[d++]=O[s+o],z[d++]=-x}var A=d>>>1;Q(z,A);var E=0;for(D=0;D<A;++D){var C=0|z[2*D+1];if(C<0){var t=!1;if((x=-C)>=U?(t=!e,x-=U):(t=!!e,x-=1),t)I(L,B,E++,x);else{var w=u[x],h=G*x,W=O[h+n+1],J=O[h+n+1+b];b:for(var R=0;R<E;++R){var k=L[R],r=G*k;if(!(J<mb[r+n+1]||mb[r+n+1+b]<W)){for(var X=n+2;X<b;++X)if(O[h+X+b]<mb[r+X]||mb[r+X+b]<O[h+X])continue b;var g,P=N[k];if(void 0!==(g=e?i(w,P):i(P,w)))return g}}}}else K(L,B,E--,C-j)}},scanComplete:function(b,n,i,e,V,Y,B,mb,N,Z,T){for(var K=0,I=2*b,O=n,u=n+b,d=e;d<V;++d){var G=d+U,o=I*d;z[K++]=Y[o+O],z[K++]=-G,z[K++]=Y[o+u],z[K++]=G}for(d=mb;d<N;++d){G=d+1;var M=I*d;z[K++]=Z[M+O],z[K++]=-G}var j=K>>>1;Q(z,j);var a=0;for(d=0;d<j;++d){var D=0|z[2*d+1];if(D<0){if((G=-D)>=U)L[a++]=G-U;else{var x=T[G-=1],y=I*G,s=Z[y+n+1],A=Z[y+n+1+b];b:for(var E=0;E<a;++E){var C=L[E],t=B[C];if(t===x)break;var w=I*C;if(!(A<Y[w+n+1]||Y[w+n+1+b]<s)){for(var h=n+2;h<b;++h)if(Z[y+h+b]<Y[w+h]||Y[w+h+b]<Z[y+h])continue b;var W=i(t,x);if(void 0!==W)return W}}}}else{for(G=D-U,E=a-1;E>=0;--E)if(L[E]===G){for(h=E+1;h<a;++h)L[h-1]=L[h];break}--a}}}};var e=i(13816),V=i(13823),Q=i(13844),U=1<<28,Y=1024,L=e.mallocInt32(Y),B=e.mallocInt32(Y),mb=e.mallocInt32(Y),N=e.mallocInt32(Y),Z=e.mallocInt32(Y),T=e.mallocInt32(Y),z=e.mallocDouble(8192);function K(b,n,i,e){var V=n[e],Q=b[i-1];b[V]=Q,n[Q]=V}function I(b,n,i,e){b[i]=e,n[e]=i}},13825:b=>{"use strict";function n(b,i,e){var V=0|b[e];if(V<=0)return[];var Q,U=new Array(V);if(e===b.length-1)for(Q=0;Q<V;++Q)U[Q]=i;else for(Q=0;Q<V;++Q)U[Q]=n(b,i,e+1);return U}b.exports=function(b,i){switch("undefined"===typeof i&&(i=0),typeof b){case"number":if(b>0)return function(b,n){var i,e;for(i=new Array(b),e=0;e<b;++e)i[e]=n;return i}(0|b,i);break;case"object":if("number"===typeof b.length)return n(b,i,0)}return[]}},13777:(b,n,i)=>{b.exports=function(){var b=this;this.components={},this.comps=this.components;var n=this.components,i=1,V={},Q=[],U=[],Y={timeout:!1,removals:[],multiComps:[]};function L(b,i){var e=n[i],Q=V[i],U=Q.hash[b];U&&(Q.remove(b),e.ln&&(e.multi?(U.forEach((n=>{n&&e.ln(b,n)})),U.length=0):e.ln(b,U)),Y.removals.push(Q),B())}function B(){Y.timeout||(Y.timeout=!0,setTimeout(mb,1))}function mb(){Y.timeout=!1,N()}function N(){Y.multiComps.length&&function(b){for(var n=0;n<b.length;n++){var{entID:i,data:e}=b[n],V=e.hash[i];if(V){for(var Q=0;Q<V.length;Q++)V[Q]||(V.splice(Q,1),Q--);0===V.length&&(e.remove(i),Y.removals.push(e))}}b.length=0}(Y.multiComps),Y.removals.length&&function(b){for(var n=0;n<b.length;n++){b[n].flush()}b.length=0}(Y.removals)}this.YN=V,this._systems=Q,this._renderSystems=U,this.HB=function(n){var e=i++;return Array.isArray(n)&&n.forEach((n=>b.AL(e,n))),e},this.deleteEntity=function(n){return Object.keys(V).forEach((b=>{V[b].hash[n]&&L(n,b)})),b},this.mN=function(b){if(!b)throw new Error("Missing component definition");var i=b.name;if(!i)throw new Error("Component definition must have a name property.");if("string"!==typeof i)throw new Error("Component name must be a string.");if(""===i)throw new Error("Component name must be a non-empty string.");if(V[i])throw new Error(`Component ${i} already exists.`);var Y={};return Y.name=i,Y.multi=!!b.multi,Y.order=isNaN(b.order)?99:b.order,Y.stateConstructor=b.stateConstructor||null,Y.state=b.state||{},Y.yY=b.yY||null,Y.ln=b.ln||null,Y.system=b.system||null,Y.wY=b.wY||null,n[i]=Y,V[i]=new e,V[i]._pendingMultiCleanup=!1,V[i]._multiCleanupIDs=Y.multi?[]:null,Y.system&&(Q.push(i),Q.sort(((b,i)=>n[b].order-n[i].order))),Y.wY&&(U.push(i),U.sort(((b,i)=>n[b].order-n[i].order))),i},this.overwriteComponent=function(b,i){var e=n[b];if(!e)throw new Error(`Unknown component: ${b}`);if(!i)throw new Error("Missing component definition");if(e.name!==i.name)throw new Error("Overwriting component must use the same name property.");var Y={};Y.name=b,Y.multi=!!i.multi,Y.order=isNaN(i.order)?99:i.order,Y.state=i.state||{},Y.yY=i.yY||null,Y.ln=i.ln||null,Y.system=i.system||null,Y.wY=i.wY||null,n[b]=Y,V[b]._pendingMultiCleanup=!1,V[b]._multiCleanupIDs=Y.multi?[]:null;var L=Q.indexOf(b);Y.system&&L<0&&Q.push(b),!Y.system&&L>=0&&Q.splice(L,1),Q.sort(((b,i)=>n[b].order-n[i].order));var B=U.indexOf(b);Y.wY&&B<0&&U.push(b),!Y.wY&&B>=0&&U.splice(B,1),U.sort(((b,i)=>n[b].order-n[i].order));var mb=Y.state;return this.sB(b).forEach((b=>{for(var n in mb)n in b||(b[n]=mb[n]);Y.yY&&Y.yY(b.CY,b)})),b},this.deleteComponent=function(i){var e=V[i];if(!e)throw new Error(`Unknown component: ${i}`);e.flush(),e.list.forEach((b=>{b&&L(b.CY||b[0].CY,i)}));var Y=Q.indexOf(i),B=U.indexOf(i);return Y>-1&&Q.splice(Y,1),B>-1&&U.splice(B,1),V[i].dispose(),delete V[i],delete n[i],b},this.AL=function(b,i,e){var Q,U=n[i],Y=V[i];if(!Y)throw new Error(`Unknown component: ${i}.`);if(Y.hash[b]&&!U.multi)throw new Error(`Entity ${b} already has component: ${i}.`);if(U.stateConstructor){if(!(Q=new U.stateConstructor).hasOwnProperty("CY"))throw new Error(`Component ${U.name} stateConstructor type does not have property __id`)}else Q=Object.assign({},{CY:b},U.state,e);if(Q.CY=b,U.multi){var L=Y.hash[b];L||(L=[],Y.add(b,L)),L.push(Q)}else Y.add(b,Q);return U.yY&&U.yY(b,Q),this},this.rL=function(b,n){var i=V[n];if(!i)throw new Error(`Unknown component: ${n}.`);return!!i.hash[b]},this.wL=function(n,i){if(!V[i])throw new Error(`Unknown component: ${i}.`);return L(n,i),b},this.getState=function(b,n){var i=V[n];if(!i)throw new Error(`Unknown component: ${n}.`);return i.hash[b]},this.sB=function(b){var n=V[b];if(!n)throw new Error(`Unknown component: ${b}.`);return N(),n.list},this.vZ=function(b){if(!V[b])throw new Error(`Unknown component: ${b}.`);var n=V[b].hash;return b=>n[b]},this.FZ=function(b){if(!V[b])throw new Error(`Unknown component: ${b}.`);var n=V[b].hash;return b=>!!n[b]},this.uY=function(i){N();for(var e=0;e<Q.length;e++){var U=Q[e],Y=n[U],L=V[U];Y.system(i,L.list),N()}return b},this.render=function(i){N();for(var e=0;e<U.length;e++){var Q=U[e],Y=n[Q],L=V[Q];Y.wY(i,L.list),N()}return b},this.removeMultiComponent=function(i,e,Q){var U=n[e],L=V[e];if(!L)throw new Error(`Unknown component: ${e}.`);if(!U.multi)throw new Error("removeMultiComponent called on non-multi component");return function(b,n,i,e){var V=i.hash[b];if(V){var Q=V[e];Q&&(V[e]=null,n.ln&&n.ln(b,Q),Y.multiComps.push({entID:b,data:i}),B())}}(i,U,L,Q),b}};var e=i(13782)},13782:b=>{function n(b,n){var i=b._map[n];if(delete b.hash[n],delete b._map[n],i===b.list.length-1)b.list.pop();else{var e=b.list.pop();if(b.list[i]=e,null===e||null===e[0]){var V=b.list.length;for(var Q in b._map)if(b._map[Q]===V)return void(b._map[Q]=i)}else{var U=e.CY||e[0].CY;b._map[U]=i}}}b.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(b,n){if("number"===typeof this._map[b]){var i=this._map[b];this.hash[b]=n,this.list[i]=n}else this._map[b]=this.list.length,this.hash[b]=n,this.list.push(n)}remove(b){var n=this._map[b];this.hash[b]=null,this.list[n]=null,this._pendingRemovals.push(b)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var b=0;b<this._pendingRemovals.length;b++){var i=this._pendingRemovals[b];null===this.hash[i]&&n(this,i)}this._pendingRemovals.length=0}}},13734:b=>{"use strict";var n,i="object"===typeof Reflect?Reflect:null,e=function(b,n,i){return Function.prototype.apply.call(b,n,i)};n=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:function(b){return Object.getOwnPropertyNames(b)};var V=Number.isNaN||function(b){return b!==b};function Q(){Q.init.call(this)}b.exports=Q,b.exports.once=function(b,n){return new Promise((function(i,e){function V(i){b.removeListener(n,Q),e(i)}function Q(){"function"===typeof b.removeListener&&b.removeListener("error",V),i([].slice.call(arguments))}K(b,n,Q,{once:!0}),"error"!==n&&function(b,n,i){"function"===typeof b.on&&K(b,"error",n,i)}(b,V,{once:!0})}))},Q.EventEmitter=Q,Q.prototype._events=void 0,Q.prototype._eventsCount=0,Q.prototype._maxListeners=void 0;var U=10;function Y(b){if("function"!==typeof b)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}function L(b){return void 0===b._maxListeners?Q.defaultMaxListeners:b._maxListeners}function B(b,n,i,e){var V,Q,U,B;if(Y(i),void 0===(Q=b._events)?(Q=b._events=Object.create(null),b._eventsCount=0):(void 0!==Q.newListener&&(b.emit("newListener",n,i.listener?i.listener:i),Q=b._events),U=Q[n]),void 0===U)U=Q[n]=i,++b._eventsCount;else if("function"===typeof U?U=Q[n]=e?[i,U]:[U,i]:e?U.unshift(i):U.push(i),(V=L(b))>0&&U.length>V&&!U.warned){U.warned=!0;var mb=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");mb.name="MaxListenersExceededWarning",mb.Un=b,mb.type=n,mb.count=U.length,B=mb,console&&console.warn&&console.warn(B)}return b}function mb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function N(b,n,i){var e={fired:!1,wrapFn:void 0,target:b,type:n,listener:i},V=mb.bind(e);return V.listener=i,e.wrapFn=V,V}function Z(b,n,i){var e=b._events;if(void 0===e)return[];var V=e[n];return void 0===V?[]:"function"===typeof V?i?[V.listener||V]:[V]:i?function(b){for(var n=new Array(b.length),i=0;i<n.length;++i)n[i]=b[i].listener||b[i];return n}(V):z(V,V.length)}function T(b){var n=this._events;if(void 0!==n){var i=n[b];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function z(b,n){for(var i=new Array(n),e=0;e<n;++e)i[e]=b[e];return i}function K(b,n,i,e){if("function"===typeof b.on)e.once?b.once(n,i):b.on(n,i);else{if("function"!==typeof b.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b);b.addEventListener(n,(function V(Q){e.once&&b.removeEventListener(n,V),i(Q)}))}}Object.defineProperty(Q,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(b){if("number"!==typeof b||b<0||V(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");U=b}}),Q.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Q.prototype.setMaxListeners=function(b){if("number"!==typeof b||b<0||V(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this},Q.prototype.getMaxListeners=function(){return L(this)},Q.prototype.emit=function(b){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var V="error"===b,Q=this._events;if(void 0!==Q)V=V&&void 0===Q.error;else if(!V)return!1;if(V){var U;if(n.length>0&&(U=n[0]),U instanceof Error)throw U;var Y=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw Y.context=U,Y}var L=Q[b];if(void 0===L)return!1;if("function"===typeof L)e(L,this,n);else{var B=L.length,mb=z(L,B);for(i=0;i<B;++i)e(mb[i],this,n)}return!0},Q.prototype.addListener=function(b,n){return B(this,b,n,!1)},Q.prototype.on=Q.prototype.addListener,Q.prototype.prependListener=function(b,n){return B(this,b,n,!0)},Q.prototype.once=function(b,n){return Y(n),this.on(b,N(this,b,n)),this},Q.prototype.prependOnceListener=function(b,n){return Y(n),this.prependListener(b,N(this,b,n)),this},Q.prototype.removeListener=function(b,n){var i,e,V,Q,U;if(Y(n),void 0===(e=this._events))return this;if(void 0===(i=e[b]))return this;if(i===n||i.listener===n)0===--this._eventsCount?this._events=Object.create(null):(delete e[b],e.removeListener&&this.emit("removeListener",b,i.listener||n));else if("function"!==typeof i){for(V=-1,Q=i.length-1;Q>=0;Q--)if(i[Q]===n||i[Q].listener===n){U=i[Q].listener,V=Q;break}if(V<0)return this;0===V?i.shift():function(b,n){for(;n+1<b.length;n++)b[n]=b[n+1];b.pop()}(i,V),1===i.length&&(e[b]=i[0]),void 0!==e.removeListener&&this.emit("removeListener",b,U||n)}return this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.Yn=function(b){var n,i,e;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[b]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[b]),this;if(0===arguments.length){var V,Q=Object.keys(i);for(e=0;e<Q.length;++e)"removeListener"!==(V=Q[e])&&this.Yn(V);return this.Yn("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(n=i[b]))this.removeListener(b,n);else if(void 0!==n)for(e=n.length-1;e>=0;e--)this.removeListener(b,n[e]);return this},Q.prototype.listeners=function(b){return Z(this,b,!0)},Q.prototype.rawListeners=function(b){return Z(this,b,!1)},Q.listenerCount=function(b,n){return"function"===typeof b.listenerCount?b.listenerCount(n):T.call(b,n)},Q.prototype.listenerCount=T,Q.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},14047:b=>{"use strict";b.exports=function(b,n,i,e,V,Q){var U=+n[0],Y=+n[1],L=+n[2],B=+i[0],mb=+i[1],N=+i[2],Z=Math.sqrt(B*B+mb*mb+N*N);if(0===Z)throw new Error("Can't raycast along a zero vector");return function(b,n,i,e,V,Q,U,Y,L,B){for(var mb=0,N=Math.floor,Z=0|N(n),T=0|N(i),z=0|N(e),K=V>0?1:-1,I=Q>0?1:-1,O=U>0?1:-1,u=Math.abs(1/V),d=Math.abs(1/Q),G=Math.abs(1/U),o=u<1/0?u*(K>0?Z+1-n:n-Z):1/0,M=d<1/0?d*(I>0?T+1-i:i-T):1/0,j=G<1/0?G*(O>0?z+1-e:e-z):1/0,a=-1;mb<=Y;){var D=b(Z,T,z);if(D)return L&&(L[0]=n+mb*V,L[1]=i+mb*Q,L[2]=e+mb*U),B&&(B[0]=B[1]=B[2]=0,0===a&&(B[0]=-K),1===a&&(B[1]=-I),2===a&&(B[2]=-O)),D;o<M?o<j?(Z+=K,mb=o,o+=u,a=0):(z+=O,mb=j,j+=G,a=2):M<j?(T+=I,mb=M,M+=d,a=1):(z+=O,mb=j,j+=G,a=2)}return L&&(L[0]=n+mb*V,L[1]=i+mb*Q,L[2]=e+mb*U),B&&(B[0]=B[1]=B[2]=0),0}(b,U,Y,L,B/=Z,mb/=Z,N/=Z,e="undefined"===typeof e?64:+e,V,Q)}},14083:(b,n,i)=>{"use strict";i.d(n,{c:()=>Q});var e=i(13734);function V(){this.vN=!1,this.stopPropagation=!1,this.pN=!1,this.disabled=!1}class Q{constructor(b,n){this.version="0.7.0";var i=Object.assign({},new V,n||{});this.element=b||document,this.vN=!!i.vN,this.stopPropagation=!!i.stopPropagation,this.pN=!!i.pN,this.disabled=!!i.disabled,this.filterEvents=(b,n)=>!0,this.down=new e.EventEmitter,this.up=new e.EventEmitter,this.state={},this.MB={dx:0,dy:0,rZ:0,oB:0,XZ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Y(this):document.addEventListener("DOMContentLoaded",(b=>{Y(this)}),{once:!0})}bind(b){for(var n=arguments.length,i=new Array(n>1?n-1:0),e=1;e<n;e++)i[e-1]=arguments[e];i.forEach((n=>{var i=this._keyBindmap[n]||[];i.includes(b)||(i.push(b),this._keyBindmap[n]=i)})),this.state[b]=!!this.state[b],this.pressCount[b]=this.pressCount[b]||0,this.releaseCount[b]=this.releaseCount[b]||0}unbind(b){for(var n in this._keyBindmap){var i=this._keyBindmap[n],e=i.indexOf(b);e>-1&&i.splice(e,1)}}getBindings(){var b={};for(var n in this._keyBindmap){this._keyBindmap[n].forEach((i=>{b[i]=b[i]||[],b[i].push(n)}))}return b}uY(){U(this.MB),U(this.pressCount),U(this.releaseCount)}}function U(b){for(var n in b)b[n]=0}function Y(b){window.addEventListener("keydown",z.bind(null,b,!0),!1),window.addEventListener("keyup",z.bind(null,b,!1),!1);var n={passive:!0};b.element.addEventListener("touchstart",N.bind(void 0,b),{passive:!1}),b.element.addEventListener("touchend",T.bind(void 0,b),n),b.element.addEventListener("mousedown",K.bind(null,b,!0),n),window.document.addEventListener("mouseup",K.bind(null,b,!1),n),b.element.addEventListener("touchmove",I.bind(null,b),n),b.element.addEventListener("mousemove",I.bind(null,b),n),window.PointerEvent,b.element.addEventListener("wheel",O.bind(null,b),n),b.element.addEventListener("contextmenu",u.bind(null,b),!1),window.addEventListener("blur",d.bind(null,b),!1)}var L=0,B=0,mb=null;function N(b,n){n.preventDefault(),Z(n)}function Z(b){let n=!1;for(let i=0;i<b.touches.length;++i)if(b.touches[i].identifier===mb){n=!0;break}if(!n){const n=b.changedTouches[0];L=n.clientX,B=n.clientY,mb=n.identifier}}function T(b,n){for(var i=n.changedTouches,e=0;e<i.length;++e)i[e].identifier===mb&&(mb=null)}function z(b,n,i){G(i.code,n,b,i)}function K(b,n,i){if("pointerId"in i)if(n){if(null!==b._touches.currID)return;b._touches.currID=i.pointerId}else{if(b._touches.currID!==i.pointerId)return;b._touches.currID=null}return G("Mouse"+("button"in i?i.button+1:1),n,b,i),!1}function I(b,n){var i=n.movementX||n.mozMovementX||0,e=n.movementY||n.mozMovementY||0;if(n.touches&&0===(i|e)){var V=function(b){Z(b);for(let n=0;n<b.changedTouches.length;++n)if(b.changedTouches[n].identifier==mb){const i=b.changedTouches[n],e=[i.clientX-L,i.clientY-B];return L=i.clientX,B=i.clientY,e}return console.error(`Did not find touch id ${mb}`),[0,0]}(n);i=V[0],e=V[1]}b.MB.dx+=i,b.MB.dy+=e}function O(b,n){var i=1;switch(n.deltaMode){case 0:i=1;break;case 1:i=12;break;case 2:i=b.element.clientHeight||window.innerHeight}b.MB.rZ+=(n.deltaX||0)*i,b.MB.oB+=(n.deltaY||0)*i,b.MB.XZ+=(n.deltaZ||0)*i}function u(b,n){if(!b.pN)return n.preventDefault(),!1}function d(b){for(var n in b._keyStates)b._keyStates[n]&&(/^Mouse\d/.test(n)||G(n,!1,b,{code:n,note:"eitrko2g72b",preventDefault:()=>{},stopPropagation:()=>{}}))}function G(b,n,i,e){var V=i._keyBindmap[b];V&&(o(i._keyStates[b],n)&&(i._keyStates[b]=n,V.forEach((b=>{(!i.filterEvents||i.filterEvents(e,b))&&function(b,n,i,e){var V=n?i.pressCount:i.releaseCount;V[b]=(V[b]||0)+1;var Q=i._bindPressCount[b]||0;(Q+=n?1:-1)<0&&(Q=0);i._bindPressCount[b]=Q;var U=i.state[b];if(o(U,Q)){i.state[b]=Q>0;var Y=n?i.down:i.up;i.disabled||Y.emit(b,e)}}(b,n,i,e)}))),"button"in e||(i.vN&&!e.defaultPrevented&&e.preventDefault(),i.stopPropagation&&e.stopPropagation()))}function o(b,n){return b?!n:n}},12648:b=>{b.exports=function(b,n,i){return b[0]=n[0]+i[0],b[1]=n[1]+i[1],b[2]=n[2]+i[2],b}},12622:(b,n,i)=>{b.exports=function(b,n){var i=e(b[0],b[1],b[2]),U=e(n[0],n[1],n[2]);V(i,i),V(U,U);var Y=Q(i,U);return Y>1?0:Math.acos(Y)};var e=i(12631),V=i(12633),Q=i(12635)},12710:b=>{b.exports=function(b,n){return b[0]=Math.ceil(n[0]),b[1]=Math.ceil(n[1]),b[2]=Math.ceil(n[2]),b}},12619:b=>{b.exports=function(b){var n=new Float32Array(3);return n[0]=b[0],n[1]=b[1],n[2]=b[2],n}},12637:b=>{b.exports=function(b,n){return b[0]=n[0],b[1]=n[1],b[2]=n[2],b}},12612:b=>{b.exports=function(){var b=new Float32Array(3);return b[0]=0,b[1]=0,b[2]=0,b}},12799:b=>{b.exports=function(b,n,i){var e=n[0],V=n[1],Q=n[2],U=i[0],Y=i[1],L=i[2];return b[0]=V*L-Q*Y,b[1]=Q*U-e*L,b[2]=e*Y-V*U,b}},12742:(b,n,i)=>{b.exports=i(12735)},12735:b=>{b.exports=function(b,n){var i=n[0]-b[0],e=n[1]-b[1],V=n[2]-b[2];return Math.sqrt(i*i+e*e+V*V)}},12688:(b,n,i)=>{b.exports=i(12680)},12680:b=>{b.exports=function(b,n,i){return b[0]=n[0]/i[0],b[1]=n[1]/i[1],b[2]=n[2]/i[2],b}},12635:b=>{b.exports=function(b,n){return b[0]*n[0]+b[1]*n[1]+b[2]*n[2]}},12608:b=>{b.exports=1e-6},12642:(b,n,i)=>{b.exports=function(b,n){var i=b[0],V=b[1],Q=b[2],U=n[0],Y=n[1],L=n[2];return Math.abs(i-U)<=e*Math.max(1,Math.abs(i),Math.abs(U))&&Math.abs(V-Y)<=e*Math.max(1,Math.abs(V),Math.abs(Y))&&Math.abs(Q-L)<=e*Math.max(1,Math.abs(Q),Math.abs(L))};var e=i(12608)},12646:b=>{b.exports=function(b,n){return b[0]===n[0]&&b[1]===n[1]&&b[2]===n[2]}},12705:b=>{b.exports=function(b,n){return b[0]=Math.floor(n[0]),b[1]=Math.floor(n[1]),b[2]=Math.floor(n[2]),b}},12849:(b,n,i)=>{b.exports=function(b,n,i,V,Q,U){var Y,L;n||(n=3);i||(i=0);L=V?Math.min(V*n+i,b.length):b.length;for(Y=i;Y<L;Y+=n)e[0]=b[Y],e[1]=b[Y+1],e[2]=b[Y+2],Q(e,e,U),b[Y]=e[0],b[Y+1]=e[1],b[Y+2]=e[2];return b};var e=i(12612)()},12631:b=>{b.exports=function(b,n,i){var e=new Float32Array(3);return e[0]=b,e[1]=n,e[2]=i,e}},12601:(b,n,i)=>{b.exports={EPSILON:i(12608),create:i(12612),clone:i(12619),angle:i(12622),BY:i(12631),k:i(12637),set:i(12640),equals:i(12642),exactEquals:i(12646),add:i(12648),un:i(12653),sub:i(12658),multiply:i(12663),mul:i(12672),divide:i(12680),div:i(12688),min:i(12695),max:i(12698),floor:i(12705),ceil:i(12710),round:i(12719),scale:i(12724),mL:i(12726),distance:i(12735),i:i(12742),squaredDistance:i(12747),sqrDist:i(12755),length:i(12763),len:i(12767),squaredLength:i(12774),NY:i(12783),negate:i(12785),inverse:i(12793),normalize:i(12633),dot:i(12635),cross:i(12799),UY:i(12802),random:i(12808),transformMat4:i(12817),transformMat3:i(12822),transformQuat:i(12829),ZY:i(12835),TY:i(12839),zY:i(12844),forEach:i(12849)}},12793:b=>{b.exports=function(b,n){return b[0]=1/n[0],b[1]=1/n[1],b[2]=1/n[2],b}},12767:(b,n,i)=>{b.exports=i(12763)},12763:b=>{b.exports=function(b){var n=b[0],i=b[1],e=b[2];return Math.sqrt(n*n+i*i+e*e)}},12802:b=>{b.exports=function(b,n,i,e){var V=n[0],Q=n[1],U=n[2];return b[0]=V+e*(i[0]-V),b[1]=Q+e*(i[1]-Q),b[2]=U+e*(i[2]-U),b}},12698:b=>{b.exports=function(b,n,i){return b[0]=Math.max(n[0],i[0]),b[1]=Math.max(n[1],i[1]),b[2]=Math.max(n[2],i[2]),b}},12695:b=>{b.exports=function(b,n,i){return b[0]=Math.min(n[0],i[0]),b[1]=Math.min(n[1],i[1]),b[2]=Math.min(n[2],i[2]),b}},12672:(b,n,i)=>{b.exports=i(12663)},12663:b=>{b.exports=function(b,n,i){return b[0]=n[0]*i[0],b[1]=n[1]*i[1],b[2]=n[2]*i[2],b}},12785:b=>{b.exports=function(b,n){return b[0]=-n[0],b[1]=-n[1],b[2]=-n[2],b}},12633:b=>{b.exports=function(b,n){var i=n[0],e=n[1],V=n[2],Q=i*i+e*e+V*V;Q>0&&(Q=1/Math.sqrt(Q),b[0]=n[0]*Q,b[1]=n[1]*Q,b[2]=n[2]*Q);return b}},12808:b=>{b.exports=function(b,n){n=n||1;var i=2*Math.random()*Math.PI,e=2*Math.random()-1,V=Math.sqrt(1-e*e)*n;return b[0]=Math.cos(i)*V,b[1]=Math.sin(i)*V,b[2]=e*n,b}},12835:b=>{b.exports=function(b,n,i,e){var V=i[1],Q=i[2],U=n[1]-V,Y=n[2]-Q,L=Math.sin(e),B=Math.cos(e);return b[0]=n[0],b[1]=V+U*B-Y*L,b[2]=Q+U*L+Y*B,b}},12839:b=>{b.exports=function(b,n,i,e){var V=i[0],Q=i[2],U=n[0]-V,Y=n[2]-Q,L=Math.sin(e),B=Math.cos(e);return b[0]=V+Y*L+U*B,b[1]=n[1],b[2]=Q+Y*B-U*L,b}},12844:b=>{b.exports=function(b,n,i,e){var V=i[0],Q=i[1],U=n[0]-V,Y=n[1]-Q,L=Math.sin(e),B=Math.cos(e);return b[0]=V+U*B-Y*L,b[1]=Q+U*L+Y*B,b[2]=n[2],b}},12719:b=>{b.exports=function(b,n){return b[0]=Math.round(n[0]),b[1]=Math.round(n[1]),b[2]=Math.round(n[2]),b}},12724:b=>{b.exports=function(b,n,i){return b[0]=n[0]*i,b[1]=n[1]*i,b[2]=n[2]*i,b}},12726:b=>{b.exports=function(b,n,i,e){return b[0]=n[0]+i[0]*e,b[1]=n[1]+i[1]*e,b[2]=n[2]+i[2]*e,b}},12640:b=>{b.exports=function(b,n,i,e){return b[0]=n,b[1]=i,b[2]=e,b}},12755:(b,n,i)=>{b.exports=i(12747)},12783:(b,n,i)=>{b.exports=i(12774)},12747:b=>{b.exports=function(b,n){var i=n[0]-b[0],e=n[1]-b[1],V=n[2]-b[2];return i*i+e*e+V*V}},12774:b=>{b.exports=function(b){var n=b[0],i=b[1],e=b[2];return n*n+i*i+e*e}},12658:(b,n,i)=>{b.exports=i(12653)},12653:b=>{b.exports=function(b,n,i){return b[0]=n[0]-i[0],b[1]=n[1]-i[1],b[2]=n[2]-i[2],b}},12822:b=>{b.exports=function(b,n,i){var e=n[0],V=n[1],Q=n[2];return b[0]=e*i[0]+V*i[3]+Q*i[6],b[1]=e*i[1]+V*i[4]+Q*i[7],b[2]=e*i[2]+V*i[5]+Q*i[8],b}},12817:b=>{b.exports=function(b,n,i){var e=n[0],V=n[1],Q=n[2],U=i[3]*e+i[7]*V+i[11]*Q+i[15];return U=U||1,b[0]=(i[0]*e+i[4]*V+i[8]*Q+i[12])/U,b[1]=(i[1]*e+i[5]*V+i[9]*Q+i[13])/U,b[2]=(i[2]*e+i[6]*V+i[10]*Q+i[14])/U,b}},12829:b=>{b.exports=function(b,n,i){var e=n[0],V=n[1],Q=n[2],U=i[0],Y=i[1],L=i[2],B=i[3],mb=B*e+Y*Q-L*V,N=B*V+L*e-U*Q,Z=B*Q+U*V-Y*e,T=-U*e-Y*V-L*Q;return b[0]=mb*B+T*-U+N*-L-Z*-Y,b[1]=N*B+T*-Y+Z*-U-mb*-L,b[2]=Z*B+T*-L+mb*-Y-N*-U,b}},13755:b=>{"use strict";b.exports=function(b){for(var n=new Array(b),i=0;i<b;++i)n[i]=i;return n}},13834:b=>{b.exports=function(b){return null!=b&&null!=b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}},14055:(b,n,i)=>{"use strict";i.d(n,{d:()=>e});class e{constructor(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Em=!1,this.Cm=!1,this.sm=30,this.Am=0,this.rm=!1,this.fullscreen=!1,this.wm=function(b){},this.hm=function(){},this.Rm=function(){},this.bi=function(){},this.Wm=function(b){},this.onFullscreenChanged=function(b){},B((()=>{!function(b,n){b._nowObject=performance||Date,b._lastTick=0,b._renderAccum=0,b._rt=0,b._frameCB=Y.bind(null,b),requestAnimationFrame(b._frameCB),n>0&&(b._intervalCB=U.bind(null,b),b._interval=setInterval(b._intervalCB,Math.max(n,1e3/b.sm/2)))}(this,n),function(b,n){if(!n)return;var i=!1,e=!1;document.addEventListener("pointerlockchange",(e=>{i=document.pointerLockElement===n,b.Wm(i)})),document.addEventListener("fullscreenchange",(i=>{e=document.fullscreenElement===n,b.onFullscreenChanged(e)})),Object.defineProperty(b,"rm",{get:()=>i,set:b=>{b&&!i?L(n):i&&!b&&function(b){b.exitPointerLock&&b.exitPointerLock()}(document)}}),Object.defineProperty(b,"fullscreen",{get:()=>e,set:b=>{b&&!e?n.requestFullscreen():e&&!b&&document.exitFullscreen()}}),n.addEventListener("click",(V=>{b.Em&&!i&&L(n),b.Cm&&!e&&n.requestFullscreen()}));var V=()=>b.bi();if(window.ResizeObserver){new ResizeObserver(V).observe(n)}else window.addEventListener("resize",V)}(this,b),this.Rm()}))}}var V=3,Q=20;function U(b){for(var n=1e3/b.sm,i=b._nowObject.now()+Q,e=0;b._nowObject.now()>=b._lastTick+n&&b._nowObject.now()<i&&++e<=V;)b.wm(n),b._lastTick+=n;var U=5*(n+5),Y=b._nowObject.now();if(Y-b._lastTick>U)for(;Y>=b._lastTick+n;)b._lastTick+=n}function Y(b){requestAnimationFrame(b._frameCB),U(b);var n=b._nowObject.now(),i=n-b._rt;if(b._rt=n,b.Am>0){b._renderAccum+=i;var e=1e3/b.Am;if(b._renderAccum<e)return;b._renderAccum=Math.min(b._renderAccum-e,e)}var V=1e3/b.sm,Q=(n-b._lastTick)/V;b.hm(i,Q,V)}function L(b){b.requestPointerLock&&b.requestPointerLock()}var B=b=>{if("loading"===document.readyState){var n=()=>{document.removeEventListener("readystatechange",n),b()};document.addEventListener("readystatechange",n)}else setTimeout(b,1)}},13749:(b,n,i)=>{var e=i(13755),V=i(13764),Q="undefined"!==typeof Float64Array;function U(b,n){return b[0]-n[0]}function Y(){var b,n=this.stride,i=new Array(n.length);for(b=0;b<i.length;++b)i[b]=[Math.abs(n[b]),b];i.sort(U);var e=new Array(i.length);for(b=0;b<e.length;++b)e[b]=i[b][1];return e}function L(b,n){var i=["View",n,"d",b].join("");n<0&&(i="View_Nil"+b);var V="generic"===b;if(-1===n){var Q="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(Q)()}if(0===n){Q="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(V?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(V?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",Q)(B[b][0])}Q=["'use strict'"];var U=e(n),L=U.map((function(b){return"i"+b})),mb="this.offset+"+U.map((function(b){return"this.stride["+b+"]*i"+b})).join("+"),N=U.map((function(b){return"b"+b})).join(","),Z=U.map((function(b){return"c"+b})).join(",");Q.push("function "+i+"(a,"+N+","+Z+",d){this.data=a","this.shape=["+N+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+b+"'","proto.dimension="+n),Q.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+U.map((function(b){return"this.shape["+b+"]"})).join("*"),"}})"),1===n?Q.push("proto.order=[0]"):(Q.push("Object.defineProperty(proto,'order',{get:"),n<4?(Q.push("function "+i+"_order(){"),2===n?Q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===n&&Q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Q.push("ORDER})")),Q.push("proto.set=function "+i+"_set("+L.join(",")+",v){"),V?Q.push("return this.data.set("+mb+",v)}"):Q.push("return this.data["+mb+"]=v}"),Q.push("proto.get=function "+i+"_get("+L.join(",")+"){"),V?Q.push("return this.data.get("+mb+")}"):Q.push("return this.data["+mb+"]}"),Q.push("proto.index=function "+i+"_index(",L.join(),"){return "+mb+"}"),Q.push("proto.hi=function "+i+"_hi("+L.join(",")+"){return new "+i+"(this.data,"+U.map((function(b){return["(typeof i",b,"!=='number'||i",b,"<0)?this.shape[",b,"]:i",b,"|0"].join("")})).join(",")+","+U.map((function(b){return"this.stride["+b+"]"})).join(",")+",this.offset)}");var T=U.map((function(b){return"a"+b+"=this.shape["+b+"]"})),z=U.map((function(b){return"c"+b+"=this.stride["+b+"]"}));Q.push("proto.lo=function "+i+"_lo("+L.join(",")+"){var b=this.offset,d=0,"+T.join(",")+","+z.join(","));for(var K=0;K<n;++K)Q.push("if(typeof i"+K+"==='number'&&i"+K+">=0){d=i"+K+"|0;b+=c"+K+"*d;a"+K+"-=d}");Q.push("return new "+i+"(this.data,"+U.map((function(b){return"a"+b})).join(",")+","+U.map((function(b){return"c"+b})).join(",")+",b)}"),Q.push("proto.step=function "+i+"_step("+L.join(",")+"){var "+U.map((function(b){return"a"+b+"=this.shape["+b+"]"})).join(",")+","+U.map((function(b){return"b"+b+"=this.stride["+b+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(K=0;K<n;++K)Q.push("if(typeof i"+K+"==='number'){d=i"+K+"|0;if(d<0){c+=b"+K+"*(a"+K+"-1);a"+K+"=ceil(-a"+K+"/d)}else{a"+K+"=ceil(a"+K+"/d)}b"+K+"*=d}");Q.push("return new "+i+"(this.data,"+U.map((function(b){return"a"+b})).join(",")+","+U.map((function(b){return"b"+b})).join(",")+",c)}");var I=new Array(n),O=new Array(n);for(K=0;K<n;++K)I[K]="a[i"+K+"]",O[K]="b[i"+K+"]";Q.push("proto.transpose=function "+i+"_transpose("+L+"){"+L.map((function(b,n){return b+"=("+b+"===undefined?"+n+":"+b+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+I.join(",")+","+O.join(",")+",this.offset)}"),Q.push("proto.pick=function "+i+"_pick("+L+"){var a=[],b=[],c=this.offset");for(K=0;K<n;++K)Q.push("if(typeof i"+K+"==='number'&&i"+K+">=0){c=(c+this.stride["+K+"]*i"+K+")|0}else{a.push(this.shape["+K+"]);b.push(this.stride["+K+"])}");return Q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Q.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+U.map((function(b){return"shape["+b+"]"})).join(",")+","+U.map((function(b){return"stride["+b+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Q.join("\n"))(B[b],Y)}var B={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(b,n,i,e){if(void 0===b)return(0,B.array[0])([]);"number"===typeof b&&(b=[b]),void 0===n&&(n=[b.length]);var U=n.length;if(void 0===i){i=new Array(U);for(var Y=U-1,mb=1;Y>=0;--Y)i[Y]=mb,mb*=n[Y]}if(void 0===e){e=0;for(Y=0;Y<U;++Y)i[Y]<0&&(e-=(n[Y]-1)*i[Y])}for(var N=function(b){if(V(b))return"buffer";if(Q)switch(Object.prototype.toString.call(b)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(b)?"array":"generic"}(b),Z=B[N];Z.length<=U+1;)Z.push(L(N,Z.length-1));return(0,Z[U+1])(b,n,i,e)}},13764:b=>{function n(b){return!!b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}b.exports=function(b){return null!=b&&(n(b)||function(b){return"function"===typeof b.readFloatLE&&"function"===typeof b.slice&&n(b.slice(0,0))}(b)||!!b._isBuffer)}},13928:b=>{"use strict";var n=[],i=[],e=[],V=[],Q=[],U=[],Y=[],L=[],B=[],mb=[],N=[],Z=[];b.exports=function(b,T,z,K,I,O){for(var u=Y,d=B,G=mb,o=Z,M=0;M<3;M++)u[M]=+z[M],G[M]=+T.max[M],d[M]=+T.base[M];O||(O=1e-10);var j=function(b,Y,B,mb,Z,T){var z=n,K=i,I=e,O=V,u=Q,d=U,G=L,o=Math.floor,M=0,j=0,a=0,D=0,x=0;if(y(),0===a)return 0;for(D=E();j<=a;){if(s(D)&&A())return M;D=E()}for(M+=a,x=0;x<3;x++)mb[x]+=B[x],Z[x]+=B[x];return M;function y(){if(j=0,0!==(a=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2])))for(var b=0;b<3;b++){var n=B[b]>=0;O[b]=n?1:-1;var i=n?Z[b]:mb[b];z[b]=n?mb[b]:Z[b],K[b]=C(i,O[b]),I[b]=t(z[b],O[b]),G[b]=B[b]/a,u[b]=Math.abs(1/G[b]);var e=n?K[b]+1-i:i-K[b];d[b]=u[b]<1/0?u[b]*e:1/0}}function s(n){for(var i=O[0],e=0===n?K[0]:I[0],V=K[0]+i,Q=O[1],U=1===n?K[1]:I[1],Y=K[1]+Q,L=O[2],B=2===n?K[2]:I[2],mb=K[2]+L,N=e;N!=V;N+=i)for(var Z=U;Z!=Y;Z+=Q)for(var T=B;T!=mb;T+=L)if(b(N,Z,T))return!0;return!1}function A(){M+=j;var b=O[D],n=j/a,i=N;for(x=0;x<3;x++){var e=B[x]*n;mb[x]+=e,Z[x]+=e,i[x]=B[x]-e}if(b>0?Z[D]=Math.round(Z[D]):mb[D]=Math.round(mb[D]),Y(M,D,b,i))return!0;for(x=0;x<3;x++)B[x]=i[x];return y(),0===a}function E(){var b=d[0]<d[1]?d[0]<d[2]?0:2:d[1]<d[2]?1:2,n=d[b]-j;for(j=d[b],K[b]+=O[b],d[b]+=u[b],x=0;x<3;x++)z[x]+=n*G[x],I[x]=t(z[x],O[x]);return b}function C(b,n){return o(b-n*T)}function t(b,n){return o(b+n*T)}}(b,K,u,d,G,O);if(!I){for(M=0;M<3;M++)o[M]=z[M]>0?G[M]-T.max[M]:d[M]-T.base[M];T.translate(o)}return j}},14086:(b,n,i)=>{"use strict";i.d(n,{d:()=>N});var e=i(13920),V=i(12601);class Q{constructor(b,n,i,Q,U,Y,L){this.yB=new e(b.base,b.cB),this.pi=n,this.friction=i,this.restitution=Q,this.FU=U,this.YT=Y,this.bY=!!L,this.PB=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.HT=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.iB=V.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=V.create(),this._impulses=V.create(),this._sleepFrameCount=10}loadFromCopy(b){V.k(this.yB.base,b.yB.base),V.k(this.yB.cB,b.yB.cB),V.k(this.yB.max,b.yB.max),this.yB.mag=b.yB.mag,this.pi=b.pi,this.friction=b.friction,this.restitution=b.restitution,this.FU=b.FU,this.YT=b.YT,this.bY=b.bY,this.PB=b.PB,this.fluidDrag=b.fluidDrag,this.HT=b.HT,this.preventFallOffEdge=b.preventFallOffEdge,this.rolledBackLastTick=b.rolledBackLastTick,V.k(this.iB,b.iB),V.k(this.resting,b.resting),this.inFluid=b.inFluid,this._ratioInFluid=b._ratioInFluid,V.k(this._forces,b._forces),V.k(this._impulses,b._impulses),this._sleepFrameCount=b._sleepFrameCount}setPosition(b){U(b),V.un(b,b,this.yB.base),this.yB.translate(b),this.QB()}me(){return V.clone(this.yB.base)}applyForce(b){U(b),V.add(this._forces,this._forces,b),this.QB()}applyImpulse(b){U(b),V.add(this._impulses,this._impulses,b),this.QB()}QB(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var U=b=>{};var Y=i(13920),L=i(12601),B=i(13928);function mb(){this.PB=.1,this.fluidDrag=.4,this.QY=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function N(b,n,i){b=Object.assign(new mb,b),this.gravity=b.gravity||[0,-10,0],this.PB=b.PB||.1,this.QY=b.QY||2,this.fluidDrag=b.fluidDrag||.4,this.minBounceImpulse=b.minBounceImpulse,this.bodies=[],this.AZ=b.AZ,this.testSolid=n,this.testFluid=i}N.prototype.zT=function(b,n,i,e,V,U){b=b||new Y([0,0,0],[1,1,1]),"undefined"==typeof n&&(n=1),"undefined"==typeof i&&(i=1),"undefined"==typeof e&&(e=0),"undefined"==typeof V&&(V=1);var L=new Q(b,n,i,e,V,U);return this.bodies.push(L),L},N.prototype.KT=function(b){var n=this.bodies.indexOf(b);n<0||(this.bodies.splice(n,1),b.yB=b.YT=null)};var Z=L.create(),T=L.create(),z=L.create(),K=L.create(),I=L.create(),O=L.create(),u=L.create(),d=new Y([0,0,0],[1,1,1]),G=new Q(d,1,1,0,1,(()=>{}),!1);function o(b,n,i){return n=i,n*=1-(1-b.ratioInFluid)**2}N.prototype.uY=function(b){b/=1e3;var n=R(0,L.squaredLength(this.gravity));this.bodies.forEach((i=>function(b,n,i,e){L.k(I,n.resting),b.AZ&&G.loadFromCopy(n);if(n.pi<=0)return L.set(n.iB,0,0,0),L.set(n._forces,0,0,0),void L.set(n._impulses,0,0,0);var V=e||0===n.FU;if(function(b,n,i,e){if(n._sleepFrameCount>0)return!1;if(e)return!0;var V=!1,Q=.5*i*i*n.FU;return L.scale(J,b.gravity,Q),B(b.testSolid,n.yB,J,(function(){return V=!0,!0}),!0),V}(b,n,i,V))return;n._sleepFrameCount--,function(b,n){var i=n.yB,e=Math.floor(i.base[0]),V=Math.floor(i.base[2]),Q=Math.floor(i.base[1]),U=Math.floor(i.max[1]);if(!b.testFluid(e,Q,V))return n.inFluid=!1,void(n.ratioInFluid=0);var Y=1,B=Q+1;for(;B<=U&&b.testFluid(e,B,V);)Y++,B++;var mb=(Q+Y-i.base[1])/i.cB[1];mb>1&&(mb=1);var N=i.cB[0]*i.cB[1]*i.cB[2]*mb,Z=j;L.scale(Z,b.gravity,-b.QY*N*n.FU),n.applyForce(Z),n.inFluid=!0,n.ratioInFluid=mb}(b,n),r(n._forces),r(n._impulses),r(n.iB),r(n.resting),L.scale(Z,n._forces,1/n.pi),L.mL(Z,Z,b.gravity,n.FU),L.scale(T,n._impulses,1/n.pi),L.mL(T,T,Z,i),L.add(n.iB,n.iB,T),n.friction&&(a(b,0,n,T,i),a(b,1,n,T,i),a(b,2,n,T,i));var Q=n.fluidDrag>=0?n.fluidDrag:b.fluidDrag,U=n.PB>=0?n.PB:b.PB,Y=U,mb=U;n.inFluid&&(Y=o(n,Y,n.fluidDragHoriz>=0?n.fluidDragHoriz:Q),mb=o(n,mb,n.fluidDragVert>=0?n.fluidDragVert:Q));Y=Math.max(1-Y*i/n.pi,0),mb=Math.max(1-mb*i/n.pi,0),L.set(M,Y,mb,Y),L.multiply(n.iB,n.iB,M),L.scale(z,n.iB,i),L.set(n._forces,0,0,0),L.set(n._impulses,0,0,0),n.bY&&k(y,n.yB);L.k(O,z),L.set(u,0,0,0),n.preventFallOffEdge&&function(b,n,i,e){if(!n.resting[1]||i[1]>0)return;var V=w;k(V,n.yB);for(var Q=0;Q<3;Q+=2){L.set(t,0,0,0),t[Q]=i[Q];var U=!0;(U=(U=(U=(U=U&&!W(b,V.base[0]+t[0]+1e-5,V.base[1],V.base[2]+t[2]+1e-5))&&!W(b,V.max[0]+t[0]-1e-5,V.base[1],V.base[2]+t[2]+1e-5))&&!W(b,V.base[0]+t[0]+1e-5,V.base[1],V.max[2]+t[2]-1e-5))&&!W(b,V.max[0]+t[0]-1e-5,V.base[1],V.max[2]+t[2]-1e-5))?(e[Q]=i[Q]>0?1:-1,i[Q]=0):0===Q&&(L.set(h,i[0],0,0),x(b,V,h,e,n.slideOnCollision))}}(b,n,z,u);x(b,n.yB,z,n.resting,n.slideOnCollision),n.bY&&function(b,n,i,e){if(n.resting[1]>=0&&!n.inFluid)return;var V=0!==n.resting[0],Q=0!==n.resting[2];if(!V&&!Q)return;var U=Math.abs(e[0]/e[2]),Y=4;if(!V&&U>Y)return;if(!Q&&U<1/Y)return;L.add(A,i.base,e);var mb=b.testSolid;B(mb,i,e,(function(b,n,i,e){if(1!==n)return!0;e[n]=0}));var N=i.base[1],Z=n.inFluid?1.951:1.001,T=Math.floor(N+Z)-N;L.set(E,0,T,0);var z=!1;if(B(mb,i,E,(function(b,n,i,e){return z=!0,!0})),z)return;L.un(C,A,i.base),C[1]=0,x(b,i,C,s,!0);var K=R(i.base[0],A[0]),I=R(i.base[2],A[2]);if(V&&!K&&(!I||!Q))return;if(Q&&(!K||!V)&&!I)return;var O=!0;if(O=O&&!W(b,i.base[0]+1e-5,i.base[1],i.base[2]+1e-5),O=O&&!W(b,i.max[0]-1e-5,i.base[1],i.base[2]+1e-5),O=O&&!W(b,i.base[0]+1e-5,i.base[1],i.max[2]-1e-5),O=O&&!W(b,i.max[0]-1e-5,i.base[1],i.max[2]-1e-5),O)return;k(n.yB,i),n.resting[0]=s[0],n.resting[2]=s[2],n.HT&&n.HT()}(b,n,y,O);for(var N=0;N<3;++N)n.resting[N]=n.resting[N]||u[N],K[N]=0,n.resting[N]&&(I[N]||(K[N]=-n.iB[N]),n.iB[N]=0);var d=L.length(K);d>.001&&(L.scale(K,K,n.pi),n.YT&&n.YT(K),n.restitution>0&&d>b.minBounceImpulse&&(L.scale(K,K,n.restitution),n.applyImpulse(K)));var D=L.squaredLength(n.iB);D>1e-5&&n.QB();b.AZ&&b.AZ(n)?(n.loadFromCopy(G),n.rolledBackLastTick=!0):n.rolledBackLastTick=!1}(this,i,b,n)))};var M=L.create([0,0,0]);var j=L.create();function a(b,n,i,e,V){var Q=i.resting[n],U=e[n];if(!i.alwaysApplyHorizFriction||1!==n){if(0===Q)return;if(Q*U<=0)return}L.k(D,i.iB),D[n]=0;var Y=L.length(D);if(!R(Y,0)){var B=Math.abs(i.friction*b.gravity[n]*V),mb=Y>B?(Y-B)/Y:0;i.iB[(n+1)%3]*=mb,i.iB[(n+2)%3]*=mb}}var D=L.create();function x(b,n,i,e,V){return L.set(e,0,0,0),B(b.testSolid,n,i,(function(b,n,i,Q){e[n]=i,Q[n]=0,V||(Q[0]=0,Q[1]=0,Q[2]=0)}))}var y=new Y([],[]),s=L.create(),A=L.create(),E=L.create(),C=L.create();var t=L.create(),w=new Y([],[]),h=L.create();function W(b,n,i,e){return b.testSolid(Math.floor(n),Math.floor(i-1),Math.floor(e))}var J=L.create();function R(b,n){return Math.abs(b-n)<1e-5}function k(b,n){for(var i=0;i<3;i++)b.base[i]=n.base[i],b.max[i]=n.max[i],b.cB[i]=n.cB[i]}var r=function(b){}},12473:function(b,n){!function(b){"use strict";var n=function(b,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,n){b.__proto__=n}||function(b,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(b[i]=n[i])},n(b,i)};function i(b,i){if("function"!==typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=b}n(b,i),b.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}function e(b,n,i,e){var V,Q=arguments.length,U=Q<3?n:null===e?e=Object.getOwnPropertyDescriptor(n,i):e;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)U=Reflect.decorate(b,n,i,e);else for(var Y=b.length-1;Y>=0;Y--)(V=b[Y])&&(U=(Q<3?V(U):Q>3?V(n,i,U):V(n,i))||U);return Q>3&&U&&Object.defineProperty(n,i,U),U}function V(b,n,i){if(i||2===arguments.length)for(var e,V=0,Q=n.length;V<Q;V++)!e&&V in n||(e||(e=Array.prototype.slice.call(n,0,V)),e[V]=n[V]);return b.concat(e||Array.prototype.slice.call(n))}var Q,U=255,Y=213;b.OPERATION=void 0,(Q=b.OPERATION||(b.OPERATION={}))[Q.ADD=128]="ADD",Q[Q.REPLACE=0]="REPLACE",Q[Q.DELETE=64]="DELETE",Q[Q.DELETE_AND_ADD=192]="DELETE_AND_ADD",Q[Q.TOUCH=1]="TOUCH",Q[Q.CLEAR=10]="CLEAR";var L=function(){function n(b,n,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=b,this.setParent(n,i)}return n.prototype.setParent=function(b,n,i){var e=this;if(this.indexes||(this.indexes=this.ref instanceof Cb?this.ref._definition.indexes:{}),this.parent=b,this.parentIndex=i,n)if(this.root=n,this.ref instanceof Cb){var V=this.ref._definition;for(var Q in V.schema){var U=this.ref[Q];if(U&&U.$changes){var Y=V.indexes[Q];U.$changes.setParent(this.ref,n,Y)}}}else"object"===typeof this.ref&&this.ref.forEach((function(b,n){if(b instanceof Cb){var i=b.$changes,V=e.ref.$changes.indexes[n];i.setParent(e.ref,e.root,V)}}))},n.prototype.operation=function(b){this.changes.set(--this.currentCustomOperation,b)},n.prototype.change=function(n,i){void 0===i&&(i=b.OPERATION.ADD);var e="number"===typeof n?n:this.indexes[n];this.assertValidIndex(e,n);var V=this.changes.get(e);V&&V.op!==b.OPERATION.DELETE&&V.op!==b.OPERATION.TOUCH||this.changes.set(e,{op:V&&V.op===b.OPERATION.DELETE?b.OPERATION.DELETE_AND_ADD:i,index:e}),this.allChanges.add(e),this.changed=!0,this.touchParents()},n.prototype.touch=function(n){var i="number"===typeof n?n:this.indexes[n];this.assertValidIndex(i,n),this.changes.has(i)||this.changes.set(i,{op:b.OPERATION.TOUCH,index:i}),this.allChanges.add(i),this.touchParents()},n.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},n.prototype.getType=function(b){if(this.ref._definition)return(n=this.ref._definition).schema[n.fieldsByIndex[b]];var n,i=(n=this.parent._definition).schema[n.fieldsByIndex[this.parentIndex]];return Object.values(i)[0]},n.prototype.getChildrenFilter=function(){var b=this.parent._definition.childFilters;return b&&b[this.parentIndex]},n.prototype.getValue=function(b){return this.ref.getByIndex(b)},n.prototype.delete=function(n){var i="number"===typeof n?n:this.indexes[n];if(void 0!==i){var e=this.getValue(i);this.changes.set(i,{op:b.OPERATION.DELETE,index:i}),this.allChanges.delete(i),delete this.caches[i],e&&e.$changes&&(e.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(n," (").concat(i,")"))},n.prototype.discard=function(n,i){var e=this;void 0===n&&(n=!1),void 0===i&&(i=!1),this.ref instanceof Cb||this.changes.forEach((function(n){if(n.op===b.OPERATION.DELETE){var i=e.ref.getIndex(n.index);delete e.indexes[i]}})),this.changes.clear(),this.changed=n,i&&this.allChanges.clear(),this.currentCustomOperation=0},n.prototype.discardAll=function(){var b=this;this.changes.forEach((function(n){var i=b.getValue(n.index);i&&i.$changes&&i.$changes.discardAll()})),this.discard()},n.prototype.cache=function(b,n){this.caches[b]=n},n.prototype.clone=function(){return new n(this.ref,this.parent,this.root)},n.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},n.prototype.assertValidIndex=function(b,n){if(void 0===b)throw new Error('ChangeTree: missing index for field "'.concat(n,'"'))},n}();function B(b,n,i,e){return b[n]||(b[n]=[]),b[n].push(i),null===e||void 0===e||e.forEach((function(b,n){return i(b,n)})),function(){return N(b[n],b[n].indexOf(i))}}function mb(n){var i=this,e="string"!==typeof this.$changes.getType();this.$items.forEach((function(V,Q){n.push({refId:i.$changes.refId,op:b.OPERATION.DELETE,field:Q,value:void 0,previousValue:V}),e&&i.$changes.root.removeRef(V.$changes.refId)}))}function N(b,n){if(-1===n||n>=b.length)return!1;for(var i=b.length-1,e=n;e<i;e++)b[e]=b[e+1];return b.length=i,!0}var Z=function(b,n){var i=b.toString(),e=n.toString();return i<e?-1:i>e?1:0};function T(b){return b.$proxy=!0,b=new Proxy(b,{get:function(b,n){return"symbol"===typeof n||isNaN(n)?b[n]:b.at(n)},set:function(b,n,i){if("symbol"===typeof n||isNaN(n))b[n]=i;else{var e=Array.from(b.$items.keys()),V=parseInt(e[n]||n);void 0===i||null===i?b.deleteAt(V):b.setAt(V,i)}return!0},deleteProperty:function(b,n){return"number"===typeof n?b.deleteAt(n):delete b[n],!0}})}var z=function(){function n(){for(var b=[],n=0;n<arguments.length;n++)b[n]=arguments[n];this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,b)}return n.prototype.yY=function(n,i){return void 0===i&&(i=!0),B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,n,i?this.$items:void 0)},n.prototype.ln=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,n)},n.prototype.onChange=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,n)},n.is=function(b){return Array.isArray(b)||void 0!==b.array},Object.defineProperty(n.prototype,"length",{get:function(){return this.$items.size},set:function(b){0===b?this.clear():this.splice(b,this.length-b)},enumerable:!1,configurable:!0}),n.prototype.push=function(){for(var b,n=this,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return i.forEach((function(i){b=n.$refId++,n.setAt(b,i)})),b},n.prototype.pop=function(){var b=Array.from(this.$indexes.values()).pop();if(void 0!==b){this.$changes.delete(b),this.$indexes.delete(b);var n=this.$items.get(b);return this.$items.delete(b),n}},n.prototype.at=function(b){var n=Array.from(this.$items.keys())[b];return this.$items.get(n)},n.prototype.setAt=function(n,i){var e,V;if(void 0!==i&&null!==i){if(this.$items.get(n)!==i){void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,n);var Q=null!==(V=null===(e=this.$changes.indexes[n])||void 0===e?void 0:e.op)&&void 0!==V?V:b.OPERATION.ADD;this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,i),this.$changes.change(n,Q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},n.prototype.deleteAt=function(b){var n=Array.from(this.$items.keys())[b];return void 0!==n&&this.$deleteAt(n)},n.prototype.$deleteAt=function(b){return this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b)},n.prototype.clear=function(n){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),n&&mb.call(this,n),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.concat=function(){for(var b,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return new(n.bind.apply(n,V([void 0],(b=Array.from(this.$items.values())).concat.apply(b,i),!1)))},n.prototype.join=function(b){return Array.from(this.$items.values()).join(b)},n.prototype.reverse=function(){var b=this,n=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(i,e){b.setAt(n[e],i)})),this},n.prototype.shift=function(){var b=Array.from(this.$items.keys()).shift();if(void 0!==b){var n=this.$items.get(b);return this.$deleteAt(b),n}},n.prototype.slice=function(b,i){var e=new n;return e.push.apply(e,Array.from(this.$items.values()).slice(b,i)),e},n.prototype.sort=function(b){var n=this;void 0===b&&(b=Z);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(b).forEach((function(b,e){n.setAt(i[e],b)})),this},n.prototype.splice=function(b,n){void 0===n&&(n=this.length-b);for(var i=Array.from(this.$items.keys()),e=[],V=b;V<b+n;V++)e.push(this.$items.get(i[V])),this.$deleteAt(i[V]);return e},n.prototype.unshift=function(){for(var b=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var e=this.length,V=n.length,Q=Array.from(this.$items.values());return n.forEach((function(n,i){b.setAt(i,n)})),Q.forEach((function(n,i){b.setAt(V+i,n)})),e+V},n.prototype.indexOf=function(b,n){return Array.from(this.$items.values()).indexOf(b,n)},n.prototype.lastIndexOf=function(b,n){return void 0===n&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(b,n)},n.prototype.every=function(b,n){return Array.from(this.$items.values()).every(b,n)},n.prototype.some=function(b,n){return Array.from(this.$items.values()).some(b,n)},n.prototype.forEach=function(b,n){Array.from(this.$items.values()).forEach(b,n)},n.prototype.map=function(b,n){return Array.from(this.$items.values()).map(b,n)},n.prototype.filter=function(b,n){return Array.from(this.$items.values()).filter(b,n)},n.prototype.reduce=function(b,n){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},n.prototype.reduceRight=function(b,n){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},n.prototype.find=function(b,n){return Array.from(this.$items.values()).find(b,n)},n.prototype.findIndex=function(b,n){return Array.from(this.$items.values()).findIndex(b,n)},n.prototype.fill=function(b,n,i){throw new Error("ArraySchema#fill() not implemented")},n.prototype.copyWithin=function(b,n,i){throw new Error("ArraySchema#copyWithin() not implemented")},n.prototype.toString=function(){return this.$items.toString()},n.prototype.toLocaleString=function(){return this.$items.toLocaleString()},n.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(n,Symbol.species,{get:function(){return n},enumerable:!1,configurable:!0}),n.prototype.entries=function(){return this.$items.entries()},n.prototype.keys=function(){return this.$items.keys()},n.prototype.values=function(){return this.$items.values()},n.prototype.includes=function(b,n){return Array.from(this.$items.values()).includes(b,n)},n.prototype.flatMap=function(b,n){throw new Error("ArraySchema#flatMap() is not supported.")},n.prototype.flat=function(b){throw new Error("ArraySchema#flat() is not supported.")},n.prototype.findLast=function(){var b=Array.from(this.$items.values());return b.findLast.apply(b,arguments)},n.prototype.findLastIndex=function(){var b=Array.from(this.$items.values());return b.findLastIndex.apply(b,arguments)},n.prototype.setIndex=function(b,n){this.$indexes.set(b,n)},n.prototype.getIndex=function(b){return this.$indexes.get(b)},n.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},n.prototype.deleteByIndex=function(b){var n=this.$indexes.get(b);this.$items.delete(n),this.$indexes.delete(b)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){return this.toArray().map((function(b){return"function"===typeof b.toJSON?b.toJSON():b}))},n.prototype.clone=function(b){return b?new(n.bind.apply(n,V([void 0],Array.from(this.$items.values()),!1))):new(n.bind.apply(n,V([void 0],this.map((function(b){return b.$changes?b.clone():b})),!1)))},n}();function K(b){return b.$proxy=!0,b=new Proxy(b,{get:function(b,n){return"symbol"!==typeof n&&"undefined"===typeof b[n]?b.get(n):b[n]},set:function(b,n,i){return"symbol"!==typeof n&&-1===n.indexOf("$")&&"yY"!==n&&"ln"!==n&&"onChange"!==n?b.set(n,i):b[n]=i,!0},deleteProperty:function(b,n){return b.delete(n),!0}})}var I=function(){function n(b){var i=this;if(this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b)if(b instanceof Map||b instanceof n)b.forEach((function(b,n){return i.set(n,b)}));else for(var e in b)this.set(e,b[e])}return n.prototype.yY=function(n,i){return void 0===i&&(i=!0),B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,n,i?this.$items:void 0)},n.prototype.ln=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,n)},n.prototype.onChange=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,n)},n.is=function(b){return void 0!==b.map},n.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(n,Symbol.species,{get:function(){return n},enumerable:!1,configurable:!0}),n.prototype.set=function(n,i){if(void 0===i||null===i)throw new Error("MapSchema#set('".concat(n,"', ").concat(i,"): trying to set ").concat(i," value on '").concat(n,"'."));n=n.toString();var e="undefined"!==typeof this.$changes.indexes[n],V=e?this.$changes.indexes[n]:this.$refId++,Q=e?b.OPERATION.REPLACE:b.OPERATION.ADD,U=void 0!==i.$changes;if(U&&i.$changes.setParent(this,this.$changes.root,V),e){if(!U&&this.$items.get(n)===i)return;U&&this.$items.get(n)!==i&&(Q=b.OPERATION.ADD)}else this.$changes.indexes[n]=V,this.$indexes.set(V,n);return this.$items.set(n,i),this.$changes.change(n,Q),this},n.prototype.get=function(b){return this.$items.get(b)},n.prototype.delete=function(b){return this.$changes.delete(b),this.$items.delete(b)},n.prototype.clear=function(n){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),n&&mb.call(this,n),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(b){return this.$items.has(b)},n.prototype.forEach=function(b){this.$items.forEach(b)},n.prototype.entries=function(){return this.$items.entries()},n.prototype.keys=function(){return this.$items.keys()},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(b,n){this.$indexes.set(b,n)},n.prototype.getIndex=function(b){return this.$indexes.get(b)},n.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},n.prototype.deleteByIndex=function(b){var n=this.$indexes.get(b);this.$items.delete(n),this.$indexes.delete(b)},n.prototype.toJSON=function(){var b={};return this.forEach((function(n,i){b[i]="function"===typeof n.toJSON?n.toJSON():n})),b},n.prototype.clone=function(b){var i;return b?i=Object.assign(new n,this):(i=new n,this.forEach((function(b,n){b.$changes?i.set(n,b.clone()):i.set(n,b)}))),i},n}(),O={};function u(b,n){O[b]=n}function d(b){return O[b]}var G=function(){function b(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return b.create=function(n){var i=new b;return i.schema=Object.assign({},n&&n.schema||{}),i.indexes=Object.assign({},n&&n.indexes||{}),i.fieldsByIndex=Object.assign({},n&&n.fieldsByIndex||{}),i.descriptors=Object.assign({},n&&n.descriptors||{}),i.deprecated=Object.assign({},n&&n.deprecated||{}),i},b.prototype.addField=function(b,n){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=b,this.indexes[b]=i,this.schema[b]=Array.isArray(n)?{array:n[0]}:n},b.prototype.hasField=function(b){return void 0!==this.indexes[b]},b.prototype.addFilter=function(b,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[b]]=n,this.indexesWithFilters.push(this.indexes[b]),!0},b.prototype.addChildrenFilter=function(b,n){var i=this.indexes[b],e=this.schema[b];if(d(Object.keys(e)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=n,!0;console.warn("@filterChildren: field '".concat(b,"' can't have children. Ignoring filter."))},b.prototype.getChildrenFilter=function(b){return this.childFilters&&this.childFilters[this.indexes[b]]},b.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},b}();function o(b){return b._context&&b._context.useFilters}var M=function(){function b(){this.types={},this.schemas=new Map,this.useFilters=!1}return b.prototype.has=function(b){return this.schemas.has(b)},b.prototype.get=function(b){return this.types[b]},b.prototype.add=function(b,n){void 0===n&&(n=this.schemas.size),b._definition=G.create(b._definition),b._typeid=n,this.types[n]=b,this.schemas.set(b,n)},b.create=function(n){return void 0===n&&(n={}),function(i){return n.context||(n.context=new b),a(i,n)}},b}(),j=new M;function a(b,n){return void 0===n&&(n={}),function(i,e){var Q=n.context||j,U=i.constructor;if(U._context=Q,!b)throw new Error("".concat(U.name,': @type() reference provided for "').concat(e,"\" is undefined. Make sure you don't have any circular dependencies."));Q.has(U)||Q.add(U);var Y=U._definition;if(Y.addField(e,b),Y.descriptors[e]){if(Y.deprecated[e])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(e,"' definition on '").concat(U.name,"'.\nCheck @type() annotation"))}catch(O){var L=O.stack.split("\n")[4].trim();throw new Error("".concat(O.message," ").concat(L))}}var B=z.is(b),mb=!B&&I.is(b);if("string"!==typeof b&&!Cb.is(b)){var N=Object.values(b)[0];"string"===typeof N||Q.has(N)||Q.add(N)}if(n.manual)Y.descriptors[e]={enumerable:!0,configurable:!0,writable:!0};else{var Z="_".concat(e);Y.descriptors[Z]={enumerable:!1,configurable:!1,writable:!0},Y.descriptors[e]={get:function(){return this[Z]},set:function(b){b!==this[Z]&&(void 0!==b&&null!==b?(!B||b instanceof z||(b=new(z.bind.apply(z,V([void 0],b,!1)))),!mb||b instanceof I||(b=new I(b)),void 0===b.$proxy&&(mb?b=K(b):B&&(b=T(b))),this.$changes.change(e),b.$changes&&b.$changes.setParent(this,this.$changes.root,this._definition.indexes[e])):this[Z]&&this.$changes.delete(e),this[Z]=b)},enumerable:!0,configurable:!0}}}}function D(b){return function(n,i){var e=n.constructor;e._definition.addFilter(i,b)&&(e._context.useFilters=!0)}}function x(b){return function(n,i){var e=n.constructor;e._definition.addChildrenFilter(i,b)&&(e._context.useFilters=!0)}}function y(b){return void 0===b&&(b=!0),function(n,i){var e=n.constructor._definition;e.deprecated[i]=!0,b&&(e.descriptors[i]={get:function(){throw new Error("".concat(i," is deprecated."))},set:function(b){},enumerable:!1,configurable:!0})}}function s(b,n,i){for(var e in void 0===i&&(i={}),i.context||(i.context=b._context||i.context||j),n)a(n[e],i)(b.prototype,e);return b}function A(b){for(var n=0,i=0,e=0,V=b.length;e<V;e++)(n=b.charCodeAt(e))<128?i+=1:n<2048?i+=2:n<55296||n>=57344?i+=3:(e++,i+=4);return i}function E(b,n,i){for(var e=0,V=0,Q=i.length;V<Q;V++)(e=i.charCodeAt(V))<128?b[n++]=e:e<2048?(b[n++]=192|e>>6,b[n++]=128|63&e):e<55296||e>=57344?(b[n++]=224|e>>12,b[n++]=128|e>>6&63,b[n++]=128|63&e):(V++,e=65536+((1023&e)<<10|1023&i.charCodeAt(V)),b[n++]=240|e>>18,b[n++]=128|e>>12&63,b[n++]=128|e>>6&63,b[n++]=128|63&e)}function C(b,n){b.push(255&n)}function t(b,n){b.push(255&n)}function w(b,n){b.push(255&n),b.push(n>>8&255)}function h(b,n){b.push(255&n),b.push(n>>8&255)}function W(b,n){b.push(255&n),b.push(n>>8&255),b.push(n>>16&255),b.push(n>>24&255)}function J(b,n){var i=n>>24,e=n>>16,V=n>>8,Q=n;b.push(255&Q),b.push(255&V),b.push(255&e),b.push(255&i)}function R(b,n){var i=Math.floor(n/Math.pow(2,32));J(b,n>>>0),J(b,i)}function k(b,n){var i=n/Math.pow(2,32)|0;J(b,n>>>0),J(b,i)}function r(b,n){q(b,n)}function X(b,n){S(b,n)}var g=new Int32Array(2),P=new Float32Array(g.buffer),c=new Float64Array(g.buffer);function q(b,n){P[0]=n,W(b,g[0])}function S(b,n){c[0]=n,W(b,g[0]),W(b,g[1])}function H(b,n){return t(b,n?1:0)}function l(b,n){n||(n="");var i=A(n),e=0;if(i<32)b.push(160|i),e=1;else if(i<256)b.push(217),t(b,i),e=2;else if(i<65536)b.push(218),h(b,i),e=3;else{if(!(i<4294967296))throw new Error("String too long");b.push(219),J(b,i),e=5}return E(b,b.length,n),e+i}function v(b,n){return isNaN(n)?v(b,0):isFinite(n)?n!==(0|n)?(b.push(203),S(b,n),9):n>=0?n<128?(t(b,n),1):n<256?(b.push(204),t(b,n),2):n<65536?(b.push(205),h(b,n),3):n<4294967296?(b.push(206),J(b,n),5):(b.push(207),k(b,n),9):n>=-32?(b.push(224|n+32),1):n>=-128?(b.push(208),C(b,n),2):n>=-32768?(b.push(209),w(b,n),3):n>=-2147483648?(b.push(210),W(b,n),5):(b.push(211),R(b,n),9):v(b,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:E,int8:C,uint8:t,int16:w,uint16:h,int32:W,uint32:J,int64:R,uint64:k,float32:r,float64:X,writeFloat32:q,writeFloat64:S,boolean:H,string:l,number:v});function f(b,n,i){for(var e="",V=0,Q=n,U=n+i;Q<U;Q++){var Y=b[Q];0!==(128&Y)?192!==(224&Y)?224!==(240&Y)?240!==(248&Y)?console.error("Invalid byte "+Y.toString(16)):(V=(7&Y)<<18|(63&b[++Q])<<12|(63&b[++Q])<<6|63&b[++Q])>=65536?(V-=65536,e+=String.fromCharCode(55296+(V>>>10),56320+(1023&V))):e+=String.fromCharCode(V):e+=String.fromCharCode((15&Y)<<12|(63&b[++Q])<<6|63&b[++Q]):e+=String.fromCharCode((31&Y)<<6|63&b[++Q]):e+=String.fromCharCode(Y)}return e}function F(b,n){return bb(b,n)<<24>>24}function bb(b,n){return b[n.offset++]}function nb(b,n){return ib(b,n)<<16>>16}function ib(b,n){return b[n.offset++]|b[n.offset++]<<8}function eb(b,n){return b[n.offset++]|b[n.offset++]<<8|b[n.offset++]<<16|b[n.offset++]<<24}function Vb(b,n){return eb(b,n)>>>0}function Qb(b,n){return Zb(b,n)}function Ub(b,n){return Tb(b,n)}function Yb(b,n){var i=Vb(b,n);return eb(b,n)*Math.pow(2,32)+i}function Lb(b,n){var i=Vb(b,n);return Vb(b,n)*Math.pow(2,32)+i}var Bb=new Int32Array(2),mn=new Float32Array(Bb.buffer),Nb=new Float64Array(Bb.buffer);function Zb(b,n){return Bb[0]=eb(b,n),mn[0]}function Tb(b,n){return Bb[0]=eb(b,n),Bb[1]=eb(b,n),Nb[0]}function zb(b,n){return bb(b,n)>0}function Kb(b,n){var i,e=b[n.offset++];e<192?i=31&e:217===e?i=bb(b,n):218===e?i=ib(b,n):219===e&&(i=Vb(b,n));var V=f(b,n.offset,i);return n.offset+=i,V}function Ib(b,n){var i=b[n.offset];return i<192&&i>160||217===i||218===i||219===i}function Ob(b,n){var i=b[n.offset++];return i<128?i:202===i?Zb(b,n):203===i?Tb(b,n):204===i?bb(b,n):205===i?ib(b,n):206===i?Vb(b,n):207===i?Lb(b,n):208===i?F(b,n):209===i?nb(b,n):210===i?eb(b,n):211===i?Yb(b,n):i>223?-1*(255-i+1):void 0}function ub(b,n){var i=b[n.offset];return i<128||i>=202&&i<=211}function db(b,n){return b[n.offset]<160}function Gb(b,n){return b[n.offset-1]===U&&(b[n.offset]<128||b[n.offset]>=202&&b[n.offset]<=211)}var ob=Object.freeze({__proto__:null,int8:F,uint8:bb,int16:nb,uint16:ib,int32:eb,uint32:Vb,float32:Qb,float64:Ub,int64:Yb,uint64:Lb,readFloat32:Zb,readFloat64:Tb,boolean:zb,string:Kb,stringCheck:Ib,number:Ob,numberCheck:ub,arrayCheck:db,switchStructureCheck:Gb}),Mb=function(){function n(b){var n=this;this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b&&b.forEach((function(b){return n.add(b)}))}return n.prototype.yY=function(n,i){return void 0===i&&(i=!0),B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,n,i?this.$items:void 0)},n.prototype.ln=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,n)},n.prototype.onChange=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,n)},n.is=function(b){return void 0!==b.collection},n.prototype.add=function(b){var n=this.$refId++;return void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,b),this.$changes.change(n),n},n.prototype.at=function(b){var n=Array.from(this.$items.keys())[b];return this.$items.get(n)},n.prototype.entries=function(){return this.$items.entries()},n.prototype.delete=function(b){for(var n,i,e=this.$items.entries();(i=e.next())&&!i.done;)if(b===i.value[1]){n=i.value[0];break}return void 0!==n&&(this.$changes.delete(n),this.$indexes.delete(n),this.$items.delete(n))},n.prototype.clear=function(n){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),n&&mb.call(this,n),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(b){return Array.from(this.$items.values()).some((function(n){return n===b}))},n.prototype.forEach=function(b){var n=this;this.$items.forEach((function(i,e,V){return b(i,e,n)}))},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(b,n){this.$indexes.set(b,n)},n.prototype.getIndex=function(b){return this.$indexes.get(b)},n.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},n.prototype.deleteByIndex=function(b){var n=this.$indexes.get(b);this.$items.delete(n),this.$indexes.delete(b)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){var b=[];return this.forEach((function(n,i){b.push("function"===typeof n.toJSON?n.toJSON():n)})),b},n.prototype.clone=function(b){var i;return b?i=Object.assign(new n,this):(i=new n,this.forEach((function(b){b.$changes?i.add(b.clone()):i.add(b)}))),i},n}(),jb=function(){function n(b){var n=this;this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b&&b.forEach((function(b){return n.add(b)}))}return n.prototype.yY=function(n,i){return void 0===i&&(i=!0),B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,n,i?this.$items:void 0)},n.prototype.ln=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,n)},n.prototype.onChange=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,n)},n.is=function(b){return void 0!==b.set},n.prototype.add=function(n){var i,e;if(this.has(n))return!1;var V=this.$refId++;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,V);var Q=null!==(e=null===(i=this.$changes.indexes[V])||void 0===i?void 0:i.op)&&void 0!==e?e:b.OPERATION.ADD;return this.$changes.indexes[V]=V,this.$indexes.set(V,V),this.$items.set(V,n),this.$changes.change(V,Q),V},n.prototype.entries=function(){return this.$items.entries()},n.prototype.delete=function(b){for(var n,i,e=this.$items.entries();(i=e.next())&&!i.done;)if(b===i.value[1]){n=i.value[0];break}return void 0!==n&&(this.$changes.delete(n),this.$indexes.delete(n),this.$items.delete(n))},n.prototype.clear=function(n){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),n&&mb.call(this,n),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(b){for(var n,i=this.$items.values(),e=!1;(n=i.next())&&!n.done;)if(b===n.value){e=!0;break}return e},n.prototype.forEach=function(b){var n=this;this.$items.forEach((function(i,e,V){return b(i,e,n)}))},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(b,n){this.$indexes.set(b,n)},n.prototype.getIndex=function(b){return this.$indexes.get(b)},n.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},n.prototype.deleteByIndex=function(b){var n=this.$indexes.get(b);this.$items.delete(n),this.$indexes.delete(b)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){var b=[];return this.forEach((function(n,i){b.push("function"===typeof n.toJSON?n.toJSON():n)})),b},n.prototype.clone=function(b){var i;return b?i=Object.assign(new n,this):(i=new n,this.forEach((function(b){b.$changes?i.add(b.clone()):i.add(b)}))),i},n}(),ab=function(){function b(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return b.prototype.addRefId=function(b){this.refIds.has(b)||(this.refIds.add(b),this.containerIndexes.set(b,new Set))},b.get=function(n){return void 0===n.$filterState&&(n.$filterState=new b),n.$filterState},b}(),Db=function(){function b(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return b.prototype.getNextUniqueId=function(){return this.nextUniqueId++},b.prototype.addRef=function(b,n,i){void 0===i&&(i=!0),this.refs.set(b,n),i&&(this.refCounts[b]=(this.refCounts[b]||0)+1)},b.prototype.removeRef=function(b){this.refCounts[b]=this.refCounts[b]-1,this.deletedRefs.add(b)},b.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},b.prototype.garbageCollectDeletedRefs=function(){var b=this;this.deletedRefs.forEach((function(n){if(!(b.refCounts[n]>0)){var i=b.refs.get(n);if(i instanceof Cb)for(var e in i._definition.schema)"string"!==typeof i._definition.schema[e]&&i[e]&&i[e].$changes&&b.removeRef(i[e].$changes.refId);else{var V=i.$changes.parent._definition,Q=V.schema[V.fieldsByIndex[i.$changes.parentIndex]];"function"===typeof Object.values(Q)[0]&&Array.from(i.values()).forEach((function(n){return b.removeRef(n.$changes.refId)}))}b.refs.delete(n),delete b.refCounts[n]}})),this.deletedRefs.clear()},b}(),xb=function(b){function n(){return null!==b&&b.apply(this,arguments)||this}return i(n,b),n}(Error);function yb(b,n,i,e){var V,Q=!1;switch(n){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":V="number",isNaN(b)&&console.log('trying to encode "NaN" in '.concat(i.constructor.name,"#").concat(e));break;case"string":V="string",Q=!0;break;case"boolean":return}if(typeof b!==V&&(!Q||Q&&null!==b)){var U="'".concat(JSON.stringify(b),"'").concat(b&&b.constructor&&" (".concat(b.constructor.name,")")||"");throw new xb("a '".concat(V,"' was expected, but ").concat(U," was provided in ").concat(i.constructor.name,"#").concat(e))}}function sb(b,n,i,e){if(!(b instanceof n))throw new xb("a '".concat(n.name,"' was expected, but '").concat(b.constructor.name,"' was provided in ").concat(i.constructor.name,"#").concat(e))}function Ab(b,n,i,e,V){yb(i,b,e,V);var Q=p[b];if(!Q)throw new xb("a '".concat(b,"' was expected, but ").concat(i," was provided in ").concat(e.constructor.name,"#").concat(V));Q(n,i)}function Eb(b,n,i){return ob[b](n,i)}var Cb=function(){function n(){for(var b=[],n=0;n<arguments.length;n++)b[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new L(this,void 0,new Db),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),b[0]&&this.assign(b[0])}return n.onError=function(b){console.error(b)},n.is=function(b){return b._definition&&void 0!==b._definition.schema},n.prototype.onChange=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,n)},n.prototype.ln=function(n){return B(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,n)},n.prototype.assign=function(b){return Object.assign(this,b),this},Object.defineProperty(n.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),n.prototype.setDirty=function(b,n){this.$changes.change(b,n)},n.prototype.listen=function(b,n,i){var e=this;return void 0===i&&(i=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[b]||(this.$callbacks[b]=[]),this.$callbacks[b].push(n),i&&void 0!==this[b]&&n(this[b],void 0),function(){return N(e.$callbacks[b],e.$callbacks[b].indexOf(n))}},n.prototype.decode=function(i,e,V){var Q;void 0===e&&(e={offset:0}),void 0===V&&(V=this);var Y=[],L=this.$changes.root,B=i.length,mb=0;for(L.refs.set(mb,this);e.offset<B;){var N=i[e.offset++];if(N!=U){var Z=V.$changes,T=void 0!==V._definition,K=T?N>>6<<6:N;if(K!==b.OPERATION.CLEAR){var O=T?N%(K||255):Ob(i,e),u=T?V._definition.fieldsByIndex[O]:"",G=Z.getType(O),o=void 0,M=void 0,j=void 0;if(T?M=V["_".concat(u)]:(M=V.getByIndex(O),(K&b.OPERATION.ADD)===b.OPERATION.ADD?(j=V instanceof I?Kb(i,e):O,V.setIndex(O,j)):j=V.getIndex(O)),(K&b.OPERATION.DELETE)===b.OPERATION.DELETE&&(K!==b.OPERATION.DELETE_AND_ADD&&V.deleteByIndex(O),M&&M.$changes&&L.removeRef(M.$changes.refId),o=null),void 0!==u){if(K===b.OPERATION.DELETE);else if(n.is(G)){var a=Ob(i,e);if(o=L.refs.get(a),K!==b.OPERATION.REPLACE){var D=this.getSchemaType(i,e,G);o||((o=this.createTypeInstance(D)).$changes.refId=a,M&&(o.$callbacks=M.$callbacks,M.$changes.refId&&a!==M.$changes.refId&&L.removeRef(M.$changes.refId))),L.addRef(a,o,o!==M)}}else if("string"===typeof G)o=Eb(G,i,e);else{var x=d(Object.keys(G)[0]),y=Ob(i,e),s=L.refs.has(y)?M||L.refs.get(y):new x.constructor;if((o=s.clone(!0)).$changes.refId=y,M&&(o.$callbacks=M.$callbacks,M.$changes.refId&&y!==M.$changes.refId)){L.removeRef(M.$changes.refId);for(var A=M.entries(),E=void 0;(E=A.next())&&!E.done;){var C=(Q=E.value)[0],t=Q[1];Y.push({refId:y,op:b.OPERATION.DELETE,field:C,value:void 0,previousValue:t})}}L.addRef(y,o,s!==M)}if(null!==o&&void 0!==o)if(o.$changes&&o.$changes.setParent(Z.ref,Z.root,O),V instanceof n)V[u]=o;else if(V instanceof I)C=j,V.$items.set(C,o),V.$changes.allChanges.add(O);else if(V instanceof z)V.setAt(O,o);else if(V instanceof Mb){var w=V.add(o);V.setIndex(O,w)}else V instanceof jb&&!1!==(w=V.add(o))&&V.setIndex(O,w);M!==o&&Y.push({refId:mb,op:K,field:u,dynamicIndex:j,value:o,previousValue:M})}else{console.warn("@colyseus/schema: definition mismatch");for(var h={offset:e.offset};e.offset<B&&(!Gb(i,e)||(h.offset=e.offset+1,!L.refs.has(Ob(i,h))));)e.offset++}}else V.clear(Y)}else{mb=Ob(i,e);var W=L.refs.get(mb);if(!W)throw new Error('"refId" not found: '.concat(mb));V=W}}return this._triggerChanges(Y),L.garbageCollectDeletedRefs(),Y},n.prototype.encode=function(i,e,V){void 0===i&&(i=!1),void 0===e&&(e=[]),void 0===V&&(V=!1);for(var Q=this.$changes,Y=new WeakSet,L=[Q],B=1,mb=0;mb<B;mb++){var N=L[mb],Z=N.ref,T=Z instanceof n;N.ensureRefId(),Y.add(N),N!==Q&&(N.changed||i)&&(t(e,U),v(e,N.refId));for(var z=i?Array.from(N.allChanges):Array.from(N.changes.values()),K=0,O=z.length;K<O;K++){var u=i?{op:b.OPERATION.ADD,index:z[K]}:z[K],G=u.index,o=T?Z._definition.fieldsByIndex&&Z._definition.fieldsByIndex[G]:G,M=e.length;if(u.op!==b.OPERATION.TOUCH)if(T)t(e,G|u.op);else{if(t(e,u.op),u.op===b.OPERATION.CLEAR)continue;v(e,G)}if(T||(u.op&b.OPERATION.ADD)!=b.OPERATION.ADD||Z instanceof I&&l(e,N.ref.$indexes.get(G)),u.op!==b.OPERATION.DELETE){var j=N.getType(G),a=N.getValue(G);if(a&&a.$changes&&!Y.has(a.$changes)&&(L.push(a.$changes),a.$changes.ensureRefId(),B++),u.op!==b.OPERATION.TOUCH){if(n.is(j))sb(a,j,Z,o),v(e,a.$changes.refId),(u.op&b.OPERATION.ADD)===b.OPERATION.ADD&&this.tryEncodeTypeId(e,j,a.constructor);else if("string"===typeof j)Ab(j,e,a,Z,o);else{var D=d(Object.keys(j)[0]);sb(Z["_".concat(o)],D.constructor,Z,o),v(e,a.$changes.refId)}V&&N.cache(G,e.slice(M))}}}i||V||N.discard()}return e},n.prototype.encodeAll=function(b){return this.encode(!0,[],b)},n.prototype.applyFilters=function(i,e){var V,Q;void 0===e&&(e=!1);for(var Y=this,L=new Set,B=ab.get(i),mb=[this.$changes],N=1,Z=[],T=function(T){var z=mb[T];if(L.has(z.refId))return"continue";var K=z.ref,O=K instanceof n;t(Z,U),v(Z,z.refId);var u=B.refIds.has(z),d=e||!u;B.addRefId(z);var G=B.containerIndexes.get(z),o=d?Array.from(z.allChanges):Array.from(z.changes.values());!e&&O&&K._definition.indexesWithFilters&&K._definition.indexesWithFilters.forEach((function(n){!G.has(n)&&z.allChanges.has(n)&&(d?o.push(n):o.push({op:b.OPERATION.ADD,index:n}))}));for(var M=0,j=o.length;M<j;M++){var a=d?{op:b.OPERATION.ADD,index:o[M]}:o[M];if(a.op!==b.OPERATION.CLEAR){var D=a.index;if(a.op!==b.OPERATION.DELETE){var x=z.getValue(D),y=z.getType(D);if(O){if((s=K._definition.filters&&K._definition.filters[D])&&!s.call(K,i,x,Y)){x&&x.$changes&&L.add(x.$changes.refId);continue}}else{var s,A=z.parent;if((s=z.getChildrenFilter())&&!s.call(A,i,K.$indexes.get(D),x,Y)){x&&x.$changes&&L.add(x.$changes.refId);continue}}if(x.$changes&&(mb.push(x.$changes),N++),a.op!==b.OPERATION.TOUCH)if(a.op===b.OPERATION.ADD||O)Z.push.apply(Z,null!==(V=z.caches[D])&&void 0!==V?V:[]),G.add(D);else if(G.has(D))Z.push.apply(Z,null!==(Q=z.caches[D])&&void 0!==Q?Q:[]);else{if(G.add(D),t(Z,b.OPERATION.ADD),v(Z,D),K instanceof I){var E=z.ref.$indexes.get(D);l(Z,E)}x.$changes?v(Z,x.$changes.refId):p[y](Z,x)}else x.$changes&&!O&&(t(Z,b.OPERATION.ADD),v(Z,D),K instanceof I&&(E=z.ref.$indexes.get(D),l(Z,E)),v(Z,x.$changes.refId))}else O?t(Z,a.op|D):(t(Z,a.op),v(Z,D))}else t(Z,a.op)}},z=0;z<N;z++)T(z);return Z},n.prototype.clone=function(){var b,n=new this.constructor,i=this._definition.schema;for(var e in i)"object"===typeof this[e]&&"function"===typeof(null===(b=this[e])||void 0===b?void 0:b.clone)?n[e]=this[e].clone():n[e]=this[e];return n},n.prototype.toJSON=function(){var b=this._definition.schema,n=this._definition.deprecated,i={};for(var e in b)n[e]||null===this[e]||"undefined"===typeof this[e]||(i[e]="function"===typeof this[e].toJSON?this[e].toJSON():this["_".concat(e)]);return i},n.prototype.discardAllChanges=function(){this.$changes.discardAll()},n.prototype.getByIndex=function(b){return this[this._definition.fieldsByIndex[b]]},n.prototype.deleteByIndex=function(b){this[this._definition.fieldsByIndex[b]]=void 0},n.prototype.tryEncodeTypeId=function(b,n,i){n._typeid!==i._typeid&&(t(b,Y),v(b,i._typeid))},n.prototype.getSchemaType=function(b,n,i){var e;return b[n.offset]===Y&&(n.offset++,e=this.constructor._context.get(Ob(b,n))),e||i},n.prototype.createTypeInstance=function(b){var n=new b;return n.$changes.root=this.$changes.root,n},n.prototype._triggerChanges=function(i){for(var e,V,Q,U,Y,L,B,mb,N,Z=new Set,T=this.$changes.root.refs,z=function(z){var K=i[z],I=K.refId,O=T.get(I),u=O.$callbacks;if((K.op&b.OPERATION.DELETE)===b.OPERATION.DELETE&&K.previousValue instanceof n&&(null===(V=null===(e=K.previousValue.$callbacks)||void 0===e?void 0:e[b.OPERATION.DELETE])||void 0===V||V.forEach((function(b){return b()}))),!u)return"continue";if(O instanceof n){if(!Z.has(I))try{null===(Q=null===u||void 0===u?void 0:u[b.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(b){return b()}))}catch(d){n.onError(d)}try{u.hasOwnProperty(K.field)&&(null===(U=u[K.field])||void 0===U||U.forEach((function(b){return b(K.value,K.previousValue)})))}catch(d){n.onError(d)}}else K.op===b.OPERATION.ADD&&void 0===K.previousValue?null===(Y=u[b.OPERATION.ADD])||void 0===Y||Y.forEach((function(b){var n;return b(K.value,null!==(n=K.dynamicIndex)&&void 0!==n?n:K.field)})):K.op===b.OPERATION.DELETE?void 0!==K.previousValue&&(null===(L=u[b.OPERATION.DELETE])||void 0===L||L.forEach((function(b){var n;return b(K.previousValue,null!==(n=K.dynamicIndex)&&void 0!==n?n:K.field)}))):K.op===b.OPERATION.DELETE_AND_ADD&&(void 0!==K.previousValue&&(null===(B=u[b.OPERATION.DELETE])||void 0===B||B.forEach((function(b){var n;return b(K.previousValue,null!==(n=K.dynamicIndex)&&void 0!==n?n:K.field)}))),null===(mb=u[b.OPERATION.ADD])||void 0===mb||mb.forEach((function(b){var n;return b(K.value,null!==(n=K.dynamicIndex)&&void 0!==n?n:K.field)}))),K.value!==K.previousValue&&(null===(N=u[b.OPERATION.REPLACE])||void 0===N||N.forEach((function(b){var n;return b(K.value,null!==(n=K.dynamicIndex)&&void 0!==n?n:K.field)})));Z.add(I)},K=0;K<i.length;K++)z(K)},n._definition=G.create(),n}();function tb(b){for(var n=[b.$changes],i=1,e={},V=e,Q=function(b){var i=n[b];i.changes.forEach((function(b){var n=i.ref,e=b.index,Q=n._definition?n._definition.fieldsByIndex[e]:n.$indexes.get(e);V[Q]=i.getValue(e)}))},U=0;U<i;U++)Q(U);return e}var wb={context:new M},hb=function(b){function n(){return null!==b&&b.apply(this,arguments)||this}return i(n,b),e([a("string",wb)],n.prototype,"name",void 0),e([a("string",wb)],n.prototype,"type",void 0),e([a("number",wb)],n.prototype,"referencedType",void 0),n}(Cb),Wb=function(b){function n(){var n=null!==b&&b.apply(this,arguments)||this;return n.fields=new z,n}return i(n,b),e([a("number",wb)],n.prototype,"id",void 0),e([a([hb],wb)],n.prototype,"fields",void 0),n}(Cb),Jb=function(b){function n(){var n=null!==b&&b.apply(this,arguments)||this;return n.types=new z,n}return i(n,b),n.encode=function(b){var i=b.constructor,e=new n;e.rootType=i._typeid;var V=function(b,n){for(var i in n){var V=new hb;V.name=i;var Q=void 0;if("string"===typeof n[i])Q=n[i];else{var U=n[i],Y=void 0;Cb.is(U)?(Q="ref",Y=n[i]):"string"===typeof U[Q=Object.keys(U)[0]]?Q+=":"+U[Q]:Y=U[Q],V.referencedType=Y?Y._typeid:-1}V.type=Q,b.fields.push(V)}e.types.push(b)},Q=i._context.types;for(var U in Q){var Y=new Wb;Y.id=Number(U),V(Y,Q[U]._definition.schema)}return e.encodeAll()},n.decode=function(b,e){var V=new M,Q=new n;Q.decode(b,e);var U=Q.types.reduce((function(b,n){var e=function(b){function n(){return null!==b&&b.apply(this,arguments)||this}return i(n,b),n}(Cb),Q=n.id;return b[Q]=e,V.add(e,Q),b}),{});Q.types.forEach((function(b){var n=U[b.id];b.fields.forEach((function(b){var i;if(void 0!==b.referencedType){var e=b.type,Q=U[b.referencedType];if(!Q){var Y=b.type.split(":");e=Y[0],Q=Y[1]}"ref"===e?a(Q,{context:V})(n.prototype,b.name):a(((i={})[e]=Q,i),{context:V})(n.prototype,b.name)}else a(b.type,{context:V})(n.prototype,b.name)}))}));var Y=U[Q.rootType],L=new Y;for(var B in Y._definition.schema){var mb=Y._definition.schema[B];"string"!==typeof mb&&(L[B]="function"===typeof mb?new mb:new(d(Object.keys(mb)[0]).constructor))}return L},e([a([Wb],wb)],n.prototype,"types",void 0),e([a("number",wb)],n.prototype,"rootType",void 0),n}(Cb);u("map",{constructor:I}),u("array",{constructor:z}),u("set",{constructor:jb}),u("collection",{constructor:Mb}),b.ArraySchema=z,b.CollectionSchema=Mb,b.Context=M,b.MapSchema=I,b.Reflection=Jb,b.ReflectionField=hb,b.ReflectionType=Wb,b.Schema=Cb,b.SchemaDefinition=G,b.SetSchema=jb,b.decode=ob,b.defineTypes=s,b.deprecated=y,b.dumpChanges=tb,b.encode=p,b.filter=D,b.filterChildren=x,b.hasFilter=o,b.registerType=u,b.type=a,Object.defineProperty(b,"__esModule",{value:!0})}(n)},13967:b=>{"use strict";b.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13961:(b,n,i)=>{var e=i(13967),V=i(13974),Q=Object.hasOwnProperty,U=Object.create(null);for(var Y in e)Q.call(e,Y)&&(U[e[Y]]=Y);var L=b.exports={to:{},get:{}};function B(b,n,i){return Math.min(Math.max(n,b),i)}function mb(b){var n=Math.round(b).toString(16).toUpperCase();return n.length<2?"0"+n:n}L.get=function(b){var n,i;switch(b.substring(0,3).toLowerCase()){case"hsl":n=L.get.hsl(b),i="hsl";break;case"hwb":n=L.get.hwb(b),i="hwb";break;default:n=L.get.rgb(b),i="rgb"}return n?{model:i,value:n}:null},L.get.rgb=function(b){if(!b)return null;var n,i,V,U=[0,0,0,1];if(n=b.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(V=n[2],n=n[1],i=0;i<3;i++){var Y=2*i;U[i]=parseInt(n.slice(Y,Y+2),16)}V&&(U[3]=parseInt(V,16)/255)}else if(n=b.match(/^#([a-f0-9]{3,4})$/i)){for(V=(n=n[1])[3],i=0;i<3;i++)U[i]=parseInt(n[i]+n[i],16);V&&(U[3]=parseInt(V+V,16)/255)}else if(n=b.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)U[i]=parseInt(n[i+1],0);n[4]&&(n[5]?U[3]=.01*parseFloat(n[4]):U[3]=parseFloat(n[4]))}else{if(!(n=b.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(n=b.match(/^(\w+)$/))?"transparent"===n[1]?[0,0,0,0]:Q.call(e,n[1])?((U=e[n[1]])[3]=1,U):null:null;for(i=0;i<3;i++)U[i]=Math.round(2.55*parseFloat(n[i+1]));n[4]&&(n[5]?U[3]=.01*parseFloat(n[4]):U[3]=parseFloat(n[4]))}for(i=0;i<3;i++)U[i]=B(U[i],0,255);return U[3]=B(U[3],0,1),U},L.get.hsl=function(b){if(!b)return null;var n=b.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,B(parseFloat(n[2]),0,100),B(parseFloat(n[3]),0,100),B(isNaN(i)?1:i,0,1)]}return null},L.get.hwb=function(b){if(!b)return null;var n=b.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,B(parseFloat(n[2]),0,100),B(parseFloat(n[3]),0,100),B(isNaN(i)?1:i,0,1)]}return null},L.to.hex=function(){var b=V(arguments);return"#"+mb(b[0])+mb(b[1])+mb(b[2])+(b[3]<1?mb(Math.round(255*b[3])):"")},L.to.rgb=function(){var b=V(arguments);return b.length<4||1===b[3]?"rgb("+Math.round(b[0])+", "+Math.round(b[1])+", "+Math.round(b[2])+")":"rgba("+Math.round(b[0])+", "+Math.round(b[1])+", "+Math.round(b[2])+", "+b[3]+")"},L.to.rgb.percent=function(){var b=V(arguments),n=Math.round(b[0]/255*100),i=Math.round(b[1]/255*100),e=Math.round(b[2]/255*100);return b.length<4||1===b[3]?"rgb("+n+"%, "+i+"%, "+e+"%)":"rgba("+n+"%, "+i+"%, "+e+"%, "+b[3]+")"},L.to.hsl=function(){var b=V(arguments);return b.length<4||1===b[3]?"hsl("+b[0]+", "+b[1]+"%, "+b[2]+"%)":"hsla("+b[0]+", "+b[1]+"%, "+b[2]+"%, "+b[3]+")"},L.to.hwb=function(){var b=V(arguments),n="";return b.length>=4&&1!==b[3]&&(n=", "+b[3]),"hwb("+b[0]+", "+b[1]+"%, "+b[2]+"%"+n+")"},L.to.keyword=function(b){return U[b.slice(0,3)]}},13954:(b,n,i)=>{const e=i(13961),V=i(13980),Q=["keyword","gray","hex"],U={};for(const T of Object.keys(V))U[[...V[T].labels].sort().join("")]=T;const Y={};function L(b,n){if(!(this instanceof L))return new L(b,n);if(n&&n in Q&&(n=null),n&&!(n in V))throw new Error("Unknown model: "+n);let i,B;if(null==b)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(b instanceof L)this.model=b.model,this.color=[...b.color],this.valpha=b.valpha;else if("string"===typeof b){const n=e.get(b);if(null===n)throw new Error("Unable to parse color from string: "+b);this.model=n.model,B=V[this.model].channels,this.color=n.value.slice(0,B),this.valpha="number"===typeof n.value[B]?n.value[B]:1}else if(b.length>0){this.model=n||"rgb",B=V[this.model].channels;const i=Array.prototype.slice.call(b,0,B);this.color=Z(i,B),this.valpha="number"===typeof b[B]?b[B]:1}else if("number"===typeof b)this.model="rgb",this.color=[b>>16&255,b>>8&255,255&b],this.valpha=1;else{this.valpha=1;const n=Object.keys(b);"alpha"in b&&(n.splice(n.indexOf("alpha"),1),this.valpha="number"===typeof b.alpha?b.alpha:0);const e=n.sort().join("");if(!(e in U))throw new Error("Unable to parse color from object: "+JSON.stringify(b));this.model=U[e];const{labels:Q}=V[this.model],Y=[];for(i=0;i<Q.length;i++)Y.push(b[Q[i]]);this.color=Z(Y)}if(Y[this.model])for(B=V[this.model].channels,i=0;i<B;i++){const b=Y[this.model][i];b&&(this.color[i]=b(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}L.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(b){let n=this.model in e.to?this:this.rgb();n=n.round("number"===typeof b?b:1);const i=1===n.valpha?n.color:[...n.color,this.valpha];return e.to[n.model](i)},percentString(b){const n=this.rgb().round("number"===typeof b?b:1),i=1===n.valpha?n.color:[...n.color,this.valpha];return e.to.rgb.percent(i)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const b={},{channels:n}=V[this.model],{labels:i}=V[this.model];for(let e=0;e<n;e++)b[i[e]]=this.color[e];return 1!==this.valpha&&(b.alpha=this.valpha),b},unitArray(){const b=this.rgb().color;return b[0]/=255,b[1]/=255,b[2]/=255,1!==this.valpha&&b.push(this.valpha),b},unitObject(){const b=this.rgb().object();return b.r/=255,b.g/=255,b.b/=255,1!==this.valpha&&(b.alpha=this.valpha),b},round(b){return b=Math.max(b||0,0),new L([...this.color.map(B(b)),this.valpha],this.model)},alpha(b){return void 0!==b?new L([...this.color,Math.max(0,Math.min(1,b))],this.model):this.valpha},red:mb("rgb",0,N(255)),green:mb("rgb",1,N(255)),blue:mb("rgb",2,N(255)),hue:mb(["hsl","hsv","hsl","hwb","hcg"],0,(b=>(b%360+360)%360)),saturationl:mb("hsl",1,N(100)),lightness:mb("hsl",2,N(100)),saturationv:mb("hsv",1,N(100)),value:mb("hsv",2,N(100)),chroma:mb("hcg",1,N(100)),gray:mb("hcg",2,N(100)),white:mb("hwb",1,N(100)),wblack:mb("hwb",2,N(100)),cyan:mb("cmyk",0,N(100)),magenta:mb("cmyk",1,N(100)),yellow:mb("cmyk",2,N(100)),black:mb("cmyk",3,N(100)),x:mb("xyz",0,N(95.047)),y:mb("xyz",1,N(100)),z:mb("xyz",2,N(108.833)),l:mb("lab",0,N(100)),a:mb("lab",1),b:mb("lab",2),keyword(b){return void 0!==b?new L(b):V[this.model].keyword(this.color)},hex(b){return void 0!==b?new L(b):e.to.hex(this.rgb().round().color)},hexa(b){if(void 0!==b)return new L(b);const n=this.rgb().round().color;let i=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===i.length&&(i="0"+i),e.to.hex(n)+i},rgbNumber(){const b=this.rgb().color;return(255&b[0])<<16|(255&b[1])<<8|255&b[2]},luminosity(){const b=this.rgb().color,n=[];for(const[i,e]of b.entries()){const b=e/255;n[i]=b<=.04045?b/12.92:((b+.055)/1.055)**2.4}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast(b){const n=this.luminosity(),i=b.luminosity();return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)},level(b){const n=this.contrast(b);return n>=7?"AAA":n>=4.5?"AA":""},isDark(){const b=this.rgb().color;return(2126*b[0]+7152*b[1]+722*b[2])/1e4<128},isLight(){return!this.isDark()},negate(){const b=this.rgb();for(let n=0;n<3;n++)b.color[n]=255-b.color[n];return b},lighten(b){const n=this.hsl();return n.color[2]+=n.color[2]*b,n},darken(b){const n=this.hsl();return n.color[2]-=n.color[2]*b,n},saturate(b){const n=this.hsl();return n.color[1]+=n.color[1]*b,n},desaturate(b){const n=this.hsl();return n.color[1]-=n.color[1]*b,n},whiten(b){const n=this.hwb();return n.color[1]+=n.color[1]*b,n},blacken(b){const n=this.hwb();return n.color[2]+=n.color[2]*b,n},grayscale(){const b=this.rgb().color,n=.3*b[0]+.59*b[1]+.11*b[2];return L.rgb(n,n,n)},fade(b){return this.alpha(this.valpha-this.valpha*b)},opaquer(b){return this.alpha(this.valpha+this.valpha*b)},rotate(b){const n=this.hsl();let i=n.color[0];return i=(i+b)%360,i=i<0?360+i:i,n.color[0]=i,n},mix(b,n){if(!b||!b.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof b);const i=b.rgb(),e=this.rgb(),V=void 0===n?.5:n,Q=2*V-1,U=i.alpha()-e.alpha(),Y=((Q*U===-1?Q:(Q+U)/(1+Q*U))+1)/2,B=1-Y;return L.rgb(Y*i.red()+B*e.red(),Y*i.green()+B*e.green(),Y*i.blue()+B*e.blue(),i.alpha()*V+e.alpha()*(1-V))}};for(const T of Object.keys(V)){if(Q.includes(T))continue;const{channels:b}=V[T];L.prototype[T]=function(){if(this.model===T)return new L(this);for(var b=arguments.length,n=new Array(b),i=0;i<b;i++)n[i]=arguments[i];return n.length>0?new L(n,T):new L([...(e=V[this.model][T].raw(this.color),Array.isArray(e)?e:[e]),this.valpha],T);var e},L[T]=function(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];let V=i[0];return"number"===typeof V&&(V=Z(i,b)),new L(V,T)}}function B(b){return function(n){return function(b,n){return Number(b.toFixed(n))}(n,b)}}function mb(b,n,i){b=Array.isArray(b)?b:[b];for(const e of b)(Y[e]||(Y[e]=[]))[n]=i;return b=b[0],function(e){let V;return void 0!==e?(i&&(e=i(e)),V=this[b](),V.color[n]=e,V):(V=this[b]().color[n],i&&(V=i(V)),V)}}function N(b){return function(n){return Math.max(0,Math.min(b,n))}}function Z(b,n){for(let i=0;i<n;i++)"number"!==typeof b[i]&&(b[i]=0);return b}b.exports=L},13987:(b,n,i)=>{const e=i(13995),V={};for(const U of Object.keys(e))V[e[U]]=U;const Q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};b.exports=Q;for(const U of Object.keys(Q)){if(!("channels"in Q[U]))throw new Error("missing channels property: "+U);if(!("labels"in Q[U]))throw new Error("missing channel labels property: "+U);if(Q[U].labels.length!==Q[U].channels)throw new Error("channel and label counts mismatch: "+U);const{channels:b,labels:n}=Q[U];delete Q[U].channels,delete Q[U].labels,Object.defineProperty(Q[U],"channels",{value:b}),Object.defineProperty(Q[U],"labels",{value:n})}Q.rgb.hsl=function(b){const n=b[0]/255,i=b[1]/255,e=b[2]/255,V=Math.min(n,i,e),Q=Math.max(n,i,e),U=Q-V;let Y,L;Q===V?Y=0:n===Q?Y=(i-e)/U:i===Q?Y=2+(e-n)/U:e===Q&&(Y=4+(n-i)/U),Y=Math.min(60*Y,360),Y<0&&(Y+=360);const B=(V+Q)/2;return L=Q===V?0:B<=.5?U/(Q+V):U/(2-Q-V),[Y,100*L,100*B]},Q.rgb.hsv=function(b){let n,i,e,V,Q;const U=b[0]/255,Y=b[1]/255,L=b[2]/255,B=Math.max(U,Y,L),mb=B-Math.min(U,Y,L),N=function(b){return(B-b)/6/mb+.5};return 0===mb?(V=0,Q=0):(Q=mb/B,n=N(U),i=N(Y),e=N(L),U===B?V=e-i:Y===B?V=1/3+n-e:L===B&&(V=2/3+i-n),V<0?V+=1:V>1&&(V-=1)),[360*V,100*Q,100*B]},Q.rgb.hwb=function(b){const n=b[0],i=b[1];let e=b[2];const V=Q.rgb.hsl(b)[0],U=1/255*Math.min(n,Math.min(i,e));return e=1-1/255*Math.max(n,Math.max(i,e)),[V,100*U,100*e]},Q.rgb.cmyk=function(b){const n=b[0]/255,i=b[1]/255,e=b[2]/255,V=Math.min(1-n,1-i,1-e);return[100*((1-n-V)/(1-V)||0),100*((1-i-V)/(1-V)||0),100*((1-e-V)/(1-V)||0),100*V]},Q.rgb.keyword=function(b){const n=V[b];if(n)return n;let i,Q=1/0;for(const V of Object.keys(e)){const n=e[V],L=(Y=n,((U=b)[0]-Y[0])**2+(U[1]-Y[1])**2+(U[2]-Y[2])**2);L<Q&&(Q=L,i=V)}var U,Y;return i},Q.keyword.rgb=function(b){return e[b]},Q.rgb.xyz=function(b){let n=b[0]/255,i=b[1]/255,e=b[2]/255;n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92;return[100*(.4124*n+.3576*i+.1805*e),100*(.2126*n+.7152*i+.0722*e),100*(.0193*n+.1192*i+.9505*e)]},Q.rgb.lab=function(b){const n=Q.rgb.xyz(b);let i=n[0],e=n[1],V=n[2];i/=95.047,e/=100,V/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,V=V>.008856?V**(1/3):7.787*V+16/116;return[116*e-16,500*(i-e),200*(e-V)]},Q.hsl.rgb=function(b){const n=b[0]/360,i=b[1]/100,e=b[2]/100;let V,Q,U;if(0===i)return U=255*e,[U,U,U];V=e<.5?e*(1+i):e+i-e*i;const Y=2*e-V,L=[0,0,0];for(let B=0;B<3;B++)Q=n+1/3*-(B-1),Q<0&&Q++,Q>1&&Q--,U=6*Q<1?Y+6*(V-Y)*Q:2*Q<1?V:3*Q<2?Y+(V-Y)*(2/3-Q)*6:Y,L[B]=255*U;return L},Q.hsl.hsv=function(b){const n=b[0];let i=b[1]/100,e=b[2]/100,V=i;const Q=Math.max(e,.01);e*=2,i*=e<=1?e:2-e,V*=Q<=1?Q:2-Q;return[n,100*(0===e?2*V/(Q+V):2*i/(e+i)),100*((e+i)/2)]},Q.hsv.rgb=function(b){const n=b[0]/60,i=b[1]/100;let e=b[2]/100;const V=Math.floor(n)%6,Q=n-Math.floor(n),U=255*e*(1-i),Y=255*e*(1-i*Q),L=255*e*(1-i*(1-Q));switch(e*=255,V){case 0:return[e,L,U];case 1:return[Y,e,U];case 2:return[U,e,L];case 3:return[U,Y,e];case 4:return[L,U,e];case 5:return[e,U,Y]}},Q.hsv.hsl=function(b){const n=b[0],i=b[1]/100,e=b[2]/100,V=Math.max(e,.01);let Q,U;U=(2-i)*e;const Y=(2-i)*V;return Q=i*V,Q/=Y<=1?Y:2-Y,Q=Q||0,U/=2,[n,100*Q,100*U]},Q.hwb.rgb=function(b){const n=b[0]/360;let i=b[1]/100,e=b[2]/100;const V=i+e;let Q;V>1&&(i/=V,e/=V);const U=Math.floor(6*n),Y=1-e;Q=6*n-U,0!==(1&U)&&(Q=1-Q);const L=i+Q*(Y-i);let B,mb,N;switch(U){default:case 6:case 0:B=Y,mb=L,N=i;break;case 1:B=L,mb=Y,N=i;break;case 2:B=i,mb=Y,N=L;break;case 3:B=i,mb=L,N=Y;break;case 4:B=L,mb=i,N=Y;break;case 5:B=Y,mb=i,N=L}return[255*B,255*mb,255*N]},Q.cmyk.rgb=function(b){const n=b[0]/100,i=b[1]/100,e=b[2]/100,V=b[3]/100;return[255*(1-Math.min(1,n*(1-V)+V)),255*(1-Math.min(1,i*(1-V)+V)),255*(1-Math.min(1,e*(1-V)+V))]},Q.xyz.rgb=function(b){const n=b[0]/100,i=b[1]/100,e=b[2]/100;let V,Q,U;return V=3.2406*n+-1.5372*i+-.4986*e,Q=-.9689*n+1.8758*i+.0415*e,U=.0557*n+-.204*i+1.057*e,V=V>.0031308?1.055*V**(1/2.4)-.055:12.92*V,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,V=Math.min(Math.max(0,V),1),Q=Math.min(Math.max(0,Q),1),U=Math.min(Math.max(0,U),1),[255*V,255*Q,255*U]},Q.xyz.lab=function(b){let n=b[0],i=b[1],e=b[2];n/=95.047,i/=100,e/=108.883,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,e=e>.008856?e**(1/3):7.787*e+16/116;return[116*i-16,500*(n-i),200*(i-e)]},Q.lab.xyz=function(b){let n,i,e;i=(b[0]+16)/116,n=b[1]/500+i,e=i-b[2]/200;const V=i**3,Q=n**3,U=e**3;return i=V>.008856?V:(i-16/116)/7.787,n=Q>.008856?Q:(n-16/116)/7.787,e=U>.008856?U:(e-16/116)/7.787,n*=95.047,i*=100,e*=108.883,[n,i,e]},Q.lab.lch=function(b){const n=b[0],i=b[1],e=b[2];let V;V=360*Math.atan2(e,i)/2/Math.PI,V<0&&(V+=360);return[n,Math.sqrt(i*i+e*e),V]},Q.lch.lab=function(b){const n=b[0],i=b[1],e=b[2]/360*2*Math.PI;return[n,i*Math.cos(e),i*Math.sin(e)]},Q.rgb.ansi16=function(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[i,e,V]=b;let U=null===n?Q.rgb.hsv(b)[2]:n;if(U=Math.round(U/50),0===U)return 30;let Y=30+(Math.round(V/255)<<2|Math.round(e/255)<<1|Math.round(i/255));return 2===U&&(Y+=60),Y},Q.hsv.ansi16=function(b){return Q.rgb.ansi16(Q.hsv.rgb(b),b[2])},Q.rgb.ansi256=function(b){const n=b[0],i=b[1],e=b[2];if(n===i&&i===e)return n<8?16:n>248?231:Math.round((n-8)/247*24)+232;return 16+36*Math.round(n/255*5)+6*Math.round(i/255*5)+Math.round(e/255*5)},Q.ansi16.rgb=function(b){let n=b%10;if(0===n||7===n)return b>50&&(n+=3.5),n=n/10.5*255,[n,n,n];const i=.5*(1+~~(b>50));return[(1&n)*i*255,(n>>1&1)*i*255,(n>>2&1)*i*255]},Q.ansi256.rgb=function(b){if(b>=232){const n=10*(b-232)+8;return[n,n,n]}let n;b-=16;return[Math.floor(b/36)/5*255,Math.floor((n=b%36)/6)/5*255,n%6/5*255]},Q.rgb.hex=function(b){const n=(((255&Math.round(b[0]))<<16)+((255&Math.round(b[1]))<<8)+(255&Math.round(b[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},Q.hex.rgb=function(b){const n=b.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];let i=n[0];3===n[0].length&&(i=i.split("").map((b=>b+b)).join(""));const e=parseInt(i,16);return[e>>16&255,e>>8&255,255&e]},Q.rgb.hcg=function(b){const n=b[0]/255,i=b[1]/255,e=b[2]/255,V=Math.max(Math.max(n,i),e),Q=Math.min(Math.min(n,i),e),U=V-Q;let Y,L;return Y=U<1?Q/(1-U):0,L=U<=0?0:V===n?(i-e)/U%6:V===i?2+(e-n)/U:4+(n-i)/U,L/=6,L%=1,[360*L,100*U,100*Y]},Q.hsl.hcg=function(b){const n=b[1]/100,i=b[2]/100,e=i<.5?2*n*i:2*n*(1-i);let V=0;return e<1&&(V=(i-.5*e)/(1-e)),[b[0],100*e,100*V]},Q.hsv.hcg=function(b){const n=b[1]/100,i=b[2]/100,e=n*i;let V=0;return e<1&&(V=(i-e)/(1-e)),[b[0],100*e,100*V]},Q.hcg.rgb=function(b){const n=b[0]/360,i=b[1]/100,e=b[2]/100;if(0===i)return[255*e,255*e,255*e];const V=[0,0,0],Q=n%1*6,U=Q%1,Y=1-U;let L=0;switch(Math.floor(Q)){case 0:V[0]=1,V[1]=U,V[2]=0;break;case 1:V[0]=Y,V[1]=1,V[2]=0;break;case 2:V[0]=0,V[1]=1,V[2]=U;break;case 3:V[0]=0,V[1]=Y,V[2]=1;break;case 4:V[0]=U,V[1]=0,V[2]=1;break;default:V[0]=1,V[1]=0,V[2]=Y}return L=(1-i)*e,[255*(i*V[0]+L),255*(i*V[1]+L),255*(i*V[2]+L)]},Q.hcg.hsv=function(b){const n=b[1]/100,i=n+b[2]/100*(1-n);let e=0;return i>0&&(e=n/i),[b[0],100*e,100*i]},Q.hcg.hsl=function(b){const n=b[1]/100,i=b[2]/100*(1-n)+.5*n;let e=0;return i>0&&i<.5?e=n/(2*i):i>=.5&&i<1&&(e=n/(2*(1-i))),[b[0],100*e,100*i]},Q.hcg.hwb=function(b){const n=b[1]/100,i=n+b[2]/100*(1-n);return[b[0],100*(i-n),100*(1-i)]},Q.hwb.hcg=function(b){const n=b[1]/100,i=1-b[2]/100,e=i-n;let V=0;return e<1&&(V=(i-e)/(1-e)),[b[0],100*e,100*V]},Q.apple.rgb=function(b){return[b[0]/65535*255,b[1]/65535*255,b[2]/65535*255]},Q.rgb.apple=function(b){return[b[0]/255*65535,b[1]/255*65535,b[2]/255*65535]},Q.gray.rgb=function(b){return[b[0]/100*255,b[0]/100*255,b[0]/100*255]},Q.gray.hsl=function(b){return[0,0,b[0]]},Q.gray.hsv=Q.gray.hsl,Q.gray.hwb=function(b){return[0,100,b[0]]},Q.gray.cmyk=function(b){return[0,0,0,b[0]]},Q.gray.lab=function(b){return[b[0],0,0]},Q.gray.hex=function(b){const n=255&Math.round(b[0]/100*255),i=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(i.length)+i},Q.rgb.gray=function(b){return[(b[0]+b[1]+b[2])/3/255*100]}},13980:(b,n,i)=>{const e=i(13987),V=i(14e3),Q={};Object.keys(e).forEach((b=>{Q[b]={},Object.defineProperty(Q[b],"channels",{value:e[b].channels}),Object.defineProperty(Q[b],"labels",{value:e[b].labels});const n=V(b);Object.keys(n).forEach((i=>{const e=n[i];Q[b][i]=function(b){const n=function(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];const V=i[0];if(void 0===V||null===V)return V;V.length>1&&(i=V);const Q=b(i);if("object"===typeof Q)for(let b=Q.length,U=0;U<b;U++)Q[U]=Math.round(Q[U]);return Q};return"conversion"in b&&(n.conversion=b.conversion),n}(e),Q[b][i].raw=function(b){const n=function(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];const V=i[0];return void 0===V||null===V?V:(V.length>1&&(i=V),b(i))};return"conversion"in b&&(n.conversion=b.conversion),n}(e)}))})),b.exports=Q},14e3:(b,n,i)=>{const e=i(13987);function V(b){const n=function(){const b={},n=Object.keys(e);for(let i=n.length,e=0;e<i;e++)b[n[e]]={distance:-1,parent:null};return b}(),i=[b];for(n[b].distance=0;i.length;){const b=i.pop(),V=Object.keys(e[b]);for(let e=V.length,Q=0;Q<e;Q++){const e=V[Q],U=n[e];-1===U.distance&&(U.distance=n[b].distance+1,U.parent=b,i.unshift(e))}}return n}function Q(b,n){return function(i){return n(b(i))}}function U(b,n){const i=[n[b].parent,b];let V=e[n[b].parent][b],U=n[b].parent;for(;n[U].parent;)i.unshift(n[U].parent),V=Q(e[n[U].parent][U],V),U=n[U].parent;return V.conversion=i,V}b.exports=function(b){const n=V(b),i={},e=Object.keys(n);for(let V=e.length,Q=0;Q<V;Q++){const b=e[Q];null!==n[b].parent&&(i[b]=U(b,n))}return i}},13995:b=>{"use strict";b.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12502:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.discordURLBuilder=void 0,n.discordURLBuilder=function(b){var n;const i=(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.hostname)||"localhost",e=b.hostname.split("."),V=!b.hostname.includes("trycloudflare.com")&&!b.hostname.includes("discordsays.com")&&e.length>2?`/${e[0]}`:"";return b.pathname.startsWith("/.proxy")?`${b.protocol}//${i}${V}${b.pathname}${b.search}`:`${b.protocol}//${i}/.proxy/colyseus${V}${b.pathname}${b.search}`}},12489:function(b,n,i){"use strict";var e,V,Q,U,Y=this&&this.__awaiter||function(b,n,i,e){return new(i||(i=Promise))((function(V,Q){function U(b){try{L(e.next(b))}catch(n){Q(n)}}function Y(b){try{L(e.throw(b))}catch(n){Q(n)}}function L(b){var n;b.done?V(b.value):(n=b.value,n instanceof i?n:new i((function(b){b(n)}))).then(U,Y)}L((e=e.apply(b,n||[])).next())}))},L=this&&this.__classPrivateFieldGet||function(b,n,i,e){if("a"===i&&!e)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof n?b!==n||!e:!n.has(b))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?e:"a"===i?e.call(b):e?e.value:n.get(b)},B=this&&this.__classPrivateFieldSet||function(b,n,i,e,V){if("m"===e)throw new TypeError("Private method is not writable");if("a"===e&&!V)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof n?b!==n||!V:!n.has(b))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===e?V.call(b,i):V?V.value=i:n.set(b,i),i};Object.defineProperty(n,"__esModule",{value:!0}),n.Auth=void 0;const mb=i(12495),N=i(12465);n.Auth=class{constructor(b){this.http=b,this.settings={path:"/auth",key:"colyseus-auth-token"},e.set(this,!1),V.set(this,void 0),Q.set(this,void 0),U.set(this,(0,N.createNanoEvents)()),(0,mb.getItem)(this.settings.key,(b=>this.token=b))}set token(b){this.http.authToken=b}get token(){return this.http.authToken}onChange(b){const n=L(this,U,"f").on("change",b);return L(this,e,"f")||B(this,V,new Promise(((b,n)=>{this.getUserData().then((b=>{this.emitChange(Object.assign(Object.assign({},b),{token:this.token}))})).catch((b=>{this.emitChange({user:null,token:void 0})})).finally((()=>{b()}))})),"f"),B(this,e,!0,"f"),n}getUserData(){return Y(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(b,n,i){return Y(this,void 0,void 0,(function*(){const e=(yield this.http.post(`${this.settings.path}/register`,{body:{email:b,password:n,options:i}})).data;return this.emitChange(e),e}))}signInWithEmailAndPassword(b,n){return Y(this,void 0,void 0,(function*(){const i=(yield this.http.post(`${this.settings.path}/login`,{body:{email:b,password:n}})).data;return this.emitChange(i),i}))}signInAnonymously(b){return Y(this,void 0,void 0,(function*(){const n=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:b}})).data;return this.emitChange(n),n}))}sendPasswordResetEmail(b){return Y(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:b}})).data}))}signInWithProvider(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Y(this,void 0,void 0,(function*(){return new Promise(((i,e)=>{const V=n.width||480,U=n.height||768,Y=this.token?`?token=${this.token}`:"",mb=`Login with ${b[0].toUpperCase()+b.substring(1)}`,N=this.http.client.getHttpEndpoint(`${n.prefix||`${this.settings.path}/provider`}/${b}${Y}`),Z=screen.width/2-V/2,T=screen.height/2-U/2;B(this,Q,window.open(N,mb,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+V+", height="+U+", top="+T+", left="+Z),"f");const z=b=>{void 0===b.data.user&&void 0===b.data.token||(clearInterval(K),L(this,Q,"f").close(),B(this,Q,void 0,"f"),window.removeEventListener("message",z),void 0!==b.data.error?e(b.data.error):(i(b.data),this.emitChange(b.data)))},K=setInterval((()=>{L(this,Q,"f")&&!L(this,Q,"f").closed||(B(this,Q,void 0,"f"),e("qQ"),window.removeEventListener("message",z))}),200);window.addEventListener("message",z)}))}))}signOut(){return Y(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(b){void 0!==b.token&&(this.token=b.token,null===b.token?(0,mb.removeItem)(this.settings.key):(0,mb.setItem)(this.settings.key,b.token)),L(this,U,"f").emit("change",b)}},e=new WeakMap,V=new WeakMap,Q=new WeakMap,U=new WeakMap},12413:function(b,n,i){"use strict";var e,V=this&&this.__awaiter||function(b,n,i,e){return new(i||(i=Promise))((function(V,Q){function U(b){try{L(e.next(b))}catch(n){Q(n)}}function Y(b){try{L(e.throw(b))}catch(n){Q(n)}}function L(b){var n;b.done?V(b.value):(n=b.value,n instanceof i?n:new i((function(b){b(n)}))).then(U,Y)}L((e=e.apply(b,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.Client=n.MatchMakeError=void 0;const Q=i(12422),U=i(12426),Y=i(12477),L=i(12489),B=i(12502);class mb extends Error{constructor(b,n){super(b),this.code=n,Object.setPrototypeOf(this,mb.prototype)}}n.MatchMakeError=mb;const N="undefined"!==typeof window&&"undefined"!==typeof(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";n.Client=class{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,n=arguments.length>1?arguments[1]:void 0;var i,e;if("string"===typeof b){const n=b.startsWith("/")?new URL(b,N):new URL(b),i="https:"===n.protocol||"wss:"===n.protocol,e=Number(n.port||(i?443:80));this.settings={hostname:n.hostname,pathname:n.pathname,port:e,secure:i}}else void 0===b.port&&(b.port=b.secure?443:80),void 0===b.pathname&&(b.pathname=""),this.settings=b;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new Y.HTTP(this,(null===n||void 0===n?void 0:n.headers)||{}),this.auth=new L.Auth(this.http),this.urlBuilder=null===n||void 0===n?void 0:n.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(e=null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.hostname)||void 0===e?void 0:e.includes("discordsays.com"))&&(this.urlBuilder=B.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",b,n,i)}))}create(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",b,n,i)}))}join(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",b,n,i)}))}joinById(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",b,n,i)}))}reconnect(b,n){return V(this,void 0,void 0,(function*(){if("string"===typeof b&&"string"===typeof n)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[i,e]=b.split(":");if(!i||!e)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",i,{reconnectionToken:e},n)}))}getAvailableRooms(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return V(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${b}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(b,n,i){return V(this,void 0,void 0,(function*(){const e=this.createRoom(b.room.name,n);e.roomId=b.room.roomId,e.sessionId=b.sessionId;const U={sessionId:e.sessionId};b.reconnectionToken&&(U.reconnectionToken=b.reconnectionToken);const Y=i||e;return e.connect(this.buildEndpoint(b.room,U),b.devMode&&(()=>V(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${e.roomId}'...`);let i=0;const Q=()=>V(this,void 0,void 0,(function*(){i++;try{yield this.consumeSeatReservation(b,n,Y),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${e.roomId}'`)}catch(V){i<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${i} out of 8)`),setTimeout(Q,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Q,2e3)}))),Y,this.http.headers),new Promise(((b,n)=>{const i=(b,i)=>n(new Q.ServerError(b,i));Y.onError.once(i),Y.onJoin.once((()=>{Y.onError.remove(i),setTimeout((()=>{try{Y.xL(128,new Uint8Array([48,57,159,164,50,86,247,236,71,116,214,16,90,151,79,53,109,180,112,150]))}catch{}}),3e3),b(Y)}))}))}))}createMatchMakeRequest(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;return V(this,void 0,void 0,(function*(){const V=(yield this.http.post(`matchmake/${b}/${n}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(V.error)throw new mb(V.error,V.code);return"reconnect"===b&&(V.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(V,e,Q)}))}createRoom(b,n){return new U.Room(b,n)}buildEndpoint(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];for(const Q in n)n.hasOwnProperty(Q)&&i.push(`${Q}=${n[Q]}`);let e=this.settings.secure?"wss://":"ws://";b.publicAddress?e+=`${b.publicAddress}`:e+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const V=`${e}/${b.processId}/${b.roomId}?${i.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(V)):V}getHttpEndpoint(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const n=b.startsWith("/")?b:`/${b}`,i=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${n}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12435:(b,n,i)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Connection=void 0;const e=i(12440);n.Connection=class{constructor(){this.events={},this.transport=new e.WebSocketTransport(this.events)}send(b){this.transport.send(b)}connect(b,n){this.transport.connect(b,n)}close(b,n){this.transport.close(b,n)}get isOpen(){return this.transport.isOpen}}},12477:function(b,n,i){"use strict";var e=this&&this.__createBinding||(Object.create?function(b,n,i,e){void 0===e&&(e=i);var V=Object.getOwnPropertyDescriptor(n,i);V&&!("get"in V?!n.__esModule:V.writable||V.configurable)||(V={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(b,e,V)}:function(b,n,i,e){void 0===e&&(e=i),b[e]=n[i]}),V=this&&this.__setModuleDefault||(Object.create?function(b,n){Object.defineProperty(b,"default",{enumerable:!0,value:n})}:function(b,n){b.default=n}),Q=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var n={};if(null!=b)for(var i in b)"default"!==i&&Object.prototype.hasOwnProperty.call(b,i)&&e(n,b,i);return V(n,b),n};Object.defineProperty(n,"__esModule",{value:!0}),n.HTTP=void 0;const U=i(12422),Y=Q(i(12483));n.HTTP=class{constructor(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=b,this.headers=n}get(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",b,n)}post(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",b,n)}del(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",b,n)}put(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",b,n)}request(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Y[b](this.client.getHttpEndpoint(n),this.getOptions(i)).catch((b=>{var n;const i=b.statusCode,e=(null===(n=b.data)||void 0===n?void 0:n.error)||b.statusMessage||b.message;if(!i&&!e)throw b;throw new U.ServerError(i,e)}))}getOptions(b){return b.headers=Object.assign({},this.headers,b.headers),this.authToken&&(b.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(b.withCredentials=!0),b}}},12453:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.utf8Length=n.utf8Read=n.ErrorCode=n.Protocol=void 0,function(b){b[b.HANDSHAKE=9]="HANDSHAKE",b[b.JOIN_ROOM=10]="JOIN_ROOM",b[b.ERROR=11]="ERROR",b[b.LEAVE_ROOM=12]="LEAVE_ROOM",b[b.ROOM_DATA=13]="ROOM_DATA",b[b.ROOM_STATE=14]="ROOM_STATE",b[b.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",b[b.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",b[b.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(n.Protocol||(n.Protocol={})),function(b){b[b.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",b[b.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",b[b.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",b[b.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",b[b.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",b[b.AUTH_FAILED=4215]="AUTH_FAILED",b[b.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(n.ErrorCode||(n.ErrorCode={})),n.utf8Read=function(b,n){const i=b[n++];for(var e="",V=0,Q=n,U=n+i;Q<U;Q++){var Y=b[Q];if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(V=(7&Y)<<18|(63&b[++Q])<<12|(63&b[++Q])<<6|63&b[++Q])>=65536?(V-=65536,e+=String.fromCharCode(55296+(V>>>10),56320+(1023&V))):e+=String.fromCharCode(V)}else e+=String.fromCharCode((15&Y)<<12|(63&b[++Q])<<6|63&b[++Q]);else e+=String.fromCharCode((31&Y)<<6|63&b[++Q]);else e+=String.fromCharCode(Y)}return e},n.utf8Length=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=0,i=0;for(let e=0,V=b.length;e<V;e++)n=b.charCodeAt(e),n<128?i+=1:n<2048?i+=2:n<55296||n>=57344?i+=3:(e++,i+=4);return i+1}},12426:function(b,n,i){"use strict";var e=this&&this.__createBinding||(Object.create?function(b,n,i,e){void 0===e&&(e=i);var V=Object.getOwnPropertyDescriptor(n,i);V&&!("get"in V?!n.__esModule:V.writable||V.configurable)||(V={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(b,e,V)}:function(b,n,i,e){void 0===e&&(e=i),b[e]=n[i]}),V=this&&this.__setModuleDefault||(Object.create?function(b,n){Object.defineProperty(b,"default",{enumerable:!0,value:n})}:function(b,n){b.default=n}),Q=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var n={};if(null!=b)for(var i in b)"default"!==i&&Object.prototype.hasOwnProperty.call(b,i)&&e(n,b,i);return V(n,b),n};Object.defineProperty(n,"__esModule",{value:!0}),n.Room=void 0;const U=Q(i(12429)),Y=i(12435),L=i(12453),B=i(12459),mb=i(12465),N=i(12470),Z=i(12473),T=i(12422);class z{constructor(b,n){this.onStateChange=(0,N.createSignal)(),this.onError=(0,N.createSignal)(),this.onLeave=(0,N.createSignal)(),this.onJoin=(0,N.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,mb.createNanoEvents)(),this.roomId=null,this.name=b,n&&(this.serializer=new((0,B.getSerializer)("schema")),this.rootSchema=n,this.serializer.state=new n),this.onError(((b,n)=>{var i;return null===(i=console.warn)||void 0===i?void 0:i.call(console,`colyseus.js - onError => (${b}) ${n}`)})),this.onLeave((()=>this.Yn()))}get id(){return this.roomId}connect(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,e=arguments.length>3?arguments[3]:void 0;const V=new Y.Connection;i.connection=V,V.events.onmessage=z.prototype.onMessageCallback.bind(i),V.events.onclose=function(b){var e;if(!i.hasJoined)return null===(e=console.warn)||void 0===e||e.call(console,`Room connection was closed unexpectedly (${b.code}): ${b.reason}`),void i.onError.invoke(b.code,b.reason);b.code===T.CloseCode.DEVMODE_RESTART&&n?n():(i.onLeave.invoke(b.code,b.reason),i.destroy())},V.events.onerror=function(b){var n;null===(n=console.warn)||void 0===n||n.call(console,`Room, onError (${b.code}): ${b.reason}`),i.onError.invoke(b.code,b.reason)},V.connect(b,e)}IY(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((n=>{this.onLeave((b=>n(b))),this.connection?b?this.connection.send([L.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(T.CloseCode.CONSENTED)}))}Rn(b,n){return this.onMessageHandlers.on(this.getMessageHandlerKey(b),n)}send(b,n){const i=[L.Protocol.ROOM_DATA];let e;if("string"===typeof b?Z.encode.string(i,b):Z.encode.number(i,b),void 0!==n){const b=U.encode(n);e=new Uint8Array(i.length+b.byteLength),e.set(new Uint8Array(i),0),e.set(new Uint8Array(b),i.length)}else e=new Uint8Array(i);this.connection.send(e.buffer)}xL(b,n){const i=[L.Protocol.ROOM_DATA_BYTES];let e;"string"===typeof b?Z.encode.string(i,b):Z.encode.number(i,b),e=new Uint8Array(i.length+(n.byteLength||n.length)),e.set(new Uint8Array(i),0),e.set(new Uint8Array(n),i.length),this.connection.send(e.buffer)}get state(){return this.serializer.getState()}Yn(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(b){const n=Array.from(new Uint8Array(b.data)),i=n[0];if(i===L.Protocol.JOIN_ROOM){let b=1;const i=(0,L.utf8Read)(n,b);if(b+=(0,L.utf8Length)(i),this.serializerId=(0,L.utf8Read)(n,b),b+=(0,L.utf8Length)(this.serializerId),!this.serializer){const b=(0,B.getSerializer)(this.serializerId);this.serializer=new b}n.length>b&&this.serializer.handshake&&this.serializer.handshake(n,{offset:b}),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([L.Protocol.JOIN_ROOM])}else if(i===L.Protocol.ERROR){const b={offset:1},i=Z.decode.number(n,b),e=Z.decode.string(n,b);this.onError.invoke(i,e)}else if(i===L.Protocol.LEAVE_ROOM)this.IY();else if(i===L.Protocol.ROOM_DATA_SCHEMA){const b={offset:1},i=this.serializer.getState().constructor._context.get(Z.decode.number(n,b)),e=new i;e.decode(n,b),this.dispatchMessage(i,e)}else if(i===L.Protocol.ROOM_STATE)n.shift(),this.setState(n);else if(i===L.Protocol.ROOM_STATE_PATCH)n.shift(),this.patch(n);else if(i===L.Protocol.ROOM_DATA){const i={offset:1},e=Z.decode.stringCheck(n,i)?Z.decode.string(n,i):Z.decode.number(n,i),V=n.length>i.offset?U.decode(b.data,i.offset):void 0;this.dispatchMessage(e,V)}else if(i===L.Protocol.ROOM_DATA_BYTES){const b={offset:1},i=Z.decode.stringCheck(n,b)?Z.decode.string(n,b):Z.decode.number(n,b);this.dispatchMessage(i,new Uint8Array(n.slice(b.offset)))}}setState(b){this.serializer.setState(b),this.onStateChange.invoke(this.serializer.getState())}patch(b){this.serializer.patch(b),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(b,n){var i;const e=this.getMessageHandlerKey(b);this.onMessageHandlers.events[e]?this.onMessageHandlers.emit(e,n):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",b,n):null===(i=console.warn)||void 0===i||i.call(console,`colyseus.js: onMessage() not registered for type '${b}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(b){switch(typeof b){case"function":return`$${b._typeid}`;case"string":return b;case"number":return`i${b}`;default:throw new Error("invalid message type.")}}}n.Room=z},12495:(b,n)=>{"use strict";let i;function e(){if(!i)try{i="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(b){}return i||(i={cache:{},setItem:function(b,n){this.cache[b]=n},getItem:function(b){this.cache[b]},removeItem:function(b){delete this.cache[b]}}),i}Object.defineProperty(n,"__esModule",{value:!0}),n.getItem=n.removeItem=n.setItem=void 0,n.setItem=function(b,n){e().setItem(b,n)},n.removeItem=function(b){e().removeItem(b)},n.getItem=function(b,n){const i=e().getItem(b);"undefined"!==typeof Promise&&i instanceof Promise?i.then((b=>n(b))):n(i)}},12465:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createNanoEvents=void 0;n.createNanoEvents=()=>({emit(b){let n=this.events[b]||[];for(var i=arguments.length,e=new Array(i>1?i-1:0),V=1;V<i;V++)e[V-1]=arguments[V];for(let Q=0,U=n.length;Q<U;Q++)n[Q](...e)},events:{},on(b,n){var i;return(null===(i=this.events[b])||void 0===i?void 0:i.push(n))||(this.events[b]=[n]),()=>{var i;this.events[b]=null===(i=this.events[b])||void 0===i?void 0:i.filter((b=>n!==b))}}})},12470:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createSignal=n.EventEmitter=void 0;class i{constructor(){this.handlers=[]}register(b){return this.handlers.push(b),this}invoke(){for(var b=arguments.length,n=new Array(b),i=0;i<b;i++)n[i]=arguments[i];this.handlers.forEach((b=>b.apply(this,n)))}invokeAsync(){for(var b=arguments.length,n=new Array(b),i=0;i<b;i++)n[i]=arguments[i];return Promise.all(this.handlers.map((b=>b.apply(this,n))))}remove(b){const n=this.handlers.indexOf(b);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}n.EventEmitter=i,n.createSignal=function(){const b=new i;function n(n){return b.register(n,null===this)}return n.once=n=>{const i=function(){for(var e=arguments.length,V=new Array(e),Q=0;Q<e;Q++)V[Q]=arguments[Q];n.apply(this,V),b.remove(i)};b.register(i)},n.remove=n=>b.remove(n),n.invoke=function(){return b.invoke(...arguments)},n.invokeAsync=function(){return b.invokeAsync(...arguments)},n.clear=()=>b.clear(),n}},12422:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ServerError=n.CloseCode=void 0,function(b){b[b.CONSENTED=4e3]="CONSENTED",b[b.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(n.CloseCode||(n.CloseCode={}));class i extends Error{constructor(b,n){super(n),this.name="ServerError",this.code=b}}n.ServerError=i},12399:(b,n,i)=>{"use strict";n.e=void 0,i(12406);var e=i(12413);Object.defineProperty(n,"e",{enumerable:!0,get:function(){return e.Client}});var V=i(12453);var Q=i(12426);var U=i(12489);const Y=i(12506);const L=i(12512),B=i(12459);(0,B.registerSerializer)("schema",Y.SchemaSerializer),(0,B.registerSerializer)("none",L.NoneSerializer)},12406:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=b=>null!==b&&"object"===typeof b&&b.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12429:(b,n)=>{"use strict";function i(b,n){if(this._offset=n,b instanceof ArrayBuffer)this._buffer=b,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(b))throw new Error("Invalid argument");this._buffer=b.buffer,this._view=new DataView(this._buffer,b.byteOffset,b.byteLength)}}Object.defineProperty(n,"__esModule",{value:!0}),n.decode=n.encode=void 0,i.prototype._array=function(b){for(var n=new Array(b),i=0;i<b;i++)n[i]=this._parse();return n},i.prototype._map=function(b){for(var n={},i=0;i<b;i++)n[this._parse()]=this._parse();return n},i.prototype._str=function(b){var n=function(b,n,i){for(var e="",V=0,Q=n,U=n+i;Q<U;Q++){var Y=b.getUint8(Q);if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(V=(7&Y)<<18|(63&b.getUint8(++Q))<<12|(63&b.getUint8(++Q))<<6|63&b.getUint8(++Q))>=65536?(V-=65536,e+=String.fromCharCode(55296+(V>>>10),56320+(1023&V))):e+=String.fromCharCode(V)}else e+=String.fromCharCode((15&Y)<<12|(63&b.getUint8(++Q))<<6|63&b.getUint8(++Q));else e+=String.fromCharCode((31&Y)<<6|63&b.getUint8(++Q));else e+=String.fromCharCode(Y)}return e}(this._view,this._offset,b);return this._offset+=b,n},i.prototype._bin=function(b){var n=this._buffer.slice(this._offset,this._offset+b);return this._offset+=b,n},i.prototype._parse=function(){var b,n=this._view.getUint8(this._offset++),i=0,e=0,V=0,Q=0;if(n<192)return n<128?n:n<144?this._map(15&n):n<160?this._array(15&n):this._str(31&n);if(n>223)return-1*(255-n+1);switch(n){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),e=this._view.getInt8(this._offset+1),this._offset+=2,-1===e){var U=this._view.getUint32(this._offset);return V=this._view.getInt32(this._offset+4),Q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*V+Q)+U/1e6)}return[e,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),e=this._view.getInt8(this._offset+2),this._offset+=3,[e,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),e=this._view.getInt8(this._offset+4),this._offset+=5,[e,this._bin(i)];case 202:return b=this._view.getFloat32(this._offset),this._offset+=4,b;case 203:return b=this._view.getFloat64(this._offset),this._offset+=8,b;case 204:return b=this._view.getUint8(this._offset),this._offset+=1,b;case 205:return b=this._view.getUint16(this._offset),this._offset+=2,b;case 206:return b=this._view.getUint32(this._offset),this._offset+=4,b;case 207:return V=this._view.getUint32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,V+Q;case 208:return b=this._view.getInt8(this._offset),this._offset+=1,b;case 209:return b=this._view.getInt16(this._offset),this._offset+=2,b;case 210:return b=this._view.getInt32(this._offset),this._offset+=4,b;case 211:return V=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,V+Q;case 212:return e=this._view.getInt8(this._offset),this._offset+=1,0===e?void(this._offset+=1):[e,this._bin(1)];case 213:return e=this._view.getInt8(this._offset),this._offset+=1,[e,this._bin(2)];case 214:return e=this._view.getInt8(this._offset),this._offset+=1,-1===e?(b=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*b)):[e,this._bin(4)];case 215:return e=this._view.getInt8(this._offset),this._offset+=1,0===e?(V=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(V+Q)):-1===e?(V=this._view.getUint32(this._offset),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&V)+Q)+(V>>>2)/1e6)):[e,this._bin(8)];case 216:return e=this._view.getInt8(this._offset),this._offset+=1,[e,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},n.decode=function(b){var n=new i(b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),e=n._parse();if(n._offset!==b.byteLength)throw new Error(b.byteLength-n._offset+" trailing bytes");return e};function e(b,n,i){for(var e=0,V=0,Q=i.length;V<Q;V++)(e=i.charCodeAt(V))<128?b.setUint8(n++,e):e<2048?(b.setUint8(n++,192|e>>6),b.setUint8(n++,128|63&e)):e<55296||e>=57344?(b.setUint8(n++,224|e>>12),b.setUint8(n++,128|e>>6&63),b.setUint8(n++,128|63&e)):(V++,e=65536+((1023&e)<<10|1023&i.charCodeAt(V)),b.setUint8(n++,240|e>>18),b.setUint8(n++,128|e>>12&63),b.setUint8(n++,128|e>>6&63),b.setUint8(n++,128|63&e))}function V(b,n,i){var e=typeof i,Q=0,U=0,Y=0,L=0,B=0,mb=0;if("string"===e){if(B=function(b){for(var n=0,i=0,e=0,V=b.length;e<V;e++)(n=b.charCodeAt(e))<128?i+=1:n<2048?i+=2:n<55296||n>=57344?i+=3:(e++,i+=4);return i}(i),B<32)b.push(160|B),mb=1;else if(B<256)b.push(217,B),mb=2;else if(B<65536)b.push(218,B>>8,B),mb=3;else{if(!(B<4294967296))throw new Error("String too long");b.push(219,B>>24,B>>16,B>>8,B),mb=5}return n.push({_str:i,_length:B,_offset:b.length}),mb+B}if("number"===e)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(b.push(i),1):i<256?(b.push(204,i),2):i<65536?(b.push(205,i>>8,i),3):i<4294967296?(b.push(206,i>>24,i>>16,i>>8,i),5):(Y=i/Math.pow(2,32)|0,L=i>>>0,b.push(207,Y>>24,Y>>16,Y>>8,Y,L>>24,L>>16,L>>8,L),9):i>=-32?(b.push(i),1):i>=-128?(b.push(208,i),2):i>=-32768?(b.push(209,i>>8,i),3):i>=-2147483648?(b.push(210,i>>24,i>>16,i>>8,i),5):(Y=Math.floor(i/Math.pow(2,32)),L=i>>>0,b.push(211,Y>>24,Y>>16,Y>>8,Y,L>>24,L>>16,L>>8,L),9):(b.push(203),n.push({_float:i,_length:8,_offset:b.length}),9);if("object"===e){if(null===i)return b.push(192),1;if(Array.isArray(i)){if((B=i.length)<16)b.push(144|B),mb=1;else if(B<65536)b.push(220,B>>8,B),mb=3;else{if(!(B<4294967296))throw new Error("Array too large");b.push(221,B>>24,B>>16,B>>8,B),mb=5}for(Q=0;Q<B;Q++)mb+=V(b,n,i[Q]);return mb}if(i instanceof Date){var N=i.getTime(),Z=Math.floor(N/1e3),T=1e6*(N-1e3*Z);return Z>=0&&T>=0&&Z<=17179869183?0===T&&Z<=4294967295?(b.push(214,255,Z>>24,Z>>16,Z>>8,Z),6):(Y=Z/4294967296,L=4294967295&Z,b.push(215,255,T>>22,T>>14,T>>6,Y,L>>24,L>>16,L>>8,L),10):(Y=Math.floor(Z/4294967296),L=Z>>>0,b.push(199,12,255,T>>24,T>>16,T>>8,T,Y>>24,Y>>16,Y>>8,Y,L>>24,L>>16,L>>8,L),15)}if(i instanceof ArrayBuffer){if((B=i.byteLength)<256)b.push(196,B),mb=2;else if(B<65536)b.push(197,B>>8,B),mb=3;else{if(!(B<4294967296))throw new Error("Buffer too large");b.push(198,B>>24,B>>16,B>>8,B),mb=5}return n.push({_bin:i,_length:B,_offset:b.length}),mb+B}if("function"===typeof i.toJSON)return V(b,n,i.toJSON());var z=[],K="",I=Object.keys(i);for(Q=0,U=I.length;Q<U;Q++)void 0!==i[K=I[Q]]&&"function"!==typeof i[K]&&z.push(K);if((B=z.length)<16)b.push(128|B),mb=1;else if(B<65536)b.push(222,B>>8,B),mb=3;else{if(!(B<4294967296))throw new Error("Object too large");b.push(223,B>>24,B>>16,B>>8,B),mb=5}for(Q=0;Q<B;Q++)mb+=V(b,n,K=z[Q]),mb+=V(b,n,i[K]);return mb}if("boolean"===e)return b.push(i?195:194),1;if("undefined"===e)return b.push(192),1;if("function"===typeof i.toJSON)return V(b,n,i.toJSON());throw new Error("Could not encode")}n.encode=function(b){var n=[],i=[],Q=V(n,i,b),U=new ArrayBuffer(Q),Y=new DataView(U),L=0,B=0,mb=-1;i.length>0&&(mb=i[0]._offset);for(var N,Z=0,T=0,z=0,K=n.length;z<K;z++)if(Y.setUint8(B+z,n[z]),z+1===mb){if(Z=(N=i[L])._length,T=B+mb,N._bin)for(var I=new Uint8Array(N._bin),O=0;O<Z;O++)Y.setUint8(T+O,I[O]);else N._str?e(Y,T,N._str):void 0!==N._float&&Y.setFloat64(T,N._float);B+=Z,i[++L]&&(mb=i[L]._offset)}return U}},12512:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NoneSerializer=void 0;n.NoneSerializer=class{setState(b){}getState(){return null}patch(b){}teardown(){}handshake(b){}}},12506:(b,n,i)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SchemaSerializer=void 0;const e=i(12473);n.SchemaSerializer=class{setState(b){return this.state.decode(b)}getState(){return this.state}patch(b){return this.state.decode(b)}teardown(){var b,n;null===(n=null===(b=this.state)||void 0===b?void 0:b.$changes)||void 0===n||n.root.clearRefs()}handshake(b,n){if(this.state){(new e.Reflection).decode(b,n)}else this.state=e.Reflection.decode(b,n)}}},12459:(b,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getSerializer=n.registerSerializer=void 0;const i={};n.registerSerializer=function(b,n){i[b]=n},n.getSerializer=function(b){const n=i[b];if(!n)throw new Error("missing serializer: "+b);return n}},12440:function(b,n,i){"use strict";var e=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketTransport=void 0;const V=e(i(12446)),Q=globalThis.WebSocket||V.default;n.WebSocketTransport=class{constructor(b){this.events=b}send(b){b instanceof ArrayBuffer?this.ws.send(b):Array.isArray(b)&&this.ws.send(new Uint8Array(b).buffer)}connect(b,n){try{this.ws=new Q(b,{headers:n,protocols:this.protocols})}catch(i){this.ws=new Q(b,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(b,n){this.ws.close(b,n)}get isOpen(){return this.ws.readyState===Q.OPEN}}},12446:b=>{"use strict";b.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12886:b=>{"use strict";b.exports=function(b){for(var n=new Array(b),i=0;i<b;++i)n[i]=i;return n}},12891:b=>{function n(b){return!!b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}b.exports=function(b){return null!=b&&(n(b)||function(b){return"function"===typeof b.readFloatLE&&"function"===typeof b.slice&&n(b.slice(0,0))}(b)||!!b._isBuffer)}},12881:(b,n,i)=>{var e=i(12886),V=i(12891),Q="undefined"!==typeof Float64Array;function U(b,n){return b[0]-n[0]}function Y(){var b,n=this.stride,i=new Array(n.length);for(b=0;b<i.length;++b)i[b]=[Math.abs(n[b]),b];i.sort(U);var e=new Array(i.length);for(b=0;b<e.length;++b)e[b]=i[b][1];return e}function L(b,n){var i=["View",n,"d",b].join("");n<0&&(i="View_Nil"+b);var V="generic"===b;if(-1===n){var Q="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(Q)()}if(0===n){Q="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(V?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(V?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",Q)(B[b][0])}Q=["'use strict'"];var U=e(n),L=U.map((function(b){return"i"+b})),mb="this.offset+"+U.map((function(b){return"this.stride["+b+"]*i"+b})).join("+"),N=U.map((function(b){return"b"+b})).join(","),Z=U.map((function(b){return"c"+b})).join(",");Q.push("function "+i+"(a,"+N+","+Z+",d){this.data=a","this.shape=["+N+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+b+"'","proto.dimension="+n),Q.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+U.map((function(b){return"this.shape["+b+"]"})).join("*"),"}})"),1===n?Q.push("proto.order=[0]"):(Q.push("Object.defineProperty(proto,'order',{get:"),n<4?(Q.push("function "+i+"_order(){"),2===n?Q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===n&&Q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Q.push("ORDER})")),Q.push("proto.set=function "+i+"_set("+L.join(",")+",v){"),V?Q.push("return this.data.set("+mb+",v)}"):Q.push("return this.data["+mb+"]=v}"),Q.push("proto.get=function "+i+"_get("+L.join(",")+"){"),V?Q.push("return this.data.get("+mb+")}"):Q.push("return this.data["+mb+"]}"),Q.push("proto.index=function "+i+"_index(",L.join(),"){return "+mb+"}"),Q.push("proto.hi=function "+i+"_hi("+L.join(",")+"){return new "+i+"(this.data,"+U.map((function(b){return["(typeof i",b,"!=='number'||i",b,"<0)?this.shape[",b,"]:i",b,"|0"].join("")})).join(",")+","+U.map((function(b){return"this.stride["+b+"]"})).join(",")+",this.offset)}");var T=U.map((function(b){return"a"+b+"=this.shape["+b+"]"})),z=U.map((function(b){return"c"+b+"=this.stride["+b+"]"}));Q.push("proto.lo=function "+i+"_lo("+L.join(",")+"){var b=this.offset,d=0,"+T.join(",")+","+z.join(","));for(var K=0;K<n;++K)Q.push("if(typeof i"+K+"==='number'&&i"+K+">=0){d=i"+K+"|0;b+=c"+K+"*d;a"+K+"-=d}");Q.push("return new "+i+"(this.data,"+U.map((function(b){return"a"+b})).join(",")+","+U.map((function(b){return"c"+b})).join(",")+",b)}"),Q.push("proto.step=function "+i+"_step("+L.join(",")+"){var "+U.map((function(b){return"a"+b+"=this.shape["+b+"]"})).join(",")+","+U.map((function(b){return"b"+b+"=this.stride["+b+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(K=0;K<n;++K)Q.push("if(typeof i"+K+"==='number'){d=i"+K+"|0;if(d<0){c+=b"+K+"*(a"+K+"-1);a"+K+"=ceil(-a"+K+"/d)}else{a"+K+"=ceil(a"+K+"/d)}b"+K+"*=d}");Q.push("return new "+i+"(this.data,"+U.map((function(b){return"a"+b})).join(",")+","+U.map((function(b){return"b"+b})).join(",")+",c)}");var I=new Array(n),O=new Array(n);for(K=0;K<n;++K)I[K]="a[i"+K+"]",O[K]="b[i"+K+"]";Q.push("proto.transpose=function "+i+"_transpose("+L+"){"+L.map((function(b,n){return b+"=("+b+"===undefined?"+n+":"+b+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+I.join(",")+","+O.join(",")+",this.offset)}"),Q.push("proto.pick=function "+i+"_pick("+L+"){var a=[],b=[],c=this.offset");for(K=0;K<n;++K)Q.push("if(typeof i"+K+"==='number'&&i"+K+">=0){c=(c+this.stride["+K+"]*i"+K+")|0}else{a.push(this.shape["+K+"]);b.push(this.stride["+K+"])}");return Q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Q.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+U.map((function(b){return"shape["+b+"]"})).join(",")+","+U.map((function(b){return"stride["+b+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Q.join("\n"))(B[b],Y)}var B={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(b,n,i,e){if(void 0===b)return(0,B.array[0])([]);"number"===typeof b&&(b=[b]),void 0===n&&(n=[b.length]);var U=n.length;if(void 0===i){i=new Array(U);for(var Y=U-1,mb=1;Y>=0;--Y)i[Y]=mb,mb*=n[Y]}if(void 0===e){e=0;for(Y=0;Y<U;++Y)i[Y]<0&&(e-=(n[Y]-1)*i[Y])}for(var N=function(b){if(V(b))return"buffer";if(Q)switch(Object.prototype.toString.call(b)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(b)?"array":"generic"}(b),Z=B[N];Z.length<=U+1;)Z.push(L(N,Z.length-1));return(0,Z[U+1])(b,n,i,e)}},13935:b=>{var n;self,n=()=>(()=>{"use strict";var b={d:(n,i)=>{for(var e in i)b.o(i,e)&&!b.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:i[e]})},o:(b,n)=>Object.prototype.hasOwnProperty.call(b,n)},n={};b.d(n,{default:()=>t});var i,e=function(b,n){var i=n.x-b.x,e=n.y-b.y;return Math.sqrt(i*i+e*e)},V=function(b){return b*(Math.PI/180)},Q=new Map,U=function(b){Q.has(b)&&clearTimeout(Q.get(b)),Q.set(b,setTimeout(b,100))},Y=function(b,n,i){for(var e,V=n.split(/[ ,]+/g),Q=0;Q<V.length;Q+=1)e=V[Q],b.addEventListener?b.addEventListener(e,i,!1):b.attachEvent&&b.attachEvent(e,i)},L=function(b,n,i){for(var e,V=n.split(/[ ,]+/g),Q=0;Q<V.length;Q+=1)e=V[Q],b.removeEventListener?b.removeEventListener(e,i):b.detachEvent&&b.detachEvent(e,i)},B=function(b){return b.preventDefault(),b.type.match(/^touch/)?b.changedTouches:b},mb=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},N=function(b,n){n.top||n.right||n.bottom||n.left?(b.style.top=n.top,b.style.right=n.right,b.style.bottom=n.bottom,b.style.left=n.left):(b.style.left=n.x+"px",b.style.top=n.y+"px")},Z=function(b,n,i){var e=T(b);for(var V in e)if(e.hasOwnProperty(V))if("string"==typeof n)e[V]=n+" "+i;else{for(var Q="",U=0,Y=n.length;U<Y;U+=1)Q+=n[U]+" "+i+", ";e[V]=Q.slice(0,-2)}return e},T=function(b){var n={};return n[b]="",["webkit","Moz","o"].forEach((function(i){n[i+b.charAt(0).toUpperCase()+b.slice(1)]=""})),n},z=function(b,n){for(var i in n)n.hasOwnProperty(i)&&(b[i]=n[i]);return b},K=function(b,n){if(b.length)for(var i=0,e=b.length;i<e;i+=1)n(b[i]);else n(b)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,O=window.matchMedia("(any-hover: none)").matches,u=!!("ontouchstart"in window),d=!!window.PointerEvent,G=!!window.MSPointerEvent,o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},M={start:"mousedown",move:"mousemove",end:"mouseup"},j={};function a(){}I&&!O?i=o:d?i={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:G?i={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:u?(i=o,j=M):i=M,a.prototype.on=function(b,n){var i,e=this,V=b.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(var Q=0;Q<V.length;Q+=1)i=V[Q],e._handlers_[i]=e._handlers_[i]||[],e._handlers_[i].push(n);return e},a.prototype.off=function(b,n){var i=this;return i._handlers_=i._handlers_||{},void 0===b?i._handlers_={}:void 0===n?i._handlers_[b]=null:i._handlers_[b]&&i._handlers_[b].indexOf(n)>=0&&i._handlers_[b].splice(i._handlers_[b].indexOf(n),1),i},a.prototype.trigger=function(b,n){var i,e=this,V=b.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(var Q=0;Q<V.length;Q+=1)i=V[Q],e._handlers_[i]&&e._handlers_[i].length&&e._handlers_[i].forEach((function(b){b.call(e,{type:i,target:e},n)}))},a.prototype.config=function(b){var n=this;n.options=n.defaults||{},b&&(n.options=function(b,n){var i={};for(var e in b)b.hasOwnProperty(e)&&n.hasOwnProperty(e)?i[e]=n[e]:b.hasOwnProperty(e)&&(i[e]=b[e]);return i}(n.options,b))},a.prototype.bindEvt=function(b,n){var e=this;return e._domHandlers_=e._domHandlers_||{},e._domHandlers_[n]=function(){"function"==typeof e["on"+n]?e["on"+n].apply(e,arguments):console.warn('[WARNING] : Missing "on'+n+'" handler.')},Y(b,i[n],e._domHandlers_[n]),j[n]&&Y(b,j[n],e._domHandlers_[n]),e},a.prototype.unbindEvt=function(b,n){var e=this;return e._domHandlers_=e._domHandlers_||{},L(b,i[n],e._domHandlers_[n]),j[n]&&L(b,j[n],e._domHandlers_[n]),delete e._domHandlers_[n],this};const D=a;function x(b,n){return this.identifier=n.identifier,this.position=n.position,this.frontPosition=n.frontPosition,this.collection=b,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(n),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=x.id,x.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}x.prototype=new D,x.constructor=x,x.id=0,x.prototype.buildEl=function(b){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},x.prototype.stylize=function(){if(this.options.dataOnly)return this;var b=this.options.fadeTime+"ms",n=function(){var b=T("borderRadius");for(var n in b)b.hasOwnProperty(n)&&(b[n]="50%");return b}(),i=Z("transition","opacity",b),e={};return e.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},e.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},e.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},z(e.el,i),"circle"===this.options.shape&&z(e.back,n),z(e.front,n),this.applyStyles(e),this},x.prototype.applyStyles=function(b){for(var n in this.ui)if(this.ui.hasOwnProperty(n))for(var i in b[n])this.ui[n].style[i]=b[n][i];return this},x.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},x.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},x.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},x.prototype.show=function(b){var n=this;return n.options.dataOnly||(clearTimeout(n.removeTimeout),clearTimeout(n.showTimeout),clearTimeout(n.restTimeout),n.addToDom(),n.restCallback(),setTimeout((function(){n.ui.el.style.opacity=1}),0),n.showTimeout=setTimeout((function(){n.trigger("shown",n.instance),"function"==typeof b&&b.call(this)}),n.options.fadeTime)),n},x.prototype.hide=function(b){var n=this;if(n.options.dataOnly)return n;if(n.ui.el.style.opacity=n.options.restOpacity,clearTimeout(n.removeTimeout),clearTimeout(n.showTimeout),clearTimeout(n.restTimeout),n.removeTimeout=setTimeout((function(){var i="dynamic"===n.options.mode?"none":"block";n.ui.el.style.display=i,"function"==typeof b&&b.call(n),n.trigger("hidden",n.instance)}),n.options.fadeTime),n.options.restJoystick){var i=n.options.restJoystick,e={};e.x=!0===i||!1!==i.x?0:n.instance.frontPosition.x,e.y=!0===i||!1!==i.y?0:n.instance.frontPosition.y,n.setPosition(b,e)}return n},x.prototype.setPosition=function(b,n){var i=this;i.frontPosition={x:n.x,y:n.y};var e=i.options.fadeTime+"ms",V={};V.front=Z("transition",["transform"],e);var Q={front:{}};Q.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(V),i.applyStyles(Q),i.restTimeout=setTimeout((function(){"function"==typeof b&&b.call(i),i.restCallback()}),i.options.fadeTime)},x.prototype.restCallback=function(){var b=this,n={};n.front=Z("transition","none",""),b.applyStyles(n),b.trigger("rested",b.instance)},x.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},x.prototype.computeDirection=function(b){var n,i,e,V=b.angle.radian,Q=Math.PI/4,U=Math.PI/2;if(V>Q&&V<3*Q&&!b.lockX?n="up":V>-Q&&V<=Q&&!b.lockY?n="left":V>3*-Q&&V<=-Q&&!b.lockX?n="down":b.lockY||(n="right"),b.lockY||(i=V>-U&&V<U?"left":"right"),b.lockX||(e=V>0?"up":"down"),b.force>this.options.threshold){var Y,L={};for(Y in this.direction)this.direction.hasOwnProperty(Y)&&(L[Y]=this.direction[Y]);var B={};for(Y in this.direction={x:i,y:e,angle:n},b.direction=this.direction,L)L[Y]===this.direction[Y]&&(B[Y]=!0);if(B.x&&B.y&&B.angle)return b;B.x&&B.y||this.trigger("plain",b),B.x||this.trigger("plain:"+i,b),B.y||this.trigger("plain:"+e,b),B.angle||this.trigger("dir dir:"+n,b)}else this.resetDirection();return b};const y=x;function s(b,n){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=b,i.id=s.id,s.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(n),"static"!==i.options.mode&&"semi"!==i.options.mode||(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);var e=getComputedStyle(i.options.zone.parentElement);return e&&"flex"===e.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.fN(),i.begin(),i.nipples}s.prototype=new D,s.constructor=s,s.id=0,s.prototype.prepareNipples=function(){var b=this,n=b.nipples;n.on=b.on.bind(b),n.off=b.off.bind(b),n.options=b.options,n.destroy=b.destroy.bind(b),n.ids=b.ids,n.id=b.id,n.processOnMove=b.processOnMove.bind(b),n.processOnEnd=b.processOnEnd.bind(b),n.get=function(b){if(void 0===b)return n[0];for(var i=0,e=n.length;i<e;i+=1)if(n[i].identifier===b)return n[i];return!1}},s.prototype.fN=function(){var b=this;b.bindEvt(b.options.zone,"start"),b.options.zone.style.touchAction="none",b.options.zone.style.msTouchAction="none"},s.prototype.begin=function(){var b=this,n=b.options;if("static"===n.mode){var i=b.createNipple(n.position,b.manager.getIdentifier());i.add(),b.idles.push(i)}},s.prototype.createNipple=function(b,n){var i=this,e=i.manager.scroll,V={},Q=i.options,U=i.parentIsFlex?e.x:e.x+i.box.left,Y=i.parentIsFlex?e.y:e.y+i.box.top;if(b.x&&b.y)V={x:b.x-U,y:b.y-Y};else if(b.top||b.right||b.bottom||b.left){var L=document.createElement("DIV");L.style.display="hidden",L.style.top=b.top,L.style.right=b.right,L.style.bottom=b.bottom,L.style.left=b.left,L.style.position="absolute",Q.zone.appendChild(L);var B=L.getBoundingClientRect();Q.zone.removeChild(L),V=b,b={x:B.left+e.x,y:B.top+e.y}}var mb=new y(i,{color:Q.color,size:Q.size,threshold:Q.threshold,fadeTime:Q.fadeTime,dataOnly:Q.dataOnly,restJoystick:Q.restJoystick,restOpacity:Q.restOpacity,mode:Q.mode,identifier:n,position:b,zone:Q.zone,frontPosition:{x:0,y:0},shape:Q.shape});return Q.dataOnly||(N(mb.ui.el,V),N(mb.ui.front,mb.frontPosition)),i.nipples.push(mb),i.trigger("added "+mb.identifier+":added",mb),i.manager.trigger("added "+mb.identifier+":added",mb),i.bindNipple(mb),mb},s.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},s.prototype.bindNipple=function(b){var n,i=this,e=function(b,e){n=b.type+" "+e.id+":"+b.type,i.trigger(n,e)};b.on("destroyed",i.onDestroyed.bind(i)),b.on("shown hidden rested dir plain",e),b.on("dir:up dir:right dir:down dir:left",e),b.on("plain:up plain:right plain:down plain:left",e)},s.prototype.pressureFn=function(b,n,i){var e=this,V=0;clearInterval(e.pressureIntervals[i]),e.pressureIntervals[i]=setInterval(function(){var i=b.force||b.pressure||b.webkitForce||0;i!==V&&(n.trigger("pressure",i),e.trigger("pressure "+n.identifier+":pressure",i),V=i)}.bind(e),100)},s.prototype.onstart=function(b){var n=this,i=n.options,e=b;return b=B(b),n.updateBox(),K(b,(function(V){n.actives.length<i.maxNumberOfNipples?n.processOnStart(V):e.type.match(/^touch/)&&(Object.keys(n.manager.ids).forEach((function(i){if(Object.values(e.touches).findIndex((function(b){return b.identifier===i}))<0){var V=[b[0]];V.identifier=i,n.processOnEnd(V)}})),n.actives.length<i.maxNumberOfNipples&&n.processOnStart(V))})),n.manager.bindDocument(),!1},s.prototype.processOnStart=function(b){var n,i=this,V=i.options,Q=i.manager.getIdentifier(b),U=b.force||b.pressure||b.webkitForce||0,Y={x:b.pageX,y:b.pageY},L=i.getOrCreate(Q,Y);L.identifier!==Q&&i.manager.removeIdentifier(L.identifier),L.identifier=Q;var B=function(n){n.trigger("start",n),i.trigger("start "+n.id+":start",n),n.show(),U>0&&i.pressureFn(b,n,n.identifier),i.processOnMove(b)};if((n=i.idles.indexOf(L))>=0&&i.idles.splice(n,1),i.actives.push(L),i.ids.push(L.identifier),"semi"!==V.mode)B(L);else{if(!(e(Y,L.position)<=V.catchDistance))return L.destroy(),void i.processOnStart(b);B(L)}return L},s.prototype.getOrCreate=function(b,n){var i,e=this,V=e.options;return/(semi|static)/.test(V.mode)?(i=e.idles[0])?(e.idles.splice(0,1),i):"semi"===V.mode?e.createNipple(n,b):(console.warn("Coudln't find the needed nipple."),!1):i=e.createNipple(n,b)},s.prototype.processOnMove=function(b){var n=this,i=n.options,Q=n.manager.getIdentifier(b),U=n.nipples.get(Q),Y=n.manager.scroll;if(function(b){return isNaN(b.buttons)?0!==b.pressure:0!==b.buttons}(b)){if(!U)return console.error("Found zombie joystick with ID "+Q),void n.manager.removeIdentifier(Q);if(i.dynamicPage){var L=U.el.getBoundingClientRect();U.position={x:Y.x+L.left,y:Y.y+L.top}}U.identifier=Q;var B=U.options.size/2,mb={x:b.pageX,y:b.pageY};i.lockX&&(mb.y=U.position.y),i.lockY&&(mb.x=U.position.x);var N,Z,T,z,K,I,O,u,d,G,o=e(mb,U.position),M=(N=mb,T=(Z=U.position).x-N.x,z=Z.y-N.y,function(b){return b*(180/Math.PI)}(Math.atan2(z,T))),j=V(M),a=o/B,D={distance:o,position:mb};if("circle"===U.options.shape?(K=Math.min(o,B),O=U.position,u=K,G={x:0,y:0},d=V(d=M),G.x=O.x-u*Math.cos(d),G.y=O.y-u*Math.sin(d),I=G):(I=function(b,n,i){return{x:Math.min(Math.max(b.x,n.x-i),n.x+i),y:Math.min(Math.max(b.y,n.y-i),n.y+i)}}(mb,U.position,B),K=e(I,U.position)),i.follow){if(o>B){var x=mb.x-I.x,y=mb.y-I.y;U.position.x+=x,U.position.y+=y,U.el.style.top=U.position.y-(n.box.top+Y.y)+"px",U.el.style.left=U.position.x-(n.box.left+Y.x)+"px",o=e(mb,U.position)}}else mb=I,o=K;var s=mb.x-U.position.x,A=mb.y-U.position.y;U.frontPosition={x:s,y:A},i.dataOnly||(U.ui.front.style.transform="translate("+s+"px,"+A+"px)");var E={identifier:U.identifier,position:mb,force:a,pressure:b.force||b.pressure||b.webkitForce||0,distance:o,angle:{radian:j,degree:M},vector:{x:s/B,y:-A/B},raw:D,instance:U,lockX:i.lockX,lockY:i.lockY};(E=U.computeDirection(E)).angle={radian:V(180-M),degree:180-M},U.trigger("move",E),n.trigger("move "+U.id+":move",E)}else this.processOnEnd(b)},s.prototype.processOnEnd=function(b){var n=this,i=n.options,e=n.manager.getIdentifier(b),V=n.nipples.get(e),Q=n.manager.removeIdentifier(V.identifier);V&&(i.dataOnly||V.hide((function(){"dynamic"===i.mode&&(V.trigger("removed",V),n.trigger("removed "+V.id+":removed",V),n.manager.trigger("removed "+V.id+":removed",V),V.destroy())})),clearInterval(n.pressureIntervals[V.identifier]),V.resetDirection(),V.trigger("end",V),n.trigger("end "+V.id+":end",V),n.ids.indexOf(V.identifier)>=0&&n.ids.splice(n.ids.indexOf(V.identifier),1),n.actives.indexOf(V)>=0&&n.actives.splice(n.actives.indexOf(V),1),/(semi|static)/.test(i.mode)?n.idles.push(V):n.nipples.indexOf(V)>=0&&n.nipples.splice(n.nipples.indexOf(V),1),n.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(n.manager.ids[Q.id]=Q.identifier))},s.prototype.onDestroyed=function(b,n){var i=this;i.nipples.indexOf(n)>=0&&i.nipples.splice(i.nipples.indexOf(n),1),i.actives.indexOf(n)>=0&&i.actives.splice(i.actives.indexOf(n),1),i.idles.indexOf(n)>=0&&i.idles.splice(i.idles.indexOf(n),1),i.ids.indexOf(n.identifier)>=0&&i.ids.splice(i.ids.indexOf(n.identifier),1),i.manager.removeIdentifier(n.identifier),i.manager.unbindDocument()},s.prototype.destroy=function(){var b=this;for(var n in b.unbindEvt(b.options.zone,"start"),b.nipples.forEach((function(b){b.destroy()})),b.pressureIntervals)b.pressureIntervals.hasOwnProperty(n)&&clearInterval(b.pressureIntervals[n]);b.trigger("destroyed",b.nipples),b.manager.unbindDocument(),b.off()};const A=s;function E(b){var n=this;n.ids={},n.index=0,n.collections=[],n.scroll=mb(),n.config(b),n.prepareCollections();var i=function(){var b;n.collections.forEach((function(i){i.forEach((function(i){b=i.el.getBoundingClientRect(),i.position={x:n.scroll.x+b.left,y:n.scroll.y+b.top}}))}))};Y(window,"resize",(function(){U(i)}));var e=function(){n.scroll=mb()};return Y(window,"scroll",(function(){U(e)})),n.collections}E.prototype=new D,E.constructor=E,E.prototype.prepareCollections=function(){var b=this;b.collections.create=b.create.bind(b),b.collections.on=b.on.bind(b),b.collections.off=b.off.bind(b),b.collections.destroy=b.destroy.bind(b),b.collections.get=function(n){var i;return b.collections.every((function(b){return!(i=b.get(n))})),i}},E.prototype.create=function(b){return this.createCollection(b)},E.prototype.createCollection=function(b){var n=this,i=new A(n,b);return n.bindCollection(i),n.collections.push(i),i},E.prototype.bindCollection=function(b){var n,i=this,e=function(b,e){n=b.type+" "+e.id+":"+b.type,i.trigger(n,e)};b.on("destroyed",i.onDestroyed.bind(i)),b.on("shown hidden rested dir plain",e),b.on("dir:up dir:right dir:down dir:left",e),b.on("plain:up plain:right plain:down plain:left",e)},E.prototype.bindDocument=function(){var b=this;b.binded||(b.bindEvt(document,"move").bindEvt(document,"end"),b.binded=!0)},E.prototype.unbindDocument=function(b){var n=this;Object.keys(n.ids).length&&!0!==b||(n.unbindEvt(document,"move").unbindEvt(document,"end"),n.binded=!1)},E.prototype.getIdentifier=function(b){var n;return b?void 0===(n=void 0===b.identifier?b.pointerId:b.identifier)&&(n=this.latest||0):n=this.index,void 0===this.ids[n]&&(this.ids[n]=this.index,this.index+=1),this.latest=n,this.ids[n]},E.prototype.removeIdentifier=function(b){var n={};for(var i in this.ids)if(this.ids[i]===b){n.id=i,n.identifier=this.ids[i],delete this.ids[i];break}return n},E.prototype.onmove=function(b){return this.onAny("move",b),!1},E.prototype.onend=function(b){return this.onAny("end",b),!1},E.prototype.oncancel=function(b){return this.onAny("end",b),!1},E.prototype.onAny=function(b,n){var i,e=this,V="processOn"+b.charAt(0).toUpperCase()+b.slice(1);n=B(n);var Q=function(b,n,i){i.ids.indexOf(n)>=0&&(i[V](b),b._found_=!0)};return K(n,(function(b){i=e.getIdentifier(b),K(e.collections,Q.bind(null,b,i)),b._found_||e.removeIdentifier(i)})),!1},E.prototype.destroy=function(){var b=this;b.unbindDocument(!0),b.ids={},b.index=0,b.collections.forEach((function(b){b.destroy()})),b.off()},E.prototype.onDestroyed=function(b,n){var i=this;if(i.collections.indexOf(n)<0)return!1;i.collections.splice(i.collections.indexOf(n),1)};var C=new E;const t={create:function(b){return C.create(b)},factory:C};return n.default})(),b.exports=n()},12910:(b,n,i)=>{"use strict";const{Deflate:e,deflate:V,deflateRaw:Q,gzip:U}=i(12914),{Inflate:Y,inflate:L,inflateRaw:B,ungzip:mb}=i(12973),N=i(12950);b.exports.Deflate=e,b.exports.deflate=V,b.exports.deflateRaw=Q,b.exports.gzip=U,b.exports.Inflate=Y,b.exports.inflate=L,b.exports.inflateRaw=B,b.exports.ungzip=mb,b.exports.constants=N},12914:(b,n,i)=>{"use strict";const e=i(12920),V=i(12953),Q=i(12961),U=i(12941),Y=i(12967),L=Object.prototype.toString,{Z_NO_FLUSH:B,Z_SYNC_FLUSH:mb,Z_FULL_FLUSH:N,Z_FINISH:Z,Z_OK:T,Z_STREAM_END:z,Z_DEFAULT_COMPRESSION:K,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:O}=i(12950);function u(b){this.options=V.assign({level:K,method:O,kb:16384,windowBits:15,memLevel:8,strategy:I},b||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.Zn="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let i=e.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==T)throw new Error(U[i]);if(n.header&&e.deflateSetHeader(this.strm,n.header),n.dictionary){let b;if(b="string"===typeof n.dictionary?Q.string2buf(n.dictionary):"[object ArrayBuffer]"===L.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,i=e.deflateSetDictionary(this.strm,b),i!==T)throw new Error(U[i]);this._dict_set=!0}}function d(b,n){const i=new u(n);if(i.push(b,!0),i.err)throw i.Zn||U[i.err];return i.result}u.prototype.push=function(b,n){const i=this.strm,V=this.options.kb;let U,Y;if(this.ended)return!1;for(Y=n===~~n?n:!0===n?Z:B,"string"===typeof b?i.input=Q.string2buf(b):"[object ArrayBuffer]"===L.call(b)?i.input=new Uint8Array(b):i.input=b,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(V),i.next_out=0,i.avail_out=V),(Y===mb||Y===N)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(U=e.deflate(i,Y),U===z)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),U=e.deflateEnd(this.strm),this.onEnd(U),this.ended=!0,U===T;if(0!==i.avail_out){if(Y>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},u.prototype.onData=function(b){this.chunks.push(b)},u.prototype.onEnd=function(b){b===T&&(this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.Zn=this.strm.Zn},b.exports.Deflate=u,b.exports.deflate=d,b.exports.deflateRaw=function(b,n){return(n=n||{}).raw=!0,d(b,n)},b.exports.gzip=function(b,n){return(n=n||{}).gzip=!0,d(b,n)},b.exports.constants=i(12950)},12973:(b,n,i)=>{"use strict";const e=i(12979),V=i(12953),Q=i(12961),U=i(12941),Y=i(12967),L=i(12999),B=Object.prototype.toString,{Z_NO_FLUSH:mb,Z_FINISH:N,Z_OK:Z,Z_STREAM_END:T,Z_NEED_DICT:z,Z_STREAM_ERROR:K,Z_DATA_ERROR:I,Z_MEM_ERROR:O}=i(12950);function u(b){this.options=V.assign({kb:65536,windowBits:15,to:""},b||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,0===n.windowBits&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||b&&b.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&0===(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.Zn="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let i=e.inflateInit2(this.strm,n.windowBits);if(i!==Z)throw new Error(U[i]);if(this.header=new L,e.inflateGetHeader(this.strm,this.header),n.dictionary&&("string"===typeof n.dictionary?n.dictionary=Q.string2buf(n.dictionary):"[object ArrayBuffer]"===B.call(n.dictionary)&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=e.inflateSetDictionary(this.strm,n.dictionary),i!==Z)))throw new Error(U[i])}function d(b,n){const i=new u(n);if(i.push(b),i.err)throw i.Zn||U[i.err];return i.result}u.prototype.push=function(b,n){const i=this.strm,V=this.options.kb,U=this.options.dictionary;let Y,L,u;if(this.ended)return!1;for(L=n===~~n?n:!0===n?N:mb,"[object ArrayBuffer]"===B.call(b)?i.input=new Uint8Array(b):i.input=b,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(V),i.next_out=0,i.avail_out=V),Y=e.inflate(i,L),Y===z&&U&&(Y=e.inflateSetDictionary(i,U),Y===Z?Y=e.inflate(i,L):Y===I&&(Y=z));i.avail_in>0&&Y===T&&i.state.wrap>0&&0!==b[i.next_in];)e.inflateReset(i),Y=e.inflate(i,L);switch(Y){case K:case I:case z:case O:return this.onEnd(Y),this.ended=!0,!1}if(u=i.avail_out,i.next_out&&(0===i.avail_out||Y===T))if("string"===this.options.to){let b=Q.utf8border(i.output,i.next_out),n=i.next_out-b,e=Q.buf2string(i.output,b);i.next_out=n,i.avail_out=V-n,n&&i.output.set(i.output.subarray(b,b+n),0),this.onData(e)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(Y!==Z||0!==u){if(Y===T)return Y=e.inflateEnd(this.strm),this.onEnd(Y),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},u.prototype.onData=function(b){this.chunks.push(b)},u.prototype.onEnd=function(b){b===Z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.Zn=this.strm.Zn},b.exports.Inflate=u,b.exports.inflate=d,b.exports.inflateRaw=function(b,n){return(n=n||{}).raw=!0,d(b,n)},b.exports.ungzip=d,b.exports.constants=i(12950)},12953:b=>{"use strict";const n=(b,n)=>Object.prototype.hasOwnProperty.call(b,n);b.exports.assign=function(b){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const e=i.shift();if(e){if("object"!==typeof e)throw new TypeError(e+"must be non-object");for(const i in e)n(e,i)&&(b[i]=e[i])}}return b},b.exports.flattenChunks=b=>{let n=0;for(let e=0,V=b.length;e<V;e++)n+=b[e].length;const i=new Uint8Array(n);for(let e=0,V=0,Q=b.length;e<Q;e++){let n=b[e];i.set(n,V),V+=n.length}return i}},12961:b=>{"use strict";let n=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){n=!1}const i=new Uint8Array(256);for(let V=0;V<256;V++)i[V]=V>=252?6:V>=248?5:V>=240?4:V>=224?3:V>=192?2:1;i[254]=i[254]=1,b.exports.string2buf=b=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(b);let n,i,e,V,Q,U=b.length,Y=0;for(V=0;V<U;V++)i=b.charCodeAt(V),55296===(64512&i)&&V+1<U&&(e=b.charCodeAt(V+1),56320===(64512&e)&&(i=65536+(i-55296<<10)+(e-56320),V++)),Y+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(Y),Q=0,V=0;Q<Y;V++)i=b.charCodeAt(V),55296===(64512&i)&&V+1<U&&(e=b.charCodeAt(V+1),56320===(64512&e)&&(i=65536+(i-55296<<10)+(e-56320),V++)),i<128?n[Q++]=i:i<2048?(n[Q++]=192|i>>>6,n[Q++]=128|63&i):i<65536?(n[Q++]=224|i>>>12,n[Q++]=128|i>>>6&63,n[Q++]=128|63&i):(n[Q++]=240|i>>>18,n[Q++]=128|i>>>12&63,n[Q++]=128|i>>>6&63,n[Q++]=128|63&i);return n};b.exports.buf2string=(b,e)=>{const V=e||b.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(b.subarray(0,e));let Q,U;const Y=new Array(2*V);for(U=0,Q=0;Q<V;){let n=b[Q++];if(n<128){Y[U++]=n;continue}let e=i[n];if(e>4)Y[U++]=65533,Q+=e-1;else{for(n&=2===e?31:3===e?15:7;e>1&&Q<V;)n=n<<6|63&b[Q++],e--;e>1?Y[U++]=65533:n<65536?Y[U++]=n:(n-=65536,Y[U++]=55296|n>>10&1023,Y[U++]=56320|1023&n)}}return((b,i)=>{if(i<65534&&b.subarray&&n)return String.fromCharCode.apply(null,b.length===i?b:b.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(b[n]);return e})(Y,U)},b.exports.utf8border=(b,n)=>{(n=n||b.length)>b.length&&(n=b.length);let e=n-1;for(;e>=0&&128===(192&b[e]);)e--;return e<0||0===e?n:e+i[b[e]]>n?e:n}},12930:b=>{"use strict";b.exports=(b,n,i,e)=>{let V=65535&b,Q=b>>>16&65535,U=0;for(;0!==i;){U=i>2e3?2e3:i,i-=U;do{V=V+n[e++]|0,Q=Q+V|0}while(--U);V%=65521,Q%=65521}return V|Q<<16}},12950:b=>{"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12938:b=>{"use strict";const n=new Uint32Array((()=>{let b,n=[];for(var i=0;i<256;i++){b=i;for(var e=0;e<8;e++)b=1&b?3988292384^b>>>1:b>>>1;n[i]=b}return n})());b.exports=(b,i,e,V)=>{const Q=n,U=V+e;b^=-1;for(let n=V;n<U;n++)b=b>>>8^Q[255&(b^i[n])];return~b}},12920:(b,n,i)=>{"use strict";const{_tr_init:e,_tr_stored_block:V,_tr_flush_block:Q,_tr_tally:U,_tr_align:Y}=i(12926),L=i(12930),B=i(12938),mb=i(12941),{Z_NO_FLUSH:N,Z_PARTIAL_FLUSH:Z,Z_FULL_FLUSH:T,Z_FINISH:z,Z_BLOCK:K,Z_OK:I,Z_STREAM_END:O,Z_STREAM_ERROR:u,Z_DATA_ERROR:d,Z_BUF_ERROR:G,Z_DEFAULT_COMPRESSION:o,Z_FILTERED:M,Z_HUFFMAN_ONLY:j,Z_RLE:a,Z_FIXED:D,Z_DEFAULT_STRATEGY:x,Z_UNKNOWN:y,Z_DEFLATED:s}=i(12950),A=258,E=262,C=103,t=113,w=666,h=(b,n)=>(b.Zn=mb[n],n),W=b=>(b<<1)-(b>4?9:0),J=b=>{let n=b.length;for(;--n>=0;)b[n]=0};let R=(b,n,i)=>(n<<b.hash_shift^i)&b.hash_mask;const k=b=>{const n=b.state;let i=n.pending;i>b.avail_out&&(i=b.avail_out),0!==i&&(b.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),b.next_out),b.next_out+=i,n.pending_out+=i,b.total_out+=i,b.avail_out-=i,n.pending-=i,0===n.pending&&(n.pending_out=0))},r=(b,n)=>{Q(b,b.block_start>=0?b.block_start:-1,b.strstart-b.block_start,n),b.block_start=b.strstart,k(b.strm)},X=(b,n)=>{b.pending_buf[b.pending++]=n},g=(b,n)=>{b.pending_buf[b.pending++]=n>>>8&255,b.pending_buf[b.pending++]=255&n},P=(b,n,i,e)=>{let V=b.avail_in;return V>e&&(V=e),0===V?0:(b.avail_in-=V,n.set(b.input.subarray(b.next_in,b.next_in+V),i),1===b.state.wrap?b.adler=L(b.adler,n,V,i):2===b.state.wrap&&(b.adler=B(b.adler,n,V,i)),b.next_in+=V,b.total_in+=V,V)},c=(b,n)=>{let i,e,V=b.max_chain_length,Q=b.strstart,U=b.prev_length,Y=b.nice_match;const L=b.strstart>b.w_size-E?b.strstart-(b.w_size-E):0,B=b.window,mb=b.w_mask,N=b.prev,Z=b.strstart+A;let T=B[Q+U-1],z=B[Q+U];b.prev_length>=b.good_match&&(V>>=2),Y>b.lookahead&&(Y=b.lookahead);do{if(i=n,B[i+U]===z&&B[i+U-1]===T&&B[i]===B[Q]&&B[++i]===B[Q+1]){Q+=2,i++;do{}while(B[++Q]===B[++i]&&B[++Q]===B[++i]&&B[++Q]===B[++i]&&B[++Q]===B[++i]&&B[++Q]===B[++i]&&B[++Q]===B[++i]&&B[++Q]===B[++i]&&B[++Q]===B[++i]&&Q<Z);if(e=A-(Z-Q),Q=Z-A,e>U){if(b.match_start=n,U=e,e>=Y)break;T=B[Q+U-1],z=B[Q+U]}}}while((n=N[n&mb])>L&&0!==--V);return U<=b.lookahead?U:b.lookahead},q=b=>{const n=b.w_size;let i,e,V,Q,U;do{if(Q=b.window_size-b.lookahead-b.strstart,b.strstart>=n+(n-E)){b.window.set(b.window.subarray(n,n+n),0),b.match_start-=n,b.strstart-=n,b.block_start-=n,e=b.hash_size,i=e;do{V=b.head[--i],b.head[i]=V>=n?V-n:0}while(--e);e=n,i=e;do{V=b.prev[--i],b.prev[i]=V>=n?V-n:0}while(--e);Q+=n}if(0===b.strm.avail_in)break;if(e=P(b.strm,b.window,b.strstart+b.lookahead,Q),b.lookahead+=e,b.lookahead+b.insert>=3)for(U=b.strstart-b.insert,b.ins_h=b.window[U],b.ins_h=R(b,b.ins_h,b.window[U+1]);b.insert&&(b.ins_h=R(b,b.ins_h,b.window[U+3-1]),b.prev[U&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=U,U++,b.insert--,!(b.lookahead+b.insert<3)););}while(b.lookahead<E&&0!==b.strm.avail_in)},S=(b,n)=>{let i,e;for(;;){if(b.lookahead<E){if(q(b),b.lookahead<E&&n===N)return 1;if(0===b.lookahead)break}if(i=0,b.lookahead>=3&&(b.ins_h=R(b,b.ins_h,b.window[b.strstart+3-1]),i=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),0!==i&&b.strstart-i<=b.w_size-E&&(b.match_length=c(b,i)),b.match_length>=3)if(e=U(b,b.strstart-b.match_start,b.match_length-3),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=3){b.match_length--;do{b.strstart++,b.ins_h=R(b,b.ins_h,b.window[b.strstart+3-1]),i=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart}while(0!==--b.match_length);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=R(b,b.ins_h,b.window[b.strstart+1]);else e=U(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(e&&(r(b,!1),0===b.strm.avail_out))return 1}return b.insert=b.strstart<2?b.strstart:2,n===z?(r(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(r(b,!1),0===b.strm.avail_out)?1:2},H=(b,n)=>{let i,e,V;for(;;){if(b.lookahead<E){if(q(b),b.lookahead<E&&n===N)return 1;if(0===b.lookahead)break}if(i=0,b.lookahead>=3&&(b.ins_h=R(b,b.ins_h,b.window[b.strstart+3-1]),i=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=2,0!==i&&b.prev_length<b.max_lazy_match&&b.strstart-i<=b.w_size-E&&(b.match_length=c(b,i),b.match_length<=5&&(b.strategy===M||3===b.match_length&&b.strstart-b.match_start>4096)&&(b.match_length=2)),b.prev_length>=3&&b.match_length<=b.prev_length){V=b.strstart+b.lookahead-3,e=U(b,b.strstart-1-b.prev_match,b.prev_length-3),b.lookahead-=b.prev_length-1,b.prev_length-=2;do{++b.strstart<=V&&(b.ins_h=R(b,b.ins_h,b.window[b.strstart+3-1]),i=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart)}while(0!==--b.prev_length);if(b.match_available=0,b.match_length=2,b.strstart++,e&&(r(b,!1),0===b.strm.avail_out))return 1}else if(b.match_available){if(e=U(b,0,b.window[b.strstart-1]),e&&r(b,!1),b.strstart++,b.lookahead--,0===b.strm.avail_out)return 1}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(e=U(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<2?b.strstart:2,n===z?(r(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(r(b,!1),0===b.strm.avail_out)?1:2};function l(b,n,i,e,V){this.good_length=b,this.max_lazy=n,this.nice_length=i,this.max_chain=e,this.func=V}const v=[new l(0,0,0,0,((b,n)=>{let i=65535;for(i>b.pending_buf_size-5&&(i=b.pending_buf_size-5);;){if(b.lookahead<=1){if(q(b),0===b.lookahead&&n===N)return 1;if(0===b.lookahead)break}b.strstart+=b.lookahead,b.lookahead=0;const e=b.block_start+i;if((0===b.strstart||b.strstart>=e)&&(b.lookahead=b.strstart-e,b.strstart=e,r(b,!1),0===b.strm.avail_out))return 1;if(b.strstart-b.block_start>=b.w_size-E&&(r(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,n===z?(r(b,!0),0===b.strm.avail_out?3:4):(b.strstart>b.block_start&&(r(b,!1),b.strm.avail_out),1)})),new l(4,4,8,4,S),new l(4,5,16,8,S),new l(4,6,32,32,S),new l(4,4,16,16,H),new l(8,16,32,32,H),new l(8,16,128,128,H),new l(8,32,128,256,H),new l(32,128,258,1024,H),new l(32,258,258,4096,H)];function p(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=s,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const f=b=>{if(!b||!b.state)return h(b,u);b.total_in=b.total_out=0,b.data_type=y;const n=b.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap?42:t,b.adler=2===n.wrap?0:1,n.last_flush=N,e(n),I},F=b=>{const n=f(b);var i;return n===I&&((i=b.state).window_size=2*i.w_size,J(i.head),i.max_lazy_match=v[i.level].max_lazy,i.good_match=v[i.level].good_length,i.nice_match=v[i.level].nice_length,i.max_chain_length=v[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),n},bb=(b,n,i,e,V,Q)=>{if(!b)return u;let U=1;if(n===o&&(n=6),e<0?(U=0,e=-e):e>15&&(U=2,e-=16),V<1||V>9||i!==s||e<8||e>15||n<0||n>9||Q<0||Q>D)return h(b,u);8===e&&(e=9);const Y=new p;return b.state=Y,Y.strm=b,Y.wrap=U,Y.gzhead=null,Y.w_bits=e,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=V+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+3-1)/3),Y.window=new Uint8Array(2*Y.w_size),Y.head=new Uint16Array(Y.hash_size),Y.prev=new Uint16Array(Y.w_size),Y.lit_bufsize=1<<V+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new Uint8Array(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=n,Y.strategy=Q,Y.method=i,F(b)};b.exports.deflateInit=(b,n)=>bb(b,n,s,15,8,x),b.exports.deflateInit2=bb,b.exports.deflateReset=F,b.exports.deflateResetKeep=f,b.exports.deflateSetHeader=(b,n)=>b&&b.state?2!==b.state.wrap?u:(b.state.gzhead=n,I):u,b.exports.deflate=(b,n)=>{let i,e;if(!b||!b.state||n>K||n<0)return b?h(b,u):u;const Q=b.state;if(!b.output||!b.input&&0!==b.avail_in||Q.status===w&&n!==z)return h(b,0===b.avail_out?G:u);Q.strm=b;const L=Q.last_flush;if(Q.last_flush=n,42===Q.status)if(2===Q.wrap)b.adler=0,X(Q,31),X(Q,139),X(Q,8),Q.gzhead?(X(Q,(Q.gzhead.text?1:0)+(Q.gzhead.hcrc?2:0)+(Q.gzhead.extra?4:0)+(Q.gzhead.name?8:0)+(Q.gzhead.comment?16:0)),X(Q,255&Q.gzhead.time),X(Q,Q.gzhead.time>>8&255),X(Q,Q.gzhead.time>>16&255),X(Q,Q.gzhead.time>>24&255),X(Q,9===Q.level?2:Q.strategy>=j||Q.level<2?4:0),X(Q,255&Q.gzhead.os),Q.gzhead.extra&&Q.gzhead.extra.length&&(X(Q,255&Q.gzhead.extra.length),X(Q,Q.gzhead.extra.length>>8&255)),Q.gzhead.hcrc&&(b.adler=B(b.adler,Q.pending_buf,Q.pending,0)),Q.gzindex=0,Q.status=69):(X(Q,0),X(Q,0),X(Q,0),X(Q,0),X(Q,0),X(Q,9===Q.level?2:Q.strategy>=j||Q.level<2?4:0),X(Q,3),Q.status=t);else{let n=s+(Q.w_bits-8<<4)<<8,i=-1;i=Q.strategy>=j||Q.level<2?0:Q.level<6?1:6===Q.level?2:3,n|=i<<6,0!==Q.strstart&&(n|=32),n+=31-n%31,Q.status=t,g(Q,n),0!==Q.strstart&&(g(Q,b.adler>>>16),g(Q,65535&b.adler)),b.adler=1}if(69===Q.status)if(Q.gzhead.extra){for(i=Q.pending;Q.gzindex<(65535&Q.gzhead.extra.length)&&(Q.pending!==Q.pending_buf_size||(Q.gzhead.hcrc&&Q.pending>i&&(b.adler=B(b.adler,Q.pending_buf,Q.pending-i,i)),k(b),i=Q.pending,Q.pending!==Q.pending_buf_size));)X(Q,255&Q.gzhead.extra[Q.gzindex]),Q.gzindex++;Q.gzhead.hcrc&&Q.pending>i&&(b.adler=B(b.adler,Q.pending_buf,Q.pending-i,i)),Q.gzindex===Q.gzhead.extra.length&&(Q.gzindex=0,Q.status=73)}else Q.status=73;if(73===Q.status)if(Q.gzhead.name){i=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>i&&(b.adler=B(b.adler,Q.pending_buf,Q.pending-i,i)),k(b),i=Q.pending,Q.pending===Q.pending_buf_size)){e=1;break}e=Q.gzindex<Q.gzhead.name.length?255&Q.gzhead.name.charCodeAt(Q.gzindex++):0,X(Q,e)}while(0!==e);Q.gzhead.hcrc&&Q.pending>i&&(b.adler=B(b.adler,Q.pending_buf,Q.pending-i,i)),0===e&&(Q.gzindex=0,Q.status=91)}else Q.status=91;if(91===Q.status)if(Q.gzhead.comment){i=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>i&&(b.adler=B(b.adler,Q.pending_buf,Q.pending-i,i)),k(b),i=Q.pending,Q.pending===Q.pending_buf_size)){e=1;break}e=Q.gzindex<Q.gzhead.comment.length?255&Q.gzhead.comment.charCodeAt(Q.gzindex++):0,X(Q,e)}while(0!==e);Q.gzhead.hcrc&&Q.pending>i&&(b.adler=B(b.adler,Q.pending_buf,Q.pending-i,i)),0===e&&(Q.status=C)}else Q.status=C;if(Q.status===C&&(Q.gzhead.hcrc?(Q.pending+2>Q.pending_buf_size&&k(b),Q.pending+2<=Q.pending_buf_size&&(X(Q,255&b.adler),X(Q,b.adler>>8&255),b.adler=0,Q.status=t)):Q.status=t),0!==Q.pending){if(k(b),0===b.avail_out)return Q.last_flush=-1,I}else if(0===b.avail_in&&W(n)<=W(L)&&n!==z)return h(b,G);if(Q.status===w&&0!==b.avail_in)return h(b,G);if(0!==b.avail_in||0!==Q.lookahead||n!==N&&Q.status!==w){let i=Q.strategy===j?((b,n)=>{let i;for(;;){if(0===b.lookahead&&(q(b),0===b.lookahead)){if(n===N)return 1;break}if(b.match_length=0,i=U(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++,i&&(r(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,n===z?(r(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(r(b,!1),0===b.strm.avail_out)?1:2})(Q,n):Q.strategy===a?((b,n)=>{let i,e,V,Q;const Y=b.window;for(;;){if(b.lookahead<=A){if(q(b),b.lookahead<=A&&n===N)return 1;if(0===b.lookahead)break}if(b.match_length=0,b.lookahead>=3&&b.strstart>0&&(V=b.strstart-1,e=Y[V],e===Y[++V]&&e===Y[++V]&&e===Y[++V])){Q=b.strstart+A;do{}while(e===Y[++V]&&e===Y[++V]&&e===Y[++V]&&e===Y[++V]&&e===Y[++V]&&e===Y[++V]&&e===Y[++V]&&e===Y[++V]&&V<Q);b.match_length=A-(Q-V),b.match_length>b.lookahead&&(b.match_length=b.lookahead)}if(b.match_length>=3?(i=U(b,1,b.match_length-3),b.lookahead-=b.match_length,b.strstart+=b.match_length,b.match_length=0):(i=U(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++),i&&(r(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,n===z?(r(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(r(b,!1),0===b.strm.avail_out)?1:2})(Q,n):v[Q.level].func(Q,n);if(3!==i&&4!==i||(Q.status=w),1===i||3===i)return 0===b.avail_out&&(Q.last_flush=-1),I;if(2===i&&(n===Z?Y(Q):n!==K&&(V(Q,0,0,!1),n===T&&(J(Q.head),0===Q.lookahead&&(Q.strstart=0,Q.block_start=0,Q.insert=0))),k(b),0===b.avail_out))return Q.last_flush=-1,I}return n!==z?I:Q.wrap<=0?O:(2===Q.wrap?(X(Q,255&b.adler),X(Q,b.adler>>8&255),X(Q,b.adler>>16&255),X(Q,b.adler>>24&255),X(Q,255&b.total_in),X(Q,b.total_in>>8&255),X(Q,b.total_in>>16&255),X(Q,b.total_in>>24&255)):(g(Q,b.adler>>>16),g(Q,65535&b.adler)),k(b),Q.wrap>0&&(Q.wrap=-Q.wrap),0!==Q.pending?I:O)},b.exports.deflateEnd=b=>{if(!b||!b.state)return u;const n=b.state.status;return 42!==n&&69!==n&&73!==n&&91!==n&&n!==C&&n!==t&&n!==w?h(b,u):(b.state=null,n===t?h(b,d):I)},b.exports.deflateSetDictionary=(b,n)=>{let i=n.length;if(!b||!b.state)return u;const e=b.state,V=e.wrap;if(2===V||1===V&&42!==e.status||e.lookahead)return u;if(1===V&&(b.adler=L(b.adler,n,i,0)),e.wrap=0,i>=e.w_size){0===V&&(J(e.head),e.strstart=0,e.block_start=0,e.insert=0);let b=new Uint8Array(e.w_size);b.set(n.subarray(i-e.w_size,i),0),n=b,i=e.w_size}const Q=b.avail_in,U=b.next_in,Y=b.input;for(b.avail_in=i,b.next_in=0,b.input=n,q(e);e.lookahead>=3;){let b=e.strstart,n=e.lookahead-2;do{e.ins_h=R(e,e.ins_h,e.window[b+3-1]),e.prev[b&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=b,b++}while(--n);e.strstart=b,e.lookahead=2,q(e)}return e.strstart+=e.lookahead,e.block_start=e.strstart,e.insert=e.lookahead,e.lookahead=0,e.match_length=e.prev_length=2,e.match_available=0,b.next_in=U,b.input=Y,b.avail_in=Q,e.wrap=V,I},b.exports.deflateInfo="pako deflate (from Nodeca project)"},12999:b=>{"use strict";b.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12988:b=>{"use strict";b.exports=function(b,n){let i,e,V,Q,U,Y,L,B,mb,N,Z,T,z,K,I,O,u,d,G,o,M,j,a,D;const x=b.state;i=b.next_in,a=b.input,e=i+(b.avail_in-5),V=b.next_out,D=b.output,Q=V-(n-b.avail_out),U=V+(b.avail_out-257),Y=x.dmax,L=x.wsize,B=x.whave,mb=x.wnext,N=x.window,Z=x.hold,T=x.bits,z=x.lencode,K=x.distcode,I=(1<<x.lenbits)-1,O=(1<<x.distbits)-1;b:do{T<15&&(Z+=a[i++]<<T,T+=8,Z+=a[i++]<<T,T+=8),u=z[Z&I];n:for(;;){if(d=u>>>24,Z>>>=d,T-=d,d=u>>>16&255,0===d)D[V++]=65535&u;else{if(!(16&d)){if(0===(64&d)){u=z[(65535&u)+(Z&(1<<d)-1)];continue n}if(32&d){x.mode=12;break b}b.Zn="invalid literal/length code",x.mode=30;break b}G=65535&u,d&=15,d&&(T<d&&(Z+=a[i++]<<T,T+=8),G+=Z&(1<<d)-1,Z>>>=d,T-=d),T<15&&(Z+=a[i++]<<T,T+=8,Z+=a[i++]<<T,T+=8),u=K[Z&O];i:for(;;){if(d=u>>>24,Z>>>=d,T-=d,d=u>>>16&255,!(16&d)){if(0===(64&d)){u=K[(65535&u)+(Z&(1<<d)-1)];continue i}b.Zn="invalid distance code",x.mode=30;break b}if(o=65535&u,d&=15,T<d&&(Z+=a[i++]<<T,T+=8,T<d&&(Z+=a[i++]<<T,T+=8)),o+=Z&(1<<d)-1,o>Y){b.Zn="invalid distance too far back",x.mode=30;break b}if(Z>>>=d,T-=d,d=V-Q,o>d){if(d=o-d,d>B&&x.sane){b.Zn="invalid distance too far back",x.mode=30;break b}if(M=0,j=N,0===mb){if(M+=L-d,d<G){G-=d;do{D[V++]=N[M++]}while(--d);M=V-o,j=D}}else if(mb<d){if(M+=L+mb-d,d-=mb,d<G){G-=d;do{D[V++]=N[M++]}while(--d);if(M=0,mb<G){d=mb,G-=d;do{D[V++]=N[M++]}while(--d);M=V-o,j=D}}}else if(M+=mb-d,d<G){G-=d;do{D[V++]=N[M++]}while(--d);M=V-o,j=D}for(;G>2;)D[V++]=j[M++],D[V++]=j[M++],D[V++]=j[M++],G-=3;G&&(D[V++]=j[M++],G>1&&(D[V++]=j[M++]))}else{M=V-o;do{D[V++]=D[M++],D[V++]=D[M++],D[V++]=D[M++],G-=3}while(G>2);G&&(D[V++]=D[M++],G>1&&(D[V++]=D[M++]))}break}}break}}while(i<e&&V<U);G=T>>3,i-=G,T-=G<<3,Z&=(1<<T)-1,b.next_in=i,b.next_out=V,b.avail_in=i<e?e-i+5:5-(i-e),b.avail_out=V<U?U-V+257:257-(V-U),x.hold=Z,x.bits=T}},12979:(b,n,i)=>{"use strict";const e=i(12930),V=i(12938),Q=i(12988),U=i(12991),{Z_FINISH:Y,Z_BLOCK:L,Z_TREES:B,Z_OK:mb,Z_STREAM_END:N,Z_NEED_DICT:Z,Z_STREAM_ERROR:T,Z_DATA_ERROR:z,Z_MEM_ERROR:K,Z_BUF_ERROR:I,Z_DEFLATED:O}=i(12950),u=12,d=30,G=b=>(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24);function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const M=b=>{if(!b||!b.state)return T;const n=b.state;return b.total_in=b.total_out=n.total=0,b.Zn="",n.wrap&&(b.adler=1&n.wrap),n.mode=1,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,mb},j=b=>{if(!b||!b.state)return T;const n=b.state;return n.wsize=0,n.whave=0,n.wnext=0,M(b)},a=(b,n)=>{let i;if(!b||!b.state)return T;const e=b.state;return n<0?(i=0,n=-n):(i=1+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?T:(null!==e.window&&e.wbits!==n&&(e.window=null),e.wrap=i,e.wbits=n,j(b))},D=(b,n)=>{if(!b)return T;const i=new o;b.state=i,i.window=null;const e=a(b,n);return e!==mb&&(b.state=null),e};let x,y,s=!0;const A=b=>{if(s){x=new Int32Array(512),y=new Int32Array(32);let n=0;for(;n<144;)b.lens[n++]=8;for(;n<256;)b.lens[n++]=9;for(;n<280;)b.lens[n++]=7;for(;n<288;)b.lens[n++]=8;for(U(1,b.lens,0,288,x,0,b.work,{bits:9}),n=0;n<32;)b.lens[n++]=5;U(2,b.lens,0,32,y,0,b.work,{bits:5}),s=!1}b.lencode=x,b.lenbits=9,b.distcode=y,b.distbits=5},E=(b,n,i,e)=>{let V;const Q=b.state;return null===Q.window&&(Q.wsize=1<<Q.wbits,Q.wnext=0,Q.whave=0,Q.window=new Uint8Array(Q.wsize)),e>=Q.wsize?(Q.window.set(n.subarray(i-Q.wsize,i),0),Q.wnext=0,Q.whave=Q.wsize):(V=Q.wsize-Q.wnext,V>e&&(V=e),Q.window.set(n.subarray(i-e,i-e+V),Q.wnext),(e-=V)?(Q.window.set(n.subarray(i-e,i),0),Q.wnext=e,Q.whave=Q.wsize):(Q.wnext+=V,Q.wnext===Q.wsize&&(Q.wnext=0),Q.whave<Q.wsize&&(Q.whave+=V))),0};b.exports.inflateReset=j,b.exports.inflateReset2=a,b.exports.inflateResetKeep=M,b.exports.inflateInit=b=>D(b,15),b.exports.inflateInit2=D,b.exports.inflate=(b,n)=>{let i,o,M,j,a,D,x,y,s,C,t,w,h,W,J,R,k,r,X,g,P,c,q=0;const S=new Uint8Array(4);let H,l;const v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return T;i=b.state,i.mode===u&&(i.mode=13),a=b.next_out,M=b.output,x=b.avail_out,j=b.next_in,o=b.input,D=b.avail_in,y=i.hold,s=i.bits,C=D,t=x,c=mb;b:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;s<16;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(2&i.wrap&&35615===y){i.check=0,S[0]=255&y,S[1]=y>>>8&255,i.check=V(i.check,S,2,0),y=0,s=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){b.Zn="incorrect header check",i.mode=d;break}if((15&y)!==O){b.Zn="unknown compression method",i.mode=d;break}if(y>>>=4,s-=4,P=8+(15&y),0===i.wbits)i.wbits=P;else if(P>i.wbits){b.Zn="invalid window size",i.mode=d;break}i.dmax=1<<i.wbits,b.adler=i.check=1,i.mode=512&y?10:u,y=0,s=0;break;case 2:for(;s<16;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(i.flags=y,(255&i.flags)!==O){b.Zn="unknown compression method",i.mode=d;break}if(57344&i.flags){b.Zn="unknown header flags set",i.mode=d;break}i.head&&(i.head.text=y>>8&1),512&i.flags&&(S[0]=255&y,S[1]=y>>>8&255,i.check=V(i.check,S,2,0)),y=0,s=0,i.mode=3;case 3:for(;s<32;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}i.head&&(i.head.time=y),512&i.flags&&(S[0]=255&y,S[1]=y>>>8&255,S[2]=y>>>16&255,S[3]=y>>>24&255,i.check=V(i.check,S,4,0)),y=0,s=0,i.mode=4;case 4:for(;s<16;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&i.flags&&(S[0]=255&y,S[1]=y>>>8&255,i.check=V(i.check,S,2,0)),y=0,s=0,i.mode=5;case 5:if(1024&i.flags){for(;s<16;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}i.length=y,i.head&&(i.head.extra_len=y),512&i.flags&&(S[0]=255&y,S[1]=y>>>8&255,i.check=V(i.check,S,2,0)),y=0,s=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(w=i.length,w>D&&(w=D),w&&(i.head&&(P=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(j,j+w),P)),512&i.flags&&(i.check=V(i.check,o,w,j)),D-=w,j+=w,i.length-=w),i.length))break b;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===D)break b;w=0;do{P=o[j+w++],i.head&&P&&i.length<65536&&(i.head.name+=String.fromCharCode(P))}while(P&&w<D);if(512&i.flags&&(i.check=V(i.check,o,w,j)),D-=w,j+=w,P)break b}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===D)break b;w=0;do{P=o[j+w++],i.head&&P&&i.length<65536&&(i.head.comment+=String.fromCharCode(P))}while(P&&w<D);if(512&i.flags&&(i.check=V(i.check,o,w,j)),D-=w,j+=w,P)break b}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;s<16;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(y!==(65535&i.check)){b.Zn="header crc mismatch",i.mode=d;break}y=0,s=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),b.adler=i.check=0,i.mode=u;break;case 10:for(;s<32;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}b.adler=i.check=G(y),y=0,s=0,i.mode=11;case 11:if(0===i.havedict)return b.next_out=a,b.avail_out=x,b.next_in=j,b.avail_in=D,i.hold=y,i.bits=s,Z;b.adler=i.check=1,i.mode=u;case u:if(n===L||n===B)break b;case 13:if(i.last){y>>>=7&s,s-=7&s,i.mode=27;break}for(;s<3;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}switch(i.last=1&y,y>>>=1,s-=1,3&y){case 0:i.mode=14;break;case 1:if(A(i),i.mode=20,n===B){y>>>=2,s-=2;break b}break;case 2:i.mode=17;break;case 3:b.Zn="invalid block type",i.mode=d}y>>>=2,s-=2;break;case 14:for(y>>>=7&s,s-=7&s;s<32;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if((65535&y)!==(y>>>16^65535)){b.Zn="invalid stored block lengths",i.mode=d;break}if(i.length=65535&y,y=0,s=0,i.mode=15,n===B)break b;case 15:i.mode=16;case 16:if(w=i.length,w){if(w>D&&(w=D),w>x&&(w=x),0===w)break b;M.set(o.subarray(j,j+w),a),D-=w,j+=w,x-=w,a+=w,i.length-=w;break}i.mode=u;break;case 17:for(;s<14;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(i.nlen=257+(31&y),y>>>=5,s-=5,i.ndist=1+(31&y),y>>>=5,s-=5,i.ncode=4+(15&y),y>>>=4,s-=4,i.nlen>286||i.ndist>30){b.Zn="too many length or distance symbols",i.mode=d;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;s<3;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}i.lens[v[i.have++]]=7&y,y>>>=3,s-=3}for(;i.have<19;)i.lens[v[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,H={bits:i.lenbits},c=U(0,i.lens,0,19,i.lencode,0,i.work,H),i.lenbits=H.bits,c){b.Zn="invalid code lengths set",i.mode=d;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;q=i.lencode[y&(1<<i.lenbits)-1],J=q>>>24,R=q>>>16&255,k=65535&q,!(J<=s);){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(k<16)y>>>=J,s-=J,i.lens[i.have++]=k;else{if(16===k){for(l=J+2;s<l;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(y>>>=J,s-=J,0===i.have){b.Zn="invalid bit length repeat",i.mode=d;break}P=i.lens[i.have-1],w=3+(3&y),y>>>=2,s-=2}else if(17===k){for(l=J+3;s<l;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}y>>>=J,s-=J,P=0,w=3+(7&y),y>>>=3,s-=3}else{for(l=J+7;s<l;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}y>>>=J,s-=J,P=0,w=11+(127&y),y>>>=7,s-=7}if(i.have+w>i.nlen+i.ndist){b.Zn="invalid bit length repeat",i.mode=d;break}for(;w--;)i.lens[i.have++]=P}}if(i.mode===d)break;if(0===i.lens[256]){b.Zn="invalid code -- missing end-of-block",i.mode=d;break}if(i.lenbits=9,H={bits:i.lenbits},c=U(1,i.lens,0,i.nlen,i.lencode,0,i.work,H),i.lenbits=H.bits,c){b.Zn="invalid literal/lengths set",i.mode=d;break}if(i.distbits=6,i.distcode=i.distdyn,H={bits:i.distbits},c=U(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,H),i.distbits=H.bits,c){b.Zn="invalid distances set",i.mode=d;break}if(i.mode=20,n===B)break b;case 20:i.mode=21;case 21:if(D>=6&&x>=258){b.next_out=a,b.avail_out=x,b.next_in=j,b.avail_in=D,i.hold=y,i.bits=s,Q(b,t),a=b.next_out,M=b.output,x=b.avail_out,j=b.next_in,o=b.input,D=b.avail_in,y=i.hold,s=i.bits,i.mode===u&&(i.back=-1);break}for(i.back=0;q=i.lencode[y&(1<<i.lenbits)-1],J=q>>>24,R=q>>>16&255,k=65535&q,!(J<=s);){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(R&&0===(240&R)){for(r=J,X=R,g=k;q=i.lencode[g+((y&(1<<r+X)-1)>>r)],J=q>>>24,R=q>>>16&255,k=65535&q,!(r+J<=s);){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}y>>>=r,s-=r,i.back+=r}if(y>>>=J,s-=J,i.back+=J,i.length=k,0===R){i.mode=26;break}if(32&R){i.back=-1,i.mode=u;break}if(64&R){b.Zn="invalid literal/length code",i.mode=d;break}i.extra=15&R,i.mode=22;case 22:if(i.extra){for(l=i.extra;s<l;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,s-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;q=i.distcode[y&(1<<i.distbits)-1],J=q>>>24,R=q>>>16&255,k=65535&q,!(J<=s);){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(0===(240&R)){for(r=J,X=R,g=k;q=i.distcode[g+((y&(1<<r+X)-1)>>r)],J=q>>>24,R=q>>>16&255,k=65535&q,!(r+J<=s);){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}y>>>=r,s-=r,i.back+=r}if(y>>>=J,s-=J,i.back+=J,64&R){b.Zn="invalid distance code",i.mode=d;break}i.offset=k,i.extra=15&R,i.mode=24;case 24:if(i.extra){for(l=i.extra;s<l;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,s-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){b.Zn="invalid distance too far back",i.mode=d;break}i.mode=25;case 25:if(0===x)break b;if(w=t-x,i.offset>w){if(w=i.offset-w,w>i.whave&&i.sane){b.Zn="invalid distance too far back",i.mode=d;break}w>i.wnext?(w-=i.wnext,h=i.wsize-w):h=i.wnext-w,w>i.length&&(w=i.length),W=i.window}else W=M,h=a-i.offset,w=i.length;w>x&&(w=x),x-=w,i.length-=w;do{M[a++]=W[h++]}while(--w);0===i.length&&(i.mode=21);break;case 26:if(0===x)break b;M[a++]=i.length,x--,i.mode=21;break;case 27:if(i.wrap){for(;s<32;){if(0===D)break b;D--,y|=o[j++]<<s,s+=8}if(t-=x,b.total_out+=t,i.total+=t,t&&(b.adler=i.check=i.flags?V(i.check,M,t,a-t):e(i.check,M,t,a-t)),t=x,(i.flags?y:G(y))!==i.check){b.Zn="incorrect data check",i.mode=d;break}y=0,s=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;s<32;){if(0===D)break b;D--,y+=o[j++]<<s,s+=8}if(y!==(4294967295&i.total)){b.Zn="incorrect length check",i.mode=d;break}y=0,s=0}i.mode=29;case 29:c=N;break b;case d:c=z;break b;case 31:return K;default:return T}return b.next_out=a,b.avail_out=x,b.next_in=j,b.avail_in=D,i.hold=y,i.bits=s,(i.wsize||t!==b.avail_out&&i.mode<d&&(i.mode<27||n!==Y))&&E(b,b.output,b.next_out,t-b.avail_out)?(i.mode=31,K):(C-=b.avail_in,t-=b.avail_out,b.total_in+=C,b.total_out+=t,i.total+=t,i.wrap&&t&&(b.adler=i.check=i.flags?V(i.check,M,t,b.next_out-t):e(i.check,M,t,b.next_out-t)),b.data_type=i.bits+(i.last?64:0)+(i.mode===u?128:0)+(20===i.mode||15===i.mode?256:0),(0===C&&0===t||n===Y)&&c===mb&&(c=I),c)},b.exports.inflateEnd=b=>{if(!b||!b.state)return T;let n=b.state;return n.window&&(n.window=null),b.state=null,mb},b.exports.inflateGetHeader=(b,n)=>{if(!b||!b.state)return T;const i=b.state;return 0===(2&i.wrap)?T:(i.head=n,n.done=!1,mb)},b.exports.inflateSetDictionary=(b,n)=>{const i=n.length;let V,Q,U;return b&&b.state?(V=b.state,0!==V.wrap&&11!==V.mode?T:11===V.mode&&(Q=1,Q=e(Q,n,i,0),Q!==V.check)?z:(U=E(b,n,i,i),U?(V.mode=31,K):(V.havedict=1,mb))):T},b.exports.inflateInfo="pako inflate (from Nodeca project)"},12991:b=>{"use strict";const n=15,i=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),V=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);b.exports=(b,U,Y,L,B,mb,N,Z)=>{const T=Z.bits;let z,K,I,O,u,d,G=0,o=0,M=0,j=0,a=0,D=0,x=0,y=0,s=0,A=0,E=null,C=0;const t=new Uint16Array(16),w=new Uint16Array(16);let h,W,J,R=null,k=0;for(G=0;G<=n;G++)t[G]=0;for(o=0;o<L;o++)t[U[Y+o]]++;for(a=T,j=n;j>=1&&0===t[j];j--);if(a>j&&(a=j),0===j)return B[mb++]=20971520,B[mb++]=20971520,Z.bits=1,0;for(M=1;M<j&&0===t[M];M++);for(a<M&&(a=M),y=1,G=1;G<=n;G++)if(y<<=1,y-=t[G],y<0)return-1;if(y>0&&(0===b||1!==j))return-1;for(w[1]=0,G=1;G<n;G++)w[G+1]=w[G]+t[G];for(o=0;o<L;o++)0!==U[Y+o]&&(N[w[U[Y+o]]++]=o);if(0===b?(E=R=N,d=19):1===b?(E=i,C-=257,R=e,k-=257,d=256):(E=V,R=Q,d=-1),A=0,o=0,G=M,u=mb,D=a,x=0,I=-1,s=1<<a,O=s-1,1===b&&s>852||2===b&&s>592)return 1;for(;;){h=G-x,N[o]<d?(W=0,J=N[o]):N[o]>d?(W=R[k+N[o]],J=E[C+N[o]]):(W=96,J=0),z=1<<G-x,K=1<<D,M=K;do{K-=z,B[u+(A>>x)+K]=h<<24|W<<16|J}while(0!==K);for(z=1<<G-1;A&z;)z>>=1;if(0!==z?(A&=z-1,A+=z):A=0,o++,0===--t[G]){if(G===j)break;G=U[Y+N[o]]}if(G>a&&(A&O)!==I){for(0===x&&(x=a),u+=M,D=G-x,y=1<<D;D+x<j&&(y-=t[D+x],!(y<=0));)D++,y<<=1;if(s+=1<<D,1===b&&s>852||2===b&&s>592)return 1;I=A&O,B[I]=a<<24|D<<16|u-mb}}return 0!==A&&(B[u+A]=G-x<<24|64<<16),Z.bits=a,0}},12941:b=>{"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12926:b=>{"use strict";function n(b){let n=b.length;for(;--n>=0;)b[n]=0}const i=256,e=286,V=30,Q=15,U=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mb=new Array(576);n(mb);const N=new Array(60);n(N);const Z=new Array(512);n(Z);const T=new Array(256);n(T);const z=new Array(29);n(z);const K=new Array(V);function I(b,n,i,e,V){this.static_tree=b,this.extra_bits=n,this.extra_base=i,this.elems=e,this.max_length=V,this.has_stree=b&&b.length}let O,u,d;function G(b,n){this.dyn_tree=b,this.max_code=0,this.stat_desc=n}n(K);const o=b=>b<256?Z[b]:Z[256+(b>>>7)],M=(b,n)=>{b.pending_buf[b.pending++]=255&n,b.pending_buf[b.pending++]=n>>>8&255},j=(b,n,i)=>{b.bi_valid>16-i?(b.bi_buf|=n<<b.bi_valid&65535,M(b,b.bi_buf),b.bi_buf=n>>16-b.bi_valid,b.bi_valid+=i-16):(b.bi_buf|=n<<b.bi_valid&65535,b.bi_valid+=i)},a=(b,n,i)=>{j(b,i[2*n],i[2*n+1])},D=(b,n)=>{let i=0;do{i|=1&b,b>>>=1,i<<=1}while(--n>0);return i>>>1},x=(b,n,i)=>{const e=new Array(16);let V,U,Y=0;for(V=1;V<=Q;V++)e[V]=Y=Y+i[V-1]<<1;for(U=0;U<=n;U++){let n=b[2*U+1];0!==n&&(b[2*U]=D(e[n]++,n))}},y=b=>{let n;for(n=0;n<e;n++)b.dyn_ltree[2*n]=0;for(n=0;n<V;n++)b.dyn_dtree[2*n]=0;for(n=0;n<19;n++)b.bl_tree[2*n]=0;b.dyn_ltree[512]=1,b.opt_len=b.static_len=0,b.last_lit=b.matches=0},s=b=>{b.bi_valid>8?M(b,b.bi_buf):b.bi_valid>0&&(b.pending_buf[b.pending++]=b.bi_buf),b.bi_buf=0,b.bi_valid=0},A=(b,n,i,e)=>{const V=2*n,Q=2*i;return b[V]<b[Q]||b[V]===b[Q]&&e[n]<=e[i]},E=(b,n,i)=>{const e=b.heap[i];let V=i<<1;for(;V<=b.heap_len&&(V<b.heap_len&&A(n,b.heap[V+1],b.heap[V],b.depth)&&V++,!A(n,e,b.heap[V],b.depth));)b.heap[i]=b.heap[V],i=V,V<<=1;b.heap[i]=e},C=(b,n,e)=>{let V,Q,L,B,mb=0;if(0!==b.last_lit)do{V=b.pending_buf[b.d_buf+2*mb]<<8|b.pending_buf[b.d_buf+2*mb+1],Q=b.pending_buf[b.l_buf+mb],mb++,0===V?a(b,Q,n):(L=T[Q],a(b,L+i+1,n),B=U[L],0!==B&&(Q-=z[L],j(b,Q,B)),V--,L=o(V),a(b,L,e),B=Y[L],0!==B&&(V-=K[L],j(b,V,B)))}while(mb<b.last_lit);a(b,256,n)},t=(b,n)=>{const i=n.dyn_tree,e=n.stat_desc.static_tree,V=n.stat_desc.has_stree,U=n.stat_desc.elems;let Y,L,B,mb=-1;for(b.heap_len=0,b.heap_max=573,Y=0;Y<U;Y++)0!==i[2*Y]?(b.heap[++b.heap_len]=mb=Y,b.depth[Y]=0):i[2*Y+1]=0;for(;b.heap_len<2;)B=b.heap[++b.heap_len]=mb<2?++mb:0,i[2*B]=1,b.depth[B]=0,b.opt_len--,V&&(b.static_len-=e[2*B+1]);for(n.max_code=mb,Y=b.heap_len>>1;Y>=1;Y--)E(b,i,Y);B=U;do{Y=b.heap[1],b.heap[1]=b.heap[b.heap_len--],E(b,i,1),L=b.heap[1],b.heap[--b.heap_max]=Y,b.heap[--b.heap_max]=L,i[2*B]=i[2*Y]+i[2*L],b.depth[B]=(b.depth[Y]>=b.depth[L]?b.depth[Y]:b.depth[L])+1,i[2*Y+1]=i[2*L+1]=B,b.heap[1]=B++,E(b,i,1)}while(b.heap_len>=2);b.heap[--b.heap_max]=b.heap[1],((b,n)=>{const i=n.dyn_tree,e=n.max_code,V=n.stat_desc.static_tree,U=n.stat_desc.has_stree,Y=n.stat_desc.extra_bits,L=n.stat_desc.extra_base,B=n.stat_desc.max_length;let mb,N,Z,T,z,K,I=0;for(T=0;T<=Q;T++)b.bl_count[T]=0;for(i[2*b.heap[b.heap_max]+1]=0,mb=b.heap_max+1;mb<573;mb++)N=b.heap[mb],T=i[2*i[2*N+1]+1]+1,T>B&&(T=B,I++),i[2*N+1]=T,N>e||(b.bl_count[T]++,z=0,N>=L&&(z=Y[N-L]),K=i[2*N],b.opt_len+=K*(T+z),U&&(b.static_len+=K*(V[2*N+1]+z)));if(0!==I){do{for(T=B-1;0===b.bl_count[T];)T--;b.bl_count[T]--,b.bl_count[T+1]+=2,b.bl_count[B]--,I-=2}while(I>0);for(T=B;0!==T;T--)for(N=b.bl_count[T];0!==N;)Z=b.heap[--mb],Z>e||(i[2*Z+1]!==T&&(b.opt_len+=(T-i[2*Z+1])*i[2*Z],i[2*Z+1]=T),N--)}})(b,n),x(i,mb,b.bl_count)},w=(b,n,i)=>{let e,V,Q=-1,U=n[1],Y=0,L=7,B=4;for(0===U&&(L=138,B=3),n[2*(i+1)+1]=65535,e=0;e<=i;e++)V=U,U=n[2*(e+1)+1],++Y<L&&V===U||(Y<B?b.bl_tree[2*V]+=Y:0!==V?(V!==Q&&b.bl_tree[2*V]++,b.bl_tree[32]++):Y<=10?b.bl_tree[34]++:b.bl_tree[36]++,Y=0,Q=V,0===U?(L=138,B=3):V===U?(L=6,B=3):(L=7,B=4))},h=(b,n,i)=>{let e,V,Q=-1,U=n[1],Y=0,L=7,B=4;for(0===U&&(L=138,B=3),e=0;e<=i;e++)if(V=U,U=n[2*(e+1)+1],!(++Y<L&&V===U)){if(Y<B)do{a(b,V,b.bl_tree)}while(0!==--Y);else 0!==V?(V!==Q&&(a(b,V,b.bl_tree),Y--),a(b,16,b.bl_tree),j(b,Y-3,2)):Y<=10?(a(b,17,b.bl_tree),j(b,Y-3,3)):(a(b,18,b.bl_tree),j(b,Y-11,7));Y=0,Q=V,0===U?(L=138,B=3):V===U?(L=6,B=3):(L=7,B=4)}};let W=!1;const J=(b,n,i,e)=>{j(b,0+(e?1:0),3),((b,n,i,e)=>{s(b),e&&(M(b,i),M(b,~i)),b.pending_buf.set(b.window.subarray(n,n+i),b.pending),b.pending+=i})(b,n,i,!0)};b.exports._tr_init=b=>{W||((()=>{let b,n,i,B,G;const o=new Array(16);for(i=0,B=0;B<28;B++)for(z[B]=i,b=0;b<1<<U[B];b++)T[i++]=B;for(T[i-1]=B,G=0,B=0;B<16;B++)for(K[B]=G,b=0;b<1<<Y[B];b++)Z[G++]=B;for(G>>=7;B<V;B++)for(K[B]=G<<7,b=0;b<1<<Y[B]-7;b++)Z[256+G++]=B;for(n=0;n<=Q;n++)o[n]=0;for(b=0;b<=143;)mb[2*b+1]=8,b++,o[8]++;for(;b<=255;)mb[2*b+1]=9,b++,o[9]++;for(;b<=279;)mb[2*b+1]=7,b++,o[7]++;for(;b<=287;)mb[2*b+1]=8,b++,o[8]++;for(x(mb,287,o),b=0;b<V;b++)N[2*b+1]=5,N[2*b]=D(b,5);O=new I(mb,U,257,e,Q),u=new I(N,Y,0,V,Q),d=new I(new Array(0),L,0,19,7)})(),W=!0),b.l_desc=new G(b.dyn_ltree,O),b.d_desc=new G(b.dyn_dtree,u),b.bl_desc=new G(b.bl_tree,d),b.bi_buf=0,b.bi_valid=0,y(b)},b.exports._tr_stored_block=J,b.exports._tr_flush_block=(b,n,e,V)=>{let Q,U,Y=0;b.level>0?(2===b.strm.data_type&&(b.strm.data_type=(b=>{let n,e=4093624447;for(n=0;n<=31;n++,e>>>=1)if(1&e&&0!==b.dyn_ltree[2*n])return 0;if(0!==b.dyn_ltree[18]||0!==b.dyn_ltree[20]||0!==b.dyn_ltree[26])return 1;for(n=32;n<i;n++)if(0!==b.dyn_ltree[2*n])return 1;return 0})(b)),t(b,b.l_desc),t(b,b.d_desc),Y=(b=>{let n;for(w(b,b.dyn_ltree,b.l_desc.max_code),w(b,b.dyn_dtree,b.d_desc.max_code),t(b,b.bl_desc),n=18;n>=3&&0===b.bl_tree[2*B[n]+1];n--);return b.opt_len+=3*(n+1)+5+5+4,n})(b),Q=b.opt_len+3+7>>>3,U=b.static_len+3+7>>>3,U<=Q&&(Q=U)):Q=U=e+5,e+4<=Q&&-1!==n?J(b,n,e,V):4===b.strategy||U===Q?(j(b,2+(V?1:0),3),C(b,mb,N)):(j(b,4+(V?1:0),3),((b,n,i,e)=>{let V;for(j(b,n-257,5),j(b,i-1,5),j(b,e-4,4),V=0;V<e;V++)j(b,b.bl_tree[2*B[V]+1],3);h(b,b.dyn_ltree,n-1),h(b,b.dyn_dtree,i-1)})(b,b.l_desc.max_code+1,b.d_desc.max_code+1,Y+1),C(b,b.dyn_ltree,b.dyn_dtree)),y(b),V&&s(b)},b.exports._tr_tally=(b,n,e)=>(b.pending_buf[b.d_buf+2*b.last_lit]=n>>>8&255,b.pending_buf[b.d_buf+2*b.last_lit+1]=255&n,b.pending_buf[b.l_buf+b.last_lit]=255&e,b.last_lit++,0===n?b.dyn_ltree[2*e]++:(b.matches++,n--,b.dyn_ltree[2*(T[e]+i+1)]++,b.dyn_dtree[2*o(n)]++),b.last_lit===b.lit_bufsize-1),b.exports._tr_align=b=>{j(b,2,3),a(b,256,mb),(b=>{16===b.bi_valid?(M(b,b.bi_buf),b.bi_buf=0,b.bi_valid=0):b.bi_valid>=8&&(b.pending_buf[b.pending++]=255&b.bi_buf,b.bi_buf>>=8,b.bi_valid-=8)})(b)}},12967:b=>{"use strict";b.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Zn="",this.state=null,this.data_type=2,this.adler=0}},12590:b=>{function n(b,n,i){for(var e=b.length,V=-1/0,Q=1/0,U=0;U<e;U++){var Y=(i[0][U]-b[U])/n[U],L=(i[1][U]-b[U])/n[U];if(Y>L){var B=Y;Y=L,L=B}if(L<V||Y>Q)return 1/0;Y>V&&(V=Y),L<Q&&(Q=L)}return V>Q?1/0:V}b.exports=function(b,i,e,V){var Q=n(i,e,V);if(Q===1/0)b=null;else{b=b||[];for(var U=0;U<i.length;U++)b[U]=i[U]+e[U]*Q}return b},b.exports.distance=n},14026:(b,n,i)=>{"use strict";i.d(n,{c:()=>U});var e=i(27);const V=e.useLayoutEffect;const Q=function(b){var n=(0,e.useRef)(b);return V((function(){n.current=b})),n};var U=function(b){var n=Q(b);(0,e.Bn)((function(){var b=function(b){var i;if(null!=n.current&&(i=n.current(b)),b.defaultPrevented&&(b.returnValue=""),"string"===typeof i)return b.returnValue=i,i};return window.addEventListener("beforeunload",b),function(){window.removeEventListener("beforeunload",b)}}),[])}},13974:(b,n,i)=>{"use strict";var e=i(13978),V=Array.prototype.concat,Q=Array.prototype.slice,U=b.exports=function(b){for(var n=[],i=0,U=b.length;i<U;i++){var Y=b[i];e(Y)?n=V.call(n,Q.call(Y)):n.push(Y)}return n};U.wrap=function(b){return function(){return b(U(arguments))}}},13978:b=>{b.exports=function(b){return!(!b||"string"===typeof b)&&(b instanceof Array||Array.isArray(b)||b.length>=0&&(b.splice instanceof Function||Object.getOwnPropertyDescriptor(b,b.length-1)&&"String"!==b.constructor.name))}},12867:(b,n,i)=>{var e=i(12876);function V(b){for(var n,i,V=0,Q=b.length,U=0;U<b.length;){for(n=b[U],i=0;U<Q&&b[U]===n;)++U,++i;V+=e.log2(i)/7|0,V+=e.log2(n>>>0)/7|0,V+=2}return V}n.size=V,n.encode=function(b,n){n||(n=new Uint8Array(V(b)));for(var i,e,Q=0,U=n.length,Y=0;Y<b.length;){for(i=b[Y],e=0;Y<b.length&&b[Y]===i;)++Y,++e;for(;Q<U&&e>=128;)n[Q++]=128+(127&e),e>>>=7;if(Q>=U)throw new Error("RLE buffer overflow");for(n[Q++]=e,i>>>=0;Q<U&&i>=128;)n[Q++]=128+(127&i),i>>>=7;if(Q>=U)throw new Error("RLE buffer overflow");n[Q++]=i}return n},n.decode=function(b,n){for(var i,e,V,Q,U=n.length,Y=b.length,L=0,B=0;B<Y;){for(i=0,e=0;B<Y&&b[B]>=128;)i+=(127&b[B++])<<e,e+=7;if(i+=b[B++]<<e,B>=Y)throw new Error("RLE buffer underrun");if(L+i>U)throw new Error("Chunk buffer overflow");for(V=0,e=0;B<Y&&b[B]>=128;)V+=(127&b[B++])<<e,e+=7;if(B>=Y)throw new Error("RLE buffer underrun");for(V+=b[B++]<<e,Q=0;Q<i;++Q)n[L++]=V}return n}},12876:(b,n)=>{"use strict";function i(b){var n=32;return(b&=-b)&&n--,65535&b&&(n-=16),16711935&b&&(n-=8),252645135&b&&(n-=4),858993459&b&&(n-=2),1431655765&b&&(n-=1),n}n.INT_BITS=32,n.INT_MAX=2147483647,n.INT_MIN=-1<<31,n.sign=function(b){return(b>0)-(b<0)},n.abs=function(b){var n=b>>31;return(b^n)-n},n.min=function(b,n){return n^(b^n)&-(b<n)},n.max=function(b,n){return b^(b^n)&-(b<n)},n.isPow2=function(b){return!(b&b-1)&&!!b},n.log2=function(b){var n,i;return n=(b>65535)<<4,n|=i=((b>>>=n)>255)<<3,n|=i=((b>>>=i)>15)<<2,(n|=i=((b>>>=i)>3)<<1)|(b>>>=i)>>1},n.log10=function(b){return b>=1e9?9:b>=1e8?8:b>=1e7?7:b>=1e6?6:b>=1e5?5:b>=1e4?4:b>=1e3?3:b>=100?2:b>=10?1:0},n.popCount=function(b){return 16843009*((b=(858993459&(b-=b>>>1&1431655765))+(b>>>2&858993459))+(b>>>4)&252645135)>>>24},n.countTrailingZeros=i,n.nextPow2=function(b){return b+=0===b,--b,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)+1},n.prevPow2=function(b){return b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)-(b>>>1)},n.parity=function(b){return b^=b>>>16,b^=b>>>8,b^=b>>>4,27030>>>(b&=15)&1};var e=new Array(256);!function(b){for(var n=0;n<256;++n){var i=n,e=n,V=7;for(i>>>=1;i;i>>>=1)e<<=1,e|=1&i,--V;b[n]=e<<V&255}}(e),n.reverse=function(b){return e[255&b]<<24|e[b>>>8&255]<<16|e[b>>>16&255]<<8|e[b>>>24&255]},n.interleave2=function(b,n){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n&=65535)|n<<8))|n<<4))|n<<2))|n<<1))<<1},n.deinterleave2=function(b,n){return(b=65535&((b=16711935&((b=252645135&((b=858993459&((b=b>>>n&1431655765)|b>>>1))|b>>>2))|b>>>4))|b>>>16))<<16>>16},n.interleave3=function(b,n,i){return b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2),(b|=(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},n.deinterleave3=function(b,n){return(b=1023&((b=4278190335&((b=251719695&((b=3272356035&((b=b>>>n&1227133513)|b>>>2))|b>>>4))|b>>>8))|b>>>16))<<22>>22},n.nextCombination=function(b){var n=b|b-1;return n+1|(~n&-~n)-1>>>i(b)+1}},12907:b=>{"use strict";b.exports=function(b,n,i,e){var V=self||window;try{try{var Q;try{Q=new V.Blob([b])}catch(B){(Q=new(V.BlobBuilder||V.WebKitBlobBuilder||V.MozBlobBuilder||V.MSBlobBuilder)).append(b),Q=Q.getBlob()}var U=V.URL||V.webkitURL,Y=U.createObjectURL(Q),L=new V[n](Y,i);return U.revokeObjectURL(Y),L}catch(B){return new V[n]("data:application/javascript,".concat(encodeURIComponent(b)),i)}}catch(B){if(!e)throw Error("Inline worker is not supported");return new V[n](e,i)}}},12576:(b,n,i)=>{"use strict";function e(b,n,i,e,V){var Q={};return Object.keys(e).forEach((function(b){Q[b]=e[b]})),Q.enumerable=!!Q.enumerable,Q.configurable=!!Q.configurable,("value"in Q||Q.initializer)&&(Q.writable=!0),Q=i.slice().reverse().reduce((function(i,e){return e(b,n,i)||i}),Q),V&&void 0!==Q.initializer&&(Q.value=Q.initializer?Q.initializer.call(V):void 0,Q.initializer=void 0),void 0===Q.initializer&&(Object.defineProperty(b,n,Q),Q=null),Q}i.d(n,{b:()=>e})},12574:(b,n,i)=>{"use strict";function e(b,n,i,e){i&&Object.defineProperty(b,n,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(e):void 0})}i.d(n,{d:()=>e})},14009:(b,n,i)=>{"use strict";i.d(n,{b:()=>U,c:()=>N,g:()=>Y,k:()=>Q,n:()=>L,p:()=>V,r:()=>B,s:()=>mb});var e=i(11978);class V{constructor(){this._easingMode=V.EASINGMODE_EASEIN}setEasingMode(b){const n=Math.min(Math.max(b,0),2);this._easingMode=n}getEasingMode(){return this._easingMode}easeInCore(b){throw new Error("You must implement this method")}ease(b){switch(this._easingMode){case V.EASINGMODE_EASEIN:return this.easeInCore(b);case V.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b)}return b>=.5?.5*(1-this.easeInCore(2*(1-b)))+.5:.5*this.easeInCore(2*b)}}V.EASINGMODE_EASEIN=0,V.EASINGMODE_EASEOUT=1,V.EASINGMODE_EASEINOUT=2;class Q extends V{easeInCore(b){return b=Math.max(0,Math.min(1,b)),1-Math.sqrt(1-b*b)}}class U extends V{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=b}easeInCore(b){const n=Math.max(0,this.amplitude);return Math.pow(b,3)-b*n*Math.sin(3.141592653589793*b)}}class Y extends V{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=b,this.bounciness=n}easeInCore(b){const n=Math.max(0,this.bounces);let i=this.bounciness;i<=1&&(i=1.001);const e=Math.pow(i,n),V=1-i,Q=(1-e)/V+.5*e,U=b*Q,Y=Math.log(-U*(1-i)+1)/Math.log(i),L=Math.floor(Y),B=L+1,mb=(1-Math.pow(i,L))/(V*Q),N=.5*(mb+(1-Math.pow(i,B))/(V*Q)),Z=b-N,T=N-mb;return-Math.pow(1/i,n-L)/(T*T)*(Z-T)*(Z+T)}}class L extends V{easeInCore(b){return b*b*b}}class B extends V{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=b,this.springiness=n}easeInCore(b){let n;const i=Math.max(0,this.oscillations),e=Math.max(0,this.springiness);return n=0==e?b:(Math.exp(e*b)-1)/(Math.exp(e)-1),n*Math.sin((6.283185307179586*i+1.5707963267948966)*b)}}class mb extends V{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=b}easeInCore(b){return this.exponent<=0?b:(Math.exp(this.exponent*b)-1)/(Math.exp(this.exponent)-1)}}class N extends V{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=b,this.y1=n,this.x2=i,this.y2=e}easeInCore(b){return e.d.Interpolate(b,this.x1,this.y1,this.x2,this.y2)}}},13451:(b,n,i)=>{"use strict";i.d(n,{e:()=>U});var e=i(11778),V=i(11788),Q=i(12187);class U extends Q.b{get _matrix(){return this._compose(),this.TZ}set _matrix(b){(b.updateFlag!==this.TZ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.TZ.L(b),this._markAsDirtyAndDecompose())}constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(b,n.ab(),!1),this.name=b,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=n,this.TZ=(null===V||void 0===V?void 0:V.clone())??e.Matrix.Identity(),this._restMatrix=Q??this.TZ.clone(),this._bindMatrix=U??this.TZ.clone(),this._index=Y,this._absoluteMatrix=new e.Matrix,this._absoluteBindMatrix=new e.Matrix,this._absoluteInverseBindMatrix=new e.Matrix,this._finalMatrix=new e.Matrix,n.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(b){this.setParent(b)}setParent(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==b){if(this.parent){const b=this.parent.children.indexOf(this);-1!==b&&this.parent.children.splice(b,1)}this._parentNode=b,this.parent&&this.parent.children.push(this),n&&this._updateAbsoluteBindMatrices(),this.WB()}}getLocalMatrix(){return this._compose(),this.TZ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(b){this._restMatrix.L(b)}setRestPose(b){this.setRestMatrix(b)}getBindPose(){return this.getBindMatrix()}setBindMatrix(b){this.Ee(b)}setBindPose(b){this.setBindMatrix(b)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const b=e.TmpVectors.On[0],n=e.TmpVectors.Quaternion[0],i=e.TmpVectors.On[1];this.getRestMatrix().decompose(b,n,i),this._linkedTransformNode.position.L(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??e.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.L(n),this._linkedTransformNode.ge.L(b)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(b){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=b,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.rY}set position(b){this._decompose(),this.rY.L(b),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(b){this.setRotation(b)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(b){this.setRotationQuaternion(b)}get ge(){return this.getScale()}set ge(b){this.setScale(b)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=e.On.Zero(),this._localRotation=e.Quaternion.Zero(),this.rY=e.On.Zero()),this.TZ.decompose(this._localScaling,this._localRotation,this.rY))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,e.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.rY,this.TZ)):this._needToCompose=!1)}Ee(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.L(b),n&&this._updateAbsoluteBindMatrices(),i?this._matrix=b:this.WB()}_updateAbsoluteBindMatrices(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(b||(b=this._bindMatrix),this.parent?b.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.L(b),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),n)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}WB(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.WB(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.WB(),this._needToDecompose=!0}_updatePosition(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=this.getLocalMatrix();if(0==n)V?(Q.addAtIndex(12,b.x),Q.addAtIndex(13,b.y),Q.addAtIndex(14,b.z)):Q.setTranslationFromFloats(b.x,b.y,b.z);else{let n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=U._TmpMats[0],L=U._TmpVecs[0];this.parent?i&&n?(Y.L(this.parent.getAbsoluteMatrix()),Y.multiplyToRef(n,Y)):Y.L(this.parent.getAbsoluteMatrix()):e.Matrix.IdentityToRef(Y),V&&Y.setTranslationFromFloats(0,0,0),Y.invert(),e.On.TransformCoordinatesToRef(b,Y,L),V?(Q.addAtIndex(12,L.x),Q.addAtIndex(13,L.y),Q.addAtIndex(14,L.z)):Q.setTranslationFromFloats(L.x,L.y,L.z)}this._markAsDirtyAndDecompose()}translate(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(b,n,i,!0)}setPosition(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(b,n,i,!1)}setAbsolutePosition(b,n){this.setPosition(b,1,n)}scale(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=this.getLocalMatrix(),Y=U._TmpMats[0];e.Matrix.ScalingToRef(b,n,i,Y),Y.multiplyToRef(Q,Q),Y.invert();for(const e of this.children){const V=e.getLocalMatrix();V.multiplyToRef(Y,V),V.multiplyAtIndex(12,b),V.multiplyAtIndex(13,n),V.multiplyAtIndex(14,i),e._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),V)for(const e of this.children)e.scale(b,n,i,V)}setScale(b){this._decompose(),this._localScaling.L(b),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(b){this._decompose(),b.L(this._localScaling)}setYawPitchRoll(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4?arguments[4]:void 0;if(0===V){const Y=U._TmpQuat;return e.Quaternion.RotationYawPitchRollToRef(b,n,i,Y),void this.setRotationQuaternion(Y,V,Q)}const Y=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,Q))return;const L=U._TmpMats[1];e.Matrix.RotationYawPitchRollToRef(b,n,i,L),Y.multiplyToRef(L,L),this._rotateWithMatrix(L,V,Q)}rotate(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,V=arguments.length>3?arguments[3]:void 0;const Q=U._TmpMats[0];Q.setTranslationFromFloats(0,0,0),e.Matrix.RotationAxisToRef(b,n,Q),this._rotateWithMatrix(Q,i,V)}setAxisAngle(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,V=arguments.length>3?arguments[3]:void 0;if(0===i){const Q=U._TmpQuat;return e.Quaternion.RotationAxisToRef(b,n,Q),void this.setRotationQuaternion(Q,i,V)}const Q=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,V))return;const Y=U._TmpMats[1];e.Matrix.RotationAxisToRef(b,n,Y),Q.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,i,V)}setRotation(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(b.y,b.x,b.z,n,i)}setRotationQuaternion(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===n)return this._decompose(),this._localRotation.L(b),void this._markAsDirtyAndCompose();const V=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,i))return;const Q=U._TmpMats[1];e.Matrix.FromQuaternionToRef(b,Q),V.multiplyToRef(Q,Q),this._rotateWithMatrix(Q,n,i)}setRotationMatrix(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===n){const V=U._TmpQuat;return e.Quaternion.FromRotationMatrixToRef(b,V),void this.setRotationQuaternion(V,n,i)}const V=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,i))return;const Q=U._TmpMats[1];Q.L(b),V.multiplyToRef(b,Q),this._rotateWithMatrix(Q,n,i)}_rotateWithMatrix(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const e=this.getLocalMatrix(),V=e.m[12],Q=e.m[13],Y=e.m[14],L=this.getParent(),B=U._TmpMats[3],mb=U._TmpMats[4];L&&1==n?(i?(B.L(i.getWorldMatrix()),L.getAbsoluteMatrix().multiplyToRef(B,B)):B.L(L.getAbsoluteMatrix()),mb.L(B),mb.invert(),e.multiplyToRef(B,e),e.multiplyToRef(b,e),e.multiplyToRef(mb,e)):1==n&&i?(B.L(i.getWorldMatrix()),mb.L(B),mb.invert(),e.multiplyToRef(B,e),e.multiplyToRef(b,e),e.multiplyToRef(mb,e)):e.multiplyToRef(b,e),e.setTranslationFromFloats(V,Q,Y),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(b,n){const i=U._TmpMats[2];return b.L(this.getAbsoluteMatrix()),n?(b.multiplyToRef(n.getWorldMatrix(),b),e.Matrix.ScalingToRef(n.ge.x,n.ge.y,n.ge.z,i)):e.Matrix.IdentityToRef(i),b.invert(),!isNaN(b.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyToRef(i,b),!0)}me(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.On.Zero();return this.getPositionToRef(b,n,i),i}getPositionToRef(){let b=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const b=this.getLocalMatrix();n.x=b.m[12],n.y=b.m[13],n.z=b.m[14]}else{let i=null;b&&(i=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let e=U._TmpMats[0];b&&i?(e.L(this.getAbsoluteMatrix()),e.multiplyToRef(i,e)):e=this.getAbsoluteMatrix(),n.x=e.m[12],n.y=e.m[13],n.z=e.m[14]}}getAbsolutePosition(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n=e.On.Zero();return this.getPositionToRef(1,b,n),n}getAbsolutePositionToRef(b,n){this.getPositionToRef(1,b,n)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.TZ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.L(this.TZ);const b=this._skeleton.getPoseMatrix();b&&this._absoluteMatrix.multiplyToRef(b,this._absoluteMatrix)}const b=this.children,n=b.length;for(let i=0;i<n;i++)b[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}zL(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.On.Zero();return this.getDirectionToRef(b,n,i),i}getDirectionToRef(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,V=null;n&&(V=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=U._TmpMats[0];Q.L(this.getAbsoluteMatrix()),n&&V&&Q.multiplyToRef(V,Q),e.On.TransformNormalToRef(b,Q,i),i.normalize()}getRotation(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.On.Zero();return this.getRotationToRef(b,n,i),i}getRotationToRef(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const e=U._TmpQuat;this.getRotationQuaternionToRef(b,n,e),e.toEulerAnglesToRef(i)}getRotationQuaternion(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.Quaternion.Identity();return this.getRotationQuaternionToRef(b,n,i),i}getRotationQuaternionToRef(){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),n.L(this._localRotation);else{const i=U._TmpMats[0],e=this.getAbsoluteMatrix();b?e.multiplyToRef(b.getWorldMatrix(),i):i.L(e),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.decompose(void 0,n,void 0)}}getRotationMatrix(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;const i=e.Matrix.Identity();return this.getRotationMatrixToRef(b,n,i),i}getRotationMatrixToRef(){let b=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(n);else{const i=U._TmpMats[0],e=this.getAbsoluteMatrix();b?e.multiplyToRef(b.getWorldMatrix(),i):i.L(e),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.getRotationMatrixToRef(n)}}getAbsolutePositionFromLocal(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.On.Zero();return this.getAbsolutePositionFromLocalToRef(b,n,i),i}getAbsolutePositionFromLocalToRef(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,V=null;n&&(V=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=U._TmpMats[0];Q.L(this.getAbsoluteMatrix()),n&&V&&Q.multiplyToRef(V,Q),e.On.TransformCoordinatesToRef(b,Q,i)}getLocalPositionFromAbsolute(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.On.Zero();return this.getLocalPositionFromAbsoluteToRef(b,n,i),i}getLocalPositionFromAbsoluteToRef(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,V=null;n&&(V=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=U._TmpMats[0];Q.L(this.getAbsoluteMatrix()),n&&V&&Q.multiplyToRef(V,Q),Q.invert(),e.On.TransformCoordinatesToRef(b,Q,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const b=this._skeleton.bones.indexOf(this);if(-1!==b&&this._skeleton.bones.splice(b,1),this._parentNode&&this._parentNode.children){const b=this._parentNode.children,n=b.indexOf(this);-1!==n&&b.splice(n,1)}super.dispose()}}U._TmpVecs=(0,V.d)(2,e.On.Zero),U._TmpQuat=e.Quaternion.Identity(),U._TmpMats=(0,V.d)(5,e.Matrix.Identity)},14006:(b,n,i)=>{"use strict";i.d(n,{d:()=>t});var e=i(11756),V=i(11762),Q=i(11612),U=i(11778),Y=i(11796),L=i(12187),B=i(12215),mb=i(12047),N=i(11628),Z=i(11786);class T{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(b){this._zoomStopsAnimation=b}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(b){this._idleRotationSpeed=b}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(b){this._idleRotationWaitTime=b}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(b){this._idleRotationSpinupTime=b}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(b){this._attachedCamera=b;const n=this._attachedCamera.ab();this._onPrePointerObservableObserver=n.onPrePointerObservable.add((b=>{b.type!==mb.d.POINTERDOWN?b.type===mb.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const b=N.b.Now;let n=0;null!=this._lastFrameTime&&(n=b-this._lastFrameTime),this._lastFrameTime=b,this._applyUserInteraction();const i=b-this._lastInteractionTime-this._idleRotationWaitTime,e=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*e,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(n/1e3))}))}detach(){if(!this._attachedCamera)return;const b=this._attachedCamera.ab();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(b){this._lastInteractionTime=b??N.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let b=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(b=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?b:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=N.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var z=i(14009),K=i(12301);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(b){if(this._autoTransitionRange===b)return;this._autoTransitionRange=b;const n=this._attachedCamera;n&&(b?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add((b=>{if(b&&(b.we(!0),b.getBoundingInfo)){const n=b.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*n,this.upperRadiusTransitionRange=.05*n}})):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(b){this._attachedCamera=b,this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(b){return!!this._attachedCamera&&(this._attachedCamera.radius===b&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(b){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=K.c.CreateAnimation("radius",K.c.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const n=K.c.TransitionTo("radius",this._attachedCamera.radius+b,this._attachedCamera,this._attachedCamera.ab(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));n&&this._animatables.push(n)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new z.b(.3),I.EasingMode=z.p.EASINGMODE_EASEOUT;class O{constructor(){this.onTargetFramingAnimationEndObservable=new Q.e,this._mode=O.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(b){this._mode=b}get mode(){return this._mode}set radiusScale(b){this._radiusScale=b}get radiusScale(){return this._radiusScale}set positionScale(b){this._positionScale=b}get positionScale(){return this._positionScale}set defaultElevation(b){this._defaultElevation=b}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(b){this._elevationReturnTime=b}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(b){this._elevationReturnWaitTime=b}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(b){this._zoomStopsAnimation=b}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(b){this._framingTime=b}get framingTime(){return this._framingTime}init(){}attach(b){this._attachedCamera=b;const n=this._attachedCamera.ab();O.EasingFunction.setEasingMode(O.EasingMode),this._onPrePointerObservableObserver=n.onPrePointerObservable.add((b=>{b.type!==mb.d.POINTERDOWN?b.type===mb.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((b=>{b&&b.getBoundingInfo&&this.zoomOnMesh(b,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const b=this._attachedCamera.ab();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.we(!0);const e=b.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(e.minimumWorld,e.maximumWorld,n,i)}zoomOnMeshHierarchy(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.we(!0);const e=b.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(e.min,e.max,n,i)}zoomOnMeshesHierarchy(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new U.On(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),V=new U.On(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Q=0;Q<b.length;Q++){const n=b[Q].getHierarchyBoundingVectors(!0);U.On.CheckExtends(n.min,e,V),U.On.CheckExtends(n.max,e,V)}this.zoomOnBoundingInfo(e,V,n,i)}zoomOnBoundingInfo(b,n){let i,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Q=b.y,Y=Q+(n.y-Q)*this._positionScale,L=n.un(b).scale(.5);if(!isFinite(Y))return!1;if(e)i=new U.On(0,Y,0);else{const n=b.add(L);i=new U.On(n.x,Y,n.z)}this._vectorTransition||(this._vectorTransition=K.c.CreateAnimation("target",K.c.ANIMATIONTYPE_VECTOR3,60,O.EasingFunction)),this._betaIsAnimating=!0;let B=K.c.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.ab(),60,this._vectorTransition,this._framingTime);B&&this._animatables.push(B);let mb=0;if(this._mode===O.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(b,n);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=L.length()+this._attachedCamera.Ae),mb=i}else this._mode===O.IgnoreBoundsSizeMode&&(mb=this._calculateLowerRadiusFromModelBoundingSphere(b,n),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ae));if(this.autoCorrectCameraLimitsAndSensibility){const i=n.un(b).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/mb}return this._radiusTransition||(this._radiusTransition=K.c.CreateAnimation("radius",K.c.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),B=K.c.TransitionTo("radius",mb,this._attachedCamera,this._attachedCamera.ab(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),V&&V(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),B&&this._animatables.push(B),!0}_calculateLowerRadiusFromModelBoundingSphere(b,n){const i=this._attachedCamera;if(!i)return 0;let e=i._calculateLowerRadiusFromModelBoundingSphere(b,n,this._radiusScale);return i.lowerRadiusLimit&&this._mode===O.IgnoreBoundsSizeMode&&(e=e<i.lowerRadiusLimit?i.lowerRadiusLimit:e),i.upperRadiusLimit&&(e=e>i.upperRadiusLimit?i.upperRadiusLimit:e),e}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const b=N.b.Now-this._lastInteractionTime,n=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&b>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=K.c.CreateAnimation("beta",K.c.ANIMATIONTYPE_FLOAT,60,O.EasingFunction));const b=K.c.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.ab(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));b&&this._animatables.push(b)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=N.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}O.EasingFunction=new z.s,O.EasingMode=z.p.EASINGMODE_EASEINOUT,O.IgnoreBoundsSizeMode=0,O.FitFrustumSidesMode=1;var u=i(12222),d=i(12252),G=i(13447),o=i(11605);class M{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(b){b=o.Tools.BackCompatCameraNoPreventDefault(arguments);const n=this.camera.getEngine(),i=n.getInputElement();let e=0,V=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Q=>{var U,Y;const L=Q.event,B="touch"===L.pointerType;if(Q.type!==mb.d.POINTERMOVE&&-1===this.buttons.indexOf(L.button))return;const N=L.target;if(this._altKey=L.altKey,this._ctrlKey=L.ctrlKey,this._metaKey=L.metaKey,this._shiftKey=L.shiftKey,this._buttonsPressed=L.buttons,n.isPointerLock){const b=L.movementX,n=L.movementY;this.onTouch(null,b,n),this._pointA=null,this._pointB=null}else{if(Q.type!==mb.d.POINTERDOWN&&Q.type!==mb.d.POINTERDOUBLETAP&&B&&(null===(U=this._pointA)||void 0===U?void 0:U.pointerId)!==L.pointerId&&(null===(Y=this._pointB)||void 0===Y?void 0:Y.pointerId)!==L.pointerId)return;if(Q.type!==mb.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!B)if(Q.type===mb.d.POINTERDOUBLETAP)this.onDoubleTap(L.pointerType);else if(Q.type!==mb.d.POINTERUP||this._currentMousePointerIdDown!==L.pointerId&&!B){if(Q.type===mb.d.POINTERMOVE)if(b||L.preventDefault(),this._pointA&&null===this._pointB){const b=L.clientX-this._pointA.x,n=L.clientY-this._pointA.y;this._pointA.x=L.clientX,this._pointA.y=L.clientY,this.onTouch(this._pointA,b,n)}else if(this._pointA&&this._pointB){const b=this._pointA.pointerId===L.pointerId?this._pointA:this._pointB;b.x=L.clientX,b.y=L.clientY;const n=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,U=n*n+i*i,Y={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:L.pointerId,type:Q.type};this.onMultiTouch(this._pointA,this._pointB,e,U,V,Y),V=Y,e=U}}else{try{null===N||void 0===N||N.releasePointerCapture(L.pointerId)}catch(Z){}B||(this._pointB=null),n._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==L.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==L.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==e||V)&&(this.onMultiTouch(this._pointA,this._pointB,e,0,V,null),e=0,V=null),this._currentMousePointerIdDown=-1,this.onButtonUp(L),b||L.preventDefault()}else{try{null===N||void 0===N||N.setPointerCapture(L.pointerId)}catch(Z){}if(null===this._pointA)this._pointA={x:L.clientX,y:L.clientY,pointerId:L.pointerId,type:L.pointerType};else{if(null!==this._pointB)return;this._pointB={x:L.clientX,y:L.clientY,pointerId:L.pointerId,type:L.pointerType}}-1!==this._currentMousePointerIdDown||B||(this._currentMousePointerIdDown=L.pointerId),this.onButtonDown(L),b||(L.preventDefault(),i&&i.focus())}}},this._observer=this.camera.ab()._inputManager._addCameraPointerObserver(this._pointerInput,mb.d.POINTERDOWN|mb.d.POINTERUP|mb.d.POINTERMOVE|mb.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,e=0,V=null,this.onLostFocus()},this._contextMenuBind=b=>this.onContextMenu(b),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const Q=this.camera.ab().getEngine().getHostWindow();Q&&o.Tools.RegisterTopRootEvents(Q,[{name:"blur",handler:this._onLostFocus}])}aN(){if(this._onLostFocus){const b=this.camera.ab().getEngine().getHostWindow();b&&o.Tools.UnregisterTopRootEvents(b,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const b=this.camera.ab().getEngine().getInputElement();b&&b.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(b){}onTouch(b,n,i){}onMultiTouch(b,n,i,e,V,Q){}onContextMenu(b){b.preventDefault()}onButtonDown(b){}onButtonUp(b){}onLostFocus(){}}(0,e.e)([(0,V.W)()],M.prototype,"buttons",void 0);class j extends M{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(b,n){if(0!==this.panningSensibility&&b&&n){const i=n.x-b.x,e=n.y-b.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=e/this.panningSensibility}}_computePinchZoom(b,n){const i=this.camera.radius||j.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(b)/Math.sqrt(n):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(n-b)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(n-b)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(b,n,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=n/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(b,n,i,e,V,Q){0===i&&null===V||0===e&&null===Q||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,e),this._computeMultiTouchPanning(V,Q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(e)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,e),this._isPinching=!0):this._computeMultiTouchPanning(V,Q)):this.multiTouchPanning?this._computeMultiTouchPanning(V,Q):this.pinchZoom&&this._computePinchZoom(i,e))}onButtonDown(b){this._isPanClick=b.button===this.camera._panningMouseButton}onButtonUp(b){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}j.MinimumRadiusForPinch=.001,(0,e.e)([(0,V.W)()],j.prototype,"buttons",void 0),(0,e.e)([(0,V.W)()],j.prototype,"angularSensibilityX",void 0),(0,e.e)([(0,V.W)()],j.prototype,"angularSensibilityY",void 0),(0,e.e)([(0,V.W)()],j.prototype,"pinchPrecision",void 0),(0,e.e)([(0,V.W)()],j.prototype,"pinchDeltaPercentage",void 0),(0,e.e)([(0,V.W)()],j.prototype,"useNaturalPinchZoom",void 0),(0,e.e)([(0,V.W)()],j.prototype,"pinchZoom",void 0),(0,e.e)([(0,V.W)()],j.prototype,"panningSensibility",void 0),(0,e.e)([(0,V.W)()],j.prototype,"multiTouchPanning",void 0),(0,e.e)([(0,V.W)()],j.prototype,"multiTouchPanAndZoom",void 0),G.c.ArcRotateCameraPointersInput=j;var a=i(12056);class D{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(b){b=o.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ab(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((n=>{const i=n.event;if(!i.metaKey)if(n.type===a.e.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(b||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const n=this._keys.indexOf(i.keyCode);n>=0&&this._keys.splice(n,1),i.preventDefault&&(b||i.preventDefault())}})))}aN(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const b=this.camera;for(let n=0;n<this._keys.length;n++){const i=this._keys[n];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX-=1/this.panningSensibility:b.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset+=1/this.zoomingSensibility:b.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX+=1/this.panningSensibility:b.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset-=1/this.zoomingSensibility:b.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&b.useInputToRestoreState&&b.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,e.e)([(0,V.W)()],D.prototype,"keysUp",void 0),(0,e.e)([(0,V.W)()],D.prototype,"keysDown",void 0),(0,e.e)([(0,V.W)()],D.prototype,"keysLeft",void 0),(0,e.e)([(0,V.W)()],D.prototype,"keysRight",void 0),(0,e.e)([(0,V.W)()],D.prototype,"keysReset",void 0),(0,e.e)([(0,V.W)()],D.prototype,"panningSensibility",void 0),(0,e.e)([(0,V.W)()],D.prototype,"zoomingSensibility",void 0),(0,e.e)([(0,V.W)()],D.prototype,"useAltToZoom",void 0),(0,e.e)([(0,V.W)()],D.prototype,"angularSpeed",void 0),G.c.ArcRotateCameraKeyboardMoveInput=D;var x=i(11824),y=i(12064);class s{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new U.On(0,0,0),this._globalOffset=new U.On(0,0,0),this._inertialPanning=U.On.Zero()}_computeDeltaFromMouseWheelLegacyEvent(b,n){let i=0;const e=.01*b*this.wheelDeltaPercentage*n;return i=b>0?e/(1+this.wheelDeltaPercentage):e*(1+this.wheelDeltaPercentage),i}attachControl(b){b=o.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=n=>{if(n.type!==mb.d.POINTERWHEEL)return;const i=n.event;let e=0;const V=i.deltaMode===y.e.DOM_DELTA_LINE?40:1,Q=-i.deltaY*V;if(this.customComputeDeltaFromMouseWheel)e=this.customComputeDeltaFromMouseWheel(Q,this,i);else if(this.wheelDeltaPercentage){if(e=this._computeDeltaFromMouseWheelLegacyEvent(Q,this.camera.radius),e>0){let b=this.camera.radius,n=this.camera.inertialRadiusOffset+e;for(let i=0;i<20&&!(b<=n)&&!(Math.abs(n*this.camera.inertia)<.001);i++)b-=n,n*=this.camera.inertia;b=(0,Y.Clamp)(b,0,Number.MAX_VALUE),e=this._computeDeltaFromMouseWheelLegacyEvent(Q,b)}}else e=Q/(40*this.wheelPrecision);e&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(e)):this.camera.inertialRadiusOffset+=e),i.preventDefault&&(b||i.preventDefault())},this._observer=this.camera.ab()._inputManager._addCameraPointerObserver(this._wheel,mb.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Fe(0)}aN(){this._observer&&(this.camera.ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const b=this.camera;0+b.inertialAlphaOffset+b.inertialBetaOffset+b.inertialRadiusOffset&&(this._updateHitPlane(),b.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(b.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const b=this.camera,n=b.target.un(b.position);this._hitPlane=x.c.FromPositionAndNormal(b.target,n)}_getPosition(){const b=this.camera,n=b.ab(),i=n.createPickingRay(n.pointerX,n.pointerY,U.Matrix.Identity(),b,!1);0===b.targetScreenOffset.x&&0===b.targetScreenOffset.y||(this._viewOffset.set(b.targetScreenOffset.x,b.targetScreenOffset.y,0),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),this._globalOffset=U.On.TransformNormal(this._viewOffset,b._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let e=0;return this._hitPlane&&(e=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(e))}_zoomToMouse(b){const n=this.camera,i=1-n.inertia;if(n.lowerRadiusLimit){const e=n.lowerRadiusLimit??0;n.radius-(n.inertialRadiusOffset+b)/i<e&&(b=(n.radius-e)*i-n.inertialRadiusOffset)}if(n.upperRadiusLimit){const e=n.upperRadiusLimit??0;n.radius-(n.inertialRadiusOffset+b)/i>e&&(b=(n.radius-e)*i-n.inertialRadiusOffset)}const e=b/i/n.radius,V=this._getPosition(),Q=U.TmpVectors.On[6];V.subtractToRef(n.target,Q),Q.scaleInPlace(e),Q.scaleInPlace(i),this._inertialPanning.addInPlace(Q),n.inertialRadiusOffset+=b}_zeroIfClose(b){Math.abs(b.x)<Z.c&&(b.x=0),Math.abs(b.y)<Z.c&&(b.y=0),Math.abs(b.z)<Z.c&&(b.z=0)}}(0,e.e)([(0,V.W)()],s.prototype,"wheelPrecision",void 0),(0,e.e)([(0,V.W)()],s.prototype,"zoomToMouseLocation",void 0),(0,e.e)([(0,V.W)()],s.prototype,"wheelDeltaPercentage",void 0),G.c.ArcRotateCameraMouseWheelInput=s;class A extends G.d{constructor(b){super(b)}addMouseWheel(){return this.add(new s),this}addPointers(){return this.add(new j),this}addKeyboard(){return this.add(new D),this}}var E=i(11734);function C(b,n){return isNaN(b)?n:b}L.b.AddNodeConstructor("ArcRotateCamera",((b,n)=>()=>new t(b,0,0,1,U.On.Zero(),n)));class t extends d.b{get target(){return this._target}set target(b){this.setTarget(b)}get targetHost(){return this._targetHost}set targetHost(b){b&&this.setTarget(b)}getTarget(){return this.target}get position(){return this._position}set position(b){this.setPosition(b)}set upVector(b){this._upToYMatrix||(this._yToUpMatrix=new U.Matrix,this._upToYMatrix=new U.Matrix,this._upVector=U.On.Zero()),b.normalize(),this._upVector.L(b),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){U.Matrix.RotationAlignToRef(U.On.UpReadOnly,this._upVector,this._yToUpMatrix),U.Matrix.RotationAlignToRef(this._upVector,U.On.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const b=this.inputs.attached.pointers;return b?b.angularSensibilityX:0}set angularSensibilityX(b){const n=this.inputs.attached.pointers;n&&(n.angularSensibilityX=b)}get angularSensibilityY(){const b=this.inputs.attached.pointers;return b?b.angularSensibilityY:0}set angularSensibilityY(b){const n=this.inputs.attached.pointers;n&&(n.angularSensibilityY=b)}get pinchPrecision(){const b=this.inputs.attached.pointers;return b?b.pinchPrecision:0}set pinchPrecision(b){const n=this.inputs.attached.pointers;n&&(n.pinchPrecision=b)}get pinchDeltaPercentage(){const b=this.inputs.attached.pointers;return b?b.pinchDeltaPercentage:0}set pinchDeltaPercentage(b){const n=this.inputs.attached.pointers;n&&(n.pinchDeltaPercentage=b)}get useNaturalPinchZoom(){const b=this.inputs.attached.pointers;return!!b&&b.useNaturalPinchZoom}set useNaturalPinchZoom(b){const n=this.inputs.attached.pointers;n&&(n.useNaturalPinchZoom=b)}get panningSensibility(){const b=this.inputs.attached.pointers;return b?b.panningSensibility:0}set panningSensibility(b){const n=this.inputs.attached.pointers;n&&(n.panningSensibility=b)}get keysUp(){const b=this.inputs.attached.keyboard;return b?b.keysUp:[]}set keysUp(b){const n=this.inputs.attached.keyboard;n&&(n.keysUp=b)}get keysDown(){const b=this.inputs.attached.keyboard;return b?b.keysDown:[]}set keysDown(b){const n=this.inputs.attached.keyboard;n&&(n.keysDown=b)}get keysLeft(){const b=this.inputs.attached.keyboard;return b?b.keysLeft:[]}set keysLeft(b){const n=this.inputs.attached.keyboard;n&&(n.keysLeft=b)}get keysRight(){const b=this.inputs.attached.keyboard;return b?b.keysRight:[]}set keysRight(b){const n=this.inputs.attached.keyboard;n&&(n.keysRight=b)}get wheelPrecision(){const b=this.inputs.attached.mousewheel;return b?b.wheelPrecision:0}set wheelPrecision(b){const n=this.inputs.attached.mousewheel;n&&(n.wheelPrecision=b)}get zoomToMouseLocation(){const b=this.inputs.attached.mousewheel;return!!b&&b.zoomToMouseLocation}set zoomToMouseLocation(b){const n=this.inputs.attached.mousewheel;n&&(n.zoomToMouseLocation=b)}get wheelDeltaPercentage(){const b=this.inputs.attached.mousewheel;return b?b.wheelDeltaPercentage:0}set wheelDeltaPercentage(b){const n=this.inputs.attached.mousewheel;n&&(n.wheelDeltaPercentage=b)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(b){b!==this.useBouncingBehavior&&(b?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(b){b!==this.useFramingBehavior&&(b?(this._framingBehavior=new O,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(b){b!==this.useAutoRotationBehavior&&(b?(this._autoRotationBehavior=new T,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(b,n,i,e,V,Y){var L;let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(b,U.On.Zero(),Y,B),L=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=U.On.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=U.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new U.Matrix,this.panningAxis=new U.On(1,1,0),this._transformedDirection=new U.On,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Q.e,this.checkCollisions=!1,this.collisionRadius=new U.On(.5,.5,.5),this._previousPosition=U.On.Zero(),this._collisionVelocity=U.On.Zero(),this._newPosition=U.On.Zero(),this._computationVector=U.On.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new U.On(NaN,NaN,NaN),this._goalTargetScreenOffset=new U.Vector2(NaN,NaN),this._onCollisionPositionChange=function(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i?(L.setPosition(n),L.YT&&L.YT(i)):L._previousPosition.L(L._position);const e=Math.cos(L.alpha),V=Math.sin(L.alpha),Q=Math.cos(L.beta);let U=Math.sin(L.beta);0===U&&(U=1e-4);const Y=L._getTargetPosition();L._computationVector.re(L.radius*e*U,L.radius*Q,L.radius*V*U),Y.addToRef(L._computationVector,L._newPosition),L._position.L(L._newPosition);let B=L.upVector;L.allowUpsideDown&&L.beta<0&&(B=B.clone(),B=B.negate()),L._computeViewMatrix(L._position,Y,B),L._viewMatrix.addAtIndex(12,L.targetScreenOffset.x),L._viewMatrix.addAtIndex(13,L.targetScreenOffset.y),L._collisionTriggered=!1},this._target=U.On.Zero(),V&&this.setTarget(V),this.alpha=n,this.beta=i,this.radius=e,this.getViewMatrix(),this.inputs=new A(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new U.On(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=U.Vector2.Zero()}_updateCache(b){b||super._updateCache(),this._cache._target.L(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.L(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const b=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?b.addToRef(this._targetBoundingCenter,this._target):this._target.L(b)}const b=this._getLockedTargetPosition();return b||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Q=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Q?this._currentInterpolationFactor=Q:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=C(b,this._goalAlpha),this._goalBeta=C(n,this._goalBeta),this._goalRadius=C(i,this._goalRadius),this._goalTarget.set(C(e.x,this._goalTarget.x),C(e.y,this._goalTarget.y),C(e.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(C(V.x,this._goalTargetScreenOffset.x),C(V.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,Y.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,Y.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,Y.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,Y.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(b,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const V=arguments;n=o.Tools.BackCompatCameraNoPreventDefault(V),this._useCtrlForPanning=i,this._panningMouseButton=e,"boolean"===typeof V[0]&&(V.length>1&&(this._useCtrlForPanning=V[1]),V.length>2&&(this._panningMouseButton=V[2])),this.inputs.attachElement(n),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}aN(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let b=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){b=!0;const n=this.invertRotation?-1:1,i=this._calculateHandednessMultiplier();let e=this.inertialAlphaOffset*i;this.beta<0&&(e*=-1),this.alpha+=e*n,this.beta+=this.inertialBetaOffset*n,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){b=!0;const n=new U.On(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),n.multiplyInPlace(this.panningAxis),U.On.TransformNormalToRef(n,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const b=this.upVector,n=U.On.CrossToRef(this._transformedDirection,b,this._transformedDirection);U.On.CrossToRef(b,n,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);U.On.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.L(this._transformedDirection)}else{if(this.parent){const b=U.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.transposeToRef(b),U.On.TransformCoordinatesToRef(this._transformedDirection,b,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.c&&(this.inertialPanningY=0)}if(b)this.stopInterpolation();else if(this._isInterpolating){let b=!1;const n=this._scene.getEngine().getDeltaTime()/1e3,i=1-Math.pow(2,-n/this._currentInterpolationFactor),e=C(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const n=U.TmpVectors.On[0].set(C(this._goalTarget.x,this._target.x),C(this._goalTarget.y,this._target.y),C(this._goalTarget.z,this._target.z));U.On.LerpToRef(this.target,n,i,this._target),10*U.On.Distance(this.target,n)/e<Z.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.L(n),this.setTarget(this.target,!1,!0,!0)):b=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const n=U.Quaternion.RotationAlphaBetaGammaToRef(C(this._goalAlpha,this.alpha),C(this._goalBeta,this.beta),0,U.TmpVectors.Quaternion[0]),e=U.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,U.TmpVectors.Quaternion[1]),V=U.Quaternion.SlerpToRef(e,n,i,U.TmpVectors.Quaternion[2]);V.normalize();const Q=V.toAlphaBetaGammaToRef(U.TmpVectors.On[0]);if(this.alpha=Q.x,this.beta=Q.y,V.isApprox(n,Z.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const b=n.toAlphaBetaGammaToRef(U.TmpVectors.On[0]);this.alpha=b.x,this.beta=b.y}else b=!0}if(isNaN(this._goalRadius)||(this.radius+=(e-this.radius)*i,Math.abs(e/this.radius-1)<Z.c?(this._goalRadius=NaN,this.radius=e):b=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const n=U.TmpVectors.Vector2[0].set(C(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),C(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));U.Vector2.LerpToRef(this.targetScreenOffset,n,i,this.targetScreenOffset),U.Vector2.Distance(this.targetScreenOffset,n)<Z.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.L(n)):b=!0}this._isInterpolating=b}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.On.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const b=this.alpha;var n,i;this.alpha=function(b){let n=Math.PI/2;return 0===b.x&&0===b.z||(n=Math.acos(b.x/Math.sqrt(Math.pow(b.x,2)+Math.pow(b.z,2)))),b.z<0&&(n=2*Math.PI-n),n}(this._computationVector),this.beta=(n=this._computationVector.y,i=this.radius,Math.acos(n/i));const e=Math.round((b-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this._checkLimits()}setPosition(b){this._position.equals(b)||(this._position.L(b),this.rebuildAnglesAndRadius())}setTarget(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e=this.overrideCloneAlphaBetaRadius??e,b.we)n&&b.getBoundingInfo?this._targetBoundingCenter=b.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,b.we(),this._targetHost=b,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const n=b,e=this._getTargetPosition();if(e&&!i&&e.equals(n))return;this._targetHost=null,this._target=n,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}e||this.rebuildAnglesAndRadius()}_getViewMatrix(){const b=Math.cos(this.alpha),n=Math.sin(this.alpha),i=Math.cos(this.beta);let e=Math.sin(this.beta);0===e&&(e=1e-4),0===this.radius&&(this.radius=1e-4);const V=this._getTargetPosition();if(this._computationVector.re(this.radius*b*e,this.radius*i,this.radius*n*e),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.On.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),V.addToRef(this._computationVector,this._newPosition),this.ab().collisionsEnabled&&this.checkCollisions){const b=this.ab().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,b.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.L(this._newPosition);let b=this.upVector;this.allowUpsideDown&&e<0&&(b=b.negate()),this._computeViewMatrix(this._position,V,b),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.L(V),this._viewMatrix}zoomOn(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b=b||this.ab().meshes;const i=B.b.MinMax(b);let e=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);if(e=Math.max(Math.min(e,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=e*this.zoomOnFactor,this.mode===u.c.ORTHOGRAPHIC_CAMERA){const b=this.ab().getEngine().getAspectRatio(this),n=e*this.zoomOnFactor/2;this.orthoLeft=-n*b,this.orthoRight=n*b,this.orthoBottom=-n,this.orthoTop=n}this.focusOn({min:i.min,max:i.max,distance:e},n)}focusOn(b){let n,i,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===b.min){const e=b||this.ab().meshes;n=B.b.MinMax(e),i=U.On.Distance(n.min,n.max)}else{n=b,i=b.distance}this._target=B.b.Center(n),e||(this.maxZ=2*i)}createRigCamera(b,n){let i=0;switch(this.cameraRigMode){case u.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case u.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case u.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case u.c.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===n?1:-1);break;case u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===n?-1:1)}const e=new t(b,this.alpha+i,this.beta,this.radius,this._target,this.ab());return e._cameraRigParams={},e.isRigCamera=!0,e.rigParent=this,e.upVector=this.upVector,e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoBottom=this.orthoBottom,e.orthoTop=this.orthoTop,e}_updateRigCameras(){const b=this._rigCameras[0],n=this._rigCameras[1];switch(b.beta=n.beta=this.beta,this.cameraRigMode){case u.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case u.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case u.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case u.c.RIG_MODE_VR:b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const e=U.On.Distance(b,n),V=this.ab().getEngine().getAspectRatio(this),Q=Math.tan(this.fov/2),Y=Q*V,L=.5*e*i,B=L*Math.sqrt(1+1/(Y*Y)),mb=L*Math.sqrt(1+1/(Q*Q));return Math.max(B,mb)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,e.e)([(0,V.W)()],t.prototype,"alpha",void 0),(0,e.e)([(0,V.W)()],t.prototype,"beta",void 0),(0,e.e)([(0,V.W)()],t.prototype,"radius",void 0),(0,e.e)([(0,V.W)()],t.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,e.e)([(0,V.S)("target")],t.prototype,"_target",void 0),(0,e.e)([(0,V.E)("targetHost")],t.prototype,"_targetHost",void 0),(0,e.e)([(0,V.W)()],t.prototype,"inertialAlphaOffset",void 0),(0,e.e)([(0,V.W)()],t.prototype,"inertialBetaOffset",void 0),(0,e.e)([(0,V.W)()],t.prototype,"inertialRadiusOffset",void 0),(0,e.e)([(0,V.W)()],t.prototype,"lowerAlphaLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"upperAlphaLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"lowerBetaLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"upperBetaLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"lowerRadiusLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"upperRadiusLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"lowerTargetYLimit",void 0),(0,e.e)([(0,V.W)()],t.prototype,"inertialPanningX",void 0),(0,e.e)([(0,V.W)()],t.prototype,"inertialPanningY",void 0),(0,e.e)([(0,V.W)()],t.prototype,"pinchToPanMaxDistance",void 0),(0,e.e)([(0,V.W)()],t.prototype,"panningDistanceLimit",void 0),(0,e.e)([(0,V.S)()],t.prototype,"panningOriginTarget",void 0),(0,e.e)([(0,V.W)()],t.prototype,"panningInertia",void 0),(0,e.e)([(0,V.W)()],t.prototype,"zoomToMouseLocation",null),(0,e.e)([(0,V.W)()],t.prototype,"zoomOnFactor",void 0),(0,e.e)([(0,V.O)()],t.prototype,"targetScreenOffset",void 0),(0,e.e)([(0,V.W)()],t.prototype,"allowUpsideDown",void 0),(0,e.e)([(0,V.W)()],t.prototype,"useInputToRestoreState",void 0),(0,e.e)([(0,V.W)()],t.prototype,"restoreStateInterpolationFactor",void 0),(0,E.i)("BABYLON.ArcRotateCamera",t)},13447:(b,n,i)=>{"use strict";i.d(n,{c:()=>U,d:()=>Y});var e=i(11621),V=i(11811),Q=i(12222),U={};class Y{constructor(b){this.attachedToElement=!1,this.attached={},this.camera=b,this.checkInputs=()=>{}}add(b){const n=b.getSimpleName();this.attached[n]?e.b.Warn("camera input of type "+n+" already exists on camera"):(this.attached[n]=b,b.camera=this.camera,b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b))),this.attachedToElement&&b.attachControl(this.noPreventDefault))}remove(b){for(const n in this.attached){const i=this.attached[n];if(i===b)return i.aN(),i.camera=null,delete this.attached[n],void this.rebuildInputCheck()}}removeByType(b){for(const n in this.attached){const i=this.attached[n];i.getClassName()===b&&(i.aN(),i.camera=null,delete this.attached[n],this.rebuildInputCheck())}}_addCheckInputs(b){const n=this.checkInputs;return()=>{n(),b()}}attachInput(b){this.attachedToElement&&b.attachControl(this.noPreventDefault)}attachElement(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){b=!Q.c.ForceAttachControlToAlwaysPreventDefault&&b,this.attachedToElement=!0,this.noPreventDefault=b;for(const n in this.attached)this.attached[n].attachControl(b)}}detachElement(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const n in this.attached)this.attached[n].aN(),b&&(this.attached[n].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const b in this.attached){const n=this.attached[b];n.checkInputs&&(this.checkInputs=this._addCheckInputs(n.checkInputs.bind(n)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(b){const n={};for(const i in this.attached){const b=this.attached[i],e=V.c.Serialize(b);n[b.getClassName()]=e}b.inputsmgr=n}parse(b){const n=b.inputsmgr;if(n){this.clear();for(const b in n){const i=U[b];if(i){const e=n[b],Q=V.c.Parse((()=>new i),e,null);this.add(Q)}}}else for(const i in this.attached){const n=U[this.attached[i].getClassName()];if(n){const e=V.c.Parse((()=>new n),b,null);this.remove(this.attached[i]),this.add(e)}}}}},13445:(b,n,i)=>{"use strict";i.d(n,{c:()=>M});var e=i(11756),V=i(11762),Q=i(11778),U=i(12252),Y=i(13447),L=i(12056),B=i(11605);class mb{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(b){b=B.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ab(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((n=>{const i=n.event;if(!i.metaKey)if(n.type===L.e.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),b||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const n=this._keys.indexOf(i.keyCode);n>=0&&this._keys.splice(n,1),b||i.preventDefault()}})))}aN(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const b=this.camera;for(let n=0;n<this._keys.length;n++){const i=this._keys[n],e=b._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?b._localDirection.re(-e,0,0):-1!==this.keysUp.indexOf(i)?b._localDirection.re(0,0,e):-1!==this.keysRight.indexOf(i)?b._localDirection.re(e,0,0):-1!==this.keysDown.indexOf(i)?b._localDirection.re(0,0,-e):-1!==this.keysUpward.indexOf(i)?b._localDirection.re(0,e,0):-1!==this.keysDownward.indexOf(i)?b._localDirection.re(0,-e,0):-1!==this.keysRotateLeft.indexOf(i)?(b._localDirection.re(0,0,0),b.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(b._localDirection.re(0,0,0),b.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(b._localDirection.re(0,0,0),b.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(b._localDirection.re(0,0,0),b.cameraRotation.x+=this._getLocalRotation()),b.ab().useRightHandedSystem&&(b._localDirection.z*=-1),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),Q.On.TransformNormalToRef(b._localDirection,b._cameraTransformMatrix,b._transformedDirection),b.cameraDirection.addInPlace(b._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const b=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*b}}(0,e.e)([(0,V.W)()],mb.prototype,"keysUp",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysUpward",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysDown",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysDownward",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysLeft",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysRight",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"rotationSpeed",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysRotateLeft",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysRotateRight",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysRotateUp",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"keysRotateDown",void 0),Y.c.FreeCameraKeyboardMoveInput=mb;var N=i(11612),Z=i(12047);class T{constructor(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=b,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new N.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(b){b=B.Tools.BackCompatCameraNoPreventDefault(arguments);const n=this.camera.getEngine(),i=n.getInputElement();this._pointerInput||(this._pointerInput=e=>{const V=e.event,Q="touch"===V.pointerType;if(!this.touchEnabled&&Q)return;if(e.type!==Z.d.POINTERMOVE&&-1===this.buttons.indexOf(V.button))return;const U=V.target;if(e.type===Z.d.POINTERDOWN){if(Q&&-1!==this._activePointerId||!Q&&-1!==this._currentActiveButton)return;this._activePointerId=V.pointerId;try{null===U||void 0===U||U.setPointerCapture(V.pointerId)}catch(Y){}-1===this._currentActiveButton&&(this._currentActiveButton=V.button),this._previousPosition={x:V.clientX,y:V.clientY},b||(V.preventDefault(),i&&i.focus()),n.isPointerLock&&this._onMouseMove&&this._onMouseMove(e.event)}else if(e.type===Z.d.POINTERUP){if(Q&&this._activePointerId!==V.pointerId||!Q&&this._currentActiveButton!==V.button)return;try{null===U||void 0===U||U.releasePointerCapture(V.pointerId)}catch(Y){}this._currentActiveButton=-1,this._previousPosition=null,b||V.preventDefault(),this._activePointerId=-1}else if(e.type===Z.d.POINTERMOVE&&(this._activePointerId===V.pointerId||!Q))if(n.isPointerLock&&this._onMouseMove)this._onMouseMove(e.event);else if(this._previousPosition){const n=this.camera._calculateHandednessMultiplier(),i=(V.clientX-this._previousPosition.x)*n,e=V.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=e/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:e}),this._previousPosition={x:V.clientX,y:V.clientY},b||V.preventDefault()}}),this._onMouseMove=i=>{if(!n.isPointerLock)return;const e=this.camera._calculateHandednessMultiplier(),V=i.movementX*e;this.camera.cameraRotation.y+=V/this.angularSensibility;const Q=i.movementY;this.camera.cameraRotation.x+=Q/this.angularSensibility,this._previousPosition=null,b||i.preventDefault()},this._observer=this.camera.ab()._inputManager._addCameraPointerObserver(this._pointerInput,Z.d.POINTERDOWN|Z.d.POINTERUP|Z.d.POINTERMOVE),i&&(this._contextMenuBind=b=>this.onContextMenu(b),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(b){b.preventDefault()}aN(){if(this._observer){if(this.camera.ab()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const b=this.camera.getEngine().getInputElement();b&&b.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,e.e)([(0,V.W)()],T.prototype,"buttons",void 0),(0,e.e)([(0,V.W)()],T.prototype,"angularSensibility",void 0),Y.c.FreeCameraMouseInput=T;var z,K=i(12064);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new N.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(b){b=B.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=n=>{if(n.type!==Z.d.POINTERWHEEL)return;const i=n.event,e=i.deltaMode===K.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*e*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*e*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*e*i.deltaZ/this._normalize,i.preventDefault&&(b||i.preventDefault())},this._observer=this.camera.ab()._inputManager._addCameraPointerObserver(this._wheel,Z.d.POINTERWHEEL)}aN(){this._observer&&(this.camera.ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,e.e)([(0,V.W)()],I.prototype,"wheelPrecisionX",void 0),(0,e.e)([(0,V.W)()],I.prototype,"wheelPrecisionY",void 0),(0,e.e)([(0,V.W)()],I.prototype,"wheelPrecisionZ",void 0),function(b){b[b.MoveRelative=0]="MoveRelative",b[b.RotateRelative=1]="RotateRelative",b[b.MoveScene=2]="MoveScene"}(z||(z={}));class O extends I{constructor(){super(...arguments),this._moveRelative=Q.On.Zero(),this._rotateRelative=Q.On.Zero(),this._moveScene=Q.On.Zero(),this._wheelXAction=z.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=z.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(b){null===b&&this._wheelXAction!==z.MoveRelative||(this._wheelXAction=z.MoveRelative,this._wheelXActionCoordinate=b)}get wheelXMoveRelative(){return this._wheelXAction!==z.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(b){null===b&&this._wheelYAction!==z.MoveRelative||(this._wheelYAction=z.MoveRelative,this._wheelYActionCoordinate=b)}get wheelYMoveRelative(){return this._wheelYAction!==z.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(b){null===b&&this._wheelZAction!==z.MoveRelative||(this._wheelZAction=z.MoveRelative,this._wheelZActionCoordinate=b)}get wheelZMoveRelative(){return this._wheelZAction!==z.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(b){null===b&&this._wheelXAction!==z.RotateRelative||(this._wheelXAction=z.RotateRelative,this._wheelXActionCoordinate=b)}get wheelXRotateRelative(){return this._wheelXAction!==z.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(b){null===b&&this._wheelYAction!==z.RotateRelative||(this._wheelYAction=z.RotateRelative,this._wheelYActionCoordinate=b)}get wheelYRotateRelative(){return this._wheelYAction!==z.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(b){null===b&&this._wheelZAction!==z.RotateRelative||(this._wheelZAction=z.RotateRelative,this._wheelZActionCoordinate=b)}get wheelZRotateRelative(){return this._wheelZAction!==z.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(b){null===b&&this._wheelXAction!==z.MoveScene||(this._wheelXAction=z.MoveScene,this._wheelXActionCoordinate=b)}get wheelXMoveScene(){return this._wheelXAction!==z.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(b){null===b&&this._wheelYAction!==z.MoveScene||(this._wheelYAction=z.MoveScene,this._wheelYActionCoordinate=b)}get wheelYMoveScene(){return this._wheelYAction!==z.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(b){null===b&&this._wheelZAction!==z.MoveScene||(this._wheelZAction=z.MoveScene,this._wheelZActionCoordinate=b)}get wheelZMoveScene(){return this._wheelZAction!==z.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Fe(0),this._rotateRelative.Fe(0),this._moveScene.Fe(0),this._updateCamera(),this.camera.ab().useRightHandedSystem&&(this._moveRelative.z*=-1);const b=Q.Matrix.Zero();this.camera.getViewMatrix().invertToRef(b);const n=Q.On.Zero();Q.On.TransformNormalToRef(this._moveRelative,b,n),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(n),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(b,n,i){if(0===b)return;if(null===n||null===i)return;let e=null;switch(n){case z.MoveRelative:e=this._moveRelative;break;case z.RotateRelative:e=this._rotateRelative;break;case z.MoveScene:e=this._moveScene}switch(i){case 0:e.set(b,0,0);break;case 1:e.set(0,b,0);break;case 2:e.set(0,0,b)}}}(0,e.e)([(0,V.W)()],O.prototype,"wheelXMoveRelative",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelYMoveRelative",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelZMoveRelative",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelXRotateRelative",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelYRotateRelative",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelZRotateRelative",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelXMoveScene",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelYMoveScene",null),(0,e.e)([(0,V.W)()],O.prototype,"wheelZMoveScene",null),Y.c.FreeCameraMouseWheelInput=O;class u{constructor(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=b,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=B.Tools.IsSafari()}attachControl(b){b=B.Tools.BackCompatCameraNoPreventDefault(arguments);let n=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const e=i.event,V="mouse"===e.pointerType||this._isSafari&&"undefined"===typeof e.pointerType;if(this.allowMouse||!V)if(i.type===Z.d.POINTERDOWN){if(b||e.preventDefault(),this._pointerPressed.push(e.pointerId),1!==this._pointerPressed.length)return;n={x:e.clientX,y:e.clientY}}else if(i.type===Z.d.POINTERUP){b||e.preventDefault();const i=this._pointerPressed.indexOf(e.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;n=null,this._offsetX=null,this._offsetY=null}else if(i.type===Z.d.POINTERMOVE){if(b||e.preventDefault(),!n)return;if(0!=this._pointerPressed.indexOf(e.pointerId))return;this._offsetX=e.clientX-n.x,this._offsetY=-(e.clientY-n.y)}}),this._observer=this.camera.ab()._inputManager._addCameraPointerObserver(this._pointerInput,Z.d.POINTERDOWN|Z.d.POINTERUP|Z.d.POINTERMOVE),this._onLostFocus){const b=this.camera.getEngine().getInputElement();b&&b.addEventListener("blur",this._onLostFocus)}}aN(){if(this._pointerInput){if(this._observer&&(this.camera.ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const b=this.camera.getEngine().getInputElement();b&&b.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const b=this.camera,n=b._calculateHandednessMultiplier();b.cameraRotation.y=n*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)b.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const n=b._computeLocalCameraSpeed(),i=new Q.On(0,0,0!==this.touchMoveSensibility?n*this._offsetY/this.touchMoveSensibility:0);Q.Matrix.RotationYawPitchRollToRef(b.rotation.y,b.rotation.x,0,b._cameraRotationMatrix),b.cameraDirection.addInPlace(Q.On.TransformCoordinates(i,b._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,e.e)([(0,V.W)()],u.prototype,"touchAngularSensibility",void 0),(0,e.e)([(0,V.W)()],u.prototype,"touchMoveSensibility",void 0),Y.c.FreeCameraTouchInput=u;class d extends Y.d{constructor(b){super(b),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new mb),this}addMouse(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new T(b),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new O,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new u),this}clear(){super.clear(),this._mouseInput=null}}var G=i(11734),o=i(11676);class M extends U.b{get angularSensibility(){const b=this.inputs.attached.mouse;return b?b.angularSensibility:0}set angularSensibility(b){const n=this.inputs.attached.mouse;n&&(n.angularSensibility=b)}get keysUp(){const b=this.inputs.attached.keyboard;return b?b.keysUp:[]}set keysUp(b){const n=this.inputs.attached.keyboard;n&&(n.keysUp=b)}get keysUpward(){const b=this.inputs.attached.keyboard;return b?b.keysUpward:[]}set keysUpward(b){const n=this.inputs.attached.keyboard;n&&(n.keysUpward=b)}get keysDown(){const b=this.inputs.attached.keyboard;return b?b.keysDown:[]}set keysDown(b){const n=this.inputs.attached.keyboard;n&&(n.keysDown=b)}get keysDownward(){const b=this.inputs.attached.keyboard;return b?b.keysDownward:[]}set keysDownward(b){const n=this.inputs.attached.keyboard;n&&(n.keysDownward=b)}get keysLeft(){const b=this.inputs.attached.keyboard;return b?b.keysLeft:[]}set keysLeft(b){const n=this.inputs.attached.keyboard;n&&(n.keysLeft=b)}get keysRight(){const b=this.inputs.attached.keyboard;return b?b.keysRight:[]}set keysRight(b){const n=this.inputs.attached.keyboard;n&&(n.keysRight=b)}get keysRotateLeft(){const b=this.inputs.attached.keyboard;return b?b.keysRotateLeft:[]}set keysRotateLeft(b){const n=this.inputs.attached.keyboard;n&&(n.keysRotateLeft=b)}get keysRotateRight(){const b=this.inputs.attached.keyboard;return b?b.keysRotateRight:[]}set keysRotateRight(b){const n=this.inputs.attached.keyboard;n&&(n.keysRotateRight=b)}get keysRotateUp(){const b=this.inputs.attached.keyboard;return b?b.keysRotateUp:[]}set keysRotateUp(b){const n=this.inputs.attached.keyboard;n&&(n.keysRotateUp=b)}get keysRotateDown(){const b=this.inputs.attached.keyboard;return b?b.keysRotateDown:[]}set keysRotateDown(b){const n=this.inputs.attached.keyboard;n&&(n.keysRotateDown=b)}constructor(b,n,i){var e;super(b,n,i,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),e=this,this.ellipsoid=new Q.On(.5,1,.5),this.ellipsoidOffset=new Q.On(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Q.On.Zero(),this._diffPosition=Q.On.Zero(),this._newPosition=Q.On.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e._newPosition.L(n),e._newPosition.subtractToRef(e._oldPosition,e._diffPosition),e._diffPosition.length()>o.b.CollisionsEpsilon&&(e.position.addToRef(e._diffPosition,e._deferredPositionUpdate),e._deferOnly?e._deferredUpdated=!0:e.position.L(e._deferredPositionUpdate),e.YT&&i&&e.YT(i))},this.inputs=new d(this),this.inputs.addKeyboard().addMouse()}attachControl(b,n){n=B.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)}aN(){this.inputs.detachElement(),this.cameraDirection=new Q.On(0,0,0),this.cameraRotation=new Q.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(b){this._collisionMask=isNaN(b)?-1:b}_collideWithWorld(b){let n;n=this.parent?Q.On.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,n.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.ab().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let e=b;this.applyGravity&&(e=b.add(this.ab().gravity)),i.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Q.On.Zero(),this._transformedDirection=Q.On.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(b){this._needMoveForGravity=b}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.ab().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Rz"}}(0,e.e)([(0,V.S)()],M.prototype,"ellipsoid",void 0),(0,e.e)([(0,V.S)()],M.prototype,"ellipsoidOffset",void 0),(0,e.e)([(0,V.W)()],M.prototype,"checkCollisions",void 0),(0,e.e)([(0,V.W)()],M.prototype,"applyGravity",void 0),(0,G.i)("BABYLON.FreeCamera",M)},14064:(b,n,i)=>{"use strict";i.d(n,{d:()=>Q});var e=i(11865),V=i(14068);class Q{constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=i,this.Pm=[],this._maxBlockCapacity=n||64,this._selectionContent=new e.d(1024),this._creationFunc=b}update(b,n,i){V.d._CreateBlocks(b,n,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}vB(b){for(let n=0;n<this.Bm.length;n++){this.Bm[n].addEntry(b)}}lB(b){for(let n=0;n<this.Bm.length;n++){this.Bm[n].removeEntry(b)}}select(b,n){this._selectionContent.reset();for(let i=0;i<this.Bm.length;i++){this.Bm[i].select(b,this._selectionContent,n)}return n?this._selectionContent.concat(this.Pm):this._selectionContent.concatWithNoDuplicate(this.Pm),this._selectionContent}intersects(b,n,i){this._selectionContent.reset();for(let e=0;e<this.Bm.length;e++){this.Bm[e].intersects(b,n,this._selectionContent,i)}return i?this._selectionContent.concat(this.Pm):this._selectionContent.concatWithNoDuplicate(this.Pm),this._selectionContent}intersectsRay(b){this._selectionContent.reset();for(let n=0;n<this.Bm.length;n++){this.Bm[n].intersectsRay(b,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Pm),this._selectionContent}}Q.CreationFuncForMeshes=(b,n)=>{const i=b.getBoundingInfo();!b.isBlocked&&i.boundingBox.intersectsMinMax(n.vm,n.pm)&&n.entries.push(b)},Q.CreationFuncForSubMeshes=(b,n)=>{b.getBoundingInfo().boundingBox.intersectsMinMax(n.vm,n.pm)&&n.entries.push(b)}},14068:(b,n,i)=>{"use strict";i.d(n,{d:()=>Q});var e=i(11778),V=i(12115);class Q{constructor(b,n,i,e,V,Q){this.entries=[],this.fm=new Array,this._capacity=i,this._depth=e,this._maxDepth=V,this._creationFunc=Q,this._minPoint=b,this._maxPoint=n,this.fm.push(b.clone()),this.fm.push(n.clone()),this.fm.push(b.clone()),this.fm[2].x=n.x,this.fm.push(b.clone()),this.fm[3].y=n.y,this.fm.push(b.clone()),this.fm[4].z=n.z,this.fm.push(n.clone()),this.fm[5].z=b.z,this.fm.push(n.clone()),this.fm[6].x=b.x,this.fm.push(n.clone()),this.fm[7].y=b.y}get Dn(){return this._capacity}get vm(){return this._minPoint}get pm(){return this._maxPoint}addEntry(b){if(this.Bm)for(let n=0;n<this.Bm.length;n++){this.Bm[n].addEntry(b)}else this._creationFunc(b,this),this.entries.length>this.Dn&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(b){if(this.Bm){for(let n=0;n<this.Bm.length;n++){this.Bm[n].removeEntry(b)}return}const n=this.entries.indexOf(b);n>-1&&this.entries.splice(n,1)}addEntries(b){for(let n=0;n<b.length;n++){const i=b[n];this.addEntry(i)}}select(b,n,i){if(V.d.IsInFrustum(this.fm,b)){if(this.Bm){for(let e=0;e<this.Bm.length;e++){this.Bm[e].select(b,n,i)}return}i?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}}intersects(b,n,i,e){if(V.d.IntersectsSphere(this._minPoint,this._maxPoint,b,n)){if(this.Bm){for(let V=0;V<this.Bm.length;V++){this.Bm[V].intersects(b,n,i,e)}return}e?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}}intersectsRay(b,n){if(b.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Bm){for(let i=0;i<this.Bm.length;i++){this.Bm[i].intersectsRay(b,n)}return}n.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Q._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(b,n,i,V,U,Y,L,B){L.Bm=new Array;const mb=new e.On((n.x-b.x)/2,(n.y-b.y)/2,(n.z-b.z)/2);for(let e=0;e<2;e++)for(let n=0;n<2;n++)for(let N=0;N<2;N++){const Z=b.add(mb.multiplyByFloats(e,n,N)),T=b.add(mb.multiplyByFloats(e+1,n+1,N+1)),z=new Q(Z,T,V,U+1,Y,B);z.addEntries(i),L.Bm.push(z)}}}},14077:(b,n,i)=>{"use strict";i.d(n,{e:()=>mb});var e=i(12005),V=i(11778),Q=i(12190),U=i(13196),Y=i(12039),L=i(14064),B=i(11646);e.b.prototype.createOrUpdateSelectionOctree=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this._getComponent(Y.c.NAME_OCTREE);i||(i=new mb(this),this.o(i)),this.Xm||(this.Xm=new L.d(L.d.CreationFuncForMeshes,b,n));const e=this.getWorldExtends();return this.Xm.update(e.min,e.max,this.meshes),this.Xm},Object.defineProperty(e.b.prototype,"selectionOctree",{get:function(){return this.Xm},enumerable:!0,configurable:!0}),Q.d.prototype.createOrUpdateSubmeshesOctree=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=this.ab();let e=i._getComponent(Y.c.NAME_OCTREE);e||(e=new mb(i),i.o(e)),this._submeshesOctree||(this._submeshesOctree=new L.d(L.d.CreationFuncForSubMeshes,b,n)),this.we(!0);const V=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(V.minimumWorld,V.maximumWorld,this.xe),this._submeshesOctree};class mb{constructor(b){this.name=Y.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new U.c(V.On.Zero(),new V.On(1,1,1)),(b=b||B.d.LastCreatedScene)&&(this.dn=b,this.dn.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.dn.getActiveSubMeshCandidates=b=>this.getActiveSubMeshCandidates(b),this.dn.getCollidingSubMeshCandidates=(b,n)=>this.getCollidingSubMeshCandidates(b,n),this.dn.getIntersectingSubMeshCandidates=(b,n)=>this.getIntersectingSubMeshCandidates(b,n))}register(){this.dn.onMeshRemovedObservable.add((b=>{const n=this.dn.selectionOctree;if(void 0!==n&&null!==n){const i=n.Pm.indexOf(b);-1!==i&&n.Pm.splice(i,1)}})),this.dn.onMeshImportedObservable.add((b=>{const n=this.dn.selectionOctree;void 0!==n&&null!==n&&n.vB(b)}))}getActiveMeshCandidates(){var b;return(null===(b=this.dn.Xm)||void 0===b?void 0:b.select(this.dn.frustumPlanes))||this.dn._getDefaultMeshCandidates()}getActiveSubMeshCandidates(b){if(b._submeshesOctree&&b.useOctreeForRenderingSelection){return b._submeshesOctree.select(this.dn.frustumPlanes)}return this.dn._getDefaultSubMeshCandidates(b)}getIntersectingSubMeshCandidates(b,n){if(b._submeshesOctree&&b.useOctreeForPicking){U.c.TransformToRef(n,b.getWorldMatrix(),this._tempRay);return b._submeshesOctree.intersectsRay(this._tempRay)}return this.dn._getDefaultSubMeshCandidates(b)}getCollidingSubMeshCandidates(b,n){if(b._submeshesOctree&&b.useOctreeForCollisions){const i=n._velocityWorldLength+Math.max(n._radius.x,n._radius.y,n._radius.z);return b._submeshesOctree.intersects(n._basePointWorld,i)}return this.dn._getDefaultSubMeshCandidates(b)}rebuild(){}dispose(){}}},13196:(b,n,i)=>{"use strict";i.d(n,{c:()=>T});var e=i(12005),V=i(12222),Q=i(11786),U=i(11778),Y=i(11788),L=i(12108),B=i(12030),mb=i(11646),N=i(12067);const Z={internalPickerForMesh:void 0};class T{constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.c;this.origin=b,this.direction=n,this.length=i,this.epsilon=e}clone(){return new T(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const e=T._TmpVector3[0].re(b.x-i,b.y-i,b.z-i),V=T._TmpVector3[1].re(n.x+i,n.y+i,n.z+i);let Q,U,Y,L,B=0,mb=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>V.x)return!1}else if(Q=1/this.direction.x,U=(e.x-this.origin.x)*Q,Y=(V.x-this.origin.x)*Q,Y===-1/0&&(Y=1/0),U>Y&&(L=U,U=Y,Y=L),B=Math.max(U,B),mb=Math.min(Y,mb),B>mb)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>V.y)return!1}else if(Q=1/this.direction.y,U=(e.y-this.origin.y)*Q,Y=(V.y-this.origin.y)*Q,Y===-1/0&&(Y=1/0),U>Y&&(L=U,U=Y,Y=L),B=Math.max(U,B),mb=Math.min(Y,mb),B>mb)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>V.z)return!1}else if(Q=1/this.direction.z,U=(e.z-this.origin.z)*Q,Y=(V.z-this.origin.z)*Q,Y===-1/0&&(Y=1/0),U>Y&&(L=U,U=Y,Y=L),B=Math.max(U,B),mb=Math.min(Y,mb),B>mb)return!1;return!0}intersectsBox(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(b.minimum,b.maximum,n)}intersectsSphere(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=b.center.x-this.origin.x,e=b.center.y-this.origin.y,V=b.center.z-this.origin.z,Q=i*i+e*e+V*V,U=b.radius+n,Y=U*U;if(Q<=Y)return!0;const L=i*this.direction.x+e*this.direction.y+V*this.direction.z;if(L<0)return!1;return Q-L*L<=Y}intersectsTriangle(b,n,i){const e=T._TmpVector3[0],V=T._TmpVector3[1],Q=T._TmpVector3[2],Y=T._TmpVector3[3],B=T._TmpVector3[4];n.subtractToRef(b,e),i.subtractToRef(b,V),U.On.CrossToRef(this.direction,V,Q);const mb=U.On.Dot(e,Q);if(0===mb)return null;const N=1/mb;this.origin.subtractToRef(b,Y);const Z=U.On.Dot(Y,Q)*N;if(Z<-this.epsilon||Z>1+this.epsilon)return null;U.On.CrossToRef(Y,e,B);const z=U.On.Dot(this.direction,B)*N;if(z<-this.epsilon||Z+z>1+this.epsilon)return null;const K=U.On.Dot(V,B)*N;return K>this.length?null:new L.c(1-Z-z,Z,K)}intersectsPlane(b){let n;const i=U.On.Dot(b.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const e=U.On.Dot(b.normal,this.origin);return n=(-b.d-e)/i,n<0?n<-9.99999997475243e-7?null:0:n}}intersectsAxis(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(b){case"y":{const b=(this.origin.y-n)/this.direction.y;return b>0?null:new U.On(this.origin.x+this.direction.x*-b,n,this.origin.z+this.direction.z*-b)}case"x":{const b=(this.origin.x-n)/this.direction.x;return b>0?null:new U.On(n,this.origin.y+this.direction.y*-b,this.origin.z+this.direction.z*-b)}case"z":{const b=(this.origin.z-n)/this.direction.z;return b>0?null:new U.On(this.origin.x+this.direction.x*-b,this.origin.y+this.direction.y*-b,n)}default:return null}}intersectsMesh(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=U.TmpVectors.Matrix[0];return b.getWorldMatrix().invertToRef(Y),this._tmpRay?T.TransformToRef(this,Y,this._tmpRay):this._tmpRay=T.Transform(this,Y),b.intersects(this._tmpRay,n,i,e,V,Q)}intersectsMeshes(b,n,i){i?i.length=0:i=[];for(let e=0;e<b.length;e++){const V=this.intersectsMesh(b[e],n);V.hit&&i.push(V)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(b,n){return b.distance<n.distance?-1:b.distance>n.distance?1:0}intersectionSegment(b,n,i){const e=this.origin,V=U.TmpVectors.On[0],Q=U.TmpVectors.On[1],Y=U.TmpVectors.On[2],L=U.TmpVectors.On[3];n.subtractToRef(b,V),this.direction.scaleToRef(T._Rayl,Y),e.addToRef(Y,Q),b.subtractToRef(e,L);const B=U.On.Dot(V,V),mb=U.On.Dot(V,Y),N=U.On.Dot(Y,Y),Z=U.On.Dot(V,L),z=U.On.Dot(Y,L),K=B*N-mb*mb;let I,O,u=K,d=K;K<T._Smallnum?(I=0,u=1,O=z,d=N):(I=mb*z-N*Z,O=B*z-mb*Z,I<0?(I=0,O=z,d=N):I>u&&(I=u,O=z+mb,d=N)),O<0?(O=0,-Z<0?I=0:-Z>B?I=u:(I=-Z,u=B)):O>d&&(O=d,-Z+mb<0?I=0:-Z+mb>B?I=u:(I=-Z+mb,u=B));const G=Math.abs(I)<T._Smallnum?0:I/u,o=Math.abs(O)<T._Smallnum?0:O/d,M=U.TmpVectors.On[4];Y.scaleToRef(o,M);const j=U.TmpVectors.On[5];V.scaleToRef(G,j),j.addInPlace(L);const a=U.TmpVectors.On[6];j.subtractToRef(M,a);return o>0&&o<=this.length&&a.lengthSquared()<i*i?j.length():-1}update(b,n,i,e,V,Q,Y){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){T._RayDistant||(T._RayDistant=T.Zero()),T._RayDistant.unprojectRayToRef(b,n,i,e,U.Matrix.IdentityReadOnly,Q,Y);const L=U.TmpVectors.Matrix[0];V.invertToRef(L),T.TransformToRef(T._RayDistant,L,this)}else this.unprojectRayToRef(b,n,i,e,V,Q,Y);return this}static Zero(){return new T(U.On.Zero(),U.On.Zero())}static CreateNew(b,n,i,e,V,Q,U){return T.Zero().update(b,n,i,e,V,Q,U)}static CreateNewFromTo(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.Matrix.IdentityReadOnly;const e=new T(new U.On(0,0,0),new U.On(0,0,0));return T.CreateFromToToRef(b,n,e,i)}static CreateFromToToRef(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U.Matrix.IdentityReadOnly;i.origin.L(b);const V=n.subtractToRef(b,i.direction),Q=Math.sqrt(V.x*V.x+V.y*V.y+V.z*V.z);return i.length=Q,i.direction.normalize(),T.TransformToRef(i,e,i)}static Transform(b,n){const i=new T(new U.On(0,0,0),new U.On(0,0,0));return T.TransformToRef(b,n,i),i}static TransformToRef(b,n,i){U.On.TransformCoordinatesToRef(b.origin,n,i.origin),U.On.TransformNormalToRef(b.direction,n,i.direction),i.length=b.length,i.epsilon=b.epsilon;const e=i.direction,V=e.length();if(0!==V&&1!==V){const b=1/V;e.x*=b,e.y*=b,e.z*=b,i.length*=V}return i}unprojectRayToRef(b,n,i,e,V,Q,Y){const L=U.TmpVectors.Matrix[0];V.multiplyToRef(Q,L),L.multiplyToRef(Y,L),L.invert();const B=mb.d.LastCreatedEngine,N=U.TmpVectors.On[0];N.x=b/i*2-1,N.y=-(n/e*2-1),N.z=null!==B&&void 0!==B&&B.useReverseDepthBuffer?1:null!==B&&void 0!==B&&B.isNDCHalfZRange?0:-1;const Z=U.TmpVectors.On[1].re(N.x,N.y,1-1e-8),T=U.TmpVectors.On[2],z=U.TmpVectors.On[3];U.On._UnprojectFromInvertedMatrixToRef(N,L,T),U.On._UnprojectFromInvertedMatrixToRef(Z,L,z),this.origin.L(T),z.subtractToRef(T,this.direction),this.direction.normalize()}}function z(b,n,i,e,V){let Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=T.Zero();return K(b,n,i,e,U,V,Q),U}function K(b,n,i,e,V,Q){let Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const B=b.getEngine();if(!Q&&!(Q=b.activeCamera))return b;const mb=Q.viewport,N=B.getRenderHeight(),{x:Z,y:T,width:z,height:K}=mb.toGlobal(B.getRenderWidth(),N),I=1/B.getHardwareScalingLevel();return n=n*I-Z,i=i*I-(N-T-K),V.update(n,i,z,K,e||U.Matrix.IdentityReadOnly,Y?U.Matrix.IdentityReadOnly:Q.getViewMatrix(),Q.getProjectionMatrix(),L),b}function I(b,n,i,e,V){if(!B.b)return b;const Q=b.getEngine();if(!V&&!(V=b.activeCamera))throw new Error("Active camera not set");const Y=V.viewport,L=Q.getRenderHeight(),{x:mb,y:N,width:Z,height:T}=Y.toGlobal(Q.getRenderWidth(),L),z=U.Matrix.Identity(),K=1/Q.getHardwareScalingLevel();return n=n*K-mb,i=i*K-(L-N-T),e.update(n,i,Z,T,z,z,V.getProjectionMatrix()),b}function O(b,n,i,e,V,Q,U,Y){const L=n(e,i.enableDistantPicking),B=i.intersects(L,V,U,Q,e,Y);return B&&B.hit?!V&&null!=b&&B.distance>=b.distance?null:B:null}function u(b,n,i,e,V,Q){let Y=null;const L=!!(b.activeCameras&&b.activeCameras.length>1&&b.cameraToUseForPointers!==b.activeCamera),mb=b.cameraToUseForPointers||b.activeCamera,N=Z.internalPickerForMesh||O;for(let B=0;B<b.meshes.length;B++){const Z=b.meshes[B];if(i){if(!i(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.CL)continue;const T=L&&Z.isWorldMatrixCameraDependent(),z=Z.we(T,mb);if(Z.hasThinInstances&&Z.ZB){const b=N(Y,n,Z,z,!0,!0,Q);if(b){if(V)return b;const L=U.TmpVectors.Matrix[1],B=Z.thinInstanceGetWorldMatrices();for(let b=0;b<B.length;b++){if(i&&!i(Z,b))continue;B[b].multiplyToRef(z,L);const U=N(Y,n,Z,L,e,V,Q,!0);if(U&&(Y=U,Y.thinInstanceIndex=b,e))return Y}}}else{const b=N(Y,n,Z,z,e,V,Q);if(b&&(Y=b,e))return Y}}return Y||new B.b}function d(b,n,i,e){if(!B.b)return null;const V=[],Q=!!(b.activeCameras&&b.activeCameras.length>1&&b.cameraToUseForPointers!==b.activeCamera),Y=b.cameraToUseForPointers||b.activeCamera,L=Z.internalPickerForMesh||O;for(let B=0;B<b.meshes.length;B++){const mb=b.meshes[B];if(i){if(!i(mb,-1))continue}else if(!mb.isEnabled()||!mb.isVisible||!mb.CL)continue;const N=Q&&mb.isWorldMatrixCameraDependent(),Z=mb.we(N,Y);if(mb.hasThinInstances&&mb.ZB){if(L(null,n,mb,Z,!0,!0,e)){const b=U.TmpVectors.Matrix[1],Q=mb.thinInstanceGetWorldMatrices();for(let U=0;U<Q.length;U++){if(i&&!i(mb,U))continue;Q[U].multiplyToRef(Z,b);const Y=L(null,n,mb,b,!1,!1,e,!0);Y&&(Y.thinInstanceIndex=U,V.push(Y))}}}else{const b=L(null,n,mb,Z,!1,!1,e);b&&V.push(b)}}return V}function G(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,e=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;e||(e=b.getWorldMatrix()),n.length=i,V?n.origin.L(V):n.origin.L(b.position);const Q=U.TmpVectors.On[2];Q.set(0,0,b._scene.useRightHandedSystem?-1:1);const Y=U.TmpVectors.On[3];return U.On.TransformNormalToRef(Q,e,Y),U.On.NormalizeToRef(Y,n.direction),n}var o,M;T._TmpVector3=(0,Y.d)(6,U.On.Zero),T._RayDistant=T.Zero(),T._Smallnum=1e-8,T._Rayl=1e9,o=e.b,(M=V.c)&&(M.prototype.getForwardRay=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return G(this,new T(U.On.Zero(),U.On.Zero(),b),b,n,i)},M.prototype.getForwardRayToRef=function(b){return G(this,b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),o&&(N.b._IsPickingAvailable=!0,o.prototype.createPickingRay=function(b,n,i,e){return z(this,b,n,i,e,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),e.b.prototype.createPickingRayToRef=function(b,n,i,e,V){return K(this,b,n,i,e,V,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},e.b.prototype.createPickingRayInCameraSpace=function(b,n,i){return function(b,n,i,e){const V=T.Zero();return I(b,n,i,V,e),V}(this,b,n,i)},e.b.prototype.createPickingRayInCameraSpaceToRef=function(b,n,i,e){return I(this,b,n,i,e)},e.b.prototype.pickWithBoundingInfo=function(b,n,i,e,V){return function(b,n,i,e,V,Q){if(!B.b)return null;const Y=u(b,(e=>(b._tempPickingRay||(b._tempPickingRay=T.Zero()),K(b,n,i,e,b._tempPickingRay,Q||null),b._tempPickingRay)),e,V,!0);return Y&&(Y.ray=z(b,n,i,U.Matrix.Identity(),Q||null)),Y}(this,b,n,i,e,V)},e.b.prototype.di=function(b,n,i,e,V,Q){return function(b,n,i,e,V,Q,Y){const L=u(b,((e,V)=>(b._tempPickingRay||(b._tempPickingRay=T.Zero()),K(b,n,i,e,b._tempPickingRay,Q||null,!1,V),b._tempPickingRay)),e,V,!1,Y);return L&&(L.ray=z(b,n,i,U.Matrix.Identity(),Q||null)),L}(this,b,n,i,e,V,Q)},e.b.prototype.pickWithRay=function(b,n,i,e){return function(b,n,i,e,V){const Q=u(b,(i=>(b._pickWithRayInverseMatrix||(b._pickWithRayInverseMatrix=U.Matrix.Identity()),i.invertToRef(b._pickWithRayInverseMatrix),b._cachedRayForTransform||(b._cachedRayForTransform=T.Zero()),T.TransformToRef(n,b._pickWithRayInverseMatrix,b._cachedRayForTransform),b._cachedRayForTransform)),i,e,!1,V);return Q&&(Q.ray=n),Q}(this,b,n,i,e)},e.b.prototype.multiPick=function(b,n,i,e,V){return function(b,n,i,e,V,Q){return d(b,(e=>z(b,n,i,e,V||null)),e,Q)}(this,b,n,i,e,V)},e.b.prototype.multiPickWithRay=function(b,n,i){return function(b,n,i,e){return d(b,(i=>(b._pickWithRayInverseMatrix||(b._pickWithRayInverseMatrix=U.Matrix.Identity()),i.invertToRef(b._pickWithRayInverseMatrix),b._cachedRayForTransform||(b._cachedRayForTransform=T.Zero()),T.TransformToRef(n,b._pickWithRayInverseMatrix,b._cachedRayForTransform),b._cachedRayForTransform)),i,e)}(this,b,n,i)}},13483:(b,n,i)=>{"use strict";var e=i(11706),V=i(11621),Q=i(11655),U=i(11737),Y=i(11676),L=i(11721);Y.b.prototype._partialLoadFile=function(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(b,(b=>{i[n]=b,i._internalCount++,6===i._internalCount&&e(i)}),void 0,void 0,!0,((b,n)=>{V&&b&&V(b.status+" "+b.statusText,n)}))},Y.b.prototype._cascadeLoadFiles=function(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const V=[];V._internalCount=0;for(let Q=0;Q<6;Q++)this._partialLoadFile(i[Q],Q,V,n,e)},Y.b.prototype._cascadeLoadImgs=function(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5?arguments[5]:void 0;const U=[];U._internalCount=0;for(let Y=0;Y<6;Y++)this._partialLoadImg(e[Y],Y,U,b,n,i,V,Q)},Y.b.prototype._partialLoadImg=function(b,n,i,e,V,Y){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7?arguments[7]:void 0;const mb=(0,U.d)();(0,Q.p)(b,(b=>{i[n]=b,i._internalCount++,e&&e.removePendingData(mb),6===i._internalCount&&Y&&Y(V,i)}),((b,n)=>{e&&e.removePendingData(mb),L&&L(b,n)}),e?e.offlineProvider:null,B),e&&e.addPendingData(mb)},Y.b.prototype.createCubeTextureBase=function(b,n,i,Q){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6?arguments[6]:void 0,mb=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,T=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,O=arguments.length>14&&void 0!==arguments[14]&&arguments[14],u=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const d=z||new e.e(this,7);d.isCube=!0,d.url=b,d.generateMipMaps=!Q,d._lodGenerationScale=Z,d._lodGenerationOffset=T,d._useSRGBBuffer=!!O&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Q),d!==z&&(d.label=b.substring(0,60)),this._doNotHandleContextLost||(d._extension=mb,d._files=i,d._buffer=u);const G=b;this._transformTextureUrl&&!z&&(b=this._transformTextureUrl(b));const o=mb??function(b){const n=b.split("?")[0],i=n.lastIndexOf(".");return i>-1?n.substring(i).toLowerCase():""}(b),M=(0,L.d)(o),j=(b,n)=>{d.dispose(),Y?Y(b,n):b&&V.b.Warn(b)},a=(e,Y)=>{b===G?e&&j(e.status+" "+e.statusText,Y):(V.b.Warn(`Failed to load ${b}, falling back to the ${G}`),this.createCubeTextureBase(G,n,i,!!Q,U,j,B,mb,N,Z,T,d,K,I,O,u))};if(M)M.then((e=>{const V=b=>{K&&K(d,b),e.loadCubeData(b,d,N,U,((b,n)=>{j(b,n)}))};u?V(u):i&&6===i.length?e.supportCascades?this._cascadeLoadFiles(n,(b=>V(b.map((b=>new Uint8Array(b))))),i,j):j("Textures type does not support cascades."):this._loadFile(b,(b=>V(new Uint8Array(b))),void 0,void 0,!0,a)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(n,d,((b,n)=>{I&&I(b,n)}),i,j)}return this._internalTexturesCache.push(d),d}},14080:(b,n,i)=>{"use strict";i(11621);var e=i(11894);i(11706),i(11847),i(11701),i(11946),i(11904);e.c},13513:(b,n,i)=>{"use strict";i.d(n,{b:()=>V});var e=i(11734);class V{constructor(b){this.value=this._toInt(b)}_toInt(b){return 0|b}add(b){return new V(this.value+b.value)}un(b){return new V(this.value-b.value)}multiply(b){return new V(Math.imul(this.value,b.value))}divide(b){return new V(this.value/b.value)}getClassName(){return V.ClassName}equals(b){return this.value===b.value}static FromValue(b){return new V(b)}toString(){return this.value.toString()}}V.ClassName="FlowGraphInteger",(0,e.i)("FlowGraphInteger",V)},13527:(b,n,i)=>{"use strict";i.d(n,{c:()=>V,d:()=>Q});var e=i(11778);class V{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ue=b}get m(){return this.Ue}transformVector(b){return this.transformVectorToRef(b,new e.Vector2)}transformVectorToRef(b,n){return n.x=b.x*this.Ue[0]+b.y*this.Ue[1],n.y=b.x*this.Ue[2]+b.y*this.Ue[3],n}ye(){return this.toArray()}toArray(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let n=0;n<4;n++)b[n]=this.Ue[n];return b}Gi(b){for(let n=0;n<4;n++)this.Ue[n]=b[n];return this}multiplyToRef(b,n){const i=b.Ue,e=this.Ue,V=n.Ue;return V[0]=i[0]*e[0]+i[1]*e[2],V[1]=i[0]*e[1]+i[1]*e[3],V[2]=i[2]*e[0]+i[3]*e[2],V[3]=i[2]*e[1]+i[3]*e[3],n}multiply(b){return this.multiplyToRef(b,new V)}divideToRef(b,n){const i=this.Ue,e=b.Ue,V=n.Ue;return V[0]=i[0]/e[0],V[1]=i[1]/e[1],V[2]=i[2]/e[2],V[3]=i[3]/e[3],n}divide(b){return this.divideToRef(b,new V)}addToRef(b,n){const i=this.Ue,e=b.m,V=n.m;return V[0]=i[0]+e[0],V[1]=i[1]+e[1],V[2]=i[2]+e[2],V[3]=i[3]+e[3],n}add(b){return this.addToRef(b,new V)}subtractToRef(b,n){const i=this.Ue,e=b.m,V=n.m;return V[0]=i[0]-e[0],V[1]=i[1]-e[1],V[2]=i[2]-e[2],V[3]=i[3]-e[3],n}un(b){return this.subtractToRef(b,new V)}transpose(){const b=this.Ue;return new V([b[0],b[2],b[1],b[3]])}determinant(){const b=this.Ue;return b[0]*b[3]-b[1]*b[2]}inverse(){const b=this.determinant();if(0===b)throw new Error("Matrix is not invertible");const n=this.Ue,i=1/b;return new V([n[3]*i,-n[1]*i,-n[2]*i,n[0]*i])}equals(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.Ue,e=b.m;return 0===n?i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]:Math.abs(i[0]-e[0])<n&&Math.abs(i[1]-e[1])<n&&Math.abs(i[2]-e[2])<n&&Math.abs(i[3]-e[3])<n}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ue.join(", ")})`}}class Q{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ue=b}get m(){return this.Ue}transformVector(b){return this.transformVectorToRef(b,new e.On)}transformVectorToRef(b,n){const i=this.Ue;return n.x=b.x*i[0]+b.y*i[1]+b.z*i[2],n.y=b.x*i[3]+b.y*i[4]+b.z*i[5],n.z=b.x*i[6]+b.y*i[7]+b.z*i[8],n}multiplyToRef(b,n){const i=b.Ue,e=this.Ue,V=n.m;return V[0]=i[0]*e[0]+i[1]*e[3]+i[2]*e[6],V[1]=i[0]*e[1]+i[1]*e[4]+i[2]*e[7],V[2]=i[0]*e[2]+i[1]*e[5]+i[2]*e[8],V[3]=i[3]*e[0]+i[4]*e[3]+i[5]*e[6],V[4]=i[3]*e[1]+i[4]*e[4]+i[5]*e[7],V[5]=i[3]*e[2]+i[4]*e[5]+i[5]*e[8],V[6]=i[6]*e[0]+i[7]*e[3]+i[8]*e[6],V[7]=i[6]*e[1]+i[7]*e[4]+i[8]*e[7],V[8]=i[6]*e[2]+i[7]*e[5]+i[8]*e[8],n}multiply(b){return this.multiplyToRef(b,new Q)}divideToRef(b,n){const i=this.Ue,e=b.m,V=n.m;return V[0]=i[0]/e[0],V[1]=i[1]/e[1],V[2]=i[2]/e[2],V[3]=i[3]/e[3],V[4]=i[4]/e[4],V[5]=i[5]/e[5],V[6]=i[6]/e[6],V[7]=i[7]/e[7],V[8]=i[8]/e[8],n}divide(b){return this.divideToRef(b,new Q)}addToRef(b,n){const i=this.Ue,e=b.m,V=n.m;return V[0]=i[0]+e[0],V[1]=i[1]+e[1],V[2]=i[2]+e[2],V[3]=i[3]+e[3],V[4]=i[4]+e[4],V[5]=i[5]+e[5],V[6]=i[6]+e[6],V[7]=i[7]+e[7],V[8]=i[8]+e[8],n}add(b){return this.addToRef(b,new Q)}subtractToRef(b,n){const i=this.Ue,e=b.m,V=n.m;return V[0]=i[0]-e[0],V[1]=i[1]-e[1],V[2]=i[2]-e[2],V[3]=i[3]-e[3],V[4]=i[4]-e[4],V[5]=i[5]-e[5],V[6]=i[6]-e[6],V[7]=i[7]-e[7],V[8]=i[8]-e[8],n}un(b){return this.subtractToRef(b,new Q)}toArray(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let n=0;n<9;n++)b[n]=this.Ue[n];return b}ye(){return this.toArray()}Gi(b){for(let n=0;n<9;n++)this.Ue[n]=b[n];return this}transpose(){const b=this.Ue;return new Q([b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]])}determinant(){const b=this.Ue;return b[0]*(b[4]*b[8]-b[5]*b[7])-b[1]*(b[3]*b[8]-b[5]*b[6])+b[2]*(b[3]*b[7]-b[4]*b[6])}inverse(){const b=this.determinant();if(0===b)throw new Error("Matrix is not invertible");const n=this.Ue,i=1/b;return new Q([(n[4]*n[8]-n[5]*n[7])*i,(n[2]*n[7]-n[1]*n[8])*i,(n[1]*n[5]-n[2]*n[4])*i,(n[5]*n[6]-n[3]*n[8])*i,(n[0]*n[8]-n[2]*n[6])*i,(n[2]*n[3]-n[0]*n[5])*i,(n[3]*n[7]-n[4]*n[6])*i,(n[1]*n[6]-n[0]*n[7])*i,(n[0]*n[4]-n[1]*n[3])*i])}equals(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.Ue,e=b.m;return 0===n?i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]:Math.abs(i[0]-e[0])<n&&Math.abs(i[1]-e[1])<n&&Math.abs(i[2]-e[2])<n&&Math.abs(i[3]-e[3])<n&&Math.abs(i[4]-e[4])<n&&Math.abs(i[5]-e[5])<n&&Math.abs(i[6]-e[6])<n&&Math.abs(i[7]-e[7])<n&&Math.abs(i[8]-e[8])<n}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ue.join(", ")})`}}},13535:(b,n,i)=>{"use strict";var e;function V(b,n,i,e){switch(n){case"Animation":return e?b.animations.find((b=>b.uniqueId===i))??null:b.animations[i]??null;case"AnimationGroup":return e?b.animationGroups.find((b=>b.uniqueId===i))??null:b.animationGroups[i]??null;case"Mesh":return e?b.meshes.find((b=>b.uniqueId===i))??null:b.meshes[i]??null;case"Material":return e?b.materials.find((b=>b.uniqueId===i))??null:b.materials[i]??null;case"Qm":return e?b.cameras.find((b=>b.uniqueId===i))??null:b.cameras[i]??null;case"Light":return e?b.lights.find((b=>b.uniqueId===i))??null:b.lights[i]??null;default:return null}}i.d(n,{d:()=>V}),function(b){b.Animation="Animation",b.AnimationGroup="AnimationGroup",b.Mesh="Mesh",b.Material="Material",b.Qm="Qm",b.Light="Light"}(e||(e={}))},13574:(b,n,i)=>{"use strict";i.d(n,{c:()=>V});var e=i(13582);class V extends e.d{constructor(b,n){if(super(b),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),n)for(const i of n)this._eventsSignalOutputs[i]=this._registerSignalOutput(i+"Event")}_executeOnTick(b){}_startPendingTasks(b){b._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(b),this._resetAfterCanceled(b)),this._preparePendingTasks(b),b._addPendingBlock(this),this.out._activateSignal(b),b._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(b){b._deleteExecutionVariable(this,"_initialized"),b._removePendingBlock(this)}}},13547:(b,n,i)=>{"use strict";i.d(n,{c:()=>B});var e=i(11737),V=i(11734),Q=i(13551),U=i(11612),Y=i(13504);class L extends Q.c{constructor(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.defaultValue,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(b,n,i),this.richType=e,this._defaultValue=V,this._optional=Q,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new U.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(b){this._isDisabled!==b&&(this._isDisabled=b,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(b,n){n._getConnectionValue(this)!==b&&(n._setConnectionValue(this,b),this.onValueChangedObservable.notifyObservers(b))}resetToDefaultValue(b){b._setConnectionValue(this,this._defaultValue)}connectTo(b){this._isDisabled||super.connectTo(b)}_getValueOrDefault(b){const n=b._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(n):n}getValue(b){if(1===this.connectionType){b._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(b);const n=this._getValueOrDefault(b);return this._lastValue=n,this.richType.typeTransformer?this.richType.typeTransformer(n):n}const n=this.isConnected()?this._connectedPoint[0].getValue(b):this._getValueOrDefault(b);return this._lastValue=n,this.richType.typeTransformer?this.richType.typeTransformer(n):n}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(b),b.richType={},this.richType.serialize(b.richType),b.optional=this._optional,(0,Y.e)("defaultValue",this._defaultValue,b)}}(0,V.i)("FlowGraphDataConnection",L);class B{constructor(b){var n;this.config=b,this.uniqueId=(0,e.d)(),this.name=(null===(n=this.config)||void 0===n?void 0:n.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(b){}registerDataInput(b,n,i){const e=new L(b,0,this,n,i);return this.dataInputs.push(e),e}registerDataOutput(b,n,i){const e=new L(b,1,this,n,i);return this.dataOutputs.push(e),e}getDataInput(b){return this.dataInputs.find((n=>n.name===b))}getDataOutput(b){return this.dataOutputs.find((n=>n.name===b))}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y.e;if(b.uniqueId=this.uniqueId,b.config={},this.config){const i=this.config,e=Object.keys(i);for(const V of e)n(V,i[V],b.config)}b.dataInputs=[],b.dataOutputs=[],b.className=this.getClassName();for(const i of this.dataInputs){const n={};i.serialize(n),b.dataInputs.push(n)}for(const i of this.dataOutputs){const n={};i.serialize(n),b.dataOutputs.push(n)}}deserialize(b){}_log(b,n,i){var e;null===(e=b.logger)||void 0===e||e.addLogItem({action:n,oi:i,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13551:(b,n,i)=>{"use strict";i.d(n,{c:()=>Q});var e,V=i(11737);!function(b){b[b.Input=0]="Input",b[b.Output=1]="Output"}(e||(e={}));class Q{constructor(b,n,i){this._ownerBlock=i,this._connectedPoint=[],this.uniqueId=(0,V.d)(),this.connectedPointIds=[],this.name=b,this._connectionType=n}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(b){if(this._connectionType===b._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||b._isSingularConnection()&&b._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(b),b._connectedPoint.push(this)}disconnectFrom(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this._connectedPoint.indexOf(b),e=b._connectedPoint.indexOf(this);-1!==i&&-1!==e&&(n&&this._connectedPoint.splice(i,1),b._connectedPoint.splice(e,1))}disconnectFromAll(){for(const b of this._connectedPoint)this.disconnectFrom(b,!1);this._connectedPoint.length=0}dispose(){for(const b of this._connectedPoint)this.disconnectFrom(b)}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b.uniqueId=this.uniqueId,b.name=this.name,b._connectionType=this._connectionType,b.connectedPointIds=[],b.className=this.getClassName();for(const n of this._connectedPoint)b.connectedPointIds.push(n.uniqueId)}getClassName(){return"FGConnection"}deserialize(b){this.uniqueId=b.uniqueId,this.name=b.name,this._connectionType=b._connectionType,this.connectedPointIds=b.connectedPointIds}}},13502:(b,n,i)=>{"use strict";i.d(n,{d:()=>d});var e,V=i(11612),Q=i(11756),U=i(11762),Y=i(11737),L=i(13504),B=i(13535),mb=i(11621);!function(b){b.ExecuteBlock="ExecuteBlock",b.ExecuteEvent="ExecuteEvent",b.TriggerConnection="TriggerConnection",b.ContextVariableSet="ContextVariableSet",b.GlobalVariableSet="GlobalVariableSet",b.GlobalVariableDelete="GlobalVariableDelete",b.GlobalVariableGet="GlobalVariableGet",b.AddConnection="AddConnection",b.GetConnectionValue="GetConnectionValue",b.SetConnectionValue="SetConnectionValue",b.ActivateSignal="ActivateSignal",b.ContextVariableGet="ContextVariableGet"}(e||(e={}));class N{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(b){if(b.time||(b.time=Date.now()),this.log.push(b),this.logToConsole){var n;const i=null===(n=b.oi)||void 0===n?void 0:n.value;"object"===typeof i&&i.getClassName?mb.b.Log(`[FGLog] ${b.className}:${b.uniqueId.split("-")[0]} ${b.action} - ${JSON.stringify(i.getClassName())}: ${i.toString()}`):mb.b.Log(`[FGLog] ${b.className}:${b.uniqueId.split("-")[0]} ${b.action} - ${JSON.stringify(b.oi)}`)}}getItemsOfType(b){return this.log.filter((n=>n.action===b))}}class Z{get enableLogging(){return this._enableLogging}set enableLogging(b){this._enableLogging!==b&&(this._enableLogging=b,this._enableLogging?(this.logger=new N,this.logger.logToConsole=!0):this.logger=null)}constructor(b){this.uniqueId=(0,Y.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new V.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=b,this.assetsContext=b.assetsContext??b.dn}hasVariable(b){return b in this._userVariables}setVariable(b,n){var i;this._userVariables[b]=n,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",oi:{name:b,value:n}})}getAsset(b,n){return(0,B.d)(this.assetsContext,b,n)}getVariable(b){var n;return null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",oi:{name:b,value:this._userVariables[b]}}),this._userVariables[b]}get userVariables(){return this._userVariables}ab(){return this._configuration.dn}_getUniqueIdPrefixedName(b,n){return`${b.uniqueId}_${n}`}_getGlobalContextVariable(b,n){var i;return null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",oi:{name:b,defaultValue:n,possibleValue:this._globalContextVariables[b]}}),this._hasGlobalContextVariable(b)?this._globalContextVariables[b]:n}_setGlobalContextVariable(b,n){var i;null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",oi:{name:b,value:n}}),this._globalContextVariables[b]=n}_deleteGlobalContextVariable(b){var n;null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",oi:{name:b}}),delete this._globalContextVariables[b]}_hasGlobalContextVariable(b){return b in this._globalContextVariables}_setExecutionVariable(b,n,i){this._executionVariables[this._getUniqueIdPrefixedName(b,n)]=i}_getExecutionVariable(b,n,i){return this._hasExecutionVariable(b,n)?this._executionVariables[this._getUniqueIdPrefixedName(b,n)]:i}_deleteExecutionVariable(b,n){delete this._executionVariables[this._getUniqueIdPrefixedName(b,n)]}_hasExecutionVariable(b,n){return this._getUniqueIdPrefixedName(b,n)in this._executionVariables}_hasConnectionValue(b){return b.uniqueId in this._connectionValues}_setConnectionValue(b,n){var i;this._connectionValues[b.uniqueId]=n,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",oi:{connectionPointId:b.uniqueId,value:n}})}_setConnectionValueByKey(b,n){this._connectionValues[b]=n}_getConnectionValue(b){var n;return null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",oi:{connectionPointId:b.uniqueId,value:this._connectionValues[b.uniqueId]}}),this._connectionValues[b.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(b){this._pendingBlocks.includes(b)||(this._pendingBlocks.push(b),this._pendingBlocks.sort(((b,n)=>b.priority-n.priority)))}_removePendingBlock(b){const n=this._pendingBlocks.indexOf(b);-1!==n&&this._pendingBlocks.splice(n,1)}_clearPendingBlocks(){for(const b of this._pendingBlocks)b._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(b){var n;this.onNodeExecutedObservable.notifyObservers(b),null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:b.getClassName(),uniqueId:b.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(b){this._setGlobalContextVariable("timeSinceStart",b.timeSinceStart),this._setGlobalContextVariable("deltaTime",b.deltaTime);for(const i of this._pendingBlocks){var n;null===(n=i._executeOnTick)||void 0===n||n.call(i,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.e;b.uniqueId=this.uniqueId,b._userVariables={};for(const e in this._userVariables)n(e,this._userVariables[e],b._userVariables);b._connectionValues={};for(const e in this._connectionValues)n(e,this._connectionValues[e],b._connectionValues);var i;this.assetsContext!==this.ab()&&(b._assetsContext={meshes:this.assetsContext.meshes.map((b=>b.id)),materials:this.assetsContext.materials.map((b=>b.id)),textures:this.assetsContext.textures.map((b=>b.name)),animations:this.assetsContext.animations.map((b=>b.name)),lights:this.assetsContext.lights.map((b=>b.id)),cameras:this.assetsContext.cameras.map((b=>b.id)),DZ:null===(i=this.assetsContext.DZ)||void 0===i?void 0:i.map((b=>b.name)),skeletons:this.assetsContext.skeletons.map((b=>b.id)),cN:this.assetsContext.cN.map((b=>b.name)),geometries:this.assetsContext.geometries.map((b=>b.id)),multiMaterials:this.assetsContext.multiMaterials.map((b=>b.id)),transformNodes:this.assetsContext.transformNodes.map((b=>b.id))})}getClassName(){return"FlowGraphContext"}}(0,Q.e)([(0,U.W)()],Z.prototype,"uniqueId",void 0);var T=i(13544),z=i(12047);class K{constructor(b){this.onEventTriggeredObservable=new V.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=b,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Qe.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const b=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",oi:{timeSinceStart:this._startingTime,deltaTime:b}}),this._startingTime+=b})),this._meshPickedObserver=this._scene.onPointerObservable.add((b=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",oi:b})}),z.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((b=>{const n=b.pointerId,i=b.mesh,e=this._pointerUnderMeshState[n];!e&&i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",oi:{pointerId:n,mesh:i}}):e&&!i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",oi:{pointerId:n,mesh:e}}):e&&i&&e!==i&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",oi:{pointerId:n,mesh:e,over:i}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",oi:{pointerId:n,mesh:i,out:e}})),this._pointerUnderMeshState[n]=i}),z.d.POINTERMOVE)}dispose(){var b,n,i,e,V;null===(b=this._sceneDisposeObserver)||void 0===b||b.remove(),null===(n=this._sceneReadyObserver)||void 0===n||n.remove(),null===(i=this._sceneOnBeforeRenderObserver)||void 0===i||i.remove(),null===(e=this._meshPickedObserver)||void 0===e||e.remove(),null===(V=this._meshUnderPointerObserver)||void 0===V||V.remove(),this.onEventTriggeredObservable.clear()}}var I,O=i(13560);!function(b){b[b.Stopped=0]="Stopped",b[b.Started=1]="Started"}(I||(I={}));class u{get state(){return this._state}set state(b){this._state=b,this.onStateChangedObservable.notifyObservers(b)}constructor(b){this.onStateChangedObservable=new V.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=b.dn,this._sceneEventCoordinator=new K(this._scene),this._coordinator=b.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((b=>{for(const n of this._executionContexts){const i=this._getContextualOrder(b.type,n);for(const e of i)if(!e._executeEvent(n,b.oi))break}switch(b.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const n of this._executionContexts)n._notifyOnTick(b.oi);break;case"SceneDispose":this.dispose()}}))}createContext(){const b=new Z({dn:this._scene,coordinator:this._coordinator});return this._executionContexts.push(b),b}getContext(b){return this._executionContexts[b]}addEventBlock(b){if("PointerOver"!==b.type&&"PointerOut"!==b.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==b.type&&this._eventBlocks[b.type].push(b),1===this.state)for(const n of this._executionContexts)b._startPendingTasks(n);else this.onStateChangedObservable.addOnce((n=>{if(1===n)for(const i of this._executionContexts)b._startPendingTasks(i)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((b=>{1===b&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const b of this._executionContexts)for(const n in this._eventBlocks){const i=this._getContextualOrder(n,b);for(const n of i)n._startPendingTasks(b)}}_getContextualOrder(b,n){const i=this._eventBlocks[b].sort(((b,n)=>n.initPriority-b.initPriority));if("MeshPick"===b){const b=[];for(const e of i){const V=e.asset.getValue(n);let Q=0;for(;Q<i.length;Q++){const b=i[Q].asset.getValue(n);if(V&&b&&(0,O.l)(V,b))break}b.splice(Q,0,e)}return b}return i}dispose(){var b;if(0!==this.state){this.state=0;for(const b of this._executionContexts)b._clearPendingBlocks();this._executionContexts.length=0;for(const b in this._eventBlocks)this._eventBlocks[b].length=0;null===(b=this._eventObserver)||void 0===b||b.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(b){const n=[],i=new Set;for(const e in this._eventBlocks)for(const b of this._eventBlocks[e])n.push(b),i.add(b.uniqueId);for(;n.length>0;){const e=n.pop();b(e);for(const b of e.dataInputs)for(const e of b._connectedPoint)i.has(e._ownerBlock.uniqueId)||(n.push(e._ownerBlock),i.add(e._ownerBlock.uniqueId));if(e instanceof T.d)for(const b of e.signalOutputs)for(const e of b._connectedPoint)i.has(e._ownerBlock.uniqueId)||(n.push(e._ownerBlock),i.add(e._ownerBlock.uniqueId))}}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;b.allBlocks=[],this.visitAllBlocks((n=>{const i={};n.serialize(i),b.allBlocks.push(i)})),b.executionContexts=[];for(const i of this._executionContexts){const e={};i.serialize(e,n),b.executionContexts.push(e)}}}class d{constructor(b){this.config=b,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.dn.Qe.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.dn.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const b=this._executeOnNextFrame.slice(0);if(b.length)for(const n of b){this.notifyCustomEvent(n.id,n.data,!1);const b=this._executeOnNextFrame.findIndex((b=>b.uniqueId===n.uniqueId));-1!==b&&this._executeOnNextFrame.splice(b,1)}}));(d.SceneCoordinators.get(this.config.dn)??[]).push(this)}createGraph(){const b=new u({dn:this.config.dn,coordinator:this});return this._flowGraphs.push(b),b}removeGraph(b){const n=this._flowGraphs.indexOf(b);-1!==n&&(b.dispose(),this._flowGraphs.splice(n,1))}start(){for(const b of this._flowGraphs)b.start()}dispose(){var b,n;for(const V of this._flowGraphs)V.dispose();this._flowGraphs.length=0,null===(b=this._disposeObserver)||void 0===b||b.remove(),null===(n=this._onBeforeRenderObserver)||void 0===n||n.remove();const i=d.SceneCoordinators.get(this.config.dn)??[],e=i.indexOf(this);-1!==e&&i.splice(e,1)}serialize(b,n){b._flowGraphs=[];for(const i of this._flowGraphs){const e={};i.serialize(e,n),b._flowGraphs.push(e)}b.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(b){let n=this._customEventsMap.get(b);return n||(n=new V.e,this._customEventsMap.set(b,n)),n}notifyCustomEvent(b,n){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:b,data:n,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(b)){const n=this._eventExecutionCounter.get(b);if(this._eventExecutionCounter.set(b,n+1),n>=d.MaxEventTypeExecutionPerFrame)return void(n===d.MaxEventTypeExecutionPerFrame&&mb.b.Warn(`FlowGraphCoordinator: Too many executions of event "${b}".`))}else this._eventExecutionCounter.set(b,1);const i=this._customEventsMap.get(b);i&&i.notifyObservers(n)}}d.MaxEventsPerType=30,d.MaxEventTypeExecutionPerFrame=30,d.SceneCoordinators=new Map},13566:(b,n,i)=>{"use strict";i.d(n,{c:()=>V});var e=i(13574);class V extends e.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(b){b._notifyExecuteNode(this),this.done._activateSignal(b)}}},13544:(b,n,i)=>{"use strict";i.d(n,{d:()=>Y});var e=i(13547),V=i(13551),Q=i(11734);class U extends V.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(b){super.connectTo(b),this._connectedPoint.sort(((b,n)=>n.priority-b.priority))}_activateSignal(b){var n;if(null===(n=b.logger)||void 0===n||n.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,oi:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)b._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(b,this),b._increaseExecutionId();else for(const i of this._connectedPoint)i._activateSignal(b)}}(0,Q.i)("FlowGraphSignalConnection",U);class Y extends e.c{constructor(b){super(b),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(b){const n=new U(b,0,this);return this.signalInputs.push(n),n}_registerSignalOutput(b){const n=new U(b,1,this);return this.signalOutputs.push(n),n}_unregisterSignalInput(b){const n=this.signalInputs.findIndex((n=>n.name===b));-1!==n&&(this.signalInputs[n].dispose(),this.signalInputs.splice(n,1))}_unregisterSignalOutput(b){const n=this.signalOutputs.findIndex((n=>n.name===b));-1!==n&&(this.signalOutputs[n].dispose(),this.signalOutputs.splice(n,1))}_reportError(b,n){this.error.oi="string"===typeof n?new Error(n):n,this.error._activateSignal(b)}getSignalInput(b){return this.signalInputs.find((n=>n.name===b))}getSignalOutput(b){return this.signalOutputs.find((n=>n.name===b))}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(b),b.signalInputs=[],b.signalOutputs=[];for(const n of this.signalInputs){const i={};n.serialize(i),b.signalInputs.push(i)}for(const n of this.signalOutputs){const i={};n.serialize(i),b.signalOutputs.push(i)}}deserialize(b){for(let n=0;n<b.signalInputs.length;n++){const i=this.getSignalInput(b.signalInputs[n].name);if(!i)throw new Error("Could not find signal input with name "+b.signalInputs[n].name+" in block "+b.className);i.deserialize(b.signalInputs[n])}for(let n=0;n<b.signalOutputs.length;n++){const i=this.getSignalOutput(b.signalOutputs[n].name);if(!i)throw new Error("Could not find signal output with name "+b.signalOutputs[n].name+" in block "+b.className);i.deserialize(b.signalOutputs[n])}}getClassName(){return"FlowGraphExecutionBlock"}}},13582:(b,n,i)=>{"use strict";i.d(n,{d:()=>V});var e=i(13544);class V extends e.d{constructor(b){super(b),this.out=this._registerSignalOutput("out")}}},13522:(b,n,i)=>{"use strict";i.d(n,{A:()=>T,E:()=>z,F:()=>K,H:()=>D,K:()=>x,M:()=>a,P:()=>j,c:()=>B,f:()=>Z,h:()=>M,j:()=>I,k:()=>O,o:()=>u,q:()=>N,t:()=>o,x:()=>mb});var e,V=i(11778),Q=i(11822),U=i(13513),Y=i(13527);!function(b){b.Any="any",b.String="string",b.Number="number",b.Boolean="boolean",b.Object="object",b.Integer="FlowGraphInteger",b.Vector2="Vector2",b.On="On",b.Vector4="Vector4",b.Quaternion="Quaternion",b.Matrix="Matrix",b.Matrix2D="Matrix2D",b.Matrix3D="Matrix3D",b.Mn="Mn",b.IV="IV"}(e||(e={}));class L{constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=b,this.defaultValue=n,this.animationType=i}serialize(b){b.typeName=this.typeName,b.defaultValue=this.defaultValue}}const B=new L("any",void 0),mb=new L("string",""),N=new L("number",0,0),Z=new L("boolean",!1),T=new L("Vector2",V.Vector2.Zero(),5),z=new L("On",V.On.Zero(),1),K=new L("Vector4",V.Vector4.Zero()),I=new L("Matrix",V.Matrix.Identity(),3),O=new L("Matrix2D",new Y.c),u=new L("Matrix3D",new Y.d),d=new L("Mn",Q.Mn.Black(),4),G=new L("IV",new Q.IV(0,0,0,0),7),o=new L("Quaternion",V.Quaternion.Identity(),2);o.typeTransformer=b=>{if(b.getClassName){if("Vector4"===b.getClassName())return V.Quaternion.jn(b.ye());if("On"===b.getClassName())return V.Quaternion.FromEulerVector(b);if("Matrix"===b.getClassName())return V.Quaternion.FromRotationMatrix(b)}return b};const M=new L("FlowGraphInteger",new U.b(0),0);function j(b){const n=b;switch(typeof b){case"string":return mb;case"number":return N;case"boolean":return Z;case"object":if(n.getClassName)switch(n.getClassName()){case"Vector2":return T;case"On":return z;case"Vector4":return K;case"Matrix":return I;case"Mn":return d;case"IV":return G;case"Quaternion":return o;case"FlowGraphInteger":return M;case"Matrix2D":return O;case"Matrix3D":return u}return B;default:return B}}function a(b){switch(b){case"string":return mb;case"number":return N;case"boolean":return Z;case"Vector2":return T;case"On":return z;case"Vector4":return K;case"Matrix":return I;case"Mn":return d;case"IV":return G;case"Quaternion":return o;case"FlowGraphInteger":return M;case"Matrix2D":return O;case"Matrix3D":return u;default:return B}}function D(b){switch(b){case"number":default:return 0;case"Vector2":return 5;case"On":return 1;case"Matrix":return 3;case"Mn":return 4;case"IV":return 7;case"Quaternion":return 2}}function x(b){switch(b){case 0:return N;case 5:return T;case 1:return z;case 3:return I;case 4:return d;case 7:return G;case 2:return o;default:return B}}},13504:(b,n,i)=>{"use strict";i.d(n,{b:()=>mb,e:()=>B,f:()=>N});var e=i(11822),V=i(11778),Q=i(13513),U=i(13522),Y=i(13527);function L(b){return"Vector2"===b||"On"===b||"Vector4"===b||"Quaternion"===b||"Mn"===b||"IV"===b}function B(b,n,i){var e;const V=(null===n||void 0===n||null===(e=n.getClassName)||void 0===e?void 0:e.call(n))??"";if(L(V)||function(b){return"Matrix"===b||"Matrix2D"===b||"Matrix3D"===b}(V))i[b]={value:n.ye(),className:V};else if("FlowGraphInteger"===V)i[b]={value:n.value,className:V};else if(V&&(n.id||n.name))i[b]={id:n.id,name:n.name,className:V};else{if("object"===typeof n)throw new Error(`Could not serialize value ${n}`);i[b]=n}}function mb(b,n,i,B){const N=n[b];let Z;const T=(null===N||void 0===N?void 0:N.type)??(null===N||void 0===N?void 0:N.className);if(function(b){return"Mesh"===b||"AbstractMesh"===b||"GroundMesh"===b||"InstanceMesh"===b||"LinesMesh"===b||"GoldbergMesh"===b||"GreasedLineMesh"===b||"TrailMesh"===b}(T)){let b=B.meshes.filter((b=>N.id?b.id===N.id:b.name===N.name));0===b.length&&(b=B.transformNodes.filter((b=>N.id?b.id===N.id:b.name===N.name))),Z=N.uniqueId?b.find((b=>b.uniqueId===N.uniqueId)):b[0]}else if(L(T))Z=function(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===b)return V.Vector2.jn(n);if("On"===b)return i&&(n[2]*=-1),V.On.jn(n);if("Vector4"===b)return V.Vector4.jn(n);if("Quaternion"===b)return i&&(n[2]*=-1,n[3]*=-1),V.Quaternion.jn(n);if("Mn"===b)return new e.Mn(n[0],n[1],n[2]);if("IV"===b)return new e.IV(n[0],n[1],n[2],n[3]);throw new Error(`Unknown vector class name ${b}`)}(T,N.value);else if(function(b){return"AnimationGroup"===b}(T)){const b=B.animationGroups.filter((b=>b.name===N.name));Z=1===b.length?b[0]:b.find((b=>b.uniqueId===N.uniqueId))}else Z="Matrix"===T?V.Matrix.jn(N.value):"Matrix2D"===T?new Y.c(N.value):"Matrix3D"===T?new Y.d(N.value):"FlowGraphInteger"===T?Q.b.FromValue(N.value):"number"===T||"string"===T||"boolean"===T?N.value[0]:N&&void 0!==N.value?N.value:Array.isArray(N)?N.reduce(((b,n)=>n.eventData?(b[n.id]={type:(0,U.M)(n.type)},"undefined"!==typeof n.value&&(b[n.id].value=mb("value",n,i,B)),b):b),{}):N;return Z}function N(b){return"FlowGraphJsonPointerParserBlock"===b}},13560:(b,n,i)=>{"use strict";function e(b,n){return!(!b.parent||b.parent!==n&&!e(b.parent,n))}function V(b){if(b.getClassName)return b.getClassName()}function Q(b,n){return b===n&&("Vector2"===b||"On"===b||"Vector4"===b||"Quaternion"===b)}function U(b,n){return b===n&&("Matrix"===b||"Matrix2D"===b||"Matrix3D"===b)}function Y(b,n){return"FlowGraphInteger"===b&&"FlowGraphInteger"===n}function L(b,n){const i="number"===typeof b||"number"===typeof(null===b||void 0===b?void 0:b.value);return i&&!n?!isNaN(B(b)):i}function B(b){return"number"===typeof b?b:b.value}i.d(n,{b:()=>Y,f:()=>U,j:()=>Q,k:()=>V,l:()=>e,o:()=>B,r:()=>L})},12899:(b,n,i)=>{"use strict";i.r(n),i.d(n,{SceneInstrumentation:()=>Q});var e=i(11605),V=i(11986);class Q{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(b){b!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=b,b?(this._onBeforeActiveMeshesEvaluationObserver=this.dn.onBeforeActiveMeshesEvaluationObservable.add((()=>{e.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.dn.onAfterActiveMeshesEvaluationObservable.add((()=>{e.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.dn.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.dn.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(b){b!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=b,b?(this._onBeforeRenderTargetsRenderObserver=this.dn.onBeforeRenderTargetsRenderObservable.add((()=>{e.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.dn.onAfterRenderTargetsRenderObservable.add((()=>{e.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.dn.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.dn.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(b){b!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=b,b?(this._onBeforeParticlesRenderingObserver=this.dn.onBeforeParticlesRenderingObservable.add((()=>{e.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.dn.onAfterParticlesRenderingObservable.add((()=>{e.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.dn.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.dn.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(b){b!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=b,this.dn.spriteManagers&&(b?(this._onBeforeSpritesRenderingObserver=this.dn.onBeforeSpritesRenderingObservable.add((()=>{e.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.dn.onAfterSpritesRenderingObservable.add((()=>{e.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.dn.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.dn.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(b){b!==this._capturePhysicsTime&&this.dn.onBeforePhysicsObservable&&(this._capturePhysicsTime=b,b?(this._onBeforePhysicsObserver=this.dn.onBeforePhysicsObservable.add((()=>{e.Tools.StartPerformanceCounter("kz"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.dn.onAfterPhysicsObservable.add((()=>{e.Tools.EndPerformanceCounter("kz"),this._physicsTime.endMonitoring()}))):(this.dn.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.dn.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(b){b!==this._captureAnimationsTime&&(this._captureAnimationsTime=b,b?this._onAfterAnimationsObserver=this.dn.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.dn.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(b){this._captureFrameTime=b}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(b){this._captureInterFrameTime=b}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(b){b!==this._captureRenderTime&&(this._captureRenderTime=b,b?(this._onBeforeDrawPhaseObserver=this.dn.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),e.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.dn.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter("Main render")}))):(this.dn.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.dn.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(b){b!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=b,b?(this._onBeforeCameraRenderObserver=this.dn.onBeforeCameraRenderObservable.add((b=>{this._cameraRenderTime.beginMonitoring(),e.Tools.StartPerformanceCounter(`Rendering camera ${b.name}`)})),this._onAfterCameraRenderObserver=this.dn.onAfterCameraRenderObservable.add((b=>{this._cameraRenderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter(`Rendering camera ${b.name}`)}))):(this.dn.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.dn.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.dn.getEngine()._drawCalls}constructor(b){this.dn=b,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new V.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new V.e,this._captureFrameTime=!1,this._frameTime=new V.e,this._captureRenderTime=!1,this._renderTime=new V.e,this._captureInterFrameTime=!1,this._interFrameTime=new V.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new V.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new V.e,this._capturePhysicsTime=!1,this._physicsTime=new V.e,this._captureAnimationsTime=!1,this._animationsTime=new V.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new V.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=b.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(e.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.dn.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=b.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(e.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ie(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ie(),this._captureParticlesRenderTime&&this._particlesRenderTime.ie(),this._captureSpritesRenderTime&&this._spritesRenderTime.ie(),this._captureRenderTime&&this._renderTime.ie(),this._captureCameraRenderTime&&this._cameraRenderTime.ie()}))}dispose(){this._disposed||(this.dn.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.dn.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.dn.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.dn.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.dn.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.dn.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.dn.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.dn.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.dn.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.dn.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.dn.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.dn.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.dn.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.dn.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.dn.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.dn.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.dn.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.dn=null,this._disposed=!0)}}},13495:(b,n,i)=>{"use strict";i.d(n,{d:()=>mb});var e=i(11756),V=i(11762),Q=i(11778),U=i(12187),Y=i(12317),L=i(12388),B=i(11734);U.b.AddNodeConstructor("Light_Type_1",((b,n)=>()=>new mb(b,Q.On.Zero(),n)));class mb extends L.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(b){this._shadowFrustumSize=b,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(b){this._shadowOrthoScale=b,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(b){this._orthoLeft=b}get orthoRight(){return this._orthoRight}set orthoRight(b){this._orthoRight=b}get orthoTop(){return this._orthoTop}set orthoTop(b){this._orthoTop=b}get orthoBottom(){return this._orthoBottom}set orthoBottom(b){this._orthoBottom=b}constructor(b,n,i){super(b,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=n.scale(-1),this.direction=n}getClassName(){return"rz"}getTypeID(){return Y.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(b,n,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(b):this._setDefaultAutoExtendShadowProjectionMatrix(b,n,i)}_setDefaultFixedFrustumShadowProjectionMatrix(b){const n=this.ab().activeCamera;n&&Q.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:n.Ae,void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,b,this.ab().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(b,n,i){const e=this.ab().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const b=Q.On.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let e=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(let U=0;U<i.length;U++){const Y=i[U];if(!Y)continue;const L=Y.getBoundingInfo().boundingBox;for(let i=0;i<L.vectorsWorld.length;i++)Q.On.TransformCoordinatesToRef(L.vectorsWorld[i],n,b),b.x<this._orthoLeft&&(this._orthoLeft=b.x),b.y<this._orthoBottom&&(this._orthoBottom=b.y),b.x>this._orthoRight&&(this._orthoRight=b.x),b.y>this._orthoTop&&(this._orthoTop=b.y),this.autoCalcShadowZBounds&&(b.z<e&&(e=b.z),b.z>V&&(V=b.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=e,this._shadowMaxZ=V)}const V=this._orthoRight-this._orthoLeft,U=this._orthoTop-this._orthoBottom,Y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===e||void 0===e?void 0:e.Ae)||0,L=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===e||void 0===e?void 0:e.maxZ)||1e4,B=this.ab().getEngine().useReverseDepthBuffer;Q.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-V*this.shadowOrthoScale,this._orthoRight+V*this.shadowOrthoScale,this._orthoBottom-U*this.shadowOrthoScale,this._orthoTop+U*this.shadowOrthoScale,B?L:Y,B?Y:L,b,this.ab().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(b,n){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,n),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,n),this)}transferToNodeMaterialEffect(b,n){return this.computeTransformedInformation()?(b.setFloat3(n,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(b.setFloat3(n,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(b){const n=this._scene.getEngine();return!n.useReverseDepthBuffer&&n.isNDCHalfZRange?0:1}getDepthMaxZ(b){const n=this._scene.getEngine();return n.useReverseDepthBuffer&&n.isNDCHalfZRange?0:1}prepareLightSpecificDefines(b,n){b["DIRLIGHT"+n]=!0}}(0,e.e)([(0,V.W)()],mb.prototype,"shadowFrustumSize",null),(0,e.e)([(0,V.W)()],mb.prototype,"shadowOrthoScale",null),(0,e.e)([(0,V.W)()],mb.prototype,"autoUpdateExtends",void 0),(0,e.e)([(0,V.W)()],mb.prototype,"autoCalcShadowZBounds",void 0),(0,e.e)([(0,V.W)("orthoLeft")],mb.prototype,"_orthoLeft",void 0),(0,e.e)([(0,V.W)("orthoRight")],mb.prototype,"_orthoRight",void 0),(0,e.e)([(0,V.W)("orthoTop")],mb.prototype,"_orthoTop",void 0),(0,e.e)([(0,V.W)("orthoBottom")],mb.prototype,"_orthoBottom",void 0),(0,B.i)("BABYLON.DirectionalLight",mb)},14017:(b,n,i)=>{"use strict";i.d(n,{c:()=>mb});var e=i(11756),V=i(11762),Q=i(11778),U=i(11822),Y=i(12187),L=i(12317),B=i(11734);Y.b.AddNodeConstructor("Light_Type_3",((b,n)=>()=>new mb(b,Q.On.Zero(),n)));class mb extends L.c{constructor(b,n,i){super(b,i),this.groundColor=new U.Mn(0,0,0),this.direction=n||Q.On.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Xz"}setDirectionToTarget(b){return this.direction=Q.On.Normalize(b.un(Q.On.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(b,n){const i=Q.On.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,n),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.GY),n),this}transferToNodeMaterialEffect(b,n){const i=Q.On.Normalize(this.direction);return b.setFloat3(n,i.x,i.y,i.z),this}we(){return this._worldMatrix||(this._worldMatrix=Q.Matrix.Identity()),this._worldMatrix}getTypeID(){return L.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(b,n){b["HEMILIGHT"+n]=!0}}(0,e.e)([(0,V.p)()],mb.prototype,"groundColor",void 0),(0,e.e)([(0,V.S)()],mb.prototype,"direction",void 0),(0,B.i)("BABYLON.HemisphericLight",mb)},13470:(b,n,i)=>{"use strict";i.d(n,{e:()=>N});var e=i(11756),V=i(11762),Q=i(11778),U=i(12187),Y=i(12317),L=i(12388),B=i(11748),mb=i(11734);U.b.AddNodeConstructor("Light_Type_2",((b,n)=>()=>new N(b,Q.On.Zero(),Q.On.Zero(),0,0,n)));class N extends L.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(b){this._iesProfileTexture!==b&&(this._iesProfileTexture=b,this._iesProfileTexture&&N._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(b){this._angle=b,this._cosHalfAngle=Math.cos(.5*b),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(b){this._innerAngle=b,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(b){this._shadowAngleScale=b,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(b){this._projectionTextureLightNear=b,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(b){this._projectionTextureLightFar=b,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(b){this._projectionTextureUpDirection=b,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(b){this._projectionTexture!==b&&(this._projectionTexture=b,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(N._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):N._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(b){return void 0!==b.onGeneratedObservable}static _IsTexture(b){return void 0!==b.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(b){this._projectionTextureProjectionLightMatrix=b,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(b,n,i,e,V,U){super(b,U),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Q.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Q.On.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Q.On.Zero(),this._projectionTextureViewLightMatrix=Q.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=Q.Matrix.Zero(),this._projectionTextureScalingMatrix=Q.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=n,this.direction=i,this.angle=e,this.exponent=V}getClassName(){return"SpotLight"}getTypeID(){return Y.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(b){super._setDirection(b),this._projectionTextureViewLightDirty=!0}_setPosition(b){super._setPosition(b),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(b,n,i){const e=this.ab().activeCamera;if(!e)return;this._shadowAngleScale=this._shadowAngleScale||1;const V=this._shadowAngleScale*this._angle,U=void 0!==this.shadowMinZ?this.shadowMinZ:e.Ae,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ,L=this.ab().getEngine().useReverseDepthBuffer;Q.Matrix.PerspectiveFovLHToRef(V,1,L?Y:U,L?U:Y,b,!0,this._scene.getEngine().isNDCHalfZRange,void 0,L)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Q.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const b=this.projectionTextureLightFar,n=this.projectionTextureLightNear,i=b/(b-n),e=-i*n,V=1/Math.tan(this._angle/2);Q.Matrix.FromValuesToRef(V/1,0,0,0,0,V,0,0,0,0,i,1,0,0,e,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof B.e){const b=this._projectionTexture.uScale/2,n=this._projectionTexture.vScale/2;Q.Matrix.FromValuesToRef(b,0,0,0,0,n,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(b,n){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),b.setMatrix("textureProjectionMatrix"+n,this._projectionTextureMatrix),b.setTexture("projectionLightTexture"+n,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&b.setTexture("iesLightTexture"+n,this._iesProfileTexture),this}transferToEffect(b,n){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,n),i=Q.On.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,n),i=Q.On.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,n),this}transferToNodeMaterialEffect(b,n){let i;return i=this.computeTransformedInformation()?Q.On.Normalize(this.transformedDirection):Q.On.Normalize(this.direction),this.ab().useRightHandedSystem?b.setFloat3(n,-i.x,-i.y,-i.z):b.setFloat3(n,i.x,i.y,i.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(b){const n=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===b||void 0===b?void 0:b.Ae)??0;return n.useReverseDepthBuffer&&n.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}getDepthMaxZ(b){const n=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===b||void 0===b?void 0:b.maxZ)??1e4;return n.useReverseDepthBuffer&&n.isNDCHalfZRange?0:i}prepareLightSpecificDefines(b,n){b["SPOTLIGHT"+n]=!0,b["PROJECTEDLIGHTTEXTURE"+n]=!(!this.projectionTexture||!this.projectionTexture.isReady()),b["IESLIGHTTEXTURE"+n]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,e.e)([(0,V.W)()],N.prototype,"angle",null),(0,e.e)([(0,V.W)()],N.prototype,"innerAngle",null),(0,e.e)([(0,V.W)()],N.prototype,"shadowAngleScale",null),(0,e.e)([(0,V.W)()],N.prototype,"exponent",void 0),(0,e.e)([(0,V.W)()],N.prototype,"projectionTextureLightNear",null),(0,e.e)([(0,V.W)()],N.prototype,"projectionTextureLightFar",null),(0,e.e)([(0,V.W)()],N.prototype,"projectionTextureUpDirection",null),(0,e.e)([(0,V.K)("projectedLightTexture")],N.prototype,"_projectionTexture",void 0),(0,mb.i)("BABYLON.SpotLight",N)},13187:(b,n,i)=>{"use strict";i.d(n,{e:()=>U,f:()=>Q,h:()=>Y});const e={},V={};function Q(b,n){e[b]=n}function U(b,n){V[b]=n}function Y(b){return V[b]?V[b]:null}},13072:(b,n,i)=>{"use strict";i.d(n,{d:()=>j,f:()=>h});var e,V=i(11605),Q=i(11612),U=i(12005),Y=i(11646),L=i(11621),B=i(12233),mb=i(11655),N=i(11659),Z=i(11737),T=i(11676),z=i(11639);!function(b){b[b.Clean=0]="Clean",b[b.Stop=1]="Stop",b[b.Sync=2]="Sync",b[b.NoSync=3]="NoSync"}(e||(e={}));const K=new Q.e,I={};let O=!1;function u(){return I[".babylon"]}function d(b,n){const i=I[b];return i||(L.b.Warn("Unable to find a plugin to load "+b+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),n?u():void 0)}function G(b,n,i){let e="Unable to load from "+(b.rawData?"binary data":b.url);return n?e+=`: ${n}`:i&&(e+=`: ${i}`),e}async function o(b,n,i,e,V,Q,U,Y,L){var B;const N="data:"===(Z=b.url).substring(0,5)?Z.substring(5):null;var Z;if(b.rawData&&!U)throw"When using ArrayBufferView to load data the file extension must be provided.";const O=N||U?"":function(b){const n=b.indexOf("?");-1!==n&&(b=b.substring(0,n));const i=b.lastIndexOf(".");return b.substring(i,b.length).toLowerCase()}(b.url);let G=U?d(U,!0):N?function(b){for(const n in I){const i=I[n].plugin;if(i.canDirectLoad&&i.canDirectLoad(b))return I[n]}return u()}(b.url):d(O,!1);if(!G&&O){if(b.url&&!b.url.startsWith("blob:")){const n=await async function(b,n){const i=n.method||"GET";return await new Promise(((e,V)=>{const Q=new z.e;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const b={};if(n.responseHeaders)for(const i of n.responseHeaders)b[i]=Q.getResponseHeader(i)||"";e({response:Q.response,headerValues:b})}else V(`Unable to fetch data from ${b}. Error code: ${Q.status}`)})),Q.open(i,b),Q.send()}))}(b.url,{method:"HEAD",responseHeaders:["Content-Type"]}),i=n.headerValues?n.headerValues["Content-Type"]:"";i&&(G=function(b){for(const n in I){const i=I[n];if(i.mimeType===b)return i}}(i))}G||(G=u())}if(!G)throw new Error(`No plugin or fallback for ${U??b.url}`);if(!1===(null===L||void 0===L||null===(B=L[G.plugin.name])||void 0===B?void 0:B.enabled))throw new Error(`The '${G.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(b.rawData&&!G.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(b=>{if(G.plugin.createPlugin){const n=G.plugin.createPlugin(L??{});return n instanceof Promise?(n.then(b).catch((b=>{V("Error instantiating plugin.",b)})),null):(b(n),n)}return b(G.plugin),G.plugin})((L=>{var B;if(!L)throw`The loader plugin corresponding to the '${U}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(K.notifyObservers(L),N&&(L.canDirectLoad&&L.canDirectLoad(b.url)||!(0,mb.h)(b.url))){if(L.directLoad){const b=L.directLoad(n,N);b instanceof Promise?b.then((b=>{i(L,b)})).catch((b=>{V("Error in directLoad of _loadData: "+b,b)})):i(L,b)}else i(L,N);return}const Z=G.isBinary,z=(b,e)=>{n.N?V("Scene has been disposed"):i(L,b,e)};let I=null,O=!1;null===(B=L.Qe)||void 0===B||B.add((()=>{O=!0,I&&(I.abort(),I=null),Q()}));const u=()=>{if(O)return;const i=(b,n)=>{V(null===b||void 0===b?void 0:b.statusText,n)};if(!L.loadFile&&b.rawData)throw"Plugin does not support loading ArrayBufferView.";I=L.loadFile?L.loadFile(n,b.rawData||b.file||b.url,b.rootUrl,z,e,Z,i,Y):n._loadFile(b.file||b.url,z,e,!0,Z,i)},d=n.getEngine();let o=d.enableOfflineSupport;if(o){let i=!1;for(const e of n.disableOfflineSupportExceptionRules)if(e.test(b.url)){i=!0;break}o=!i}o&&T.b.OfflineProviderFactory?n.offlineProvider=T.b.OfflineProviderFactory(b.url,u,d.disableManifestCheck):u()}))}function M(b,n){let i,e,Q=null,U=null;if(n)if(n.name)i=`file:${n.name}`,e=n.name,Q=n;else if(ArrayBuffer.isView(n))i="",e=(0,Z.d)(),U=n;else if(n.startsWith("data:"))i=n,e="";else if(b){const Q=n;if("/"===Q.substring(0,1))return V.Tools.Error("Wrong sceneFilename parameter"),null;i=b+Q,e=Q}else i=n,e=V.Tools.GetFilename(n),b=V.Tools.GetFolderPath(n);else i=b,e=V.Tools.GetFilename(b),b=V.Tools.GetFolderPath(b);return{url:i,rootUrl:b,name:e,file:Q,rawData:U}}function j(b){if("string"===typeof b.extensions){const n=b.extensions;I[n.toLowerCase()]={plugin:b,isBinary:!1}}else{const n=b.extensions,i=Object.keys(n);for(const e of i)I[e.toLowerCase()]={plugin:b,isBinary:n[e].isBinary,mimeType:n[e].mimeType}}}async function a(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.d.LastCreatedScene,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,mb=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!e)return L.b.Error("No scene available to import mesh to"),null;const T=M(n,i);if(!T)return null;const z={};e.addPendingData(z);const K=()=>{e.removePendingData(z)},I=(b,n)=>{const i=G(T,b,n);U?U(e,i,new N.k(i,N.g.SceneLoaderError,n)):L.b.Error(i),K()},O=Q?b=>{try{Q(b)}catch(n){I("Error in onProgress callback: "+n,n)}}:void 0,u=(b,n,i,Q,U,Y,L,B)=>{if(e.importedMeshesFiles.push(T.url),V)try{V(b,n,i,Q,U,Y,L,B)}catch(mb){I("Error in onSuccess callback: "+mb,mb)}e.removePendingData(z)};return await o(T,e,((n,i,V)=>{if(n.rewriteRootURL&&(T.rootUrl=n.rewriteRootURL(T.rootUrl,V)),n.importMesh){const V=[],Q=[],U=[];if(!n.importMesh(b,e,i,T.rootUrl,V,Q,U,I))return;e.loadingPluginName=n.name,u(V,Q,U,[],[],[],[],[])}else{n.importMeshAsync(b,e,i,T.rootUrl,O,T.name).then((b=>{e.loadingPluginName=n.name,u(b.meshes,b.cN,b.skeletons,b.animationGroups,b.transformNodes,b.geometries,b.lights,b.spriteManagers)})).catch((b=>{I(b.message,b)}))}}),O,I,K,B,mb,Z)}async function D(b,n,i,e,V,Q,U,Y){return await new Promise(((L,B)=>{try{a(b,n,i,e,((b,n,i,e,V,Q,U,Y)=>{L({meshes:b,cN:n,skeletons:i,animationGroups:e,transformNodes:V,geometries:Q,lights:U,spriteManagers:Y})}),V,((b,n,i)=>{B(i||new Error(n))}),Q,U,Y).catch(B)}catch(N){B(N)}}))}async function x(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.d.LastCreatedEngine,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mb=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};i?await s(b,n,new U.b(i),e,Q,L,B,mb,N):V.Tools.Error("No engine available")}async function y(b,n,i,e,V,Q,U){return await new Promise(((Y,L)=>{x(b,n,i,(b=>{Y(b)}),e,((b,n,i)=>{L(i||new Error(n))}),V,Q,U)}))}async function s(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.d.LastCreatedScene,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mb=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return L.b.Error("No scene available to append to"),null;const T=M(b,n);if(!T)return null;const z={};i.addPendingData(z);const K=()=>{i.removePendingData(z)};B.d.ShowLoadingScreen&&!O&&(O=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),O=!1})));const I=(b,n)=>{const e=G(T,b,n);Q?Q(i,e,new N.k(e,N.g.SceneLoaderError,n)):L.b.Error(e),K()},u=V?b=>{try{V(b)}catch(n){I("Error in onProgress callback",n)}}:void 0,d=()=>{if(e)try{e(i)}catch(b){I("Error in onSuccess callback",b)}i.removePendingData(z)};return await o(T,i,((b,n)=>{if(b.load){if(!b.load(i,n,T.rootUrl,I))return;i.loadingPluginName=b.name,d()}else{b.loadAsync(i,n,T.rootUrl,u,T.name).then((()=>{i.loadingPluginName=b.name,d()})).catch((b=>{I(b.message,b)}))}}),u,I,K,U,mb,Z)}async function A(b,n,i,e,V,Q,U){return await new Promise(((Y,L)=>{try{s(b,n,i,(b=>{Y(b)}),e,((b,n,i)=>{L(i||new Error(n))}),V,Q,U).catch(L)}catch(N){L(N)}}))}async function E(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.d.LastCreatedScene,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",mb=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return L.b.Error("No scene available to load asset container to"),null;const Z=M(b,n);if(!Z)return null;const T={};i.addPendingData(T);const z=()=>{i.removePendingData(T)},K=(b,n)=>{const e=G(Z,b,n);Q?Q(i,e,new N.k(e,N.g.SceneLoaderError,n)):L.b.Error(e),z()},I=V?b=>{try{V(b)}catch(n){K("Error in onProgress callback",n)}}:void 0,O=b=>{if(e)try{e(b)}catch(n){K("Error in onSuccess callback",n)}i.removePendingData(T)};return await o(Z,i,((b,n)=>{if(b.loadAssetContainer){const e=b.loadAssetContainer(i,n,Z.rootUrl,K);if(!e)return;e.populateRootNodes(),i.loadingPluginName=b.name,O(e)}else if(b.loadAssetContainerAsync){b.loadAssetContainerAsync(i,n,Z.rootUrl,I,Z.name).then((n=>{n.populateRootNodes(),i.loadingPluginName=b.name,O(n)})).catch((b=>{K(b.message,b)}))}else K("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,K,z,U,B,mb)}async function C(b,n,i,e,V,Q,U){return await new Promise(((Y,L)=>{try{E(b,n,i,(b=>{Y(b)}),e,((b,n,i)=>{L(i||new Error(n))}),V,Q,U).catch(L)}catch(N){L(N)}}))}async function t(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.d.LastCreatedScene,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,mb=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!i)return void L.b.Error("No scene available to load animations to");if(e){for(const e of i.animatables)e.reset();i.stopAllAnimations();const b=i.animationGroups.slice();for(const i of b)i.dispose();const n=i.getNodes();for(const i of n)i.animations&&(i.animations=[])}else switch(V){case 0:const b=i.animationGroups.slice();for(const n of b)n.dispose();break;case 1:for(const n of i.animationGroups)n.stop();break;case 2:for(const n of i.animationGroups)n.reset(),n.restart();break;case 3:break;default:return void L.b.Error("Unknown animation group loading mode value '"+V+"'")}const z=i.animatables.length;await E(b,n,i,(b=>{b.mergeAnimationsTo(i,i.animatables.slice(z),Q),b.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),U&&U(i)}),B,mb,N,Z,T)}async function w(b,n,i,e,V,Q,U,Y,L,B){return await new Promise(((mb,Z)=>{try{t(b,n,i,e,V,Q,(b=>{mb(b)}),U,((b,n,i)=>{Z(i||new Error(n))}),Y,L,B).catch(Z)}catch(N){Z(N)}}))}class h{static get ForceFullSceneLoadingForIncremental(){return B.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(b){B.d.ForceFullSceneLoadingForIncremental=b}static get ShowLoadingScreen(){return B.d.ShowLoadingScreen}static set ShowLoadingScreen(b){B.d.ShowLoadingScreen=b}static get loggingLevel(){return B.d.loggingLevel}static set loggingLevel(b){B.d.loggingLevel=b}static get CleanBoneMatrixWeights(){return B.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(b){B.d.CleanBoneMatrixWeights=b}static GetDefaultPlugin(){return u()}static GetPluginForExtension(b){var n;return null===(n=d(b,!0))||void 0===n?void 0:n.plugin}static IsPluginForExtensionAvailable(b){return function(b){return!!I[b]}(b)}static RegisterPlugin(b){j(b)}static ImportMesh(b,n,i,e,V,Q,U,L,B){a(b,n,i,e,V,Q,U,L,B).catch((b=>null===U||void 0===U?void 0:U(Y.d.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async ImportMeshAsync(b,n,i,e,V,Q,U){return await D(b,n,i,e,V,Q,U)}static Load(b,n,i,e,V,Q,U,L){x(b,n,i,e,V,Q,U,L).catch((b=>null===Q||void 0===Q?void 0:Q(Y.d.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async LoadAsync(b,n,i,e,V,Q){return await y(b,n,i,e,V,Q)}static Append(b,n,i,e,V,Q,U,L){s(b,n,i,e,V,Q,U,L).catch((b=>null===Q||void 0===Q?void 0:Q(i??Y.d.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async AppendAsync(b,n,i,e,V,Q){return await A(b,n,i,e,V,Q)}static LoadAssetContainer(b,n,i,e,V,Q,U,L){E(b,n,i,e,V,Q,U,L).catch((b=>null===Q||void 0===Q?void 0:Q(i??Y.d.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async LoadAssetContainerAsync(b,n,i,e,V,Q){return await C(b,n,i,e,V,Q)}static ImportAnimations(b,n,i,e,V,Q,U,L,B,mb,N){t(b,n,i,e,V,Q,U,L,B,mb,N).catch((b=>null===B||void 0===B?void 0:B(i??Y.d.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async ImportAnimationsAsync(b,n,i,e,V,Q,U,Y,L,B,mb){return await w(b,n,i,e,V,Q,Y,B,mb)}}h.NO_LOGGING=0,h.MINIMAL_LOGGING=1,h.SUMMARY_LOGGING=2,h.DETAILED_LOGGING=3,h.OnPluginActivatedObservable=K},13479:(b,n,i)=>{"use strict";i.d(n,{b:()=>Z});var e=i(11756),V=i(11762),Q=i(11605),U=i(11778),Y=i(11803),L=i(11748),B=i(11734),mb=i(11612),N=i(11811);i(13483);class Z extends Y.e{set boundingBoxSize(b){if(this._boundingBoxSize&&this._boundingBoxSize.equals(b))return;this._boundingBoxSize=b;const n=this.ab();n&&n.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(b){this._rotationY=b,this.setReflectionTextureMatrix(U.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(b,n,i){let e="";for(const V of b)e+=V;return new Z(e,n,null,i,b)}static CreateFromPrefilteredData(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const V=n.useDelayedTextureLoading;n.useDelayedTextureLoading=!1;const Q=new Z(b,n,null,!1,null,null,null,void 0,!0,i,e);return n.useDelayedTextureLoading=V,Q}constructor(b,n){var i;let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],T=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,O=arguments.length>13?arguments[13]:void 0,u=arguments.length>14?arguments[14]:void 0;super(n),this.onLoadObservable=new mb.e,this.boundingBoxPosition=U.On.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new U.Matrix,this._buffer=null,this.name=b,this.url=b,this._noMipmap=V,this.se=!1,this.isCube=!0,this._textureMatrix=U.Matrix.Identity(),this.coordinatesMode=L.e.CUBIC_MODE;let d=null,G=null;null===e||Array.isArray(e)?(this._noMipmap=V,this._format=N,this._createPolynomials=z,d=e,this._loaderOptions=O,this._useSRGBBuffer=u,this._lodScale=K,this._lodOffset=I):(d=e.extensions??null,this._noMipmap=e.noMipmap??!1,Q=e.files??null,G=e.buffer??null,this._format=e.format??5,Z=e.prefiltered??!1,T=e.forcedExtension??null,this._createPolynomials=e.createPolynomials??!1,this._lodScale=e.lodScale??.8,this._lodOffset=e.lodOffset??0,this._loaderOptions=e.loaderOptions,this._useSRGBBuffer=e.useSRGBBuffer,Y=e.v??null,B=e.onError??null),(b||Q)&&this.updateURL(b,T,Y,Z,B,d,null===(i=this.ab())||void 0===i?void 0:i.useDelayedTextureLoading,Q,G)}getClassName(){return"CubeTexture"}updateURL(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=b),this.url=b,n&&(this._forcedExtension=n);const B=b.lastIndexOf("."),mb=n||(B>-1?b.substring(B).toLowerCase():""),N=0===mb.indexOf(".dds"),Z=0===mb.indexOf(".env"),T=0===mb.indexOf(".basis");if(Z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=e,e&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Y)this._files=Y;else if(T||Z||N||Q||(Q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Q){for(let n=0;n<Q.length;n++)this._files.push(b+Q[n]);this._extensions=Q}this._buffer=L,U?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=V):this._loadTexture(i,V)}delayLoad(b){4===this.delayLoadState&&(b&&(this._forcedExtension=b),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(b){var n,i;if(b.updateFlag===this._textureMatrix.updateFlag)return;b.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(i=this.ab())||void 0===i||i.markAllMaterialsAsDirty(1,(b=>-1!==b.getActiveTextures().indexOf(this))));if(this._textureMatrix=b,null===(n=this.ab())||void 0===n||!n.useRightHandedSystem)return;const e=U.TmpVectors.On[0],V=U.TmpVectors.Quaternion[0],Q=U.TmpVectors.On[1];this._textureMatrix.decompose(e,V,Q),V.z*=-1,V.w*=-1,U.Matrix.ComposeToRef(e,V,Q,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var b;return null!==(b=this.ab())&&void 0!==b&&b.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this.ab(),e=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const V=()=>{var n;(this.onLoadObservable.notifyObservers(this),e)&&(e.dispose(),null===(n=this.ab())||void 0===n||n.markAllMaterialsAsDirty(1));b&&b()},U=(b,i)=>{this._loadingError=!0,this._errorObject={message:b,exception:i},n&&n(b,i),L.e.OnTextureLoadErrorObservable.notifyObservers(this)};var Y;this._texture?this._texture.isReady?Q.Tools.SetImmediate((()=>V())):this._texture.onLoadedObservable.add((()=>V())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,b,U,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,b,U,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(Y=this._texture)||void 0===Y||Y.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(b,n,i){const e=N.c.Parse((()=>{let e=!1;return b.prefiltered&&(e=b.prefiltered),new Z(i+(b.url??b.name),n,b.extensions,!1,b.files||null,null,null,void 0,e,b.forcedExtension)}),b,n);if(b.boundingBoxPosition&&(e.boundingBoxPosition=U.On.jn(b.boundingBoxPosition)),b.boundingBoxSize&&(e.boundingBoxSize=U.On.jn(b.boundingBoxSize)),b.animations)for(let V=0;V<b.animations.length;V++){const n=b.animations[V],i=(0,B.e)("BABYLON.Animation");i&&e.animations.push(i.Parse(n))}return e}clone(){let b=0;const n=N.c.Clone((()=>{const n=new Z(this.url,this.ab()||this._getEngine(),this._extensions,this._noMipmap,this._files);return b=n.uniqueId,n}),this);return n.uniqueId=b,n}}(0,e.e)([(0,V.W)()],Z.prototype,"url",void 0),(0,e.e)([(0,V.S)()],Z.prototype,"boundingBoxPosition",void 0),(0,e.e)([(0,V.S)()],Z.prototype,"boundingBoxSize",null),(0,e.e)([(0,V.W)("rotationY")],Z.prototype,"rotationY",null),(0,e.e)([(0,V.W)("files")],Z.prototype,"_files",void 0),(0,e.e)([(0,V.W)("forcedExtension")],Z.prototype,"_forcedExtension",void 0),(0,e.e)([(0,V.W)("extensions")],Z.prototype,"_extensions",void 0),(0,e.e)([(0,V.A)("textureMatrix")],Z.prototype,"_textureMatrix",void 0),(0,e.e)([(0,V.A)("textureMatrixRefraction")],Z.prototype,"_textureMatrixRefraction",void 0),L.e._CubeTextureParser=Z.Parse,(0,B.i)("BABYLON.CubeTexture",Z)},14029:(b,n,i)=>{"use strict";i.d(n,{b:()=>L});var e=i(11621),V=i(11748),Q=i(11740),U=i(11898),Y=i(11706);U.ThinEngine.prototype.createDynamicTexture=function(b,n,i,e){const V=new Y.e(this,4);return V.baseWidth=b,V.baseHeight=n,i&&(b=this.needPOTTextures?(0,Q.d)(b,this._caps.maxTextureSize):b,n=this.needPOTTextures?(0,Q.d)(n,this._caps.maxTextureSize):n),V.width=b,V.height=n,V.isReady=!1,V.generateMipMaps=i,V.samplingMode=e,this.updateTextureSamplingMode(e,V),this._internalTexturesCache.push(V),V},U.ThinEngine.prototype.updateDynamicTexture=function(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!b)return;const U=this._gl,Y=U.TEXTURE_2D,L=this._bindTextureDirectly(Y,b,!0,Q);this._unpackFlipY(void 0===i?b.invertY:i),e&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const B=this._getWebGLTextureType(b.type),mb=this._getInternalFormat(V||b.format),N=this._getRGBABufferInternalSizedFormat(b.type,mb);U.texImage2D(Y,0,N,mb,B,n),b.generateMipMaps&&U.generateMipmap(Y),L||this._bindTextureDirectly(Y,null),e&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),V&&(b.format=V),b._dynamicTextureSource=n,b._premulAlpha=e,b.invertY=i||!1,b.isReady=!0};class L extends V.e{constructor(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,Y=arguments.length>6?arguments[6]:void 0;const L=!i||i._isScene;super(null,L?i:null===i||void 0===i?void 0:i.dn,L?!e:i,Y,Q,void 0,void 0,void 0,void 0,U),this.name=b,this.wrapU=V.e.CLAMP_ADDRESSMODE,this.wrapV=V.e.CLAMP_ADDRESSMODE,this._generateMipMaps=e;const B=this._getEngine();if(!B)return;if(n.getContext)this._canvas=n,this._ownCanvas=!1,this._texture=B.createDynamicTexture(this._canvas.width,this._canvas.height,e,Q);else{this._canvas=B.createCanvas(1,1),this._ownCanvas=!0;const b=n;b.width||0===b.width?this._texture=B.createDynamicTexture(b.width,b.height,e,Q):this._texture=B.createDynamicTexture(n,n,e,Q)}const mb=this.getSize();this._canvas.width!==mb.width&&(this._canvas.width=mb.width),this._canvas.height!==mb.height&&(this._canvas.height=mb.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(b){this._canvas.width=b.width,this._canvas.height=b.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(b.width,b.height,this._generateMipMaps,this.samplingMode)}scale(b){const n=this.getSize();n.width*=b,n.height*=b,this._recreate(n)}scaleTo(b,n){const i=this.getSize();i.width=b,i.height=n,this._recreate(i)}getContext(){return this._context}clear(b){const n=this.getSize();b&&(this._context.fillStyle=b),this._context.clearRect(0,0,n.width,n.height)}update(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===b||b,n,this._format||void 0,void 0,i)}drawText(b,n,i,e,V,Q,U){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const L=this.getSize();if(Q&&(this._context.fillStyle=Q,this._context.fillRect(0,0,L.width,L.height)),this._context.font=e,null===n||void 0===n){const i=this._context.measureText(b);n=(L.width-i.width)/2}if(null===i||void 0===i){const b=parseInt(e.replace(/\D/g,""));i=L.height/2+b/3.65}this._context.fillStyle=V||"",this._context.fillText(b,n,i),Y&&this.update(U)}dispose(){var b,n;(super.dispose(),this._ownCanvas)&&(null===(b=this._canvas)||void 0===b||null===(n=b.remove)||void 0===n||n.call(b));this._canvas=null,this._context=null}clone(){const b=this.ab();if(!b)return this;const n=this.getSize(),i=new L(this.name,n,b,this._generateMipMaps);return i.se=this.se,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const b=this.ab();b&&!b.isReady()&&e.b.Warn("The scene must be ready before serializing the dynamic texture");const n=super.serialize();return L._IsCanvasElement(this._canvas)&&(n.base64String=this._canvas.toDataURL()),n.invertY=this._invertY,n.samplingMode=this.samplingMode,n}static _IsCanvasElement(b){return void 0!==b.toDataURL}_rebuild(){this.update()}}},13403:(b,n,i)=>{"use strict";i.d(n,{e:()=>V});var e=i(11748);class V extends e.e{get depth(){return this._depth}constructor(b,n,i,V,Q,U){let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],L=arguments.length>7&&void 0!==arguments[7]&&arguments[7],B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:e.e.TRILINEAR_SAMPLINGMODE,mb=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10?arguments[10]:void 0;super(null,U,!Y,L),this.format=Q,this._texture=U.getEngine().createRawTexture2DArray(b,n,i,V,Q,Y,L,B,null,mb,N),this._depth=V,this.is2DArray=!0}update(b){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,b,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(b,n,i,e,Q){return new V(b,n,i,e,5,Q,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13203:(b,n,i)=>{"use strict";i.d(n,{d:()=>Y,e:()=>L,i:()=>Q,k:()=>U});var e=i(11796),V=i(11778);function Q(b,n){return`{X: ${b.x.toFixed(n)} Y: ${b.y.toFixed(n)}}`}function U(b,n){return`{X: ${b._x.toFixed(n)} Y: ${b._y.toFixed(n)} Z: ${b._z.toFixed(n)}}`}function Y(b,n){return 2*Math.acos((0,e.Clamp)(V.Quaternion.Dot(b,n)))}function L(b,n){const i=new V.Quaternion;return function(b,n,i){const Q=V.On.Cross(b,n),U=Math.acos((0,e.Clamp)(V.On.Dot(b,n),-1,1));V.Quaternion.RotationAxisToRef(Q,U,i)}(b,n,i),i}},13028:(b,n,i)=>{"use strict";i.d(n,{b:()=>B});var e=i(11778),V=i(11822),Q=i(12215),U=i(12198),Y=i(11829);i(13036);function L(b){let n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Q=[];let L=[];const B=b.width||b.size||1,mb=b.height||b.size||1,N=b.depth||b.size||1,Z=b.wrap||!1;let T=void 0===b.topBaseAt?1:b.topBaseAt,z=void 0===b.bottomBaseAt?0:b.bottomBaseAt;T=(T+4)%4,z=(z+4)%4;let K=[2,0,3,1][T],I=[2,0,1,3][z],O=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Z){n=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],O=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let b=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const e=[17,18,19,16],V=[22,23,20,21];for(;K>0;)b.unshift(b.pop()),e.unshift(e.pop()),K--;for(;I>0;)i.unshift(i.pop()),V.unshift(V.pop()),I--;b=b.flat(),i=i.flat(),O=O.concat(b).concat(i),n.push(e[0],e[2],e[3],e[0],e[1],e[2]),n.push(V[0],V[2],V[3],V[0],V[1],V[2])}const u=[B/2,mb/2,N/2];L=O.reduce(((b,n,i)=>b.concat(n*u[i%3])),[]);const d=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,G=b.faceUV||new Array(6),o=b.faceColors,M=[];for(let U=0;U<6;U++)void 0===G[U]&&(G[U]=new e.Vector4(0,0,1,1)),o&&void 0===o[U]&&(o[U]=new V.IV(1,1,1,1));for(let e=0;e<6;e++)if(Q.push(G[e].z,Y.e?1-G[e].w:G[e].w),Q.push(G[e].x,Y.e?1-G[e].w:G[e].w),Q.push(G[e].x,Y.e?1-G[e].y:G[e].y),Q.push(G[e].z,Y.e?1-G[e].y:G[e].y),o)for(let b=0;b<4;b++)M.push(o[e].r,o[e].g,o[e].b,o[e].a);U.d._ComputeSides(d,L,n,i,Q,b.frontUVs,b.backUVs);const j=new U.d;if(j.indices=n,j.xb=L,j.yb=i,j.Ab=Q,o){const b=d===U.d.DOUBLESIDE?M.concat(M):M;j.sb=b}return j}function B(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new Q.b(b,i);n.sideOrientation=Q.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return L(n).Cb(e,n.updatable),e}U.d.CreateBox=L,Q.b.CreateBox=function(b,n){return B(b,{size:n,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13193:(b,n,i)=>{"use strict";i.d(n,{e:()=>Y});var e=i(12215),V=i(12198),Q=i(11829);function U(b){const n=[],i=[],e=[],U=[],Y=b.radius||.5,L=b.tessellation||64,B=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,mb=0===b.sideOrientation?0:b.sideOrientation||V.d.DEFAULTSIDE;n.push(0,0,0),U.push(.5,.5);const N=2*Math.PI*B,Z=1===B?N/L:N/(L-1);let T=0;for(let V=0;V<L;V++){const b=Math.cos(T),i=Math.sin(T),e=(b+1)/2,V=(1-i)/2;n.push(Y*b,Y*i,0),U.push(e,Q.e?1-V:V),T+=Z}1===B&&(n.push(n[3],n[4],n[5]),U.push(U[2],Q.e?1-U[3]:U[3]));const z=n.length/3;for(let V=1;V<z-1;V++)i.push(V+1,0,V);V.d.ComputeNormals(n,i,e),V.d._ComputeSides(mb,n,i,e,U,b.frontUVs,b.backUVs);const K=new V.d;return K.indices=i,K.xb=n,K.yb=e,K.Ab=U,K}function Y(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new e.b(b,i);n.sideOrientation=e.b._GetDefaultSideOrientation(n.sideOrientation),V._originalBuilderSideOrientation=n.sideOrientation;return U(n).Cb(V,n.updatable),V}V.d.CreateDisc=U,e.b.CreateDisc=function(b,n,i){return Y(b,{radius:n,tessellation:i,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13036:(b,n,i)=>{"use strict";i.d(n,{g:()=>I,e:()=>u,i:()=>O});var e=i(11778),V=i(11822),Q=i(12215),U=i(12198),Y=i(11842);Q.b._GroundMeshParser=(b,n)=>L.Parse(b,n);class L extends Q.b{constructor(b,n){super(b,n),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=b,this._subdivisionsY=b,this.subdivide(b);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(n)}getHeightAtCoordinates(b,n){const i=this.getWorldMatrix(),V=e.TmpVectors.Matrix[5];i.invertToRef(V);const Q=e.TmpVectors.On[8];if(e.On.TransformCoordinatesFromFloatsToRef(b,0,n,V,Q),b=Q.x,n=Q.z,b<this._minX||b>=this._maxX||n<=this._minZ||n>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const U=this._getFacetAt(b,n),Y=-(U.x*b+U.z*n+U.w)/U.y;return e.On.TransformCoordinatesFromFloatsToRef(0,Y,0,i,Q),Q.y}getNormalAtCoordinates(b,n){const i=new e.On(0,1,0);return this.getNormalAtCoordinatesToRef(b,n,i),i}getNormalAtCoordinatesToRef(b,n,i){const V=this.getWorldMatrix(),Q=e.TmpVectors.Matrix[5];V.invertToRef(Q);const U=e.TmpVectors.On[8];if(e.On.TransformCoordinatesFromFloatsToRef(b,0,n,Q,U),b=U.x,n=U.z,b<this._minX||b>this._maxX||n<this._minZ||n>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(b,n);return e.On.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,V,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(b,n){const i=Math.floor((b+this._maxX)*this._subdivisionsX/this._width),e=Math.floor(-(n+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),V=this._heightQuads[e*this._subdivisionsX+i];let Q;return Q=n<V.slope.x*b+V.slope.y?V.facet1:V.facet2,Q}_initHeightQuads(){const b=this._subdivisionsX,n=this._subdivisionsY;this._heightQuads=[];for(let i=0;i<n;i++)for(let n=0;n<b;n++){const V={slope:e.Vector2.Zero(),facet1:new e.Vector4(0,0,0,0),facet2:new e.Vector4(0,0,0,0)};this._heightQuads[i*b+n]=V}return this}_computeHeightQuads(){const b=this.getVerticesData(Y.g.PositionKind);if(!b)return this;const n=e.TmpVectors.On[3],i=e.TmpVectors.On[2],V=e.TmpVectors.On[1],Q=e.TmpVectors.On[0],U=e.TmpVectors.On[4],L=e.TmpVectors.On[5],B=e.TmpVectors.On[6],mb=e.TmpVectors.On[7],N=e.TmpVectors.On[8];let Z=0,T=0,z=0,K=0,I=0,O=0,u=0;const d=this._subdivisionsX,G=this._subdivisionsY;for(let Y=0;Y<G;Y++)for(let G=0;G<d;G++){Z=3*G,T=Y*(d+1)*3,z=(Y+1)*(d+1)*3,n.x=b[T+Z],n.y=b[T+Z+1],n.z=b[T+Z+2],i.x=b[T+Z+3],i.y=b[T+Z+4],i.z=b[T+Z+5],V.x=b[z+Z],V.y=b[z+Z+1],V.z=b[z+Z+2],Q.x=b[z+Z+3],Q.y=b[z+Z+4],Q.z=b[z+Z+5],K=(Q.z-n.z)/(Q.x-n.x),I=n.z-K*n.x,i.subtractToRef(n,U),V.subtractToRef(n,L),Q.subtractToRef(n,B),e.On.CrossToRef(B,L,mb),e.On.CrossToRef(U,B,N),mb.normalize(),N.normalize(),O=-(mb.x*n.x+mb.y*n.y+mb.z*n.z),u=-(N.x*i.x+N.y*i.y+N.z*i.z);const o=this._heightQuads[Y*d+G];o.slope.re(K,I),o.facet1.re(mb.x,mb.y,mb.z,O),o.facet2.re(N.x,N.y,N.z,u)}return this}serialize(b){super.serialize(b),b.subdivisionsX=this._subdivisionsX,b.subdivisionsY=this._subdivisionsY,b.minX=this._minX,b.maxX=this._maxX,b.Ae=this._minZ,b.maxZ=this._maxZ,b.width=this._width,b.height=this._height}static Parse(b,n){const i=new L(b.name,n);return i._subdivisionsX=b.subdivisionsX||1,i._subdivisionsY=b.subdivisionsY||1,i._minX=b.minX,i._maxX=b.maxX,i._minZ=b.Ae,i._maxZ=b.maxZ,i._width=b.width,i._height=b.height,i}}var B=i(11605),mb=i(11646),N=i(11786),Z=i(11829);function T(b){const n=[],i=[],V=[],Q=[];let Y,L;const B=b.width||b.size||1,mb=b.height||b.size||1,N=0|(b.subdivisionsX||b.subdivisions||1),T=0|(b.subdivisionsY||b.subdivisions||1);for(Y=0;Y<=T;Y++)for(L=0;L<=N;L++){const b=new e.On(L*B/N-B/2,0,(T-Y)*mb/T-mb/2),n=new e.On(0,1,0);i.push(b.x,b.y,b.z),V.push(n.x,n.y,n.z),Q.push(L/N,Z.e?Y/T:1-Y/T)}for(Y=0;Y<T;Y++)for(L=0;L<N;L++)n.push(L+1+(Y+1)*(N+1)),n.push(L+1+Y*(N+1)),n.push(L+Y*(N+1)),n.push(L+(Y+1)*(N+1)),n.push(L+1+(Y+1)*(N+1)),n.push(L+Y*(N+1));const z=new U.d;return z.indices=n,z.xb=i,z.yb=V,z.Ab=Q,z}function z(b){const n=void 0!==b.xmin&&null!==b.xmin?b.xmin:-1,i=void 0!==b.zmin&&null!==b.zmin?b.zmin:-1,V=void 0!==b.xmax&&null!==b.xmax?b.xmax:1,Q=void 0!==b.zmax&&null!==b.zmax?b.zmax:1,Y=b.subdivisions||{w:1,h:1},L=b.precision||{w:1,h:1},B=[],mb=[],N=[],Z=[];let T,z,K,I;Y.h=Y.h<1?1:Y.h,Y.w=Y.w<1?1:Y.w,L.w=L.w<1?1:L.w,L.h=L.h<1?1:L.h;const O=(V-n)/Y.w,u=(Q-i)/Y.h;function d(b,n,i,V){const Q=mb.length/3,U=L.w+1;for(T=0;T<L.h;T++)for(z=0;z<L.w;z++){const b=[Q+z+T*U,Q+(z+1)+T*U,Q+(z+1)+(T+1)*U,Q+z+(T+1)*U];B.push(b[1]),B.push(b[2]),B.push(b[3]),B.push(b[0]),B.push(b[1]),B.push(b[3])}const Y=e.On.Zero(),K=new e.On(0,1,0);for(T=0;T<=L.h;T++)for(Y.z=T*(V-n)/L.h+n,z=0;z<=L.w;z++)Y.x=z*(i-b)/L.w+b,Y.y=0,mb.push(Y.x,Y.y,Y.z),N.push(K.x,K.y,K.z),Z.push(z/L.w,T/L.h)}for(K=0;K<Y.h;K++)for(I=0;I<Y.w;I++)d(n+I*O,i+K*u,n+(I+1)*O,i+(K+1)*u);const G=new U.d;return G.indices=B,G.xb=mb,G.yb=N,G.Ab=Z,G}function K(b){const n=[],i=[],Q=[],Y=[];let L,B;const mb=b.colorFilter||new V.Mn(.3,.59,.11),Z=b.alphaFilter||0;let T=!1;if(b.minHeight>b.maxHeight){T=!0;const n=b.maxHeight;b.maxHeight=b.minHeight,b.minHeight=n}for(L=0;L<=b.subdivisions;L++)for(B=0;B<=b.subdivisions;B++){const n=new e.On(B*b.width/b.subdivisions-b.width/2,0,(b.subdivisions-L)*b.height/b.subdivisions-b.height/2),V=4*(((n.x+b.width/2)/b.width*(b.bufferWidth-1)|0)+((1-(n.z+b.height/2)/b.height)*(b.bufferHeight-1)|0)*b.bufferWidth);let U=b.buffer[V]/255,z=b.buffer[V+1]/255,K=b.buffer[V+2]/255;const I=b.buffer[V+3]/255;T&&(U=1-U,z=1-z,K=1-K);const O=U*mb.r+z*mb.g+K*mb.b;n.y=I>=Z?b.minHeight+(b.maxHeight-b.minHeight)*O:b.minHeight-N.c,b.heightBuffer&&(b.heightBuffer[L*(b.subdivisions+1)+B]=n.y),i.push(n.x,n.y,n.z),Q.push(0,0,0),Y.push(B/b.subdivisions,1-L/b.subdivisions)}for(L=0;L<b.subdivisions;L++)for(B=0;B<b.subdivisions;B++){const e=B+1+(L+1)*(b.subdivisions+1),V=B+1+L*(b.subdivisions+1),Q=B+L*(b.subdivisions+1),U=B+(L+1)*(b.subdivisions+1),Y=i[3*e+1]>=b.minHeight,mb=i[3*V+1]>=b.minHeight,N=i[3*Q+1]>=b.minHeight;Y&&mb&&N&&(n.push(e),n.push(V),n.push(Q));i[3*U+1]>=b.minHeight&&Y&&N&&(n.push(U),n.push(e),n.push(Q))}U.d.ComputeNormals(i,n,Q);const z=new U.d;return z.indices=n,z.xb=i,z.yb=Q,z.Ab=Y,z}function I(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new L(b,arguments.length>2?arguments[2]:void 0);i._setReady(!1),i._subdivisionsX=n.subdivisionsX||n.subdivisions||1,i._subdivisionsY=n.subdivisionsY||n.subdivisions||1,i._width=n.width||1,i._height=n.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ;return T(n).Cb(i,n.updatable),i._setReady(!0),i}function O(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new Q.b(b,i);return z(n).Cb(e,n.updatable),e}function u(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=i.width||10,U=i.height||10,Y=i.subdivisions||1,N=i.minHeight||0,Z=i.maxHeight||1,T=i.colorFilter||new V.Mn(.3,.59,.11),z=i.alphaFilter||0,I=i.updatable,O=i.onReady;e=e||mb.d.LastCreatedScene;const u=new L(b,e);let d;u._subdivisionsX=Y,u._subdivisionsY=Y,u._width=Q,u._height=U,u._maxX=u._width/2,u._maxZ=u._height/2,u._minX=-u._maxX,u._minZ=-u._maxZ,u._setReady(!1),i.passHeightBufferInCallback&&(d=new Float32Array((Y+1)*(Y+1)));const G=(b,n,i)=>{K({width:Q,height:U,subdivisions:Y,minHeight:N,maxHeight:Z,colorFilter:T,buffer:b,bufferWidth:n,bufferHeight:i,alphaFilter:z,heightBuffer:d}).Cb(u,I),O&&O(u,d),u._setReady(!0)};if("string"===typeof n){const b=b=>{var n;const i=b.width,V=b.height;if(e.N)return;const Q=null===(n=e)||void 0===n?void 0:n.getEngine().resizeImageBitmap(b,i,V);G(Q,i,V)};B.Tools.LoadImage(n,b,i.onError?i.onError:()=>{},e.offlineProvider)}else G(n.data,n.width,n.height);return u}U.d.CreateGround=T,U.d.CreateTiledGround=z,U.d.CreateGroundFromHeightMap=K,Q.b.CreateGround=(b,n,i,e,V,Q)=>I(b,{width:n,height:i,subdivisions:e,updatable:Q},V),Q.b.CreateTiledGround=(b,n,i,e,V,Q,U,Y,L)=>O(b,{xmin:n,zmin:i,xmax:e,zmax:V,subdivisions:Q,precision:U,updatable:L},Y),Q.b.CreateGroundFromHeightMap=(b,n,i,e,V,Q,U,Y,L,B,mb)=>u(b,n,{width:i,height:e,subdivisions:V,minHeight:Q,maxHeight:U,updatable:L,onReady:B,alphaFilter:mb},Y)},13717:(b,n,i)=>{"use strict";i.d(n,{b:()=>T,c:()=>N,d:()=>Z});var e=i(11778),V=i(12215),Q=i(12198),U=i(12325),Y=i(11842),L=i(11621);function B(b){const n=[],i=[],e=b.lines,V=b.sb,U=[];let Y=0;for(let Q=0;Q<e.length;Q++){const b=e[Q];for(let e=0;e<b.length;e++){const{x:L,y:B,z:mb}=b[e];if(i.push(L,B,mb),V){const b=V[Q],{r:n,g:i,b:Y,a:L}=b[e];U.push(n,i,Y,L)}e>0&&(n.push(Y-1),n.push(Y)),Y++}}const L=new Q.d;return L.indices=n,L.xb=i,V&&(L.sb=U),L}function mb(b){const n=b.dashSize||3,i=b.gapSize||1,V=b.dashNb||200,U=b.points,Y=[],L=[],B=e.On.Zero();let mb=0,N=0,Z=0,T=0,z=0,K=0,I=0;for(I=0;I<U.length-1;I++)U[I+1].subtractToRef(U[I],B),mb+=B.length();for(Z=mb/V,T=n*Z/(n+i),I=0;I<U.length-1;I++){U[I+1].subtractToRef(U[I],B),N=Math.floor(B.length()/Z),B.normalize();for(let b=0;b<N;b++)z=Z*b,Y.push(U[I].x+z*B.x,U[I].y+z*B.y,U[I].z+z*B.z),Y.push(U[I].x+(z+T)*B.x,U[I].y+(z+T)*B.y,U[I].z+(z+T)*B.z),L.push(K,K+1),K+=2}const O=new Q.d;return O.xb=Y,O.indices=L,O}function N(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=n.instance,V=n.lines,Q=n.sb;if(e){const b=e.getVerticesData(Y.g.PositionKind);let n,i;Q&&(n=e.getVerticesData(Y.g.ColorKind));let U=0,L=0;for(let e=0;e<V.length;e++){const Y=V[e];for(let V=0;V<Y.length;V++)b[U]=Y[V].x,b[U+1]=Y[V].y,b[U+2]=Y[V].z,Q&&n&&(i=Q[e],n[L]=i[V].r,n[L+1]=i[V].g,n[L+2]=i[V].b,n[L+3]=i[V].a,L+=4),U+=3}return e.updateVerticesData(Y.g.PositionKind,b,!1,!1),Q&&n&&e.updateVerticesData(Y.g.ColorKind,n,!1,!1),e.refreshBoundingInfo(),e}const L=!!Q,mb=new U.b(b,i,null,void 0,void 0,L,n.useVertexAlpha,n.material);return B(n).Cb(mb,n.updatable),mb}function Z(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=n.sb?[n.sb]:null;return N(b,{lines:[n.points],updatable:n.updatable,instance:n.instance,sb:e,useVertexAlpha:n.useVertexAlpha,material:n.material},i)}function T(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=n.points,Y=n.instance,B=n.gapSize||1,N=n.dashSize||3;if(Y){const b=b=>{const n=e.On.Zero(),i=b.length/6;let V=0,U=0,L=0,B=0,mb=0,N=0,Z=0,T=0;for(Z=0;Z<Q.length-1;Z++)Q[Z+1].subtractToRef(Q[Z],n),V+=n.length();L=V/i;const z=Y._creationDataStorage.dashSize;for(B=z*L/(z+Y._creationDataStorage.gapSize),Z=0;Z<Q.length-1;Z++)for(Q[Z+1].subtractToRef(Q[Z],n),U=Math.floor(n.length()/L),n.normalize(),T=0;T<U&&N<b.length;)mb=L*T,b[N]=Q[Z].x+mb*n.x,b[N+1]=Q[Z].y+mb*n.y,b[N+2]=Q[Z].z+mb*n.z,b[N+3]=Q[Z].x+(mb+B)*n.x,b[N+4]=Q[Z].y+(mb+B)*n.y,b[N+5]=Q[Z].z+(mb+B)*n.z,N+=6,T++;for(;N<b.length;)b[N]=Q[Z].x,b[N+1]=Q[Z].y,b[N+2]=Q[Z].z,N+=3};return(n.dashNb||n.dashSize||n.gapSize||n.useVertexAlpha||n.material)&&L.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),Y.updateMeshPositions(b,!1),Y}const Z=new U.b(b,i,null,void 0,void 0,void 0,n.useVertexAlpha,n.material);return mb(n).Cb(Z,n.updatable),Z._creationDataStorage=new V.e,Z._creationDataStorage.dashSize=N,Z._creationDataStorage.gapSize=B,Z}Q.d.CreateLineSystem=B,Q.d.CreateDashedLines=mb,V.b.NB=function(b,n){return Z(b,{points:n,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},V.b.CreateDashedLines=function(b,n,i,e,V){return T(b,{points:n,dashSize:i,gapSize:e,dashNb:V,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13081:(b,n,i)=>{"use strict";i.d(n,{c:()=>Y,f:()=>L});var e=i(12215),V=i(12198),Q=i(11829);function U(b){const n=[],i=[],e=[],U=[],Y=void 0!==b.width?b.width:void 0!==b.size?b.size:1,L=void 0!==b.height?b.height:void 0!==b.size?b.size:1,B=0===b.sideOrientation?0:b.sideOrientation||V.d.DEFAULTSIDE,mb=Y/2,N=L/2;i.push(-mb,-N,0),e.push(0,0,-1),U.push(0,Q.e?1:0),i.push(mb,-N,0),e.push(0,0,-1),U.push(1,Q.e?1:0),i.push(mb,N,0),e.push(0,0,-1),U.push(1,Q.e?0:1),i.push(-mb,N,0),e.push(0,0,-1),U.push(0,Q.e?0:1),n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),V.d._ComputeSides(B,i,n,e,U,b.frontUVs,b.backUVs);const Z=new V.d;return Z.indices=n,Z.xb=i,Z.yb=e,Z.Ab=U,Z}function Y(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new e.b(b,i);n.sideOrientation=e.b._GetDefaultSideOrientation(n.sideOrientation),V._originalBuilderSideOrientation=n.sideOrientation;return U(n).Cb(V,n.updatable),n.sourcePlane&&(V.translate(n.sourcePlane.normal,-n.sourcePlane.d),V.setDirection(n.sourcePlane.normal.scale(-1))),V}const L={zB:Y};V.d.zB=U,e.b.zB=(b,n,i,e,V)=>Y(b,{size:n,width:n,height:n,sideOrientation:V,updatable:e},i)},13179:(b,n,i)=>{"use strict";i.d(n,{b:()=>L});var e=i(11778),V=i(12215),Q=i(12198),U=i(11829);function Y(b){const n=0|(b.segments||32),i=b.diameterX||b.diameter||1,V=b.diameterY||b.diameter||1,Y=b.diameterZ||b.diameter||1,L=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,B=b.slice&&b.slice<=0?1:b.slice||1,mb=0===b.sideOrientation?0:b.sideOrientation||Q.d.DEFAULTSIDE,N=!!b.dedupTopBottomIndices,Z=new e.On(i/2,V/2,Y/2),T=2+n,z=2*T,K=[],I=[],O=[],u=[];for(let Q=0;Q<=T;Q++){const b=Q/T,n=b*Math.PI*B;for(let i=0;i<=z;i++){const V=i/z,Q=V*Math.PI*2*L,Y=e.Matrix.RotationZ(-n),B=e.Matrix.RotationY(Q),mb=e.On.TransformCoordinates(e.On.Up(),Y),N=e.On.TransformCoordinates(mb,B),T=N.multiply(Z),K=N.divide(Z).normalize();I.push(T.x,T.y,T.z),O.push(K.x,K.y,K.z),u.push(V,U.e?1-b:b)}if(Q>0){const b=I.length/3;for(let n=b-2*(z+1);n+z+2<b;n++)N?(Q>1&&(K.push(n),K.push(n+1),K.push(n+z+1)),(Q<T||B<1)&&(K.push(n+z+1),K.push(n+1),K.push(n+z+2))):(K.push(n),K.push(n+1),K.push(n+z+1),K.push(n+z+1),K.push(n+1),K.push(n+z+2))}}Q.d._ComputeSides(mb,I,K,O,u,b.frontUVs,b.backUVs);const d=new Q.d;return d.indices=K,d.xb=I,d.yb=O,d.Ab=u,d}function L(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return Y(n).Cb(e,n.updatable),e}Q.d.CreateSphere=Y,V.b.CreateSphere=(b,n,i,e,V,Q)=>L(b,{segments:n,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:Q,updatable:V},e)},14037:(b,n,i)=>{"use strict";i.d(n,{d:()=>Y});var e=i(12351),V=i(13492),Q=i(12370),U=i(12198);class Y{static get Configuration(){return{get decoder(){return V.b.DefaultConfiguration},set decoder(b){V.b.DefaultConfiguration=b}}}static set Configuration(b){V.b.DefaultConfiguration=b.decoder}static get DecoderAvailable(){return(0,e.g)(V.b.DefaultConfiguration)}static get Default(){return Y._Default??(Y._Default=new Y),Y._Default}static ResetDefault(b){Y._Default&&(b||Y._Default.dispose(),Y._Default=null)}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.DefaultNumWorkers;const n="number"===typeof b?{...V.b.DefaultConfiguration,numWorkers:b}:{...V.b.DefaultConfiguration,...b};this._decoder=new V.b(n)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(b,n,i){return this._decoder.decodeMeshToMeshDataAsync(b,n,i)}async decodeMeshToGeometryAsync(b,n,i,e){return await this._decoder.decodeMeshToGeometryAsync(b,n,i,e)}async _decodeMeshToGeometryForGltfAsync(b,n,i,e,V,Q){return await this._decoder._decodeMeshToGeometryForGltfAsync(b,n,i,e,V,Q)}async decodeMeshAsync(b,n){const i=await this._decoder.decodeMeshToMeshDataAsync(b,n),e=new U.d;i.indices&&(e.indices=i.indices);for(const V of i.attributes){const b=Q.d.GetFloatData(V.data,V.size,Q.d.GetDataType(V.data),V.byteOffset,V.byteStride,V.normalized,i.totalVertices);e.set(b,V.kind)}return e}}Y.DefaultNumWorkers=(0,e.e)(),Y._Default=null},13492:(b,n,i)=>{"use strict";i.d(n,{b:()=>B});var e=i(12351),V=i(11605),Q=i(12225),U=i(12370),Y=i(11621),L=i(12364);class B extends e.d{static get DefaultAvailable(){return(0,e.g)(B.DefaultConfiguration)}static get Default(){return B._Default??(B._Default=new B),B._Default}static ResetDefault(b){B._Default&&(b||B._Default.dispose(),B._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(b,n){return{module:await(n||DracoDecoderModule)({wasmBinary:b})}}_getWorkerContent(){return`${L.c}(${L.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.DefaultConfiguration)}decodeMeshToMeshDataAsync(b,n,i){const e=b instanceof ArrayBuffer?new Int8Array(b):new Int8Array(b.buffer,b.byteOffset,b.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async b=>await new Promise(((V,Q)=>{b.push(((b,U)=>{let L=null;const B=[],mb=n=>{b.removeEventListener("error",mb),b.removeEventListener("message",N),Q(n),U()},N=n=>{const e=n.data;switch(e.id){case"indices":L=e.data;break;case"attribute":B.push({kind:e.kind,data:e.data,size:e.size,byteOffset:e.byteOffset,byteStride:e.byteStride,normalized:(Q=e.kind,Z=e.normalized,i&&void 0!==i[Q]?(Z!==i[Q]&&Y.b.Warn(`Normalized flag from Draco data (${Z}) does not match normalized flag from glTF accessor (${i[Q]}). Using flag from glTF accessor.`),i[Q]):Z)});break;case"decodeMeshDone":b.removeEventListener("error",mb),b.removeEventListener("message",N),V({indices:L,attributes:B,totalVertices:e.totalVertices}),U()}var Q,Z};b.addEventListener("error",mb),b.addEventListener("message",N);const Z=e.slice();b.postMessage({id:"decodeMesh",dataView:Z,attributes:n},[Z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((b=>{let i=null;const V=[],Q=(0,L.c)(b.module,e,n,(b=>{i=b}),((b,n,i,e,Q,U)=>{V.push({kind:b,data:n,size:i,byteOffset:e,byteStride:Q,normalized:U})}));return{indices:i,attributes:V,totalVertices:Q}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(b,n,i,e){const V=await this.decodeMeshToMeshDataAsync(i,e),Y=new Q.c(b,n);V.indices&&Y.setIndices(V.indices);for(const Q of V.attributes)Y.setVerticesBuffer(new U.d(n.getEngine(),Q.data,Q.kind,!1,void 0,Q.byteStride,void 0,Q.byteOffset,Q.size,void 0,Q.normalized,!0),V.totalVertices);return Y}async _decodeMeshToGeometryForGltfAsync(b,n,i,e,V,Y){const L=await this.decodeMeshToMeshDataAsync(i,e,V),B=new Q.c(b,n);Y&&(B._boundingInfo=Y,B.useBoundingInfoFromGeometry=!0),L.indices&&B.setIndices(L.indices);for(const Q of L.attributes)B.setVerticesBuffer(new U.d(n.getEngine(),Q.data,Q.kind,!1,void 0,Q.byteStride,void 0,Q.byteOffset,Q.size,void 0,Q.normalized,!0),L.totalVertices);return B}}B.DefaultConfiguration={wasmUrl:`${V.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${V.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${V.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},B._Default=null},13714:(b,n,i)=>{"use strict";i.d(n,{d:()=>Yb});var e=i(11778),V=i(12215),Q=i(11842),U=i(12198),Y=i(11829);function L(b){let n=b.pathArray;const i=b.closeArray||!1,e=b.closePath||!1,V=b.invertUV||!1,L=Math.floor(n[0].length/2);let B=b.offset||L;B=B>L?L:Math.floor(B);const mb=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,N=b.Ab,Z=b.sb,T=[],z=[],K=[],I=[],O=[],u=[],d=[],G=[];let o;const M=[],j=[];let a,D,x;if(n.length<2){const b=[],i=[];for(D=0;D<n[0].length-B;D++)b.push(n[0][D]),i.push(n[0][D+B]);n=[b,i]}let y=0;const s=e?1:0,A=i?1:0;let E,C,t,w,h,W;for(o=n[0].length,a=0;a<n.length+A;a++){for(d[a]=0,O[a]=[0],E=a===n.length?n[0]:n[a],C=E.length,o=o<C?o:C,x=0;x<C;)T.push(E[x].x,E[x].y,E[x].z),x>0&&(t=E[x].un(E[x-1]).length(),w=t+d[a],O[a].push(w),d[a]=w),x++;e&&(x--,T.push(E[0].x,E[0].y,E[0].z),t=E[x].un(E[0]).length(),w=t+d[a],O[a].push(w),d[a]=w),M[a]=C+s,j[a]=y,y+=C+s}let J,R,k=null,r=null;for(D=0;D<o+s;D++)for(G[D]=0,u[D]=[0],a=0;a<n.length-1+A;a++)h=n[a],W=a===n.length-1?n[0]:n[a+1],D===o?(k=h[0],r=W[0]):(k=h[D],r=W[D]),t=r.un(k).length(),w=t+G[D],u[D].push(w),G[D]=w;if(N)for(a=0;a<N.length;a++)I.push(N[a].x,Y.e?1-N[a].y:N[a].y);else for(a=0;a<n.length+A;a++)for(D=0;D<o+s;D++)J=0!=d[a]?O[a][D]/d[a]:0,R=0!=G[D]?u[D][a]/G[D]:0,V?I.push(R,J):I.push(J,Y.e?1-R:R);a=0;let X=0,g=M[a]-1,P=M[a+1]-1,c=g<P?g:P,q=j[1]-j[0];const S=M.length-1;for(;X<=c&&a<S;)z.push(X,X+q,X+1),z.push(X+q+1,X+1,X+q),X+=1,X===c&&(a++,q=j[a+1]-j[a],g=M[a]-1,P=M[a+1]-1,X=j[a],c=g<P?g+X:P+X);if(U.d.ComputeNormals(T,z,K),e){let b=0,i=0;for(a=0;a<n.length;a++){b=3*j[a],i=a+1<n.length?3*(j[a+1]-1):K.length-3,K[b]=.5*(K[b]+K[i]),K[b+1]=.5*(K[b+1]+K[i+1]),K[b+2]=.5*(K[b+2]+K[i+2]);const e=Math.sqrt(K[b]*K[b]+K[b+1]*K[b+1]+K[b+2]*K[b+2]);K[b]/=e,K[b+1]/=e,K[b+2]/=e,K[i]=K[b],K[i+1]=K[b+1],K[i+2]=K[b+2]}}if(i){let b=3*j[0],i=3*j[n.length];for(D=0;D<o+s;D++){K[b]=.5*(K[b]+K[i]),K[b+1]=.5*(K[b+1]+K[i+1]),K[b+2]=.5*(K[b+2]+K[i+2]);const n=Math.sqrt(K[b]*K[b]+K[b+1]*K[b+1]+K[b+2]*K[b+2]);K[b]/=n,K[b+1]/=n,K[b+2]/=n,K[i]=K[b],K[i+1]=K[b+1],K[i+2]=K[b+2],b+=3,i+=3}}U.d._ComputeSides(mb,T,z,K,I,b.frontUVs,b.backUVs);let H=null;if(Z){H=new Float32Array(4*Z.length);for(let b=0;b<Z.length;b++)H[4*b]=Z[b].r,H[4*b+1]=Z[b].g,H[4*b+2]=Z[b].b,H[4*b+3]=Z[b].a}const l=new U.d,v=new Float32Array(T),p=new Float32Array(K),f=new Float32Array(I);return l.indices=z,l.xb=v,l.yb=p,l.Ab=f,H&&l.set(H,Q.g.ColorKind),e&&(l._idx=j),l}function B(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=n.pathArray,mb=n.closeArray,N=n.closePath,Z=V.b._GetDefaultSideOrientation(n.sideOrientation),T=n.instance,z=n.updatable;if(T){const b=e.TmpVectors.On[0].Fe(Number.MAX_VALUE),i=e.TmpVectors.On[1].Fe(-Number.MAX_VALUE),L=n=>{let e=B[0].length;const Q=T;let U=0;const Y=Q._originalBuilderSideOrientation===V.b.DOUBLESIDE?2:1;for(let V=1;V<=Y;++V)for(let Y=0;Y<B.length;++Y){const V=B[Y],L=V.length;e=e<L?e:L;for(let Q=0;Q<e;++Q){const e=V[Q];n[U]=e.x,n[U+1]=e.y,n[U+2]=e.z,b.minimizeInPlaceFromFloats(e.x,e.y,e.z),i.maximizeInPlaceFromFloats(e.x,e.y,e.z),U+=3}if(Q._creationDataStorage&&Q._creationDataStorage.closePath){const b=V[0];n[U]=b.x,n[U+1]=b.y,n[U+2]=b.z,U+=3}}},mb=T.getVerticesData(Q.g.PositionKind);if(L(mb),T.hasBoundingInfo?T.getBoundingInfo().reConstruct(b,i,T._worldMatrix):T.buildBoundingInfo(b,i,T._worldMatrix),T.updateVerticesData(Q.g.PositionKind,mb,!1,!1),n.sb){const b=T.getVerticesData(Q.g.ColorKind);for(let i=0,e=0;i<n.sb.length;i++,e+=4){const V=n.sb[i];b[e]=V.r,b[e+1]=V.g,b[e+2]=V.b,b[e+3]=V.a}T.updateVerticesData(Q.g.ColorKind,b,!1,!1)}if(n.Ab){const b=T.getVerticesData(Q.g.UVKind);for(let i=0;i<n.Ab.length;i++)b[2*i]=n.Ab[i].x,b[2*i+1]=Y.e?1-n.Ab[i].y:n.Ab[i].y;T.updateVerticesData(Q.g.UVKind,b,!1,!1)}if(!T.areNormalsFrozen||T.isFacetDataEnabled){const b=T.Je(),n=T.getVerticesData(Q.g.NormalKind),i=T.isFacetDataEnabled?T.getFacetDataParameters():null;if(U.d.ComputeNormals(mb,b,n,i),T._creationDataStorage&&T._creationDataStorage.closePath){let b=0,i=0;for(let e=0;e<B.length;e++)b=3*T._creationDataStorage.idx[e],i=e+1<B.length?3*(T._creationDataStorage.idx[e+1]-1):n.length-3,n[b]=.5*(n[b]+n[i]),n[b+1]=.5*(n[b+1]+n[i+1]),n[b+2]=.5*(n[b+2]+n[i+2]),n[i]=n[b],n[i+1]=n[b+1],n[i+2]=n[b+2]}T.areNormalsFrozen||T.updateVerticesData(Q.g.NormalKind,n,!1,!1)}return T}{const e=new V.b(b,i);e._originalBuilderSideOrientation=Z,e._creationDataStorage=new V.e;const Q=L(n);return N&&(e._creationDataStorage.idx=Q._idx),e._creationDataStorage.closePath=N,e._creationDataStorage.closeArray=mb,Q.Cb(e,z),e}}U.d.CreateRibbon=L,V.b.CreateRibbon=function(b,n){return B(b,{pathArray:n,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var mb=i(13193),N=i(13028),Z=i(11822);function T(b){const n=b.pattern||V.b.NO_FLIP,i=b.tileWidth||b.tileSize||1,e=b.tileHeight||b.tileSize||1,Q=b.alignHorizontal||0,Y=b.alignVertical||0,L=b.width||b.size||1,B=Math.floor(L/i);let mb=L-B*i;const N=b.height||b.size||1,Z=Math.floor(N/e);let T=N-Z*e;const z=i*B/2,K=e*Z/2;let I=0,O=0,u=0,d=0,G=0,o=0;if(mb>0||T>0){switch(u=-z,d=-K,G=z,o=K,Q){case V.b.CENTER:mb/=2,u-=mb,G+=mb;break;case V.b.LEFT:G+=mb,I=-mb/2;break;case V.b.RIGHT:u-=mb,I=mb/2}switch(Y){case V.b.CENTER:T/=2,d-=T,o+=T;break;case V.b.BOTTOM:o+=T,O=-T/2;break;case V.b.TOP:d-=T,O=T/2}}const M=[],j=[],a=[];a[0]=[0,0,1,0,1,1,0,1],a[1]=[0,0,1,0,1,1,0,1],n!==V.b.ROTATE_TILE&&n!==V.b.ROTATE_ROW||(a[1]=[1,1,0,1,0,0,1,0]),n!==V.b.FLIP_TILE&&n!==V.b.FLIP_ROW||(a[1]=[1,0,0,0,0,1,1,1]),n!==V.b.FLIP_N_ROTATE_TILE&&n!==V.b.FLIP_N_ROTATE_ROW||(a[1]=[0,1,1,1,1,0,0,0]);let D=[];const x=[],y=[];let s=0;for(let U=0;U<Z;U++)for(let b=0;b<B;b++)M.push(b*i-z+I,U*e-K+O,0),M.push((b+1)*i-z+I,U*e-K+O,0),M.push((b+1)*i-z+I,(U+1)*e-K+O,0),M.push(b*i-z+I,(U+1)*e-K+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),D=n===V.b.FLIP_TILE||n===V.b.ROTATE_TILE||n===V.b.FLIP_N_ROTATE_TILE?D.concat(a[(b%2+U%2)%2]):n===V.b.FLIP_ROW||n===V.b.ROTATE_ROW||n===V.b.FLIP_N_ROTATE_ROW?D.concat(a[U%2]):D.concat(a[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),s+=4;if(mb>0||T>0){const b=T>0&&(Y===V.b.CENTER||Y===V.b.TOP),U=T>0&&(Y===V.b.CENTER||Y===V.b.BOTTOM),L=mb>0&&(Q===V.b.CENTER||Q===V.b.RIGHT),N=mb>0&&(Q===V.b.CENTER||Q===V.b.LEFT);let a,A,E,C,t=[];if(b&&L&&(M.push(u+I,d+O,0),M.push(-z+I,d+O,0),M.push(-z+I,d+T+O,0),M.push(u+I,d+T+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=1-mb/i,A=1-T/e,E=1,C=1,t=[a,A,E,A,E,C,a,C],n===V.b.ROTATE_ROW&&(t=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),n===V.b.FLIP_ROW&&(t=[1-a,A,1-E,A,1-E,C,1-a,C]),n===V.b.FLIP_N_ROTATE_ROW&&(t=[a,1-A,E,1-A,E,1-C,a,1-C]),D=D.concat(t),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&N&&(M.push(z+I,d+O,0),M.push(G+I,d+O,0),M.push(G+I,d+T+O,0),M.push(z+I,d+T+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=0,A=1-T/e,E=mb/i,C=1,t=[a,A,E,A,E,C,a,C],(n===V.b.ROTATE_ROW||n===V.b.ROTATE_TILE&&B%2===0)&&(t=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),(n===V.b.FLIP_ROW||n===V.b.FLIP_TILE&&B%2===0)&&(t=[1-a,A,1-E,A,1-E,C,1-a,C]),(n===V.b.FLIP_N_ROTATE_ROW||n===V.b.FLIP_N_ROTATE_TILE&&B%2===0)&&(t=[a,1-A,E,1-A,E,1-C,a,1-C]),D=D.concat(t),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&L&&(M.push(u+I,K+O,0),M.push(-z+I,K+O,0),M.push(-z+I,o+O,0),M.push(u+I,o+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=1-mb/i,A=0,E=1,C=T/e,t=[a,A,E,A,E,C,a,C],(n===V.b.ROTATE_ROW&&Z%2===1||n===V.b.ROTATE_TILE&&Z%1===0)&&(t=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),(n===V.b.FLIP_ROW&&Z%2===1||n===V.b.FLIP_TILE&&Z%2===0)&&(t=[1-a,A,1-E,A,1-E,C,1-a,C]),(n===V.b.FLIP_N_ROTATE_ROW&&Z%2===1||n===V.b.FLIP_N_ROTATE_TILE&&Z%2===0)&&(t=[a,1-A,E,1-A,E,1-C,a,1-C]),D=D.concat(t),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&N&&(M.push(z+I,K+O,0),M.push(G+I,K+O,0),M.push(G+I,o+O,0),M.push(z+I,o+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=0,A=0,E=mb/i,C=T/e,t=[a,A,E,A,E,C,a,C],(n===V.b.ROTATE_ROW&&Z%2===1||n===V.b.ROTATE_TILE&&(Z+B)%2===1)&&(t=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),(n===V.b.FLIP_ROW&&Z%2===1||n===V.b.FLIP_TILE&&(Z+B)%2===1)&&(t=[1-a,A,1-E,A,1-E,C,1-a,C]),(n===V.b.FLIP_N_ROTATE_ROW&&Z%2===1||n===V.b.FLIP_N_ROTATE_TILE&&(Z+B)%2===1)&&(t=[a,1-A,E,1-A,E,1-C,a,1-C]),D=D.concat(t),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b){const b=[];a=0,A=1-T/e,E=1,C=1,b[0]=[a,A,E,A,E,C,a,C],b[1]=[a,A,E,A,E,C,a,C],n!==V.b.ROTATE_TILE&&n!==V.b.ROTATE_ROW||(b[1]=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),n!==V.b.FLIP_TILE&&n!==V.b.FLIP_ROW||(b[1]=[1-a,A,1-E,A,1-E,C,1-a,C]),n!==V.b.FLIP_N_ROTATE_TILE&&n!==V.b.FLIP_N_ROTATE_ROW||(b[1]=[a,1-A,E,1-A,E,1-C,a,1-C]);for(let e=0;e<B;e++)M.push(e*i-z+I,d+O,0),M.push((e+1)*i-z+I,d+O,0),M.push((e+1)*i-z+I,d+T+O,0),M.push(e*i-z+I,d+T+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,D=n===V.b.FLIP_TILE||n===V.b.ROTATE_TILE||n===V.b.FLIP_N_ROTATE_TILE?D.concat(b[(e+1)%2]):n===V.b.FLIP_ROW||n===V.b.ROTATE_ROW||n===V.b.FLIP_N_ROTATE_ROW?D.concat(b[1]):D.concat(b[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const b=[];a=0,A=0,E=1,C=T/e,b[0]=[a,A,E,A,E,C,a,C],b[1]=[a,A,E,A,E,C,a,C],n!==V.b.ROTATE_TILE&&n!==V.b.ROTATE_ROW||(b[1]=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),n!==V.b.FLIP_TILE&&n!==V.b.FLIP_ROW||(b[1]=[1-a,A,1-E,A,1-E,C,1-a,C]),n!==V.b.FLIP_N_ROTATE_TILE&&n!==V.b.FLIP_N_ROTATE_ROW||(b[1]=[a,1-A,E,1-A,E,1-C,a,1-C]);for(let e=0;e<B;e++)M.push(e*i-z+I,o-T+O,0),M.push((e+1)*i-z+I,o-T+O,0),M.push((e+1)*i-z+I,o+O,0),M.push(e*i-z+I,o+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,D=n===V.b.FLIP_TILE||n===V.b.ROTATE_TILE||n===V.b.FLIP_N_ROTATE_TILE?D.concat(b[(e+Z)%2]):n===V.b.FLIP_ROW||n===V.b.ROTATE_ROW||n===V.b.FLIP_N_ROTATE_ROW?D.concat(b[Z%2]):D.concat(b[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const b=[];a=1-mb/i,A=0,E=1,C=1,b[0]=[a,A,E,A,E,C,a,C],b[1]=[a,A,E,A,E,C,a,C],n!==V.b.ROTATE_TILE&&n!==V.b.ROTATE_ROW||(b[1]=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),n!==V.b.FLIP_TILE&&n!==V.b.FLIP_ROW||(b[1]=[1-a,A,1-E,A,1-E,C,1-a,C]),n!==V.b.FLIP_N_ROTATE_TILE&&n!==V.b.FLIP_N_ROTATE_ROW||(b[1]=[a,1-A,E,1-A,E,1-C,a,1-C]);for(let i=0;i<Z;i++)M.push(u+I,i*e-K+O,0),M.push(u+mb+I,i*e-K+O,0),M.push(u+mb+I,(i+1)*e-K+O,0),M.push(u+I,(i+1)*e-K+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,D=n===V.b.FLIP_TILE||n===V.b.ROTATE_TILE||n===V.b.FLIP_N_ROTATE_TILE?D.concat(b[(i+1)%2]):n===V.b.FLIP_ROW||n===V.b.ROTATE_ROW||n===V.b.FLIP_N_ROTATE_ROW?D.concat(b[i%2]):D.concat(b[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(N){const b=[];a=0,A=0,E=mb/e,C=1,b[0]=[a,A,E,A,E,C,a,C],b[1]=[a,A,E,A,E,C,a,C],n!==V.b.ROTATE_TILE&&n!==V.b.ROTATE_ROW||(b[1]=[1-a,1-A,1-E,1-A,1-E,1-C,1-a,1-C]),n!==V.b.FLIP_TILE&&n!==V.b.FLIP_ROW||(b[1]=[1-a,A,1-E,A,1-E,C,1-a,C]),n!==V.b.FLIP_N_ROTATE_TILE&&n!==V.b.FLIP_N_ROTATE_ROW||(b[1]=[a,1-A,E,1-A,E,1-C,a,1-C]);for(let i=0;i<Z;i++)M.push(G-mb+I,i*e-K+O,0),M.push(G+I,i*e-K+O,0),M.push(G+I,(i+1)*e-K+O,0),M.push(G-mb+I,(i+1)*e-K+O,0),y.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,D=n===V.b.FLIP_TILE||n===V.b.ROTATE_TILE||n===V.b.FLIP_N_ROTATE_TILE?D.concat(b[(i+B)%2]):n===V.b.FLIP_ROW||n===V.b.ROTATE_ROW||n===V.b.FLIP_N_ROTATE_ROW?D.concat(b[i%2]):D.concat(b[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),j.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const A=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE;U.d._ComputeSides(A,M,y,j,D,b.frontUVs,b.backUVs);const E=new U.d;E.indices=y,E.xb=M,E.yb=j,E.Ab=D;const C=A===U.d.DOUBLESIDE?x.concat(x):x;return E.sb=C,E}function z(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return T(n).Cb(e,n.updatable),e}function K(b){const n=b.faceUV||new Array(6),i=b.faceColors,Q=b.pattern||V.b.NO_FLIP,L=b.width||b.size||1,B=b.height||b.size||1,mb=b.depth||b.size||1,N=b.tileWidth||b.tileSize||1,z=b.tileHeight||b.tileSize||1,K=b.alignHorizontal||0,I=b.alignVertical||0,O=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE;for(let V=0;V<6;V++)void 0===n[V]&&(n[V]=new e.Vector4(0,0,1,1)),i&&void 0===i[V]&&(i[V]=new Z.IV(1,1,1,1));const u=L/2,d=B/2,G=mb/2,o=[];for(let e=0;e<2;e++)o[e]=T({pattern:Q,tileWidth:N,tileHeight:z,width:L,height:B,alignVertical:I,alignHorizontal:K,sideOrientation:O});for(let e=2;e<4;e++)o[e]=T({pattern:Q,tileWidth:N,tileHeight:z,width:mb,height:B,alignVertical:I,alignHorizontal:K,sideOrientation:O});let M=I;I===V.b.BOTTOM?M=V.b.TOP:I===V.b.TOP&&(M=V.b.BOTTOM);for(let e=4;e<6;e++)o[e]=T({pattern:Q,tileWidth:N,tileHeight:z,width:L,height:mb,alignVertical:M,alignHorizontal:K,sideOrientation:O});let j=[],a=[],D=[],x=[];const y=[],s=[],A=[],E=[];let C=0,t=0;for(let V=0;V<6;V++){const b=o[V].xb.length;s[V]=[],A[V]=[];for(let n=0;n<b/3;n++)s[V].push(new e.On(o[V].xb[3*n],o[V].xb[3*n+1],o[V].xb[3*n+2])),A[V].push(new e.On(o[V].yb[3*n],o[V].yb[3*n+1],o[V].yb[3*n+2]));C=o[V].Ab.length,E[V]=[];for(let i=0;i<C;i+=2)E[V][i]=n[V].x+(n[V].z-n[V].x)*o[V].Ab[i],E[V][i+1]=n[V].y+(n[V].w-n[V].y)*o[V].Ab[i+1],Y.e&&(E[V][i+1]=1-E[V][i+1]);if(D=D.concat(E[V]),x=x.concat(o[V].indices.map((b=>b+t))),t+=s[V].length,i)for(let n=0;n<4;n++)y.push(i[V].r,i[V].g,i[V].b,i[V].a)}const w=new e.On(0,0,G),h=e.Matrix.RotationY(Math.PI);j=s[0].map((b=>e.On.TransformNormal(b,h).add(w))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[]),a=A[0].map((b=>e.On.TransformNormal(b,h))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[]),j=j.concat(s[1].map((b=>b.un(w))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[])),a=a.concat(A[1].map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[]));const W=new e.On(u,0,0),J=e.Matrix.RotationY(-Math.PI/2);j=j.concat(s[2].map((b=>e.On.TransformNormal(b,J).add(W))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[])),a=a.concat(A[2].map((b=>e.On.TransformNormal(b,J))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[]));const R=e.Matrix.RotationY(Math.PI/2);j=j.concat(s[3].map((b=>e.On.TransformNormal(b,R).un(W))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[])),a=a.concat(A[3].map((b=>e.On.TransformNormal(b,R))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[]));const k=new e.On(0,d,0),r=e.Matrix.RotationX(Math.PI/2);j=j.concat(s[4].map((b=>e.On.TransformNormal(b,r).add(k))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[])),a=a.concat(A[4].map((b=>e.On.TransformNormal(b,r))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[]));const X=e.Matrix.RotationX(-Math.PI/2);j=j.concat(s[5].map((b=>e.On.TransformNormal(b,X).un(k))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[])),a=a.concat(A[5].map((b=>e.On.TransformNormal(b,X))).map((b=>[b.x,b.y,b.z])).reduce(((b,n)=>b.concat(n)),[])),U.d._ComputeSides(O,j,x,a,D);const g=new U.d;if(g.indices=x,g.xb=j,g.yb=a,g.Ab=D,i){const b=O===U.d.DOUBLESIDE?y.concat(y):y;g.sb=b}return g}function I(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return K(n).Cb(e,n.updatable),e}U.d.CreateTiledPlane=T;U.d.CreateTiledBox=K;var O=i(13179),u=i(12005),d=i(11972);function G(b){const n=b.height||2;let i=0===b.diameterTop?0:b.diameterTop||b.diameter||1,Q=0===b.diameterBottom?0:b.diameterBottom||b.diameter||1;i=i||1e-5,Q=Q||1e-5;const L=0|(b.tessellation||24),B=0|(b.subdivisions||1),mb=!!b.hasRings,N=!!b.enclose,T=0===b.cap?0:b.cap||V.b.CAP_ALL,z=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,K=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,I=b.faceUV||new Array(3),O=b.faceColors,u=2+(1+(1!==z&&N?2:0))*(mb?B:1);let G;for(G=0;G<u;G++)O&&void 0===O[G]&&(O[G]=new Z.IV(1,1,1,1));for(G=0;G<u;G++)I&&void 0===I[G]&&(I[G]=new e.Vector4(0,0,1,1));const o=[],M=[],j=[],a=[],D=[],x=2*Math.PI*z/L;let y,s,A;const E=(Q-i)/2/n,C=e.On.Zero(),t=e.On.Zero(),w=e.On.Zero(),h=e.On.Zero(),W=e.On.Zero(),J=d.c.Y;let R,k,r,X=1,g=1,P=0,c=0;for(R=0;R<=B;R++)for(s=R/B,A=(s*(i-Q)+Q)/2,X=mb&&0!==R&&R!==B?2:1,r=0;r<X;r++){for(mb&&(g+=r),N&&(g+=2*r),k=0;k<=L;k++)y=k*x,C.x=Math.cos(-y)*A,C.y=-n/2+s*n,C.z=Math.sin(-y)*A,0===i&&R===B?(t.x=j[j.length-3*(L+1)],t.y=j[j.length-3*(L+1)+1],t.z=j[j.length-3*(L+1)+2]):(t.x=C.x,t.z=C.z,t.y=Math.sqrt(t.x*t.x+t.z*t.z)*E,t.normalize()),0===k&&(w.L(C),h.L(t)),M.push(C.x,C.y,C.z),j.push(t.x,t.y,t.z),c=mb?P!==g?I[g].y:I[g].w:I[g].y+(I[g].w-I[g].y)*s,a.push(I[g].x+(I[g].z-I[g].x)*k/L,Y.e?1-c:c),O&&D.push(O[g].r,O[g].g,O[g].b,O[g].a);1!==z&&N&&(M.push(C.x,C.y,C.z),M.push(0,C.y,0),M.push(0,C.y,0),M.push(w.x,w.y,w.z),e.On.CrossToRef(J,t,W),W.normalize(),j.push(W.x,W.y,W.z,W.x,W.y,W.z),e.On.CrossToRef(h,J,W),W.normalize(),j.push(W.x,W.y,W.z,W.x,W.y,W.z),c=mb?P!==g?I[g+1].y:I[g+1].w:I[g+1].y+(I[g+1].w-I[g+1].y)*s,a.push(I[g+1].x,Y.e?1-c:c),a.push(I[g+1].z,Y.e?1-c:c),c=mb?P!==g?I[g+2].y:I[g+2].w:I[g+2].y+(I[g+2].w-I[g+2].y)*s,a.push(I[g+2].x,Y.e?1-c:c),a.push(I[g+2].z,Y.e?1-c:c),O&&(D.push(O[g+1].r,O[g+1].g,O[g+1].b,O[g+1].a),D.push(O[g+1].r,O[g+1].g,O[g+1].b,O[g+1].a),D.push(O[g+2].r,O[g+2].g,O[g+2].b,O[g+2].a),D.push(O[g+2].r,O[g+2].g,O[g+2].b,O[g+2].a))),P!==g&&(P=g)}const q=1!==z&&N?L+4:L;for(R=0,g=0;g<B;g++){let b=0,n=0,i=0,e=0;for(k=0;k<L;k++)b=R*(q+1)+k,n=(R+1)*(q+1)+k,i=R*(q+1)+(k+1),e=(R+1)*(q+1)+(k+1),o.push(b,n,i),o.push(e,i,n);1!==z&&N&&(o.push(b+2,n+2,i+2),o.push(e+2,i+2,n+2),o.push(b+4,n+4,i+4),o.push(e+4,i+4,n+4)),R=mb?R+2:R+1}const S=b=>{const V=b?i/2:Q/2;if(0===V)return;let U,B,mb;const N=b?I[u-1]:I[0];let Z=null;O&&(Z=b?O[u-1]:O[0]);const T=M.length/3,K=b?n/2:-n/2,d=new e.On(0,K,0);M.push(d.x,d.y,d.z),j.push(0,b?1:-1,0);const G=N.y+.5*(N.w-N.y);a.push(N.x+.5*(N.z-N.x),Y.e?1-G:G),Z&&D.push(Z.r,Z.g,Z.b,Z.a);const x=new e.Vector2(.5,.5);for(mb=0;mb<=L;mb++){U=2*Math.PI*mb*z/L;const n=Math.cos(-U),i=Math.sin(-U);B=new e.On(n*V,K,i*V);const Q=new e.Vector2(n*x.x+.5,i*x.y+.5);M.push(B.x,B.y,B.z),j.push(0,b?1:-1,0);const T=N.y+(N.w-N.y)*Q.y;a.push(N.x+(N.z-N.x)*Q.x,Y.e?1-T:T),Z&&D.push(Z.r,Z.g,Z.b,Z.a)}for(mb=0;mb<L;mb++)b?(o.push(T),o.push(T+(mb+2)),o.push(T+(mb+1))):(o.push(T),o.push(T+(mb+1)),o.push(T+(mb+2)))};T!==V.b.CAP_START&&T!==V.b.CAP_ALL||S(!1),T!==V.b.CAP_END&&T!==V.b.CAP_ALL||S(!0),U.d._ComputeSides(K,M,o,j,a,b.frontUVs,b.backUVs);const H=new U.d;return H.indices=o,H.xb=M,H.yb=j,H.Ab=a,O&&(H.sb=D),H}function o(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return G(n).Cb(e,n.updatable),e}function M(b){const n=[],i=[],V=[],Q=[],L=b.diameter||1,B=b.thickness||.5,mb=0|(b.tessellation||16),N=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,Z=mb+1;for(let U=0;U<=mb;U++){const b=U/mb,N=U*Math.PI*2/mb-Math.PI/2,T=e.Matrix.Translation(L/2,0,0).multiply(e.Matrix.RotationY(N));for(let L=0;L<=mb;L++){const N=1-L/mb,z=L*Math.PI*2/mb+Math.PI,K=Math.cos(z),I=Math.sin(z);let O=new e.On(K,I,0),u=O.scale(B/2);const d=new e.Vector2(b,N);u=e.On.TransformCoordinates(u,T),O=e.On.TransformNormal(O,T),i.push(u.x,u.y,u.z),V.push(O.x,O.y,O.z),Q.push(d.x,Y.e?1-d.y:d.y);const G=(U+1)%Z,o=(L+1)%Z;n.push(U*Z+L),n.push(U*Z+o),n.push(G*Z+L),n.push(U*Z+o),n.push(G*Z+o),n.push(G*Z+L)}}U.d._ComputeSides(N,i,n,V,Q,b.frontUVs,b.backUVs);const T=new U.d;return T.indices=n,T.xb=i,T.yb=V,T.Ab=Q,T}function j(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return M(n).Cb(e,n.updatable),e}U.d.CreateCylinder=G,V.b.CreateCylinder=(b,n,i,e,Q,U,Y,L,B)=>{void 0!==Y&&Y instanceof u.b||(void 0!==Y&&(B=L||V.b.DEFAULTSIDE,L=Y),Y=U,U=1);return o(b,{height:n,diameterTop:i,diameterBottom:e,tessellation:Q,subdivisions:U,sideOrientation:B,updatable:L},Y)};function a(b){const n=[],i=[],V=[],Q=[],L=b.radius||2,B=b.tube||.5,mb=b.radialSegments||32,N=b.tubularSegments||32,Z=b.p||2,T=b.q||3,z=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,K=b=>{const n=Math.cos(b),i=Math.sin(b),V=T/Z*b,Q=Math.cos(V),U=L*(2+Q)*.5*n,Y=L*(2+Q)*i*.5,B=L*Math.sin(V)*.5;return new e.On(U,Y,B)};let I,O;for(I=0;I<=mb;I++){const b=I%mb/mb*2*Z*Math.PI,n=K(b),V=K(b+.01),U=V.un(n);let L=V.add(n);const T=e.On.Cross(U,L);for(L=e.On.Cross(T,U),T.normalize(),L.normalize(),O=0;O<N;O++){const b=O%N/N*2*Math.PI,e=-B*Math.cos(b),V=B*Math.sin(b);i.push(n.x+e*L.x+V*T.x),i.push(n.y+e*L.y+V*T.y),i.push(n.z+e*L.z+V*T.z),Q.push(I/mb),Q.push(Y.e?1-O/N:O/N)}}for(I=0;I<mb;I++)for(O=0;O<N;O++){const b=(O+1)%N,i=I*N+O,e=(I+1)*N+O,V=(I+1)*N+b,Q=I*N+b;n.push(Q),n.push(e),n.push(i),n.push(Q),n.push(V),n.push(e)}U.d.ComputeNormals(i,n,V),U.d._ComputeSides(z,i,n,V,Q,b.frontUVs,b.backUVs);const u=new U.d;return u.indices=n,u.xb=i,u.yb=V,u.Ab=Q,u}function D(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return a(n).Cb(e,n.updatable),e}U.d.CreateTorus=M,V.b.CreateTorus=(b,n,i,e,V,Q,U)=>j(b,{diameter:n,thickness:i,tessellation:e,sideOrientation:U,updatable:Q},V);U.d.CreateTorusKnot=a,V.b.CreateTorusKnot=(b,n,i,e,V,Q,U,Y,L,B)=>D(b,{radius:n,tube:i,radialSegments:e,tubularSegments:V,p:Q,q:U,sideOrientation:B,updatable:L},Y);var x=i(13717),y=i(12339),s=i(11978);function A(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=n.path,Q=n.shape,U=n.scale||1,Y=n.rotation||0,L=0===n.cap?0:n.cap||V.b.NO_CAP,B=n.updatable,mb=V.b._GetDefaultSideOrientation(n.sideOrientation),N=n.instance||null,Z=n.invertUV||!1,T=n.closeShape||!1,z=n.closePath||!1,K=n.capFunction||null;return C(b,Q,e,U,Y,null,null,z,T,L,!1,i,!!B,mb,N,Z,n.frontUVs||null,n.backUVs||null,n.firstNormal||null,!!n.adjustFrame,K)}function E(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=n.path,Q=n.shape,U=n.scaleFunction||(()=>1),Y=n.rotationFunction||(()=>0),L=n.closePath||n.ribbonCloseArray||!1,B=n.closeShape||n.ribbonClosePath||!1,mb=0===n.cap?0:n.cap||V.b.NO_CAP,N=n.updatable,Z=n.firstNormal||null,T=n.adjustFrame||!1,z=V.b._GetDefaultSideOrientation(n.sideOrientation),K=n.instance,I=n.invertUV||!1,O=n.capFunction||null;return C(b,Q,e,null,null,U,Y,L,B,mb,!0,i,!!N,z,K||null,I,n.frontUVs||null,n.backUVs||null,Z,T,O||null)}function C(b,n,i,Q,U,Y,L,mb,N,Z,T,z,K,I,O,u,d,G,o,M,j){const a=(b,n,i,Q,U,Y,L,B,mb,N,Z)=>{const T=i.getTangents(),z=i.getNormals(),K=i.getBinormals(),I=i.getDistances();if(Z)for(let V=0;V<T.length;V++)if(0==T[V].x&&0==T[V].y&&0==T[V].z&&T[V].L(T[V-1]),0==z[V].x&&0==z[V].y&&0==z[V].z&&z[V].L(z[V-1]),0==K[V].x&&0==K[V].y&&0==K[V].z&&K[V].L(K[V-1]),V>0){let b=T[V-1];e.On.Dot(b,T[V])<0&&T[V].scaleInPlace(-1),b=z[V-1],e.On.Dot(b,z[V])<0&&z[V].scaleInPlace(-1),b=K[V-1],e.On.Dot(b,K[V])<0&&K[V].scaleInPlace(-1)}let O=0;const u=N&&B?B:()=>null!==Y?Y:0,d=N&&L?L:()=>null!==U?U:1;let G=mb===V.b.NO_CAP||mb===V.b.CAP_END?0:2;const o=e.TmpVectors.Matrix[0];for(let V=0;V<n.length;V++){const i=[],U=u(V,I[V]),Y=d(V,I[V]);e.Matrix.RotationAxisToRef(T[V],O,o);for(let Q=0;Q<b.length;Q++){const U=T[V].scale(b[Q].z).add(z[V].scale(b[Q].x)).add(K[V].scale(b[Q].y)),L=e.On.Zero();e.On.TransformCoordinatesToRef(U,o,L),L.scaleInPlace(Y).addInPlace(n[V]),i[Q]=L}Q[G]=i,O+=U,G++}const M=j||(b=>{const n=Array(),i=e.On.Zero();let V;for(V=0;V<b.length;V++)i.addInPlace(b[V]);for(i.scaleInPlace(1/b.length),V=0;V<b.length;V++)n.push(i);return n});switch(mb){case V.b.NO_CAP:break;case V.b.CAP_START:Q[0]=M(Q[2]),Q[1]=Q[2];break;case V.b.CAP_END:Q[G]=Q[G-1],Q[G+1]=M(Q[G-1]);break;case V.b.CAP_ALL:Q[0]=M(Q[2]),Q[1]=Q[2],Q[G]=Q[G-1],Q[G+1]=M(Q[G-1])}return Q};let D,x;if(O){const b=O._creationDataStorage;return D=o?b.path3D.update(i,o):b.path3D.update(i),x=a(n,i,b.path3D,b.pathArray,Q,U,Y,L,b.cap,T,M),O=B("",{pathArray:x,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:O},z||void 0)}D=o?new s.m(i,o):new s.m(i);x=a(n,i,D,new Array,Q,U,Y,L,Z=Z<0||Z>3?0:Z,T,M);const y=B(b,{pathArray:x,closeArray:mb,closePath:N,updatable:K,sideOrientation:I,invertUV:u,frontUVs:d||void 0,backUVs:G||void 0},z);return y._creationDataStorage.pathArray=x,y._creationDataStorage.path3D=D,y._creationDataStorage.cap=Z,y}function t(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=n.arc?n.arc<=0||n.arc>1?1:n.arc:1,U=void 0===n.closed||n.closed,Y=n.shape,L=n.radius||1,mb=n.tessellation||64,N=n.clip||0,Z=n.updatable,T=V.b._GetDefaultSideOrientation(n.sideOrientation),z=n.cap||V.b.NO_CAP,K=2*Math.PI,I=[],O=n.invertUV||!1;let u=0,d=0;const G=K/mb*Q;let o,M;for(u=0;u<=mb-N;u++){for(M=[],z!=V.b.CAP_START&&z!=V.b.CAP_ALL||(M.push(new e.On(0,Y[0].y,0)),M.push(new e.On(Math.cos(u*G)*Y[0].x*L,Y[0].y,Math.sin(u*G)*Y[0].x*L))),d=0;d<Y.length;d++)o=new e.On(Math.cos(u*G)*Y[d].x*L,Y[d].y,Math.sin(u*G)*Y[d].x*L),M.push(o);z!=V.b.CAP_END&&z!=V.b.CAP_ALL||(M.push(new e.On(Math.cos(u*G)*Y[Y.length-1].x*L,Y[Y.length-1].y,Math.sin(u*G)*Y[Y.length-1].x*L)),M.push(new e.On(0,Y[Y.length-1].y,0))),I.push(M)}return B(b,{pathArray:I,closeArray:U,sideOrientation:T,updatable:Z,invertUV:O,frontUVs:n.frontUVs,backUVs:n.backUVs},i)}V.b.ExtrudeShape=function(b,n,i,e,Q,U){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0,mb=arguments.length>9?arguments[9]:void 0;return A(b,{shape:n,path:i,scale:e,rotation:Q,cap:0===U?0:U||V.b.NO_CAP,sideOrientation:B,instance:mb,updatable:L},Y)},V.b.ExtrudeShapeCustom=(b,n,i,e,Q,U,Y,L,B,mb,N,Z)=>E(b,{shape:n,path:i,scaleFunction:e,rotationFunction:Q,ribbonCloseArray:U,ribbonClosePath:Y,cap:0===L?0:L||V.b.NO_CAP,sideOrientation:N,instance:Z,updatable:mb},B);V.b.CreateLathe=(b,n,i,e,V,Q,U)=>t(b,{shape:n,radius:i,tessellation:e,sideOrientation:U,updatable:Q},V);var w=i(13081),h=i(13036);function W(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=n.path;let U=n.instance,Y=1;void 0!==n.radius?Y=n.radius:U&&(Y=U._creationDataStorage.radius);const L=n.tessellation||64,mb=n.radiusFunction||null;let N=n.cap||V.b.NO_CAP;const Z=n.invertUV||!1,T=n.updatable,z=V.b._GetDefaultSideOrientation(n.sideOrientation);n.arc=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1;const K=(b,n,i,Q,U,Y,L,B)=>{const mb=n.getTangents(),N=n.getNormals(),Z=n.getDistances(),T=2*Math.PI/U*B,z=Y||(()=>Q);let K,I,O,u;const d=e.TmpVectors.Matrix[0];let G=L===V.b.NO_CAP||L===V.b.CAP_END?0:2;for(let V=0;V<b.length;V++){I=z(V,Z[V]),K=Array(),O=N[V];for(let n=0;n<U;n++)e.Matrix.RotationAxisToRef(mb[V],T*n,d),u=K[n]?K[n]:e.On.Zero(),e.On.TransformCoordinatesToRef(O,d,u),u.scaleInPlace(I).addInPlace(b[V]),K[n]=u;i[G]=K,G++}const o=(n,i)=>{const e=Array();for(let V=0;V<n;V++)e.push(b[i]);return e};switch(L){case V.b.NO_CAP:break;case V.b.CAP_START:i[0]=o(U,0),i[1]=i[2].slice(0);break;case V.b.CAP_END:i[G]=i[G-1].slice(0),i[G+1]=o(U,b.length-1);break;case V.b.CAP_ALL:i[0]=o(U,0),i[1]=i[2].slice(0),i[G]=i[G-1].slice(0),i[G+1]=o(U,b.length-1)}return i};let I,O;if(U){const b=U._creationDataStorage,i=n.arc||b.arc;return I=b.path3D.update(Q),O=K(Q,I,b.pathArray,Y,b.tessellation,mb,b.cap,i),U=B("",{pathArray:O,instance:U}),b.path3D=I,b.pathArray=O,b.arc=i,b.radius=Y,U}I=new s.m(Q);N=N<0||N>3?0:N,O=K(Q,I,new Array,Y,L,mb,N,n.arc);const u=B(b,{pathArray:O,closePath:!0,closeArray:!1,updatable:T,sideOrientation:z,invertUV:Z,frontUVs:n.frontUVs,backUVs:n.backUVs},i);return u._creationDataStorage.pathArray=O,u._creationDataStorage.path3D=I,u._creationDataStorage.tessellation=L,u._creationDataStorage.cap=N,u._creationDataStorage.arc=n.arc,u._creationDataStorage.radius=Y,u}function J(b){const n=[];n[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},n[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},n[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},n[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},n[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},n[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},n[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},n[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},n[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},n[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},n[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},n[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},n[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},n[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},n[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=b.type&&(b.type<0||b.type>=n.length)?0:b.type||0,V=b.size,Q=b.sizeX||V||1,L=b.sizeY||V||1,B=b.sizeZ||V||1,mb=b.custom||n[i],N=mb.face.length,T=b.faceUV||new Array(N),z=b.faceColors,K=void 0===b.flat||b.flat,I=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,O=[],u=[],d=[],G=[],o=[];let M=0,j=0;const a=[];let D,x,y,s,A,E,C=0,t=0;if(K)for(t=0;t<N;t++)z&&void 0===z[t]&&(z[t]=new Z.IV(1,1,1,1)),T&&void 0===T[t]&&(T[t]=new e.Vector4(0,0,1,1));if(K)for(t=0;t<N;t++){const b=mb.face[t].length;for(y=2*Math.PI/b,s=.5*Math.tan(y/2),A=.5,C=0;C<b;C++)O.push(mb.vertex[mb.face[t][C]][0]*Q,mb.vertex[mb.face[t][C]][1]*L,mb.vertex[mb.face[t][C]][2]*B),a.push(M),M++,D=T[t].x+(T[t].z-T[t].x)*(.5+s),x=T[t].y+(T[t].w-T[t].y)*(A-.5),G.push(D,Y.e?1-x:x),E=s*Math.cos(y)-A*Math.sin(y),A=s*Math.sin(y)+A*Math.cos(y),s=E,z&&o.push(z[t].r,z[t].g,z[t].b,z[t].a);for(C=0;C<b-2;C++)u.push(a[0+j],a[C+2+j],a[C+1+j]);j+=b}else{for(C=0;C<mb.vertex.length;C++)O.push(mb.vertex[C][0]*Q,mb.vertex[C][1]*L,mb.vertex[C][2]*B),G.push(0,Y.e?1:0);for(t=0;t<N;t++)for(C=0;C<mb.face[t].length-2;C++)u.push(mb.face[t][0],mb.face[t][C+2],mb.face[t][C+1])}U.d.ComputeNormals(O,u,d),U.d._ComputeSides(I,O,u,d,G,b.frontUVs,b.backUVs);const w=new U.d;return w.xb=O,w.indices=u,w.yb=d,w.Ab=G,z&&K&&(w.sb=o),w}function R(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return J(n).Cb(e,n.updatable),e}V.b.CreateTube=(b,n,i,e,V,Q,U,Y,L,B)=>W(b,{path:n,radius:i,tessellation:e,radiusFunction:V,arc:1,cap:Q,updatable:Y,sideOrientation:L,instance:B},U);function k(b){const n=b.sideOrientation||U.d.DEFAULTSIDE,i=b.radius||1,V=void 0===b.flat||b.flat,Q=0|(b.subdivisions||4),L=b.radiusX||i,B=b.radiusY||i,mb=b.radiusZ||i,N=(1+Math.sqrt(5))/2,Z=[-1,N,-0,1,N,0,-1,-N,0,1,-N,0,0,-1,-N,0,1,-N,0,-1,N,0,1,N,N,0,1,N,0,-1,-N,0,1,-N,0,-1],T=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],z=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],K=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],O=[],u=[],d=[],G=[];let o=0;const M=new Array(3),j=new Array(3);let a;for(a=0;a<3;a++)M[a]=e.On.Zero(),j[a]=e.Vector2.Zero();for(let U=0;U<20;U++){for(a=0;a<3;a++){const b=T[3*U+a];M[a].re(Z[3*z[b]],Z[3*z[b]+1],Z[3*z[b]+2]),M[a].normalize(),j[a].re(.134765625*K[2*b]+.05859375+-.0390625*I[U],.2333984375*K[2*b+1]+.025390625+.01953125*I[U])}const b=(b,n,i,U)=>{const N=e.On.Lerp(M[0],M[2],n/Q),Z=e.On.Lerp(M[1],M[2],n/Q),T=Q===n?M[2]:e.On.Lerp(N,Z,b/(Q-n));let z;if(T.normalize(),V){const b=e.On.Lerp(M[0],M[2],U/Q),n=e.On.Lerp(M[1],M[2],U/Q);z=e.On.Lerp(b,n,i/(Q-U))}else z=new e.On(T.x,T.y,T.z);z.x/=L,z.y/=B,z.z/=mb,z.normalize();const K=e.Vector2.Lerp(j[0],j[2],n/Q),I=e.Vector2.Lerp(j[1],j[2],n/Q),a=Q===n?j[2]:e.Vector2.Lerp(K,I,b/(Q-n));u.push(T.x*L,T.y*B,T.z*mb),d.push(z.x,z.y,z.z),G.push(a.x,Y.e?1-a.y:a.y),O.push(o),o++};for(let n=0;n<Q;n++)for(let i=0;i+n<Q;i++)b(i,n,i+1/3,n+1/3),b(i+1,n,i+1/3,n+1/3),b(i,n+1,i+1/3,n+1/3),i+n+1<Q&&(b(i+1,n,i+2/3,n+2/3),b(i+1,n+1,i+2/3,n+2/3),b(i,n+1,i+2/3,n+2/3))}U.d._ComputeSides(n,u,O,d,G,b.frontUVs,b.backUVs);const D=new U.d;return D.indices=O,D.xb=u,D.yb=d,D.Ab=G,D}function r(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new V.b(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),e._originalBuilderSideOrientation=n.sideOrientation;return k(n).Cb(e,n.updatable),e}U.d.CreatePolyhedron=J,V.b.CreatePolyhedron=(b,n,i)=>R(b,n,i);U.d.CreateIcoSphere=k,V.b.CreateIcoSphere=(b,n,i)=>r(b,n,i);var X=i(11796);const g=new e.On(1,0,0),P=new e.On(-1,0,0),c=new e.On(0,1,0),q=new e.On(0,-1,0),S=new e.On(0,0,1),H=new e.On(0,0,-1);class l{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.On.Zero(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.On.Up(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Vector2.Zero(),V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=b,this.normal=n,this.uv=i,this.vertexIdx=V,this.vertexIdxForBones=Q,this.localPositionOverride=U,this.localNormalOverride=Y,this.matrixIndicesOverride=L,this.matrixWeightsOverride=B}clone(){var b,n,i,e;return new l(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(b=this.localPositionOverride)||void 0===b?void 0:b.slice(),null===(n=this.localNormalOverride)||void 0===n?void 0:n.slice(),null===(i=this.matrixIndicesOverride)||void 0===i?void 0:i.slice(),null===(e=this.matrixWeightsOverride)||void 0===e?void 0:e.slice())}}function v(b,n,i){var L,B,mb,N,Z;const T=!!n.skeleton,z=!(null===(L=n.morphTargetManager)||void 0===L||!L.numTargets),K=i.localMode||T,I=n.Je(),O=T||z?n.AY(!0,!0):n.getVerticesData(Q.g.PositionKind),u=T||z?n.getNormalsData(!0,!0):n.getVerticesData(Q.g.NormalKind),d=K?T?n.getVerticesData(Q.g.PositionKind):O:null,G=K?T?n.getVerticesData(Q.g.NormalKind):u:null,o=n.getVerticesData(Q.g.UVKind),M=T?n.getVerticesData(Q.g.MatricesIndicesKind):null,j=T?n.getVerticesData(Q.g.MatricesWeightsKind):null,a=T?n.getVerticesData(Q.g.MatricesIndicesExtraKind):null,D=T?n.getVerticesData(Q.g.MatricesWeightsExtraKind):null,x=i.position||e.On.Zero();let y=i.normal||e.On.Up();const s=i.size||e.On.One(),A=i.angle||0;if(!y){const b=new e.On(0,0,1),i=n.ab().activeCamera,V=e.On.TransformCoordinates(b,i.getWorldMatrix());y=i.globalPosition.un(V)}const E=-Math.atan2(y.z,y.x)-Math.PI/2,C=Math.sqrt(y.x*y.x+y.z*y.z),t=Math.atan2(y.y,C),w=new U.d;w.indices=[],w.xb=[],w.yb=[],w.Ab=[],w.matricesIndices=T?[]:null,w.matricesWeights=T?[]:null,w.matricesIndicesExtra=a?[]:null,w.matricesWeightsExtra=D?[]:null;let h=0;const W=(b,n)=>{const V=new l;if(!I||!O||!u)return V;const Q=I[b];if(V.vertexIdx=3*Q,V.vertexIdxForBones=4*Q,V.position=new e.On(O[3*Q],O[3*Q+1],O[3*Q+2]),e.On.TransformCoordinatesToRef(V.position,n,V.position),V.normal=new e.On(u[3*Q],u[3*Q+1],u[3*Q+2]),e.On.TransformNormalToRef(V.normal,n,V.normal),i.captureUVS&&o){const b=o[2*Q+1];V.uv=new e.Vector2(o[2*Q],Y.e?1-b:b)}return V},J=[0,0,0,0],R=(b,n)=>{if(0===b.length)return b;const i=.5*Math.abs(e.On.Dot(s,n)),V=(b,n,i,e)=>{for(let V=0;V<e;++V)if(b[i+V]===n)return i+V;return-1},Q=(b,Q)=>{const U=e.On.GetClipFactor(b.position,Q.position,n,i);let Y=J,L=J;if(M&&j){const n=b.matrixIndicesOverride?0:b.vertexIdxForBones,i=b.matrixIndicesOverride??M,e=b.matrixWeightsOverride??j,B=Q.matrixIndicesOverride?0:Q.vertexIdxForBones,mb=Q.matrixIndicesOverride??M,N=Q.matrixWeightsOverride??j;Y=[0,0,0,0],L=[0,0,0,0];let Z=0;for(let b=0;b<4;++b)if(e[n+b]>0){const Q=V(mb,i[n+b],B,4);Y[Z]=i[n+b],L[Z]=(0,X.Lerp)(e[n+b],Q>=0?N[Q]:0,U),Z++}for(let b=0;b<4&&Z<4;++b){const e=mb[B+b];-1===V(i,e,n,4)&&(Y[Z]=e,L[Z]=(0,X.Lerp)(0,N[B+b],U),Z++)}const T=L[0]+L[1]+L[2]+L[3];L[0]/=T,L[1]/=T,L[2]/=T,L[3]/=T}const B=b.localPositionOverride?b.localPositionOverride[0]:(null===d||void 0===d?void 0:d[b.vertexIdx])??0,mb=b.localPositionOverride?b.localPositionOverride[1]:(null===d||void 0===d?void 0:d[b.vertexIdx+1])??0,N=b.localPositionOverride?b.localPositionOverride[2]:(null===d||void 0===d?void 0:d[b.vertexIdx+2])??0,Z=Q.localPositionOverride?Q.localPositionOverride[0]:(null===d||void 0===d?void 0:d[Q.vertexIdx])??0,T=Q.localPositionOverride?Q.localPositionOverride[1]:(null===d||void 0===d?void 0:d[Q.vertexIdx+1])??0,z=Q.localPositionOverride?Q.localPositionOverride[2]:(null===d||void 0===d?void 0:d[Q.vertexIdx+2])??0,K=b.localNormalOverride?b.localNormalOverride[0]:(null===G||void 0===G?void 0:G[b.vertexIdx])??0,I=b.localNormalOverride?b.localNormalOverride[1]:(null===G||void 0===G?void 0:G[b.vertexIdx+1])??0,O=b.localNormalOverride?b.localNormalOverride[2]:(null===G||void 0===G?void 0:G[b.vertexIdx+2])??0,u=K+((Q.localNormalOverride?Q.localNormalOverride[0]:(null===G||void 0===G?void 0:G[Q.vertexIdx])??0)-K)*U,o=I+((Q.localNormalOverride?Q.localNormalOverride[1]:(null===G||void 0===G?void 0:G[Q.vertexIdx+1])??0)-I)*U,a=O+((Q.localNormalOverride?Q.localNormalOverride[2]:(null===G||void 0===G?void 0:G[Q.vertexIdx+2])??0)-O)*U,D=Math.sqrt(u*u+o*o+a*a);return new l(e.On.Lerp(b.position,Q.position,U),e.On.Lerp(b.normal,Q.normal,U).normalize(),e.Vector2.Lerp(b.uv,Q.uv,U),-1,-1,d?[B+(Z-B)*U,mb+(T-mb)*U,N+(z-N)*U]:null,G?[u/D,o/D,a/D]:null,Y,L)};let U=null;b.length>3&&(U=[]);for(let Y=0;Y<b.length;Y+=3){let V=0,L=null,B=null,mb=null,N=null;const Z=e.On.Dot(b[Y].position,n)-i>0,T=e.On.Dot(b[Y+1].position,n)-i>0,z=e.On.Dot(b[Y+2].position,n)-i>0;switch(V=(Z?1:0)+(T?1:0)+(z?1:0),V){case 0:b.length>3?(U.push(b[Y]),U.push(b[Y+1]),U.push(b[Y+2])):U=b;break;case 1:if(U=U??new Array,Z&&(L=b[Y+1],B=b[Y+2],mb=Q(b[Y],L),N=Q(b[Y],B)),T){L=b[Y],B=b[Y+2],mb=Q(b[Y+1],L),N=Q(b[Y+1],B),U.push(mb),U.push(B.clone()),U.push(L.clone()),U.push(B.clone()),U.push(mb.clone()),U.push(N);break}z&&(L=b[Y],B=b[Y+1],mb=Q(b[Y+2],L),N=Q(b[Y+2],B)),L&&B&&mb&&N&&(U.push(L.clone()),U.push(B.clone()),U.push(mb),U.push(N),U.push(mb.clone()),U.push(B.clone()));break;case 2:U=U??new Array,Z||(L=b[Y].clone(),B=Q(L,b[Y+1]),mb=Q(L,b[Y+2]),U.push(L),U.push(B),U.push(mb)),T||(L=b[Y+1].clone(),B=Q(L,b[Y+2]),mb=Q(L,b[Y]),U.push(L),U.push(B),U.push(mb)),z||(L=b[Y+2].clone(),B=Q(L,b[Y]),mb=Q(L,b[Y+1]),U.push(L),U.push(B),U.push(mb))}}return U},k=n instanceof V.b?n:null,r=null===k||void 0===k?void 0:k._thinInstanceDataStorage.matrixData,v=(null===k||void 0===k?void 0:k.dY)||1,p=e.TmpVectors.Matrix[0];p.L(e.Matrix.IdentityReadOnly);for(let V=0;V<v;++V){if(null!==k&&void 0!==k&&k.hasThinInstances&&r){const b=16*V;p.setRowFromFloats(0,r[b+0],r[b+1],r[b+2],r[b+3]),p.setRowFromFloats(1,r[b+4],r[b+5],r[b+6],r[b+7]),p.setRowFromFloats(2,r[b+8],r[b+9],r[b+10],r[b+11]),p.setRowFromFloats(3,r[b+12],r[b+13],r[b+14],r[b+15])}const b=e.Matrix.RotationYawPitchRoll(E,t,A).multiply(e.Matrix.Translation(x.x,x.y,x.z)),Q=e.Matrix.Invert(b),U=n.getWorldMatrix(),L=p.multiply(U).multiply(Q),B=new Array(3);for(let n=0;n<I.length;n+=3){let b=B;if(b[0]=W(n,L),b[1]=W(n+1,L),b[2]=W(n+2,L),!(i.cullBackFaces&&-b[0].normal.z<=0&&-b[1].normal.z<=0&&-b[2].normal.z<=0)&&(b=R(b,g),b&&(b=R(b,P),b&&(b=R(b,c),b&&(b=R(b,q),b&&(b=R(b,S),b&&(b=R(b,H),b)))))))for(let n=0;n<b.length;n++){const e=b[n];if(w.indices.push(h),K?(e.localPositionOverride?(w.xb[3*h]=e.localPositionOverride[0],w.xb[3*h+1]=e.localPositionOverride[1],w.xb[3*h+2]=e.localPositionOverride[2]):d&&(w.xb[3*h]=d[e.vertexIdx],w.xb[3*h+1]=d[e.vertexIdx+1],w.xb[3*h+2]=d[e.vertexIdx+2]),e.localNormalOverride?(w.yb[3*h]=e.localNormalOverride[0],w.yb[3*h+1]=e.localNormalOverride[1],w.yb[3*h+2]=e.localNormalOverride[2]):G&&(w.yb[3*h]=G[e.vertexIdx],w.yb[3*h+1]=G[e.vertexIdx+1],w.yb[3*h+2]=G[e.vertexIdx+2])):(e.position.toArray(w.xb,3*h),e.normal.toArray(w.yb,3*h)),w.matricesIndices&&w.matricesWeights&&(e.matrixIndicesOverride?(w.matricesIndices[4*h]=e.matrixIndicesOverride[0],w.matricesIndices[4*h+1]=e.matrixIndicesOverride[1],w.matricesIndices[4*h+2]=e.matrixIndicesOverride[2],w.matricesIndices[4*h+3]=e.matrixIndicesOverride[3]):(M&&(w.matricesIndices[4*h]=M[e.vertexIdxForBones],w.matricesIndices[4*h+1]=M[e.vertexIdxForBones+1],w.matricesIndices[4*h+2]=M[e.vertexIdxForBones+2],w.matricesIndices[4*h+3]=M[e.vertexIdxForBones+3]),a&&w.matricesIndicesExtra&&(w.matricesIndicesExtra[4*h]=a[e.vertexIdxForBones],w.matricesIndicesExtra[4*h+1]=a[e.vertexIdxForBones+1],w.matricesIndicesExtra[4*h+2]=a[e.vertexIdxForBones+2],w.matricesIndicesExtra[4*h+3]=a[e.vertexIdxForBones+3])),e.matrixWeightsOverride?(w.matricesWeights[4*h]=e.matrixWeightsOverride[0],w.matricesWeights[4*h+1]=e.matrixWeightsOverride[1],w.matricesWeights[4*h+2]=e.matrixWeightsOverride[2],w.matricesWeights[4*h+3]=e.matrixWeightsOverride[3]):(j&&(w.matricesWeights[4*h]=j[e.vertexIdxForBones],w.matricesWeights[4*h+1]=j[e.vertexIdxForBones+1],w.matricesWeights[4*h+2]=j[e.vertexIdxForBones+2],w.matricesWeights[4*h+3]=j[e.vertexIdxForBones+3]),D&&w.matricesWeightsExtra&&(w.matricesWeightsExtra[4*h]=D[e.vertexIdxForBones],w.matricesWeightsExtra[4*h+1]=D[e.vertexIdxForBones+1],w.matricesWeightsExtra[4*h+2]=D[e.vertexIdxForBones+2],w.matricesWeightsExtra[4*h+3]=D[e.vertexIdxForBones+3]))),i.captureUVS)e.uv.toArray(w.Ab,2*h);else{w.Ab.push(.5+e.position.x/s.x);const b=.5+e.position.y/s.y;w.Ab.push(Y.e?1-b:b)}h++}}}0===w.indices.length&&(w.indices=null),0===w.xb.length&&(w.xb=null),0===w.yb.length&&(w.yb=null),0===w.Ab.length&&(w.Ab=null),0===(null===(B=w.matricesIndices)||void 0===B?void 0:B.length)&&(w.matricesIndices=null),0===(null===(mb=w.matricesWeights)||void 0===mb?void 0:mb.length)&&(w.matricesWeights=null),0===(null===(N=w.matricesIndicesExtra)||void 0===N?void 0:N.length)&&(w.matricesIndicesExtra=null),0===(null===(Z=w.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(w.matricesWeightsExtra=null);const f=new V.b(b,n.ab());return w.Cb(f),K?(f.skeleton=n.skeleton,f.parent=n):(f.position=x.clone(),f.rotation=new e.On(t,E,A)),f.we(!0),f.refreshBoundingInfo(!0,!0),f}function p(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const n=0|Math.max(b.subdivisions?b.subdivisions:2,1),i=0|Math.max(b.tessellation?b.tessellation:16,3),V=Math.max(b.height?b.height:1,0),Q=Math.max(b.radius?b.radius:.25,0),L=0|Math.max(b.capSubdivisions?b.capSubdivisions:6,1),B=i,mb=n,N=Math.max(b.radiusTop?b.radiusTop:Q,0),Z=Math.max(b.radiusBottom?b.radiusBottom:Q,0),T=V-(N+Z),z=2*Math.PI,K=Math.max(b.topCapSubdivisions?b.topCapSubdivisions:L,1),I=Math.max(b.bottomCapSubdivisions?b.bottomCapSubdivisions:L,1),O=Math.acos((Z-N)/V);let u=[];const d=[],G=[],o=[];let M=0;const j=[],a=.5*T,D=.5*Math.PI;let x,y;const s=e.On.Zero(),A=e.On.Zero(),E=Math.cos(O),C=Math.sin(O),t=new e.Vector2(N*C,a+N*E).un(new e.Vector2(Z*C,Z*E-a)).length(),w=N*O+t+Z*(D-O);let h=0;for(y=0;y<=K;y++){const b=[],n=D-O*(y/K);h+=N*O/K;const i=Math.cos(n),e=Math.sin(n),V=i*N;for(x=0;x<=B;x++){const n=x/B,Q=n*z+0,U=Math.sin(Q),L=Math.cos(Q);A.x=V*U,A.y=a+e*N,A.z=V*L,d.push(A.x,A.y,A.z),s.set(i*U,e,i*L),G.push(s.x,s.y,s.z),o.push(n,Y.e?h/w:1-h/w),b.push(M),M++}j.push(b)}const W=V-N-Z+E*N-E*Z,J=C*(Z-N)/W;for(y=1;y<=mb;y++){const b=[];h+=t/mb;const n=C*(y*(Z-N)/mb+N);for(x=0;x<=B;x++){const i=x/B,e=i*z+0,V=Math.sin(e),Q=Math.cos(e);A.x=n*V,A.y=a+E*N-y*W/mb,A.z=n*Q,d.push(A.x,A.y,A.z),s.set(V,J,Q).normalize(),G.push(s.x,s.y,s.z),o.push(i,Y.e?h/w:1-h/w),b.push(M),M++}j.push(b)}for(y=1;y<=I;y++){const b=[],n=D-O-(Math.PI-O)*(y/I);h+=Z*O/I;const i=Math.cos(n),e=Math.sin(n),V=i*Z;for(x=0;x<=B;x++){const n=x/B,Q=n*z+0,U=Math.sin(Q),L=Math.cos(Q);A.x=V*U,A.y=e*Z-a,A.z=V*L,d.push(A.x,A.y,A.z),s.set(i*U,e,i*L),G.push(s.x,s.y,s.z),o.push(n,Y.e?h/w:1-h/w),b.push(M),M++}j.push(b)}for(x=0;x<B;x++)for(y=0;y<K+mb+I;y++){const b=j[y][x],n=j[y+1][x],i=j[y+1][x+1],e=j[y][x+1];u.push(b),u.push(n),u.push(e),u.push(n),u.push(i),u.push(e)}if(u=u.reverse(),b.orientation&&!b.orientation.equals(e.On.Up())){const n=new e.Matrix;b.orientation.clone().scale(.5*Math.PI).cross(e.On.Up()).toQuaternion().toRotationMatrix(n);const i=e.On.Zero();for(let b=0;b<d.length;b+=3)i.set(d[b],d[b+1],d[b+2]),e.On.TransformCoordinatesToRef(i.clone(),n,i),d[b]=i.x,d[b+1]=i.y,d[b+2]=i.z}const R=new U.d;return R.xb=d,R.yb=G,R.Ab=o,R.indices=u,R}function f(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:e.On.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new V.b(b,i);return p(n).Cb(Q,n.updatable),Q}V.b.CreateDecal=(b,n,i,e,V,Q)=>v(b,n,{position:i,normal:e,size:V,angle:Q});V.b.CreateCapsule=(b,n,i)=>f(b,n,i),U.d.CreateCapsule=p;var F=i(11621),bb=i(11786);class nb{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=b,this.y=n,b!==Math.floor(b)&&(b=Math.floor(b),F.b.Warn("x is not an integer, floor(x) used")),n!==Math.floor(n)&&(n=Math.floor(n),F.b.Warn("y is not an integer, floor(y) used"))}clone(){return new nb(this.x,this.y)}rotate60About(b){const n=this.x;return this.x=b.x+b.y-this.y,this.y=n+this.y-b.x,this}rotateNeg60About(b){const n=this.x;return this.x=n+this.y-b.y,this.y=b.x+b.y-n,this}rotate120(b,n){b!==Math.floor(b)&&(b=Math.floor(b),F.b.Warn("m not an integer only floor(m) used")),n!==Math.floor(n)&&(n=Math.floor(n),F.b.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=b-i-this.y,this.y=n+i,this}rotateNeg120(b,n){b!==Math.floor(b)&&(b=Math.floor(b),F.b.Warn("m is not an integer, floor(m) used")),n!==Math.floor(n)&&(n=Math.floor(n),F.b.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-n,this.y=b+n-i-this.y,this}toCartesianOrigin(b,n){const i=e.On.Zero();return i.x=b.x+2*this.x*n+this.y*n,i.y=b.y+Math.sqrt(3)*this.y*n,i}static Zero(){return new nb(0,0)}}class ib{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new eb("icosahedron","Regular",[[0,bb.d,-1],[-bb.d,1,0],[-1,0,-bb.d],[1,0,-bb.d],[bb.d,1,0],[0,bb.d,1],[-1,0,bb.d],[-bb.d,-1,0],[0,-bb.d,-1],[bb.d,-1,0],[1,0,bb.d],[0,-bb.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let b=12;const n={},i=this.m,e=this.n;let V,Q,U,Y,L,B=i,mb=1,N=0;0!==e&&(B=(0,X.HighestCommonFactor)(i,e)),mb=i/B,N=e/B;const Z=nb.Zero(),T=new nb(i,e),z=new nb(-e,i+e),K=nb.Zero(),I=nb.Zero(),O=nb.Zero();let u,d,G,o,M=[];const j=[],a=this.vertByDist,D=(i,e,V,Q)=>{u=i+"|"+V,d=e+"|"+Q,u in n||d in n?u in n&&!(d in n)?n[d]=n[u]:d in n&&!(u in n)&&(n[u]=n[d]):(n[u]=b,n[d]=b,b++),a[V][0]>2?j[n[u]]=[-a[V][0],a[V][1],n[u]]:j[n[u]]=[M[a[V][0]],a[V][1],n[u]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let x=0;x<20;x++){if(M=this.IDATA.face[x],U=M[2],Y=M[1],L=M[0],G=Z.x+"|"+Z.y,u=x+"|"+G,u in n||(n[u]=U,j[U]=[M[a[G][0]],a[G][1]]),G=T.x+"|"+T.y,u=x+"|"+G,u in n||(n[u]=Y,j[Y]=[M[a[G][0]],a[G][1]]),G=z.x+"|"+z.y,u=x+"|"+G,u in n||(n[u]=L,j[L]=[M[a[G][0]],a[G][1]]),V=this.IDATA.edgematch[x][0],Q=this.IDATA.edgematch[x][1],"B"===Q)for(let b=1;b<B;b++)I.x=i-b*(mb+N),I.y=e+b*mb,O.x=-b*N,O.y=b*(mb+N),G=I.x+"|"+I.y,o=O.x+"|"+O.y,D(x,V,G,o);if("O"===Q)for(let b=1;b<B;b++)O.x=-b*N,O.y=b*(mb+N),K.x=b*mb,K.y=b*N,G=O.x+"|"+O.y,o=K.x+"|"+K.y,D(x,V,G,o);if(V=this.IDATA.edgematch[x][2],Q=this.IDATA.edgematch[x][3],Q&&"A"===Q)for(let b=1;b<B;b++)K.x=b*mb,K.y=b*N,I.x=i-(B-b)*(mb+N),I.y=e+(B-b)*mb,G=K.x+"|"+K.y,o=I.x+"|"+I.y,D(x,V,G,o);for(let i=0;i<this.vertices.length;i++)G=this.vertices[i].x+"|"+this.vertices[i].y,u=x+"|"+G,u in n||(n[u]=b++,a[G][0]>2?j[n[u]]=[-a[G][0],a[G][1],n[u]]:j[n[u]]=[M[a[G][0]],a[G][1],n[u]])}this.closestTo=j,this.vecToidx=n}calcCoeffs(){const b=this.m,n=this.n,i=Math.sqrt(3)/3,e=b*b+n*n+b*n;this.coau=(b+n)/e,this.cobu=-n/e,this.coav=-i*(b-n)/e,this.cobv=i*(2*b+n)/e}createInnerFacets(){const b=this.m,n=this.n;for(let i=0;i<n+b+1;i++)for(let b=this.min[i];b<this.max[i]+1;b++)b<this.max[i]&&b<this.max[i+1]+1&&this.innerFacets.push(["|"+b+"|"+i,"|"+b+"|"+(i+1),"|"+(b+1)+"|"+i]),i>0&&b<this.max[i-1]&&b+1<this.max[i]+1&&this.innerFacets.push(["|"+b+"|"+i,"|"+(b+1)+"|"+i,"|"+(b+1)+"|"+(i-1)])}edgeVecsABOB(){const b=this.m,n=this.n,i=new nb(-n,b+n);for(let e=1;e<b+n;e++){const b=new nb(this.min[e],e),n=new nb(this.min[e-1],e-1),V=new nb(this.min[e+1],e+1),Q=b.clone(),U=n.clone(),Y=V.clone();Q.rotate60About(i),U.rotate60About(i),Y.rotate60About(i);const L=new nb(this.max[Q.y],Q.y),B=new nb(this.max[Q.y-1],Q.y-1),mb=new nb(this.max[Q.y-1]-1,Q.y-1);Q.x===L.x&&Q.y===L.y||(Q.x!==B.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,B,mb]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,mb,L])):Q.y===Y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,n,B]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([b,B,V])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,n,B]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,B,L])))}}mapABOBtoOBOA(){const b=new nb(0,0);for(let n=0;n<this.isoVecsABOB.length;n++){const i=[];for(let e=0;e<3;e++)b.x=this.isoVecsABOB[n][e].x,b.y=this.isoVecsABOB[n][e].y,0===this.vertexTypes[n][e]&&b.rotateNeg120(this.m,this.n),i.push(b.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const b=new nb(0,0);for(let n=0;n<this.isoVecsABOB.length;n++){const i=[];for(let e=0;e<3;e++)b.x=this.isoVecsABOB[n][e].x,b.y=this.isoVecsABOB[n][e].y,1===this.vertexTypes[n][e]&&b.rotate120(this.m,this.n),i.push(b.clone());this.isoVecsBAOA.push(i)}}MapToFace(b,n){const i=this.IDATA.face[b],V=i[2],Q=i[1],U=i[0],Y=e.On.jn(this.IDATA.vertex[V]),L=e.On.jn(this.IDATA.vertex[Q]),B=e.On.jn(this.IDATA.vertex[U]),mb=L.un(Y),N=B.un(Y),Z=mb.scale(this.coau).add(N.scale(this.cobu)),T=mb.scale(this.coav).add(N.scale(this.cobv)),z=[];let K,I=e.TmpVectors.On[0];for(let e=0;e<this.cartesian.length;e++)I=Z.scale(this.cartesian[e].x).add(T.scale(this.cartesian[e].y)).add(Y),z[e]=[I.x,I.y,I.z],K=b+"|"+this.vertices[e].x+"|"+this.vertices[e].y,n.vertex[this.vecToidx[K]]=[I.x,I.y,I.z]}build(b,n){const i=[],e=nb.Zero(),V=new nb(b,n),Q=new nb(-n,b+n);i.push(e,V,Q);for(let G=n;G<b+1;G++)for(let n=0;n<b+1-G;n++)i.push(new nb(n,G));if(n>0){const e=(0,X.HighestCommonFactor)(b,n),V=b/e,Q=n/e;for(let Y=1;Y<e;Y++)i.push(new nb(Y*V,Y*Q)),i.push(new nb(-Y*Q,Y*(V+Q))),i.push(new nb(b-Y*(V+Q),n+Y*V));const U=b/n;for(let Y=1;Y<n;Y++)for(let e=0;e<Y*U;e++)i.push(new nb(e,Y)),i.push(new nb(e,Y).rotate120(b,n)),i.push(new nb(e,Y).rotateNeg120(b,n))}i.sort(((b,n)=>b.x-n.x)),i.sort(((b,n)=>b.y-n.y));const U=new Array(b+n+1),Y=new Array(b+n+1);for(let G=0;G<U.length;G++)U[G]=1/0,Y[G]=-1/0;let L=0,B=0;const mb=i.length;for(let G=0;G<mb;G++)B=i[G].x,L=i[G].y,U[L]=Math.min(B,U[L]),Y[L]=Math.max(B,Y[L]);const N=(i,e)=>{const V=i.clone();return"A"===e&&V.rotateNeg120(b,n),"B"===e&&V.rotate120(b,n),V.x<0?V.y:V.x+V.y},Z=[],T=[],z=[],K=[],I={},O=[];let u=-1,d=-1;for(let G=0;G<mb;G++)Z[G]=i[G].toCartesianOrigin(new nb(0,0),.5),T[G]=N(i[G],"O"),z[G]=N(i[G],"A"),K[G]=N(i[G],"B"),T[G]===z[G]&&z[G]===K[G]?(u=3,d=T[G]):T[G]===z[G]?(u=4,d=T[G]):z[G]===K[G]?(u=5,d=z[G]):K[G]===T[G]&&(u=6,d=T[G]),T[G]<z[G]&&T[G]<K[G]&&(u=2,d=T[G]),z[G]<T[G]&&z[G]<K[G]&&(u=1,d=z[G]),K[G]<z[G]&&K[G]<T[G]&&(u=0,d=K[G]),O.push([u,d,i[G].x,i[G].y]);O.sort(((b,n)=>b[2]-n[2])),O.sort(((b,n)=>b[3]-n[3])),O.sort(((b,n)=>b[1]-n[1])),O.sort(((b,n)=>b[0]-n[0]));for(let G=0;G<O.length;G++)I[O[G][2]+"|"+O[G][3]]=[O[G][0],O[G][1],G];return this.m=b,this.n=n,this.vertices=i,this.vertByDist=I,this.cartesian=Z,this.min=U,this.max=Y,this}}class eb{constructor(b,n,i,e){this.name=b,this.category=n,this.vertex=i,this.face=e}}class Vb extends eb{innerToData(b,n){for(let i=0;i<n.innerFacets.length;i++)this.face.push(n.innerFacets[i].map((i=>n.vecToidx[b+i])))}mapABOBtoDATA(b,n){const i=n.IDATA.edgematch[b][0];for(let e=0;e<n.isoVecsABOB.length;e++){const V=[];for(let Q=0;Q<3;Q++)0===n.vertexTypes[e][Q]?V.push(b+"|"+n.isoVecsABOB[e][Q].x+"|"+n.isoVecsABOB[e][Q].y):V.push(i+"|"+n.isoVecsABOB[e][Q].x+"|"+n.isoVecsABOB[e][Q].y);this.face.push([n.vecToidx[V[0]],n.vecToidx[V[1]],n.vecToidx[V[2]]])}}mapOBOAtoDATA(b,n){const i=n.IDATA.edgematch[b][0];for(let e=0;e<n.isoVecsOBOA.length;e++){const V=[];for(let Q=0;Q<3;Q++)1===n.vertexTypes[e][Q]?V.push(b+"|"+n.isoVecsOBOA[e][Q].x+"|"+n.isoVecsOBOA[e][Q].y):V.push(i+"|"+n.isoVecsOBOA[e][Q].x+"|"+n.isoVecsOBOA[e][Q].y);this.face.push([n.vecToidx[V[0]],n.vecToidx[V[1]],n.vecToidx[V[2]]])}}mapBAOAtoDATA(b,n){const i=n.IDATA.edgematch[b][2];for(let e=0;e<n.isoVecsBAOA.length;e++){const V=[];for(let Q=0;Q<3;Q++)1===n.vertexTypes[e][Q]?V.push(b+"|"+n.isoVecsBAOA[e][Q].x+"|"+n.isoVecsBAOA[e][Q].y):V.push(i+"|"+n.isoVecsBAOA[e][Q].x+"|"+n.isoVecsBAOA[e][Q].y);this.face.push([n.vecToidx[V[0]],n.vecToidx[V[1]],n.vecToidx[V[2]]])}}orderData(b){const n=[];for(let Q=0;Q<13;Q++)n[Q]=[];const i=b.closestTo;for(let Q=0;Q<i.length;Q++)i[Q][0]>-1?i[Q][1]>0&&n[i[Q][0]].push([Q,i[Q][1]]):n[12].push([Q,i[Q][0]]);const e=[];for(let Q=0;Q<12;Q++)e[Q]=Q;let V=12;for(let Q=0;Q<12;Q++){n[Q].sort(((b,n)=>b[1]-n[1]));for(let b=0;b<n[Q].length;b++)e[n[Q][b][0]]=V++}for(let Q=0;Q<n[12].length;Q++)e[n[12][Q][0]]=V++;for(let Q=0;Q<this.vertex.length;Q++)this.vertex[Q].push(e[Q]);this.vertex.sort(((b,n)=>b[3]-n[3]));for(let Q=0;Q<this.vertex.length;Q++)this.vertex[Q].pop();for(let Q=0;Q<this.face.length;Q++)for(let b=0;b<this.face[Q].length;b++)this.face[Q][b]=e[this.face[Q][b]];this.sharedNodes=n[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(b,n){const i=[],e=[];let V=n.pop();e.push(V);let Q=this.face[V].indexOf(b);Q=(Q+2)%3;let U=this.face[V][Q];i.push(U);let Y=0;for(;n.length>0;)V=n[Y],this.face[V].indexOf(U)>-1?(Q=(this.face[V].indexOf(U)+1)%3,U=this.face[V][Q],i.push(U),e.push(V),n.splice(Y,1),Y=0):Y++;return this.adjacentFaces.push(i),e}toGoldbergPolyhedronData(){const b=new eb("GeoDual","Goldberg",[],[]);b.name="GD dual";const n=this.vertex.length,i=new Array(n);for(let L=0;L<n;L++)i[L]=[];for(let L=0;L<this.face.length;L++)for(let b=0;b<3;b++)i[this.face[L][b]].push(L);let e=0,V=0,Q=0,U=[],Y=[];this.adjacentFaces=[];for(let L=0;L<i.length;L++){b.face[L]=this.setOrder(L,i[L].concat([]));for(const n of i[L]){e=0,V=0,Q=0,U=this.face[n];for(let b=0;b<3;b++)Y=this.vertex[U[b]],e+=Y[0],V+=Y[1],Q+=Y[2];b.vertex[n]=[e/3,V/3,Q/3]}}return b}static BuildGeodesicData(b){const n=new Vb("Geodesic-m-n","Geodesic",[[0,bb.d,-1],[-bb.d,1,0],[-1,0,-bb.d],[1,0,-bb.d],[bb.d,1,0],[0,bb.d,1],[-1,0,bb.d],[-bb.d,-1,0],[0,-bb.d,-1],[bb.d,-1,0],[1,0,bb.d],[0,-bb.d,1]],[]);b.setIndices(),b.calcCoeffs(),b.createInnerFacets(),b.edgeVecsABOB(),b.mapABOBtoOBOA(),b.mapABOBtoBAOA();for(let i=0;i<b.IDATA.face.length;i++)b.MapToFace(i,n),n.innerToData(i,b),"B"===b.IDATA.edgematch[i][1]&&n.mapABOBtoDATA(i,b),"O"===b.IDATA.edgematch[i][1]&&n.mapOBOAtoDATA(i,b),"A"===b.IDATA.edgematch[i][3]&&n.mapBAOAtoDATA(i,b);n.orderData(b);return n.vertex=n.vertex.map((function(b){const n=b[0],i=b[1],e=b[2],V=Math.sqrt(n*n+i*i+e*e);return b[0]*=1/V,b[1]*=1/V,b[2]*=1/V,b})),n}}V.b._GoldbergMeshParser=(b,n)=>Qb.Parse(b,n);class Qb extends V.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(b,n){return void 0===n?(b>this.goldbergData.nbUnsharedFaces-1&&(F.b.Warn("Maximum number of unshared faces used"),b=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+b):(b>11&&(F.b.Warn("Last pole used"),b=11),n>this.goldbergData.nbFacesAtPole-1&&(F.b.Warn("Maximum number of faces at a pole used"),n=this.goldbergData.nbFacesAtPole-1),12+b*this.goldbergData.nbFacesAtPole+n)}_changeGoldbergFaceColors(b){for(let i=0;i<b.length;i++){const n=b[i][0],e=b[i][1],V=b[i][2];for(let b=n;b<e+1;b++)this.goldbergData.faceColors[b]=V}const n=[];for(let i=0;i<12;i++)for(let b=0;b<5;b++)n.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let b=0;b<6;b++)n.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return n}setGoldbergFaceColors(b){const n=this._changeGoldbergFaceColors(b);this.Wb(Q.g.ColorKind,n)}updateGoldbergFaceColors(b){const n=this._changeGoldbergFaceColors(b);this.updateVerticesData(Q.g.ColorKind,n)}_changeGoldbergFaceUVs(b){const n=this.getVerticesData(Q.g.UVKind);for(let i=0;i<b.length;i++){const e=b[i][0],V=b[i][1],Q=b[i][2],U=b[i][3],Y=b[i][4],L=[],B=[];let mb,N;for(let b=0;b<5;b++)mb=Q.x+U*Math.cos(Y+b*Math.PI/2.5),N=Q.y+U*Math.sin(Y+b*Math.PI/2.5),mb<0&&(mb=0),mb>1&&(mb=1),L.push(mb,N);for(let b=0;b<6;b++)mb=Q.x+U*Math.cos(Y+b*Math.PI/3),N=Q.y+U*Math.sin(Y+b*Math.PI/3),mb<0&&(mb=0),mb>1&&(mb=1),B.push(mb,N);for(let b=e;b<Math.min(12,V+1);b++)for(let i=0;i<5;i++)n[10*b+2*i]=L[2*i],n[10*b+2*i+1]=L[2*i+1];for(let b=Math.max(12,e);b<V+1;b++)for(let i=0;i<6;i++)n[12*b-24+2*i]=B[2*i],n[12*b-23+2*i]=B[2*i+1]}return n}setGoldbergFaceUVs(b){const n=this._changeGoldbergFaceUVs(b);this.Wb(Q.g.UVKind,n)}updateGoldbergFaceUVs(b){const n=this._changeGoldbergFaceUVs(b);this.updateVerticesData(Q.g.UVKind,n)}placeOnGoldbergFaceAt(b,n,i){const V=e.On.RotationFromAxis(this.goldbergData.faceXaxis[n],this.goldbergData.faceYaxis[n],this.goldbergData.faceZaxis[n]);b.rotation=V,b.position=this.goldbergData.faceCenters[n].add(this.goldbergData.faceXaxis[n].scale(i.x)).add(this.goldbergData.faceYaxis[n].scale(i.y)).add(this.goldbergData.faceZaxis[n].scale(i.z))}serialize(b){super.serialize(b),b.type="GoldbergMesh";const n={};if(n.adjacentFaces=this.goldbergData.adjacentFaces,n.nbSharedFaces=this.goldbergData.nbSharedFaces,n.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,n.nbFaces=this.goldbergData.nbFaces,n.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){n.faceColors=[];for(const b of this.goldbergData.faceColors)n.faceColors.push(b.ye())}if(this.goldbergData.faceCenters){n.faceCenters=[];for(const b of this.goldbergData.faceCenters)n.faceCenters.push(b.ye())}if(this.goldbergData.faceZaxis){n.faceZaxis=[];for(const b of this.goldbergData.faceZaxis)n.faceZaxis.push(b.ye())}if(this.goldbergData.faceYaxis){n.faceYaxis=[];for(const b of this.goldbergData.faceYaxis)n.faceYaxis.push(b.ye())}if(this.goldbergData.faceXaxis){n.faceXaxis=[];for(const b of this.goldbergData.faceXaxis)n.faceXaxis.push(b.ye())}b.goldbergData=n}static Parse(b,n){const i=b.goldbergData;i.faceColors=i.faceColors.map((b=>Z.IV.jn(b))),i.faceCenters=i.faceCenters.map((b=>e.On.jn(b))),i.faceZaxis=i.faceZaxis.map((b=>e.On.jn(b))),i.faceXaxis=i.faceXaxis.map((b=>e.On.jn(b))),i.faceYaxis=i.faceYaxis.map((b=>e.On.jn(b)));const V=new Qb(b.name,n);return V.goldbergData=i,V}}var Ub=i(12333);const Yb={CreateBox:N.b,CreateTiledBox:I,CreateSphere:O.b,CreateDisc:mb.e,CreateIcoSphere:r,CreateRibbon:B,CreateCylinder:o,CreateTorus:j,CreateTorusKnot:D,CreateLineSystem:x.c,NB:x.d,CreateDashedLines:x.b,ExtrudeShape:A,ExtrudeShapeCustom:E,CreateLathe:t,CreateTiledPlane:z,zB:w.c,CreateGround:h.g,CreateTiledGround:h.i,CreateGroundFromHeightMap:h.e,CreatePolygon:y.e,ExtrudePolygon:y.f,CreateTube:W,CreatePolyhedron:R,CreateGeodesic:function(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=n.m||1;e!==Math.floor(e)&&(e=Math.floor(e),F.b.Warn("m not an integer only floor(m) used"));let V=n.n||0;if(V!==Math.floor(V)&&(V=Math.floor(V),F.b.Warn("n not an integer only floor(n) used")),V>e){const b=V;V=e,e=b,F.b.Warn("n > m therefore m and n swapped")}const Q=new ib;return Q.build(e,V),R(b,{custom:Vb.BuildGeodesicData(Q),size:n.size,sizeX:n.sizeX,sizeY:n.sizeY,sizeZ:n.sizeZ,faceUV:n.faceUV,faceColors:n.faceColors,flat:n.flat,updatable:n.updatable,sideOrientation:n.sideOrientation,frontUVs:n.frontUVs,backUVs:n.backUVs},i)},CreateGoldberg:function(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=n.size,L=n.sizeX||Q||1,B=n.sizeY||Q||1,mb=n.sizeZ||Q||1;let N=n.m||1;N!==Math.floor(N)&&(N=Math.floor(N),F.b.Warn("m not an integer only floor(m) used"));let T=n.n||0;if(T!==Math.floor(T)&&(T=Math.floor(T),F.b.Warn("n not an integer only floor(n) used")),T>N){const b=T;T=N,N=b,F.b.Warn("n > m therefore m and n swapped")}const z=new ib;z.build(N,T);const K=Vb.BuildGeodesicData(z),I=K.toGoldbergPolyhedronData(),O=new Qb(b,i);n.sideOrientation=V.b._GetDefaultSideOrientation(n.sideOrientation),O._originalBuilderSideOrientation=n.sideOrientation;(function(b,n){const i=b.size,V=b.sizeX||i||1,Q=b.sizeY||i||1,L=b.sizeZ||i||1,B=0===b.sideOrientation?0:b.sideOrientation||U.d.DEFAULTSIDE,mb=[],N=[],Z=[],T=[];let z=1/0,K=-1/0,I=1/0,O=-1/0;for(let e=0;e<n.vertex.length;e++)z=Math.min(z,n.vertex[e][0]*V),K=Math.max(K,n.vertex[e][0]*V),I=Math.min(I,n.vertex[e][1]*Q),O=Math.max(O,n.vertex[e][1]*Q);let u=0;for(let U=0;U<n.face.length;U++){const b=n.face[U],i=e.On.jn(n.vertex[b[0]]),B=e.On.jn(n.vertex[b[2]]),d=e.On.jn(n.vertex[b[1]]),G=B.un(i),o=d.un(i),M=e.On.Cross(o,G).normalize();for(let e=0;e<b.length;e++){Z.push(M.x,M.y,M.z);const i=n.vertex[b[e]];mb.push(i[0]*V,i[1]*Q,i[2]*L);const U=(i[1]*Q-I)/(O-I);T.push((i[0]*V-z)/(K-z),Y.e?1-U:U)}for(let n=0;n<b.length-2;n++)N.push(u,u+n+2,u+n+1);u+=b.length}U.d._ComputeSides(B,mb,N,Z,T);const d=new U.d;return d.xb=mb,d.indices=N,d.yb=Z,d.Ab=T,d})(n,I).Cb(O,n.updatable),O.goldbergData.nbSharedFaces=K.sharedNodes,O.goldbergData.nbUnsharedFaces=K.poleNodes,O.goldbergData.adjacentFaces=K.adjacentFaces,O.goldbergData.nbFaces=O.goldbergData.nbSharedFaces+O.goldbergData.nbUnsharedFaces,O.goldbergData.nbFacesAtPole=(O.goldbergData.nbUnsharedFaces-12)/12;for(let V=0;V<K.vertex.length;V++)O.goldbergData.faceCenters.push(e.On.jn(K.vertex[V])),O.goldbergData.faceCenters[V].x*=L,O.goldbergData.faceCenters[V].y*=B,O.goldbergData.faceCenters[V].z*=mb,O.goldbergData.faceColors.push(new Z.IV(1,1,1,1));for(let V=0;V<I.face.length;V++){const b=I.face[V],n=e.On.jn(I.vertex[b[0]]),i=e.On.jn(I.vertex[b[2]]),Q=e.On.jn(I.vertex[b[1]]),U=i.un(n),Y=Q.un(n),L=e.On.Cross(Y,U).normalize(),B=e.On.Cross(Y,L).normalize();O.goldbergData.faceXaxis.push(Y.normalize()),O.goldbergData.faceYaxis.push(L),O.goldbergData.faceZaxis.push(B)}return O},CreateDecal:v,CreateCapsule:f,CreateText:Ub.f}},13100:(b,n,i)=>{"use strict";i.d(n,{c:()=>Ln});var e=i(11778),V=i(12159);class Q extends V.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var U=i(11822),Y=(i(11936),i(11734));class L{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(b){this._targetStopDuration!==b&&(this._targetStopDuration=b)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(b){this._noiseTexture!==b&&(this._noiseTexture=b,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(b){this._animationSheetEnabled!==b&&(this._animationSheetEnabled=b)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(b){this._isAnimationSheetEnabled!=b&&(this._isAnimationSheetEnabled=b,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(b){this._useLogarithmicDepth=b&&this.ab().getEngine().getCaps().fragmentDepthSupported}ab(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(b){switch(b){case L.BLENDMODE_MULTIPLYADD:return;case L.BLENDMODE_ADD:b=1;break;case L.BLENDMODE_ONEONE:b=6;break;case L.BLENDMODE_STANDARD:b=2;break;case L.BLENDMODE_MULTIPLY:b=4;break;case L.BLENDMODE_SUBTRACT:b=3}this._engine.setAlphaMode(b)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:e.On.Zero()}set direction1(b){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=b)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:e.On.Zero()}set direction2(b){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=b)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:e.On.Zero()}set minEmitBox(b){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=b)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:e.On.Zero()}set maxEmitBox(b){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=b)}get billboardMode(){return this._billboardMode}set billboardMode(b){this._billboardMode!==b&&(this._billboardMode=b,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(b){this._isBillboardBased!==b&&(this._isBillboardBased=b,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(b){this._attachImageProcessingConfiguration(b)}_attachImageProcessingConfiguration(b){b!==this._imageProcessingConfiguration&&(!b&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=b)}_reset(){}_removeGradientAndTexture(b,n,i){if(!n)return this;let e=0;for(const V of n){if(V.gradient===b){n.splice(e,1);break}e++}return i&&i.dispose(),this}constructor(b){this.animations=[],this.renderingGroupId=0,this.Un=e.On.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new e.On(10,10,10),this.onAnimationEnd=null,this.blendMode=L.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new e.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.YB=new e.On(0,0,0),this._useLogarithmicDepth=!1,this.gravity=e.On.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new U.IV(1,1,1,1),this.color2=new U.IV(1,1,1,1),this.colorDead=new U.IV(0,0,0,1),this.textureMask=new U.IV(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Q,this.id=b,this.name=b}createPointEmitter(b,n){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new e.On(0,1,0),arguments.length>2&&void 0!==arguments[2]||new e.On(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new e.On(0,1,0),arguments.length>4&&void 0!==arguments[4]||new e.On(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new e.On(0,1,0),arguments.length>3&&void 0!==arguments[3]||new e.On(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(b,n,i,e){throw new Error("Method not implemented.")}}L.BLENDMODE_ONEONE=0,L.BLENDMODE_STANDARD=1,L.BLENDMODE_ADD=2,L.BLENDMODE_MULTIPLY=3,L.BLENDMODE_MULTIPLYADD=4,L.BLENDMODE_SUBTRACT=-1,(0,Y.i)("BABYLON.BaseParticleSystem",L);var B=i(11796),mb=i(11625);class N{constructor(){this.direction1=new e.On(0,1,0),this.direction2=new e.On(0,1,0),this.minEmitBox=new e.On(-.5,-.5,-.5),this.maxEmitBox=new e.On(.5,.5,.5)}startDirectionFunction(b,n,i,V){const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),U=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,B.RandomRange)(this.direction1.z,this.direction2.z);if(V)return n.x=Q,n.y=U,void(n.z=Y);e.On.TransformNormalFromFloatsToRef(Q,U,Y,b,n)}startPositionFunction(b,n,i,V){const Q=(0,B.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),U=(0,B.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),Y=(0,B.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(V)return n.x=Q,n.y=U,void(n.z=Y);e.On.TransformCoordinatesFromFloatsToRef(Q,U,Y,b,n)}clone(){const b=new N;return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2),b.setVector3("minEmitBox",this.minEmitBox),b.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3),b.addUniform("minEmitBox",3),b.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.direction1=this.direction1.ye(),b.direction2=this.direction2.ye(),b.minEmitBox=this.minEmitBox.ye(),b.maxEmitBox=this.maxEmitBox.ye(),b}parse(b){e.On.FromArrayToRef(b.direction1,0,this.direction1),e.On.FromArrayToRef(b.direction2,0,this.direction2),e.On.FromArrayToRef(b.minEmitBox,0,this.minEmitBox),e.On.FromArrayToRef(b.maxEmitBox,0,this.maxEmitBox)}}class Z{get radius(){return this._radius}set radius(b){this._radius=b,this._buildHeight()}get angle(){return this._angle}set angle(b){this._angle=b,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=i,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=n,this.radius=b}startDirectionFunction(b,n,i,V){V?e.TmpVectors.On[0].L(i.rY).normalize():i.position.subtractToRef(b.getTranslation(),e.TmpVectors.On[0]).normalize();const Q=(0,B.RandomRange)(0,this.directionRandomizer),U=(0,B.RandomRange)(0,this.directionRandomizer),Y=(0,B.RandomRange)(0,this.directionRandomizer);n.x=e.TmpVectors.On[0].x+Q,n.y=e.TmpVectors.On[0].y+U,n.z=e.TmpVectors.On[0].z+Y,n.normalize()}startPositionFunction(b,n,i,V){const Q=(0,B.RandomRange)(0,2*Math.PI);let U;this.emitFromSpawnPointOnly?U=1e-4:(U=(0,B.RandomRange)(0,this.heightRange),U=1-U*U);let Y=this._radius-(0,B.RandomRange)(0,this._radius*this.radiusRange);Y*=U;const L=Y*Math.sin(Q),mb=Y*Math.cos(Q),N=U*this._height;if(V)return n.x=L,n.y=N,void(n.z=mb);e.On.TransformCoordinatesFromFloatsToRef(L,N,mb,b,n)}clone(){const b=new Z(this._radius,this._angle,this.directionRandomizer);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat2("radius",this._radius,this.radiusRange),b.setFloat("coneAngle",this._angle),b.setFloat2("height",this._height,this.heightRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",2),b.addUniform("coneAngle",1),b.addUniform("height",2),b.addUniform("directionRandomizer",1)}getEffectDefines(){let b="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(b+="\n#define CONEEMITTERSPAWNPOINT"),b}getClassName(){return"ConeParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this._radius,b.angle=this._angle,b.directionRandomizer=this.directionRandomizer,b.radiusRange=this.radiusRange,b.heightRange=this.heightRange,b.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,b}parse(b){this.radius=b.radius,this.angle=b.angle,this.directionRandomizer=b.directionRandomizer,this.radiusRange=void 0!==b.radiusRange?b.radiusRange:1,this.heightRange=void 0!==b.radiusRange?b.heightRange:1,this.emitFromSpawnPointOnly=void 0!==b.emitFromSpawnPointOnly&&b.emitFromSpawnPointOnly}}class T extends Z{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0),V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0);super(b,n),this.direction1=i,this.direction2=V}startDirectionFunction(b,n){const i=(0,B.RandomRange)(this.direction1.x,this.direction2.x),V=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,B.RandomRange)(this.direction1.z,this.direction2.z);e.On.TransformNormalFromFloatsToRef(i,V,Q,b,n)}clone(){const b=new T(this.radius,this.angle,this.direction1,this.direction2);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.ye(),b.direction2=this.direction2.ye(),b}parse(b){super.parse(b),this.direction1.L(b.direction1),this.direction2.L(b.direction2)}}class z{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=b,this.height=n,this.radiusRange=i,this.directionRandomizer=V,this._tempVector=e.On.Zero()}startDirectionFunction(b,n,i,V,Q){i.position.subtractToRef(b.getTranslation(),this._tempVector),this._tempVector.normalize(),e.On.TransformNormalToRef(this._tempVector,Q,this._tempVector);const U=(0,B.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,B.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=U,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),V?n.L(this._tempVector):e.On.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,b,n)}startPositionFunction(b,n,i,V){const Q=(0,B.RandomRange)(-this.height/2,this.height/2),U=(0,B.RandomRange)(0,2*Math.PI),Y=(0,B.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),L=Math.sqrt(Y)*this.radius,mb=L*Math.cos(U),N=L*Math.sin(U);V?n.re(mb,Q,N):e.On.TransformCoordinatesFromFloatsToRef(mb,Q,N,b,n)}clone(){const b=new z(this.radius,this.directionRandomizer);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("height",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.height=this.height,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.height=b.height,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class K extends z{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0),Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.On(0,1,0);super(b,n,i),this.direction1=V,this.direction2=Q}startDirectionFunction(b,n,i,V){const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),U=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,B.RandomRange)(this.direction1.z,this.direction2.z);V?n.re(Q,U,Y):e.On.TransformNormalFromFloatsToRef(Q,U,Y,b,n)}clone(){const b=new K(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("height",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.ye(),b.direction2=this.direction2.ye(),b}parse(b){super.parse(b),e.On.FromArrayToRef(b.direction1,0,this.direction1),e.On.FromArrayToRef(b.direction2,0,this.direction2)}}class I{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=b,this.radiusRange=n,this.directionRandomizer=i}startDirectionFunction(b,n,i,V){const Q=i.position.un(b.getTranslation()).normalize(),U=(0,B.RandomRange)(0,this.directionRandomizer),Y=(0,B.RandomRange)(0,this.directionRandomizer),L=(0,B.RandomRange)(0,this.directionRandomizer);Q.x+=U,Q.y+=Y,Q.z+=L,Q.normalize(),V?n.L(Q):e.On.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,b,n)}startPositionFunction(b,n,i,V){const Q=this.radius-(0,B.RandomRange)(0,this.radius*this.radiusRange),U=(0,B.RandomRange)(0,1),Y=(0,B.RandomRange)(0,2*Math.PI),L=Math.acos(2*U-1),mb=Q*Math.cos(Y)*Math.sin(L),N=Q*Math.cos(L),Z=Q*Math.sin(Y)*Math.sin(L);V?n.re(mb,Math.abs(N),Z):e.On.TransformCoordinatesFromFloatsToRef(mb,Math.abs(N),Z,b,n)}clone(){const b=new I(this.radius,this.directionRandomizer);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class O{constructor(){this.direction1=new e.On(0,1,0),this.direction2=new e.On(0,1,0)}startDirectionFunction(b,n,i,V){const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),U=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,B.RandomRange)(this.direction1.z,this.direction2.z);V?n.re(Q,U,Y):e.On.TransformNormalFromFloatsToRef(Q,U,Y,b,n)}startPositionFunction(b,n,i,V){V?n.re(0,0,0):e.On.TransformCoordinatesFromFloatsToRef(0,0,0,b,n)}clone(){const b=new O;return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.direction1=this.direction1.ye(),b.direction2=this.direction2.ye(),b}parse(b){e.On.FromArrayToRef(b.direction1,0,this.direction1),e.On.FromArrayToRef(b.direction2,0,this.direction2)}}class u{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=b,this.radiusRange=n,this.directionRandomizer=i}startDirectionFunction(b,n,i,V){const Q=i.position.un(b.getTranslation()).normalize(),U=(0,B.RandomRange)(0,this.directionRandomizer),Y=(0,B.RandomRange)(0,this.directionRandomizer),L=(0,B.RandomRange)(0,this.directionRandomizer);Q.x+=U,Q.y+=Y,Q.z+=L,Q.normalize(),V?n.L(Q):e.On.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,b,n)}startPositionFunction(b,n,i,V){const Q=this.radius-(0,B.RandomRange)(0,this.radius*this.radiusRange),U=(0,B.RandomRange)(0,1),Y=(0,B.RandomRange)(0,2*Math.PI),L=Math.acos(2*U-1),mb=Q*Math.cos(Y)*Math.sin(L),N=Q*Math.cos(L),Z=Q*Math.sin(Y)*Math.sin(L);V?n.re(mb,N,Z):e.On.TransformCoordinatesFromFloatsToRef(mb,N,Z,b,n)}clone(){const b=new u(this.radius,this.directionRandomizer);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class d extends u{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.On(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0);super(b),this.direction1=n,this.direction2=i}startDirectionFunction(b,n){const i=(0,B.RandomRange)(this.direction1.x,this.direction2.x),V=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,B.RandomRange)(this.direction1.z,this.direction2.z);e.On.TransformNormalFromFloatsToRef(i,V,Q,b,n)}clone(){const b=new d(this.radius,this.direction1,this.direction2);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.ye(),b.direction2=this.direction2.ye(),b}parse(b){super.parse(b),this.direction1.L(b.direction1),this.direction2.L(b.direction2)}}class G{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(b,n,i,V){const Q=e.TmpVectors.On[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,i,Q);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,i,Q);const b=e.TmpVectors.On[1];Q.subtractToRef(i.position,b),b.scaleToRef(1/i.lifeTime,Q)}else Q.set(0,0,0);V?n.L(Q):e.On.TransformNormalToRef(Q,b,n)}startPositionFunction(b,n,i,V){const Q=e.TmpVectors.On[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,i,Q):Q.set(0,0,0),V?n.L(Q):e.On.TransformCoordinatesToRef(Q,b,n)}clone(){const b=new G;return mb.e.DeepCopy(this,b),b}applyToShader(b){}buildUniformLayout(b){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.particlePositionGenerator=this.particlePositionGenerator,b.particleDestinationGenerator=this.particleDestinationGenerator,b}parse(b){b.particlePositionGenerator&&(this.particlePositionGenerator=b.particlePositionGenerator),b.particleDestinationGenerator&&(this.particleDestinationGenerator=b.particleDestinationGenerator)}}var o=i(11842);class M{get mesh(){return this._mesh}set mesh(b){this._mesh!==b&&(this._mesh=b,b?(this._indices=b.Je(),this._positions=b.getVerticesData(o.g.PositionKind),this._normals=b.getVerticesData(o.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=e.On.Zero(),this._mesh=null,this.direction1=new e.On(0,1,0),this.direction2=new e.On(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=b}startDirectionFunction(b,n,i,V){if(this.useMeshNormalsForDirection&&this._normals)return void e.On.TransformNormalToRef(this._storedNormal,b,n);const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),U=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,B.RandomRange)(this.direction1.z,this.direction2.z);V?n.re(Q,U,Y):e.On.TransformNormalFromFloatsToRef(Q,U,Y,b,n)}startPositionFunction(b,n,i,V){if(!this._indices||!this._positions)return;const Q=3*(Math.random()*(this._indices.length/3)|0),U=Math.random(),Y=Math.random()*(1-U),L=1-U-Y,B=this._indices[Q],mb=this._indices[Q+1],N=this._indices[Q+2],Z=e.TmpVectors.On[0],T=e.TmpVectors.On[1],z=e.TmpVectors.On[2],K=e.TmpVectors.On[3];e.On.FromArrayToRef(this._positions,3*B,Z),e.On.FromArrayToRef(this._positions,3*mb,T),e.On.FromArrayToRef(this._positions,3*N,z),K.x=U*Z.x+Y*T.x+L*z.x,K.y=U*Z.y+Y*T.y+L*z.y,K.z=U*Z.z+Y*T.z+L*z.z,V?n.re(K.x,K.y,K.z):e.On.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,b,n),this.useMeshNormalsForDirection&&this._normals&&(e.On.FromArrayToRef(this._normals,3*B,Z),e.On.FromArrayToRef(this._normals,3*mb,T),e.On.FromArrayToRef(this._normals,3*N,z),this._storedNormal.x=U*Z.x+Y*T.x+L*z.x,this._storedNormal.y=U*Z.y+Y*T.y+L*z.y,this._storedNormal.z=U*Z.z+Y*T.z+L*z.z)}clone(){const b=new M(this.mesh);return mb.e.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var b;const n={};return n.type=this.getClassName(),n.direction1=this.direction1.ye(),n.direction2=this.direction2.ye(),n.meshId=null===(b=this.mesh)||void 0===b?void 0:b.id,n.useMeshNormalsForDirection=this.useMeshNormalsForDirection,n}parse(b,n){e.On.FromArrayToRef(b.direction1,0,this.direction1),e.On.FromArrayToRef(b.direction2,0,this.direction2),b.meshId&&n&&(this.mesh=n.getLastMeshById(b.meshId)),this.useMeshNormalsForDirection=b.useMeshNormalsForDirection}}class j{_isUbo(b){return void 0!==b.addUniform}constructor(b){this._isUbo(b)?(this.setMatrix3x3=b.updateMatrix3x3.bind(b),this.setMatrix2x2=b.updateMatrix2x2.bind(b),this.setFloat=b.updateFloat.bind(b),this.setFloat2=b.updateFloat2.bind(b),this.setFloat3=b.updateFloat3.bind(b),this.setFloat4=b.updateFloat4.bind(b),this.setFloatArray=b.updateFloatArray.bind(b),this.setArray=b.updateArray.bind(b),this.setIntArray=b.updateIntArray.bind(b),this.setMatrix=b.Ee.bind(b),this.setMatrices=b.updateMatrices.bind(b),this.setVector3=b.updateVector3.bind(b),this.setVector4=b.updateVector4.bind(b),this.setColor3=b.updateColor3.bind(b),this.setColor4=b.updateColor4.bind(b),this.setDirectColor4=b.updateDirectColor4.bind(b),this.setInt=b.updateInt.bind(b),this.setInt2=b.updateInt2.bind(b),this.setInt3=b.updateInt3.bind(b),this.setInt4=b.updateInt4.bind(b)):(this.setMatrix3x3=b.setMatrix3x3.bind(b),this.setMatrix2x2=b.setMatrix2x2.bind(b),this.setFloat=b.setFloat.bind(b),this.setFloat2=b.setFloat2.bind(b),this.setFloat3=b.setFloat3.bind(b),this.setFloat4=b.setFloat4.bind(b),this.setFloatArray=b.setFloatArray.bind(b),this.setArray=b.setArray.bind(b),this.setIntArray=b.setIntArray.bind(b),this.setMatrix=b.setMatrix.bind(b),this.setMatrices=b.setMatrices.bind(b),this.setVector3=b.setVector3.bind(b),this.setVector4=b.setVector4.bind(b),this.setColor3=b.setColor3.bind(b),this.setColor4=b.setColor4.bind(b),this.setDirectColor4=b.setDirectColor4.bind(b),this.setInt=b.setInt.bind(b),this.setInt2=b.setInt2.bind(b),this.setInt3=b.setInt3.bind(b),this.setInt4=b.setInt4.bind(b))}}var a=i(11686);const D="gpuUpdateParticlesPixelShader",x="#version 300 es\nvoid main() {discard;}\n";a.c.ShadersStore[D]||(a.c.ShadersStore[D]=x);const y="gpuUpdateParticlesVertexShader",s="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";a.c.ShadersStore[y]||(a.c.ShadersStore[y]=s);(0,Y.i)("BABYLON.WebGL2ParticleSystem",class{constructor(b,n){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=b,this._engine=n,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var b;return(null===(b=this._updateEffect)||void 0===b?void 0:b.isReady())??!1}createUpdateBuffer(b){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof G&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=b,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new j(this._updateEffect)}createVertexBuffers(b,n){this._updateVAO.push(this._createUpdateVAO(b)),this._renderVAO.push(this._engine.recordVertexArrayObject(n,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=n}createParticleBuffer(b){return b}bindDrawBuffers(b,n,i){i?this._engine.bindBuffers(this._renderVertexBuffers,i,n):this._engine.bindVertexArrayObject(this._renderVAO[b],null)}preUpdateParticleBuffer(){const b=this._engine;if(this._engine.enableEffect(this._updateEffect),!b.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(b,n,i){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[b],null);const e=this._engine;e.bindTransformFeedbackBuffer(n.getBuffer()),e.setRasterizerState(!1),e.beginTransformFeedback(!0),e.drawArraysType(3,0,i),e.endTransformFeedback(),e.setRasterizerState(!0),e.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let b=0;b<this._updateVAO.length;b++)this._engine.releaseVertexArrayObject(this._updateVAO[b]);this._updateVAO.length=0;for(let b=0;b<this._renderVAO.length;b++)this._engine.releaseVertexArrayObject(this._renderVAO[b]);this._renderVAO.length=0}_createUpdateVAO(b){const n={};n.position=b.createVertexBuffer("position",0,3);let i=3;n.age=b.createVertexBuffer("age",i,1),i+=1,n.size=b.createVertexBuffer("size",i,3),i+=3,n.life=b.createVertexBuffer("life",i,1),i+=1,n.seed=b.createVertexBuffer("seed",i,4),i+=4,n.direction=b.createVertexBuffer("direction",i,3),i+=3,this._parent.particleEmitterType instanceof G&&(n.initialPosition=b.createVertexBuffer("initialPosition",i,3),i+=3),this._parent._colorGradientsTexture||(n.color=b.createVertexBuffer("color",i,4),i+=4),this._parent._isBillboardBased||(n.initialDirection=b.createVertexBuffer("initialDirection",i,3),i+=3),this._parent.noiseTexture&&(n.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",i,3),i+=3,n.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",i,3),i+=3),this._parent._angularSpeedGradientsTexture?(n.angle=b.createVertexBuffer("angle",i,1),i+=1):(n.angle=b.createVertexBuffer("angle",i,2),i+=2),this._parent._isAnimationSheetEnabled&&(n.cellIndex=b.createVertexBuffer("cellIndex",i,1),i+=1,this._parent.spriteRandomStartCell&&(n.cellStartOffset=b.createVertexBuffer("cellStartOffset",i,1),i+=1));const e=this._engine.recordVertexArrayObject(n,null,this._updateEffect);return this._engine.bindArrayBuffer(null),e}});class A{constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,e=arguments.length>3?arguments[3]:void 0;this._engine=b,this._label=e,this._engine._storageBuffers.push(this),this._create(n,i)}_create(b,n){this._bufferSize=b,this._creationFlags=n,this._buffer=this._engine.createStorageBuffer(b,n,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(b,n,i){this._buffer&&this._engine.updateStorageBuffer(this._buffer,b,n,i)}async read(b,n,i,e){return await this._engine.readFromStorageBuffer(this._buffer,b,n,i,e)}dispose(){const b=this._engine._storageBuffers,n=b.indexOf(this);-1!==n&&(b[n]=b[b.length-1],b.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var E=i(11756),C=i(11762),t=i(11811),w=i(11748),h=i(12073),W=i(11621),J=i(11713),R=i(11986);class k{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.e}_addDuration(b,n){b<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==b?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(n,!1),this._gpuTimeInFrameId=b):this.counter.addCount(n,!1))}}var r=i(11674);class X{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=b,this._engine=n,this.uniqueId=h.e.UniqueId,n.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new k),this._engine.getCaps().supportComputeShaders?e.bindingsMapping?(this._context=n.createComputeContext(),this._shaderPath=i,this._options={bindingsMapping:{},defines:[],...e}):W.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):W.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(b,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const e=this._bindings[b];this._bindings[b]={type:i?0:4,object:n,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!e||e.object!==n||e.type!==this._bindings[b].type)}setStorageTexture(b,n){const i=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==n),this._bindings[b]={type:1,object:n,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setExternalTexture(b,n){const i=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==n),this._bindings[b]={type:6,object:n,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setVideoTexture(b,n){return!!n.externalTexture&&(this.setExternalTexture(b,n.externalTexture),!0)}setUniformBuffer(b,n){const i=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==n),this._bindings[b]={type:X._BufferIsDataBuffer(n)?7:2,object:n,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setStorageBuffer(b,n){const i=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==n),this._bindings[b]={type:X._BufferIsDataBuffer(n)?7:3,object:n,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setTextureSampler(b,n){const i=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!i||!n.compareSampler(i.object)),this._bindings[b]={type:5,object:n,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}isReady(){let b=this._effect;for(const V in this._bindings){const b=this._bindings[V],n=b.type,i=b.object;switch(n){case 0:case 4:case 1:if(!i.isReady())return!1;break;case 6:if(!i.isReady())return!1;break}}const n=[],i=this._shaderPath;if(this._options.defines)for(let V=0;V<this._options.defines.length;V++)n.push(this._options.defines[V]);const e=n.join("\n");return this._cachedDefines!==e&&(this._cachedDefines=e,b=this._engine.createComputeEffect(i,{defines:e,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=b),!!b.isReady()}dispatch(b,n,i){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,b,n,i,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const i=X._BufferIsDataBuffer(b)?b:b.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,i,n,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const n in this._bindings){const i=this._bindings[n];if(!this._options.bindingsMapping[n])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+n+"'");switch(i.type){case 0:{const e=this._samplers[n],V=i.object;var b;if(!e||!V._texture||!e.compareSampler(V._texture))this._samplers[n]=(new J.d).setParameters(V.wrapU,V.wrapV,V.wrapR,V.anisotropicFilteringLevel,V._texture.samplingMode,null===(b=V._texture)||void 0===b?void 0:b._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const b=i.object;b.getBuffer()!==i.buffer&&(i.buffer=b.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((V=>{(0,r.f)((()=>this.dispatch(b,n,i)),V,void 0,e)}))}serialize(){const b=t.c.Serialize(this);b.options=this._options,b.shaderPath=this._shaderPath,b.fN={},b.textures={};for(const n in this._bindings){const i=this._bindings[n],e=i.object;switch(i.type){case 0:case 4:case 1:{const V=e.serialize();V&&(b.textures[n]=V,b.fN[n]={type:i.type});break}}}return b}static Parse(b,n,i){const e=t.c.Parse((()=>new X(b.name,n.getEngine(),b.shaderPath,b.options)),b,n,i);for(const V in b.textures){const Q=b.fN[V],U=w.e.Parse(b.textures[V],n,i);0===Q.type?e.setTexture(V,U):4===Q.type?e.setTexture(V,U,!1):e.setStorageTexture(V,U)}return e}static _BufferIsDataBuffer(b){return void 0!==b.underlyingResource}}(0,E.e)([(0,C.W)()],X.prototype,"name",void 0),(0,E.e)([(0,C.W)()],X.prototype,"fastMode",void 0),(0,Y.i)("BABYLON.ComputeShader",X);var g=i(12022);const P="gpuUpdateParticlesComputeShader",c="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";a.c.ShadersStoreWGSL[P]||(a.c.ShadersStoreWGSL[P]=c);(0,Y.i)("BABYLON.ComputeShaderParticleSystem",class{constructor(b,n){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=b,this._engine=n}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var b;return(null===(b=this._updateComputeShader)||void 0===b?void 0:b.isReady())??!1}createUpdateBuffer(b){var n;const i={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(i.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(i.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(i.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(i.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(i.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(i.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(i.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new X("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:i,defines:b.split("\n")}),null===(n=this._simParamsComputeShader)||void 0===n||n.dispose(),this._simParamsComputeShader=new g.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new j(this._simParamsComputeShader)}createVertexBuffers(b,n){this._renderVertexBuffers.push(n)}createParticleBuffer(b){const n=new A(this._engine,4*b.length,11,"ComputeShaderParticleSystemBuffer");return n.update(b),this._bufferComputeShader.push(n),n.getBuffer()}bindDrawBuffers(b,n,i){this._engine.bindBuffers(this._renderVertexBuffers[b],i,n)}preUpdateParticleBuffer(){}updateParticleBuffer(b,n,i){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[b]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^b]),this._updateComputeShader.dispatch(Math.ceil(i/64))}releaseBuffers(){var b;for(let n=0;n<this._bufferComputeShader.length;++n)this._bufferComputeShader[n].dispose();this._bufferComputeShader.length=0,null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class q{constructor(b,n,i){this.gradient=b,this.color1=n,this.color2=i}getColorToRef(b){this.color2?U.IV.LerpToRef(this.color1,this.color2,Math.random(),b):b.L(this.color1)}}class S{constructor(b,n){this.gradient=b,this.color=n}}class H{constructor(b,n,i){this.gradient=b,this.factor1=n,this.factor2=i}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class l{static GetCurrentGradient(b,n,i){if(n[0].gradient>b)return void i(n[0],n[0],1);for(let V=0;V<n.length-1;V++){const e=n[V],Q=n[V+1];if(b>=e.gradient&&b<=Q.gradient){return void i(e,Q,(b-e.gradient)/(Q.gradient-e.gradient))}}const e=n.length-1;i(n[e],n[e],1)}}var v=i(11612),p=i(12244),f=i(11646);class F{constructor(b){this.particleSystem=b,this.position=e.On.Zero(),this.direction=e.On.Zero(),this.color=new U.IV(0,0,0,0),this.colorStep=new U.IV(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new e.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new U.IV(0,0,0,0),this._currentColor2=new U.IV(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=F._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let b=this.age,n=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===n?(n=1,b=this._randomCellOffset):b+=this._randomCellOffset);const i=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let e;e=this._initialSpriteCellLoop?(0,B.Clamp)(b*n%this.lifeTime/this.lifeTime):(0,B.Clamp)(b*n/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+e*i|0}_inheritParticleInfoToSubEmitter(b){if(b.particleSystem.Un.position){const n=b.particleSystem.Un;if(n.position.L(this.position),b.inheritDirection){const b=e.TmpVectors.On[0];this.direction.normalizeToRef(b),n.setDirection(b,0,Math.PI/2)}}else{b.particleSystem.Un.L(this.position)}this.direction.scaleToRef(b.inheritedVelocityAmount/2,e.TmpVectors.On[0]),b.particleSystem._inheritedVelocityOffset.L(e.TmpVectors.On[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const b of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(b)}_reset(){this.age=0,this.id=F._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(b){b.position.L(this.position),this._initialDirection?b._initialDirection?b._initialDirection.L(this._initialDirection):b._initialDirection=this._initialDirection.clone():b._initialDirection=null,b.direction.L(this.direction),this.rY&&(b.rY?b.rY.L(this.rY):b.rY=this.rY.clone()),b.color.L(this.color),b.colorStep.L(this.colorStep),b.lifeTime=this.lifeTime,b.age=this.age,b._randomCellOffset=this._randomCellOffset,b.size=this.size,b.scale.L(this.scale),b.angle=this.angle,b.angularSpeed=this.angularSpeed,b.particleSystem=this.particleSystem,b.cellIndex=this.cellIndex,b.id=this.id,b._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(b._currentColorGradient=this._currentColorGradient,b._currentColor1.L(this._currentColor1),b._currentColor2.L(this._currentColor2)),this._currentSizeGradient&&(b._currentSizeGradient=this._currentSizeGradient,b._currentSize1=this._currentSize1,b._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(b._currentAngularSpeedGradient=this._currentAngularSpeedGradient,b._currentAngularSpeed1=this._currentAngularSpeed1,b._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(b._currentVelocityGradient=this._currentVelocityGradient,b._currentVelocity1=this._currentVelocity1,b._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(b._currentLimitVelocityGradient=this._currentLimitVelocityGradient,b._currentLimitVelocity1=this._currentLimitVelocity1,b._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(b._currentDragGradient=this._currentDragGradient,b._currentDrag1=this._currentDrag1,b._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(b._initialStartSpriteCellId=this._initialStartSpriteCellId,b._initialEndSpriteCellId=this._initialEndSpriteCellId,b._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(b.remapData&&this.remapData?b.remapData.L(this.remapData):b.remapData=new e.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.L(this._randomNoiseCoordinates1),b._randomNoiseCoordinates2.L(this._randomNoiseCoordinates2)):(b._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),b._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}F._Count=0;var bb=i(11883),nb=(i(11932),i(12142)),ib=i(12134),eb=i(12019);function Vb(b,n){const i=(0,B.RandomRange)(0,1);U.IV.LerpToRef(n.color1,n.color2,i,b.color),n.colorDead.subtractToRef(b.color,n._colorDiff),n._colorDiff.scaleToRef(1/b.lifeTime,b.colorStep)}function Qb(b,n){b._currentColorGradient=n._colorGradients[0],b._currentColorGradient.getColorToRef(b.color),b._currentColor1.L(b.color),n._colorGradients.length>1?n._colorGradients[1].getColorToRef(b._currentColor2):b._currentColor2.L(b.color)}function Ub(b,n){const i=n._colorGradients;l.GetCurrentGradient(n._ratio,i,((n,i,e)=>{n!==b._currentColorGradient&&(b._currentColor1.L(b._currentColor2),i.getColorToRef(b._currentColor2),b._currentColorGradient=n),U.IV.LerpToRef(b._currentColor1,b._currentColor2,e,b.color)}))}function Yb(b,n){b.colorStep.scaleToRef(n._scaledUpdateSpeed,n._scaledColorStep),b.color.addInPlace(n._scaledColorStep),b.color.a<0&&(b.color.a=0)}function Lb(b,n){l.GetCurrentGradient(n._ratio,n._angularSpeedGradients,((n,i,e)=>{n!==b._currentAngularSpeedGradient&&(b._currentAngularSpeed1=b._currentAngularSpeed2,b._currentAngularSpeed2=i.getFactor(),b._currentAngularSpeedGradient=n),b.angularSpeed=(0,B.Lerp)(b._currentAngularSpeed1,b._currentAngularSpeed2,e)}))}function Bb(b,n){b.angle+=b.angularSpeed*n._scaledUpdateSpeed}function mn(b,n){n.particleEmitterType.startDirectionFunction(n._emitterWorldMatrix,b.direction,b,n.isLocal,n._emitterInverseWorldMatrix)}function Nb(b,n){n.startDirectionFunction(n._emitterWorldMatrix,b.direction,b,n.isLocal)}function Zb(b,n){b._currentVelocityGradient=n._velocityGradients[0],b._currentVelocity1=b._currentVelocityGradient.getFactor(),n._velocityGradients.length>1?b._currentVelocity2=n._velocityGradients[1].getFactor():b._currentVelocity2=b._currentVelocity1}function Tb(b,n){b._currentLimitVelocityGradient=n._limitVelocityGradients[0],b._currentLimitVelocity1=b._currentLimitVelocityGradient.getFactor(),n._limitVelocityGradients.length>1?b._currentLimitVelocity2=n._limitVelocityGradients[1].getFactor():b._currentLimitVelocity2=b._currentLimitVelocity1}function zb(b,n){l.GetCurrentGradient(n._ratio,n._velocityGradients,((i,e,V)=>{i!==b._currentVelocityGradient&&(b._currentVelocity1=b._currentVelocity2,b._currentVelocity2=e.getFactor(),b._currentVelocityGradient=i),n._directionScale*=(0,B.Lerp)(b._currentVelocity1,b._currentVelocity2,V)}))}function Kb(b,n){l.GetCurrentGradient(n._ratio,n._limitVelocityGradients,((i,e,V)=>{i!==b._currentLimitVelocityGradient&&(b._currentLimitVelocity1=b._currentLimitVelocity2,b._currentLimitVelocity2=e.getFactor(),b._currentLimitVelocityGradient=i);const Q=(0,B.Lerp)(b._currentLimitVelocity1,b._currentLimitVelocity2,V);b.direction.length()>Q&&b.direction.scaleInPlace(n.limitVelocityDamping)}))}function Ib(b,n){b.direction.scaleToRef(n._directionScale,n._scaledDirection)}function Ob(b,n){n.particleEmitterType.startPositionFunction(n._emitterWorldMatrix,b.position,b,n.isLocal)}function ub(b,n){n.startPositionFunction(n._emitterWorldMatrix,b.position,b,n.isLocal)}function db(b,n){b.rY?b.rY.L(b.position):b.rY=b.position.clone(),e.On.TransformCoordinatesToRef(b.rY,n._emitterWorldMatrix,b.position)}function Gb(b,n){n.isLocal&&b.rY?(b.rY.addInPlace(n._scaledDirection),e.On.TransformCoordinatesToRef(b.rY,n._emitterWorldMatrix,b.position)):b.position.addInPlace(n._scaledDirection)}function ob(b,n){b._currentDragGradient=n._dragGradients[0],b._currentDrag1=b._currentDragGradient.getFactor(),n._dragGradients.length>1?b._currentDrag2=n._dragGradients[1].getFactor():b._currentDrag2=b._currentDrag1}function Mb(b,n){l.GetCurrentGradient(n._ratio,n._dragGradients,((i,e,V)=>{i!==b._currentDragGradient&&(b._currentDrag1=b._currentDrag2,b._currentDrag2=e.getFactor(),b._currentDragGradient=i);const Q=(0,B.Lerp)(b._currentDrag1,b._currentDrag2,V);n._scaledDirection.scaleInPlace(1-Q)}))}function jb(b,n){b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.re(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2.re(Math.random(),Math.random(),Math.random())):(b._randomNoiseCoordinates1=new e.On(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2=new e.On(Math.random(),Math.random(),Math.random()))}function ab(b,n){const i=n._noiseTextureData,V=n._noiseTextureSize;if(i&&V&&b._randomNoiseCoordinates1){const Q=n._fetchR(b._randomNoiseCoordinates1.x,b._randomNoiseCoordinates1.y,V.width,V.height,i),U=n._fetchR(b._randomNoiseCoordinates1.z,b._randomNoiseCoordinates2.x,V.width,V.height,i),Y=n._fetchR(b._randomNoiseCoordinates2.y,b._randomNoiseCoordinates2.z,V.width,V.height,i),L=e.TmpVectors.On[0],B=e.TmpVectors.On[1];L.re((2*Q-1)*n.noiseStrength.x,(2*U-1)*n.noiseStrength.y,(2*Y-1)*n.noiseStrength.z),L.scaleToRef(n._tempScaledUpdateSpeed,B),b.direction.addInPlace(B)}}function Db(b,n){n.gravity.scaleToRef(n._tempScaledUpdateSpeed,n._scaledGravity),b.direction.addInPlace(n._scaledGravity)}function xb(b,n){b.size=(0,B.RandomRange)(n.minSize,n.maxSize),b.scale.re((0,B.RandomRange)(n.minScaleX,n.maxScaleX),(0,B.RandomRange)(n.minScaleY,n.maxScaleY))}function yb(b,n){b._currentSizeGradient=n._sizeGradients[0],b._currentSize1=b._currentSizeGradient.getFactor(),b.size=b._currentSize1,n._sizeGradients.length>1?b._currentSize2=n._sizeGradients[1].getFactor():b._currentSize2=b._currentSize1,b.scale.re((0,B.RandomRange)(n.minScaleX,n.maxScaleX),(0,B.RandomRange)(n.minScaleY,n.maxScaleY))}function sb(b,n){const i=n._actualFrame/n.targetStopDuration;l.GetCurrentGradient(i,n._startSizeGradients,((i,e,V)=>{i!==n._currentStartSizeGradient&&(n._currentStartSize1=n._currentStartSize2,n._currentStartSize2=e.getFactor(),n._currentStartSizeGradient=i);const Q=(0,B.Lerp)(n._currentStartSize1,n._currentStartSize2,V);b.scale.scaleInPlace(Q)}))}function Ab(b,n){l.GetCurrentGradient(n._ratio,n._sizeGradients,((n,i,e)=>{n!==b._currentSizeGradient&&(b._currentSize1=b._currentSize2,b._currentSize2=i.getFactor(),b._currentSizeGradient=n),b.size=(0,B.Lerp)(b._currentSize1,b._currentSize2,e)}))}function Eb(b,n){b.remapData=new e.Vector4(0,1,0,1)}function Cb(b,n){n._colorRemapGradients&&n._colorRemapGradients.length>0&&l.GetCurrentGradient(n._ratio,n._colorRemapGradients,((n,i,e)=>{const V=(0,B.Lerp)(n.factor1,i.factor1,e),Q=(0,B.Lerp)(n.factor2,i.factor2,e);b.remapData.x=V,b.remapData.y=Q-V})),n._alphaRemapGradients&&n._alphaRemapGradients.length>0&&l.GetCurrentGradient(n._ratio,n._alphaRemapGradients,((n,i,e)=>{const V=(0,B.Lerp)(n.factor1,i.factor1,e),Q=(0,B.Lerp)(n.factor2,i.factor2,e);b.remapData.z=V,b.remapData.w=Q-V}))}function tb(b,n){const i=(0,B.Clamp)(n._actualFrame/n.targetStopDuration);l.GetCurrentGradient(i,n._lifeTimeGradients,((n,e)=>{const V=n,Q=e,U=V.getFactor(),Y=Q.getFactor(),L=(i-V.gradient)/(Q.gradient-V.gradient);b.lifeTime=(0,B.Lerp)(U,Y,L)})),n._emitPower=(0,B.RandomRange)(n.minEmitPower,n.maxEmitPower)}function wb(b,n){b.lifeTime=(0,B.RandomRange)(n.minLifeTime,n.maxLifeTime),n._emitPower=(0,B.RandomRange)(n.minEmitPower,n.maxEmitPower)}function hb(b,n){0===n._emitPower?(b._initialDirection?b._initialDirection.L(b.direction):b._initialDirection=b.direction.clone(),b.direction.set(0,0,0)):(b._initialDirection=null,b.direction.scaleInPlace(n._emitPower)),b.direction.addInPlace(n._inheritedVelocityOffset)}function Wb(b,n){b.angularSpeed=(0,B.RandomRange)(n.minAngularSpeed,n.maxAngularSpeed),b.angle=(0,B.RandomRange)(n.minInitialRotation,n.maxInitialRotation)}function Jb(b,n){b._currentAngularSpeedGradient=n._angularSpeedGradients[0],b.angularSpeed=b._currentAngularSpeedGradient.getFactor(),b._currentAngularSpeed1=b.angularSpeed,n._angularSpeedGradients.length>1?b._currentAngularSpeed2=n._angularSpeedGradients[1].getFactor():b._currentAngularSpeed2=b._currentAngularSpeed1,b.angle=(0,B.RandomRange)(n.minInitialRotation,n.maxInitialRotation)}function Rb(b,n){b._initialStartSpriteCellId=n.startSpriteCellID,b._initialEndSpriteCellId=n.endSpriteCellID,b._initialSpriteCellLoop=n.spriteCellLoop}function kb(b,n){b.previousItem=n.previousItem,b.nextItem=n,n.previousItem&&(n.previousItem.nextItem=b),n.previousItem=b}function rb(b,n){b.previousItem=n,b.nextItem=n.nextItem,n.nextItem&&(n.nextItem.previousItem=b),n.nextItem=b}function Xb(b,n){let i=n;for(;i.nextItem;)i=i.nextItem;b.previousItem=i,b.nextItem=i.nextItem,i.nextItem=b}function gb(b){b.previousItem&&(b.previousItem.nextItem=b.nextItem),b.nextItem&&(b.nextItem.previousItem=b.previousItem)}class Pb extends L{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(b){this._startDirectionFunction!==b&&(this._startDirectionFunction=b,this._directionProcessing.process=b?Nb:mn)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(b){this._startPositionFunction!==b&&(this._startPositionFunction=b,this._positionCreation.process=b?ub:Ob)}set onDispose(b){this._onDisposeObserver&&this.Qe.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qe.add(b)}get N(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(b){this._useRampGradients!==b&&(this._useRampGradients=b,this._resetEffect(),b?(this._rampCreation={process:Eb,previousItem:null,nextItem:null},rb(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Cb,previousItem:null,nextItem:null},rb(this._remapGradientProcessing,this._gravityProcessing)):(gb(this._rampCreation),gb(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(b){this._isLocal!==b&&(this._isLocal=b,b?(this._isLocalCreation={process:db,previousItem:null,nextItem:null},rb(this._isLocalCreation,this._positionCreation)):gb(this._isLocalCreation))}get particles(){return this.SN}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(b){this._animationSheetEnabled!==b&&(this._animationSheetEnabled=b,b?(this._sheetCreation={process:Rb,previousItem:null,nextItem:null},rb(this._sheetCreation,this._colorCreation)):gb(this._sheetCreation),this._reset())}getActiveCount(){return this.SN.length}getClassName(){return"dZ"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var b;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(b=this._customWrappers[n])||void 0===b?void 0:b.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[b]??this._customWrappers[0]}setCustomEffect(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[n]=new bb.b(this._engine),this._customWrappers[n].effect=b,this._customWrappers[n].drawContext&&(this._customWrappers[n].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(b){if(this.noiseTexture!==b){if(this._noiseTexture=b,!b)return gb(this._noiseCreation),void gb(this._noiseProcessing);this._noiseCreation={process:jb,previousItem:null,nextItem:null},rb(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ab,previousItem:null,nextItem:null},rb(this._noiseProcessing,this._positionProcessing)}}constructor(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(b),this._emitterInverseWorldMatrix=e.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new e.On,this.Qe=new v.e,this.onStoppedObservable=new v.e,this.onStartedObservable=new v.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.SN=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new U.IV(0,0,0,0),this._colorDiff=new U.IV(0,0,0,0),this._scaledDirection=e.On.Zero(),this._scaledGravity=e.On.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=b=>{},this.recycleParticle=b=>{const n=this.SN.pop();n!==b&&n.copyTo(b),this._stockParticles.push(n)},this._createParticle=()=>{let b;return 0!==this._stockParticles.length?(b=this._stockParticles.pop(),b._reset()):b=new F(this),this._prepareParticle(b),b},this.paused=!1,this._shadersLoaded=!1,this._capacity=n,this._epsilon=Y,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=e.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||f.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.cN.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:wb,previousItem:null,nextItem:null},this._positionCreation={process:Ob,previousItem:null,nextItem:null},rb(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:mn,previousItem:null,nextItem:null},rb(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:hb,previousItem:null,nextItem:null},rb(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:xb,previousItem:null,nextItem:null},rb(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Wb,previousItem:null,nextItem:null},rb(this._angleCreation,this._sizeCreation),this._colorCreation={process:Vb,previousItem:null,nextItem:null},rb(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,L||(this._colorProcessing={process:Yb,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Bb,previousItem:null,nextItem:null},rb(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Ib,previousItem:null,nextItem:null},rb(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Gb,previousItem:null,nextItem:null},rb(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Db,previousItem:null,nextItem:null},rb(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Q,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new bb.b(this._engine)},this._customWrappers[0].effect=V,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new N,this.updateFunction=b=>{var n;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(n=this.noiseTexture.getContent())||void 0===n||n.then((b=>{this._noiseTextureData=b})));const i=b===this.SN;for(let e=0;e<b.length;e++){const n=b[e];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const V=n.age;if(n.age+=this._tempScaledUpdateSpeed,n.age>n.lifeTime){const b=n.age-V,i=n.lifeTime-V;this._tempScaledUpdateSpeed=i*this._tempScaledUpdateSpeed/b,n.age=n.lifeTime}this._ratio=n.age/n.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Q=this._updateQueueStart;for(;Q;)Q.process(n,this),Q=Q.nextItem;if(this._isAnimationSheetEnabled&&!L&&n.updateCellIndex(),n._inheritParticleInfoToSubEmitters(),n.age>=n.lifeTime){if(this._emitFromParticle(n),n._attachedSubEmitters){for(const b of n._attachedSubEmitters)b.particleSystem.disposeOnStop=!0,b.particleSystem.stop();n._attachedSubEmitters=null}this.recycleParticle(n),i&&e--}else;}}}serialize(b){throw new Error("Method not implemented.")}clone(b,n){throw new Error("Method not implemented.")}_addFactorGradient(b,n,i,e){const V=new H(n,i,e);b.push(V),b.sort(((b,n)=>b.gradient<n.gradient?-1:b.gradient>n.gradient?1:0))}_removeFactorGradient(b,n){if(!b)return;let i=0;for(const e of b){if(e.gradient===n){b.splice(i,1);break}i++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=tb:this._lifeTimeCreation.process=wb}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:sb,previousItem:null,nextItem:null},rb(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(gb(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(b){this.targetStopDuration!==b&&(this._targetStopDuration=b,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(b,n,i){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,b,n,i),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(b){return this._removeFactorGradient(this._lifeTimeGradients,b),this._syncLifeTimeCreation(),this}addSizeGradient(b,n,i){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=yb,this._sizeGradientProcessing={process:Ab,previousItem:null,nextItem:null},kb(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,b,n,i),this}removeSizeGradient(b){var n;return this._removeFactorGradient(this._sizeGradients,b),0===(null===(n=this._sizeGradients)||void 0===n?void 0:n.length)&&(gb(this._sizeGradientProcessing),this._sizeCreation.process=xb),this}addColorRemapGradient(b,n,i){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,b,n,i),this}removeColorRemapGradient(b){return this._removeFactorGradient(this._colorRemapGradients,b),this}addAlphaRemapGradient(b,n,i){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,b,n,i),this}removeAlphaRemapGradient(b){return this._removeFactorGradient(this._alphaRemapGradients,b),this}addAngularSpeedGradient(b,n,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Jb,this._angularSpeedGradientProcessing={process:Lb,previousItem:null,nextItem:null},kb(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,b,n,i),this}removeAngularSpeedGradient(b){var n;return this._removeFactorGradient(this._angularSpeedGradients,b),0===(null===(n=this._angularSpeedGradients)||void 0===n?void 0:n.length)&&(this._angleCreation.process=Wb,gb(this._angularSpeedGradientProcessing)),this}addVelocityGradient(b,n,i){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Zb,previousItem:null,nextItem:null},rb(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:zb,previousItem:null,nextItem:null},kb(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,b,n,i),this}removeVelocityGradient(b){var n;return this._removeFactorGradient(this._velocityGradients,b),0===(null===(n=this._velocityGradients)||void 0===n?void 0:n.length)&&(gb(this._velocityCreation),gb(this._velocityGradientProcessing)),this}addLimitVelocityGradient(b,n,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Tb,previousItem:null,nextItem:null},rb(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Kb,previousItem:null,nextItem:null},rb(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,b,n,i),this}removeLimitVelocityGradient(b){var n;return this._removeFactorGradient(this._limitVelocityGradients,b),0===(null===(n=this._limitVelocityGradients)||void 0===n?void 0:n.length)&&(gb(this._limitVelocityCreation),gb(this._limitVelocityGradientProcessing)),this}addDragGradient(b,n,i){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:ob,previousItem:null,nextItem:null},kb(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Mb,previousItem:null,nextItem:null},kb(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,b,n,i),this}removeDragGradient(b){var n;return this._removeFactorGradient(this._dragGradients,b),0===(null===(n=this._dragGradients)||void 0===n?void 0:n.length)&&(gb(this._dragCreation),gb(this._dragGradientProcessing)),this}addEmitRateGradient(b,n,i){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,b,n,i),this}removeEmitRateGradient(b){return this._removeFactorGradient(this._emitRateGradients,b),this}addStartSizeGradient(b,n,i){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,b,n,i),this._syncStartSizeCreation(),this}removeStartSizeGradient(b){return this._removeFactorGradient(this._startSizeGradients,b),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const b=new Uint8Array(4*this._rawTextureWidth),n=U.TmpColors.Mn[0];for(let i=0;i<this._rawTextureWidth;i++){const e=i/this._rawTextureWidth;l.GetCurrentGradient(e,this._rampGradients,((e,V,Q)=>{U.Mn.LerpToRef(e.color,V.color,Q,n),b[4*i]=255*n.r,b[4*i+1]=255*n.g,b[4*i+2]=255*n.b,b[4*i+3]=255}))}this._rampGradientsTexture=p.d.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((b,n)=>b.gradient<n.gradient?-1:b.gradient>n.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(b,n){this._rampGradients||(this._rampGradients=[]);const i=new S(b,n);return this._rampGradients.push(i),this._syncRampGradientTexture(),this}removeRampGradient(b){return this._removeGradientAndTexture(b,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(b,n,i){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Qb,this._colorProcessing.process=Ub);const e=new q(b,n,i);return this._colorGradients.push(e),this._colorGradients.sort(((b,n)=>b.gradient<n.gradient?-1:b.gradient>n.gradient?1:0)),this}removeColorGradient(b){if(!this._colorGradients)return this;let n=0;for(const i of this._colorGradients){if(i.gradient===b){this._colorGradients.splice(n,1);break}n++}return 0===this._colorGradients.length&&(this._colorCreation.process=Vb,this._colorProcessing.process=Yb),this}resetDrawCache(){if(this._drawWrappers){for(const b of this._drawWrappers)if(b)for(const n of b)null===n||void 0===n||n.dispose();this._drawWrappers=[]}}_fetchR(b,n,i,e,V){return V[4*(((b=.5*Math.abs(b)+.5)*i%i|0)+((n=.5*Math.abs(n)+.5)*e%e|0)*i)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const b=this._engine,n=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*n),this._vertexBuffer=new o.e(b,this._vertexData,!0,n);let i=0;const e=this._vertexBuffer.createVertexBuffer(o.g.PositionKind,i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.g.PositionKind]=e,i+=3;const V=this._vertexBuffer.createVertexBuffer(o.g.ColorKind,i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.g.ColorKind]=V,i+=4;const Q=this._vertexBuffer.createVertexBuffer("angle",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Q,i+=1;const U=this._vertexBuffer.createVertexBuffer("size",i,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=U,i+=2,this._isAnimationSheetEnabled){const b=this._vertexBuffer.createVertexBuffer("cellIndex",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=b,i+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const b=this._vertexBuffer.createVertexBuffer("direction",i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=b,i+=3}if(this._useRampGradients){const b=this._vertexBuffer.createVertexBuffer("remapData",i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=b,i+=4}let Y;if(this._useInstancing){const n=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new o.e(b,n,!1,2),Y=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Y=this._vertexBuffer.createVertexBuffer("offset",i,2,this._vertexBufferSize,this._useInstancing),i+=2;this._vertexBuffers.offset=Y,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const b=[],n=[];let i=0;for(let e=0;e<this._capacity;e++)b.push(i),b.push(i+1),b.push(i+2),b.push(i),b.push(i+2),b.push(i+3),n.push(i,i+1,i+1,i+2,i+2,i+3,i+3,i,i,i+3),i+=4;this._indexBuffer=this._engine.createIndexBuffer(b),this._linesIndexBuffer=this._engine.createIndexBuffer(n)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(b)setTimeout((()=>{this.start(0)}),b);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var n;-1!==(null===(n=this.Un)||void 0===n?void 0:n.getClassName().indexOf("Mesh"))&&this.Un.we(!0);const b=this.noiseTexture;if(b&&b.onGeneratedObservable)b.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let n=0;n<this.preWarmCycles;n++)this.animate(!0),b.render()}))}));else for(let n=0;n<this.preWarmCycles;n++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(b))}_postStop(b){}reset(){this._stockParticles.length=0,this.SN.length=0}_appendParticleVertex(b,n,i,V){let Q=b*this._vertexBufferSize;if(this._vertexData[Q++]=n.position.x+this.YB.x,this._vertexData[Q++]=n.position.y+this.YB.y,this._vertexData[Q++]=n.position.z+this.YB.z,this._vertexData[Q++]=n.color.r,this._vertexData[Q++]=n.color.g,this._vertexData[Q++]=n.color.b,this._vertexData[Q++]=n.color.a,this._vertexData[Q++]=n.angle,this._vertexData[Q++]=n.scale.x*n.size,this._vertexData[Q++]=n.scale.y*n.size,this._isAnimationSheetEnabled&&(this._vertexData[Q++]=n.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Q++]=n.direction.x,this._vertexData[Q++]=n.direction.y,this._vertexData[Q++]=n.direction.z);else if(n._initialDirection){let b=n._initialDirection;this.isLocal&&(e.On.TransformNormalToRef(b,this._emitterWorldMatrix,e.TmpVectors.On[0]),b=e.TmpVectors.On[0]),0===b.x&&0===b.z&&(b.x=.001),this._vertexData[Q++]=b.x,this._vertexData[Q++]=b.y,this._vertexData[Q++]=b.z}else{let b=n.direction;this.isLocal&&(e.On.TransformNormalToRef(b,this._emitterWorldMatrix,e.TmpVectors.On[0]),b=e.TmpVectors.On[0]),0===b.x&&0===b.z&&(b.x=.001),this._vertexData[Q++]=b.x,this._vertexData[Q++]=b.y,this._vertexData[Q++]=b.z}this._useRampGradients&&n.remapData&&(this._vertexData[Q++]=n.remapData.x,this._vertexData[Q++]=n.remapData.y,this._vertexData[Q++]=n.remapData.z,this._vertexData[Q++]=n.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===V?V=this._epsilon:1===V&&(V=1-this._epsilon)),this._vertexData[Q++]=i,this._vertexData[Q++]=V)}_prepareParticle(b){}_createNewOnes(b){let n;for(let i=0;i<b&&this.SN.length!==this._capacity;i++){n=this._createParticle(),this.SN.push(n);let b=this._createQueueStart;for(;b;)b.process(n,this),b=b.nextItem;n._inheritParticleInfoToSubEmitters()}}_update(b){if(this._alive=this.SN.length>0,this.Un.position){const b=this.Un;this._emitterWorldMatrix=b.getWorldMatrix()}else{const b=this.Un;this._emitterWorldMatrix=e.Matrix.Translation(b.x,b.y,b.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.SN),this._createNewOnes(b)}static _GetAttributeNamesOrOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=[o.g.PositionKind,o.g.ColorKind,"angle","offset","size"];return b&&e.push("cellIndex"),n||e.push("direction"),i&&e.push("remapData"),e}static _GetEffectCreationOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,nb.c)(e),b&&e.push("particlesInfos"),n&&e.push("logarithmicDepthConstant"),i&&(e.push("vFogInfos"),e.push("vFogColor")),e}fillDefines(b,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,nb.h)(this,this._scene,b),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&b.push("#define FOG")),this._isAnimationSheetEnabled&&b.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&b.push("#define LOGARITHMICDEPTH"),n===L.BLENDMODE_MULTIPLY&&b.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&b.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(b.push("#define BILLBOARD"),this.billboardMode){case 2:b.push("#define BILLBOARDY");break;case 8:case 9:b.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&b.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:b.push("#define BILLBOARDMODE_ALL")}i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(b,n,i){n.push(...Pb._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),b.push(...Pb._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,eb.g)(b,this._imageProcessingConfigurationDefines),(0,eb.d)(i,this._imageProcessingConfigurationDefines))}_getWrapper(b){const n=this._getCustomDrawWrapper(b);if(null!==n&&void 0!==n&&n.effect)return n;const i=[];this.fillDefines(i,b);const e=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let V=this._drawWrappers[e];V||(V=this._drawWrappers[e]=[]);let Q=V[b];Q||(Q=new bb.b(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=this._useInstancing),V[b]=Q);const U=i.join("\n");if(Q.defines!==U){const b=[],n=[],i=[];this.fillUniformsAttributesAndSamplerNames(n,b,i),Q.setEffect(this._engine.createEffect("particles",b,n,i,U,void 0,void 0,void 0,void 0,this._shaderLanguage),U)}return Q}animate(){var b;let n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!i&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(i?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1),this.manualEmitCount>-1)n=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let b=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const n=this._actualFrame/this.targetStopDuration;l.GetCurrentGradient(n,this._emitRateGradients,((n,i,e)=>{n!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=i.getFactor(),this._currentEmitRateGradient=n),b=(0,B.Lerp)(this._currentEmitRate1,this._currentEmitRate2,e)}))}n=b*this._scaledUpdateSpeed|0,this._newPartsExcess+=b*this._scaledUpdateSpeed-n}if(this._newPartsExcess>1&&(n+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?n=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(n),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!i){let b=0;for(let n=0;n<this.SN.length;n++){const i=this.SN[n];this._appendParticleVertices(b,i),b+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.SN.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(b,n){this._appendParticleVertex(b++,n,0,0),this._useInstancing||(this._appendParticleVertex(b++,n,1,0),this._appendParticleVertex(b++,n,1,1),this._appendParticleVertex(b++,n,0,1))}rebuild(){var b;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(b=this._spriteBuffer)||void 0===b||b._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Pb.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(i.bind(i,13288)),Promise.resolve().then(i.bind(i,13234))])):await Promise.all([Promise.resolve().then(i.bind(i,13225)),Promise.resolve().then(i.bind(i,13210))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Un||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==L.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(L.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(L.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(b){const n=this._getWrapper(b),i=n.effect,V=this._engine;V.enableEffect(n);const Q=this.defaultViewMatrix??this._scene.getViewMatrix();if(i.setTexture("diffuseSampler",this.particleTexture),i.setMatrix("view",Q),i.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const b=this.particleTexture.getBaseSize();i.setFloat3("particlesInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,this.spriteCellWidth/b.width)}if(i.setVector2("translationPivot",this.translationPivot),i.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const b=this._scene.activeCamera;i.setVector3("eyePosition",b.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),i.setTexture("rampSampler",this._rampGradientsTexture));const U=i.defines;var Y,L,B,mb,N,Z;(this._scene&&((0,nb.d)(i,this,this._scene),this.applyFog&&(0,ib.e)(this._scene,void 0,i)),U.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Q.invertToRef(e.TmpVectors.Matrix[0]),i.setMatrix("invView",e.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?V.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,i):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,i)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?V.bindBuffers(this._vertexBuffers,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBuffer:this._indexBuffer,i):V.bindBuffers(this._vertexBuffers,null!==(mb=this._scene)&&void 0!==mb&&mb.forceWireframe?this._linesIndexBufferUseInstancing:null,i);(this.useLogarithmicDepth&&this._scene&&(0,ib.k)(U,i,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(i),this._setEngineBasedOnBlendMode(b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(i),this._useInstancing)?null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?V.drawElementsType(6,0,10,this.SN.length):V.drawArraysType(7,0,4,this.SN.length):null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?V.drawElementsType(1,0,10*this.SN.length):V.drawElementsType(0,0,6*this.SN.length);return this.SN.length}render(){if(!this.isReady()||!this.SN.length)return 0;const b=this._engine;b.setState&&(b.setState(!1),this.forceDepthWrite&&b.setDepthWrite(!0));let n=0;return n=this.blendMode===L.BLENDMODE_MULTIPLYADD?this._render(L.BLENDMODE_MULTIPLY)+this._render(L.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),n}_onDispose(){}dispose(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(n,i),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const b=this._scene.cN.indexOf(this);b>-1&&this._scene.cN.splice(b,1),this._scene._activeParticleSystems.dispose()}this.Qe.notifyObservers(this),this.Qe.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Pb.ForceGLSL=!1;var cb,qb=i(11636);!function(b){b[b.ATTACHED=0]="ATTACHED",b[b.END=1]="END"}(cb||(cb={}));class Sb{constructor(b){if(this.particleSystem=b,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!b.Un||!b.Un.dispose){const n=(0,Y.e)("BABYLON.AbstractMesh");b.Un=new n("SubemitterSystemEmitter",b.ab()),b._disposeEmitterOnDispose=!0}}clone(){let b=this.particleSystem.Un;if(b){if(b instanceof e.On)b=b.clone();else if(-1!==b.getClassName().indexOf("Mesh")){b=new((0,Y.e)("BABYLON.Mesh"))("",b.ab()),b.isVisible=!1}}else b=new e.On;const n=new Sb(this.particleSystem.clone(this.particleSystem.name,b));return n.particleSystem.name+="Clone",n.type=this.type,n.inheritDirection=this.inheritDirection,n.inheritedVelocityAmount=this.inheritedVelocityAmount,n.particleSystem._disposeEmitterOnDispose=!0,n.particleSystem.disposeOnStop=!0,n}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={};return n.type=this.type,n.inheritDirection=this.inheritDirection,n.inheritedVelocityAmount=this.inheritedVelocityAmount,n.particleSystem=this.particleSystem.serialize(b),n}static _ParseParticleSystem(b,n,i){throw(0,qb.e)("ParseParticle")}static Parse(b,n,i){const e=b.particleSystem,V=new Sb(Sb._ParseParticleSystem(e,n,i,!0));return V.type=b.type,V.inheritDirection=b.inheritDirection,V.inheritedVelocityAmount=b.inheritedVelocityAmount,V.particleSystem._isSubEmitter=!0,V}dispose(){this.particleSystem.dispose()}}var Hb=i(11676);function lb(b,n){const i=new O;return i.direction1=b,i.direction2=n,i}function vb(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function pb(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fb(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.On(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0);return new d(b,n,i)}function Fb(){return new z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function bn(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0),Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.On(0,1,0);return new K(b,n,i,V,Q)}function nn(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Z(b,n)}function en(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0),V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0);return new T(b,n,i,V)}const Vn=e.On.Zero(),Qn=e.On.Zero(),Un=e.On.Zero();class Yn{constructor(){this.strength=0,this.position=e.On.Zero()}_processParticle(b,n){this.position.subtractToRef(b.position,Vn);const i=Vn.lengthSquared()+1;Vn.normalize().scaleToRef(this.strength/i,Qn),Qn.scaleToRef(n._tempScaledUpdateSpeed,Un),b.direction.addInPlace(Un)}serialize(){return{position:this.position.ye(),strength:this.strength}}}class Ln extends Pb{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=b=>{if(!this._subEmitters||0===this._subEmitters.length)return;const n=Math.floor(Math.random()*this._subEmitters.length);for(const i of this._subEmitters[n])if(1===i.type){const n=i.clone();b._inheritParticleInfoToSubEmitter(n),n.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(n.particleSystem),n.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(b,n){const i=lb(b,n);return this.particleEmitterType=i,i}get flowMap(){return this._flowMap}set flowMap(b){this._flowMap!==b&&(this._flowMap=b,this._flowMapUpdate&&(gb(this._flowMapUpdate),this._flowMapUpdate=null),b&&(this._flowMapUpdate={process:b=>{var n;const i=null===(n=this.ab())||void 0===n?void 0:n.getTransformMatrix();this._flowMap._processParticle(b,this.flowMapStrength*this._tempScaledUpdateSpeed,i)},previousItem:null,nextItem:null},rb(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(b){this._attractors.push(b),1===this._attractors.length&&(this._attractorUpdate={process:b=>{for(const n of this._attractors)n._processParticle(b,this)},previousItem:null,nextItem:null},rb(this._attractorUpdate,this._directionProcessing))}removeAttractor(b){const n=this._attractors.indexOf(b);-1!==n&&this._attractors.splice(n,1),0===this._attractors.length&&gb(this._attractorUpdate)}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(b)}createHemisphericEmitter(){const b=vb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createSphereEmitter(){const b=pb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createDirectedSphereEmitter(){const b=fb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.On(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0));return this.particleEmitterType=b,b}createCylinderEmitter(){const b=Fb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=b,b}createDirectedCylinderEmitter(){const b=bn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.On(0,1,0));return this.particleEmitterType=b,b}createConeEmitter(){const b=nn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=b,b}createDirectedConeEmitter(){const b=en(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0));return this.particleEmitterType=b,b}createBoxEmitter(b,n,i,e){const V=new N;return this.particleEmitterType=V,this.direction1=b,this.direction2=n,this.minEmitBox=i,this.maxEmitBox=e,V}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const b of this.subEmitters)b instanceof Ln?this._subEmitters.push([new Sb(b)]):b instanceof Sb?this._subEmitters.push([b]):b instanceof Array&&this._subEmitters.push(b)}_stopSubEmitters(){if(this.activeSubSystems){for(const b of this.activeSubSystems)b.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const b=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==b&&this._rootParticleSystem.activeSubSystems.splice(b,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(b){b&&this._stopSubEmitters()}_prepareParticle(b){if(this._subEmitters&&this._subEmitters.length>0){const n=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];b._attachedSubEmitters=[];for(const i of n)if(0===i.type){const n=i.clone();b._attachedSubEmitters.push(n),n.particleSystem.start()}}}_onDispose(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),b&&this.particles)for(const i of this.particles)if(i._attachedSubEmitters)for(let b=i._attachedSubEmitters.length-1;b>=0;b-=1)i._attachedSubEmitters[b].dispose();if(n&&this.activeSubSystems)for(let i=this.activeSubSystems.length-1;i>=0;i-=1)this.activeSubSystems[i].dispose();if(this._subEmitters&&this._subEmitters.length){for(let b=0;b<this._subEmitters.length;b++)for(const n of this._subEmitters[b])n.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Un&&this.Un.dispose&&this.Un.dispose(!0)}static _Parse(b,n,i,V){let Q;Q=i instanceof Hb.b?null:i;const L=(0,Y.e)("BABYLON.Texture");if(L&&Q&&(b.texture?n.particleTexture=L.Parse(b.texture,Q,V):b.textureName&&(n.particleTexture=new L(V+b.textureName,Q,!1,void 0===b.invertY||b.invertY),n.particleTexture.name=b.textureName)),b.emitterId||0===b.emitterId||void 0!==b.Un?b.emitterId&&Q?n.Un=Q.getLastMeshById(b.emitterId):n.Un=e.On.jn(b.Un):n.Un=e.On.Zero(),n.isLocal=!!b.isLocal,void 0!==b.renderingGroupId&&(n.renderingGroupId=b.renderingGroupId),void 0!==b.isBillboardBased&&(n.isBillboardBased=b.isBillboardBased),void 0!==b.billboardMode&&(n.billboardMode=b.billboardMode),void 0!==b.useLogarithmicDepth&&(n.useLogarithmicDepth=b.useLogarithmicDepth),b.animations){for(let i=0;i<b.animations.length;i++){const e=b.animations[i],V=(0,Y.e)("BABYLON.Animation");V&&n.animations.push(V.Parse(e))}n.beginAnimationOnStart=b.beginAnimationOnStart,n.beginAnimationFrom=b.beginAnimationFrom,n.beginAnimationTo=b.beginAnimationTo,n.beginAnimationLoop=b.beginAnimationLoop}if(b.autoAnimate&&Q&&Q.beginAnimation(n,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),n.startDelay=0|b.startDelay,n.minAngularSpeed=b.minAngularSpeed,n.maxAngularSpeed=b.maxAngularSpeed,n.minSize=b.minSize,n.maxSize=b.maxSize,b.minScaleX&&(n.minScaleX=b.minScaleX,n.maxScaleX=b.maxScaleX,n.minScaleY=b.minScaleY,n.maxScaleY=b.maxScaleY),void 0!==b.preWarmCycles&&(n.preWarmCycles=b.preWarmCycles,n.preWarmStepOffset=b.preWarmStepOffset),void 0!==b.minInitialRotation&&(n.minInitialRotation=b.minInitialRotation,n.maxInitialRotation=b.maxInitialRotation),n.minLifeTime=b.minLifeTime,n.maxLifeTime=b.maxLifeTime,n.minEmitPower=b.minEmitPower,n.maxEmitPower=b.maxEmitPower,n.emitRate=b.emitRate,n.gravity=e.On.jn(b.gravity),b.noiseStrength&&(n.noiseStrength=e.On.jn(b.noiseStrength)),n.color1=U.IV.jn(b.color1),n.color2=U.IV.jn(b.color2),n.colorDead=U.IV.jn(b.colorDead),n.updateSpeed=b.updateSpeed,n.targetStopDuration=b.targetStopDuration,n.blendMode=b.blendMode,b.colorGradients)for(const e of b.colorGradients)n.addColorGradient(e.gradient,U.IV.jn(e.color1),e.color2?U.IV.jn(e.color2):void 0);if(b.rampGradients){for(const i of b.rampGradients)n.addRampGradient(i.gradient,U.Mn.jn(i.color));n.useRampGradients=b.useRampGradients}if(b.colorRemapGradients)for(const e of b.colorRemapGradients)n.addColorRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.alphaRemapGradients)for(const e of b.alphaRemapGradients)n.addAlphaRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.sizeGradients)for(const e of b.sizeGradients)n.addSizeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.angularSpeedGradients)for(const e of b.angularSpeedGradients)n.addAngularSpeedGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.velocityGradients)for(const e of b.velocityGradients)n.addVelocityGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.dragGradients)for(const e of b.dragGradients)n.addDragGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.emitRateGradients)for(const e of b.emitRateGradients)n.addEmitRateGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.startSizeGradients)for(const e of b.startSizeGradients)n.addStartSizeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.lifeTimeGradients)for(const e of b.lifeTimeGradients)n.addLifeTimeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(b.limitVelocityGradients){for(const i of b.limitVelocityGradients)n.addLimitVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);n.limitVelocityDamping=b.limitVelocityDamping}if(b.noiseTexture&&Q){const i=(0,Y.e)("BABYLON.ProceduralTexture");n.noiseTexture=i.Parse(b.noiseTexture,Q,V)}let B;if(b.particleEmitterType){switch(b.particleEmitterType.type){case"SphereParticleEmitter":B=new u;break;case"SphereDirectedParticleEmitter":B=new d;break;case"ConeEmitter":case"ConeParticleEmitter":B=new Z;break;case"ConeDirectedParticleEmitter":B=new T;break;case"CylinderParticleEmitter":B=new z;break;case"CylinderDirectedParticleEmitter":B=new K;break;case"HemisphericParticleEmitter":B=new I;break;case"PointParticleEmitter":B=new O;break;case"MeshParticleEmitter":B=new M;break;case"CustomParticleEmitter":B=new G;break;default:B=new N}B.parse(b.particleEmitterType,Q)}else B=new N,B.parse(b,Q);n.particleEmitterType=B,n.startSpriteCellID=b.startSpriteCellID,n.endSpriteCellID=b.endSpriteCellID,n.spriteCellLoop=b.spriteCellLoop??!0,n.spriteCellWidth=b.spriteCellWidth,n.spriteCellHeight=b.spriteCellHeight,n.spriteCellChangeSpeed=b.spriteCellChangeSpeed,n.spriteRandomStartCell=b.spriteRandomStartCell,n.disposeOnStop=b.disposeOnStop??!1,n.manualEmitCount=b.manualEmitCount??-1}static Parse(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0;const Y=b.name;let L,B,mb=null,N=null;if(n instanceof Hb.b?L=n:(B=n,L=B.getEngine()),b.customShader&&L.createEffectForParticles){N=b.customShader;const n=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";mb=L.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,n)}const Z=new Ln(Y,Q||b.Dn,n,mb,b.isAnimationSheetEnabled);if(Z.customShader=N,Z._rootUrl=i,b.id&&(Z.id=b.id),b.subEmitters){Z.subEmitters=[];for(const e of b.subEmitters){const b=[];for(const V of e)b.push(Sb.Parse(V,n,i));Z.subEmitters.push(b)}}if(b.attractors)for(const U of b.attractors){const b=new Yn;b.position=e.On.jn(U.position),b.strength=U.strength,Z.addAttractor(b)}return Ln._Parse(b,Z,n,i),b.textureMask&&(Z.textureMask=U.IV.jn(b.textureMask)),b.YB&&(Z.YB=e.On.jn(b.YB)),b.preventAutoStart&&(Z.preventAutoStart=b.preventAutoStart),V||Z.preventAutoStart||Z.start(),Z}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={};if(Ln._Serialize(n,this,b),n.textureMask=this.textureMask.ye(),n.customShader=this.customShader,n.preventAutoStart=this.preventAutoStart,n.YB=this.YB.ye(),this.subEmitters){n.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const i of this._subEmitters){const e=[];for(const n of i)e.push(n.serialize(b));n.subEmitters.push(e)}}if(this._attractors&&this._attractors.length){n.attractors=[];for(const b of this._attractors)n.attractors.push(b.serialize())}return n}static _Serialize(b,n,i){if(b.name=n.name,b.id=n.id,b.Dn=n.getCapacity(),b.disposeOnStop=n.disposeOnStop,b.manualEmitCount=n.manualEmitCount,n.Un.position){const i=n.Un;b.emitterId=i.id}else{const i=n.Un;b.Un=i.ye()}n.particleEmitterType&&(b.particleEmitterType=n.particleEmitterType.serialize()),n.particleTexture&&(i?b.texture=n.particleTexture.serialize():(b.textureName=n.particleTexture.name,b.invertY=!!n.particleTexture._invertY)),b.isLocal=n.isLocal,t.c.AppendSerializedAnimations(n,b),b.beginAnimationOnStart=n.beginAnimationOnStart,b.beginAnimationFrom=n.beginAnimationFrom,b.beginAnimationTo=n.beginAnimationTo,b.beginAnimationLoop=n.beginAnimationLoop,b.startDelay=n.startDelay,b.renderingGroupId=n.renderingGroupId,b.isBillboardBased=n.isBillboardBased,b.billboardMode=n.billboardMode,b.minAngularSpeed=n.minAngularSpeed,b.maxAngularSpeed=n.maxAngularSpeed,b.minSize=n.minSize,b.maxSize=n.maxSize,b.minScaleX=n.minScaleX,b.maxScaleX=n.maxScaleX,b.minScaleY=n.minScaleY,b.maxScaleY=n.maxScaleY,b.minEmitPower=n.minEmitPower,b.maxEmitPower=n.maxEmitPower,b.minLifeTime=n.minLifeTime,b.maxLifeTime=n.maxLifeTime,b.emitRate=n.emitRate,b.gravity=n.gravity.ye(),b.noiseStrength=n.noiseStrength.ye(),b.color1=n.color1.ye(),b.color2=n.color2.ye(),b.colorDead=n.colorDead.ye(),b.updateSpeed=n.updateSpeed,b.targetStopDuration=n.targetStopDuration,b.blendMode=n.blendMode,b.preWarmCycles=n.preWarmCycles,b.preWarmStepOffset=n.preWarmStepOffset,b.minInitialRotation=n.minInitialRotation,b.maxInitialRotation=n.maxInitialRotation,b.startSpriteCellID=n.startSpriteCellID,b.spriteCellLoop=n.spriteCellLoop,b.endSpriteCellID=n.endSpriteCellID,b.spriteCellChangeSpeed=n.spriteCellChangeSpeed,b.spriteCellWidth=n.spriteCellWidth,b.spriteCellHeight=n.spriteCellHeight,b.spriteRandomStartCell=n.spriteRandomStartCell,b.isAnimationSheetEnabled=n.isAnimationSheetEnabled,b.useLogarithmicDepth=n.useLogarithmicDepth;const e=n.getColorGradients();if(e){b.colorGradients=[];for(const n of e){const i={gradient:n.gradient,color1:n.color1.ye()};n.color2?i.color2=n.color2.ye():i.color2=n.color1.ye(),b.colorGradients.push(i)}}const V=n.getRampGradients();if(V){b.rampGradients=[];for(const n of V){const i={gradient:n.gradient,color:n.color.ye()};b.rampGradients.push(i)}b.useRampGradients=n.useRampGradients}const Q=n.getColorRemapGradients();if(Q){b.colorRemapGradients=[];for(const n of Q){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.colorRemapGradients.push(i)}}const U=n.getAlphaRemapGradients();if(U){b.alphaRemapGradients=[];for(const n of U){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.alphaRemapGradients.push(i)}}const Y=n.getSizeGradients();if(Y){b.sizeGradients=[];for(const n of Y){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.sizeGradients.push(i)}}const L=n.getAngularSpeedGradients();if(L){b.angularSpeedGradients=[];for(const n of L){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.angularSpeedGradients.push(i)}}const B=n.getVelocityGradients();if(B){b.velocityGradients=[];for(const n of B){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.velocityGradients.push(i)}}const mb=n.getDragGradients();if(mb){b.dragGradients=[];for(const n of mb){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.dragGradients.push(i)}}const N=n.getEmitRateGradients();if(N){b.emitRateGradients=[];for(const n of N){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.emitRateGradients.push(i)}}const Z=n.getStartSizeGradients();if(Z){b.startSizeGradients=[];for(const n of Z){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.startSizeGradients.push(i)}}const T=n.getLifeTimeGradients();if(T){b.lifeTimeGradients=[];for(const n of T){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.lifeTimeGradients.push(i)}}const z=n.getLimitVelocityGradients();if(z){b.limitVelocityGradients=[];for(const n of z){const i={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?i.factor2=n.factor2:i.factor2=n.factor1,b.limitVelocityGradients.push(i)}b.limitVelocityDamping=n.limitVelocityDamping}n.noiseTexture&&(b.noiseTexture=n.noiseTexture.serialize())}clone(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e={...this._customWrappers};let V=null;const Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){V=this.customShader;const b=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"",n=Q.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,b);e[0]?e[0].effect=n:this.setCustomEffect(n,0)}const U=this.serialize(i),Y=Ln.Parse(U,this._scene||this._engine,this._rootUrl);return Y.name=b,Y.customShader=V,Y._customWrappers=e,void 0===n&&(n=this.Un),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.Un=n,this.preventAutoStart||Y.start(),Y}}Ln.BILLBOARDMODE_Y=2,Ln.BILLBOARDMODE_ALL=7,Ln.BILLBOARDMODE_STRETCHED=8,Ln.BILLBOARDMODE_STRETCHED_LOCAL=9,Sb._ParseParticleSystem=Ln.Parse;var Bn=i(12009),mi=i(12005),Nn=i(11894);Nn.c.prototype.createTransformFeedback=function(){const b=this._gl.createTransformFeedback();if(!b)throw new Error("Unable to create Transform Feedback");return b},Nn.c.prototype.deleteTransformFeedback=function(b){this._gl.deleteTransformFeedback(b)},Nn.c.prototype.bindTransformFeedback=function(b){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,b)},Nn.c.prototype.beginTransformFeedback=function(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(b?this._gl.POINTS:this._gl.TRIANGLES)},Nn.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Nn.c.prototype.setTranformFeedbackVaryings=function(b,n){this._gl.transformFeedbackVaryings(b,n,this._gl.INTERLEAVED_ATTRIBS)},Nn.c.prototype.bindTransformFeedbackBuffer=function(b){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,b?b.underlyingResource:null)},Nn.c.prototype.readTransformFeedbackBuffer=function(b){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,b)};const Zn="clipPlaneFragmentDeclaration2",Tn="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";a.c.IncludesShadersStore[Zn]||(a.c.IncludesShadersStore[Zn]=Tn);i(13104),i(13109),i(13118),i(13125),i(13131),i(13137),i(13141),i(13150);const zn="gpuRenderParticlesPixelShader",Kn="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";a.c.ShadersStore[zn]||(a.c.ShadersStore[zn]=Kn);const In="clipPlaneVertexDeclaration2",On="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";a.c.IncludesShadersStore[In]||(a.c.IncludesShadersStore[In]=On);i(13156),i(13158),i(13163),i(13170);const un="gpuRenderParticlesVertexShader",dn="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";a.c.ShadersStore[un]||(a.c.ShadersStore[un]=dn);class Gn extends L{static get IsSupported(){if(!f.d.LastCreatedEngine)return!1;const b=f.d.LastCreatedEngine.getCaps();return b.supportTransformFeedbacks||b.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(b){this._maxActiveParticleCount=Math.min(b,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(b){this.maxActiveParticleCount=b}createPointEmitter(b,n){const i=lb(b,n);return this.particleEmitterType=i,i}createHemisphericEmitter(){const b=vb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createSphereEmitter(){const b=pb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createDirectedSphereEmitter(){const b=fb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.On(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0));return this.particleEmitterType=b,b}createCylinderEmitter(){const b=Fb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=b,b}createDirectedCylinderEmitter(){const b=bn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.On(0,1,0));return this.particleEmitterType=b,b}createConeEmitter(){const b=nn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=b,b}createDirectedConeEmitter(){const b=en(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.On(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.On(0,1,0));return this.particleEmitterType=b,b}createBoxEmitter(b,n,i,e){const V=new N;return this.particleEmitterType=V,this.direction1=b,this.direction2=n,this.minEmitBox=i,this.maxEmitBox=e,V}get flowMap(){return this._flowMap}set flowMap(b){this._flowMap!==b&&(this._flowMap=b)}isReady(){if(!this.Un||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Ln.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Ln.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Ln.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";b?setTimeout((()=>{this.start(0)}),b):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var b;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(b=this._customWrappers[n])||void 0===b?void 0:b.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[b]??this._customWrappers[0]}setCustomEffect(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[n]=new bb.b(this._engine),this._customWrappers[n].effect=b}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(b,n,i){return super._removeGradientAndTexture(b,n,i),this._releaseBuffers(),this}addColorGradient(b,n){this._colorGradients||(this._colorGradients=[]);const i=new q(b,n);return this._colorGradients.push(i),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(b&&this._colorGradients.sort(((b,n)=>b.gradient<n.gradient?-1:b.gradient>n.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(b){return this._removeGradientAndTexture(b,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const n in this._drawWrappers){var b;null===(b=this._drawWrappers[n].drawContext)||void 0===b||b.reset()}}_addFactorGradient(b,n,i){const e=new H(n,i);b.push(e),this._releaseBuffers()}addSizeGradient(b,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,b,n),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(b){return this._removeGradientAndTexture(b,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(b,n){if(!b)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&b.sort(((b,n)=>b.gradient<n.gradient?-1:b.gradient>n.gradient?1:0));const i=this;i[n]&&(i[n].dispose(),i[n]=null)}addAngularSpeedGradient(b,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,b,n),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(b){return this._removeGradientAndTexture(b,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(b,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,b,n),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(b){return this._removeGradientAndTexture(b,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(b,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,b,n),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(b){return this._removeGradientAndTexture(b,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(b,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,b,n),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(b){return this._removeGradientAndTexture(b,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(b){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(b),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Qe=new v.e,this.onStoppedObservable=new v.e,this.onStartedObservable=new v.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=e.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||f.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.cN.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,Y.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,Y.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new bb.b(this._engine)},this._customWrappers[0].effect=V,this._drawWrappers={0:new bb.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(n=n??{}).randomTextureSize||delete n.randomTextureSize;const U={Dn:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...n},L=n;isFinite(L)&&(U.Dn=L),this._capacity=U.Dn,this._maxActiveParticleCount=U.Dn,this._currentActiveCount=0,this._isAnimationSheetEnabled=Q,this.particleEmitterType=new N;const B=Math.min(this._engine.getCaps().maxTextureSize,U.randomTextureSize);let mb=[];for(let e=0;e<B;++e)mb.push(Math.random()),mb.push(Math.random()),mb.push(Math.random()),mb.push(Math.random());this._randomTexture=new p.d(new Float32Array(mb),B,1,5,i,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,mb=[];for(let e=0;e<B;++e)mb.push(Math.random()),mb.push(Math.random()),mb.push(Math.random()),mb.push(Math.random());this._randomTexture2=new p.d(new Float32Array(mb),B,1,5,i,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=B}_reset(){this._releaseBuffers()}_createVertexBuffers(b,n,i){const e={};e.position=n.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let V=3;e.age=n.createVertexBuffer("age",V,1,this._attributesStrideSize,!0),V+=1,e.size=n.createVertexBuffer("size",V,3,this._attributesStrideSize,!0),V+=3,e.life=n.createVertexBuffer("life",V,1,this._attributesStrideSize,!0),V+=1,V+=4,this.billboardMode===Ln.BILLBOARDMODE_STRETCHED&&(e.direction=n.createVertexBuffer("direction",V,3,this._attributesStrideSize,!0)),V+=3,this._platform.alignDataInBuffer&&(V+=1),this.particleEmitterType instanceof G&&(V+=3,this._platform.alignDataInBuffer&&(V+=1)),this._colorGradientsTexture||(e.color=n.createVertexBuffer("color",V,4,this._attributesStrideSize,!0),V+=4),this._isBillboardBased||(e.initialDirection=n.createVertexBuffer("initialDirection",V,3,this._attributesStrideSize,!0),V+=3,this._platform.alignDataInBuffer&&(V+=1)),this.noiseTexture&&(e.noiseCoordinates1=n.createVertexBuffer("noiseCoordinates1",V,3,this._attributesStrideSize,!0),V+=3,this._platform.alignDataInBuffer&&(V+=1),e.noiseCoordinates2=n.createVertexBuffer("noiseCoordinates2",V,3,this._attributesStrideSize,!0),V+=3,this._platform.alignDataInBuffer&&(V+=1)),e.angle=n.createVertexBuffer("angle",V,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?V++:V+=2,this._isAnimationSheetEnabled&&(e.cellIndex=n.createVertexBuffer("cellIndex",V,1,this._attributesStrideSize,!0),V+=1,this.spriteRandomStartCell&&(e.cellStartOffset=n.createVertexBuffer("cellStartOffset",V,1,this._attributesStrideSize,!0),V+=1)),e.offset=i.createVertexBuffer("offset",0,2),e.uv=i.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(e),this._platform.createVertexBuffers(b,e),this.resetDrawCache()}_initialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!b)return;const n=this._engine,i=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof G&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const V=this.particleEmitterType instanceof G,Q=e.TmpVectors.On[0];let U=0;for(let e=0;e<this._capacity;e++)if(i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),V?(this.particleEmitterType.particleDestinationGenerator(e,null,Q),i.push(Q.x),i.push(Q.y),i.push(Q.z)):(i.push(0),i.push(0),i.push(0)),this._platform.alignDataInBuffer&&i.push(0),U+=16,V&&(this.particleEmitterType.particlePositionGenerator(e,null,Q),i.push(Q.x),i.push(Q.y),i.push(Q.z),this._platform.alignDataInBuffer&&i.push(0),U+=4),this._colorGradientsTexture||(i.push(0),i.push(0),i.push(0),i.push(0),U+=4),this.isBillboardBased||(i.push(0),i.push(0),i.push(0),this._platform.alignDataInBuffer&&i.push(0),U+=4),this.noiseTexture&&(i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),U+=8),i.push(0),U+=1,this._angularSpeedGradientsTexture||(i.push(0),U+=1),this._isAnimationSheetEnabled&&(i.push(0),U+=1,this.spriteRandomStartCell&&(i.push(0),U+=1)),this._platform.alignDataInBuffer){let b=3-(U+3&3);for(U+=b;b-- >0;)i.push(0)}const Y=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),L=this._platform.createParticleBuffer(i),B=this._platform.createParticleBuffer(i);this._buffer0=new o.e(n,L,!1,this._attributesStrideSize),this._buffer1=new o.e(n,B,!1,this._attributesStrideSize),this._spriteBuffer=new o.e(n,Y,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let b=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(b+="\n#define BILLBOARD"),this._colorGradientsTexture&&(b+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(b+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(b+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(b+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(b+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(b+="\n#define DRAGGRADIENTS"),this._flowMap&&(b+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(b+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(b+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(b+="\n#define NOISE"),this.isLocal&&(b+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===b||(this._cachedUpdateDefines=b,this._updateBuffer=this._platform.createUpdateBuffer(b)),this._platform.isUpdateBufferReady()}_getWrapper(b){const n=this._getCustomDrawWrapper(b);if(null!==n&&void 0!==n&&n.effect)return n;const i=[];this.fillDefines(i,b);let e=this._drawWrappers[b];e||(e=new bb.b(this._engine),e.drawContext&&(e.drawContext.useInstancing=!0),this._drawWrappers[b]=e);const V=i.join("\n");if(e.defines!==V){const b=[],n=[],i=[];this.fillUniformsAttributesAndSamplerNames(n,b,i),e.setEffect(this._engine.createEffect("gpuRenderParticles",b,n,i,V),V)}return e}static _GetAttributeNamesOrOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const V=[o.g.PositionKind,"age","life","size","angle"];return b||V.push(o.g.ColorKind),n&&V.push("cellIndex"),i||V.push("initialDirection"),e&&V.push("direction"),V.push("offset",o.g.UVKind),V}static _GetEffectCreationOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=["emitterWM","YB","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,nb.c)(e),b&&e.push("sheetInfos"),n&&e.push("logarithmicDepthConstant"),i&&(e.push("vFogInfos"),e.push("vFogColor")),e}fillDefines(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,nb.h)(this,this._scene,b),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==mi.b.FOGMODE_NONE&&b.push("#define FOG")),n===Ln.BLENDMODE_MULTIPLY&&b.push("#define BLENDMULTIPLYMODE"),this.isLocal&&b.push("#define LOCAL"),this.useLogarithmicDepth&&b.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(b.push("#define BILLBOARD"),this.billboardMode){case Ln.BILLBOARDMODE_Y:b.push("#define BILLBOARDY");break;case Ln.BILLBOARDMODE_STRETCHED:b.push("#define BILLBOARDSTRETCHED");break;case Ln.BILLBOARDMODE_ALL:b.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&b.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&b.push("#define ANIMATESHEET"),i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(b,n,i){n.push(...Gn._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Ln.BILLBOARDMODE_STRETCHED)),b.push(...Gn._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Bn.e.PrepareUniforms(b,this._imageProcessingConfigurationDefines),Bn.e.PrepareSamplers(i,this._imageProcessingConfigurationDefines))}animate(){var b;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(n?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(b,n){const i=this[n];if(!b||!b.length||i)return;const e=new Float32Array(this._rawTextureWidth);for(let V=0;V<this._rawTextureWidth;V++){const n=V/this._rawTextureWidth;l.GetCurrentGradient(n,b,((b,n,i)=>{e[V]=(0,B.Lerp)(b.factor1,n.factor1,i)}))}this[n]=p.d.CreateRTexture(e,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[n].name=n.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const b=new Uint8Array(4*this._rawTextureWidth),n=U.TmpColors.IV[0];for(let i=0;i<this._rawTextureWidth;i++){const e=i/this._rawTextureWidth;l.GetCurrentGradient(e,this._colorGradients,((e,V,Q)=>{U.IV.LerpToRef(e.color1,V.color1,Q,n),b[4*i]=255*n.r,b[4*i+1]=255*n.g,b[4*i+2]=255*n.b,b[4*i+3]=255*n.a}))}this._colorGradientsTexture=p.d.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(b,n){var i,V,Q,U;const Y=this._getWrapper(b),L=Y.effect;this._engine.enableEffect(Y);const B=(null===(i=this._scene)||void 0===i?void 0:i.getViewMatrix())||e.Matrix.IdentityReadOnly;if(L.setMatrix("view",B),L.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),L.setTexture("diffuseSampler",this.particleTexture),L.setVector2("translationPivot",this.translationPivot),L.setVector3("YB",this.YB),this.isLocal&&L.setMatrix("emitterWM",n),this._colorGradientsTexture?L.setTexture("colorGradientSampler",this._colorGradientsTexture):L.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const b=this.particleTexture.getBaseSize();L.setFloat3("sheetInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,b.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const b=this._scene.activeCamera;L.setVector3("eyePosition",b.globalPosition)}const mb=L.defines;if(this._scene&&((0,nb.d)(L,this,this._scene),this.applyFog&&(0,ib.e)(this._scene,void 0,L)),mb.indexOf("#define BILLBOARDMODE_ALL")>=0){const b=B.clone();b.invert(),L.setMatrix("invView",b)}return this.useLogarithmicDepth&&this._scene&&(0,ib.k)(mb,L,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(L),this._setEngineBasedOnBlendMode(b),this._platform.bindDrawBuffers(this._targetIndex,L,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(L),null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(U=this._scene)&&void 0!==U&&U.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(b){if(!this.Un||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!b)if(this.Un.position){b=this.Un.getWorldMatrix()}else{const n=this.Un;b=e.TmpVectors.Matrix[0],e.Matrix.TranslationToRef(n.x,n.y,n.z,b)}const n=this._engine,i=n.getDepthWrite();if(n.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const b=this.ab();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",b.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",b),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const V=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=V,n.setDepthWrite(i)}render(){let b,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!n&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const b=0|this._accumulatedCount;this._accumulatedCount-=b,this._currentActiveCount+=b}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Un.position){b=this.Un.getWorldMatrix()}else{const n=this.Un;b=e.TmpVectors.Matrix[0],e.Matrix.TranslationToRef(n.x,n.y,n.z,b)}const V=this._engine;this.updateInAnimate||this._update(b);let Q=0;return n||i||(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0),Q=this.blendMode===Ln.BLENDMODE_MULTIPLYADD?this._render(Ln.BLENDMODE_MULTIPLY,b)+this._render(Ln.BLENDMODE_ADD,b):this._render(this.blendMode,b),this._engine.setAlphaMode(0)),Q}rebuild(){const b=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(b,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,b()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const n in this._drawWrappers){this._drawWrappers[n].dispose()}if(this._drawWrappers={},this._scene){const b=this._scene.cN.indexOf(this);b>-1&&this._scene.cN.splice(b,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let n=0;n<this._renderVertexBuffers.length;++n){const b=this._renderVertexBuffers[n];for(const n in b)b[n].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Qe.notifyObservers(this),this.Qe.clear()}clone(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e={...this._customWrappers};let V=null;const Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){V=this.customShader;const b=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"";e[0]=Q.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,b,void 0,void 0,void 0,this)}const U=this.serialize(i),Y=Gn.Parse(U,this._scene||this._engine,this._rootUrl);return Y.name=b,Y.customShader=V,Y._customWrappers=e,void 0===n&&(n=this.Un),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.Un=n,Y}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={};return Ln._Serialize(n,this,b),n.activeParticleCount=this.activeParticleCount,n.randomTextureSize=this._randomTextureSize,n.customShader=this.customShader,n}static Parse(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4?arguments[4]:void 0;const Q=b.name;let U,Y;n instanceof Hb.b?U=n:(Y=n,U=Y.getEngine());const L=new Gn(Q,{Dn:V||b.Dn,randomTextureSize:b.randomTextureSize},n,null,b.isAnimationSheetEnabled);if(L._rootUrl=i,b.customShader&&U.createEffectForParticles){const n=b.customShader,i=n.shaderOptions.defines.length>0?n.shaderOptions.defines.join("\n"):"",e=U.createEffectForParticles(n.shaderPath.fragmentElement,n.shaderOptions.uniforms,n.shaderOptions.samplers,i,void 0,void 0,void 0,L);L.setCustomEffect(e,0),L.customShader=n}return b.id&&(L.id=b.id),b.activeParticleCount&&(L.activeParticleCount=b.activeParticleCount),Ln._Parse(b,L,n,i),b.preventAutoStart&&(L.preventAutoStart=b.preventAutoStart),e||L.preventAutoStart||L.start(),L}}var on=i(11605),Mn=i(13179),jn=i(12151);class an{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(b){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const n of this.systems)n.Un=b;this._emitterNode=b}setEmitterAsSphere(b,n,i){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:b,renderingGroupId:n};const e=(0,Mn.b)("emitterSphere",{diameter:b.diameter,segments:b.segments},i);e.renderingGroupId=n;const V=new jn.Gn("emitterSphereMaterial",i);V.emissiveColor=b.color,e.material=V;for(const Q of this.systems)Q.Un=e;this._emitterNode=e}start(b){for(const n of this.systems)b&&(n.Un=b),n.start()}dispose(){for(const b of this.systems)b.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n={systems:[]};for(const i of this.systems)n.systems.push(i.serialize(b));return this._emitterNode&&(n.Un=this._emitterCreationOptions),n}static Parse(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;const V=new an,Q=this.BaseAssetsUrl+"/textures/";n=n||f.d.LastCreatedScene;for(const U of b.systems)V.systems.push(i?Gn.Parse(U,n,Q,!0,e):Ln.Parse(U,n,Q,!0,e));if(b.Un){const i=b.Un.options;if("Sphere"===b.Un.kind)V.setEmitterAsSphere({diameter:i.diameter,segments:i.segments,color:U.Mn.jn(i.color)},b.Un.renderingGroupId,n)}return V}}an.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Dn=i(11639);class xn{static CreateDefault(b){let n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,e=arguments.length>2?arguments[2]:void 0;n=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Gn("default system",{Dn:i},e):new Ln("default system",i,e),n.Un=b;const V=on.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return n.particleTexture=new w.e(V,n.ab()),n.createConeEmitter(.1,Math.PI/4),n.color1=new U.IV(1,1,1,1),n.color2=new U.IV(1,1,1,1),n.colorDead=new U.IV(1,1,1,0),n.minSize=.1,n.maxSize=.1,n.minEmitPower=2,n.maxEmitPower=2,n.updateSpeed=1/60,n.emitRate=30,n}static CreateAsync(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;n||(n=f.d.LastCreatedScene);const V={};return n.addPendingData(V),new Promise(((Q,U)=>{if(i&&!Gn.IsSupported)return n.removePendingData(V),U("Particle system with GPU is not supported.");on.Tools.LoadFile(`${xn.BaseAssetsUrl}/systems/${b}.json`,(b=>{n.removePendingData(V);const U=JSON.parse(b.toString());return Q(an.Parse(U,n,i,e))}),void 0,void 0,void 0,(()=>(n.removePendingData(V),U(`An error occurred with the creation of your particle system. Check if your type '${b}' exists.`))))}))}static ExportSet(b){const n=new an;for(const i of b)n.systems.push(i);return n}static ParseFromFileAsync(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Q=arguments.length>5?arguments[5]:void 0;return new Promise(((U,Y)=>{const L=new Dn.e;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const n=JSON.parse(L.responseText);let Y;Y=e?Gn.Parse(n,i,V,!1,Q):Ln.Parse(n,i,V,!1,Q),b&&(Y.name=b),U(Y)}else Y("Unable to load the particle system")})),L.open("GET",n),L.send()}))}static ParseFromSnippetAsync(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",V=arguments.length>4?arguments[4]:void 0;if("_BLANK"===b){const b=this.CreateDefault(null);return b.start(),Promise.resolve(b)}return new Promise(((Q,U)=>{const Y=new Dn.e;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const U=JSON.parse(JSON.parse(Y.responseText).jsonPayload),L=JSON.parse(U.particleSystem);let B;B=i?Gn.Parse(L,n,e,!1,V):Ln.Parse(L,n,e,!1,V),B.snippetId=b,Q(B)}else U("Unable to load the snippet "+b)})),Y.open("GET",this.SnippetUrl+"/"+b.replace(/#/g,"/")),Y.send()}))}}xn.BaseAssetsUrl=an.BaseAssetsUrl,xn.SnippetUrl="https://snippet.babylonjs.com",xn.CreateFromSnippetAsync=xn.ParseFromSnippetAsync;var yn=i(12215),sn=i(12039),An=i(13187);(0,An.f)(sn.c.NAME_PARTICLESYSTEM,((b,n,i,e)=>{const V=(0,An.h)(sn.c.NAME_PARTICLESYSTEM);if(V&&void 0!==b.cN&&null!==b.cN)for(let Q=0,U=b.cN.length;Q<U;Q++){const U=b.cN[Q];i.cN.push(V(U,n,e))}})),(0,An.e)(sn.c.NAME_PARTICLESYSTEM,((b,n,i)=>{if(b.activeParticleCount){return Gn.Parse(b,n,i)}return Ln.Parse(b,n,i)})),Hb.b.prototype.createEffectForParticles=function(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Q=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,L=arguments.length>7?arguments[7]:void 0,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,mb=arguments.length>9?arguments[9]:void 0,N=[],Z=[];const T=[];return L?L.fillUniformsAttributesAndSamplerNames(Z,N,T):(N=Ln._GetAttributeNamesOrOptions(),Z=Ln._GetEffectCreationOptions()),-1===V.indexOf(" BILLBOARD")&&(V+="\n#define BILLBOARD\n"),null!==L&&void 0!==L&&L.isAnimationSheetEnabled&&-1===V.indexOf(" ANIMATESHEET")&&(V+="\n#define ANIMATESHEET\n"),-1===e.indexOf("diffuseSampler")&&e.push("diffuseSampler"),this.createEffect({vertex:mb??(null===L||void 0===L?void 0:L.vertexShaderName)??"particles",fragmentElement:b},N,Z.concat(n),T.concat(e),V,Q,U,Y,void 0,B,(async()=>{0===B?await Promise.resolve().then(i.bind(i,13225)):await Promise.resolve().then(i.bind(i,13288))}))},yn.b.prototype.getEmittedParticleSystems=function(){const b=[];for(let n=0;n<this.ab().cN.length;n++){const i=this.ab().cN[n];i.Un===this&&b.push(i)}return b},yn.b.prototype.getHierarchyEmittedParticleSystems=function(){const b=[],n=this.getDescendants();n.push(this);for(let i=0;i<this.ab().cN.length;i++){const e=this.ab().cN[i],V=e.Un;V.position&&-1!==n.indexOf(V)&&b.push(e)}return b};i(12112),i(12123),i(12190);i(12198),i(13193),i(11972),i(12102),i(12235);i(11968);var En;i(13196),i(11803);!function(b){b[b.Color=2]="Color",b[b.UV=1]="UV",b[b.Random=0]="Random",b[b.Stated=3]="Stated"}(En||(En={}));var Cn=i(11994);const tn=new e.On(0,0,0),wn=new e.On(0,0,0),hn=new e.On(0,0,0);class Wn{constructor(b,n,i){this.width=b,this.height=n,this.data=i}processFlowable(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;if(!i)return;i instanceof e.Matrix?e.On.TransformCoordinatesToRef(b.position,i,hn):(hn.x=i.x,hn.y=i.y,hn.z=i.z);const V=.5*hn.x+.5,Q=1-(.5*hn.y+.5),U=Math.floor(V*this.width),Y=Math.floor(Q*this.height);if(U<0||U>=this.width||Y<0||Y>=this.height)return;const L=4*(Y*this.width+U),B=this.data[L]/255*2-1,mb=this.data[L+1]/255*2-1,N=this.data[L+2]/255*2-1,Z=this.data[L+3]/255;tn.set(B,mb,N),tn.scaleToRef(n*Z,wn),b.direction.addInPlace(wn)}_processParticle(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;this.processFlowable(b,n,i)}static async FromUrlAsync(b){return await new Promise(((n,i)=>{const e=document.createElement("canvas"),V=e.getContext("2d");let Q=null;const U=new Image;U.crossOrigin="anonymous",U.src=b,U.onerror=n=>{i(new Error(`Failed to load image: ${b} : ${n}`))},U.onload=()=>{e.width=U.width,e.height=U.height,V.drawImage(U,0,0),Q=V.getImageData(0,0,e.width,e.height),n(new Wn(e.width,e.height,Q.data))}}))}static async ExtractFromTextureAsync(b){return await new Promise(((n,i)=>{if(!b.isReady())return void b.onLoadObservable.addOnce((async()=>{try{const i=await this.ExtractFromTextureAsync(b);n(i)}catch(e){i(e)}}));const e=b.getSize();Cn.m.GetTextureDataAsync(b,e.width,e.height).then((b=>{n(new Wn(e.width,e.height,new Uint8ClampedArray(b)))})).catch(i)}))}}var Jn,Rn,kn,rn,Xn,gn,Pn,cn,qn;!function(b){b[b.Int=1]="Int",b[b.Float=2]="Float",b[b.Vector2=4]="Vector2",b[b.On=8]="On",b[b.Matrix=16]="Matrix",b[b.Particle=32]="Particle",b[b.Texture=64]="Texture",b[b.IV=128]="IV",b[b.FloatGradient=256]="FloatGradient",b[b.Vector2Gradient=512]="Vector2Gradient",b[b.Vector3Gradient=1024]="Vector3Gradient",b[b.Color4Gradient=2048]="Color4Gradient",b[b.System=4096]="System",b[b.AutoDetect=8192]="AutoDetect",b[b.BasedOnInput=16384]="BasedOnInput",b[b.Undefined=32768]="Undefined",b[b.All=65535]="All"}(Jn||(Jn={})),function(b){b[b.Compatible=0]="Compatible",b[b.TypeIncompatible=1]="TypeIncompatible",b[b.HierarchyIssue=2]="HierarchyIssue"}(Rn||(Rn={})),function(b){b[b.Input=0]="Input",b[b.Output=1]="Output"}(kn||(kn={}));class Sn{get direction(){return this._direction}get type(){if(this._type===Jn.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Jn.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(b){this._type=b}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((b=>b.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(b,n,i){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Jn.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new v.e,this.onDisconnectionObservable=new v.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=n,this.name=b,this._direction=i}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(b){var n;return this.isConnected?null!==(n=this._connectedPoint)&&void 0!==n&&n._storedFunction?this._connectedPoint._storedFunction(b):this._connectedPoint._storedValue:this.value}canConnectTo(b){return 0===this.checkCompatibilityState(b)}checkCompatibilityState(b){const n=this._ownerBlock,i=b.ownerBlock;if(this.type!==b.type&&b.innerType!==Jn.AutoDetect)return b.acceptedConnectionPointTypes&&-1!==b.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(b.excludedConnectionPointTypes&&-1!==b.excludedConnectionPointTypes.indexOf(this.type))return 1;let e=i,V=n;return 0===this.direction&&(e=n,V=i),e.isAnAncestorOf(V)?2:0}connectTo(b){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(b))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${b.ownerBlock.name}".${b.name}`;return this._endpoints.push(b),b._connectedPoint=this,this.onConnectionObservable.notifyObservers(b),b.onConnectionObservable.notifyObservers(this),this}disconnectFrom(b){const n=this._endpoints.indexOf(b);return-1===n||(this._endpoints.splice(n,1),b._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(b),b.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(b){let n=1;for(;n<Jn.All;)b&n||this.excludedConnectionPointTypes.push(n),n<<=1}serialize(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n={};return n.name=this.name,n.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.ye?(n.valueType="BABYLON."+this.value.getClassName(),n.value=this.value.ye()):(n.valueType="number",n.value=this.value)),b&&this.connectedPoint&&(n.inputName=this.name,n.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,n.targetConnectionName=this.connectedPoint.name,n.isExposedOnFrame=!0,n.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(n.isExposedOnFrame=!0,n.exposedPortPosition=this.exposedPortPosition),n}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Hn{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(b){this._name=b}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(b){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new v.e,this.Qe=new v.e,this.onInputChangedObservable=new v.e,this.visibleOnFrame=!1,this._name=b,this.uniqueId=h.e.UniqueId}_inputRename(b){return b}_outputRename(b){return b}isAnAncestorOf(b){for(const n of this._outputs)if(n.hasEndpoints)for(const i of n.endpoints){if(i.ownerBlock===b)return!0;if(i.ownerBlock.isAnAncestorOf(b))return!0}return!1}isAnAncestorOfType(b){if(this.getClassName()===b)return!0;for(const n of this._outputs)if(n.hasEndpoints)for(const i of n.endpoints)if(i.ownerBlock.isAnAncestorOfType(b))return!0;return!1}getInputByName(b){const n=this._inputs.filter((n=>n.name===b));return n.length?n[0]:null}_linkConnectionTypes(b,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[n]._acceptedConnectionPointType=this._inputs[b]:(this._inputs[b]._linkedConnectionSource=this._inputs[n],this._inputs[b]._isMainLinkSource=!0),this._inputs[n]._linkedConnectionSource=this._inputs[b]}registerInput(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0;const U=new Sn(b,this,0);return U.type=n,U.isOptional=i,U.defaultValue=e,U.value=e,U.valueMin=V,U.valueMax=Q,this._inputs.push(U),this.onInputChangedObservable.notifyObservers(U),this}registerOutput(b,n,i){return(i=i??new Sn(b,this,1)).type=n,this._outputs.push(i),this}_build(b){}_customBuildStep(b){}build(b){if(this._buildId===b.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((b=>b.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=b.buildId;for(const n of this._inputs){if(!n.connectedPoint){n.isOptional||b.notConnectedNonOptionalInputs.push(n);continue}const i=n.connectedPoint.ownerBlock;i&&i!==this&&!i.isSystem&&i.build(b)}return this._customBuildStep(b),b.verbose&&W.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(b),this.onBuildObservable.notifyObservers(this),!1}serialize(){const b={};b.customType="BABYLON."+this.getClassName(),b.id=this.uniqueId,b.name=this.name,b.visibleOnFrame=this.visibleOnFrame,b.inputs=[],b.outputs=[];for(const n of this.inputs)b.inputs.push(n.serialize());for(const n of this.outputs)b.outputs.push(n.serialize(!1));return b}_deserialize(b){this._name=b.name,this.comments=b.comments,this.visibleOnFrame=!!b.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(b)}_deserializePortDisplayNamesAndExposedOnFrame(b){const n=b.inputs,i=b.outputs;if(n)for(const e of n){const b=this.inputs.find((b=>b.name===e.name));if(!b)return;if(e.displayName&&(b.displayName=e.displayName),e.isExposedOnFrame&&(b.isExposedOnFrame=e.isExposedOnFrame,b.exposedPortPosition=e.exposedPortPosition),void 0!==e.value&&null!==e.value)if("number"===e.valueType)b.value=e.value;else{const n=(0,Y.e)(e.valueType);n&&(b.value=n.jn(e.value))}}if(i)for(let e=0;e<i.length;e++){const b=i[e];b.displayName&&(this.outputs[e].displayName=b.displayName),b.isExposedOnFrame&&(this.outputs[e].isExposedOnFrame=b.isExposedOnFrame,this.outputs[e].exposedPortPosition=b.exposedPortPosition)}}clone(){const b=this.serialize(),n=(0,Y.e)(b.customType);if(n){const i=new n;return i._deserialize(b),i}return null}dispose(){this.Qe.notifyObservers(this),this.Qe.clear();for(const b of this.inputs)b.dispose();for(const b of this.outputs)b.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ln(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",e=arguments.length>3?arguments[3]:void 0;return(V,Q)=>{let U=V._propStore;U||(U=[],V._propStore=U),U.push({propertyName:Q,displayName:b,type:n,groupName:i,options:e??{},className:V.getClassName()})}}(0,E.e)([(0,C.W)("comment")],Hn.prototype,"comments",void 0),function(b){b[b.Boolean=0]="Boolean",b[b.Float=1]="Float",b[b.Int=2]="Int",b[b.Vector2=3]="Vector2",b[b.List=4]="List",b[b.IV=5]="IV",b[b.SamplingMode=6]="SamplingMode",b[b.TextureFormat=7]="TextureFormat",b[b.TextureType=8]="TextureType"}(rn||(rn={})),function(b){b[b.None=0]="None",b[b.Position=1]="Position",b[b.Direction=2]="Direction",b[b.Age=3]="Age",b[b.Lifetime=4]="Lifetime",b[b.Color=5]="Color",b[b.ScaledDirection=6]="ScaledDirection",b[b.Scale=7]="Scale",b[b.AgeGradient=8]="AgeGradient",b[b.Angle=9]="Angle",b[b.SpriteCellIndex=16]="SpriteCellIndex",b[b.SpriteCellStart=17]="SpriteCellStart",b[b.SpriteCellEnd=18]="SpriteCellEnd"}(Xn||(Xn={})),function(b){b[b.None=0]="None",b[b.Time=1]="Time",b[b.Delta=2]="Delta",b[b.Emitter=3]="Emitter"}(gn||(gn={}));class vn{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let b="";for(const n of this.notConnectedNonOptionalInputs)b+=`input ${n.name} from block ${n.ownerBlock.name}[${n.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(b)throw"Build of Node Particle System Set failed:\n"+b}adapt(b,n){const i=b.getConnectedValue(this)||0;if(b.type===n)return i;switch(n){case Jn.Vector2:return new e.Vector2(i,i);case Jn.On:return new e.On(i,i,i);case Jn.IV:return new U.IV(i,i,i,i)}return null}getContextualValue(b){if(!this.particleContext||!this.systemContext)return null;switch(b){case Xn.Position:return this.particleContext.position;case Xn.Direction:return this.particleContext.direction;case Xn.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Xn.Color:return this.particleContext.color;case Xn.Age:return this.particleContext.age;case Xn.Lifetime:return this.particleContext.lifeTime;case Xn.Angle:return this.particleContext.angle;case Xn.Scale:return this.particleContext.scale;case Xn.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Xn.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Xn.SpriteCellIndex:return this.particleContext.cellIndex;case Xn.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Un.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Un.absolutePosition:this.systemContext.Un:null}getSystemValue(b){if(!this.particleContext||!this.systemContext)return null;switch(b){case gn.Time:return this.systemContext._actualFrame;case gn.Delta:return this.systemContext._scaledUpdateSpeed;case gn.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Un.absolutePosition}return this.systemContext.Un}return null}}function pn(b,n,i){const e=new vn;e.dn=n;const V=b.createSystem(e);return V.canStart=()=>!0,V.Un=i.clone(),V.disposeOnStop=!0,V.start(),V}class fn extends Hn{constructor(b){super(b),this.blendMode=L.BLENDMODE_ONEONE,this.Dn=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Jn.Particle),this.registerInput("texture",Jn.Texture),this.registerInput("onStart",Jn.System,!0),this.registerInput("onEnd",Jn.System,!0),this.registerOutput("system",Jn.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(b){b.Dn=this.Dn,b.buildId=this._buildId++,this.build(b);const n=this.particle.getConnectedValue(b);return n.particleTexture=this.texture.getConnectedValue(b),n.emitRate=this.emitRate,n.blendMode=this.blendMode,n.name=this.name,n._nodeGenerated=!0,n._targetStopDuration=this.targetStopDuration,n.startDelay=this.startDelay,this.system._storedValue=this,n.canStart=()=>!this.doNoStart,n.onStartedObservable.add((i=>{const e=this.onStart.getConnectedValue(b);e&&i.onStartedObservable.addOnce((()=>{b.systemContext=n;const i=pn(e,b.dn,b.emitterPosition);this.Qe.addOnce((()=>{i.dispose()}))}));const V=this.onEnd.getConnectedValue(b);V&&i.onStoppedObservable.addOnce((()=>{b.systemContext=n;const i=pn(V,b.dn,b.emitterPosition);this.Qe.addOnce((()=>{i.dispose()}))}))})),this.Qe.addOnce((()=>{n.dispose()})),n}serialize(){const b=super.serialize();return b.Dn=this.Dn,b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.doNoStart=this.doNoStart,b.targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,b}_deserialize(b){super._deserialize(b),this.Dn=b.Dn,this.emitRate=b.emitRate,this.doNoStart=!!b.doNoStart,void 0!==b.blendMode&&(this.blendMode=b.blendMode),void 0!==b.targetStopDuration&&(this.targetStopDuration=b.targetStopDuration),void 0!==b.startDelay&&(this.startDelay=b.startDelay)}}(0,E.e)([ln("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:L.BLENDMODE_ONEONE},{label:"Standard",value:L.BLENDMODE_STANDARD},{label:"Add",value:L.BLENDMODE_ADD},{label:"Multiply",value:L.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:L.BLENDMODE_MULTIPLYADD}]})],fn.prototype,"blendMode",void 0),(0,E.e)([ln("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],fn.prototype,"Dn",void 0),(0,E.e)([ln("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fn.prototype,"emitRate",void 0),(0,E.e)([ln("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fn.prototype,"targetStopDuration",void 0),(0,E.e)([ln("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fn.prototype,"startDelay",void 0),(0,E.e)([ln("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],fn.prototype,"doNoStart",void 0),(0,Y.i)("BABYLON.SystemBlock",fn);class Fn extends Hn{get type(){if(this._type===Jn.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Jn.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Jn.Vector2,this._type;case"On":return this._type=Jn.On,this._type;case"IV":return this._type=Jn.IV,this._type;case"Matrix":return this._type=Jn.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Xn.None&&this._systemSource!==gn.None}get systemSource(){return this._systemSource}set systemSource(b){if(this._systemSource=b,b!==gn.None){switch(this._contextualSource=Xn.None,this._type=Jn.Float,b){case gn.Time:case gn.Delta:this._type=Jn.Float;break;case gn.Emitter:this._type=Jn.On}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Xn.None}get contextualValue(){return this._contextualSource}set contextualValue(b){if(this._contextualSource=b,b!==Xn.None){switch(this._systemSource=gn.None,b){case Xn.Scale:this._type=Jn.Vector2;break;case Xn.Position:case Xn.Direction:case Xn.ScaledDirection:this._type=Jn.On;break;case Xn.Color:this._type=Jn.IV;break;case Xn.Age:case Xn.Lifetime:case Xn.Angle:case Xn.AgeGradient:this._type=Jn.Float;break;case Xn.SpriteCellEnd:case Xn.SpriteCellStart:case Xn.SpriteCellIndex:this._type=Jn.Int}this.output&&(this.output.type=this._type)}}constructor(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jn.AutoDetect;super(b),this._type=Jn.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new v.e,this._systemSource=gn.None,this._contextualSource=Xn.None,this._type=n,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",n)}get value(){return this._storedValue}set value(b){this.type===Jn.Float&&this.min!==this.max&&(b=Math.max(this.min,b),b=Math.min(this.max,b)),this._storedValue=b,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(b){this._valueCallback=b}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Jn.Int:case Jn.Float:this.value=0;break;case Jn.Vector2:this.value=e.Vector2.Zero();break;case Jn.On:this.value=e.On.Zero();break;case Jn.IV:this.value=new U.IV(1,1,1,1);break;case Jn.Matrix:this.value=e.Matrix.Identity()}}_build(b){super._build(b),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=b=>b.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=b=>b.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const b=super.serialize();return b.type=this.type,b.contextualValue=this.contextualValue,b.systemSource=this.systemSource,b.min=this.min,b.max=this.max,b.groupInInspector=this.groupInInspector,b.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.ye?(b.valueType="BABYLON."+this._storedValue.getClassName(),b.value=this._storedValue.ye()):(b.valueType="number",b.value=this._storedValue)),b}_deserialize(b){if(super._deserialize(b),this._type=b.type,this.contextualValue=b.contextualValue,this.systemSource=b.systemSource||gn.None,this.min=b.min||0,this.max=b.max||0,this.groupInInspector=b.groupInInspector||"",void 0!==b.displayInInspector&&(this.displayInInspector=b.displayInInspector),b.valueType)if("number"===b.valueType)this._storedValue=b.value;else{const n=(0,Y.e)(b.valueType);n&&(this._storedValue=n.jn(b.value))}}}(0,Y.i)("BABYLON.ParticleInputBlock",Fn);class bi extends Hn{get url(){return this._url}set url(b){this._url!==b&&(this._cachedData=null,this._url=b,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(b){this._textureDataUrl!==b&&(this._cachedData=null,this._textureDataUrl=b,this._url="",this._sourceTexture=null)}set sourceTexture(b){this._sourceTexture!==b&&(this._cachedData=null,this._sourceTexture=b,this._url="",this._textureDataUrl="")}constructor(b){super(b),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Jn.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const b=this.texture._storedValue;return await new Promise(((n,i)=>{if(!b.isReady())return void b.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),n(this._cachedData)}catch(b){i(b)}}));const e=b.getSize();Cn.m.GetTextureDataAsync(b,e.width,e.height).then((i=>{this._cachedData={width:e.width,height:e.height,data:new Uint8ClampedArray(i)},b.dispose(),n(this._cachedData)})).catch(i)}))}_build(b){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new w.e(this._textureDataUrl,b.dn):this.texture._storedValue=new w.e(this._url,b.dn):this.texture._storedValue=null}serialize(){const b=super.serialize();return b.url=this.url,b.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(b.textureDataUrl=this.textureDataUrl),b}_deserialize(b){super._deserialize(b),this.url=b.url,this.serializedCachedData=!!b.serializedCachedData,b.textureDataUrl&&(this.textureDataUrl=b.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,Y.i)("BABYLON.ParticleTextureSourceBlock",bi);class ni extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("position",Jn.On),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(b){const n=this.particle.getConnectedValue(b);if(this.output._storedValue=n,!this.position.isConnected)return;const i={process:i=>{b.particleContext=i,b.systemContext=n,i.position.L(this.position.getConnectedValue(b))},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i}}(0,Y.i)("BABYLON.UpdatePositionBlock",ni),function(b){b[b.Add=0]="Add",b[b.Subtract=1]="Subtract",b[b.Multiply=2]="Multiply",b[b.Divide=3]="Divide",b[b.Max=4]="Max",b[b.Min=5]="Min"}(Pn||(Pn={}));class ii extends Hn{constructor(b){super(b),this.operation=Pn.Add,this.registerInput("left",Jn.AutoDetect),this.registerInput("right",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this.output._typeConnectionSource=this.left;const n=[Jn.Matrix,Jn.Particle,Jn.Texture,Jn.System,Jn.FloatGradient,Jn.Color4Gradient,Jn.Vector2Gradient,Jn.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...n),this.right.excludedConnectionPointTypes.push(...n),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(b){let n;const i=this.left,V=this.right;if(!i.isConnected||!V.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Q=i.type===Jn.Float||i.type===Jn.Int,Y=V.type===Jn.Float||V.type===Jn.Int,L=Q&&Y;switch(this.operation){case Pn.Add:n=L?b=>i.getConnectedValue(b)+V.getConnectedValue(b):Q?b=>b.adapt(i,V.type).add(V.getConnectedValue(b)):b=>i.getConnectedValue(b).add(b.adapt(V,i.type));break;case Pn.Subtract:n=L?b=>i.getConnectedValue(b)-V.getConnectedValue(b):Q?b=>b.adapt(i,V.type).un(V.getConnectedValue(b)):b=>i.getConnectedValue(b).un(b.adapt(V,i.type));break;case Pn.Multiply:n=L?b=>i.getConnectedValue(b)*V.getConnectedValue(b):Q?b=>b.adapt(i,V.type).multiply(V.getConnectedValue(b)):b=>i.getConnectedValue(b).multiply(b.adapt(V,i.type));break;case Pn.Divide:n=L?b=>i.getConnectedValue(b)/V.getConnectedValue(b):Q?b=>b.adapt(i,V.type).divide(V.getConnectedValue(b)):b=>i.getConnectedValue(b).divide(b.adapt(V,i.type));break;case Pn.Min:if(L)n=b=>Math.min(i.getConnectedValue(b),V.getConnectedValue(b));else{const[b,Y]=Q?[V,i]:[i,V];switch(b.type){case Jn.Vector2:n=n=>e.Vector2.Minimize(b.getConnectedValue(n),n.adapt(Y,b.type));break;case Jn.On:n=n=>e.On.Minimize(b.getConnectedValue(n),n.adapt(Y,b.type));break;case Jn.IV:n=n=>{const i=b.getConnectedValue(n),{r:e,g:V,b:Q,a:L}=n.adapt(Y,b.type);return new U.IV(Math.min(i.r,e),Math.min(i.g,V),Math.min(i.b,Q),Math.min(i.a,L))}}}break;case Pn.Max:if(!L){const[b,Y]=Q?[V,i]:[i,V];switch(b.type){case Jn.Vector2:n=n=>e.Vector2.Maximize(b.getConnectedValue(n),n.adapt(Y,b.type));break;case Jn.On:n=n=>e.On.Maximize(b.getConnectedValue(n),n.adapt(Y,b.type));break;case Jn.IV:n=n=>{const i=b.getConnectedValue(n),{r:e,g:V,b:Q,a:L}=n.adapt(Y,b.type);return new U.IV(Math.max(i.r,e),Math.min(i.g,V),Math.min(i.b,Q),Math.min(i.a,L))}}break}n=b=>Math.max(i.getConnectedValue(b),V.getConnectedValue(b))}this.output._storedFunction=b=>i.type===Jn.Int?0|n(b):n(b)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Jn.Int||this.left.type===Jn.Float&&this.right.type!==Jn.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[b,n]of[[this.left,this.right],[this.right,this.left]])b.acceptedConnectionPointTypes=[Jn.Int,Jn.Float],n.isConnected&&(b.acceptedConnectionPointTypes.push(n.type),n.type!==Jn.Int&&n.type!==Jn.Float||b.acceptedConnectionPointTypes.push(Jn.Vector2,Jn.On,Jn.IV))}dispose(){super.dispose();for(const b of this._connectionObservers)b.remove();this._connectionObservers.length=0}serialize(){const b=super.serialize();return b.operation=this.operation,b}_deserialize(b){super._deserialize(b),this.operation=b.operation}}(0,E.e)([ln("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Pn.Add},{label:"Subtract",value:Pn.Subtract},{label:"Multiply",value:Pn.Multiply},{label:"Divide",value:Pn.Divide},{label:"Max",value:Pn.Max},{label:"Min",value:Pn.Min}]})],ii.prototype,"operation",void 0),(0,Y.i)("BABYLON.ParticleMathBlock",ii);class ei extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("direction1",Jn.On,!0,new e.On(0,1,0)),this.registerInput("direction2",Jn.On,!0,new e.On(0,1,0)),this.registerInput("minEmitBox",Jn.On,!0,new e.On(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Jn.On,!0,new e.On(.5,.5,.5)),this.registerOutput("output",Jn.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(b){const n=this.particle.getConnectedValue(b);n._directionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.direction1.getConnectedValue(b),Q=this.direction2.getConnectedValue(b),U=(0,B.RandomRange)(V.x,Q.x),Y=(0,B.RandomRange)(V.y,Q.y),L=(0,B.RandomRange)(V.z,Q.z);b.isEmitterTransformNode?e.On.TransformNormalFromFloatsToRef(U,Y,L,b.emitterWorldMatrix,i.direction):i.direction.re(U,Y,L)},n._positionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.minEmitBox.getConnectedValue(b),Q=this.maxEmitBox.getConnectedValue(b),U=(0,B.RandomRange)(V.x,Q.x),Y=(0,B.RandomRange)(V.y,Q.y),L=(0,B.RandomRange)(V.z,Q.z);b.isEmitterTransformNode?e.On.TransformCoordinatesFromFloatsToRef(U,Y,L,b.emitterWorldMatrix,i.position):(i.position.re(U,Y,L),i.position.addInPlace(b.emitterPosition))},this.output._storedValue=n}}(0,Y.i)("BABYLON.BoxShapeBlock",ei);class Vi extends Hn{constructor(b){super(b),this.registerInput("emitPower",Jn.Float,!0,1),this.registerInput("lifeTime",Jn.Float,!0,1),this.registerInput("color",Jn.IV,!0,new U.IV(1,1,1,1)),this.registerInput("scale",Jn.Vector2,!0,new e.Vector2(1,1)),this.registerInput("angle",Jn.Float,!0,0),this.registerOutput("particle",Jn.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(b){const n=new Ln(this.name,b.Dn,b.dn,null,!1,void 0,!0);n.particleEmitterType=new O,n._lifeTimeCreation.process=(n,i)=>{b.particleContext=n,n.lifeTime=this.lifeTime.getConnectedValue(b),i._emitPower=this.emitPower.getConnectedValue(b)},n._colorCreation.process=n=>{b.particleContext=n,n.color.L(this.color.getConnectedValue(b))},n._sizeCreation.process=n=>{b.particleContext=n,n.size=1,n.scale.L(this.scale.getConnectedValue(b))},n._angleCreation.process=n=>{b.particleContext=n,n.angle=this.angle.getConnectedValue(b)},this.particle._storedValue=n}}(0,Y.i)("BABYLON.CreateParticleBlock",Vi);class Qi{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const b=[];for(const n of this.attachedBlocks)n.isInput&&b.push(n);return b}constructor(b){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new v.e,this.name=b}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(b)&&this.attachedBlocks.push(b);for(const i of b.inputs){const e=i.connectedPoint;if(e){const i=e.ownerBlock;i!==b&&this._initializeBlock(i,n)}}}async buildAsync(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((i=>{const e=new an;for(const b of this._systemBlocks)this._initializeBlock(b);for(const V of this.systemBlocks){const i=new vn;i.buildId=this._buildId++,i.dn=b,i.verbose=n;const Q=V.createSystem(i);i.emitErrors(),e.systems.push(Q)}this.onBuildObservable.notifyObservers(this),i(e)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const b=new fn("Particle system"),n=new ni("Update position");n.output.connectTo(b.particle);const i=new Fn("Position");i.contextualValue=Xn.Position;const e=new Fn("Scaled direction");e.contextualValue=Xn.ScaledDirection;const V=new ii("Add");V.operation=Pn.Add,i.output.connectTo(V.left),e.output.connectTo(V.right),V.output.connectTo(n.position);const Q=new Vi("Create particle"),U=new ei("Box shape");Q.particle.connectTo(U.particle),U.output.connectTo(n.particle);const Y=new bi("Texture");Y.texture.connectTo(b.texture),Y.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(b)}removeBlock(b){const n=this.attachedBlocks.indexOf(b);if(n>-1&&this.attachedBlocks.splice(n,1),b.isSystem){const n=this._systemBlocks.indexOf(b);n>-1&&this._systemBlocks.splice(n,1)}}parseSerializedObject(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n||this.clear();const i={};for(const e of b.Bm){const b=(0,Y.e)(e.customType);if(b){const n=new b;n._deserialize(e),i[e.id]=n,this.attachedBlocks.push(n),n.isSystem&&this._systemBlocks.push(n)}}for(const e of this.attachedBlocks)if(e.isTeleportOut){const b=e,n=b._tempEntryPointUniqueId;if(n){const e=i[n];e&&e.attachToEndpoint(b)}}for(let e=0;e<b.Bm.length;e++){const V=b.Bm[e],Q=i[V.id];Q&&(Q.inputs.length&&V.inputs.some((b=>b.targetConnectionName))&&!n||this._restoreConnections(Q,b,i))}if(b.locations||b.editorData&&b.editorData.locations){const e=b.locations||b.editorData.locations;for(const b of e)i[b.bV]&&(b.bV=i[b.bV].uniqueId);n&&this.editorData&&this.editorData.locations&&e.concat(this.editorData.locations),b.locations?this.editorData={locations:e}:(this.editorData=b.editorData,this.editorData.locations=e);const V=[];for(const b in i)V[b]=i[b].uniqueId;this.editorData.map=V}this.comment=b.comment}_restoreConnections(b,n,i){for(const e of b.outputs)for(const V of n.Bm){const Q=i[V.id];if(Q)for(const U of V.inputs)if(i[U.targetBlockId]!==b||U.targetConnectionName!==e.name);else{const b=Q.getInputByName(U.inputName);if(!b||b.isConnected)continue;e.connectTo(b,!0),this._restoreConnections(Q,n,i)}}}serialize(b){const n=b?{}:t.c.Serialize(this);n.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];b?i=b:n.customType="BABYLON.NodeParticleSystemSet",n.Bm=[];for(const e of i)n.Bm.push(e.serialize());if(!b)for(const e of this.attachedBlocks)-1===i.indexOf(e)&&n.Bm.push(e.serialize());return n}dispose(){for(const b of this.attachedBlocks)b.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(b){const n=new Qi(b);return n.setToDefault(),n}static Parse(b){const n=t.c.Parse((()=>new Qi(b.name)),b,null);return n.parseSerializedObject(b),n}static ParseFromSnippetAsync(b,n){return"_BLANK"===b?Promise.resolve(Qi.CreateDefault("blank")):new Promise(((i,e)=>{const V=new Dn.e;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const U=JSON.parse(JSON.parse(V.responseText).jsonPayload),Y=JSON.parse(U.nodeParticle);n||(n=t.c.Parse((()=>new Qi(b)),Y,null)),n.parseSerializedObject(Y),n.snippetId=b;try{i(n)}catch(Q){e(Q)}}else e("Unable to load the snippet "+b)})),V.open("GET",this.SnippetUrl+"/"+b.replace(/#/g,"/")),V.send()}))}}Qi.EditorURL=`${on.Tools._DefaultCdnUrl}/v${Hb.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Qi.SnippetUrl="https://snippet.babylonjs.com",(0,E.e)([(0,C.W)()],Qi.prototype,"name",void 0),(0,E.e)([(0,C.W)("comment")],Qi.prototype,"comment",void 0),function(b){b[b.None=0]="None",b[b.PerParticle=1]="PerParticle",b[b.PerSystem=2]="PerSystem"}(cn||(cn={}));class Ui extends Hn{constructor(b){super(b),this._currentLockId=-2,this.lockMode=cn.PerParticle,this.registerInput("min",Jn.AutoDetect,!0,0),this.registerInput("max",Jn.AutoDetect,!0,1),this.registerOutput("output",Jn.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Jn.Float|Jn.Int|Jn.Vector2|Jn.On|Jn.IV),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Jn.Float|Jn.Int|Jn.Vector2|Jn.On|Jn.IV),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Jn.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let b=null;switch(this._currentLockId=-2,this.min.type){case Jn.AutoDetect:case Jn.Int:case Jn.Float:b=b=>{const n=this.min.getConnectedValue(b)||0,i=this.max.getConnectedValue(b)||1;return n+Math.random()*(i-n)};break;case Jn.Vector2:b=b=>{const n=this.min.getConnectedValue(b)||e.Vector2.Zero(),i=this.max.getConnectedValue(b)||e.Vector2.One();return new e.Vector2(n.x+Math.random()*(i.x-n.x),n.y+Math.random()*(i.y-n.y))};break;case Jn.On:b=b=>{const n=this.min.getConnectedValue(b)||e.On.Zero(),i=this.max.getConnectedValue(b)||e.On.One();return new e.On(n.x+Math.random()*(i.x-n.x),n.y+Math.random()*(i.y-n.y),n.z+Math.random()*(i.z-n.z))};break;case Jn.IV:b=b=>{const n=this.min.getConnectedValue(b)||new U.IV(0,0,0,0),i=this.max.getConnectedValue(b)||new U.IV(1,1,1,1);return new U.IV(n.x+Math.random()*(i.x-n.x),n.y+Math.random()*(i.y-n.y),n.z+Math.random()*(i.z-n.z),n.w+Math.random()*(i.w-n.w))}}this.output._storedFunction=n=>{var i;let e=0;switch(this.lockMode){case cn.PerParticle:e=(null===(i=n.particleContext)||void 0===i?void 0:i.id)||-1;break;case cn.PerSystem:e=n.buildId||0}return this._currentLockId!==e&&(this.lockMode!==cn.None&&(this._currentLockId=e),this.output._storedValue=b(n)),this.output._storedValue}}serialize(){const b=super.serialize();return b.lockMode=this.lockMode,b}_deserialize(b){super._deserialize(b),this.lockMode=b.lockMode}}(0,E.e)([ln("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cn.None},{label:"Per particle",value:cn.PerParticle},{label:"Per system",value:cn.PerSystem}]})],Ui.prototype,"lockMode",void 0),(0,Y.i)("BABYLON.ParticleRandomBlock",Ui);class Yi extends Hn{constructor(b){super(b),this._currentLockId=-2,this.lockMode=cn.PerParticle,this.registerInput("min",Jn.AutoDetect),this.registerInput("max",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const n=[Jn.Matrix,Jn.Particle,Jn.Texture,Jn.System,Jn.FloatGradient,Jn.Color4Gradient,Jn.Vector2Gradient,Jn.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...n),this.max.excludedConnectionPointTypes.push(...n)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let b=null;switch(this._currentLockId=-2,this.min.type){case Jn.Float:case Jn.Int:b=b=>{const n=this.min.getConnectedValue(b),i=this.max.getConnectedValue(b);return Math.random()*(i-n)+n};break;case Jn.Vector2:b=b=>{const n=this.min.getConnectedValue(b),i=this.max.getConnectedValue(b);return new e.Vector2(Math.random()*(i.x-n.x)+n.x,Math.random()*(i.y-n.y)+n.y)};break;case Jn.On:b=b=>{const n=this.min.getConnectedValue(b),i=this.max.getConnectedValue(b);return new e.On(Math.random()*(i.x-n.x)+n.x,Math.random()*(i.y-n.y)+n.y,Math.random()*(i.z-n.z)+n.z)};break;case Jn.IV:b=b=>{const n=this.min.getConnectedValue(b),i=this.max.getConnectedValue(b);return new U.IV(Math.random()*(i.r-n.r)+n.r,Math.random()*(i.g-n.g)+n.g,Math.random()*(i.b-n.b)+n.b,Math.random()*(i.a-n.a)+n.a)}}this.output._storedFunction=n=>{var i;let e=0;switch(this.lockMode){case cn.PerParticle:e=(null===(i=n.particleContext)||void 0===i?void 0:i.id)||-1;break;case cn.PerSystem:e=n.buildId||0}return this._currentLockId!==e&&(this.lockMode!==cn.None&&(this._currentLockId=e),this.output._storedValue=b(n)),this.output._storedValue}}serialize(){const b=super.serialize();return b.lockMode=this.lockMode,b}_deserialize(b){super._deserialize(b),void 0!==b.lockMode&&(this.lockMode=b.lockMode)}}(0,E.e)([ln("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cn.None},{label:"Per particle",value:cn.PerParticle},{label:"Per system",value:cn.PerSystem}]})],Yi.prototype,"lockMode",void 0),(0,Y.i)("BABYLON.RandomRangeBlock",Yi);(0,Y.i)("BABYLON.ParticleLerpBlock",class extends Hn{constructor(b){super(b),this.registerInput("left",Jn.AutoDetect),this.registerInput("right",Jn.AutoDetect),this.registerInput("gradient",Jn.Float,!0,0,0,1),this.registerOutput("output",Jn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Jn.Float|Jn.Int|Jn.Vector2|Jn.On|Jn.IV)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const b=(b,n,i)=>(1-b)*n+b*i;this.output._storedFunction=n=>{const i=this.left.getConnectedValue(n),V=this.right.getConnectedValue(n),Q=this.gradient.getConnectedValue(n);switch(this.left.type){case Jn.Int:case Jn.Float:return b(Q,i,V);case Jn.Vector2:return new e.Vector2(b(Q,i.x,V.x),b(Q,i.y,V.y));case Jn.On:return new e.On(b(Q,i.x,V.x),b(Q,i.y,V.y),b(Q,i.z,V.z));case Jn.IV:return new U.IV(b(Q,i.r,V.r),b(Q,i.g,V.g),b(Q,i.b,V.b),b(Q,i.a,V.a))}return 0}}});(0,Y.i)("BABYLON.UpdateDirectionBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("direction",Jn.On),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(b){const n=this.particle.getConnectedValue(b);if(this.output._storedValue=n,!this.direction.isConnected)return;const i={process:i=>{b.particleContext=i,b.systemContext=n,i.direction.L(this.direction.getConnectedValue(b))},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i}});(0,Y.i)("BABYLON.UpdateColorBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("color",Jn.IV),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(b){const n=this.particle.getConnectedValue(b);if(this.output._storedValue=n,!this.color.isConnected)return;const i={process:i=>{b.particleContext=i,b.systemContext=n,i.color.L(this.color.getConnectedValue(b))},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i}});(0,Y.i)("BABYLON.UpdateScaleBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("scale",Jn.Vector2),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(b){const n=this.particle.getConnectedValue(b);if(this.output._storedValue=n,!this.scale.isConnected)return;const i={process:i=>{b.particleContext=i,b.systemContext=n,i.scale.L(this.scale.getConnectedValue(b))},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i}});(0,Y.i)("BABYLON.UpdateAngleBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("angle",Jn.Float),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(b){const n=this.particle.getConnectedValue(b);if(this.output._storedValue=n,!this.angle.isConnected)return;const i={process:i=>{b.particleContext=i,b.systemContext=n,i.angle=this.angle.getConnectedValue(b)},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i}});(0,Y.i)("BABYLON.BasicPositionUpdateBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(b){const n=this.particle.getConnectedValue(b),i={process:i=>{b.particleContext=i,b.systemContext=n,i.direction.scaleToRef(n._directionScale,n._scaledDirection),i.position.addInPlace(n._scaledDirection)},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i,this.output._storedValue=n}});(0,Y.i)("BABYLON.BasicSpriteUpdateBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(b){const n=this.particle.getConnectedValue(b),i={process:i=>{b.particleContext=i,b.systemContext=n,i.updateCellIndex()},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i,this.output._storedValue=n}});(0,Y.i)("BABYLON.UpdateSpriteCellIndexBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("cellIndex",Jn.Int),this.registerOutput("output",Jn.Particle),this.cellIndex.acceptedConnectionPointTypes=[Jn.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(b){const n=this.particle.getConnectedValue(b);if(this.output._storedValue=n,!this.cellIndex.isConnected)return;const i={process:i=>{b.particleContext=i,b.systemContext=n,i.cellIndex=Math.floor(this.cellIndex.getConnectedValue(b))},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i}});class Li extends Hn{constructor(b){super(b),this.strength=1,this.registerInput("particle",Jn.Particle),this.registerInput("flowMap",Jn.Texture),this.registerOutput("output",Jn.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(b){var n;const i=this.particle.getConnectedValue(b),e=b.dn;let V;(null===(n=this.flowMap.connectedPoint)||void 0===n?void 0:n.ownerBlock).extractTextureContentAsync().then((b=>{b&&(V=new Wn(b.width,b.height,b.data))}));const Q={process:b=>{const n=e.getTransformMatrix();V&&V._processParticle(b,this.strength*i._tempScaledUpdateSpeed,n)},previousItem:null,nextItem:null};i._updateQueueStart?Xb(Q,i._updateQueueStart):i._updateQueueStart=Q,this.output._storedValue=i}serialize(){const b=super.serialize();return b.strength=this.strength,b}_deserialize(b){super._deserialize(b),this.strength=b.strength}}(0,E.e)([ln("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Li.prototype,"strength",void 0),(0,Y.i)("BABYLON.UpdateFlowMapBlock",Li);(0,Y.i)("BABYLON.SphereShapeBlock",class extends Hn{constructor(b){super(b),this.registerInput("input",Jn.Particle),this.registerInput("radius",Jn.Float,!0,1),this.registerInput("radiusRange",Jn.Float,!0,1,0,1),this.registerInput("directionRandomizer",Jn.Float,!0,0,0,1),this.registerOutput("output",Jn.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(b){const n=this.input.getConnectedValue(b);n._directionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.directionRandomizer.getConnectedValue(b),Q=i.position.un(b.emitterPosition).normalize(),U=(0,B.RandomRange)(0,V),Y=(0,B.RandomRange)(0,V),L=(0,B.RandomRange)(0,V);Q.x+=U,Q.y+=Y,Q.z+=L,Q.normalize(),b.isEmitterTransformNode?e.On.TransformNormalFromFloatsToRef(U,Y,L,b.emitterWorldMatrix,i.direction):i.direction.re(U,Y,L)},n._positionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.radius.getConnectedValue(b),Q=this.radiusRange.getConnectedValue(b),U=V-(0,B.RandomRange)(0,V*Q),Y=(0,B.RandomRange)(0,1),L=(0,B.RandomRange)(0,2*Math.PI),mb=Math.acos(2*Y-1),N=U*Math.cos(L)*Math.sin(mb),Z=U*Math.cos(mb),T=U*Math.sin(L)*Math.sin(mb);b.isEmitterTransformNode?e.On.TransformCoordinatesFromFloatsToRef(N,Z,T,b.emitterWorldMatrix,i.position):(i.position.re(N,Z,T),i.position.addInPlace(b.emitterPosition))},this.output._storedValue=n}});(0,Y.i)("BABYLON.PointShapeBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("direction1",Jn.On,!0,new e.On(0,1,0)),this.registerInput("direction2",Jn.On,!0,new e.On(0,1,0)),this.registerOutput("output",Jn.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){const n=this.particle.getConnectedValue(b);n._directionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.direction1.getConnectedValue(b),Q=this.direction2.getConnectedValue(b),U=(0,B.RandomRange)(V.x,Q.x),Y=(0,B.RandomRange)(V.y,Q.y),L=(0,B.RandomRange)(V.z,Q.z);b.isEmitterTransformNode?e.On.TransformNormalFromFloatsToRef(U,Y,L,b.emitterWorldMatrix,i.direction):i.direction.re(U,Y,L)},n._positionCreation.process=i=>{b.systemContext=n,b.isEmitterTransformNode?e.On.TransformCoordinatesFromFloatsToRef(0,0,0,b.emitterWorldMatrix,i.position):i.position.L(b.emitterPosition)},this.output._storedValue=n}});(0,Y.i)("BABYLON.CustomShapeBlock",class extends Hn{constructor(b){super(b),this.registerInput("particle",Jn.Particle),this.registerInput("position",Jn.On,!0,new e.On(0,0,0)),this.registerInput("direction",Jn.On,!0,new e.On(0,1,0)),this.registerOutput("output",Jn.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){const n=this.particle.getConnectedValue(b);n._directionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.direction.getConnectedValue(b);b.isEmitterTransformNode?e.On.TransformNormalToRef(V,b.emitterWorldMatrix,i.direction):i.direction.L(V)},n._positionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.position.getConnectedValue(b);b.isEmitterTransformNode?e.On.TransformCoordinatesToRef(V,b.emitterWorldMatrix,i.position):(i.position.L(V),i.position.addInPlace(b.emitterPosition))},this.output._storedValue=n}});(0,Y.i)("BABYLON.CylinderShapeBlock",class extends Hn{constructor(b){super(b),this._tempVector=e.On.Zero(),this.registerInput("particle",Jn.Particle),this.registerInput("radius",Jn.Float,!0,1),this.registerInput("height",Jn.Float,!0,1,0),this.registerInput("radiusRange",Jn.Float,!0,1,0,1),this.registerInput("directionRandomizer",Jn.Float,!0,0,0,1),this.registerOutput("output",Jn.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(b){const n=this.particle.getConnectedValue(b);n._directionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.directionRandomizer.getConnectedValue(b);i.position.subtractToRef(b.emitterPosition,this._tempVector),this._tempVector.normalize(),b.isEmitterTransformNode&&e.On.TransformNormalToRef(this._tempVector,b.emitterInverseWorldMatrix,this._tempVector);const Q=(0,B.RandomRange)(-V/2,V/2);let U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=(0,B.RandomRange)(-Math.PI/2,Math.PI/2)*V,this._tempVector.y=Q,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),b.isEmitterTransformNode?e.On.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,b.emitterWorldMatrix,i.direction):i.direction.L(this._tempVector)},n._positionCreation.process=i=>{b.particleContext=i,b.systemContext=n;const V=this.height.getConnectedValue(b),Q=this.radiusRange.getConnectedValue(b),U=this.radius.getConnectedValue(b),Y=(0,B.RandomRange)(-V/2,V/2),L=(0,B.RandomRange)(0,2*Math.PI),mb=(0,B.RandomRange)((1-Q)*(1-Q),1),N=Math.sqrt(mb)*U,Z=N*Math.cos(L),T=N*Math.sin(L);b.isEmitterTransformNode?e.On.TransformCoordinatesFromFloatsToRef(Z,Y,T,b.emitterWorldMatrix,i.position):(i.position.re(Z,Y,T),i.position.addInPlace(b.emitterPosition))},this.output._storedValue=n}});class Bi extends Hn{constructor(b){super(b),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Jn.Particle),this.registerOutput("output",Jn.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);const n=this.particle.getConnectedValue(b);n._isAnimationSheetEnabled=!0,n.spriteCellWidth=this.width,n.spriteCellHeight=this.height,n.startSpriteCellID=this.start,n.endSpriteCellID=this.end,n.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=n}serialize(){const b=super.serialize();return b.width=this.width,b.height=this.height,b.start=this.start,b.end=this.end,b.randomStartCell=this.randomStartCell,b}_deserialize(b){super._deserialize(b),this.width=b.width,this.height=b.height,this.start=b.start,this.end=b.end,this.randomStartCell=b.randomStartCell}}(0,E.e)([ln("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"start",void 0),(0,E.e)([ln("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"end",void 0),(0,E.e)([ln("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"width",void 0),(0,E.e)([ln("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"height",void 0),(0,E.e)([ln("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Bi.prototype,"loop",void 0),(0,E.e)([ln("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Bi.prototype,"randomStartCell",void 0),(0,Y.i)("BABYLON.SetupSpriteSheetBlock",Bi);class me extends Hn{constructor(b){super(b),this.reference=0,this.registerInput("value",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=b=>{switch(b){case Jn.Float:return Jn.FloatGradient;case Jn.Vector2:return Jn.Vector2Gradient;case Jn.On:return Jn.Vector3Gradient;case Jn.IV:return Jn.Color4Gradient}return b},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Jn.Float|Jn.Vector2|Jn.On|Jn.IV)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=b=>null}serialize(){const b=super.serialize();return b.reference=this.reference,b}_deserialize(b){super._deserialize(b),this.reference=b.reference}}(0,E.e)([ln("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],me.prototype,"reference",void 0),(0,Y.i)("BABYLON.ParticleGradientValueBlock",me);(0,Y.i)("BABYLON.ParticleGradientBlock",class extends Hn{constructor(b){super(b),this._entryCount=1,this.registerInput("gradient",Jn.Float,!0,1,0,1),this.registerInput("value0",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=b=>{switch(b){case Jn.FloatGradient:return Jn.Float;case Jn.Vector2Gradient:return Jn.Vector2;case Jn.Vector3Gradient:return Jn.On;case Jn.Color4Gradient:return Jn.IV}return b},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Jn.FloatGradient|Jn.Vector2Gradient|Jn.Vector3Gradient|Jn.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(b){this._inputs[b].onConnectionObservable.add((()=>{this._entryCount>b||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Jn.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const b=[];for(let i=1;i<this._inputs.length;i++){var n;if(this._inputs[i].isConnected)b.push(null===(n=this._inputs[i].connectedPoint)||void 0===n?void 0:n.ownerBlock)}b.sort(((b,n)=>b.reference-n.reference)),this.output._storedFunction=n=>{const i=this.gradient.getConnectedValue(n);if(1===b.length)return b[0].value.getConnectedValue(n);let V=null;for(let Q=b.length-1;Q>=0;Q--){const Y=b[Q];if(Y.reference<=i){const b=Y.value.getConnectedValue(n);if(V){const Q=V.value.getConnectedValue(n),L=V.reference,mb=Y.reference,N=Math.max(0,Math.min(1,(i-mb)/(L-mb)));switch(this.output.type){case Jn.Float:return(0,B.Lerp)(b,Q,N);case Jn.Vector2:return e.Vector2.Lerp(b,Q,N);case Jn.On:return e.On.Lerp(b,Q,N);case Jn.IV:return U.IV.Lerp(b,Q,N)}}return b}V=Y}return 0}}});(0,Y.i)("BABYLON.ParticleConverterBlock",class extends Hn{constructor(b){super(b),this.registerInput("color ",Jn.IV,!0),this.registerInput("xyz ",Jn.On,!0),this.registerInput("xy ",Jn.Vector2,!0),this.registerInput("zw ",Jn.Vector2,!0),this.registerInput("x ",Jn.Float,!0),this.registerInput("y ",Jn.Float,!0),this.registerInput("z ",Jn.Float,!0),this.registerInput("w ",Jn.Float,!0),this.registerOutput("color",Jn.IV),this.registerOutput("xyz",Jn.On),this.registerOutput("xy",Jn.Vector2),this.registerOutput("zw",Jn.Vector2),this.registerOutput("x",Jn.Float),this.registerOutput("y",Jn.Float),this.registerOutput("z",Jn.Float),this.registerOutput("w",Jn.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(b){return"color "===b?"colorIn":"xyz "===b?"xyzIn":"xy "===b?"xyIn":"zw "===b?"zwIn":"x "===b?"xIn":"y "===b?"yIn":"z "===b?"zIn":"w "===b?"wIn":b}_outputRename(b){switch(b){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return b}}_build(b){super._build(b);const n=this.xIn,i=this.yIn,V=this.zIn,Q=this.wIn,Y=this.xyIn,L=this.zwIn,B=this.xyzIn,mb=this.colorIn,N=this.colorOut,Z=this.xyzOut,T=this.xyOut,z=this.zwOut,K=this.xOut,I=this.yOut,O=this.zOut,u=this.wOut,d=b=>{if(mb.isConnected)return mb.getConnectedValue(b);let e=0,N=0,Z=0,T=0;if(n.isConnected&&(e=n.getConnectedValue(b)),i.isConnected&&(N=i.getConnectedValue(b)),V.isConnected&&(Z=V.getConnectedValue(b)),Q.isConnected&&(T=Q.getConnectedValue(b)),Y.isConnected){const n=Y.getConnectedValue(b);n&&(e=n.x,N=n.y)}if(L.isConnected){const n=L.getConnectedValue(b);n&&(Z=n.x,T=n.y)}if(B.isConnected){const n=B.getConnectedValue(b);n&&(e=n.x,N=n.y,Z=n.z)}return new U.IV(e,N,Z,T)};N._storedFunction=b=>d(b),Z._storedFunction=b=>{const n=d(b);return new e.On(n.r,n.g,n.b)},T._storedFunction=b=>{const n=d(b);return new e.Vector2(n.r,n.g)},z._storedFunction=b=>{const n=d(b);return new e.Vector2(n.b,n.a)},K._storedFunction=b=>d(b).r,I._storedFunction=b=>d(b).g,O._storedFunction=b=>d(b).b,u._storedFunction=b=>d(b).a}}),function(b){b[b.Cos=0]="Cos",b[b.Sin=1]="Sin",b[b.Abs=2]="Abs",b[b.Exp=3]="Exp",b[b.Exp2=4]="Exp2",b[b.Round=5]="Round",b[b.Floor=6]="Floor",b[b.Ceiling=7]="Ceiling",b[b.Sqrt=8]="Sqrt",b[b.Log=9]="Log",b[b.Tan=10]="Tan",b[b.ArcTan=11]="ArcTan",b[b.ArcCos=12]="ArcCos",b[b.ArcSin=13]="ArcSin",b[b.Sign=14]="Sign",b[b.Negate=15]="Negate",b[b.OneMinus=16]="OneMinus",b[b.Reciprocal=17]="Reciprocal",b[b.ToDegrees=18]="ToDegrees",b[b.ToRadians=19]="ToRadians",b[b.Fract=20]="Fract"}(qn||(qn={}));class Ni extends Hn{constructor(b){super(b),this.operation=qn.Cos,this.registerInput("input",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Jn.Float|Jn.Int|Jn.Vector2|Jn.On|Jn.IV)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);let n=null;switch(this.operation){case qn.Cos:n=b=>Math.cos(b);break;case qn.Sin:n=b=>Math.sin(b);break;case qn.Abs:n=b=>Math.abs(b);break;case qn.Exp:n=b=>Math.exp(b);break;case qn.Exp2:n=b=>Math.pow(2,b);break;case qn.Round:n=b=>Math.round(b);break;case qn.Floor:n=b=>Math.floor(b);break;case qn.Ceiling:n=b=>Math.ceil(b);break;case qn.Sqrt:n=b=>Math.sqrt(b);break;case qn.Log:n=b=>Math.log(b);break;case qn.Tan:n=b=>Math.tan(b);break;case qn.ArcTan:n=b=>Math.atan(b);break;case qn.ArcCos:n=b=>Math.acos(b);break;case qn.ArcSin:n=b=>Math.asin(b);break;case qn.Sign:n=b=>Math.sign(b);break;case qn.Negate:n=b=>-b;break;case qn.OneMinus:n=b=>1-b;break;case qn.Reciprocal:n=b=>1/b;break;case qn.ToRadians:n=b=>b*Math.PI/180;break;case qn.ToDegrees:n=b=>180*b/Math.PI;break;case qn.Fract:n=b=>b>=0?b-Math.floor(b):b-Math.ceil(b)}if(!n)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Jn.Int:case Jn.Float:this.output._storedFunction=b=>{const i=this.input.getConnectedValue(b);return n(i)};break;case Jn.Vector2:this.output._storedFunction=b=>{const i=this.input.getConnectedValue(b);return new e.Vector2(n(i.x),n(i.y))};break;case Jn.On:this.output._storedFunction=b=>{const i=this.input.getConnectedValue(b);return new e.On(n(i.x),n(i.y),n(i.z))};break;case Jn.IV:this.output._storedFunction=b=>{const i=this.input.getConnectedValue(b);return new U.IV(n(i.r),n(i.g),n(i.b),n(i.a))}}return this}serialize(){const b=super.serialize();return b.operation=this.operation,b}_deserialize(b){super._deserialize(b),this.operation=b.operation}}(0,E.e)([ln("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:qn.Cos},{label:"Sin",value:qn.Sin},{label:"Abs",value:qn.Abs},{label:"Exp",value:qn.Exp},{label:"Exp2",value:qn.Exp2},{label:"Round",value:qn.Round},{label:"Floor",value:qn.Floor},{label:"Ceiling",value:qn.Ceiling},{label:"Sqrt",value:qn.Sqrt},{label:"Log",value:qn.Log},{label:"Tan",value:qn.Tan},{label:"ArcTan",value:qn.ArcTan},{label:"ArcCos",value:qn.ArcCos},{label:"ArcSin",value:qn.ArcSin},{label:"Sign",value:qn.Sign},{label:"Negate",value:qn.Negate},{label:"OneMinus",value:qn.OneMinus},{label:"Reciprocal",value:qn.Reciprocal},{label:"ToDegrees",value:qn.ToDegrees},{label:"ToRadians",value:qn.ToRadians},{label:"Fract",value:qn.Fract}]})],Ni.prototype,"operation",void 0),(0,Y.i)("BABYLON.ParticleTrigonometryBlock",Ni);var Zi,Ti=i(13203);class zi extends Hn{constructor(b){super(b),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Jn.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Jn.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Jn.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Jn.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Jn.System),this._inputs[0].excludedConnectionPointTypes.push(Jn.Particle),this._inputs[0].excludedConnectionPointTypes.push(Jn.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const n=b=>{const n=this.input.getConnectedValue(b);if(this.log.length>=this.stackSize)return n;if(null===n||void 0===n)return this.log.push(["null",""]),n;switch(this.input.type){case Jn.Vector2:this.log.push([(0,Ti.i)(n,4),n.toString()]);break;case Jn.On:this.log.push([(0,Ti.k)(n,4),n.toString()]);break;case Jn.IV:this.log.push([`{R: ${n.r.toFixed(4)} G: ${n.g.toFixed(4)} B: ${n.b.toFixed(4)} A: ${n.a.toFixed(4)}}`,n.toString()]);break;default:this.log.push([n.toString(),n.toString()])}return n};this.output.isConnected?this.output._storedFunction=n:this.output._storedValue=n(b)}serialize(){const b=super.serialize();return b.stackSize=this.stackSize,b}_deserialize(b){super._deserialize(b),this.stackSize=b.stackSize}}(0,E.e)([ln("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],zi.prototype,"stackSize",void 0),(0,Y.i)("BABYLON.ParticleDebugBlock",zi);(0,Y.i)("BABYLON.ParticleElbowBlock",class extends Hn{constructor(b){super(b),this.registerInput("input",Jn.AutoDetect),this.registerOutput("output",Jn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);const n=this._outputs[0],i=this._inputs[0];n._storedFunction=b=>i.getConnectedValue(b)}});(0,Y.i)("BABYLON.ParticleTeleportInBlock",class extends Hn{get endpoints(){return this._endpoints}constructor(b){super(b),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Jn.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(b){if(this.getClassName()===b)return!0;for(const n of this.endpoints)if(n.isAnAncestorOfType(b))return!0;return!1}isAnAncestorOf(b){for(const n of this.endpoints){if(n===b)return!0;if(n.isAnAncestorOf(b))return!0}return!1}attachToEndpoint(b){b.detach(),this._endpoints.push(b),b._entryPoint=this,b._outputs[0]._typeConnectionSource=this._inputs[0],b._tempEntryPointUniqueId=null,b.name="> "+this.name}detachFromEndpoint(b){const n=this._endpoints.indexOf(b);-1!==n&&(this._endpoints.splice(n,1),b._outputs[0]._typeConnectionSource=null,b._entryPoint=null)}_build(){for(const b of this._endpoints)b.output._storedFunction=b=>this.input.getConnectedValue(b)}});(0,Y.i)("BABYLON.ParticleTeleportOutBlock",class extends Hn{constructor(b){super(b),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Jn.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(b){this.entryPoint&&this.entryPoint.build(b)}clone(){const b=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(b),b}serialize(){var b;const n=super.serialize();return n.entryPoint=(null===(b=this.entryPoint)||void 0===b?void 0:b.uniqueId)??"",n}_deserialize(b){super._deserialize(b),this._tempEntryPointUniqueId=b.entryPoint}}),function(b){b[b.Equal=0]="Equal",b[b.NotEqual=1]="NotEqual",b[b.LessThan=2]="LessThan",b[b.GreaterThan=3]="GreaterThan",b[b.LessOrEqual=4]="LessOrEqual",b[b.GreaterOrEqual=5]="GreaterOrEqual",b[b.Xor=6]="Xor",b[b.Or=7]="Or",b[b.And=8]="And"}(Zi||(Zi={}));class Ki extends Hn{constructor(b){super(b),this.test=Zi.Equal,this.epsilon=0,this.registerInput("left",Jn.Float),this.registerInput("right",Jn.Float,!0,0),this.registerInput("ifTrue",Jn.AutoDetect,!0,1),this.registerInput("ifFalse",Jn.AutoDetect,!0,0),this.registerOutput("output",Jn.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Jn.Float,this._inputs[0].acceptedConnectionPointTypes.push(Jn.Int),this._inputs[1].acceptedConnectionPointTypes.push(Jn.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const b=b=>{const n=this.left.getConnectedValue(b),i=this.right.getConnectedValue(b);let e=!1;switch(this.test){case Zi.Equal:e=(0,B.WithinEpsilon)(n,i,this.epsilon);break;case Zi.NotEqual:e=!(0,B.WithinEpsilon)(n,i,this.epsilon);break;case Zi.LessThan:e=n<i+this.epsilon;break;case Zi.GreaterThan:e=n>i-this.epsilon;break;case Zi.LessOrEqual:e=n<=i+this.epsilon;break;case Zi.GreaterOrEqual:e=n>=i-this.epsilon;break;case Zi.Xor:e=!!n&&!i||!n&&!!i;break;case Zi.Or:e=!!n||!!i;break;case Zi.And:e=!!n&&!!i}return e};this.output._storedFunction=n=>b(n)?this.ifTrue.getConnectedValue(n):this.ifFalse.getConnectedValue(n)}serialize(){const b=super.serialize();return b.test=this.test,b.epsilon=this.epsilon,b}_deserialize(b){super._deserialize(b),this.test=b.test,void 0!==b.epsilon&&(this.epsilon=b.epsilon)}}(0,E.e)([ln("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Zi.Equal},{label:"NotEqual",value:Zi.NotEqual},{label:"LessThan",value:Zi.LessThan},{label:"GreaterThan",value:Zi.GreaterThan},{label:"LessOrEqual",value:Zi.LessOrEqual},{label:"GreaterOrEqual",value:Zi.GreaterOrEqual},{label:"Xor",value:Zi.Xor},{label:"Or",value:Zi.Or},{label:"And",value:Zi.And}]})],Ki.prototype,"test",void 0),(0,E.e)([ln("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ki.prototype,"epsilon",void 0),(0,Y.i)("BABYLON.ParticleConditionBlock",Ki);class Ii extends Hn{constructor(b){super(b),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Jn.Particle),this.registerInput("condition",Jn.Float,!0,0),this.registerInput("system",Jn.System),this.registerOutput("output",Jn.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){this._triggerCount=0;const n=this.input.getConnectedValue(b),i={process:i=>{if(b.particleContext=i,b.systemContext=n,0!==this.condition.getConnectedValue(b)&&(0===this.limit||this._triggerCount<this.limit)){const e=(new Date).getTime();if(this._previousOne&&e-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=e;const V=this.system.getConnectedValue(b);if(V){const e=pn(V,b.dn,i.position);e.Qe.addOnce((()=>{this._triggerCount--})),n.Qe.addOnce((()=>{e.dispose()}))}}},previousItem:null,nextItem:null};n._updateQueueStart?Xb(i,n._updateQueueStart):n._updateQueueStart=i,this.output._storedValue=n}serialize(){const b=super.serialize();return b.limit=this.limit,b.delay=this.delay,b}_deserialize(b){super._deserialize(b),void 0!==b.limit&&(this.limit=b.limit),void 0!==b.delay&&(this.delay=b.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,E.e)([ln("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ii.prototype,"limit",void 0),(0,E.e)([ln("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ii.prototype,"delay",void 0),(0,Y.i)("BABYLON.ParticleTriggerBlock",Ii);i(13210),i(13225),i(13234),i(13288)},13271:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneFragment",Q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13243:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneFragmentDeclaration",Q="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13303:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneVertex",Q="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13294:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneVertexDeclaration",Q="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13282:(b,n,i)=>{"use strict";var e=i(11686);const V="fogFragment",Q="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13263:(b,n,i)=>{"use strict";var e=i(11686);const V="fogFragmentDeclaration",Q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13309:(b,n,i)=>{"use strict";var e=i(11686);const V="fogVertex",Q="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13299:(b,n,i)=>{"use strict";var e=i(11686);const V="fogVertexDeclaration",Q="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13255:(b,n,i)=>{"use strict";var e=i(11686);const V="helperFunctions",Q="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13246:(b,n,i)=>{"use strict";var e=i(11686);const V="imageProcessingDeclaration",Q="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13260:(b,n,i)=>{"use strict";var e=i(11686);const V="imageProcessingFunctions",Q="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13251:(b,n,i)=>{"use strict";var e=i(11686);const V="logDepthDeclaration",Q="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13277:(b,n,i)=>{"use strict";var e=i(11686);const V="logDepthFragment",Q="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13317:(b,n,i)=>{"use strict";var e=i(11686);const V="logDepthVertex",Q="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";e.c.IncludesShadersStoreWGSL[V]||(e.c.IncludesShadersStoreWGSL[V]=Q)},13234:(b,n,i)=>{"use strict";i.r(n),i.d(n,{particlesPixelShaderWGSL:()=>U});var e=i(11686);i(13243),i(13246),i(13251),i(13255),i(13260),i(13263),i(13271),i(13277),i(13282);const V="particlesPixelShader",Q="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";e.c.ShadersStoreWGSL[V]||(e.c.ShadersStoreWGSL[V]=Q);const U={name:V,shader:Q}},13288:(b,n,i)=>{"use strict";i.r(n),i.d(n,{particlesVertexShaderWGSL:()=>U});var e=i(11686);i(13294),i(13299),i(13251),i(13303),i(13309),i(13317);const V="particlesVertexShader",Q="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";e.c.ShadersStoreWGSL[V]||(e.c.ShadersStoreWGSL[V]=Q);const U={name:V,shader:Q}},13137:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneFragment",Q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13218:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneFragmentDeclaration",Q="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13158:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneVertex",Q="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13227:(b,n,i)=>{"use strict";var e=i(11686);const V="clipPlaneVertexDeclaration",Q="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13150:(b,n,i)=>{"use strict";var e=i(11686);const V="fogFragment",Q="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13131:(b,n,i)=>{"use strict";var e=i(11686);const V="fogFragmentDeclaration",Q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13163:(b,n,i)=>{"use strict";var e=i(11686);const V="fogVertex",Q="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13156:(b,n,i)=>{"use strict";var e=i(11686);const V="fogVertexDeclaration",Q="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13118:(b,n,i)=>{"use strict";var e=i(11686);const V="helperFunctions",Q="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13104:(b,n,i)=>{"use strict";var e=i(11686);const V="imageProcessingDeclaration",Q="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13125:(b,n,i)=>{"use strict";var e=i(11686);const V="imageProcessingFunctions",Q="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13109:(b,n,i)=>{"use strict";var e=i(11686);const V="logDepthDeclaration",Q="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13141:(b,n,i)=>{"use strict";var e=i(11686);const V="logDepthFragment",Q="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13170:(b,n,i)=>{"use strict";var e=i(11686);const V="logDepthVertex",Q="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";e.c.IncludesShadersStore[V]||(e.c.IncludesShadersStore[V]=Q)},13210:(b,n,i)=>{"use strict";i.r(n),i.d(n,{particlesPixelShader:()=>U});var e=i(11686);i(13218),i(13104),i(13109),i(13118),i(13125),i(13131),i(13137),i(13141),i(13150);const V="particlesPixelShader",Q="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";e.c.ShadersStore[V]||(e.c.ShadersStore[V]=Q);const U={name:V,shader:Q}},13225:(b,n,i)=>{"use strict";i.r(n),i.d(n,{particlesVertexShader:()=>U});var e=i(11686);i(13227),i(13156),i(13109),i(13158),i(13163),i(13170);const V="particlesVertexShader",Q="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";e.c.ShadersStore[V]||(e.c.ShadersStore[V]=Q);const U={name:V,shader:Q}},13590:(b,n,i)=>{"use strict";i.r(n),i.d(n,{FlowGraphGLTFDataProvider:()=>Q});var e=i(13547),V=i(13522);class Q extends e.c{constructor(b){var n,i;super();const e=b.glTF,Q=(null===(n=e.animations)||void 0===n?void 0:n.map((b=>b._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",V.c,Q);const U=(null===(i=e.nodes)||void 0===i?void 0:i.map((b=>b._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",V.c,U)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13468:(b,n,i)=>{"use strict";i.d(n,{c:()=>I,g:()=>z,i:()=>T,m:()=>K});var e=i(11778),V=i(12247),Q=i(11822),U=i(13470);const Y=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class L{constructor(b,n){this._gltf=b,this._infoTree=n}convert(b){let n,i=this._gltf,e=this._infoTree;if(!b.startsWith("/"))throw new Error("Path must start with a /");const V=b.split("/");if(V.shift(),V[V.length-1].includes(".length")){const b=V[V.length-1].split(".");V.pop(),V.push(...b)}let Q=!1;for(const L of V){const V="length"===L;if(V&&!e.__array__)throw new Error(`Path ${b} is invalid`);if(e.__ignoreObjectTree__&&(Q=!0),e.__array__&&!V)e=e.__array__;else if(e=e[L],!e)throw new Error(`Path ${b} is invalid`);if(!Q)if(void 0===i){if(!Y.find((n=>n.regex.test(b))))throw new Error(`Path ${b} is invalid`)}else if(!V){var U;i=null===(U=i)||void 0===U?void 0:U[L]}(e.__target__||V)&&(n=i)}return{object:n,info:e}}}function B(b,n,i,e){const V=mb(b,n);return e?V[i][e]:V[i]}function mb(b,n,i){var e,Q;return null===(e=b._data)||void 0===e||null===(Q=e[(null===i||void 0===i?void 0:i.fillMode)??V.e.MATERIAL_TriangleFillMode])||void 0===Q?void 0:Q.babylonMaterial}function N(b,n){return{offset:{componentsCount:2,type:"Vector2",get:(i,V,Q)=>{const U=B(i,Q,b,n);return new e.Vector2(null===U||void 0===U?void 0:U.uOffset,null===U||void 0===U?void 0:U.vOffset)},getTarget:mb,set:(i,e,V,Q)=>{const U=B(e,Q,b,n);U.uOffset=i.x,U.vOffset=i.y},getPropertyName:[()=>`${b}${n?"."+n:""}.uOffset`,()=>`${b}${n?"."+n:""}.vOffset`]},rotation:{type:"number",get:(i,e,V)=>{var Q;return null===(Q=B(i,V,b,n))||void 0===Q?void 0:Q.wAng},getTarget:mb,set:(i,e,V,Q)=>B(e,Q,b,n).wAng=i,getPropertyName:[()=>`${b}${n?"."+n:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(i,V,Q)=>{const U=B(i,Q,b,n);return new e.Vector2(null===U||void 0===U?void 0:U.uScale,null===U||void 0===U?void 0:U.vScale)},getTarget:mb,set:(i,e,V,Q)=>{const U=B(e,Q,b,n);U.uScale=i.x,U.vScale=i.y},getPropertyName:[()=>`${b}${n?"."+n:""}.uScale`,()=>`${b}${n?"."+n:""}.vScale`]}}}const Z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:b=>{var n,i;return new e.Vector2((null===(n=b._babylonCamera)||void 0===n?void 0:n.orthoLeft)??0,(null===(i=b._babylonCamera)||void 0===i?void 0:i.orthoRight)??0)},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.orthoLeft=b.x,n._babylonCamera.orthoRight=b.y)},getTarget:b=>b,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:b=>{var n,i;return new e.Vector2((null===(n=b._babylonCamera)||void 0===n?void 0:n.orthoBottom)??0,(null===(i=b._babylonCamera)||void 0===i?void 0:i.orthoTop)??0)},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.orthoBottom=b.x,n._babylonCamera.orthoTop=b.y)},getTarget:b=>b,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:b=>{var n;return null===(n=b._babylonCamera)||void 0===n?void 0:n.maxZ},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.maxZ=b)},getTarget:b=>b,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:b=>{var n;return null===(n=b._babylonCamera)||void 0===n?void 0:n.Ae},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.Ae=b)},getTarget:b=>b,getPropertyName:[()=>"Ae"]}},perspective:{aspectRatio:{type:"number",get:b=>{var n;return null===(n=b._babylonCamera)||void 0===n?void 0:n.getEngine().getAspectRatio(b._babylonCamera)},getTarget:b=>b,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:b=>{var n;return null===(n=b._babylonCamera)||void 0===n?void 0:n.fov},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.fov=b)},getTarget:b=>b,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:b=>{var n;return null===(n=b._babylonCamera)||void 0===n?void 0:n.maxZ},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.maxZ=b)},getTarget:b=>b,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:b=>{var n;return null===(n=b._babylonCamera)||void 0===n?void 0:n.Ae},set:(b,n)=>{n._babylonCamera&&(n._babylonCamera.Ae=b)},getTarget:b=>b,getPropertyName:[()=>"Ae"]}}}},nodes:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"On",get:b=>{var n;return null===(n=b._babylonTransformNode)||void 0===n?void 0:n.position},set:(b,n)=>{var i;return null===(i=n._babylonTransformNode)||void 0===i?void 0:i.position.L(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:b=>{var n;return null===(n=b._babylonTransformNode)||void 0===n?void 0:n.rotationQuaternion},set:(b,n)=>{var i,e;return null===(i=n._babylonTransformNode)||void 0===i||null===(e=i.rotationQuaternion)||void 0===e?void 0:e.L(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"On",get:b=>{var n;return null===(n=b._babylonTransformNode)||void 0===n?void 0:n.ge},set:(b,n)=>{var i;return null===(i=n._babylonTransformNode)||void 0===i?void 0:i.ge.L(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"ge"]},weights:{length:{type:"number",get:b=>b._numMorphTargets,getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(b,n)=>{var i,e;return void 0!==n?null===(i=b._primitiveBabylonMeshes)||void 0===i||null===(e=i[0].morphTargetManager)||void 0===e?void 0:e.getTarget(n).influence:void 0},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(b,n)=>[0],getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:b=>{var n,i,V;return e.Matrix.Compose(null===(n=b._babylonTransformNode)||void 0===n?void 0:n.ge,null===(i=b._babylonTransformNode)||void 0===i?void 0:i.rotationQuaternion,null===(V=b._babylonTransformNode)||void 0===V?void 0:V.position)},getTarget:b=>b._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:b=>{var n,i,V,Q;const U=e.Matrix.Identity();let Y=b.parent;for(;Y&&Y.parent;)Y=Y.parent;const L=(null===(n=b._babylonTransformNode)||void 0===n?void 0:n.position._isDirty)||(null===(i=b._babylonTransformNode)||void 0===i||null===(V=i.rotationQuaternion)||void 0===V?void 0:V._isDirty)||(null===(Q=b._babylonTransformNode)||void 0===Q?void 0:Q.ge._isDirty);if(Y){var B;const n=null===(B=Y._babylonTransformNode)||void 0===B?void 0:B.we(!0).invert();var mb,N;if(n)null===(mb=b._babylonTransformNode)||void 0===mb||null===(N=mb.we(L))||void 0===N||N.multiplyToRef(n,U)}else b._babylonTransformNode&&U.L(b._babylonTransformNode.we(L));return U},getTarget:b=>b._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:b=>{var n,i;return null===(n=b._babylonTransformNode)||void 0===n||null===(i=n.getChildren((b=>b instanceof U.e),!0)[0])||void 0===i?void 0:i.GY},getTarget:b=>{var n;return null===(n=b._babylonTransformNode)||void 0===n?void 0:n.getChildren((b=>b instanceof U.e),!0)[0]},set:(b,n)=>{if(n._babylonTransformNode){const i=n._babylonTransformNode.getChildren((b=>b instanceof U.e),!0)[0];i&&(i.GY=b)}}},color:{type:"Mn",get:b=>{var n,i;return null===(n=b._babylonTransformNode)||void 0===n||null===(i=n.getChildren((b=>b instanceof U.e),!0)[0])||void 0===i?void 0:i.oY},getTarget:b=>{var n;return null===(n=b._babylonTransformNode)||void 0===n?void 0:n.getChildren((b=>b instanceof U.e),!0)[0]},set:(b,n)=>{if(n._babylonTransformNode){const i=n._babylonTransformNode.getChildren((b=>b instanceof U.e),!0)[0];i&&(i.oY=b)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Mn",get:(b,n,i)=>mb(b,n,i).emissiveColor,set:(b,n,i,e)=>mb(n,i,e).emissiveColor.L(b),getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:N("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(b,n,i)=>{var e;return null===(e=B(b,i,"bumpTexture"))||void 0===e?void 0:e.level},set:(b,n,i,e)=>{const V=B(n,e,"bumpTexture");V&&(V.level=b)},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:N("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(b,n,i)=>mb(b,n,i).ambientTextureStrength,set:(b,n,i,e)=>{const V=mb(n,i,e);V&&(V.ambientTextureStrength=b)},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:N("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"IV",get:(b,n,i)=>{const e=mb(b,n,i);return Q.IV.FromColor3(e.albedoColor,e.alpha)},set:(b,n,i,e)=>{const V=mb(n,i,e);V.albedoColor.set(b.r,b.g,b.b),V.alpha=b.a},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:N("albedoTexture")}},metallicFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).metallic,set:(b,n,i,e)=>{const V=mb(n,i,e);V&&(V.metallic=b)},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).roughness,set:(b,n,i,e)=>{const V=mb(n,i,e);V&&(V.roughness=b)},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:N("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(b,n,i)=>mb(b,n,i).anisotropy.GY,set:(b,n,i,e)=>{mb(n,i,e).anisotropy.GY=b},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(b,n,i)=>mb(b,n,i).anisotropy.angle,set:(b,n,i,e)=>{mb(n,i,e).anisotropy.angle=b},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:N("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).clearCoat.GY,set:(b,n,i,e)=>{mb(n,i,e).clearCoat.GY=b},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).clearCoat.roughness,set:(b,n,i,e)=>{mb(n,i,e).clearCoat.roughness=b},getTarget:(b,n,i)=>mb(b,n,i),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:N("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(b,n,i)=>{var e;return null===(e=mb(b,n,i).clearCoat.bumpTexture)||void 0===e?void 0:e.level},getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).clearCoat.bumpTexture.level=b},extensions:{KHR_texture_transform:N("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:N("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(b,n,i)=>mb(b,n,i).subSurface.dispersion,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).subSurface.dispersion=b}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(b,n,i)=>mb(b,n,i).emissiveIntensity,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).emissiveIntensity=b}},KHR_materials_ior:{ior:{type:"number",get:(b,n,i)=>mb(b,n,i).indexOfRefraction,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).indexOfRefraction=b}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).iridescence.GY,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).iridescence.GY=b},iridescenceIor:{type:"number",get:(b,n,i)=>mb(b,n,i).iridescence.indexOfRefraction,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).iridescence.indexOfRefraction=b},iridescenceTexture:{extensions:{KHR_texture_transform:N("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(b,n,i)=>mb(b,n,i).iridescence.maximumThickness,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).iridescence.maximumThickness=b},iridescenceThicknessMinimum:{type:"number",get:(b,n,i)=>mb(b,n,i).iridescence.minimumThickness,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).iridescence.minimumThickness=b},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:N("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Mn",get:(b,n,i)=>mb(b,n,i).sheen.color,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).sheen.color.L(b)},sheenColorTexture:{extensions:{KHR_texture_transform:N("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).sheen.GY,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).sheen.GY=b},sheenRoughnessTexture:{extensions:{KHR_texture_transform:N("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).metallicF0Factor,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).metallicF0Factor=b,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Mn",get:(b,n,i)=>mb(b,n,i).metallicReflectanceColor,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).metallicReflectanceColor.L(b),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:N("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:N("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).subSurface.refractionIntensity,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).subSurface.refractionIntensity=b,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:N("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).subSurface.translucencyIntensity,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).subSurface.translucencyIntensity=b},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:N("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Mn",get:(b,n,i)=>mb(b,n,i).subSurface.translucencyColor,getTarget:mb,set:(b,n,i,e)=>{var V;return b&&(null===(V=mb(n,i,e).subSurface.translucencyColor)||void 0===V?void 0:V.L(b))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:N("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Mn",get:(b,n,i)=>mb(b,n,i).subSurface.tintColor,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).subSurface.tintColor.L(b)},attenuationDistance:{type:"number",get:(b,n,i)=>mb(b,n,i).subSurface.tintColorAtDistance,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).subSurface.tintColorAtDistance=b},thicknessFactor:{type:"number",get:(b,n,i)=>mb(b,n,i).subSurface.maximumThickness,getTarget:mb,set:(b,n,i,e)=>mb(n,i,e).subSurface.maximumThickness=b},thicknessTexture:{extensions:{KHR_texture_transform:N("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonLight)),getPropertyName:[b=>"length"]},__array__:{__target__:!0,color:{type:"Mn",get:b=>{var n;return null===(n=b._babylonLight)||void 0===n?void 0:n.oY},set:(b,n)=>{var i;return null===(i=n._babylonLight)||void 0===i?void 0:i.oY.L(b)},getTarget:b=>b._babylonLight,getPropertyName:[b=>"diffuse"]},GY:{type:"number",get:b=>{var n;return null===(n=b._babylonLight)||void 0===n?void 0:n.GY},set:(b,n)=>n._babylonLight?n._babylonLight.GY=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"intensity"]},range:{type:"number",get:b=>{var n;return null===(n=b._babylonLight)||void 0===n?void 0:n.range},set:(b,n)=>n._babylonLight?n._babylonLight.range=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"range"]},spot:{innerConeAngle:{type:"number",get:b=>{var n;return null===(n=b._babylonLight)||void 0===n?void 0:n.innerAngle},set:(b,n)=>n._babylonLight?n._babylonLight.innerAngle=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"innerConeAngle"]},outerConeAngle:{type:"number",get:b=>{var n;return null===(n=b._babylonLight)||void 0===n?void 0:n.angle},set:(b,n)=>n._babylonLight?n._babylonLight.angle=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonLight)),getPropertyName:[b=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonTexture)),getPropertyName:[b=>"length"]},__array__:{__target__:!0,GY:{type:"number",get:b=>{var n;return null===(n=b._babylonTexture)||void 0===n?void 0:n.level},set:(b,n)=>{n._babylonTexture&&(n._babylonTexture.level=b)},getTarget:b=>b._babylonTexture},rotation:{type:"Quaternion",get:b=>{var n;return b._babylonTexture&&e.Quaternion.FromRotationMatrix(null===(n=b._babylonTexture)||void 0===n?void 0:n.getReflectionTextureMatrix())},set:(b,n)=>{var i;n._babylonTexture&&(null!==(i=n._babylonTexture.ab())&&void 0!==i&&i.useRightHandedSystem||(b=e.Quaternion.Inverse(b)),e.Matrix.FromQuaternionToRef(b,n._babylonTexture.getReflectionTextureMatrix()))},getTarget:b=>b._babylonTexture}}}}},animations:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>{var n;return null===(n=b.primitives[0]._instanceData)||void 0===n?void 0:n.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function T(b){return new L(b,Z)}function z(b){const n=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let i=Z;for(const e of n)e&&(i=i[e]);if(i&&i.type&&i.get)return i}function K(b,n){const i=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let e=Z;for(const V of i)V&&(e=e[V]);e&&e.type&&e.get&&(e.interpolation=n)}function I(b,n){const i=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let e=Z;for(const V of i)if(V){if(!e[V]){if("?"===V){e.__ignoreObjectTree__=!0;continue}e[V]={},"__array__"===V&&(e[V].__target__=!0)}e=e[V]}Object.assign(e,n)}},13475:(b,n,i)=>{"use strict";i.r(n),i.d(n,{AnimationPropertyInfo:()=>B,TransformNodeAnimationPropertyInfo:()=>mb,WeightAnimationPropertyInfo:()=>N,getQuaternion:()=>Y,getVector3:()=>U,getWeights:()=>L});var e=i(12301),V=i(11778),Q=i(13468);function U(b,n,i,e){return V.On.jn(n,i).scaleInPlace(e)}function Y(b,n,i,e){return V.Quaternion.jn(n,i).scaleInPlace(e)}function L(b,n,i,e){const V=new Array(b._numMorphTargets);for(let Q=0;Q<V.length;Q++)V[Q]=n[i++]*e;return V}class B{constructor(b,n,i,e){this.type=b,this.name=n,this.getValue=i,this.getStride=e}_buildAnimation(b,n,i){const V=new e.c(b,this.name,n,this.type);return V.setKeys(i),V}}class mb extends B{buildAnimations(b,n,i,e){const V=[];return V.push({babylonAnimatable:b._babylonTransformNode,babylonAnimation:this._buildAnimation(n,i,e)}),V}}class N extends B{buildAnimations(b,n,i,V){const Q=[];if(b._numMorphTargets)for(let U=0;U<b._numMorphTargets;U++){const Y=new e.c(`${n}_${U}`,this.name,i,this.type);if(Y.setKeys(V.map((b=>({frame:b.frame,inTangent:b.inTangent?b.inTangent[U]:void 0,value:b.value[U],outTangent:b.outTangent?b.outTangent[U]:void 0,interpolation:b.interpolation})))),b._primitiveBabylonMeshes)for(const n of b._primitiveBabylonMeshes)if(n.morphTargetManager){const b=n.morphTargetManager.getTarget(U),i=Y.clone();b.animations.push(i),Q.push({babylonAnimatable:b,babylonAnimation:i})}}return Q}}(0,Q.m)("/nodes/{}/translation",[new mb(e.c.ANIMATIONTYPE_VECTOR3,"position",U,(()=>3))]),(0,Q.m)("/nodes/{}/rotation",[new mb(e.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",Y,(()=>4))]),(0,Q.m)("/nodes/{}/scale",[new mb(e.c.ANIMATIONTYPE_VECTOR3,"ge",U,(()=>3))]),(0,Q.m)("/nodes/{}/weights",[new N(e.c.ANIMATIONTYPE_FLOAT,"influence",L,(b=>b._numMorphTargets))])},13436:(b,n,i)=>{"use strict";class e{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((b,n)=>{this._resolve=b,this._reject=n}))}}var V=i(11778),Q=i(11822),U=i(11605),Y=i(12222),L=i(13445),B=i(13451),mb=i(11612),N=i(12244),Z=i(12301),T=i(12304),z=i(11646),K=i(11621),I=i(11625);class O{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(b){this._useTextureToStoreBoneMatrices=b,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(b){this._animationPropertiesOverride=b}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(b,n,i){this.name=b,this.id=n,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=V.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new mb.e,this.bones=[],this._scene=i||z.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const e=this._scene.getEngine().getCaps();this._canUseTextureForBones=e.textureFloat&&e.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((b=>!b.getParent()))}getTransformMatrices(b){if(this.needInitialSkinMatrix){if(!b)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return b._bonesTransformMatrices||this.prepare(!0),b._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(b){return this.needInitialSkinMatrix&&b._transformMatrixTexture?b._transformMatrixTexture:this._transformMatrixTexture}ab(){return this._scene}toString(b){let n=`Name: ${this.name}, nBones: ${this.bones.length}`;if(n+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,b){n+=", Ranges: {";let b=!0;for(const i in this._ranges)b&&(n+=", ",b=!1),n+=i;n+="}"}return n}getBoneIndexByName(b){for(let n=0,i=this.bones.length;n<i;n++)if(this.bones[n].name===b)return n;return-1}createAnimationRange(b,n,i){if(!this._ranges[b]){this._ranges[b]=new T.c(b,n,i);for(let e=0,V=this.bones.length;e<V;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].createRange(b,n,i)}}deleteAnimationRange(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let i=0,e=this.bones.length;i<e;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(b,n);this._ranges[b]=null}getAnimationRange(b){return this._ranges[b]||null}getAnimationRanges(){const b=[];let n;for(n in this._ranges)b.push(this._ranges[n]);return b}copyAnimationRange(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[n]||!b.getAnimationRange(n))return!1;let e=!0;const V=this._getHighestAnimationFrame()+1,Q={},U=b.bones;let Y,L;for(L=0,Y=U.length;L<Y;L++)Q[U[L].name]=U[L];this.bones.length!==U.length&&(K.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${U.length}`),e=!1);const B=i&&this.dimensionsAtRest&&b.dimensionsAtRest?this.dimensionsAtRest.divide(b.dimensionsAtRest):null;for(L=0,Y=this.bones.length;L<Y;L++){const b=this.bones[L].name,U=Q[b];U?e=e&&this.bones[L].copyAnimationRange(U,n,V,i,B):(K.b.Warn("copyAnimationRange: not same rig, missing source bone "+b),e=!1)}const mb=b.getAnimationRange(n);return mb&&(this._ranges[n]=new T.c(n,mb.from+V,mb.to+V)),e}returnToRest(){for(const b of this.bones)-1!==b._index&&b.returnToRest()}_getHighestAnimationFrame(){let b=0;for(let n=0,i=this.bones.length;n<i;n++)if(this.bones[n].animations[0]){const i=this.bones[n].animations[0].getHighestFrame();b<i&&(b=i)}return b}beginAnimation(b,n,i,e){const V=this.getAnimationRange(b);return V?this._scene.beginAnimation(this,V.from,V.to,n,i,e):null}static MakeAnimationAdditive(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const e=b.getAnimationRange(i);if(!e)return null;const V=b._scene.getAllAnimatablesByTarget(b);let Q=null;for(let Y=0;Y<V.length;Y++){const b=V[Y];if(b.fromFrame===(null===e||void 0===e?void 0:e.from)&&b.toFrame===(null===e||void 0===e?void 0:e.to)){Q=b;break}}const U=b.getAnimatables();for(let Y=0;Y<U.length;Y++){const b=U[Y].animations;if(b)for(let e=0;e<b.length;e++)Z.c.MakeAnimationAdditive(b[e],n,i)}return Q&&(Q.isAdditive=!0),b}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(b){this._meshesWithPoseMatrix.push(b)}_unregisterMeshWithPoseMatrix(b){const n=this._meshesWithPoseMatrix.indexOf(b);n>-1&&this._meshesWithPoseMatrix.splice(n,1)}_computeTransformMatrices(b,n){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const e=this.bones[i];e._childUpdateId++;const V=e.getParent();if(V?e.getLocalMatrix().multiplyToRef(V.getFinalMatrix(),e.getFinalMatrix()):n?e.getLocalMatrix().multiplyToRef(n,e.getFinalMatrix()):e.getFinalMatrix().L(e.getLocalMatrix()),-1!==e._index){const n=null===e._index?i:e._index;e.getAbsoluteInverseBindMatrix().multiplyToArray(e.getFinalMatrix(),b,16*n)}}this._identity.copyToArray(b,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const b=this.ab().getRenderId();if(this._currentRenderId===b)return;this._currentRenderId=b}if(this._numBonesWithLinkedTransformNode>0)for(const b of this.bones)if(b._linkedTransformNode){const n=b._linkedTransformNode;b.position=n.position,n.rotationQuaternion?b.rotationQuaternion=n.rotationQuaternion:b.rotation=n.rotation,b.ge=n.ge}if(this.needInitialSkinMatrix)for(const b of this._meshesWithPoseMatrix){const n=b.getPoseMatrix();let i=this._isDirty;if(b._bonesTransformMatrices&&b._bonesTransformMatrices.length===16*(this.bones.length+1)||(b._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==b){this._synchronizedWithMesh=b;for(const b of this.bones)if(!b.getParent()){b.getBindMatrix().multiplyToRef(n,V.TmpVectors.Matrix[1]),b._updateAbsoluteBindMatrices(V.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const n=4*(this.bones.length+1);b._transformMatrixTexture&&b._transformMatrixTexture.getSize().width===n||(b._transformMatrixTexture&&b._transformMatrixTexture.dispose(),b._transformMatrixTexture=N.d.CreateRGBATexture(b._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(b._bonesTransformMatrices,n),this.isUsingTextureForMatrices&&b._transformMatrixTexture&&b._transformMatrixTexture.update(b._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=N.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let b=0;b<this.bones.length;b++)this._animatables.push(this.bones[b])}return this._animatables}clone(b,n){const i=new O(b,n||b,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){const b=this.bones[e];let n=null;const V=b.getParent();if(V){const b=this.bones.indexOf(V);n=i.bones[b]}const Q=new B.e(b.name,i,n,b.getBindMatrix().clone(),b.getRestMatrix().clone());Q._index=b._index,b._linkedTransformNode&&Q.linkTransformNode(b._linkedTransformNode),I.e.DeepCopy(b.animations,Q.animations)}if(this._ranges){i._ranges={};for(const b in this._ranges){const n=this._ranges[b];n&&(i._ranges[b]=n.clone())}}return this._isDirty=!0,i.prepare(!0),i}enableBlending(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const n of this.bones)for(const i of n.animations)i.enableBlending=!0,i.blendingSpeed=b}dispose(){if(this._meshesWithPoseMatrix.length=0,this.ab().stopAnimation(this),this.ab().removeSkeleton(this),this._parentContainer){const b=this._parentContainer.skeletons.indexOf(this);b>-1&&this._parentContainer.skeletons.splice(b,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const b={};b.name=this.name,b.id=this.id,this.dimensionsAtRest&&(b.dimensionsAtRest=this.dimensionsAtRest.ye()),b.bones=[],b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let i=0;i<this.bones.length;i++){var n;const e=this.bones[i],V=e.getParent(),Q={parentBoneIndex:V?this.bones.indexOf(V):-1,index:e.getIndex(),name:e.name,id:e.id,matrix:e.getBindMatrix().ye(),rest:e.getRestMatrix().ye(),linkedTransformNodeId:null===(n=e.getTransformNode())||void 0===n?void 0:n.id};b.bones.push(Q),e.length&&(Q.length=e.length),e.metadata&&(Q.metadata=e.metadata),e.animations&&e.animations.length>0&&(Q.animation=e.animations[0].serialize()),b.ranges=[];for(const n in this._ranges){const i=this._ranges[n];if(!i)continue;const e={};e.name=n,e.from=i.from,e.to=i.to,b.ranges.push(e)}}return b}static Parse(b,n){const i=new O(b.name,b.id,n);let e;for(b.dimensionsAtRest&&(i.dimensionsAtRest=V.On.jn(b.dimensionsAtRest)),i.needInitialSkinMatrix=b.needInitialSkinMatrix,e=0;e<b.bones.length;e++){const n=b.bones[e],Q=b.bones[e].index;let U=null;n.parentBoneIndex>-1&&(U=i.bones[n.parentBoneIndex]);const Y=n.rest?V.Matrix.jn(n.rest):null,L=new B.e(n.name,i,U,V.Matrix.jn(n.matrix),Y,null,Q);void 0!==n.id&&null!==n.id&&(L.id=n.id),n.length&&(L.length=n.length),n.metadata&&(L.metadata=n.metadata),n.animation&&L.animations.push(Z.c.Parse(n.animation)),void 0!==n.linkedTransformNodeId&&null!==n.linkedTransformNodeId&&(i._hasWaitingData=!0,L._waitingTransformNodeId=n.linkedTransformNodeId)}if(b.ranges)for(e=0;e<b.ranges.length;e++){const n=b.ranges[e];i.createAnimationRange(n.name,n.from,n.to)}return i}computeAbsoluteMatrices(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||b)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(b)}getPoseMatrix(){let b=null;return this._meshesWithPoseMatrix.length>0&&(b=this._meshesWithPoseMatrix[0].getPoseMatrix()),b}sortBones(){const b=[],n=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,b,n);this.bones=b}_sortBones(b,n,i){if(i[b])return;i[b]=!0;const e=this.bones[b];if(!e)return;void 0===e._index&&(e._index=b);const V=e.getParent();V&&this._sortBones(this.bones.indexOf(V),n,i),n.push(e)}setCurrentPoseAsRest(){for(const b of this.bones)b.setCurrentPoseAsRest()}}var u=i(12095),d=i(12261),G=i(11748),o=i(12185),M=i(11842),j=i(12225),a=i(12190),D=i(12215),x=i(12310),y=i(11865),s=i(13403);class A{set areUpdatesFrozen(b){b?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new y.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,b||(b=z.d.LastCreatedScene),this._scene=b,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const b=this._scene.getEngine().getCaps();this._canUseTextureForTargets=b.canUseGLVertexID&&b.textureFloat&&b.maxVertexTextureImageUnits>0&&b.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return A.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?A.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(b){this._numMaxInfluencers!==b&&(this._numMaxInfluencers=b,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(b){this._useTextureToStoreTargets!==b&&(this._useTextureToStoreTargets=b,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var b;return A.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(b=this._scene)&&void 0!==b&&b.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(b){return this._activeTargets.data[b]}getTarget(b){return this._targets[b]}getTargetByName(b){for(const n of this._targets)if(n.name===b)return n;return null}addTarget(b){this._targets.push(b),this._targetInfluenceChangedObservers.push(b.onInfluenceChanged.add((b=>{this.areUpdatesFrozen&&b&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(b)}))),this._targetDataLayoutChangedObservers.push(b._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(b){const n=this._targets.indexOf(b);n>=0&&(this._targets.splice(n,1),b.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(n,1)[0]),b._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(n,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(b)}_bind(b){b.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),b.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),b.setTexture("morphTargets",this._targetStoreTexture),b.setInt("morphTargetCount",this.numInfluencers)}clone(){const b=new A(this._scene);for(const n of this._targets)b.addTarget(n.clone());return b.enablePositionMorphing=this.enablePositionMorphing,b.enableNormalMorphing=this.enableNormalMorphing,b.enableTangentMorphing=this.enableTangentMorphing,b.enableUVMorphing=this.enableUVMorphing,b.enableUV2Morphing=this.enableUV2Morphing,b.enableColorMorphing=this.enableColorMorphing,b}serialize(){const b={};b.id=this.uniqueId,b.targets=[];for(const n of this._targets)b.targets.push(n.serialize());return b}_syncActiveTargets(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const n=!!this._targetStoreTexture,i=this.isUsingTextureForTargets;(this._mustSynchronize||n!==i)&&(this._mustSynchronize=!1,this.synchronize());let e=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let V=-1;for(const Q of this._targets)if(V++,0!==Q.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=A.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Q),this._morphTargetTextureIndices[e]=V,this._tempInfluences[e++]=Q.influence}this._morphTargetTextureIndices.length!==e&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,e)),this._influences&&this._influences.length===e||(this._influences=new Float32Array(e));for(let Q=0;Q<e;Q++)this._influences[Q]=this._tempInfluences[Q];if(b&&this._scene)for(const Q of this._scene.meshes)Q.morphTargetManager===this&&(i?Q._markSubMeshesAsAttributesDirty():Q._syncGeometryWithMorphTargetManager())}synchronize(){var b;if(!this._scene||this.areUpdatesFrozen)return;const n=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(b=this._targetStoreTexture)||void 0===b||b.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>n.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const i of this._targets){this._supportsPositions=this._supportsPositions&&i.hasPositions,this._supportsNormals=this._supportsNormals&&i.hasNormals,this._supportsTangents=this._supportsTangents&&i.hasTangents,this._supportsUVs=this._supportsUVs&&i.hasUVs,this._supportsUV2s=this._supportsUV2s&&i.hasUV2s,this._supportsColors=this._supportsColors&&i.hasColors;const b=i.vertexCount;if(0===this._vertexCount)this._vertexCount=b;else if(this._vertexCount!==b)return void K.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${i.name}": ${b}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const b=n.getCaps().maxTextureSize;this._textureWidth>b&&(this._textureHeight=Math.ceil(this._textureWidth/b),this._textureWidth=b);const i=this._targets.length,e=new Float32Array(i*this._textureWidth*this._textureHeight*4);let V=0;for(let n=0;n<i;n++){const b=this._targets[n],i=b.getPositions(),Q=b.getNormals(),U=b.getUVs(),Y=b.getTangents(),L=b.getUV2s(),B=b.getColors();V=n*this._textureWidth*this._textureHeight*4;for(let n=0;n<this._vertexCount;n++)this._supportsPositions&&i&&(e[V]=i[3*n],e[V+1]=i[3*n+1],e[V+2]=i[3*n+2],V+=4),this._supportsNormals&&Q&&(e[V]=Q[3*n],e[V+1]=Q[3*n+1],e[V+2]=Q[3*n+2],V+=4),this._supportsUVs&&U&&(e[V]=U[2*n],e[V+1]=U[2*n+1],V+=4),this._supportsTangents&&Y&&(e[V]=Y[3*n],e[V+1]=Y[3*n+1],e[V+2]=Y[3*n+2],V+=4),this._supportsUV2s&&L&&(e[V]=L[2*n],e[V+1]=L[2*n+1],V+=4),this._supportsColors&&B&&(e[V]=B[4*n],e[V+1]=B[4*n+1],e[V+2]=B[4*n+2],e[V+3]=B[4*n+3],V+=4)}this._targetStoreTexture=s.e.CreateRGBATexture(e,this._textureWidth,this._textureHeight,i,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const i of this._scene.meshes)i.morphTargetManager===this&&i._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const b=this._parentContainer.morphTargetManagers.indexOf(this);b>-1&&this._parentContainer.morphTargetManagers.splice(b,1),this._parentContainer=null}for(const b of this._targets)this._scene.stopAnimation(b)}}static Parse(b,n){const i=new A(n);for(const e of b.targets)i.addTarget(x.c.Parse(e,n));return i}}A.EnableTextureStorage=!0,A.MaxActiveMorphTargetsInVertexAttributeMode=8,A.ConstantTargetCountForTextureMode=0;var E=i(13454),C=i(11655),t=i(12112);const w=new Map,h=w;function W(b,n,i){J(b)&&K.b.Warn(`Extension with the name '${b}' already exists`),w.set(b,{isGLTFExtension:n,factory:i})}function J(b){return w.delete(b)}var R=i(13468),k=i(12379),r=i(11854);class X{static Get(b,n,i){if(!n||void 0==i||!n[i])throw new Error(`${b}: Failed to find index (${i})`);return n[i]}static TryGet(b,n){return b&&void 0!=n&&b[n]?b[n]:null}static Assign(b){if(b)for(let n=0;n<b.length;n++)b[n].index=n}}function g(b){if(b.min&&b.max){const n=b.min,i=b.max,e=V.TmpVectors.On[0].re(n[0],n[1],n[2]),Q=V.TmpVectors.On[1].re(i[0],i[1],i[2]);if(b.normalized&&5126!==b.componentType){let n=1;switch(b.componentType){case 5120:n=127;break;case 5121:n=255;break;case 5122:n=32767;break;case 5123:n=65535}const i=1/n;e.scaleInPlace(i),Q.scaleInPlace(i)}return new t.d(e,Q)}return null}class P{static RegisterExtension(b,n){W(b,!1,n)}static UnregisterExtension(b){return J(b)}get Ne(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(b){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=b}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((b=>b.dispose&&b.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(b,n,i,e,V,Q){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=n,this._assetContainer=i,this._loadData(e);let Q=null;if(b){const n={};if(this._gltf.nodes)for(const b of this._gltf.nodes)b.name&&(n[b.name]=b.index);Q=(b instanceof Array?b:[b]).map((b=>{const i=n[b];if(void 0===i)throw new Error(`Failed to find node '${b}'`);return i}))}return await this._loadAsync(V,U,Q,(()=>({meshes:this._getMeshes(),cN:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=b,this._loadData(n),await this._loadAsync(i,V,null,(()=>{}))}async _loadAsync(b,n,i,e){return await Promise.resolve().then((async()=>{this._rootUrl=b,this._uniqueRootUrl=!b.startsWith("file:")&&n?b:`${b}${Date.now()}/`,this._fileName=n,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const V=`${E.j[E.j.LOADING]} => ${E.j[E.j.READY]}`,Q=`${E.j[E.j.LOADING]} => ${E.j[E.j.COMPLETE]}`;this._parent._startPerformanceCounter(V),this._parent._startPerformanceCounter(Q),this._parent._setState(E.j.LOADING),this._extensionsOnLoading();const Y=new Array;if(!this.parent.loadOnlyMaterials)if(i)Y.push(this.loadSceneAsync("/nodes",{nodes:i,index:-1}));else if(void 0!=this._gltf.dn||this._gltf.scenes&&this._gltf.scenes[0]){const b=X.Get("/scene",this._gltf.scenes,this._gltf.dn||0);Y.push(this.loadSceneAsync(`/scenes/${b.index}`,b))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let b=0;b<this._gltf.materials.length;++b){const n=this._gltf.materials[b],i="/materials/"+b,e=u.b.TriangleFillMode;Y.push(this._loadMaterialAsync(i,n,null,e,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&Y.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&Y.push(this._compileShadowGeneratorsAsync());const L=Promise.all(Y).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.RY(!0);for(const b of this._babylonScene.materials){const n=b;void 0!==n.maxSimultaneousLights&&(n.maxSimultaneousLights=Math.max(n.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(E.j.READY),this._skipStartAnimationStep||this._startAnimations(),e()}));return await L.then((b=>(this._parent._endPerformanceCounter(V),U.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Q),this._parent._setState(E.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(b=>{this._parent.onErrorObservable.notifyObservers(b),this._parent.onErrorObservable.clear(),this.dispose()}))})),b)))})).catch((b=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(b),this._parent.onErrorObservable.clear(),this.dispose()),b}))}_loadData(b){if(this._gltf=b.json,this._setupData(),b.bin){const n=this._gltf.buffers;if(n&&n[0]&&!n[0].uri){const i=n[0];(i.byteLength<b.bin.byteLength-3||i.byteLength>b.bin.byteLength)&&K.b.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${b.bin.byteLength})`),this._bin=b.bin}else K.b.Warn("Unexpected BIN chunk")}}_setupData(){if(X.Assign(this._gltf.accessors),X.Assign(this._gltf.animations),X.Assign(this._gltf.buffers),X.Assign(this._gltf.bufferViews),X.Assign(this._gltf.cameras),X.Assign(this._gltf.images),X.Assign(this._gltf.materials),X.Assign(this._gltf.meshes),X.Assign(this._gltf.nodes),X.Assign(this._gltf.samplers),X.Assign(this._gltf.scenes),X.Assign(this._gltf.skins),X.Assign(this._gltf.textures),this._gltf.nodes){const b={};for(const i of this._gltf.nodes)if(i.children)for(const n of i.children)b[n]=i.index;const n=this._createRootNode();for(const i of this._gltf.nodes){const e=b[i.index];i.parent=void 0===e?n:this._gltf.nodes[e]}}}async _loadExtensionsAsync(){const b=[];if(h.forEach(((n,i)=>{var e;!1===(null===(e=this.parent.extensionOptions[i])||void 0===e?void 0:e.enabled)?n.isGLTFExtension&&this.isExtensionUsed(i)&&K.b.Warn(`Extension ${i} is used but has been explicitly disabled.`):n.isGLTFExtension&&!this.isExtensionUsed(i)||b.push((async()=>{const b=await n.factory(this);return b.name!==i&&K.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${b.name} !== ${i}`),this._parent.onExtensionLoadedObservable.notifyObservers(b),b})())})),this._extensions.push(...await Promise.all(b)),this._extensions.sort(((b,n)=>(b.order||Number.MAX_VALUE)-(n.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const i of this._gltf.extensionsRequired){if(!this._extensions.some((b=>b.name===i&&b.enabled))){var n;if(!1===(null===(n=this.parent.extensionOptions[i])||void 0===n?void 0:n.enabled))throw new Error(`Required extension ${i} is disabled`);throw new Error(`Required extension ${i} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new D.b("__root__",this._babylonScene);this._rootBabylonMesh=b,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.RY(!1);const n={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case E.i.AUTO:this._babylonScene.useRightHandedSystem||(n.rotation=[0,1,0,0],n.scale=[1,1,-1],P._LoadTransform(n,this._rootBabylonMesh));break;case E.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(b),n}loadSceneAsync(b,n){const i=this._extensionsLoadSceneAsync(b,n);if(i)return i;const e=new Array;if(this.logOpen(`${b} ${n.name||""}`),n.nodes)for(const V of n.nodes){const n=X.Get(`${b}/nodes/${V}`,this._gltf.nodes,V);e.push(this.loadNodeAsync(`/nodes/${n.index}`,n,(b=>{b.parent=this._rootBabylonMesh})))}for(const V of this._postSceneLoadActions)V();return e.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(e).then((()=>{}))}_forEachPrimitive(b,n){if(b._primitiveBabylonMeshes)for(const i of b._primitiveBabylonMeshes)n(i)}_getGeometries(){const b=[],n=this._gltf.nodes;if(n)for(const i of n)this._forEachPrimitive(i,(n=>{const i=n.We;i&&-1===b.indexOf(i)&&b.push(i)}));return b}_getMeshes(){const b=[];this._rootBabylonMesh instanceof a.d&&b.push(this._rootBabylonMesh);const n=this._gltf.nodes;if(n)for(const i of n)this._forEachPrimitive(i,(n=>{b.push(n)}));return b}_getTransformNodes(){const b=[],n=this._gltf.nodes;if(n)for(const i of n)i._babylonTransformNode&&"Jz"===i._babylonTransformNode.getClassName()&&b.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&b.push(i._babylonTransformNodeForSkin);return b}_getSkeletons(){const b=[],n=this._gltf.skins;if(n)for(const i of n)i._data&&b.push(i._data.babylonSkeleton);return b}_getAnimationGroups(){const b=[],n=this._gltf.animations;if(n)for(const i of n)i._babylonAnimationGroup&&b.push(i._babylonAnimationGroup);return b}_startAnimations(){switch(this._parent.animationStartMode){case E.f.NONE:break;case E.f.FIRST:{const b=this._getAnimationGroups();0!==b.length&&b[0].start(!0);break}case E.f.ALL:{const b=this._getAnimationGroups();for(const n of b)n.start(!0);break}default:return void K.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadNodeAsync(b,n,i);if(e)return e;if(n._babylonTransformNode)throw new Error(`${b}: Invalid recursive node hierarchy`);const V=new Array;this.logOpen(`${b} ${n.name||""}`);const Q=e=>{if(P.AddPointerMetadata(e,b),P._LoadTransform(n,e),void 0!=n.camera){const i=X.Get(`${b}/camera`,this._gltf.cameras,n.camera);V.push(this.loadCameraAsync(`/cameras/${i.index}`,i,(b=>{b.parent=e,this._babylonScene.useRightHandedSystem||(e.ge.x=-1)})))}if(n.children)for(const i of n.children){const n=X.Get(`${b}/children/${i}`,this._gltf.nodes,i);V.push(this.loadNodeAsync(`/nodes/${n.index}`,n,(b=>{b.parent=e})))}i(e)},U=void 0!=n.mesh,Y=this._parent.loadSkins&&void 0!=n.skin;if(!U||Y){const b=n.name||`node${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new o.e(b,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==n.mesh?n._babylonTransformNode=i:n._babylonTransformNodeForSkin=i,Q(i)}if(U)if(Y){const i=X.Get(`${b}/mesh`,this._gltf.meshes,n.mesh);V.push(this._loadMeshAsync(`/meshes/${i.index}`,n,i,(i=>{const e=n._babylonTransformNodeForSkin;i.metadata=(0,k.e)(e.metadata,i.metadata||{});const Q=X.Get(`${b}/skin`,this._gltf.skins,n.skin);V.push(this._loadSkinAsync(`/skins/${Q.index}`,n,Q,(b=>{this._forEachPrimitive(n,(n=>{n.skeleton=b})),this._postSceneLoadActions.push((()=>{if(void 0!=Q.skeleton){const b=X.Get(`/skins/${Q.index}/skeleton`,this._gltf.nodes,Q.skeleton).parent;n.index===b.index?i.parent=e.parent:i.parent=b._babylonTransformNode}else i.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:e,skinnedNode:i})}))})))})))}else{const i=X.Get(`${b}/mesh`,this._gltf.meshes,n.mesh);V.push(this._loadMeshAsync(`/meshes/${i.index}`,n,i,Q))}return this.logClose(),Promise.all(V).then((()=>(this._forEachPrimitive(n,(b=>{const n=b;!n.isAnInstance&&n.We&&n.We.useBoundingInfoFromGeometry?b.wb():b.refreshBoundingInfo(!0,!0)})),n._babylonTransformNode)))}_loadMeshAsync(b,n,i,e){const V=i.primitives;if(!V||!V.length)throw new Error(`${b}: Primitives are missing`);void 0==V[0].index&&X.Assign(V);const Q=new Array;this.logOpen(`${b} ${i.name||""}`);const U=n.name||`node${n.index}`;if(1===V.length){const e=i.primitives[0];Q.push(this._loadMeshPrimitiveAsync(`${b}/primitives/${e.index}`,U,n,i,e,(b=>{n._babylonTransformNode=b,n._primitiveBabylonMeshes=[b]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,n._babylonTransformNode=new o.e(U,this._babylonScene),n._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._primitiveBabylonMeshes=[];for(const e of V)Q.push(this._loadMeshPrimitiveAsync(`${b}/primitives/${e.index}`,`${U}_primitive${e.index}`,n,i,e,(b=>{b.parent=n._babylonTransformNode,n._primitiveBabylonMeshes.push(b)})))}return e(n._babylonTransformNode),this.logClose(),Promise.all(Q).then((()=>n._babylonTransformNode))}_loadMeshPrimitiveAsync(b,n,i,e,V,Q){const U=this._extensionsLoadMeshPrimitiveAsync(b,n,i,e,V,Q);if(U)return U;this.logOpen(`${b}`);const Y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==i.skin&&!e.primitives[0].targets;let L,B;if(Y&&V._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,L=V._instanceData.babylonSourceMesh.createInstance(n),L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B=V._instanceData.promise;else{const Q=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new D.b(n,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.sideOrientation=this._babylonScene.useRightHandedSystem?u.b.CounterClockWiseSideOrientation:u.b.ClockWiseSideOrientation,this._createMorphTargets(b,i,e,V,U),Q.push(this._loadVertexDataAsync(b,V,U).then((async n=>await this._loadMorphTargetsAsync(b,V,U,n).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,n.Cb(U),n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const mb=P._GetDrawMode(b,V.mode);if(void 0==V.material){let b=this._defaultBabylonMaterialData[mb];b||(b=this._createDefaultMaterial("__GLTFLoader._default",mb),this._parent.onMaterialLoadedObservable.notifyObservers(b),this._defaultBabylonMaterialData[mb]=b),U.material=b}else if(!this.parent.skipMaterials){const n=X.Get(`${b}/material`,this._gltf.materials,V.material);Q.push(this._loadMaterialAsync(`/materials/${n.index}`,n,U,mb,(b=>{U.material=b})))}B=Promise.all(Q),Y&&(V._instanceData={babylonSourceMesh:U,promise:B}),L=U}return P.AddPointerMetadata(L,b),this._parent.onMeshLoadedObservable.notifyObservers(L),Q(L),this.logClose(),B.then((()=>L))}_loadVertexDataAsync(b,n,i){const e=this._extensionsLoadVertexDataAsync(b,n,i);if(e)return e;const V=n.attributes;if(!V)throw new Error(`${b}: Attributes are missing`);const Q=new Array,U=new j.c(i.name,this._babylonScene);if(void 0==n.indices)i.isUnIndexed=!0;else{const i=X.Get(`${b}/indices`,this._gltf.accessors,n.indices);Q.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then((b=>{U.setIndices(b)})))}const Y=(n,e,Y)=>{if(void 0==V[n])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(e)&&i._delayInfo.push(e);const L=X.Get(`${b}/attributes/${n}`,this._gltf.accessors,V[n]);Q.push(this._loadVertexAccessorAsync(`/accessors/${L.index}`,L,e).then((b=>{if(b.getKind()===M.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton){const b=g(L);b&&(U._boundingInfo=b,U.useBoundingInfoFromGeometry=!0)}U.setVerticesBuffer(b,L.count)}))),e==M.g.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),Y&&Y(L)};return Y("POSITION",M.g.PositionKind),Y("NORMAL",M.g.NormalKind),Y("TANGENT",M.g.TangentKind),Y("TEXCOORD_0",M.g.UVKind),Y("TEXCOORD_1",M.g.UV2Kind),Y("TEXCOORD_2",M.g.UV3Kind),Y("TEXCOORD_3",M.g.UV4Kind),Y("TEXCOORD_4",M.g.UV5Kind),Y("TEXCOORD_5",M.g.UV6Kind),Y("JOINTS_0",M.g.MatricesIndicesKind),Y("WEIGHTS_0",M.g.MatricesWeightsKind),Y("JOINTS_1",M.g.MatricesIndicesExtraKind),Y("WEIGHTS_1",M.g.MatricesWeightsExtraKind),Y("COLOR_0",M.g.ColorKind,(b=>{"VEC4"===b.type&&(i.hasVertexAlpha=!0)})),Promise.all(Q).then((()=>U))}_createMorphTargets(b,n,i,e,V){if(!e.targets||!this._parent.loadMorphTargets)return;if(void 0==n._numMorphTargets)n._numMorphTargets=e.targets.length;else if(e.targets.length!==n._numMorphTargets)throw new Error(`${b}: Primitives do not have the same number of targets`);const Q=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,V.morphTargetManager=new A(this._babylonScene),V.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.morphTargetManager.areUpdatesFrozen=!0;for(let U=0;U<e.targets.length;U++){const b=n.weights?n.weights[U]:i.weights?i.weights[U]:0,e=Q?Q[U]:`morphTarget${U}`;V.morphTargetManager.addTarget(new x.c(e,b,V.ab()))}}_loadMorphTargetsAsync(b,n,i,e){if(!n.targets||!this._parent.loadMorphTargets)return Promise.resolve();const V=new Array,Q=i.morphTargetManager;for(let U=0;U<Q.numTargets;U++){const i=Q.getTarget(U);V.push(this._loadMorphTargetVertexDataAsync(`${b}/targets/${U}`,e,n.targets[U],i))}return Promise.all(V).then((()=>{Q.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(b,n,i,e){const V=new Array,Q=(e,Q,U)=>{if(void 0==i[e])return;const Y=n.getVertexBuffer(Q);if(!Y)return;const L=X.Get(`${b}/${e}`,this._gltf.accessors,i[e]);V.push(this._loadFloatAccessorAsync(`/accessors/${L.index}`,L).then((b=>{U(Y,b)})))};return Q("POSITION",M.g.PositionKind,((b,n)=>{const i=new Float32Array(n.length);b.forEach(n.length,((b,e)=>{i[e]=n[e]+b})),e.setPositions(i)})),Q("NORMAL",M.g.NormalKind,((b,n)=>{const i=new Float32Array(n.length);b.forEach(i.length,((b,e)=>{i[e]=n[e]+b})),e.setNormals(i)})),Q("TANGENT",M.g.TangentKind,((b,n)=>{const i=new Float32Array(n.length/3*4);let V=0;b.forEach(n.length/3*4,((b,e)=>{(e+1)%4!==0&&(i[V]=n[V]+b,V++)})),e.setTangents(i)})),Q("TEXCOORD_0",M.g.UVKind,((b,n)=>{const i=new Float32Array(n.length);b.forEach(n.length,((b,e)=>{i[e]=n[e]+b})),e.setUVs(i)})),Q("TEXCOORD_1",M.g.UV2Kind,((b,n)=>{const i=new Float32Array(n.length);b.forEach(n.length,((b,e)=>{i[e]=n[e]+b})),e.setUV2s(i)})),Q("COLOR_0",M.g.ColorKind,((n,i)=>{let V=null;const Q=n.getSize();if(3===Q){V=new Float32Array(i.length/3*4),n.forEach(i.length,((b,n)=>{const e=Math.floor(n/3),Q=n%3;V[4*e+Q]=i[3*e+Q]+b}));for(let b=0;b<i.length/3;++b)V[4*b+3]=1}else{if(4!==Q)throw new Error(`${b}: Invalid number of components (${Q}) for COLOR_0 attribute`);V=new Float32Array(i.length),n.forEach(i.length,((b,n)=>{V[n]=i[n]+b}))}e.setColors(V)})),await Promise.all(V).then((()=>{}))}static _LoadTransform(b,n){if(void 0!=b.skin)return;let i=V.On.Zero(),e=V.Quaternion.Identity(),Q=V.On.One();if(b.matrix){V.Matrix.jn(b.matrix).decompose(Q,e,i)}else b.translation&&(i=V.On.jn(b.translation)),b.rotation&&(e=V.Quaternion.jn(b.rotation)),b.scale&&(Q=V.On.jn(b.scale));n.position=i,n.rotationQuaternion=e,n.ge=Q}_loadSkinAsync(b,n,i,e){if(!this._parent.loadSkins)return Promise.resolve();const V=this._extensionsLoadSkinAsync(b,n,i);if(V)return V;if(i._data)return e(i._data.babylonSkeleton),i._data.promise;const Q=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new O(i.name||Q,Q,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(b,i,U);const Y=this._loadSkinInverseBindMatricesDataAsync(b,i).then((b=>{this._updateBoneMatrices(U,b)}));return i._data={babylonSkeleton:U,promise:Y},e(U),Y}_loadBones(b,n,i){if(void 0==n.skeleton||this._parent.alwaysComputeSkeletonRootNode){const i=this._findSkeletonRootNode(`${b}/joints`,n.joints);if(i)if(void 0===n.skeleton)n.skeleton=i.index;else{const e=(b,n)=>{for(;n.parent;n=n.parent)if(n.parent===b)return!0;return!1},V=X.Get(`${b}/skeleton`,this._gltf.nodes,n.skeleton);V===i||e(V,i)||(K.b.Warn(`${b}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),n.skeleton=i.index)}else K.b.Warn(`${b}: Failed to find common root`)}const e={};for(const V of n.joints){const Q=X.Get(`${b}/joints/${V}`,this._gltf.nodes,V);this._loadBone(Q,n,i,e)}}_findSkeletonRootNode(b,n){if(0===n.length)return null;const i={};for(const V of n){const n=[];let e=X.Get(`${b}/${V}`,this._gltf.nodes,V);for(;-1!==e.index;)n.unshift(e),e=e.parent;i[V]=n}let e=null;for(let V=0;;++V){let b=i[n[0]];if(V>=b.length)return e;const Q=b[V];for(let U=1;U<n.length;++U)if(b=i[n[U]],V>=b.length||Q!==b[V])return e;e=Q}}_loadBone(b,n,i,e){b._isJoint=!0;let V=e[b.index];if(V)return V;let Q=null;b.index!==n.skeleton&&(b.parent&&-1!==b.parent.index?Q=this._loadBone(b.parent,n,i,e):void 0!==n.skeleton&&K.b.Warn(`/skins/${n.index}/skeleton: Skeleton node is not a common root`));const U=n.joints.indexOf(b.index);return V=new B.e(b.name||`joint${b.index}`,i,Q,this._getNodeMatrix(b),null,null,U),e[b.index]=V,this._postSceneLoadActions.push((()=>{V.linkTransformNode(b._babylonTransformNode)})),V}_loadSkinInverseBindMatricesDataAsync(b,n){if(void 0==n.inverseBindMatrices)return Promise.resolve(null);const i=X.Get(`${b}/inverseBindMatrices`,this._gltf.accessors,n.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}_updateBoneMatrices(b,n){for(const i of b.bones){const b=V.Matrix.Identity(),e=i._index;n&&-1!==e&&(V.Matrix.FromArrayToRef(n,16*e,b),b.invertToRef(b));const Q=i.getParent();Q&&b.multiplyToRef(Q.getAbsoluteInverseBindMatrix(),b),i.Ee(b,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(b){return b.matrix?V.Matrix.jn(b.matrix):V.Matrix.Compose(b.scale?V.On.jn(b.scale):V.On.One(),b.rotation?V.Quaternion.jn(b.rotation):V.Quaternion.Identity(),b.translation?V.On.jn(b.translation):V.On.Zero())}loadCameraAsync(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadCameraAsync(b,n,i);if(e)return e;const Q=new Array;this.logOpen(`${b} ${n.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new L.c(n.name||`camera${n.index}`,V.On.Zero(),this._babylonScene,!1);switch(U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonCamera=U,U.setTarget(new V.On(0,0,-1)),n.type){case"perspective":{const i=n.perspective;if(!i)throw new Error(`${b}: Camera perspective properties are missing`);U.fov=i.yfov,U.Ae=i.znear,U.maxZ=i.zfar||0;break}case"orthographic":if(!n.orthographic)throw new Error(`${b}: Camera orthographic properties are missing`);U.mode=Y.c.ORTHOGRAPHIC_CAMERA,U.orthoLeft=-n.orthographic.xmag,U.orthoRight=n.orthographic.xmag,U.orthoBottom=-n.orthographic.ymag,U.orthoTop=n.orthographic.ymag,U.Ae=n.orthographic.znear,U.maxZ=n.orthographic.zfar;break;default:throw new Error(`${b}: Invalid camera type (${n.type})`)}return P.AddPointerMetadata(U,b),this._parent.onCameraLoadedObservable.notifyObservers(U),i(U),this.logClose(),Promise.all(Q).then((()=>U))}_loadAnimationsAsync(){const b=this._gltf.animations;if(!b)return Promise.resolve();const n=new Array;for(let i=0;i<b.length;i++){const e=b[i];n.push(this.loadAnimationAsync(`/animations/${e.index}`,e).then((b=>{0===b.targetedAnimations.length&&b.dispose()})))}return Promise.all(n).then((()=>{}))}loadAnimationAsync(b,n){const e=this._extensionsLoadAnimationAsync(b,n);return e||i.e(78).then(i.bind(i,15023)).then((i=>{let{AnimationGroup:e}=i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new e(n.name||`animation${n.index}`,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=V;const Q=new Array;X.Assign(n.channels),X.Assign(n.samplers);for(const U of n.channels)Q.push(this._loadAnimationChannelAsync(`${b}/channels/${U.index}`,b,n,U,((b,n)=>{b.animations=b.animations||[],b.animations.push(n),V.addTargetedAnimation(n,b)})));return Promise.all(Q).then((()=>(V.normalize(0),V)))}))}async _loadAnimationChannelAsync(b,n,e,V,Q){const U=this._extensionsLoadAnimationChannelAsync(b,n,e,V,Q);if(U)return await U;if(void 0==V.target.node)return await Promise.resolve();const Y=X.Get(`${b}/target/node`,this._gltf.nodes,V.target.node),L=V.target.path,B="weights"===L;if(B&&!Y._numMorphTargets||!B&&!Y._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!B&&!Y._isJoint)return await Promise.resolve();let mb;switch(await Promise.resolve().then(i.bind(i,13475)),L){case"translation":var N;mb=null===(N=(0,R.g)("/nodes/{}/translation"))||void 0===N?void 0:N.interpolation;break;case"rotation":var Z;mb=null===(Z=(0,R.g)("/nodes/{}/rotation"))||void 0===Z?void 0:Z.interpolation;break;case"scale":var T;mb=null===(T=(0,R.g)("/nodes/{}/scale"))||void 0===T?void 0:T.interpolation;break;case"weights":var z;mb=null===(z=(0,R.g)("/nodes/{}/weights"))||void 0===z?void 0:z.interpolation;break;default:throw new Error(`${b}/target/path: Invalid value (${V.target.path})`)}if(!mb)throw new Error(`${b}/target/path: Could not find interpolation properties for target path (${V.target.path})`);const K={object:Y,info:mb};return await this._loadAnimationChannelFromTargetInfoAsync(b,n,e,V,K,Q)}_loadAnimationChannelFromTargetInfoAsync(b,n,i,e,V,Q){const U=this.parent.targetFps,Y=1/U,L=X.Get(`${b}/sampler`,i.samplers,e.sampler);return this._loadAnimationSamplerAsync(`${n}/samplers/${e.sampler}`,L).then((b=>{let n=0;const L=V.object,B=V.info;for(const V of B){const B=V.getStride(L),mb=b.input,N=b.output,Z=new Array(mb.length);let T=0;switch(b.interpolation){case"STEP":for(let b=0;b<mb.length;b++){const n=V.getValue(L,N,T,1);T+=B,Z[b]={frame:mb[b]*U,value:n,interpolation:1}}break;case"CUBICSPLINE":for(let b=0;b<mb.length;b++){const n=V.getValue(L,N,T,Y);T+=B;const i=V.getValue(L,N,T,1);T+=B;const e=V.getValue(L,N,T,Y);T+=B,Z[b]={frame:mb[b]*U,inTangent:n,value:i,outTangent:e}}break;case"LINEAR":for(let b=0;b<mb.length;b++){const n=V.getValue(L,N,T,1);T+=B,Z[b]={frame:mb[b]*U,value:n}}}if(T>0){const b=`${i.name||`animation${i.index}`}_channel${e.index}_${n}`,Y=V.buildAnimations(L,b,U,Z);for(const i of Y)n++,Q(i.babylonAnimatable,i.babylonAnimation)}}}))}_loadAnimationSamplerAsync(b,n){if(n._data)return n._data;const i=n.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${b}/interpolation: Invalid value (${n.interpolation})`)}const e=X.Get(`${b}/input`,this._gltf.accessors,n.input),V=X.Get(`${b}/output`,this._gltf.accessors,n.output);return n._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${e.index}`,e),this._loadFloatAccessorAsync(`/accessors/${V.index}`,V)]).then((b=>{let[n,e]=b;return{input:n,interpolation:i,output:e}})),n._data}loadBufferAsync(b,n,i,e){const V=this._extensionsLoadBufferAsync(b,n,i,e);if(V)return V;if(!n._data)if(n.uri)n._data=this.loadUriAsync(`${b}/uri`,n,n.uri);else{if(!this._bin)throw new Error(`${b}: Uri is missing or the binary glTF is missing its binary chunk`);n._data=this._bin.readAsync(0,n.byteLength)}return n._data.then((n=>{try{return new Uint8Array(n.buffer,n.byteOffset+i,e)}catch(V){throw new Error(`${b}: ${V.message}`)}}))}loadBufferViewAsync(b,n){const i=this._extensionsLoadBufferViewAsync(b,n);if(i)return i;if(n._data)return n._data;const e=X.Get(`${b}/buffer`,this._gltf.buffers,n.buffer);return n._data=this.loadBufferAsync(`/buffers/${e.index}`,e,n.byteOffset||0,n.byteLength),n._data}_loadAccessorAsync(b,n,i){if(n._data)return n._data;const e=P._GetNumComponents(b,n.type),V=e*M.g.GetTypeByteLength(n.componentType),Q=e*n.count;if(void 0==n.bufferView)n._data=Promise.resolve(new i(Q));else{const U=X.Get(`${b}/bufferView`,this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((Y=>{if(5126!==n.componentType||n.normalized||U.byteStride&&U.byteStride!==V){const b=new i(Q);return M.g.ForEach(Y,n.byteOffset||0,U.byteStride||V,e,n.componentType,b.length,n.normalized||!1,((n,i)=>{b[i]=n})),b}return P._GetTypedArray(b,n.componentType,Y,n.byteOffset,Q)}))}if(n.sparse){const Q=n.sparse;n._data=n._data.then((U=>{const Y=U,L=X.Get(`${b}/sparse/indices/bufferView`,this._gltf.bufferViews,Q.indices.bufferView),B=X.Get(`${b}/sparse/values/bufferView`,this._gltf.bufferViews,Q.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${L.index}`,L),this.loadBufferViewAsync(`/bufferViews/${B.index}`,B)]).then((U=>{let[L,B]=U;const mb=P._GetTypedArray(`${b}/sparse/indices`,Q.indices.componentType,L,Q.indices.byteOffset,Q.count),N=e*Q.count;let Z;if(5126!==n.componentType||n.normalized){const U=P._GetTypedArray(`${b}/sparse/values`,n.componentType,B,Q.values.byteOffset,N);Z=new i(N),M.g.ForEach(U,0,V,e,n.componentType,Z.length,n.normalized||!1,((b,n)=>{Z[n]=b}))}else Z=P._GetTypedArray(`${b}/sparse/values`,n.componentType,B,Q.values.byteOffset,N);let T=0;for(let b=0;b<mb.length;b++){let n=mb[b]*e;for(let b=0;b<e;b++)Y[n++]=Z[T++]}return Y}))}))}return n._data}_loadFloatAccessorAsync(b,n){return this._loadAccessorAsync(b,n,Float32Array)}_loadIndicesAccessorAsync(b,n){if("SCALAR"!==n.type)throw new Error(`${b}/type: Invalid value ${n.type}`);if(5121!==n.componentType&&5123!==n.componentType&&5125!==n.componentType)throw new Error(`${b}/componentType: Invalid value ${n.componentType}`);if(n._data)return n._data;if(n.sparse){const i=P._GetTypedArrayConstructor(`${b}/componentType`,n.componentType);n._data=this._loadAccessorAsync(b,n,i)}else{const i=X.Get(`${b}/bufferView`,this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((i=>P._GetTypedArray(b,n.componentType,i,n.byteOffset,n.count)))}return n._data}_loadVertexBufferViewAsync(b){if(b._babylonBuffer)return b._babylonBuffer;const n=this._babylonScene.getEngine();return b._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>new M.e(n,b,!1))),b._babylonBuffer}_loadVertexAccessorAsync(b,n,i){var e;if(null!==(e=n._babylonVertexBuffer)&&void 0!==e&&e[i])return n._babylonVertexBuffer[i];n._babylonVertexBuffer||(n._babylonVertexBuffer={});const V=this._babylonScene.getEngine();if(n.sparse||void 0==n.bufferView)n._babylonVertexBuffer[i]=this._loadFloatAccessorAsync(b,n).then((b=>new M.g(V,b,i,!1)));else{const e=X.Get(`${b}/bufferView`,this._gltf.bufferViews,n.bufferView);n._babylonVertexBuffer[i]=this._loadVertexBufferViewAsync(e).then((Q=>{const U=P._GetNumComponents(b,n.type);return new M.g(V,Q,i,!1,void 0,e.byteStride,void 0,n.byteOffset,U,n.componentType,n.normalized,!0,void 0,!0)}))}return n._babylonVertexBuffer[i]}_loadMaterialMetallicRoughnessPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return n&&(n.baseColorFactor?(i.albedoColor=Q.Mn.jn(n.baseColorFactor),i.alpha=n.baseColorFactor[3]):i.albedoColor=Q.Mn.White(),i.metallic=void 0==n.metallicFactor?1:n.metallicFactor,i.roughness=void 0==n.roughnessFactor?1:n.roughnessFactor,n.baseColorTexture&&e.push(this.loadTextureInfoAsync(`${b}/baseColorTexture`,n.baseColorTexture,(b=>{b.name=`${i.name} (Base Color)`,i.albedoTexture=b}))),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${b}/metallicRoughnessTexture`,n.metallicRoughnessTexture,(b=>{b.name=`${i.name} (Metallic Roughness)`,i.metallicTexture=b}))),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(e).then((()=>{}))}_loadMaterialAsync(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Q=this._extensionsLoadMaterialAsync(b,n,i,e,V);if(Q)return Q;n._data=n._data||{};let U=n._data[e];if(!U){this.logOpen(`${b} ${n.name||""}`);const i=this.createMaterial(b,n,e);U={babylonMaterial:i,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(b,n,i)},n._data[e]=U,P.AddPointerMetadata(i,b),this._parent.onMaterialLoadedObservable.notifyObservers(i),this.logClose()}return i&&(U.babylonMeshes.push(i),i.Qe.addOnce((()=>{const b=U.babylonMeshes.indexOf(i);-1!==b&&U.babylonMeshes.splice(b,1)}))),V(U.babylonMaterial),U.promise.then((()=>U.babylonMaterial))}_createDefaultMaterial(b,n){this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new d.c(b,this._babylonScene);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=n,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=d.c.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i}createMaterial(b,n,i){const e=this._extensionsCreateMaterial(b,n,i);if(e)return e;const V=n.name||`material${n.index}`;return this._createDefaultMaterial(V,i)}loadMaterialPropertiesAsync(b,n,i){const e=this._extensionsLoadMaterialPropertiesAsync(b,n,i);if(e)return e;const V=new Array;return V.push(this.loadMaterialBasePropertiesAsync(b,n,i)),n.pbrMetallicRoughness&&V.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${b}/pbrMetallicRoughness`,n.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(b,n,i),Promise.all(V).then((()=>{}))}loadMaterialBasePropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return i.emissiveColor=n.emissiveFactor?Q.Mn.jn(n.emissiveFactor):new Q.Mn(0,0,0),n.doubleSided&&(i.Re=!1,i.twoSidedLighting=!0),n.normalTexture&&(n.normalTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${b}/normalTexture`,n.normalTexture,(b=>{b.name=`${i.name} (Normal)`,i.bumpTexture=b}))),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=n.normalTexture.scale&&i.bumpTexture&&(i.bumpTexture.level=n.normalTexture.scale),i.forceIrradianceInFragment=!0),n.occlusionTexture&&(n.occlusionTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${b}/occlusionTexture`,n.occlusionTexture,(b=>{b.name=`${i.name} (Occlusion)`,i.ambientTexture=b}))),i.useAmbientInGrayScale=!0,void 0!=n.occlusionTexture.strength&&(i.ambientTextureStrength=n.occlusionTexture.strength)),n.emissiveTexture&&e.push(this.loadTextureInfoAsync(`${b}/emissiveTexture`,n.emissiveTexture,(b=>{b.name=`${i.name} (Emissive)`,i.emissiveTexture=b}))),Promise.all(e).then((()=>{}))}loadMaterialAlphaProperties(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);switch(n.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=d.c.PBRMATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=d.c.PBRMATERIAL_ALPHATEST,i.alphaCutOff=void 0==n.alphaCutoff?.5:n.alphaCutoff,i.albedoTexture&&(i.albedoTexture.se=!0);break;case"BLEND":i.transparencyMode=d.c.PBRMATERIAL_ALPHABLEND,i.albedoTexture&&(i.albedoTexture.se=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${b}/alphaMode: Invalid value (${n.alphaMode})`)}}loadTextureInfoAsync(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadTextureInfoAsync(b,n,i);if(e)return e;if(this.logOpen(`${b}`),n.texCoord>=6)throw new Error(`${b}/texCoord: Invalid value (${n.texCoord})`);const V=X.Get(`${b}/index`,this._gltf.textures,n.index);V._textureInfo=n;const Q=this._loadTextureAsync(`/textures/${n.index}`,V,(e=>{e.coordinatesIndex=n.texCoord||0,P.AddPointerMetadata(e,b),this._parent.onTextureLoadedObservable.notifyObservers(e),i(e)}));return this.logClose(),Q}_loadTextureAsync(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadTextureAsync(b,n,i);if(e)return e;this.logOpen(`${b} ${n.name||""}`);const V=void 0==n.sampler?P.DefaultSampler:X.Get(`${b}/sampler`,this._gltf.samplers,n.sampler),Q=X.Get(`${b}/source`,this._gltf.images,n.source),U=this._createTextureAsync(b,V,Q,i,void 0,!n._textureInfo.nonColorData);return this.logClose(),U}_createTextureAsync(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Q=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0;const Y=this._loadSampler(`/samplers/${n.index}`,n),L=new Array,B=new e;this._babylonScene._blockEntityCollection=!!this._assetContainer;const mb={noMipmap:Y.noMipMaps,invertY:!1,samplingMode:Y.samplingMode,v:()=>{this._disposed||B.resolve()},onError:(n,i)=>{this._disposed||B.reject(new Error(`${b}: ${i&&i.message?i.message:n||"Failed to load texture"}`))},mimeType:i.mimeType??(0,C.g)(i.uri??""),loaderOptions:Q,useSRGBBuffer:!!U&&this._parent.useSRGBBuffers},N=new G.e(null,this._babylonScene,mb);return N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.push(B.promise),L.push(this.loadImageAsync(`/images/${i.index}`,i).then((b=>{const n=i.uri||`${this._fileName}#image${i.index}`,e=`data:${this._uniqueRootUrl}${n}`;N.updateURL(e,b);const V=N.getInternalTexture();V&&(V.label=i.name)}))),N.wrapU=Y.wrapU,N.wrapV=Y.wrapV,V(N),this._parent.useGltfTextureNames&&(N.name=i.name||i.uri||`image${i.index}`),Promise.all(L).then((()=>N))}_loadSampler(b,n){return n._data||(n._data={noMipMaps:9728===n.minFilter||9729===n.minFilter,samplingMode:P._GetTextureSamplingMode(b,n),wrapU:P._GetTextureWrapMode(`${b}/wrapS`,n.wrapS),wrapV:P._GetTextureWrapMode(`${b}/wrapT`,n.wrapT)}),n._data}loadImageAsync(b,n){if(!n._data){if(this.logOpen(`${b} ${n.name||""}`),n.uri)n._data=this.loadUriAsync(`${b}/uri`,n,n.uri);else{const i=X.Get(`${b}/bufferView`,this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return n._data}loadUriAsync(b,n,i){const e=this._extensionsLoadUriAsync(b,n,i);if(e)return e;if(!P._ValidateUri(i))throw new Error(`${b}: '${i}' is invalid`);if((0,C.h)(i)){const n=new Uint8Array((0,C.d)(i));return this.log(`${b}: Decoded ${i.substring(0,64)}... (${n.length} bytes)`),Promise.resolve(n)}return this.log(`${b}: Loading ${i}`),this._parent.preprocessUrlAsync(this._rootUrl+i).then((n=>new Promise(((e,V)=>{this._parent._loadFile(this._babylonScene,n,(n=>{this._disposed||(this.log(`${b}: Loaded ${i} (${n.byteLength} bytes)`),e(new Uint8Array(n)))}),!0,(n=>{V(new C.i(`${b}: Failed to load '${i}'${n?": "+n.status+" "+n.statusText:""}`,n))}))}))))}static AddPointerMetadata(b,n){b.metadata=b.metadata||{};const i=b._internalMetadata=b._internalMetadata||{},e=i.Ne=i.Ne||{};(e.pointers=e.pointers||[]).push(n)}static _GetTextureWrapMode(b,n){switch(n=void 0==n?10497:n){case 33071:return G.e.CLAMP_ADDRESSMODE;case 33648:return G.e.MIRROR_ADDRESSMODE;case 10497:return G.e.WRAP_ADDRESSMODE;default:return K.b.Warn(`${b}: Invalid value (${n})`),G.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(b,n){const i=void 0==n.magFilter?9729:n.magFilter,e=void 0==n.minFilter?9987:n.minFilter;if(9729===i)switch(e){case 9728:return G.e.LINEAR_NEAREST;case 9729:return G.e.LINEAR_LINEAR;case 9984:return G.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return G.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return G.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return G.e.LINEAR_LINEAR_MIPLINEAR;default:return K.b.Warn(`${b}/minFilter: Invalid value (${e})`),G.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==i&&K.b.Warn(`${b}/magFilter: Invalid value (${i})`),e){case 9728:return G.e.NEAREST_NEAREST;case 9729:return G.e.NEAREST_LINEAR;case 9984:return G.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return G.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return G.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return G.e.NEAREST_LINEAR_MIPLINEAR;default:return K.b.Warn(`${b}/minFilter: Invalid value (${e})`),G.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(b,n){try{return(0,r.s)(n)}catch(i){throw new Error(`${b}: ${i.message}`)}}static _GetTypedArray(b,n,i,e,V){const Q=i.buffer;e=i.byteOffset+(e||0);const U=P._GetTypedArrayConstructor(`${b}/componentType`,n),Y=M.g.GetTypeByteLength(n);return e%Y!==0?(K.b.Warn(`${b}: Copying buffer as byte offset (${e}) is not a multiple of component type byte length (${Y})`),new U(Q.slice(e,e+V*Y),0)):new U(Q,e,V)}static _GetNumComponents(b,n){switch(n){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${b}: Invalid type (${n})`)}static _ValidateUri(b){return U.Tools.IsBase64(b)||-1===b.indexOf("..")}static _GetDrawMode(b,n){switch(void 0==n&&(n=4),n){case 0:return u.b.PointListDrawMode;case 1:return u.b.LineListDrawMode;case 2:return u.b.LineLoopDrawMode;case 3:return u.b.LineStripDrawMode;case 4:return u.b.TriangleFillMode;case 5:return u.b.TriangleStripDrawMode;case 6:return u.b.TriangleFanDrawMode}throw new Error(`${b}: Invalid mesh primitive mode (${n})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const b=new Array;if(this._gltf.materials)for(const n of this._gltf.materials)if(n._data)for(const i in n._data){const e=n._data[i];for(const n of e.babylonMeshes){n.we(!0);const i=e.babylonMaterial;b.push(i.forceCompilationAsync(n)),b.push(i.forceCompilationAsync(n,{useInstances:!0})),this._parent.useClipPlane&&(b.push(i.forceCompilationAsync(n,{clipPlane:!0})),b.push(i.forceCompilationAsync(n,{clipPlane:!0,useInstances:!0})))}}return Promise.all(b).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const b=new Array,n=this._babylonScene.lights;for(const i of n){const n=i.getShadowGenerator();n&&b.push(n.forceCompilationAsync())}return Promise.all(b).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(b){for(const n of this._extensions)n.enabled&&b(n)}_applyExtensions(b,n,i){for(const e of this._extensions)if(e.enabled){const V=`${e.name}.${n}`,Q=b;Q._activeLoaderExtensionFunctions=Q._activeLoaderExtensionFunctions||{};const U=Q._activeLoaderExtensionFunctions;if(!U[V]){U[V]=!0;try{const b=i(e);if(b)return b}finally{delete U[V]}}}return null}_extensionsOnLoading(){this._forEachExtensions((b=>b.onLoading&&b.onLoading()))}_extensionsOnReady(){this._forEachExtensions((b=>b.onReady&&b.onReady()))}_extensionsLoadSceneAsync(b,n){return this._applyExtensions(n,"loadScene",(i=>i.loadSceneAsync&&i.loadSceneAsync(b,n)))}_extensionsLoadNodeAsync(b,n,i){return this._applyExtensions(n,"loadNode",(e=>e.loadNodeAsync&&e.loadNodeAsync(b,n,i)))}_extensionsLoadCameraAsync(b,n,i){return this._applyExtensions(n,"loadCamera",(e=>e.loadCameraAsync&&e.loadCameraAsync(b,n,i)))}_extensionsLoadVertexDataAsync(b,n,i){return this._applyExtensions(n,"loadVertexData",(e=>e._loadVertexDataAsync&&e._loadVertexDataAsync(b,n,i)))}_extensionsLoadMeshPrimitiveAsync(b,n,i,e,V,Q){return this._applyExtensions(V,"loadMeshPrimitive",(U=>U._loadMeshPrimitiveAsync&&U._loadMeshPrimitiveAsync(b,n,i,e,V,Q)))}_extensionsLoadMaterialAsync(b,n,i,e,V){return this._applyExtensions(n,"loadMaterial",(Q=>Q._loadMaterialAsync&&Q._loadMaterialAsync(b,n,i,e,V)))}_extensionsCreateMaterial(b,n,i){return this._applyExtensions(n,"createMaterial",(e=>e.createMaterial&&e.createMaterial(b,n,i)))}_extensionsLoadMaterialPropertiesAsync(b,n,i){return this._applyExtensions(n,"loadMaterialProperties",(e=>e.loadMaterialPropertiesAsync&&e.loadMaterialPropertiesAsync(b,n,i)))}_extensionsLoadTextureInfoAsync(b,n,i){return this._applyExtensions(n,"loadTextureInfo",(e=>e.loadTextureInfoAsync&&e.loadTextureInfoAsync(b,n,i)))}_extensionsLoadTextureAsync(b,n,i){return this._applyExtensions(n,"loadTexture",(e=>e._loadTextureAsync&&e._loadTextureAsync(b,n,i)))}_extensionsLoadAnimationAsync(b,n){return this._applyExtensions(n,"loadAnimation",(i=>i.loadAnimationAsync&&i.loadAnimationAsync(b,n)))}_extensionsLoadAnimationChannelAsync(b,n,i,e,V){return this._applyExtensions(i,"loadAnimationChannel",(Q=>Q._loadAnimationChannelAsync&&Q._loadAnimationChannelAsync(b,n,i,e,V)))}_extensionsLoadSkinAsync(b,n,i){return this._applyExtensions(i,"loadSkin",(e=>e._loadSkinAsync&&e._loadSkinAsync(b,n,i)))}_extensionsLoadUriAsync(b,n,i){return this._applyExtensions(n,"loadUri",(e=>e._loadUriAsync&&e._loadUriAsync(b,n,i)))}_extensionsLoadBufferViewAsync(b,n){return this._applyExtensions(n,"loadBufferView",(i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(b,n)))}_extensionsLoadBufferAsync(b,n,i,e){return this._applyExtensions(n,"loadBuffer",(V=>V.loadBufferAsync&&V.loadBufferAsync(b,n,i,e)))}static LoadExtensionAsync(b,n,i,e){if(!n.extensions)return null;const V=n.extensions[i];return V?e(`${b}/extensions/${i}`,V):null}static LoadExtraAsync(b,n,i,e){if(!n.extras)return null;const V=n.extras[i];return V?e(`${b}/extras/${i}`,V):null}isExtensionUsed(b){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(b)}logOpen(b){this._parent._logOpen(b)}logClose(){this._parent._logClose()}log(b){this._parent._log(b)}startPerformanceCounter(b){this._parent._startPerformanceCounter(b)}endPerformanceCounter(b){this._parent._endPerformanceCounter(b)}}P.DefaultSampler={index:-1},E.b._CreateGLTF2Loader=b=>new P(b);var c=i(13475),q=i(11960),S=i(11811),H=i(13477),l=i(13479);class v extends l.b{constructor(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",b),this._texture=b.getEngine().createRawCubeTexture(n,i,e,V,Q,U,Y,L)}update(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,b,n,i,e,V)}updateRGBDAsync(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,H.h)(this._texture,b,n,i,e).then((()=>{}))}clone(){return S.c.Clone((()=>{const b=this.ab(),n=this._texture,i=new v(b,n._bufferViewArray,n.width,n.format,n.type,n.generateMipMaps,n.invertY,n.samplingMode,n._compression);return 13===n.source&&i.updateRGBDAsync(n._bufferViewArrayArray,n._sphericalPolynomial,n._lodGenerationScale,n._lodGenerationOffset),i}),this)}}const p="EXT_lights_image_based";class f{constructor(b){this.name=p,this._loader=b,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.Ne.extensions;if(b&&b[this.name]){const n=b[this.name];this._lights=n.lights}}loadSceneAsync(b,n){return P.LoadExtensionAsync(b,n,this.name,(async(i,e)=>{this._loader._allMaterialsDirtyRequired=!0;const V=new Array;V.push(this._loader.loadSceneAsync(b,n)),this._loader.logOpen(`${i}`);const Q=X.Get(`${i}/light`,this._lights,e.ai);return V.push(this._loadLightAsync(`/extensions/${this.name}/lights/${e.ai}`,Q).then((b=>{this._loader.babylonScene.environmentTexture=b}))),this._loader.logClose(),await Promise.all(V).then((()=>{}))}))}_loadLightAsync(b,n){if(!n._loaded){const i=new Array;this._loader.logOpen(`${b}`);const e=new Array(n.specularImages.length);for(let V=0;V<n.specularImages.length;V++){const Q=n.specularImages[V];e[V]=new Array(Q.length);for(let n=0;n<Q.length;n++){const U=`${b}/specularImages/${V}/${n}`;this._loader.logOpen(`${U}`);const Y=Q[n],L=X.Get(U,this._loader.Ne.images,Y);i.push(this._loader.loadImageAsync(`/images/${Y}`,L).then((b=>{e[V][n]=b}))),this._loader.logClose()}}this._loader.logClose(),n._loaded=Promise.all(i).then((async()=>{const i=new v(this._loader.babylonScene,null,n.specularImageSize);if(i.name=n.name||"environment",n._babylonTexture=i,void 0!=n.GY&&(i.level=n.GY),n.rotation){let b=V.Quaternion.jn(n.rotation);this._loader.babylonScene.useRightHandedSystem||(b=V.Quaternion.Inverse(b)),V.Matrix.FromQuaternionToRef(b,i.getReflectionTextureMatrix())}if(!n.irradianceCoefficients)throw new Error(`${b}: Irradiance coefficients are missing`);const Q=q.e.jn(n.irradianceCoefficients);Q.scaleInPlace(n.GY),Q.convertIrradianceToLambertianRadiance();const U=q.h.FromHarmonics(Q),Y=(e.length-1)/Math.log2(n.specularImageSize);return await i.updateRGBDAsync(e,U,Y)}))}return n._loaded.then((()=>n._babylonTexture))}}J(p),W(p,!0,(b=>new f(b)));i(12348);const F="EXT_mesh_gpu_instancing";class bb{constructor(b){this.name=F,this._loader=b,this.enabled=this._loader.isExtensionUsed(F)}dispose(){this._loader=null}loadNodeAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(b,e)=>{this._loader._disableInstancedMesh++;const Q=this._loader.loadNodeAsync(`/nodes/${n.index}`,n,i);if(this._loader._disableInstancedMesh--,!n._primitiveBabylonMeshes)return await Q;const U=new Array;let Y=0;const L=n=>{if(void 0==e.attributes[n])return void U.push(Promise.resolve(null));const i=X.Get(`${b}/attributes/${n}`,this._loader.Ne.accessors,e.attributes[n]);if(U.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===Y)Y=i.count;else if(Y!==i.count)throw new Error(`${b}/attributes: Instance buffer accessors do not have the same count.`)};return L("TRANSLATION"),L("ROTATION"),L("SCALE"),await Q.then((async b=>{const[i,e,Q]=await Promise.all(U),L=new Float32Array(16*Y);V.TmpVectors.On[0].re(0,0,0),V.TmpVectors.Quaternion[0].re(0,0,0,1),V.TmpVectors.On[1].re(1,1,1);for(let n=0;n<Y;++n)i&&V.On.FromArrayToRef(i,3*n,V.TmpVectors.On[0]),e&&V.Quaternion.FromArrayToRef(e,4*n,V.TmpVectors.Quaternion[0]),Q&&V.On.FromArrayToRef(Q,3*n,V.TmpVectors.On[1]),V.Matrix.ComposeToRef(V.TmpVectors.On[1],V.TmpVectors.Quaternion[0],V.TmpVectors.On[0],V.TmpVectors.Matrix[0]),V.TmpVectors.Matrix[0].copyToArray(L,16*n);for(const V of n._primitiveBabylonMeshes)V.NN("matrix",L,16,!0);return b}))}))}}J(F),W(F,!0,(b=>new bb(b)));let nb=0,ib=null;class eb{static get Default(){return eb._Default||(eb._Default=new eb),eb._Default}constructor(){const b=eb.Configuration.decoder;this._decoderModulePromise=U.Tools.LoadBabylonScriptAsync(b.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(b,n,i,e,V){await this._decoderModulePromise,0===nb&&(MeshoptDecoder.useWorkers(1),nb=1);const Q=await MeshoptDecoder.decodeGltfBufferAsync(n,i,b,e,V);return null!==ib&&clearTimeout(ib),ib=setTimeout((()=>{MeshoptDecoder.useWorkers(0),nb=0,ib=null}),1e3),Q}}eb.Configuration={decoder:{url:`${U.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},eb._Default=null;const Vb="EXT_meshopt_compression";class Qb{constructor(b){this.name=Vb,this.enabled=b.isExtensionUsed(Vb),this._loader=b}dispose(){this._loader=null}loadBufferViewAsync(b,n){return P.LoadExtensionAsync(b,n,this.name,(async(i,e)=>{const V=n;if(V._meshOptData)return await V._meshOptData;const Q=X.Get(`${b}/buffer`,this._loader.Ne.buffers,e.buffer);return V._meshOptData=this._loader.loadBufferAsync(`/buffers/${Q.index}`,Q,e.byteOffset||0,e.byteLength).then((async b=>await eb.Default.decodeGltfBufferAsync(b,e.count,e.byteStride,e.mode,e.filter))),await V._meshOptData}))}}J(Vb),W(Vb,!0,(b=>new Qb(b)));const Ub="EXT_texture_webp";class Yb{constructor(b){this.name=Ub,this._loader=b,this.enabled=b.isExtensionUsed(Ub)}dispose(){this._loader=null}_loadTextureAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=void 0==n.sampler?P.DefaultSampler:X.Get(`${b}/sampler`,this._loader.Ne.samplers,n.sampler),U=X.Get(`${e}/source`,this._loader.Ne.images,V.source);return await this._loader._createTextureAsync(b,Q,U,(b=>{i(b)}),void 0,!n._textureInfo.nonColorData)}))}}J(Ub),W(Ub,!0,(b=>new Yb(b)));const Lb="EXT_texture_avif";class Bb{constructor(b){this.name=Lb,this._loader=b,this.enabled=b.isExtensionUsed(Lb)}dispose(){this._loader=null}_loadTextureAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=void 0==n.sampler?P.DefaultSampler:X.Get(`${b}/sampler`,this._loader.Ne.samplers,n.sampler),U=X.Get(`${e}/source`,this._loader.Ne.images,V.source);return await this._loader._createTextureAsync(b,Q,U,(b=>{i(b)}),void 0,!n._textureInfo.nonColorData)}))}}J(Lb),W(Lb,!0,(b=>new Bb(b)));var mn=i(13470),Nb=i(12317);const Zb="EXT_lights_ies";class Tb{constructor(b){this.name=Zb,this._loader=b,this.enabled=this._loader.isExtensionUsed(Zb)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.Ne.extensions;if(b&&b[this.name]){const n=b[this.name];this._lights=n.lights,X.Assign(this._lights)}}loadNodeAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,U)=>{let Y,L;this._loader._allMaterialsDirtyRequired=!0;const B=await this._loader.loadNodeAsync(b,n,(b=>{L=X.Get(e,this._lights,U.ai);const n=L.name||b.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y=new mn.e(n,V.On.Zero(),V.On.Backward(),0,1,this._loader.babylonScene),Y.angle=Math.PI/2,Y.innerAngle=0,Y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,L._babylonLight=Y,Y.falloffType=Nb.c.FALLOFF_GLTF,Y.oY=U.color?Q.Mn.jn(U.color):Q.Mn.White(),Y.GY=U.multiplier||1,Y.range=Number.MAX_VALUE,Y.parent=b,this._loader._babylonLights.push(Y),P.AddPointerMetadata(Y,e),i(b)}));let mb;if(L.uri)mb=await this._loader.loadUriAsync(b,L,L.uri);else{const n=X.Get(`${b}/bufferView`,this._loader.Ne.bufferViews,L.bufferView);mb=await this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return Y.iesProfileTexture=new G.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,mb,!0,void 0,void 0,void 0,void 0,".ies"),B}))}}J(Zb),W(Zb,!0,(b=>new Tb(b)));var zb=i(13492);const Kb="KHR_draco_mesh_compression";class Ib{constructor(b){this.name=Kb,this.useNormalizedFlagFromAccessor=!0,this._loader=b,this.enabled=zb.b.DefaultAvailable&&this._loader.isExtensionUsed(Kb)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{if(void 0!=n.mode&&4!==n.mode&&5!==n.mode)throw new Error(`${b}: Unsupported mode ${n.mode}`);const Q={},U={},Y=(b,e)=>{const Y=V.attributes[b];if(void 0!=Y&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(e)&&i._delayInfo.push(e),Q[e]=Y,this.useNormalizedFlagFromAccessor)){const i=X.TryGet(this._loader.Ne.accessors,n.attributes[b]);i&&(U[e]=i.normalized||!1)}};Y("POSITION",M.g.PositionKind),Y("NORMAL",M.g.NormalKind),Y("TANGENT",M.g.TangentKind),Y("TEXCOORD_0",M.g.UVKind),Y("TEXCOORD_1",M.g.UV2Kind),Y("TEXCOORD_2",M.g.UV3Kind),Y("TEXCOORD_3",M.g.UV4Kind),Y("TEXCOORD_4",M.g.UV5Kind),Y("TEXCOORD_5",M.g.UV6Kind),Y("JOINTS_0",M.g.MatricesIndicesKind),Y("WEIGHTS_0",M.g.MatricesWeightsKind),Y("COLOR_0",M.g.ColorKind);const L=X.Get(e,this._loader.Ne.bufferViews,V.bufferView);return L._dracoBabylonGeometry||(L._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((async e=>{const V=this.dracoDecoder||zb.b.Default,Y=X.TryGet(this._loader.Ne.accessors,n.attributes.POSITION),L=this._loader.parent.alwaysComputeBoundingBox||i.skeleton||!Y?null:g(Y);return await V._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,e,Q,U,L).catch((n=>{throw new Error(`${b}: ${n.message}`)}))}))),await L._dracoBabylonGeometry}))}}J(Kb),W(Kb,!0,(b=>new Ib(b)));var Ob=i(13495),ub=i(11756),db=i(11762),Gb=i(12187),ob=i(12388),Mb=i(11734);Gb.b.AddNodeConstructor("Light_Type_0",((b,n)=>()=>new jb(b,V.On.Zero(),n)));class jb extends ob.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(b){this._shadowAngle=b,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(b){const n=this.needCube();if(this._direction=b,this.needCube()!==n&&this._shadowGenerators){const b=this._shadowGenerators.values();for(let n=b.next();!0!==n.done;n=b.next()){n.value.recreateShadowMap()}}}constructor(b,n,i){super(b,i),this._shadowAngle=Math.PI/2,this.position=n}getClassName(){return"PointLight"}getTypeID(){return Nb.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(b){if(this.direction)return super.getShadowDirection(b);switch(b){case 0:return new V.On(1,0,0);case 1:return new V.On(-1,0,0);case 2:return new V.On(0,-1,0);case 3:return new V.On(0,1,0);case 4:return new V.On(0,0,1);case 5:return new V.On(0,0,-1)}return V.On.Zero()}_setDefaultShadowProjectionMatrix(b,n,i){const e=this.ab().activeCamera;if(!e)return;const Q=void 0!==this.shadowMinZ?this.shadowMinZ:e.Ae,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ,Y=this.ab().getEngine().useReverseDepthBuffer;V.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,Y?U:Q,Y?Q:U,b,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Y)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(b,n){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,n):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,n),this}transferToNodeMaterialEffect(b,n){return this.computeTransformedInformation()?b.setFloat3(n,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):b.setFloat3(n,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(b,n){b["POINTLIGHT"+n]=!0}}(0,ub.e)([(0,db.W)()],jb.prototype,"shadowAngle",null),(0,Mb.i)("BABYLON.PointLight",jb);const ab="KHR_lights_punctual";class Db{constructor(b){this.name=ab,this._loader=b,this.enabled=this._loader.isExtensionUsed(ab)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.Ne.extensions;if(b&&b[this.name]){const n=b[this.name];this._lights=n.lights,X.Assign(this._lights)}}loadNodeAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,U)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(b,n,(b=>{let n;const Y=X.Get(e,this._lights,U.ai),L=Y.name||b.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y.type){case"directional":{const b=new Ob.d(L,V.On.Backward(),this._loader.babylonScene);b.position.Fe(0),n=b;break}case"point":n=new jb(L,V.On.Zero(),this._loader.babylonScene);break;case"spot":{const b=new mn.e(L,V.On.Zero(),V.On.Backward(),0,1,this._loader.babylonScene);b.angle=2*(Y.spot&&Y.spot.outerConeAngle||Math.PI/4),b.innerAngle=2*(Y.spot&&Y.spot.innerConeAngle||0),n=b;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${e}: Invalid light type (${Y.type})`)}n._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Y._babylonLight=n,n.falloffType=Nb.c.FALLOFF_GLTF,n.oY=Y.color?Q.Mn.jn(Y.color):Q.Mn.White(),n.GY=void 0==Y.GY?1:Y.GY,n.range=void 0==Y.range?Number.MAX_VALUE:Y.range,n.parent=b,this._loader._babylonLights.push(n),P.AddPointerMetadata(n,e),i(b)})))))}}J(ab),W(ab,!0,(b=>new Db(b)));const xb="KHR_materials_pbrSpecularGlossiness";class yb{constructor(b){this.name=xb,this.order=200,this._loader=b,this.enabled=this._loader.isExtensionUsed(xb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialBasePropertiesAsync(b,n,i)),Q.push(this._loadSpecularGlossinessPropertiesAsync(e,V,i)),this._loader.loadMaterialAlphaProperties(b,n,i),await Promise.all(Q).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return i.metallic=null,i.roughness=null,n.diffuseFactor?(i.albedoColor=Q.Mn.jn(n.diffuseFactor),i.alpha=n.diffuseFactor[3]):i.albedoColor=Q.Mn.White(),i.reflectivityColor=n.specularFactor?Q.Mn.jn(n.specularFactor):Q.Mn.White(),i.microSurface=void 0==n.glossinessFactor?1:n.glossinessFactor,n.diffuseTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTexture`,n.diffuseTexture,(b=>{b.name=`${i.name} (Diffuse)`,i.albedoTexture=b}))),n.specularGlossinessTexture&&(e.push(this._loader.loadTextureInfoAsync(`${b}/specularGlossinessTexture`,n.specularGlossinessTexture,(b=>{b.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=b,i.reflectivityTexture.se=!0}))),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(e).then((()=>{}))}}J(xb),W(xb,!0,(b=>new yb(b)));const sb="KHR_materials_unlit";class Ab{constructor(b){this.name=sb,this.order=210,this._loader=b,this.enabled=this._loader.isExtensionUsed(sb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async()=>await this._loadUnlitPropertiesAsync(b,n,i)))}_loadUnlitPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;i.unlit=!0;const V=n.pbrMetallicRoughness;return V&&(V.baseColorFactor?(i.albedoColor=Q.Mn.jn(V.baseColorFactor),i.alpha=V.baseColorFactor[3]):i.albedoColor=Q.Mn.White(),V.baseColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/baseColorTexture`,V.baseColorTexture,(b=>{b.name=`${i.name} (Base Color)`,i.albedoTexture=b})))),n.doubleSided&&(i.Re=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(b,n,i),Promise.all(e).then((()=>{}))}}J(sb),W(sb,!0,(b=>new Ab(b)));const Eb="KHR_materials_clearcoat";class Cb{constructor(b){this.name=Eb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Eb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadClearCoatPropertiesAsync(e,V,i)),await Promise.all(Q)}))}_loadClearCoatPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return i.clearCoat.isEnabled=!0,i.clearCoat.useRoughnessFromMainTexture=!1,i.clearCoat.remapF0OnInterfaceChange=!1,void 0!=n.clearcoatFactor?i.clearCoat.GY=n.clearcoatFactor:i.clearCoat.GY=0,n.clearcoatTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatTexture`,n.clearcoatTexture,(b=>{b.name=`${i.name} (ClearCoat)`,i.clearCoat.texture=b}))),void 0!=n.clearcoatRoughnessFactor?i.clearCoat.roughness=n.clearcoatRoughnessFactor:i.clearCoat.roughness=0,n.clearcoatRoughnessTexture&&(n.clearcoatRoughnessTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatRoughnessTexture`,n.clearcoatRoughnessTexture,(b=>{b.name=`${i.name} (ClearCoat Roughness)`,i.clearCoat.textureRoughness=b})))),n.clearcoatNormalTexture&&(n.clearcoatNormalTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatNormalTexture`,n.clearcoatNormalTexture,(b=>{b.name=`${i.name} (ClearCoat Normal)`,i.clearCoat.bumpTexture=b}))),i.invertNormalMapX=!i.ab().useRightHandedSystem,i.invertNormalMapY=i.ab().useRightHandedSystem,void 0!=n.clearcoatNormalTexture.scale&&(i.clearCoat.bumpTexture.level=n.clearcoatNormalTexture.scale)),Promise.all(e).then((()=>{}))}}J(Eb),W(Eb,!0,(b=>new Cb(b)));const tb="KHR_materials_iridescence";class wb{constructor(b){this.name=tb,this.order=195,this._loader=b,this.enabled=this._loader.isExtensionUsed(tb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadIridescencePropertiesAsync(e,V,i)),await Promise.all(Q).then((()=>{}))}))}_loadIridescencePropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return i.iridescence.isEnabled=!0,i.iridescence.GY=n.iridescenceFactor??0,i.iridescence.indexOfRefraction=n.iridescenceIor??n.iridescenceIOR??1.3,i.iridescence.minimumThickness=n.iridescenceThicknessMinimum??100,i.iridescence.maximumThickness=n.iridescenceThicknessMaximum??400,n.iridescenceTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/iridescenceTexture`,n.iridescenceTexture,(b=>{b.name=`${i.name} (Iridescence)`,i.iridescence.texture=b}))),n.iridescenceThicknessTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/iridescenceThicknessTexture`,n.iridescenceThicknessTexture,(b=>{b.name=`${i.name} (Iridescence Thickness)`,i.iridescence.thicknessTexture=b}))),Promise.all(e).then((()=>{}))}}J(tb),W(tb,!0,(b=>new wb(b)));const hb="KHR_materials_anisotropy";class Wb{constructor(b){this.name=hb,this.order=195,this._loader=b,this.enabled=this._loader.isExtensionUsed(hb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadIridescencePropertiesAsync(e,V,i)),await Promise.all(Q)}))}async _loadIridescencePropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;i.anisotropy.isEnabled=!0,i.anisotropy.GY=n.anisotropyStrength??0,i.anisotropy.angle=n.anisotropyRotation??0,n.anisotropyTexture&&(n.anisotropyTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${b}/anisotropyTexture`,n.anisotropyTexture,(b=>{b.name=`${i.name} (Anisotropy Intensity)`,i.anisotropy.texture=b})))),await Promise.all(e)}}J(hb),W(hb,!0,(b=>new Wb(b)));const Jb="KHR_materials_emissive_strength";class Rb{constructor(b){this.name=Jb,this.order=170,this._loader=b,this.enabled=this._loader.isExtensionUsed(Jb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>await this._loader.loadMaterialPropertiesAsync(b,n,i).then((()=>{this._loadEmissiveProperties(e,V,i)}))))}_loadEmissiveProperties(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);void 0!==n.emissiveStrength&&(i.emissiveIntensity=n.emissiveStrength)}}J(Jb),W(Jb,!0,(b=>new Rb(b)));const kb="KHR_materials_sheen";class rb{constructor(b){this.name=kb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(kb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadSheenPropertiesAsync(e,V,i)),await Promise.all(Q).then((()=>{}))}))}_loadSheenPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return i.sheen.isEnabled=!0,i.sheen.GY=1,void 0!=n.sheenColorFactor?i.sheen.color=Q.Mn.jn(n.sheenColorFactor):i.sheen.color=Q.Mn.Black(),n.sheenColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/sheenColorTexture`,n.sheenColorTexture,(b=>{b.name=`${i.name} (Sheen Color)`,i.sheen.texture=b}))),void 0!==n.sheenRoughnessFactor?i.sheen.roughness=n.sheenRoughnessFactor:i.sheen.roughness=0,n.sheenRoughnessTexture&&(n.sheenRoughnessTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${b}/sheenRoughnessTexture`,n.sheenRoughnessTexture,(b=>{b.name=`${i.name} (Sheen Roughness)`,i.sheen.textureRoughness=b})))),i.sheen.albedoScaling=!0,i.sheen.useRoughnessFromMainTexture=!1,Promise.all(e).then((()=>{}))}}J(kb),W(kb,!0,(b=>new rb(b)));var Xb=i(12247);const gb="KHR_materials_specular";class Pb{constructor(b){this.name=gb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(gb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;if(Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadSpecularPropertiesAsync(e,V,i)),V.extensions&&V.extensions.EXT_materials_specular_edge_color&&i instanceof d.c){V.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(i.brdf.dielectricSpecularModel=Xb.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,i.brdf.conductorSpecularModel=Xb.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Q).then((()=>{}))}))}_loadSpecularPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return void 0!==n.specularFactor&&(i.metallicF0Factor=n.specularFactor),void 0!==n.specularColorFactor&&(i.metallicReflectanceColor=Q.Mn.jn(n.specularColorFactor)),n.specularTexture&&(n.specularTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${b}/specularTexture`,n.specularTexture,(b=>{b.name=`${i.name} (Specular)`,i.metallicReflectanceTexture=b,i.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),n.specularColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/specularColorTexture`,n.specularColorTexture,(b=>{b.name=`${i.name} (Specular Color)`,i.reflectanceTexture=b}))),Promise.all(e).then((()=>{}))}}J(gb),W(gb,!0,(b=>new Pb(b)));const cb="KHR_materials_ior";class qb{constructor(b){this.name=cb,this.order=180,this._loader=b,this.enabled=this._loader.isExtensionUsed(cb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadIorPropertiesAsync(e,V,i)),await Promise.all(Q).then((()=>{}))}))}_loadIorPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);return void 0!==n.ior?i.indexOfRefraction=n.ior:i.indexOfRefraction=qb._DEFAULT_IOR,Promise.resolve()}}qb._DEFAULT_IOR=1.5,J(cb),W(cb,!0,(b=>new qb(b)));const Sb="KHR_materials_variants";class Hb{constructor(b){this.name=Sb,this._loader=b,this.enabled=this._loader.isExtensionUsed(Sb)}dispose(){this._loader=null}static GetAvailableVariants(b){const n=this._GetExtensionMetadata(b);return n?Object.keys(n.variants):[]}getAvailableVariants(b){return Hb.GetAvailableVariants(b)}static SelectVariant(b,n){const i=this._GetExtensionMetadata(b);if(!i)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Sb} extension`);const e=b=>{const n=i.variants[b];if(n)for(const i of n)i.mesh.material=i.material};if(n instanceof Array)for(const V of n)e(V);else e(n);i.lastSelected=n}selectVariant(b,n){Hb.SelectVariant(b,n)}static Reset(b){const n=this._GetExtensionMetadata(b);if(!n)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Sb} extension`);for(const i of n.original)i.mesh.material=i.material;n.lastSelected=null}reset(b){Hb.Reset(b)}static GetLastSelectedVariant(b){const n=this._GetExtensionMetadata(b);if(!n)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Sb} extension`);return n.lastSelected}getLastSelectedVariant(b){return Hb.GetLastSelectedVariant(b)}static _GetExtensionMetadata(b){var n,i;return(null===b||void 0===b||null===(n=b._internalMetadata)||void 0===n||null===(i=n.Ne)||void 0===i?void 0:i[Sb])||null}onLoading(){const b=this._loader.Ne.extensions;if(b&&b[this.name]){const n=b[this.name];this._variants=n.variants}}onReady(){const b=this._loader.rootBabylonMesh;if(b){var n;const i=this._loader.parent.extensionOptions[Sb];null!==i&&void 0!==i&&i.defaultVariant&&Hb.SelectVariant(b,i.defaultVariant),null===i||void 0===i||null===(n=i.onLoaded)||void 0===n||n.call(i,{get variants(){return Hb.GetAvailableVariants(b)},get selectedVariant(){const n=Hb.GetLastSelectedVariant(b);return n?Array.isArray(n)?n[0]:n:Hb.GetAvailableVariants(b)[0]},set selectedVariant(n){Hb.SelectVariant(b,n)}})}}_loadMeshPrimitiveAsync(b,n,i,e,V,Q){return P.LoadExtensionAsync(b,V,this.name,(async(U,Y)=>{const L=new Array;return L.push(this._loader._loadMeshPrimitiveAsync(b,n,i,e,V,(n=>{if(Q(n),n instanceof D.b){const i=P._GetDrawMode(b,V.mode),e=this._loader.rootBabylonMesh,Q=e?e._internalMetadata=e._internalMetadata||{}:{},B=Q.Ne=Q.Ne||{},mb=B[Sb]=B[Sb]||{lastSelected:null,original:[],variants:{}};mb.original.push({mesh:n,material:n.material});for(let b=0;b<Y.mappings.length;++b){const V=Y.mappings[b],Q=X.Get(`${U}/mappings/${b}/material`,this._loader.Ne.materials,V.material);L.push(this._loader._loadMaterialAsync(`#/materials/${V.material}`,Q,n,i,(b=>{for(let i=0;i<V.variants.length;++i){const Q=V.variants[i],U=X.Get(`/extensions/${Sb}/variants/${Q}`,this._variants,Q);mb.variants[U.name]=mb.variants[U.name]||[],mb.variants[U.name].push({mesh:n,material:b}),n.onClonedObservable.add((b=>{const i=b;let V=null,Q=i;do{if(Q=Q.parent,!Q)return;V=Hb._GetExtensionMetadata(Q)}while(null===V);if(e&&V===Hb._GetExtensionMetadata(e)){Q._internalMetadata={};for(const b in e._internalMetadata)Q._internalMetadata[b]=e._internalMetadata[b];Q._internalMetadata.Ne=[];for(const b in e._internalMetadata.Ne)Q._internalMetadata.Ne[b]=e._internalMetadata.Ne[b];Q._internalMetadata.Ne[Sb]={lastSelected:null,original:[],variants:{}};for(const b of V.original)Q._internalMetadata.Ne[Sb].original.push({mesh:b.mesh,material:b.material});for(const b in V.variants)if(Object.prototype.hasOwnProperty.call(V.variants,b)){Q._internalMetadata.Ne[Sb].variants[b]=[];for(const n of V.variants[b])Q._internalMetadata.Ne[Sb].variants[b].push({mesh:n.mesh,material:n.material})}V=Q._internalMetadata.Ne[Sb]}for(const e of V.original)e.mesh===n&&(e.mesh=i);for(const e of V.variants[U.name])e.mesh===n&&(e.mesh=i)}))}})))}}}))),await Promise.all(L).then((b=>{let[n]=b;return n}))}))}}J(Sb),W(Sb,!0,(b=>new Hb(b)));var lb=i(11832);class vb{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Xb.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(b,n){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...vb._GetDefaultOptions(),...b},this._scene=n,this._scene._transmissionHelper=this,this.onErrorObservable=new mb.e,this._scene.Qe.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(b){if(!Object.keys(b).filter((n=>this._options[n]!==b[n])).length)return;const n={...this._options,...b},i=this._options;this._options=n,n.renderSize===i.renderSize&&n.renderTargetTextureType===i.renderTargetTextureType&&n.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=n.samples,this._opaqueRenderTarget.lodGenerationScale=n.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=n.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(b){return!!b&&!!(b instanceof d.c&&b.subSurface.isRefractionEnabled)}_addMesh(b){this._materialObservers[b.uniqueId]=b.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),U.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(b.material)?(b.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(b)&&this._transparentMeshesCache.push(b)):-1===this._opaqueMeshesCache.indexOf(b)&&this._opaqueMeshesCache.push(b)}))}_removeMesh(b){b.onMaterialChangedObservable.remove(this._materialObservers[b.uniqueId]),delete this._materialObservers[b.uniqueId];let n=this._transparentMeshesCache.indexOf(b);-1!==n&&this._transparentMeshesCache.splice(n,1),n=this._opaqueMeshesCache.indexOf(b),-1!==n&&this._opaqueMeshesCache.splice(n,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(b){const n=this._transparentMeshesCache.indexOf(b),i=this._opaqueMeshesCache.indexOf(b);this._shouldRenderAsTransmission(b.material)?(b.material instanceof d.c&&(b.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(b)):-1===n&&this._transparentMeshesCache.push(b)):-1!==n?(this._transparentMeshesCache.splice(n,1),this._opaqueMeshesCache.push(b)):-1===i&&this._opaqueMeshesCache.push(b)}_isRenderTargetValid(){var b;return null!==(null===(b=this._opaqueRenderTarget)||void 0===b?void 0:b.getInternalTexture())}_setupRenderTargets(){var b;let n;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new lb.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(b=this._options.clearColor)||void 0===b?void 0:b.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((b=>{n=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?b.clearColor.L(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(b.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=n}));for(const i of this._transparentMeshesCache)this._shouldRenderAsTransmission(i.material)&&(i.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const pb="KHR_materials_transmission";class fb{constructor(b){this.name=pb,this.order=175,this._loader=b,this.enabled=this._loader.isExtensionUsed(pb),this.enabled&&(b.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadTransparentPropertiesAsync(e,n,i,V)),await Promise.all(Q).then((()=>{}))}))}_loadTransparentPropertiesAsync(b,n,i,e){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const V=i;if(V.subSurface.isRefractionEnabled=!0,V.subSurface.volumeIndexOfRefraction=1,V.subSurface.useAlbedoToTintRefraction=!0,void 0===e.transmissionFactor)return V.subSurface.refractionIntensity=0,V.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Q;V.subSurface.refractionIntensity=e.transmissionFactor;const b=V.ab();if(V.subSurface.refractionIntensity&&!b._transmissionHelper)new vb({},V.ab());else if(V.subSurface.refractionIntensity&&(null===(Q=b._transmissionHelper)||void 0===Q||!Q._isRenderTargetValid())){var U;null===(U=b._transmissionHelper)||void 0===U||U._setupRenderTargets()}}return V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=0,e.transmissionTexture?(e.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${b}/transmissionTexture`,e.transmissionTexture,void 0).then((b=>{b.name=`${i.name} (Transmission)`,V.subSurface.refractionIntensityTexture=b,V.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(pb),W(pb,!0,(b=>new fb(b)));const Fb="KHR_materials_diffuse_transmission";class bn{constructor(b){this.name=Fb,this.order=174,this._loader=b,this.enabled=this._loader.isExtensionUsed(Fb),this.enabled&&(b.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadTranslucentPropertiesAsync(e,n,i,V)),await Promise.all(Q).then((()=>{}))}))}_loadTranslucentPropertiesAsync(b,n,i,e){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const V=i;if(V.subSurface.isTranslucencyEnabled=!0,V.subSurface.volumeIndexOfRefraction=1,V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=0,V.subSurface.useAlbedoToTintTranslucency=!1,void 0===e.diffuseTransmissionFactor)return V.subSurface.translucencyIntensity=0,V.subSurface.isTranslucencyEnabled=!1,Promise.resolve();V.subSurface.translucencyIntensity=e.diffuseTransmissionFactor;const U=new Array;return V.subSurface.useGltfStyleTextures=!0,e.diffuseTransmissionTexture&&(e.diffuseTransmissionTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTransmissionTexture`,e.diffuseTransmissionTexture).then((b=>{b.name=`${i.name} (Diffuse Transmission)`,V.subSurface.translucencyIntensityTexture=b})))),void 0!==e.diffuseTransmissionColorFactor?V.subSurface.translucencyColor=Q.Mn.jn(e.diffuseTransmissionColorFactor):V.subSurface.translucencyColor=Q.Mn.White(),e.diffuseTransmissionColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTransmissionColorTexture`,e.diffuseTransmissionColorTexture).then((b=>{b.name=`${i.name} (Diffuse Transmission Color)`,V.subSurface.translucencyColorTexture=b}))),Promise.all(U).then((()=>{}))}}J(Fb),W(Fb,!0,(b=>new bn(b)));const nn="KHR_materials_volume";class en{constructor(b){this.name=nn,this.order=173,this._loader=b,this.enabled=this._loader.isExtensionUsed(nn),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadVolumePropertiesAsync(e,n,i,V)),await Promise.all(Q).then((()=>{}))}))}_loadVolumePropertiesAsync(b,n,i,e){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);if(!i.subSurface.isRefractionEnabled&&!i.subSurface.isTranslucencyEnabled||!e.thicknessFactor)return Promise.resolve();i.subSurface.volumeIndexOfRefraction=i.indexOfRefraction;const V=void 0!==e.attenuationDistance?e.attenuationDistance:Number.MAX_VALUE;return i.subSurface.tintColorAtDistance=V,void 0!==e.attenuationColor&&3==e.attenuationColor.length&&i.subSurface.tintColor.re(e.attenuationColor[0],e.attenuationColor[1],e.attenuationColor[2]),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=e.thicknessFactor,i.subSurface.useThicknessAsDepth=!0,e.thicknessTexture?(e.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${b}/thicknessTexture`,e.thicknessTexture).then((b=>{b.name=`${i.name} (Thickness)`,i.subSurface.thicknessTexture=b,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(nn),W(nn,!0,(b=>new en(b)));const Vn="KHR_materials_dispersion";class Qn{constructor(b){this.name=Vn,this.order=174,this._loader=b,this.enabled=this._loader.isExtensionUsed(Vn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadDispersionPropertiesAsync(e,n,i,V)),await Promise.all(Q).then((()=>{}))}))}_loadDispersionPropertiesAsync(b,n,i,e){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);return i.subSurface.isRefractionEnabled&&e.dispersion?(i.subSurface.isDispersionEnabled=!0,i.subSurface.dispersion=e.dispersion,Promise.resolve()):Promise.resolve()}}J(Vn),W(Vn,!0,(b=>new Qn(b)));const Un="EXT_materials_diffuse_roughness";class Yn{constructor(b){this.name=Un,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Un)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(b,n,i)),Q.push(this._loadDiffuseRoughnessPropertiesAsync(e,V,i)),await Promise.all(Q).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(b,n,i){if(!(i instanceof d.c))throw new Error(`${b}: Material type not supported`);const e=new Array;return i.brdf.baseDiffuseModel=Xb.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=n.diffuseRoughnessFactor?i.baseDiffuseRoughness=n.diffuseRoughnessFactor:i.baseDiffuseRoughness=0,n.diffuseRoughnessTexture&&e.push(this._loader.loadTextureInfoAsync(`${b}/diffuseRoughnessTexture`,n.diffuseRoughnessTexture,(b=>{b.name=`${i.name} (Diffuse Roughness)`,i.baseDiffuseRoughnessTexture=b}))),Promise.all(e).then((()=>{}))}}J(Un),W(Un,!0,(b=>new Yn(b)));const Ln="KHR_mesh_quantization";class Bn{constructor(b){this.name=Ln,this.enabled=b.isExtensionUsed(Ln)}dispose(){}}J(Ln),W(Ln,!0,(b=>new Bn(b)));const mi="KHR_texture_basisu";class Nn{constructor(b){this.name=mi,this._loader=b,this.enabled=b.isExtensionUsed(mi)}dispose(){this._loader=null}_loadTextureAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>{const Q=void 0==n.sampler?P.DefaultSampler:X.Get(`${b}/sampler`,this._loader.Ne.samplers,n.sampler),U=X.Get(`${e}/source`,this._loader.Ne.images,V.source);return await this._loader._createTextureAsync(b,Q,U,(b=>{i(b)}),n._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!n._textureInfo.nonColorData)}))}}J(mi),W(mi,!0,(b=>new Nn(b)));const Zn="KHR_texture_transform";class Tn{constructor(b){this.name=Zn,this._loader=b,this.enabled=this._loader.isExtensionUsed(Zn)}dispose(){this._loader=null}loadTextureInfoAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(e,V)=>await this._loader.loadTextureInfoAsync(b,n,(b=>{if(!(b instanceof G.e))throw new Error(`${e}: Texture type not supported`);V.offset&&(b.uOffset=V.offset[0],b.vOffset=V.offset[1]),b.uRotationCenter=0,b.vRotationCenter=0,V.rotation&&(b.wAng=-V.rotation),V.scale&&(b.uScale=V.scale[0],b.vScale=V.scale[1]),void 0!=V.texCoord&&(b.coordinatesIndex=V.texCoord),i(b)}))))}}J(Zn),W(Zn,!0,(b=>new Tn(b)));const zn="KHR_xmp_json_ld";class Kn{constructor(b){this.name=zn,this.order=100,this._loader=b,this.enabled=this._loader.isExtensionUsed(zn)}dispose(){this._loader=null}onLoading(){var b,n,i;if(null===this._loader.rootBabylonMesh)return;const e=null===(b=this._loader.Ne.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld,V=null===(n=this._loader.Ne.asset)||void 0===n||null===(i=n.extensions)||void 0===i?void 0:i.KHR_xmp_json_ld;if(e&&V){const b=+V.packet;e.packets&&b<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[b])}}}function In(b,n,i,e){return Q.Mn.jn(n,i).scale(e)}function On(b,n,i,e){return n[i]*e}function un(b,n,i,e){return-n[i]*e}function dn(b,n,i,e){return n[i+1]*e}function Gn(b,n,i,e){return n[i]*e*2}function on(b){return{scale:[new jn(Z.c.ANIMATIONTYPE_FLOAT,`${b}.uScale`,On,(()=>2)),new jn(Z.c.ANIMATIONTYPE_FLOAT,`${b}.vScale`,dn,(()=>2))],offset:[new jn(Z.c.ANIMATIONTYPE_FLOAT,`${b}.uOffset`,On,(()=>2)),new jn(Z.c.ANIMATIONTYPE_FLOAT,`${b}.vOffset`,dn,(()=>2))],rotation:[new jn(Z.c.ANIMATIONTYPE_FLOAT,`${b}.wAng`,un,(()=>1))]}}J(zn),W(zn,!0,(b=>new Kn(b)));class Mn extends c.AnimationPropertyInfo{buildAnimations(b,n,i,e){return[{babylonAnimatable:b._babylonCamera,babylonAnimation:this._buildAnimation(n,i,e)}]}}class jn extends c.AnimationPropertyInfo{buildAnimations(b,n,i,e){const V=[];for(const Q in b._data)V.push({babylonAnimatable:b._data[Q].babylonMaterial,babylonAnimation:this._buildAnimation(n,i,e)});return V}}class an extends c.AnimationPropertyInfo{buildAnimations(b,n,i,e){return[{babylonAnimatable:b._babylonLight,babylonAnimation:this._buildAnimation(n,i,e)}]}}(0,R.m)("/cameras/{}/orthographic/xmag",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"orthoLeft",un,(()=>1)),new Mn(Z.c.ANIMATIONTYPE_FLOAT,"orthoRight",dn,(()=>1))]),(0,R.m)("/cameras/{}/orthographic/ymag",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"orthoBottom",un,(()=>1)),new Mn(Z.c.ANIMATIONTYPE_FLOAT,"orthoTop",dn,(()=>1))]),(0,R.m)("/cameras/{}/orthographic/zfar",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"maxZ",On,(()=>1))]),(0,R.m)("/cameras/{}/orthographic/znear",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"Ae",On,(()=>1))]),(0,R.m)("/cameras/{}/perspective/yfov",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"fov",On,(()=>1))]),(0,R.m)("/cameras/{}/perspective/zfar",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"maxZ",On,(()=>1))]),(0,R.m)("/cameras/{}/perspective/znear",[new Mn(Z.c.ANIMATIONTYPE_FLOAT,"Ae",On,(()=>1))]),(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new jn(Z.c.ANIMATIONTYPE_COLOR3,"albedoColor",In,(()=>4)),new jn(Z.c.ANIMATIONTYPE_FLOAT,"alpha",(function(b,n,i,e){return n[i+3]*e}),(()=>4))]),(0,R.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"metallic",On,(()=>1))]),(0,R.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"roughness",On,(()=>1))]);const Dn=on("albedoTexture");(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Dn.scale),(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Dn.offset),(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Dn.rotation);const xn=on("metallicTexture");(0,R.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",xn.scale),(0,R.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",xn.offset),(0,R.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",xn.rotation),(0,R.m)("/materials/{}/emissiveFactor",[new jn(Z.c.ANIMATIONTYPE_COLOR3,"emissiveColor",In,(()=>3))]);const yn=on("bumpTexture");(0,R.m)("/materials/{}/normalTexture/scale",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",On,(()=>1))]),(0,R.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",yn.scale),(0,R.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",yn.offset),(0,R.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",yn.rotation),(0,R.m)("/materials/{}/occlusionTexture/strength",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",On,(()=>1))]);const sn=on("ambientTexture");(0,R.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",sn.scale),(0,R.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",sn.offset),(0,R.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",sn.rotation);const An=on("emissiveTexture");(0,R.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",An.scale),(0,R.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",An.offset),(0,R.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",An.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",On,(()=>1))]);const En=on("anisotropy.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",En.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",En.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",En.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",On,(()=>1))]);const Cn=on("clearCoat.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Cn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Cn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Cn.rotation);const tn=on("clearCoat.bumpTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",tn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",tn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",tn.rotation);const wn=on("clearCoat.textureRoughness");(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",wn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",wn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",wn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",On,(()=>1))]);const hn=on("iridescence.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",hn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",hn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",hn.rotation);const Wn=on("iridescence.thicknessTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Wn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Wn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Wn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new jn(Z.c.ANIMATIONTYPE_COLOR3,"sheen.color",In,(()=>3))]),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",On,(()=>1))]);const Jn=on("sheen.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Jn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Jn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Jn.rotation);const Rn=on("sheen.textureRoughness");(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Rn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Rn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Rn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new jn(Z.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",In,(()=>3))]);const kn=on("metallicReflectanceTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",kn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",kn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",kn.rotation);const rn=on("reflectanceTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",rn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",rn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",rn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",On,(()=>1))]);const Xn=on("subSurface.refractionIntensityTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Xn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Xn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Xn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new jn(Z.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",In,(()=>3))]),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",On,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",On,(()=>1))]);const gn=on("subSurface.thicknessTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",gn.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",gn.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",gn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new jn(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",On,(()=>1))]);const Pn=on("subSurface.translucencyIntensityTexture");(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Pn.scale),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Pn.offset),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Pn.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new jn(Z.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",In,(()=>3))]);const cn=on("subSurface.translucencyColorTexture");(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",cn.scale),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",cn.offset),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",cn.rotation),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new an(Z.c.ANIMATIONTYPE_COLOR3,"diffuse",In,(()=>3))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new an(Z.c.ANIMATIONTYPE_FLOAT,"intensity",On,(()=>1))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new an(Z.c.ANIMATIONTYPE_FLOAT,"range",On,(()=>1))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new an(Z.c.ANIMATIONTYPE_FLOAT,"innerAngle",Gn,(()=>1))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new an(Z.c.ANIMATIONTYPE_FLOAT,"angle",Gn,(()=>1))]),(0,R.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new an(Z.c.ANIMATIONTYPE_COLOR3,"diffuse",In,(()=>3))]),(0,R.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new an(Z.c.ANIMATIONTYPE_FLOAT,"intensity",On,(()=>1))]);const qn="KHR_animation_pointer";class Sn{constructor(b){this.name=qn,this._loader=b,this._pathToObjectConverter=(0,R.i)(this._loader.Ne)}get enabled(){return this._loader.isExtensionUsed(qn)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(b,n,i,e,V){var Q;const U=null===(Q=e.target.extensions)||void 0===Q?void 0:Q.KHR_animation_pointer;if(!U||!this._pathToObjectConverter)return null;"pointer"!==e.target.path&&K.b.Warn(`${b}/target/path: Value (${e.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=e.target.node&&K.b.Warn(`${b}/target/node: Value (${e.target.node}) must not be present when using the ${this.name} extension`);const Y=`${b}/extensions/${this.name}`,L=U.pointer;if(!L)throw new Error(`${Y}: Pointer is missing`);try{const Q=this._pathToObjectConverter.convert(L);if(!Q.info.interpolation)throw new Error(`${Y}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(b,n,i,e,{object:Q.object,info:Q.info.interpolation},V)}catch(B){return K.b.Warn(`${Y}/pointer: Invalid pointer (${L}) skipped`),null}}}J(qn),W(qn,!0,(b=>new Sn(b)));class Hn{constructor(b,n,i){this.frame=b,this.action=n,this.onlyOnce=i,this.isDone=!1}_clone(){return new Hn(this.frame,this.action,this.onlyOnce)}}var ln=i(11636),vn=i(11676),pn=i(11674);class fn{get loop(){return this._loop}set loop(b){b!==this._loop&&(this._loop=b,this.updateOptions({loop:b}))}get currentTime(){var b;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(b=vn.b.audioEngine)&&void 0!==b&&b.audioContext&&(this.isPlaying||this.isPaused)){const b=this.isPaused?0:vn.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+b}return 0}get spatialSound(){return this._spatialSound}set spatialSound(b){if(b==this._spatialSound)return;const n=this.isPlaying;this.pause(),b?(this._spatialSound=b,this._updateSpatialParameters()):this._disableSpatialSound(),n&&this.play()}constructor(b,n,i){var e;let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new mb.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=V.On.Zero(),this._localDirection=new V.On(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=b,i=i||z.d.LastCreatedScene)if(this._scene=i,fn._SceneComponentInitialization(i),this._readyToPlayCallback=Q,this._customAttenuationFunction=(b,n,i,e,V)=>n<i?b*(1-n/i):0,Y&&(this.autoplay=Y.autoplay||!1,this._loop=Y.loop||!1,void 0!==Y.volume&&(this._volume=Y.volume),this._spatialSound=Y.spatialSound??!1,this.maxDistance=Y.maxDistance??100,this.useCustomAttenuation=Y.useCustomAttenuation??!1,this.rolloffFactor=Y.rolloffFactor||1,this.refDistance=Y.refDistance||1,this.distanceModel=Y.distanceModel||"linear",this._playbackRate=Y.playbackRate||1,this._streaming=Y.streaming??!1,this._length=Y.length,this._offset=Y.offset),null!==(e=vn.b.audioEngine)&&void 0!==e&&e.canUseWebAudio&&vn.b.audioEngine.audioContext){this._soundGain=vn.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let b=!0;if(n)try{"string"===typeof n?(this._urlType="String",this._url=n):n instanceof ArrayBuffer?this._urlType="ArrayBuffer":n instanceof HTMLMediaElement?this._urlType="MediaElement":n instanceof MediaStream?this._urlType="MediaStream":n instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(n)&&(this._urlType="Array");let i=[],e=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vn.b.audioEngine.audioContext.createMediaElementSource(n),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vn.b.audioEngine.audioContext.createMediaStreamSource(n),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":n.byteLength>0&&(e=!0,this._soundLoaded(n));break;case"AudioBuffer":this._audioBufferLoaded(n);break;case"String":i.push(n);case"Array":0===i.length&&(i=n);for(let b=0;b<i.length;b++){const n=i[b];if(e=Y&&Y.skipCodecCheck||-1!==n.indexOf(".mp3",n.length-4)&&vn.b.audioEngine.isMP3supported||-1!==n.indexOf(".ogg",n.length-4)&&vn.b.audioEngine.isOGGsupported||-1!==n.indexOf(".wav",n.length-4)||-1!==n.indexOf(".m4a",n.length-4)||-1!==n.indexOf(".mp4",n.length-4)||-1!==n.indexOf("blob:"),e){this._streaming?(this._htmlAudioElement=new Audio(n),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,U.Tools.SetCorsBehavior(n,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(n,(b=>{this._soundLoaded(b)}),void 0,!0,!0,(b=>{b&&K.b.Error("XHR "+b.status+" error on: "+n+"."),K.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:b=!1}b?e||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):K.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(L){K.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),vn.b.audioEngine&&!vn.b.audioEngine.WarnedWebAudioUnsupported&&(K.b.Error("Web Audio is not supported by your browser."),vn.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var b;null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(b){var n;null!==(n=vn.b.audioEngine)&&void 0!==n&&n.audioContext&&(this._audioBuffer=b,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(b){var n;null!==(n=vn.b.audioEngine)&&void 0!==n&&n.audioContext&&vn.b.audioEngine.audioContext.decodeAudioData(b,(b=>{this._audioBufferLoaded(b)}),(b=>{K.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+b)}))}setAudioBuffer(b){var n;null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&(this._audioBuffer=b,this._isReadyToPlay=!0)}updateOptions(b){b&&(this.loop=b.loop??this.loop,this.maxDistance=b.maxDistance??this.maxDistance,this.useCustomAttenuation=b.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=b.rolloffFactor??this.rolloffFactor,this.refDistance=b.refDistance??this.refDistance,this.distanceModel=b.distanceModel??this.distanceModel,this._playbackRate=b.playbackRate??this._playbackRate,this._length=b.length??void 0,this.spatialSound=b.spatialSound??this._spatialSound,this._setOffset(b.offset??void 0),this.setVolume(b.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var b;null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&vn.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??vn.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var b;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(b=this._soundPanner)||void 0===b||b.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var b;null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(b){var n;null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(b),this._isOutputConnected=!0)}setDirectionalCone(b,n,i){n<b?K.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=b,this._coneOuterAngle=n,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(b){if(b!=this._coneInnerAngle){var n;if(this._coneOuterAngle<b)return void K.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b,null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(b){if(b!=this._coneOuterAngle){var n;if(b<this._coneInnerAngle)return void K.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b,null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(b){var n;b.equals(this._position)||(this._position.L(b),null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(b){var n;this._localDirection=b,null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const b=this._connectedTransformNode.getWorldMatrix(),n=V.On.TransformNormal(this._localDirection,b);n.normalize(),this._soundPanner.orientationX.value=n.x,this._soundPanner.orientationY.value=n.y,this._soundPanner.orientationZ.value=n.z}updateDistanceFromListener(){var b;if(null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const b=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.un(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,b,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(b){this._customAttenuationFunction=b}play(b,n,i){var e;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(e=vn.b.audioEngine)&&void 0!==e&&e.audioContext)try{var V,Q;this._clearTimeoutsAndObservers();let e=b?(null===(V=vn.b.audioEngine)||void 0===V?void 0:V.audioContext.currentTime)+b:null===(Q=vn.b.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=vn.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const b=()=>{var i;if(null!==(i=vn.b.audioEngine)&&void 0!==i&&i.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=n??0;const i=this._htmlAudioElement.play();void 0!==i&&i.catch((()=>{var n,i;(null===(n=vn.b.audioEngine)||void 0===n||n.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(i=vn.b.audioEngine)||void 0===i?void 0:i.onAudioUnlockedObservable.addOnce((()=>{b()})))}))}else{var e;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(e=vn.b.audioEngine)||void 0===e?void 0:e.onAudioUnlockedObservable.addOnce((()=>{b()}))}};b()}}else{var U;const V=()=>{var V;if(null!==(V=vn.b.audioEngine)&&void 0!==V&&V.audioContext){var Q;if(i=i||this._length,void 0!==n&&this._setOffset(n),this._soundSource){const b=this._soundSource;b.onended=()=>{b.disconnect()}}if(this._soundSource=null===(Q=vn.b.audioEngine)||void 0===Q?void 0:Q.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var U;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==n&&(this._soundSource.loopStart=n),void 0!==i&&(this._soundSource.loopEnd=(0|n)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},e=b?(null===(U=vn.b.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+b:vn.b.audioEngine.audioContext.currentTime;const V=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(e,V,this.loop?void 0:i)}}};"suspended"===(null===(U=vn.b.audioEngine)||void 0===U?void 0:U.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var b;"suspended"===(null===(b=vn.b.audioEngine)||void 0===b?void 0:b.audioContext.state)?(vn.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=vn.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{V()})))):V()}),500):V()}this._startTime=e,this.isPlaying=!0,this.isPaused=!1}catch(Y){K.b.Error("Error while trying to play audio: "+this.name+", "+Y.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(b){var n;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var i;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(i=this._streamingSource)||void 0===i||i.disconnect();this.isPlaying=!1}else if(null!==(n=vn.b.audioEngine)&&void 0!==n&&n.audioContext&&this._soundSource){const n=b?vn.b.audioEngine.audioContext.currentTime+b:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(n)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var n;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(n=this._streamingSource)||void 0===n||n.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(b=vn.b.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=vn.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(b,n){var i;null!==(i=vn.b.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._soundGain&&(n&&vn.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(vn.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,vn.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(b,vn.b.audioEngine.audioContext.currentTime+n)):this._soundGain.gain.value=b),this._volume=b}setPlaybackRate(b){this._playbackRate=b,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(b){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=b,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=b=>this._onRegisterAfterWorldMatrixUpdate(b),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(b){var n;if(b.getBoundingInfo){const n=b.getBoundingInfo();this.setPosition(n.boundingSphere.centerWorld)}else this.setPosition(b.absolutePosition);null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const b=()=>{(0,pn.f)((()=>this._isReadyToPlay),(()=>{i._audioBuffer=this.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play(0,this._offset,this._length)}),void 0,300)},n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},i=new fn(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&i.setAttenuationFunction(this._customAttenuationFunction),i.setPosition(this._position),i.setPlaybackRate(this._playbackRate),b(),i}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const b={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(b.connectedMeshId=this._connectedTransformNode.id),b.position=this._position.ye(),b.refDistance=this.refDistance,b.distanceModel=this.distanceModel,b.isDirectional=this._isDirectional,b.localDirectionToMesh=this._localDirection.ye(),b.coneInnerAngle=this._coneInnerAngle,b.coneOuterAngle=this._coneOuterAngle,b.coneOuterGain=this._coneOuterGain),b}static Parse(b,n,i,e){const Q=b.name;let U;U=b.url?i+b.url:i+Q;const Y={autoplay:b.autoplay,loop:b.loop,volume:b.volume,spatialSound:b.spatialSound,maxDistance:b.maxDistance,rolloffFactor:b.rolloffFactor,refDistance:b.refDistance,distanceModel:b.distanceModel,playbackRate:b.playbackRate};let L;if(e){const b=()=>{(0,pn.f)((()=>e._isReadyToPlay),(()=>{L._audioBuffer=e.getAudioBuffer(),L._isReadyToPlay=!0,L.autoplay&&L.play(0,L._offset,L._length)}),void 0,300)};L=new fn(Q,new ArrayBuffer(0),n,null,Y),b()}else L=new fn(Q,U,n,(()=>{n.removePendingData(L)}),Y),n.addPendingData(L);if(b.position){const n=V.On.jn(b.position);L.setPosition(n)}if(b.isDirectional&&(L.setDirectionalCone(b.coneInnerAngle||360,b.coneOuterAngle||360,b.coneOuterGain||0),b.localDirectionToMesh)){const n=V.On.jn(b.localDirectionToMesh);L.setLocalDirectionToMesh(n)}if(b.connectedMeshId){const i=n.getMeshById(b.connectedMeshId);i&&L.attachToMesh(i)}return b.metadata&&(L.metadata=b.metadata),L}_setOffset(b){this._offset!==b&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=b)}_clearTimeoutsAndObservers(){var b;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(b=vn.b.audioEngine)||void 0===b||b.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}fn._SceneComponentInitialization=b=>{throw(0,ln.e)("AudioSceneComponent")},(0,Mb.i)("BABYLON.Sound",fn);class Fn{constructor(b,n,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],n.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=b,this._weights=i;let e=0;for(const Q of i)e+=Q;const V=e>0?1/e:0;for(let Q=0;Q<this._weights.length;Q++)this._weights[Q]*=V;this._sounds=n;for(const Q of this._sounds)Q.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(b){if(b!==this._coneInnerAngle){if(this._coneOuterAngle<b)return void K.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b;for(const n of this._sounds)n.directionalConeInnerAngle=b}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(b){if(b!==this._coneOuterAngle){if(b<this._coneInnerAngle)return void K.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b;for(const n of this._sounds)n.directionalConeOuterAngle=b}}get volume(){return this._volume}set volume(b){if(b!==this._volume)for(const n of this._sounds)n.setVolume(b)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(b){if(!this.isPaused){this.stop();const b=Math.random();let n=0;for(let i=0;i<this._weights.length;i++)if(n+=this._weights[i],b<=n){this._currentIndex=i;break}}const n=this._sounds[this._currentIndex??0];n.isReady()?n.play(0,this.isPaused?void 0:b):n.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class bi{constructor(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(b=b||z.d.LastCreatedScene)&&(this._scene=b,this.soundCollection=[],this._options=n,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var b;null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&vn.b.audioEngine.audioContext&&(this._outputAudioNode=vn.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(vn.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(vn.b.audioEngine&&vn.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(b){var n;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._outputAudioNode&&b.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==b.soundTrackId&&(-1===b.soundTrackId?this._scene.mainSoundTrack.removeSound(b):this._scene.soundTracks&&this._scene.soundTracks[b.soundTrackId].removeSound(b)),this.soundCollection.push(b),b.soundTrackId=this.id}removeSound(b){const n=this.soundCollection.indexOf(b);-1!==n&&this.soundCollection.splice(n,1)}setVolume(b){var n;null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=b)}switchPanningModelToHRTF(){var b;if(null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio)for(let n=0;n<this.soundCollection.length;n++)this.soundCollection[n].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var b;if(null!==(b=vn.b.audioEngine)&&void 0!==b&&b.canUseWebAudio)for(let n=0;n<this.soundCollection.length;n++)this.soundCollection[n].switchPanningModelToEqualPower()}connectToAnalyser(b){var n;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=b,null!==(n=vn.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,vn.b.audioEngine.masterGain))}}var ni=i(12039),ii=i(12005),ei=i(11616);vn.b.AudioEngineFactory=(b,n,i)=>new Vi(b,n,i);class Vi{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new mb.e,this.onAudioLockedObservable=new mb.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ei.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const e=document.createElement("audio");this._hostElement=b,this._audioContext=n,this._audioDestination=i;try{e&&e.canPlayType&&(e.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||e.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(V){}try{e&&e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(V){}}lock(){this._triggerSuspendedState()}unlock(){var b,n;if("running"===(null===(b=this._audioContext)||void 0===b?void 0:b.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(n=this._audioContext)||void 0===n||n.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{K.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var b;null===(b=this._audioContext)||void 0===b||b.addEventListener("statechange",(()=>{var b;this.unlocked&&"running"!==(null===(b=this._audioContext)||void 0===b?void 0:b.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var b;return null!==(b=this._audioContext)&&void 0!==b&&b.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(b){this.canUseWebAudio=!1,K.b.Error("Web Audio: "+b.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(b){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const b=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",n=document.createElement("style");n.appendChild(document.createTextNode(b)),document.getElementsByTagName("head")[0].appendChild(n),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var b;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(b=this._audioContext)||void 0===b||b.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(b){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=b)}connectToAnalyser(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=b,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Qi=i(11628);(0,i(13187).f)(ni.c.NAME_AUDIO,((b,n,i,e)=>{let V,Q=[];if(i.DZ=i.DZ||[],void 0!==b.DZ&&null!==b.DZ)for(let Y=0,L=b.DZ.length;Y<L;Y++){var U;const L=b.DZ[Y];null!==(U=vn.b.audioEngine)&&void 0!==U&&U.canUseWebAudio?(L.url||(L.url=L.name),Q[L.url]?i.DZ.push(fn.Parse(L,n,e,Q[L.url])):(V=fn.Parse(L,n,e),Q[L.url]=V,i.DZ.push(V))):i.DZ.push(new fn(L.name,null,n))}Q=[]})),Object.defineProperty(ii.b.prototype,"mainSoundTrack",{get:function(){let b=this._getComponent(ni.c.NAME_AUDIO);return b||(b=new Ui(this),this.o(b)),this._mainSoundTrack||(this._mainSoundTrack=new bi(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ii.b.prototype.getSoundByName=function(b){let n;for(n=0;n<this.mainSoundTrack.soundCollection.length;n++)if(this.mainSoundTrack.soundCollection[n].name===b)return this.mainSoundTrack.soundCollection[n];if(this.soundTracks)for(let i=0;i<this.soundTracks.length;i++)for(n=0;n<this.soundTracks[i].soundCollection.length;n++)if(this.soundTracks[i].soundCollection[n].name===b)return this.soundTracks[i].soundCollection[n];return null},Object.defineProperty(ii.b.prototype,"audioEnabled",{get:function(){let b=this._getComponent(ni.c.NAME_AUDIO);return b||(b=new Ui(this),this.o(b)),b.audioEnabled},set:function(b){let n=this._getComponent(ni.c.NAME_AUDIO);n||(n=new Ui(this),this.o(n)),b?n.enableAudio():n.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ii.b.prototype,"headphone",{get:function(){let b=this._getComponent(ni.c.NAME_AUDIO);return b||(b=new Ui(this),this.o(b)),b.headphone},set:function(b){let n=this._getComponent(ni.c.NAME_AUDIO);n||(n=new Ui(this),this.o(n)),b?n.switchAudioModeForHeadphones():n.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ii.b.prototype,"audioListenerPositionProvider",{get:function(){let b=this._getComponent(ni.c.NAME_AUDIO);return b||(b=new Ui(this),this.o(b)),b.audioListenerPositionProvider},set:function(b){let n=this._getComponent(ni.c.NAME_AUDIO);if(n||(n=new Ui(this),this.o(n)),b&&"function"!==typeof b)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");n.audioListenerPositionProvider=b},enumerable:!0,configurable:!0}),Object.defineProperty(ii.b.prototype,"audioListenerRotationProvider",{get:function(){let b=this._getComponent(ni.c.NAME_AUDIO);return b||(b=new Ui(this),this.o(b)),b.audioListenerRotationProvider},set:function(b){let n=this._getComponent(ni.c.NAME_AUDIO);if(n||(n=new Ui(this),this.o(n)),b&&"function"!==typeof b)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");n.audioListenerRotationProvider=b},enumerable:!0,configurable:!0}),Object.defineProperty(ii.b.prototype,"audioPositioningRefreshRate",{get:function(){let b=this._getComponent(ni.c.NAME_AUDIO);return b||(b=new Ui(this),this.o(b)),b.audioPositioningRefreshRate},set:function(b){let n=this._getComponent(ni.c.NAME_AUDIO);n||(n=new Ui(this),this.o(n)),n.audioPositioningRefreshRate=b},enumerable:!0,configurable:!0});class Ui{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(b){this.name=ni.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new V.On,this._cachedCameraPosition=new V.On,this._lastCheck=0,this._invertMatrixTemp=new V.Matrix,this._cameraDirectionTemp=new V.On,(b=b||z.d.LastCreatedScene)&&(this.dn=b,b.soundTracks=[],b.DZ=[])}register(){this.dn._afterRenderStage.registerStep(ni.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(b){if(b.DZ=[],this.dn.soundTracks)for(let n=0;n<this.dn.soundTracks.length;n++){const i=this.dn.soundTracks[n];for(let n=0;n<i.soundCollection.length;n++)b.DZ.push(i.soundCollection[n].serialize())}}addFromContainer(b){if(b.DZ)for(const n of b.DZ)n.play(),n.autoplay=!0,this.dn.mainSoundTrack.addSound(n)}removeFromContainer(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(b.DZ)for(const i of b.DZ)i.stop(),i.autoplay=!1,this.dn.mainSoundTrack.removeSound(i),n&&i.dispose()}dispose(){const b=this.dn;if(b._mainSoundTrack&&b.mainSoundTrack.dispose(),b.soundTracks)for(let n=0;n<b.soundTracks.length;n++)b.soundTracks[n].dispose()}disableAudio(){const b=this.dn;let n;for(this._audioEnabled=!1,vn.b.audioEngine&&vn.b.audioEngine.audioContext&&vn.b.audioEngine.audioContext.suspend(),n=0;n<b.mainSoundTrack.soundCollection.length;n++)b.mainSoundTrack.soundCollection[n].pause();if(b.soundTracks)for(n=0;n<b.soundTracks.length;n++)for(let i=0;i<b.soundTracks[n].soundCollection.length;i++)b.soundTracks[n].soundCollection[i].pause()}enableAudio(){const b=this.dn;let n;for(this._audioEnabled=!0,vn.b.audioEngine&&vn.b.audioEngine.audioContext&&vn.b.audioEngine.audioContext.resume(),n=0;n<b.mainSoundTrack.soundCollection.length;n++)b.mainSoundTrack.soundCollection[n].isPaused&&b.mainSoundTrack.soundCollection[n].play();if(b.soundTracks)for(n=0;n<b.soundTracks.length;n++)for(let i=0;i<b.soundTracks[n].soundCollection.length;i++)b.soundTracks[n].soundCollection[i].isPaused&&b.soundTracks[n].soundCollection[i].play()}switchAudioModeForHeadphones(){const b=this.dn;if(this._headphone=!0,b.mainSoundTrack.switchPanningModelToHRTF(),b.soundTracks)for(let n=0;n<b.soundTracks.length;n++)b.soundTracks[n].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const b=this.dn;if(this._headphone=!1,b.mainSoundTrack.switchPanningModelToEqualPower(),b.soundTracks)for(let n=0;n<b.soundTracks.length;n++)b.soundTracks[n].switchPanningModelToEqualPower()}_afterRender(){const b=Qi.b.Now;if(this._lastCheck&&b-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=b;const n=this.dn;if(!this._audioEnabled||!n._mainSoundTrack||!n.soundTracks||0===n._mainSoundTrack.soundCollection.length&&1===n.soundTracks.length)return;const i=vn.b.audioEngine;if(i&&i.audioContext){let b,e=n.activeCamera;if(n.activeCameras&&n.activeCameras.length>0&&(e=n.activeCameras[0]),this.audioListenerPositionProvider){const b=this.audioListenerPositionProvider();i.audioContext.listener.setPosition(b.x||0,b.y||0,b.z||0)}else e?this._cachedCameraPosition.equals(e.globalPosition)||(this._cachedCameraPosition.L(e.globalPosition),i.audioContext.listener.setPosition(e.globalPosition.x,e.globalPosition.y,e.globalPosition.z)):i.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const b=this.audioListenerRotationProvider();i.audioContext.listener.setOrientation(b.x||0,b.y||0,b.z||0,0,1,0)}else e?(e.rigCameras&&e.rigCameras.length>0&&(e=e.rigCameras[0]),e.getViewMatrix().invertToRef(this._invertMatrixTemp),V.On.TransformNormalToRef(Ui._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.L(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):i.audioContext.listener.setOrientation(0,0,0,0,1,0);for(b=0;b<n.mainSoundTrack.soundCollection.length;b++){const i=n.mainSoundTrack.soundCollection[b];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(n.soundTracks)for(b=0;b<n.soundTracks.length;b++)for(let i=0;i<n.soundTracks[b].soundCollection.length;i++){const e=n.soundTracks[b].soundCollection[i];e.useCustomAttenuation&&e.updateDistanceFromListener()}}}}Ui._CameraDirection=new V.On(0,0,-1),fn._SceneComponentInitialization=b=>{let n=b._getComponent(ni.c.NAME_AUDIO);n||(n=new Ui(b),b.o(n))};const Yi="MSFT_audio_emitter";class Li{constructor(b){this.name=Yi,this._loader=b,this.enabled=this._loader.isExtensionUsed(Yi)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const b=this._loader.Ne.extensions;if(b&&b[this.name]){const n=b[this.name];this._clips=n.clips,this._emitters=n.emitters,X.Assign(this._clips),X.Assign(this._emitters)}}loadSceneAsync(b,n){return P.LoadExtensionAsync(b,n,this.name,(async(i,e)=>{const V=new Array;V.push(this._loader.loadSceneAsync(b,n));for(const b of e.emitters){const n=X.Get(`${i}/emitters`,this._emitters,b);if(void 0!=n.refDistance||void 0!=n.maxDistance||void 0!=n.rolloffFactor||void 0!=n.distanceModel||void 0!=n.innerAngle||void 0!=n.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);V.push(this._loadEmitterAsync(`${i}/emitters/${n.index}`,n))}await Promise.all(V)}))}loadNodeAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(b,e)=>{const Q=new Array,Y=await this._loader.loadNodeAsync(b,n,(n=>{for(const i of e.emitters){const e=X.Get(`${b}/emitters`,this._emitters,i);Q.push(this._loadEmitterAsync(`${b}/emitters/${e.index}`,e).then((()=>{for(const b of e._babylonSounds)b.attachToMesh(n),void 0==e.innerAngle&&void 0==e.outerAngle||(b.setLocalDirectionToMesh(V.On.Forward()),b.setDirectionalCone(2*U.Tools.ToDegrees(void 0==e.innerAngle?Math.PI:e.innerAngle),2*U.Tools.ToDegrees(void 0==e.outerAngle?Math.PI:e.outerAngle),0))})))}i(n)}));return await Promise.all(Q),Y}))}loadAnimationAsync(b,n){return P.LoadExtensionAsync(b,n,this.name,(async(i,e)=>{const V=await this._loader.loadAnimationAsync(b,n),Q=new Array;X.Assign(e.events);for(const U of e.events)Q.push(this._loadAnimationEventAsync(`${i}/events/${U.index}`,b,n,U,V));return await Promise.all(Q),V}))}_loadClipAsync(b,n){if(n._objectURL)return n._objectURL;let i;if(n.uri)i=this._loader.loadUriAsync(b,n,n.uri);else{const e=X.Get(`${b}/bufferView`,this._loader.Ne.bufferViews,n.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e)}return n._objectURL=i.then((b=>URL.createObjectURL(new Blob([b],{type:n.mimeType})))),n._objectURL}_loadEmitterAsync(b,n){if(n._babylonSounds=n._babylonSounds||[],!n._babylonData){const b=new Array,i=n.name||`emitter${n.index}`,e={loop:!1,autoplay:!1,volume:void 0==n.volume?1:n.volume};for(let Q=0;Q<n.clips.length;Q++){const V=`/extensions/${this.name}/clips`,U=X.Get(V,this._clips,n.clips[Q].clip);b.push(this._loadClipAsync(`${V}/${n.clips[Q].clip}`,U).then((b=>{const V=n._babylonSounds[Q]=new fn(i,b,this._loader.babylonScene,null,e);V.refDistance=n.refDistance||1,V.maxDistance=n.maxDistance||256,V.rolloffFactor=n.rolloffFactor||1,V.distanceModel=n.distanceModel||"exponential"})))}const V=Promise.all(b).then((()=>{const b=n.clips.map((b=>b.weight||1)),i=new Fn(n.loop||!1,n._babylonSounds,b);n.innerAngle&&(i.directionalConeInnerAngle=2*U.Tools.ToDegrees(n.innerAngle)),n.outerAngle&&(i.directionalConeOuterAngle=2*U.Tools.ToDegrees(n.outerAngle)),n.volume&&(i.volume=n.volume),n._babylonData.sound=i}));n._babylonData={loaded:V}}return n._babylonData.loaded}_getEventAction(b,n,i,e,V){switch(i){case"play":return b=>{const i=(V||0)+(b-e);n.play(i)};case"stop":return()=>{n.stop()};case"pause":return()=>{n.pause()};default:throw new Error(`${b}: Unsupported action ${i}`)}}_loadAnimationEventAsync(b,n,i,e,V){if(0==V.targetedAnimations.length)return Promise.resolve();const Q=V.targetedAnimations[0],U=e.Un,Y=X.Get(`/extensions/${this.name}/emitters`,this._emitters,U);return this._loadEmitterAsync(b,Y).then((()=>{const n=Y._babylonData.sound;if(n){const i=new Hn(e.time,this._getEventAction(b,n,e.action,e.time,e.startOffset));Q.animation.addEvent(i),V.onAnimationGroupEndObservable.add((()=>{n.stop()})),V.onAnimationGroupPauseObservable.add((()=>{n.pause()}))}}))}}J(Yi),W(Yi,!0,(b=>new Li(b)));const Bi="MSFT_lod";class me{constructor(b){var n;this.name=Bi,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new mb.e,this.onMaterialLODsLoadedObservable=new mb.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=b,this.maxLODsToLoad=(null===(n=this._loader.parent.extensionOptions[Bi])||void 0===n?void 0:n.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Bi)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let b=0;b<this._nodePromiseLODs.length;b++){const n=Promise.all(this._nodePromiseLODs[b]).then((()=>{0!==b&&(this._loader.endPerformanceCounter(`Node LOD ${b}`),this._loader.log(`Loaded node LOD ${b}`)),this.onNodeLODsLoadedObservable.notifyObservers(b),b!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${b+1}`),this._loadBufferLOD(this._nodeBufferLODs,b+1),this._nodeSignalLODs[b]&&this._nodeSignalLODs[b].resolve())}));this._loader._completePromises.push(n)}for(let b=0;b<this._materialPromiseLODs.length;b++){const n=Promise.all(this._materialPromiseLODs[b]).then((()=>{0!==b&&(this._loader.endPerformanceCounter(`Material LOD ${b}`),this._loader.log(`Loaded material LOD ${b}`)),this.onMaterialLODsLoadedObservable.notifyObservers(b),b!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${b+1}`),this._loadBufferLOD(this._materialBufferLODs,b+1),this._materialSignalLODs[b]&&this._materialSignalLODs[b].resolve())}));this._loader._completePromises.push(n)}}loadSceneAsync(b,n){const i=this._loader.loadSceneAsync(b,n);return this._loadBufferLOD(this._bufferLODs,0),i}loadNodeAsync(b,n,i){return P.LoadExtensionAsync(b,n,this.name,(async(b,V)=>{let Q;const U=this._getLODs(b,n,this._loader.Ne.nodes,V.ids);this._loader.logOpen(`${b}`);for(let n=0;n<U.length;n++){const b=U[n];0!==n&&(this._nodeIndexLOD=n,this._nodeSignalLODs[n]=this._nodeSignalLODs[n]||new e);const V=b=>{i(b),b.RY(!1)},Y=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,V).then((b=>{if(0!==n){const b=U[n-1];b._babylonTransformNode&&(this._disposeTransformNode(b._babylonTransformNode),delete b._babylonTransformNode)}return b.RY(!0),b}));this._nodePromiseLODs[n]=this._nodePromiseLODs[n]||[],0===n?Q=Y:(this._nodeIndexLOD=null,this._nodePromiseLODs[n].push(Y))}return this._loader.logClose(),await Q}))}_loadMaterialAsync(b,n,i,e,V){return this._nodeIndexLOD?null:P.LoadExtensionAsync(b,n,this.name,(async(b,Q)=>{let U;const Y=this._getLODs(b,n,this._loader.Ne.materials,Q.ids);this._loader.logOpen(`${b}`);for(let n=0;n<Y.length;n++){const b=Y[n];0!==n&&(this._materialIndexLOD=n);const Q=this._loader._loadMaterialAsync(`/materials/${b.index}`,b,i,e,(b=>{0===n&&V(b)})).then((b=>{if(0!==n){V(b);const i=Y[n-1]._data;i[e]&&(this._disposeMaterials([i[e].babylonMaterial]),delete i[e])}return b}));this._materialPromiseLODs[n]=this._materialPromiseLODs[n]||[],0===n?U=Q:(this._materialIndexLOD=null,this._materialPromiseLODs[n].push(Q))}return this._loader.logClose(),await U}))}_loadUriAsync(b,n,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const V=this._nodeIndexLOD-1;return this._nodeSignalLODs[V]=this._nodeSignalLODs[V]||new e,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(b,n,i)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const V=this._materialIndexLOD-1;return this._materialSignalLODs[V]=this._materialSignalLODs[V]||new e,this._materialSignalLODs[V].promise.then((async()=>await this._loader.loadUriAsync(b,n,i)))}return null}loadBufferAsync(b,n,i,V){if(this._loader.parent.useRangeRequests&&!n.uri){if(!this._loader.bin)throw new Error(`${b}: Uri is missing or the binary glTF is missing its binary chunk`);const n=async(b,n)=>{const Q=i,U=Q+V-1;let Y=b[n];return Y?(Y.start=Math.min(Y.start,Q),Y.end=Math.max(Y.end,U)):(Y={start:Q,end:U,loaded:new e},b[n]=Y),await Y.loaded.promise.then((b=>new Uint8Array(b.buffer,b.byteOffset+i-Y.start,V)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?n(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?n(this._materialBufferLODs,this._materialIndexLOD):n(this._bufferLODs,0)}return null}_loadBufferLOD(b,n){const i=b[n];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then((b=>{i.loaded.resolve(b)}),(b=>{i.loaded.reject(b)})))}_getLODs(b,n,i,e){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const V=[];for(let Q=e.length-1;Q>=0;Q--)if(V.push(X.Get(`${b}/ids/${e[Q]}`,i,e[Q])),V.length===this.maxLODsToLoad)return V;return V.push(n),V}_disposeTransformNode(b){const n=[],i=b.material;i&&n.push(i);for(const V of b.getChildMeshes())V.material&&n.push(V.material);b.dispose();const e=n.filter((b=>this._loader.babylonScene.meshes.every((n=>n.material!=b))));this._disposeMaterials(e)}_disposeMaterials(b){const n={};for(const i of b){for(const b of i.getActiveTextures())n[b.uniqueId]=b;i.dispose()}for(const i in n)for(const b of this._loader.babylonScene.materials)b.hasTexture(n[i])&&delete n[i];for(const i in n)n[i].dispose()}}J(Bi),W(Bi,!0,(b=>new me(b)));const Ni="MSFT_minecraftMesh";class Zi{constructor(b){this.name=Ni,this._loader=b,this.enabled=this._loader.isExtensionUsed(Ni)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtraAsync(b,n,this.name,(async(e,V)=>{if(V){if(!(i instanceof d.c))throw new Error(`${e}: Material type not supported`);const V=this._loader.loadMaterialPropertiesAsync(b,n,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.Re=i.forceDepthWrite,i.twoSidedLighting=!0,await V}}))}}J(Ni),W(Ni,!0,(b=>new Zi(b)));const Ti="MSFT_sRGBFactors";class zi{constructor(b){this.name=Ti,this._loader=b,this.enabled=this._loader.isExtensionUsed(Ti)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,n,i){return P.LoadExtraAsync(b,n,this.name,(async(e,V)=>{if(V){if(!(i instanceof d.c))throw new Error(`${e}: Material type not supported`);const V=this._loader.loadMaterialPropertiesAsync(b,n,i),Q=i.ab().getEngine().useExactSrgbConversions;return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor,Q),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor,Q),await V}}))}}J(Ti),W(Ti,!0,(b=>new zi(b)));var Ki=i(13502);const Ii={};var Oi=i(13566),ui=i(13544),di=i(13504),Gi=i(13522);function oi(b,n){for(const i of b)for(const b of i.dataOutputs)if(b.uniqueId===n)return b;throw new Error("Could not find data out connection with unique id "+n)}function Mi(b,n){for(const i of b)if(i instanceof ui.d)for(const b of i.signalInputs)if(b.uniqueId===n)return b;throw new Error("Could not find signal in connection with unique id "+n)}async function ji(b,n){const e=await Promise.all(b.allBlocks.map((async b=>{const n=function(b){switch(b){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([i.e(78),i.e(79)]).then(i.bind(i,15031))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await i.e(80).then(i.bind(i,15034))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await i.e(81).then(i.bind(i,15038))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await i.e(82).then(i.bind(i,15042))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await i.e(83).then(i.bind(i,15046))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await i.e(84).then(i.bind(i,15048))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await i.e(85).then(i.bind(i,15057))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await i.e(86).then(i.bind(i,15062))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await i.e(87).then(i.bind(i,15065))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await i.e(90).then(i.bind(i,15096))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await i.e(90).then(i.bind(i,15096))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await i.e(90).then(i.bind(i,15096))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await i.e(90).then(i.bind(i,15096))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await i.e(95).then(i.bind(i,15104))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await i.e(96).then(i.bind(i,15113))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await i.e(97).then(i.bind(i,15118))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await i.e(98).then(i.bind(i,15121))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await i.e(99).then(i.bind(i,15128))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await i.e(100).then(i.bind(i,15133))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await i.e(101).then(i.bind(i,15141))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await i.e(102).then(i.bind(i,15146))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await i.e(103).then(i.bind(i,15149))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await i.e(104).then(i.bind(i,15158))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await i.e(105).then(i.bind(i,15161))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await i.e(106).then(i.bind(i,15167))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await i.e(107).then(i.bind(i,15171))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await i.e(108).then(i.bind(i,15180))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await i.e(109).then(i.bind(i,15189))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await i.e(110).then(i.bind(i,15193))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await i.e(111).then(i.bind(i,15202))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await i.e(112).then(i.bind(i,15208))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await i.e(113).then(i.bind(i,15217))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await i.e(92).then(i.bind(i,15221))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await i.e(114).then(i.bind(i,15228))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await i.e(115).then(i.bind(i,15237))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await i.e(116).then(i.bind(i,15246))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await i.e(93).then(i.bind(i,15253))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await i.e(88).then(i.bind(i,15074))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,15262))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await i.e(89).then(i.bind(i,15091))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await i.e(90).then(i.bind(i,15096))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await i.e(90).then(i.bind(i,15096))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await i.e(91).then(i.bind(i,15267))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await i.e(91).then(i.bind(i,15267))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await i.e(91).then(i.bind(i,15267))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await i.e(91).then(i.bind(i,15267))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await i.e(91).then(i.bind(i,15267))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await i.e(91).then(i.bind(i,15267))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await i.e(117).then(i.bind(i,15270))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await i.e(118).then(i.bind(i,15278))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await i.e(119).then(i.bind(i,15283))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await i.e(120).then(i.bind(i,15291))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await i.e(121).then(i.bind(i,15300))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await i.e(122).then(i.bind(i,15309))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await i.e(123).then(i.bind(i,15314))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await i.e(124).then(i.bind(i,15320))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await i.e(125).then(i.bind(i,15324))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await i.e(126).then(i.bind(i,15329))).FlowGraphDataSwitchBlock;default:if(Ii[b])return Ii[b];throw new Error(`Unknown block name ${b}`)}}(b.className);return await n()})));return function(b,n,i){const e=n.coordinator.createGraph(),V=[],Q=n.valueParseFunction??di.b;for(let U=0;U<b.allBlocks.length;U++){const Y=Di(b.allBlocks[U],{dn:n.coordinator.config.dn,pathConverter:n.pathConverter,assetsContainer:n.coordinator.config.dn,valueParseFunction:Q},i[U]);V.push(Y),Y instanceof Oi.c&&e.addEventBlock(Y)}for(const U of V){for(const b of U.dataInputs)for(const n of b.connectedPointIds){const i=oi(V,n);b.connectTo(i)}if(U instanceof ui.d)for(const b of U.signalOutputs)for(const n of b.connectedPointIds){const i=Mi(V,n);b.connectTo(i)}}for(const U of b.executionContexts)ai(U,{graph:e,valueParseFunction:Q},b.rightHanded);return e}(b,n,e)}function ai(b,n,i){const e=n.graph.createContext();b.enableLogging&&(e.enableLogging=!0),e.treatDataAsRightHanded=i||!1;const V=n.valueParseFunction??di.b;e.uniqueId=b.uniqueId;const Q=e.ab();if(b._assetsContext){var U,Y,L,B,mb,N,Z,T,z,K;const n=b._assetsContext,i={meshes:null===(U=n.meshes)||void 0===U?void 0:U.map((b=>Q.getMeshById(b))),lights:null===(Y=n.lights)||void 0===Y?void 0:Y.map((b=>Q.getLightByName(b))),cameras:null===(L=n.cameras)||void 0===L?void 0:L.map((b=>Q.getCameraByName(b))),materials:null===(B=n.materials)||void 0===B?void 0:B.map((b=>Q.getMaterialById(b))),textures:null===(mb=n.textures)||void 0===mb?void 0:mb.map((b=>Q.getTextureByName(b))),animations:null===(N=n.animations)||void 0===N?void 0:N.map((b=>Q.animations.find((n=>n.name===b)))),skeletons:null===(Z=n.skeletons)||void 0===Z?void 0:Z.map((b=>Q.getSkeletonByName(b))),cN:null===(T=n.cN)||void 0===T?void 0:T.map((b=>Q.getParticleSystemById(b))),animationGroups:null===(z=n.animationGroups)||void 0===z?void 0:z.map((b=>Q.getAnimationGroupByName(b))),transformNodes:null===(K=n.transformNodes)||void 0===K?void 0:K.map((b=>Q.getTransformNodeById(b))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],DZ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};e.assetsContext=i}for(const I in b._userVariables){const n=V(I,b._userVariables,e.assetsContext,Q);e.userVariables[I]=n}for(const I in b._connectionValues){const n=V(I,b._connectionValues,e.assetsContext,Q);e._setConnectionValueByKey(I,n)}return e}function Di(b,n,i){const e={},V=n.valueParseFunction??di.b;if(b.config)for(const U in b.config)e[U]=V(U,b.config,n.assetsContainer||n.dn,n.dn);if((0,di.f)(b.className)){if(!n.pathConverter)throw new Error("Path converter is required for this block");e.pathConverter=n.pathConverter}const Q=new i(e);Q.uniqueId=b.uniqueId;for(let U=0;U<b.dataInputs.length;U++){const n=Q.getDataInput(b.dataInputs[U].name);if(!n)throw new Error("Could not find data input with name "+b.dataInputs[U].name+" in block "+b.className);n.deserialize(b.dataInputs[U])}for(let U=0;U<b.dataOutputs.length;U++){const n=Q.getDataOutput(b.dataOutputs[U].name);if(!n)throw new Error("Could not find data output with name "+b.dataOutputs[U].name+" in block "+b.className);n.deserialize(b.dataOutputs[U])}return Q.metadata=b.metadata,Q.deserialize&&Q.deserialize(b),Q}function xi(b){const[n,i]=b.split(":");return yi({op:n,extension:i})}function yi(b){var n;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=b.extension?null===(n=Ai[b.extension])||void 0===n?void 0:n[b.op]:Ei[b.op];if(!e&&(K.b.Warn(`No mapping found for operation ${b.op} and extension ${b.extension||"KHR_interactivity"}`),i)){const n={},i={flows:{}};if(b.inputValueSockets){n.values={};for(const i in b.inputValueSockets)n.values[i]={name:i}}return b.outputValueSockets&&(i.values={},Object.keys(b.outputValueSockets).forEach((b=>{i.values[b]={name:b}}))),{Bm:[],inputs:n,outputs:i}}return e}function si(b,n,i){Ai[n]||(Ai[n]={}),Ai[n][b]=i}const Ai={BABYLON:{"flow/log":{Bm:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ei={"event/onStart":{Bm:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Bm:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Bm:["FlowGraphSendCustomEventBlock"],extraProcessor(b,n,i,e,V){if("event/send"!==n.op||!b.configuration||1!==Object.keys(b.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Q=b.configuration.event.value[0];if("number"!==typeof Q)throw new Error("Event id should be a number");const U=e.arrays.events[Q],Y=V[0];return Y.config||(Y.config={}),Y.config.eventId=U.eventId,Y.config.eventData=U.eventData,V}},"event/receive":{Bm:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(b,n){var i;if(!b.configuration)return K.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const e=b.configuration.event;if(!e)return K.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const V=e.value[0];if("number"!==typeof V)return K.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(i=n.events)||void 0===i?void 0:i[V])?{valid:!0}:(K.b.Error(`Event with id ${V} not found`),{valid:!1,error:`Event with id ${V} not found`})},extraProcessor(b,n,i,e,V){if("event/receive"!==n.op||!b.configuration||1!==Object.keys(b.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Q=b.configuration.event.value[0];if("number"!==typeof Q)throw new Error("Event id should be a number");const U=e.arrays.events[Q],Y=V[0];return Y.config||(Y.config={}),Y.config.eventId=U.eventId,Y.config.eventData=U.eventData,V}},"math/e":Ci("FlowGraphEBlock"),"math/pi":Ci("FlowGraphPIBlock"),"math/inf":Ci("FlowGraphInfBlock"),"math/nan":Ci("FlowGraphNaNBlock"),"math/abs":Ci("FlowGraphAbsBlock"),"math/sign":Ci("FlowGraphSignBlock"),"math/trunc":Ci("FlowGraphTruncBlock"),"math/floor":Ci("FlowGraphFloorBlock"),"math/ceil":Ci("FlowGraphCeilBlock"),"math/round":{Bm:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V){var Q;return(Q=V[0]).config||(Q.config={}),V[0].config.roundHalfAwayFromZero=!0,V}},"math/fract":Ci("FlowGraphFractBlock"),"math/neg":Ci("FlowGraphNegationBlock"),"math/add":Ci("FlowGraphAddBlock",["a","b"],!0),"math/sub":Ci("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Bm:["FlowGraphMultiplyBlock"],extraProcessor(b,n,i,e,V){var Q;(Q=V[0]).config||(Q.config={}),V[0].config.useMatrixPerComponent=!0,V[0].config.preventIntegerFloatArithmetic=!0;let U=-1;return Object.keys(b.values||{}).find((n=>{var i;return void 0!==(null===(i=b.values)||void 0===i?void 0:i[n].type)&&(U=b.values[n].type,!0)})),-1!==U&&(V[0].config.type=e.arrays.types[U].flowGraphType),V},validation:b=>b.values?ti(b):{valid:!0}},"math/div":Ci("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Ci("FlowGraphModuloBlock",["a","b"]),"math/min":Ci("FlowGraphMinBlock",["a","b"]),"math/max":Ci("FlowGraphMaxBlock",["a","b"]),"math/clamp":Ci("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Ci("FlowGraphSaturateBlock"),"math/mix":Ci("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Ci("FlowGraphEqualityBlock",["a","b"]),"math/lt":Ci("FlowGraphLessThanBlock",["a","b"]),"math/le":Ci("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Ci("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Ci("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Ci("FlowGraphIsNaNBlock"),"math/isinf":Ci("FlowGraphIsInfBlock"),"math/select":{Bm:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Bm:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Ci("FlowGraphSinBlock"),"math/cos":Ci("FlowGraphCosBlock"),"math/tan":Ci("FlowGraphTanBlock"),"math/asin":Ci("FlowGraphASinBlock"),"math/acos":Ci("FlowGraphACosBlock"),"math/atan":Ci("FlowGraphATanBlock"),"math/atan2":Ci("FlowGraphATan2Block",["a","b"]),"math/sinh":Ci("FlowGraphSinhBlock"),"math/cosh":Ci("FlowGraphCoshBlock"),"math/tanh":Ci("FlowGraphTanhBlock"),"math/asinh":Ci("FlowGraphASinhBlock"),"math/acosh":Ci("FlowGraphACoshBlock"),"math/atanh":Ci("FlowGraphATanhBlock"),"math/exp":Ci("FlowGraphExponentialBlock"),"math/log":Ci("FlowGraphLogBlock"),"math/log2":Ci("FlowGraphLog2Block"),"math/log10":Ci("FlowGraphLog10Block"),"math/sqrt":Ci("FlowGraphSquareRootBlock"),"math/cbrt":Ci("FlowGraphCubeRootBlock"),"math/pow":Ci("FlowGraphPowerBlock",["a","b"]),"math/length":Ci("FlowGraphLengthBlock"),"math/normalize":Ci("FlowGraphNormalizeBlock"),"math/dot":Ci("FlowGraphDotBlock",["a","b"]),"math/cross":Ci("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Ci("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Ci("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Bm:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Bm:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Bm:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Bm:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Bm:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Bm:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Bm:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Ci("FlowGraphTransposeBlock"),"math/determinant":Ci("FlowGraphDeterminantBlock"),"math/inverse":Ci("FlowGraphInvertMatrixBlock"),"math/matmul":Ci("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Bm:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ge",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V,Q){const U=V[0].dataInputs.find((b=>"rotationQuaternion"===b.name));if(!U)throw new Error("Rotation quaternion input not found");return Q._connectionValues[U.uniqueId]&&(Q._connectionValues[U.uniqueId].type="Quaternion"),V}},"math/matDecompose":{Bm:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ge"}}}},"math/quatConjugate":Ci("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Bm:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V){var Q;return(Q=V[0]).config||(Q.config={}),V[0].config.type="Quaternion",V}},"math/quatAngleBetween":Ci("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Bm:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Ci("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Ci("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Bm:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V){var Q;return(Q=V[0]).config||(Q.config={}),V[0].config.inputIsColumnMajor=!0,V}},"math/extract2x2":{Bm:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Bm:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V){var Q;return(Q=V[0]).config||(Q.config={}),V[0].config.inputIsColumnMajor=!0,V}},"math/extract3x3":{Bm:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Bm:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V){var Q;return(Q=V[0]).config||(Q.config={}),V[0].config.inputIsColumnMajor=!0,V}},"math/extract4x4":{Bm:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Bm:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V,Q){var U,Y;(Y=V[0]).config||(Y.config={});const L=V[0].dataInputs[0];return V[0].config.valueType=(null===(U=Q._connectionValues[L.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",V}},"math/and":{Bm:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V,Q){var U,Y,L;(L=V[0]).config||(L.config={});const B=V[0].dataInputs[0],mb=V[0].dataInputs[1];return V[0].config.valueType=(null===(U=Q._connectionValues[B.uniqueId])||void 0===U?void 0:U.type)??(null===(Y=Q._connectionValues[mb.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",V}},"math/or":{Bm:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V,Q){var U,Y,L;(L=V[0]).config||(L.config={});const B=V[0].dataInputs[0],mb=V[0].dataInputs[1];return V[0].config.valueType=(null===(U=Q._connectionValues[B.uniqueId])||void 0===U?void 0:U.type)??(null===(Y=Q._connectionValues[mb.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",V}},"math/xor":{Bm:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,n,i,e,V,Q){var U,Y,L;(L=V[0]).config||(L.config={});const B=V[0].dataInputs[0],mb=V[0].dataInputs[1];return V[0].config.valueType=(null===(U=Q._connectionValues[B.uniqueId])||void 0===U?void 0:U.type)??(null===(Y=Q._connectionValues[mb.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",V}},"math/asr":Ci("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Ci("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Ci("FlowGraphLeadingZerosBlock"),"math/ctz":Ci("FlowGraphTrailingZerosBlock"),"math/popcnt":Ci("FlowGraphOneBitsCounterBlock"),"math/rad":Ci("FlowGraphDegToRadBlock"),"math/deg":Ci("FlowGraphRadToDegBlock"),"type/boolToInt":Ci("FlowGraphBooleanToInt"),"type/boolToFloat":Ci("FlowGraphBooleanToFloat"),"type/intToBool":Ci("FlowGraphIntToBoolean"),"type/intToFloat":Ci("FlowGraphIntToFloat"),"type/floatToInt":Ci("FlowGraphFloatToInt"),"type/floatToBool":Ci("FlowGraphFloatToBoolean"),"flow/sequence":{Bm:["FlowGraphSequenceBlock"],extraProcessor(b,n,i,e,V){const Q=V[0];return Q.config||(Q.config={}),Q.config.outputSignalCount=Object.keys(b.flows||[]).length,Q.signalOutputs.forEach(((b,n)=>{b.name="out_"+n})),V}},"flow/branch":{Bm:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Bm:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(b){if(b.configuration&&b.configuration.cases){const n=b.configuration.cases.value;if(!n.every((b=>"number"===typeof b&&/^-?\d+$/.test(b.toString()))))return K.b.Warn("Switch cases should be integers. Using empty array instead."),b.configuration.cases.value=[],{valid:!0};const i=new Set(n);b.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(b,n,i,e,V){if("flow/switch"!==n.op||!b.flows||0===Object.keys(b.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return V[0].signalOutputs.forEach((b=>{"default"!==b.name&&(b.name="out_"+b.name)})),V}},"flow/while":{Bm:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Bm:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(b,n,i,e,V){const Q=V[0];return Q.config||(Q.config={}),Q.config.incrementIndexWhenLoopDone=!0,V}},"flow/doN":{Bm:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Bm:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(b,n,i,e,V){if("flow/multiGate"!==n.op||!b.flows||0===Object.keys(b.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Q=V[0];return Q.config||(Q.config={}),Q.config.outputSignalCount=Object.keys(b.flows).length,Q.signalOutputs.forEach(((b,n)=>{b.name="out_"+n})),V}},"flow/waitAll":{Bm:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(b){var n,i;return"number"!==typeof(null===(n=b.configuration)||void 0===n||null===(i=n.inputFlows)||void 0===i?void 0:i.value[0])&&(b.configuration=b.configuration||{inputFlows:{value:[0]}},b.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Bm:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Bm:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Bm:["FlowGraphCancelDelayBlock"]},"variable/get":{Bm:["FlowGraphGetVariableBlock"],validation(b){var n,i;return null!==(n=b.configuration)&&void 0!==n&&null!==(i=n.variable)&&void 0!==i&&i.value?{valid:!0}:(K.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(b,n)=>[n.getVariableName(b[0])]}}},"variable/set":{Bm:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(b,n)=>[n.getVariableName(b[0])]}}},"variable/setMultiple":{Bm:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(b,n)=>[b[0].map((b=>n.getVariableName(b)))]}},extraProcessor:(b,n,i,e,V)=>(V[0].dataInputs.forEach((b=>{b.name=e.getVariableName(+b.name)})),V)},"variable/interpolate":{Bm:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(b,n)=>[n.getVariableName(b[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:b=>!0===b[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",yi:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",yi:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",yi:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",yi:"FlowGraphPlayAnimationBlock"},out:{name:"out",yi:"FlowGraphPlayAnimationBlock"},done:{name:"done",yi:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(b,n,i,e,V){var Q,U,Y;const L=V[0],B=null===(Q=b.configuration)||void 0===Q?void 0:Q.variable.value[0];if("number"!==typeof B)throw K.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const mb=e.arrays.staticVariables[B];"undefined"===typeof L.config.animationType.value&&(e.arrays.staticVariables,L.config.animationType.value=(0,Gi.H)(mb.type));const N=V[4];return N.config||(N.config={}),(U=N.config).variable||(U.variable={}),N.config.variable.value=e.getVariableName(B),(Y=V[3]).config||(Y.config={}),V}},"pointer/get":{Bm:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",yi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",yi:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,n,i,e,V)=>(V.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className&&(b.config||(b.config={}),b.config.outputValue=!0)})),V)},"pointer/set":{Bm:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",yi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",yi:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,n,i,e,V)=>(V.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className&&(b.config||(b.config={}),b.config.outputValue=!0)})),V)},"pointer/interpolate":{Bm:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",yi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",yi:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",yi:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",yi:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",yi:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",yi:"FlowGraphPlayAnimationBlock"},out:{name:"out",yi:"FlowGraphPlayAnimationBlock"},done:{name:"done",yi:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,n,i,e,V)=>(V.forEach((n=>{"FlowGraphJsonPointerParserBlock"===n.className?(n.config||(n.config={}),n.config.outputValue=!0):"FlowGraphInterpolationBlock"===n.className&&(n.config||(n.config={}),Object.keys(b.values||[]).forEach((i=>{var V;const Q=null===(V=b.values)||void 0===V?void 0:V[i];if("value"===i&&Q){const b=Q.type;void 0!==b&&(n.config.animationType=e.arrays.types[b].flowGraphType)}})))})),V)},"animation/start":{Bm:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",yi:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(b,n)=>[b[0]*n._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(b,n)=>[b[0]*n._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,n,i,e,V,Q,U){const Y=V[V.length-1];return Y.config||(Y.config={}),Y.config.glTF=U,V}},"animation/stop":{Bm:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",yi:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,n,i,e,V,Q,U){const Y=V[V.length-1];return Y.config||(Y.config={}),Y.config.glTF=U,V}},"animation/stopAt":{Bm:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",yi:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(b,n)=>[b[0]*n._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,n,i,e,V,Q,U){const Y=V[V.length-1];return Y.config||(Y.config={}),Y.config.glTF=U,V}},"math/switch":{Bm:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(b){if(b.configuration&&b.configuration.cases){const n=b.configuration.cases.value;if(!n.every((b=>"number"===typeof b&&/^-?\d+$/.test(b.toString()))))return K.b.Warn("Switch cases should be integers. Using empty array instead."),b.configuration.cases.value=[],{valid:!0};const i=new Set(n);b.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(b,n,i,e,V){const Q=V[0];return Q.dataInputs.forEach((b=>{"default"!==b.name&&"case"!==b.name&&(b.name="in_"+b.name)})),Q.config||(Q.config={}),Q.config.treatCasesAsIntegers=!0,V}},"debug/log":{Bm:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Ci(b){let n=arguments.length>2?arguments[2]:void 0;return{Bm:[b],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((b,n)=>(b[n]={name:n},b)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(b,i,e,V,Q){var U;if(n){(U=Q[0]).config||(U.config={}),Q[0].config.preventIntegerFloatArithmetic=!0;let n=-1;Object.keys(b.values||{}).find((i=>{var e;return void 0!==(null===(e=b.values)||void 0===e?void 0:e[i].type)&&(n=b.values[i].type,!0)})),-1!==n&&(Q[0].config.type=V.arrays.types[n].flowGraphType)}return Q},validation:b=>n?ti(b):{valid:!0}}}function ti(b){if(b.values){const n=Object.keys(b.values).map((n=>b.values[n].type)).filter((b=>void 0!==b));if(!n.every((b=>b===n[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ei["math/compose"]=Ei["math/matCompose"],Ei["math/decompose"]=Ei["math/matDecompose"];var wi=i(11737);const hi={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"On",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Wi{constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=b,this._gltf=n,this._animationTargetFps=i,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const b of this._interactivityGraph.types)this._types.push(hi[b.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const b of this._interactivityGraph.declarations){const n=yi(b);if(!n)throw K.b.Error(["No mapping found for declaration",b]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:n,fullOperationName:b.extension?b.op+":"+b.extension:b.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const b of this._interactivityGraph.variables){const n=this._parseVariable(b);this._staticVariables.push(n)}}_parseVariable(b,n){const i=this._types[b.type];if(!i)throw K.b.Error(["No type found for variable",b]),new Error("Error parsing variables");if(b.value&&b.value.length!==i.length)throw K.b.Error(["Invalid value length for variable",b,i]),new Error("Error parsing variables");const e=b.value||[];if(!e.length)switch(i.flowGraphType){case"boolean":e.push(!1);break;case"FlowGraphInteger":e.push(0);break;case"number":e.push(NaN);break;case"Vector2":e.push(NaN,NaN);break;case"On":e.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":e.fill(NaN,0,4);break;case"Matrix":e.fill(NaN,0,16);break;case"Matrix3D":e.fill(NaN,0,9)}return"number"===i.elementType&&"string"===typeof e[0]&&(e[0]=parseFloat(e[0])),{type:i.flowGraphType,value:n?n(e,this):e}}_parseEvents(){if(this._interactivityGraph.events)for(const b of this._interactivityGraph.events){const n={eventId:b.id||"internalEvent_"+this._internalEventsCounter++};b.values&&(n.eventData=Object.keys(b.values).map((n=>{var i;const e=null===(i=b.values)||void 0===i?void 0:i[n];if(!e)throw K.b.Error(["No value found for event key",n]),new Error("Error parsing events");const V=this._types[e.type];if(!V)throw K.b.Error(["No type found for event value",e]),new Error("Error parsing events");const Q="undefined"!==typeof e.value?this._parseVariable(e):void 0;return{id:n,type:V.flowGraphType,eventData:!0,value:Q}}))),this._events.push(n)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const n of this._interactivityGraph.nodes){if("number"!==typeof n.declaration)throw K.b.Error(["No declaration found for node",n]),new Error("Error parsing nodes");const i=this._mappings[n.declaration];if(!i)throw K.b.Error(["No mapping found for node",n]),new Error("Error parsing nodes");if(i.flowGraphMapping.validation){const e=i.flowGraphMapping.validation(n,this._interactivityGraph,this._gltf);var b;if(!e.valid)throw new Error(`Error validating interactivity node ${null===(b=this._interactivityGraph.declarations)||void 0===b?void 0:b[n.declaration].op} - ${e.error}`)}const e=[];for(const b of i.flowGraphMapping.Bm){const V=this._getEmptyBlock(b,i.fullOperationName);this._parseNodeConfiguration(n,V,i.flowGraphMapping,b),e.push(V)}this._nodes.push({Bm:e,fullOperationName:i.fullOperationName})}}_getEmptyBlock(b,n){return{uniqueId:(0,wi.d)(),className:b,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:n,metadata:{}}}_parseNodeConfiguration(b,n,i,e){const V=n.config;if(b.configuration){const n=Object.keys(b.configuration);for(const Y of n){var Q,U;const n=null===(Q=b.configuration)||void 0===Q?void 0:Q[Y];if(!n)throw K.b.Error(["No value found for node configuration",Y]),new Error("Error parsing node configuration");const L=null===(U=i.configuration)||void 0===U?void 0:U[Y];if(L&&L.yi?L.yi===e:0===i.Bm.indexOf(e)){const b=(null===L||void 0===L?void 0:L.name)||Y;n&&"undefined"!==typeof n.value||"undefined"===typeof(null===L||void 0===L?void 0:L.defaultValue)?n.value.length>=0?V[b]={value:1===n.value.length?n.value[0]:n.value}:K.b.Warn(["Invalid value for node configuration",n]):V[b]={value:L.defaultValue},L&&L.dataTransformer&&(V[b].value=L.dataTransformer([V[b].value],this)[0])}}}}_parseNodeConnections(b){for(let M=0;M<this._nodes.length;M++){var n;const j=null===(n=this._interactivityGraph.nodes)||void 0===n?void 0:n[M];if(!j)throw K.b.Error(["No node found for interactivity node",this._nodes[M]]),new Error("Error parsing node connections");const a=this._nodes[M],D=this._mappings[j.declaration];if(!D)throw K.b.Error(["No mapping found for node",j]),new Error("Error parsing node connections");const x=j.flows||{},y=Object.keys(x).sort();for(const b of y){var i,e,V,Q;const n=x[b],B=null===(i=D.flowGraphMapping.outputs)||void 0===i||null===(e=i.flows)||void 0===e?void 0:e[b],mb=(null===B||void 0===B?void 0:B.name)||b,N=this._createNewSocketConnection(mb,!0);(B&&B.yi&&a.Bm.find((b=>b.className===B.yi))||a.Bm[0]).signalOutputs.push(N);const Z=n.node,T=this._nodes[Z];if(!T)throw K.b.Error(["No node found for input node id",Z]),new Error("Error parsing node connections");const z=xi(T.fullOperationName);if(!z)throw K.b.Error(["No mapping found for input node",T]),new Error("Error parsing node connections");let I=null===(V=z.inputs)||void 0===V||null===(Q=V.flows)||void 0===Q?void 0:Q[n.socket||"in"],O=!1;if(!I)for(const b in null===(U=z.inputs)||void 0===U?void 0:U.flows){var U,Y,L;if(b.startsWith("[")&&b.endsWith("]"))O=!0,I=null===(Y=z.inputs)||void 0===Y||null===(L=Y.flows)||void 0===L?void 0:L[b]}const u=I?O?I.name.replace("$1",n.socket||""):I.name:n.socket||"in",d=I&&I.yi&&T.Bm.find((b=>b.className===I.yi))||T.Bm[0];let G=d.signalInputs.find((b=>b.name===u));G||(G=this._createNewSocketConnection(u),d.signalInputs.push(G)),G.connectedPointIds.push(N.uniqueId),N.connectedPointIds.push(G.uniqueId)}const s=j.values||{},A=Object.keys(s);for(const n of A){var B,mb;const i=s[n];let e=null===(B=D.flowGraphMapping.inputs)||void 0===B||null===(mb=B.values)||void 0===mb?void 0:mb[n],V=!1;if(!e)for(const b in null===(N=D.flowGraphMapping.inputs)||void 0===N?void 0:N.values){var N,Z,T;if(b.startsWith("[")&&b.endsWith("]"))V=!0,e=null===(Z=D.flowGraphMapping.inputs)||void 0===Z||null===(T=Z.values)||void 0===T?void 0:T[b]}const Q=e?V?e.name.replace("$1",n):e.name:n,U=this._createNewSocketConnection(Q);if((e&&e.yi&&a.Bm.find((b=>b.className===e.yi))||a.Bm[0]).dataInputs.push(U),void 0!==i.value){const n=this._parseVariable(i,e&&e.dataTransformer);b._connectionValues[U.uniqueId]=n}else{if("undefined"===typeof i.node)throw K.b.Error(["Invalid value for value connection",i]),new Error("Error parsing node connections");{var z,I,O;const b=i.node,n=i.socket||"value",e=this._nodes[b];if(!e)throw K.b.Error(["No node found for output socket reference",i]),new Error("Error parsing node connections");const V=xi(e.fullOperationName);if(!V)throw K.b.Error(["No mapping found for output socket reference",i]),new Error("Error parsing node connections");let Q=null===(z=V.outputs)||void 0===z||null===(I=z.values)||void 0===I?void 0:I[n],Y=!1;if(!Q)for(const i in null===(u=V.outputs)||void 0===u?void 0:u.values){var u,d,G;if(i.startsWith("[")&&i.endsWith("]"))Y=!0,Q=null===(d=V.outputs)||void 0===d||null===(G=d.values)||void 0===G?void 0:G[i]}const L=Q?Y?Q.name.replace("$1",n):null===(O=Q)||void 0===O?void 0:O.name:n,B=Q&&Q.yi&&e.Bm.find((b=>b.className===Q.yi))||e.Bm[0];let mb=B.dataOutputs.find((b=>b.name===L));mb||(mb=this._createNewSocketConnection(L,!0),B.dataOutputs.push(mb)),U.connectedPointIds.push(mb.uniqueId),mb.connectedPointIds.push(U.uniqueId)}}}if(D.flowGraphMapping.interBlockConnectors)for(const b of D.flowGraphMapping.interBlockConnectors){const n=b.input,i=b.output,e=b.isVariable;this._connectFlowGraphNodes(n,i,a.Bm[b.inputBlockIndex],a.Bm[b.outputBlockIndex],e)}if(D.flowGraphMapping.extraProcessor){var o;const n=null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[j.declaration];if(!n)throw K.b.Error(["No declaration found for extra processor",j]),new Error("Error parsing node connections");a.Bm=D.flowGraphMapping.extraProcessor(j,n,D.flowGraphMapping,this,a.Bm,b,this._gltf)}}}_createNewSocketConnection(b,n){return{uniqueId:(0,wi.d)(),name:b,_connectionType:n?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(b,n,i,e,V){const Q=V?i.dataInputs:i.signalInputs,U=V?e.dataOutputs:e.signalOutputs,Y=Q.find((n=>n.name===b))||this._createNewSocketConnection(b),L=U.find((b=>b.name===n))||this._createNewSocketConnection(n,!0);Q.find((n=>n.name===b))||Q.push(Y),U.find((b=>b.name===n))||U.push(L),Y.connectedPointIds.push(L.uniqueId),L.connectedPointIds.push(Y.uniqueId)}getVariableName(b){return"staticVariable_"+b}serializeToFlowGraph(){const b={uniqueId:(0,wi.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(b);for(let n=0;n<this._staticVariables.length;n++){const i=this._staticVariables[n];b._userVariables[this.getVariableName(n)]=i}return{rightHanded:!0,allBlocks:this._nodes.reduce(((b,n)=>b.concat(n.Bm)),[]),executionContexts:[b]}}}const Ji="KHR_interactivity";class Ri{constructor(b){this._loader=b,this.name=Ji,this.enabled=this._loader.isExtensionUsed(Ji),this._pathConverter=(0,R.i)(this._loader.Ne),b._skipStartAnimationStep=!0;const n=b.babylonScene;n&&function(b){(0,R.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!b.activeCamera)return new V.Quaternion(NaN,NaN,NaN,NaN);const n=V.Quaternion.FromRotationMatrix(b.activeCamera.getWorldMatrix()).normalize();return b.useRightHandedSystem||(n.w*=-1,n.x*=-1),n},type:"Quaternion",getTarget:()=>b.activeCamera}),(0,R.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!b.activeCamera)return new V.On(NaN,NaN,NaN);const n=b.activeCamera.getWorldMatrix().getTranslation();return b.useRightHandedSystem||(n.x*=-1),n},type:"On",getTarget:()=>b.activeCamera}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:b=>{var n;return(null===(n=b._babylonAnimationGroup)||void 0===n?void 0:n.isPlaying)??!1},type:"boolean",getTarget:b=>b._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:b=>{var n;return((null===(n=b._babylonAnimationGroup)||void 0===n?void 0:n.from)??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:b=>{var n;return((null===(n=b._babylonAnimationGroup)||void 0===n?void 0:n.to)??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:b=>{var n;return((null===(n=b._babylonAnimationGroup)||void 0===n?void 0:n.getCurrentFrame())??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:b=>{var n;return((null===(n=b._babylonAnimationGroup)||void 0===n?void 0:n.getCurrentFrame())??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup})}(n)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var b;if(!this._loader.babylonScene||!this._pathConverter)return;const n=this._loader.babylonScene,i=null===(b=this._loader.Ne.extensions)||void 0===b?void 0:b.KHR_interactivity;if(!i)return;const e=new Ki.d({dn:n});e.dispatchEventsSynchronously=!1;const V=i.graphs.map((b=>new Wi(b,this._loader.Ne,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(V.map((async b=>await ji(b,{coordinator:e,pathConverter:this._pathConverter})))),e.start()}}var ki;ki=async()=>(await Promise.resolve().then(i.bind(i,13590))).FlowGraphGLTFDataProvider,Ii[`${Ji}/${"FlowGraphGLTFDataProvider"}`]=ki,J(Ji),W(Ji,!0,(b=>new Ri(b)));const ri="KHR_node_visibility";(0,R.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:b=>{const n=b._babylonTransformNode;return!n||void 0===n.isVisible||n.isVisible},set:(b,n)=>{var i,e;null===(i=n._primitiveBabylonMeshes)||void 0===i||i.forEach((b=>{b.inheritVisibility=!0})),n._babylonTransformNode&&(n._babylonTransformNode.isVisible=b),null===(e=n._primitiveBabylonMeshes)||void 0===e||e.forEach((n=>{n.isVisible=b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Xi{constructor(b){this.name=ri,this._loader=b,this.enabled=b.isExtensionUsed(ri)}async onReady(){var b;null===(b=this._loader.Ne.nodes)||void 0===b||b.forEach((b=>{var n,i,e,V;(null===(n=b._primitiveBabylonMeshes)||void 0===n||n.forEach((b=>{b.inheritVisibility=!0})),null!==(i=b.extensions)&&void 0!==i&&i.KHR_node_visibility)&&(!1===(null===(e=b.extensions)||void 0===e?void 0:e.KHR_node_visibility.visible)&&(b._babylonTransformNode&&(b._babylonTransformNode.isVisible=!1),null===(V=b._primitiveBabylonMeshes)||void 0===V||V.forEach((b=>{b.isVisible=!1}))))}))}dispose(){this._loader=null}}J(ri),W(ri,!0,(b=>new Xi(b)));const gi="KHR_node_selectability";si("event/onSelect",gi,{Bm:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yi:"FlowGraphGetVariableBlock",dataTransformer:b=>["pickedMesh_"+b[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",yi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,n,i,e,V,Q,U){var Y,L,B,mb,N,Z;const T=V[V.length-1];T.config=T.config||{},T.config.glTF=U;const z=null===(Y=b.configuration)||void 0===Y||null===(L=Y.nodeIndex)||void 0===L?void 0:L.value[0];if(void 0===z||"number"!==typeof z)throw new Error("nodeIndex not found in configuration");const K="pickedMesh_"+z;return V[1].config.variable=K,Q._userVariables[K]={className:"Mesh",id:null===U||void 0===U||null===(B=U.nodes)||void 0===B||null===(mb=B[z]._babylonTransformNode)||void 0===mb?void 0:mb.id,uniqueId:null===U||void 0===U||null===(N=U.nodes)||void 0===N||null===(Z=N[z]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},V}}),(0,R.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:b=>{const n=b._babylonTransformNode;return!n||void 0===n.CL||n.CL},set:(b,n)=>{var i;null===(i=n._primitiveBabylonMeshes)||void 0===i||i.forEach((n=>{n.CL=b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"CL"],type:"boolean"});class Pi{constructor(b){this.name=gi,this._loader=b,this.enabled=b.isExtensionUsed(gi)}async onReady(){var b;null===(b=this._loader.Ne.nodes)||void 0===b||b.forEach((b=>{var n,i,e;null!==(n=b.extensions)&&void 0!==n&&n.KHR_node_selectability&&!1===(null===(i=b.extensions)||void 0===i?void 0:i.KHR_node_selectability.selectable)&&(null===(e=b._babylonTransformNode)||void 0===e||e.getChildMeshes().forEach((b=>{b.CL=!1})))}))}dispose(){this._loader=null}}J(gi),W(gi,!0,(b=>new Pi(b)));const ci="KHR_node_hoverability",qi="targetMeshPointerOver_";si("event/onHoverIn",ci,{Bm:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yi:"FlowGraphGetVariableBlock",dataTransformer:b=>[qi+b[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",yi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,n,i,e,V,Q,U){var Y,L,B,mb,N,Z;const T=V[V.length-1];T.config=T.config||{},T.config.glTF=U;const z=null===(Y=b.configuration)||void 0===Y||null===(L=Y.nodeIndex)||void 0===L?void 0:L.value[0];if(void 0===z||"number"!==typeof z)throw new Error("nodeIndex not found in configuration");const K=qi+z;return V[1].config.variable=K,Q._userVariables[K]={className:"Mesh",id:null===U||void 0===U||null===(B=U.nodes)||void 0===B||null===(mb=B[z]._babylonTransformNode)||void 0===mb?void 0:mb.id,uniqueId:null===U||void 0===U||null===(N=U.nodes)||void 0===N||null===(Z=N[z]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},V}});const Si="targetMeshPointerOut_";si("event/onHoverOut",ci,{Bm:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yi:"FlowGraphGetVariableBlock",dataTransformer:b=>[Si+b[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",yi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,n,i,e,V,Q,U){var Y,L,B,mb,N,Z;const T=V[V.length-1];T.config=T.config||{},T.config.glTF=U;const z=null===(Y=b.configuration)||void 0===Y||null===(L=Y.nodeIndex)||void 0===L?void 0:L.value[0];if(void 0===z||"number"!==typeof z)throw new Error("nodeIndex not found in configuration");const K=Si+z;return V[1].config.variable=K,Q._userVariables[K]={className:"Mesh",id:null===U||void 0===U||null===(B=U.nodes)||void 0===B||null===(mb=B[z]._babylonTransformNode)||void 0===mb?void 0:mb.id,uniqueId:null===U||void 0===U||null===(N=U.nodes)||void 0===N||null===(Z=N[z]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},V}}),(0,R.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:b=>{const n=b._babylonTransformNode;return!n||void 0===n.pointerOverDisableMeshTesting||n.pointerOverDisableMeshTesting},set:(b,n)=>{var i;null===(i=n._primitiveBabylonMeshes)||void 0===i||i.forEach((n=>{n.pointerOverDisableMeshTesting=!b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Hi{constructor(b){this.name=ci,this._loader=b,this.enabled=b.isExtensionUsed(ci)}async onReady(){var b;null===(b=this._loader.Ne.nodes)||void 0===b||b.forEach((b=>{var n,i,e;null!==(n=b.extensions)&&void 0!==n&&n.KHR_node_hoverability&&!1===(null===(i=b.extensions)||void 0===i?void 0:i.KHR_node_hoverability.hoverable)&&(null===(e=b._babylonTransformNode)||void 0===e||e.getChildMeshes().forEach((b=>{b.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}J(ci),W(ci,!0,(b=>new Hi(b)));const li="ExtrasAsMetadata";class vi{_assignExtras(b,n){if(n.extras&&Object.keys(n.extras).length>0){const i=b.metadata=b.metadata||{};(i.Ne=i.Ne||{}).extras=n.extras}}constructor(b){this.name=li,this.enabled=!0,this._loader=b}dispose(){this._loader=null}loadNodeAsync(b,n,i){return this._loader.loadNodeAsync(b,n,(b=>{this._assignExtras(b,n),i(b)}))}loadCameraAsync(b,n,i){return this._loader.loadCameraAsync(b,n,(b=>{this._assignExtras(b,n),i(b)}))}createMaterial(b,n,i){const e=this._loader.createMaterial(b,n,i);return this._assignExtras(e,n),e}}J(li),W(li,!1,(b=>new vi(b)));i(13590)},13454:(b,n,i)=>{"use strict";i.d(n,{b:()=>C,f:()=>D,i:()=>a,j:()=>x});var e=i(11612),V=i(11605),Q=i(13072),U=i(12215),Y=i(12185),L=i(12190),B=i(11621),mb=i(11646),N=i(12209),Z=i(12317),T=i(12222),z=i(11813);class K{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.cN=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.DZ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(b){this._environmentTexture=b}getNodes(){let b=[];b=b.concat(this.meshes),b=b.concat(this.lights),b=b.concat(this.cameras),b=b.concat(this.transformNodes);for(const n of this.skeletons)b=b.concat(n.bones);return b}}class I extends K{}class O{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const b=this.rootNodes;for(const e of b)e.dispose();b.length=0;const n=this.skeletons;for(const e of n)e.dispose();n.length=0;const i=this.animationGroups;for(const e of i)e.dispose();i.length=0}}class u extends K{constructor(b){super(),this._wasAddedToScene=!1,(b=b||mb.d.LastCreatedScene)&&(this.dn=b,this.proceduralTextures=[],b.Qe.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=b.getEngine().onContextRestoredObservable.add((()=>{for(const b of this.geometries)b._rebuild();for(const b of this.meshes)b._rebuild();for(const b of this.cN)b.rebuild();for(const b of this.textures)b._rebuild()})))}_topologicalSort(b){const n=new Map;for(const U of b)n.set(U.uniqueId,U);const i={dependsOn:new Map,dependedBy:new Map};for(const U of b){const b=U.uniqueId;i.dependsOn.set(b,new Set),i.dependedBy.set(b,new Set)}for(const U of b){const b=U.uniqueId,e=i.dependsOn.get(b);if(U instanceof N.e){const V=U.sourceMesh;n.has(V.uniqueId)&&(e.add(V.uniqueId),i.dependedBy.get(V.uniqueId).add(b))}const V=i.dependedBy.get(b);for(const Q of U.getDescendants()){const e=Q.uniqueId;if(n.has(e)){V.add(e);i.dependsOn.get(e).add(b)}}}const e=[],V=[];for(const U of b){const b=U.uniqueId;0===i.dependsOn.get(b).size&&(V.push(U),n.delete(b))}const Q=V;for(;Q.length>0;){const b=Q.shift();e.push(b);const V=i.dependedBy.get(b.uniqueId);for(const e of Array.from(V.values())){const V=i.dependsOn.get(e);V.delete(b.uniqueId),0===V.size&&n.get(e)&&(Q.push(n.get(e)),n.delete(e))}}return n.size>0&&(B.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),n.forEach((b=>{B.b.Error(b.name)}))),e}_addNodeAndDescendantsToList(b,n,i,e){if(i&&(!e||e(i))&&!n.has(i.uniqueId)){b.push(i),n.add(i.uniqueId);for(const V of i.getDescendants(!0))this._addNodeAndDescendantsToList(b,n,V,e)}}_isNodeInContainer(b){return b instanceof L.d&&-1!==this.meshes.indexOf(b)||(b instanceof Y.e&&-1!==this.transformNodes.indexOf(b)||(b instanceof Z.c&&-1!==this.lights.indexOf(b)||b instanceof T.c&&-1!==this.cameras.indexOf(b)))}_isValidHierarchy(){for(const b of this.meshes)if(b.parent&&!this._isNodeInContainer(b.parent))return B.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.transformNodes)if(b.parent&&!this._isNodeInContainer(b.parent))return B.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.lights)if(b.parent&&!this._isNodeInContainer(b.parent))return B.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.cameras)if(b.parent&&!this._isNodeInContainer(b.parent))return B.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||V.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const e={},Q={},Y=new O,L=[],B=[],mb={doNotInstantiate:!0,...i},N=[],Z=new Set;for(const V of this.transformNodes)null===V.parent&&this._addNodeAndDescendantsToList(N,Z,V,mb.predicate);for(const V of this.meshes)null===V.parent&&this._addNodeAndDescendantsToList(N,Z,V,mb.predicate);const T=this._topologicalSort(N),z=(i,V)=>{if(((n,i)=>{if(e[n.uniqueId]=i.uniqueId,Q[i.uniqueId]=i,b&&(i.name=b(n.name)),i instanceof U.b){const b=i;if(b.morphTargetManager){const i=n.morphTargetManager;b.morphTargetManager=i.clone();for(let n=0;n<i.numTargets;n++){const V=i.getTarget(n),U=b.morphTargetManager.getTarget(n);e[V.uniqueId]=U.uniqueId,Q[U.uniqueId]=U}}}})(i,V),i.parent){const b=e[i.parent.uniqueId],n=Q[b];V.parent=n||i.parent}if(V.position&&i.position&&V.position.L(i.position),V.rotationQuaternion&&i.rotationQuaternion&&V.rotationQuaternion.L(i.rotationQuaternion),V.rotation&&i.rotation&&V.rotation.L(i.rotation),V.ge&&i.ge&&V.ge.L(i.ge),V.material){const U=V;if(U.material)if(n){const n=i.material;if(-1===B.indexOf(n)){let i=n.clone(b?b(n.name):"Clone of "+n.name);if(B.push(n),e[n.uniqueId]=i.uniqueId,Q[i.uniqueId]=i,"MultiMaterial"===n.getClassName()){const V=n;for(const n of V.QQ)n&&(i=n.clone(b?b(n.name):"Clone of "+n.name),B.push(n),e[n.uniqueId]=i.uniqueId,Q[i.uniqueId]=i);V.QQ=V.QQ.map((b=>b&&Q[e[b.uniqueId]]))}}"InstancedMesh"!==U.getClassName()&&(U.material=Q[e[n.uniqueId]])}else"MultiMaterial"===U.material.getClassName()?-1===this.dn.multiMaterials.indexOf(U.material)&&this.dn.addMultiMaterial(U.material):-1===this.dn.materials.indexOf(U.material)&&this.dn.addMaterial(U.material)}null===V.parent&&Y.rootNodes.push(V)};for(const V of T)if("InstancedMesh"===V.getClassName()){const b=V,n=b.sourceMesh,i=e[n.uniqueId];z(b,("number"===typeof i?Q[i]:n).createInstance(b.name))}else{let b=!0;"Jz"===V.getClassName()||"Node"===V.getClassName()||V.skeleton||!V.getTotalVertices||0===V.getTotalVertices()?b=!1:mb.doNotInstantiate&&(b="function"===typeof mb.doNotInstantiate?!mb.doNotInstantiate(V):!mb.doNotInstantiate);const n=b?V.createInstance(`instance of ${V.name}`):V.clone(`Clone of ${V.name}`,null,!0);if(!n)throw new Error(`Could not clone or instantiate node on Asset Container ${V.name}`);z(V,n)}for(const V of this.skeletons){if(mb.predicate&&!mb.predicate(V))continue;const n=V.clone(b?b(V.name):"Clone of "+V.name);for(const b of this.meshes)if(b.skeleton===V&&!b.isAnInstance){const i=Q[e[b.uniqueId]];if(!i||i.isAnInstance)continue;if(i.skeleton=n,-1!==L.indexOf(n))continue;L.push(n);for(const b of n.bones)b._linkedTransformNode&&(b._linkedTransformNode=Q[e[b._linkedTransformNode.uniqueId]])}Y.skeletons.push(n)}for(const V of this.animationGroups){if(mb.predicate&&!mb.predicate(V))continue;const n=V.clone(b?b(V.name):"Clone of "+V.name,(b=>Q[e[b.uniqueId]]||b));Y.animationGroups.push(n)}return Y}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||V.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.dn.environmentTexture=this.environmentTexture);for(const b of this.dn._serializableComponents)b.addFromContainer(this);this.dn.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n=[];for(const i of this.cameras)b&&!b(i)||(this.dn.addCamera(i),n.push(i));for(const i of this.lights)b&&!b(i)||(this.dn.addLight(i),n.push(i));for(const i of this.meshes)b&&!b(i)||(this.dn.vB(i),n.push(i));for(const i of this.skeletons)b&&!b(i)||this.dn.addSkeleton(i);for(const i of this.animations)b&&!b(i)||this.dn.addAnimation(i);for(const i of this.animationGroups)b&&!b(i)||this.dn.addAnimationGroup(i);for(const i of this.multiMaterials)b&&!b(i)||this.dn.addMultiMaterial(i);for(const i of this.materials)b&&!b(i)||this.dn.addMaterial(i);for(const i of this.morphTargetManagers)b&&!b(i)||this.dn.addMorphTargetManager(i);for(const i of this.geometries)b&&!b(i)||this.dn.addGeometry(i);for(const i of this.transformNodes)b&&!b(i)||(this.dn.addTransformNode(i),n.push(i));for(const i of this.actionManagers)b&&!b(i)||this.dn.addActionManager(i);for(const i of this.textures)b&&!b(i)||this.dn.addTexture(i);for(const i of this.reflectionProbes)b&&!b(i)||this.dn.addReflectionProbe(i);for(const i of n)i.parent&&-1===this.dn.getNodes().indexOf(i.parent)&&(i.setParent?i.setParent(null):i.parent=null)}removeAllFromScene(){this._isValidHierarchy()||V.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.dn.environmentTexture&&(this.dn.environmentTexture=null);for(const b of this.dn._serializableComponents)b.removeFromContainer(this)}removeFromScene(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const n of this.cameras)b&&!b(n)||this.dn.removeCamera(n);for(const n of this.lights)b&&!b(n)||this.dn.removeLight(n);for(const n of this.meshes)b&&!b(n)||this.dn.lB(n,!0);for(const n of this.skeletons)b&&!b(n)||this.dn.removeSkeleton(n);for(const n of this.animations)b&&!b(n)||this.dn.removeAnimation(n);for(const n of this.animationGroups)b&&!b(n)||this.dn.removeAnimationGroup(n);for(const n of this.multiMaterials)b&&!b(n)||this.dn.removeMultiMaterial(n);for(const n of this.materials)b&&!b(n)||this.dn.removeMaterial(n);for(const n of this.morphTargetManagers)b&&!b(n)||this.dn.removeMorphTargetManager(n);for(const n of this.geometries)b&&!b(n)||this.dn.removeGeometry(n);for(const n of this.transformNodes)b&&!b(n)||this.dn.removeTransformNode(n);for(const n of this.actionManagers)b&&!b(n)||this.dn.removeActionManager(n);for(const n of this.textures)b&&!b(n)||this.dn.removeTexture(n);for(const n of this.reflectionProbes)b&&!b(n)||this.dn.removeReflectionProbe(n)}dispose(){const b=this.cameras.slice(0);for(const T of b)T.dispose();this.cameras.length=0;const n=this.lights.slice(0);for(const T of n)T.dispose();this.lights.length=0;const i=this.meshes.slice(0);for(const T of i)T.dispose();this.meshes.length=0;const e=this.skeletons.slice(0);for(const T of e)T.dispose();this.skeletons.length=0;const V=this.animationGroups.slice(0);for(const T of V)T.dispose();this.animationGroups.length=0;const Q=this.multiMaterials.slice(0);for(const T of Q)T.dispose();this.multiMaterials.length=0;const U=this.materials.slice(0);for(const T of U)T.dispose();this.materials.length=0;const Y=this.geometries.slice(0);for(const T of Y)T.dispose();this.geometries.length=0;const L=this.transformNodes.slice(0);for(const T of L)T.dispose();this.transformNodes.length=0;const B=this.actionManagers.slice(0);for(const T of B)T.dispose();this.actionManagers.length=0;const mb=this.textures.slice(0);for(const T of mb)T.dispose();this.textures.length=0;const N=this.reflectionProbes.slice(0);for(const T of N)T.dispose();this.reflectionProbes.length=0;const Z=this.morphTargetManagers.slice(0);for(const T of Z)T.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const T of this.dn._serializableComponents)T.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.dn.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(b,n,i){if(b&&n)for(const e of b){let b=!0;if(i)for(const n of i)if(e===n){b=!1;break}b&&(n.push(e),e._parentContainer=this)}}moveAllFromScene(b){this._wasAddedToScene=!1,void 0===b&&(b=new I);for(const n in this)Object.prototype.hasOwnProperty.call(this,n)&&(this[n]=this[n]||("_environmentTexture"===n?null:[]),this._moveAssets(this.dn[n],this[n],b[n]));this.environmentTexture=this.dn.environmentTexture,this.removeAllFromScene()}createRootMesh(){const b=new U.b("assetContainerRootMesh",this.dn);for(const n of this.meshes)n.parent||b.addChild(n);return this.meshes.unshift(b),b}mergeAnimationsTo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mb.d.LastCreatedScene,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!b)return B.b.Error("No scene available to merge animations to"),[];const e=i||(n=>{let i=null;const e=n.animations.length?n.animations[0].targetProperty:"",V=n.name.split(".").join("").split("_primitive")[0];switch(e){case"position":case"rotationQuaternion":i=b.getTransformNodeByName(n.name)||b.getTransformNodeByName(V);break;case"influence":i=b.getMorphTargetByName(n.name)||b.getMorphTargetByName(V);break;default:i=b.getNodeByName(n.name)||b.getNodeByName(V)}return i}),V=this.getNodes();for(const Y of V){const b=e(Y);if(null!==b){for(const n of Y.animations){const i=b.animations.filter((b=>b.targetProperty===n.targetProperty));for(const n of i){const i=b.animations.indexOf(n,0);i>-1&&b.animations.splice(i,1)}}b.animations=b.animations.concat(Y.animations)}}const Q=[],U=this.animationGroups.slice();for(const Y of U){Q.push(Y.clone(Y.name,e));for(const b of Y.animatables)b.stop()}for(const Y of n){const n=e(Y.target);n&&(b.beginAnimation(n,Y.fromFrame,Y.toFrame,Y.loopAnimation,Y.speedRatio,Y.onAnimationEnd?Y.onAnimationEnd:void 0,void 0,!0,void 0,Y.onAnimationLoop?Y.onAnimationLoop:void 0),b.stopAnimation(Y.target))}return Q}populateRootNodes(){this.rootNodes.length=0;for(const b of this.meshes)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.transformNodes)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.lights)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.cameras)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b)}addAllAssetsToContainer(b){if(!b)return;const n=[],i=new Set;for(n.push(b);n.length>0;){const b=n.pop();if(b instanceof U.b?(b.We&&-1===this.geometries.indexOf(b.We)&&this.geometries.push(b.We),this.meshes.push(b)):b instanceof N.e?this.meshes.push(b):b instanceof Y.e?this.transformNodes.push(b):b instanceof Z.c?this.lights.push(b):b instanceof T.c&&this.cameras.push(b),b instanceof L.d){if(b.material&&-1===this.materials.indexOf(b.material)){this.materials.push(b.material);for(const n of b.material.getActiveTextures())-1===this.textures.indexOf(n)&&this.textures.push(n)}b.skeleton&&-1===this.skeletons.indexOf(b.skeleton)&&this.skeletons.push(b.skeleton),b.morphTargetManager&&-1===this.morphTargetManagers.indexOf(b.morphTargetManager)&&this.morphTargetManagers.push(b.morphTargetManager)}for(const e of b.getChildren())i.has(e)||n.push(e);i.add(b)}this.populateRootNodes()}_getByTags(b,n,i){if(void 0===n)return b;const e=[];for(const V in b){const Q=b[V];z.d&&z.d.MatchesQuery(Q,n)&&(!i||i(Q))&&e.push(Q)}return e}getMeshesByTags(b,n){return this._getByTags(this.meshes,b,n)}getCamerasByTags(b,n){return this._getByTags(this.cameras,b,n)}getLightsByTags(b,n){return this._getByTags(this.lights,b,n)}getMaterialsByTags(b,n){return this._getByTags(this.materials,b,n).concat(this._getByTags(this.multiMaterials,b,n))}getTransformNodesByTags(b,n){return this._getByTags(this.transformNodes,b,n)}}var d=i(11662);class G{constructor(b){this.byteOffset=0,this.buffer=b}async loadAsync(b){const n=await this.buffer.readAsync(this.byteOffset,b);this._dataView=new DataView(n.buffer,n.byteOffset,n.byteLength),this._dataByteOffset=0}readUint32(){const b=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,b}readUint8Array(b){const n=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,b);return this._dataByteOffset+=b,this.byteOffset+=b,n}readString(b){return(0,d.g)(this.readUint8Array(b))}skipBytes(b){this._dataByteOffset+=b,this.byteOffset+=b}}var o=i(13460);const M="Z2xURg",j={name:"Ne",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:b=>-1!==b.indexOf("asset")&&-1!==b.indexOf("version")||b.startsWith("data:base64,"+M)||b.startsWith("data:;base64,"+M)||b.startsWith("data:application/octet-stream;base64,"+M)||b.startsWith("data:model/gltf-binary;base64,"+M)};var a,D,x,y=i(11655),s=i(11659);function A(b,n,i){try{return Promise.resolve(new Uint8Array(b,n,i))}catch(e){return Promise.reject(e)}}!function(b){b[b.AUTO=0]="AUTO",b[b.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(a||(a={})),function(b){b[b.NONE=0]="NONE",b[b.FIRST=1]="FIRST",b[b.ALL=2]="ALL"}(D||(D={})),function(b){b[b.LOADING=0]="LOADING",b[b.READY=1]="READY",b[b.COMPLETE=2]="COMPLETE"}(x||(x={}));class E{constructor(){this.coordinateSystemMode=a.AUTO,this.animationStartMode=D.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=b=>Promise.resolve(b),this.extensionOptions={}}L(b){b&&(this.onParsed=b.onParsed,this.coordinateSystemMode=b.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=b.animationStartMode??this.animationStartMode,this.loadNodeAnimations=b.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=b.loadSkins??this.loadSkins,this.loadMorphTargets=b.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=b.compileMaterials??this.compileMaterials,this.useClipPlane=b.useClipPlane??this.useClipPlane,this.compileShadowGenerators=b.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=b.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=b.useRangeRequests??this.useRangeRequests,this.createInstances=b.createInstances??this.createInstances,this.alwaysComputeBoundingBox=b.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=b.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=b.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=b.skipMaterials??this.skipMaterials,this.useSRGBBuffers=b.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=b.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=b.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=b.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=b.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=b.customRootNode,this.onMeshLoaded=b.onMeshLoaded,this.onSkinLoaded=b.onSkinLoaded,this.onTextureLoaded=b.onTextureLoaded,this.onMaterialLoaded=b.onMaterialLoaded,this.onCameraLoaded=b.onCameraLoaded,this.extensionOptions=b.extensionOptions??this.extensionOptions)}}class C extends E{constructor(b){super(),this.onParsedObservable=new e.e,this.onMeshLoadedObservable=new e.e,this.onSkinLoadedObservable=new e.e,this.onTextureLoadedObservable=new e.e,this.onMaterialLoadedObservable=new e.e,this.onCameraLoadedObservable=new e.e,this.onCompleteObservable=new e.e,this.onErrorObservable=new e.e,this.Qe=new e.e,this.onExtensionLoadedObservable=new e.e,this.validate=!1,this.onValidatedObservable=new e.e,this._loader=null,this._state=null,this._requests=new Array,this.name=j.name,this.extensions=j.extensions,this.onLoaderStateChangedObservable=new e.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.L(b)}set onParsed(b){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),b&&(this._onParsedObserver=this.onParsedObservable.add(b))}set onMeshLoaded(b){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),b&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(b))}set onSkinLoaded(b){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),b&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((n=>b(n.node,n.skinnedNode))))}set onTextureLoaded(b){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),b&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(b))}set onMaterialLoaded(b){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),b&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(b))}set onCameraLoaded(b){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),b&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(b))}set onComplete(b){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(b)}set onError(b){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(b)}set onDispose(b){this._onDisposeObserver&&this.Qe.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qe.add(b)}set onExtensionLoaded(b){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(b)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(b){this._loggingEnabled!==b&&(this._loggingEnabled=b,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(b){this._capturePerformanceCounters!==b&&(this._capturePerformanceCounters=b,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(b){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(b)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const b of this._requests)b.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=b=>Promise.resolve(b),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Qe.notifyObservers(void 0),this.Qe.clear()}loadFile(b,n,i,Q,U,Y,L,mb){if(ArrayBuffer.isView(n))return this._loadBinary(b,n,i,Q,L,mb),null;this._progressCallback=U;const N=n.name||V.Tools.GetFilename(n);if(Y){if(this.useRangeRequests){this.validate&&B.b.Warn("glTF validation is not supported when range requests are enabled");const i={abort:()=>{},onCompleteObservable:new e.e},V={readAsync:(i,e)=>new Promise(((V,Q)=>{this._loadFile(b,n,(b=>{V(new Uint8Array(b))}),!0,(b=>{Q(b)}),(b=>{b.setRequestHeader("Range",`bytes=${i}-${i+e-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new G(V)).then((b=>{i.onCompleteObservable.notifyObservers(i),Q(b)}),L?b=>L(void 0,b):void 0),i}return this._loadFile(b,n,(n=>{this._validate(b,new Uint8Array(n,0,n.byteLength),i,N),this._unpackBinaryAsync(new G({readAsync:(b,i)=>A(n,b,i),byteLength:n.byteLength})).then((b=>{Q(b)}),L?b=>L(void 0,b):void 0)}),!0,L)}return this._loadFile(b,n,(n=>{try{this._validate(b,n,i,N),Q({json:this._parseJson(n)})}catch{L&&L()}}),!1,L)}_loadBinary(b,n,i,e,V,Q){this._validate(b,new Uint8Array(n.buffer,n.byteOffset,n.byteLength),i,Q),this._unpackBinaryAsync(new G({readAsync:(b,i)=>function(b,n,i){try{if(n<0||n>=b.byteLength)throw new RangeError("Offset is out of range.");if(n+i>b.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(b.buffer,b.byteOffset+n,i))}catch(e){return Promise.reject(e)}}(n,b,i),byteLength:n.byteLength})).then((b=>{e(b)}),V?b=>V(void 0,b):void 0)}importMeshAsync(b,n,i,e,V,Q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(b,n,null,i,e,V,Q))))}loadAsync(b,n,i,e,V){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${V||""}`),this._loader=this._getLoader(n),this._loader.loadAsync(b,n,i,e,V))))}loadAssetContainerAsync(b,n,i,e,V){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${V||""}`),this._loader=this._getLoader(n);const Q=new u(b),U=[];this.onMaterialLoadedObservable.add((b=>{U.push(b)}));const Y=[];this.onTextureLoadedObservable.add((b=>{Y.push(b)}));const L=[];this.onCameraLoadedObservable.add((b=>{L.push(b)}));const B=[];return this.onMeshLoadedObservable.add((b=>{b.morphTargetManager&&B.push(b.morphTargetManager)})),this._loader.importMeshAsync(null,b,Q,n,i,e,V).then((b=>(Array.prototype.push.apply(Q.geometries,b.geometries),Array.prototype.push.apply(Q.meshes,b.meshes),Array.prototype.push.apply(Q.cN,b.cN),Array.prototype.push.apply(Q.skeletons,b.skeletons),Array.prototype.push.apply(Q.animationGroups,b.animationGroups),Array.prototype.push.apply(Q.materials,U),Array.prototype.push.apply(Q.textures,Y),Array.prototype.push.apply(Q.lights,b.lights),Array.prototype.push.apply(Q.transformNodes,b.transformNodes),Array.prototype.push.apply(Q.cameras,L),Array.prototype.push.apply(Q.morphTargetManagers,B),Q)))}))}canDirectLoad(b){return j.canDirectLoad(b)}directLoad(b,n){if(n.startsWith("base64,"+M)||n.startsWith(";base64,"+M)||n.startsWith("application/octet-stream;base64,"+M)||n.startsWith("model/gltf-binary;base64,"+M)){const i=(0,y.d)(n);return this._validate(b,new Uint8Array(i,0,i.byteLength)),this._unpackBinaryAsync(new G({readAsync:(b,n)=>A(i,b,n),byteLength:i.byteLength}))}return this._validate(b,n),Promise.resolve({json:this._parseJson(n)})}createPlugin(b){return new C(b[j.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((b,n)=>{this.onCompleteObservable.addOnce((()=>{b()})),this.onErrorObservable.addOnce((b=>{n(b)}))}))}_setState(b){this._state!==b&&(this._state=b,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(x[this._state]))}_loadFile(b,n,i,e,V,Q){const U=b._loadFile(n,i,(b=>{this._onProgress(b,U)}),!0,e,V,Q);return U.onCompleteObservable.add((()=>{U._lengthComputable=!0,U._total=U._loaded})),this._requests.push(U),U}_onProgress(b,n){if(!this._progressCallback)return;n._lengthComputable=b.lengthComputable,n._loaded=b.loaded,n._total=b.total;let i=!0,e=0,V=0;for(const Q of this._requests){if(void 0===Q._lengthComputable||void 0===Q._loaded||void 0===Q._total)return;i=i&&Q._lengthComputable,e+=Q._loaded,V+=Q._total}this._progressCallback({lengthComputable:i,loaded:e,total:i?V:0})}_validate(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),o.c.ValidateAsync(n,i,e,(n=>this.preprocessUrlAsync(i+n).then((n=>b._loadFileAsync(n,void 0,!0,!0).then((b=>new Uint8Array(b,0,b.byteLength))))))).then((b=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(b),this.onValidatedObservable.clear()}),(b=>{this._endPerformanceCounter("Validate JSON"),V.Tools.Warn(`Failed to validate: ${b.message}`),this.onValidatedObservable.clear()})))}_getLoader(b){const n=b.json.asset||{};this._log(`Asset version: ${n.version}`),n.minVersion&&this._log(`Asset minimum version: ${n.minVersion}`),n.generator&&this._log(`Asset generator: ${n.generator}`);const i=C._parseVersion(n.version);if(!i)throw new Error("Invalid version: "+n.version);if(void 0!==n.minVersion){const b=C._parseVersion(n.minVersion);if(!b)throw new Error("Invalid minimum version: "+n.minVersion);if(C._compareVersion(b,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+n.minVersion)}const e={1:C._CreateGLTF1Loader,2:C._CreateGLTF2Loader}[i.major];if(!e)throw new Error("Unsupported version: "+n.version);return e(this)}_parseJson(b){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${b.length}`);const n=JSON.parse(b);return this._endPerformanceCounter("Parse JSON"),n}_unpackBinaryAsync(b){return this._startPerformanceCounter("Unpack Binary"),b.loadAsync(20).then((()=>{const n=b.readUint32();if(1179937895!==n)throw new s.k("Unexpected magic: "+n,s.g.GLTFLoaderUnexpectedMagicError);const i=b.readUint32();this.loggingEnabled&&this._log(`Binary version: ${i}`);const e=b.readUint32();let V;switch(this.useRangeRequests||e===b.buffer.byteLength||B.b.Warn(`Length in header does not match actual data length: ${e} != ${b.buffer.byteLength}`),i){case 1:V=this._unpackBinaryV1Async(b,e);break;case 2:V=this._unpackBinaryV2Async(b,e);break;default:throw new Error("Unsupported version: "+i)}return this._endPerformanceCounter("Unpack Binary"),V}))}_unpackBinaryV1Async(b,n){const i=b.readUint32(),e=b.readUint32();if(0!==e)throw new Error(`Unexpected content format: ${e}`);const V=n-b.byteOffset,Q={json:this._parseJson(b.readString(i)),bin:null};if(0!==V){const n=b.byteOffset;Q.bin={readAsync:(i,e)=>b.buffer.readAsync(n+i,e),byteLength:V}}return Promise.resolve(Q)}_unpackBinaryV2Async(b,n){const i=1313821514,e=5130562,V=b.readUint32();if(b.readUint32()!==i)throw new Error("First chunk format is not JSON");return b.byteOffset+V===n?b.loadAsync(V).then((()=>({json:this._parseJson(b.readString(V)),bin:null}))):b.loadAsync(V+8).then((()=>{const Q={json:this._parseJson(b.readString(V)),bin:null},U=()=>{const V=b.readUint32();switch(b.readUint32()){case i:throw new Error("Unexpected JSON chunk");case e:{const n=b.byteOffset;Q.bin={readAsync:(i,e)=>b.buffer.readAsync(n+i,e),byteLength:V},b.skipBytes(V);break}default:b.skipBytes(V)}return b.byteOffset!==n?b.loadAsync(8).then(U):Promise.resolve(Q)};return U()}))}static _parseVersion(b){if("1.0"===b||"1.0.1"===b)return{major:1,minor:0};const n=(b+"").match(/^(\d+)\.(\d+)/);return n?{major:parseInt(n[1]),minor:parseInt(n[2])}:null}static _compareVersion(b,n){return b.major>n.major?1:b.major<n.major?-1:b.minor>n.minor?1:b.minor<n.minor?-1:0}_logOpen(b){this._log(b),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(b){const n=C._logSpaces.substring(0,2*this._logIndentLevel);B.b.Log(`${n}${b}`)}_logDisabled(b){}_startPerformanceCounterEnabled(b){V.Tools.StartPerformanceCounter(b)}_startPerformanceCounterDisabled(b){}_endPerformanceCounterEnabled(b){V.Tools.EndPerformanceCounter(b)}_endPerformanceCounterDisabled(b){}}C.IncrementalLoading=!0,C.HomogeneousCoordinates=!1,C._logSpaces="                                ",(0,Q.d)(new C)},13460:(b,n,i)=>{"use strict";i.d(n,{c:()=>U});var e=i(11605);function V(b,n,i,e){const V={externalResourceFunction:e};return i&&(V.uri="file:"===n?i:n+i),ArrayBuffer.isView(b)?GLTFValidator.validateBytes(b,V):GLTFValidator.validateString(b,V)}function Q(){const b=[];onmessage=n=>{const i=n.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":V(i.data,i.rootUrl,i.fileName,(n=>new Promise(((i,e)=>{const V=b.length;b.push({resolve:i,reject:e}),postMessage({id:"getExternalResource",index:V,uri:n})})))).then((b=>{postMessage({id:"validate.resolve",value:b})}),(b=>{postMessage({id:"validate.reject",reason:b})}));break;case"getExternalResource.resolve":b[i.index].resolve(i.value);break;case"getExternalResource.reject":b[i.index].reject(i.reason)}}}class U{static ValidateAsync(b,n,i,U){return"function"===typeof Worker?new Promise(((Y,L)=>{const B=`${V}(${Q})()`,mb=URL.createObjectURL(new Blob([B],{type:"application/javascript"})),N=new Worker(mb),Z=b=>{N.removeEventListener("error",Z),N.removeEventListener("message",T),L(b)},T=b=>{const n=b.data;switch(n.id){case"getExternalResource":U(n.uri).then((b=>{N.postMessage({id:"getExternalResource.resolve",index:n.index,value:b},[b.buffer])}),(b=>{N.postMessage({id:"getExternalResource.reject",index:n.index,reason:b})}));break;case"validate.resolve":N.removeEventListener("error",Z),N.removeEventListener("message",T),Y(n.value),N.terminate();break;case"validate.reject":N.removeEventListener("error",Z),N.removeEventListener("message",T),L(n.reason),N.terminate()}};if(N.addEventListener("error",Z),N.addEventListener("message",T),N.postMessage({id:"init",url:e.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(b)){const e=b.slice();N.postMessage({id:"validate",data:e,rootUrl:n,fileName:i},[e.buffer])}else N.postMessage({id:"validate",data:b,rootUrl:n,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=e.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>V(b,n,i,U))))}}U.Configuration={url:`${e.Tools._DefaultCdnUrl}/gltf_validator.js`}},14033:(b,n,i)=>{"use strict";i.d(n,{b:()=>j});var e=i(11756),V=i(11762),Q=i(11811),U=i(11778),Y=i(12159),L=i(12090),B=i(11842),mb=i(12005),N=i(11734),Z=i(11686);i(13218),i(13109),i(13131),i(13118),i(13137),i(13141),i(13150);const T="imageProcessingCompatibility",z="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Z.c.IncludesShadersStore[T]||(Z.c.IncludesShadersStore[T]=z);const K="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Z.c.ShadersStore[K]||(Z.c.ShadersStore[K]=I);i(13227),i(13156),i(13158),i(13170),i(13163);const O="skyVertexShader",u="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Z.c.ShadersStore[O]||(Z.c.ShadersStore[O]=u);var d=i(12081),G=i(12142),o=i(12134);class M extends Y.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class j extends L.c{constructor(b,n){super(b,n),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new U.On(0,100,0),this.useSunPosition=!1,this.cameraOffset=U.On.Zero(),this.up=U.On.Up(),this.dithering=!1,this._cameraPosition=U.On.Zero(),this._skyOrientation=new U.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(b,n){const i=n._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;n.materialDefines||(n.materialDefines=new M);const e=n.materialDefines,V=this.ab();if(this._isReadyForSubMesh(n))return!0;if((0,o.Z)(b,V,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,e),(0,o.P)(b,e,!0,!1),e.IMAGEPROCESSINGPOSTPROCESS!==V.imageProcessingConfiguration.applyByPostProcess&&e.markAsMiscDirty(),e.DITHER!==this.dithering&&e.markAsMiscDirty(),e.isDirty){e.markAsProcessed(),V.resetCachedMaterial();const b=new d.b;e.FOG&&b.addFallback(1,"FOG"),e.IMAGEPROCESSINGPOSTPROCESS=V.imageProcessingConfiguration.applyByPostProcess,e.DITHER=this.dithering;const i=[B.g.PositionKind];e.VERTEXCOLOR&&i.push(B.g.ColorKind);const Q="sky",U=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,G.c)(U);const Y=e.toString();n.setEffect(V.getEngine().createEffect(Q,i,U,[],Y,b,this.onCompiled,this.onError),e,this._materialContext)}return!(!n.effect||!n.effect.isReady())&&(e._renderId=V.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(b,n,i){const e=this.ab(),V=i.materialDefines;if(!V)return;const Q=i.effect;if(!Q)return;this._activeEffect=Q,this.bindOnlyWorldMatrix(b),this._activeEffect.setMatrix("viewProjection",e.getTransformMatrix()),this._mustRebind(e,Q,i)&&((0,G.d)(Q,this,e),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,o.k)(V,Q,e)),e.fogEnabled&&n.applyFog&&e.fogMode!==mb.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",e.getViewMatrix()),(0,o.e)(e,n,this._activeEffect);const Y=e.activeCamera;if(Y){const b=Y.getWorldMatrix();this._cameraPosition.x=b.m[12],this._cameraPosition.y=b.m[13],this._cameraPosition.z=b.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const b=Math.PI*(this.inclination-.5),n=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(n)*Math.cos(b),this.sunPosition.y=this.distance*Math.sin(-b),this.sunPosition.z=this.distance*Math.sin(n)*Math.cos(b),U.Quaternion.FromUnitVectorsToRef(U.On.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(n,this._activeEffect,i)}getAnimatables(){return[]}dispose(b){super.dispose(b)}clone(b){return Q.c.Clone((()=>new j(b,this.ab())),this)}serialize(){const b=super.serialize();return b.customType="BABYLON.SkyMaterial",b}getClassName(){return"SkyMaterial"}static Parse(b,n,i){return Q.c.Parse((()=>new j(b.name,n)),b,n,i)}}(0,e.e)([(0,V.W)()],j.prototype,"luminance",void 0),(0,e.e)([(0,V.W)()],j.prototype,"turbidity",void 0),(0,e.e)([(0,V.W)()],j.prototype,"rayleigh",void 0),(0,e.e)([(0,V.W)()],j.prototype,"mieCoefficient",void 0),(0,e.e)([(0,V.W)()],j.prototype,"mieDirectionalG",void 0),(0,e.e)([(0,V.W)()],j.prototype,"distance",void 0),(0,e.e)([(0,V.W)()],j.prototype,"inclination",void 0),(0,e.e)([(0,V.W)()],j.prototype,"azimuth",void 0),(0,e.e)([(0,V.S)()],j.prototype,"sunPosition",void 0),(0,e.e)([(0,V.W)()],j.prototype,"useSunPosition",void 0),(0,e.e)([(0,V.S)()],j.prototype,"cameraOffset",void 0),(0,e.e)([(0,V.S)()],j.prototype,"up",void 0),(0,e.e)([(0,V.W)()],j.prototype,"dithering",void 0),(0,N.i)("BABYLON.SkyMaterial",j)},12483:(b,n,i)=>{"use strict";function e(b,n){n.headers=b.headers||{},n.statusMessage=b.statusText,n.statusCode=b.status,n.data=b.response}function V(b,n,i){return new Promise((function(V,Q){i=i||{};var U,Y,L,B=new XMLHttpRequest,mb=i.body,N=i.headers||{};for(U in i.timeout&&(B.timeout=i.timeout),B.ontimeout=B.onerror=function(b){b.timeout="timeout"==b.type,Q(b)},B.open(b,n.href||n),B.onload=function(){for(L=B.getAllResponseHeaders().trim().split(/[\r\n]+/),e(B,B);Y=L.shift();)Y=Y.split(": "),B.headers[Y.shift().toLowerCase()]=Y.join(": ");if((Y=B.headers["content-type"])&&~Y.indexOf("application/json"))try{B.data=JSON.parse(B.data,i.reviver)}catch(b){return e(B,b),Q(b)}(B.status>=400?Q:V)(B)},typeof FormData<"u"&&mb instanceof FormData||mb&&"object"==typeof mb&&(N["content-type"]="application/json",mb=JSON.stringify(mb)),B.withCredentials=!!i.withCredentials,N)B.setRequestHeader(U,N[U]);B.send(mb)}))}i.r(n),i.d(n,{del:()=>L,get:()=>Q,patch:()=>Y,post:()=>U,put:()=>B,send:()=>V});var Q=V.bind(V,"GET"),U=V.bind(V,"POST"),Y=V.bind(V,"PATCH"),L=V.bind(V,"DELETE"),B=V.bind(V,"PUT")},14141:(b,n,i)=>{"use strict";i.d(n,{b:()=>N});const e=.5*(Math.sqrt(3)-1),V=(3-Math.sqrt(3))/6,Q=1/3,U=1/6,Y=(Math.sqrt(5)-1)/4,L=(5-Math.sqrt(5))/20,B=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),mb=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const N=class{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const n="function"==typeof b?b:function(b){let n=0,i=0,e=0,V=1;const Q=function(){let b=4022871197;return function(n){n=n.toString();for(let i=0;i<n.length;i++){b+=n.charCodeAt(i);let e=.02519603282416938*b;b=e>>>0,e-=b,e*=b,b=e>>>0,e-=b,b+=4294967296*e}return 2.3283064365386963e-10*(b>>>0)}}();n=Q(" "),i=Q(" "),e=Q(" "),n-=Q(b),n<0&&(n+=1);i-=Q(b),i<0&&(i+=1);e-=Q(b),e<0&&(e+=1);return function(){const b=2091639*n+2.3283064365386963e-10*V;return n=i,i=e,e=b-(V=0|b)}}(b);this.p=function(b){const n=new Uint8Array(256);for(let i=0;i<256;i++)n[i]=i;for(let i=0;i<255;i++){const e=i+~~(b()*(256-i)),V=n[i];n[i]=n[e],n[e]=V}return n}(n),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}noise2D(b,n){const i=this.permMod12,Q=this.perm;let U=0,Y=0,L=0;const mb=(b+n)*e,N=Math.floor(b+mb),Z=Math.floor(n+mb),T=(N+Z)*V,z=b-(N-T),K=n-(Z-T);let I,O;z>K?(I=1,O=0):(I=0,O=1);const u=z-I+V,d=K-O+V,G=z-1+2*V,o=K-1+2*V,M=255&N,j=255&Z;let a=.5-z*z-K*K;if(a>=0){const b=3*i[M+Q[j]];a*=a,U=a*a*(B[b]*z+B[b+1]*K)}let D=.5-u*u-d*d;if(D>=0){const b=3*i[M+I+Q[j+O]];D*=D,Y=D*D*(B[b]*u+B[b+1]*d)}let x=.5-G*G-o*o;if(x>=0){const b=3*i[M+1+Q[j+1]];x*=x,L=x*x*(B[b]*G+B[b+1]*o)}return 70*(U+Y+L)}noise3D(b,n,i){const e=this.permMod12,V=this.perm;let Y,L,mb,N;const Z=(b+n+i)*Q,T=Math.floor(b+Z),z=Math.floor(n+Z),K=Math.floor(i+Z),I=(T+z+K)*U,O=b-(T-I),u=n-(z-I),d=i-(K-I);let G,o,M,j,a,D;O>=u?u>=d?(G=1,o=0,M=0,j=1,a=1,D=0):O>=d?(G=1,o=0,M=0,j=1,a=0,D=1):(G=0,o=0,M=1,j=1,a=0,D=1):u<d?(G=0,o=0,M=1,j=0,a=1,D=1):O<d?(G=0,o=1,M=0,j=0,a=1,D=1):(G=0,o=1,M=0,j=1,a=1,D=0);const x=O-G+U,y=u-o+U,s=d-M+U,A=O-j+2*U,E=u-a+2*U,C=d-D+2*U,t=O-1+.5,w=u-1+.5,h=d-1+.5,W=255&T,J=255&z,R=255&K;let k=.6-O*O-u*u-d*d;if(k<0)Y=0;else{const b=3*e[W+V[J+V[R]]];k*=k,Y=k*k*(B[b]*O+B[b+1]*u+B[b+2]*d)}let r=.6-x*x-y*y-s*s;if(r<0)L=0;else{const b=3*e[W+G+V[J+o+V[R+M]]];r*=r,L=r*r*(B[b]*x+B[b+1]*y+B[b+2]*s)}let X=.6-A*A-E*E-C*C;if(X<0)mb=0;else{const b=3*e[W+j+V[J+a+V[R+D]]];X*=X,mb=X*X*(B[b]*A+B[b+1]*E+B[b+2]*C)}let g=.6-t*t-w*w-h*h;if(g<0)N=0;else{const b=3*e[W+1+V[J+1+V[R+1]]];g*=g,N=g*g*(B[b]*t+B[b+1]*w+B[b+2]*h)}return 32*(Y+L+mb+N)}noise4D(b,n,i,e){const V=this.perm;let Q,U,B,N,Z;const T=(b+n+i+e)*Y,z=Math.floor(b+T),K=Math.floor(n+T),I=Math.floor(i+T),O=Math.floor(e+T),u=(z+K+I+O)*L,d=b-(z-u),G=n-(K-u),o=i-(I-u),M=e-(O-u);let j=0,a=0,D=0,x=0;d>G?j++:a++,d>o?j++:D++,d>M?j++:x++,G>o?a++:D++,G>M?a++:x++,o>M?D++:x++;const y=j>=3?1:0,s=a>=3?1:0,A=D>=3?1:0,E=x>=3?1:0,C=j>=2?1:0,t=a>=2?1:0,w=D>=2?1:0,h=x>=2?1:0,W=j>=1?1:0,J=a>=1?1:0,R=D>=1?1:0,k=x>=1?1:0,r=d-y+L,X=G-s+L,g=o-A+L,P=M-E+L,c=d-C+2*L,q=G-t+2*L,S=o-w+2*L,H=M-h+2*L,l=d-W+3*L,v=G-J+3*L,p=o-R+3*L,f=M-k+3*L,F=d-1+4*L,bb=G-1+4*L,nb=o-1+4*L,ib=M-1+4*L,eb=255&z,Vb=255&K,Qb=255&I,Ub=255&O;let Yb=.6-d*d-G*G-o*o-M*M;if(Yb<0)Q=0;else{const b=V[eb+V[Vb+V[Qb+V[Ub]]]]%32*4;Yb*=Yb,Q=Yb*Yb*(mb[b]*d+mb[b+1]*G+mb[b+2]*o+mb[b+3]*M)}let Lb=.6-r*r-X*X-g*g-P*P;if(Lb<0)U=0;else{const b=V[eb+y+V[Vb+s+V[Qb+A+V[Ub+E]]]]%32*4;Lb*=Lb,U=Lb*Lb*(mb[b]*r+mb[b+1]*X+mb[b+2]*g+mb[b+3]*P)}let Bb=.6-c*c-q*q-S*S-H*H;if(Bb<0)B=0;else{const b=V[eb+C+V[Vb+t+V[Qb+w+V[Ub+h]]]]%32*4;Bb*=Bb,B=Bb*Bb*(mb[b]*c+mb[b+1]*q+mb[b+2]*S+mb[b+3]*H)}let mn=.6-l*l-v*v-p*p-f*f;if(mn<0)N=0;else{const b=V[eb+W+V[Vb+J+V[Qb+R+V[Ub+k]]]]%32*4;mn*=mn,N=mn*mn*(mb[b]*l+mb[b+1]*v+mb[b+2]*p+mb[b+3]*f)}let Nb=.6-F*F-bb*bb-nb*nb-ib*ib;if(Nb<0)Z=0;else{const b=V[eb+1+V[Vb+1+V[Qb+1+V[Ub+1]]]]%32*4;Nb*=Nb,Z=Nb*Nb*(mb[b]*F+mb[b+1]*bb+mb[b+2]*nb+mb[b+3]*ib)}return 27*(Q+U+B+N+Z)}}}}]);