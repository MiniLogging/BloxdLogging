/*! For license information please see d0h99.32.6c143260.chunk.js.LICENSE.txt */
(self.qcdfysujsyf=self.qcdfysujsyf||[]).push([[32],{14554:(K,A,T)=>{"use strict";var G=T(14556),B=T(14563),L=T(14568);T.g.__TYPEDARRAY_POOL||(T.g.__TYPEDARRAY_POOL={UINT8:B([32,0]),UINT16:B([32,0]),UINT32:B([32,0]),INT8:B([32,0]),INT16:B([32,0]),INT32:B([32,0]),FLOAT:B([32,0]),DOUBLE:B([32,0]),DATA:B([32,0]),UINT8C:B([32,0]),BUFFER:B([32,0])});var f="undefined"!==typeof Uint8ClampedArray,O=T.g.__TYPEDARRAY_POOL;O.UINT8C||(O.UINT8C=B([32,0])),O.BUFFER||(O.BUFFER=B([32,0]));var C=O.DATA,Q=O.BUFFER;function Y(K){if(K){var A=K.length||K.byteLength,T=G.log2(A);C[T].push(K)}}function Z(K){K=G.nextPow2(K);var A=G.log2(K),T=C[A];return T.length>0?T.pop():new ArrayBuffer(K)}function x(K){return new Uint8Array(Z(K),0,K)}function J(K){return new Uint16Array(Z(2*K),0,K)}function b(K){return new Uint32Array(Z(4*K),0,K)}function P(K){return new Int8Array(Z(K),0,K)}function F(K){return new Int16Array(Z(2*K),0,K)}function d(K){return new Int32Array(Z(4*K),0,K)}function N(K){return new Float32Array(Z(4*K),0,K)}function D(K){return new Float64Array(Z(8*K),0,K)}function mK(K){return f?new Uint8ClampedArray(Z(K),0,K):x(K)}function U(K){return new DataView(Z(K),0,K)}A.free=function(K){if(L(K))Q[G.log2(K.length)].push(K);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(K)&&(K=K.buffer),!K)return;var A=K.length||K.byteLength,T=0|G.log2(A);C[T].push(K)}},A.freeUint8=A.freeUint16=A.freeUint32=A.freeInt8=A.freeInt16=A.freeInt32=A.freeFloat32=A.freeFloat=A.freeFloat64=A.freeDouble=A.freeUint8Clamped=A.freeDataView=function(K){Y(K.buffer)},A.freeArrayBuffer=Y,A.freeBuffer=function(K){Q[G.log2(K.length)].push(K)},A.malloc=function(K,A){if(void 0===A||"arraybuffer"===A)return Z(K);switch(A){case"uint8":return x(K);case"uint16":return J(K);case"uint32":return b(K);case"int8":return P(K);case"int16":return F(K);case"int32":return d(K);case"float":case"float32":return N(K);case"double":case"float64":return D(K);case"uint8_clamped":return mK(K);case"buffer":throw"Buffer not supported";case"data":case"dataview":return U(K);default:return null}return null},A.mallocArrayBuffer=Z,A.mallocUint8=x,A.mallocUint16=J,A.mallocUint32=b,A.mallocInt8=P,A.mallocInt16=F,A.mallocInt32=d,A.mallocFloat32=A.mallocFloat=N,A.mallocFloat64=A.mallocDouble=D,A.mallocUint8Clamped=mK,A.mallocDataView=U,A.clearCache=function(){for(var K=0;K<32;++K)O.UINT8[K].length=0,O.UINT16[K].length=0,O.UINT32[K].length=0,O.INT8[K].length=0,O.INT16[K].length=0,O.INT32[K].length=0,O.FLOAT[K].length=0,O.DOUBLE[K].length=0,O.UINT8C[K].length=0,C[K].length=0,Q[K].length=0}},14633:(K,A,T)=>{K.exports=B;var G=T(13508);function B(K,A){if(!(this instanceof B))return new B(K,A);var T=G.create();G.add(T,K,A),this.base=G.min(G.create(),K,T),this.bY=G.clone(A),this.max=G.max(G.create(),K,T),this.mag=G.length(this.bY)}var L=B.prototype;L.width=function(){return this.bY[0]},L.height=function(){return this.bY[1]},L.depth=function(){return this.bY[2]},L.x0=function(){return this.base[0]},L.y0=function(){return this.base[1]},L.z0=function(){return this.base[2]},L.x1=function(){return this.max[0]},L.y1=function(){return this.max[1]},L.z1=function(){return this.max[2]},L.translate=function(K){return G.add(this.max,this.max,K),G.add(this.base,this.base,K),this},L.setPosition=function(K){return G.add(this.max,K,this.bY),G.i(this.base,K),this},L.expand=function(K){var A=G.create(),T=G.create();return G.max(A,K.max,this.max),G.min(T,K.base,this.base),G.FA(A,A,T),new B(T,A)},L.intersects=function(K){return!(K.base[0]>this.max[0])&&(!(K.base[1]>this.max[1])&&(!(K.base[2]>this.max[2])&&(!(K.max[0]<this.base[0])&&(!(K.max[1]<this.base[1])&&!(K.max[2]<this.base[2])))))},L.touches=function(K){var A=this.union(K);return null!==A&&(0==A.width()||0==A.height()||0==A.depth())},L.union=function(K){if(!this.intersects(K))return null;var A=Math.max(K.base[0],this.base[0]),T=Math.max(K.base[1],this.base[1]),G=Math.max(K.base[2],this.base[2]);return new B([A,T,G],[Math.min(K.max[0],this.max[0])-A,Math.min(K.max[1],this.max[1])-T,Math.min(K.max[2],this.max[2])-G])}},14556:(K,A)=>{"use strict";function T(K){var A=32;return(K&=-K)&&A--,65535&K&&(A-=16),16711935&K&&(A-=8),252645135&K&&(A-=4),858993459&K&&(A-=2),1431655765&K&&(A-=1),A}A.INT_BITS=32,A.INT_MAX=2147483647,A.INT_MIN=-1<<31,A.sign=function(K){return(K>0)-(K<0)},A.abs=function(K){var A=K>>31;return(K^A)-A},A.min=function(K,A){return A^(K^A)&-(K<A)},A.max=function(K,A){return K^(K^A)&-(K<A)},A.isPow2=function(K){return!(K&K-1)&&!!K},A.log2=function(K){var A,T;return A=(K>65535)<<4,A|=T=((K>>>=A)>255)<<3,A|=T=((K>>>=T)>15)<<2,(A|=T=((K>>>=T)>3)<<1)|(K>>>=T)>>1},A.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},A.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},A.countTrailingZeros=T,A.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},A.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},A.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var G=new Array(256);!function(K){for(var A=0;A<256;++A){var T=A,G=A,B=7;for(T>>>=1;T;T>>>=1)G<<=1,G|=1&T,--B;K[A]=G<<B&255}}(G),A.reverse=function(K){return G[255&K]<<24|G[K>>>8&255]<<16|G[K>>>16&255]<<8|G[K>>>24&255]},A.interleave2=function(K,A){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))<<1},A.deinterleave2=function(K,A){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>A&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},A.interleave3=function(K,A,T){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},A.deinterleave3=function(K,A){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>A&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},A.nextCombination=function(K){var A=K|K-1;return A+1|(~A&-~A)-1>>>T(K)+1}},14549:(K,A,T)=>{"use strict";K.exports=function(K,A,T){switch(arguments.length){case 1:return G=[],Q(B=K,B,Y,!0),G;case 2:return"function"===typeof A?Q(K,K,A,!0):function(K,A){return G=[],Q(K,A,Y,!1),G}(K,A);case 3:return Q(K,A,T,!1);default:throw new Error("box-intersect: Invalid arguments")}var B};var G,B=T(14554),L=T(14572),f=T(14582);function O(K,A){for(var T=0;T<K;++T)if(!(A[T]<=A[T+K]))return!0;return!1}function C(K,A,T,G){for(var B=0,L=0,f=0,C=K.length;f<C;++f){var Q=K[f];if(!O(A,Q)){for(var Y=0;Y<2*A;++Y)T[B++]=Q[Y];G[L++]=f}}return L}function Q(K,A,T,G){var O=K.length,Q=A.length;if(!(O<=0||Q<=0)){var Y=K[0].length>>>1;if(!(Y<=0)){var Z,x=B.mallocDouble(2*Y*O),J=B.mallocInt32(O);if((O=C(K,Y,x,J))>0){if(1===Y&&G)L.init(O),Z=L.sweepComplete(Y,T,0,O,x,J,0,O,x,J);else{var b=B.mallocDouble(2*Y*Q),P=B.mallocInt32(Q);(Q=C(A,Y,b,P))>0&&(L.init(O+Q),Z=1===Y?L.sweepBipartite(Y,T,0,O,x,J,0,Q,b,P):f(Y,T,G,O,x,J,Q,b,P),B.free(b),B.free(P))}B.free(x),B.free(J)}return Z}}}function Y(K,A){G.push([K,A])}},14588:(K,A)=>{"use strict";var T="d",G="ax",B="fp",L="es",f="rs",O="re",C="rb",Q="bs",Y="be",Z="bb",x=[T,G,"vv",f,O,C,"ri",Q,Y,Z,"bi"];function J(K){var A="bruteForce"+(K?"Full":"Partial"),G=[],f=x.slice();K||f.splice(3,0,B);var O=["function "+A+"("+f.join()+"){"];function C(A,B){var f=function(K,A,G){var B="bruteForce"+(K?"Red":"Blue")+(A?"Flip":"")+(G?"Full":""),f=["function ",B,"(",x.join(),"){","var ",L,"=2*",T,";"],O="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",C="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(G?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return K?f.push(O,"Q",":",C):f.push(C,"Q",":",O),G?f.push("if(y1<x0||x1<y0)continue;"):A?f.push("if(y0<=x0||x1<y0)continue;"):f.push("if(y0<x0||x1<y0)continue;"),f.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),A?f.push("yi,xi"):f.push("xi,yi"),f.push(");if(rv!==void 0)return rv;}}}"),{name:B,code:f.join("")}}(A,B,K);G.push(f.code),O.push("return "+f.name+"("+x.join()+");")}O.push("if(re-rs>be-bs){"),K?(C(!0,!1),O.push("}else{"),C(!1,!1)):(O.push("if(fp){"),C(!0,!0),O.push("}else{"),C(!0,!1),O.push("}}else{if(fp){"),C(!1,!0),O.push("}else{"),C(!1,!1),O.push("}")),O.push("}}return "+A);var Q=G.join("")+O.join("");return new Function(Q)()}A.partial=J(!1),A.full=J(!0)},14582:(K,A,T)=>{"use strict";K.exports=function(K,A,T,L,Y,c,n,H,e){!function(K,A){var T=8*B.log2(A+1)*(K+1)|0,L=B.nextPow2(mK*T);z.length<L&&(G.free(z),z=G.mallocInt32(L));var f=B.nextPow2(U*T);g.length<f&&(G.free(g),g=G.mallocDouble(f))}(K,L+n);var p,r=0,h=2*K;S(r++,0,0,L,0,n,T?16:0,-1/0,1/0),T||S(r++,0,0,n,0,L,1,-1/0,1/0);for(;r>0;){var k=(r-=1)*mK,s=z[k],j=z[k+1],R=z[k+2],v=z[k+3],I=z[k+4],o=z[k+5],W=r*U,i=g[W],V=g[W+1],X=1&o,q=!!(16&o),y=Y,w=c,a=H,M=e;if(X&&(y=H,w=e,a=Y,M=c),!(2&o&&j>=(R=F(K,s,j,R,y,w,V)))&&!(4&o&&(j=d(K,s,j,R,y,w,i))>=R)){var E=R-j,t=I-v;if(q){if(K*E*(E+t)<J){if(void 0!==(p=C.scanComplete(K,s,A,j,R,y,w,v,I,a,M)))return p;continue}}else{if(K*Math.min(E,t)<Z){if(void 0!==(p=f(K,s,A,X,j,R,y,w,v,I,a,M)))return p;continue}if(K*E*t<x){if(void 0!==(p=C.scanBipartite(K,s,A,X,j,R,y,w,v,I,a,M)))return p;continue}}var KK=b(K,s,j,R,y,w,i,V);if(j<KK)if(K*(KK-j)<Z){if(void 0!==(p=O(K,s+1,A,j,KK,y,w,v,I,a,M)))return p}else if(s===K-2){if(void 0!==(p=X?C.sweepBipartite(K,A,v,I,a,M,j,KK,y,w):C.sweepBipartite(K,A,j,KK,y,w,v,I,a,M)))return p}else S(r++,s+1,j,KK,v,I,X,-1/0,1/0),S(r++,s+1,v,I,j,KK,1^X,-1/0,1/0);if(KK<R){var AK=Q(K,s,v,I,a,M),TK=a[h*AK+s],GK=P(K,s,AK,I,a,M,TK);if(GK<I&&S(r++,s,KK,R,GK,I,(4|X)+(q?16:0),TK,V),v<AK&&S(r++,s,KK,R,v,AK,(2|X)+(q?16:0),i,TK),AK+1===GK){if(void 0!==(p=q?u(K,s,A,KK,R,y,w,AK,a,M[AK]):l(K,s,A,X,KK,R,y,w,AK,a,M[AK])))return p}else if(AK<GK){var BK;if(q){if(KK<(BK=N(K,s,KK,R,y,w,TK))){var LK=P(K,s,KK,BK,y,w,TK);if(s===K-2){if(KK<LK&&void 0!==(p=C.sweepComplete(K,A,KK,LK,y,w,AK,GK,a,M)))return p;if(LK<BK&&void 0!==(p=C.sweepBipartite(K,A,LK,BK,y,w,AK,GK,a,M)))return p}else KK<LK&&S(r++,s+1,KK,LK,AK,GK,16,-1/0,1/0),LK<BK&&(S(r++,s+1,LK,BK,AK,GK,0,-1/0,1/0),S(r++,s+1,AK,GK,LK,BK,1,-1/0,1/0))}}else KK<(BK=X?D(K,s,KK,R,y,w,TK):N(K,s,KK,R,y,w,TK))&&(s===K-2?p=X?C.sweepBipartite(K,A,AK,GK,a,M,KK,BK,y,w):C.sweepBipartite(K,A,KK,BK,y,w,AK,GK,a,M):(S(r++,s+1,KK,BK,AK,GK,X,-1/0,1/0),S(r++,s+1,AK,GK,KK,BK,1^X,-1/0,1/0)))}}}}};var G=T(14554),B=T(14556),L=T(14588),f=L.partial,O=L.full,C=T(14572),Q=T(14597),Y=T(14600),Z=128,x=1<<22,J=1<<22,b=Y("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),P=Y("lo===p0",["p0"]),F=Y("lo<p0",["p0"]),d=Y("hi<=p0",["p0"]),N=Y("lo<=p0&&p0<=hi",["p0"]),D=Y("lo<p0&&p0<=hi",["p0"]),mK=6,U=2,z=G.mallocInt32(1024),g=G.mallocDouble(1024);function S(K,A,T,G,B,L,f,O,C){var Q=mK*K;z[Q]=A,z[Q+1]=T,z[Q+2]=G,z[Q+3]=B,z[Q+4]=L,z[Q+5]=f;var Y=U*K;g[Y]=O,g[Y+1]=C}function l(K,A,T,G,B,L,f,O,C,Q,Y){var Z=2*K,x=C*Z,J=Q[x+A];K:for(var b=B,P=B*Z;b<L;++b,P+=Z){var F=f[P+A],d=f[P+A+K];if(!(J<F||d<J)&&(!G||J!==F)){for(var N,D=O[b],mK=A+1;mK<K;++mK){F=f[P+mK],d=f[P+mK+K];var U=Q[x+mK],z=Q[x+mK+K];if(d<U||z<F)continue K}if(void 0!==(N=G?T(Y,D):T(D,Y)))return N}}}function u(K,A,T,G,B,L,f,O,C,Q){var Y=2*K,Z=O*Y,x=C[Z+A];K:for(var J=G,b=G*Y;J<B;++J,b+=Y){var P=f[J];if(P!==Q){var F=L[b+A],d=L[b+A+K];if(!(x<F||d<x)){for(var N=A+1;N<K;++N){F=L[b+N],d=L[b+N+K];var D=C[Z+N],mK=C[Z+N+K];if(d<D||mK<F)continue K}var U=T(P,Q);if(void 0!==U)return U}}}}},14597:(K,A,T)=>{"use strict";K.exports=function(K,A,T,f,O,C){if(f<=T+1)return T;var Q=T,Y=f,Z=f+T>>>1,x=2*K,J=Z,b=O[x*Z+A];for(;Q<Y;){if(Y-Q<B){L(K,A,Q,Y,O,C),b=O[x*Z+A];break}var P=Y-Q,F=Math.random()*P+Q|0,d=O[x*F+A],N=Math.random()*P+Q|0,D=O[x*N+A],mK=Math.random()*P+Q|0,U=O[x*mK+A];d<=D?U>=D?(J=N,b=D):d>=U?(J=F,b=d):(J=mK,b=U):D>=U?(J=N,b=D):U>=d?(J=F,b=d):(J=mK,b=U);for(var z=x*(Y-1),g=x*J,S=0;S<x;++S,++z,++g){var l=O[z];O[z]=O[g],O[g]=l}var u=C[Y-1];C[Y-1]=C[J],C[J]=u;for(z=x*(Y-1),g=x*(J=G(K,A,Q,Y-1,O,C,b)),S=0;S<x;++S,++z,++g){l=O[z];O[z]=O[g],O[g]=l}u=C[Y-1];if(C[Y-1]=C[J],C[J]=u,Z<J){for(Y=J-1;Q<Y&&O[x*(Y-1)+A]===b;)Y-=1;Y+=1}else{if(!(J<Z))break;for(Q=J+1;Q<Y&&O[x*Q+A]===b;)Q+=1}}return G(K,A,T,Z,O,C,O[x*Z+A])};var G=T(14600)("lo<p0",["p0"]),B=8;function L(K,A,T,G,B,L){for(var f=2*K,O=f*(T+1)+A,C=T+1;C<G;++C,O+=f)for(var Q=B[O],Y=C,Z=f*(C-1);Y>T&&B[Z+A]>Q;--Y,Z-=f){for(var x=Z,J=Z+f,b=0;b<f;++b,++x,++J){var P=B[x];B[x]=B[J],B[J]=P}var F=L[Y];L[Y]=L[Y-1],L[Y-1]=F}}},14600:K=>{"use strict";K.exports=function(K,T){var G="abcdef".split("").concat(T),B=[];K.indexOf("lo")>=0&&B.push("lo=e[k+n]");K.indexOf("hi")>=0&&B.push("hi=e[k+o]");return G.push(A.replace("_",B.join()).replace("$",K)),Function.apply(void 0,G)};var A="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14579:K=>{"use strict";K.exports=function(K,G){G<=4*A?T(0,G-1,K):Q(0,G-1,K)};var A=32;function T(K,A,T){for(var G=2*(K+1),B=K+1;B<=A;++B){for(var L=T[G++],f=T[G++],O=B,C=G-2;O-- >K;){var Q=T[C-2],Y=T[C-1];if(Q<L)break;if(Q===L&&Y<f)break;T[C]=Q,T[C+1]=Y,C-=2}T[C]=L,T[C+1]=f}}function G(K,A,T){A*=2;var G=T[K*=2],B=T[K+1];T[K]=T[A],T[K+1]=T[A+1],T[A]=G,T[A+1]=B}function B(K,A,T){A*=2,T[K*=2]=T[A],T[K+1]=T[A+1]}function L(K,A,T,G){A*=2,T*=2;var B=G[K*=2],L=G[K+1];G[K]=G[A],G[K+1]=G[A+1],G[A]=G[T],G[A+1]=G[T+1],G[T]=B,G[T+1]=L}function f(K,A,T,G,B){A*=2,B[K*=2]=B[A],B[A]=T,B[K+1]=B[A+1],B[A+1]=G}function O(K,A,T){A*=2;var G=T[K*=2],B=T[A];return!(G<B)&&(G!==B||T[K+1]>T[A+1])}function C(K,A,T,G){var B=G[K*=2];return B<A||B===A&&G[K+1]<T}function Q(K,Y,Z){var x=(Y-K+1)/6|0,J=K+x,b=Y-x,P=K+Y>>1,F=P-x,d=P+x,N=J,D=F,mK=P,U=d,z=b,g=K+1,S=Y-1,l=0;O(N,D,Z)&&(l=N,N=D,D=l),O(U,z,Z)&&(l=U,U=z,z=l),O(N,mK,Z)&&(l=N,N=mK,mK=l),O(D,mK,Z)&&(l=D,D=mK,mK=l),O(N,U,Z)&&(l=N,N=U,U=l),O(mK,U,Z)&&(l=mK,mK=U,U=l),O(D,z,Z)&&(l=D,D=z,z=l),O(D,mK,Z)&&(l=D,D=mK,mK=l),O(U,z,Z)&&(l=U,U=z,z=l);for(var u=Z[2*D],c=Z[2*D+1],n=Z[2*U],H=Z[2*U+1],e=2*N,p=2*mK,r=2*z,h=2*J,k=2*P,s=2*b,j=0;j<2;++j){var R=Z[e+j],v=Z[p+j],I=Z[r+j];Z[h+j]=R,Z[k+j]=v,Z[s+j]=I}B(F,K,Z),B(d,Y,Z);for(var o=g;o<=S;++o)if(C(o,u,c,Z))o!==g&&G(o,g,Z),++g;else if(!C(o,n,H,Z))for(;;){if(C(S,n,H,Z)){C(S,u,c,Z)?(L(o,g,S,Z),++g,--S):(G(o,S,Z),--S);break}if(--S<o)break}f(K,g-1,u,c,Z),f(Y,S+1,n,H,Z),g-2-K<=A?T(K,g-2,Z):Q(K,g-2,Z),Y-(S+2)<=A?T(S+2,Y,Z):Q(S+2,Y,Z),S-g<=A?T(g,S,Z):Q(g,S,Z)}},14572:(K,A,T)=>{"use strict";K.exports={init:function(K){var A=B.nextPow2(K);C.length<A&&(G.free(C),C=G.mallocInt32(A));Q.length<A&&(G.free(Q),Q=G.mallocInt32(A));Y.length<A&&(G.free(Y),Y=G.mallocInt32(A));Z.length<A&&(G.free(Z),Z=G.mallocInt32(A));x.length<A&&(G.free(x),x=G.mallocInt32(A));J.length<A&&(G.free(J),J=G.mallocInt32(A));var T=8*A;b.length<T&&(G.free(b),b=G.mallocDouble(T))},sweepBipartite:function(K,A,T,G,B,O,x,J,d,N){for(var D=0,mK=2*K,U=K-1,z=mK-1,g=T;g<G;++g){var S=O[g],l=mK*g;b[D++]=B[l+U],b[D++]=-(S+1),b[D++]=B[l+z],b[D++]=S}for(g=x;g<J;++g){S=N[g]+f;var u=mK*g;b[D++]=d[u+U],b[D++]=-S,b[D++]=d[u+z],b[D++]=S}var c=D>>>1;L(b,c);var n=0,H=0;for(g=0;g<c;++g){var e=0|b[2*g+1];if(e>=f)P(Y,Z,H--,e=e-f|0);else if(e>=0)P(C,Q,n--,e);else if(e<=-f){e=-e-f|0;for(var p=0;p<n;++p){if(void 0!==(r=A(C[p],e)))return r}F(Y,Z,H++,e)}else{e=-e-1|0;for(p=0;p<H;++p){var r;if(void 0!==(r=A(e,Y[p])))return r}F(C,Q,n++,e)}}},sweepComplete:function(K,A,T,G,B,f,O,d,N,D){for(var mK=0,U=2*K,z=K-1,g=U-1,S=T;S<G;++S){var l=f[S]+1<<1,u=U*S;b[mK++]=B[u+z],b[mK++]=-l,b[mK++]=B[u+g],b[mK++]=l}for(S=O;S<d;++S){l=D[S]+1<<1;var c=U*S;b[mK++]=N[c+z],b[mK++]=1|-l,b[mK++]=N[c+g],b[mK++]=1|l}var n=mK>>>1;L(b,n);var H=0,e=0,p=0;for(S=0;S<n;++S){var r=0|b[2*S+1],h=1&r;if(S<n-1&&r>>1===b[2*S+3]>>1&&(h=2,S+=1),r<0){for(var k=-(r>>1)-1,s=0;s<p;++s){if(void 0!==(j=A(x[s],k)))return j}if(0!==h)for(s=0;s<H;++s){if(void 0!==(j=A(C[s],k)))return j}if(1!==h)for(s=0;s<e;++s){var j;if(void 0!==(j=A(Y[s],k)))return j}0===h?F(C,Q,H++,k):1===h?F(Y,Z,e++,k):2===h&&F(x,J,p++,k)}else{k=(r>>1)-1;0===h?P(C,Q,H--,k):1===h?P(Y,Z,e--,k):2===h&&P(x,J,p--,k)}}},scanBipartite:function(K,A,T,G,B,O,Y,Z,x,J,d,N){var D=0,mK=2*K,U=A,z=A+K,g=1,S=1;G?S=f:g=f;for(var l=B;l<O;++l){var u=l+g,c=mK*l;b[D++]=Y[c+U],b[D++]=-u,b[D++]=Y[c+z],b[D++]=u}for(l=x;l<J;++l){u=l+S;var n=mK*l;b[D++]=d[n+U],b[D++]=-u}var H=D>>>1;L(b,H);var e=0;for(l=0;l<H;++l){var p=0|b[2*l+1];if(p<0){var r=!1;if((u=-p)>=f?(r=!G,u-=f):(r=!!G,u-=1),r)F(C,Q,e++,u);else{var h=N[u],k=mK*u,s=d[k+A+1],j=d[k+A+1+K];K:for(var R=0;R<e;++R){var v=C[R],I=mK*v;if(!(j<Y[I+A+1]||Y[I+A+1+K]<s)){for(var o=A+2;o<K;++o)if(d[k+o+K]<Y[I+o]||Y[I+o+K]<d[k+o])continue K;var W,i=Z[v];if(void 0!==(W=G?T(h,i):T(i,h)))return W}}}}else P(C,Q,e--,p-g)}},scanComplete:function(K,A,T,G,B,O,Q,Y,Z,x,J){for(var P=0,F=2*K,d=A,N=A+K,D=G;D<B;++D){var mK=D+f,U=F*D;b[P++]=O[U+d],b[P++]=-mK,b[P++]=O[U+N],b[P++]=mK}for(D=Y;D<Z;++D){mK=D+1;var z=F*D;b[P++]=x[z+d],b[P++]=-mK}var g=P>>>1;L(b,g);var S=0;for(D=0;D<g;++D){var l=0|b[2*D+1];if(l<0){if((mK=-l)>=f)C[S++]=mK-f;else{var u=J[mK-=1],c=F*mK,n=x[c+A+1],H=x[c+A+1+K];K:for(var e=0;e<S;++e){var p=C[e],r=Q[p];if(r===u)break;var h=F*p;if(!(H<O[h+A+1]||O[h+A+1+K]<n)){for(var k=A+2;k<K;++k)if(x[c+k+K]<O[h+k]||O[h+k+K]<x[c+k])continue K;var s=T(r,u);if(void 0!==s)return s}}}}else{for(mK=l-f,e=S-1;e>=0;--e)if(C[e]===mK){for(k=e+1;k<S;++k)C[k-1]=C[k];break}--S}}}};var G=T(14554),B=T(14556),L=T(14579),f=1<<28,O=1024,C=G.mallocInt32(O),Q=G.mallocInt32(O),Y=G.mallocInt32(O),Z=G.mallocInt32(O),x=G.mallocInt32(O),J=G.mallocInt32(O),b=G.mallocDouble(8192);function P(K,A,T,G){var B=A[G],L=K[T-1];K[B]=L,A[L]=B}function F(K,A,T,G){K[T]=G,A[G]=T}},14563:K=>{"use strict";function A(K,T,G){var B=0|K[G];if(B<=0)return[];var L,f=new Array(B);if(G===K.length-1)for(L=0;L<B;++L)f[L]=T;else for(L=0;L<B;++L)f[L]=A(K,T,G+1);return f}K.exports=function(K,T){switch("undefined"===typeof T&&(T=0),typeof K){case"number":if(K>0)return function(K,A){var T,G;for(T=new Array(K),G=0;G<K;++G)T[G]=A;return T}(0|K,T);break;case"object":if("number"===typeof K.length)return A(K,T,0)}return[]}},14514:(K,A,T)=>{K.exports=function(){var K=this;this.components={},this.comps=this.components;var A=this.components,T=1,B={},L=[],f=[],O={timeout:!1,removals:[],multiComps:[]};function C(K,T){var G=A[T],L=B[T],f=L.hash[K];f&&(L.remove(K),G.XL&&(G.multi?(f.forEach((A=>{A&&G.XL(K,A)})),f.length=0):G.XL(K,f)),O.removals.push(L),Q())}function Q(){O.timeout||(O.timeout=!0,setTimeout(Y,1))}function Y(){O.timeout=!1,Z()}function Z(){O.multiComps.length&&function(K){for(var A=0;A<K.length;A++){var{entID:T,data:G}=K[A],B=G.hash[T];if(B){for(var L=0;L<B.length;L++)B[L]||(B.splice(L,1),L--);0===B.length&&(G.remove(T),O.removals.push(G))}}K.length=0}(O.multiComps),O.removals.length&&function(K){for(var A=0;A<K.length;A++){K[A].flush()}K.length=0}(O.removals)}this.pZ=B,this._systems=L,this._renderSystems=f,this.QQ=function(A){var G=T++;return Array.isArray(A)&&A.forEach((A=>K.AQ(G,A))),G},this.deleteEntity=function(A){return Object.keys(B).forEach((K=>{B[K].hash[A]&&C(A,K)})),K},this.kY=function(K){if(!K)throw new Error("Missing component definition");var T=K.name;if(!T)throw new Error("Component definition must have a name property.");if("string"!==typeof T)throw new Error("Component name must be a string.");if(""===T)throw new Error("Component name must be a non-empty string.");if(B[T])throw new Error(`Component ${T} already exists.`);var O={};return O.name=T,O.multi=!!K.multi,O.order=isNaN(K.order)?99:K.order,O.stateConstructor=K.stateConstructor||null,O.state=K.state||{},O.tO=K.tO||null,O.XL=K.XL||null,O.system=K.system||null,O.LC=K.LC||null,A[T]=O,B[T]=new G,B[T]._pendingMultiCleanup=!1,B[T]._multiCleanupIDs=O.multi?[]:null,O.system&&(L.push(T),L.sort(((K,T)=>A[K].order-A[T].order))),O.LC&&(f.push(T),f.sort(((K,T)=>A[K].order-A[T].order))),T},this.overwriteComponent=function(K,T){var G=A[K];if(!G)throw new Error(`Unknown component: ${K}`);if(!T)throw new Error("Missing component definition");if(G.name!==T.name)throw new Error("Overwriting component must use the same name property.");var O={};O.name=K,O.multi=!!T.multi,O.order=isNaN(T.order)?99:T.order,O.state=T.state||{},O.tO=T.tO||null,O.XL=T.XL||null,O.system=T.system||null,O.LC=T.LC||null,A[K]=O,B[K]._pendingMultiCleanup=!1,B[K]._multiCleanupIDs=O.multi?[]:null;var C=L.indexOf(K);O.system&&C<0&&L.push(K),!O.system&&C>=0&&L.splice(C,1),L.sort(((K,T)=>A[K].order-A[T].order));var Q=f.indexOf(K);O.LC&&Q<0&&f.push(K),!O.LC&&Q>=0&&f.splice(Q,1),f.sort(((K,T)=>A[K].order-A[T].order));var Y=O.state;return this.tQ(K).forEach((K=>{for(var A in Y)A in K||(K[A]=Y[A]);O.tO&&O.tO(K.GC,K)})),K},this.deleteComponent=function(T){var G=B[T];if(!G)throw new Error(`Unknown component: ${T}`);G.flush(),G.list.forEach((K=>{K&&C(K.GC||K[0].GC,T)}));var O=L.indexOf(T),Q=f.indexOf(T);return O>-1&&L.splice(O,1),Q>-1&&f.splice(Q,1),B[T].dispose(),delete B[T],delete A[T],K},this.AQ=function(K,T,G){var L,f=A[T],O=B[T];if(!O)throw new Error(`Unknown component: ${T}.`);if(O.hash[K]&&!f.multi)throw new Error(`Entity ${K} already has component: ${T}.`);if(f.stateConstructor){if(!(L=new f.stateConstructor).hasOwnProperty("GC"))throw new Error(`Component ${f.name} stateConstructor type does not have property __id`)}else L=Object.assign({},{GC:K},f.state,G);if(L.GC=K,f.multi){var C=O.hash[K];C||(C=[],O.add(K,C)),C.push(L)}else O.add(K,L);return f.tO&&f.tO(K,L),this},this.xQ=function(K,A){var T=B[A];if(!T)throw new Error(`Unknown component: ${A}.`);return!!T.hash[K]},this.LQ=function(A,T){if(!B[T])throw new Error(`Unknown component: ${T}.`);return C(A,T),K},this.getState=function(K,A){var T=B[A];if(!T)throw new Error(`Unknown component: ${A}.`);return T.hash[K]},this.tQ=function(K){var A=B[K];if(!A)throw new Error(`Unknown component: ${K}.`);return Z(),A.list},this.eJ=function(K){if(!B[K])throw new Error(`Unknown component: ${K}.`);var A=B[K].hash;return K=>A[K]},this.hJ=function(K){if(!B[K])throw new Error(`Unknown component: ${K}.`);var A=B[K].hash;return K=>!!A[K]},this.jO=function(T){Z();for(var G=0;G<L.length;G++){var f=L[G],O=A[f],C=B[f];O.system(T,C.list),Z()}return K},this.render=function(T){Z();for(var G=0;G<f.length;G++){var L=f[G],O=A[L],C=B[L];O.LC(T,C.list),Z()}return K},this.removeMultiComponent=function(T,G,L){var f=A[G],C=B[G];if(!C)throw new Error(`Unknown component: ${G}.`);if(!f.multi)throw new Error("removeMultiComponent called on non-multi component");return function(K,A,T,G){var B=T.hash[K];if(B){var L=B[G];L&&(B[G]=null,A.XL&&A.XL(K,L),O.multiComps.push({entID:K,data:T}),Q())}}(T,f,C,L),K}};var G=T(14523)},14523:K=>{function A(K,A){var T=K._map[A];if(delete K.hash[A],delete K._map[A],T===K.list.length-1)K.list.pop();else{var G=K.list.pop();if(K.list[T]=G,null===G||null===G[0]){var B=K.list.length;for(var L in K._map)if(K._map[L]===B)return void(K._map[L]=T)}else{var f=G.GC||G[0].GC;K._map[f]=T}}}K.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(K,A){if("number"===typeof this._map[K]){var T=this._map[K];this.hash[K]=A,this.list[T]=A}else this._map[K]=this.list.length,this.hash[K]=A,this.list.push(A)}remove(K){var A=this._map[K];this.hash[K]=null,this.list[A]=null,this._pendingRemovals.push(K)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var K=0;K<this._pendingRemovals.length;K++){var T=this._pendingRemovals[K];null===this.hash[T]&&A(this,T)}this._pendingRemovals.length=0}}},14479:K=>{"use strict";var A,T="object"===typeof Reflect?Reflect:null,G=function(K,A,T){return Function.prototype.apply.call(K,A,T)};A=T&&"function"===typeof T.ownKeys?T.ownKeys:Object.getOwnPropertySymbols?function(K){return Object.getOwnPropertyNames(K).concat(Object.getOwnPropertySymbols(K))}:function(K){return Object.getOwnPropertyNames(K)};var B=Number.isNaN||function(K){return K!==K};function L(){L.init.call(this)}K.exports=L,K.exports.once=function(K,A){return new Promise((function(T,G){function B(T){K.removeListener(A,L),G(T)}function L(){"function"===typeof K.removeListener&&K.removeListener("error",B),T([].slice.call(arguments))}P(K,A,L,{once:!0}),"error"!==A&&function(K,A,T){"function"===typeof K.on&&P(K,"error",A,T)}(K,B,{once:!0})}))},L.EventEmitter=L,L.prototype._events=void 0,L.prototype._eventsCount=0,L.prototype._maxListeners=void 0;var f=10;function O(K){if("function"!==typeof K)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof K)}function C(K){return void 0===K._maxListeners?L.defaultMaxListeners:K._maxListeners}function Q(K,A,T,G){var B,L,f,Q;if(O(T),void 0===(L=K._events)?(L=K._events=Object.create(null),K._eventsCount=0):(void 0!==L.newListener&&(K.emit("newListener",A,T.listener?T.listener:T),L=K._events),f=L[A]),void 0===f)f=L[A]=T,++K._eventsCount;else if("function"===typeof f?f=L[A]=G?[T,f]:[f,T]:G?f.unshift(T):f.push(T),(B=C(K))>0&&f.length>B&&!f.warned){f.warned=!0;var Y=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");Y.name="MaxListenersExceededWarning",Y.BA=K,Y.type=A,Y.count=f.length,Q=Y,console&&console.warn&&console.warn(Q)}return K}function Y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(K,A,T){var G={fired:!1,wrapFn:void 0,target:K,type:A,listener:T},B=Y.bind(G);return B.listener=T,G.wrapFn=B,B}function x(K,A,T){var G=K._events;if(void 0===G)return[];var B=G[A];return void 0===B?[]:"function"===typeof B?T?[B.listener||B]:[B]:T?function(K){for(var A=new Array(K.length),T=0;T<A.length;++T)A[T]=K[T].listener||K[T];return A}(B):b(B,B.length)}function J(K){var A=this._events;if(void 0!==A){var T=A[K];if("function"===typeof T)return 1;if(void 0!==T)return T.length}return 0}function b(K,A){for(var T=new Array(A),G=0;G<A;++G)T[G]=K[G];return T}function P(K,A,T,G){if("function"===typeof K.on)G.once?K.once(A,T):K.on(A,T);else{if("function"!==typeof K.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof K);K.addEventListener(A,(function B(L){G.once&&K.removeEventListener(A,B),T(L)}))}}Object.defineProperty(L,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(K){if("number"!==typeof K||K<0||B(K))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+K+".");f=K}}),L.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},L.prototype.setMaxListeners=function(K){if("number"!==typeof K||K<0||B(K))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+K+".");return this._maxListeners=K,this},L.prototype.getMaxListeners=function(){return C(this)},L.prototype.emit=function(K){for(var A=[],T=1;T<arguments.length;T++)A.push(arguments[T]);var B="error"===K,L=this._events;if(void 0!==L)B=B&&void 0===L.error;else if(!B)return!1;if(B){var f;if(A.length>0&&(f=A[0]),f instanceof Error)throw f;var O=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw O.context=f,O}var C=L[K];if(void 0===C)return!1;if("function"===typeof C)G(C,this,A);else{var Q=C.length,Y=b(C,Q);for(T=0;T<Q;++T)G(Y[T],this,A)}return!0},L.prototype.addListener=function(K,A){return Q(this,K,A,!1)},L.prototype.on=L.prototype.addListener,L.prototype.prependListener=function(K,A){return Q(this,K,A,!0)},L.prototype.once=function(K,A){return O(A),this.on(K,Z(this,K,A)),this},L.prototype.prependOnceListener=function(K,A){return O(A),this.prependListener(K,Z(this,K,A)),this},L.prototype.removeListener=function(K,A){var T,G,B,L,f;if(O(A),void 0===(G=this._events))return this;if(void 0===(T=G[K]))return this;if(T===A||T.listener===A)0===--this._eventsCount?this._events=Object.create(null):(delete G[K],G.removeListener&&this.emit("removeListener",K,T.listener||A));else if("function"!==typeof T){for(B=-1,L=T.length-1;L>=0;L--)if(T[L]===A||T[L].listener===A){f=T[L].listener,B=L;break}if(B<0)return this;0===B?T.shift():function(K,A){for(;A+1<K.length;A++)K[A]=K[A+1];K.pop()}(T,B),1===T.length&&(G[K]=T[0]),void 0!==G.removeListener&&this.emit("removeListener",K,f||A)}return this},L.prototype.off=L.prototype.removeListener,L.prototype.LA=function(K){var A,T,G;if(void 0===(T=this._events))return this;if(void 0===T.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==T[K]&&(0===--this._eventsCount?this._events=Object.create(null):delete T[K]),this;if(0===arguments.length){var B,L=Object.keys(T);for(G=0;G<L.length;++G)"removeListener"!==(B=L[G])&&this.LA(B);return this.LA("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(A=T[K]))this.removeListener(K,A);else if(void 0!==A)for(G=A.length-1;G>=0;G--)this.removeListener(K,A[G]);return this},L.prototype.listeners=function(K){return x(this,K,!0)},L.prototype.rawListeners=function(K){return x(this,K,!1)},L.listenerCount=function(K,A){return"function"===typeof K.listenerCount?K.listenerCount(A):J.call(K,A)},L.prototype.listenerCount=J,L.prototype.eventNames=function(){return this._eventsCount>0?A(this._events):[]}},14905:K=>{"use strict";K.exports=function(K,A,T,G,B,L){var f=+A[0],O=+A[1],C=+A[2],Q=+T[0],Y=+T[1],Z=+T[2],x=Math.sqrt(Q*Q+Y*Y+Z*Z);if(0===x)throw new Error("Can't raycast along a zero vector");return function(K,A,T,G,B,L,f,O,C,Q){for(var Y=0,Z=Math.floor,x=0|Z(A),J=0|Z(T),b=0|Z(G),P=B>0?1:-1,F=L>0?1:-1,d=f>0?1:-1,N=Math.abs(1/B),D=Math.abs(1/L),mK=Math.abs(1/f),U=N<1/0?N*(P>0?x+1-A:A-x):1/0,z=D<1/0?D*(F>0?J+1-T:T-J):1/0,g=mK<1/0?mK*(d>0?b+1-G:G-b):1/0,S=-1;Y<=O;){var l=K(x,J,b);if(l)return C&&(C[0]=A+Y*B,C[1]=T+Y*L,C[2]=G+Y*f),Q&&(Q[0]=Q[1]=Q[2]=0,0===S&&(Q[0]=-P),1===S&&(Q[1]=-F),2===S&&(Q[2]=-d)),l;U<z?U<g?(x+=P,Y=U,U+=N,S=0):(b+=d,Y=g,g+=mK,S=2):z<g?(J+=F,Y=z,z+=D,S=1):(b+=d,Y=g,g+=mK,S=2)}return C&&(C[0]=A+Y*B,C[1]=T+Y*L,C[2]=G+Y*f),Q&&(Q[0]=Q[1]=Q[2]=0),0}(K,f,O,C,Q/=x,Y/=x,Z/=x,G="undefined"===typeof G?64:+G,B,L)}},14929:(K,A,T)=>{"use strict";T.d(A,{d:()=>L});var G=T(14479);function B(){this.gx=!1,this.stopPropagation=!1,this.Sx=!1,this.disabled=!1}class L{constructor(K,A){this.version="0.7.0";var T=Object.assign({},new B,A||{});this.element=K||document,this.gx=!!T.gx,this.stopPropagation=!!T.stopPropagation,this.Sx=!!T.Sx,this.disabled=!!T.disabled,this.filterEvents=(K,A)=>!0,this.down=new G.EventEmitter,this.up=new G.EventEmitter,this.state={},this.yQ={dx:0,dy:0,UJ:0,qQ:0,zJ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?O(this):document.addEventListener("DOMContentLoaded",(K=>{O(this)}),{once:!0})}bind(K){for(var A=arguments.length,T=new Array(A>1?A-1:0),G=1;G<A;G++)T[G-1]=arguments[G];T.forEach((A=>{var T=this._keyBindmap[A]||[];T.includes(K)||(T.push(K),this._keyBindmap[A]=T)})),this.state[K]=!!this.state[K],this.pressCount[K]=this.pressCount[K]||0,this.releaseCount[K]=this.releaseCount[K]||0}unbind(K){for(var A in this._keyBindmap){var T=this._keyBindmap[A],G=T.indexOf(K);G>-1&&T.splice(G,1)}}getBindings(){var K={};for(var A in this._keyBindmap){this._keyBindmap[A].forEach((T=>{K[T]=K[T]||[],K[T].push(A)}))}return K}jO(){f(this.yQ),f(this.pressCount),f(this.releaseCount)}}function f(K){for(var A in K)K[A]=0}function O(K){window.addEventListener("keydown",b.bind(null,K,!0),!1),window.addEventListener("keyup",b.bind(null,K,!1),!1);var A={passive:!0};K.element.addEventListener("touchstart",Z.bind(void 0,K),{passive:!1}),K.element.addEventListener("touchend",J.bind(void 0,K),A),K.element.addEventListener("mousedown",P.bind(null,K,!0),A),window.document.addEventListener("mouseup",P.bind(null,K,!1),A),K.element.addEventListener("touchmove",F.bind(null,K),A),K.element.addEventListener("mousemove",F.bind(null,K),A),window.PointerEvent,K.element.addEventListener("wheel",d.bind(null,K),A),K.element.addEventListener("contextmenu",N.bind(null,K),!1),window.addEventListener("blur",D.bind(null,K),!1)}var C=0,Q=0,Y=null;function Z(K,A){A.preventDefault(),x(A)}function x(K){let A=!1;for(let T=0;T<K.touches.length;++T)if(K.touches[T].identifier===Y){A=!0;break}if(!A){const A=K.changedTouches[0];C=A.clientX,Q=A.clientY,Y=A.identifier}}function J(K,A){for(var T=A.changedTouches,G=0;G<T.length;++G)T[G].identifier===Y&&(Y=null)}function b(K,A,T){mK(T.code,A,K,T)}function P(K,A,T){if("pointerId"in T)if(A){if(null!==K._touches.currID)return;K._touches.currID=T.pointerId}else{if(K._touches.currID!==T.pointerId)return;K._touches.currID=null}return mK("Mouse"+("button"in T?T.button+1:1),A,K,T),!1}function F(K,A){var T=A.movementX||A.mozMovementX||0,G=A.movementY||A.mozMovementY||0;if(A.touches&&0===(T|G)){var B=function(K){x(K);for(let A=0;A<K.changedTouches.length;++A)if(K.changedTouches[A].identifier==Y){const T=K.changedTouches[A],G=[T.clientX-C,T.clientY-Q];return C=T.clientX,Q=T.clientY,G}return console.error(`Did not find touch id ${Y}`),[0,0]}(A);T=B[0],G=B[1]}K.yQ.dx+=T,K.yQ.dy+=G}function d(K,A){var T=1;switch(A.deltaMode){case 0:T=1;break;case 1:T=12;break;case 2:T=K.element.clientHeight||window.innerHeight}K.yQ.UJ+=(A.deltaX||0)*T,K.yQ.qQ+=(A.deltaY||0)*T,K.yQ.zJ+=(A.deltaZ||0)*T}function N(K,A){if(!K.Sx)return A.preventDefault(),!1}function D(K){for(var A in K._keyStates)K._keyStates[A]&&(/^Mouse\d/.test(A)||mK(A,!1,K,{code:A,note:"6we69v8m2nl",preventDefault:()=>{},stopPropagation:()=>{}}))}function mK(K,A,T,G){var B=T._keyBindmap[K];B&&(U(T._keyStates[K],A)&&(T._keyStates[K]=A,B.forEach((K=>{(!T.filterEvents||T.filterEvents(G,K))&&function(K,A,T,G){var B=A?T.pressCount:T.releaseCount;B[K]=(B[K]||0)+1;var L=T._bindPressCount[K]||0;(L+=A?1:-1)<0&&(L=0);T._bindPressCount[K]=L;var f=T.state[K];if(U(f,L)){T.state[K]=L>0;var O=A?T.down:T.up;T.disabled||O.emit(K,G)}}(K,A,T,G)}))),"button"in G||(T.gx&&!G.defaultPrevented&&G.preventDefault(),T.stopPropagation&&G.stopPropagation()))}function U(K,A){return K?!A:A}},13565:K=>{K.exports=function(K,A,T){return K[0]=A[0]+T[0],K[1]=A[1]+T[1],K[2]=A[2]+T[2],K}},13529:(K,A,T)=>{K.exports=function(K,A){var T=G(K[0],K[1],K[2]),f=G(A[0],A[1],A[2]);B(T,T),B(f,f);var O=L(T,f);return O>1?0:Math.acos(O)};var G=T(13531),B=T(13537),L=T(13545)},13620:K=>{K.exports=function(K,A){return K[0]=Math.ceil(A[0]),K[1]=Math.ceil(A[1]),K[2]=Math.ceil(A[2]),K}},13524:K=>{K.exports=function(K){var A=new Float32Array(3);return A[0]=K[0],A[1]=K[1],A[2]=K[2],A}},13550:K=>{K.exports=function(K,A){return K[0]=A[0],K[1]=A[1],K[2]=A[2],K}},13516:K=>{K.exports=function(){var K=new Float32Array(3);return K[0]=0,K[1]=0,K[2]=0,K}},13704:K=>{K.exports=function(K,A,T){var G=A[0],B=A[1],L=A[2],f=T[0],O=T[1],C=T[2];return K[0]=B*C-L*O,K[1]=L*f-G*C,K[2]=G*O-B*f,K}},13650:(K,A,T)=>{K.exports=T(13644)},13644:K=>{K.exports=function(K,A){var T=A[0]-K[0],G=A[1]-K[1],B=A[2]-K[2];return Math.sqrt(T*T+G*G+B*B)}},13596:(K,A,T)=>{K.exports=T(13591)},13591:K=>{K.exports=function(K,A,T){return K[0]=A[0]/T[0],K[1]=A[1]/T[1],K[2]=A[2]/T[2],K}},13545:K=>{K.exports=function(K,A){return K[0]*A[0]+K[1]*A[1]+K[2]*A[2]}},13510:K=>{K.exports=1e-6},13558:(K,A,T)=>{K.exports=function(K,A){var T=K[0],B=K[1],L=K[2],f=A[0],O=A[1],C=A[2];return Math.abs(T-f)<=G*Math.max(1,Math.abs(T),Math.abs(f))&&Math.abs(B-O)<=G*Math.max(1,Math.abs(B),Math.abs(O))&&Math.abs(L-C)<=G*Math.max(1,Math.abs(L),Math.abs(C))};var G=T(13510)},13560:K=>{K.exports=function(K,A){return K[0]===A[0]&&K[1]===A[1]&&K[2]===A[2]}},13611:K=>{K.exports=function(K,A){return K[0]=Math.floor(A[0]),K[1]=Math.floor(A[1]),K[2]=Math.floor(A[2]),K}},13763:(K,A,T)=>{K.exports=function(K,A,T,B,L,f){var O,C;A||(A=3);T||(T=0);C=B?Math.min(B*A+T,K.length):K.length;for(O=T;O<C;O+=A)G[0]=K[O],G[1]=K[O+1],G[2]=K[O+2],L(G,G,f),K[O]=G[0],K[O+1]=G[1],K[O+2]=G[2];return K};var G=T(13516)()},13531:K=>{K.exports=function(K,A,T){var G=new Float32Array(3);return G[0]=K,G[1]=A,G[2]=T,G}},13508:(K,A,T)=>{K.exports={EPSILON:T(13510),create:T(13516),clone:T(13524),angle:T(13529),cO:T(13531),i:T(13550),set:T(13556),equals:T(13558),exactEquals:T(13560),add:T(13565),FA:T(13573),sub:T(13575),multiply:T(13578),mul:T(13582),divide:T(13591),div:T(13596),min:T(13604),max:T(13606),floor:T(13611),ceil:T(13620),round:T(13627),scale:T(13633),nO:T(13641),distance:T(13644),k:T(13650),squaredDistance:T(13654),sqrDist:T(13659),length:T(13662),len:T(13671),squaredLength:T(13680),HO:T(13687),negate:T(13694),inverse:T(13696),normalize:T(13537),dot:T(13545),cross:T(13704),NO:T(13708),random:T(13717),transformMat4:T(13721),transformMat3:T(13730),transformQuat:T(13739),eO:T(13746),pO:T(13751),rO:T(13755),forEach:T(13763)}},13696:K=>{K.exports=function(K,A){return K[0]=1/A[0],K[1]=1/A[1],K[2]=1/A[2],K}},13671:(K,A,T)=>{K.exports=T(13662)},13662:K=>{K.exports=function(K){var A=K[0],T=K[1],G=K[2];return Math.sqrt(A*A+T*T+G*G)}},13708:K=>{K.exports=function(K,A,T,G){var B=A[0],L=A[1],f=A[2];return K[0]=B+G*(T[0]-B),K[1]=L+G*(T[1]-L),K[2]=f+G*(T[2]-f),K}},13606:K=>{K.exports=function(K,A,T){return K[0]=Math.max(A[0],T[0]),K[1]=Math.max(A[1],T[1]),K[2]=Math.max(A[2],T[2]),K}},13604:K=>{K.exports=function(K,A,T){return K[0]=Math.min(A[0],T[0]),K[1]=Math.min(A[1],T[1]),K[2]=Math.min(A[2],T[2]),K}},13582:(K,A,T)=>{K.exports=T(13578)},13578:K=>{K.exports=function(K,A,T){return K[0]=A[0]*T[0],K[1]=A[1]*T[1],K[2]=A[2]*T[2],K}},13694:K=>{K.exports=function(K,A){return K[0]=-A[0],K[1]=-A[1],K[2]=-A[2],K}},13537:K=>{K.exports=function(K,A){var T=A[0],G=A[1],B=A[2],L=T*T+G*G+B*B;L>0&&(L=1/Math.sqrt(L),K[0]=A[0]*L,K[1]=A[1]*L,K[2]=A[2]*L);return K}},13717:K=>{K.exports=function(K,A){A=A||1;var T=2*Math.random()*Math.PI,G=2*Math.random()-1,B=Math.sqrt(1-G*G)*A;return K[0]=Math.cos(T)*B,K[1]=Math.sin(T)*B,K[2]=G*A,K}},13746:K=>{K.exports=function(K,A,T,G){var B=T[1],L=T[2],f=A[1]-B,O=A[2]-L,C=Math.sin(G),Q=Math.cos(G);return K[0]=A[0],K[1]=B+f*Q-O*C,K[2]=L+f*C+O*Q,K}},13751:K=>{K.exports=function(K,A,T,G){var B=T[0],L=T[2],f=A[0]-B,O=A[2]-L,C=Math.sin(G),Q=Math.cos(G);return K[0]=B+O*C+f*Q,K[1]=A[1],K[2]=L+O*Q-f*C,K}},13755:K=>{K.exports=function(K,A,T,G){var B=T[0],L=T[1],f=A[0]-B,O=A[1]-L,C=Math.sin(G),Q=Math.cos(G);return K[0]=B+f*Q-O*C,K[1]=L+f*C+O*Q,K[2]=A[2],K}},13627:K=>{K.exports=function(K,A){return K[0]=Math.round(A[0]),K[1]=Math.round(A[1]),K[2]=Math.round(A[2]),K}},13633:K=>{K.exports=function(K,A,T){return K[0]=A[0]*T,K[1]=A[1]*T,K[2]=A[2]*T,K}},13641:K=>{K.exports=function(K,A,T,G){return K[0]=A[0]+T[0]*G,K[1]=A[1]+T[1]*G,K[2]=A[2]+T[2]*G,K}},13556:K=>{K.exports=function(K,A,T,G){return K[0]=A,K[1]=T,K[2]=G,K}},13659:(K,A,T)=>{K.exports=T(13654)},13687:(K,A,T)=>{K.exports=T(13680)},13654:K=>{K.exports=function(K,A){var T=A[0]-K[0],G=A[1]-K[1],B=A[2]-K[2];return T*T+G*G+B*B}},13680:K=>{K.exports=function(K){var A=K[0],T=K[1],G=K[2];return A*A+T*T+G*G}},13575:(K,A,T)=>{K.exports=T(13573)},13573:K=>{K.exports=function(K,A,T){return K[0]=A[0]-T[0],K[1]=A[1]-T[1],K[2]=A[2]-T[2],K}},13730:K=>{K.exports=function(K,A,T){var G=A[0],B=A[1],L=A[2];return K[0]=G*T[0]+B*T[3]+L*T[6],K[1]=G*T[1]+B*T[4]+L*T[7],K[2]=G*T[2]+B*T[5]+L*T[8],K}},13721:K=>{K.exports=function(K,A,T){var G=A[0],B=A[1],L=A[2],f=T[3]*G+T[7]*B+T[11]*L+T[15];return f=f||1,K[0]=(T[0]*G+T[4]*B+T[8]*L+T[12])/f,K[1]=(T[1]*G+T[5]*B+T[9]*L+T[13])/f,K[2]=(T[2]*G+T[6]*B+T[10]*L+T[14])/f,K}},13739:K=>{K.exports=function(K,A,T){var G=A[0],B=A[1],L=A[2],f=T[0],O=T[1],C=T[2],Q=T[3],Y=Q*G+O*L-C*B,Z=Q*B+C*G-f*L,x=Q*L+f*B-O*G,J=-f*G-O*B-C*L;return K[0]=Y*Q+J*-f+Z*-C-x*-O,K[1]=Z*Q+J*-O+x*-f-Y*-C,K[2]=x*Q+J*-C+Y*-O-Z*-f,K}},14497:K=>{"use strict";K.exports=function(K){for(var A=new Array(K),T=0;T<K;++T)A[T]=T;return A}},14568:K=>{K.exports=function(K){return null!=K&&null!=K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}},14907:(K,A,T)=>{"use strict";T.d(A,{e:()=>G});class G{constructor(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.TZ=!1,this.GZ=!1,this.KZ=30,this.AZ=0,this.ZZ=!1,this.fullscreen=!1,this.LZ=function(K){},this.fZ=function(){},this.QZ=function(){},this.Tf=function(){},this.OZ=function(K){},this.onFullscreenChanged=function(K){},Q((()=>{!function(K,A){K._nowObject=performance||Date,K._lastTick=0,K._renderAccum=0,K._rt=0,K._frameCB=O.bind(null,K),requestAnimationFrame(K._frameCB),A>0&&(K._intervalCB=f.bind(null,K),K._interval=setInterval(K._intervalCB,Math.max(A,1e3/K.KZ/2)))}(this,A),function(K,A){if(!A)return;var T=!1,G=!1;document.addEventListener("pointerlockchange",(G=>{T=document.pointerLockElement===A,K.OZ(T)})),document.addEventListener("fullscreenchange",(T=>{G=document.fullscreenElement===A,K.onFullscreenChanged(G)})),Object.defineProperty(K,"ZZ",{get:()=>T,set:K=>{K&&!T?C(A):T&&!K&&function(K){K.exitPointerLock&&K.exitPointerLock()}(document)}}),Object.defineProperty(K,"fullscreen",{get:()=>G,set:K=>{K&&!G?A.requestFullscreen():G&&!K&&document.exitFullscreen()}}),A.addEventListener("click",(B=>{K.TZ&&!T&&C(A),K.GZ&&!G&&A.requestFullscreen()}));var B=()=>K.Tf();if(window.ResizeObserver){new ResizeObserver(B).observe(A)}else window.addEventListener("resize",B)}(this,K),this.QZ()}))}}var B=3,L=20;function f(K){for(var A=1e3/K.KZ,T=K._nowObject.now()+L,G=0;K._nowObject.now()>=K._lastTick+A&&K._nowObject.now()<T&&++G<=B;)K.LZ(A),K._lastTick+=A;var f=5*(A+5),O=K._nowObject.now();if(O-K._lastTick>f)for(;O>=K._lastTick+A;)K._lastTick+=A}function O(K){requestAnimationFrame(K._frameCB),f(K);var A=K._nowObject.now(),T=A-K._rt;if(K._rt=A,K.AZ>0){K._renderAccum+=T;var G=1e3/K.AZ;if(K._renderAccum<G)return;K._renderAccum=Math.min(K._renderAccum-G,G)}var B=1e3/K.KZ,L=(A-K._lastTick)/B;K.fZ(T,L,B)}function C(K){K.requestPointerLock&&K.requestPointerLock()}var Q=K=>{if("loading"===document.readyState){var A=()=>{document.removeEventListener("readystatechange",A),K()};document.addEventListener("readystatechange",A)}else setTimeout(K,1)}},14491:(K,A,T)=>{var G=T(14497),B=T(14502),L="undefined"!==typeof Float64Array;function f(K,A){return K[0]-A[0]}function O(){var K,A=this.stride,T=new Array(A.length);for(K=0;K<T.length;++K)T[K]=[Math.abs(A[K]),K];T.sort(f);var G=new Array(T.length);for(K=0;K<G.length;++K)G[K]=T[K][1];return G}function C(K,A){var T=["View",A,"d",K].join("");A<0&&(T="View_Nil"+K);var B="generic"===K;if(-1===A){var L="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(L)()}if(0===A){L="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",L)(Q[K][0])}L=["'use strict'"];var f=G(A),C=f.map((function(K){return"i"+K})),Y="this.offset+"+f.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),Z=f.map((function(K){return"b"+K})).join(","),x=f.map((function(K){return"c"+K})).join(",");L.push("function "+T+"(a,"+Z+","+x+",d){this.data=a","this.shape=["+Z+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+K+"'","proto.dimension="+A),L.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+f.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===A?L.push("proto.order=[0]"):(L.push("Object.defineProperty(proto,'order',{get:"),A<4?(L.push("function "+T+"_order(){"),2===A?L.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===A&&L.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):L.push("ORDER})")),L.push("proto.set=function "+T+"_set("+C.join(",")+",v){"),B?L.push("return this.data.set("+Y+",v)}"):L.push("return this.data["+Y+"]=v}"),L.push("proto.get=function "+T+"_get("+C.join(",")+"){"),B?L.push("return this.data.get("+Y+")}"):L.push("return this.data["+Y+"]}"),L.push("proto.index=function "+T+"_index(",C.join(),"){return "+Y+"}"),L.push("proto.hi=function "+T+"_hi("+C.join(",")+"){return new "+T+"(this.data,"+f.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+f.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var J=f.map((function(K){return"a"+K+"=this.shape["+K+"]"})),b=f.map((function(K){return"c"+K+"=this.stride["+K+"]"}));L.push("proto.lo=function "+T+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+b.join(","));for(var P=0;P<A;++P)L.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");L.push("return new "+T+"(this.data,"+f.map((function(K){return"a"+K})).join(",")+","+f.map((function(K){return"c"+K})).join(",")+",b)}"),L.push("proto.step=function "+T+"_step("+C.join(",")+"){var "+f.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+f.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<A;++P)L.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");L.push("return new "+T+"(this.data,"+f.map((function(K){return"a"+K})).join(",")+","+f.map((function(K){return"b"+K})).join(",")+",c)}");var F=new Array(A),d=new Array(A);for(P=0;P<A;++P)F[P]="a[i"+P+"]",d[P]="b[i"+P+"]";L.push("proto.transpose=function "+T+"_transpose("+C+"){"+C.map((function(K,A){return K+"=("+K+"===undefined?"+A+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+F.join(",")+","+d.join(",")+",this.offset)}"),L.push("proto.pick=function "+T+"_pick("+C+"){var a=[],b=[],c=this.offset");for(P=0;P<A;++P)L.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return L.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),L.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+f.map((function(K){return"shape["+K+"]"})).join(",")+","+f.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",L.join("\n"))(Q[K],O)}var Q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,A,T,G){if(void 0===K)return(0,Q.array[0])([]);"number"===typeof K&&(K=[K]),void 0===A&&(A=[K.length]);var f=A.length;if(void 0===T){T=new Array(f);for(var O=f-1,Y=1;O>=0;--O)T[O]=Y,Y*=A[O]}if(void 0===G){G=0;for(O=0;O<f;++O)T[O]<0&&(G-=(A[O]-1)*T[O])}for(var Z=function(K){if(B(K))return"buffer";if(L)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),x=Q[Z];x.length<=f+1;)x.push(C(Z,x.length-1));return(0,x[f+1])(K,A,T,G)}},14502:K=>{function A(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(A(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&A(K.slice(0,0))}(K)||!!K._isBuffer)}},14638:K=>{"use strict";var A=[],T=[],G=[],B=[],L=[],f=[],O=[],C=[],Q=[],Y=[],Z=[],x=[];K.exports=function(K,J,b,P,F,d){for(var N=O,D=Q,mK=Y,U=x,z=0;z<3;z++)N[z]=+b[z],mK[z]=+J.max[z],D[z]=+J.base[z];d||(d=1e-10);var g=function(K,O,Q,Y,x,J){var b=A,P=T,F=G,d=B,N=L,D=f,mK=C,U=Math.floor,z=0,g=0,S=0,l=0,u=0;if(c(),0===S)return 0;for(l=e();g<=S;){if(n(l)&&H())return z;l=e()}for(z+=S,u=0;u<3;u++)Y[u]+=Q[u],x[u]+=Q[u];return z;function c(){if(g=0,0!==(S=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2])))for(var K=0;K<3;K++){var A=Q[K]>=0;d[K]=A?1:-1;var T=A?x[K]:Y[K];b[K]=A?Y[K]:x[K],P[K]=p(T,d[K]),F[K]=r(b[K],d[K]),mK[K]=Q[K]/S,N[K]=Math.abs(1/mK[K]);var G=A?P[K]+1-T:T-P[K];D[K]=N[K]<1/0?N[K]*G:1/0}}function n(A){for(var T=d[0],G=0===A?P[0]:F[0],B=P[0]+T,L=d[1],f=1===A?P[1]:F[1],O=P[1]+L,C=d[2],Q=2===A?P[2]:F[2],Y=P[2]+C,Z=G;Z!=B;Z+=T)for(var x=f;x!=O;x+=L)for(var J=Q;J!=Y;J+=C)if(K(Z,x,J))return!0;return!1}function H(){z+=g;var K=d[l],A=g/S,T=Z;for(u=0;u<3;u++){var G=Q[u]*A;Y[u]+=G,x[u]+=G,T[u]=Q[u]-G}if(K>0?x[l]=Math.round(x[l]):Y[l]=Math.round(Y[l]),O(z,l,K,T))return!0;for(u=0;u<3;u++)Q[u]=T[u];return c(),0===S}function e(){var K=D[0]<D[1]?D[0]<D[2]?0:2:D[1]<D[2]?1:2,A=D[K]-g;for(g=D[K],P[K]+=d[K],D[K]+=N[K],u=0;u<3;u++)b[u]+=A*mK[u],F[u]=r(b[u],d[u]);return K}function p(K,A){return U(K-A*J)}function r(K,A){return U(K+A*J)}}(K,P,N,D,mK,d);if(!F){for(z=0;z<3;z++)U[z]=b[z]>0?mK[z]-J.max[z]:D[z]-J.base[z];J.translate(U)}return g}},14931:(K,A,T)=>{"use strict";T.d(A,{d:()=>Z});var G=T(14633),B=T(13508);class L{constructor(K,A,T,L,f,O,C){this.EQ=new G(K.base,K.bY),this.NG=A,this.friction=T,this.restitution=L,this.ZO=f,this.WJ=O,this.xO=!!C,this.JY=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.mF=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.FQ=B.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=B.create(),this._impulses=B.create(),this._sleepFrameCount=10}loadFromCopy(K){B.i(this.EQ.base,K.EQ.base),B.i(this.EQ.bY,K.EQ.bY),B.i(this.EQ.max,K.EQ.max),this.EQ.mag=K.EQ.mag,this.NG=K.NG,this.friction=K.friction,this.restitution=K.restitution,this.ZO=K.ZO,this.WJ=K.WJ,this.xO=K.xO,this.JY=K.JY,this.fluidDrag=K.fluidDrag,this.mF=K.mF,this.preventFallOffEdge=K.preventFallOffEdge,this.rolledBackLastTick=K.rolledBackLastTick,B.i(this.FQ,K.FQ),B.i(this.resting,K.resting),this.inFluid=K.inFluid,this._ratioInFluid=K._ratioInFluid,B.i(this._forces,K._forces),B.i(this._impulses,K._impulses),this._sleepFrameCount=K._sleepFrameCount}setPosition(K){f(K),B.FA(K,K,this.EQ.base),this.EQ.translate(K),this.dQ()}Of(){return B.clone(this.EQ.base)}applyForce(K){f(K),B.add(this._forces,this._forces,K),this.dQ()}applyImpulse(K){f(K),B.add(this._impulses,this._impulses,K),this.dQ()}dQ(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var f=K=>{};var O=T(14633),C=T(13508),Q=T(14638);function Y(){this.JY=.1,this.fluidDrag=.4,this.dO=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Z(K,A,T){K=Object.assign(new Y,K),this.gravity=K.gravity||[0,-10,0],this.JY=K.JY||.1,this.dO=K.dO||2,this.fluidDrag=K.fluidDrag||.4,this.minBounceImpulse=K.minBounceImpulse,this.bodies=[],this.YJ=K.YJ,this.testSolid=A,this.testFluid=T}Z.prototype.aJ=function(K,A,T,G,B,f){K=K||new O([0,0,0],[1,1,1]),"undefined"==typeof A&&(A=1),"undefined"==typeof T&&(T=1),"undefined"==typeof G&&(G=0),"undefined"==typeof B&&(B=1);var C=new L(K,A,T,G,B,f);return this.bodies.push(C),C},Z.prototype.MJ=function(K){var A=this.bodies.indexOf(K);A<0||(this.bodies.splice(A,1),K.EQ=K.WJ=null)};var x=C.create(),J=C.create(),b=C.create(),P=C.create(),F=C.create(),d=C.create(),N=C.create(),D=new O([0,0,0],[1,1,1]),mK=new L(D,1,1,0,1,(()=>{}),!1);function U(K,A,T){return A=T,A*=1-(1-K.ratioInFluid)**2}Z.prototype.jO=function(K){K/=1e3;var A=R(0,C.squaredLength(this.gravity));this.bodies.forEach((T=>function(K,A,T,G){C.i(F,A.resting),K.YJ&&mK.loadFromCopy(A);if(A.NG<=0)return C.set(A.FQ,0,0,0),C.set(A._forces,0,0,0),void C.set(A._impulses,0,0,0);var B=G||0===A.ZO;if(function(K,A,T,G){if(A._sleepFrameCount>0)return!1;if(G)return!0;var B=!1,L=.5*T*T*A.ZO;return C.scale(j,K.gravity,L),Q(K.testSolid,A.EQ,j,(function(){return B=!0,!0}),!0),B}(K,A,T,B))return;A._sleepFrameCount--,function(K,A){var T=A.EQ,G=Math.floor(T.base[0]),B=Math.floor(T.base[2]),L=Math.floor(T.base[1]),f=Math.floor(T.max[1]);if(!K.testFluid(G,L,B))return A.inFluid=!1,void(A.ratioInFluid=0);var O=1,Q=L+1;for(;Q<=f&&K.testFluid(G,Q,B);)O++,Q++;var Y=(L+O-T.base[1])/T.bY[1];Y>1&&(Y=1);var Z=T.bY[0]*T.bY[1]*T.bY[2]*Y,x=g;C.scale(x,K.gravity,-K.dO*Z*A.ZO),A.applyForce(x),A.inFluid=!0,A.ratioInFluid=Y}(K,A),I(A._forces),I(A._impulses),I(A.FQ),I(A.resting),C.scale(x,A._forces,1/A.NG),C.nO(x,x,K.gravity,A.ZO),C.scale(J,A._impulses,1/A.NG),C.nO(J,J,x,T),C.add(A.FQ,A.FQ,J),A.friction&&(S(K,0,A,J,T),S(K,1,A,J,T),S(K,2,A,J,T));var L=A.fluidDrag>=0?A.fluidDrag:K.fluidDrag,f=A.JY>=0?A.JY:K.JY,O=f,Y=f;A.inFluid&&(O=U(A,O,A.fluidDragHoriz>=0?A.fluidDragHoriz:L),Y=U(A,Y,A.fluidDragVert>=0?A.fluidDragVert:L));O=Math.max(1-O*T/A.NG,0),Y=Math.max(1-Y*T/A.NG,0),C.set(z,O,Y,O),C.multiply(A.FQ,A.FQ,z),C.scale(b,A.FQ,T),C.set(A._forces,0,0,0),C.set(A._impulses,0,0,0),A.xO&&v(c,A.EQ);C.i(d,b),C.set(N,0,0,0),A.preventFallOffEdge&&function(K,A,T,G){if(!A.resting[1]||T[1]>0)return;var B=h;v(B,A.EQ);for(var L=0;L<3;L+=2){C.set(r,0,0,0),r[L]=T[L];var f=!0;(f=(f=(f=(f=f&&!s(K,B.base[0]+r[0]+1e-5,B.base[1],B.base[2]+r[2]+1e-5))&&!s(K,B.max[0]+r[0]-1e-5,B.base[1],B.base[2]+r[2]+1e-5))&&!s(K,B.base[0]+r[0]+1e-5,B.base[1],B.max[2]+r[2]-1e-5))&&!s(K,B.max[0]+r[0]-1e-5,B.base[1],B.max[2]+r[2]-1e-5))?(G[L]=T[L]>0?1:-1,T[L]=0):0===L&&(C.set(k,T[0],0,0),u(K,B,k,G,A.slideOnCollision))}}(K,A,b,N);u(K,A.EQ,b,A.resting,A.slideOnCollision),A.xO&&function(K,A,T,G){if(A.resting[1]>=0&&!A.inFluid)return;var B=0!==A.resting[0],L=0!==A.resting[2];if(!B&&!L)return;var f=Math.abs(G[0]/G[2]),O=4;if(!B&&f>O)return;if(!L&&f<1/O)return;C.add(H,T.base,G);var Y=K.testSolid;Q(Y,T,G,(function(K,A,T,G){if(1!==A)return!0;G[A]=0}));var Z=T.base[1],x=A.inFluid?1.951:1.001,J=Math.floor(Z+x)-Z;C.set(e,0,J,0);var b=!1;if(Q(Y,T,e,(function(K,A,T,G){return b=!0,!0})),b)return;C.FA(p,H,T.base),p[1]=0,u(K,T,p,n,!0);var P=R(T.base[0],H[0]),F=R(T.base[2],H[2]);if(B&&!P&&(!F||!L))return;if(L&&(!P||!B)&&!F)return;var d=!0;if(d=d&&!s(K,T.base[0]+1e-5,T.base[1],T.base[2]+1e-5),d=d&&!s(K,T.max[0]-1e-5,T.base[1],T.base[2]+1e-5),d=d&&!s(K,T.base[0]+1e-5,T.base[1],T.max[2]-1e-5),d=d&&!s(K,T.max[0]-1e-5,T.base[1],T.max[2]-1e-5),d)return;v(A.EQ,T),A.resting[0]=n[0],A.resting[2]=n[2],A.mF&&A.mF()}(K,A,c,d);for(var Z=0;Z<3;++Z)A.resting[Z]=A.resting[Z]||N[Z],P[Z]=0,A.resting[Z]&&(F[Z]||(P[Z]=-A.FQ[Z]),A.FQ[Z]=0);var D=C.length(P);D>.001&&(C.scale(P,P,A.NG),A.WJ&&A.WJ(P),A.restitution>0&&D>K.minBounceImpulse&&(C.scale(P,P,A.restitution),A.applyImpulse(P)));var l=C.squaredLength(A.FQ);l>1e-5&&A.dQ();K.YJ&&K.YJ(A)?(A.loadFromCopy(mK),A.rolledBackLastTick=!0):A.rolledBackLastTick=!1}(this,T,K,A)))};var z=C.create([0,0,0]);var g=C.create();function S(K,A,T,G,B){var L=T.resting[A],f=G[A];if(!T.alwaysApplyHorizFriction||1!==A){if(0===L)return;if(L*f<=0)return}C.i(l,T.FQ),l[A]=0;var O=C.length(l);if(!R(O,0)){var Q=Math.abs(T.friction*K.gravity[A]*B),Y=O>Q?(O-Q)/O:0;T.FQ[(A+1)%3]*=Y,T.FQ[(A+2)%3]*=Y}}var l=C.create();function u(K,A,T,G,B){return C.set(G,0,0,0),Q(K.testSolid,A,T,(function(K,A,T,L){G[A]=T,L[A]=0,B||(L[0]=0,L[1]=0,L[2]=0)}))}var c=new O([],[]),n=C.create(),H=C.create(),e=C.create(),p=C.create();var r=C.create(),h=new O([],[]),k=C.create();function s(K,A,T,G){return K.testSolid(Math.floor(A),Math.floor(T-1),Math.floor(G))}var j=C.create();function R(K,A){return Math.abs(K-A)<1e-5}function v(K,A){for(var T=0;T<3;T++)K.base[T]=A.base[T],K.max[T]=A.max[T],K.bY[T]=A.bY[T]}var I=function(K){}},13373:function(K,A){!function(K){"use strict";var A=function(K,T){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,A){K.__proto__=A}||function(K,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(K[T]=A[T])},A(K,T)};function T(K,T){if("function"!==typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function G(){this.constructor=K}A(K,T),K.prototype=null===T?Object.create(T):(G.prototype=T.prototype,new G)}function G(K,A,T,G){var B,L=arguments.length,f=L<3?A:null===G?G=Object.getOwnPropertyDescriptor(A,T):G;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(K,A,T,G);else for(var O=K.length-1;O>=0;O--)(B=K[O])&&(f=(L<3?B(f):L>3?B(A,T,f):B(A,T))||f);return L>3&&f&&Object.defineProperty(A,T,f),f}function B(K,A,T){if(T||2===arguments.length)for(var G,B=0,L=A.length;B<L;B++)!G&&B in A||(G||(G=Array.prototype.slice.call(A,0,B)),G[B]=A[B]);return K.concat(G||Array.prototype.slice.call(A))}var L,f=255,O=213;K.OPERATION=void 0,(L=K.OPERATION||(K.OPERATION={}))[L.ADD=128]="ADD",L[L.REPLACE=0]="REPLACE",L[L.DELETE=64]="DELETE",L[L.DELETE_AND_ADD=192]="DELETE_AND_ADD",L[L.TOUCH=1]="TOUCH",L[L.CLEAR=10]="CLEAR";var C=function(){function A(K,A,T){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=K,this.setParent(A,T)}return A.prototype.setParent=function(K,A,T){var G=this;if(this.indexes||(this.indexes=this.ref instanceof pK?this.ref._definition.indexes:{}),this.parent=K,this.parentIndex=T,A)if(this.root=A,this.ref instanceof pK){var B=this.ref._definition;for(var L in B.schema){var f=this.ref[L];if(f&&f.$changes){var O=B.indexes[L];f.$changes.setParent(this.ref,A,O)}}}else"object"===typeof this.ref&&this.ref.forEach((function(K,A){if(K instanceof pK){var T=K.$changes,B=G.ref.$changes.indexes[A];T.setParent(G.ref,G.root,B)}}))},A.prototype.operation=function(K){this.changes.set(--this.currentCustomOperation,K)},A.prototype.change=function(A,T){void 0===T&&(T=K.OPERATION.ADD);var G="number"===typeof A?A:this.indexes[A];this.assertValidIndex(G,A);var B=this.changes.get(G);B&&B.op!==K.OPERATION.DELETE&&B.op!==K.OPERATION.TOUCH||this.changes.set(G,{op:B&&B.op===K.OPERATION.DELETE?K.OPERATION.DELETE_AND_ADD:T,index:G}),this.allChanges.add(G),this.changed=!0,this.touchParents()},A.prototype.touch=function(A){var T="number"===typeof A?A:this.indexes[A];this.assertValidIndex(T,A),this.changes.has(T)||this.changes.set(T,{op:K.OPERATION.TOUCH,index:T}),this.allChanges.add(T),this.touchParents()},A.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},A.prototype.getType=function(K){if(this.ref._definition)return(A=this.ref._definition).schema[A.fieldsByIndex[K]];var A,T=(A=this.parent._definition).schema[A.fieldsByIndex[this.parentIndex]];return Object.values(T)[0]},A.prototype.getChildrenFilter=function(){var K=this.parent._definition.childFilters;return K&&K[this.parentIndex]},A.prototype.getValue=function(K){return this.ref.getByIndex(K)},A.prototype.delete=function(A){var T="number"===typeof A?A:this.indexes[A];if(void 0!==T){var G=this.getValue(T);this.changes.set(T,{op:K.OPERATION.DELETE,index:T}),this.allChanges.delete(T),delete this.caches[T],G&&G.$changes&&(G.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(A," (").concat(T,")"))},A.prototype.discard=function(A,T){var G=this;void 0===A&&(A=!1),void 0===T&&(T=!1),this.ref instanceof pK||this.changes.forEach((function(A){if(A.op===K.OPERATION.DELETE){var T=G.ref.getIndex(A.index);delete G.indexes[T]}})),this.changes.clear(),this.changed=A,T&&this.allChanges.clear(),this.currentCustomOperation=0},A.prototype.discardAll=function(){var K=this;this.changes.forEach((function(A){var T=K.getValue(A.index);T&&T.$changes&&T.$changes.discardAll()})),this.discard()},A.prototype.cache=function(K,A){this.caches[K]=A},A.prototype.clone=function(){return new A(this.ref,this.parent,this.root)},A.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},A.prototype.assertValidIndex=function(K,A){if(void 0===K)throw new Error('ChangeTree: missing index for field "'.concat(A,'"'))},A}();function Q(K,A,T,G){return K[A]||(K[A]=[]),K[A].push(T),null===G||void 0===G||G.forEach((function(K,A){return T(K,A)})),function(){return Z(K[A],K[A].indexOf(T))}}function Y(A){var T=this,G="string"!==typeof this.$changes.getType();this.$items.forEach((function(B,L){A.push({refId:T.$changes.refId,op:K.OPERATION.DELETE,field:L,value:void 0,previousValue:B}),G&&T.$changes.root.removeRef(B.$changes.refId)}))}function Z(K,A){if(-1===A||A>=K.length)return!1;for(var T=K.length-1,G=A;G<T;G++)K[G]=K[G+1];return K.length=T,!0}var x=function(K,A){var T=K.toString(),G=A.toString();return T<G?-1:T>G?1:0};function J(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,A){return"symbol"===typeof A||isNaN(A)?K[A]:K.at(A)},set:function(K,A,T){if("symbol"===typeof A||isNaN(A))K[A]=T;else{var G=Array.from(K.$items.keys()),B=parseInt(G[A]||A);void 0===T||null===T?K.deleteAt(B):K.setAt(B,T)}return!0},deleteProperty:function(K,A){return"number"===typeof A?K.deleteAt(A):delete K[A],!0}})}var b=function(){function A(){for(var K=[],A=0;A<arguments.length;A++)K[A]=arguments[A];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,K)}return A.prototype.tO=function(A,T){return void 0===T&&(T=!0),Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,A,T?this.$items:void 0)},A.prototype.XL=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,A)},A.is=function(K){return Array.isArray(K)||void 0!==K.array},Object.defineProperty(A.prototype,"length",{get:function(){return this.$items.size},set:function(K){0===K?this.clear():this.splice(K,this.length-K)},enumerable:!1,configurable:!0}),A.prototype.push=function(){for(var K,A=this,T=[],G=0;G<arguments.length;G++)T[G]=arguments[G];return T.forEach((function(T){K=A.$refId++,A.setAt(K,T)})),K},A.prototype.pop=function(){var K=Array.from(this.$indexes.values()).pop();if(void 0!==K){this.$changes.delete(K),this.$indexes.delete(K);var A=this.$items.get(K);return this.$items.delete(K),A}},A.prototype.at=function(K){var A=Array.from(this.$items.keys())[K];return this.$items.get(A)},A.prototype.setAt=function(A,T){var G,B;if(void 0!==T&&null!==T){if(this.$items.get(A)!==T){void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,A);var L=null!==(B=null===(G=this.$changes.indexes[A])||void 0===G?void 0:G.op)&&void 0!==B?B:K.OPERATION.ADD;this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,T),this.$changes.change(A,L)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},A.prototype.deleteAt=function(K){var A=Array.from(this.$items.keys())[K];return void 0!==A&&this.$deleteAt(A)},A.prototype.$deleteAt=function(K){return this.$changes.delete(K),this.$indexes.delete(K),this.$items.delete(K)},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&Y.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.concat=function(){for(var K,T=[],G=0;G<arguments.length;G++)T[G]=arguments[G];return new(A.bind.apply(A,B([void 0],(K=Array.from(this.$items.values())).concat.apply(K,T),!1)))},A.prototype.join=function(K){return Array.from(this.$items.values()).join(K)},A.prototype.reverse=function(){var K=this,A=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(T,G){K.setAt(A[G],T)})),this},A.prototype.shift=function(){var K=Array.from(this.$items.keys()).shift();if(void 0!==K){var A=this.$items.get(K);return this.$deleteAt(K),A}},A.prototype.slice=function(K,T){var G=new A;return G.push.apply(G,Array.from(this.$items.values()).slice(K,T)),G},A.prototype.sort=function(K){var A=this;void 0===K&&(K=x);var T=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(K).forEach((function(K,G){A.setAt(T[G],K)})),this},A.prototype.splice=function(K,A){void 0===A&&(A=this.length-K);for(var T=Array.from(this.$items.keys()),G=[],B=K;B<K+A;B++)G.push(this.$items.get(T[B])),this.$deleteAt(T[B]);return G},A.prototype.unshift=function(){for(var K=this,A=[],T=0;T<arguments.length;T++)A[T]=arguments[T];var G=this.length,B=A.length,L=Array.from(this.$items.values());return A.forEach((function(A,T){K.setAt(T,A)})),L.forEach((function(A,T){K.setAt(B+T,A)})),G+B},A.prototype.indexOf=function(K,A){return Array.from(this.$items.values()).indexOf(K,A)},A.prototype.lastIndexOf=function(K,A){return void 0===A&&(A=this.length-1),Array.from(this.$items.values()).lastIndexOf(K,A)},A.prototype.every=function(K,A){return Array.from(this.$items.values()).every(K,A)},A.prototype.some=function(K,A){return Array.from(this.$items.values()).some(K,A)},A.prototype.forEach=function(K,A){Array.from(this.$items.values()).forEach(K,A)},A.prototype.map=function(K,A){return Array.from(this.$items.values()).map(K,A)},A.prototype.filter=function(K,A){return Array.from(this.$items.values()).filter(K,A)},A.prototype.reduce=function(K,A){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},A.prototype.reduceRight=function(K,A){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},A.prototype.find=function(K,A){return Array.from(this.$items.values()).find(K,A)},A.prototype.findIndex=function(K,A){return Array.from(this.$items.values()).findIndex(K,A)},A.prototype.fill=function(K,A,T){throw new Error("ArraySchema#fill() not implemented")},A.prototype.copyWithin=function(K,A,T){throw new Error("ArraySchema#copyWithin() not implemented")},A.prototype.toString=function(){return this.$items.toString()},A.prototype.toLocaleString=function(){return this.$items.toLocaleString()},A.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(A,Symbol.species,{get:function(){return A},enumerable:!1,configurable:!0}),A.prototype.entries=function(){return this.$items.entries()},A.prototype.keys=function(){return this.$items.keys()},A.prototype.values=function(){return this.$items.values()},A.prototype.includes=function(K,A){return Array.from(this.$items.values()).includes(K,A)},A.prototype.flatMap=function(K,A){throw new Error("ArraySchema#flatMap() is not supported.")},A.prototype.flat=function(K){throw new Error("ArraySchema#flat() is not supported.")},A.prototype.findLast=function(){var K=Array.from(this.$items.values());return K.findLast.apply(K,arguments)},A.prototype.findLastIndex=function(){var K=Array.from(this.$items.values());return K.findLastIndex.apply(K,arguments)},A.prototype.setIndex=function(K,A){this.$indexes.set(K,A)},A.prototype.getIndex=function(K){return this.$indexes.get(K)},A.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},A.prototype.deleteByIndex=function(K){var A=this.$indexes.get(K);this.$items.delete(A),this.$indexes.delete(K)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){return this.toArray().map((function(K){return"function"===typeof K.toJSON?K.toJSON():K}))},A.prototype.clone=function(K){return K?new(A.bind.apply(A,B([void 0],Array.from(this.$items.values()),!1))):new(A.bind.apply(A,B([void 0],this.map((function(K){return K.$changes?K.clone():K})),!1)))},A}();function P(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,A){return"symbol"!==typeof A&&"undefined"===typeof K[A]?K.get(A):K[A]},set:function(K,A,T){return"symbol"!==typeof A&&-1===A.indexOf("$")&&"tO"!==A&&"XL"!==A&&"onChange"!==A?K.set(A,T):K[A]=T,!0},deleteProperty:function(K,A){return K.delete(A),!0}})}var F=function(){function A(K){var T=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K)if(K instanceof Map||K instanceof A)K.forEach((function(K,A){return T.set(A,K)}));else for(var G in K)this.set(G,K[G])}return A.prototype.tO=function(A,T){return void 0===T&&(T=!0),Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,A,T?this.$items:void 0)},A.prototype.XL=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,A)},A.is=function(K){return void 0!==K.map},A.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(A.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(A,Symbol.species,{get:function(){return A},enumerable:!1,configurable:!0}),A.prototype.set=function(A,T){if(void 0===T||null===T)throw new Error("MapSchema#set('".concat(A,"', ").concat(T,"): trying to set ").concat(T," value on '").concat(A,"'."));A=A.toString();var G="undefined"!==typeof this.$changes.indexes[A],B=G?this.$changes.indexes[A]:this.$refId++,L=G?K.OPERATION.REPLACE:K.OPERATION.ADD,f=void 0!==T.$changes;if(f&&T.$changes.setParent(this,this.$changes.root,B),G){if(!f&&this.$items.get(A)===T)return;f&&this.$items.get(A)!==T&&(L=K.OPERATION.ADD)}else this.$changes.indexes[A]=B,this.$indexes.set(B,A);return this.$items.set(A,T),this.$changes.change(A,L),this},A.prototype.get=function(K){return this.$items.get(K)},A.prototype.delete=function(K){return this.$changes.delete(K),this.$items.delete(K)},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&Y.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(K){return this.$items.has(K)},A.prototype.forEach=function(K){this.$items.forEach(K)},A.prototype.entries=function(){return this.$items.entries()},A.prototype.keys=function(){return this.$items.keys()},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(K,A){this.$indexes.set(K,A)},A.prototype.getIndex=function(K){return this.$indexes.get(K)},A.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},A.prototype.deleteByIndex=function(K){var A=this.$indexes.get(K);this.$items.delete(A),this.$indexes.delete(K)},A.prototype.toJSON=function(){var K={};return this.forEach((function(A,T){K[T]="function"===typeof A.toJSON?A.toJSON():A})),K},A.prototype.clone=function(K){var T;return K?T=Object.assign(new A,this):(T=new A,this.forEach((function(K,A){K.$changes?T.set(A,K.clone()):T.set(A,K)}))),T},A}(),d={};function N(K,A){d[K]=A}function D(K){return d[K]}var mK=function(){function K(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return K.create=function(A){var T=new K;return T.schema=Object.assign({},A&&A.schema||{}),T.indexes=Object.assign({},A&&A.indexes||{}),T.fieldsByIndex=Object.assign({},A&&A.fieldsByIndex||{}),T.descriptors=Object.assign({},A&&A.descriptors||{}),T.deprecated=Object.assign({},A&&A.deprecated||{}),T},K.prototype.addField=function(K,A){var T=this.getNextFieldIndex();this.fieldsByIndex[T]=K,this.indexes[K]=T,this.schema[K]=Array.isArray(A)?{array:A[0]}:A},K.prototype.hasField=function(K){return void 0!==this.indexes[K]},K.prototype.addFilter=function(K,A){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[K]]=A,this.indexesWithFilters.push(this.indexes[K]),!0},K.prototype.addChildrenFilter=function(K,A){var T=this.indexes[K],G=this.schema[K];if(D(Object.keys(G)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[T]=A,!0;console.warn("@filterChildren: field '".concat(K,"' can't have children. Ignoring filter."))},K.prototype.getChildrenFilter=function(K){return this.childFilters&&this.childFilters[this.indexes[K]]},K.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},K}();function U(K){return K._context&&K._context.useFilters}var z=function(){function K(){this.types={},this.schemas=new Map,this.useFilters=!1}return K.prototype.has=function(K){return this.schemas.has(K)},K.prototype.get=function(K){return this.types[K]},K.prototype.add=function(K,A){void 0===A&&(A=this.schemas.size),K._definition=mK.create(K._definition),K._typeid=A,this.types[A]=K,this.schemas.set(K,A)},K.create=function(A){return void 0===A&&(A={}),function(T){return A.context||(A.context=new K),S(T,A)}},K}(),g=new z;function S(K,A){return void 0===A&&(A={}),function(T,G){var L=A.context||g,f=T.constructor;if(f._context=L,!K)throw new Error("".concat(f.name,': @type() reference provided for "').concat(G,"\" is undefined. Make sure you don't have any circular dependencies."));L.has(f)||L.add(f);var O=f._definition;if(O.addField(G,K),O.descriptors[G]){if(O.deprecated[G])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(G,"' definition on '").concat(f.name,"'.\nCheck @type() annotation"))}catch(d){var C=d.stack.split("\n")[4].trim();throw new Error("".concat(d.message," ").concat(C))}}var Q=b.is(K),Y=!Q&&F.is(K);if("string"!==typeof K&&!pK.is(K)){var Z=Object.values(K)[0];"string"===typeof Z||L.has(Z)||L.add(Z)}if(A.manual)O.descriptors[G]={enumerable:!0,configurable:!0,writable:!0};else{var x="_".concat(G);O.descriptors[x]={enumerable:!1,configurable:!1,writable:!0},O.descriptors[G]={get:function(){return this[x]},set:function(K){K!==this[x]&&(void 0!==K&&null!==K?(!Q||K instanceof b||(K=new(b.bind.apply(b,B([void 0],K,!1)))),!Y||K instanceof F||(K=new F(K)),void 0===K.$proxy&&(Y?K=P(K):Q&&(K=J(K))),this.$changes.change(G),K.$changes&&K.$changes.setParent(this,this.$changes.root,this._definition.indexes[G])):this[x]&&this.$changes.delete(G),this[x]=K)},enumerable:!0,configurable:!0}}}}function l(K){return function(A,T){var G=A.constructor;G._definition.addFilter(T,K)&&(G._context.useFilters=!0)}}function u(K){return function(A,T){var G=A.constructor;G._definition.addChildrenFilter(T,K)&&(G._context.useFilters=!0)}}function c(K){return void 0===K&&(K=!0),function(A,T){var G=A.constructor._definition;G.deprecated[T]=!0,K&&(G.descriptors[T]={get:function(){throw new Error("".concat(T," is deprecated."))},set:function(K){},enumerable:!1,configurable:!0})}}function n(K,A,T){for(var G in void 0===T&&(T={}),T.context||(T.context=K._context||T.context||g),A)S(A[G],T)(K.prototype,G);return K}function H(K){for(var A=0,T=0,G=0,B=K.length;G<B;G++)(A=K.charCodeAt(G))<128?T+=1:A<2048?T+=2:A<55296||A>=57344?T+=3:(G++,T+=4);return T}function e(K,A,T){for(var G=0,B=0,L=T.length;B<L;B++)(G=T.charCodeAt(B))<128?K[A++]=G:G<2048?(K[A++]=192|G>>6,K[A++]=128|63&G):G<55296||G>=57344?(K[A++]=224|G>>12,K[A++]=128|G>>6&63,K[A++]=128|63&G):(B++,G=65536+((1023&G)<<10|1023&T.charCodeAt(B)),K[A++]=240|G>>18,K[A++]=128|G>>12&63,K[A++]=128|G>>6&63,K[A++]=128|63&G)}function p(K,A){K.push(255&A)}function r(K,A){K.push(255&A)}function h(K,A){K.push(255&A),K.push(A>>8&255)}function k(K,A){K.push(255&A),K.push(A>>8&255)}function s(K,A){K.push(255&A),K.push(A>>8&255),K.push(A>>16&255),K.push(A>>24&255)}function j(K,A){var T=A>>24,G=A>>16,B=A>>8,L=A;K.push(255&L),K.push(255&B),K.push(255&G),K.push(255&T)}function R(K,A){var T=Math.floor(A/Math.pow(2,32));j(K,A>>>0),j(K,T)}function v(K,A){var T=A/Math.pow(2,32)|0;j(K,A>>>0),j(K,T)}function I(K,A){X(K,A)}function o(K,A){q(K,A)}var W=new Int32Array(2),i=new Float32Array(W.buffer),V=new Float64Array(W.buffer);function X(K,A){i[0]=A,s(K,W[0])}function q(K,A){V[0]=A,s(K,W[0]),s(K,W[1])}function y(K,A){return r(K,A?1:0)}function w(K,A){A||(A="");var T=H(A),G=0;if(T<32)K.push(160|T),G=1;else if(T<256)K.push(217),r(K,T),G=2;else if(T<65536)K.push(218),k(K,T),G=3;else{if(!(T<4294967296))throw new Error("String too long");K.push(219),j(K,T),G=5}return e(K,K.length,A),G+T}function a(K,A){return isNaN(A)?a(K,0):isFinite(A)?A!==(0|A)?(K.push(203),q(K,A),9):A>=0?A<128?(r(K,A),1):A<256?(K.push(204),r(K,A),2):A<65536?(K.push(205),k(K,A),3):A<4294967296?(K.push(206),j(K,A),5):(K.push(207),v(K,A),9):A>=-32?(K.push(224|A+32),1):A>=-128?(K.push(208),p(K,A),2):A>=-32768?(K.push(209),h(K,A),3):A>=-2147483648?(K.push(210),s(K,A),5):(K.push(211),R(K,A),9):a(K,A>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var M=Object.freeze({__proto__:null,utf8Write:e,int8:p,uint8:r,int16:h,uint16:k,int32:s,uint32:j,int64:R,uint64:v,float32:I,float64:o,writeFloat32:X,writeFloat64:q,boolean:y,string:w,number:a});function E(K,A,T){for(var G="",B=0,L=A,f=A+T;L<f;L++){var O=K[L];0!==(128&O)?192!==(224&O)?224!==(240&O)?240!==(248&O)?console.error("Invalid byte "+O.toString(16)):(B=(7&O)<<18|(63&K[++L])<<12|(63&K[++L])<<6|63&K[++L])>=65536?(B-=65536,G+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):G+=String.fromCharCode(B):G+=String.fromCharCode((15&O)<<12|(63&K[++L])<<6|63&K[++L]):G+=String.fromCharCode((31&O)<<6|63&K[++L]):G+=String.fromCharCode(O)}return G}function t(K,A){return KK(K,A)<<24>>24}function KK(K,A){return K[A.offset++]}function AK(K,A){return TK(K,A)<<16>>16}function TK(K,A){return K[A.offset++]|K[A.offset++]<<8}function GK(K,A){return K[A.offset++]|K[A.offset++]<<8|K[A.offset++]<<16|K[A.offset++]<<24}function BK(K,A){return GK(K,A)>>>0}function LK(K,A){return xK(K,A)}function fK(K,A){return JK(K,A)}function OK(K,A){var T=BK(K,A);return GK(K,A)*Math.pow(2,32)+T}function CK(K,A){var T=BK(K,A);return BK(K,A)*Math.pow(2,32)+T}var QK=new Int32Array(2),YK=new Float32Array(QK.buffer),ZK=new Float64Array(QK.buffer);function xK(K,A){return QK[0]=GK(K,A),YK[0]}function JK(K,A){return QK[0]=GK(K,A),QK[1]=GK(K,A),ZK[0]}function bK(K,A){return KK(K,A)>0}function PK(K,A){var T,G=K[A.offset++];G<192?T=31&G:217===G?T=KK(K,A):218===G?T=TK(K,A):219===G&&(T=BK(K,A));var B=E(K,A.offset,T);return A.offset+=T,B}function FK(K,A){var T=K[A.offset];return T<192&&T>160||217===T||218===T||219===T}function dK(K,A){var T=K[A.offset++];return T<128?T:202===T?xK(K,A):203===T?JK(K,A):204===T?KK(K,A):205===T?TK(K,A):206===T?BK(K,A):207===T?CK(K,A):208===T?t(K,A):209===T?AK(K,A):210===T?GK(K,A):211===T?OK(K,A):T>223?-1*(255-T+1):void 0}function NK(K,A){var T=K[A.offset];return T<128||T>=202&&T<=211}function DK(K,A){return K[A.offset]<160}function mA(K,A){return K[A.offset-1]===f&&(K[A.offset]<128||K[A.offset]>=202&&K[A.offset]<=211)}var UK=Object.freeze({__proto__:null,int8:t,uint8:KK,int16:AK,uint16:TK,int32:GK,uint32:BK,float32:LK,float64:fK,int64:OK,uint64:CK,readFloat32:xK,readFloat64:JK,boolean:bK,string:PK,stringCheck:FK,number:dK,numberCheck:NK,arrayCheck:DK,switchStructureCheck:mA}),zK=function(){function A(K){var A=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return A.add(K)}))}return A.prototype.tO=function(A,T){return void 0===T&&(T=!0),Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,A,T?this.$items:void 0)},A.prototype.XL=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,A)},A.is=function(K){return void 0!==K.collection},A.prototype.add=function(K){var A=this.$refId++;return void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,A),this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,K),this.$changes.change(A),A},A.prototype.at=function(K){var A=Array.from(this.$items.keys())[K];return this.$items.get(A)},A.prototype.entries=function(){return this.$items.entries()},A.prototype.delete=function(K){for(var A,T,G=this.$items.entries();(T=G.next())&&!T.done;)if(K===T.value[1]){A=T.value[0];break}return void 0!==A&&(this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A))},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&Y.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(K){return Array.from(this.$items.values()).some((function(A){return A===K}))},A.prototype.forEach=function(K){var A=this;this.$items.forEach((function(T,G,B){return K(T,G,A)}))},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(K,A){this.$indexes.set(K,A)},A.prototype.getIndex=function(K){return this.$indexes.get(K)},A.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},A.prototype.deleteByIndex=function(K){var A=this.$indexes.get(K);this.$items.delete(A),this.$indexes.delete(K)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){var K=[];return this.forEach((function(A,T){K.push("function"===typeof A.toJSON?A.toJSON():A)})),K},A.prototype.clone=function(K){var T;return K?T=Object.assign(new A,this):(T=new A,this.forEach((function(K){K.$changes?T.add(K.clone()):T.add(K)}))),T},A}(),gK=function(){function A(K){var A=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return A.add(K)}))}return A.prototype.tO=function(A,T){return void 0===T&&(T=!0),Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,A,T?this.$items:void 0)},A.prototype.XL=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,A)},A.is=function(K){return void 0!==K.set},A.prototype.add=function(A){var T,G;if(this.has(A))return!1;var B=this.$refId++;void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,B);var L=null!==(G=null===(T=this.$changes.indexes[B])||void 0===T?void 0:T.op)&&void 0!==G?G:K.OPERATION.ADD;return this.$changes.indexes[B]=B,this.$indexes.set(B,B),this.$items.set(B,A),this.$changes.change(B,L),B},A.prototype.entries=function(){return this.$items.entries()},A.prototype.delete=function(K){for(var A,T,G=this.$items.entries();(T=G.next())&&!T.done;)if(K===T.value[1]){A=T.value[0];break}return void 0!==A&&(this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A))},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&Y.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(K){for(var A,T=this.$items.values(),G=!1;(A=T.next())&&!A.done;)if(K===A.value){G=!0;break}return G},A.prototype.forEach=function(K){var A=this;this.$items.forEach((function(T,G,B){return K(T,G,A)}))},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(K,A){this.$indexes.set(K,A)},A.prototype.getIndex=function(K){return this.$indexes.get(K)},A.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},A.prototype.deleteByIndex=function(K){var A=this.$indexes.get(K);this.$items.delete(A),this.$indexes.delete(K)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){var K=[];return this.forEach((function(A,T){K.push("function"===typeof A.toJSON?A.toJSON():A)})),K},A.prototype.clone=function(K){var T;return K?T=Object.assign(new A,this):(T=new A,this.forEach((function(K){K.$changes?T.add(K.clone()):T.add(K)}))),T},A}(),SK=function(){function K(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return K.prototype.addRefId=function(K){this.refIds.has(K)||(this.refIds.add(K),this.containerIndexes.set(K,new Set))},K.get=function(A){return void 0===A.$filterState&&(A.$filterState=new K),A.$filterState},K}(),lK=function(){function K(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return K.prototype.getNextUniqueId=function(){return this.nextUniqueId++},K.prototype.addRef=function(K,A,T){void 0===T&&(T=!0),this.refs.set(K,A),T&&(this.refCounts[K]=(this.refCounts[K]||0)+1)},K.prototype.removeRef=function(K){this.refCounts[K]=this.refCounts[K]-1,this.deletedRefs.add(K)},K.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},K.prototype.garbageCollectDeletedRefs=function(){var K=this;this.deletedRefs.forEach((function(A){if(!(K.refCounts[A]>0)){var T=K.refs.get(A);if(T instanceof pK)for(var G in T._definition.schema)"string"!==typeof T._definition.schema[G]&&T[G]&&T[G].$changes&&K.removeRef(T[G].$changes.refId);else{var B=T.$changes.parent._definition,L=B.schema[B.fieldsByIndex[T.$changes.parentIndex]];"function"===typeof Object.values(L)[0]&&Array.from(T.values()).forEach((function(A){return K.removeRef(A.$changes.refId)}))}K.refs.delete(A),delete K.refCounts[A]}})),this.deletedRefs.clear()},K}(),uK=function(K){function A(){return null!==K&&K.apply(this,arguments)||this}return T(A,K),A}(Error);function cK(K,A,T,G){var B,L=!1;switch(A){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":B="number",isNaN(K)&&console.log('trying to encode "NaN" in '.concat(T.constructor.name,"#").concat(G));break;case"string":B="string",L=!0;break;case"boolean":return}if(typeof K!==B&&(!L||L&&null!==K)){var f="'".concat(JSON.stringify(K),"'").concat(K&&K.constructor&&" (".concat(K.constructor.name,")")||"");throw new uK("a '".concat(B,"' was expected, but ").concat(f," was provided in ").concat(T.constructor.name,"#").concat(G))}}function nK(K,A,T,G){if(!(K instanceof A))throw new uK("a '".concat(A.name,"' was expected, but '").concat(K.constructor.name,"' was provided in ").concat(T.constructor.name,"#").concat(G))}function HK(K,A,T,G,B){cK(T,K,G,B);var L=M[K];if(!L)throw new uK("a '".concat(K,"' was expected, but ").concat(T," was provided in ").concat(G.constructor.name,"#").concat(B));L(A,T)}function eK(K,A,T){return UK[K](A,T)}var pK=function(){function A(){for(var K=[],A=0;A<arguments.length;A++)K[A]=arguments[A];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new lK),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var T=this._definition.descriptors;T&&Object.defineProperties(this,T),K[0]&&this.assign(K[0])}return A.onError=function(K){console.error(K)},A.is=function(K){return K._definition&&void 0!==K._definition.schema},A.prototype.onChange=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,A)},A.prototype.XL=function(A){return Q(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,A)},A.prototype.assign=function(K){return Object.assign(this,K),this},Object.defineProperty(A.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),A.prototype.setDirty=function(K,A){this.$changes.change(K,A)},A.prototype.listen=function(K,A,T){var G=this;return void 0===T&&(T=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[K]||(this.$callbacks[K]=[]),this.$callbacks[K].push(A),T&&void 0!==this[K]&&A(this[K],void 0),function(){return Z(G.$callbacks[K],G.$callbacks[K].indexOf(A))}},A.prototype.decode=function(T,G,B){var L;void 0===G&&(G={offset:0}),void 0===B&&(B=this);var O=[],C=this.$changes.root,Q=T.length,Y=0;for(C.refs.set(Y,this);G.offset<Q;){var Z=T[G.offset++];if(Z!=f){var x=B.$changes,J=void 0!==B._definition,P=J?Z>>6<<6:Z;if(P!==K.OPERATION.CLEAR){var d=J?Z%(P||255):dK(T,G),N=J?B._definition.fieldsByIndex[d]:"",mK=x.getType(d),U=void 0,z=void 0,g=void 0;if(J?z=B["_".concat(N)]:(z=B.getByIndex(d),(P&K.OPERATION.ADD)===K.OPERATION.ADD?(g=B instanceof F?PK(T,G):d,B.setIndex(d,g)):g=B.getIndex(d)),(P&K.OPERATION.DELETE)===K.OPERATION.DELETE&&(P!==K.OPERATION.DELETE_AND_ADD&&B.deleteByIndex(d),z&&z.$changes&&C.removeRef(z.$changes.refId),U=null),void 0!==N){if(P===K.OPERATION.DELETE);else if(A.is(mK)){var S=dK(T,G);if(U=C.refs.get(S),P!==K.OPERATION.REPLACE){var l=this.getSchemaType(T,G,mK);U||((U=this.createTypeInstance(l)).$changes.refId=S,z&&(U.$callbacks=z.$callbacks,z.$changes.refId&&S!==z.$changes.refId&&C.removeRef(z.$changes.refId))),C.addRef(S,U,U!==z)}}else if("string"===typeof mK)U=eK(mK,T,G);else{var u=D(Object.keys(mK)[0]),c=dK(T,G),n=C.refs.has(c)?z||C.refs.get(c):new u.constructor;if((U=n.clone(!0)).$changes.refId=c,z&&(U.$callbacks=z.$callbacks,z.$changes.refId&&c!==z.$changes.refId)){C.removeRef(z.$changes.refId);for(var H=z.entries(),e=void 0;(e=H.next())&&!e.done;){var p=(L=e.value)[0],r=L[1];O.push({refId:c,op:K.OPERATION.DELETE,field:p,value:void 0,previousValue:r})}}C.addRef(c,U,n!==z)}if(null!==U&&void 0!==U)if(U.$changes&&U.$changes.setParent(x.ref,x.root,d),B instanceof A)B[N]=U;else if(B instanceof F)p=g,B.$items.set(p,U),B.$changes.allChanges.add(d);else if(B instanceof b)B.setAt(d,U);else if(B instanceof zK){var h=B.add(U);B.setIndex(d,h)}else B instanceof gK&&!1!==(h=B.add(U))&&B.setIndex(d,h);z!==U&&O.push({refId:Y,op:P,field:N,dynamicIndex:g,value:U,previousValue:z})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:G.offset};G.offset<Q&&(!mA(T,G)||(k.offset=G.offset+1,!C.refs.has(dK(T,k))));)G.offset++}}else B.clear(O)}else{Y=dK(T,G);var s=C.refs.get(Y);if(!s)throw new Error('"refId" not found: '.concat(Y));B=s}}return this._triggerChanges(O),C.garbageCollectDeletedRefs(),O},A.prototype.encode=function(T,G,B){void 0===T&&(T=!1),void 0===G&&(G=[]),void 0===B&&(B=!1);for(var L=this.$changes,O=new WeakSet,C=[L],Q=1,Y=0;Y<Q;Y++){var Z=C[Y],x=Z.ref,J=x instanceof A;Z.ensureRefId(),O.add(Z),Z!==L&&(Z.changed||T)&&(r(G,f),a(G,Z.refId));for(var b=T?Array.from(Z.allChanges):Array.from(Z.changes.values()),P=0,d=b.length;P<d;P++){var N=T?{op:K.OPERATION.ADD,index:b[P]}:b[P],mK=N.index,U=J?x._definition.fieldsByIndex&&x._definition.fieldsByIndex[mK]:mK,z=G.length;if(N.op!==K.OPERATION.TOUCH)if(J)r(G,mK|N.op);else{if(r(G,N.op),N.op===K.OPERATION.CLEAR)continue;a(G,mK)}if(J||(N.op&K.OPERATION.ADD)!=K.OPERATION.ADD||x instanceof F&&w(G,Z.ref.$indexes.get(mK)),N.op!==K.OPERATION.DELETE){var g=Z.getType(mK),S=Z.getValue(mK);if(S&&S.$changes&&!O.has(S.$changes)&&(C.push(S.$changes),S.$changes.ensureRefId(),Q++),N.op!==K.OPERATION.TOUCH){if(A.is(g))nK(S,g,x,U),a(G,S.$changes.refId),(N.op&K.OPERATION.ADD)===K.OPERATION.ADD&&this.tryEncodeTypeId(G,g,S.constructor);else if("string"===typeof g)HK(g,G,S,x,U);else{var l=D(Object.keys(g)[0]);nK(x["_".concat(U)],l.constructor,x,U),a(G,S.$changes.refId)}B&&Z.cache(mK,G.slice(z))}}}T||B||Z.discard()}return G},A.prototype.encodeAll=function(K){return this.encode(!0,[],K)},A.prototype.applyFilters=function(T,G){var B,L;void 0===G&&(G=!1);for(var O=this,C=new Set,Q=SK.get(T),Y=[this.$changes],Z=1,x=[],J=function(J){var b=Y[J];if(C.has(b.refId))return"continue";var P=b.ref,d=P instanceof A;r(x,f),a(x,b.refId);var N=Q.refIds.has(b),D=G||!N;Q.addRefId(b);var mK=Q.containerIndexes.get(b),U=D?Array.from(b.allChanges):Array.from(b.changes.values());!G&&d&&P._definition.indexesWithFilters&&P._definition.indexesWithFilters.forEach((function(A){!mK.has(A)&&b.allChanges.has(A)&&(D?U.push(A):U.push({op:K.OPERATION.ADD,index:A}))}));for(var z=0,g=U.length;z<g;z++){var S=D?{op:K.OPERATION.ADD,index:U[z]}:U[z];if(S.op!==K.OPERATION.CLEAR){var l=S.index;if(S.op!==K.OPERATION.DELETE){var u=b.getValue(l),c=b.getType(l);if(d){if((n=P._definition.filters&&P._definition.filters[l])&&!n.call(P,T,u,O)){u&&u.$changes&&C.add(u.$changes.refId);continue}}else{var n,H=b.parent;if((n=b.getChildrenFilter())&&!n.call(H,T,P.$indexes.get(l),u,O)){u&&u.$changes&&C.add(u.$changes.refId);continue}}if(u.$changes&&(Y.push(u.$changes),Z++),S.op!==K.OPERATION.TOUCH)if(S.op===K.OPERATION.ADD||d)x.push.apply(x,null!==(B=b.caches[l])&&void 0!==B?B:[]),mK.add(l);else if(mK.has(l))x.push.apply(x,null!==(L=b.caches[l])&&void 0!==L?L:[]);else{if(mK.add(l),r(x,K.OPERATION.ADD),a(x,l),P instanceof F){var e=b.ref.$indexes.get(l);w(x,e)}u.$changes?a(x,u.$changes.refId):M[c](x,u)}else u.$changes&&!d&&(r(x,K.OPERATION.ADD),a(x,l),P instanceof F&&(e=b.ref.$indexes.get(l),w(x,e)),a(x,u.$changes.refId))}else d?r(x,S.op|l):(r(x,S.op),a(x,l))}else r(x,S.op)}},b=0;b<Z;b++)J(b);return x},A.prototype.clone=function(){var K,A=new this.constructor,T=this._definition.schema;for(var G in T)"object"===typeof this[G]&&"function"===typeof(null===(K=this[G])||void 0===K?void 0:K.clone)?A[G]=this[G].clone():A[G]=this[G];return A},A.prototype.toJSON=function(){var K=this._definition.schema,A=this._definition.deprecated,T={};for(var G in K)A[G]||null===this[G]||"undefined"===typeof this[G]||(T[G]="function"===typeof this[G].toJSON?this[G].toJSON():this["_".concat(G)]);return T},A.prototype.discardAllChanges=function(){this.$changes.discardAll()},A.prototype.getByIndex=function(K){return this[this._definition.fieldsByIndex[K]]},A.prototype.deleteByIndex=function(K){this[this._definition.fieldsByIndex[K]]=void 0},A.prototype.tryEncodeTypeId=function(K,A,T){A._typeid!==T._typeid&&(r(K,O),a(K,T._typeid))},A.prototype.getSchemaType=function(K,A,T){var G;return K[A.offset]===O&&(A.offset++,G=this.constructor._context.get(dK(K,A))),G||T},A.prototype.createTypeInstance=function(K){var A=new K;return A.$changes.root=this.$changes.root,A},A.prototype._triggerChanges=function(T){for(var G,B,L,f,O,C,Q,Y,Z,x=new Set,J=this.$changes.root.refs,b=function(b){var P=T[b],F=P.refId,d=J.get(F),N=d.$callbacks;if((P.op&K.OPERATION.DELETE)===K.OPERATION.DELETE&&P.previousValue instanceof A&&(null===(B=null===(G=P.previousValue.$callbacks)||void 0===G?void 0:G[K.OPERATION.DELETE])||void 0===B||B.forEach((function(K){return K()}))),!N)return"continue";if(d instanceof A){if(!x.has(F))try{null===(L=null===N||void 0===N?void 0:N[K.OPERATION.REPLACE])||void 0===L||L.forEach((function(K){return K()}))}catch(D){A.onError(D)}try{N.hasOwnProperty(P.field)&&(null===(f=N[P.field])||void 0===f||f.forEach((function(K){return K(P.value,P.previousValue)})))}catch(D){A.onError(D)}}else P.op===K.OPERATION.ADD&&void 0===P.previousValue?null===(O=N[K.OPERATION.ADD])||void 0===O||O.forEach((function(K){var A;return K(P.value,null!==(A=P.dynamicIndex)&&void 0!==A?A:P.field)})):P.op===K.OPERATION.DELETE?void 0!==P.previousValue&&(null===(C=N[K.OPERATION.DELETE])||void 0===C||C.forEach((function(K){var A;return K(P.previousValue,null!==(A=P.dynamicIndex)&&void 0!==A?A:P.field)}))):P.op===K.OPERATION.DELETE_AND_ADD&&(void 0!==P.previousValue&&(null===(Q=N[K.OPERATION.DELETE])||void 0===Q||Q.forEach((function(K){var A;return K(P.previousValue,null!==(A=P.dynamicIndex)&&void 0!==A?A:P.field)}))),null===(Y=N[K.OPERATION.ADD])||void 0===Y||Y.forEach((function(K){var A;return K(P.value,null!==(A=P.dynamicIndex)&&void 0!==A?A:P.field)}))),P.value!==P.previousValue&&(null===(Z=N[K.OPERATION.REPLACE])||void 0===Z||Z.forEach((function(K){var A;return K(P.value,null!==(A=P.dynamicIndex)&&void 0!==A?A:P.field)})));x.add(F)},P=0;P<T.length;P++)b(P)},A._definition=mK.create(),A}();function rK(K){for(var A=[K.$changes],T=1,G={},B=G,L=function(K){var T=A[K];T.changes.forEach((function(K){var A=T.ref,G=K.index,L=A._definition?A._definition.fieldsByIndex[G]:A.$indexes.get(G);B[L]=T.getValue(G)}))},f=0;f<T;f++)L(f);return G}var hK={context:new z},kK=function(K){function A(){return null!==K&&K.apply(this,arguments)||this}return T(A,K),G([S("string",hK)],A.prototype,"name",void 0),G([S("string",hK)],A.prototype,"type",void 0),G([S("number",hK)],A.prototype,"referencedType",void 0),A}(pK),sK=function(K){function A(){var A=null!==K&&K.apply(this,arguments)||this;return A.fields=new b,A}return T(A,K),G([S("number",hK)],A.prototype,"id",void 0),G([S([kK],hK)],A.prototype,"fields",void 0),A}(pK),jK=function(K){function A(){var A=null!==K&&K.apply(this,arguments)||this;return A.types=new b,A}return T(A,K),A.encode=function(K){var T=K.constructor,G=new A;G.rootType=T._typeid;var B=function(K,A){for(var T in A){var B=new kK;B.name=T;var L=void 0;if("string"===typeof A[T])L=A[T];else{var f=A[T],O=void 0;pK.is(f)?(L="ref",O=A[T]):"string"===typeof f[L=Object.keys(f)[0]]?L+=":"+f[L]:O=f[L],B.referencedType=O?O._typeid:-1}B.type=L,K.fields.push(B)}G.types.push(K)},L=T._context.types;for(var f in L){var O=new sK;O.id=Number(f),B(O,L[f]._definition.schema)}return G.encodeAll()},A.decode=function(K,G){var B=new z,L=new A;L.decode(K,G);var f=L.types.reduce((function(K,A){var G=function(K){function A(){return null!==K&&K.apply(this,arguments)||this}return T(A,K),A}(pK),L=A.id;return K[L]=G,B.add(G,L),K}),{});L.types.forEach((function(K){var A=f[K.id];K.fields.forEach((function(K){var T;if(void 0!==K.referencedType){var G=K.type,L=f[K.referencedType];if(!L){var O=K.type.split(":");G=O[0],L=O[1]}"ref"===G?S(L,{context:B})(A.prototype,K.name):S(((T={})[G]=L,T),{context:B})(A.prototype,K.name)}else S(K.type,{context:B})(A.prototype,K.name)}))}));var O=f[L.rootType],C=new O;for(var Q in O._definition.schema){var Y=O._definition.schema[Q];"string"!==typeof Y&&(C[Q]="function"===typeof Y?new Y:new(D(Object.keys(Y)[0]).constructor))}return C},G([S([sK],hK)],A.prototype,"types",void 0),G([S("number",hK)],A.prototype,"rootType",void 0),A}(pK);N("map",{constructor:F}),N("array",{constructor:b}),N("set",{constructor:gK}),N("collection",{constructor:zK}),K.ArraySchema=b,K.CollectionSchema=zK,K.Context=z,K.MapSchema=F,K.Reflection=jK,K.ReflectionField=kK,K.ReflectionType=sK,K.Schema=pK,K.SchemaDefinition=mK,K.SetSchema=gK,K.decode=UK,K.defineTypes=n,K.deprecated=c,K.dumpChanges=rK,K.encode=M,K.filter=l,K.filterChildren=u,K.hasFilter=U,K.registerType=N,K.type=S,Object.defineProperty(K,"__esModule",{value:!0})}(A)},14806:function(K,A,T){var G,B,L;function f(){const K=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(f=function(){return K})()}function O(K,A){const T=f();return(O=function(K,A){return T[K-=212]})(K,A)}K=T.nmd(K),function(K){const A=O,T=K();for(;;)try{if(368192===parseInt(A(328))/1+parseInt(A(379))/2*(-parseInt(A(226))/3)+parseInt(A(348))/4*(parseInt(A(264))/5)+parseInt(A(224))/6*(-parseInt(A(223))/7)+-parseInt(A(345))/8*(parseInt(A(325))/9)+-parseInt(A(215))/10+-parseInt(A(275))/11*(-parseInt(A(383))/12))break;T.push(T.shift())}catch(G){T.push(T.shift())}}(f),function(f,C){const Q=O;Q(262)==typeof A&&"object"==Q(262)?K[Q(337)]=C():"function"==Q(237)&&T.amdD[Q(400)]?(B=[],void 0===(L="function"===typeof(G=C)?G.apply(A,B):G)||(K.exports=L)):Q(262)==typeof A?A[Q(277)]=C():f[Q(277)]=C()}(this,(()=>(()=>{var K={646:function(K){K[O(337)]=function(){"use strict";function K(K){const A=O;for(var T=1;T<arguments[A(302)];T++){var G=arguments[T];for(var B in G)K[B]=G[B]}return K}return function A(T,G){const B=O;function L(A,B,L){const f=O;if(f(363)!=typeof document){"number"==typeof(L=K({},G,L))[f(278)]&&(L[f(278)]=new Date(Date[f(235)]()+864e5*L[f(278)])),L[f(278)]&&(L[f(278)]=L[f(278)][f(351)]()),A=encodeURIComponent(A).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[f(320)](/[()]/g,escape);var C="";for(var Q in L)L[Q]&&(C+="; "+Q,!0!==L[Q]&&(C+="="+L[Q][f(335)](";")[0]));return document[f(295)]=A+"="+T[f(349)](B,A)+C}}return Object[B(260)]({set:L,get:function(K){const A=O;if(A(363)!=typeof document&&(!arguments[A(302)]||K)){for(var G=document.cookie?document[A(295)][A(335)]("; "):[],B={},L=0;L<G[A(302)];L++){var f=G[L][A(335)]("="),C=f[A(396)](1)[A(323)]("=");try{var Q=decodeURIComponent(f[0]);if(B[Q]=T[A(366)](C,Q),K===Q)break}catch(Y){}}return K?B[K]:B}},remove:function(A,T){L(A,"",K({},T,{expires:-1}))},withAttributes:function(T){return A(this[B(359)],K({},this.attributes,T))},withConverter:function(T){const G=B;return A(K({},this[G(359)],T),this[G(398)])}},{attributes:{value:Object[B(315)](G)},converter:{value:Object.freeze(T)}})}({read:function(K){const A=O;return'"'===K[0]&&(K=K[A(396)](1,-1)),K.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(K){const A=O;return encodeURIComponent(K)[A(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(382)]=void 0;const B=T(284);class L{static[G(218)](){const K=G;console[K(395)](K(212)),window.addEventListener(K(297),L[K(258)])}static onBeforeUnload(){const K=G;B[K(313)][K(236)]()}}A[G(382)]=L},719:(K,A,T)=>{"use strict";const G=O;Object.defineProperty(A,"__esModule",{value:!0}),A[G(290)]=void 0;const B=T(284),L=T(878);A[G(290)]=class{static[G(307)](K,A,T){const L=G;B.ByteBrewCore[L(307)](K,A,T)}static[G(339)](){const K=G;return B[K(313)][K(393)]}static[G(239)](K,A){const T=G;void 0===A?B.ByteBrewCore[T(239)](K):T(240)==typeof A?B.ByteBrewCore[T(247)](K,A):T(270)==typeof A?B[T(313)][T(243)](K,A):T(262)==typeof A&&B[T(313)][T(286)](K,A)}static loadRemoteConfigs(K){const A=G;L.RemoteConfigHandler[A(282)](K)}static[G(233)](K,A){const T=G;return L[T(272)][T(233)](K,A)}static[G(369)](){const K=G;return L[K(272)][K(369)]()}static[G(391)](){const K=G;B[K(313)][K(391)]()}static[G(384)](){const K=G;B[K(313)][K(384)]()}static[G(213)](){return B.ByteBrewCore.userID}}},441:function(K,A,T){"use strict";const G=O;var B=this&&this[G(329)]||function(K){return K&&K[G(220)]?K:{default:K}};Object[G(228)](A,G(220),{value:!0}),A[G(397)]=void 0;const L=B(T(646)),f=T(429);class C{static[G(332)](){const K=G,A=L[K(334)][K(311)](C[K(231)]);return A?{userID:A,isNewUser:!1,hasSuccessfullyInitialized:C[K(394)]()}:{userID:C.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[G(230)](){const K=G,A=(0,f.v4)();return L.default[K(242)](C[K(231)],A,{expires:365}),A}static setTrackingSettingsCookie(K){const A=G,T=A(K?248:367);L[A(334)].set(C[A(225)],T,{expires:365})}static[G(314)](){const K=G,A=L[K(334)][K(311)](C.trackingSettingsIDCookieKey);return!A||"true"===A}static[G(356)](){return C.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const K=G,A=L.default[K(311)](C[K(231)]);A&&L.default[K(242)](C.userHasInitializedSuccessfullyCookieKey,A,{expires:365})}static[G(330)](){const K=G,A=L[K(334)][K(311)](C[K(326)]),T=L[K(334)][K(311)](C[K(231)]);return!(!A||!T)&&A===T}static hasUserInitialized(){return C[G(330)]()}}A.ByteBrewCookieManager=C,C.userIDCookieKey=G(361),C.trackingSettingsIDCookieKey=G(357),C[G(326)]="bb_u_h_init"},284:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(313)]=void 0;const B=T(441),L=T(797),f=T(334),C=T(429),Q=T(147);class Y{static[G(246)](){const K=G;let A=navigator[K(281)][K(335)]("-");return A.length<2?"??":A[A.length-1]||"??"}static[G(307)](K,A,T){const L=G;if(Y[L(393)])return;if(console[L(395)]("ByteBrew: Starting Initialization"),!K||!A)return void console.log(L(256));if(Y[L(221)]=B[L(397)][L(356)](),!Y.trackingEnabled)return void console[L(395)](L(362));Y[L(399)]=K,Y[L(249)]=A,Y[L(336)]=T,Y.sessionID=(0,C.v4)(),Y.sessionKey="",Y[L(300)]=Q[L(305)],Y.language=navigator[L(281)],Y[L(385)]=Y[L(246)]();const O=B[L(397)][L(332)]();Y[L(308)]=O[L(308)],O.isNewUser||!O[L(293)]?Y.createNewUserEvent():Y[L(344)](),Y[L(331)]=new Date,f[L(382)][L(218)]()}static reinitializeByteBrew(){const K=G;console[K(395)](K(306)),Y.initializeByteBrew(Y[K(399)],Y[K(249)],Y[K(336)])}static[G(387)](K){const A=G;Y[A(214)]=K,Y[A(393)]=!0,Y.hasBeenInitializedWhilePageOpen=!0,B[A(397)][A(296)](),console[A(395)](A(386))}static[G(301)](){const K=G;Y[K(303)]&&(console.log(K(341)),this[K(217)]())}static[G(372)](){return Y[G(393)]&&Y.trackingEnabled}static getScreenResolution(){return window[G(227)]+"x"+window.innerHeight}static[G(241)](){const K=G;return{game_id:Y[K(399)],user_id:Y[K(308)],session_id:Y[K(318)],session_key:Y.sessionKey,platform:Y.platform}}static[G(244)](){const K=G;return Object[K(219)](Object[K(219)]({},Y[K(241)]()),{version_number:Y[K(336)],sdk_version:Y[K(300)],deviceScreenSize:Y[K(280)](),tracking_enabled:Y[K(221)]})}static[G(283)](K,A){const T=G;L.ByteBrewWebRequestor[T(380)](K,A).then((K=>{const A=T;if(K&&K.ok){const T=K.headers.get(A(354));T?Y.onInitializationSuccessful(T):console[A(395)](A(381))}else console[A(395)](A(232)+(K?K[A(259)]:"No Response"))}))}static createUserEvent(){const K=G;if(!Y[K(221)])return;console.log(K(353));let A={eventType:"game_open",userLocale:Y[K(281)]};const T=Object[K(219)](Object[K(219)]({},Y[K(244)]()),{category:K(269),geo:Y[K(385)],externalData:A});Y[K(283)](L.ByteBrewWebRequestor[K(238)],T)}static[G(285)](){const K=G;if(!Y[K(221)])return;console[K(395)](K(352));let A={eventType:K(309),userLocale:Y[K(281)]};const T=Object.assign(Object.assign({},Y.getFullEventObject()),{category:K(269),geo:Y[K(385)],externalData:A});Y[K(283)](L[K(265)][K(238)],T)}static endCurrentSession(){const K=G;if(!Y[K(372)]())return;Y[K(393)]=!1,console.log(K(350));const A=new Date;let T={sessionLength:Math[K(287)]((A[K(253)]()-Y[K(331)].getTime())/1e3)[K(251)]()};const B=Object[K(219)](Object[K(219)]({},Y[K(244)]()),{category:K(401),externalData:T});L.ByteBrewWebRequestor[K(380)](L[K(265)][K(238)],B)}static[G(252)](K){const A=G;let T="";if(!K)return T;for(const[G,B]of Object.entries(K))T+=G+"="+B+";";return T[A(302)]>0&&(T=T[A(396)](0,-1)),T}static[G(368)](K,A){const T=G;if(!Y.canSendData())return;console[T(395)](T(374)+K);let B={eventType:K};A&&(B=Object.assign(Object[T(219)]({},B),{value:"object"==typeof A?Y[T(252)](A):A[T(251)]()}));const f=Object[T(219)](Object[T(219)]({},Y[T(244)]()),{category:"custom",externalData:B});L.ByteBrewWebRequestor[T(380)](L[T(265)][T(238)],f)[T(378)]((K=>{const A=T;K&&K.ok?console.log(A(274)):console[A(395)](A(294)+(K?K.status:A(267)))}))}static[G(239)](K){Y[G(368)](K,null)}static[G(247)](K,A){Y.sendCustomEvent(K,A)}static newCustomEventWithNumber(K,A){Y.sendCustomEvent(K,A)}static[G(286)](K,A){Y[G(368)](K,A)}static[G(391)](){const K=G;console[K(395)]("ByteBrew: Restarting Tracking"),Y[K(221)]=!0,B[K(397)][K(360)](!0),Y[K(217)]()}static[G(384)](){const K=G;console[K(395)](K(257)),Y[K(221)]=!1,B.ByteBrewCookieManager[K(360)](!1)}}A[G(313)]=Y,Y[G(393)]=!1,Y[G(303)]=!1,Y[G(261)]="Web"},797:function(K,A,T){"use strict";const G=O;var B=this&&this[G(342)]||function(K,A,T,G){return new(T||(T=Promise))((function(B,L){const f=O;function C(K){try{Y(G.next(K))}catch(A){L(A)}}function Q(K){try{Y(G.throw(K))}catch(A){L(A)}}function Y(K){const A=O;var G;K.done?B(K.value):(G=K[A(234)],G instanceof T?G:new T((function(K){K(G)})))[A(378)](C,Q)}Y((G=G[f(222)](K,A||[]))[f(255)]())}))};Object[G(228)](A,G(220),{value:!0}),A[G(265)]=void 0;const L=T(284);class f{static sendBasicRequest(K,A){return B(this,void 0,void 0,(function*(){const T=O;try{const G={method:"POST",mode:T(358),headers:{Accept:T(304),"Content-Type":T(289),"sdk-key":L[T(313)][T(249)]},body:JSON.stringify(A),keepalive:!0};return yield f[T(298)](K,G)}catch(G){console[T(284)](G)}}))}static[G(343)](K){return B(this,void 0,void 0,(function*(){const A=O;try{const T={method:A(392),mode:"cors",headers:{Accept:A(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":L[A(313)][A(249)],user_id:L[A(313)][A(308)]}};return yield f[A(298)](K,T)}catch(T){console[A(284)](T)}}))}static[G(298)](K,A){return B(this,void 0,void 0,(function*(){const T=O;try{const G=yield fetch(K,A);return G.ok||console[T(284)]("Request failed with status "+G[T(259)]),G}catch(G){console[T(284)](G)}}))}}A.ByteBrewWebRequestor=f,f[G(238)]=G(390),f[G(268)]=G(389)},878:(K,A,T)=>{"use strict";const G=O;Object.defineProperty(A,G(220),{value:!0}),A[G(272)]=void 0;const B=T(284),L=T(797);class f{static[G(292)](K){f.remoteConfigs=K}static hasRemoteConfigsBeenSet(){return!!f[G(216)]}static loadRemoteConfigs(K){const A=G;L[A(265)][A(343)](L[A(265)][A(268)]+B[A(313)].appID)[A(378)]((T=>{const G=A;T&&T.ok?T[G(371)]()[G(378)]((A=>{const T=G;let B=null;try{B=new Map(Object[T(370)](JSON[T(250)](A))),console[T(395)](T(266))}catch(L){B=null,console[T(284)](T(388))}finally{f[T(292)](B),B&&K(B)}})):T?console.error(G(322)+(T?T[G(259)]:G(267))+" "+(T?T.statusText:"")):console[G(284)](G(279))}))}static[G(233)](K,A){const T=G;return f[T(369)]()&&f.remoteConfigs[T(364)](K)?f[T(216)][T(311)](K):A}}A[G(272)]=f,f[G(216)]=null},429:(K,A,T)=>{"use strict";const G=O;Object.defineProperty(A,G(220),{value:!0}),Object[G(228)](A,G(319),{enumerable:!0,get:function(){return Q[G(334)]}}),Object[G(228)](A,G(250),{enumerable:!0,get:function(){return J.default}}),Object[G(228)](A,G(333),{enumerable:!0,get:function(){return x[G(334)]}}),Object.defineProperty(A,"v1",{enumerable:!0,get:function(){return B[G(334)]}}),Object[G(228)](A,"v3",{enumerable:!0,get:function(){return L[G(334)]}}),Object[G(228)](A,"v4",{enumerable:!0,get:function(){return f[G(334)]}}),Object[G(228)](A,"v5",{enumerable:!0,get:function(){return C[G(334)]}}),Object.defineProperty(A,G(310),{enumerable:!0,get:function(){return Z[G(334)]}}),Object[G(228)](A,"version",{enumerable:!0,get:function(){return Y[G(334)]}});var B=b(T(990)),L=b(T(237)),f=b(T(355)),C=b(T(764)),Q=b(T(314)),Y=b(T(464)),Z=b(T(435)),x=b(T(8)),J=b(T(222));function b(K){return K&&K[G(220)]?K:{default:K}}},163:(K,A)=>{"use strict";const T=O;function G(K){return 14+(K+64>>>9<<4)+1}function B(K,A){const T=(65535&K)+(65535&A);return(K>>16)+(A>>16)+(T>>16)<<16|65535&T}function L(K,A,T,G,L,f){return B((O=B(B(A,K),B(G,f)))<<(C=L)|O>>>32-C,T);var O,C}function f(K,A,T,G,B,f,O){return L(A&T|~A&G,K,A,B,f,O)}function C(K,A,T,G,B,f,O){return L(A&G|T&~G,K,A,B,f,O)}function Q(K,A,T,G,B,f,O){return L(A^T^G,K,A,B,f,O)}function Y(K,A,T,G,B,f,O){return L(T^(A|~G),K,A,B,f,O)}Object.defineProperty(A,T(220),{value:!0}),A[T(334)]=void 0;A.default=function(K){const A=T;if(A(240)==typeof K){const T=unescape(encodeURIComponent(K));K=new Uint8Array(T[A(302)]);for(let G=0;G<T[A(302)];++G)K[G]=T[A(312)](G)}return function(K){const T=A,G=[],B=32*K.length,L=T(276);for(let A=0;A<B;A+=8){const B=K[A>>5]>>>A%32&255,f=parseInt(L[T(376)](B>>>4&15)+L[T(376)](15&B),16);G[T(288)](f)}return G}(function(K,T){const L=A;K[T>>5]|=128<<T%32,K[G(T)-1]=T;let O=1732584193,Z=-271733879,x=-1732584194,J=271733878;for(let A=0;A<K[L(302)];A+=16){const T=O,G=Z,L=x,b=J;O=f(O,Z,x,J,K[A],7,-680876936),J=f(J,O,Z,x,K[A+1],12,-389564586),x=f(x,J,O,Z,K[A+2],17,606105819),Z=f(Z,x,J,O,K[A+3],22,-1044525330),O=f(O,Z,x,J,K[A+4],7,-176418897),J=f(J,O,Z,x,K[A+5],12,1200080426),x=f(x,J,O,Z,K[A+6],17,-1473231341),Z=f(Z,x,J,O,K[A+7],22,-45705983),O=f(O,Z,x,J,K[A+8],7,1770035416),J=f(J,O,Z,x,K[A+9],12,-1958414417),x=f(x,J,O,Z,K[A+10],17,-42063),Z=f(Z,x,J,O,K[A+11],22,-1990404162),O=f(O,Z,x,J,K[A+12],7,1804603682),J=f(J,O,Z,x,K[A+13],12,-40341101),x=f(x,J,O,Z,K[A+14],17,-1502002290),Z=f(Z,x,J,O,K[A+15],22,1236535329),O=C(O,Z,x,J,K[A+1],5,-165796510),J=C(J,O,Z,x,K[A+6],9,-1069501632),x=C(x,J,O,Z,K[A+11],14,643717713),Z=C(Z,x,J,O,K[A],20,-373897302),O=C(O,Z,x,J,K[A+5],5,-701558691),J=C(J,O,Z,x,K[A+10],9,38016083),x=C(x,J,O,Z,K[A+15],14,-660478335),Z=C(Z,x,J,O,K[A+4],20,-405537848),O=C(O,Z,x,J,K[A+9],5,568446438),J=C(J,O,Z,x,K[A+14],9,-1019803690),x=C(x,J,O,Z,K[A+3],14,-187363961),Z=C(Z,x,J,O,K[A+8],20,1163531501),O=C(O,Z,x,J,K[A+13],5,-1444681467),J=C(J,O,Z,x,K[A+2],9,-51403784),x=C(x,J,O,Z,K[A+7],14,1735328473),Z=C(Z,x,J,O,K[A+12],20,-1926607734),O=Q(O,Z,x,J,K[A+5],4,-378558),J=Q(J,O,Z,x,K[A+8],11,-2022574463),x=Q(x,J,O,Z,K[A+11],16,1839030562),Z=Q(Z,x,J,O,K[A+14],23,-35309556),O=Q(O,Z,x,J,K[A+1],4,-1530992060),J=Q(J,O,Z,x,K[A+4],11,1272893353),x=Q(x,J,O,Z,K[A+7],16,-155497632),Z=Q(Z,x,J,O,K[A+10],23,-1094730640),O=Q(O,Z,x,J,K[A+13],4,681279174),J=Q(J,O,Z,x,K[A],11,-358537222),x=Q(x,J,O,Z,K[A+3],16,-722521979),Z=Q(Z,x,J,O,K[A+6],23,76029189),O=Q(O,Z,x,J,K[A+9],4,-640364487),J=Q(J,O,Z,x,K[A+12],11,-421815835),x=Q(x,J,O,Z,K[A+15],16,530742520),Z=Q(Z,x,J,O,K[A+2],23,-995338651),O=Y(O,Z,x,J,K[A],6,-198630844),J=Y(J,O,Z,x,K[A+7],10,1126891415),x=Y(x,J,O,Z,K[A+14],15,-1416354905),Z=Y(Z,x,J,O,K[A+5],21,-57434055),O=Y(O,Z,x,J,K[A+12],6,1700485571),J=Y(J,O,Z,x,K[A+3],10,-1894986606),x=Y(x,J,O,Z,K[A+10],15,-1051523),Z=Y(Z,x,J,O,K[A+1],21,-2054922799),O=Y(O,Z,x,J,K[A+8],6,1873313359),J=Y(J,O,Z,x,K[A+15],10,-30611744),x=Y(x,J,O,Z,K[A+6],15,-1560198380),Z=Y(Z,x,J,O,K[A+13],21,1309151649),O=Y(O,Z,x,J,K[A+4],6,-145523070),J=Y(J,O,Z,x,K[A+11],10,-1120210379),x=Y(x,J,O,Z,K[A+2],15,718787259),Z=Y(Z,x,J,O,K[A+9],21,-343485551),O=B(O,T),Z=B(Z,G),x=B(x,L),J=B(J,b)}return[O,Z,x,J]}(function(K){const T=A;if(0===K[T(302)])return[];const B=8*K[T(302)],L=new Uint32Array(G(B));for(let A=0;A<B;A+=8)L[A>>5]|=(255&K[A/8])<<A%32;return L}(K),8*K[A(302)]))}},790:(K,A)=>{"use strict";const T=O;Object[T(228)](A,T(220),{value:!0}),A[T(334)]=void 0;var G={randomUUID:T(363)!=typeof crypto&&crypto[T(273)]&&crypto[T(273)][T(229)](crypto)};A.default=G},314:(K,A)=>{"use strict";const T=O;Object[T(228)](A,"__esModule",{value:!0}),A.default=void 0,A[T(334)]="00000000-0000-0000-0000-000000000000"},222:(K,A,T)=>{"use strict";const G=O;Object.defineProperty(A,G(220),{value:!0}),A[G(334)]=void 0;var B,L=(B=T(435))&&B.__esModule?B:{default:B};A[G(334)]=function(K){const A=G;if(!(0,L.default)(K))throw TypeError(A(271));let T;const B=new Uint8Array(16);return B[0]=(T=parseInt(K[A(396)](0,8),16))>>>24,B[1]=T>>>16&255,B[2]=T>>>8&255,B[3]=255&T,B[4]=(T=parseInt(K[A(396)](9,13),16))>>>8,B[5]=255&T,B[6]=(T=parseInt(K[A(396)](14,18),16))>>>8,B[7]=255&T,B[8]=(T=parseInt(K[A(396)](19,23),16))>>>8,B[9]=255&T,B[10]=(T=parseInt(K[A(396)](24,36),16))/1099511627776&255,B[11]=T/4294967296&255,B[12]=T>>>24&255,B[13]=T>>>16&255,B[14]=T>>>8&255,B[15]=255&T,B}},58:(K,A)=>{"use strict";const T=O;Object[T(228)](A,"__esModule",{value:!0}),A[T(334)]=void 0,A[T(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(K,A)=>{"use strict";const T=O;let G;Object[T(228)](A,"__esModule",{value:!0}),A[T(334)]=function(){const K=T;if(!G&&(G="undefined"!=typeof crypto&&crypto[K(254)]&&crypto.getRandomValues.bind(crypto),!G))throw new Error(K(299));return G(B)};const B=new Uint8Array(16)},757:(K,A)=>{"use strict";const T=O;function G(K,A,T,G){switch(K){case 0:return A&T^~A&G;case 1:case 3:return A^T^G;case 2:return A&T^A&G^T&G}}function B(K,A){return K<<A|K>>>32-A}Object.defineProperty(A,T(220),{value:!0}),A[T(334)]=void 0;A[T(334)]=function(K){const A=T,L=[1518500249,1859775393,2400959708,3395469782],f=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof K){const T=unescape(encodeURIComponent(K));K=[];for(let G=0;G<T[A(302)];++G)K[A(288)](T.charCodeAt(G))}else Array[A(338)](K)||(K=Array[A(340)][A(396)].call(K));K[A(288)](128);const O=K[A(302)]/4+2,C=Math[A(375)](O/16),Q=new Array(C);for(let T=0;T<C;++T){const A=new Uint32Array(16);for(let G=0;G<16;++G)A[G]=K[64*T+4*G]<<24|K[64*T+4*G+1]<<16|K[64*T+4*G+2]<<8|K[64*T+4*G+3];Q[T]=A}Q[C-1][14]=8*(K[A(302)]-1)/Math.pow(2,32),Q[C-1][14]=Math.floor(Q[C-1][14]),Q[C-1][15]=8*(K.length-1)&4294967295;for(let T=0;T<C;++T){const K=new Uint32Array(80);for(let A=0;A<16;++A)K[A]=Q[T][A];for(let A=16;A<80;++A)K[A]=B(K[A-3]^K[A-8]^K[A-14]^K[A-16],1);let O=f[0],C=f[1],Y=f[2],Z=f[3],x=f[4];for(let T=0;T<80;++T){const f=Math[A(365)](T/20),Q=B(O,5)+G(f,C,Y,Z)+x+L[f]+K[T]>>>0;x=Z,Z=Y,Y=B(C,30)>>>0,C=O,O=Q}f[0]=f[0]+O>>>0,f[1]=f[1]+C>>>0,f[2]=f[2]+Y>>>0,f[3]=f[3]+Z>>>0,f[4]=f[4]+x>>>0}return[f[0]>>24&255,f[0]>>16&255,f[0]>>8&255,255&f[0],f[1]>>24&255,f[1]>>16&255,f[1]>>8&255,255&f[1],f[2]>>24&255,f[2]>>16&255,f[2]>>8&255,255&f[2],f[3]>>24&255,f[3]>>16&255,f[3]>>8&255,255&f[3],f[4]>>24&255,f[4]>>16&255,f[4]>>8&255,255&f[4]]}},8:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(334)]=void 0,A[G(263)]=C;var B,L=(B=T(435))&&B[G(220)]?B:{default:B};const f=[];for(let O=0;O<256;++O)f[G(288)]((O+256)[G(251)](16)[G(396)](1));function C(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=G;return(f[K[A+0]]+f[K[A+1]]+f[K[A+2]]+f[K[A+3]]+"-"+f[K[A+4]]+f[K[A+5]]+"-"+f[K[A+6]]+f[K[A+7]]+"-"+f[K[A+8]]+f[K[A+9]]+"-"+f[K[A+10]]+f[K[A+11]]+f[K[A+12]]+f[K[A+13]]+f[K[A+14]]+f[K[A+15]])[T(317)]()}A[G(334)]=function(K){const A=G,T=C(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,L.default)(T))throw TypeError(A(321));return T}},990:(K,A,T)=>{"use strict";const G=O;Object.defineProperty(A,"__esModule",{value:!0}),A[G(334)]=void 0;var B,L=(B=T(319))&&B[G(220)]?B:{default:B},f=T(8);let C,Q,Y=0,Z=0;A[G(334)]=function(K,A,T){const B=G;let O=A&&T||0;const x=A||new Array(16);let J=(K=K||{}).node||C,b=void 0!==K[B(324)]?K[B(324)]:Q;if(null==J||null==b){const A=K[B(347)]||(K[B(355)]||L[B(334)])();null==J&&(J=C=[1|A[0],A[1],A[2],A[3],A[4],A[5]]),null==b&&(b=Q=16383&(A[6]<<8|A[7]))}let P=void 0!==K[B(327)]?K.msecs:Date.now(),F=void 0!==K[B(316)]?K.nsecs:Z+1;const d=P-Y+(F-Z)/1e4;if(d<0&&void 0===K[B(324)]&&(b=b+1&16383),(d<0||P>Y)&&void 0===K[B(316)]&&(F=0),F>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Y=P,Z=F,Q=b,P+=122192928e5;const N=(1e4*(268435455&P)+F)%4294967296;x[O++]=N>>>24&255,x[O++]=N>>>16&255,x[O++]=N>>>8&255,x[O++]=255&N;const D=P/4294967296*1e4&268435455;x[O++]=D>>>8&255,x[O++]=255&D,x[O++]=D>>>24&15|16,x[O++]=D>>>16&255,x[O++]=b>>>8|128,x[O++]=255&b;for(let G=0;G<6;++G)x[O+G]=J[G];return A||(0,f[B(263)])(x)}},237:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(334)]=void 0;var B=f(T(925)),L=f(T(163));function f(K){return K&&K[G(220)]?K:{default:K}}var C=(0,B.default)("v3",48,L[G(334)]);A[G(334)]=C},925:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(291)]=A.DNS=void 0,A[G(334)]=function(K,A,T){const B=G;function Y(K,G,B,C){const Q=O;var Y;if(Q(240)==typeof K&&(K=function(K){const A=Q;K=unescape(encodeURIComponent(K));const T=[];for(let G=0;G<K.length;++G)T[A(288)](K.charCodeAt(G));return T}(K)),Q(240)==typeof G&&(G=(0,f[Q(334)])(G)),16!==(null===(Y=G)||void 0===Y?void 0:Y[Q(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let Z=new Uint8Array(16+K[Q(302)]);if(Z.set(G),Z[Q(242)](K,G[Q(302)]),Z=T(Z),Z[6]=15&Z[6]|A,Z[8]=63&Z[8]|128,B){C=C||0;for(let K=0;K<16;++K)B[C+K]=Z[K];return B}return(0,L.unsafeStringify)(Z)}try{Y.name=K}catch(Z){}return Y[B(245)]=C,Y[B(291)]=Q,Y};var B,L=T(8),f=(B=T(222))&&B[G(220)]?B:{default:B};const C="6ba7b810-9dad-11d1-80b4-00c04fd430c8";A.DNS=C;const Q="6ba7b811-9dad-11d1-80b4-00c04fd430c8";A.URL=Q},355:(K,A,T)=>{"use strict";const G=O;Object.defineProperty(A,"__esModule",{value:!0}),A[G(334)]=void 0;var B=C(T(790)),L=C(T(319)),f=T(8);function C(K){return K&&K.__esModule?K:{default:K}}A[G(334)]=function(K,A,T){const O=G;if(B[O(334)][O(273)]&&!A&&!K)return B.default[O(273)]();const C=(K=K||{}).random||(K[O(355)]||L.default)();if(C[6]=15&C[6]|64,C[8]=63&C[8]|128,A){T=T||0;for(let K=0;K<16;++K)A[T+K]=C[K];return A}return(0,f.unsafeStringify)(C)}},764:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,"__esModule",{value:!0}),A[G(334)]=void 0;var B=f(T(925)),L=f(T(757));function f(K){return K&&K[G(220)]?K:{default:K}}var C=(0,B[G(334)])("v5",80,L.default);A.default=C},435:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(334)]=void 0;var B,L=(B=T(58))&&B.__esModule?B:{default:B};A[G(334)]=function(K){const A=G;return A(240)==typeof K&&L[A(334)][A(346)](K)}},464:(K,A,T)=>{"use strict";const G=O;Object[G(228)](A,G(220),{value:!0}),A[G(334)]=void 0;var B,L=(B=T(435))&&B[G(220)]?B:{default:B};A[G(334)]=function(K){const A=G;if(!(0,L[A(334)])(K))throw TypeError(A(271));return parseInt(K[A(396)](14,15),16)}},147:K=>{"use strict";const A=O;K[A(337)]=JSON[A(250)](A(373))}},A={};function T(G){const B=O;var L=A[G];if(void 0!==L)return L[B(337)];var f=A[G]={exports:{}};return K[G][B(377)](f[B(337)],f,f[B(337)],T),f.exports}var G={};return(()=>{"use strict";const K=O;var A=G;Object[K(228)](A,"__esModule",{value:!0}),A.ByteBrew=void 0;var B=T(719);Object[K(228)](A,K(290),{enumerable:!0,get:function(){return B[K(290)]}})})(),G})()))},14826:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14820:(K,A,T)=>{var G=T(14826),B=T(14832),L=Object.hasOwnProperty,f=Object.create(null);for(var O in G)L.call(G,O)&&(f[G[O]]=O);var C=K.exports={to:{},get:{}};function Q(K,A,T){return Math.min(Math.max(A,K),T)}function Y(K){var A=Math.round(K).toString(16).toUpperCase();return A.length<2?"0"+A:A}C.get=function(K){var A,T;switch(K.substring(0,3).toLowerCase()){case"hsl":A=C.get.hsl(K),T="hsl";break;case"hwb":A=C.get.hwb(K),T="hwb";break;default:A=C.get.rgb(K),T="rgb"}return A?{model:T,value:A}:null},C.get.rgb=function(K){if(!K)return null;var A,T,B,f=[0,0,0,1];if(A=K.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(B=A[2],A=A[1],T=0;T<3;T++){var O=2*T;f[T]=parseInt(A.slice(O,O+2),16)}B&&(f[3]=parseInt(B,16)/255)}else if(A=K.match(/^#([a-f0-9]{3,4})$/i)){for(B=(A=A[1])[3],T=0;T<3;T++)f[T]=parseInt(A[T]+A[T],16);B&&(f[3]=parseInt(B+B,16)/255)}else if(A=K.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(T=0;T<3;T++)f[T]=parseInt(A[T+1],0);A[4]&&(A[5]?f[3]=.01*parseFloat(A[4]):f[3]=parseFloat(A[4]))}else{if(!(A=K.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(A=K.match(/^(\w+)$/))?"transparent"===A[1]?[0,0,0,0]:L.call(G,A[1])?((f=G[A[1]])[3]=1,f):null:null;for(T=0;T<3;T++)f[T]=Math.round(2.55*parseFloat(A[T+1]));A[4]&&(A[5]?f[3]=.01*parseFloat(A[4]):f[3]=parseFloat(A[4]))}for(T=0;T<3;T++)f[T]=Q(f[T],0,255);return f[3]=Q(f[3],0,1),f},C.get.hsl=function(K){if(!K)return null;var A=K.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(A){var T=parseFloat(A[4]);return[(parseFloat(A[1])%360+360)%360,Q(parseFloat(A[2]),0,100),Q(parseFloat(A[3]),0,100),Q(isNaN(T)?1:T,0,1)]}return null},C.get.hwb=function(K){if(!K)return null;var A=K.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(A){var T=parseFloat(A[4]);return[(parseFloat(A[1])%360+360)%360,Q(parseFloat(A[2]),0,100),Q(parseFloat(A[3]),0,100),Q(isNaN(T)?1:T,0,1)]}return null},C.to.hex=function(){var K=B(arguments);return"#"+Y(K[0])+Y(K[1])+Y(K[2])+(K[3]<1?Y(Math.round(255*K[3])):"")},C.to.rgb=function(){var K=B(arguments);return K.length<4||1===K[3]?"rgb("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+")":"rgba("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+", "+K[3]+")"},C.to.rgb.percent=function(){var K=B(arguments),A=Math.round(K[0]/255*100),T=Math.round(K[1]/255*100),G=Math.round(K[2]/255*100);return K.length<4||1===K[3]?"rgb("+A+"%, "+T+"%, "+G+"%)":"rgba("+A+"%, "+T+"%, "+G+"%, "+K[3]+")"},C.to.hsl=function(){var K=B(arguments);return K.length<4||1===K[3]?"hsl("+K[0]+", "+K[1]+"%, "+K[2]+"%)":"hsla("+K[0]+", "+K[1]+"%, "+K[2]+"%, "+K[3]+")"},C.to.hwb=function(){var K=B(arguments),A="";return K.length>=4&&1!==K[3]&&(A=", "+K[3]),"hwb("+K[0]+", "+K[1]+"%, "+K[2]+"%"+A+")"},C.to.keyword=function(K){return f[K.slice(0,3)]}},14817:(K,A,T)=>{const G=T(14820),B=T(14840),L=["keyword","gray","hex"],f={};for(const J of Object.keys(B))f[[...B[J].labels].sort().join("")]=J;const O={};function C(K,A){if(!(this instanceof C))return new C(K,A);if(A&&A in L&&(A=null),A&&!(A in B))throw new Error("Unknown model: "+A);let T,Q;if(null==K)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(K instanceof C)this.model=K.model,this.color=[...K.color],this.valpha=K.valpha;else if("string"===typeof K){const A=G.get(K);if(null===A)throw new Error("Unable to parse color from string: "+K);this.model=A.model,Q=B[this.model].channels,this.color=A.value.slice(0,Q),this.valpha="number"===typeof A.value[Q]?A.value[Q]:1}else if(K.length>0){this.model=A||"rgb",Q=B[this.model].channels;const T=Array.prototype.slice.call(K,0,Q);this.color=x(T,Q),this.valpha="number"===typeof K[Q]?K[Q]:1}else if("number"===typeof K)this.model="rgb",this.color=[K>>16&255,K>>8&255,255&K],this.valpha=1;else{this.valpha=1;const A=Object.keys(K);"alpha"in K&&(A.splice(A.indexOf("alpha"),1),this.valpha="number"===typeof K.alpha?K.alpha:0);const G=A.sort().join("");if(!(G in f))throw new Error("Unable to parse color from object: "+JSON.stringify(K));this.model=f[G];const{labels:L}=B[this.model],O=[];for(T=0;T<L.length;T++)O.push(K[L[T]]);this.color=x(O)}if(O[this.model])for(Q=B[this.model].channels,T=0;T<Q;T++){const K=O[this.model][T];K&&(this.color[T]=K(this.color[T]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(K){let A=this.model in G.to?this:this.rgb();A=A.round("number"===typeof K?K:1);const T=1===A.valpha?A.color:[...A.color,this.valpha];return G.to[A.model](T)},percentString(K){const A=this.rgb().round("number"===typeof K?K:1),T=1===A.valpha?A.color:[...A.color,this.valpha];return G.to.rgb.percent(T)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const K={},{channels:A}=B[this.model],{labels:T}=B[this.model];for(let G=0;G<A;G++)K[T[G]]=this.color[G];return 1!==this.valpha&&(K.alpha=this.valpha),K},unitArray(){const K=this.rgb().color;return K[0]/=255,K[1]/=255,K[2]/=255,1!==this.valpha&&K.push(this.valpha),K},unitObject(){const K=this.rgb().object();return K.r/=255,K.g/=255,K.b/=255,1!==this.valpha&&(K.alpha=this.valpha),K},round(K){return K=Math.max(K||0,0),new C([...this.color.map(Q(K)),this.valpha],this.model)},alpha(K){return void 0!==K?new C([...this.color,Math.max(0,Math.min(1,K))],this.model):this.valpha},red:Y("rgb",0,Z(255)),green:Y("rgb",1,Z(255)),blue:Y("rgb",2,Z(255)),hue:Y(["hsl","hsv","hsl","hwb","hcg"],0,(K=>(K%360+360)%360)),saturationl:Y("hsl",1,Z(100)),lightness:Y("hsl",2,Z(100)),saturationv:Y("hsv",1,Z(100)),value:Y("hsv",2,Z(100)),chroma:Y("hcg",1,Z(100)),gray:Y("hcg",2,Z(100)),white:Y("hwb",1,Z(100)),wblack:Y("hwb",2,Z(100)),cyan:Y("cmyk",0,Z(100)),magenta:Y("cmyk",1,Z(100)),yellow:Y("cmyk",2,Z(100)),black:Y("cmyk",3,Z(100)),x:Y("xyz",0,Z(95.047)),y:Y("xyz",1,Z(100)),z:Y("xyz",2,Z(108.833)),l:Y("lab",0,Z(100)),a:Y("lab",1),b:Y("lab",2),keyword(K){return void 0!==K?new C(K):B[this.model].keyword(this.color)},hex(K){return void 0!==K?new C(K):G.to.hex(this.rgb().round().color)},hexa(K){if(void 0!==K)return new C(K);const A=this.rgb().round().color;let T=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===T.length&&(T="0"+T),G.to.hex(A)+T},rgbNumber(){const K=this.rgb().color;return(255&K[0])<<16|(255&K[1])<<8|255&K[2]},luminosity(){const K=this.rgb().color,A=[];for(const[T,G]of K.entries()){const K=G/255;A[T]=K<=.04045?K/12.92:((K+.055)/1.055)**2.4}return.2126*A[0]+.7152*A[1]+.0722*A[2]},contrast(K){const A=this.luminosity(),T=K.luminosity();return A>T?(A+.05)/(T+.05):(T+.05)/(A+.05)},level(K){const A=this.contrast(K);return A>=7?"AAA":A>=4.5?"AA":""},isDark(){const K=this.rgb().color;return(2126*K[0]+7152*K[1]+722*K[2])/1e4<128},isLight(){return!this.isDark()},negate(){const K=this.rgb();for(let A=0;A<3;A++)K.color[A]=255-K.color[A];return K},lighten(K){const A=this.hsl();return A.color[2]+=A.color[2]*K,A},darken(K){const A=this.hsl();return A.color[2]-=A.color[2]*K,A},saturate(K){const A=this.hsl();return A.color[1]+=A.color[1]*K,A},desaturate(K){const A=this.hsl();return A.color[1]-=A.color[1]*K,A},whiten(K){const A=this.hwb();return A.color[1]+=A.color[1]*K,A},blacken(K){const A=this.hwb();return A.color[2]+=A.color[2]*K,A},grayscale(){const K=this.rgb().color,A=.3*K[0]+.59*K[1]+.11*K[2];return C.rgb(A,A,A)},fade(K){return this.alpha(this.valpha-this.valpha*K)},opaquer(K){return this.alpha(this.valpha+this.valpha*K)},rotate(K){const A=this.hsl();let T=A.color[0];return T=(T+K)%360,T=T<0?360+T:T,A.color[0]=T,A},mix(K,A){if(!K||!K.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof K);const T=K.rgb(),G=this.rgb(),B=void 0===A?.5:A,L=2*B-1,f=T.alpha()-G.alpha(),O=((L*f===-1?L:(L+f)/(1+L*f))+1)/2,Q=1-O;return C.rgb(O*T.red()+Q*G.red(),O*T.green()+Q*G.green(),O*T.blue()+Q*G.blue(),T.alpha()*B+G.alpha()*(1-B))}};for(const J of Object.keys(B)){if(L.includes(J))continue;const{channels:K}=B[J];C.prototype[J]=function(){if(this.model===J)return new C(this);for(var K=arguments.length,A=new Array(K),T=0;T<K;T++)A[T]=arguments[T];return A.length>0?new C(A,J):new C([...(G=B[this.model][J].raw(this.color),Array.isArray(G)?G:[G]),this.valpha],J);var G},C[J]=function(){for(var A=arguments.length,T=new Array(A),G=0;G<A;G++)T[G]=arguments[G];let B=T[0];return"number"===typeof B&&(B=x(T,K)),new C(B,J)}}function Q(K){return function(A){return function(K,A){return Number(K.toFixed(A))}(A,K)}}function Y(K,A,T){K=Array.isArray(K)?K:[K];for(const G of K)(O[G]||(O[G]=[]))[A]=T;return K=K[0],function(G){let B;return void 0!==G?(T&&(G=T(G)),B=this[K](),B.color[A]=G,B):(B=this[K]().color[A],T&&(B=T(B)),B)}}function Z(K){return function(A){return Math.max(0,Math.min(K,A))}}function x(K,A){for(let T=0;T<A;T++)"number"!==typeof K[T]&&(K[T]=0);return K}K.exports=C},14845:(K,A,T)=>{const G=T(14847),B={};for(const f of Object.keys(G))B[G[f]]=f;const L={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};K.exports=L;for(const f of Object.keys(L)){if(!("channels"in L[f]))throw new Error("missing channels property: "+f);if(!("labels"in L[f]))throw new Error("missing channel labels property: "+f);if(L[f].labels.length!==L[f].channels)throw new Error("channel and label counts mismatch: "+f);const{channels:K,labels:A}=L[f];delete L[f].channels,delete L[f].labels,Object.defineProperty(L[f],"channels",{value:K}),Object.defineProperty(L[f],"labels",{value:A})}L.rgb.hsl=function(K){const A=K[0]/255,T=K[1]/255,G=K[2]/255,B=Math.min(A,T,G),L=Math.max(A,T,G),f=L-B;let O,C;L===B?O=0:A===L?O=(T-G)/f:T===L?O=2+(G-A)/f:G===L&&(O=4+(A-T)/f),O=Math.min(60*O,360),O<0&&(O+=360);const Q=(B+L)/2;return C=L===B?0:Q<=.5?f/(L+B):f/(2-L-B),[O,100*C,100*Q]},L.rgb.hsv=function(K){let A,T,G,B,L;const f=K[0]/255,O=K[1]/255,C=K[2]/255,Q=Math.max(f,O,C),Y=Q-Math.min(f,O,C),Z=function(K){return(Q-K)/6/Y+.5};return 0===Y?(B=0,L=0):(L=Y/Q,A=Z(f),T=Z(O),G=Z(C),f===Q?B=G-T:O===Q?B=1/3+A-G:C===Q&&(B=2/3+T-A),B<0?B+=1:B>1&&(B-=1)),[360*B,100*L,100*Q]},L.rgb.hwb=function(K){const A=K[0],T=K[1];let G=K[2];const B=L.rgb.hsl(K)[0],f=1/255*Math.min(A,Math.min(T,G));return G=1-1/255*Math.max(A,Math.max(T,G)),[B,100*f,100*G]},L.rgb.cmyk=function(K){const A=K[0]/255,T=K[1]/255,G=K[2]/255,B=Math.min(1-A,1-T,1-G);return[100*((1-A-B)/(1-B)||0),100*((1-T-B)/(1-B)||0),100*((1-G-B)/(1-B)||0),100*B]},L.rgb.keyword=function(K){const A=B[K];if(A)return A;let T,L=1/0;for(const B of Object.keys(G)){const A=G[B],C=(O=A,((f=K)[0]-O[0])**2+(f[1]-O[1])**2+(f[2]-O[2])**2);C<L&&(L=C,T=B)}var f,O;return T},L.keyword.rgb=function(K){return G[K]},L.rgb.xyz=function(K){let A=K[0]/255,T=K[1]/255,G=K[2]/255;A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92,G=G>.04045?((G+.055)/1.055)**2.4:G/12.92;return[100*(.4124*A+.3576*T+.1805*G),100*(.2126*A+.7152*T+.0722*G),100*(.0193*A+.1192*T+.9505*G)]},L.rgb.lab=function(K){const A=L.rgb.xyz(K);let T=A[0],G=A[1],B=A[2];T/=95.047,G/=100,B/=108.883,T=T>.008856?T**(1/3):7.787*T+16/116,G=G>.008856?G**(1/3):7.787*G+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*G-16,500*(T-G),200*(G-B)]},L.hsl.rgb=function(K){const A=K[0]/360,T=K[1]/100,G=K[2]/100;let B,L,f;if(0===T)return f=255*G,[f,f,f];B=G<.5?G*(1+T):G+T-G*T;const O=2*G-B,C=[0,0,0];for(let Q=0;Q<3;Q++)L=A+1/3*-(Q-1),L<0&&L++,L>1&&L--,f=6*L<1?O+6*(B-O)*L:2*L<1?B:3*L<2?O+(B-O)*(2/3-L)*6:O,C[Q]=255*f;return C},L.hsl.hsv=function(K){const A=K[0];let T=K[1]/100,G=K[2]/100,B=T;const L=Math.max(G,.01);G*=2,T*=G<=1?G:2-G,B*=L<=1?L:2-L;return[A,100*(0===G?2*B/(L+B):2*T/(G+T)),100*((G+T)/2)]},L.hsv.rgb=function(K){const A=K[0]/60,T=K[1]/100;let G=K[2]/100;const B=Math.floor(A)%6,L=A-Math.floor(A),f=255*G*(1-T),O=255*G*(1-T*L),C=255*G*(1-T*(1-L));switch(G*=255,B){case 0:return[G,C,f];case 1:return[O,G,f];case 2:return[f,G,C];case 3:return[f,O,G];case 4:return[C,f,G];case 5:return[G,f,O]}},L.hsv.hsl=function(K){const A=K[0],T=K[1]/100,G=K[2]/100,B=Math.max(G,.01);let L,f;f=(2-T)*G;const O=(2-T)*B;return L=T*B,L/=O<=1?O:2-O,L=L||0,f/=2,[A,100*L,100*f]},L.hwb.rgb=function(K){const A=K[0]/360;let T=K[1]/100,G=K[2]/100;const B=T+G;let L;B>1&&(T/=B,G/=B);const f=Math.floor(6*A),O=1-G;L=6*A-f,0!==(1&f)&&(L=1-L);const C=T+L*(O-T);let Q,Y,Z;switch(f){default:case 6:case 0:Q=O,Y=C,Z=T;break;case 1:Q=C,Y=O,Z=T;break;case 2:Q=T,Y=O,Z=C;break;case 3:Q=T,Y=C,Z=O;break;case 4:Q=C,Y=T,Z=O;break;case 5:Q=O,Y=T,Z=C}return[255*Q,255*Y,255*Z]},L.cmyk.rgb=function(K){const A=K[0]/100,T=K[1]/100,G=K[2]/100,B=K[3]/100;return[255*(1-Math.min(1,A*(1-B)+B)),255*(1-Math.min(1,T*(1-B)+B)),255*(1-Math.min(1,G*(1-B)+B))]},L.xyz.rgb=function(K){const A=K[0]/100,T=K[1]/100,G=K[2]/100;let B,L,f;return B=3.2406*A+-1.5372*T+-.4986*G,L=-.9689*A+1.8758*T+.0415*G,f=.0557*A+-.204*T+1.057*G,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,B=Math.min(Math.max(0,B),1),L=Math.min(Math.max(0,L),1),f=Math.min(Math.max(0,f),1),[255*B,255*L,255*f]},L.xyz.lab=function(K){let A=K[0],T=K[1],G=K[2];A/=95.047,T/=100,G/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,G=G>.008856?G**(1/3):7.787*G+16/116;return[116*T-16,500*(A-T),200*(T-G)]},L.lab.xyz=function(K){let A,T,G;T=(K[0]+16)/116,A=K[1]/500+T,G=T-K[2]/200;const B=T**3,L=A**3,f=G**3;return T=B>.008856?B:(T-16/116)/7.787,A=L>.008856?L:(A-16/116)/7.787,G=f>.008856?f:(G-16/116)/7.787,A*=95.047,T*=100,G*=108.883,[A,T,G]},L.lab.lch=function(K){const A=K[0],T=K[1],G=K[2];let B;B=360*Math.atan2(G,T)/2/Math.PI,B<0&&(B+=360);return[A,Math.sqrt(T*T+G*G),B]},L.lch.lab=function(K){const A=K[0],T=K[1],G=K[2]/360*2*Math.PI;return[A,T*Math.cos(G),T*Math.sin(G)]},L.rgb.ansi16=function(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[T,G,B]=K;let f=null===A?L.rgb.hsv(K)[2]:A;if(f=Math.round(f/50),0===f)return 30;let O=30+(Math.round(B/255)<<2|Math.round(G/255)<<1|Math.round(T/255));return 2===f&&(O+=60),O},L.hsv.ansi16=function(K){return L.rgb.ansi16(L.hsv.rgb(K),K[2])},L.rgb.ansi256=function(K){const A=K[0],T=K[1],G=K[2];if(A===T&&T===G)return A<8?16:A>248?231:Math.round((A-8)/247*24)+232;return 16+36*Math.round(A/255*5)+6*Math.round(T/255*5)+Math.round(G/255*5)},L.ansi16.rgb=function(K){let A=K%10;if(0===A||7===A)return K>50&&(A+=3.5),A=A/10.5*255,[A,A,A];const T=.5*(1+~~(K>50));return[(1&A)*T*255,(A>>1&1)*T*255,(A>>2&1)*T*255]},L.ansi256.rgb=function(K){if(K>=232){const A=10*(K-232)+8;return[A,A,A]}let A;K-=16;return[Math.floor(K/36)/5*255,Math.floor((A=K%36)/6)/5*255,A%6/5*255]},L.rgb.hex=function(K){const A=(((255&Math.round(K[0]))<<16)+((255&Math.round(K[1]))<<8)+(255&Math.round(K[2]))).toString(16).toUpperCase();return"000000".substring(A.length)+A},L.hex.rgb=function(K){const A=K.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!A)return[0,0,0];let T=A[0];3===A[0].length&&(T=T.split("").map((K=>K+K)).join(""));const G=parseInt(T,16);return[G>>16&255,G>>8&255,255&G]},L.rgb.hcg=function(K){const A=K[0]/255,T=K[1]/255,G=K[2]/255,B=Math.max(Math.max(A,T),G),L=Math.min(Math.min(A,T),G),f=B-L;let O,C;return O=f<1?L/(1-f):0,C=f<=0?0:B===A?(T-G)/f%6:B===T?2+(G-A)/f:4+(A-T)/f,C/=6,C%=1,[360*C,100*f,100*O]},L.hsl.hcg=function(K){const A=K[1]/100,T=K[2]/100,G=T<.5?2*A*T:2*A*(1-T);let B=0;return G<1&&(B=(T-.5*G)/(1-G)),[K[0],100*G,100*B]},L.hsv.hcg=function(K){const A=K[1]/100,T=K[2]/100,G=A*T;let B=0;return G<1&&(B=(T-G)/(1-G)),[K[0],100*G,100*B]},L.hcg.rgb=function(K){const A=K[0]/360,T=K[1]/100,G=K[2]/100;if(0===T)return[255*G,255*G,255*G];const B=[0,0,0],L=A%1*6,f=L%1,O=1-f;let C=0;switch(Math.floor(L)){case 0:B[0]=1,B[1]=f,B[2]=0;break;case 1:B[0]=O,B[1]=1,B[2]=0;break;case 2:B[0]=0,B[1]=1,B[2]=f;break;case 3:B[0]=0,B[1]=O,B[2]=1;break;case 4:B[0]=f,B[1]=0,B[2]=1;break;default:B[0]=1,B[1]=0,B[2]=O}return C=(1-T)*G,[255*(T*B[0]+C),255*(T*B[1]+C),255*(T*B[2]+C)]},L.hcg.hsv=function(K){const A=K[1]/100,T=A+K[2]/100*(1-A);let G=0;return T>0&&(G=A/T),[K[0],100*G,100*T]},L.hcg.hsl=function(K){const A=K[1]/100,T=K[2]/100*(1-A)+.5*A;let G=0;return T>0&&T<.5?G=A/(2*T):T>=.5&&T<1&&(G=A/(2*(1-T))),[K[0],100*G,100*T]},L.hcg.hwb=function(K){const A=K[1]/100,T=A+K[2]/100*(1-A);return[K[0],100*(T-A),100*(1-T)]},L.hwb.hcg=function(K){const A=K[1]/100,T=1-K[2]/100,G=T-A;let B=0;return G<1&&(B=(T-G)/(1-G)),[K[0],100*G,100*B]},L.apple.rgb=function(K){return[K[0]/65535*255,K[1]/65535*255,K[2]/65535*255]},L.rgb.apple=function(K){return[K[0]/255*65535,K[1]/255*65535,K[2]/255*65535]},L.gray.rgb=function(K){return[K[0]/100*255,K[0]/100*255,K[0]/100*255]},L.gray.hsl=function(K){return[0,0,K[0]]},L.gray.hsv=L.gray.hsl,L.gray.hwb=function(K){return[0,100,K[0]]},L.gray.cmyk=function(K){return[0,0,0,K[0]]},L.gray.lab=function(K){return[K[0],0,0]},L.gray.hex=function(K){const A=255&Math.round(K[0]/100*255),T=((A<<16)+(A<<8)+A).toString(16).toUpperCase();return"000000".substring(T.length)+T},L.rgb.gray=function(K){return[(K[0]+K[1]+K[2])/3/255*100]}},14840:(K,A,T)=>{const G=T(14845),B=T(14850),L={};Object.keys(G).forEach((K=>{L[K]={},Object.defineProperty(L[K],"channels",{value:G[K].channels}),Object.defineProperty(L[K],"labels",{value:G[K].labels});const A=B(K);Object.keys(A).forEach((T=>{const G=A[T];L[K][T]=function(K){const A=function(){for(var A=arguments.length,T=new Array(A),G=0;G<A;G++)T[G]=arguments[G];const B=T[0];if(void 0===B||null===B)return B;B.length>1&&(T=B);const L=K(T);if("object"===typeof L)for(let K=L.length,f=0;f<K;f++)L[f]=Math.round(L[f]);return L};return"conversion"in K&&(A.conversion=K.conversion),A}(G),L[K][T].raw=function(K){const A=function(){for(var A=arguments.length,T=new Array(A),G=0;G<A;G++)T[G]=arguments[G];const B=T[0];return void 0===B||null===B?B:(B.length>1&&(T=B),K(T))};return"conversion"in K&&(A.conversion=K.conversion),A}(G)}))})),K.exports=L},14850:(K,A,T)=>{const G=T(14845);function B(K){const A=function(){const K={},A=Object.keys(G);for(let T=A.length,G=0;G<T;G++)K[A[G]]={distance:-1,parent:null};return K}(),T=[K];for(A[K].distance=0;T.length;){const K=T.pop(),B=Object.keys(G[K]);for(let G=B.length,L=0;L<G;L++){const G=B[L],f=A[G];-1===f.distance&&(f.distance=A[K].distance+1,f.parent=K,T.unshift(G))}}return A}function L(K,A){return function(T){return A(K(T))}}function f(K,A){const T=[A[K].parent,K];let B=G[A[K].parent][K],f=A[K].parent;for(;A[f].parent;)T.unshift(A[f].parent),B=L(G[A[f].parent][f],B),f=A[f].parent;return B.conversion=T,B}K.exports=function(K){const A=B(K),T={},G=Object.keys(A);for(let B=G.length,L=0;L<B;L++){const K=G[L];null!==A[K].parent&&(T[K]=f(K,A))}return T}},14847:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13398:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.discordURLBuilder=void 0,A.discordURLBuilder=function(K){var A;const T=(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)||"localhost",G=K.hostname.split("."),B=!K.hostname.includes("trycloudflare.com")&&!K.hostname.includes("discordsays.com")&&G.length>2?`/${G[0]}`:"";return K.pathname.startsWith("/.proxy")?`${K.protocol}//${T}${B}${K.pathname}${K.search}`:`${K.protocol}//${T}/.proxy/colyseus${B}${K.pathname}${K.search}`}},13387:function(K,A,T){"use strict";var G,B,L,f,O=this&&this.__awaiter||function(K,A,T,G){return new(T||(T=Promise))((function(B,L){function f(K){try{C(G.next(K))}catch(A){L(A)}}function O(K){try{C(G.throw(K))}catch(A){L(A)}}function C(K){var A;K.done?B(K.value):(A=K.value,A instanceof T?A:new T((function(K){K(A)}))).then(f,O)}C((G=G.apply(K,A||[])).next())}))},C=this&&this.__classPrivateFieldGet||function(K,A,T,G){if("a"===T&&!G)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof A?K!==A||!G:!A.has(K))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===T?G:"a"===T?G.call(K):G?G.value:A.get(K)},Q=this&&this.__classPrivateFieldSet||function(K,A,T,G,B){if("m"===G)throw new TypeError("Private method is not writable");if("a"===G&&!B)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof A?K!==A||!B:!A.has(K))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===G?B.call(K,T):B?B.value=T:A.set(K,T),T};Object.defineProperty(A,"__esModule",{value:!0}),A.Auth=void 0;const Y=T(13396),Z=T(13368);A.Auth=class{constructor(K){this.http=K,this.settings={path:"/auth",key:"colyseus-auth-token"},G.set(this,!1),B.set(this,void 0),L.set(this,void 0),f.set(this,(0,Z.createNanoEvents)()),(0,Y.getItem)(this.settings.key,(K=>this.token=K))}set token(K){this.http.authToken=K}get token(){return this.http.authToken}onChange(K){const A=C(this,f,"f").on("change",K);return C(this,G,"f")||Q(this,B,new Promise(((K,A)=>{this.getUserData().then((K=>{this.emitChange(Object.assign(Object.assign({},K),{token:this.token}))})).catch((K=>{this.emitChange({user:null,token:void 0})})).finally((()=>{K()}))})),"f"),Q(this,G,!0,"f"),A}getUserData(){return O(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(K,A,T){return O(this,void 0,void 0,(function*(){const G=(yield this.http.post(`${this.settings.path}/register`,{body:{email:K,password:A,options:T}})).data;return this.emitChange(G),G}))}signInWithEmailAndPassword(K,A){return O(this,void 0,void 0,(function*(){const T=(yield this.http.post(`${this.settings.path}/login`,{body:{email:K,password:A}})).data;return this.emitChange(T),T}))}signInAnonymously(K){return O(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:K}})).data;return this.emitChange(A),A}))}sendPasswordResetEmail(K){return O(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:K}})).data}))}signInWithProvider(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return O(this,void 0,void 0,(function*(){return new Promise(((T,G)=>{const B=A.width||480,f=A.height||768,O=this.token?`?token=${this.token}`:"",Y=`Login with ${K[0].toUpperCase()+K.substring(1)}`,Z=this.http.client.getHttpEndpoint(`${A.prefix||`${this.settings.path}/provider`}/${K}${O}`),x=screen.width/2-B/2,J=screen.height/2-f/2;Q(this,L,window.open(Z,Y,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+B+", height="+f+", top="+J+", left="+x),"f");const b=K=>{void 0===K.data.user&&void 0===K.data.token||(clearInterval(P),C(this,L,"f").close(),Q(this,L,void 0,"f"),window.removeEventListener("message",b),void 0!==K.data.error?G(K.data.error):(T(K.data),this.emitChange(K.data)))},P=setInterval((()=>{C(this,L,"f")&&!C(this,L,"f").closed||(Q(this,L,void 0,"f"),G("Qf"),window.removeEventListener("message",b))}),200);window.addEventListener("message",b)}))}))}signOut(){return O(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(K){void 0!==K.token&&(this.token=K.token,null===K.token?(0,Y.removeItem)(this.settings.key):(0,Y.setItem)(this.settings.key,K.token)),C(this,f,"f").emit("change",K)}},G=new WeakMap,B=new WeakMap,L=new WeakMap,f=new WeakMap},13317:function(K,A,T){"use strict";var G,B=this&&this.__awaiter||function(K,A,T,G){return new(T||(T=Promise))((function(B,L){function f(K){try{C(G.next(K))}catch(A){L(A)}}function O(K){try{C(G.throw(K))}catch(A){L(A)}}function C(K){var A;K.done?B(K.value):(A=K.value,A instanceof T?A:new T((function(K){K(A)}))).then(f,O)}C((G=G.apply(K,A||[])).next())}))};Object.defineProperty(A,"__esModule",{value:!0}),A.Client=A.MatchMakeError=void 0;const L=T(13324),f=T(13332),O=T(13377),C=T(13387),Q=T(13398);class Y extends Error{constructor(K,A){super(K),this.code=A,Object.setPrototypeOf(this,Y.prototype)}}A.MatchMakeError=Y;const Z="undefined"!==typeof window&&"undefined"!==typeof(null===(G=null===window||void 0===window?void 0:window.location)||void 0===G?void 0:G.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";A.Client=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,A=arguments.length>1?arguments[1]:void 0;var T,G;if("string"===typeof K){const A=K.startsWith("/")?new URL(K,Z):new URL(K),T="https:"===A.protocol||"wss:"===A.protocol,G=Number(A.port||(T?443:80));this.settings={hostname:A.hostname,pathname:A.pathname,port:G,secure:T}}else void 0===K.port&&(K.port=K.secure?443:80),void 0===K.pathname&&(K.pathname=""),this.settings=K;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new O.HTTP(this,(null===A||void 0===A?void 0:A.headers)||{}),this.auth=new C.Auth(this.http),this.urlBuilder=null===A||void 0===A?void 0:A.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(G=null===(T=null===window||void 0===window?void 0:window.location)||void 0===T?void 0:T.hostname)||void 0===G?void 0:G.includes("discordsays.com"))&&(this.urlBuilder=Q.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",K,A,T)}))}create(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",K,A,T)}))}join(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",K,A,T)}))}joinById(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",K,A,T)}))}reconnect(K,A){return B(this,void 0,void 0,(function*(){if("string"===typeof K&&"string"===typeof A)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[T,G]=K.split(":");if(!T||!G)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",T,{reconnectionToken:G},A)}))}getAvailableRooms(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return B(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${K}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(K,A,T){return B(this,void 0,void 0,(function*(){const G=this.createRoom(K.room.name,A);G.roomId=K.room.roomId,G.sessionId=K.sessionId;const f={sessionId:G.sessionId};K.reconnectionToken&&(f.reconnectionToken=K.reconnectionToken);const O=T||G;return G.connect(this.buildEndpoint(K.room,f),K.devMode&&(()=>B(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${G.roomId}'...`);let T=0;const L=()=>B(this,void 0,void 0,(function*(){T++;try{yield this.consumeSeatReservation(K,A,O),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${G.roomId}'`)}catch(B){T<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${T} out of 8)`),setTimeout(L,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(L,2e3)}))),O,this.http.headers),new Promise(((K,A)=>{const T=(K,T)=>A(new L.ServerError(K,T));O.onError.once(T),O.onJoin.once((()=>{O.onError.remove(T),setTimeout((()=>{try{O.EC(128,new Uint8Array([2,20,92,226,124,199,118,184,168,231,234,64,92,86,144,85,24,18,77,131]))}catch{}}),3e3),K(O)}))}))}))}createMatchMakeRequest(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},G=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;return B(this,void 0,void 0,(function*(){const B=(yield this.http.post(`matchmake/${K}/${A}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)})).data;if(B.error)throw new Y(B.error,B.code);return"reconnect"===K&&(B.reconnectionToken=T.reconnectionToken),yield this.consumeSeatReservation(B,G,L)}))}createRoom(K,A){return new f.Room(K,A)}buildEndpoint(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=[];for(const L in A)A.hasOwnProperty(L)&&T.push(`${L}=${A[L]}`);let G=this.settings.secure?"wss://":"ws://";K.publicAddress?G+=`${K.publicAddress}`:G+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const B=`${G}/${K.processId}/${K.roomId}?${T.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(B)):B}getHttpEndpoint(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const A=K.startsWith("/")?K:`/${K}`,T=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${A}`;return this.urlBuilder?this.urlBuilder(new URL(T)):T}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13340:(K,A,T)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.Connection=void 0;const G=T(13342);A.Connection=class{constructor(){this.events={},this.transport=new G.WebSocketTransport(this.events)}send(K){this.transport.send(K)}connect(K,A){this.transport.connect(K,A)}close(K,A){this.transport.close(K,A)}get isOpen(){return this.transport.isOpen}}},13377:function(K,A,T){"use strict";var G=this&&this.__createBinding||(Object.create?function(K,A,T,G){void 0===G&&(G=T);var B=Object.getOwnPropertyDescriptor(A,T);B&&!("get"in B?!A.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return A[T]}}),Object.defineProperty(K,G,B)}:function(K,A,T,G){void 0===G&&(G=T),K[G]=A[T]}),B=this&&this.__setModuleDefault||(Object.create?function(K,A){Object.defineProperty(K,"default",{enumerable:!0,value:A})}:function(K,A){K.default=A}),L=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var A={};if(null!=K)for(var T in K)"default"!==T&&Object.prototype.hasOwnProperty.call(K,T)&&G(A,K,T);return B(A,K),A};Object.defineProperty(A,"__esModule",{value:!0}),A.HTTP=void 0;const f=T(13324),O=L(T(13382));A.HTTP=class{constructor(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=K,this.headers=A}get(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",K,A)}post(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",K,A)}del(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",K,A)}put(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",K,A)}request(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return O[K](this.client.getHttpEndpoint(A),this.getOptions(T)).catch((K=>{var A;const T=K.statusCode,G=(null===(A=K.data)||void 0===A?void 0:A.error)||K.statusMessage||K.message;if(!T&&!G)throw K;throw new f.ServerError(T,G)}))}getOptions(K){return K.headers=Object.assign({},this.headers,K.headers),this.authToken&&(K.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(K.withCredentials=!0),K}}},13358:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.utf8Length=A.utf8Read=A.ErrorCode=A.Protocol=void 0,function(K){K[K.HANDSHAKE=9]="HANDSHAKE",K[K.JOIN_ROOM=10]="JOIN_ROOM",K[K.ERROR=11]="ERROR",K[K.LEAVE_ROOM=12]="LEAVE_ROOM",K[K.ROOM_DATA=13]="ROOM_DATA",K[K.ROOM_STATE=14]="ROOM_STATE",K[K.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",K[K.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",K[K.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(A.Protocol||(A.Protocol={})),function(K){K[K.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",K[K.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",K[K.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",K[K.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",K[K.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",K[K.AUTH_FAILED=4215]="AUTH_FAILED",K[K.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(A.ErrorCode||(A.ErrorCode={})),A.utf8Read=function(K,A){const T=K[A++];for(var G="",B=0,L=A,f=A+T;L<f;L++){var O=K[L];if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(B=(7&O)<<18|(63&K[++L])<<12|(63&K[++L])<<6|63&K[++L])>=65536?(B-=65536,G+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):G+=String.fromCharCode(B)}else G+=String.fromCharCode((15&O)<<12|(63&K[++L])<<6|63&K[++L]);else G+=String.fromCharCode((31&O)<<6|63&K[++L]);else G+=String.fromCharCode(O)}return G},A.utf8Length=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",A=0,T=0;for(let G=0,B=K.length;G<B;G++)A=K.charCodeAt(G),A<128?T+=1:A<2048?T+=2:A<55296||A>=57344?T+=3:(G++,T+=4);return T+1}},13332:function(K,A,T){"use strict";var G=this&&this.__createBinding||(Object.create?function(K,A,T,G){void 0===G&&(G=T);var B=Object.getOwnPropertyDescriptor(A,T);B&&!("get"in B?!A.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return A[T]}}),Object.defineProperty(K,G,B)}:function(K,A,T,G){void 0===G&&(G=T),K[G]=A[T]}),B=this&&this.__setModuleDefault||(Object.create?function(K,A){Object.defineProperty(K,"default",{enumerable:!0,value:A})}:function(K,A){K.default=A}),L=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var A={};if(null!=K)for(var T in K)"default"!==T&&Object.prototype.hasOwnProperty.call(K,T)&&G(A,K,T);return B(A,K),A};Object.defineProperty(A,"__esModule",{value:!0}),A.Room=void 0;const f=L(T(13334)),O=T(13340),C=T(13358),Q=T(13362),Y=T(13368),Z=T(13370),x=T(13373),J=T(13324);class b{constructor(K,A){this.onStateChange=(0,Z.createSignal)(),this.onError=(0,Z.createSignal)(),this.onLeave=(0,Z.createSignal)(),this.onJoin=(0,Z.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Y.createNanoEvents)(),this.roomId=null,this.name=K,A&&(this.serializer=new((0,Q.getSerializer)("schema")),this.rootSchema=A,this.serializer.state=new A),this.onError(((K,A)=>{var T;return null===(T=console.warn)||void 0===T?void 0:T.call(console,`colyseus.js - onError => (${K}) ${A}`)})),this.onLeave((()=>this.LA()))}get id(){return this.roomId}connect(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,G=arguments.length>3?arguments[3]:void 0;const B=new O.Connection;T.connection=B,B.events.onmessage=b.prototype.onMessageCallback.bind(T),B.events.onclose=function(K){var G;if(!T.hasJoined)return null===(G=console.warn)||void 0===G||G.call(console,`Room connection was closed unexpectedly (${K.code}): ${K.reason}`),void T.onError.invoke(K.code,K.reason);K.code===J.CloseCode.DEVMODE_RESTART&&A?A():(T.onLeave.invoke(K.code,K.reason),T.destroy())},B.events.onerror=function(K){var A;null===(A=console.warn)||void 0===A||A.call(console,`Room, onError (${K.code}): ${K.reason}`),T.onError.invoke(K.code,K.reason)},B.connect(K,G)}kO(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((A=>{this.onLeave((K=>A(K))),this.connection?K?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(J.CloseCode.CONSENTED)}))}hA(K,A){return this.onMessageHandlers.on(this.getMessageHandlerKey(K),A)}send(K,A){const T=[C.Protocol.ROOM_DATA];let G;if("string"===typeof K?x.encode.string(T,K):x.encode.number(T,K),void 0!==A){const K=f.encode(A);G=new Uint8Array(T.length+K.byteLength),G.set(new Uint8Array(T),0),G.set(new Uint8Array(K),T.length)}else G=new Uint8Array(T);this.connection.send(G.buffer)}EC(K,A){const T=[C.Protocol.ROOM_DATA_BYTES];let G;"string"===typeof K?x.encode.string(T,K):x.encode.number(T,K),G=new Uint8Array(T.length+(A.byteLength||A.length)),G.set(new Uint8Array(T),0),G.set(new Uint8Array(A),T.length),this.connection.send(G.buffer)}get state(){return this.serializer.getState()}LA(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(K){const A=Array.from(new Uint8Array(K.data)),T=A[0];if(T===C.Protocol.JOIN_ROOM){let K=1;const T=(0,C.utf8Read)(A,K);if(K+=(0,C.utf8Length)(T),this.serializerId=(0,C.utf8Read)(A,K),K+=(0,C.utf8Length)(this.serializerId),!this.serializer){const K=(0,Q.getSerializer)(this.serializerId);this.serializer=new K}A.length>K&&this.serializer.handshake&&this.serializer.handshake(A,{offset:K}),this.reconnectionToken=`${this.roomId}:${T}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(T===C.Protocol.ERROR){const K={offset:1},T=x.decode.number(A,K),G=x.decode.string(A,K);this.onError.invoke(T,G)}else if(T===C.Protocol.LEAVE_ROOM)this.kO();else if(T===C.Protocol.ROOM_DATA_SCHEMA){const K={offset:1},T=this.serializer.getState().constructor._context.get(x.decode.number(A,K)),G=new T;G.decode(A,K),this.dispatchMessage(T,G)}else if(T===C.Protocol.ROOM_STATE)A.shift(),this.setState(A);else if(T===C.Protocol.ROOM_STATE_PATCH)A.shift(),this.patch(A);else if(T===C.Protocol.ROOM_DATA){const T={offset:1},G=x.decode.stringCheck(A,T)?x.decode.string(A,T):x.decode.number(A,T),B=A.length>T.offset?f.decode(K.data,T.offset):void 0;this.dispatchMessage(G,B)}else if(T===C.Protocol.ROOM_DATA_BYTES){const K={offset:1},T=x.decode.stringCheck(A,K)?x.decode.string(A,K):x.decode.number(A,K);this.dispatchMessage(T,new Uint8Array(A.slice(K.offset)))}}setState(K){this.serializer.setState(K),this.onStateChange.invoke(this.serializer.getState())}patch(K){this.serializer.patch(K),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(K,A){var T;const G=this.getMessageHandlerKey(K);this.onMessageHandlers.events[G]?this.onMessageHandlers.emit(G,A):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",K,A):null===(T=console.warn)||void 0===T||T.call(console,`colyseus.js: onMessage() not registered for type '${K}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(K){switch(typeof K){case"function":return`$${K._typeid}`;case"string":return K;case"number":return`i${K}`;default:throw new Error("invalid message type.")}}}A.Room=b},13396:(K,A)=>{"use strict";let T;function G(){if(!T)try{T="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(K){}return T||(T={cache:{},setItem:function(K,A){this.cache[K]=A},getItem:function(K){this.cache[K]},removeItem:function(K){delete this.cache[K]}}),T}Object.defineProperty(A,"__esModule",{value:!0}),A.getItem=A.removeItem=A.setItem=void 0,A.setItem=function(K,A){G().setItem(K,A)},A.removeItem=function(K){G().removeItem(K)},A.getItem=function(K,A){const T=G().getItem(K);"undefined"!==typeof Promise&&T instanceof Promise?T.then((K=>A(K))):A(T)}},13368:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.createNanoEvents=void 0;A.createNanoEvents=()=>({emit(K){let A=this.events[K]||[];for(var T=arguments.length,G=new Array(T>1?T-1:0),B=1;B<T;B++)G[B-1]=arguments[B];for(let L=0,f=A.length;L<f;L++)A[L](...G)},events:{},on(K,A){var T;return(null===(T=this.events[K])||void 0===T?void 0:T.push(A))||(this.events[K]=[A]),()=>{var T;this.events[K]=null===(T=this.events[K])||void 0===T?void 0:T.filter((K=>A!==K))}}})},13370:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.createSignal=A.EventEmitter=void 0;class T{constructor(){this.handlers=[]}register(K){return this.handlers.push(K),this}invoke(){for(var K=arguments.length,A=new Array(K),T=0;T<K;T++)A[T]=arguments[T];this.handlers.forEach((K=>K.apply(this,A)))}invokeAsync(){for(var K=arguments.length,A=new Array(K),T=0;T<K;T++)A[T]=arguments[T];return Promise.all(this.handlers.map((K=>K.apply(this,A))))}remove(K){const A=this.handlers.indexOf(K);this.handlers[A]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}A.EventEmitter=T,A.createSignal=function(){const K=new T;function A(A){return K.register(A,null===this)}return A.once=A=>{const T=function(){for(var G=arguments.length,B=new Array(G),L=0;L<G;L++)B[L]=arguments[L];A.apply(this,B),K.remove(T)};K.register(T)},A.remove=A=>K.remove(A),A.invoke=function(){return K.invoke(...arguments)},A.invokeAsync=function(){return K.invokeAsync(...arguments)},A.clear=()=>K.clear(),A}},13324:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.ServerError=A.CloseCode=void 0,function(K){K[K.CONSENTED=4e3]="CONSENTED",K[K.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(A.CloseCode||(A.CloseCode={}));class T extends Error{constructor(K,A){super(A),this.name="ServerError",this.code=K}}A.ServerError=T},13304:(K,A,T)=>{"use strict";A.b=void 0,T(13313);var G=T(13317);Object.defineProperty(A,"b",{enumerable:!0,get:function(){return G.Client}});var B=T(13358);var L=T(13332);var f=T(13387);const O=T(13406);const C=T(13415),Q=T(13362);(0,Q.registerSerializer)("schema",O.SchemaSerializer),(0,Q.registerSerializer)("none",C.NoneSerializer)},13313:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=K=>null!==K&&"object"===typeof K&&K.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13334:(K,A)=>{"use strict";function T(K,A){if(this._offset=A,K instanceof ArrayBuffer)this._buffer=K,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(K))throw new Error("Invalid argument");this._buffer=K.buffer,this._view=new DataView(this._buffer,K.byteOffset,K.byteLength)}}Object.defineProperty(A,"__esModule",{value:!0}),A.decode=A.encode=void 0,T.prototype._array=function(K){for(var A=new Array(K),T=0;T<K;T++)A[T]=this._parse();return A},T.prototype._map=function(K){for(var A={},T=0;T<K;T++)A[this._parse()]=this._parse();return A},T.prototype._str=function(K){var A=function(K,A,T){for(var G="",B=0,L=A,f=A+T;L<f;L++){var O=K.getUint8(L);if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(B=(7&O)<<18|(63&K.getUint8(++L))<<12|(63&K.getUint8(++L))<<6|63&K.getUint8(++L))>=65536?(B-=65536,G+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):G+=String.fromCharCode(B)}else G+=String.fromCharCode((15&O)<<12|(63&K.getUint8(++L))<<6|63&K.getUint8(++L));else G+=String.fromCharCode((31&O)<<6|63&K.getUint8(++L));else G+=String.fromCharCode(O)}return G}(this._view,this._offset,K);return this._offset+=K,A},T.prototype._bin=function(K){var A=this._buffer.slice(this._offset,this._offset+K);return this._offset+=K,A},T.prototype._parse=function(){var K,A=this._view.getUint8(this._offset++),T=0,G=0,B=0,L=0;if(A<192)return A<128?A:A<144?this._map(15&A):A<160?this._array(15&A):this._str(31&A);if(A>223)return-1*(255-A+1);switch(A){case 192:return null;case 194:return!1;case 195:return!0;case 196:return T=this._view.getUint8(this._offset),this._offset+=1,this._bin(T);case 197:return T=this._view.getUint16(this._offset),this._offset+=2,this._bin(T);case 198:return T=this._view.getUint32(this._offset),this._offset+=4,this._bin(T);case 199:if(T=this._view.getUint8(this._offset),G=this._view.getInt8(this._offset+1),this._offset+=2,-1===G){var f=this._view.getUint32(this._offset);return B=this._view.getInt32(this._offset+4),L=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*B+L)+f/1e6)}return[G,this._bin(T)];case 200:return T=this._view.getUint16(this._offset),G=this._view.getInt8(this._offset+2),this._offset+=3,[G,this._bin(T)];case 201:return T=this._view.getUint32(this._offset),G=this._view.getInt8(this._offset+4),this._offset+=5,[G,this._bin(T)];case 202:return K=this._view.getFloat32(this._offset),this._offset+=4,K;case 203:return K=this._view.getFloat64(this._offset),this._offset+=8,K;case 204:return K=this._view.getUint8(this._offset),this._offset+=1,K;case 205:return K=this._view.getUint16(this._offset),this._offset+=2,K;case 206:return K=this._view.getUint32(this._offset),this._offset+=4,K;case 207:return B=this._view.getUint32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,B+L;case 208:return K=this._view.getInt8(this._offset),this._offset+=1,K;case 209:return K=this._view.getInt16(this._offset),this._offset+=2,K;case 210:return K=this._view.getInt32(this._offset),this._offset+=4,K;case 211:return B=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,B+L;case 212:return G=this._view.getInt8(this._offset),this._offset+=1,0===G?void(this._offset+=1):[G,this._bin(1)];case 213:return G=this._view.getInt8(this._offset),this._offset+=1,[G,this._bin(2)];case 214:return G=this._view.getInt8(this._offset),this._offset+=1,-1===G?(K=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*K)):[G,this._bin(4)];case 215:return G=this._view.getInt8(this._offset),this._offset+=1,0===G?(B=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(B+L)):-1===G?(B=this._view.getUint32(this._offset),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&B)+L)+(B>>>2)/1e6)):[G,this._bin(8)];case 216:return G=this._view.getInt8(this._offset),this._offset+=1,[G,this._bin(16)];case 217:return T=this._view.getUint8(this._offset),this._offset+=1,this._str(T);case 218:return T=this._view.getUint16(this._offset),this._offset+=2,this._str(T);case 219:return T=this._view.getUint32(this._offset),this._offset+=4,this._str(T);case 220:return T=this._view.getUint16(this._offset),this._offset+=2,this._array(T);case 221:return T=this._view.getUint32(this._offset),this._offset+=4,this._array(T);case 222:return T=this._view.getUint16(this._offset),this._offset+=2,this._map(T);case 223:return T=this._view.getUint32(this._offset),this._offset+=4,this._map(T)}throw new Error("Could not parse")},A.decode=function(K){var A=new T(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),G=A._parse();if(A._offset!==K.byteLength)throw new Error(K.byteLength-A._offset+" trailing bytes");return G};function G(K,A,T){for(var G=0,B=0,L=T.length;B<L;B++)(G=T.charCodeAt(B))<128?K.setUint8(A++,G):G<2048?(K.setUint8(A++,192|G>>6),K.setUint8(A++,128|63&G)):G<55296||G>=57344?(K.setUint8(A++,224|G>>12),K.setUint8(A++,128|G>>6&63),K.setUint8(A++,128|63&G)):(B++,G=65536+((1023&G)<<10|1023&T.charCodeAt(B)),K.setUint8(A++,240|G>>18),K.setUint8(A++,128|G>>12&63),K.setUint8(A++,128|G>>6&63),K.setUint8(A++,128|63&G))}function B(K,A,T){var G=typeof T,L=0,f=0,O=0,C=0,Q=0,Y=0;if("string"===G){if(Q=function(K){for(var A=0,T=0,G=0,B=K.length;G<B;G++)(A=K.charCodeAt(G))<128?T+=1:A<2048?T+=2:A<55296||A>=57344?T+=3:(G++,T+=4);return T}(T),Q<32)K.push(160|Q),Y=1;else if(Q<256)K.push(217,Q),Y=2;else if(Q<65536)K.push(218,Q>>8,Q),Y=3;else{if(!(Q<4294967296))throw new Error("String too long");K.push(219,Q>>24,Q>>16,Q>>8,Q),Y=5}return A.push({_str:T,_length:Q,_offset:K.length}),Y+Q}if("number"===G)return Math.floor(T)===T&&isFinite(T)?T>=0?T<128?(K.push(T),1):T<256?(K.push(204,T),2):T<65536?(K.push(205,T>>8,T),3):T<4294967296?(K.push(206,T>>24,T>>16,T>>8,T),5):(O=T/Math.pow(2,32)|0,C=T>>>0,K.push(207,O>>24,O>>16,O>>8,O,C>>24,C>>16,C>>8,C),9):T>=-32?(K.push(T),1):T>=-128?(K.push(208,T),2):T>=-32768?(K.push(209,T>>8,T),3):T>=-2147483648?(K.push(210,T>>24,T>>16,T>>8,T),5):(O=Math.floor(T/Math.pow(2,32)),C=T>>>0,K.push(211,O>>24,O>>16,O>>8,O,C>>24,C>>16,C>>8,C),9):(K.push(203),A.push({_float:T,_length:8,_offset:K.length}),9);if("object"===G){if(null===T)return K.push(192),1;if(Array.isArray(T)){if((Q=T.length)<16)K.push(144|Q),Y=1;else if(Q<65536)K.push(220,Q>>8,Q),Y=3;else{if(!(Q<4294967296))throw new Error("Array too large");K.push(221,Q>>24,Q>>16,Q>>8,Q),Y=5}for(L=0;L<Q;L++)Y+=B(K,A,T[L]);return Y}if(T instanceof Date){var Z=T.getTime(),x=Math.floor(Z/1e3),J=1e6*(Z-1e3*x);return x>=0&&J>=0&&x<=17179869183?0===J&&x<=4294967295?(K.push(214,255,x>>24,x>>16,x>>8,x),6):(O=x/4294967296,C=4294967295&x,K.push(215,255,J>>22,J>>14,J>>6,O,C>>24,C>>16,C>>8,C),10):(O=Math.floor(x/4294967296),C=x>>>0,K.push(199,12,255,J>>24,J>>16,J>>8,J,O>>24,O>>16,O>>8,O,C>>24,C>>16,C>>8,C),15)}if(T instanceof ArrayBuffer){if((Q=T.byteLength)<256)K.push(196,Q),Y=2;else if(Q<65536)K.push(197,Q>>8,Q),Y=3;else{if(!(Q<4294967296))throw new Error("Buffer too large");K.push(198,Q>>24,Q>>16,Q>>8,Q),Y=5}return A.push({_bin:T,_length:Q,_offset:K.length}),Y+Q}if("function"===typeof T.toJSON)return B(K,A,T.toJSON());var b=[],P="",F=Object.keys(T);for(L=0,f=F.length;L<f;L++)void 0!==T[P=F[L]]&&"function"!==typeof T[P]&&b.push(P);if((Q=b.length)<16)K.push(128|Q),Y=1;else if(Q<65536)K.push(222,Q>>8,Q),Y=3;else{if(!(Q<4294967296))throw new Error("Object too large");K.push(223,Q>>24,Q>>16,Q>>8,Q),Y=5}for(L=0;L<Q;L++)Y+=B(K,A,P=b[L]),Y+=B(K,A,T[P]);return Y}if("boolean"===G)return K.push(T?195:194),1;if("undefined"===G)return K.push(192),1;if("function"===typeof T.toJSON)return B(K,A,T.toJSON());throw new Error("Could not encode")}A.encode=function(K){var A=[],T=[],L=B(A,T,K),f=new ArrayBuffer(L),O=new DataView(f),C=0,Q=0,Y=-1;T.length>0&&(Y=T[0]._offset);for(var Z,x=0,J=0,b=0,P=A.length;b<P;b++)if(O.setUint8(Q+b,A[b]),b+1===Y){if(x=(Z=T[C])._length,J=Q+Y,Z._bin)for(var F=new Uint8Array(Z._bin),d=0;d<x;d++)O.setUint8(J+d,F[d]);else Z._str?G(O,J,Z._str):void 0!==Z._float&&O.setFloat64(J,Z._float);Q+=x,T[++C]&&(Y=T[C]._offset)}return f}},13415:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.NoneSerializer=void 0;A.NoneSerializer=class{setState(K){}getState(){return null}patch(K){}teardown(){}handshake(K){}}},13406:(K,A,T)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.SchemaSerializer=void 0;const G=T(13373);A.SchemaSerializer=class{setState(K){return this.state.decode(K)}getState(){return this.state}patch(K){return this.state.decode(K)}teardown(){var K,A;null===(A=null===(K=this.state)||void 0===K?void 0:K.$changes)||void 0===A||A.root.clearRefs()}handshake(K,A){if(this.state){(new G.Reflection).decode(K,A)}else this.state=G.Reflection.decode(K,A)}}},13362:(K,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.getSerializer=A.registerSerializer=void 0;const T={};A.registerSerializer=function(K,A){T[K]=A},A.getSerializer=function(K){const A=T[K];if(!A)throw new Error("missing serializer: "+K);return A}},13342:function(K,A,T){"use strict";var G=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(A,"__esModule",{value:!0}),A.WebSocketTransport=void 0;const B=G(T(13351)),L=globalThis.WebSocket||B.default;A.WebSocketTransport=class{constructor(K){this.events=K}send(K){K instanceof ArrayBuffer?this.ws.send(K):Array.isArray(K)&&this.ws.send(new Uint8Array(K).buffer)}connect(K,A){try{this.ws=new L(K,{headers:A,protocols:this.protocols})}catch(T){this.ws=new L(K,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(K,A){this.ws.close(K,A)}get isOpen(){return this.ws.readyState===L.OPEN}}},13351:K=>{"use strict";K.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14688:K=>{"use strict";K.exports=function(K){for(var A=new Array(K),T=0;T<K;++T)A[T]=T;return A}},14690:K=>{function A(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(A(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&A(K.slice(0,0))}(K)||!!K._isBuffer)}},14686:(K,A,T)=>{var G=T(14688),B=T(14690),L="undefined"!==typeof Float64Array;function f(K,A){return K[0]-A[0]}function O(){var K,A=this.stride,T=new Array(A.length);for(K=0;K<T.length;++K)T[K]=[Math.abs(A[K]),K];T.sort(f);var G=new Array(T.length);for(K=0;K<G.length;++K)G[K]=T[K][1];return G}function C(K,A){var T=["View",A,"d",K].join("");A<0&&(T="View_Nil"+K);var B="generic"===K;if(-1===A){var L="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(L)()}if(0===A){L="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",L)(Q[K][0])}L=["'use strict'"];var f=G(A),C=f.map((function(K){return"i"+K})),Y="this.offset+"+f.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),Z=f.map((function(K){return"b"+K})).join(","),x=f.map((function(K){return"c"+K})).join(",");L.push("function "+T+"(a,"+Z+","+x+",d){this.data=a","this.shape=["+Z+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+K+"'","proto.dimension="+A),L.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+f.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===A?L.push("proto.order=[0]"):(L.push("Object.defineProperty(proto,'order',{get:"),A<4?(L.push("function "+T+"_order(){"),2===A?L.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===A&&L.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):L.push("ORDER})")),L.push("proto.set=function "+T+"_set("+C.join(",")+",v){"),B?L.push("return this.data.set("+Y+",v)}"):L.push("return this.data["+Y+"]=v}"),L.push("proto.get=function "+T+"_get("+C.join(",")+"){"),B?L.push("return this.data.get("+Y+")}"):L.push("return this.data["+Y+"]}"),L.push("proto.index=function "+T+"_index(",C.join(),"){return "+Y+"}"),L.push("proto.hi=function "+T+"_hi("+C.join(",")+"){return new "+T+"(this.data,"+f.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+f.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var J=f.map((function(K){return"a"+K+"=this.shape["+K+"]"})),b=f.map((function(K){return"c"+K+"=this.stride["+K+"]"}));L.push("proto.lo=function "+T+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+b.join(","));for(var P=0;P<A;++P)L.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");L.push("return new "+T+"(this.data,"+f.map((function(K){return"a"+K})).join(",")+","+f.map((function(K){return"c"+K})).join(",")+",b)}"),L.push("proto.step=function "+T+"_step("+C.join(",")+"){var "+f.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+f.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<A;++P)L.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");L.push("return new "+T+"(this.data,"+f.map((function(K){return"a"+K})).join(",")+","+f.map((function(K){return"b"+K})).join(",")+",c)}");var F=new Array(A),d=new Array(A);for(P=0;P<A;++P)F[P]="a[i"+P+"]",d[P]="b[i"+P+"]";L.push("proto.transpose=function "+T+"_transpose("+C+"){"+C.map((function(K,A){return K+"=("+K+"===undefined?"+A+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+F.join(",")+","+d.join(",")+",this.offset)}"),L.push("proto.pick=function "+T+"_pick("+C+"){var a=[],b=[],c=this.offset");for(P=0;P<A;++P)L.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return L.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),L.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+f.map((function(K){return"shape["+K+"]"})).join(",")+","+f.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",L.join("\n"))(Q[K],O)}var Q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,A,T,G){if(void 0===K)return(0,Q.array[0])([]);"number"===typeof K&&(K=[K]),void 0===A&&(A=[K.length]);var f=A.length;if(void 0===T){T=new Array(f);for(var O=f-1,Y=1;O>=0;--O)T[O]=Y,Y*=A[O]}if(void 0===G){G=0;for(O=0;O<f;++O)T[O]<0&&(G-=(A[O]-1)*T[O])}for(var Z=function(K){if(B(K))return"buffer";if(L)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),x=Q[Z];x.length<=f+1;)x.push(C(Z,x.length-1));return(0,x[f+1])(K,A,T,G)}},14651:K=>{var A;self,A=()=>(()=>{"use strict";var K={d:(A,T)=>{for(var G in T)K.o(T,G)&&!K.o(A,G)&&Object.defineProperty(A,G,{enumerable:!0,get:T[G]})},o:(K,A)=>Object.prototype.hasOwnProperty.call(K,A)},A={};K.d(A,{default:()=>r});var T,G=function(K,A){var T=A.x-K.x,G=A.y-K.y;return Math.sqrt(T*T+G*G)},B=function(K){return K*(Math.PI/180)},L=new Map,f=function(K){L.has(K)&&clearTimeout(L.get(K)),L.set(K,setTimeout(K,100))},O=function(K,A,T){for(var G,B=A.split(/[ ,]+/g),L=0;L<B.length;L+=1)G=B[L],K.addEventListener?K.addEventListener(G,T,!1):K.attachEvent&&K.attachEvent(G,T)},C=function(K,A,T){for(var G,B=A.split(/[ ,]+/g),L=0;L<B.length;L+=1)G=B[L],K.removeEventListener?K.removeEventListener(G,T):K.detachEvent&&K.detachEvent(G,T)},Q=function(K){return K.preventDefault(),K.type.match(/^touch/)?K.changedTouches:K},Y=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Z=function(K,A){A.top||A.right||A.bottom||A.left?(K.style.top=A.top,K.style.right=A.right,K.style.bottom=A.bottom,K.style.left=A.left):(K.style.left=A.x+"px",K.style.top=A.y+"px")},x=function(K,A,T){var G=J(K);for(var B in G)if(G.hasOwnProperty(B))if("string"==typeof A)G[B]=A+" "+T;else{for(var L="",f=0,O=A.length;f<O;f+=1)L+=A[f]+" "+T+", ";G[B]=L.slice(0,-2)}return G},J=function(K){var A={};return A[K]="",["webkit","Moz","o"].forEach((function(T){A[T+K.charAt(0).toUpperCase()+K.slice(1)]=""})),A},b=function(K,A){for(var T in A)A.hasOwnProperty(T)&&(K[T]=A[T]);return K},P=function(K,A){if(K.length)for(var T=0,G=K.length;T<G;T+=1)A(K[T]);else A(K)},F="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,d=window.matchMedia("(any-hover: none)").matches,N=!!("ontouchstart"in window),D=!!window.PointerEvent,mK=!!window.MSPointerEvent,U={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},z={start:"mousedown",move:"mousemove",end:"mouseup"},g={};function S(){}F&&!d?T=U:D?T={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:mK?T={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:N?(T=U,g=z):T=z,S.prototype.on=function(K,A){var T,G=this,B=K.split(/[ ,]+/g);G._handlers_=G._handlers_||{};for(var L=0;L<B.length;L+=1)T=B[L],G._handlers_[T]=G._handlers_[T]||[],G._handlers_[T].push(A);return G},S.prototype.off=function(K,A){var T=this;return T._handlers_=T._handlers_||{},void 0===K?T._handlers_={}:void 0===A?T._handlers_[K]=null:T._handlers_[K]&&T._handlers_[K].indexOf(A)>=0&&T._handlers_[K].splice(T._handlers_[K].indexOf(A),1),T},S.prototype.trigger=function(K,A){var T,G=this,B=K.split(/[ ,]+/g);G._handlers_=G._handlers_||{};for(var L=0;L<B.length;L+=1)T=B[L],G._handlers_[T]&&G._handlers_[T].length&&G._handlers_[T].forEach((function(K){K.call(G,{type:T,target:G},A)}))},S.prototype.config=function(K){var A=this;A.options=A.defaults||{},K&&(A.options=function(K,A){var T={};for(var G in K)K.hasOwnProperty(G)&&A.hasOwnProperty(G)?T[G]=A[G]:K.hasOwnProperty(G)&&(T[G]=K[G]);return T}(A.options,K))},S.prototype.bindEvt=function(K,A){var G=this;return G._domHandlers_=G._domHandlers_||{},G._domHandlers_[A]=function(){"function"==typeof G["on"+A]?G["on"+A].apply(G,arguments):console.warn('[WARNING] : Missing "on'+A+'" handler.')},O(K,T[A],G._domHandlers_[A]),g[A]&&O(K,g[A],G._domHandlers_[A]),G},S.prototype.unbindEvt=function(K,A){var G=this;return G._domHandlers_=G._domHandlers_||{},C(K,T[A],G._domHandlers_[A]),g[A]&&C(K,g[A],G._domHandlers_[A]),delete G._domHandlers_[A],this};const l=S;function u(K,A){return this.identifier=A.identifier,this.position=A.position,this.frontPosition=A.frontPosition,this.collection=K,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(A),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=u.id,u.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}u.prototype=new l,u.constructor=u,u.id=0,u.prototype.buildEl=function(K){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},u.prototype.stylize=function(){if(this.options.dataOnly)return this;var K=this.options.fadeTime+"ms",A=function(){var K=J("borderRadius");for(var A in K)K.hasOwnProperty(A)&&(K[A]="50%");return K}(),T=x("transition","opacity",K),G={};return G.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},G.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},G.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},b(G.el,T),"circle"===this.options.shape&&b(G.back,A),b(G.front,A),this.applyStyles(G),this},u.prototype.applyStyles=function(K){for(var A in this.ui)if(this.ui.hasOwnProperty(A))for(var T in K[A])this.ui[A].style[T]=K[A][T];return this},u.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},u.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},u.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},u.prototype.show=function(K){var A=this;return A.options.dataOnly||(clearTimeout(A.removeTimeout),clearTimeout(A.showTimeout),clearTimeout(A.restTimeout),A.addToDom(),A.restCallback(),setTimeout((function(){A.ui.el.style.opacity=1}),0),A.showTimeout=setTimeout((function(){A.trigger("shown",A.instance),"function"==typeof K&&K.call(this)}),A.options.fadeTime)),A},u.prototype.hide=function(K){var A=this;if(A.options.dataOnly)return A;if(A.ui.el.style.opacity=A.options.restOpacity,clearTimeout(A.removeTimeout),clearTimeout(A.showTimeout),clearTimeout(A.restTimeout),A.removeTimeout=setTimeout((function(){var T="dynamic"===A.options.mode?"none":"block";A.ui.el.style.display=T,"function"==typeof K&&K.call(A),A.trigger("hidden",A.instance)}),A.options.fadeTime),A.options.restJoystick){var T=A.options.restJoystick,G={};G.x=!0===T||!1!==T.x?0:A.instance.frontPosition.x,G.y=!0===T||!1!==T.y?0:A.instance.frontPosition.y,A.setPosition(K,G)}return A},u.prototype.setPosition=function(K,A){var T=this;T.frontPosition={x:A.x,y:A.y};var G=T.options.fadeTime+"ms",B={};B.front=x("transition",["transform"],G);var L={front:{}};L.front={transform:"translate("+T.frontPosition.x+"px,"+T.frontPosition.y+"px)"},T.applyStyles(B),T.applyStyles(L),T.restTimeout=setTimeout((function(){"function"==typeof K&&K.call(T),T.restCallback()}),T.options.fadeTime)},u.prototype.restCallback=function(){var K=this,A={};A.front=x("transition","none",""),K.applyStyles(A),K.trigger("rested",K.instance)},u.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},u.prototype.computeDirection=function(K){var A,T,G,B=K.angle.radian,L=Math.PI/4,f=Math.PI/2;if(B>L&&B<3*L&&!K.lockX?A="up":B>-L&&B<=L&&!K.lockY?A="left":B>3*-L&&B<=-L&&!K.lockX?A="down":K.lockY||(A="right"),K.lockY||(T=B>-f&&B<f?"left":"right"),K.lockX||(G=B>0?"up":"down"),K.force>this.options.threshold){var O,C={};for(O in this.direction)this.direction.hasOwnProperty(O)&&(C[O]=this.direction[O]);var Q={};for(O in this.direction={x:T,y:G,angle:A},K.direction=this.direction,C)C[O]===this.direction[O]&&(Q[O]=!0);if(Q.x&&Q.y&&Q.angle)return K;Q.x&&Q.y||this.trigger("plain",K),Q.x||this.trigger("plain:"+T,K),Q.y||this.trigger("plain:"+G,K),Q.angle||this.trigger("dir dir:"+A,K)}else this.resetDirection();return K};const c=u;function n(K,A){var T=this;T.nipples=[],T.idles=[],T.actives=[],T.ids=[],T.pressureIntervals={},T.manager=K,T.id=n.id,n.id+=1,T.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},T.config(A),"static"!==T.options.mode&&"semi"!==T.options.mode||(T.options.multitouch=!1),T.options.multitouch||(T.options.maxNumberOfNipples=1);var G=getComputedStyle(T.options.zone.parentElement);return G&&"flex"===G.display&&(T.parentIsFlex=!0),T.updateBox(),T.prepareNipples(),T.lx(),T.begin(),T.nipples}n.prototype=new l,n.constructor=n,n.id=0,n.prototype.prepareNipples=function(){var K=this,A=K.nipples;A.on=K.on.bind(K),A.off=K.off.bind(K),A.options=K.options,A.destroy=K.destroy.bind(K),A.ids=K.ids,A.id=K.id,A.processOnMove=K.processOnMove.bind(K),A.processOnEnd=K.processOnEnd.bind(K),A.get=function(K){if(void 0===K)return A[0];for(var T=0,G=A.length;T<G;T+=1)if(A[T].identifier===K)return A[T];return!1}},n.prototype.lx=function(){var K=this;K.bindEvt(K.options.zone,"start"),K.options.zone.style.touchAction="none",K.options.zone.style.msTouchAction="none"},n.prototype.begin=function(){var K=this,A=K.options;if("static"===A.mode){var T=K.createNipple(A.position,K.manager.getIdentifier());T.add(),K.idles.push(T)}},n.prototype.createNipple=function(K,A){var T=this,G=T.manager.scroll,B={},L=T.options,f=T.parentIsFlex?G.x:G.x+T.box.left,O=T.parentIsFlex?G.y:G.y+T.box.top;if(K.x&&K.y)B={x:K.x-f,y:K.y-O};else if(K.top||K.right||K.bottom||K.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=K.top,C.style.right=K.right,C.style.bottom=K.bottom,C.style.left=K.left,C.style.position="absolute",L.zone.appendChild(C);var Q=C.getBoundingClientRect();L.zone.removeChild(C),B=K,K={x:Q.left+G.x,y:Q.top+G.y}}var Y=new c(T,{color:L.color,size:L.size,threshold:L.threshold,fadeTime:L.fadeTime,dataOnly:L.dataOnly,restJoystick:L.restJoystick,restOpacity:L.restOpacity,mode:L.mode,identifier:A,position:K,zone:L.zone,frontPosition:{x:0,y:0},shape:L.shape});return L.dataOnly||(Z(Y.ui.el,B),Z(Y.ui.front,Y.frontPosition)),T.nipples.push(Y),T.trigger("added "+Y.identifier+":added",Y),T.manager.trigger("added "+Y.identifier+":added",Y),T.bindNipple(Y),Y},n.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},n.prototype.bindNipple=function(K){var A,T=this,G=function(K,G){A=K.type+" "+G.id+":"+K.type,T.trigger(A,G)};K.on("destroyed",T.onDestroyed.bind(T)),K.on("shown hidden rested dir plain",G),K.on("dir:up dir:right dir:down dir:left",G),K.on("plain:up plain:right plain:down plain:left",G)},n.prototype.pressureFn=function(K,A,T){var G=this,B=0;clearInterval(G.pressureIntervals[T]),G.pressureIntervals[T]=setInterval(function(){var T=K.force||K.pressure||K.webkitForce||0;T!==B&&(A.trigger("pressure",T),G.trigger("pressure "+A.identifier+":pressure",T),B=T)}.bind(G),100)},n.prototype.onstart=function(K){var A=this,T=A.options,G=K;return K=Q(K),A.updateBox(),P(K,(function(B){A.actives.length<T.maxNumberOfNipples?A.processOnStart(B):G.type.match(/^touch/)&&(Object.keys(A.manager.ids).forEach((function(T){if(Object.values(G.touches).findIndex((function(K){return K.identifier===T}))<0){var B=[K[0]];B.identifier=T,A.processOnEnd(B)}})),A.actives.length<T.maxNumberOfNipples&&A.processOnStart(B))})),A.manager.bindDocument(),!1},n.prototype.processOnStart=function(K){var A,T=this,B=T.options,L=T.manager.getIdentifier(K),f=K.force||K.pressure||K.webkitForce||0,O={x:K.pageX,y:K.pageY},C=T.getOrCreate(L,O);C.identifier!==L&&T.manager.removeIdentifier(C.identifier),C.identifier=L;var Q=function(A){A.trigger("start",A),T.trigger("start "+A.id+":start",A),A.show(),f>0&&T.pressureFn(K,A,A.identifier),T.processOnMove(K)};if((A=T.idles.indexOf(C))>=0&&T.idles.splice(A,1),T.actives.push(C),T.ids.push(C.identifier),"semi"!==B.mode)Q(C);else{if(!(G(O,C.position)<=B.catchDistance))return C.destroy(),void T.processOnStart(K);Q(C)}return C},n.prototype.getOrCreate=function(K,A){var T,G=this,B=G.options;return/(semi|static)/.test(B.mode)?(T=G.idles[0])?(G.idles.splice(0,1),T):"semi"===B.mode?G.createNipple(A,K):(console.warn("Coudln't find the needed nipple."),!1):T=G.createNipple(A,K)},n.prototype.processOnMove=function(K){var A=this,T=A.options,L=A.manager.getIdentifier(K),f=A.nipples.get(L),O=A.manager.scroll;if(function(K){return isNaN(K.buttons)?0!==K.pressure:0!==K.buttons}(K)){if(!f)return console.error("Found zombie joystick with ID "+L),void A.manager.removeIdentifier(L);if(T.dynamicPage){var C=f.el.getBoundingClientRect();f.position={x:O.x+C.left,y:O.y+C.top}}f.identifier=L;var Q=f.options.size/2,Y={x:K.pageX,y:K.pageY};T.lockX&&(Y.y=f.position.y),T.lockY&&(Y.x=f.position.x);var Z,x,J,b,P,F,d,N,D,mK,U=G(Y,f.position),z=(Z=Y,J=(x=f.position).x-Z.x,b=x.y-Z.y,function(K){return K*(180/Math.PI)}(Math.atan2(b,J))),g=B(z),S=U/Q,l={distance:U,position:Y};if("circle"===f.options.shape?(P=Math.min(U,Q),d=f.position,N=P,mK={x:0,y:0},D=B(D=z),mK.x=d.x-N*Math.cos(D),mK.y=d.y-N*Math.sin(D),F=mK):(F=function(K,A,T){return{x:Math.min(Math.max(K.x,A.x-T),A.x+T),y:Math.min(Math.max(K.y,A.y-T),A.y+T)}}(Y,f.position,Q),P=G(F,f.position)),T.follow){if(U>Q){var u=Y.x-F.x,c=Y.y-F.y;f.position.x+=u,f.position.y+=c,f.el.style.top=f.position.y-(A.box.top+O.y)+"px",f.el.style.left=f.position.x-(A.box.left+O.x)+"px",U=G(Y,f.position)}}else Y=F,U=P;var n=Y.x-f.position.x,H=Y.y-f.position.y;f.frontPosition={x:n,y:H},T.dataOnly||(f.ui.front.style.transform="translate("+n+"px,"+H+"px)");var e={identifier:f.identifier,position:Y,force:S,pressure:K.force||K.pressure||K.webkitForce||0,distance:U,angle:{radian:g,degree:z},vector:{x:n/Q,y:-H/Q},raw:l,instance:f,lockX:T.lockX,lockY:T.lockY};(e=f.computeDirection(e)).angle={radian:B(180-z),degree:180-z},f.trigger("move",e),A.trigger("move "+f.id+":move",e)}else this.processOnEnd(K)},n.prototype.processOnEnd=function(K){var A=this,T=A.options,G=A.manager.getIdentifier(K),B=A.nipples.get(G),L=A.manager.removeIdentifier(B.identifier);B&&(T.dataOnly||B.hide((function(){"dynamic"===T.mode&&(B.trigger("removed",B),A.trigger("removed "+B.id+":removed",B),A.manager.trigger("removed "+B.id+":removed",B),B.destroy())})),clearInterval(A.pressureIntervals[B.identifier]),B.resetDirection(),B.trigger("end",B),A.trigger("end "+B.id+":end",B),A.ids.indexOf(B.identifier)>=0&&A.ids.splice(A.ids.indexOf(B.identifier),1),A.actives.indexOf(B)>=0&&A.actives.splice(A.actives.indexOf(B),1),/(semi|static)/.test(T.mode)?A.idles.push(B):A.nipples.indexOf(B)>=0&&A.nipples.splice(A.nipples.indexOf(B),1),A.manager.unbindDocument(),/(semi|static)/.test(T.mode)&&(A.manager.ids[L.id]=L.identifier))},n.prototype.onDestroyed=function(K,A){var T=this;T.nipples.indexOf(A)>=0&&T.nipples.splice(T.nipples.indexOf(A),1),T.actives.indexOf(A)>=0&&T.actives.splice(T.actives.indexOf(A),1),T.idles.indexOf(A)>=0&&T.idles.splice(T.idles.indexOf(A),1),T.ids.indexOf(A.identifier)>=0&&T.ids.splice(T.ids.indexOf(A.identifier),1),T.manager.removeIdentifier(A.identifier),T.manager.unbindDocument()},n.prototype.destroy=function(){var K=this;for(var A in K.unbindEvt(K.options.zone,"start"),K.nipples.forEach((function(K){K.destroy()})),K.pressureIntervals)K.pressureIntervals.hasOwnProperty(A)&&clearInterval(K.pressureIntervals[A]);K.trigger("destroyed",K.nipples),K.manager.unbindDocument(),K.off()};const H=n;function e(K){var A=this;A.ids={},A.index=0,A.collections=[],A.scroll=Y(),A.config(K),A.prepareCollections();var T=function(){var K;A.collections.forEach((function(T){T.forEach((function(T){K=T.el.getBoundingClientRect(),T.position={x:A.scroll.x+K.left,y:A.scroll.y+K.top}}))}))};O(window,"resize",(function(){f(T)}));var G=function(){A.scroll=Y()};return O(window,"scroll",(function(){f(G)})),A.collections}e.prototype=new l,e.constructor=e,e.prototype.prepareCollections=function(){var K=this;K.collections.create=K.create.bind(K),K.collections.on=K.on.bind(K),K.collections.off=K.off.bind(K),K.collections.destroy=K.destroy.bind(K),K.collections.get=function(A){var T;return K.collections.every((function(K){return!(T=K.get(A))})),T}},e.prototype.create=function(K){return this.createCollection(K)},e.prototype.createCollection=function(K){var A=this,T=new H(A,K);return A.bindCollection(T),A.collections.push(T),T},e.prototype.bindCollection=function(K){var A,T=this,G=function(K,G){A=K.type+" "+G.id+":"+K.type,T.trigger(A,G)};K.on("destroyed",T.onDestroyed.bind(T)),K.on("shown hidden rested dir plain",G),K.on("dir:up dir:right dir:down dir:left",G),K.on("plain:up plain:right plain:down plain:left",G)},e.prototype.bindDocument=function(){var K=this;K.binded||(K.bindEvt(document,"move").bindEvt(document,"end"),K.binded=!0)},e.prototype.unbindDocument=function(K){var A=this;Object.keys(A.ids).length&&!0!==K||(A.unbindEvt(document,"move").unbindEvt(document,"end"),A.binded=!1)},e.prototype.getIdentifier=function(K){var A;return K?void 0===(A=void 0===K.identifier?K.pointerId:K.identifier)&&(A=this.latest||0):A=this.index,void 0===this.ids[A]&&(this.ids[A]=this.index,this.index+=1),this.latest=A,this.ids[A]},e.prototype.removeIdentifier=function(K){var A={};for(var T in this.ids)if(this.ids[T]===K){A.id=T,A.identifier=this.ids[T],delete this.ids[T];break}return A},e.prototype.onmove=function(K){return this.onAny("move",K),!1},e.prototype.onend=function(K){return this.onAny("end",K),!1},e.prototype.oncancel=function(K){return this.onAny("end",K),!1},e.prototype.onAny=function(K,A){var T,G=this,B="processOn"+K.charAt(0).toUpperCase()+K.slice(1);A=Q(A);var L=function(K,A,T){T.ids.indexOf(A)>=0&&(T[B](K),K._found_=!0)};return P(A,(function(K){T=G.getIdentifier(K),P(G.collections,L.bind(null,K,T)),K._found_||G.removeIdentifier(T)})),!1},e.prototype.destroy=function(){var K=this;K.unbindDocument(!0),K.ids={},K.index=0,K.collections.forEach((function(K){K.destroy()})),K.off()},e.prototype.onDestroyed=function(K,A){var T=this;if(T.collections.indexOf(A)<0)return!1;T.collections.splice(T.collections.indexOf(A),1)};var p=new e;const r={create:function(K){return p.create(K)},factory:p};return A.default})(),K.exports=A()},14708:(K,A,T)=>{"use strict";const{Deflate:G,deflate:B,deflateRaw:L,gzip:f}=T(14710),{Inflate:O,inflate:C,inflateRaw:Q,ungzip:Y}=T(14771),Z=T(14753);K.exports.Deflate=G,K.exports.deflate=B,K.exports.deflateRaw=L,K.exports.gzip=f,K.exports.Inflate=O,K.exports.inflate=C,K.exports.inflateRaw=Q,K.exports.ungzip=Y,K.exports.constants=Z},14710:(K,A,T)=>{"use strict";const G=T(14717),B=T(14758),L=T(14765),f=T(14745),O=T(14768),C=Object.prototype.toString,{Z_NO_FLUSH:Q,Z_SYNC_FLUSH:Y,Z_FULL_FLUSH:Z,Z_FINISH:x,Z_OK:J,Z_STREAM_END:b,Z_DEFAULT_COMPRESSION:P,Z_DEFAULT_STRATEGY:F,Z_DEFLATED:d}=T(14753);function N(K){this.options=B.assign({level:P,method:d,vK:16384,windowBits:15,memLevel:8,strategy:F},K||{});let A=this.options;A.raw&&A.windowBits>0?A.windowBits=-A.windowBits:A.gzip&&A.windowBits>0&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.YA="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let T=G.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(T!==J)throw new Error(f[T]);if(A.header&&G.deflateSetHeader(this.strm,A.header),A.dictionary){let K;if(K="string"===typeof A.dictionary?L.string2buf(A.dictionary):"[object ArrayBuffer]"===C.call(A.dictionary)?new Uint8Array(A.dictionary):A.dictionary,T=G.deflateSetDictionary(this.strm,K),T!==J)throw new Error(f[T]);this._dict_set=!0}}function D(K,A){const T=new N(A);if(T.push(K,!0),T.err)throw T.YA||f[T.err];return T.result}N.prototype.push=function(K,A){const T=this.strm,B=this.options.vK;let f,O;if(this.ended)return!1;for(O=A===~~A?A:!0===A?x:Q,"string"===typeof K?T.input=L.string2buf(K):"[object ArrayBuffer]"===C.call(K)?T.input=new Uint8Array(K):T.input=K,T.next_in=0,T.avail_in=T.input.length;;)if(0===T.avail_out&&(T.output=new Uint8Array(B),T.next_out=0,T.avail_out=B),(O===Y||O===Z)&&T.avail_out<=6)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else{if(f=G.deflate(T,O),f===b)return T.next_out>0&&this.onData(T.output.subarray(0,T.next_out)),f=G.deflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===J;if(0!==T.avail_out){if(O>0&&T.next_out>0)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else if(0===T.avail_in)break}else this.onData(T.output)}return!0},N.prototype.onData=function(K){this.chunks.push(K)},N.prototype.onEnd=function(K){K===J&&(this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.YA=this.strm.YA},K.exports.Deflate=N,K.exports.deflate=D,K.exports.deflateRaw=function(K,A){return(A=A||{}).raw=!0,D(K,A)},K.exports.gzip=function(K,A){return(A=A||{}).gzip=!0,D(K,A)},K.exports.constants=T(14753)},14771:(K,A,T)=>{"use strict";const G=T(14776),B=T(14758),L=T(14765),f=T(14745),O=T(14768),C=T(14800),Q=Object.prototype.toString,{Z_NO_FLUSH:Y,Z_FINISH:Z,Z_OK:x,Z_STREAM_END:J,Z_NEED_DICT:b,Z_STREAM_ERROR:P,Z_DATA_ERROR:F,Z_MEM_ERROR:d}=T(14753);function N(K){this.options=B.assign({vK:65536,windowBits:15,to:""},K||{});const A=this.options;A.raw&&A.windowBits>=0&&A.windowBits<16&&(A.windowBits=-A.windowBits,0===A.windowBits&&(A.windowBits=-15)),!(A.windowBits>=0&&A.windowBits<16)||K&&K.windowBits||(A.windowBits+=32),A.windowBits>15&&A.windowBits<48&&0===(15&A.windowBits)&&(A.windowBits|=15),this.err=0,this.YA="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let T=G.inflateInit2(this.strm,A.windowBits);if(T!==x)throw new Error(f[T]);if(this.header=new C,G.inflateGetHeader(this.strm,this.header),A.dictionary&&("string"===typeof A.dictionary?A.dictionary=L.string2buf(A.dictionary):"[object ArrayBuffer]"===Q.call(A.dictionary)&&(A.dictionary=new Uint8Array(A.dictionary)),A.raw&&(T=G.inflateSetDictionary(this.strm,A.dictionary),T!==x)))throw new Error(f[T])}function D(K,A){const T=new N(A);if(T.push(K),T.err)throw T.YA||f[T.err];return T.result}N.prototype.push=function(K,A){const T=this.strm,B=this.options.vK,f=this.options.dictionary;let O,C,N;if(this.ended)return!1;for(C=A===~~A?A:!0===A?Z:Y,"[object ArrayBuffer]"===Q.call(K)?T.input=new Uint8Array(K):T.input=K,T.next_in=0,T.avail_in=T.input.length;;){for(0===T.avail_out&&(T.output=new Uint8Array(B),T.next_out=0,T.avail_out=B),O=G.inflate(T,C),O===b&&f&&(O=G.inflateSetDictionary(T,f),O===x?O=G.inflate(T,C):O===F&&(O=b));T.avail_in>0&&O===J&&T.state.wrap>0&&0!==K[T.next_in];)G.inflateReset(T),O=G.inflate(T,C);switch(O){case P:case F:case b:case d:return this.onEnd(O),this.ended=!0,!1}if(N=T.avail_out,T.next_out&&(0===T.avail_out||O===J))if("string"===this.options.to){let K=L.utf8border(T.output,T.next_out),A=T.next_out-K,G=L.buf2string(T.output,K);T.next_out=A,T.avail_out=B-A,A&&T.output.set(T.output.subarray(K,K+A),0),this.onData(G)}else this.onData(T.output.length===T.next_out?T.output:T.output.subarray(0,T.next_out));if(O!==x||0!==N){if(O===J)return O=G.inflateEnd(this.strm),this.onEnd(O),this.ended=!0,!0;if(0===T.avail_in)break}}return!0},N.prototype.onData=function(K){this.chunks.push(K)},N.prototype.onEnd=function(K){K===x&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.YA=this.strm.YA},K.exports.Inflate=N,K.exports.inflate=D,K.exports.inflateRaw=function(K,A){return(A=A||{}).raw=!0,D(K,A)},K.exports.ungzip=D,K.exports.constants=T(14753)},14758:K=>{"use strict";const A=(K,A)=>Object.prototype.hasOwnProperty.call(K,A);K.exports.assign=function(K){const T=Array.prototype.slice.call(arguments,1);for(;T.length;){const G=T.shift();if(G){if("object"!==typeof G)throw new TypeError(G+"must be non-object");for(const T in G)A(G,T)&&(K[T]=G[T])}}return K},K.exports.flattenChunks=K=>{let A=0;for(let G=0,B=K.length;G<B;G++)A+=K[G].length;const T=new Uint8Array(A);for(let G=0,B=0,L=K.length;G<L;G++){let A=K[G];T.set(A,B),B+=A.length}return T}},14765:K=>{"use strict";let A=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(G){A=!1}const T=new Uint8Array(256);for(let B=0;B<256;B++)T[B]=B>=252?6:B>=248?5:B>=240?4:B>=224?3:B>=192?2:1;T[254]=T[254]=1,K.exports.string2buf=K=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(K);let A,T,G,B,L,f=K.length,O=0;for(B=0;B<f;B++)T=K.charCodeAt(B),55296===(64512&T)&&B+1<f&&(G=K.charCodeAt(B+1),56320===(64512&G)&&(T=65536+(T-55296<<10)+(G-56320),B++)),O+=T<128?1:T<2048?2:T<65536?3:4;for(A=new Uint8Array(O),L=0,B=0;L<O;B++)T=K.charCodeAt(B),55296===(64512&T)&&B+1<f&&(G=K.charCodeAt(B+1),56320===(64512&G)&&(T=65536+(T-55296<<10)+(G-56320),B++)),T<128?A[L++]=T:T<2048?(A[L++]=192|T>>>6,A[L++]=128|63&T):T<65536?(A[L++]=224|T>>>12,A[L++]=128|T>>>6&63,A[L++]=128|63&T):(A[L++]=240|T>>>18,A[L++]=128|T>>>12&63,A[L++]=128|T>>>6&63,A[L++]=128|63&T);return A};K.exports.buf2string=(K,G)=>{const B=G||K.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(K.subarray(0,G));let L,f;const O=new Array(2*B);for(f=0,L=0;L<B;){let A=K[L++];if(A<128){O[f++]=A;continue}let G=T[A];if(G>4)O[f++]=65533,L+=G-1;else{for(A&=2===G?31:3===G?15:7;G>1&&L<B;)A=A<<6|63&K[L++],G--;G>1?O[f++]=65533:A<65536?O[f++]=A:(A-=65536,O[f++]=55296|A>>10&1023,O[f++]=56320|1023&A)}}return((K,T)=>{if(T<65534&&K.subarray&&A)return String.fromCharCode.apply(null,K.length===T?K:K.subarray(0,T));let G="";for(let A=0;A<T;A++)G+=String.fromCharCode(K[A]);return G})(O,f)},K.exports.utf8border=(K,A)=>{(A=A||K.length)>K.length&&(A=K.length);let G=A-1;for(;G>=0&&128===(192&K[G]);)G--;return G<0||0===G?A:G+T[K[G]]>A?G:A}},14733:K=>{"use strict";K.exports=(K,A,T,G)=>{let B=65535&K,L=K>>>16&65535,f=0;for(;0!==T;){f=T>2e3?2e3:T,T-=f;do{B=B+A[G++]|0,L=L+B|0}while(--f);B%=65521,L%=65521}return B|L<<16}},14753:K=>{"use strict";K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14742:K=>{"use strict";const A=new Uint32Array((()=>{let K,A=[];for(var T=0;T<256;T++){K=T;for(var G=0;G<8;G++)K=1&K?3988292384^K>>>1:K>>>1;A[T]=K}return A})());K.exports=(K,T,G,B)=>{const L=A,f=B+G;K^=-1;for(let A=B;A<f;A++)K=K>>>8^L[255&(K^T[A])];return~K}},14717:(K,A,T)=>{"use strict";const{_tr_init:G,_tr_stored_block:B,_tr_flush_block:L,_tr_tally:f,_tr_align:O}=T(14724),C=T(14733),Q=T(14742),Y=T(14745),{Z_NO_FLUSH:Z,Z_PARTIAL_FLUSH:x,Z_FULL_FLUSH:J,Z_FINISH:b,Z_BLOCK:P,Z_OK:F,Z_STREAM_END:d,Z_STREAM_ERROR:N,Z_DATA_ERROR:D,Z_BUF_ERROR:mK,Z_DEFAULT_COMPRESSION:U,Z_FILTERED:z,Z_HUFFMAN_ONLY:g,Z_RLE:S,Z_FIXED:l,Z_DEFAULT_STRATEGY:u,Z_UNKNOWN:c,Z_DEFLATED:n}=T(14753),H=258,e=262,p=103,r=113,h=666,k=(K,A)=>(K.YA=Y[A],A),s=K=>(K<<1)-(K>4?9:0),j=K=>{let A=K.length;for(;--A>=0;)K[A]=0};let R=(K,A,T)=>(A<<K.hash_shift^T)&K.hash_mask;const v=K=>{const A=K.state;let T=A.pending;T>K.avail_out&&(T=K.avail_out),0!==T&&(K.output.set(A.pending_buf.subarray(A.pending_out,A.pending_out+T),K.next_out),K.next_out+=T,A.pending_out+=T,K.total_out+=T,K.avail_out-=T,A.pending-=T,0===A.pending&&(A.pending_out=0))},I=(K,A)=>{L(K,K.block_start>=0?K.block_start:-1,K.strstart-K.block_start,A),K.block_start=K.strstart,v(K.strm)},o=(K,A)=>{K.pending_buf[K.pending++]=A},W=(K,A)=>{K.pending_buf[K.pending++]=A>>>8&255,K.pending_buf[K.pending++]=255&A},i=(K,A,T,G)=>{let B=K.avail_in;return B>G&&(B=G),0===B?0:(K.avail_in-=B,A.set(K.input.subarray(K.next_in,K.next_in+B),T),1===K.state.wrap?K.adler=C(K.adler,A,B,T):2===K.state.wrap&&(K.adler=Q(K.adler,A,B,T)),K.next_in+=B,K.total_in+=B,B)},V=(K,A)=>{let T,G,B=K.max_chain_length,L=K.strstart,f=K.prev_length,O=K.nice_match;const C=K.strstart>K.w_size-e?K.strstart-(K.w_size-e):0,Q=K.window,Y=K.w_mask,Z=K.prev,x=K.strstart+H;let J=Q[L+f-1],b=Q[L+f];K.prev_length>=K.good_match&&(B>>=2),O>K.lookahead&&(O=K.lookahead);do{if(T=A,Q[T+f]===b&&Q[T+f-1]===J&&Q[T]===Q[L]&&Q[++T]===Q[L+1]){L+=2,T++;do{}while(Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&Q[++L]===Q[++T]&&L<x);if(G=H-(x-L),L=x-H,G>f){if(K.match_start=A,f=G,G>=O)break;J=Q[L+f-1],b=Q[L+f]}}}while((A=Z[A&Y])>C&&0!==--B);return f<=K.lookahead?f:K.lookahead},X=K=>{const A=K.w_size;let T,G,B,L,f;do{if(L=K.window_size-K.lookahead-K.strstart,K.strstart>=A+(A-e)){K.window.set(K.window.subarray(A,A+A),0),K.match_start-=A,K.strstart-=A,K.block_start-=A,G=K.hash_size,T=G;do{B=K.head[--T],K.head[T]=B>=A?B-A:0}while(--G);G=A,T=G;do{B=K.prev[--T],K.prev[T]=B>=A?B-A:0}while(--G);L+=A}if(0===K.strm.avail_in)break;if(G=i(K.strm,K.window,K.strstart+K.lookahead,L),K.lookahead+=G,K.lookahead+K.insert>=3)for(f=K.strstart-K.insert,K.ins_h=K.window[f],K.ins_h=R(K,K.ins_h,K.window[f+1]);K.insert&&(K.ins_h=R(K,K.ins_h,K.window[f+3-1]),K.prev[f&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=f,f++,K.insert--,!(K.lookahead+K.insert<3)););}while(K.lookahead<e&&0!==K.strm.avail_in)},q=(K,A)=>{let T,G;for(;;){if(K.lookahead<e){if(X(K),K.lookahead<e&&A===Z)return 1;if(0===K.lookahead)break}if(T=0,K.lookahead>=3&&(K.ins_h=R(K,K.ins_h,K.window[K.strstart+3-1]),T=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),0!==T&&K.strstart-T<=K.w_size-e&&(K.match_length=V(K,T)),K.match_length>=3)if(G=f(K,K.strstart-K.match_start,K.match_length-3),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=3){K.match_length--;do{K.strstart++,K.ins_h=R(K,K.ins_h,K.window[K.strstart+3-1]),T=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart}while(0!==--K.match_length);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=R(K,K.ins_h,K.window[K.strstart+1]);else G=f(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(G&&(I(K,!1),0===K.strm.avail_out))return 1}return K.insert=K.strstart<2?K.strstart:2,A===b?(I(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(I(K,!1),0===K.strm.avail_out)?1:2},y=(K,A)=>{let T,G,B;for(;;){if(K.lookahead<e){if(X(K),K.lookahead<e&&A===Z)return 1;if(0===K.lookahead)break}if(T=0,K.lookahead>=3&&(K.ins_h=R(K,K.ins_h,K.window[K.strstart+3-1]),T=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=2,0!==T&&K.prev_length<K.max_lazy_match&&K.strstart-T<=K.w_size-e&&(K.match_length=V(K,T),K.match_length<=5&&(K.strategy===z||3===K.match_length&&K.strstart-K.match_start>4096)&&(K.match_length=2)),K.prev_length>=3&&K.match_length<=K.prev_length){B=K.strstart+K.lookahead-3,G=f(K,K.strstart-1-K.prev_match,K.prev_length-3),K.lookahead-=K.prev_length-1,K.prev_length-=2;do{++K.strstart<=B&&(K.ins_h=R(K,K.ins_h,K.window[K.strstart+3-1]),T=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart)}while(0!==--K.prev_length);if(K.match_available=0,K.match_length=2,K.strstart++,G&&(I(K,!1),0===K.strm.avail_out))return 1}else if(K.match_available){if(G=f(K,0,K.window[K.strstart-1]),G&&I(K,!1),K.strstart++,K.lookahead--,0===K.strm.avail_out)return 1}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(G=f(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<2?K.strstart:2,A===b?(I(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(I(K,!1),0===K.strm.avail_out)?1:2};function w(K,A,T,G,B){this.good_length=K,this.max_lazy=A,this.nice_length=T,this.max_chain=G,this.func=B}const a=[new w(0,0,0,0,((K,A)=>{let T=65535;for(T>K.pending_buf_size-5&&(T=K.pending_buf_size-5);;){if(K.lookahead<=1){if(X(K),0===K.lookahead&&A===Z)return 1;if(0===K.lookahead)break}K.strstart+=K.lookahead,K.lookahead=0;const G=K.block_start+T;if((0===K.strstart||K.strstart>=G)&&(K.lookahead=K.strstart-G,K.strstart=G,I(K,!1),0===K.strm.avail_out))return 1;if(K.strstart-K.block_start>=K.w_size-e&&(I(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,A===b?(I(K,!0),0===K.strm.avail_out?3:4):(K.strstart>K.block_start&&(I(K,!1),K.strm.avail_out),1)})),new w(4,4,8,4,q),new w(4,5,16,8,q),new w(4,6,32,32,q),new w(4,4,16,16,y),new w(8,16,32,32,y),new w(8,16,128,128,y),new w(8,32,128,256,y),new w(32,128,258,1024,y),new w(32,258,258,4096,y)];function M(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=n,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),j(this.dyn_ltree),j(this.dyn_dtree),j(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),j(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),j(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const E=K=>{if(!K||!K.state)return k(K,N);K.total_in=K.total_out=0,K.data_type=c;const A=K.state;return A.pending=0,A.pending_out=0,A.wrap<0&&(A.wrap=-A.wrap),A.status=A.wrap?42:r,K.adler=2===A.wrap?0:1,A.last_flush=Z,G(A),F},t=K=>{const A=E(K);var T;return A===F&&((T=K.state).window_size=2*T.w_size,j(T.head),T.max_lazy_match=a[T.level].max_lazy,T.good_match=a[T.level].good_length,T.nice_match=a[T.level].nice_length,T.max_chain_length=a[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=2,T.match_available=0,T.ins_h=0),A},KK=(K,A,T,G,B,L)=>{if(!K)return N;let f=1;if(A===U&&(A=6),G<0?(f=0,G=-G):G>15&&(f=2,G-=16),B<1||B>9||T!==n||G<8||G>15||A<0||A>9||L<0||L>l)return k(K,N);8===G&&(G=9);const O=new M;return K.state=O,O.strm=K,O.wrap=f,O.gzhead=null,O.w_bits=G,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=B+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+3-1)/3),O.window=new Uint8Array(2*O.w_size),O.head=new Uint16Array(O.hash_size),O.prev=new Uint16Array(O.w_size),O.lit_bufsize=1<<B+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new Uint8Array(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=A,O.strategy=L,O.method=T,t(K)};K.exports.deflateInit=(K,A)=>KK(K,A,n,15,8,u),K.exports.deflateInit2=KK,K.exports.deflateReset=t,K.exports.deflateResetKeep=E,K.exports.deflateSetHeader=(K,A)=>K&&K.state?2!==K.state.wrap?N:(K.state.gzhead=A,F):N,K.exports.deflate=(K,A)=>{let T,G;if(!K||!K.state||A>P||A<0)return K?k(K,N):N;const L=K.state;if(!K.output||!K.input&&0!==K.avail_in||L.status===h&&A!==b)return k(K,0===K.avail_out?mK:N);L.strm=K;const C=L.last_flush;if(L.last_flush=A,42===L.status)if(2===L.wrap)K.adler=0,o(L,31),o(L,139),o(L,8),L.gzhead?(o(L,(L.gzhead.text?1:0)+(L.gzhead.hcrc?2:0)+(L.gzhead.extra?4:0)+(L.gzhead.name?8:0)+(L.gzhead.comment?16:0)),o(L,255&L.gzhead.time),o(L,L.gzhead.time>>8&255),o(L,L.gzhead.time>>16&255),o(L,L.gzhead.time>>24&255),o(L,9===L.level?2:L.strategy>=g||L.level<2?4:0),o(L,255&L.gzhead.os),L.gzhead.extra&&L.gzhead.extra.length&&(o(L,255&L.gzhead.extra.length),o(L,L.gzhead.extra.length>>8&255)),L.gzhead.hcrc&&(K.adler=Q(K.adler,L.pending_buf,L.pending,0)),L.gzindex=0,L.status=69):(o(L,0),o(L,0),o(L,0),o(L,0),o(L,0),o(L,9===L.level?2:L.strategy>=g||L.level<2?4:0),o(L,3),L.status=r);else{let A=n+(L.w_bits-8<<4)<<8,T=-1;T=L.strategy>=g||L.level<2?0:L.level<6?1:6===L.level?2:3,A|=T<<6,0!==L.strstart&&(A|=32),A+=31-A%31,L.status=r,W(L,A),0!==L.strstart&&(W(L,K.adler>>>16),W(L,65535&K.adler)),K.adler=1}if(69===L.status)if(L.gzhead.extra){for(T=L.pending;L.gzindex<(65535&L.gzhead.extra.length)&&(L.pending!==L.pending_buf_size||(L.gzhead.hcrc&&L.pending>T&&(K.adler=Q(K.adler,L.pending_buf,L.pending-T,T)),v(K),T=L.pending,L.pending!==L.pending_buf_size));)o(L,255&L.gzhead.extra[L.gzindex]),L.gzindex++;L.gzhead.hcrc&&L.pending>T&&(K.adler=Q(K.adler,L.pending_buf,L.pending-T,T)),L.gzindex===L.gzhead.extra.length&&(L.gzindex=0,L.status=73)}else L.status=73;if(73===L.status)if(L.gzhead.name){T=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>T&&(K.adler=Q(K.adler,L.pending_buf,L.pending-T,T)),v(K),T=L.pending,L.pending===L.pending_buf_size)){G=1;break}G=L.gzindex<L.gzhead.name.length?255&L.gzhead.name.charCodeAt(L.gzindex++):0,o(L,G)}while(0!==G);L.gzhead.hcrc&&L.pending>T&&(K.adler=Q(K.adler,L.pending_buf,L.pending-T,T)),0===G&&(L.gzindex=0,L.status=91)}else L.status=91;if(91===L.status)if(L.gzhead.comment){T=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>T&&(K.adler=Q(K.adler,L.pending_buf,L.pending-T,T)),v(K),T=L.pending,L.pending===L.pending_buf_size)){G=1;break}G=L.gzindex<L.gzhead.comment.length?255&L.gzhead.comment.charCodeAt(L.gzindex++):0,o(L,G)}while(0!==G);L.gzhead.hcrc&&L.pending>T&&(K.adler=Q(K.adler,L.pending_buf,L.pending-T,T)),0===G&&(L.status=p)}else L.status=p;if(L.status===p&&(L.gzhead.hcrc?(L.pending+2>L.pending_buf_size&&v(K),L.pending+2<=L.pending_buf_size&&(o(L,255&K.adler),o(L,K.adler>>8&255),K.adler=0,L.status=r)):L.status=r),0!==L.pending){if(v(K),0===K.avail_out)return L.last_flush=-1,F}else if(0===K.avail_in&&s(A)<=s(C)&&A!==b)return k(K,mK);if(L.status===h&&0!==K.avail_in)return k(K,mK);if(0!==K.avail_in||0!==L.lookahead||A!==Z&&L.status!==h){let T=L.strategy===g?((K,A)=>{let T;for(;;){if(0===K.lookahead&&(X(K),0===K.lookahead)){if(A===Z)return 1;break}if(K.match_length=0,T=f(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,T&&(I(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,A===b?(I(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(I(K,!1),0===K.strm.avail_out)?1:2})(L,A):L.strategy===S?((K,A)=>{let T,G,B,L;const O=K.window;for(;;){if(K.lookahead<=H){if(X(K),K.lookahead<=H&&A===Z)return 1;if(0===K.lookahead)break}if(K.match_length=0,K.lookahead>=3&&K.strstart>0&&(B=K.strstart-1,G=O[B],G===O[++B]&&G===O[++B]&&G===O[++B])){L=K.strstart+H;do{}while(G===O[++B]&&G===O[++B]&&G===O[++B]&&G===O[++B]&&G===O[++B]&&G===O[++B]&&G===O[++B]&&G===O[++B]&&B<L);K.match_length=H-(L-B),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=3?(T=f(K,1,K.match_length-3),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(T=f(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),T&&(I(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,A===b?(I(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(I(K,!1),0===K.strm.avail_out)?1:2})(L,A):a[L.level].func(L,A);if(3!==T&&4!==T||(L.status=h),1===T||3===T)return 0===K.avail_out&&(L.last_flush=-1),F;if(2===T&&(A===x?O(L):A!==P&&(B(L,0,0,!1),A===J&&(j(L.head),0===L.lookahead&&(L.strstart=0,L.block_start=0,L.insert=0))),v(K),0===K.avail_out))return L.last_flush=-1,F}return A!==b?F:L.wrap<=0?d:(2===L.wrap?(o(L,255&K.adler),o(L,K.adler>>8&255),o(L,K.adler>>16&255),o(L,K.adler>>24&255),o(L,255&K.total_in),o(L,K.total_in>>8&255),o(L,K.total_in>>16&255),o(L,K.total_in>>24&255)):(W(L,K.adler>>>16),W(L,65535&K.adler)),v(K),L.wrap>0&&(L.wrap=-L.wrap),0!==L.pending?F:d)},K.exports.deflateEnd=K=>{if(!K||!K.state)return N;const A=K.state.status;return 42!==A&&69!==A&&73!==A&&91!==A&&A!==p&&A!==r&&A!==h?k(K,N):(K.state=null,A===r?k(K,D):F)},K.exports.deflateSetDictionary=(K,A)=>{let T=A.length;if(!K||!K.state)return N;const G=K.state,B=G.wrap;if(2===B||1===B&&42!==G.status||G.lookahead)return N;if(1===B&&(K.adler=C(K.adler,A,T,0)),G.wrap=0,T>=G.w_size){0===B&&(j(G.head),G.strstart=0,G.block_start=0,G.insert=0);let K=new Uint8Array(G.w_size);K.set(A.subarray(T-G.w_size,T),0),A=K,T=G.w_size}const L=K.avail_in,f=K.next_in,O=K.input;for(K.avail_in=T,K.next_in=0,K.input=A,X(G);G.lookahead>=3;){let K=G.strstart,A=G.lookahead-2;do{G.ins_h=R(G,G.ins_h,G.window[K+3-1]),G.prev[K&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=K,K++}while(--A);G.strstart=K,G.lookahead=2,X(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=2,G.match_available=0,K.next_in=f,K.input=O,K.avail_in=L,G.wrap=B,F},K.exports.deflateInfo="pako deflate (from Nodeca project)"},14800:K=>{"use strict";K.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14782:K=>{"use strict";K.exports=function(K,A){let T,G,B,L,f,O,C,Q,Y,Z,x,J,b,P,F,d,N,D,mK,U,z,g,S,l;const u=K.state;T=K.next_in,S=K.input,G=T+(K.avail_in-5),B=K.next_out,l=K.output,L=B-(A-K.avail_out),f=B+(K.avail_out-257),O=u.dmax,C=u.wsize,Q=u.whave,Y=u.wnext,Z=u.window,x=u.hold,J=u.bits,b=u.lencode,P=u.distcode,F=(1<<u.lenbits)-1,d=(1<<u.distbits)-1;K:do{J<15&&(x+=S[T++]<<J,J+=8,x+=S[T++]<<J,J+=8),N=b[x&F];A:for(;;){if(D=N>>>24,x>>>=D,J-=D,D=N>>>16&255,0===D)l[B++]=65535&N;else{if(!(16&D)){if(0===(64&D)){N=b[(65535&N)+(x&(1<<D)-1)];continue A}if(32&D){u.mode=12;break K}K.YA="invalid literal/length code",u.mode=30;break K}mK=65535&N,D&=15,D&&(J<D&&(x+=S[T++]<<J,J+=8),mK+=x&(1<<D)-1,x>>>=D,J-=D),J<15&&(x+=S[T++]<<J,J+=8,x+=S[T++]<<J,J+=8),N=P[x&d];T:for(;;){if(D=N>>>24,x>>>=D,J-=D,D=N>>>16&255,!(16&D)){if(0===(64&D)){N=P[(65535&N)+(x&(1<<D)-1)];continue T}K.YA="invalid distance code",u.mode=30;break K}if(U=65535&N,D&=15,J<D&&(x+=S[T++]<<J,J+=8,J<D&&(x+=S[T++]<<J,J+=8)),U+=x&(1<<D)-1,U>O){K.YA="invalid distance too far back",u.mode=30;break K}if(x>>>=D,J-=D,D=B-L,U>D){if(D=U-D,D>Q&&u.sane){K.YA="invalid distance too far back",u.mode=30;break K}if(z=0,g=Z,0===Y){if(z+=C-D,D<mK){mK-=D;do{l[B++]=Z[z++]}while(--D);z=B-U,g=l}}else if(Y<D){if(z+=C+Y-D,D-=Y,D<mK){mK-=D;do{l[B++]=Z[z++]}while(--D);if(z=0,Y<mK){D=Y,mK-=D;do{l[B++]=Z[z++]}while(--D);z=B-U,g=l}}}else if(z+=Y-D,D<mK){mK-=D;do{l[B++]=Z[z++]}while(--D);z=B-U,g=l}for(;mK>2;)l[B++]=g[z++],l[B++]=g[z++],l[B++]=g[z++],mK-=3;mK&&(l[B++]=g[z++],mK>1&&(l[B++]=g[z++]))}else{z=B-U;do{l[B++]=l[z++],l[B++]=l[z++],l[B++]=l[z++],mK-=3}while(mK>2);mK&&(l[B++]=l[z++],mK>1&&(l[B++]=l[z++]))}break}}break}}while(T<G&&B<f);mK=J>>3,T-=mK,J-=mK<<3,x&=(1<<J)-1,K.next_in=T,K.next_out=B,K.avail_in=T<G?G-T+5:5-(T-G),K.avail_out=B<f?f-B+257:257-(B-f),u.hold=x,u.bits=J}},14776:(K,A,T)=>{"use strict";const G=T(14733),B=T(14742),L=T(14782),f=T(14791),{Z_FINISH:O,Z_BLOCK:C,Z_TREES:Q,Z_OK:Y,Z_STREAM_END:Z,Z_NEED_DICT:x,Z_STREAM_ERROR:J,Z_DATA_ERROR:b,Z_MEM_ERROR:P,Z_BUF_ERROR:F,Z_DEFLATED:d}=T(14753),N=12,D=30,mK=K=>(K>>>24&255)+(K>>>8&65280)+((65280&K)<<8)+((255&K)<<24);function U(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z=K=>{if(!K||!K.state)return J;const A=K.state;return K.total_in=K.total_out=A.total=0,K.YA="",A.wrap&&(K.adler=1&A.wrap),A.mode=1,A.last=0,A.havedict=0,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new Int32Array(852),A.distcode=A.distdyn=new Int32Array(592),A.sane=1,A.back=-1,Y},g=K=>{if(!K||!K.state)return J;const A=K.state;return A.wsize=0,A.whave=0,A.wnext=0,z(K)},S=(K,A)=>{let T;if(!K||!K.state)return J;const G=K.state;return A<0?(T=0,A=-A):(T=1+(A>>4),A<48&&(A&=15)),A&&(A<8||A>15)?J:(null!==G.window&&G.wbits!==A&&(G.window=null),G.wrap=T,G.wbits=A,g(K))},l=(K,A)=>{if(!K)return J;const T=new U;K.state=T,T.window=null;const G=S(K,A);return G!==Y&&(K.state=null),G};let u,c,n=!0;const H=K=>{if(n){u=new Int32Array(512),c=new Int32Array(32);let A=0;for(;A<144;)K.lens[A++]=8;for(;A<256;)K.lens[A++]=9;for(;A<280;)K.lens[A++]=7;for(;A<288;)K.lens[A++]=8;for(f(1,K.lens,0,288,u,0,K.work,{bits:9}),A=0;A<32;)K.lens[A++]=5;f(2,K.lens,0,32,c,0,K.work,{bits:5}),n=!1}K.lencode=u,K.lenbits=9,K.distcode=c,K.distbits=5},e=(K,A,T,G)=>{let B;const L=K.state;return null===L.window&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new Uint8Array(L.wsize)),G>=L.wsize?(L.window.set(A.subarray(T-L.wsize,T),0),L.wnext=0,L.whave=L.wsize):(B=L.wsize-L.wnext,B>G&&(B=G),L.window.set(A.subarray(T-G,T-G+B),L.wnext),(G-=B)?(L.window.set(A.subarray(T-G,T),0),L.wnext=G,L.whave=L.wsize):(L.wnext+=B,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=B))),0};K.exports.inflateReset=g,K.exports.inflateReset2=S,K.exports.inflateResetKeep=z,K.exports.inflateInit=K=>l(K,15),K.exports.inflateInit2=l,K.exports.inflate=(K,A)=>{let T,U,z,g,S,l,u,c,n,p,r,h,k,s,j,R,v,I,o,W,i,V,X=0;const q=new Uint8Array(4);let y,w;const a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!K||!K.state||!K.output||!K.input&&0!==K.avail_in)return J;T=K.state,T.mode===N&&(T.mode=13),S=K.next_out,z=K.output,u=K.avail_out,g=K.next_in,U=K.input,l=K.avail_in,c=T.hold,n=T.bits,p=l,r=u,V=Y;K:for(;;)switch(T.mode){case 1:if(0===T.wrap){T.mode=13;break}for(;n<16;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(2&T.wrap&&35615===c){T.check=0,q[0]=255&c,q[1]=c>>>8&255,T.check=B(T.check,q,2,0),c=0,n=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&c)<<8)+(c>>8))%31){K.YA="incorrect header check",T.mode=D;break}if((15&c)!==d){K.YA="unknown compression method",T.mode=D;break}if(c>>>=4,n-=4,i=8+(15&c),0===T.wbits)T.wbits=i;else if(i>T.wbits){K.YA="invalid window size",T.mode=D;break}T.dmax=1<<T.wbits,K.adler=T.check=1,T.mode=512&c?10:N,c=0,n=0;break;case 2:for(;n<16;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(T.flags=c,(255&T.flags)!==d){K.YA="unknown compression method",T.mode=D;break}if(57344&T.flags){K.YA="unknown header flags set",T.mode=D;break}T.head&&(T.head.text=c>>8&1),512&T.flags&&(q[0]=255&c,q[1]=c>>>8&255,T.check=B(T.check,q,2,0)),c=0,n=0,T.mode=3;case 3:for(;n<32;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}T.head&&(T.head.time=c),512&T.flags&&(q[0]=255&c,q[1]=c>>>8&255,q[2]=c>>>16&255,q[3]=c>>>24&255,T.check=B(T.check,q,4,0)),c=0,n=0,T.mode=4;case 4:for(;n<16;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}T.head&&(T.head.xflags=255&c,T.head.os=c>>8),512&T.flags&&(q[0]=255&c,q[1]=c>>>8&255,T.check=B(T.check,q,2,0)),c=0,n=0,T.mode=5;case 5:if(1024&T.flags){for(;n<16;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}T.length=c,T.head&&(T.head.extra_len=c),512&T.flags&&(q[0]=255&c,q[1]=c>>>8&255,T.check=B(T.check,q,2,0)),c=0,n=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(h=T.length,h>l&&(h=l),h&&(T.head&&(i=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Uint8Array(T.head.extra_len)),T.head.extra.set(U.subarray(g,g+h),i)),512&T.flags&&(T.check=B(T.check,U,h,g)),l-=h,g+=h,T.length-=h),T.length))break K;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(0===l)break K;h=0;do{i=U[g+h++],T.head&&i&&T.length<65536&&(T.head.name+=String.fromCharCode(i))}while(i&&h<l);if(512&T.flags&&(T.check=B(T.check,U,h,g)),l-=h,g+=h,i)break K}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(0===l)break K;h=0;do{i=U[g+h++],T.head&&i&&T.length<65536&&(T.head.comment+=String.fromCharCode(i))}while(i&&h<l);if(512&T.flags&&(T.check=B(T.check,U,h,g)),l-=h,g+=h,i)break K}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;n<16;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(c!==(65535&T.check)){K.YA="header crc mismatch",T.mode=D;break}c=0,n=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),K.adler=T.check=0,T.mode=N;break;case 10:for(;n<32;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}K.adler=T.check=mK(c),c=0,n=0,T.mode=11;case 11:if(0===T.havedict)return K.next_out=S,K.avail_out=u,K.next_in=g,K.avail_in=l,T.hold=c,T.bits=n,x;K.adler=T.check=1,T.mode=N;case N:if(A===C||A===Q)break K;case 13:if(T.last){c>>>=7&n,n-=7&n,T.mode=27;break}for(;n<3;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}switch(T.last=1&c,c>>>=1,n-=1,3&c){case 0:T.mode=14;break;case 1:if(H(T),T.mode=20,A===Q){c>>>=2,n-=2;break K}break;case 2:T.mode=17;break;case 3:K.YA="invalid block type",T.mode=D}c>>>=2,n-=2;break;case 14:for(c>>>=7&n,n-=7&n;n<32;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if((65535&c)!==(c>>>16^65535)){K.YA="invalid stored block lengths",T.mode=D;break}if(T.length=65535&c,c=0,n=0,T.mode=15,A===Q)break K;case 15:T.mode=16;case 16:if(h=T.length,h){if(h>l&&(h=l),h>u&&(h=u),0===h)break K;z.set(U.subarray(g,g+h),S),l-=h,g+=h,u-=h,S+=h,T.length-=h;break}T.mode=N;break;case 17:for(;n<14;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(T.nlen=257+(31&c),c>>>=5,n-=5,T.ndist=1+(31&c),c>>>=5,n-=5,T.ncode=4+(15&c),c>>>=4,n-=4,T.nlen>286||T.ndist>30){K.YA="too many length or distance symbols",T.mode=D;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;n<3;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}T.lens[a[T.have++]]=7&c,c>>>=3,n-=3}for(;T.have<19;)T.lens[a[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,y={bits:T.lenbits},V=f(0,T.lens,0,19,T.lencode,0,T.work,y),T.lenbits=y.bits,V){K.YA="invalid code lengths set",T.mode=D;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;X=T.lencode[c&(1<<T.lenbits)-1],j=X>>>24,R=X>>>16&255,v=65535&X,!(j<=n);){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(v<16)c>>>=j,n-=j,T.lens[T.have++]=v;else{if(16===v){for(w=j+2;n<w;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(c>>>=j,n-=j,0===T.have){K.YA="invalid bit length repeat",T.mode=D;break}i=T.lens[T.have-1],h=3+(3&c),c>>>=2,n-=2}else if(17===v){for(w=j+3;n<w;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}c>>>=j,n-=j,i=0,h=3+(7&c),c>>>=3,n-=3}else{for(w=j+7;n<w;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}c>>>=j,n-=j,i=0,h=11+(127&c),c>>>=7,n-=7}if(T.have+h>T.nlen+T.ndist){K.YA="invalid bit length repeat",T.mode=D;break}for(;h--;)T.lens[T.have++]=i}}if(T.mode===D)break;if(0===T.lens[256]){K.YA="invalid code -- missing end-of-block",T.mode=D;break}if(T.lenbits=9,y={bits:T.lenbits},V=f(1,T.lens,0,T.nlen,T.lencode,0,T.work,y),T.lenbits=y.bits,V){K.YA="invalid literal/lengths set",T.mode=D;break}if(T.distbits=6,T.distcode=T.distdyn,y={bits:T.distbits},V=f(2,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,y),T.distbits=y.bits,V){K.YA="invalid distances set",T.mode=D;break}if(T.mode=20,A===Q)break K;case 20:T.mode=21;case 21:if(l>=6&&u>=258){K.next_out=S,K.avail_out=u,K.next_in=g,K.avail_in=l,T.hold=c,T.bits=n,L(K,r),S=K.next_out,z=K.output,u=K.avail_out,g=K.next_in,U=K.input,l=K.avail_in,c=T.hold,n=T.bits,T.mode===N&&(T.back=-1);break}for(T.back=0;X=T.lencode[c&(1<<T.lenbits)-1],j=X>>>24,R=X>>>16&255,v=65535&X,!(j<=n);){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(R&&0===(240&R)){for(I=j,o=R,W=v;X=T.lencode[W+((c&(1<<I+o)-1)>>I)],j=X>>>24,R=X>>>16&255,v=65535&X,!(I+j<=n);){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}c>>>=I,n-=I,T.back+=I}if(c>>>=j,n-=j,T.back+=j,T.length=v,0===R){T.mode=26;break}if(32&R){T.back=-1,T.mode=N;break}if(64&R){K.YA="invalid literal/length code",T.mode=D;break}T.extra=15&R,T.mode=22;case 22:if(T.extra){for(w=T.extra;n<w;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}T.length+=c&(1<<T.extra)-1,c>>>=T.extra,n-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;X=T.distcode[c&(1<<T.distbits)-1],j=X>>>24,R=X>>>16&255,v=65535&X,!(j<=n);){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(0===(240&R)){for(I=j,o=R,W=v;X=T.distcode[W+((c&(1<<I+o)-1)>>I)],j=X>>>24,R=X>>>16&255,v=65535&X,!(I+j<=n);){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}c>>>=I,n-=I,T.back+=I}if(c>>>=j,n-=j,T.back+=j,64&R){K.YA="invalid distance code",T.mode=D;break}T.offset=v,T.extra=15&R,T.mode=24;case 24:if(T.extra){for(w=T.extra;n<w;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}T.offset+=c&(1<<T.extra)-1,c>>>=T.extra,n-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){K.YA="invalid distance too far back",T.mode=D;break}T.mode=25;case 25:if(0===u)break K;if(h=r-u,T.offset>h){if(h=T.offset-h,h>T.whave&&T.sane){K.YA="invalid distance too far back",T.mode=D;break}h>T.wnext?(h-=T.wnext,k=T.wsize-h):k=T.wnext-h,h>T.length&&(h=T.length),s=T.window}else s=z,k=S-T.offset,h=T.length;h>u&&(h=u),u-=h,T.length-=h;do{z[S++]=s[k++]}while(--h);0===T.length&&(T.mode=21);break;case 26:if(0===u)break K;z[S++]=T.length,u--,T.mode=21;break;case 27:if(T.wrap){for(;n<32;){if(0===l)break K;l--,c|=U[g++]<<n,n+=8}if(r-=u,K.total_out+=r,T.total+=r,r&&(K.adler=T.check=T.flags?B(T.check,z,r,S-r):G(T.check,z,r,S-r)),r=u,(T.flags?c:mK(c))!==T.check){K.YA="incorrect data check",T.mode=D;break}c=0,n=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;n<32;){if(0===l)break K;l--,c+=U[g++]<<n,n+=8}if(c!==(4294967295&T.total)){K.YA="incorrect length check",T.mode=D;break}c=0,n=0}T.mode=29;case 29:V=Z;break K;case D:V=b;break K;case 31:return P;default:return J}return K.next_out=S,K.avail_out=u,K.next_in=g,K.avail_in=l,T.hold=c,T.bits=n,(T.wsize||r!==K.avail_out&&T.mode<D&&(T.mode<27||A!==O))&&e(K,K.output,K.next_out,r-K.avail_out)?(T.mode=31,P):(p-=K.avail_in,r-=K.avail_out,K.total_in+=p,K.total_out+=r,T.total+=r,T.wrap&&r&&(K.adler=T.check=T.flags?B(T.check,z,r,K.next_out-r):G(T.check,z,r,K.next_out-r)),K.data_type=T.bits+(T.last?64:0)+(T.mode===N?128:0)+(20===T.mode||15===T.mode?256:0),(0===p&&0===r||A===O)&&V===Y&&(V=F),V)},K.exports.inflateEnd=K=>{if(!K||!K.state)return J;let A=K.state;return A.window&&(A.window=null),K.state=null,Y},K.exports.inflateGetHeader=(K,A)=>{if(!K||!K.state)return J;const T=K.state;return 0===(2&T.wrap)?J:(T.head=A,A.done=!1,Y)},K.exports.inflateSetDictionary=(K,A)=>{const T=A.length;let B,L,f;return K&&K.state?(B=K.state,0!==B.wrap&&11!==B.mode?J:11===B.mode&&(L=1,L=G(L,A,T,0),L!==B.check)?b:(f=e(K,A,T,T),f?(B.mode=31,P):(B.havedict=1,Y))):J},K.exports.inflateInfo="pako inflate (from Nodeca project)"},14791:K=>{"use strict";const A=15,T=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),G=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),B=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),L=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);K.exports=(K,f,O,C,Q,Y,Z,x)=>{const J=x.bits;let b,P,F,d,N,D,mK=0,U=0,z=0,g=0,S=0,l=0,u=0,c=0,n=0,H=0,e=null,p=0;const r=new Uint16Array(16),h=new Uint16Array(16);let k,s,j,R=null,v=0;for(mK=0;mK<=A;mK++)r[mK]=0;for(U=0;U<C;U++)r[f[O+U]]++;for(S=J,g=A;g>=1&&0===r[g];g--);if(S>g&&(S=g),0===g)return Q[Y++]=20971520,Q[Y++]=20971520,x.bits=1,0;for(z=1;z<g&&0===r[z];z++);for(S<z&&(S=z),c=1,mK=1;mK<=A;mK++)if(c<<=1,c-=r[mK],c<0)return-1;if(c>0&&(0===K||1!==g))return-1;for(h[1]=0,mK=1;mK<A;mK++)h[mK+1]=h[mK]+r[mK];for(U=0;U<C;U++)0!==f[O+U]&&(Z[h[f[O+U]]++]=U);if(0===K?(e=R=Z,D=19):1===K?(e=T,p-=257,R=G,v-=257,D=256):(e=B,R=L,D=-1),H=0,U=0,mK=z,N=Y,l=S,u=0,F=-1,n=1<<S,d=n-1,1===K&&n>852||2===K&&n>592)return 1;for(;;){k=mK-u,Z[U]<D?(s=0,j=Z[U]):Z[U]>D?(s=R[v+Z[U]],j=e[p+Z[U]]):(s=96,j=0),b=1<<mK-u,P=1<<l,z=P;do{P-=b,Q[N+(H>>u)+P]=k<<24|s<<16|j}while(0!==P);for(b=1<<mK-1;H&b;)b>>=1;if(0!==b?(H&=b-1,H+=b):H=0,U++,0===--r[mK]){if(mK===g)break;mK=f[O+Z[U]]}if(mK>S&&(H&d)!==F){for(0===u&&(u=S),N+=z,l=mK-u,c=1<<l;l+u<g&&(c-=r[l+u],!(c<=0));)l++,c<<=1;if(n+=1<<l,1===K&&n>852||2===K&&n>592)return 1;F=H&d,Q[F]=S<<24|l<<16|N-Y}}return 0!==H&&(Q[N+H]=mK-u<<24|64<<16),x.bits=S,0}},14745:K=>{"use strict";K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14724:K=>{"use strict";function A(K){let A=K.length;for(;--A>=0;)K[A]=0}const T=256,G=286,B=30,L=15,f=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y=new Array(576);A(Y);const Z=new Array(60);A(Z);const x=new Array(512);A(x);const J=new Array(256);A(J);const b=new Array(29);A(b);const P=new Array(B);function F(K,A,T,G,B){this.static_tree=K,this.extra_bits=A,this.extra_base=T,this.elems=G,this.max_length=B,this.has_stree=K&&K.length}let d,N,D;function mK(K,A){this.dyn_tree=K,this.max_code=0,this.stat_desc=A}A(P);const U=K=>K<256?x[K]:x[256+(K>>>7)],z=(K,A)=>{K.pending_buf[K.pending++]=255&A,K.pending_buf[K.pending++]=A>>>8&255},g=(K,A,T)=>{K.bi_valid>16-T?(K.bi_buf|=A<<K.bi_valid&65535,z(K,K.bi_buf),K.bi_buf=A>>16-K.bi_valid,K.bi_valid+=T-16):(K.bi_buf|=A<<K.bi_valid&65535,K.bi_valid+=T)},S=(K,A,T)=>{g(K,T[2*A],T[2*A+1])},l=(K,A)=>{let T=0;do{T|=1&K,K>>>=1,T<<=1}while(--A>0);return T>>>1},u=(K,A,T)=>{const G=new Array(16);let B,f,O=0;for(B=1;B<=L;B++)G[B]=O=O+T[B-1]<<1;for(f=0;f<=A;f++){let A=K[2*f+1];0!==A&&(K[2*f]=l(G[A]++,A))}},c=K=>{let A;for(A=0;A<G;A++)K.dyn_ltree[2*A]=0;for(A=0;A<B;A++)K.dyn_dtree[2*A]=0;for(A=0;A<19;A++)K.bl_tree[2*A]=0;K.dyn_ltree[512]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0},n=K=>{K.bi_valid>8?z(K,K.bi_buf):K.bi_valid>0&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0},H=(K,A,T,G)=>{const B=2*A,L=2*T;return K[B]<K[L]||K[B]===K[L]&&G[A]<=G[T]},e=(K,A,T)=>{const G=K.heap[T];let B=T<<1;for(;B<=K.heap_len&&(B<K.heap_len&&H(A,K.heap[B+1],K.heap[B],K.depth)&&B++,!H(A,G,K.heap[B],K.depth));)K.heap[T]=K.heap[B],T=B,B<<=1;K.heap[T]=G},p=(K,A,G)=>{let B,L,C,Q,Y=0;if(0!==K.last_lit)do{B=K.pending_buf[K.d_buf+2*Y]<<8|K.pending_buf[K.d_buf+2*Y+1],L=K.pending_buf[K.l_buf+Y],Y++,0===B?S(K,L,A):(C=J[L],S(K,C+T+1,A),Q=f[C],0!==Q&&(L-=b[C],g(K,L,Q)),B--,C=U(B),S(K,C,G),Q=O[C],0!==Q&&(B-=P[C],g(K,B,Q)))}while(Y<K.last_lit);S(K,256,A)},r=(K,A)=>{const T=A.dyn_tree,G=A.stat_desc.static_tree,B=A.stat_desc.has_stree,f=A.stat_desc.elems;let O,C,Q,Y=-1;for(K.heap_len=0,K.heap_max=573,O=0;O<f;O++)0!==T[2*O]?(K.heap[++K.heap_len]=Y=O,K.depth[O]=0):T[2*O+1]=0;for(;K.heap_len<2;)Q=K.heap[++K.heap_len]=Y<2?++Y:0,T[2*Q]=1,K.depth[Q]=0,K.opt_len--,B&&(K.static_len-=G[2*Q+1]);for(A.max_code=Y,O=K.heap_len>>1;O>=1;O--)e(K,T,O);Q=f;do{O=K.heap[1],K.heap[1]=K.heap[K.heap_len--],e(K,T,1),C=K.heap[1],K.heap[--K.heap_max]=O,K.heap[--K.heap_max]=C,T[2*Q]=T[2*O]+T[2*C],K.depth[Q]=(K.depth[O]>=K.depth[C]?K.depth[O]:K.depth[C])+1,T[2*O+1]=T[2*C+1]=Q,K.heap[1]=Q++,e(K,T,1)}while(K.heap_len>=2);K.heap[--K.heap_max]=K.heap[1],((K,A)=>{const T=A.dyn_tree,G=A.max_code,B=A.stat_desc.static_tree,f=A.stat_desc.has_stree,O=A.stat_desc.extra_bits,C=A.stat_desc.extra_base,Q=A.stat_desc.max_length;let Y,Z,x,J,b,P,F=0;for(J=0;J<=L;J++)K.bl_count[J]=0;for(T[2*K.heap[K.heap_max]+1]=0,Y=K.heap_max+1;Y<573;Y++)Z=K.heap[Y],J=T[2*T[2*Z+1]+1]+1,J>Q&&(J=Q,F++),T[2*Z+1]=J,Z>G||(K.bl_count[J]++,b=0,Z>=C&&(b=O[Z-C]),P=T[2*Z],K.opt_len+=P*(J+b),f&&(K.static_len+=P*(B[2*Z+1]+b)));if(0!==F){do{for(J=Q-1;0===K.bl_count[J];)J--;K.bl_count[J]--,K.bl_count[J+1]+=2,K.bl_count[Q]--,F-=2}while(F>0);for(J=Q;0!==J;J--)for(Z=K.bl_count[J];0!==Z;)x=K.heap[--Y],x>G||(T[2*x+1]!==J&&(K.opt_len+=(J-T[2*x+1])*T[2*x],T[2*x+1]=J),Z--)}})(K,A),u(T,Y,K.bl_count)},h=(K,A,T)=>{let G,B,L=-1,f=A[1],O=0,C=7,Q=4;for(0===f&&(C=138,Q=3),A[2*(T+1)+1]=65535,G=0;G<=T;G++)B=f,f=A[2*(G+1)+1],++O<C&&B===f||(O<Q?K.bl_tree[2*B]+=O:0!==B?(B!==L&&K.bl_tree[2*B]++,K.bl_tree[32]++):O<=10?K.bl_tree[34]++:K.bl_tree[36]++,O=0,L=B,0===f?(C=138,Q=3):B===f?(C=6,Q=3):(C=7,Q=4))},k=(K,A,T)=>{let G,B,L=-1,f=A[1],O=0,C=7,Q=4;for(0===f&&(C=138,Q=3),G=0;G<=T;G++)if(B=f,f=A[2*(G+1)+1],!(++O<C&&B===f)){if(O<Q)do{S(K,B,K.bl_tree)}while(0!==--O);else 0!==B?(B!==L&&(S(K,B,K.bl_tree),O--),S(K,16,K.bl_tree),g(K,O-3,2)):O<=10?(S(K,17,K.bl_tree),g(K,O-3,3)):(S(K,18,K.bl_tree),g(K,O-11,7));O=0,L=B,0===f?(C=138,Q=3):B===f?(C=6,Q=3):(C=7,Q=4)}};let s=!1;const j=(K,A,T,G)=>{g(K,0+(G?1:0),3),((K,A,T,G)=>{n(K),G&&(z(K,T),z(K,~T)),K.pending_buf.set(K.window.subarray(A,A+T),K.pending),K.pending+=T})(K,A,T,!0)};K.exports._tr_init=K=>{s||((()=>{let K,A,T,Q,mK;const U=new Array(16);for(T=0,Q=0;Q<28;Q++)for(b[Q]=T,K=0;K<1<<f[Q];K++)J[T++]=Q;for(J[T-1]=Q,mK=0,Q=0;Q<16;Q++)for(P[Q]=mK,K=0;K<1<<O[Q];K++)x[mK++]=Q;for(mK>>=7;Q<B;Q++)for(P[Q]=mK<<7,K=0;K<1<<O[Q]-7;K++)x[256+mK++]=Q;for(A=0;A<=L;A++)U[A]=0;for(K=0;K<=143;)Y[2*K+1]=8,K++,U[8]++;for(;K<=255;)Y[2*K+1]=9,K++,U[9]++;for(;K<=279;)Y[2*K+1]=7,K++,U[7]++;for(;K<=287;)Y[2*K+1]=8,K++,U[8]++;for(u(Y,287,U),K=0;K<B;K++)Z[2*K+1]=5,Z[2*K]=l(K,5);d=new F(Y,f,257,G,L),N=new F(Z,O,0,B,L),D=new F(new Array(0),C,0,19,7)})(),s=!0),K.l_desc=new mK(K.dyn_ltree,d),K.d_desc=new mK(K.dyn_dtree,N),K.bl_desc=new mK(K.bl_tree,D),K.bi_buf=0,K.bi_valid=0,c(K)},K.exports._tr_stored_block=j,K.exports._tr_flush_block=(K,A,G,B)=>{let L,f,O=0;K.level>0?(2===K.strm.data_type&&(K.strm.data_type=(K=>{let A,G=4093624447;for(A=0;A<=31;A++,G>>>=1)if(1&G&&0!==K.dyn_ltree[2*A])return 0;if(0!==K.dyn_ltree[18]||0!==K.dyn_ltree[20]||0!==K.dyn_ltree[26])return 1;for(A=32;A<T;A++)if(0!==K.dyn_ltree[2*A])return 1;return 0})(K)),r(K,K.l_desc),r(K,K.d_desc),O=(K=>{let A;for(h(K,K.dyn_ltree,K.l_desc.max_code),h(K,K.dyn_dtree,K.d_desc.max_code),r(K,K.bl_desc),A=18;A>=3&&0===K.bl_tree[2*Q[A]+1];A--);return K.opt_len+=3*(A+1)+5+5+4,A})(K),L=K.opt_len+3+7>>>3,f=K.static_len+3+7>>>3,f<=L&&(L=f)):L=f=G+5,G+4<=L&&-1!==A?j(K,A,G,B):4===K.strategy||f===L?(g(K,2+(B?1:0),3),p(K,Y,Z)):(g(K,4+(B?1:0),3),((K,A,T,G)=>{let B;for(g(K,A-257,5),g(K,T-1,5),g(K,G-4,4),B=0;B<G;B++)g(K,K.bl_tree[2*Q[B]+1],3);k(K,K.dyn_ltree,A-1),k(K,K.dyn_dtree,T-1)})(K,K.l_desc.max_code+1,K.d_desc.max_code+1,O+1),p(K,K.dyn_ltree,K.dyn_dtree)),c(K),B&&n(K)},K.exports._tr_tally=(K,A,G)=>(K.pending_buf[K.d_buf+2*K.last_lit]=A>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&A,K.pending_buf[K.l_buf+K.last_lit]=255&G,K.last_lit++,0===A?K.dyn_ltree[2*G]++:(K.matches++,A--,K.dyn_ltree[2*(J[G]+T+1)]++,K.dyn_dtree[2*U(A)]++),K.last_lit===K.lit_bufsize-1),K.exports._tr_align=K=>{g(K,2,3),S(K,256,Y),(K=>{16===K.bi_valid?(z(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):K.bi_valid>=8&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)})(K)}},14768:K=>{"use strict";K.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.YA="",this.state=null,this.data_type=2,this.adler=0}},13497:K=>{function A(K,A,T){for(var G=K.length,B=-1/0,L=1/0,f=0;f<G;f++){var O=(T[0][f]-K[f])/A[f],C=(T[1][f]-K[f])/A[f];if(O>C){var Q=O;O=C,C=Q}if(C<B||O>L)return 1/0;O>B&&(B=O),C<L&&(L=C)}return B>L?1/0:B}K.exports=function(K,T,G,B){var L=A(T,G,B);if(L===1/0)K=null;else{K=K||[];for(var f=0;f<T.length;f++)K[f]=T[f]+G[f]*L}return K},K.exports.distance=A},14878:(K,A,T)=>{"use strict";T.d(A,{c:()=>f});var G=T(30);const B=G.useLayoutEffect;const L=function(K){var A=(0,G.useRef)(K);return B((function(){A.current=K})),A};var f=function(K){var A=L(K);(0,G.OA)((function(){var K=function(K){var T;if(null!=A.current&&(T=A.current(K)),K.defaultPrevented&&(K.returnValue=""),"string"===typeof T)return K.returnValue=T,T};return window.addEventListener("beforeunload",K),function(){window.removeEventListener("beforeunload",K)}}),[])}},14832:(K,A,T)=>{"use strict";var G=T(14836),B=Array.prototype.concat,L=Array.prototype.slice,f=K.exports=function(K){for(var A=[],T=0,f=K.length;T<f;T++){var O=K[T];G(O)?A=B.call(A,L.call(O)):A.push(O)}return A};f.wrap=function(K){return function(){return K(f(arguments))}}},14836:K=>{K.exports=function(K){return!(!K||"string"===typeof K)&&(K instanceof Array||Array.isArray(K)||K.length>=0&&(K.splice instanceof Function||Object.getOwnPropertyDescriptor(K,K.length-1)&&"String"!==K.constructor.name))}},14679:(K,A,T)=>{var G=T(14684);function B(K){for(var A,T,B=0,L=K.length,f=0;f<K.length;){for(A=K[f],T=0;f<L&&K[f]===A;)++f,++T;B+=G.log2(T)/7|0,B+=G.log2(A>>>0)/7|0,B+=2}return B}A.size=B,A.encode=function(K,A){A||(A=new Uint8Array(B(K)));for(var T,G,L=0,f=A.length,O=0;O<K.length;){for(T=K[O],G=0;O<K.length&&K[O]===T;)++O,++G;for(;L<f&&G>=128;)A[L++]=128+(127&G),G>>>=7;if(L>=f)throw new Error("RLE buffer overflow");for(A[L++]=G,T>>>=0;L<f&&T>=128;)A[L++]=128+(127&T),T>>>=7;if(L>=f)throw new Error("RLE buffer overflow");A[L++]=T}return A},A.decode=function(K,A){for(var T,G,B,L,f=A.length,O=K.length,C=0,Q=0;Q<O;){for(T=0,G=0;Q<O&&K[Q]>=128;)T+=(127&K[Q++])<<G,G+=7;if(T+=K[Q++]<<G,Q>=O)throw new Error("RLE buffer underrun");if(C+T>f)throw new Error("Chunk buffer overflow");for(B=0,G=0;Q<O&&K[Q]>=128;)B+=(127&K[Q++])<<G,G+=7;if(Q>=O)throw new Error("RLE buffer underrun");for(B+=K[Q++]<<G,L=0;L<T;++L)A[C++]=B}return A}},14684:(K,A)=>{"use strict";function T(K){var A=32;return(K&=-K)&&A--,65535&K&&(A-=16),16711935&K&&(A-=8),252645135&K&&(A-=4),858993459&K&&(A-=2),1431655765&K&&(A-=1),A}A.INT_BITS=32,A.INT_MAX=2147483647,A.INT_MIN=-1<<31,A.sign=function(K){return(K>0)-(K<0)},A.abs=function(K){var A=K>>31;return(K^A)-A},A.min=function(K,A){return A^(K^A)&-(K<A)},A.max=function(K,A){return K^(K^A)&-(K<A)},A.isPow2=function(K){return!(K&K-1)&&!!K},A.log2=function(K){var A,T;return A=(K>65535)<<4,A|=T=((K>>>=A)>255)<<3,A|=T=((K>>>=T)>15)<<2,(A|=T=((K>>>=T)>3)<<1)|(K>>>=T)>>1},A.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},A.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},A.countTrailingZeros=T,A.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},A.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},A.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var G=new Array(256);!function(K){for(var A=0;A<256;++A){var T=A,G=A,B=7;for(T>>>=1;T;T>>>=1)G<<=1,G|=1&T,--B;K[A]=G<<B&255}}(G),A.reverse=function(K){return G[255&K]<<24|G[K>>>8&255]<<16|G[K>>>16&255]<<8|G[K>>>24&255]},A.interleave2=function(K,A){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))<<1},A.deinterleave2=function(K,A){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>A&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},A.interleave3=function(K,A,T){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},A.deinterleave3=function(K,A){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>A&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},A.nextCombination=function(K){var A=K|K-1;return A+1|(~A&-~A)-1>>>T(K)+1}},14702:K=>{"use strict";K.exports=function(K,A,T,G){var B=self||window;try{try{var L;try{L=new B.Blob([K])}catch(Q){(L=new(B.BlobBuilder||B.WebKitBlobBuilder||B.MozBlobBuilder||B.MSBlobBuilder)).append(K),L=L.getBlob()}var f=B.URL||B.webkitURL,O=f.createObjectURL(L),C=new B[A](O,T);return f.revokeObjectURL(O),C}catch(Q){return new B[A]("data:application/javascript,".concat(encodeURIComponent(K)),T)}}catch(Q){if(!G)throw Error("Inline worker is not supported");return new B[A](G,T)}}},13483:(K,A,T)=>{"use strict";function G(K,A,T,G,B){var L={};return Object.keys(G).forEach((function(K){L[K]=G[K]})),L.enumerable=!!L.enumerable,L.configurable=!!L.configurable,("value"in L||L.initializer)&&(L.writable=!0),L=T.slice().reverse().reduce((function(T,G){return G(K,A,T)||T}),L),B&&void 0!==L.initializer&&(L.value=L.initializer?L.initializer.call(B):void 0,L.initializer=void 0),void 0===L.initializer&&(Object.defineProperty(K,A,L),L=null),L}T.d(A,{e:()=>G})},13474:(K,A,T)=>{"use strict";function G(K,A,T,G){T&&Object.defineProperty(K,A,{enumerable:T.enumerable,configurable:T.configurable,writable:T.writable,value:T.initializer?T.initializer.call(G):void 0})}T.d(A,{c:()=>G})},14867:(K,A,T)=>{"use strict";T.d(A,{c:()=>f,d:()=>Z,g:()=>O,k:()=>L,l:()=>C,n:()=>B,r:()=>Q,s:()=>Y});var G=T(12907);class B{constructor(){this._easingMode=B.EASINGMODE_EASEIN}setEasingMode(K){const A=Math.min(Math.max(K,0),2);this._easingMode=A}getEasingMode(){return this._easingMode}easeInCore(K){throw new Error("You must implement this method")}ease(K){switch(this._easingMode){case B.EASINGMODE_EASEIN:return this.easeInCore(K);case B.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-K)}return K>=.5?.5*(1-this.easeInCore(2*(1-K)))+.5:.5*this.easeInCore(2*K)}}B.EASINGMODE_EASEIN=0,B.EASINGMODE_EASEOUT=1,B.EASINGMODE_EASEINOUT=2;class L extends B{easeInCore(K){return K=Math.max(0,Math.min(1,K)),1-Math.sqrt(1-K*K)}}class f extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=K}easeInCore(K){const A=Math.max(0,this.amplitude);return Math.pow(K,3)-K*A*Math.sin(3.141592653589793*K)}}class O extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=K,this.bounciness=A}easeInCore(K){const A=Math.max(0,this.bounces);let T=this.bounciness;T<=1&&(T=1.001);const G=Math.pow(T,A),B=1-T,L=(1-G)/B+.5*G,f=K*L,O=Math.log(-f*(1-T)+1)/Math.log(T),C=Math.floor(O),Q=C+1,Y=(1-Math.pow(T,C))/(B*L),Z=.5*(Y+(1-Math.pow(T,Q))/(B*L)),x=K-Z,J=Z-Y;return-Math.pow(1/T,A-C)/(J*J)*(x-J)*(x+J)}}class C extends B{easeInCore(K){return K*K*K}}class Q extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=K,this.springiness=A}easeInCore(K){let A;const T=Math.max(0,this.oscillations),G=Math.max(0,this.springiness);return A=0==G?K:(Math.exp(G*K)-1)/(Math.exp(G)-1),A*Math.sin((6.283185307179586*T+1.5707963267948966)*K)}}class Y extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=K}easeInCore(K){return this.exponent<=0?K:(Math.exp(this.exponent*K)-1)/(Math.exp(this.exponent)-1)}}class Z extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=K,this.y1=A,this.x2=T,this.y2=G}easeInCore(K){return G.d.Interpolate(K,this.x1,this.y1,this.x2,this.y2)}}},14152:(K,A,T)=>{"use strict";T.d(A,{b:()=>f});var G=T(12700),B=T(12714),L=T(13127);class f extends L.d{get _matrix(){return this._compose(),this.yx}set _matrix(K){(K.updateFlag!==this.yx.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.yx.G(K),this._markAsDirtyAndDecompose())}constructor(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(K,A.SK(),!1),this.name=K,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=A,this.yx=(null===B||void 0===B?void 0:B.clone())??G.Matrix.Identity(),this._restMatrix=L??this.yx.clone(),this._bindMatrix=f??this.yx.clone(),this._index=O,this._absoluteMatrix=new G.Matrix,this._absoluteBindMatrix=new G.Matrix,this._absoluteInverseBindMatrix=new G.Matrix,this._finalMatrix=new G.Matrix,A.bones.push(this),this.setParent(T,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(K){this.setParent(K)}setParent(K){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==K){if(this.parent){const K=this.parent.children.indexOf(this);-1!==K&&this.parent.children.splice(K,1)}this._parentNode=K,this.parent&&this.parent.children.push(this),A&&this._updateAbsoluteBindMatrices(),this.fY()}}getLocalMatrix(){return this._compose(),this.yx}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(K){this._restMatrix.G(K)}setRestPose(K){this.setRestMatrix(K)}getBindPose(){return this.getBindMatrix()}setBindMatrix(K){this.Xf(K)}setBindPose(K){this.setBindMatrix(K)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const K=G.TmpVectors.PA[0],A=G.TmpVectors.Quaternion[0],T=G.TmpVectors.PA[1];this.getRestMatrix().decompose(K,A,T),this._linkedTransformNode.position.G(T),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??G.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.G(A),this._linkedTransformNode.vO.G(K)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(K){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=K,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ZC}set position(K){this._decompose(),this.ZC.G(K),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(K){this.setRotation(K)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(K){this.setRotationQuaternion(K)}get vO(){return this.getScale()}set vO(K){this.setScale(K)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=G.PA.Zero(),this._localRotation=G.Quaternion.Zero(),this.ZC=G.PA.Zero()),this.yx.decompose(this._localScaling,this._localRotation,this.ZC))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,G.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.ZC,this.yx)):this._needToCompose=!1)}Xf(K){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.G(K),A&&this._updateAbsoluteBindMatrices(),T?this._matrix=K:this.fY()}_updateAbsoluteBindMatrices(K){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K||(K=this._bindMatrix),this.parent?K.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.G(K),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),A)for(let T=0;T<this.children.length;T++)this.children[T]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}fY(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.fY(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.fY(),this._needToDecompose=!0}_updatePosition(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this.getLocalMatrix();if(0==A)B?(L.addAtIndex(12,K.x),L.addAtIndex(13,K.y),L.addAtIndex(14,K.z)):L.setTranslationFromFloats(K.x,K.y,K.z);else{let A=null;T&&(A=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=f._TmpMats[0],C=f._TmpVecs[0];this.parent?T&&A?(O.G(this.parent.getAbsoluteMatrix()),O.multiplyToRef(A,O)):O.G(this.parent.getAbsoluteMatrix()):G.Matrix.IdentityToRef(O),B&&O.setTranslationFromFloats(0,0,0),O.invert(),G.PA.TransformCoordinatesToRef(K,O,C),B?(L.addAtIndex(12,C.x),L.addAtIndex(13,C.y),L.addAtIndex(14,C.z)):L.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,A,T,!0)}setPosition(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,A,T,!1)}setAbsolutePosition(K,A){this.setPosition(K,1,A)}scale(K,A,T){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=this.getLocalMatrix(),O=f._TmpMats[0];G.Matrix.ScalingToRef(K,A,T,O),O.multiplyToRef(L,L),O.invert();for(const G of this.children){const B=G.getLocalMatrix();B.multiplyToRef(O,B),B.multiplyAtIndex(12,K),B.multiplyAtIndex(13,A),B.multiplyAtIndex(14,T),G._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),B)for(const G of this.children)G.scale(K,A,T,B)}setScale(K){this._decompose(),this._localScaling.G(K),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(K){this._decompose(),K.G(this._localScaling)}setYawPitchRoll(K,A,T){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4?arguments[4]:void 0;if(0===B){const O=f._TmpQuat;return G.Quaternion.RotationYawPitchRollToRef(K,A,T,O),void this.setRotationQuaternion(O,B,L)}const O=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,L))return;const C=f._TmpMats[1];G.Matrix.RotationYawPitchRollToRef(K,A,T,C),O.multiplyToRef(C,C),this._rotateWithMatrix(C,B,L)}rotate(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;const L=f._TmpMats[0];L.setTranslationFromFloats(0,0,0),G.Matrix.RotationAxisToRef(K,A,L),this._rotateWithMatrix(L,T,B)}setAxisAngle(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;if(0===T){const L=f._TmpQuat;return G.Quaternion.RotationAxisToRef(K,A,L),void this.setRotationQuaternion(L,T,B)}const L=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,B))return;const O=f._TmpMats[1];G.Matrix.RotationAxisToRef(K,A,O),L.multiplyToRef(O,O),this._rotateWithMatrix(O,T,B)}setRotation(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(K.y,K.x,K.z,A,T)}setRotationQuaternion(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===A)return this._decompose(),this._localRotation.G(K),void this._markAsDirtyAndCompose();const B=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,T))return;const L=f._TmpMats[1];G.Matrix.FromQuaternionToRef(K,L),B.multiplyToRef(L,L),this._rotateWithMatrix(L,A,T)}setRotationMatrix(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===A){const B=f._TmpQuat;return G.Quaternion.FromRotationMatrixToRef(K,B),void this.setRotationQuaternion(B,A,T)}const B=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,T))return;const L=f._TmpMats[1];L.G(K),B.multiplyToRef(K,L),this._rotateWithMatrix(L,A,T)}_rotateWithMatrix(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const G=this.getLocalMatrix(),B=G.m[12],L=G.m[13],O=G.m[14],C=this.getParent(),Q=f._TmpMats[3],Y=f._TmpMats[4];C&&1==A?(T?(Q.G(T.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(Q,Q)):Q.G(C.getAbsoluteMatrix()),Y.G(Q),Y.invert(),G.multiplyToRef(Q,G),G.multiplyToRef(K,G),G.multiplyToRef(Y,G)):1==A&&T?(Q.G(T.getWorldMatrix()),Y.G(Q),Y.invert(),G.multiplyToRef(Q,G),G.multiplyToRef(K,G),G.multiplyToRef(Y,G)):G.multiplyToRef(K,G),G.setTranslationFromFloats(B,L,O),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(K,A){const T=f._TmpMats[2];return K.G(this.getAbsoluteMatrix()),A?(K.multiplyToRef(A.getWorldMatrix(),K),G.Matrix.ScalingToRef(A.vO.x,A.vO.y,A.vO.z,T)):G.Matrix.IdentityToRef(T),K.invert(),!isNaN(K.m[0])&&(T.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyToRef(T,K),!0)}Of(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=G.PA.Zero();return this.getPositionToRef(K,A,T),T}getPositionToRef(){let K=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const K=this.getLocalMatrix();A.x=K.m[12],A.y=K.m[13],A.z=K.m[14]}else{let T=null;K&&(T=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let G=f._TmpMats[0];K&&T?(G.G(this.getAbsoluteMatrix()),G.multiplyToRef(T,G)):G=this.getAbsoluteMatrix(),A.x=G.m[12],A.y=G.m[13],A.z=G.m[14]}}getAbsolutePosition(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const A=G.PA.Zero();return this.getPositionToRef(1,K,A),A}getAbsolutePositionToRef(K,A){this.getPositionToRef(1,K,A)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.yx.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.G(this.yx);const K=this._skeleton.getPoseMatrix();K&&this._absoluteMatrix.multiplyToRef(K,this._absoluteMatrix)}const K=this.children,A=K.length;for(let T=0;T<A;T++)K[T].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}vC(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=G.PA.Zero();return this.getDirectionToRef(K,A,T),T}getDirectionToRef(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,B=null;A&&(B=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=f._TmpMats[0];L.G(this.getAbsoluteMatrix()),A&&B&&L.multiplyToRef(B,L),G.PA.TransformNormalToRef(K,L,T),T.normalize()}getRotation(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=G.PA.Zero();return this.getRotationToRef(K,A,T),T}getRotationToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;const G=f._TmpQuat;this.getRotationQuaternionToRef(K,A,G),G.toEulerAnglesToRef(T)}getRotationQuaternion(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=G.Quaternion.Identity();return this.getRotationQuaternionToRef(K,A,T),T}getRotationQuaternionToRef(){let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),A.G(this._localRotation);else{const T=f._TmpMats[0],G=this.getAbsoluteMatrix();K?G.multiplyToRef(K.getWorldMatrix(),T):T.G(G),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.decompose(void 0,A,void 0)}}getRotationMatrix(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1?arguments[1]:void 0;const T=G.Matrix.Identity();return this.getRotationMatrixToRef(K,A,T),T}getRotationMatrixToRef(){let K=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(A);else{const T=f._TmpMats[0],G=this.getAbsoluteMatrix();K?G.multiplyToRef(K.getWorldMatrix(),T):T.G(G),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.getRotationMatrixToRef(A)}}getAbsolutePositionFromLocal(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=G.PA.Zero();return this.getAbsolutePositionFromLocalToRef(K,A,T),T}getAbsolutePositionFromLocalToRef(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,B=null;A&&(B=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=f._TmpMats[0];L.G(this.getAbsoluteMatrix()),A&&B&&L.multiplyToRef(B,L),G.PA.TransformCoordinatesToRef(K,L,T)}getLocalPositionFromAbsolute(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=G.PA.Zero();return this.getLocalPositionFromAbsoluteToRef(K,A,T),T}getLocalPositionFromAbsoluteToRef(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,B=null;A&&(B=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=f._TmpMats[0];L.G(this.getAbsoluteMatrix()),A&&B&&L.multiplyToRef(B,L),L.invert(),G.PA.TransformCoordinatesToRef(K,L,T)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const K=this._skeleton.bones.indexOf(this);if(-1!==K&&this._skeleton.bones.splice(K,1),this._parentNode&&this._parentNode.children){const K=this._parentNode.children,A=K.indexOf(this);-1!==A&&K.splice(A,1)}super.dispose()}}f._TmpVecs=(0,B.b)(2,G.PA.Zero),f._TmpQuat=G.Quaternion.Identity(),f._TmpMats=(0,B.b)(5,G.Matrix.Identity)},14859:(K,A,T)=>{"use strict";T.d(A,{d:()=>r});var G=T(12683),B=T(12688),L=T(12534),f=T(12700),O=T(12716),C=T(13127),Q=T(13147),Y=T(12974),Z=T(12553),x=T(12706);class J{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(K){this._idleRotationSpeed=K}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(K){this._idleRotationWaitTime=K}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(K){this._idleRotationSpinupTime=K}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(K){this._attachedCamera=K;const A=this._attachedCamera.SK();this._onPrePointerObservableObserver=A.onPrePointerObservable.add((K=>{K.type!==Y.e.POINTERDOWN?K.type===Y.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const K=Z.d.Now;let A=0;null!=this._lastFrameTime&&(A=K-this._lastFrameTime),this._lastFrameTime=K,this._applyUserInteraction();const T=K-this._lastInteractionTime-this._idleRotationWaitTime,G=Math.max(Math.min(T/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*G,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(A/1e3))}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.SK();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(K){this._lastInteractionTime=K??Z.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<x.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let K=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(K=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?K:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Z.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var b=T(14867),P=T(13226);class F{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(K){if(this._autoTransitionRange===K)return;this._autoTransitionRange=K;const A=this._attachedCamera;A&&(K?this._onMeshTargetChangedObserver=A.onMeshTargetChangedObservable.add((K=>{if(K&&(K.wf(!0),K.getBoundingInfo)){const A=K.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*A,this.upperRadiusTransitionRange=.05*A}})):this._onMeshTargetChangedObserver&&A.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(K){this._attachedCamera=K,this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(K){return!!this._attachedCamera&&(this._attachedCamera.radius===K&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(K){if(!this._attachedCamera)return;this._radiusBounceTransition||(F.EasingFunction.setEasingMode(F.EasingMode),this._radiusBounceTransition=P.b.CreateAnimation("radius",P.b.ANIMATIONTYPE_FLOAT,60,F.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const A=P.b.TransitionTo("radius",this._attachedCamera.radius+K,this._attachedCamera,this._attachedCamera.SK(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));A&&this._animatables.push(A)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}F.EasingFunction=new b.c(.3),F.EasingMode=b.n.EASINGMODE_EASEOUT;class d{constructor(){this.onTargetFramingAnimationEndObservable=new L.e,this._mode=d.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(K){this._mode=K}get mode(){return this._mode}set radiusScale(K){this._radiusScale=K}get radiusScale(){return this._radiusScale}set positionScale(K){this._positionScale=K}get positionScale(){return this._positionScale}set defaultElevation(K){this._defaultElevation=K}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(K){this._elevationReturnTime=K}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(K){this._elevationReturnWaitTime=K}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(K){this._framingTime=K}get framingTime(){return this._framingTime}init(){}attach(K){this._attachedCamera=K;const A=this._attachedCamera.SK();d.EasingFunction.setEasingMode(d.EasingMode),this._onPrePointerObservableObserver=A.onPrePointerObservable.add((K=>{K.type!==Y.e.POINTERDOWN?K.type===Y.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=K.onMeshTargetChangedObservable.add((K=>{K&&K.getBoundingInfo&&this.zoomOnMesh(K,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.SK();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.wf(!0);const G=K.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(G.minimumWorld,G.maximumWorld,A,T)}zoomOnMeshHierarchy(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.wf(!0);const G=K.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(G.min,G.max,A,T)}zoomOnMeshesHierarchy(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new f.PA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new f.PA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let L=0;L<K.length;L++){const A=K[L].getHierarchyBoundingVectors(!0);f.PA.CheckExtends(A.min,G,B),f.PA.CheckExtends(A.max,G,B)}this.zoomOnBoundingInfo(G,B,A,T)}zoomOnBoundingInfo(K,A){let T,G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const L=K.y,O=L+(A.y-L)*this._positionScale,C=A.FA(K).scale(.5);if(!isFinite(O))return!1;if(G)T=new f.PA(0,O,0);else{const A=K.add(C);T=new f.PA(A.x,O,A.z)}this._vectorTransition||(this._vectorTransition=P.b.CreateAnimation("target",P.b.ANIMATIONTYPE_VECTOR3,60,d.EasingFunction)),this._betaIsAnimating=!0;let Q=P.b.TransitionTo("target",T,this._attachedCamera,this._attachedCamera.SK(),60,this._vectorTransition,this._framingTime);Q&&this._animatables.push(Q);let Y=0;if(this._mode===d.FitFrustumSidesMode){const T=this._calculateLowerRadiusFromModelBoundingSphere(K,A);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.If),Y=T}else this._mode===d.IgnoreBoundsSizeMode&&(Y=this._calculateLowerRadiusFromModelBoundingSphere(K,A),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.If));if(this.autoCorrectCameraLimitsAndSensibility){const T=A.FA(K).length();this._attachedCamera.panningSensibility=5e3/T,this._attachedCamera.wheelPrecision=100/Y}return this._radiusTransition||(this._radiusTransition=P.b.CreateAnimation("radius",P.b.ANIMATIONTYPE_FLOAT,60,d.EasingFunction)),Q=P.b.TransitionTo("radius",Y,this._attachedCamera,this._attachedCamera.SK(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),B&&B(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Q&&this._animatables.push(Q),!0}_calculateLowerRadiusFromModelBoundingSphere(K,A){const T=this._attachedCamera;if(!T)return 0;let G=T._calculateLowerRadiusFromModelBoundingSphere(K,A,this._radiusScale);return T.lowerRadiusLimit&&this._mode===d.IgnoreBoundsSizeMode&&(G=G<T.lowerRadiusLimit?T.lowerRadiusLimit:G),T.upperRadiusLimit&&(G=G>T.upperRadiusLimit?T.upperRadiusLimit:G),G}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const K=Z.d.Now-this._lastInteractionTime,A=.5*Math.PI-this._defaultElevation,T=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>T&&K>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=P.b.CreateAnimation("beta",P.b.ANIMATIONTYPE_FLOAT,60,d.EasingFunction));const K=P.b.TransitionTo("beta",A,this._attachedCamera,this._attachedCamera.SK(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));K&&this._animatables.push(K)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Z.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}d.EasingFunction=new b.s,d.EasingMode=b.n.EASINGMODE_EASEINOUT,d.IgnoreBoundsSizeMode=0,d.FitFrustumSidesMode=1;var N=T(13154),D=T(13192),mK=T(14149),U=T(12526);class z{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(K){K=U.Tools.BackCompatCameraNoPreventDefault(arguments);const A=this.camera.getEngine(),T=A.getInputElement();let G=0,B=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=L=>{var f,O;const C=L.event,Q="touch"===C.pointerType;if(L.type!==Y.e.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const Z=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,A.isPointerLock){const K=C.movementX,A=C.movementY;this.onTouch(null,K,A),this._pointA=null,this._pointB=null}else{if(L.type!==Y.e.POINTERDOWN&&L.type!==Y.e.POINTERDOUBLETAP&&Q&&(null===(f=this._pointA)||void 0===f?void 0:f.pointerId)!==C.pointerId&&(null===(O=this._pointB)||void 0===O?void 0:O.pointerId)!==C.pointerId)return;if(L.type!==Y.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!Q)if(L.type===Y.e.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(L.type!==Y.e.POINTERUP||this._currentMousePointerIdDown!==C.pointerId&&!Q){if(L.type===Y.e.POINTERMOVE)if(K||C.preventDefault(),this._pointA&&null===this._pointB){const K=C.clientX-this._pointA.x,A=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,K,A)}else if(this._pointA&&this._pointB){const K=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;K.x=C.clientX,K.y=C.clientY;const A=this._pointA.x-this._pointB.x,T=this._pointA.y-this._pointB.y,f=A*A+T*T,O={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:L.type};this.onMultiTouch(this._pointA,this._pointB,G,f,B,O),B=O,G=f}}else{try{null===Z||void 0===Z||Z.releasePointerCapture(C.pointerId)}catch(x){}Q||(this._pointB=null),A._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==G||B)&&(this.onMultiTouch(this._pointA,this._pointB,G,0,B,null),G=0,B=null),this._currentMousePointerIdDown=-1,this.onButtonUp(C),K||C.preventDefault()}else{try{null===Z||void 0===Z||Z.setPointerCapture(C.pointerId)}catch(x){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentMousePointerIdDown||Q||(this._currentMousePointerIdDown=C.pointerId),this.onButtonDown(C),K||(C.preventDefault(),T&&T.focus())}}},this._observer=this.camera.SK()._inputManager._addCameraPointerObserver(this._pointerInput,Y.e.POINTERDOWN|Y.e.POINTERUP|Y.e.POINTERMOVE|Y.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,G=0,B=null,this.onLostFocus()},this._contextMenuBind=K=>this.onContextMenu(K),T&&T.addEventListener("contextmenu",this._contextMenuBind,!1);const L=this.camera.SK().getEngine().getHostWindow();L&&U.Tools.RegisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}aZ(){if(this._onLostFocus){const K=this.camera.SK().getEngine().getHostWindow();K&&U.Tools.UnregisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.SK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const K=this.camera.SK().getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(K){}onTouch(K,A,T){}onMultiTouch(K,A,T,G,B,L){}onContextMenu(K){K.preventDefault()}onButtonDown(K){}onButtonUp(K){}onLostFocus(){}}(0,G.c)([(0,B.B)()],z.prototype,"buttons",void 0);class g extends z{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(K,A){if(0!==this.panningSensibility&&K&&A){const T=A.x-K.x,G=A.y-K.y;this.camera.inertialPanningX+=-T/this.panningSensibility,this.camera.inertialPanningY+=G/this.panningSensibility}}_computePinchZoom(K,A){const T=this.camera.radius||g.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=T*Math.sqrt(K)/Math.sqrt(A):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(A-K)*T*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(A-K)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(K,A,T){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility):(this.camera.inertialAlphaOffset-=A/this.angularSensibilityX,this.camera.inertialBetaOffset-=T/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(K,A,T,G,B,L){0===T&&null===B||0===G&&null===L||(this.multiTouchPanAndZoom?(this._computePinchZoom(T,G),this._computeMultiTouchPanning(B,L)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(G)-Math.sqrt(T))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(T,G),this._isPinching=!0):this._computeMultiTouchPanning(B,L)):this.multiTouchPanning?this._computeMultiTouchPanning(B,L):this.pinchZoom&&this._computePinchZoom(T,G))}onButtonDown(K){this._isPanClick=K.button===this.camera._panningMouseButton}onButtonUp(K){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}g.MinimumRadiusForPinch=.001,(0,G.c)([(0,B.B)()],g.prototype,"buttons",void 0),(0,G.c)([(0,B.B)()],g.prototype,"angularSensibilityX",void 0),(0,G.c)([(0,B.B)()],g.prototype,"angularSensibilityY",void 0),(0,G.c)([(0,B.B)()],g.prototype,"pinchPrecision",void 0),(0,G.c)([(0,B.B)()],g.prototype,"pinchDeltaPercentage",void 0),(0,G.c)([(0,B.B)()],g.prototype,"useNaturalPinchZoom",void 0),(0,G.c)([(0,B.B)()],g.prototype,"pinchZoom",void 0),(0,G.c)([(0,B.B)()],g.prototype,"panningSensibility",void 0),(0,G.c)([(0,B.B)()],g.prototype,"multiTouchPanning",void 0),(0,G.c)([(0,B.B)()],g.prototype,"multiTouchPanAndZoom",void 0),mK.e.ArcRotateCameraPointersInput=g;var S=T(12983);class l{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(K){K=U.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.SK(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((A=>{const T=A.event;if(!T.metaKey)if(A.type===S.c.KEYDOWN){if(this._ctrlPressed=T.ctrlKey,this._altPressed=T.altKey,-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),T.preventDefault&&(K||T.preventDefault())}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){const A=this._keys.indexOf(T.keyCode);A>=0&&this._keys.splice(A,1),T.preventDefault&&(K||T.preventDefault())}})))}aZ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let A=0;A<this._keys.length;A++){const T=this._keys[A];-1!==this.keysLeft.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX-=1/this.panningSensibility:K.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset+=1/this.zoomingSensibility:K.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX+=1/this.panningSensibility:K.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset-=1/this.zoomingSensibility:K.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(T)&&K.useInputToRestoreState&&K.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,G.c)([(0,B.B)()],l.prototype,"keysUp",void 0),(0,G.c)([(0,B.B)()],l.prototype,"keysDown",void 0),(0,G.c)([(0,B.B)()],l.prototype,"keysLeft",void 0),(0,G.c)([(0,B.B)()],l.prototype,"keysRight",void 0),(0,G.c)([(0,B.B)()],l.prototype,"keysReset",void 0),(0,G.c)([(0,B.B)()],l.prototype,"panningSensibility",void 0),(0,G.c)([(0,B.B)()],l.prototype,"zoomingSensibility",void 0),(0,G.c)([(0,B.B)()],l.prototype,"useAltToZoom",void 0),(0,G.c)([(0,B.B)()],l.prototype,"angularSpeed",void 0),mK.e.ArcRotateCameraKeyboardMoveInput=l;var u=T(12747),c=T(12989);class n{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new f.PA(0,0,0),this._globalOffset=new f.PA(0,0,0),this._inertialPanning=f.PA.Zero()}_computeDeltaFromMouseWheelLegacyEvent(K,A){let T=0;const G=.01*K*this.wheelDeltaPercentage*A;return T=K>0?G/(1+this.wheelDeltaPercentage):G*(1+this.wheelDeltaPercentage),T}attachControl(K){K=U.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=A=>{if(A.type!==Y.e.POINTERWHEEL)return;const T=A.event;let G=0;const B=T.deltaMode===c.b.DOM_DELTA_LINE?40:1,L=-T.deltaY*B;if(this.customComputeDeltaFromMouseWheel)G=this.customComputeDeltaFromMouseWheel(L,this,T);else if(this.wheelDeltaPercentage){if(G=this._computeDeltaFromMouseWheelLegacyEvent(L,this.camera.radius),G>0){let K=this.camera.radius,A=this.camera.inertialRadiusOffset+G;for(let T=0;T<20&&!(K<=A)&&!(Math.abs(A*this.camera.inertia)<.001);T++)K-=A,A*=this.camera.inertia;K=(0,O.Clamp)(K,0,Number.MAX_VALUE),G=this._computeDeltaFromMouseWheelLegacyEvent(L,K)}}else G=L/(40*this.wheelPrecision);G&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(G)):this.camera.inertialRadiusOffset+=G),T.preventDefault&&(K||T.preventDefault())},this._observer=this.camera.SK()._inputManager._addCameraPointerObserver(this._wheel,Y.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.IO(0)}aZ(){this._observer&&(this.camera.SK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const K=this.camera;0+K.inertialAlphaOffset+K.inertialBetaOffset+K.inertialRadiusOffset&&(this._updateHitPlane(),K.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(K.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const K=this.camera,A=K.target.FA(K.position);this._hitPlane=u.e.FromPositionAndNormal(K.target,A)}_getPosition(){const K=this.camera,A=K.SK(),T=A.createPickingRay(A.pointerX,A.pointerY,f.Matrix.Identity(),K,!1);0===K.targetScreenOffset.x&&0===K.targetScreenOffset.y||(this._viewOffset.set(K.targetScreenOffset.x,K.targetScreenOffset.y,0),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),this._globalOffset=f.PA.TransformNormal(this._viewOffset,K._cameraTransformMatrix),T.origin.addInPlace(this._globalOffset));let G=0;return this._hitPlane&&(G=T.intersectsPlane(this._hitPlane)??0),T.origin.addInPlace(T.direction.scaleInPlace(G))}_zoomToMouse(K){const A=this.camera,T=1-A.inertia;if(A.lowerRadiusLimit){const G=A.lowerRadiusLimit??0;A.radius-(A.inertialRadiusOffset+K)/T<G&&(K=(A.radius-G)*T-A.inertialRadiusOffset)}if(A.upperRadiusLimit){const G=A.upperRadiusLimit??0;A.radius-(A.inertialRadiusOffset+K)/T>G&&(K=(A.radius-G)*T-A.inertialRadiusOffset)}const G=K/T/A.radius,B=this._getPosition(),L=f.TmpVectors.PA[6];B.subtractToRef(A.target,L),L.scaleInPlace(G),L.scaleInPlace(T),this._inertialPanning.addInPlace(L),A.inertialRadiusOffset+=K}_zeroIfClose(K){Math.abs(K.x)<x.c&&(K.x=0),Math.abs(K.y)<x.c&&(K.y=0),Math.abs(K.z)<x.c&&(K.z=0)}}(0,G.c)([(0,B.B)()],n.prototype,"wheelPrecision",void 0),(0,G.c)([(0,B.B)()],n.prototype,"zoomToMouseLocation",void 0),(0,G.c)([(0,B.B)()],n.prototype,"wheelDeltaPercentage",void 0),mK.e.ArcRotateCameraMouseWheelInput=n;class H extends mK.h{constructor(K){super(K)}addMouseWheel(){return this.add(new n),this}addPointers(){return this.add(new g),this}addKeyboard(){return this.add(new l),this}}var e=T(12651);function p(K,A){return isNaN(K)?A:K}C.d.AddNodeConstructor("ArcRotateCamera",((K,A)=>()=>new r(K,0,0,1,f.PA.Zero(),A)));class r extends D.d{get target(){return this._target}set target(K){this.setTarget(K)}get targetHost(){return this._targetHost}set targetHost(K){K&&this.setTarget(K)}getTarget(){return this.target}get position(){return this._position}set position(K){this.setPosition(K)}set upVector(K){this._upToYMatrix||(this._yToUpMatrix=new f.Matrix,this._upToYMatrix=new f.Matrix,this._upVector=f.PA.Zero()),K.normalize(),this._upVector.G(K),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){f.Matrix.RotationAlignToRef(f.PA.UpReadOnly,this._upVector,this._yToUpMatrix),f.Matrix.RotationAlignToRef(this._upVector,f.PA.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityX:0}set angularSensibilityX(K){const A=this.inputs.attached.pointers;A&&(A.angularSensibilityX=K)}get angularSensibilityY(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityY:0}set angularSensibilityY(K){const A=this.inputs.attached.pointers;A&&(A.angularSensibilityY=K)}get pinchPrecision(){const K=this.inputs.attached.pointers;return K?K.pinchPrecision:0}set pinchPrecision(K){const A=this.inputs.attached.pointers;A&&(A.pinchPrecision=K)}get pinchDeltaPercentage(){const K=this.inputs.attached.pointers;return K?K.pinchDeltaPercentage:0}set pinchDeltaPercentage(K){const A=this.inputs.attached.pointers;A&&(A.pinchDeltaPercentage=K)}get useNaturalPinchZoom(){const K=this.inputs.attached.pointers;return!!K&&K.useNaturalPinchZoom}set useNaturalPinchZoom(K){const A=this.inputs.attached.pointers;A&&(A.useNaturalPinchZoom=K)}get panningSensibility(){const K=this.inputs.attached.pointers;return K?K.panningSensibility:0}set panningSensibility(K){const A=this.inputs.attached.pointers;A&&(A.panningSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const A=this.inputs.attached.keyboard;A&&(A.keysUp=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const A=this.inputs.attached.keyboard;A&&(A.keysDown=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const A=this.inputs.attached.keyboard;A&&(A.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const A=this.inputs.attached.keyboard;A&&(A.keysRight=K)}get wheelPrecision(){const K=this.inputs.attached.mousewheel;return K?K.wheelPrecision:0}set wheelPrecision(K){const A=this.inputs.attached.mousewheel;A&&(A.wheelPrecision=K)}get zoomToMouseLocation(){const K=this.inputs.attached.mousewheel;return!!K&&K.zoomToMouseLocation}set zoomToMouseLocation(K){const A=this.inputs.attached.mousewheel;A&&(A.zoomToMouseLocation=K)}get wheelDeltaPercentage(){const K=this.inputs.attached.mousewheel;return K?K.wheelDeltaPercentage:0}set wheelDeltaPercentage(K){const A=this.inputs.attached.mousewheel;A&&(A.wheelDeltaPercentage=K)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(K){K!==this.useBouncingBehavior&&(K?(this._bouncingBehavior=new F,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(K){K!==this.useFramingBehavior&&(K?(this._framingBehavior=new d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(K){K!==this.useAutoRotationBehavior&&(K?(this._autoRotationBehavior=new J,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(K,A,T,G,B,O){var C;let Q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(K,f.PA.Zero(),O,Q),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=f.PA.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=f.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new f.Matrix,this.panningAxis=new f.PA(1,1,0),this._transformedDirection=new f.PA,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new L.e,this.checkCollisions=!1,this.collisionRadius=new f.PA(.5,.5,.5),this._previousPosition=f.PA.Zero(),this._collisionVelocity=f.PA.Zero(),this._newPosition=f.PA.Zero(),this._computationVector=f.PA.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new f.PA(NaN,NaN,NaN),this._goalTargetScreenOffset=new f.Vector2(NaN,NaN),this._onCollisionPositionChange=function(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T?(C.setPosition(A),C.WJ&&C.WJ(T)):C._previousPosition.G(C._position);const G=Math.cos(C.alpha),B=Math.sin(C.alpha),L=Math.cos(C.beta);let f=Math.sin(C.beta);0===f&&(f=1e-4);const O=C._getTargetPosition();C._computationVector.RO(C.radius*G*f,C.radius*L,C.radius*B*f),O.addToRef(C._computationVector,C._newPosition),C._position.G(C._newPosition);let Q=C.upVector;C.allowUpsideDown&&C.beta<0&&(Q=Q.clone(),Q=Q.negate()),C._computeViewMatrix(C._position,O,Q),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=f.PA.Zero(),B&&this.setTarget(B),this.alpha=A,this.beta=T,this.radius=G,this.getViewMatrix(),this.inputs=new H(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new f.PA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=f.Vector2.Zero()}_updateCache(K){K||super._updateCache(),this._cache._target.G(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.G(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const K=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?K.addToRef(this._targetBoundingCenter,this._target):this._target.G(K)}const K=this._getLockedTargetPosition();return K||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>x.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,L=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=L?this._currentInterpolationFactor=L:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=p(K,this._goalAlpha),this._goalBeta=p(A,this._goalBeta),this._goalRadius=p(T,this._goalRadius),this._goalTarget.set(p(G.x,this._goalTarget.x),p(G.y,this._goalTarget.y),p(G.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(p(B.x,this._goalTargetScreenOffset.x),p(B.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,O.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,O.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,O.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,O.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(K,A){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const B=arguments;A=U.Tools.BackCompatCameraNoPreventDefault(B),this._useCtrlForPanning=T,this._panningMouseButton=G,"boolean"===typeof B[0]&&(B.length>1&&(this._useCtrlForPanning=B[1]),B.length>2&&(this._panningMouseButton=B[2])),this.inputs.attachElement(A),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}aZ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let K=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){K=!0;const A=this.invertRotation?-1:1,T=this._calculateHandednessMultiplier();let G=this.inertialAlphaOffset*T;this.beta<0&&(G*=-1),this.alpha+=G*A,this.beta+=this.inertialBetaOffset*A,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<x.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<x.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*x.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){K=!0;const A=new f.PA(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),A.multiplyInPlace(this.panningAxis),f.PA.TransformNormalToRef(A,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const K=this.upVector,A=f.PA.CrossToRef(this._transformedDirection,K,this._transformedDirection);f.PA.CrossToRef(K,A,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);f.PA.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.G(this._transformedDirection)}else{if(this.parent){const K=f.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(K),K.transposeToRef(K),f.PA.TransformCoordinatesToRef(this._transformedDirection,K,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*x.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*x.c&&(this.inertialPanningY=0)}if(K)this.stopInterpolation();else if(this._isInterpolating){let K=!1;const A=this._scene.getEngine().getDeltaTime()/1e3,T=1-Math.pow(2,-A/this._currentInterpolationFactor),G=p(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const A=f.TmpVectors.PA[0].set(p(this._goalTarget.x,this._target.x),p(this._goalTarget.y,this._target.y),p(this._goalTarget.z,this._target.z));f.PA.LerpToRef(this.target,A,T,this._target),10*f.PA.Distance(this.target,A)/G<x.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.G(A),this.setTarget(this.target,!1,!0,!0)):K=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const A=f.Quaternion.RotationAlphaBetaGammaToRef(p(this._goalAlpha,this.alpha),p(this._goalBeta,this.beta),0,f.TmpVectors.Quaternion[0]),G=f.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,f.TmpVectors.Quaternion[1]),B=f.Quaternion.SlerpToRef(G,A,T,f.TmpVectors.Quaternion[2]);B.normalize();const L=B.toAlphaBetaGammaToRef(f.TmpVectors.PA[0]);if(this.alpha=L.x,this.beta=L.y,B.isApprox(A,x.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const K=A.toAlphaBetaGammaToRef(f.TmpVectors.PA[0]);this.alpha=K.x,this.beta=K.y}else K=!0}if(isNaN(this._goalRadius)||(this.radius+=(G-this.radius)*T,Math.abs(G/this.radius-1)<x.c?(this._goalRadius=NaN,this.radius=G):K=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const A=f.TmpVectors.Vector2[0].set(p(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),p(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));f.Vector2.LerpToRef(this.targetScreenOffset,A,T,this.targetScreenOffset),f.Vector2.Distance(this.targetScreenOffset,A)<x.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.G(A)):K=!0}this._isInterpolating=K}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.PA.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const K=this.alpha;var A,T;this.alpha=function(K){let A=Math.PI/2;return 0===K.x&&0===K.z||(A=Math.acos(K.x/Math.sqrt(Math.pow(K.x,2)+Math.pow(K.z,2)))),K.z<0&&(A=2*Math.PI-A),A}(this._computationVector),this.beta=(A=this._computationVector.y,T=this.radius,Math.acos(A/T));const G=Math.round((K-this.alpha)/(2*Math.PI));this.alpha+=2*G*Math.PI,this._checkLimits()}setPosition(K){this._position.equals(K)||(this._position.G(K),this.rebuildAnglesAndRadius())}setTarget(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(G=this.overrideCloneAlphaBetaRadius??G,K.wf)A&&K.getBoundingInfo?this._targetBoundingCenter=K.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,K.wf(),this._targetHost=K,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const A=K,G=this._getTargetPosition();if(G&&!T&&G.equals(A))return;this._targetHost=null,this._target=A,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}G||this.rebuildAnglesAndRadius()}_getViewMatrix(){const K=Math.cos(this.alpha),A=Math.sin(this.alpha),T=Math.cos(this.beta);let G=Math.sin(this.beta);0===G&&(G=1e-4),0===this.radius&&(this.radius=1e-4);const B=this._getTargetPosition();if(this._computationVector.RO(this.radius*K*G,this.radius*T,this.radius*A*G),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.PA.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),B.addToRef(this._computationVector,this._newPosition),this.SK().collisionsEnabled&&this.checkCollisions){const K=this.SK().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,K.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.G(this._newPosition);let K=this.upVector;this.allowUpsideDown&&G<0&&(K=K.negate()),this._computeViewMatrix(this._position,B,K),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.G(B),this._viewMatrix}zoomOn(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K||this.SK().meshes;const T=Q.e.MinMax(K);let G=this._calculateLowerRadiusFromModelBoundingSphere(T.min,T.max);if(G=Math.max(Math.min(G,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=G*this.zoomOnFactor,this.mode===N.e.ORTHOGRAPHIC_CAMERA){const K=this.SK().getEngine().getAspectRatio(this),A=G*this.zoomOnFactor/2;this.orthoLeft=-A*K,this.orthoRight=A*K,this.orthoBottom=-A,this.orthoTop=A}this.focusOn({min:T.min,max:T.max,distance:G},A)}focusOn(K){let A,T,G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===K.min){const G=K||this.SK().meshes;A=Q.e.MinMax(G),T=f.PA.Distance(A.min,A.max)}else{A=K,T=K.distance}this._target=Q.e.Center(A),G||(this.maxZ=2*T)}createRigCamera(K,A){let T=0;switch(this.cameraRigMode){case N.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.e.RIG_MODE_VR:T=this._cameraRigParams.stereoHalfAngle*(0===A?1:-1);break;case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:T=this._cameraRigParams.stereoHalfAngle*(0===A?-1:1)}const G=new r(K,this.alpha+T,this.beta,this.radius,this._target,this.SK());return G._cameraRigParams={},G.isRigCamera=!0,G.rigParent=this,G.upVector=this.upVector,G.mode=this.mode,G.orthoLeft=this.orthoLeft,G.orthoRight=this.orthoRight,G.orthoBottom=this.orthoBottom,G.orthoTop=this.orthoTop,G}_updateRigCameras(){const K=this._rigCameras[0],A=this._rigCameras[1];switch(K.beta=A.beta=this.beta,this.cameraRigMode){case N.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.e.RIG_MODE_VR:K.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,A.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,A.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const G=f.PA.Distance(K,A),B=this.SK().getEngine().getAspectRatio(this),L=Math.tan(this.fov/2),O=L*B,C=.5*G*T,Q=C*Math.sqrt(1+1/(O*O)),Y=C*Math.sqrt(1+1/(L*L));return Math.max(Q,Y)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,G.c)([(0,B.B)()],r.prototype,"alpha",void 0),(0,G.c)([(0,B.B)()],r.prototype,"beta",void 0),(0,G.c)([(0,B.B)()],r.prototype,"radius",void 0),(0,G.c)([(0,B.B)()],r.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,G.c)([(0,B.A)("target")],r.prototype,"_target",void 0),(0,G.c)([(0,B.r)("targetHost")],r.prototype,"_targetHost",void 0),(0,G.c)([(0,B.B)()],r.prototype,"inertialAlphaOffset",void 0),(0,G.c)([(0,B.B)()],r.prototype,"inertialBetaOffset",void 0),(0,G.c)([(0,B.B)()],r.prototype,"inertialRadiusOffset",void 0),(0,G.c)([(0,B.B)()],r.prototype,"lowerAlphaLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"upperAlphaLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"lowerBetaLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"upperBetaLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"lowerRadiusLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"upperRadiusLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"lowerTargetYLimit",void 0),(0,G.c)([(0,B.B)()],r.prototype,"inertialPanningX",void 0),(0,G.c)([(0,B.B)()],r.prototype,"inertialPanningY",void 0),(0,G.c)([(0,B.B)()],r.prototype,"pinchToPanMaxDistance",void 0),(0,G.c)([(0,B.B)()],r.prototype,"panningDistanceLimit",void 0),(0,G.c)([(0,B.A)()],r.prototype,"panningOriginTarget",void 0),(0,G.c)([(0,B.B)()],r.prototype,"panningInertia",void 0),(0,G.c)([(0,B.B)()],r.prototype,"zoomToMouseLocation",null),(0,G.c)([(0,B.B)()],r.prototype,"zoomOnFactor",void 0),(0,G.c)([(0,B.x)()],r.prototype,"targetScreenOffset",void 0),(0,G.c)([(0,B.B)()],r.prototype,"allowUpsideDown",void 0),(0,G.c)([(0,B.B)()],r.prototype,"useInputToRestoreState",void 0),(0,G.c)([(0,B.B)()],r.prototype,"restoreStateInterpolationFactor",void 0),(0,e.c)("BABYLON.ArcRotateCamera",r)},14149:(K,A,T)=>{"use strict";T.d(A,{e:()=>f,h:()=>O});var G=T(12548),B=T(12733),L=T(13154),f={};class O{constructor(K){this.attachedToElement=!1,this.attached={},this.camera=K,this.checkInputs=()=>{}}add(K){const A=K.getSimpleName();this.attached[A]?G.d.Warn("camera input of type "+A+" already exists on camera"):(this.attached[A]=K,K.camera=this.camera,K.checkInputs&&(this.checkInputs=this._addCheckInputs(K.checkInputs.bind(K))),this.attachedToElement&&K.attachControl(this.noPreventDefault))}remove(K){for(const A in this.attached){const T=this.attached[A];if(T===K)return T.aZ(),T.camera=null,delete this.attached[A],void this.rebuildInputCheck()}}removeByType(K){for(const A in this.attached){const T=this.attached[A];T.getClassName()===K&&(T.aZ(),T.camera=null,delete this.attached[A],this.rebuildInputCheck())}}_addCheckInputs(K){const A=this.checkInputs;return()=>{A(),K()}}attachInput(K){this.attachedToElement&&K.attachControl(this.noPreventDefault)}attachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){K=!L.e.ForceAttachControlToAlwaysPreventDefault&&K,this.attachedToElement=!0,this.noPreventDefault=K;for(const A in this.attached)this.attached[A].attachControl(K)}}detachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const A in this.attached)this.attached[A].aZ(),K&&(this.attached[A].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const K in this.attached){const A=this.attached[K];A.checkInputs&&(this.checkInputs=this._addCheckInputs(A.checkInputs.bind(A)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(K){const A={};for(const T in this.attached){const K=this.attached[T],G=B.c.Serialize(K);A[K.getClassName()]=G}K.inputsmgr=A}parse(K){const A=K.inputsmgr;if(A){this.clear();for(const K in A){const T=f[K];if(T){const G=A[K],L=B.c.Parse((()=>new T),G,null);this.add(L)}}}else for(const T in this.attached){const A=f[this.attached[T].getClassName()];if(A){const G=B.c.Parse((()=>new A),K,null);this.remove(this.attached[T]),this.add(G)}}}}},14140:(K,A,T)=>{"use strict";T.d(A,{d:()=>z});var G=T(12683),B=T(12688),L=T(12700),f=T(13192),O=T(14149),C=T(12983),Q=T(12526);class Y{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(K){K=Q.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.SK(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((A=>{const T=A.event;if(!T.metaKey)if(A.type===C.c.KEYDOWN){if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),K||T.preventDefault()}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){const A=this._keys.indexOf(T.keyCode);A>=0&&this._keys.splice(A,1),K||T.preventDefault()}})))}aZ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let A=0;A<this._keys.length;A++){const T=this._keys[A],G=K._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(T)?K._localDirection.RO(-G,0,0):-1!==this.keysUp.indexOf(T)?K._localDirection.RO(0,0,G):-1!==this.keysRight.indexOf(T)?K._localDirection.RO(G,0,0):-1!==this.keysDown.indexOf(T)?K._localDirection.RO(0,0,-G):-1!==this.keysUpward.indexOf(T)?K._localDirection.RO(0,G,0):-1!==this.keysDownward.indexOf(T)?K._localDirection.RO(0,-G,0):-1!==this.keysRotateLeft.indexOf(T)?(K._localDirection.RO(0,0,0),K.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(T)?(K._localDirection.RO(0,0,0),K.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(T)?(K._localDirection.RO(0,0,0),K.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(T)&&(K._localDirection.RO(0,0,0),K.cameraRotation.x+=this._getLocalRotation()),K.SK().useRightHandedSystem&&(K._localDirection.z*=-1),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),L.PA.TransformNormalToRef(K._localDirection,K._cameraTransformMatrix,K._transformedDirection),K.cameraDirection.addInPlace(K._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const K=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*K}}(0,G.c)([(0,B.B)()],Y.prototype,"keysUp",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysUpward",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysDown",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysDownward",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysLeft",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysRight",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"rotationSpeed",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysRotateLeft",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysRotateRight",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysRotateUp",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"keysRotateDown",void 0),O.e.FreeCameraKeyboardMoveInput=Y;var Z=T(12534),x=T(12974);class J{constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=K,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Z.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(K){K=Q.Tools.BackCompatCameraNoPreventDefault(arguments);const A=this.camera.getEngine(),T=A.getInputElement();this._pointerInput||(this._pointerInput=G=>{const B=G.event,L="touch"===B.pointerType;if(!this.touchEnabled&&L)return;if(G.type!==x.e.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const f=B.target;if(G.type===x.e.POINTERDOWN){if(L&&-1!==this._activePointerId||!L&&-1!==this._currentActiveButton)return;this._activePointerId=B.pointerId;try{null===f||void 0===f||f.setPointerCapture(B.pointerId)}catch(O){}-1===this._currentActiveButton&&(this._currentActiveButton=B.button),this._previousPosition={x:B.clientX,y:B.clientY},K||(B.preventDefault(),T&&T.focus()),A.isPointerLock&&this._onMouseMove&&this._onMouseMove(G.event)}else if(G.type===x.e.POINTERUP){if(L&&this._activePointerId!==B.pointerId||!L&&this._currentActiveButton!==B.button)return;try{null===f||void 0===f||f.releasePointerCapture(B.pointerId)}catch(O){}this._currentActiveButton=-1,this._previousPosition=null,K||B.preventDefault(),this._activePointerId=-1}else if(G.type===x.e.POINTERMOVE&&(this._activePointerId===B.pointerId||!L))if(A.isPointerLock&&this._onMouseMove)this._onMouseMove(G.event);else if(this._previousPosition){const A=this.camera._calculateHandednessMultiplier(),T=(B.clientX-this._previousPosition.x)*A,G=B.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=T/this.angularSensibility,this.camera.cameraRotation.x+=G/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:T,offsetY:G}),this._previousPosition={x:B.clientX,y:B.clientY},K||B.preventDefault()}}),this._onMouseMove=T=>{if(!A.isPointerLock)return;const G=this.camera._calculateHandednessMultiplier(),B=T.movementX*G;this.camera.cameraRotation.y+=B/this.angularSensibility;const L=T.movementY;this.camera.cameraRotation.x+=L/this.angularSensibility,this._previousPosition=null,K||T.preventDefault()},this._observer=this.camera.SK()._inputManager._addCameraPointerObserver(this._pointerInput,x.e.POINTERDOWN|x.e.POINTERUP|x.e.POINTERMOVE),T&&(this._contextMenuBind=K=>this.onContextMenu(K),T.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(K){K.preventDefault()}aZ(){if(this._observer){if(this.camera.SK()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,G.c)([(0,B.B)()],J.prototype,"buttons",void 0),(0,G.c)([(0,B.B)()],J.prototype,"angularSensibility",void 0),O.e.FreeCameraMouseInput=J;var b,P=T(12989);class F{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Z.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(K){K=Q.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=A=>{if(A.type!==x.e.POINTERWHEEL)return;const T=A.event,G=T.deltaMode===P.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*G*T.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*G*T.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*G*T.deltaZ/this._normalize,T.preventDefault&&(K||T.preventDefault())},this._observer=this.camera.SK()._inputManager._addCameraPointerObserver(this._wheel,x.e.POINTERWHEEL)}aZ(){this._observer&&(this.camera.SK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,G.c)([(0,B.B)()],F.prototype,"wheelPrecisionX",void 0),(0,G.c)([(0,B.B)()],F.prototype,"wheelPrecisionY",void 0),(0,G.c)([(0,B.B)()],F.prototype,"wheelPrecisionZ",void 0),function(K){K[K.MoveRelative=0]="MoveRelative",K[K.RotateRelative=1]="RotateRelative",K[K.MoveScene=2]="MoveScene"}(b||(b={}));class d extends F{constructor(){super(...arguments),this._moveRelative=L.PA.Zero(),this._rotateRelative=L.PA.Zero(),this._moveScene=L.PA.Zero(),this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(K){null===K&&this._wheelXAction!==b.MoveRelative||(this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=K)}get wheelXMoveRelative(){return this._wheelXAction!==b.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(K){null===K&&this._wheelYAction!==b.MoveRelative||(this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=K)}get wheelYMoveRelative(){return this._wheelYAction!==b.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(K){null===K&&this._wheelZAction!==b.MoveRelative||(this._wheelZAction=b.MoveRelative,this._wheelZActionCoordinate=K)}get wheelZMoveRelative(){return this._wheelZAction!==b.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(K){null===K&&this._wheelXAction!==b.RotateRelative||(this._wheelXAction=b.RotateRelative,this._wheelXActionCoordinate=K)}get wheelXRotateRelative(){return this._wheelXAction!==b.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(K){null===K&&this._wheelYAction!==b.RotateRelative||(this._wheelYAction=b.RotateRelative,this._wheelYActionCoordinate=K)}get wheelYRotateRelative(){return this._wheelYAction!==b.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(K){null===K&&this._wheelZAction!==b.RotateRelative||(this._wheelZAction=b.RotateRelative,this._wheelZActionCoordinate=K)}get wheelZRotateRelative(){return this._wheelZAction!==b.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(K){null===K&&this._wheelXAction!==b.MoveScene||(this._wheelXAction=b.MoveScene,this._wheelXActionCoordinate=K)}get wheelXMoveScene(){return this._wheelXAction!==b.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(K){null===K&&this._wheelYAction!==b.MoveScene||(this._wheelYAction=b.MoveScene,this._wheelYActionCoordinate=K)}get wheelYMoveScene(){return this._wheelYAction!==b.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(K){null===K&&this._wheelZAction!==b.MoveScene||(this._wheelZAction=b.MoveScene,this._wheelZActionCoordinate=K)}get wheelZMoveScene(){return this._wheelZAction!==b.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.IO(0),this._rotateRelative.IO(0),this._moveScene.IO(0),this._updateCamera(),this.camera.SK().useRightHandedSystem&&(this._moveRelative.z*=-1);const K=L.Matrix.Zero();this.camera.getViewMatrix().invertToRef(K);const A=L.PA.Zero();L.PA.TransformNormalToRef(this._moveRelative,K,A),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(A),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(K,A,T){if(0===K)return;if(null===A||null===T)return;let G=null;switch(A){case b.MoveRelative:G=this._moveRelative;break;case b.RotateRelative:G=this._rotateRelative;break;case b.MoveScene:G=this._moveScene}switch(T){case 0:G.set(K,0,0);break;case 1:G.set(0,K,0);break;case 2:G.set(0,0,K)}}}(0,G.c)([(0,B.B)()],d.prototype,"wheelXMoveRelative",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelYMoveRelative",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelZMoveRelative",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelXRotateRelative",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelYRotateRelative",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelZRotateRelative",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelXMoveScene",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelYMoveScene",null),(0,G.c)([(0,B.B)()],d.prototype,"wheelZMoveScene",null),O.e.FreeCameraMouseWheelInput=d;class N{constructor(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=K,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Q.Tools.IsSafari()}attachControl(K){K=Q.Tools.BackCompatCameraNoPreventDefault(arguments);let A=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=T=>{const G=T.event,B="mouse"===G.pointerType||this._isSafari&&"undefined"===typeof G.pointerType;if(this.allowMouse||!B)if(T.type===x.e.POINTERDOWN){if(K||G.preventDefault(),this._pointerPressed.push(G.pointerId),1!==this._pointerPressed.length)return;A={x:G.clientX,y:G.clientY}}else if(T.type===x.e.POINTERUP){K||G.preventDefault();const T=this._pointerPressed.indexOf(G.pointerId);if(-1===T)return;if(this._pointerPressed.splice(T,1),0!=T)return;A=null,this._offsetX=null,this._offsetY=null}else if(T.type===x.e.POINTERMOVE){if(K||G.preventDefault(),!A)return;if(0!=this._pointerPressed.indexOf(G.pointerId))return;this._offsetX=G.clientX-A.x,this._offsetY=-(G.clientY-A.y)}}),this._observer=this.camera.SK()._inputManager._addCameraPointerObserver(this._pointerInput,x.e.POINTERDOWN|x.e.POINTERUP|x.e.POINTERMOVE),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.addEventListener("blur",this._onLostFocus)}}aZ(){if(this._pointerInput){if(this._observer&&(this.camera.SK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const K=this.camera,A=K._calculateHandednessMultiplier();K.cameraRotation.y=A*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)K.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const A=K._computeLocalCameraSpeed(),T=new L.PA(0,0,0!==this.touchMoveSensibility?A*this._offsetY/this.touchMoveSensibility:0);L.Matrix.RotationYawPitchRollToRef(K.rotation.y,K.rotation.x,0,K._cameraRotationMatrix),K.cameraDirection.addInPlace(L.PA.TransformCoordinates(T,K._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,G.c)([(0,B.B)()],N.prototype,"touchAngularSensibility",void 0),(0,G.c)([(0,B.B)()],N.prototype,"touchMoveSensibility",void 0),O.e.FreeCameraTouchInput=N;class D extends O.h{constructor(K){super(K),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Y),this}addMouse(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new J(K),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new d,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new N),this}clear(){super.clear(),this._mouseInput=null}}var mK=T(12651),U=T(12604);class z extends f.d{get angularSensibility(){const K=this.inputs.attached.mouse;return K?K.angularSensibility:0}set angularSensibility(K){const A=this.inputs.attached.mouse;A&&(A.angularSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const A=this.inputs.attached.keyboard;A&&(A.keysUp=K)}get keysUpward(){const K=this.inputs.attached.keyboard;return K?K.keysUpward:[]}set keysUpward(K){const A=this.inputs.attached.keyboard;A&&(A.keysUpward=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const A=this.inputs.attached.keyboard;A&&(A.keysDown=K)}get keysDownward(){const K=this.inputs.attached.keyboard;return K?K.keysDownward:[]}set keysDownward(K){const A=this.inputs.attached.keyboard;A&&(A.keysDownward=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const A=this.inputs.attached.keyboard;A&&(A.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const A=this.inputs.attached.keyboard;A&&(A.keysRight=K)}get keysRotateLeft(){const K=this.inputs.attached.keyboard;return K?K.keysRotateLeft:[]}set keysRotateLeft(K){const A=this.inputs.attached.keyboard;A&&(A.keysRotateLeft=K)}get keysRotateRight(){const K=this.inputs.attached.keyboard;return K?K.keysRotateRight:[]}set keysRotateRight(K){const A=this.inputs.attached.keyboard;A&&(A.keysRotateRight=K)}get keysRotateUp(){const K=this.inputs.attached.keyboard;return K?K.keysRotateUp:[]}set keysRotateUp(K){const A=this.inputs.attached.keyboard;A&&(A.keysRotateUp=K)}get keysRotateDown(){const K=this.inputs.attached.keyboard;return K?K.keysRotateDown:[]}set keysRotateDown(K){const A=this.inputs.attached.keyboard;A&&(A.keysRotateDown=K)}constructor(K,A,T){var G;super(K,A,T,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),G=this,this.ellipsoid=new L.PA(.5,1,.5),this.ellipsoidOffset=new L.PA(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=L.PA.Zero(),this._diffPosition=L.PA.Zero(),this._newPosition=L.PA.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G._newPosition.G(A),G._newPosition.subtractToRef(G._oldPosition,G._diffPosition),G._diffPosition.length()>U.c.CollisionsEpsilon&&(G.position.addToRef(G._diffPosition,G._deferredPositionUpdate),G._deferOnly?G._deferredUpdated=!0:G.position.G(G._deferredPositionUpdate),G.WJ&&T&&G.WJ(T))},this.inputs=new D(this),this.inputs.addKeyboard().addMouse()}attachControl(K,A){A=Q.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(A)}aZ(){this.inputs.detachElement(),this.cameraDirection=new L.PA(0,0,0),this.cameraRotation=new L.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(K){this._collisionMask=isNaN(K)?-1:K}_collideWithWorld(K){let A;A=this.parent?L.PA.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,A.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const T=this.SK().collisionCoordinator;this._collider||(this._collider=T.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let G=K;this.applyGravity&&(G=K.add(this.SK().gravity)),T.getNewPosition(this._oldPosition,G,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=L.PA.Zero(),this._transformedDirection=L.PA.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(K){this._needMoveForGravity=K}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.SK().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"vx"}}(0,G.c)([(0,B.A)()],z.prototype,"ellipsoid",void 0),(0,G.c)([(0,B.A)()],z.prototype,"ellipsoidOffset",void 0),(0,G.c)([(0,B.B)()],z.prototype,"checkCollisions",void 0),(0,G.c)([(0,B.B)()],z.prototype,"applyGravity",void 0),(0,mK.c)("BABYLON.FreeCamera",z)},14911:(K,A,T)=>{"use strict";T.d(A,{c:()=>L});var G=T(12786),B=T(14916);class L{constructor(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=T,this.bZ=[],this._maxBlockCapacity=A||64,this._selectionContent=new G.b(1024),this._creationFunc=K}update(K,A,T){B.c._CreateBlocks(K,A,T,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}UY(K){for(let A=0;A<this.hY.length;A++){this.hY[A].addEntry(K)}}mZ(K){for(let A=0;A<this.hY.length;A++){this.hY[A].removeEntry(K)}}select(K,A){this._selectionContent.reset();for(let T=0;T<this.hY.length;T++){this.hY[T].select(K,this._selectionContent,A)}return A?this._selectionContent.concat(this.bZ):this._selectionContent.concatWithNoDuplicate(this.bZ),this._selectionContent}intersects(K,A,T){this._selectionContent.reset();for(let G=0;G<this.hY.length;G++){this.hY[G].intersects(K,A,this._selectionContent,T)}return T?this._selectionContent.concat(this.bZ):this._selectionContent.concatWithNoDuplicate(this.bZ),this._selectionContent}intersectsRay(K){this._selectionContent.reset();for(let A=0;A<this.hY.length;A++){this.hY[A].intersectsRay(K,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bZ),this._selectionContent}}L.CreationFuncForMeshes=(K,A)=>{const T=K.getBoundingInfo();!K.isBlocked&&T.boundingBox.intersectsMinMax(A.mx,A.UZ)&&A.entries.push(K)},L.CreationFuncForSubMeshes=(K,A)=>{K.getBoundingInfo().boundingBox.intersectsMinMax(A.mx,A.UZ)&&A.entries.push(K)}},14916:(K,A,T)=>{"use strict";T.d(A,{c:()=>L});var G=T(12700),B=T(13030);class L{constructor(K,A,T,G,B,L){this.entries=[],this.zZ=new Array,this._capacity=T,this._depth=G,this._maxDepth=B,this._creationFunc=L,this._minPoint=K,this._maxPoint=A,this.zZ.push(K.clone()),this.zZ.push(A.clone()),this.zZ.push(K.clone()),this.zZ[2].x=A.x,this.zZ.push(K.clone()),this.zZ[3].y=A.y,this.zZ.push(K.clone()),this.zZ[4].z=A.z,this.zZ.push(A.clone()),this.zZ[5].z=K.z,this.zZ.push(A.clone()),this.zZ[6].x=K.x,this.zZ.push(A.clone()),this.zZ[7].y=K.y}get aO(){return this._capacity}get mx(){return this._minPoint}get UZ(){return this._maxPoint}addEntry(K){if(this.hY)for(let A=0;A<this.hY.length;A++){this.hY[A].addEntry(K)}else this._creationFunc(K,this),this.entries.length>this.aO&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(K){if(this.hY){for(let A=0;A<this.hY.length;A++){this.hY[A].removeEntry(K)}return}const A=this.entries.indexOf(K);A>-1&&this.entries.splice(A,1)}addEntries(K){for(let A=0;A<K.length;A++){const T=K[A];this.addEntry(T)}}select(K,A,T){if(B.e.IsInFrustum(this.zZ,K)){if(this.hY){for(let G=0;G<this.hY.length;G++){this.hY[G].select(K,A,T)}return}T?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersects(K,A,T,G){if(B.e.IntersectsSphere(this._minPoint,this._maxPoint,K,A)){if(this.hY){for(let B=0;B<this.hY.length;B++){this.hY[B].intersects(K,A,T,G)}return}G?T.concat(this.entries):T.concatWithNoDuplicate(this.entries)}}intersectsRay(K,A){if(K.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.hY){for(let T=0;T<this.hY.length;T++){this.hY[T].intersectsRay(K,A)}return}A.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){L._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(K,A,T,B,f,O,C,Q){C.hY=new Array;const Y=new G.PA((A.x-K.x)/2,(A.y-K.y)/2,(A.z-K.z)/2);for(let G=0;G<2;G++)for(let A=0;A<2;A++)for(let Z=0;Z<2;Z++){const x=K.add(Y.multiplyByFloats(G,A,Z)),J=K.add(Y.multiplyByFloats(G+1,A+1,Z+1)),b=new L(x,J,B,f+1,O,Q);b.addEntries(T),C.hY.push(b)}}}},14922:(K,A,T)=>{"use strict";T.d(A,{c:()=>Y});var G=T(12931),B=T(12700),L=T(13129),f=T(13938),O=T(12971),C=T(14911),Q=T(12565);G.c.prototype.createOrUpdateSelectionOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,T=this._getComponent(O.e.NAME_OCTREE);T||(T=new Y(this),this.o(T)),this.xZ||(this.xZ=new C.c(C.c.CreationFuncForMeshes,K,A));const G=this.getWorldExtends();return this.xZ.update(G.min,G.max,this.meshes),this.xZ},Object.defineProperty(G.c.prototype,"selectionOctree",{get:function(){return this.xZ},enumerable:!0,configurable:!0}),L.e.prototype.createOrUpdateSubmeshesOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const T=this.SK();let G=T._getComponent(O.e.NAME_OCTREE);G||(G=new Y(T),T.o(G)),this._submeshesOctree||(this._submeshesOctree=new C.c(C.c.CreationFuncForSubMeshes,K,A)),this.wf(!0);const B=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(B.minimumWorld,B.maximumWorld,this.hf),this._submeshesOctree};class Y{constructor(K){this.name=O.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new f.c(B.PA.Zero(),new B.PA(1,1,1)),(K=K||Q.b.LastCreatedScene)&&(this.dA=K,this.dA.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.dA.getActiveSubMeshCandidates=K=>this.getActiveSubMeshCandidates(K),this.dA.getCollidingSubMeshCandidates=(K,A)=>this.getCollidingSubMeshCandidates(K,A),this.dA.getIntersectingSubMeshCandidates=(K,A)=>this.getIntersectingSubMeshCandidates(K,A))}register(){this.dA.onMeshRemovedObservable.add((K=>{const A=this.dA.selectionOctree;if(void 0!==A&&null!==A){const T=A.bZ.indexOf(K);-1!==T&&A.bZ.splice(T,1)}})),this.dA.onMeshImportedObservable.add((K=>{const A=this.dA.selectionOctree;void 0!==A&&null!==A&&A.UY(K)}))}getActiveMeshCandidates(){var K;return(null===(K=this.dA.xZ)||void 0===K?void 0:K.select(this.dA.frustumPlanes))||this.dA._getDefaultMeshCandidates()}getActiveSubMeshCandidates(K){if(K._submeshesOctree&&K.useOctreeForRenderingSelection){return K._submeshesOctree.select(this.dA.frustumPlanes)}return this.dA._getDefaultSubMeshCandidates(K)}getIntersectingSubMeshCandidates(K,A){if(K._submeshesOctree&&K.useOctreeForPicking){f.c.TransformToRef(A,K.getWorldMatrix(),this._tempRay);return K._submeshesOctree.intersectsRay(this._tempRay)}return this.dA._getDefaultSubMeshCandidates(K)}getCollidingSubMeshCandidates(K,A){if(K._submeshesOctree&&K.useOctreeForCollisions){const T=A._velocityWorldLength+Math.max(A._radius.x,A._radius.y,A._radius.z);return K._submeshesOctree.intersects(A._basePointWorld,T)}return this.dA._getDefaultSubMeshCandidates(K)}rebuild(){}dispose(){}}},13938:(K,A,T)=>{"use strict";T.d(A,{c:()=>J});var G=T(12931),B=T(13154),L=T(12706),f=T(12700),O=T(12714),C=T(13023),Q=T(12962),Y=T(12565),Z=T(12991);const x={internalPickerForMesh:void 0};class J{constructor(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.c;this.origin=K,this.direction=A,this.length=T,this.epsilon=G}clone(){return new J(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const G=J._TmpVector3[0].RO(K.x-T,K.y-T,K.z-T),B=J._TmpVector3[1].RO(A.x+T,A.y+T,A.z+T);let L,f,O,C,Q=0,Y=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<G.x||this.origin.x>B.x)return!1}else if(L=1/this.direction.x,f=(G.x-this.origin.x)*L,O=(B.x-this.origin.x)*L,O===-1/0&&(O=1/0),f>O&&(C=f,f=O,O=C),Q=Math.max(f,Q),Y=Math.min(O,Y),Q>Y)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<G.y||this.origin.y>B.y)return!1}else if(L=1/this.direction.y,f=(G.y-this.origin.y)*L,O=(B.y-this.origin.y)*L,O===-1/0&&(O=1/0),f>O&&(C=f,f=O,O=C),Q=Math.max(f,Q),Y=Math.min(O,Y),Q>Y)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<G.z||this.origin.z>B.z)return!1}else if(L=1/this.direction.z,f=(G.z-this.origin.z)*L,O=(B.z-this.origin.z)*L,O===-1/0&&(O=1/0),f>O&&(C=f,f=O,O=C),Q=Math.max(f,Q),Y=Math.min(O,Y),Q>Y)return!1;return!0}intersectsBox(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(K.minimum,K.maximum,A)}intersectsSphere(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=K.center.x-this.origin.x,G=K.center.y-this.origin.y,B=K.center.z-this.origin.z,L=T*T+G*G+B*B,f=K.radius+A,O=f*f;if(L<=O)return!0;const C=T*this.direction.x+G*this.direction.y+B*this.direction.z;if(C<0)return!1;return L-C*C<=O}intersectsTriangle(K,A,T){const G=J._TmpVector3[0],B=J._TmpVector3[1],L=J._TmpVector3[2],O=J._TmpVector3[3],Q=J._TmpVector3[4];A.subtractToRef(K,G),T.subtractToRef(K,B),f.PA.CrossToRef(this.direction,B,L);const Y=f.PA.Dot(G,L);if(0===Y)return null;const Z=1/Y;this.origin.subtractToRef(K,O);const x=f.PA.Dot(O,L)*Z;if(x<-this.epsilon||x>1+this.epsilon)return null;f.PA.CrossToRef(O,G,Q);const b=f.PA.Dot(this.direction,Q)*Z;if(b<-this.epsilon||x+b>1+this.epsilon)return null;const P=f.PA.Dot(B,Q)*Z;return P>this.length?null:new C.b(1-x-b,x,P)}intersectsPlane(K){let A;const T=f.PA.Dot(K.normal,this.direction);if(Math.abs(T)<9.99999997475243e-7)return null;{const G=f.PA.Dot(K.normal,this.origin);return A=(-K.d-G)/T,A<0?A<-9.99999997475243e-7?null:0:A}}intersectsAxis(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(K){case"y":{const K=(this.origin.y-A)/this.direction.y;return K>0?null:new f.PA(this.origin.x+this.direction.x*-K,A,this.origin.z+this.direction.z*-K)}case"x":{const K=(this.origin.x-A)/this.direction.x;return K>0?null:new f.PA(A,this.origin.y+this.direction.y*-K,this.origin.z+this.direction.z*-K)}case"z":{const K=(this.origin.z-A)/this.direction.z;return K>0?null:new f.PA(this.origin.x+this.direction.x*-K,this.origin.y+this.direction.y*-K,A)}default:return null}}intersectsMesh(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=f.TmpVectors.Matrix[0];return K.getWorldMatrix().invertToRef(O),this._tmpRay?J.TransformToRef(this,O,this._tmpRay):this._tmpRay=J.Transform(this,O),K.intersects(this._tmpRay,A,T,G,B,L)}intersectsMeshes(K,A,T){T?T.length=0:T=[];for(let G=0;G<K.length;G++){const B=this.intersectsMesh(K[G],A);B.hit&&T.push(B)}return T.sort(this._comparePickingInfo),T}_comparePickingInfo(K,A){return K.distance<A.distance?-1:K.distance>A.distance?1:0}intersectionSegment(K,A,T){const G=this.origin,B=f.TmpVectors.PA[0],L=f.TmpVectors.PA[1],O=f.TmpVectors.PA[2],C=f.TmpVectors.PA[3];A.subtractToRef(K,B),this.direction.scaleToRef(J._Rayl,O),G.addToRef(O,L),K.subtractToRef(G,C);const Q=f.PA.Dot(B,B),Y=f.PA.Dot(B,O),Z=f.PA.Dot(O,O),x=f.PA.Dot(B,C),b=f.PA.Dot(O,C),P=Q*Z-Y*Y;let F,d,N=P,D=P;P<J._Smallnum?(F=0,N=1,d=b,D=Z):(F=Y*b-Z*x,d=Q*b-Y*x,F<0?(F=0,d=b,D=Z):F>N&&(F=N,d=b+Y,D=Z)),d<0?(d=0,-x<0?F=0:-x>Q?F=N:(F=-x,N=Q)):d>D&&(d=D,-x+Y<0?F=0:-x+Y>Q?F=N:(F=-x+Y,N=Q));const mK=Math.abs(F)<J._Smallnum?0:F/N,U=Math.abs(d)<J._Smallnum?0:d/D,z=f.TmpVectors.PA[4];O.scaleToRef(U,z);const g=f.TmpVectors.PA[5];B.scaleToRef(mK,g),g.addInPlace(C);const S=f.TmpVectors.PA[6];g.subtractToRef(z,S);return U>0&&U<=this.length&&S.lengthSquared()<T*T?g.length():-1}update(K,A,T,G,B,L,O){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){J._RayDistant||(J._RayDistant=J.Zero()),J._RayDistant.unprojectRayToRef(K,A,T,G,f.Matrix.IdentityReadOnly,L,O);const C=f.TmpVectors.Matrix[0];B.invertToRef(C),J.TransformToRef(J._RayDistant,C,this)}else this.unprojectRayToRef(K,A,T,G,B,L,O);return this}static Zero(){return new J(f.PA.Zero(),f.PA.Zero())}static CreateNew(K,A,T,G,B,L,f){return J.Zero().update(K,A,T,G,B,L,f)}static CreateNewFromTo(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.Matrix.IdentityReadOnly;const G=new J(new f.PA(0,0,0),new f.PA(0,0,0));return J.CreateFromToToRef(K,A,G,T)}static CreateFromToToRef(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.Matrix.IdentityReadOnly;T.origin.G(K);const B=A.subtractToRef(K,T.direction),L=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);return T.length=L,T.direction.normalize(),J.TransformToRef(T,G,T)}static Transform(K,A){const T=new J(new f.PA(0,0,0),new f.PA(0,0,0));return J.TransformToRef(K,A,T),T}static TransformToRef(K,A,T){f.PA.TransformCoordinatesToRef(K.origin,A,T.origin),f.PA.TransformNormalToRef(K.direction,A,T.direction),T.length=K.length,T.epsilon=K.epsilon;const G=T.direction,B=G.length();if(0!==B&&1!==B){const K=1/B;G.x*=K,G.y*=K,G.z*=K,T.length*=B}return T}unprojectRayToRef(K,A,T,G,B,L,O){const C=f.TmpVectors.Matrix[0];B.multiplyToRef(L,C),C.multiplyToRef(O,C),C.invert();const Q=Y.b.LastCreatedEngine,Z=f.TmpVectors.PA[0];Z.x=K/T*2-1,Z.y=-(A/G*2-1),Z.z=null!==Q&&void 0!==Q&&Q.Zf?1:null!==Q&&void 0!==Q&&Q.isNDCHalfZRange?0:-1;const x=f.TmpVectors.PA[1].RO(Z.x,Z.y,1-1e-8),J=f.TmpVectors.PA[2],b=f.TmpVectors.PA[3];f.PA._UnprojectFromInvertedMatrixToRef(Z,C,J),f.PA._UnprojectFromInvertedMatrixToRef(x,C,b),this.origin.G(J),b.subtractToRef(J,this.direction),this.direction.normalize()}}function b(K,A,T,G,B){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=J.Zero();return P(K,A,T,G,f,B,L),f}function P(K,A,T,G,B,L){let O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Q=K.getEngine();if(!L&&!(L=K.activeCamera))return K;const Y=L.viewport,Z=Q.getRenderHeight(),{x:x,y:J,width:b,height:P}=Y.toGlobal(Q.getRenderWidth(),Z),F=1/Q.getHardwareScalingLevel();return A=A*F-x,T=T*F-(Z-J-P),B.update(A,T,b,P,G||f.Matrix.IdentityReadOnly,O?f.Matrix.IdentityReadOnly:L.getViewMatrix(),L.getProjectionMatrix(),C),K}function F(K,A,T,G,B){if(!Q.d)return K;const L=K.getEngine();if(!B&&!(B=K.activeCamera))throw new Error("Active camera not set");const O=B.viewport,C=L.getRenderHeight(),{x:Y,y:Z,width:x,height:J}=O.toGlobal(L.getRenderWidth(),C),b=f.Matrix.Identity(),P=1/L.getHardwareScalingLevel();return A=A*P-Y,T=T*P-(C-Z-J),G.update(A,T,x,J,b,b,B.getProjectionMatrix()),K}function d(K,A,T,G,B,L,f,O){const C=A(G,T.enableDistantPicking),Q=T.intersects(C,B,f,L,G,O);return Q&&Q.hit?!B&&null!=K&&Q.distance>=K.distance?null:Q:null}function N(K,A,T,G,B,L){let O=null;const C=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),Y=K.cameraToUseForPointers||K.activeCamera,Z=x.internalPickerForMesh||d;for(let Q=0;Q<K.meshes.length;Q++){const x=K.meshes[Q];if(T){if(!T(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.GQ)continue;const J=C&&x.isWorldMatrixCameraDependent(),b=x.wf(J,Y);if(x.hasThinInstances&&x.jQ){const K=Z(O,A,x,b,!0,!0,L);if(K){if(B)return K;const C=f.TmpVectors.Matrix[1],Q=x.thinInstanceGetWorldMatrices();for(let K=0;K<Q.length;K++){if(T&&!T(x,K))continue;Q[K].multiplyToRef(b,C);const f=Z(O,A,x,C,G,B,L,!0);if(f&&(O=f,O.thinInstanceIndex=K,G))return O}}}else{const K=Z(O,A,x,b,G,B,L);if(K&&(O=K,G))return O}}return O||new Q.d}function D(K,A,T,G){if(!Q.d)return null;const B=[],L=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),O=K.cameraToUseForPointers||K.activeCamera,C=x.internalPickerForMesh||d;for(let Q=0;Q<K.meshes.length;Q++){const Y=K.meshes[Q];if(T){if(!T(Y,-1))continue}else if(!Y.isEnabled()||!Y.isVisible||!Y.GQ)continue;const Z=L&&Y.isWorldMatrixCameraDependent(),x=Y.wf(Z,O);if(Y.hasThinInstances&&Y.jQ){if(C(null,A,Y,x,!0,!0,G)){const K=f.TmpVectors.Matrix[1],L=Y.thinInstanceGetWorldMatrices();for(let f=0;f<L.length;f++){if(T&&!T(Y,f))continue;L[f].multiplyToRef(x,K);const O=C(null,A,Y,K,!1,!1,G,!0);O&&(O.thinInstanceIndex=f,B.push(O))}}}else{const K=C(null,A,Y,x,!1,!1,G);K&&B.push(K)}}return B}function mK(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,G=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;G||(G=K.getWorldMatrix()),A.length=T,B?A.origin.G(B):A.origin.G(K.position);const L=f.TmpVectors.PA[2];L.set(0,0,K._scene.useRightHandedSystem?-1:1);const O=f.TmpVectors.PA[3];return f.PA.TransformNormalToRef(L,G,O),f.PA.NormalizeToRef(O,A.direction),A}var U,z;J._TmpVector3=(0,O.b)(6,f.PA.Zero),J._RayDistant=J.Zero(),J._Smallnum=1e-8,J._Rayl=1e9,U=G.c,(z=B.e)&&(z.prototype.getForwardRay=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,A=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;return mK(this,new J(f.PA.Zero(),f.PA.Zero(),K),K,A,T)},z.prototype.getForwardRayToRef=function(K){return mK(this,K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),U&&(Z.d._IsPickingAvailable=!0,U.prototype.createPickingRay=function(K,A,T,G){return b(this,K,A,T,G,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),G.c.prototype.createPickingRayToRef=function(K,A,T,G,B){return P(this,K,A,T,G,B,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},G.c.prototype.createPickingRayInCameraSpace=function(K,A,T){return function(K,A,T,G){const B=J.Zero();return F(K,A,T,B,G),B}(this,K,A,T)},G.c.prototype.createPickingRayInCameraSpaceToRef=function(K,A,T,G){return F(this,K,A,T,G)},G.c.prototype.pickWithBoundingInfo=function(K,A,T,G,B){return function(K,A,T,G,B,L){if(!Q.d)return null;const O=N(K,(G=>(K._tempPickingRay||(K._tempPickingRay=J.Zero()),P(K,A,T,G,K._tempPickingRay,L||null),K._tempPickingRay)),G,B,!0);return O&&(O.ray=b(K,A,T,f.Matrix.Identity(),L||null)),O}(this,K,A,T,G,B)},G.c.prototype.JT=function(K,A,T,G,B,L){return function(K,A,T,G,B,L,O){const C=N(K,((G,B)=>(K._tempPickingRay||(K._tempPickingRay=J.Zero()),P(K,A,T,G,K._tempPickingRay,L||null,!1,B),K._tempPickingRay)),G,B,!1,O);return C&&(C.ray=b(K,A,T,f.Matrix.Identity(),L||null)),C}(this,K,A,T,G,B,L)},G.c.prototype.pickWithRay=function(K,A,T,G){return function(K,A,T,G,B){const L=N(K,(T=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=f.Matrix.Identity()),T.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=J.Zero()),J.TransformToRef(A,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),T,G,!1,B);return L&&(L.ray=A),L}(this,K,A,T,G)},G.c.prototype.multiPick=function(K,A,T,G,B){return function(K,A,T,G,B,L){return D(K,(G=>b(K,A,T,G,B||null)),G,L)}(this,K,A,T,G,B)},G.c.prototype.multiPickWithRay=function(K,A,T){return function(K,A,T,G){return D(K,(T=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=f.Matrix.Identity()),T.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=J.Zero()),J.TransformToRef(A,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),T,G)}(this,K,A,T)}},14192:(K,A,T)=>{"use strict";var G=T(12637),B=T(12548),L=T(12571),f=T(12653),O=T(12604),C=T(12642);O.c.prototype._partialLoadFile=function(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(K,(K=>{T[A]=K,T._internalCount++,6===T._internalCount&&G(T)}),void 0,void 0,!0,((K,A)=>{B&&K&&B(K.status+" "+K.statusText,A)}))},O.c.prototype._cascadeLoadFiles=function(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=[];B._internalCount=0;for(let L=0;L<6;L++)this._partialLoadFile(T[L],L,B,A,G)},O.c.prototype._cascadeLoadImgs=function(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5?arguments[5]:void 0;const f=[];f._internalCount=0;for(let O=0;O<6;O++)this._partialLoadImg(G[O],O,f,K,A,T,B,L)},O.c.prototype._partialLoadImg=function(K,A,T,G,B,O){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7?arguments[7]:void 0;const Y=(0,f.d)();(0,L.u)(K,(K=>{T[A]=K,T._internalCount++,G&&G.removePendingData(Y),6===T._internalCount&&O&&O(B,T)}),((K,A)=>{G&&G.removePendingData(Y),C&&C(K,A)}),G?G.offlineProvider:null,Q),G&&G.addPendingData(Y)},O.c.prototype.createCubeTextureBase=function(K,A,T,L){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,F=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,d=arguments.length>14&&void 0!==arguments[14]&&arguments[14],N=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const D=b||new G.b(this,7);D.isCube=!0,D.url=K,D.generateMipMaps=!L,D._lodGenerationScale=x,D._lodGenerationOffset=J,D._useSRGBBuffer=!!d&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!L),D!==b&&(D.label=K.substring(0,60)),this._doNotHandleContextLost||(D._extension=Y,D._files=T,D._buffer=N);const mK=K;this._transformTextureUrl&&!b&&(K=this._transformTextureUrl(K));const U=Y??function(K){const A=K.split("?")[0],T=A.lastIndexOf(".");return T>-1?A.substring(T).toLowerCase():""}(K),z=(0,C.b)(U),g=(K,A)=>{D.dispose(),O?O(K,A):K&&B.d.Warn(K)},S=(G,O)=>{K===mK?G&&g(G.status+" "+G.statusText,O):(B.d.Warn(`Failed to load ${K}, falling back to the ${mK}`),this.createCubeTextureBase(mK,A,T,!!L,f,g,Q,Y,Z,x,J,D,P,F,d,N))};if(z)z.then((G=>{const B=K=>{P&&P(D,K),G.loadCubeData(K,D,Z,f,((K,A)=>{g(K,A)}))};N?B(N):T&&6===T.length?G.supportCascades?this._cascadeLoadFiles(A,(K=>B(K.map((K=>new Uint8Array(K))))),T,g):g("Textures type does not support cascades."):this._loadFile(K,(K=>B(new Uint8Array(K))),void 0,void 0,!0,S)}));else{if(!T||0===T.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(A,D,((K,A)=>{F&&F(K,A)}),T,g)}return this._internalTexturesCache.push(D),D}},14924:(K,A,T)=>{"use strict";T(12548);var G=T(12826);T(12637),T(12774),T(12629),T(12870),T(12834);G.c},14229:(K,A,T)=>{"use strict";T.d(A,{e:()=>B});var G=T(12651);class B{constructor(K){this.value=this._toInt(K)}_toInt(K){return 0|K}add(K){return new B(this.value+K.value)}FA(K){return new B(this.value-K.value)}multiply(K){return new B(Math.imul(this.value,K.value))}divide(K){return new B(this.value/K.value)}getClassName(){return B.ClassName}equals(K){return this.value===K.value}static FromValue(K){return new B(K)}toString(){return this.value.toString()}}B.ClassName="FlowGraphInteger",(0,G.c)("FlowGraphInteger",B)},14245:(K,A,T)=>{"use strict";T.d(A,{e:()=>B,i:()=>L});var G=T(12700);class B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.zf=K}get m(){return this.zf}transformVector(K){return this.transformVectorToRef(K,new G.Vector2)}transformVectorToRef(K,A){return A.x=K.x*this.zf[0]+K.y*this.zf[1],A.y=K.x*this.zf[2]+K.y*this.zf[3],A}kf(){return this.toArray()}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let A=0;A<4;A++)K[A]=this.zf[A];return K}bT(K){for(let A=0;A<4;A++)this.zf[A]=K[A];return this}multiplyToRef(K,A){const T=K.zf,G=this.zf,B=A.zf;return B[0]=T[0]*G[0]+T[1]*G[2],B[1]=T[0]*G[1]+T[1]*G[3],B[2]=T[2]*G[0]+T[3]*G[2],B[3]=T[2]*G[1]+T[3]*G[3],A}multiply(K){return this.multiplyToRef(K,new B)}divideToRef(K,A){const T=this.zf,G=K.zf,B=A.zf;return B[0]=T[0]/G[0],B[1]=T[1]/G[1],B[2]=T[2]/G[2],B[3]=T[3]/G[3],A}divide(K){return this.divideToRef(K,new B)}addToRef(K,A){const T=this.zf,G=K.m,B=A.m;return B[0]=T[0]+G[0],B[1]=T[1]+G[1],B[2]=T[2]+G[2],B[3]=T[3]+G[3],A}add(K){return this.addToRef(K,new B)}subtractToRef(K,A){const T=this.zf,G=K.m,B=A.m;return B[0]=T[0]-G[0],B[1]=T[1]-G[1],B[2]=T[2]-G[2],B[3]=T[3]-G[3],A}FA(K){return this.subtractToRef(K,new B)}transpose(){const K=this.zf;return new B([K[0],K[2],K[1],K[3]])}determinant(){const K=this.zf;return K[0]*K[3]-K[1]*K[2]}inverse(){const K=this.determinant();if(0===K)throw new Error("Matrix is not invertible");const A=this.zf,T=1/K;return new B([A[3]*T,-A[1]*T,-A[2]*T,A[0]*T])}equals(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.zf,G=K.m;return 0===A?T[0]===G[0]&&T[1]===G[1]&&T[2]===G[2]&&T[3]===G[3]:Math.abs(T[0]-G[0])<A&&Math.abs(T[1]-G[1])<A&&Math.abs(T[2]-G[2])<A&&Math.abs(T[3]-G[3])<A}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.zf.join(", ")})`}}class L{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.zf=K}get m(){return this.zf}transformVector(K){return this.transformVectorToRef(K,new G.PA)}transformVectorToRef(K,A){const T=this.zf;return A.x=K.x*T[0]+K.y*T[1]+K.z*T[2],A.y=K.x*T[3]+K.y*T[4]+K.z*T[5],A.z=K.x*T[6]+K.y*T[7]+K.z*T[8],A}multiplyToRef(K,A){const T=K.zf,G=this.zf,B=A.m;return B[0]=T[0]*G[0]+T[1]*G[3]+T[2]*G[6],B[1]=T[0]*G[1]+T[1]*G[4]+T[2]*G[7],B[2]=T[0]*G[2]+T[1]*G[5]+T[2]*G[8],B[3]=T[3]*G[0]+T[4]*G[3]+T[5]*G[6],B[4]=T[3]*G[1]+T[4]*G[4]+T[5]*G[7],B[5]=T[3]*G[2]+T[4]*G[5]+T[5]*G[8],B[6]=T[6]*G[0]+T[7]*G[3]+T[8]*G[6],B[7]=T[6]*G[1]+T[7]*G[4]+T[8]*G[7],B[8]=T[6]*G[2]+T[7]*G[5]+T[8]*G[8],A}multiply(K){return this.multiplyToRef(K,new L)}divideToRef(K,A){const T=this.zf,G=K.m,B=A.m;return B[0]=T[0]/G[0],B[1]=T[1]/G[1],B[2]=T[2]/G[2],B[3]=T[3]/G[3],B[4]=T[4]/G[4],B[5]=T[5]/G[5],B[6]=T[6]/G[6],B[7]=T[7]/G[7],B[8]=T[8]/G[8],A}divide(K){return this.divideToRef(K,new L)}addToRef(K,A){const T=this.zf,G=K.m,B=A.m;return B[0]=T[0]+G[0],B[1]=T[1]+G[1],B[2]=T[2]+G[2],B[3]=T[3]+G[3],B[4]=T[4]+G[4],B[5]=T[5]+G[5],B[6]=T[6]+G[6],B[7]=T[7]+G[7],B[8]=T[8]+G[8],A}add(K){return this.addToRef(K,new L)}subtractToRef(K,A){const T=this.zf,G=K.m,B=A.m;return B[0]=T[0]-G[0],B[1]=T[1]-G[1],B[2]=T[2]-G[2],B[3]=T[3]-G[3],B[4]=T[4]-G[4],B[5]=T[5]-G[5],B[6]=T[6]-G[6],B[7]=T[7]-G[7],B[8]=T[8]-G[8],A}FA(K){return this.subtractToRef(K,new L)}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let A=0;A<9;A++)K[A]=this.zf[A];return K}kf(){return this.toArray()}bT(K){for(let A=0;A<9;A++)this.zf[A]=K[A];return this}transpose(){const K=this.zf;return new L([K[0],K[3],K[6],K[1],K[4],K[7],K[2],K[5],K[8]])}determinant(){const K=this.zf;return K[0]*(K[4]*K[8]-K[5]*K[7])-K[1]*(K[3]*K[8]-K[5]*K[6])+K[2]*(K[3]*K[7]-K[4]*K[6])}inverse(){const K=this.determinant();if(0===K)throw new Error("Matrix is not invertible");const A=this.zf,T=1/K;return new L([(A[4]*A[8]-A[5]*A[7])*T,(A[2]*A[7]-A[1]*A[8])*T,(A[1]*A[5]-A[2]*A[4])*T,(A[5]*A[6]-A[3]*A[8])*T,(A[0]*A[8]-A[2]*A[6])*T,(A[2]*A[3]-A[0]*A[5])*T,(A[3]*A[7]-A[4]*A[6])*T,(A[1]*A[6]-A[0]*A[7])*T,(A[0]*A[4]-A[1]*A[3])*T])}equals(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.zf,G=K.m;return 0===A?T[0]===G[0]&&T[1]===G[1]&&T[2]===G[2]&&T[3]===G[3]&&T[4]===G[4]&&T[5]===G[5]&&T[6]===G[6]&&T[7]===G[7]&&T[8]===G[8]:Math.abs(T[0]-G[0])<A&&Math.abs(T[1]-G[1])<A&&Math.abs(T[2]-G[2])<A&&Math.abs(T[3]-G[3])<A&&Math.abs(T[4]-G[4])<A&&Math.abs(T[5]-G[5])<A&&Math.abs(T[6]-G[6])<A&&Math.abs(T[7]-G[7])<A&&Math.abs(T[8]-G[8])<A}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.zf.join(", ")})`}}},14253:(K,A,T)=>{"use strict";var G;function B(K,A,T,G){switch(A){case"Animation":return G?K.animations.find((K=>K.uniqueId===T))??null:K.animations[T]??null;case"AnimationGroup":return G?K.animationGroups.find((K=>K.uniqueId===T))??null:K.animationGroups[T]??null;case"Mesh":return G?K.meshes.find((K=>K.uniqueId===T))??null:K.meshes[T]??null;case"Material":return G?K.materials.find((K=>K.uniqueId===T))??null:K.materials[T]??null;case"HY":return G?K.cameras.find((K=>K.uniqueId===T))??null:K.cameras[T]??null;case"Light":return G?K.lights.find((K=>K.uniqueId===T))??null:K.lights[T]??null;default:return null}}T.d(A,{d:()=>B}),function(K){K.Animation="Animation",K.AnimationGroup="AnimationGroup",K.Mesh="Mesh",K.Material="Material",K.HY="HY",K.Light="Light"}(G||(G={}))},14288:(K,A,T)=>{"use strict";T.d(A,{e:()=>B});var G=T(14295);class B extends G.d{constructor(K,A){if(super(K),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),A)for(const T of A)this._eventsSignalOutputs[T]=this._registerSignalOutput(T+"Event")}_executeOnTick(K){}_startPendingTasks(K){K._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(K),this._resetAfterCanceled(K)),this._preparePendingTasks(K),K._addPendingBlock(this),this.out._activateSignal(K),K._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(K){K._deleteExecutionVariable(this,"_initialized"),K._removePendingBlock(this)}}},14262:(K,A,T)=>{"use strict";T.d(A,{e:()=>Q});var G=T(12653),B=T(12651),L=T(14271),f=T(12534),O=T(14223);class C extends L.b{constructor(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:G.defaultValue,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(K,A,T),this.richType=G,this._defaultValue=B,this._optional=L,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new f.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(K){this._isDisabled!==K&&(this._isDisabled=K,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(K,A){A._getConnectionValue(this)!==K&&(A._setConnectionValue(this,K),this.onValueChangedObservable.notifyObservers(K))}resetToDefaultValue(K){K._setConnectionValue(this,this._defaultValue)}connectTo(K){this._isDisabled||super.connectTo(K)}_getValueOrDefault(K){const A=K._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(A):A}getValue(K){if(1===this.connectionType){K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(K);const A=this._getValueOrDefault(K);return this._lastValue=A,this.richType.typeTransformer?this.richType.typeTransformer(A):A}const A=this.isConnected()?this._connectedPoint[0].getValue(K):this._getValueOrDefault(K);return this._lastValue=A,this.richType.typeTransformer?this.richType.typeTransformer(A):A}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.richType={},this.richType.serialize(K.richType),K.optional=this._optional,(0,O.h)("defaultValue",this._defaultValue,K)}}(0,B.c)("FlowGraphDataConnection",C);class Q{constructor(K){var A;this.config=K,this.uniqueId=(0,G.d)(),this.name=(null===(A=this.config)||void 0===A?void 0:A.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(K){}registerDataInput(K,A,T){const G=new C(K,0,this,A,T);return this.dataInputs.push(G),G}registerDataOutput(K,A,T){const G=new C(K,1,this,A,T);return this.dataOutputs.push(G),G}getDataInput(K){return this.dataInputs.find((A=>A.name===K))}getDataOutput(K){return this.dataOutputs.find((A=>A.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.h;if(K.uniqueId=this.uniqueId,K.config={},this.config){const T=this.config,G=Object.keys(T);for(const B of G)A(B,T[B],K.config)}K.dataInputs=[],K.dataOutputs=[],K.className=this.getClassName();for(const T of this.dataInputs){const A={};T.serialize(A),K.dataInputs.push(A)}for(const T of this.dataOutputs){const A={};T.serialize(A),K.dataOutputs.push(A)}}deserialize(K){}_log(K,A,T){var G;null===(G=K.logger)||void 0===G||G.addLogItem({action:A,PT:T,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14271:(K,A,T)=>{"use strict";T.d(A,{b:()=>L});var G,B=T(12653);!function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(G||(G={}));class L{constructor(K,A,T){this._ownerBlock=T,this._connectedPoint=[],this.uniqueId=(0,B.d)(),this.connectedPointIds=[],this.name=K,this._connectionType=A}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(K){if(this._connectionType===K._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||K._isSingularConnection()&&K._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(K),K._connectedPoint.push(this)}disconnectFrom(K){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const T=this._connectedPoint.indexOf(K),G=K._connectedPoint.indexOf(this);-1!==T&&-1!==G&&(A&&this._connectedPoint.splice(T,1),K._connectedPoint.splice(G,1))}disconnectFromAll(){for(const K of this._connectedPoint)this.disconnectFrom(K,!1);this._connectedPoint.length=0}dispose(){for(const K of this._connectedPoint)this.disconnectFrom(K)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.name=this.name,K._connectionType=this._connectionType,K.connectedPointIds=[],K.className=this.getClassName();for(const A of this._connectedPoint)K.connectedPointIds.push(A.uniqueId)}getClassName(){return"FGConnection"}deserialize(K){this.uniqueId=K.uniqueId,this.name=K.name,this._connectionType=K._connectionType,this.connectedPointIds=K.connectedPointIds}}},14215:(K,A,T)=>{"use strict";T.d(A,{c:()=>D});var G,B=T(12534),L=T(12683),f=T(12688),O=T(12653),C=T(14223),Q=T(14253),Y=T(12548);!function(K){K.ExecuteBlock="ExecuteBlock",K.ExecuteEvent="ExecuteEvent",K.TriggerConnection="TriggerConnection",K.ContextVariableSet="ContextVariableSet",K.GlobalVariableSet="GlobalVariableSet",K.GlobalVariableDelete="GlobalVariableDelete",K.GlobalVariableGet="GlobalVariableGet",K.AddConnection="AddConnection",K.GetConnectionValue="GetConnectionValue",K.SetConnectionValue="SetConnectionValue",K.ActivateSignal="ActivateSignal",K.ContextVariableGet="ContextVariableGet"}(G||(G={}));class Z{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(K){if(K.time||(K.time=Date.now()),this.log.push(K),this.logToConsole){var A;const T=null===(A=K.PT)||void 0===A?void 0:A.value;"object"===typeof T&&T.getClassName?Y.d.Log(`[FGLog] ${K.className}:${K.uniqueId.split("-")[0]} ${K.action} - ${JSON.stringify(T.getClassName())}: ${T.toString()}`):Y.d.Log(`[FGLog] ${K.className}:${K.uniqueId.split("-")[0]} ${K.action} - ${JSON.stringify(K.PT)}`)}}getItemsOfType(K){return this.log.filter((A=>A.action===K))}}class x{get enableLogging(){return this._enableLogging}set enableLogging(K){this._enableLogging!==K&&(this._enableLogging=K,this._enableLogging?(this.logger=new Z,this.logger.logToConsole=!0):this.logger=null)}constructor(K){this.uniqueId=(0,O.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new B.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=K,this.assetsContext=K.assetsContext??K.dA}hasVariable(K){return K in this._userVariables}setVariable(K,A){var T;this._userVariables[K]=A,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",PT:{name:K,value:A}})}getAsset(K,A){return(0,Q.d)(this.assetsContext,K,A)}getVariable(K){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",PT:{name:K,value:this._userVariables[K]}}),this._userVariables[K]}get userVariables(){return this._userVariables}SK(){return this._configuration.dA}_getUniqueIdPrefixedName(K,A){return`${K.uniqueId}_${A}`}_getGlobalContextVariable(K,A){var T;return null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",PT:{name:K,defaultValue:A,possibleValue:this._globalContextVariables[K]}}),this._hasGlobalContextVariable(K)?this._globalContextVariables[K]:A}_setGlobalContextVariable(K,A){var T;null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",PT:{name:K,value:A}}),this._globalContextVariables[K]=A}_deleteGlobalContextVariable(K){var A;null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",PT:{name:K}}),delete this._globalContextVariables[K]}_hasGlobalContextVariable(K){return K in this._globalContextVariables}_setExecutionVariable(K,A,T){this._executionVariables[this._getUniqueIdPrefixedName(K,A)]=T}_getExecutionVariable(K,A,T){return this._hasExecutionVariable(K,A)?this._executionVariables[this._getUniqueIdPrefixedName(K,A)]:T}_deleteExecutionVariable(K,A){delete this._executionVariables[this._getUniqueIdPrefixedName(K,A)]}_hasExecutionVariable(K,A){return this._getUniqueIdPrefixedName(K,A)in this._executionVariables}_hasConnectionValue(K){return K.uniqueId in this._connectionValues}_setConnectionValue(K,A){var T;this._connectionValues[K.uniqueId]=A,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",PT:{connectionPointId:K.uniqueId,value:A}})}_setConnectionValueByKey(K,A){this._connectionValues[K]=A}_getConnectionValue(K){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",PT:{connectionPointId:K.uniqueId,value:this._connectionValues[K.uniqueId]}}),this._connectionValues[K.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(K){this._pendingBlocks.includes(K)||(this._pendingBlocks.push(K),this._pendingBlocks.sort(((K,A)=>K.priority-A.priority)))}_removePendingBlock(K){const A=this._pendingBlocks.indexOf(K);-1!==A&&this._pendingBlocks.splice(A,1)}_clearPendingBlocks(){for(const K of this._pendingBlocks)K._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(K){var A;this.onNodeExecutedObservable.notifyObservers(K),null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:K.getClassName(),uniqueId:K.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(K){this._setGlobalContextVariable("timeSinceStart",K.timeSinceStart),this._setGlobalContextVariable("deltaTime",K.deltaTime);for(const T of this._pendingBlocks){var A;null===(A=T._executeOnTick)||void 0===A||A.call(T,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.h;K.uniqueId=this.uniqueId,K._userVariables={};for(const G in this._userVariables)A(G,this._userVariables[G],K._userVariables);K._connectionValues={};for(const G in this._connectionValues)A(G,this._connectionValues[G],K._connectionValues);var T;this.assetsContext!==this.SK()&&(K._assetsContext={meshes:this.assetsContext.meshes.map((K=>K.id)),materials:this.assetsContext.materials.map((K=>K.id)),textures:this.assetsContext.textures.map((K=>K.name)),animations:this.assetsContext.animations.map((K=>K.name)),lights:this.assetsContext.lights.map((K=>K.id)),cameras:this.assetsContext.cameras.map((K=>K.id)),fJ:null===(T=this.assetsContext.fJ)||void 0===T?void 0:T.map((K=>K.name)),skeletons:this.assetsContext.skeletons.map((K=>K.id)),Nx:this.assetsContext.Nx.map((K=>K.name)),geometries:this.assetsContext.geometries.map((K=>K.id)),multiMaterials:this.assetsContext.multiMaterials.map((K=>K.id)),transformNodes:this.assetsContext.transformNodes.map((K=>K.id))})}getClassName(){return"FlowGraphContext"}}(0,L.c)([(0,f.B)()],x.prototype,"uniqueId",void 0);var J=T(14259),b=T(12974);class P{constructor(K){this.onEventTriggeredObservable=new B.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=K,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ff.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const K=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",PT:{timeSinceStart:this._startingTime,deltaTime:K}}),this._startingTime+=K})),this._meshPickedObserver=this._scene.onPointerObservable.add((K=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",PT:K})}),b.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((K=>{const A=K.pointerId,T=K.mesh,G=this._pointerUnderMeshState[A];!G&&T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",PT:{pointerId:A,mesh:T}}):G&&!T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",PT:{pointerId:A,mesh:G}}):G&&T&&G!==T&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",PT:{pointerId:A,mesh:G,over:T}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",PT:{pointerId:A,mesh:T,out:G}})),this._pointerUnderMeshState[A]=T}),b.e.POINTERMOVE)}dispose(){var K,A,T,G,B;null===(K=this._sceneDisposeObserver)||void 0===K||K.remove(),null===(A=this._sceneReadyObserver)||void 0===A||A.remove(),null===(T=this._sceneOnBeforeRenderObserver)||void 0===T||T.remove(),null===(G=this._meshPickedObserver)||void 0===G||G.remove(),null===(B=this._meshUnderPointerObserver)||void 0===B||B.remove(),this.onEventTriggeredObservable.clear()}}var F,d=T(14278);!function(K){K[K.Stopped=0]="Stopped",K[K.Started=1]="Started"}(F||(F={}));class N{get state(){return this._state}set state(K){this._state=K,this.onStateChangedObservable.notifyObservers(K)}constructor(K){this.onStateChangedObservable=new B.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=K.dA,this._sceneEventCoordinator=new P(this._scene),this._coordinator=K.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((K=>{for(const A of this._executionContexts){const T=this._getContextualOrder(K.type,A);for(const G of T)if(!G._executeEvent(A,K.PT))break}switch(K.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const A of this._executionContexts)A._notifyOnTick(K.PT);break;case"SceneDispose":this.dispose()}}))}createContext(){const K=new x({dA:this._scene,coordinator:this._coordinator});return this._executionContexts.push(K),K}getContext(K){return this._executionContexts[K]}addEventBlock(K){if("PointerOver"!==K.type&&"PointerOut"!==K.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==K.type&&this._eventBlocks[K.type].push(K),1===this.state)for(const A of this._executionContexts)K._startPendingTasks(A);else this.onStateChangedObservable.addOnce((A=>{if(1===A)for(const T of this._executionContexts)K._startPendingTasks(T)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((K=>{1===K&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const K of this._executionContexts)for(const A in this._eventBlocks){const T=this._getContextualOrder(A,K);for(const A of T)A._startPendingTasks(K)}}_getContextualOrder(K,A){const T=this._eventBlocks[K].sort(((K,A)=>A.initPriority-K.initPriority));if("MeshPick"===K){const K=[];for(const G of T){const B=G.asset.getValue(A);let L=0;for(;L<T.length;L++){const K=T[L].asset.getValue(A);if(B&&K&&(0,d.m)(B,K))break}K.splice(L,0,G)}return K}return T}dispose(){var K;if(0!==this.state){this.state=0;for(const K of this._executionContexts)K._clearPendingBlocks();this._executionContexts.length=0;for(const K in this._eventBlocks)this._eventBlocks[K].length=0;null===(K=this._eventObserver)||void 0===K||K.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(K){const A=[],T=new Set;for(const G in this._eventBlocks)for(const K of this._eventBlocks[G])A.push(K),T.add(K.uniqueId);for(;A.length>0;){const G=A.pop();K(G);for(const K of G.dataInputs)for(const G of K._connectedPoint)T.has(G._ownerBlock.uniqueId)||(A.push(G._ownerBlock),T.add(G._ownerBlock.uniqueId));if(G instanceof J.e)for(const K of G.signalOutputs)for(const G of K._connectedPoint)T.has(G._ownerBlock.uniqueId)||(A.push(G._ownerBlock),T.add(G._ownerBlock.uniqueId))}}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1?arguments[1]:void 0;K.allBlocks=[],this.visitAllBlocks((A=>{const T={};A.serialize(T),K.allBlocks.push(T)})),K.executionContexts=[];for(const T of this._executionContexts){const G={};T.serialize(G,A),K.executionContexts.push(G)}}}class D{constructor(K){this.config=K,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.dA.Ff.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.dA.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const K=this._executeOnNextFrame.slice(0);if(K.length)for(const A of K){this.notifyCustomEvent(A.id,A.data,!1);const K=this._executeOnNextFrame.findIndex((K=>K.uniqueId===A.uniqueId));-1!==K&&this._executeOnNextFrame.splice(K,1)}}));(D.SceneCoordinators.get(this.config.dA)??[]).push(this)}createGraph(){const K=new N({dA:this.config.dA,coordinator:this});return this._flowGraphs.push(K),K}removeGraph(K){const A=this._flowGraphs.indexOf(K);-1!==A&&(K.dispose(),this._flowGraphs.splice(A,1))}start(){for(const K of this._flowGraphs)K.start()}dispose(){var K,A;for(const B of this._flowGraphs)B.dispose();this._flowGraphs.length=0,null===(K=this._disposeObserver)||void 0===K||K.remove(),null===(A=this._onBeforeRenderObserver)||void 0===A||A.remove();const T=D.SceneCoordinators.get(this.config.dA)??[],G=T.indexOf(this);-1!==G&&T.splice(G,1)}serialize(K,A){K._flowGraphs=[];for(const T of this._flowGraphs){const G={};T.serialize(G,A),K._flowGraphs.push(G)}K.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(K){let A=this._customEventsMap.get(K);return A||(A=new B.e,this._customEventsMap.set(K,A)),A}notifyCustomEvent(K,A){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:K,data:A,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(K)){const A=this._eventExecutionCounter.get(K);if(this._eventExecutionCounter.set(K,A+1),A>=D.MaxEventTypeExecutionPerFrame)return void(A===D.MaxEventTypeExecutionPerFrame&&Y.d.Warn(`FlowGraphCoordinator: Too many executions of event "${K}".`))}else this._eventExecutionCounter.set(K,1);const T=this._customEventsMap.get(K);T&&T.notifyObservers(A)}}D.MaxEventsPerType=30,D.MaxEventTypeExecutionPerFrame=30,D.SceneCoordinators=new Map},14283:(K,A,T)=>{"use strict";T.d(A,{e:()=>B});var G=T(14288);class B extends G.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(K){K._notifyExecuteNode(this),this.done._activateSignal(K)}}},14259:(K,A,T)=>{"use strict";T.d(A,{e:()=>O});var G=T(14262),B=T(14271),L=T(12651);class f extends B.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(K){super.connectTo(K),this._connectedPoint.sort(((K,A)=>A.priority-K.priority))}_activateSignal(K){var A;if(null===(A=K.logger)||void 0===A||A.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,PT:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(K,this),K._increaseExecutionId();else for(const T of this._connectedPoint)T._activateSignal(K)}}(0,L.c)("FlowGraphSignalConnection",f);class O extends G.e{constructor(K){super(K),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(K){const A=new f(K,0,this);return this.signalInputs.push(A),A}_registerSignalOutput(K){const A=new f(K,1,this);return this.signalOutputs.push(A),A}_unregisterSignalInput(K){const A=this.signalInputs.findIndex((A=>A.name===K));-1!==A&&(this.signalInputs[A].dispose(),this.signalInputs.splice(A,1))}_unregisterSignalOutput(K){const A=this.signalOutputs.findIndex((A=>A.name===K));-1!==A&&(this.signalOutputs[A].dispose(),this.signalOutputs.splice(A,1))}_reportError(K,A){this.error.PT="string"===typeof A?new Error(A):A,this.error._activateSignal(K)}getSignalInput(K){return this.signalInputs.find((A=>A.name===K))}getSignalOutput(K){return this.signalOutputs.find((A=>A.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.signalInputs=[],K.signalOutputs=[];for(const A of this.signalInputs){const T={};A.serialize(T),K.signalInputs.push(T)}for(const A of this.signalOutputs){const T={};A.serialize(T),K.signalOutputs.push(T)}}deserialize(K){for(let A=0;A<K.signalInputs.length;A++){const T=this.getSignalInput(K.signalInputs[A].name);if(!T)throw new Error("Could not find signal input with name "+K.signalInputs[A].name+" in block "+K.className);T.deserialize(K.signalInputs[A])}for(let A=0;A<K.signalOutputs.length;A++){const T=this.getSignalOutput(K.signalOutputs[A].name);if(!T)throw new Error("Could not find signal output with name "+K.signalOutputs[A].name+" in block "+K.className);T.deserialize(K.signalOutputs[A])}}getClassName(){return"FlowGraphExecutionBlock"}}},14295:(K,A,T)=>{"use strict";T.d(A,{d:()=>B});var G=T(14259);class B extends G.e{constructor(K){super(K),this.out=this._registerSignalOutput("out")}}},14237:(K,A,T)=>{"use strict";T.d(A,{C:()=>b,F:()=>P,H:()=>l,L:()=>u,O:()=>S,P:()=>g,b:()=>Q,d:()=>x,g:()=>z,h:()=>F,l:()=>d,m:()=>N,q:()=>Z,t:()=>U,v:()=>Y,z:()=>J});var G,B=T(12700),L=T(12743),f=T(14229),O=T(14245);!function(K){K.Any="any",K.String="string",K.Number="number",K.Boolean="boolean",K.Object="object",K.Integer="FlowGraphInteger",K.Vector2="Vector2",K.PA="PA",K.Vector4="Vector4",K.Quaternion="Quaternion",K.Matrix="Matrix",K.Matrix2D="Matrix2D",K.Matrix3D="Matrix3D",K.DA="DA",K.oO="oO"}(G||(G={}));class C{constructor(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=K,this.defaultValue=A,this.animationType=T}serialize(K){K.typeName=this.typeName,K.defaultValue=this.defaultValue}}const Q=new C("any",void 0),Y=new C("string",""),Z=new C("number",0,0),x=new C("boolean",!1),J=new C("Vector2",B.Vector2.Zero(),5),b=new C("PA",B.PA.Zero(),1),P=new C("Vector4",B.Vector4.Zero()),F=new C("Matrix",B.Matrix.Identity(),3),d=new C("Matrix2D",new O.e),N=new C("Matrix3D",new O.i),D=new C("DA",L.DA.Black(),4),mK=new C("oO",new L.oO(0,0,0,0),7),U=new C("Quaternion",B.Quaternion.Identity(),2);U.typeTransformer=K=>{if(K.getClassName){if("Vector4"===K.getClassName())return B.Quaternion.mT(K.kf());if("PA"===K.getClassName())return B.Quaternion.FromEulerVector(K);if("Matrix"===K.getClassName())return B.Quaternion.FromRotationMatrix(K)}return K};const z=new C("FlowGraphInteger",new f.e(0),0);function g(K){const A=K;switch(typeof K){case"string":return Y;case"number":return Z;case"boolean":return x;case"object":if(A.getClassName)switch(A.getClassName()){case"Vector2":return J;case"PA":return b;case"Vector4":return P;case"Matrix":return F;case"DA":return D;case"oO":return mK;case"Quaternion":return U;case"FlowGraphInteger":return z;case"Matrix2D":return d;case"Matrix3D":return N}return Q;default:return Q}}function S(K){switch(K){case"string":return Y;case"number":return Z;case"boolean":return x;case"Vector2":return J;case"PA":return b;case"Vector4":return P;case"Matrix":return F;case"DA":return D;case"oO":return mK;case"Quaternion":return U;case"FlowGraphInteger":return z;case"Matrix2D":return d;case"Matrix3D":return N;default:return Q}}function l(K){switch(K){case"number":default:return 0;case"Vector2":return 5;case"PA":return 1;case"Matrix":return 3;case"DA":return 4;case"oO":return 7;case"Quaternion":return 2}}function u(K){switch(K){case 0:return Z;case 5:return J;case 1:return b;case 3:return F;case 4:return D;case 7:return mK;case 2:return U;default:return Q}}},14223:(K,A,T)=>{"use strict";T.d(A,{d:()=>Y,h:()=>Q,i:()=>Z});var G=T(12743),B=T(12700),L=T(14229),f=T(14237),O=T(14245);function C(K){return"Vector2"===K||"PA"===K||"Vector4"===K||"Quaternion"===K||"DA"===K||"oO"===K}function Q(K,A,T){var G;const B=(null===A||void 0===A||null===(G=A.getClassName)||void 0===G?void 0:G.call(A))??"";if(C(B)||function(K){return"Matrix"===K||"Matrix2D"===K||"Matrix3D"===K}(B))T[K]={value:A.kf(),className:B};else if("FlowGraphInteger"===B)T[K]={value:A.value,className:B};else if(B&&(A.id||A.name))T[K]={id:A.id,name:A.name,className:B};else{if("object"===typeof A)throw new Error(`Could not serialize value ${A}`);T[K]=A}}function Y(K,A,T,Q){const Z=A[K];let x;const J=(null===Z||void 0===Z?void 0:Z.type)??(null===Z||void 0===Z?void 0:Z.className);if(function(K){return"Mesh"===K||"AbstractMesh"===K||"GroundMesh"===K||"InstanceMesh"===K||"LinesMesh"===K||"GoldbergMesh"===K||"GreasedLineMesh"===K||"TrailMesh"===K}(J)){let K=Q.meshes.filter((K=>Z.id?K.id===Z.id:K.name===Z.name));0===K.length&&(K=Q.transformNodes.filter((K=>Z.id?K.id===Z.id:K.name===Z.name))),x=Z.uniqueId?K.find((K=>K.uniqueId===Z.uniqueId)):K[0]}else if(C(J))x=function(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===K)return B.Vector2.mT(A);if("PA"===K)return T&&(A[2]*=-1),B.PA.mT(A);if("Vector4"===K)return B.Vector4.mT(A);if("Quaternion"===K)return T&&(A[2]*=-1,A[3]*=-1),B.Quaternion.mT(A);if("DA"===K)return new G.DA(A[0],A[1],A[2]);if("oO"===K)return new G.oO(A[0],A[1],A[2],A[3]);throw new Error(`Unknown vector class name ${K}`)}(J,Z.value);else if(function(K){return"AnimationGroup"===K}(J)){const K=Q.animationGroups.filter((K=>K.name===Z.name));x=1===K.length?K[0]:K.find((K=>K.uniqueId===Z.uniqueId))}else x="Matrix"===J?B.Matrix.mT(Z.value):"Matrix2D"===J?new O.e(Z.value):"Matrix3D"===J?new O.i(Z.value):"FlowGraphInteger"===J?L.e.FromValue(Z.value):"number"===J||"string"===J||"boolean"===J?Z.value[0]:Z&&void 0!==Z.value?Z.value:Array.isArray(Z)?Z.reduce(((K,A)=>A.eventData?(K[A.id]={type:(0,f.O)(A.type)},"undefined"!==typeof A.value&&(K[A.id].value=Y("value",A,T,Q)),K):K),{}):Z;return x}function Z(K){return"FlowGraphJsonPointerParserBlock"===K}},14278:(K,A,T)=>{"use strict";function G(K,A){return!(!K.parent||K.parent!==A&&!G(K.parent,A))}function B(K){if(K.getClassName)return K.getClassName()}function L(K,A){return K===A&&("Vector2"===K||"PA"===K||"Vector4"===K||"Quaternion"===K)}function f(K,A){return K===A&&("Matrix"===K||"Matrix2D"===K||"Matrix3D"===K)}function O(K,A){return"FlowGraphInteger"===K&&"FlowGraphInteger"===A}function C(K,A){const T="number"===typeof K||"number"===typeof(null===K||void 0===K?void 0:K.value);return T&&!A?!isNaN(Q(K)):T}function Q(K){return"number"===typeof K?K:K.value}T.d(A,{c:()=>O,f:()=>f,h:()=>L,i:()=>B,m:()=>G,q:()=>Q,r:()=>C})},14694:(K,A,T)=>{"use strict";T.r(A),T.d(A,{SceneInstrumentation:()=>L});var G=T(12526),B=T(12912);class L{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(K){K!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=K,K?(this._onBeforeActiveMeshesEvaluationObserver=this.dA.onBeforeActiveMeshesEvaluationObservable.add((()=>{G.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.dA.onAfterActiveMeshesEvaluationObservable.add((()=>{G.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.dA.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.dA.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(K){K!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=K,K?(this._onBeforeRenderTargetsRenderObserver=this.dA.onBeforeRenderTargetsRenderObservable.add((()=>{G.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.dA.onAfterRenderTargetsRenderObservable.add((()=>{G.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.dA.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.dA.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(K){K!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=K,K?(this._onBeforeParticlesRenderingObserver=this.dA.onBeforeParticlesRenderingObservable.add((()=>{G.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.dA.onAfterParticlesRenderingObservable.add((()=>{G.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.dA.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.dA.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(K){K!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=K,this.dA.spriteManagers&&(K?(this._onBeforeSpritesRenderingObserver=this.dA.onBeforeSpritesRenderingObservable.add((()=>{G.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.dA.onAfterSpritesRenderingObservable.add((()=>{G.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.dA.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.dA.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(K){K!==this._capturePhysicsTime&&this.dA.onBeforePhysicsObservable&&(this._capturePhysicsTime=K,K?(this._onBeforePhysicsObserver=this.dA.onBeforePhysicsObservable.add((()=>{G.Tools.StartPerformanceCounter("mb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.dA.onAfterPhysicsObservable.add((()=>{G.Tools.EndPerformanceCounter("mb"),this._physicsTime.endMonitoring()}))):(this.dA.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.dA.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(K){K!==this._captureAnimationsTime&&(this._captureAnimationsTime=K,K?this._onAfterAnimationsObserver=this.dA.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.dA.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(K){this._captureFrameTime=K}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(K){this._captureInterFrameTime=K}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(K){K!==this._captureRenderTime&&(this._captureRenderTime=K,K?(this._onBeforeDrawPhaseObserver=this.dA.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),G.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.dA.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),G.Tools.EndPerformanceCounter("Main render")}))):(this.dA.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.dA.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(K){K!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=K,K?(this._onBeforeCameraRenderObserver=this.dA.onBeforeCameraRenderObservable.add((K=>{this._cameraRenderTime.beginMonitoring(),G.Tools.StartPerformanceCounter(`Rendering camera ${K.name}`)})),this._onAfterCameraRenderObserver=this.dA.onAfterCameraRenderObservable.add((K=>{this._cameraRenderTime.endMonitoring(!1),G.Tools.EndPerformanceCounter(`Rendering camera ${K.name}`)}))):(this.dA.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.dA.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.dA.getEngine()._drawCalls}constructor(K){this.dA=K,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new B.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new B.b,this._captureFrameTime=!1,this._frameTime=new B.b,this._captureRenderTime=!1,this._renderTime=new B.b,this._captureInterFrameTime=!1,this._interFrameTime=new B.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new B.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new B.b,this._capturePhysicsTime=!1,this._physicsTime=new B.b,this._captureAnimationsTime=!1,this._animationsTime=new B.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new B.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=K.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(G.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.dA.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=K.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(G.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Pf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Pf(),this._captureParticlesRenderTime&&this._particlesRenderTime.Pf(),this._captureSpritesRenderTime&&this._spritesRenderTime.Pf(),this._captureRenderTime&&this._renderTime.Pf(),this._captureCameraRenderTime&&this._cameraRenderTime.Pf()}))}dispose(){this._disposed||(this.dA.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.dA.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.dA.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.dA.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.dA.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.dA.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.dA.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.dA.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.dA.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.dA.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.dA.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.dA.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.dA.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.dA.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.dA.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.dA.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.dA.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.dA=null,this._disposed=!0)}}},14206:(K,A,T)=>{"use strict";T.d(A,{d:()=>Y});var G=T(12683),B=T(12688),L=T(12700),f=T(13127),O=T(13242),C=T(13290),Q=T(12651);f.d.AddNodeConstructor("Light_Type_1",((K,A)=>()=>new Y(K,L.PA.Zero(),A)));class Y extends C.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(K){this._shadowFrustumSize=K,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(K){this._shadowOrthoScale=K,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(K){this._orthoLeft=K}get orthoRight(){return this._orthoRight}set orthoRight(K){this._orthoRight=K}get orthoTop(){return this._orthoTop}set orthoTop(K){this._orthoTop=K}get orthoBottom(){return this._orthoBottom}set orthoBottom(K){this._orthoBottom=K}constructor(K,A,T){super(K,T),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=A.scale(-1),this.direction=A}getClassName(){return"Kb"}getTypeID(){return O.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(K,A,T){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(K):this._setDefaultAutoExtendShadowProjectionMatrix(K,A,T)}_setDefaultFixedFrustumShadowProjectionMatrix(K){const A=this.SK().activeCamera;A&&L.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:A.If,void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,K,this.SK().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(K,A,T){const G=this.SK().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const K=L.PA.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let G=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let f=0;f<T.length;f++){const O=T[f];if(!O)continue;const C=O.getBoundingInfo().boundingBox;for(let T=0;T<C.vectorsWorld.length;T++)L.PA.TransformCoordinatesToRef(C.vectorsWorld[T],A,K),K.x<this._orthoLeft&&(this._orthoLeft=K.x),K.y<this._orthoBottom&&(this._orthoBottom=K.y),K.x>this._orthoRight&&(this._orthoRight=K.x),K.y>this._orthoTop&&(this._orthoTop=K.y),this.autoCalcShadowZBounds&&(K.z<G&&(G=K.z),K.z>B&&(B=K.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=G,this._shadowMaxZ=B)}const B=this._orthoRight-this._orthoLeft,f=this._orthoTop-this._orthoBottom,O=void 0!==this.shadowMinZ?this.shadowMinZ:(null===G||void 0===G?void 0:G.If)||0,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===G||void 0===G?void 0:G.maxZ)||1e4,Q=this.SK().getEngine().Zf;L.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-B*this.shadowOrthoScale,this._orthoRight+B*this.shadowOrthoScale,this._orthoBottom-f*this.shadowOrthoScale,this._orthoTop+f*this.shadowOrthoScale,Q?C:O,Q?O:C,K,this.SK().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,A){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,A),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,A),this)}transferToNodeMaterialEffect(K,A){return this.computeTransformedInformation()?(K.setFloat3(A,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(K.setFloat3(A,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(K){const A=this._scene.getEngine();return!A.Zf&&A.isNDCHalfZRange?0:1}getDepthMaxZ(K){const A=this._scene.getEngine();return A.Zf&&A.isNDCHalfZRange?0:1}prepareLightSpecificDefines(K,A){K["DIRLIGHT"+A]=!0}}(0,G.c)([(0,B.B)()],Y.prototype,"shadowFrustumSize",null),(0,G.c)([(0,B.B)()],Y.prototype,"shadowOrthoScale",null),(0,G.c)([(0,B.B)()],Y.prototype,"autoUpdateExtends",void 0),(0,G.c)([(0,B.B)()],Y.prototype,"autoCalcShadowZBounds",void 0),(0,G.c)([(0,B.B)("orthoLeft")],Y.prototype,"_orthoLeft",void 0),(0,G.c)([(0,B.B)("orthoRight")],Y.prototype,"_orthoRight",void 0),(0,G.c)([(0,B.B)("orthoTop")],Y.prototype,"_orthoTop",void 0),(0,G.c)([(0,B.B)("orthoBottom")],Y.prototype,"_orthoBottom",void 0),(0,Q.c)("BABYLON.DirectionalLight",Y)},14870:(K,A,T)=>{"use strict";T.d(A,{d:()=>Y});var G=T(12683),B=T(12688),L=T(12700),f=T(12743),O=T(13127),C=T(13242),Q=T(12651);O.d.AddNodeConstructor("Light_Type_3",((K,A)=>()=>new Y(K,L.PA.Zero(),A)));class Y extends C.b{constructor(K,A,T){super(K,T),this.groundColor=new f.DA(0,0,0),this.direction=A||L.PA.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Tb"}setDirectionToTarget(K){return this.direction=L.PA.Normalize(K.FA(L.PA.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(K,A){const T=L.PA.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",T.x,T.y,T.z,0,A),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.VO),A),this}transferToNodeMaterialEffect(K,A){const T=L.PA.Normalize(this.direction);return K.setFloat3(A,T.x,T.y,T.z),this}wf(){return this._worldMatrix||(this._worldMatrix=L.Matrix.Identity()),this._worldMatrix}getTypeID(){return C.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(K,A){K["HEMILIGHT"+A]=!0}}(0,G.c)([(0,B.j)()],Y.prototype,"groundColor",void 0),(0,G.c)([(0,B.A)()],Y.prototype,"direction",void 0),(0,Q.c)("BABYLON.HemisphericLight",Y)},14173:(K,A,T)=>{"use strict";T.d(A,{b:()=>Z});var G=T(12683),B=T(12688),L=T(12700),f=T(13127),O=T(13242),C=T(13290),Q=T(12674),Y=T(12651);f.d.AddNodeConstructor("Light_Type_2",((K,A)=>()=>new Z(K,L.PA.Zero(),L.PA.Zero(),0,0,A)));class Z extends C.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(K){this._iesProfileTexture!==K&&(this._iesProfileTexture=K,this._iesProfileTexture&&Z._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(K){this._angle=K,this._cosHalfAngle=Math.cos(.5*K),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(K){this._innerAngle=K,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(K){this._shadowAngleScale=K,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(K){this._projectionTextureLightNear=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(K){this._projectionTextureLightFar=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(K){this._projectionTextureUpDirection=K,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(K){this._projectionTexture!==K&&(this._projectionTexture=K,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Z._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Z._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(K){return void 0!==K.onGeneratedObservable}static _IsTexture(K){return void 0!==K.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(K){this._projectionTextureProjectionLightMatrix=K,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(K,A,T,G,B,f){super(K,f),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=L.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=L.PA.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=L.PA.Zero(),this._projectionTextureViewLightMatrix=L.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=L.Matrix.Zero(),this._projectionTextureScalingMatrix=L.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=A,this.direction=T,this.angle=G,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return O.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(K){super._setDirection(K),this._projectionTextureViewLightDirty=!0}_setPosition(K){super._setPosition(K),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(K,A,T){const G=this.SK().activeCamera;if(!G)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,f=void 0!==this.shadowMinZ?this.shadowMinZ:G.If,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ,C=this.SK().getEngine().Zf;L.Matrix.PerspectiveFovLHToRef(B,1,C?O:f,C?f:O,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),L.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const K=this.projectionTextureLightFar,A=this.projectionTextureLightNear,T=K/(K-A),G=-T*A,B=1/Math.tan(this._angle/2);L.Matrix.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,T,1,0,0,G,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Q.c){const K=this._projectionTexture.uScale/2,A=this._projectionTexture.vScale/2;L.Matrix.FromValuesToRef(K,0,0,0,0,A,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(K,A){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),K.setMatrix("textureProjectionMatrix"+A,this._projectionTextureMatrix),K.setTexture("projectionLightTexture"+A,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&K.setTexture("iesLightTexture"+A,this._iesProfileTexture),this}transferToEffect(K,A){let T;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,A),T=L.PA.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,A),T=L.PA.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",T.x,T.y,T.z,this._cosHalfAngle,A),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,A),this}transferToNodeMaterialEffect(K,A){let T;return T=this.computeTransformedInformation()?L.PA.Normalize(this.transformedDirection):L.PA.Normalize(this.direction),this.SK().useRightHandedSystem?K.setFloat3(A,-T.x,-T.y,-T.z):K.setFloat3(A,T.x,T.y,T.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(K){const A=this._scene.getEngine(),T=void 0!==this.shadowMinZ?this.shadowMinZ:(null===K||void 0===K?void 0:K.If)??0;return A.Zf&&A.isNDCHalfZRange?T:this._scene.getEngine().isNDCHalfZRange?0:T}getDepthMaxZ(K){const A=this._scene.getEngine(),T=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===K||void 0===K?void 0:K.maxZ)??1e4;return A.Zf&&A.isNDCHalfZRange?0:T}prepareLightSpecificDefines(K,A){K["SPOTLIGHT"+A]=!0,K["PROJECTEDLIGHTTEXTURE"+A]=!(!this.projectionTexture||!this.projectionTexture.isReady()),K["IESLIGHTTEXTURE"+A]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,G.c)([(0,B.B)()],Z.prototype,"angle",null),(0,G.c)([(0,B.B)()],Z.prototype,"innerAngle",null),(0,G.c)([(0,B.B)()],Z.prototype,"shadowAngleScale",null),(0,G.c)([(0,B.B)()],Z.prototype,"exponent",void 0),(0,G.c)([(0,B.B)()],Z.prototype,"projectionTextureLightNear",null),(0,G.c)([(0,B.B)()],Z.prototype,"projectionTextureLightFar",null),(0,G.c)([(0,B.B)()],Z.prototype,"projectionTextureUpDirection",null),(0,G.c)([(0,B.v)("projectedLightTexture")],Z.prototype,"_projectionTexture",void 0),(0,Y.c)("BABYLON.SpotLight",Z)},13924:(K,A,T)=>{"use strict";T.d(A,{e:()=>f,h:()=>L,j:()=>O});const G={},B={};function L(K,A){G[K]=A}function f(K,A){B[K]=A}function O(K){return B[K]?B[K]:null}},13831:(K,A,T)=>{"use strict";T.d(A,{d:()=>g,h:()=>k});var G,B=T(12526),L=T(12534),f=T(12931),O=T(12565),C=T(12548),Q=T(13168),Y=T(12571),Z=T(12573),x=T(12653),J=T(12604),b=T(12563);!function(K){K[K.Clean=0]="Clean",K[K.Stop=1]="Stop",K[K.Sync=2]="Sync",K[K.NoSync=3]="NoSync"}(G||(G={}));const P=new L.e,F={};let d=!1;function N(){return F[".babylon"]}function D(K,A){const T=F[K];return T||(C.d.Warn("Unable to find a plugin to load "+K+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),A?N():void 0)}function mK(K,A,T){let G="Unable to load from "+(K.rawData?"binary data":K.url);return A?G+=`: ${A}`:T&&(G+=`: ${T}`),G}async function U(K,A,T,G,B,L,f,O,C){var Q;const Z="data:"===(x=K.url).substring(0,5)?x.substring(5):null;var x;if(K.rawData&&!f)throw"When using ArrayBufferView to load data the file extension must be provided.";const d=Z||f?"":function(K){const A=K.indexOf("?");-1!==A&&(K=K.substring(0,A));const T=K.lastIndexOf(".");return K.substring(T,K.length).toLowerCase()}(K.url);let mK=f?D(f,!0):Z?function(K){for(const A in F){const T=F[A].plugin;if(T.canDirectLoad&&T.canDirectLoad(K))return F[A]}return N()}(K.url):D(d,!1);if(!mK&&d){if(K.url&&!K.url.startsWith("blob:")){const A=await async function(K,A){const T=A.method||"GET";return await new Promise(((G,B)=>{const L=new b.b;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const K={};if(A.responseHeaders)for(const T of A.responseHeaders)K[T]=L.getResponseHeader(T)||"";G({response:L.response,headerValues:K})}else B(`Unable to fetch data from ${K}. Error code: ${L.status}`)})),L.open(T,K),L.send()}))}(K.url,{method:"HEAD",responseHeaders:["Content-Type"]}),T=A.headerValues?A.headerValues["Content-Type"]:"";T&&(mK=function(K){for(const A in F){const T=F[A];if(T.mimeType===K)return T}}(T))}mK||(mK=N())}if(!mK)throw new Error(`No plugin or fallback for ${f??K.url}`);if(!1===(null===C||void 0===C||null===(Q=C[mK.plugin.name])||void 0===Q?void 0:Q.enabled))throw new Error(`The '${mK.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(K.rawData&&!mK.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(K=>{if(mK.plugin.createPlugin){const A=mK.plugin.createPlugin(C??{});return A instanceof Promise?(A.then(K).catch((K=>{B("Error instantiating plugin.",K)})),null):(K(A),A)}return K(mK.plugin),mK.plugin})((C=>{var Q;if(!C)throw`The loader plugin corresponding to the '${f}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(P.notifyObservers(C),Z&&(C.canDirectLoad&&C.canDirectLoad(K.url)||!(0,Y.m)(K.url))){if(C.directLoad){const K=C.directLoad(A,Z);K instanceof Promise?K.then((K=>{T(C,K)})).catch((K=>{B("Error in directLoad of _loadData: "+K,K)})):T(C,K)}else T(C,Z);return}const x=mK.isBinary,b=(K,G)=>{A.O?B("Scene has been disposed"):T(C,K,G)};let F=null,d=!1;null===(Q=C.Ff)||void 0===Q||Q.add((()=>{d=!0,F&&(F.abort(),F=null),L()}));const N=()=>{if(d)return;const T=(K,A)=>{B(null===K||void 0===K?void 0:K.statusText,A)};if(!C.loadFile&&K.rawData)throw"Plugin does not support loading ArrayBufferView.";F=C.loadFile?C.loadFile(A,K.rawData||K.file||K.url,K.rootUrl,b,G,x,T,O):A._loadFile(K.file||K.url,b,G,!0,x,T)},D=A.getEngine();let U=D.enableOfflineSupport;if(U){let T=!1;for(const G of A.disableOfflineSupportExceptionRules)if(G.test(K.url)){T=!0;break}U=!T}U&&J.c.OfflineProviderFactory?A.offlineProvider=J.c.OfflineProviderFactory(K.url,N,D.disableManifestCheck):N()}))}function z(K,A){let T,G,L=null,f=null;if(A)if(A.name)T=`file:${A.name}`,G=A.name,L=A;else if(ArrayBuffer.isView(A))T="",G=(0,x.d)(),f=A;else if(A.startsWith("data:"))T=A,G="";else if(K){const L=A;if("/"===L.substring(0,1))return B.Tools.Error("Wrong sceneFilename parameter"),null;T=K+L,G=L}else T=A,G=B.Tools.GetFilename(A),K=B.Tools.GetFolderPath(A);else T=K,G=B.Tools.GetFilename(K),K=B.Tools.GetFolderPath(K);return{url:T,rootUrl:K,name:G,file:L,rawData:f}}function g(K){if("string"===typeof K.extensions){const A=K.extensions;F[A.toLowerCase()]={plugin:K,isBinary:!1}}else{const A=K.extensions,T=Object.keys(A);for(const G of T)F[G.toLowerCase()]={plugin:K,isBinary:A[G].isBinary,mimeType:A[G].mimeType}}}async function S(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.b.LastCreatedScene,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!G)return C.d.Error("No scene available to import mesh to"),null;const J=z(A,T);if(!J)return null;const b={};G.addPendingData(b);const P=()=>{G.removePendingData(b)},F=(K,A)=>{const T=mK(J,K,A);f?f(G,T,new Z.i(T,Z.g.SceneLoaderError,A)):C.d.Error(T),P()},d=L?K=>{try{L(K)}catch(A){F("Error in onProgress callback: "+A,A)}}:void 0,N=(K,A,T,L,f,O,C,Q)=>{if(G.importedMeshesFiles.push(J.url),B)try{B(K,A,T,L,f,O,C,Q)}catch(Y){F("Error in onSuccess callback: "+Y,Y)}G.removePendingData(b)};return await U(J,G,((A,T,B)=>{if(A.rewriteRootURL&&(J.rootUrl=A.rewriteRootURL(J.rootUrl,B)),A.importMesh){const B=[],L=[],f=[];if(!A.importMesh(K,G,T,J.rootUrl,B,L,f,F))return;G.loadingPluginName=A.name,N(B,L,f,[],[],[],[],[])}else{A.importMeshAsync(K,G,T,J.rootUrl,d,J.name).then((K=>{G.loadingPluginName=A.name,N(K.meshes,K.Nx,K.skeletons,K.animationGroups,K.transformNodes,K.geometries,K.lights,K.spriteManagers)})).catch((K=>{F(K.message,K)}))}}),d,F,P,Q,Y,x)}async function l(K,A,T,G,B,L,f,O){return await new Promise(((C,Q)=>{try{S(K,A,T,G,((K,A,T,G,B,L,f,O)=>{C({meshes:K,Nx:A,skeletons:T,animationGroups:G,transformNodes:B,geometries:L,lights:f,spriteManagers:O})}),B,((K,A,T)=>{Q(T||new Error(A))}),L,f,O).catch(Q)}catch(Z){Q(Z)}}))}async function u(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedEngine,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};T?await n(K,A,new f.c(T),G,L,C,Q,Y,Z):B.Tools.Error("No engine available")}async function c(K,A,T,G,B,L,f){return await new Promise(((O,C)=>{u(K,A,T,(K=>{O(K)}),G,((K,A,T)=>{C(T||new Error(A))}),B,L,f)}))}async function n(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return C.d.Error("No scene available to append to"),null;const J=z(K,A);if(!J)return null;const b={};T.addPendingData(b);const P=()=>{T.removePendingData(b)};Q.c.ShowLoadingScreen&&!d&&(d=!0,T.getEngine().displayLoadingUI(),T.executeWhenReady((()=>{T.getEngine().hideLoadingUI(),d=!1})));const F=(K,A)=>{const G=mK(J,K,A);L?L(T,G,new Z.i(G,Z.g.SceneLoaderError,A)):C.d.Error(G),P()},N=B?K=>{try{B(K)}catch(A){F("Error in onProgress callback",A)}}:void 0,D=()=>{if(G)try{G(T)}catch(K){F("Error in onSuccess callback",K)}T.removePendingData(b)};return await U(J,T,((K,A)=>{if(K.load){if(!K.load(T,A,J.rootUrl,F))return;T.loadingPluginName=K.name,D()}else{K.loadAsync(T,A,J.rootUrl,N,J.name).then((()=>{T.loadingPluginName=K.name,D()})).catch((K=>{F(K.message,K)}))}}),N,F,P,f,Y,x)}async function H(K,A,T,G,B,L,f){return await new Promise(((O,C)=>{try{n(K,A,T,(K=>{O(K)}),G,((K,A,T)=>{C(T||new Error(A))}),B,L,f).catch(C)}catch(Z){C(Z)}}))}async function e(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return C.d.Error("No scene available to load asset container to"),null;const x=z(K,A);if(!x)return null;const J={};T.addPendingData(J);const b=()=>{T.removePendingData(J)},P=(K,A)=>{const G=mK(x,K,A);L?L(T,G,new Z.i(G,Z.g.SceneLoaderError,A)):C.d.Error(G),b()},F=B?K=>{try{B(K)}catch(A){P("Error in onProgress callback",A)}}:void 0,d=K=>{if(G)try{G(K)}catch(A){P("Error in onSuccess callback",A)}T.removePendingData(J)};return await U(x,T,((K,A)=>{if(K.loadAssetContainer){const G=K.loadAssetContainer(T,A,x.rootUrl,P);if(!G)return;G.populateRootNodes(),T.loadingPluginName=K.name,d(G)}else if(K.loadAssetContainerAsync){K.loadAssetContainerAsync(T,A,x.rootUrl,F,x.name).then((A=>{A.populateRootNodes(),T.loadingPluginName=K.name,d(A)})).catch((K=>{P(K.message,K)}))}else P("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),F,P,b,f,Q,Y)}async function p(K,A,T,G,B,L,f){return await new Promise(((O,C)=>{try{e(K,A,T,(K=>{O(K)}),G,((K,A,T)=>{C(T||new Error(A))}),B,L,f).catch(C)}catch(Z){C(Z)}}))}async function r(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!T)return void C.d.Error("No scene available to load animations to");if(G){for(const G of T.animatables)G.reset();T.stopAllAnimations();const K=T.animationGroups.slice();for(const T of K)T.dispose();const A=T.getNodes();for(const T of A)T.animations&&(T.animations=[])}else switch(B){case 0:const K=T.animationGroups.slice();for(const A of K)A.dispose();break;case 1:for(const A of T.animationGroups)A.stop();break;case 2:for(const A of T.animationGroups)A.reset(),A.restart();break;case 3:break;default:return void C.d.Error("Unknown animation group loading mode value '"+B+"'")}const b=T.animatables.length;await e(K,A,T,(K=>{K.mergeAnimationsTo(T,T.animatables.slice(b),L),K.dispose(),T.onAnimationFileImportedObservable.notifyObservers(T),f&&f(T)}),Q,Y,Z,x,J)}async function h(K,A,T,G,B,L,f,O,C,Q){return await new Promise(((Y,x)=>{try{r(K,A,T,G,B,L,(K=>{Y(K)}),f,((K,A,T)=>{x(T||new Error(A))}),O,C,Q).catch(x)}catch(Z){x(Z)}}))}class k{static get ForceFullSceneLoadingForIncremental(){return Q.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(K){Q.c.ForceFullSceneLoadingForIncremental=K}static get ShowLoadingScreen(){return Q.c.ShowLoadingScreen}static set ShowLoadingScreen(K){Q.c.ShowLoadingScreen=K}static get loggingLevel(){return Q.c.loggingLevel}static set loggingLevel(K){Q.c.loggingLevel=K}static get CleanBoneMatrixWeights(){return Q.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(K){Q.c.CleanBoneMatrixWeights=K}static GetDefaultPlugin(){return N()}static GetPluginForExtension(K){var A;return null===(A=D(K,!0))||void 0===A?void 0:A.plugin}static IsPluginForExtensionAvailable(K){return function(K){return!!F[K]}(K)}static RegisterPlugin(K){g(K)}static ImportMesh(K,A,T,G,B,L,f,C,Q){S(K,A,T,G,B,L,f,C,Q).catch((K=>null===f||void 0===f?void 0:f(O.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async ImportMeshAsync(K,A,T,G,B,L,f){return await l(K,A,T,G,B,L,f)}static Load(K,A,T,G,B,L,f,C){u(K,A,T,G,B,L,f,C).catch((K=>null===L||void 0===L?void 0:L(O.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async LoadAsync(K,A,T,G,B,L){return await c(K,A,T,G,B,L)}static Append(K,A,T,G,B,L,f,C){n(K,A,T,G,B,L,f,C).catch((K=>null===L||void 0===L?void 0:L(T??O.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async AppendAsync(K,A,T,G,B,L){return await H(K,A,T,G,B,L)}static LoadAssetContainer(K,A,T,G,B,L,f,C){e(K,A,T,G,B,L,f,C).catch((K=>null===L||void 0===L?void 0:L(T??O.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async LoadAssetContainerAsync(K,A,T,G,B,L){return await p(K,A,T,G,B,L)}static ImportAnimations(K,A,T,G,B,L,f,C,Q,Y,Z){r(K,A,T,G,B,L,f,C,Q,Y,Z).catch((K=>null===Q||void 0===Q?void 0:Q(T??O.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async ImportAnimationsAsync(K,A,T,G,B,L,f,O,C,Q,Y){return await h(K,A,T,G,B,L,O,Q,Y)}}k.NO_LOGGING=0,k.MINIMAL_LOGGING=1,k.SUMMARY_LOGGING=2,k.DETAILED_LOGGING=3,k.OnPluginActivatedObservable=P},14185:(K,A,T)=>{"use strict";T.d(A,{c:()=>x});var G=T(12683),B=T(12688),L=T(12526),f=T(12700),O=T(12722),C=T(12674),Q=T(12651),Y=T(12534),Z=T(12733);T(14192);class x extends O.e{set boundingBoxSize(K){if(this._boundingBoxSize&&this._boundingBoxSize.equals(K))return;this._boundingBoxSize=K;const A=this.SK();A&&A.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(K){this._rotationY=K,this.setReflectionTextureMatrix(f.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(K,A,T){let G="";for(const B of K)G+=B;return new x(G,A,null,T,K)}static CreateFromPrefilteredData(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=A.useDelayedTextureLoading;A.useDelayedTextureLoading=!1;const L=new x(K,A,null,!1,null,null,null,void 0,!0,T,G);return A.useDelayedTextureLoading=B,L}constructor(K,A){var T;let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]&&arguments[10],P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d=arguments.length>13?arguments[13]:void 0,N=arguments.length>14?arguments[14]:void 0;super(A),this.onLoadObservable=new Y.e,this.boundingBoxPosition=f.PA.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new f.Matrix,this._buffer=null,this.name=K,this.url=K,this._noMipmap=B,this.sf=!1,this.isCube=!0,this._textureMatrix=f.Matrix.Identity(),this.coordinatesMode=C.c.CUBIC_MODE;let D=null,mK=null;null===G||Array.isArray(G)?(this._noMipmap=B,this._format=Z,this._createPolynomials=b,D=G,this._loaderOptions=d,this._useSRGBBuffer=N,this._lodScale=P,this._lodOffset=F):(D=G.extensions??null,this._noMipmap=G.noMipmap??!1,L=G.files??null,mK=G.buffer??null,this._format=G.format??5,x=G.prefiltered??!1,J=G.forcedExtension??null,this._createPolynomials=G.createPolynomials??!1,this._lodScale=G.lodScale??.8,this._lodOffset=G.lodOffset??0,this._loaderOptions=G.loaderOptions,this._useSRGBBuffer=G.useSRGBBuffer,O=G.q??null,Q=G.onError??null),(K||L)&&this.updateURL(K,J,O,x,Q,D,null===(T=this.SK())||void 0===T?void 0:T.useDelayedTextureLoading,L,mK)}getClassName(){return"CubeTexture"}updateURL(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=K),this.url=K,A&&(this._forcedExtension=A);const Q=K.lastIndexOf("."),Y=A||(Q>-1?K.substring(Q).toLowerCase():""),Z=0===Y.indexOf(".dds"),x=0===Y.indexOf(".env"),J=0===Y.indexOf(".basis");if(x?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=G,G&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),O)this._files=O;else if(J||x||Z||L||(L=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,L){for(let A=0;A<L.length;A++)this._files.push(K+L[A]);this._extensions=L}this._buffer=C,f?(this.delayLoadState=4,this._delayedOnLoad=T,this._delayedOnError=B):this._loadTexture(T,B)}delayLoad(K){4===this.delayLoadState&&(K&&(this._forcedExtension=K),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(K){var A,T;if(K.updateFlag===this._textureMatrix.updateFlag)return;K.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(T=this.SK())||void 0===T||T.markAllMaterialsAsDirty(1,(K=>-1!==K.getActiveTextures().indexOf(this))));if(this._textureMatrix=K,null===(A=this.SK())||void 0===A||!A.useRightHandedSystem)return;const G=f.TmpVectors.PA[0],B=f.TmpVectors.Quaternion[0],L=f.TmpVectors.PA[1];this._textureMatrix.decompose(G,B,L),B.z*=-1,B.w*=-1,f.Matrix.ComposeToRef(G,B,L,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var K;return null!==(K=this.SK())&&void 0!==K&&K.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this.SK(),G=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const B=()=>{var A;(this.onLoadObservable.notifyObservers(this),G)&&(G.dispose(),null===(A=this.SK())||void 0===A||A.markAllMaterialsAsDirty(1));K&&K()},f=(K,T)=>{this._loadingError=!0,this._errorObject={message:K,exception:T},A&&A(K,T),C.c.OnTextureLoadErrorObservable.notifyObservers(this)};var O;this._texture?this._texture.isReady?L.Tools.SetImmediate((()=>B())):this._texture.onLoadedObservable.add((()=>B())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,T,this._lodScale,this._lodOffset,K,f,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,T,this._files,this._noMipmap,K,f,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(O=this._texture)||void 0===O||O.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(K,A,T){const G=Z.c.Parse((()=>{let G=!1;return K.prefiltered&&(G=K.prefiltered),new x(T+(K.url??K.name),A,K.extensions,!1,K.files||null,null,null,void 0,G,K.forcedExtension)}),K,A);if(K.boundingBoxPosition&&(G.boundingBoxPosition=f.PA.mT(K.boundingBoxPosition)),K.boundingBoxSize&&(G.boundingBoxSize=f.PA.mT(K.boundingBoxSize)),K.animations)for(let B=0;B<K.animations.length;B++){const A=K.animations[B],T=(0,Q.b)("BABYLON.Animation");T&&G.animations.push(T.Parse(A))}return G}clone(){let K=0;const A=Z.c.Clone((()=>{const A=new x(this.url,this.SK()||this._getEngine(),this._extensions,this._noMipmap,this._files);return K=A.uniqueId,A}),this);return A.uniqueId=K,A}}(0,G.c)([(0,B.B)()],x.prototype,"url",void 0),(0,G.c)([(0,B.A)()],x.prototype,"boundingBoxPosition",void 0),(0,G.c)([(0,B.A)()],x.prototype,"boundingBoxSize",null),(0,G.c)([(0,B.B)("rotationY")],x.prototype,"rotationY",null),(0,G.c)([(0,B.B)("files")],x.prototype,"_files",void 0),(0,G.c)([(0,B.B)("forcedExtension")],x.prototype,"_forcedExtension",void 0),(0,G.c)([(0,B.B)("extensions")],x.prototype,"_extensions",void 0),(0,G.c)([(0,B.q)("textureMatrix")],x.prototype,"_textureMatrix",void 0),(0,G.c)([(0,B.q)("textureMatrixRefraction")],x.prototype,"_textureMatrixRefraction",void 0),C.c._CubeTextureParser=x.Parse,(0,Q.c)("BABYLON.CubeTexture",x)},14880:(K,A,T)=>{"use strict";T.d(A,{d:()=>C});var G=T(12548),B=T(12674),L=T(12661),f=T(12832),O=T(12637);f.ThinEngine.prototype.createDynamicTexture=function(K,A,T,G){const B=new O.b(this,4);return B.baseWidth=K,B.baseHeight=A,T&&(K=this.needPOTTextures?(0,L.f)(K,this._caps.maxTextureSize):K,A=this.needPOTTextures?(0,L.f)(A,this._caps.maxTextureSize):A),B.width=K,B.height=A,B.isReady=!1,B.generateMipMaps=T,B.samplingMode=G,this.updateTextureSamplingMode(G,B),this._internalTexturesCache.push(B),B},f.ThinEngine.prototype.updateDynamicTexture=function(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!K)return;const f=this._gl,O=f.TEXTURE_2D,C=this._bindTextureDirectly(O,K,!0,L);this._unpackFlipY(void 0===T?K.invertY:T),G&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Q=this._getWebGLTextureType(K.type),Y=this._getInternalFormat(B||K.format),Z=this._getRGBABufferInternalSizedFormat(K.type,Y);f.texImage2D(O,0,Z,Y,Q,A),K.generateMipMaps&&f.generateMipmap(O),C||this._bindTextureDirectly(O,null),G&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),B&&(K.format=B),K._dynamicTextureSource=A,K._premulAlpha=G,K.invertY=T||!1,K.isReady=!0};class C extends B.c{constructor(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,O=arguments.length>6?arguments[6]:void 0;const C=!T||T._isScene;super(null,C?T:null===T||void 0===T?void 0:T.dA,C?!G:T,O,L,void 0,void 0,void 0,void 0,f),this.name=K,this.wrapU=B.c.CLAMP_ADDRESSMODE,this.wrapV=B.c.CLAMP_ADDRESSMODE,this._generateMipMaps=G;const Q=this._getEngine();if(!Q)return;if(A.getContext)this._canvas=A,this._ownCanvas=!1,this._texture=Q.createDynamicTexture(this._canvas.width,this._canvas.height,G,L);else{this._canvas=Q.createCanvas(1,1),this._ownCanvas=!0;const K=A;K.width||0===K.width?this._texture=Q.createDynamicTexture(K.width,K.height,G,L):this._texture=Q.createDynamicTexture(A,A,G,L)}const Y=this.getSize();this._canvas.width!==Y.width&&(this._canvas.width=Y.width),this._canvas.height!==Y.height&&(this._canvas.height=Y.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(K){this._canvas.width=K.width,this._canvas.height=K.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(K.width,K.height,this._generateMipMaps,this.samplingMode)}scale(K){const A=this.getSize();A.width*=K,A.height*=K,this._recreate(A)}scaleTo(K,A){const T=this.getSize();T.width=K,T.height=A,this._recreate(T)}getContext(){return this._context}clear(K){const A=this.getSize();K&&(this._context.fillStyle=K),this._context.clearRect(0,0,A.width,A.height)}update(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===K||K,A,this._format||void 0,void 0,T)}drawText(K,A,T,G,B,L,f){let O=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(L&&(this._context.fillStyle=L,this._context.fillRect(0,0,C.width,C.height)),this._context.font=G,null===A||void 0===A){const T=this._context.measureText(K);A=(C.width-T.width)/2}if(null===T||void 0===T){const K=parseInt(G.replace(/\D/g,""));T=C.height/2+K/3.65}this._context.fillStyle=B||"",this._context.fillText(K,A,T),O&&this.update(f)}dispose(){var K,A;(super.dispose(),this._ownCanvas)&&(null===(K=this._canvas)||void 0===K||null===(A=K.remove)||void 0===A||A.call(K));this._canvas=null,this._context=null}clone(){const K=this.SK();if(!K)return this;const A=this.getSize(),T=new C(this.name,A,K,this._generateMipMaps);return T.sf=this.sf,T.level=this.level,T.wrapU=this.wrapU,T.wrapV=this.wrapV,T}serialize(){const K=this.SK();K&&!K.isReady()&&G.d.Warn("The scene must be ready before serializing the dynamic texture");const A=super.serialize();return C._IsCanvasElement(this._canvas)&&(A.base64String=this._canvas.toDataURL()),A.invertY=this._invertY,A.samplingMode=this.samplingMode,A}static _IsCanvasElement(K){return void 0!==K.toDataURL}_rebuild(){this.update()}}},14104:(K,A,T)=>{"use strict";T.d(A,{d:()=>B});var G=T(12674);class B extends G.c{get depth(){return this._depth}constructor(K,A,T,B,L,f){let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:G.c.TRILINEAR_SAMPLINGMODE,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10?arguments[10]:void 0;super(null,f,!O,C),this.format=L,this._texture=f.getEngine().createRawTexture2DArray(K,A,T,B,L,O,C,Q,null,Y,Z),this._depth=B,this.is2DArray=!0}update(K){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(K,A,T,G,L){return new B(K,A,T,G,5,L,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13942:(K,A,T)=>{"use strict";T.d(A,{d:()=>O,f:()=>C,j:()=>L,k:()=>f});var G=T(12716),B=T(12700);function L(K,A){return`{X: ${K.x.toFixed(A)} Y: ${K.y.toFixed(A)}}`}function f(K,A){return`{X: ${K._x.toFixed(A)} Y: ${K._y.toFixed(A)} Z: ${K._z.toFixed(A)}}`}function O(K,A){return 2*Math.acos((0,G.Clamp)(B.Quaternion.Dot(K,A)))}function C(K,A){const T=new B.Quaternion;return function(K,A,T){const L=B.PA.Cross(K,A),f=Math.acos((0,G.Clamp)(B.PA.Dot(K,A),-1,1));B.Quaternion.RotationAxisToRef(L,f,T)}(K,A,T),T}},13791:(K,A,T)=>{"use strict";T.d(A,{c:()=>Q});var G=T(12700),B=T(12743),L=T(13147),f=T(13133),O=T(12754);T(13793);function C(K){let A=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const T=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],L=[];let C=[];const Q=K.width||K.size||1,Y=K.height||K.size||1,Z=K.depth||K.size||1,x=K.wrap||!1;let J=void 0===K.topBaseAt?1:K.topBaseAt,b=void 0===K.bottomBaseAt?0:K.bottomBaseAt;J=(J+4)%4,b=(b+4)%4;let P=[2,0,3,1][J],F=[2,0,1,3][b],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(x){A=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let K=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],T=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const G=[17,18,19,16],B=[22,23,20,21];for(;P>0;)K.unshift(K.pop()),G.unshift(G.pop()),P--;for(;F>0;)T.unshift(T.pop()),B.unshift(B.pop()),F--;K=K.flat(),T=T.flat(),d=d.concat(K).concat(T),A.push(G[0],G[2],G[3],G[0],G[1],G[2]),A.push(B[0],B[2],B[3],B[0],B[1],B[2])}const N=[Q/2,Y/2,Z/2];C=d.reduce(((K,A,T)=>K.concat(A*N[T%3])),[]);const D=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,mK=K.faceUV||new Array(6),U=K.faceColors,z=[];for(let f=0;f<6;f++)void 0===mK[f]&&(mK[f]=new G.Vector4(0,0,1,1)),U&&void 0===U[f]&&(U[f]=new B.oO(1,1,1,1));for(let G=0;G<6;G++)if(L.push(mK[G].z,O.d?1-mK[G].w:mK[G].w),L.push(mK[G].x,O.d?1-mK[G].w:mK[G].w),L.push(mK[G].x,O.d?1-mK[G].y:mK[G].y),L.push(mK[G].z,O.d?1-mK[G].y:mK[G].y),U)for(let K=0;K<4;K++)z.push(U[G].r,U[G].g,U[G].b,U[G].a);f.d._ComputeSides(D,C,A,T,L,K.frontUVs,K.backUVs);const g=new f.d;if(g.indices=A,g.uK=C,g.cK=T,g.HK=L,U){const K=D===f.d.DOUBLESIDE?z.concat(z):z;g.nK=K}return g}function Q(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new L.e(K,T);A.sideOrientation=L.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return C(A).pK(G,A.updatable),G}f.d.CreateBox=C,L.e.CreateBox=function(K,A){return Q(K,{size:A,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13930:(K,A,T)=>{"use strict";T.d(A,{b:()=>O});var G=T(13147),B=T(13133),L=T(12754);function f(K){const A=[],T=[],G=[],f=[],O=K.radius||.5,C=K.tessellation||64,Q=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,Y=0===K.sideOrientation?0:K.sideOrientation||B.d.DEFAULTSIDE;A.push(0,0,0),f.push(.5,.5);const Z=2*Math.PI*Q,x=1===Q?Z/C:Z/(C-1);let J=0;for(let B=0;B<C;B++){const K=Math.cos(J),T=Math.sin(J),G=(K+1)/2,B=(1-T)/2;A.push(O*K,O*T,0),f.push(G,L.d?1-B:B),J+=x}1===Q&&(A.push(A[3],A[4],A[5]),f.push(f[2],L.d?1-f[3]:f[3]));const b=A.length/3;for(let B=1;B<b-1;B++)T.push(B+1,0,B);B.d.ComputeNormals(A,T,G),B.d._ComputeSides(Y,A,T,G,f,K.frontUVs,K.backUVs);const P=new B.d;return P.indices=T,P.uK=A,P.cK=G,P.HK=f,P}function O(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new G.e(K,T);A.sideOrientation=G.e._GetDefaultSideOrientation(A.sideOrientation),B._originalBuilderSideOrientation=A.sideOrientation;return f(A).pK(B,A.updatable),B}B.d.CreateDisc=f,G.e.CreateDisc=function(K,A,T){return O(K,{radius:A,tessellation:T,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13793:(K,A,T)=>{"use strict";T.d(A,{e:()=>F,c:()=>N,f:()=>d});var G=T(12700),B=T(12743),L=T(13147),f=T(13133),O=T(12768);L.e._GroundMeshParser=(K,A)=>C.Parse(K,A);class C extends L.e{constructor(K,A){super(K,A),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=K,this._subdivisionsY=K,this.subdivide(K);const T=this;T.createOrUpdateSubmeshesOctree&&T.createOrUpdateSubmeshesOctree(A)}getHeightAtCoordinates(K,A){const T=this.getWorldMatrix(),B=G.TmpVectors.Matrix[5];T.invertToRef(B);const L=G.TmpVectors.PA[8];if(G.PA.TransformCoordinatesFromFloatsToRef(K,0,A,B,L),K=L.x,A=L.z,K<this._minX||K>=this._maxX||A<=this._minZ||A>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const f=this._getFacetAt(K,A),O=-(f.x*K+f.z*A+f.w)/f.y;return G.PA.TransformCoordinatesFromFloatsToRef(0,O,0,T,L),L.y}getNormalAtCoordinates(K,A){const T=new G.PA(0,1,0);return this.getNormalAtCoordinatesToRef(K,A,T),T}getNormalAtCoordinatesToRef(K,A,T){const B=this.getWorldMatrix(),L=G.TmpVectors.Matrix[5];B.invertToRef(L);const f=G.TmpVectors.PA[8];if(G.PA.TransformCoordinatesFromFloatsToRef(K,0,A,L,f),K=f.x,A=f.z,K<this._minX||K>this._maxX||A<this._minZ||A>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const O=this._getFacetAt(K,A);return G.PA.TransformNormalFromFloatsToRef(O.x,O.y,O.z,B,T),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(K,A){const T=Math.floor((K+this._maxX)*this._subdivisionsX/this._width),G=Math.floor(-(A+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),B=this._heightQuads[G*this._subdivisionsX+T];let L;return L=A<B.slope.x*K+B.slope.y?B.facet1:B.facet2,L}_initHeightQuads(){const K=this._subdivisionsX,A=this._subdivisionsY;this._heightQuads=[];for(let T=0;T<A;T++)for(let A=0;A<K;A++){const B={slope:G.Vector2.Zero(),facet1:new G.Vector4(0,0,0,0),facet2:new G.Vector4(0,0,0,0)};this._heightQuads[T*K+A]=B}return this}_computeHeightQuads(){const K=this.getVerticesData(O.d.PositionKind);if(!K)return this;const A=G.TmpVectors.PA[3],T=G.TmpVectors.PA[2],B=G.TmpVectors.PA[1],L=G.TmpVectors.PA[0],f=G.TmpVectors.PA[4],C=G.TmpVectors.PA[5],Q=G.TmpVectors.PA[6],Y=G.TmpVectors.PA[7],Z=G.TmpVectors.PA[8];let x=0,J=0,b=0,P=0,F=0,d=0,N=0;const D=this._subdivisionsX,mK=this._subdivisionsY;for(let O=0;O<mK;O++)for(let mK=0;mK<D;mK++){x=3*mK,J=O*(D+1)*3,b=(O+1)*(D+1)*3,A.x=K[J+x],A.y=K[J+x+1],A.z=K[J+x+2],T.x=K[J+x+3],T.y=K[J+x+4],T.z=K[J+x+5],B.x=K[b+x],B.y=K[b+x+1],B.z=K[b+x+2],L.x=K[b+x+3],L.y=K[b+x+4],L.z=K[b+x+5],P=(L.z-A.z)/(L.x-A.x),F=A.z-P*A.x,T.subtractToRef(A,f),B.subtractToRef(A,C),L.subtractToRef(A,Q),G.PA.CrossToRef(Q,C,Y),G.PA.CrossToRef(f,Q,Z),Y.normalize(),Z.normalize(),d=-(Y.x*A.x+Y.y*A.y+Y.z*A.z),N=-(Z.x*T.x+Z.y*T.y+Z.z*T.z);const U=this._heightQuads[O*D+mK];U.slope.RO(P,F),U.facet1.RO(Y.x,Y.y,Y.z,d),U.facet2.RO(Z.x,Z.y,Z.z,N)}return this}serialize(K){super.serialize(K),K.subdivisionsX=this._subdivisionsX,K.subdivisionsY=this._subdivisionsY,K.minX=this._minX,K.maxX=this._maxX,K.If=this._minZ,K.maxZ=this._maxZ,K.width=this._width,K.height=this._height}static Parse(K,A){const T=new C(K.name,A);return T._subdivisionsX=K.subdivisionsX||1,T._subdivisionsY=K.subdivisionsY||1,T._minX=K.minX,T._maxX=K.maxX,T._minZ=K.If,T._maxZ=K.maxZ,T._width=K.width,T._height=K.height,T}}var Q=T(12526),Y=T(12565),Z=T(12706),x=T(12754);function J(K){const A=[],T=[],B=[],L=[];let O,C;const Q=K.width||K.size||1,Y=K.height||K.size||1,Z=0|(K.subdivisionsX||K.subdivisions||1),J=0|(K.subdivisionsY||K.subdivisions||1);for(O=0;O<=J;O++)for(C=0;C<=Z;C++){const K=new G.PA(C*Q/Z-Q/2,0,(J-O)*Y/J-Y/2),A=new G.PA(0,1,0);T.push(K.x,K.y,K.z),B.push(A.x,A.y,A.z),L.push(C/Z,x.d?O/J:1-O/J)}for(O=0;O<J;O++)for(C=0;C<Z;C++)A.push(C+1+(O+1)*(Z+1)),A.push(C+1+O*(Z+1)),A.push(C+O*(Z+1)),A.push(C+(O+1)*(Z+1)),A.push(C+1+(O+1)*(Z+1)),A.push(C+O*(Z+1));const b=new f.d;return b.indices=A,b.uK=T,b.cK=B,b.HK=L,b}function b(K){const A=void 0!==K.xmin&&null!==K.xmin?K.xmin:-1,T=void 0!==K.zmin&&null!==K.zmin?K.zmin:-1,B=void 0!==K.xmax&&null!==K.xmax?K.xmax:1,L=void 0!==K.zmax&&null!==K.zmax?K.zmax:1,O=K.subdivisions||{w:1,h:1},C=K.precision||{w:1,h:1},Q=[],Y=[],Z=[],x=[];let J,b,P,F;O.h=O.h<1?1:O.h,O.w=O.w<1?1:O.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const d=(B-A)/O.w,N=(L-T)/O.h;function D(K,A,T,B){const L=Y.length/3,f=C.w+1;for(J=0;J<C.h;J++)for(b=0;b<C.w;b++){const K=[L+b+J*f,L+(b+1)+J*f,L+(b+1)+(J+1)*f,L+b+(J+1)*f];Q.push(K[1]),Q.push(K[2]),Q.push(K[3]),Q.push(K[0]),Q.push(K[1]),Q.push(K[3])}const O=G.PA.Zero(),P=new G.PA(0,1,0);for(J=0;J<=C.h;J++)for(O.z=J*(B-A)/C.h+A,b=0;b<=C.w;b++)O.x=b*(T-K)/C.w+K,O.y=0,Y.push(O.x,O.y,O.z),Z.push(P.x,P.y,P.z),x.push(b/C.w,J/C.h)}for(P=0;P<O.h;P++)for(F=0;F<O.w;F++)D(A+F*d,T+P*N,A+(F+1)*d,T+(P+1)*N);const mK=new f.d;return mK.indices=Q,mK.uK=Y,mK.cK=Z,mK.HK=x,mK}function P(K){const A=[],T=[],L=[],O=[];let C,Q;const Y=K.colorFilter||new B.DA(.3,.59,.11),x=K.alphaFilter||0;let J=!1;if(K.minHeight>K.maxHeight){J=!0;const A=K.maxHeight;K.maxHeight=K.minHeight,K.minHeight=A}for(C=0;C<=K.subdivisions;C++)for(Q=0;Q<=K.subdivisions;Q++){const A=new G.PA(Q*K.width/K.subdivisions-K.width/2,0,(K.subdivisions-C)*K.height/K.subdivisions-K.height/2),B=4*(((A.x+K.width/2)/K.width*(K.bufferWidth-1)|0)+((1-(A.z+K.height/2)/K.height)*(K.bufferHeight-1)|0)*K.bufferWidth);let f=K.buffer[B]/255,b=K.buffer[B+1]/255,P=K.buffer[B+2]/255;const F=K.buffer[B+3]/255;J&&(f=1-f,b=1-b,P=1-P);const d=f*Y.r+b*Y.g+P*Y.b;A.y=F>=x?K.minHeight+(K.maxHeight-K.minHeight)*d:K.minHeight-Z.c,K.heightBuffer&&(K.heightBuffer[C*(K.subdivisions+1)+Q]=A.y),T.push(A.x,A.y,A.z),L.push(0,0,0),O.push(Q/K.subdivisions,1-C/K.subdivisions)}for(C=0;C<K.subdivisions;C++)for(Q=0;Q<K.subdivisions;Q++){const G=Q+1+(C+1)*(K.subdivisions+1),B=Q+1+C*(K.subdivisions+1),L=Q+C*(K.subdivisions+1),f=Q+(C+1)*(K.subdivisions+1),O=T[3*G+1]>=K.minHeight,Y=T[3*B+1]>=K.minHeight,Z=T[3*L+1]>=K.minHeight;O&&Y&&Z&&(A.push(G),A.push(B),A.push(L));T[3*f+1]>=K.minHeight&&O&&Z&&(A.push(f),A.push(G),A.push(L))}f.d.ComputeNormals(T,A,L);const b=new f.d;return b.indices=A,b.uK=T,b.cK=L,b.HK=O,b}function F(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=new C(K,arguments.length>2?arguments[2]:void 0);T._setReady(!1),T._subdivisionsX=A.subdivisionsX||A.subdivisions||1,T._subdivisionsY=A.subdivisionsY||A.subdivisions||1,T._width=A.width||1,T._height=A.height||1,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ;return J(A).pK(T,A.updatable),T._setReady(!0),T}function d(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new L.e(K,T);return b(A).pK(G,A.updatable),G}function N(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=T.width||10,f=T.height||10,O=T.subdivisions||1,Z=T.minHeight||0,x=T.maxHeight||1,J=T.colorFilter||new B.DA(.3,.59,.11),b=T.alphaFilter||0,F=T.updatable,d=T.onReady;G=G||Y.b.LastCreatedScene;const N=new C(K,G);let D;N._subdivisionsX=O,N._subdivisionsY=O,N._width=L,N._height=f,N._maxX=N._width/2,N._maxZ=N._height/2,N._minX=-N._maxX,N._minZ=-N._maxZ,N._setReady(!1),T.passHeightBufferInCallback&&(D=new Float32Array((O+1)*(O+1)));const mK=(K,A,T)=>{P({width:L,height:f,subdivisions:O,minHeight:Z,maxHeight:x,colorFilter:J,buffer:K,bufferWidth:A,bufferHeight:T,alphaFilter:b,heightBuffer:D}).pK(N,F),d&&d(N,D),N._setReady(!0)};if("string"===typeof A){const K=K=>{var A;const T=K.width,B=K.height;if(G.O)return;const L=null===(A=G)||void 0===A?void 0:A.getEngine().resizeImageBitmap(K,T,B);mK(L,T,B)};Q.Tools.LoadImage(A,K,T.onError?T.onError:()=>{},G.offlineProvider)}else mK(A.data,A.width,A.height);return N}f.d.CreateGround=J,f.d.CreateTiledGround=b,f.d.CreateGroundFromHeightMap=P,L.e.CreateGround=(K,A,T,G,B,L)=>F(K,{width:A,height:T,subdivisions:G,updatable:L},B),L.e.CreateTiledGround=(K,A,T,G,B,L,f,O,C)=>d(K,{xmin:A,zmin:T,xmax:G,zmax:B,subdivisions:L,precision:f,updatable:C},O),L.e.CreateGroundFromHeightMap=(K,A,T,G,B,L,f,O,C,Q,Y)=>N(K,A,{width:T,height:G,subdivisions:B,minHeight:L,maxHeight:f,updatable:C,onReady:Q,alphaFilter:Y},O)},14454:(K,A,T)=>{"use strict";T.d(A,{b:()=>J,f:()=>Z,j:()=>x});var G=T(12700),B=T(13147),L=T(13133),f=T(13247),O=T(12768),C=T(12548);function Q(K){const A=[],T=[],G=K.lines,B=K.nK,f=[];let O=0;for(let L=0;L<G.length;L++){const K=G[L];for(let G=0;G<K.length;G++){const{x:C,y:Q,z:Y}=K[G];if(T.push(C,Q,Y),B){const K=B[L],{r:A,g:T,b:O,a:C}=K[G];f.push(A,T,O,C)}G>0&&(A.push(O-1),A.push(O)),O++}}const C=new L.d;return C.indices=A,C.uK=T,B&&(C.nK=f),C}function Y(K){const A=K.dashSize||3,T=K.gapSize||1,B=K.dashNb||200,f=K.points,O=[],C=[],Q=G.PA.Zero();let Y=0,Z=0,x=0,J=0,b=0,P=0,F=0;for(F=0;F<f.length-1;F++)f[F+1].subtractToRef(f[F],Q),Y+=Q.length();for(x=Y/B,J=A*x/(A+T),F=0;F<f.length-1;F++){f[F+1].subtractToRef(f[F],Q),Z=Math.floor(Q.length()/x),Q.normalize();for(let K=0;K<Z;K++)b=x*K,O.push(f[F].x+b*Q.x,f[F].y+b*Q.y,f[F].z+b*Q.z),O.push(f[F].x+(b+J)*Q.x,f[F].y+(b+J)*Q.y,f[F].z+(b+J)*Q.z),C.push(P,P+1),P+=2}const d=new L.d;return d.uK=O,d.indices=C,d}function Z(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=A.instance,B=A.lines,L=A.nK;if(G){const K=G.getVerticesData(O.d.PositionKind);let A,T;L&&(A=G.getVerticesData(O.d.ColorKind));let f=0,C=0;for(let G=0;G<B.length;G++){const O=B[G];for(let B=0;B<O.length;B++)K[f]=O[B].x,K[f+1]=O[B].y,K[f+2]=O[B].z,L&&A&&(T=L[G],A[C]=T[B].r,A[C+1]=T[B].g,A[C+2]=T[B].b,A[C+3]=T[B].a,C+=4),f+=3}return G.updateVerticesData(O.d.PositionKind,K,!1,!1),L&&A&&G.updateVerticesData(O.d.ColorKind,A,!1,!1),G.refreshBoundingInfo(),G}const C=!!L,Y=new f.e(K,T,null,void 0,void 0,C,A.useVertexAlpha,A.material);return Q(A).pK(Y,A.updatable),Y}function x(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=A.nK?[A.nK]:null;return Z(K,{lines:[A.points],updatable:A.updatable,instance:A.instance,nK:G,useVertexAlpha:A.useVertexAlpha,material:A.material},T)}function J(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=A.points,O=A.instance,Q=A.gapSize||1,Z=A.dashSize||3;if(O){const K=K=>{const A=G.PA.Zero(),T=K.length/6;let B=0,f=0,C=0,Q=0,Y=0,Z=0,x=0,J=0;for(x=0;x<L.length-1;x++)L[x+1].subtractToRef(L[x],A),B+=A.length();C=B/T;const b=O._creationDataStorage.dashSize;for(Q=b*C/(b+O._creationDataStorage.gapSize),x=0;x<L.length-1;x++)for(L[x+1].subtractToRef(L[x],A),f=Math.floor(A.length()/C),A.normalize(),J=0;J<f&&Z<K.length;)Y=C*J,K[Z]=L[x].x+Y*A.x,K[Z+1]=L[x].y+Y*A.y,K[Z+2]=L[x].z+Y*A.z,K[Z+3]=L[x].x+(Y+Q)*A.x,K[Z+4]=L[x].y+(Y+Q)*A.y,K[Z+5]=L[x].z+(Y+Q)*A.z,Z+=6,J++;for(;Z<K.length;)K[Z]=L[x].x,K[Z+1]=L[x].y,K[Z+2]=L[x].z,Z+=3};return(A.dashNb||A.dashSize||A.gapSize||A.useVertexAlpha||A.material)&&C.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),O.updateMeshPositions(K,!1),O}const x=new f.e(K,T,null,void 0,void 0,void 0,A.useVertexAlpha,A.material);return Y(A).pK(x,A.updatable),x._creationDataStorage=new B.h,x._creationDataStorage.dashSize=Z,x._creationDataStorage.gapSize=Q,x}L.d.CreateLineSystem=Q,L.d.CreateDashedLines=Y,B.e.sQ=function(K,A){return x(K,{points:A,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},B.e.CreateDashedLines=function(K,A,T,G,B){return J(K,{points:A,dashSize:T,gapSize:G,dashNb:B,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13835:(K,A,T)=>{"use strict";T.d(A,{c:()=>O,g:()=>C});var G=T(13147),B=T(13133),L=T(12754);function f(K){const A=[],T=[],G=[],f=[],O=void 0!==K.width?K.width:void 0!==K.size?K.size:1,C=void 0!==K.height?K.height:void 0!==K.size?K.size:1,Q=0===K.sideOrientation?0:K.sideOrientation||B.d.DEFAULTSIDE,Y=O/2,Z=C/2;T.push(-Y,-Z,0),G.push(0,0,-1),f.push(0,L.d?1:0),T.push(Y,-Z,0),G.push(0,0,-1),f.push(1,L.d?1:0),T.push(Y,Z,0),G.push(0,0,-1),f.push(1,L.d?0:1),T.push(-Y,Z,0),G.push(0,0,-1),f.push(0,L.d?0:1),A.push(0),A.push(1),A.push(2),A.push(0),A.push(2),A.push(3),B.d._ComputeSides(Q,T,A,G,f,K.frontUVs,K.backUVs);const x=new B.d;return x.indices=A,x.uK=T,x.cK=G,x.HK=f,x}function O(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new G.e(K,T);A.sideOrientation=G.e._GetDefaultSideOrientation(A.sideOrientation),B._originalBuilderSideOrientation=A.sideOrientation;return f(A).pK(B,A.updatable),A.sourcePlane&&(B.translate(A.sourcePlane.normal,-A.sourcePlane.d),B.setDirection(A.sourcePlane.normal.scale(-1))),B}const C={vQ:O};B.d.vQ=f,G.e.vQ=(K,A,T,G,B)=>O(K,{size:A,width:A,height:A,sideOrientation:B,updatable:G},T)},13916:(K,A,T)=>{"use strict";T.d(A,{d:()=>C});var G=T(12700),B=T(13147),L=T(13133),f=T(12754);function O(K){const A=0|(K.segments||32),T=K.diameterX||K.diameter||1,B=K.diameterY||K.diameter||1,O=K.diameterZ||K.diameter||1,C=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,Q=K.slice&&K.slice<=0?1:K.slice||1,Y=0===K.sideOrientation?0:K.sideOrientation||L.d.DEFAULTSIDE,Z=!!K.dedupTopBottomIndices,x=new G.PA(T/2,B/2,O/2),J=2+A,b=2*J,P=[],F=[],d=[],N=[];for(let L=0;L<=J;L++){const K=L/J,A=K*Math.PI*Q;for(let T=0;T<=b;T++){const B=T/b,L=B*Math.PI*2*C,O=G.Matrix.RotationZ(-A),Q=G.Matrix.RotationY(L),Y=G.PA.TransformCoordinates(G.PA.Up(),O),Z=G.PA.TransformCoordinates(Y,Q),J=Z.multiply(x),P=Z.divide(x).normalize();F.push(J.x,J.y,J.z),d.push(P.x,P.y,P.z),N.push(B,f.d?1-K:K)}if(L>0){const K=F.length/3;for(let A=K-2*(b+1);A+b+2<K;A++)Z?(L>1&&(P.push(A),P.push(A+1),P.push(A+b+1)),(L<J||Q<1)&&(P.push(A+b+1),P.push(A+1),P.push(A+b+2))):(P.push(A),P.push(A+1),P.push(A+b+1),P.push(A+b+1),P.push(A+1),P.push(A+b+2))}}L.d._ComputeSides(Y,F,P,d,N,K.frontUVs,K.backUVs);const D=new L.d;return D.indices=P,D.uK=F,D.cK=d,D.HK=N,D}function C(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return O(A).pK(G,A.updatable),G}L.d.CreateSphere=O,B.e.CreateSphere=(K,A,T,G,B,L)=>C(K,{segments:A,diameterX:T,diameterY:T,diameterZ:T,sideOrientation:L,updatable:B},G)},14891:(K,A,T)=>{"use strict";T.d(A,{d:()=>O});var G=T(13272),B=T(14201),L=T(13286),f=T(13133);class O{static get Configuration(){return{get decoder(){return B.d.DefaultConfiguration},set decoder(K){B.d.DefaultConfiguration=K}}}static set Configuration(K){B.d.DefaultConfiguration=K.decoder}static get DecoderAvailable(){return(0,G.f)(B.d.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(K){O._Default&&(K||O._Default.dispose(),O._Default=null)}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultNumWorkers;const A="number"===typeof K?{...B.d.DefaultConfiguration,numWorkers:K}:{...B.d.DefaultConfiguration,...K};this._decoder=new B.d(A)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(K,A,T){return this._decoder.decodeMeshToMeshDataAsync(K,A,T)}async decodeMeshToGeometryAsync(K,A,T,G){return await this._decoder.decodeMeshToGeometryAsync(K,A,T,G)}async _decodeMeshToGeometryForGltfAsync(K,A,T,G,B,L){return await this._decoder._decodeMeshToGeometryForGltfAsync(K,A,T,G,B,L)}async decodeMeshAsync(K,A){const T=await this._decoder.decodeMeshToMeshDataAsync(K,A),G=new f.d;T.indices&&(G.indices=T.indices);for(const B of T.attributes){const K=L.c.GetFloatData(B.data,B.size,L.c.GetDataType(B.data),B.byteOffset,B.byteStride,B.normalized,T.totalVertices);G.set(K,B.kind)}return G}}O.DefaultNumWorkers=(0,G.e)(),O._Default=null},14201:(K,A,T)=>{"use strict";T.d(A,{d:()=>Q});var G=T(13272),B=T(12526),L=T(13163),f=T(13286),O=T(12548),C=T(13283);class Q extends G.c{static get DefaultAvailable(){return(0,G.f)(Q.DefaultConfiguration)}static get Default(){return Q._Default??(Q._Default=new Q),Q._Default}static ResetDefault(K){Q._Default&&(K||Q._Default.dispose(),Q._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(K,A){return{module:await(A||DracoDecoderModule)({wasmBinary:K})}}_getWorkerContent(){return`${C.b}(${C.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.DefaultConfiguration)}decodeMeshToMeshDataAsync(K,A,T){const G=K instanceof ArrayBuffer?new Int8Array(K):new Int8Array(K.buffer,K.byteOffset,K.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async K=>await new Promise(((B,L)=>{K.push(((K,f)=>{let C=null;const Q=[],Y=A=>{K.removeEventListener("error",Y),K.removeEventListener("message",Z),L(A),f()},Z=A=>{const G=A.data;switch(G.id){case"indices":C=G.data;break;case"attribute":Q.push({kind:G.kind,data:G.data,size:G.size,byteOffset:G.byteOffset,byteStride:G.byteStride,normalized:(L=G.kind,x=G.normalized,T&&void 0!==T[L]?(x!==T[L]&&O.d.Warn(`Normalized flag from Draco data (${x}) does not match normalized flag from glTF accessor (${T[L]}). Using flag from glTF accessor.`),T[L]):x)});break;case"decodeMeshDone":K.removeEventListener("error",Y),K.removeEventListener("message",Z),B({indices:C,attributes:Q,totalVertices:G.totalVertices}),f()}var L,x};K.addEventListener("error",Y),K.addEventListener("message",Z);const x=G.slice();K.postMessage({id:"decodeMesh",dataView:x,attributes:A},[x.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((K=>{let T=null;const B=[],L=(0,C.b)(K.module,G,A,(K=>{T=K}),((K,A,T,G,L,f)=>{B.push({kind:K,data:A,size:T,byteOffset:G,byteStride:L,normalized:f})}));return{indices:T,attributes:B,totalVertices:L}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(K,A,T,G){const B=await this.decodeMeshToMeshDataAsync(T,G),O=new L.b(K,A);B.indices&&O.setIndices(B.indices);for(const L of B.attributes)O.setVerticesBuffer(new f.c(A.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),B.totalVertices);return O}async _decodeMeshToGeometryForGltfAsync(K,A,T,G,B,O){const C=await this.decodeMeshToMeshDataAsync(T,G,B),Q=new L.b(K,A);O&&(Q._boundingInfo=O,Q.useBoundingInfoFromGeometry=!0),C.indices&&Q.setIndices(C.indices);for(const L of C.attributes)Q.setVerticesBuffer(new f.c(A.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),C.totalVertices);return Q}}Q.DefaultConfiguration={wasmUrl:`${B.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},Q._Default=null},14445:(K,A,T)=>{"use strict";T.d(A,{b:()=>OK});var G=T(12700),B=T(13147),L=T(12768),f=T(13133),O=T(12754);function C(K){let A=K.pathArray;const T=K.closeArray||!1,G=K.closePath||!1,B=K.invertUV||!1,C=Math.floor(A[0].length/2);let Q=K.offset||C;Q=Q>C?C:Math.floor(Q);const Y=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,Z=K.HK,x=K.nK,J=[],b=[],P=[],F=[],d=[],N=[],D=[],mK=[];let U;const z=[],g=[];let S,l,u;if(A.length<2){const K=[],T=[];for(l=0;l<A[0].length-Q;l++)K.push(A[0][l]),T.push(A[0][l+Q]);A=[K,T]}let c=0;const n=G?1:0,H=T?1:0;let e,p,r,h,k,s;for(U=A[0].length,S=0;S<A.length+H;S++){for(D[S]=0,d[S]=[0],e=S===A.length?A[0]:A[S],p=e.length,U=U<p?U:p,u=0;u<p;)J.push(e[u].x,e[u].y,e[u].z),u>0&&(r=e[u].FA(e[u-1]).length(),h=r+D[S],d[S].push(h),D[S]=h),u++;G&&(u--,J.push(e[0].x,e[0].y,e[0].z),r=e[u].FA(e[0]).length(),h=r+D[S],d[S].push(h),D[S]=h),z[S]=p+n,g[S]=c,c+=p+n}let j,R,v=null,I=null;for(l=0;l<U+n;l++)for(mK[l]=0,N[l]=[0],S=0;S<A.length-1+H;S++)k=A[S],s=S===A.length-1?A[0]:A[S+1],l===U?(v=k[0],I=s[0]):(v=k[l],I=s[l]),r=I.FA(v).length(),h=r+mK[l],N[l].push(h),mK[l]=h;if(Z)for(S=0;S<Z.length;S++)F.push(Z[S].x,O.d?1-Z[S].y:Z[S].y);else for(S=0;S<A.length+H;S++)for(l=0;l<U+n;l++)j=0!=D[S]?d[S][l]/D[S]:0,R=0!=mK[l]?N[l][S]/mK[l]:0,B?F.push(R,j):F.push(j,O.d?1-R:R);S=0;let o=0,W=z[S]-1,i=z[S+1]-1,V=W<i?W:i,X=g[1]-g[0];const q=z.length-1;for(;o<=V&&S<q;)b.push(o,o+X,o+1),b.push(o+X+1,o+1,o+X),o+=1,o===V&&(S++,X=g[S+1]-g[S],W=z[S]-1,i=z[S+1]-1,o=g[S],V=W<i?W+o:i+o);if(f.d.ComputeNormals(J,b,P),G){let K=0,T=0;for(S=0;S<A.length;S++){K=3*g[S],T=S+1<A.length?3*(g[S+1]-1):P.length-3,P[K]=.5*(P[K]+P[T]),P[K+1]=.5*(P[K+1]+P[T+1]),P[K+2]=.5*(P[K+2]+P[T+2]);const G=Math.sqrt(P[K]*P[K]+P[K+1]*P[K+1]+P[K+2]*P[K+2]);P[K]/=G,P[K+1]/=G,P[K+2]/=G,P[T]=P[K],P[T+1]=P[K+1],P[T+2]=P[K+2]}}if(T){let K=3*g[0],T=3*g[A.length];for(l=0;l<U+n;l++){P[K]=.5*(P[K]+P[T]),P[K+1]=.5*(P[K+1]+P[T+1]),P[K+2]=.5*(P[K+2]+P[T+2]);const A=Math.sqrt(P[K]*P[K]+P[K+1]*P[K+1]+P[K+2]*P[K+2]);P[K]/=A,P[K+1]/=A,P[K+2]/=A,P[T]=P[K],P[T+1]=P[K+1],P[T+2]=P[K+2],K+=3,T+=3}}f.d._ComputeSides(Y,J,b,P,F,K.frontUVs,K.backUVs);let y=null;if(x){y=new Float32Array(4*x.length);for(let K=0;K<x.length;K++)y[4*K]=x[K].r,y[4*K+1]=x[K].g,y[4*K+2]=x[K].b,y[4*K+3]=x[K].a}const w=new f.d,a=new Float32Array(J),M=new Float32Array(P),E=new Float32Array(F);return w.indices=b,w.uK=a,w.cK=M,w.HK=E,y&&w.set(y,L.d.ColorKind),G&&(w._idx=g),w}function Q(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=A.pathArray,Y=A.closeArray,Z=A.closePath,x=B.e._GetDefaultSideOrientation(A.sideOrientation),J=A.instance,b=A.updatable;if(J){const K=G.TmpVectors.PA[0].IO(Number.MAX_VALUE),T=G.TmpVectors.PA[1].IO(-Number.MAX_VALUE),C=A=>{let G=Q[0].length;const L=J;let f=0;const O=L._originalBuilderSideOrientation===B.e.DOUBLESIDE?2:1;for(let B=1;B<=O;++B)for(let O=0;O<Q.length;++O){const B=Q[O],C=B.length;G=G<C?G:C;for(let L=0;L<G;++L){const G=B[L];A[f]=G.x,A[f+1]=G.y,A[f+2]=G.z,K.minimizeInPlaceFromFloats(G.x,G.y,G.z),T.maximizeInPlaceFromFloats(G.x,G.y,G.z),f+=3}if(L._creationDataStorage&&L._creationDataStorage.closePath){const K=B[0];A[f]=K.x,A[f+1]=K.y,A[f+2]=K.z,f+=3}}},Y=J.getVerticesData(L.d.PositionKind);if(C(Y),J.hasBoundingInfo?J.getBoundingInfo().reConstruct(K,T,J._worldMatrix):J.buildBoundingInfo(K,T,J._worldMatrix),J.updateVerticesData(L.d.PositionKind,Y,!1,!1),A.nK){const K=J.getVerticesData(L.d.ColorKind);for(let T=0,G=0;T<A.nK.length;T++,G+=4){const B=A.nK[T];K[G]=B.r,K[G+1]=B.g,K[G+2]=B.b,K[G+3]=B.a}J.updateVerticesData(L.d.ColorKind,K,!1,!1)}if(A.HK){const K=J.getVerticesData(L.d.UVKind);for(let T=0;T<A.HK.length;T++)K[2*T]=A.HK[T].x,K[2*T+1]=O.d?1-A.HK[T].y:A.HK[T].y;J.updateVerticesData(L.d.UVKind,K,!1,!1)}if(!J.areNormalsFrozen||J.isFacetDataEnabled){const K=J.Ef(),A=J.getVerticesData(L.d.NormalKind),T=J.isFacetDataEnabled?J.getFacetDataParameters():null;if(f.d.ComputeNormals(Y,K,A,T),J._creationDataStorage&&J._creationDataStorage.closePath){let K=0,T=0;for(let G=0;G<Q.length;G++)K=3*J._creationDataStorage.idx[G],T=G+1<Q.length?3*(J._creationDataStorage.idx[G+1]-1):A.length-3,A[K]=.5*(A[K]+A[T]),A[K+1]=.5*(A[K+1]+A[T+1]),A[K+2]=.5*(A[K+2]+A[T+2]),A[T]=A[K],A[T+1]=A[K+1],A[T+2]=A[K+2]}J.areNormalsFrozen||J.updateVerticesData(L.d.NormalKind,A,!1,!1)}return J}{const G=new B.e(K,T);G._originalBuilderSideOrientation=x,G._creationDataStorage=new B.h;const L=C(A);return Z&&(G._creationDataStorage.idx=L._idx),G._creationDataStorage.closePath=Z,G._creationDataStorage.closeArray=Y,L.pK(G,b),G}}f.d.CreateRibbon=C,B.e.CreateRibbon=function(K,A){return Q(K,{pathArray:A,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Y=T(13930),Z=T(13791),x=T(12743);function J(K){const A=K.pattern||B.e.NO_FLIP,T=K.tileWidth||K.tileSize||1,G=K.tileHeight||K.tileSize||1,L=K.alignHorizontal||0,O=K.alignVertical||0,C=K.width||K.size||1,Q=Math.floor(C/T);let Y=C-Q*T;const Z=K.height||K.size||1,x=Math.floor(Z/G);let J=Z-x*G;const b=T*Q/2,P=G*x/2;let F=0,d=0,N=0,D=0,mK=0,U=0;if(Y>0||J>0){switch(N=-b,D=-P,mK=b,U=P,L){case B.e.CENTER:Y/=2,N-=Y,mK+=Y;break;case B.e.LEFT:mK+=Y,F=-Y/2;break;case B.e.RIGHT:N-=Y,F=Y/2}switch(O){case B.e.CENTER:J/=2,D-=J,U+=J;break;case B.e.BOTTOM:U+=J,d=-J/2;break;case B.e.TOP:D-=J,d=J/2}}const z=[],g=[],S=[];S[0]=[0,0,1,0,1,1,0,1],S[1]=[0,0,1,0,1,1,0,1],A!==B.e.ROTATE_TILE&&A!==B.e.ROTATE_ROW||(S[1]=[1,1,0,1,0,0,1,0]),A!==B.e.FLIP_TILE&&A!==B.e.FLIP_ROW||(S[1]=[1,0,0,0,0,1,1,1]),A!==B.e.FLIP_N_ROTATE_TILE&&A!==B.e.FLIP_N_ROTATE_ROW||(S[1]=[0,1,1,1,1,0,0,0]);let l=[];const u=[],c=[];let n=0;for(let f=0;f<x;f++)for(let K=0;K<Q;K++)z.push(K*T-b+F,f*G-P+d,0),z.push((K+1)*T-b+F,f*G-P+d,0),z.push((K+1)*T-b+F,(f+1)*G-P+d,0),z.push(K*T-b+F,(f+1)*G-P+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),l=A===B.e.FLIP_TILE||A===B.e.ROTATE_TILE||A===B.e.FLIP_N_ROTATE_TILE?l.concat(S[(K%2+f%2)%2]):A===B.e.FLIP_ROW||A===B.e.ROTATE_ROW||A===B.e.FLIP_N_ROTATE_ROW?l.concat(S[f%2]):l.concat(S[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),n+=4;if(Y>0||J>0){const K=J>0&&(O===B.e.CENTER||O===B.e.TOP),f=J>0&&(O===B.e.CENTER||O===B.e.BOTTOM),C=Y>0&&(L===B.e.CENTER||L===B.e.RIGHT),Z=Y>0&&(L===B.e.CENTER||L===B.e.LEFT);let S,H,e,p,r=[];if(K&&C&&(z.push(N+F,D+d,0),z.push(-b+F,D+d,0),z.push(-b+F,D+J+d,0),z.push(N+F,D+J+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,S=1-Y/T,H=1-J/G,e=1,p=1,r=[S,H,e,H,e,p,S,p],A===B.e.ROTATE_ROW&&(r=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),A===B.e.FLIP_ROW&&(r=[1-S,H,1-e,H,1-e,p,1-S,p]),A===B.e.FLIP_N_ROTATE_ROW&&(r=[S,1-H,e,1-H,e,1-p,S,1-p]),l=l.concat(r),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&Z&&(z.push(b+F,D+d,0),z.push(mK+F,D+d,0),z.push(mK+F,D+J+d,0),z.push(b+F,D+J+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,S=0,H=1-J/G,e=Y/T,p=1,r=[S,H,e,H,e,p,S,p],(A===B.e.ROTATE_ROW||A===B.e.ROTATE_TILE&&Q%2===0)&&(r=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),(A===B.e.FLIP_ROW||A===B.e.FLIP_TILE&&Q%2===0)&&(r=[1-S,H,1-e,H,1-e,p,1-S,p]),(A===B.e.FLIP_N_ROTATE_ROW||A===B.e.FLIP_N_ROTATE_TILE&&Q%2===0)&&(r=[S,1-H,e,1-H,e,1-p,S,1-p]),l=l.concat(r),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&C&&(z.push(N+F,P+d,0),z.push(-b+F,P+d,0),z.push(-b+F,U+d,0),z.push(N+F,U+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,S=1-Y/T,H=0,e=1,p=J/G,r=[S,H,e,H,e,p,S,p],(A===B.e.ROTATE_ROW&&x%2===1||A===B.e.ROTATE_TILE&&x%1===0)&&(r=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),(A===B.e.FLIP_ROW&&x%2===1||A===B.e.FLIP_TILE&&x%2===0)&&(r=[1-S,H,1-e,H,1-e,p,1-S,p]),(A===B.e.FLIP_N_ROTATE_ROW&&x%2===1||A===B.e.FLIP_N_ROTATE_TILE&&x%2===0)&&(r=[S,1-H,e,1-H,e,1-p,S,1-p]),l=l.concat(r),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&Z&&(z.push(b+F,P+d,0),z.push(mK+F,P+d,0),z.push(mK+F,U+d,0),z.push(b+F,U+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,S=0,H=0,e=Y/T,p=J/G,r=[S,H,e,H,e,p,S,p],(A===B.e.ROTATE_ROW&&x%2===1||A===B.e.ROTATE_TILE&&(x+Q)%2===1)&&(r=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),(A===B.e.FLIP_ROW&&x%2===1||A===B.e.FLIP_TILE&&(x+Q)%2===1)&&(r=[1-S,H,1-e,H,1-e,p,1-S,p]),(A===B.e.FLIP_N_ROTATE_ROW&&x%2===1||A===B.e.FLIP_N_ROTATE_TILE&&(x+Q)%2===1)&&(r=[S,1-H,e,1-H,e,1-p,S,1-p]),l=l.concat(r),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K){const K=[];S=0,H=1-J/G,e=1,p=1,K[0]=[S,H,e,H,e,p,S,p],K[1]=[S,H,e,H,e,p,S,p],A!==B.e.ROTATE_TILE&&A!==B.e.ROTATE_ROW||(K[1]=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),A!==B.e.FLIP_TILE&&A!==B.e.FLIP_ROW||(K[1]=[1-S,H,1-e,H,1-e,p,1-S,p]),A!==B.e.FLIP_N_ROTATE_TILE&&A!==B.e.FLIP_N_ROTATE_ROW||(K[1]=[S,1-H,e,1-H,e,1-p,S,1-p]);for(let G=0;G<Q;G++)z.push(G*T-b+F,D+d,0),z.push((G+1)*T-b+F,D+d,0),z.push((G+1)*T-b+F,D+J+d,0),z.push(G*T-b+F,D+J+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,l=A===B.e.FLIP_TILE||A===B.e.ROTATE_TILE||A===B.e.FLIP_N_ROTATE_TILE?l.concat(K[(G+1)%2]):A===B.e.FLIP_ROW||A===B.e.ROTATE_ROW||A===B.e.FLIP_N_ROTATE_ROW?l.concat(K[1]):l.concat(K[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(f){const K=[];S=0,H=0,e=1,p=J/G,K[0]=[S,H,e,H,e,p,S,p],K[1]=[S,H,e,H,e,p,S,p],A!==B.e.ROTATE_TILE&&A!==B.e.ROTATE_ROW||(K[1]=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),A!==B.e.FLIP_TILE&&A!==B.e.FLIP_ROW||(K[1]=[1-S,H,1-e,H,1-e,p,1-S,p]),A!==B.e.FLIP_N_ROTATE_TILE&&A!==B.e.FLIP_N_ROTATE_ROW||(K[1]=[S,1-H,e,1-H,e,1-p,S,1-p]);for(let G=0;G<Q;G++)z.push(G*T-b+F,U-J+d,0),z.push((G+1)*T-b+F,U-J+d,0),z.push((G+1)*T-b+F,U+d,0),z.push(G*T-b+F,U+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,l=A===B.e.FLIP_TILE||A===B.e.ROTATE_TILE||A===B.e.FLIP_N_ROTATE_TILE?l.concat(K[(G+x)%2]):A===B.e.FLIP_ROW||A===B.e.ROTATE_ROW||A===B.e.FLIP_N_ROTATE_ROW?l.concat(K[x%2]):l.concat(K[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const K=[];S=1-Y/T,H=0,e=1,p=1,K[0]=[S,H,e,H,e,p,S,p],K[1]=[S,H,e,H,e,p,S,p],A!==B.e.ROTATE_TILE&&A!==B.e.ROTATE_ROW||(K[1]=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),A!==B.e.FLIP_TILE&&A!==B.e.FLIP_ROW||(K[1]=[1-S,H,1-e,H,1-e,p,1-S,p]),A!==B.e.FLIP_N_ROTATE_TILE&&A!==B.e.FLIP_N_ROTATE_ROW||(K[1]=[S,1-H,e,1-H,e,1-p,S,1-p]);for(let T=0;T<x;T++)z.push(N+F,T*G-P+d,0),z.push(N+Y+F,T*G-P+d,0),z.push(N+Y+F,(T+1)*G-P+d,0),z.push(N+F,(T+1)*G-P+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,l=A===B.e.FLIP_TILE||A===B.e.ROTATE_TILE||A===B.e.FLIP_N_ROTATE_TILE?l.concat(K[(T+1)%2]):A===B.e.FLIP_ROW||A===B.e.ROTATE_ROW||A===B.e.FLIP_N_ROTATE_ROW?l.concat(K[T%2]):l.concat(K[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const K=[];S=0,H=0,e=Y/G,p=1,K[0]=[S,H,e,H,e,p,S,p],K[1]=[S,H,e,H,e,p,S,p],A!==B.e.ROTATE_TILE&&A!==B.e.ROTATE_ROW||(K[1]=[1-S,1-H,1-e,1-H,1-e,1-p,1-S,1-p]),A!==B.e.FLIP_TILE&&A!==B.e.FLIP_ROW||(K[1]=[1-S,H,1-e,H,1-e,p,1-S,p]),A!==B.e.FLIP_N_ROTATE_TILE&&A!==B.e.FLIP_N_ROTATE_ROW||(K[1]=[S,1-H,e,1-H,e,1-p,S,1-p]);for(let T=0;T<x;T++)z.push(mK-Y+F,T*G-P+d,0),z.push(mK+F,T*G-P+d,0),z.push(mK+F,(T+1)*G-P+d,0),z.push(mK-Y+F,(T+1)*G-P+d,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,l=A===B.e.FLIP_TILE||A===B.e.ROTATE_TILE||A===B.e.FLIP_N_ROTATE_TILE?l.concat(K[(T+Q)%2]):A===B.e.FLIP_ROW||A===B.e.ROTATE_ROW||A===B.e.FLIP_N_ROTATE_ROW?l.concat(K[T%2]):l.concat(K[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const H=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE;f.d._ComputeSides(H,z,c,g,l,K.frontUVs,K.backUVs);const e=new f.d;e.indices=c,e.uK=z,e.cK=g,e.HK=l;const p=H===f.d.DOUBLESIDE?u.concat(u):u;return e.nK=p,e}function b(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return J(A).pK(G,A.updatable),G}function P(K){const A=K.faceUV||new Array(6),T=K.faceColors,L=K.pattern||B.e.NO_FLIP,C=K.width||K.size||1,Q=K.height||K.size||1,Y=K.depth||K.size||1,Z=K.tileWidth||K.tileSize||1,b=K.tileHeight||K.tileSize||1,P=K.alignHorizontal||0,F=K.alignVertical||0,d=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE;for(let B=0;B<6;B++)void 0===A[B]&&(A[B]=new G.Vector4(0,0,1,1)),T&&void 0===T[B]&&(T[B]=new x.oO(1,1,1,1));const N=C/2,D=Q/2,mK=Y/2,U=[];for(let G=0;G<2;G++)U[G]=J({pattern:L,tileWidth:Z,tileHeight:b,width:C,height:Q,alignVertical:F,alignHorizontal:P,sideOrientation:d});for(let G=2;G<4;G++)U[G]=J({pattern:L,tileWidth:Z,tileHeight:b,width:Y,height:Q,alignVertical:F,alignHorizontal:P,sideOrientation:d});let z=F;F===B.e.BOTTOM?z=B.e.TOP:F===B.e.TOP&&(z=B.e.BOTTOM);for(let G=4;G<6;G++)U[G]=J({pattern:L,tileWidth:Z,tileHeight:b,width:C,height:Y,alignVertical:z,alignHorizontal:P,sideOrientation:d});let g=[],S=[],l=[],u=[];const c=[],n=[],H=[],e=[];let p=0,r=0;for(let B=0;B<6;B++){const K=U[B].uK.length;n[B]=[],H[B]=[];for(let A=0;A<K/3;A++)n[B].push(new G.PA(U[B].uK[3*A],U[B].uK[3*A+1],U[B].uK[3*A+2])),H[B].push(new G.PA(U[B].cK[3*A],U[B].cK[3*A+1],U[B].cK[3*A+2]));p=U[B].HK.length,e[B]=[];for(let T=0;T<p;T+=2)e[B][T]=A[B].x+(A[B].z-A[B].x)*U[B].HK[T],e[B][T+1]=A[B].y+(A[B].w-A[B].y)*U[B].HK[T+1],O.d&&(e[B][T+1]=1-e[B][T+1]);if(l=l.concat(e[B]),u=u.concat(U[B].indices.map((K=>K+r))),r+=n[B].length,T)for(let A=0;A<4;A++)c.push(T[B].r,T[B].g,T[B].b,T[B].a)}const h=new G.PA(0,0,mK),k=G.Matrix.RotationY(Math.PI);g=n[0].map((K=>G.PA.TransformNormal(K,k).add(h))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[]),S=H[0].map((K=>G.PA.TransformNormal(K,k))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[]),g=g.concat(n[1].map((K=>K.FA(h))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[])),S=S.concat(H[1].map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[]));const s=new G.PA(N,0,0),j=G.Matrix.RotationY(-Math.PI/2);g=g.concat(n[2].map((K=>G.PA.TransformNormal(K,j).add(s))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[])),S=S.concat(H[2].map((K=>G.PA.TransformNormal(K,j))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[]));const R=G.Matrix.RotationY(Math.PI/2);g=g.concat(n[3].map((K=>G.PA.TransformNormal(K,R).FA(s))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[])),S=S.concat(H[3].map((K=>G.PA.TransformNormal(K,R))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[]));const v=new G.PA(0,D,0),I=G.Matrix.RotationX(Math.PI/2);g=g.concat(n[4].map((K=>G.PA.TransformNormal(K,I).add(v))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[])),S=S.concat(H[4].map((K=>G.PA.TransformNormal(K,I))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[]));const o=G.Matrix.RotationX(-Math.PI/2);g=g.concat(n[5].map((K=>G.PA.TransformNormal(K,o).FA(v))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[])),S=S.concat(H[5].map((K=>G.PA.TransformNormal(K,o))).map((K=>[K.x,K.y,K.z])).reduce(((K,A)=>K.concat(A)),[])),f.d._ComputeSides(d,g,u,S,l);const W=new f.d;if(W.indices=u,W.uK=g,W.cK=S,W.HK=l,T){const K=d===f.d.DOUBLESIDE?c.concat(c):c;W.nK=K}return W}function F(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return P(A).pK(G,A.updatable),G}f.d.CreateTiledPlane=J;f.d.CreateTiledBox=P;var d=T(13916),N=T(12931),D=T(12895);function mK(K){const A=K.height||2;let T=0===K.diameterTop?0:K.diameterTop||K.diameter||1,L=0===K.diameterBottom?0:K.diameterBottom||K.diameter||1;T=T||1e-5,L=L||1e-5;const C=0|(K.tessellation||24),Q=0|(K.subdivisions||1),Y=!!K.hasRings,Z=!!K.enclose,J=0===K.cap?0:K.cap||B.e.CAP_ALL,b=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,P=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,F=K.faceUV||new Array(3),d=K.faceColors,N=2+(1+(1!==b&&Z?2:0))*(Y?Q:1);let mK;for(mK=0;mK<N;mK++)d&&void 0===d[mK]&&(d[mK]=new x.oO(1,1,1,1));for(mK=0;mK<N;mK++)F&&void 0===F[mK]&&(F[mK]=new G.Vector4(0,0,1,1));const U=[],z=[],g=[],S=[],l=[],u=2*Math.PI*b/C;let c,n,H;const e=(L-T)/2/A,p=G.PA.Zero(),r=G.PA.Zero(),h=G.PA.Zero(),k=G.PA.Zero(),s=G.PA.Zero(),j=D.e.Y;let R,v,I,o=1,W=1,i=0,V=0;for(R=0;R<=Q;R++)for(n=R/Q,H=(n*(T-L)+L)/2,o=Y&&0!==R&&R!==Q?2:1,I=0;I<o;I++){for(Y&&(W+=I),Z&&(W+=2*I),v=0;v<=C;v++)c=v*u,p.x=Math.cos(-c)*H,p.y=-A/2+n*A,p.z=Math.sin(-c)*H,0===T&&R===Q?(r.x=g[g.length-3*(C+1)],r.y=g[g.length-3*(C+1)+1],r.z=g[g.length-3*(C+1)+2]):(r.x=p.x,r.z=p.z,r.y=Math.sqrt(r.x*r.x+r.z*r.z)*e,r.normalize()),0===v&&(h.G(p),k.G(r)),z.push(p.x,p.y,p.z),g.push(r.x,r.y,r.z),V=Y?i!==W?F[W].y:F[W].w:F[W].y+(F[W].w-F[W].y)*n,S.push(F[W].x+(F[W].z-F[W].x)*v/C,O.d?1-V:V),d&&l.push(d[W].r,d[W].g,d[W].b,d[W].a);1!==b&&Z&&(z.push(p.x,p.y,p.z),z.push(0,p.y,0),z.push(0,p.y,0),z.push(h.x,h.y,h.z),G.PA.CrossToRef(j,r,s),s.normalize(),g.push(s.x,s.y,s.z,s.x,s.y,s.z),G.PA.CrossToRef(k,j,s),s.normalize(),g.push(s.x,s.y,s.z,s.x,s.y,s.z),V=Y?i!==W?F[W+1].y:F[W+1].w:F[W+1].y+(F[W+1].w-F[W+1].y)*n,S.push(F[W+1].x,O.d?1-V:V),S.push(F[W+1].z,O.d?1-V:V),V=Y?i!==W?F[W+2].y:F[W+2].w:F[W+2].y+(F[W+2].w-F[W+2].y)*n,S.push(F[W+2].x,O.d?1-V:V),S.push(F[W+2].z,O.d?1-V:V),d&&(l.push(d[W+1].r,d[W+1].g,d[W+1].b,d[W+1].a),l.push(d[W+1].r,d[W+1].g,d[W+1].b,d[W+1].a),l.push(d[W+2].r,d[W+2].g,d[W+2].b,d[W+2].a),l.push(d[W+2].r,d[W+2].g,d[W+2].b,d[W+2].a))),i!==W&&(i=W)}const X=1!==b&&Z?C+4:C;for(R=0,W=0;W<Q;W++){let K=0,A=0,T=0,G=0;for(v=0;v<C;v++)K=R*(X+1)+v,A=(R+1)*(X+1)+v,T=R*(X+1)+(v+1),G=(R+1)*(X+1)+(v+1),U.push(K,A,T),U.push(G,T,A);1!==b&&Z&&(U.push(K+2,A+2,T+2),U.push(G+2,T+2,A+2),U.push(K+4,A+4,T+4),U.push(G+4,T+4,A+4)),R=Y?R+2:R+1}const q=K=>{const B=K?T/2:L/2;if(0===B)return;let f,Q,Y;const Z=K?F[N-1]:F[0];let x=null;d&&(x=K?d[N-1]:d[0]);const J=z.length/3,P=K?A/2:-A/2,D=new G.PA(0,P,0);z.push(D.x,D.y,D.z),g.push(0,K?1:-1,0);const mK=Z.y+.5*(Z.w-Z.y);S.push(Z.x+.5*(Z.z-Z.x),O.d?1-mK:mK),x&&l.push(x.r,x.g,x.b,x.a);const u=new G.Vector2(.5,.5);for(Y=0;Y<=C;Y++){f=2*Math.PI*Y*b/C;const A=Math.cos(-f),T=Math.sin(-f);Q=new G.PA(A*B,P,T*B);const L=new G.Vector2(A*u.x+.5,T*u.y+.5);z.push(Q.x,Q.y,Q.z),g.push(0,K?1:-1,0);const J=Z.y+(Z.w-Z.y)*L.y;S.push(Z.x+(Z.z-Z.x)*L.x,O.d?1-J:J),x&&l.push(x.r,x.g,x.b,x.a)}for(Y=0;Y<C;Y++)K?(U.push(J),U.push(J+(Y+2)),U.push(J+(Y+1))):(U.push(J),U.push(J+(Y+1)),U.push(J+(Y+2)))};J!==B.e.CAP_START&&J!==B.e.CAP_ALL||q(!1),J!==B.e.CAP_END&&J!==B.e.CAP_ALL||q(!0),f.d._ComputeSides(P,z,U,g,S,K.frontUVs,K.backUVs);const y=new f.d;return y.indices=U,y.uK=z,y.cK=g,y.HK=S,d&&(y.nK=l),y}function U(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return mK(A).pK(G,A.updatable),G}function z(K){const A=[],T=[],B=[],L=[],C=K.diameter||1,Q=K.thickness||.5,Y=0|(K.tessellation||16),Z=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,x=Y+1;for(let f=0;f<=Y;f++){const K=f/Y,Z=f*Math.PI*2/Y-Math.PI/2,J=G.Matrix.Translation(C/2,0,0).multiply(G.Matrix.RotationY(Z));for(let C=0;C<=Y;C++){const Z=1-C/Y,b=C*Math.PI*2/Y+Math.PI,P=Math.cos(b),F=Math.sin(b);let d=new G.PA(P,F,0),N=d.scale(Q/2);const D=new G.Vector2(K,Z);N=G.PA.TransformCoordinates(N,J),d=G.PA.TransformNormal(d,J),T.push(N.x,N.y,N.z),B.push(d.x,d.y,d.z),L.push(D.x,O.d?1-D.y:D.y);const mK=(f+1)%x,U=(C+1)%x;A.push(f*x+C),A.push(f*x+U),A.push(mK*x+C),A.push(f*x+U),A.push(mK*x+U),A.push(mK*x+C)}}f.d._ComputeSides(Z,T,A,B,L,K.frontUVs,K.backUVs);const J=new f.d;return J.indices=A,J.uK=T,J.cK=B,J.HK=L,J}function g(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return z(A).pK(G,A.updatable),G}f.d.CreateCylinder=mK,B.e.CreateCylinder=(K,A,T,G,L,f,O,C,Q)=>{void 0!==O&&O instanceof N.c||(void 0!==O&&(Q=C||B.e.DEFAULTSIDE,C=O),O=f,f=1);return U(K,{height:A,diameterTop:T,diameterBottom:G,tessellation:L,subdivisions:f,sideOrientation:Q,updatable:C},O)};function S(K){const A=[],T=[],B=[],L=[],C=K.radius||2,Q=K.tube||.5,Y=K.radialSegments||32,Z=K.tubularSegments||32,x=K.p||2,J=K.q||3,b=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,P=K=>{const A=Math.cos(K),T=Math.sin(K),B=J/x*K,L=Math.cos(B),f=C*(2+L)*.5*A,O=C*(2+L)*T*.5,Q=C*Math.sin(B)*.5;return new G.PA(f,O,Q)};let F,d;for(F=0;F<=Y;F++){const K=F%Y/Y*2*x*Math.PI,A=P(K),B=P(K+.01),f=B.FA(A);let C=B.add(A);const J=G.PA.Cross(f,C);for(C=G.PA.Cross(J,f),J.normalize(),C.normalize(),d=0;d<Z;d++){const K=d%Z/Z*2*Math.PI,G=-Q*Math.cos(K),B=Q*Math.sin(K);T.push(A.x+G*C.x+B*J.x),T.push(A.y+G*C.y+B*J.y),T.push(A.z+G*C.z+B*J.z),L.push(F/Y),L.push(O.d?1-d/Z:d/Z)}}for(F=0;F<Y;F++)for(d=0;d<Z;d++){const K=(d+1)%Z,T=F*Z+d,G=(F+1)*Z+d,B=(F+1)*Z+K,L=F*Z+K;A.push(L),A.push(G),A.push(T),A.push(L),A.push(B),A.push(G)}f.d.ComputeNormals(T,A,B),f.d._ComputeSides(b,T,A,B,L,K.frontUVs,K.backUVs);const N=new f.d;return N.indices=A,N.uK=T,N.cK=B,N.HK=L,N}function l(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return S(A).pK(G,A.updatable),G}f.d.CreateTorus=z,B.e.CreateTorus=(K,A,T,G,B,L,f)=>g(K,{diameter:A,thickness:T,tessellation:G,sideOrientation:f,updatable:L},B);f.d.CreateTorusKnot=S,B.e.CreateTorusKnot=(K,A,T,G,B,L,f,O,C,Q)=>l(K,{radius:A,tube:T,radialSegments:G,tubularSegments:B,p:L,q:f,sideOrientation:Q,updatable:C},O);var u=T(14454),c=T(13259),n=T(12907);function H(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=A.path,L=A.shape,f=A.scale||1,O=A.rotation||0,C=0===A.cap?0:A.cap||B.e.NO_CAP,Q=A.updatable,Y=B.e._GetDefaultSideOrientation(A.sideOrientation),Z=A.instance||null,x=A.invertUV||!1,J=A.closeShape||!1,b=A.closePath||!1,P=A.capFunction||null;return p(K,L,G,f,O,null,null,b,J,C,!1,T,!!Q,Y,Z,x,A.frontUVs||null,A.backUVs||null,A.firstNormal||null,!!A.adjustFrame,P)}function e(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=A.path,L=A.shape,f=A.scaleFunction||(()=>1),O=A.rotationFunction||(()=>0),C=A.closePath||A.ribbonCloseArray||!1,Q=A.closeShape||A.ribbonClosePath||!1,Y=0===A.cap?0:A.cap||B.e.NO_CAP,Z=A.updatable,x=A.firstNormal||null,J=A.adjustFrame||!1,b=B.e._GetDefaultSideOrientation(A.sideOrientation),P=A.instance,F=A.invertUV||!1,d=A.capFunction||null;return p(K,L,G,null,null,f,O,C,Q,Y,!0,T,!!Z,b,P||null,F,A.frontUVs||null,A.backUVs||null,x,J,d||null)}function p(K,A,T,L,f,O,C,Y,Z,x,J,b,P,F,d,N,D,mK,U,z,g){const S=(K,A,T,L,f,O,C,Q,Y,Z,x)=>{const J=T.getTangents(),b=T.getNormals(),P=T.getBinormals(),F=T.getDistances();if(x)for(let B=0;B<J.length;B++)if(0==J[B].x&&0==J[B].y&&0==J[B].z&&J[B].G(J[B-1]),0==b[B].x&&0==b[B].y&&0==b[B].z&&b[B].G(b[B-1]),0==P[B].x&&0==P[B].y&&0==P[B].z&&P[B].G(P[B-1]),B>0){let K=J[B-1];G.PA.Dot(K,J[B])<0&&J[B].scaleInPlace(-1),K=b[B-1],G.PA.Dot(K,b[B])<0&&b[B].scaleInPlace(-1),K=P[B-1],G.PA.Dot(K,P[B])<0&&P[B].scaleInPlace(-1)}let d=0;const N=Z&&Q?Q:()=>null!==O?O:0,D=Z&&C?C:()=>null!==f?f:1;let mK=Y===B.e.NO_CAP||Y===B.e.CAP_END?0:2;const U=G.TmpVectors.Matrix[0];for(let B=0;B<A.length;B++){const T=[],f=N(B,F[B]),O=D(B,F[B]);G.Matrix.RotationAxisToRef(J[B],d,U);for(let L=0;L<K.length;L++){const f=J[B].scale(K[L].z).add(b[B].scale(K[L].x)).add(P[B].scale(K[L].y)),C=G.PA.Zero();G.PA.TransformCoordinatesToRef(f,U,C),C.scaleInPlace(O).addInPlace(A[B]),T[L]=C}L[mK]=T,d+=f,mK++}const z=g||(K=>{const A=Array(),T=G.PA.Zero();let B;for(B=0;B<K.length;B++)T.addInPlace(K[B]);for(T.scaleInPlace(1/K.length),B=0;B<K.length;B++)A.push(T);return A});switch(Y){case B.e.NO_CAP:break;case B.e.CAP_START:L[0]=z(L[2]),L[1]=L[2];break;case B.e.CAP_END:L[mK]=L[mK-1],L[mK+1]=z(L[mK-1]);break;case B.e.CAP_ALL:L[0]=z(L[2]),L[1]=L[2],L[mK]=L[mK-1],L[mK+1]=z(L[mK-1])}return L};let l,u;if(d){const K=d._creationDataStorage;return l=U?K.path3D.update(T,U):K.path3D.update(T),u=S(A,T,K.path3D,K.pathArray,L,f,O,C,K.cap,J,z),d=Q("",{pathArray:u,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:d},b||void 0)}l=U?new n.k(T,U):new n.k(T);u=S(A,T,l,new Array,L,f,O,C,x=x<0||x>3?0:x,J,z);const c=Q(K,{pathArray:u,closeArray:Y,closePath:Z,updatable:P,sideOrientation:F,invertUV:N,frontUVs:D||void 0,backUVs:mK||void 0},b);return c._creationDataStorage.pathArray=u,c._creationDataStorage.path3D=l,c._creationDataStorage.cap=x,c}function r(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=A.arc?A.arc<=0||A.arc>1?1:A.arc:1,f=void 0===A.closed||A.closed,O=A.shape,C=A.radius||1,Y=A.tessellation||64,Z=A.clip||0,x=A.updatable,J=B.e._GetDefaultSideOrientation(A.sideOrientation),b=A.cap||B.e.NO_CAP,P=2*Math.PI,F=[],d=A.invertUV||!1;let N=0,D=0;const mK=P/Y*L;let U,z;for(N=0;N<=Y-Z;N++){for(z=[],b!=B.e.CAP_START&&b!=B.e.CAP_ALL||(z.push(new G.PA(0,O[0].y,0)),z.push(new G.PA(Math.cos(N*mK)*O[0].x*C,O[0].y,Math.sin(N*mK)*O[0].x*C))),D=0;D<O.length;D++)U=new G.PA(Math.cos(N*mK)*O[D].x*C,O[D].y,Math.sin(N*mK)*O[D].x*C),z.push(U);b!=B.e.CAP_END&&b!=B.e.CAP_ALL||(z.push(new G.PA(Math.cos(N*mK)*O[O.length-1].x*C,O[O.length-1].y,Math.sin(N*mK)*O[O.length-1].x*C)),z.push(new G.PA(0,O[O.length-1].y,0))),F.push(z)}return Q(K,{pathArray:F,closeArray:f,sideOrientation:J,updatable:x,invertUV:d,frontUVs:A.frontUVs,backUVs:A.backUVs},T)}B.e.ExtrudeShape=function(K,A,T,G,L,f){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8?arguments[8]:void 0,Y=arguments.length>9?arguments[9]:void 0;return H(K,{shape:A,path:T,scale:G,rotation:L,cap:0===f?0:f||B.e.NO_CAP,sideOrientation:Q,instance:Y,updatable:C},O)},B.e.ExtrudeShapeCustom=(K,A,T,G,L,f,O,C,Q,Y,Z,x)=>e(K,{shape:A,path:T,scaleFunction:G,rotationFunction:L,ribbonCloseArray:f,ribbonClosePath:O,cap:0===C?0:C||B.e.NO_CAP,sideOrientation:Z,instance:x,updatable:Y},Q);B.e.CreateLathe=(K,A,T,G,B,L,f)=>r(K,{shape:A,radius:T,tessellation:G,sideOrientation:f,updatable:L},B);var h=T(13835),k=T(13793);function s(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=A.path;let f=A.instance,O=1;void 0!==A.radius?O=A.radius:f&&(O=f._creationDataStorage.radius);const C=A.tessellation||64,Y=A.radiusFunction||null;let Z=A.cap||B.e.NO_CAP;const x=A.invertUV||!1,J=A.updatable,b=B.e._GetDefaultSideOrientation(A.sideOrientation);A.arc=A.arc&&(A.arc<=0||A.arc>1)?1:A.arc||1;const P=(K,A,T,L,f,O,C,Q)=>{const Y=A.getTangents(),Z=A.getNormals(),x=A.getDistances(),J=2*Math.PI/f*Q,b=O||(()=>L);let P,F,d,N;const D=G.TmpVectors.Matrix[0];let mK=C===B.e.NO_CAP||C===B.e.CAP_END?0:2;for(let B=0;B<K.length;B++){F=b(B,x[B]),P=Array(),d=Z[B];for(let A=0;A<f;A++)G.Matrix.RotationAxisToRef(Y[B],J*A,D),N=P[A]?P[A]:G.PA.Zero(),G.PA.TransformCoordinatesToRef(d,D,N),N.scaleInPlace(F).addInPlace(K[B]),P[A]=N;T[mK]=P,mK++}const U=(A,T)=>{const G=Array();for(let B=0;B<A;B++)G.push(K[T]);return G};switch(C){case B.e.NO_CAP:break;case B.e.CAP_START:T[0]=U(f,0),T[1]=T[2].slice(0);break;case B.e.CAP_END:T[mK]=T[mK-1].slice(0),T[mK+1]=U(f,K.length-1);break;case B.e.CAP_ALL:T[0]=U(f,0),T[1]=T[2].slice(0),T[mK]=T[mK-1].slice(0),T[mK+1]=U(f,K.length-1)}return T};let F,d;if(f){const K=f._creationDataStorage,T=A.arc||K.arc;return F=K.path3D.update(L),d=P(L,F,K.pathArray,O,K.tessellation,Y,K.cap,T),f=Q("",{pathArray:d,instance:f}),K.path3D=F,K.pathArray=d,K.arc=T,K.radius=O,f}F=new n.k(L);Z=Z<0||Z>3?0:Z,d=P(L,F,new Array,O,C,Y,Z,A.arc);const N=Q(K,{pathArray:d,closePath:!0,closeArray:!1,updatable:J,sideOrientation:b,invertUV:x,frontUVs:A.frontUVs,backUVs:A.backUVs},T);return N._creationDataStorage.pathArray=d,N._creationDataStorage.path3D=F,N._creationDataStorage.tessellation=C,N._creationDataStorage.cap=Z,N._creationDataStorage.arc=A.arc,N._creationDataStorage.radius=O,N}function j(K){const A=[];A[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},A[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},A[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},A[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},A[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},A[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},A[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},A[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},A[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},A[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},A[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},A[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},A[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},A[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},A[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const T=K.type&&(K.type<0||K.type>=A.length)?0:K.type||0,B=K.size,L=K.sizeX||B||1,C=K.sizeY||B||1,Q=K.sizeZ||B||1,Y=K.custom||A[T],Z=Y.face.length,J=K.faceUV||new Array(Z),b=K.faceColors,P=void 0===K.flat||K.flat,F=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,d=[],N=[],D=[],mK=[],U=[];let z=0,g=0;const S=[];let l,u,c,n,H,e,p=0,r=0;if(P)for(r=0;r<Z;r++)b&&void 0===b[r]&&(b[r]=new x.oO(1,1,1,1)),J&&void 0===J[r]&&(J[r]=new G.Vector4(0,0,1,1));if(P)for(r=0;r<Z;r++){const K=Y.face[r].length;for(c=2*Math.PI/K,n=.5*Math.tan(c/2),H=.5,p=0;p<K;p++)d.push(Y.vertex[Y.face[r][p]][0]*L,Y.vertex[Y.face[r][p]][1]*C,Y.vertex[Y.face[r][p]][2]*Q),S.push(z),z++,l=J[r].x+(J[r].z-J[r].x)*(.5+n),u=J[r].y+(J[r].w-J[r].y)*(H-.5),mK.push(l,O.d?1-u:u),e=n*Math.cos(c)-H*Math.sin(c),H=n*Math.sin(c)+H*Math.cos(c),n=e,b&&U.push(b[r].r,b[r].g,b[r].b,b[r].a);for(p=0;p<K-2;p++)N.push(S[0+g],S[p+2+g],S[p+1+g]);g+=K}else{for(p=0;p<Y.vertex.length;p++)d.push(Y.vertex[p][0]*L,Y.vertex[p][1]*C,Y.vertex[p][2]*Q),mK.push(0,O.d?1:0);for(r=0;r<Z;r++)for(p=0;p<Y.face[r].length-2;p++)N.push(Y.face[r][0],Y.face[r][p+2],Y.face[r][p+1])}f.d.ComputeNormals(d,N,D),f.d._ComputeSides(F,d,N,D,mK,K.frontUVs,K.backUVs);const h=new f.d;return h.uK=d,h.indices=N,h.cK=D,h.HK=mK,b&&P&&(h.nK=U),h}function R(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return j(A).pK(G,A.updatable),G}B.e.CreateTube=(K,A,T,G,B,L,f,O,C,Q)=>s(K,{path:A,radius:T,tessellation:G,radiusFunction:B,arc:1,cap:L,updatable:O,sideOrientation:C,instance:Q},f);function v(K){const A=K.sideOrientation||f.d.DEFAULTSIDE,T=K.radius||1,B=void 0===K.flat||K.flat,L=0|(K.subdivisions||4),C=K.radiusX||T,Q=K.radiusY||T,Y=K.radiusZ||T,Z=(1+Math.sqrt(5))/2,x=[-1,Z,-0,1,Z,0,-1,-Z,0,1,-Z,0,0,-1,-Z,0,1,-Z,0,-1,Z,0,1,Z,Z,0,1,Z,0,-1,-Z,0,1,-Z,0,-1],J=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],b=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],P=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],F=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],d=[],N=[],D=[],mK=[];let U=0;const z=new Array(3),g=new Array(3);let S;for(S=0;S<3;S++)z[S]=G.PA.Zero(),g[S]=G.Vector2.Zero();for(let f=0;f<20;f++){for(S=0;S<3;S++){const K=J[3*f+S];z[S].RO(x[3*b[K]],x[3*b[K]+1],x[3*b[K]+2]),z[S].normalize(),g[S].RO(.134765625*P[2*K]+.05859375+-.0390625*F[f],.2333984375*P[2*K+1]+.025390625+.01953125*F[f])}const K=(K,A,T,f)=>{const Z=G.PA.Lerp(z[0],z[2],A/L),x=G.PA.Lerp(z[1],z[2],A/L),J=L===A?z[2]:G.PA.Lerp(Z,x,K/(L-A));let b;if(J.normalize(),B){const K=G.PA.Lerp(z[0],z[2],f/L),A=G.PA.Lerp(z[1],z[2],f/L);b=G.PA.Lerp(K,A,T/(L-f))}else b=new G.PA(J.x,J.y,J.z);b.x/=C,b.y/=Q,b.z/=Y,b.normalize();const P=G.Vector2.Lerp(g[0],g[2],A/L),F=G.Vector2.Lerp(g[1],g[2],A/L),S=L===A?g[2]:G.Vector2.Lerp(P,F,K/(L-A));N.push(J.x*C,J.y*Q,J.z*Y),D.push(b.x,b.y,b.z),mK.push(S.x,O.d?1-S.y:S.y),d.push(U),U++};for(let A=0;A<L;A++)for(let T=0;T+A<L;T++)K(T,A,T+1/3,A+1/3),K(T+1,A,T+1/3,A+1/3),K(T,A+1,T+1/3,A+1/3),T+A+1<L&&(K(T+1,A,T+2/3,A+2/3),K(T+1,A+1,T+2/3,A+2/3),K(T,A+1,T+2/3,A+2/3))}f.d._ComputeSides(A,N,d,D,mK,K.frontUVs,K.backUVs);const l=new f.d;return l.indices=d,l.uK=N,l.cK=D,l.HK=mK,l}function I(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new B.e(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),G._originalBuilderSideOrientation=A.sideOrientation;return v(A).pK(G,A.updatable),G}f.d.CreatePolyhedron=j,B.e.CreatePolyhedron=(K,A,T)=>R(K,A,T);f.d.CreateIcoSphere=v,B.e.CreateIcoSphere=(K,A,T)=>I(K,A,T);var o=T(12716);const W=new G.PA(1,0,0),i=new G.PA(-1,0,0),V=new G.PA(0,1,0),X=new G.PA(0,-1,0),q=new G.PA(0,0,1),y=new G.PA(0,0,-1);class w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.PA.Zero(),A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.PA.Up(),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.Vector2.Zero(),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=K,this.normal=A,this.uv=T,this.vertexIdx=B,this.vertexIdxForBones=L,this.localPositionOverride=f,this.localNormalOverride=O,this.matrixIndicesOverride=C,this.matrixWeightsOverride=Q}clone(){var K,A,T,G;return new w(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(K=this.localPositionOverride)||void 0===K?void 0:K.slice(),null===(A=this.localNormalOverride)||void 0===A?void 0:A.slice(),null===(T=this.matrixIndicesOverride)||void 0===T?void 0:T.slice(),null===(G=this.matrixWeightsOverride)||void 0===G?void 0:G.slice())}}function a(K,A,T){var C,Q,Y,Z,x;const J=!!A.skeleton,b=!(null===(C=A.morphTargetManager)||void 0===C||!C.numTargets),P=T.localMode||J,F=A.Ef(),d=J||b?A.AC(!0,!0):A.getVerticesData(L.d.PositionKind),N=J||b?A.getNormalsData(!0,!0):A.getVerticesData(L.d.NormalKind),D=P?J?A.getVerticesData(L.d.PositionKind):d:null,mK=P?J?A.getVerticesData(L.d.NormalKind):N:null,U=A.getVerticesData(L.d.UVKind),z=J?A.getVerticesData(L.d.MatricesIndicesKind):null,g=J?A.getVerticesData(L.d.MatricesWeightsKind):null,S=J?A.getVerticesData(L.d.MatricesIndicesExtraKind):null,l=J?A.getVerticesData(L.d.MatricesWeightsExtraKind):null,u=T.position||G.PA.Zero();let c=T.normal||G.PA.Up();const n=T.size||G.PA.One(),H=T.angle||0;if(!c){const K=new G.PA(0,0,1),T=A.SK().activeCamera,B=G.PA.TransformCoordinates(K,T.getWorldMatrix());c=T.globalPosition.FA(B)}const e=-Math.atan2(c.z,c.x)-Math.PI/2,p=Math.sqrt(c.x*c.x+c.z*c.z),r=Math.atan2(c.y,p),h=new f.d;h.indices=[],h.uK=[],h.cK=[],h.HK=[],h.matricesIndices=J?[]:null,h.matricesWeights=J?[]:null,h.matricesIndicesExtra=S?[]:null,h.matricesWeightsExtra=l?[]:null;let k=0;const s=(K,A)=>{const B=new w;if(!F||!d||!N)return B;const L=F[K];if(B.vertexIdx=3*L,B.vertexIdxForBones=4*L,B.position=new G.PA(d[3*L],d[3*L+1],d[3*L+2]),G.PA.TransformCoordinatesToRef(B.position,A,B.position),B.normal=new G.PA(N[3*L],N[3*L+1],N[3*L+2]),G.PA.TransformNormalToRef(B.normal,A,B.normal),T.captureUVS&&U){const K=U[2*L+1];B.uv=new G.Vector2(U[2*L],O.d?1-K:K)}return B},j=[0,0,0,0],R=(K,A)=>{if(0===K.length)return K;const T=.5*Math.abs(G.PA.Dot(n,A)),B=(K,A,T,G)=>{for(let B=0;B<G;++B)if(K[T+B]===A)return T+B;return-1},L=(K,L)=>{const f=G.PA.GetClipFactor(K.position,L.position,A,T);let O=j,C=j;if(z&&g){const A=K.matrixIndicesOverride?0:K.vertexIdxForBones,T=K.matrixIndicesOverride??z,G=K.matrixWeightsOverride??g,Q=L.matrixIndicesOverride?0:L.vertexIdxForBones,Y=L.matrixIndicesOverride??z,Z=L.matrixWeightsOverride??g;O=[0,0,0,0],C=[0,0,0,0];let x=0;for(let K=0;K<4;++K)if(G[A+K]>0){const L=B(Y,T[A+K],Q,4);O[x]=T[A+K],C[x]=(0,o.Lerp)(G[A+K],L>=0?Z[L]:0,f),x++}for(let K=0;K<4&&x<4;++K){const G=Y[Q+K];-1===B(T,G,A,4)&&(O[x]=G,C[x]=(0,o.Lerp)(0,Z[Q+K],f),x++)}const J=C[0]+C[1]+C[2]+C[3];C[0]/=J,C[1]/=J,C[2]/=J,C[3]/=J}const Q=K.localPositionOverride?K.localPositionOverride[0]:(null===D||void 0===D?void 0:D[K.vertexIdx])??0,Y=K.localPositionOverride?K.localPositionOverride[1]:(null===D||void 0===D?void 0:D[K.vertexIdx+1])??0,Z=K.localPositionOverride?K.localPositionOverride[2]:(null===D||void 0===D?void 0:D[K.vertexIdx+2])??0,x=L.localPositionOverride?L.localPositionOverride[0]:(null===D||void 0===D?void 0:D[L.vertexIdx])??0,J=L.localPositionOverride?L.localPositionOverride[1]:(null===D||void 0===D?void 0:D[L.vertexIdx+1])??0,b=L.localPositionOverride?L.localPositionOverride[2]:(null===D||void 0===D?void 0:D[L.vertexIdx+2])??0,P=K.localNormalOverride?K.localNormalOverride[0]:(null===mK||void 0===mK?void 0:mK[K.vertexIdx])??0,F=K.localNormalOverride?K.localNormalOverride[1]:(null===mK||void 0===mK?void 0:mK[K.vertexIdx+1])??0,d=K.localNormalOverride?K.localNormalOverride[2]:(null===mK||void 0===mK?void 0:mK[K.vertexIdx+2])??0,N=P+((L.localNormalOverride?L.localNormalOverride[0]:(null===mK||void 0===mK?void 0:mK[L.vertexIdx])??0)-P)*f,U=F+((L.localNormalOverride?L.localNormalOverride[1]:(null===mK||void 0===mK?void 0:mK[L.vertexIdx+1])??0)-F)*f,S=d+((L.localNormalOverride?L.localNormalOverride[2]:(null===mK||void 0===mK?void 0:mK[L.vertexIdx+2])??0)-d)*f,l=Math.sqrt(N*N+U*U+S*S);return new w(G.PA.Lerp(K.position,L.position,f),G.PA.Lerp(K.normal,L.normal,f).normalize(),G.Vector2.Lerp(K.uv,L.uv,f),-1,-1,D?[Q+(x-Q)*f,Y+(J-Y)*f,Z+(b-Z)*f]:null,mK?[N/l,U/l,S/l]:null,O,C)};let f=null;K.length>3&&(f=[]);for(let O=0;O<K.length;O+=3){let B=0,C=null,Q=null,Y=null,Z=null;const x=G.PA.Dot(K[O].position,A)-T>0,J=G.PA.Dot(K[O+1].position,A)-T>0,b=G.PA.Dot(K[O+2].position,A)-T>0;switch(B=(x?1:0)+(J?1:0)+(b?1:0),B){case 0:K.length>3?(f.push(K[O]),f.push(K[O+1]),f.push(K[O+2])):f=K;break;case 1:if(f=f??new Array,x&&(C=K[O+1],Q=K[O+2],Y=L(K[O],C),Z=L(K[O],Q)),J){C=K[O],Q=K[O+2],Y=L(K[O+1],C),Z=L(K[O+1],Q),f.push(Y),f.push(Q.clone()),f.push(C.clone()),f.push(Q.clone()),f.push(Y.clone()),f.push(Z);break}b&&(C=K[O],Q=K[O+1],Y=L(K[O+2],C),Z=L(K[O+2],Q)),C&&Q&&Y&&Z&&(f.push(C.clone()),f.push(Q.clone()),f.push(Y),f.push(Z),f.push(Y.clone()),f.push(Q.clone()));break;case 2:f=f??new Array,x||(C=K[O].clone(),Q=L(C,K[O+1]),Y=L(C,K[O+2]),f.push(C),f.push(Q),f.push(Y)),J||(C=K[O+1].clone(),Q=L(C,K[O+2]),Y=L(C,K[O]),f.push(C),f.push(Q),f.push(Y)),b||(C=K[O+2].clone(),Q=L(C,K[O]),Y=L(C,K[O+1]),f.push(C),f.push(Q),f.push(Y))}}return f},v=A instanceof B.e?A:null,I=null===v||void 0===v?void 0:v._thinInstanceDataStorage.matrixData,a=(null===v||void 0===v?void 0:v.iO)||1,M=G.TmpVectors.Matrix[0];M.G(G.Matrix.IdentityReadOnly);for(let B=0;B<a;++B){if(null!==v&&void 0!==v&&v.hasThinInstances&&I){const K=16*B;M.setRowFromFloats(0,I[K+0],I[K+1],I[K+2],I[K+3]),M.setRowFromFloats(1,I[K+4],I[K+5],I[K+6],I[K+7]),M.setRowFromFloats(2,I[K+8],I[K+9],I[K+10],I[K+11]),M.setRowFromFloats(3,I[K+12],I[K+13],I[K+14],I[K+15])}const K=G.Matrix.RotationYawPitchRoll(e,r,H).multiply(G.Matrix.Translation(u.x,u.y,u.z)),L=G.Matrix.Invert(K),f=A.getWorldMatrix(),C=M.multiply(f).multiply(L),Q=new Array(3);for(let A=0;A<F.length;A+=3){let K=Q;if(K[0]=s(A,C),K[1]=s(A+1,C),K[2]=s(A+2,C),!(T.cullBackFaces&&-K[0].normal.z<=0&&-K[1].normal.z<=0&&-K[2].normal.z<=0)&&(K=R(K,W),K&&(K=R(K,i),K&&(K=R(K,V),K&&(K=R(K,X),K&&(K=R(K,q),K&&(K=R(K,y),K)))))))for(let A=0;A<K.length;A++){const G=K[A];if(h.indices.push(k),P?(G.localPositionOverride?(h.uK[3*k]=G.localPositionOverride[0],h.uK[3*k+1]=G.localPositionOverride[1],h.uK[3*k+2]=G.localPositionOverride[2]):D&&(h.uK[3*k]=D[G.vertexIdx],h.uK[3*k+1]=D[G.vertexIdx+1],h.uK[3*k+2]=D[G.vertexIdx+2]),G.localNormalOverride?(h.cK[3*k]=G.localNormalOverride[0],h.cK[3*k+1]=G.localNormalOverride[1],h.cK[3*k+2]=G.localNormalOverride[2]):mK&&(h.cK[3*k]=mK[G.vertexIdx],h.cK[3*k+1]=mK[G.vertexIdx+1],h.cK[3*k+2]=mK[G.vertexIdx+2])):(G.position.toArray(h.uK,3*k),G.normal.toArray(h.cK,3*k)),h.matricesIndices&&h.matricesWeights&&(G.matrixIndicesOverride?(h.matricesIndices[4*k]=G.matrixIndicesOverride[0],h.matricesIndices[4*k+1]=G.matrixIndicesOverride[1],h.matricesIndices[4*k+2]=G.matrixIndicesOverride[2],h.matricesIndices[4*k+3]=G.matrixIndicesOverride[3]):(z&&(h.matricesIndices[4*k]=z[G.vertexIdxForBones],h.matricesIndices[4*k+1]=z[G.vertexIdxForBones+1],h.matricesIndices[4*k+2]=z[G.vertexIdxForBones+2],h.matricesIndices[4*k+3]=z[G.vertexIdxForBones+3]),S&&h.matricesIndicesExtra&&(h.matricesIndicesExtra[4*k]=S[G.vertexIdxForBones],h.matricesIndicesExtra[4*k+1]=S[G.vertexIdxForBones+1],h.matricesIndicesExtra[4*k+2]=S[G.vertexIdxForBones+2],h.matricesIndicesExtra[4*k+3]=S[G.vertexIdxForBones+3])),G.matrixWeightsOverride?(h.matricesWeights[4*k]=G.matrixWeightsOverride[0],h.matricesWeights[4*k+1]=G.matrixWeightsOverride[1],h.matricesWeights[4*k+2]=G.matrixWeightsOverride[2],h.matricesWeights[4*k+3]=G.matrixWeightsOverride[3]):(g&&(h.matricesWeights[4*k]=g[G.vertexIdxForBones],h.matricesWeights[4*k+1]=g[G.vertexIdxForBones+1],h.matricesWeights[4*k+2]=g[G.vertexIdxForBones+2],h.matricesWeights[4*k+3]=g[G.vertexIdxForBones+3]),l&&h.matricesWeightsExtra&&(h.matricesWeightsExtra[4*k]=l[G.vertexIdxForBones],h.matricesWeightsExtra[4*k+1]=l[G.vertexIdxForBones+1],h.matricesWeightsExtra[4*k+2]=l[G.vertexIdxForBones+2],h.matricesWeightsExtra[4*k+3]=l[G.vertexIdxForBones+3]))),T.captureUVS)G.uv.toArray(h.HK,2*k);else{h.HK.push(.5+G.position.x/n.x);const K=.5+G.position.y/n.y;h.HK.push(O.d?1-K:K)}k++}}}0===h.indices.length&&(h.indices=null),0===h.uK.length&&(h.uK=null),0===h.cK.length&&(h.cK=null),0===h.HK.length&&(h.HK=null),0===(null===(Q=h.matricesIndices)||void 0===Q?void 0:Q.length)&&(h.matricesIndices=null),0===(null===(Y=h.matricesWeights)||void 0===Y?void 0:Y.length)&&(h.matricesWeights=null),0===(null===(Z=h.matricesIndicesExtra)||void 0===Z?void 0:Z.length)&&(h.matricesIndicesExtra=null),0===(null===(x=h.matricesWeightsExtra)||void 0===x?void 0:x.length)&&(h.matricesWeightsExtra=null);const E=new B.e(K,A.SK());return h.pK(E),P?(E.skeleton=A.skeleton,E.parent=A):(E.position=u.clone(),E.rotation=new G.PA(r,e,H)),E.wf(!0),E.refreshBoundingInfo(!0,!0),E}function M(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const A=0|Math.max(K.subdivisions?K.subdivisions:2,1),T=0|Math.max(K.tessellation?K.tessellation:16,3),B=Math.max(K.height?K.height:1,0),L=Math.max(K.radius?K.radius:.25,0),C=0|Math.max(K.capSubdivisions?K.capSubdivisions:6,1),Q=T,Y=A,Z=Math.max(K.radiusTop?K.radiusTop:L,0),x=Math.max(K.radiusBottom?K.radiusBottom:L,0),J=B-(Z+x),b=2*Math.PI,P=Math.max(K.topCapSubdivisions?K.topCapSubdivisions:C,1),F=Math.max(K.bottomCapSubdivisions?K.bottomCapSubdivisions:C,1),d=Math.acos((x-Z)/B);let N=[];const D=[],mK=[],U=[];let z=0;const g=[],S=.5*J,l=.5*Math.PI;let u,c;const n=G.PA.Zero(),H=G.PA.Zero(),e=Math.cos(d),p=Math.sin(d),r=new G.Vector2(Z*p,S+Z*e).FA(new G.Vector2(x*p,x*e-S)).length(),h=Z*d+r+x*(l-d);let k=0;for(c=0;c<=P;c++){const K=[],A=l-d*(c/P);k+=Z*d/P;const T=Math.cos(A),G=Math.sin(A),B=T*Z;for(u=0;u<=Q;u++){const A=u/Q,L=A*b+0,f=Math.sin(L),C=Math.cos(L);H.x=B*f,H.y=S+G*Z,H.z=B*C,D.push(H.x,H.y,H.z),n.set(T*f,G,T*C),mK.push(n.x,n.y,n.z),U.push(A,O.d?k/h:1-k/h),K.push(z),z++}g.push(K)}const s=B-Z-x+e*Z-e*x,j=p*(x-Z)/s;for(c=1;c<=Y;c++){const K=[];k+=r/Y;const A=p*(c*(x-Z)/Y+Z);for(u=0;u<=Q;u++){const T=u/Q,G=T*b+0,B=Math.sin(G),L=Math.cos(G);H.x=A*B,H.y=S+e*Z-c*s/Y,H.z=A*L,D.push(H.x,H.y,H.z),n.set(B,j,L).normalize(),mK.push(n.x,n.y,n.z),U.push(T,O.d?k/h:1-k/h),K.push(z),z++}g.push(K)}for(c=1;c<=F;c++){const K=[],A=l-d-(Math.PI-d)*(c/F);k+=x*d/F;const T=Math.cos(A),G=Math.sin(A),B=T*x;for(u=0;u<=Q;u++){const A=u/Q,L=A*b+0,f=Math.sin(L),C=Math.cos(L);H.x=B*f,H.y=G*x-S,H.z=B*C,D.push(H.x,H.y,H.z),n.set(T*f,G,T*C),mK.push(n.x,n.y,n.z),U.push(A,O.d?k/h:1-k/h),K.push(z),z++}g.push(K)}for(u=0;u<Q;u++)for(c=0;c<P+Y+F;c++){const K=g[c][u],A=g[c+1][u],T=g[c+1][u+1],G=g[c][u+1];N.push(K),N.push(A),N.push(G),N.push(A),N.push(T),N.push(G)}if(N=N.reverse(),K.orientation&&!K.orientation.equals(G.PA.Up())){const A=new G.Matrix;K.orientation.clone().scale(.5*Math.PI).cross(G.PA.Up()).toQuaternion().toRotationMatrix(A);const T=G.PA.Zero();for(let K=0;K<D.length;K+=3)T.set(D[K],D[K+1],D[K+2]),G.PA.TransformCoordinatesToRef(T.clone(),A,T),D[K]=T.x,D[K+1]=T.y,D[K+2]=T.z}const R=new f.d;return R.uK=D,R.cK=mK,R.HK=U,R.indices=N,R}function E(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:G.PA.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new B.e(K,T);return M(A).pK(L,A.updatable),L}B.e.CreateDecal=(K,A,T,G,B,L)=>a(K,A,{position:T,normal:G,size:B,angle:L});B.e.CreateCapsule=(K,A,T)=>E(K,A,T),f.d.CreateCapsule=M;var t=T(12548),KK=T(12706);class AK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=K,this.y=A,K!==Math.floor(K)&&(K=Math.floor(K),t.d.Warn("x is not an integer, floor(x) used")),A!==Math.floor(A)&&(A=Math.floor(A),t.d.Warn("y is not an integer, floor(y) used"))}clone(){return new AK(this.x,this.y)}rotate60About(K){const A=this.x;return this.x=K.x+K.y-this.y,this.y=A+this.y-K.x,this}rotateNeg60About(K){const A=this.x;return this.x=A+this.y-K.y,this.y=K.x+K.y-A,this}rotate120(K,A){K!==Math.floor(K)&&(K=Math.floor(K),t.d.Warn("m not an integer only floor(m) used")),A!==Math.floor(A)&&(A=Math.floor(A),t.d.Warn("n not an integer only floor(n) used"));const T=this.x;return this.x=K-T-this.y,this.y=A+T,this}rotateNeg120(K,A){K!==Math.floor(K)&&(K=Math.floor(K),t.d.Warn("m is not an integer, floor(m) used")),A!==Math.floor(A)&&(A=Math.floor(A),t.d.Warn("n is not an integer,   floor(n) used"));const T=this.x;return this.x=this.y-A,this.y=K+A-T-this.y,this}toCartesianOrigin(K,A){const T=G.PA.Zero();return T.x=K.x+2*this.x*A+this.y*A,T.y=K.y+Math.sqrt(3)*this.y*A,T}static Zero(){return new AK(0,0)}}class TK{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new GK("icosahedron","Regular",[[0,KK.e,-1],[-KK.e,1,0],[-1,0,-KK.e],[1,0,-KK.e],[KK.e,1,0],[0,KK.e,1],[-1,0,KK.e],[-KK.e,-1,0],[0,-KK.e,-1],[KK.e,-1,0],[1,0,KK.e],[0,-KK.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let K=12;const A={},T=this.m,G=this.n;let B,L,f,O,C,Q=T,Y=1,Z=0;0!==G&&(Q=(0,o.HighestCommonFactor)(T,G)),Y=T/Q,Z=G/Q;const x=AK.Zero(),J=new AK(T,G),b=new AK(-G,T+G),P=AK.Zero(),F=AK.Zero(),d=AK.Zero();let N,D,mK,U,z=[];const g=[],S=this.vertByDist,l=(T,G,B,L)=>{N=T+"|"+B,D=G+"|"+L,N in A||D in A?N in A&&!(D in A)?A[D]=A[N]:D in A&&!(N in A)&&(A[N]=A[D]):(A[N]=K,A[D]=K,K++),S[B][0]>2?g[A[N]]=[-S[B][0],S[B][1],A[N]]:g[A[N]]=[z[S[B][0]],S[B][1],A[N]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let u=0;u<20;u++){if(z=this.IDATA.face[u],f=z[2],O=z[1],C=z[0],mK=x.x+"|"+x.y,N=u+"|"+mK,N in A||(A[N]=f,g[f]=[z[S[mK][0]],S[mK][1]]),mK=J.x+"|"+J.y,N=u+"|"+mK,N in A||(A[N]=O,g[O]=[z[S[mK][0]],S[mK][1]]),mK=b.x+"|"+b.y,N=u+"|"+mK,N in A||(A[N]=C,g[C]=[z[S[mK][0]],S[mK][1]]),B=this.IDATA.edgematch[u][0],L=this.IDATA.edgematch[u][1],"B"===L)for(let K=1;K<Q;K++)F.x=T-K*(Y+Z),F.y=G+K*Y,d.x=-K*Z,d.y=K*(Y+Z),mK=F.x+"|"+F.y,U=d.x+"|"+d.y,l(u,B,mK,U);if("O"===L)for(let K=1;K<Q;K++)d.x=-K*Z,d.y=K*(Y+Z),P.x=K*Y,P.y=K*Z,mK=d.x+"|"+d.y,U=P.x+"|"+P.y,l(u,B,mK,U);if(B=this.IDATA.edgematch[u][2],L=this.IDATA.edgematch[u][3],L&&"A"===L)for(let K=1;K<Q;K++)P.x=K*Y,P.y=K*Z,F.x=T-(Q-K)*(Y+Z),F.y=G+(Q-K)*Y,mK=P.x+"|"+P.y,U=F.x+"|"+F.y,l(u,B,mK,U);for(let T=0;T<this.vertices.length;T++)mK=this.vertices[T].x+"|"+this.vertices[T].y,N=u+"|"+mK,N in A||(A[N]=K++,S[mK][0]>2?g[A[N]]=[-S[mK][0],S[mK][1],A[N]]:g[A[N]]=[z[S[mK][0]],S[mK][1],A[N]])}this.closestTo=g,this.vecToidx=A}calcCoeffs(){const K=this.m,A=this.n,T=Math.sqrt(3)/3,G=K*K+A*A+K*A;this.coau=(K+A)/G,this.cobu=-A/G,this.coav=-T*(K-A)/G,this.cobv=T*(2*K+A)/G}createInnerFacets(){const K=this.m,A=this.n;for(let T=0;T<A+K+1;T++)for(let K=this.min[T];K<this.max[T]+1;K++)K<this.max[T]&&K<this.max[T+1]+1&&this.innerFacets.push(["|"+K+"|"+T,"|"+K+"|"+(T+1),"|"+(K+1)+"|"+T]),T>0&&K<this.max[T-1]&&K+1<this.max[T]+1&&this.innerFacets.push(["|"+K+"|"+T,"|"+(K+1)+"|"+T,"|"+(K+1)+"|"+(T-1)])}edgeVecsABOB(){const K=this.m,A=this.n,T=new AK(-A,K+A);for(let G=1;G<K+A;G++){const K=new AK(this.min[G],G),A=new AK(this.min[G-1],G-1),B=new AK(this.min[G+1],G+1),L=K.clone(),f=A.clone(),O=B.clone();L.rotate60About(T),f.rotate60About(T),O.rotate60About(T);const C=new AK(this.max[L.y],L.y),Q=new AK(this.max[L.y-1],L.y-1),Y=new AK(this.max[L.y-1]-1,L.y-1);L.x===C.x&&L.y===C.y||(L.x!==Q.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Q,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Y,C])):L.y===O.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,A,Q]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([K,Q,B])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,A,Q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Q,C])))}}mapABOBtoOBOA(){const K=new AK(0,0);for(let A=0;A<this.isoVecsABOB.length;A++){const T=[];for(let G=0;G<3;G++)K.x=this.isoVecsABOB[A][G].x,K.y=this.isoVecsABOB[A][G].y,0===this.vertexTypes[A][G]&&K.rotateNeg120(this.m,this.n),T.push(K.clone());this.isoVecsOBOA.push(T)}}mapABOBtoBAOA(){const K=new AK(0,0);for(let A=0;A<this.isoVecsABOB.length;A++){const T=[];for(let G=0;G<3;G++)K.x=this.isoVecsABOB[A][G].x,K.y=this.isoVecsABOB[A][G].y,1===this.vertexTypes[A][G]&&K.rotate120(this.m,this.n),T.push(K.clone());this.isoVecsBAOA.push(T)}}MapToFace(K,A){const T=this.IDATA.face[K],B=T[2],L=T[1],f=T[0],O=G.PA.mT(this.IDATA.vertex[B]),C=G.PA.mT(this.IDATA.vertex[L]),Q=G.PA.mT(this.IDATA.vertex[f]),Y=C.FA(O),Z=Q.FA(O),x=Y.scale(this.coau).add(Z.scale(this.cobu)),J=Y.scale(this.coav).add(Z.scale(this.cobv)),b=[];let P,F=G.TmpVectors.PA[0];for(let G=0;G<this.cartesian.length;G++)F=x.scale(this.cartesian[G].x).add(J.scale(this.cartesian[G].y)).add(O),b[G]=[F.x,F.y,F.z],P=K+"|"+this.vertices[G].x+"|"+this.vertices[G].y,A.vertex[this.vecToidx[P]]=[F.x,F.y,F.z]}build(K,A){const T=[],G=AK.Zero(),B=new AK(K,A),L=new AK(-A,K+A);T.push(G,B,L);for(let mK=A;mK<K+1;mK++)for(let A=0;A<K+1-mK;A++)T.push(new AK(A,mK));if(A>0){const G=(0,o.HighestCommonFactor)(K,A),B=K/G,L=A/G;for(let O=1;O<G;O++)T.push(new AK(O*B,O*L)),T.push(new AK(-O*L,O*(B+L))),T.push(new AK(K-O*(B+L),A+O*B));const f=K/A;for(let O=1;O<A;O++)for(let G=0;G<O*f;G++)T.push(new AK(G,O)),T.push(new AK(G,O).rotate120(K,A)),T.push(new AK(G,O).rotateNeg120(K,A))}T.sort(((K,A)=>K.x-A.x)),T.sort(((K,A)=>K.y-A.y));const f=new Array(K+A+1),O=new Array(K+A+1);for(let mK=0;mK<f.length;mK++)f[mK]=1/0,O[mK]=-1/0;let C=0,Q=0;const Y=T.length;for(let mK=0;mK<Y;mK++)Q=T[mK].x,C=T[mK].y,f[C]=Math.min(Q,f[C]),O[C]=Math.max(Q,O[C]);const Z=(T,G)=>{const B=T.clone();return"A"===G&&B.rotateNeg120(K,A),"B"===G&&B.rotate120(K,A),B.x<0?B.y:B.x+B.y},x=[],J=[],b=[],P=[],F={},d=[];let N=-1,D=-1;for(let mK=0;mK<Y;mK++)x[mK]=T[mK].toCartesianOrigin(new AK(0,0),.5),J[mK]=Z(T[mK],"O"),b[mK]=Z(T[mK],"A"),P[mK]=Z(T[mK],"B"),J[mK]===b[mK]&&b[mK]===P[mK]?(N=3,D=J[mK]):J[mK]===b[mK]?(N=4,D=J[mK]):b[mK]===P[mK]?(N=5,D=b[mK]):P[mK]===J[mK]&&(N=6,D=J[mK]),J[mK]<b[mK]&&J[mK]<P[mK]&&(N=2,D=J[mK]),b[mK]<J[mK]&&b[mK]<P[mK]&&(N=1,D=b[mK]),P[mK]<b[mK]&&P[mK]<J[mK]&&(N=0,D=P[mK]),d.push([N,D,T[mK].x,T[mK].y]);d.sort(((K,A)=>K[2]-A[2])),d.sort(((K,A)=>K[3]-A[3])),d.sort(((K,A)=>K[1]-A[1])),d.sort(((K,A)=>K[0]-A[0]));for(let mK=0;mK<d.length;mK++)F[d[mK][2]+"|"+d[mK][3]]=[d[mK][0],d[mK][1],mK];return this.m=K,this.n=A,this.vertices=T,this.vertByDist=F,this.cartesian=x,this.min=f,this.max=O,this}}class GK{constructor(K,A,T,G){this.name=K,this.category=A,this.vertex=T,this.face=G}}class BK extends GK{innerToData(K,A){for(let T=0;T<A.innerFacets.length;T++)this.face.push(A.innerFacets[T].map((T=>A.vecToidx[K+T])))}mapABOBtoDATA(K,A){const T=A.IDATA.edgematch[K][0];for(let G=0;G<A.isoVecsABOB.length;G++){const B=[];for(let L=0;L<3;L++)0===A.vertexTypes[G][L]?B.push(K+"|"+A.isoVecsABOB[G][L].x+"|"+A.isoVecsABOB[G][L].y):B.push(T+"|"+A.isoVecsABOB[G][L].x+"|"+A.isoVecsABOB[G][L].y);this.face.push([A.vecToidx[B[0]],A.vecToidx[B[1]],A.vecToidx[B[2]]])}}mapOBOAtoDATA(K,A){const T=A.IDATA.edgematch[K][0];for(let G=0;G<A.isoVecsOBOA.length;G++){const B=[];for(let L=0;L<3;L++)1===A.vertexTypes[G][L]?B.push(K+"|"+A.isoVecsOBOA[G][L].x+"|"+A.isoVecsOBOA[G][L].y):B.push(T+"|"+A.isoVecsOBOA[G][L].x+"|"+A.isoVecsOBOA[G][L].y);this.face.push([A.vecToidx[B[0]],A.vecToidx[B[1]],A.vecToidx[B[2]]])}}mapBAOAtoDATA(K,A){const T=A.IDATA.edgematch[K][2];for(let G=0;G<A.isoVecsBAOA.length;G++){const B=[];for(let L=0;L<3;L++)1===A.vertexTypes[G][L]?B.push(K+"|"+A.isoVecsBAOA[G][L].x+"|"+A.isoVecsBAOA[G][L].y):B.push(T+"|"+A.isoVecsBAOA[G][L].x+"|"+A.isoVecsBAOA[G][L].y);this.face.push([A.vecToidx[B[0]],A.vecToidx[B[1]],A.vecToidx[B[2]]])}}orderData(K){const A=[];for(let L=0;L<13;L++)A[L]=[];const T=K.closestTo;for(let L=0;L<T.length;L++)T[L][0]>-1?T[L][1]>0&&A[T[L][0]].push([L,T[L][1]]):A[12].push([L,T[L][0]]);const G=[];for(let L=0;L<12;L++)G[L]=L;let B=12;for(let L=0;L<12;L++){A[L].sort(((K,A)=>K[1]-A[1]));for(let K=0;K<A[L].length;K++)G[A[L][K][0]]=B++}for(let L=0;L<A[12].length;L++)G[A[12][L][0]]=B++;for(let L=0;L<this.vertex.length;L++)this.vertex[L].push(G[L]);this.vertex.sort(((K,A)=>K[3]-A[3]));for(let L=0;L<this.vertex.length;L++)this.vertex[L].pop();for(let L=0;L<this.face.length;L++)for(let K=0;K<this.face[L].length;K++)this.face[L][K]=G[this.face[L][K]];this.sharedNodes=A[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(K,A){const T=[],G=[];let B=A.pop();G.push(B);let L=this.face[B].indexOf(K);L=(L+2)%3;let f=this.face[B][L];T.push(f);let O=0;for(;A.length>0;)B=A[O],this.face[B].indexOf(f)>-1?(L=(this.face[B].indexOf(f)+1)%3,f=this.face[B][L],T.push(f),G.push(B),A.splice(O,1),O=0):O++;return this.adjacentFaces.push(T),G}toGoldbergPolyhedronData(){const K=new GK("GeoDual","Goldberg",[],[]);K.name="GD dual";const A=this.vertex.length,T=new Array(A);for(let C=0;C<A;C++)T[C]=[];for(let C=0;C<this.face.length;C++)for(let K=0;K<3;K++)T[this.face[C][K]].push(C);let G=0,B=0,L=0,f=[],O=[];this.adjacentFaces=[];for(let C=0;C<T.length;C++){K.face[C]=this.setOrder(C,T[C].concat([]));for(const A of T[C]){G=0,B=0,L=0,f=this.face[A];for(let K=0;K<3;K++)O=this.vertex[f[K]],G+=O[0],B+=O[1],L+=O[2];K.vertex[A]=[G/3,B/3,L/3]}}return K}static BuildGeodesicData(K){const A=new BK("Geodesic-m-n","Geodesic",[[0,KK.e,-1],[-KK.e,1,0],[-1,0,-KK.e],[1,0,-KK.e],[KK.e,1,0],[0,KK.e,1],[-1,0,KK.e],[-KK.e,-1,0],[0,-KK.e,-1],[KK.e,-1,0],[1,0,KK.e],[0,-KK.e,1]],[]);K.setIndices(),K.calcCoeffs(),K.createInnerFacets(),K.edgeVecsABOB(),K.mapABOBtoOBOA(),K.mapABOBtoBAOA();for(let T=0;T<K.IDATA.face.length;T++)K.MapToFace(T,A),A.innerToData(T,K),"B"===K.IDATA.edgematch[T][1]&&A.mapABOBtoDATA(T,K),"O"===K.IDATA.edgematch[T][1]&&A.mapOBOAtoDATA(T,K),"A"===K.IDATA.edgematch[T][3]&&A.mapBAOAtoDATA(T,K);A.orderData(K);return A.vertex=A.vertex.map((function(K){const A=K[0],T=K[1],G=K[2],B=Math.sqrt(A*A+T*T+G*G);return K[0]*=1/B,K[1]*=1/B,K[2]*=1/B,K})),A}}B.e._GoldbergMeshParser=(K,A)=>LK.Parse(K,A);class LK extends B.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(K,A){return void 0===A?(K>this.goldbergData.nbUnsharedFaces-1&&(t.d.Warn("Maximum number of unshared faces used"),K=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+K):(K>11&&(t.d.Warn("Last pole used"),K=11),A>this.goldbergData.nbFacesAtPole-1&&(t.d.Warn("Maximum number of faces at a pole used"),A=this.goldbergData.nbFacesAtPole-1),12+K*this.goldbergData.nbFacesAtPole+A)}_changeGoldbergFaceColors(K){for(let T=0;T<K.length;T++){const A=K[T][0],G=K[T][1],B=K[T][2];for(let K=A;K<G+1;K++)this.goldbergData.faceColors[K]=B}const A=[];for(let T=0;T<12;T++)for(let K=0;K<5;K++)A.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);for(let T=12;T<this.goldbergData.faceColors.length;T++)for(let K=0;K<6;K++)A.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);return A}setGoldbergFaceColors(K){const A=this._changeGoldbergFaceColors(K);this.sK(L.d.ColorKind,A)}updateGoldbergFaceColors(K){const A=this._changeGoldbergFaceColors(K);this.updateVerticesData(L.d.ColorKind,A)}_changeGoldbergFaceUVs(K){const A=this.getVerticesData(L.d.UVKind);for(let T=0;T<K.length;T++){const G=K[T][0],B=K[T][1],L=K[T][2],f=K[T][3],O=K[T][4],C=[],Q=[];let Y,Z;for(let K=0;K<5;K++)Y=L.x+f*Math.cos(O+K*Math.PI/2.5),Z=L.y+f*Math.sin(O+K*Math.PI/2.5),Y<0&&(Y=0),Y>1&&(Y=1),C.push(Y,Z);for(let K=0;K<6;K++)Y=L.x+f*Math.cos(O+K*Math.PI/3),Z=L.y+f*Math.sin(O+K*Math.PI/3),Y<0&&(Y=0),Y>1&&(Y=1),Q.push(Y,Z);for(let K=G;K<Math.min(12,B+1);K++)for(let T=0;T<5;T++)A[10*K+2*T]=C[2*T],A[10*K+2*T+1]=C[2*T+1];for(let K=Math.max(12,G);K<B+1;K++)for(let T=0;T<6;T++)A[12*K-24+2*T]=Q[2*T],A[12*K-23+2*T]=Q[2*T+1]}return A}setGoldbergFaceUVs(K){const A=this._changeGoldbergFaceUVs(K);this.sK(L.d.UVKind,A)}updateGoldbergFaceUVs(K){const A=this._changeGoldbergFaceUVs(K);this.updateVerticesData(L.d.UVKind,A)}placeOnGoldbergFaceAt(K,A,T){const B=G.PA.RotationFromAxis(this.goldbergData.faceXaxis[A],this.goldbergData.faceYaxis[A],this.goldbergData.faceZaxis[A]);K.rotation=B,K.position=this.goldbergData.faceCenters[A].add(this.goldbergData.faceXaxis[A].scale(T.x)).add(this.goldbergData.faceYaxis[A].scale(T.y)).add(this.goldbergData.faceZaxis[A].scale(T.z))}serialize(K){super.serialize(K),K.type="GoldbergMesh";const A={};if(A.adjacentFaces=this.goldbergData.adjacentFaces,A.nbSharedFaces=this.goldbergData.nbSharedFaces,A.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,A.nbFaces=this.goldbergData.nbFaces,A.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){A.faceColors=[];for(const K of this.goldbergData.faceColors)A.faceColors.push(K.kf())}if(this.goldbergData.faceCenters){A.faceCenters=[];for(const K of this.goldbergData.faceCenters)A.faceCenters.push(K.kf())}if(this.goldbergData.faceZaxis){A.faceZaxis=[];for(const K of this.goldbergData.faceZaxis)A.faceZaxis.push(K.kf())}if(this.goldbergData.faceYaxis){A.faceYaxis=[];for(const K of this.goldbergData.faceYaxis)A.faceYaxis.push(K.kf())}if(this.goldbergData.faceXaxis){A.faceXaxis=[];for(const K of this.goldbergData.faceXaxis)A.faceXaxis.push(K.kf())}K.goldbergData=A}static Parse(K,A){const T=K.goldbergData;T.faceColors=T.faceColors.map((K=>x.oO.mT(K))),T.faceCenters=T.faceCenters.map((K=>G.PA.mT(K))),T.faceZaxis=T.faceZaxis.map((K=>G.PA.mT(K))),T.faceXaxis=T.faceXaxis.map((K=>G.PA.mT(K))),T.faceYaxis=T.faceYaxis.map((K=>G.PA.mT(K)));const B=new LK(K.name,A);return B.goldbergData=T,B}}var fK=T(13253);const OK={CreateBox:Z.c,CreateTiledBox:F,CreateSphere:d.d,CreateDisc:Y.b,CreateIcoSphere:I,CreateRibbon:Q,CreateCylinder:U,CreateTorus:g,CreateTorusKnot:l,CreateLineSystem:u.f,sQ:u.j,CreateDashedLines:u.b,ExtrudeShape:H,ExtrudeShapeCustom:e,CreateLathe:r,CreateTiledPlane:b,vQ:h.c,CreateGround:k.e,CreateTiledGround:k.f,CreateGroundFromHeightMap:k.c,CreatePolygon:c.b,ExtrudePolygon:c.f,CreateTube:s,CreatePolyhedron:R,CreateGeodesic:function(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=A.m||1;G!==Math.floor(G)&&(G=Math.floor(G),t.d.Warn("m not an integer only floor(m) used"));let B=A.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),t.d.Warn("n not an integer only floor(n) used")),B>G){const K=B;B=G,G=K,t.d.Warn("n > m therefore m and n swapped")}const L=new TK;return L.build(G,B),R(K,{custom:BK.BuildGeodesicData(L),size:A.size,sizeX:A.sizeX,sizeY:A.sizeY,sizeZ:A.sizeZ,faceUV:A.faceUV,faceColors:A.faceColors,flat:A.flat,updatable:A.updatable,sideOrientation:A.sideOrientation,frontUVs:A.frontUVs,backUVs:A.backUVs},T)},CreateGoldberg:function(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=A.size,C=A.sizeX||L||1,Q=A.sizeY||L||1,Y=A.sizeZ||L||1;let Z=A.m||1;Z!==Math.floor(Z)&&(Z=Math.floor(Z),t.d.Warn("m not an integer only floor(m) used"));let J=A.n||0;if(J!==Math.floor(J)&&(J=Math.floor(J),t.d.Warn("n not an integer only floor(n) used")),J>Z){const K=J;J=Z,Z=K,t.d.Warn("n > m therefore m and n swapped")}const b=new TK;b.build(Z,J);const P=BK.BuildGeodesicData(b),F=P.toGoldbergPolyhedronData(),d=new LK(K,T);A.sideOrientation=B.e._GetDefaultSideOrientation(A.sideOrientation),d._originalBuilderSideOrientation=A.sideOrientation;(function(K,A){const T=K.size,B=K.sizeX||T||1,L=K.sizeY||T||1,C=K.sizeZ||T||1,Q=0===K.sideOrientation?0:K.sideOrientation||f.d.DEFAULTSIDE,Y=[],Z=[],x=[],J=[];let b=1/0,P=-1/0,F=1/0,d=-1/0;for(let G=0;G<A.vertex.length;G++)b=Math.min(b,A.vertex[G][0]*B),P=Math.max(P,A.vertex[G][0]*B),F=Math.min(F,A.vertex[G][1]*L),d=Math.max(d,A.vertex[G][1]*L);let N=0;for(let f=0;f<A.face.length;f++){const K=A.face[f],T=G.PA.mT(A.vertex[K[0]]),Q=G.PA.mT(A.vertex[K[2]]),D=G.PA.mT(A.vertex[K[1]]),mK=Q.FA(T),U=D.FA(T),z=G.PA.Cross(U,mK).normalize();for(let G=0;G<K.length;G++){x.push(z.x,z.y,z.z);const T=A.vertex[K[G]];Y.push(T[0]*B,T[1]*L,T[2]*C);const f=(T[1]*L-F)/(d-F);J.push((T[0]*B-b)/(P-b),O.d?1-f:f)}for(let A=0;A<K.length-2;A++)Z.push(N,N+A+2,N+A+1);N+=K.length}f.d._ComputeSides(Q,Y,Z,x,J);const D=new f.d;return D.uK=Y,D.indices=Z,D.cK=x,D.HK=J,D})(A,F).pK(d,A.updatable),d.goldbergData.nbSharedFaces=P.sharedNodes,d.goldbergData.nbUnsharedFaces=P.poleNodes,d.goldbergData.adjacentFaces=P.adjacentFaces,d.goldbergData.nbFaces=d.goldbergData.nbSharedFaces+d.goldbergData.nbUnsharedFaces,d.goldbergData.nbFacesAtPole=(d.goldbergData.nbUnsharedFaces-12)/12;for(let B=0;B<P.vertex.length;B++)d.goldbergData.faceCenters.push(G.PA.mT(P.vertex[B])),d.goldbergData.faceCenters[B].x*=C,d.goldbergData.faceCenters[B].y*=Q,d.goldbergData.faceCenters[B].z*=Y,d.goldbergData.faceColors.push(new x.oO(1,1,1,1));for(let B=0;B<F.face.length;B++){const K=F.face[B],A=G.PA.mT(F.vertex[K[0]]),T=G.PA.mT(F.vertex[K[2]]),L=G.PA.mT(F.vertex[K[1]]),f=T.FA(A),O=L.FA(A),C=G.PA.Cross(O,f).normalize(),Q=G.PA.Cross(O,C).normalize();d.goldbergData.faceXaxis.push(O.normalize()),d.goldbergData.faceYaxis.push(C),d.goldbergData.faceZaxis.push(Q)}return d},CreateDecal:a,CreateCapsule:E,CreateText:fK.d}},13843:(K,A,T)=>{"use strict";T.d(A,{d:()=>OA});var G=T(12700),B=T(13081);class L extends B.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var f=T(12743),O=(T(12857),T(12651));class C{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(K){this._targetStopDuration!==K&&(this._targetStopDuration=K)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(K){this._noiseTexture!==K&&(this._noiseTexture=K,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(K){this._animationSheetEnabled!==K&&(this._animationSheetEnabled=K)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(K){this._isAnimationSheetEnabled!=K&&(this._isAnimationSheetEnabled=K,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){this._useLogarithmicDepth=K&&this.SK().getEngine().getCaps().fragmentDepthSupported}SK(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(K){switch(K){case C.BLENDMODE_MULTIPLYADD:return;case C.BLENDMODE_ADD:K=1;break;case C.BLENDMODE_ONEONE:K=6;break;case C.BLENDMODE_STANDARD:K=2;break;case C.BLENDMODE_MULTIPLY:K=4;break;case C.BLENDMODE_SUBTRACT:K=3}this._engine.setAlphaMode(K)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:G.PA.Zero()}set direction1(K){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=K)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:G.PA.Zero()}set direction2(K){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=K)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:G.PA.Zero()}set minEmitBox(K){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=K)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:G.PA.Zero()}set maxEmitBox(K){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=K)}get billboardMode(){return this._billboardMode}set billboardMode(K){this._billboardMode!==K&&(this._billboardMode=K,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(K){this._isBillboardBased!==K&&(this._isBillboardBased=K,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K)}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(!K&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=K)}_reset(){}_removeGradientAndTexture(K,A,T){if(!A)return this;let G=0;for(const B of A){if(B.gradient===K){A.splice(G,1);break}G++}return T&&T.dispose(),this}constructor(K){this.animations=[],this.renderingGroupId=0,this.BA=G.PA.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new G.PA(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new G.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.rQ=new G.PA(0,0,0),this._useLogarithmicDepth=!1,this.gravity=G.PA.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new f.oO(1,1,1,1),this.color2=new f.oO(1,1,1,1),this.colorDead=new f.oO(0,0,0,1),this.textureMask=new f.oO(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new L,this.id=K,this.name=K}createPointEmitter(K,A){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new G.PA(0,1,0),arguments.length>2&&void 0!==arguments[2]||new G.PA(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new G.PA(0,1,0),arguments.length>4&&void 0!==arguments[4]||new G.PA(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new G.PA(0,1,0),arguments.length>3&&void 0!==arguments[3]||new G.PA(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(K,A,T,G){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,C.BLENDMODE_SUBTRACT=-1,(0,O.c)("BABYLON.BaseParticleSystem",C);var Q=T(12716),Y=T(12550);class Z{constructor(){this.direction1=new G.PA(0,1,0),this.direction2=new G.PA(0,1,0),this.minEmitBox=new G.PA(-.5,-.5,-.5),this.maxEmitBox=new G.PA(.5,.5,.5)}startDirectionFunction(K,A,T,B){const L=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),f=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),O=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);if(B)return A.x=L,A.y=f,void(A.z=O);G.PA.TransformNormalFromFloatsToRef(L,f,O,K,A)}startPositionFunction(K,A,T,B){const L=(0,Q.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),f=(0,Q.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),O=(0,Q.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(B)return A.x=L,A.y=f,void(A.z=O);G.PA.TransformCoordinatesFromFloatsToRef(L,f,O,K,A)}clone(){const K=new Z;return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2),K.setVector3("minEmitBox",this.minEmitBox),K.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3),K.addUniform("minEmitBox",3),K.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.kf(),K.direction2=this.direction2.kf(),K.minEmitBox=this.minEmitBox.kf(),K.maxEmitBox=this.maxEmitBox.kf(),K}parse(K){G.PA.FromArrayToRef(K.direction1,0,this.direction1),G.PA.FromArrayToRef(K.direction2,0,this.direction2),G.PA.FromArrayToRef(K.minEmitBox,0,this.minEmitBox),G.PA.FromArrayToRef(K.maxEmitBox,0,this.maxEmitBox)}}class x{get radius(){return this._radius}set radius(K){this._radius=K,this._buildHeight()}get angle(){return this._angle}set angle(K){this._angle=K,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=T,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=A,this.radius=K}startDirectionFunction(K,A,T,B){B?G.TmpVectors.PA[0].G(T.ZC).normalize():T.position.subtractToRef(K.getTranslation(),G.TmpVectors.PA[0]).normalize();const L=(0,Q.RandomRange)(0,this.directionRandomizer),f=(0,Q.RandomRange)(0,this.directionRandomizer),O=(0,Q.RandomRange)(0,this.directionRandomizer);A.x=G.TmpVectors.PA[0].x+L,A.y=G.TmpVectors.PA[0].y+f,A.z=G.TmpVectors.PA[0].z+O,A.normalize()}startPositionFunction(K,A,T,B){const L=(0,Q.RandomRange)(0,2*Math.PI);let f;this.emitFromSpawnPointOnly?f=1e-4:(f=(0,Q.RandomRange)(0,this.heightRange),f=1-f*f);let O=this._radius-(0,Q.RandomRange)(0,this._radius*this.radiusRange);O*=f;const C=O*Math.sin(L),Y=O*Math.cos(L),Z=f*this._height;if(B)return A.x=C,A.y=Z,void(A.z=Y);G.PA.TransformCoordinatesFromFloatsToRef(C,Z,Y,K,A)}clone(){const K=new x(this._radius,this._angle,this.directionRandomizer);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat2("radius",this._radius,this.radiusRange),K.setFloat("coneAngle",this._angle),K.setFloat2("height",this._height,this.heightRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",2),K.addUniform("coneAngle",1),K.addUniform("height",2),K.addUniform("directionRandomizer",1)}getEffectDefines(){let K="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(K+="\n#define CONEEMITTERSPAWNPOINT"),K}getClassName(){return"ConeParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this._radius,K.angle=this._angle,K.directionRandomizer=this.directionRandomizer,K.radiusRange=this.radiusRange,K.heightRange=this.heightRange,K.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,K}parse(K){this.radius=K.radius,this.angle=K.angle,this.directionRandomizer=K.directionRandomizer,this.radiusRange=void 0!==K.radiusRange?K.radiusRange:1,this.heightRange=void 0!==K.radiusRange?K.heightRange:1,this.emitFromSpawnPointOnly=void 0!==K.emitFromSpawnPointOnly&&K.emitFromSpawnPointOnly}}class J extends x{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0);super(K,A),this.direction1=T,this.direction2=B}startDirectionFunction(K,A){const T=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),B=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),L=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);G.PA.TransformNormalFromFloatsToRef(T,B,L,K,A)}clone(){const K=new J(this.radius,this.angle,this.direction1,this.direction2);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.kf(),K.direction2=this.direction2.kf(),K}parse(K){super.parse(K),this.direction1.G(K.direction1),this.direction2.G(K.direction2)}}class b{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=K,this.height=A,this.radiusRange=T,this.directionRandomizer=B,this._tempVector=G.PA.Zero()}startDirectionFunction(K,A,T,B,L){T.position.subtractToRef(K.getTranslation(),this._tempVector),this._tempVector.normalize(),G.PA.TransformNormalToRef(this._tempVector,L,this._tempVector);const f=(0,Q.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let O=Math.atan2(this._tempVector.x,this._tempVector.z);O+=(0,Q.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=f,this._tempVector.x=Math.sin(O),this._tempVector.z=Math.cos(O),this._tempVector.normalize(),B?A.G(this._tempVector):G.PA.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K,A)}startPositionFunction(K,A,T,B){const L=(0,Q.RandomRange)(-this.height/2,this.height/2),f=(0,Q.RandomRange)(0,2*Math.PI),O=(0,Q.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(O)*this.radius,Y=C*Math.cos(f),Z=C*Math.sin(f);B?A.RO(Y,L,Z):G.PA.TransformCoordinatesFromFloatsToRef(Y,L,Z,K,A)}clone(){const K=new b(this.radius,this.directionRandomizer);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.height=this.height,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.height=K.height,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class P extends b{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.PA(0,1,0);super(K,A,T),this.direction1=B,this.direction2=L}startDirectionFunction(K,A,T,B){const L=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),f=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),O=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);B?A.RO(L,f,O):G.PA.TransformNormalFromFloatsToRef(L,f,O,K,A)}clone(){const K=new P(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.kf(),K.direction2=this.direction2.kf(),K}parse(K){super.parse(K),G.PA.FromArrayToRef(K.direction1,0,this.direction1),G.PA.FromArrayToRef(K.direction2,0,this.direction2)}}class F{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=A,this.directionRandomizer=T}startDirectionFunction(K,A,T,B){const L=T.position.FA(K.getTranslation()).normalize(),f=(0,Q.RandomRange)(0,this.directionRandomizer),O=(0,Q.RandomRange)(0,this.directionRandomizer),C=(0,Q.RandomRange)(0,this.directionRandomizer);L.x+=f,L.y+=O,L.z+=C,L.normalize(),B?A.G(L):G.PA.TransformNormalFromFloatsToRef(L.x,L.y,L.z,K,A)}startPositionFunction(K,A,T,B){const L=this.radius-(0,Q.RandomRange)(0,this.radius*this.radiusRange),f=(0,Q.RandomRange)(0,1),O=(0,Q.RandomRange)(0,2*Math.PI),C=Math.acos(2*f-1),Y=L*Math.cos(O)*Math.sin(C),Z=L*Math.cos(C),x=L*Math.sin(O)*Math.sin(C);B?A.RO(Y,Math.abs(Z),x):G.PA.TransformCoordinatesFromFloatsToRef(Y,Math.abs(Z),x,K,A)}clone(){const K=new F(this.radius,this.directionRandomizer);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class d{constructor(){this.direction1=new G.PA(0,1,0),this.direction2=new G.PA(0,1,0)}startDirectionFunction(K,A,T,B){const L=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),f=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),O=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);B?A.RO(L,f,O):G.PA.TransformNormalFromFloatsToRef(L,f,O,K,A)}startPositionFunction(K,A,T,B){B?A.RO(0,0,0):G.PA.TransformCoordinatesFromFloatsToRef(0,0,0,K,A)}clone(){const K=new d;return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.kf(),K.direction2=this.direction2.kf(),K}parse(K){G.PA.FromArrayToRef(K.direction1,0,this.direction1),G.PA.FromArrayToRef(K.direction2,0,this.direction2)}}class N{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=A,this.directionRandomizer=T}startDirectionFunction(K,A,T,B){const L=T.position.FA(K.getTranslation()).normalize(),f=(0,Q.RandomRange)(0,this.directionRandomizer),O=(0,Q.RandomRange)(0,this.directionRandomizer),C=(0,Q.RandomRange)(0,this.directionRandomizer);L.x+=f,L.y+=O,L.z+=C,L.normalize(),B?A.G(L):G.PA.TransformNormalFromFloatsToRef(L.x,L.y,L.z,K,A)}startPositionFunction(K,A,T,B){const L=this.radius-(0,Q.RandomRange)(0,this.radius*this.radiusRange),f=(0,Q.RandomRange)(0,1),O=(0,Q.RandomRange)(0,2*Math.PI),C=Math.acos(2*f-1),Y=L*Math.cos(O)*Math.sin(C),Z=L*Math.cos(C),x=L*Math.sin(O)*Math.sin(C);B?A.RO(Y,Z,x):G.PA.TransformCoordinatesFromFloatsToRef(Y,Z,x,K,A)}clone(){const K=new N(this.radius,this.directionRandomizer);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class D extends N{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.PA(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0);super(K),this.direction1=A,this.direction2=T}startDirectionFunction(K,A){const T=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),B=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),L=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);G.PA.TransformNormalFromFloatsToRef(T,B,L,K,A)}clone(){const K=new D(this.radius,this.direction1,this.direction2);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.kf(),K.direction2=this.direction2.kf(),K}parse(K){super.parse(K),this.direction1.G(K.direction1),this.direction2.G(K.direction2)}}class mK{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(K,A,T,B){const L=G.TmpVectors.PA[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,T,L);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,T,L);const K=G.TmpVectors.PA[1];L.subtractToRef(T.position,K),K.scaleToRef(1/T.lifeTime,L)}else L.set(0,0,0);B?A.G(L):G.PA.TransformNormalToRef(L,K,A)}startPositionFunction(K,A,T,B){const L=G.TmpVectors.PA[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,T,L):L.set(0,0,0),B?A.G(L):G.PA.TransformCoordinatesToRef(L,K,A)}clone(){const K=new mK;return Y.c.DeepCopy(this,K),K}applyToShader(K){}buildUniformLayout(K){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.particlePositionGenerator=this.particlePositionGenerator,K.particleDestinationGenerator=this.particleDestinationGenerator,K}parse(K){K.particlePositionGenerator&&(this.particlePositionGenerator=K.particlePositionGenerator),K.particleDestinationGenerator&&(this.particleDestinationGenerator=K.particleDestinationGenerator)}}var U=T(12768);class z{get mesh(){return this._mesh}set mesh(K){this._mesh!==K&&(this._mesh=K,K?(this._indices=K.Ef(),this._positions=K.getVerticesData(U.d.PositionKind),this._normals=K.getVerticesData(U.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=G.PA.Zero(),this._mesh=null,this.direction1=new G.PA(0,1,0),this.direction2=new G.PA(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=K}startDirectionFunction(K,A,T,B){if(this.useMeshNormalsForDirection&&this._normals)return void G.PA.TransformNormalToRef(this._storedNormal,K,A);const L=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),f=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),O=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);B?A.RO(L,f,O):G.PA.TransformNormalFromFloatsToRef(L,f,O,K,A)}startPositionFunction(K,A,T,B){if(!this._indices||!this._positions)return;const L=3*(Math.random()*(this._indices.length/3)|0),f=Math.random(),O=Math.random()*(1-f),C=1-f-O,Q=this._indices[L],Y=this._indices[L+1],Z=this._indices[L+2],x=G.TmpVectors.PA[0],J=G.TmpVectors.PA[1],b=G.TmpVectors.PA[2],P=G.TmpVectors.PA[3];G.PA.FromArrayToRef(this._positions,3*Q,x),G.PA.FromArrayToRef(this._positions,3*Y,J),G.PA.FromArrayToRef(this._positions,3*Z,b),P.x=f*x.x+O*J.x+C*b.x,P.y=f*x.y+O*J.y+C*b.y,P.z=f*x.z+O*J.z+C*b.z,B?A.RO(P.x,P.y,P.z):G.PA.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,K,A),this.useMeshNormalsForDirection&&this._normals&&(G.PA.FromArrayToRef(this._normals,3*Q,x),G.PA.FromArrayToRef(this._normals,3*Y,J),G.PA.FromArrayToRef(this._normals,3*Z,b),this._storedNormal.x=f*x.x+O*J.x+C*b.x,this._storedNormal.y=f*x.y+O*J.y+C*b.y,this._storedNormal.z=f*x.z+O*J.z+C*b.z)}clone(){const K=new z(this.mesh);return Y.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var K;const A={};return A.type=this.getClassName(),A.direction1=this.direction1.kf(),A.direction2=this.direction2.kf(),A.meshId=null===(K=this.mesh)||void 0===K?void 0:K.id,A.useMeshNormalsForDirection=this.useMeshNormalsForDirection,A}parse(K,A){G.PA.FromArrayToRef(K.direction1,0,this.direction1),G.PA.FromArrayToRef(K.direction2,0,this.direction2),K.meshId&&A&&(this.mesh=A.getLastMeshById(K.meshId)),this.useMeshNormalsForDirection=K.useMeshNormalsForDirection}}class g{_isUbo(K){return void 0!==K.addUniform}constructor(K){this._isUbo(K)?(this.setMatrix3x3=K.updateMatrix3x3.bind(K),this.setMatrix2x2=K.updateMatrix2x2.bind(K),this.setFloat=K.updateFloat.bind(K),this.setFloat2=K.updateFloat2.bind(K),this.setFloat3=K.updateFloat3.bind(K),this.setFloat4=K.updateFloat4.bind(K),this.setFloatArray=K.updateFloatArray.bind(K),this.setArray=K.updateArray.bind(K),this.setIntArray=K.updateIntArray.bind(K),this.setMatrix=K.Xf.bind(K),this.setMatrices=K.updateMatrices.bind(K),this.setVector3=K.updateVector3.bind(K),this.setVector4=K.updateVector4.bind(K),this.setColor3=K.updateColor3.bind(K),this.setColor4=K.updateColor4.bind(K),this.setDirectColor4=K.updateDirectColor4.bind(K),this.setInt=K.updateInt.bind(K),this.setInt2=K.updateInt2.bind(K),this.setInt3=K.updateInt3.bind(K),this.setInt4=K.updateInt4.bind(K)):(this.setMatrix3x3=K.setMatrix3x3.bind(K),this.setMatrix2x2=K.setMatrix2x2.bind(K),this.setFloat=K.setFloat.bind(K),this.setFloat2=K.setFloat2.bind(K),this.setFloat3=K.setFloat3.bind(K),this.setFloat4=K.setFloat4.bind(K),this.setFloatArray=K.setFloatArray.bind(K),this.setArray=K.setArray.bind(K),this.setIntArray=K.setIntArray.bind(K),this.setMatrix=K.setMatrix.bind(K),this.setMatrices=K.setMatrices.bind(K),this.setVector3=K.setVector3.bind(K),this.setVector4=K.setVector4.bind(K),this.setColor3=K.setColor3.bind(K),this.setColor4=K.setColor4.bind(K),this.setDirectColor4=K.setDirectColor4.bind(K),this.setInt=K.setInt.bind(K),this.setInt2=K.setInt2.bind(K),this.setInt3=K.setInt3.bind(K),this.setInt4=K.setInt4.bind(K))}}var S=T(12618);const l="gpuUpdateParticlesPixelShader",u="#version 300 es\nvoid main() {discard;}\n";S.b.ShadersStore[l]||(S.b.ShadersStore[l]=u);const c="gpuUpdateParticlesVertexShader",n="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";S.b.ShadersStore[c]||(S.b.ShadersStore[c]=n);(0,O.c)("BABYLON.WebGL2ParticleSystem",class{constructor(K,A){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=K,this._engine=A,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var K;return(null===(K=this._updateEffect)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof mK&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=K,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new g(this._updateEffect)}createVertexBuffers(K,A){this._updateVAO.push(this._createUpdateVAO(K)),this._renderVAO.push(this._engine.recordVertexArrayObject(A,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=A}createParticleBuffer(K){return K}bindDrawBuffers(K,A,T){T?this._engine.bindBuffers(this._renderVertexBuffers,T,A):this._engine.bindVertexArrayObject(this._renderVAO[K],null)}preUpdateParticleBuffer(){const K=this._engine;if(this._engine.enableEffect(this._updateEffect),!K.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(K,A,T){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[K],null);const G=this._engine;G.bindTransformFeedbackBuffer(A.getBuffer()),G.setRasterizerState(!1),G.beginTransformFeedback(!0),G.drawArraysType(3,0,T),G.endTransformFeedback(),G.setRasterizerState(!0),G.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let K=0;K<this._updateVAO.length;K++)this._engine.releaseVertexArrayObject(this._updateVAO[K]);this._updateVAO.length=0;for(let K=0;K<this._renderVAO.length;K++)this._engine.releaseVertexArrayObject(this._renderVAO[K]);this._renderVAO.length=0}_createUpdateVAO(K){const A={};A.position=K.createVertexBuffer("position",0,3);let T=3;A.age=K.createVertexBuffer("age",T,1),T+=1,A.size=K.createVertexBuffer("size",T,3),T+=3,A.life=K.createVertexBuffer("life",T,1),T+=1,A.seed=K.createVertexBuffer("seed",T,4),T+=4,A.direction=K.createVertexBuffer("direction",T,3),T+=3,this._parent.particleEmitterType instanceof mK&&(A.initialPosition=K.createVertexBuffer("initialPosition",T,3),T+=3),this._parent._colorGradientsTexture||(A.color=K.createVertexBuffer("color",T,4),T+=4),this._parent._isBillboardBased||(A.initialDirection=K.createVertexBuffer("initialDirection",T,3),T+=3),this._parent.noiseTexture&&(A.noiseCoordinates1=K.createVertexBuffer("noiseCoordinates1",T,3),T+=3,A.noiseCoordinates2=K.createVertexBuffer("noiseCoordinates2",T,3),T+=3),this._parent._angularSpeedGradientsTexture?(A.angle=K.createVertexBuffer("angle",T,1),T+=1):(A.angle=K.createVertexBuffer("angle",T,2),T+=2),this._parent._isAnimationSheetEnabled&&(A.cellIndex=K.createVertexBuffer("cellIndex",T,1),T+=1,this._parent.spriteRandomStartCell&&(A.cellStartOffset=K.createVertexBuffer("cellStartOffset",T,1),T+=1));const G=this._engine.recordVertexArrayObject(A,null,this._updateEffect);return this._engine.bindArrayBuffer(null),G}});class H{constructor(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,G=arguments.length>3?arguments[3]:void 0;this._engine=K,this._label=G,this._engine._storageBuffers.push(this),this._create(A,T)}_create(K,A){this._bufferSize=K,this._creationFlags=A,this._buffer=this._engine.createStorageBuffer(K,A,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(K,A,T){this._buffer&&this._engine.updateStorageBuffer(this._buffer,K,A,T)}async read(K,A,T,G){return await this._engine.readFromStorageBuffer(this._buffer,K,A,T,G)}dispose(){const K=this._engine._storageBuffers,A=K.indexOf(this);-1!==A&&(K[A]=K[K.length-1],K.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var e=T(12683),p=T(12688),r=T(12733),h=T(12674),k=T(13e3),s=T(12548),j=T(12639),R=T(12912);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.b}_addDuration(K,A){K<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==K?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(A,!1),this._gpuTimeInFrameId=K):this.counter.addCount(A,!1))}}var I=T(12596);class o{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=K,this._engine=A,this.uniqueId=k.d.UniqueId,A.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?G.bindingsMapping?(this._context=A.createComputeContext(),this._shaderPath=T,this._options={bindingsMapping:{},defines:[],...G}):s.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):s.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(K,A){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const G=this._bindings[K];this._bindings[K]={type:T?0:4,object:A,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!G||G.object!==A||G.type!==this._bindings[K].type)}setStorageTexture(K,A){const T=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==A),this._bindings[K]={type:1,object:A,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setExternalTexture(K,A){const T=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==A),this._bindings[K]={type:6,object:A,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setVideoTexture(K,A){return!!A.externalTexture&&(this.setExternalTexture(K,A.externalTexture),!0)}setUniformBuffer(K,A){const T=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==A),this._bindings[K]={type:o._BufferIsDataBuffer(A)?7:2,object:A,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setStorageBuffer(K,A){const T=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==A),this._bindings[K]={type:o._BufferIsDataBuffer(A)?7:3,object:A,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setTextureSampler(K,A){const T=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!T||!A.compareSampler(T.object)),this._bindings[K]={type:5,object:A,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}isReady(){let K=this._effect;for(const B in this._bindings){const K=this._bindings[B],A=K.type,T=K.object;switch(A){case 0:case 4:case 1:if(!T.isReady())return!1;break;case 6:if(!T.isReady())return!1;break}}const A=[],T=this._shaderPath;if(this._options.defines)for(let B=0;B<this._options.defines.length;B++)A.push(this._options.defines[B]);const G=A.join("\n");return this._cachedDefines!==G&&(this._cachedDefines=G,K=this._engine.createComputeEffect(T,{defines:G,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=K),!!K.isReady()}dispatch(K,A,T){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,K,A,T,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const T=o._BufferIsDataBuffer(K)?K:K.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,T,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const A in this._bindings){const T=this._bindings[A];if(!this._options.bindingsMapping[A])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+A+"'");switch(T.type){case 0:{const G=this._samplers[A],B=T.object;var K;if(!G||!B._texture||!G.compareSampler(B._texture))this._samplers[A]=(new j.c).setParameters(B.wrapU,B.wrapV,B.wrapR,B.anisotropicFilteringLevel,B._texture.samplingMode,null===(K=B._texture)||void 0===K?void 0:K._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const K=T.object;K.getBuffer()!==T.buffer&&(T.buffer=K.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((B=>{(0,I.f)((()=>this.dispatch(K,A,T)),B,void 0,G)}))}serialize(){const K=r.c.Serialize(this);K.options=this._options,K.shaderPath=this._shaderPath,K.lx={},K.textures={};for(const A in this._bindings){const T=this._bindings[A],G=T.object;switch(T.type){case 0:case 4:case 1:{const B=G.serialize();B&&(K.textures[A]=B,K.lx[A]={type:T.type});break}}}return K}static Parse(K,A,T){const G=r.c.Parse((()=>new o(K.name,A.getEngine(),K.shaderPath,K.options)),K,A,T);for(const B in K.textures){const L=K.lx[B],f=h.c.Parse(K.textures[B],A,T);0===L.type?G.setTexture(B,f):4===L.type?G.setTexture(B,f,!1):G.setStorageTexture(B,f)}return G}static _BufferIsDataBuffer(K){return void 0!==K.underlyingResource}}(0,e.c)([(0,p.B)()],o.prototype,"name",void 0),(0,e.c)([(0,p.B)()],o.prototype,"fastMode",void 0),(0,O.c)("BABYLON.ComputeShader",o);var W=T(12958);const i="gpuUpdateParticlesComputeShader",V="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";S.b.ShadersStoreWGSL[i]||(S.b.ShadersStoreWGSL[i]=V);(0,O.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(K,A){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=K,this._engine=A}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var K;return(null===(K=this._updateComputeShader)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){var A;const T={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(T.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(T.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(T.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(T.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(T.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(T.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(T.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new o("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:T,defines:K.split("\n")}),null===(A=this._simParamsComputeShader)||void 0===A||A.dispose(),this._simParamsComputeShader=new W.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new g(this._simParamsComputeShader)}createVertexBuffers(K,A){this._renderVertexBuffers.push(A)}createParticleBuffer(K){const A=new H(this._engine,4*K.length,11,"ComputeShaderParticleSystemBuffer");return A.update(K),this._bufferComputeShader.push(A),A.getBuffer()}bindDrawBuffers(K,A,T){this._engine.bindBuffers(this._renderVertexBuffers[K],T,A)}preUpdateParticleBuffer(){}updateParticleBuffer(K,A,T){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[K]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^K]),this._updateComputeShader.dispatch(Math.ceil(T/64))}releaseBuffers(){var K;for(let A=0;A<this._bufferComputeShader.length;++A)this._bufferComputeShader[A].dispose();this._bufferComputeShader.length=0,null===(K=this._simParamsComputeShader)||void 0===K||K.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class X{constructor(K,A,T){this.gradient=K,this.color1=A,this.color2=T}getColorToRef(K){this.color2?f.oO.LerpToRef(this.color1,this.color2,Math.random(),K):K.G(this.color1)}}class q{constructor(K,A){this.gradient=K,this.color=A}}class y{constructor(K,A,T){this.gradient=K,this.factor1=A,this.factor2=T}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(K,A,T){if(A[0].gradient>K)return void T(A[0],A[0],1);for(let B=0;B<A.length-1;B++){const G=A[B],L=A[B+1];if(K>=G.gradient&&K<=L.gradient){return void T(G,L,(K-G.gradient)/(L.gradient-G.gradient))}}const G=A.length-1;T(A[G],A[G],1)}}var a=T(12534),M=T(13181),E=T(12565);class t{constructor(K){this.particleSystem=K,this.position=G.PA.Zero(),this.direction=G.PA.Zero(),this.color=new f.oO(0,0,0,0),this.colorStep=new f.oO(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new G.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new f.oO(0,0,0,0),this._currentColor2=new f.oO(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=t._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let K=this.age,A=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===A?(A=1,K=this._randomCellOffset):K+=this._randomCellOffset);const T=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let G;G=this._initialSpriteCellLoop?(0,Q.Clamp)(K*A%this.lifeTime/this.lifeTime):(0,Q.Clamp)(K*A/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+G*T|0}_inheritParticleInfoToSubEmitter(K){if(K.particleSystem.BA.position){const A=K.particleSystem.BA;if(A.position.G(this.position),K.inheritDirection){const K=G.TmpVectors.PA[0];this.direction.normalizeToRef(K),A.setDirection(K,0,Math.PI/2)}}else{K.particleSystem.BA.G(this.position)}this.direction.scaleToRef(K.inheritedVelocityAmount/2,G.TmpVectors.PA[0]),K.particleSystem._inheritedVelocityOffset.G(G.TmpVectors.PA[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const K of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(K)}_reset(){this.age=0,this.id=t._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(K){K.position.G(this.position),this._initialDirection?K._initialDirection?K._initialDirection.G(this._initialDirection):K._initialDirection=this._initialDirection.clone():K._initialDirection=null,K.direction.G(this.direction),this.ZC&&(K.ZC?K.ZC.G(this.ZC):K.ZC=this.ZC.clone()),K.color.G(this.color),K.colorStep.G(this.colorStep),K.lifeTime=this.lifeTime,K.age=this.age,K._randomCellOffset=this._randomCellOffset,K.size=this.size,K.scale.G(this.scale),K.angle=this.angle,K.angularSpeed=this.angularSpeed,K.particleSystem=this.particleSystem,K.cellIndex=this.cellIndex,K.id=this.id,K._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(K._currentColorGradient=this._currentColorGradient,K._currentColor1.G(this._currentColor1),K._currentColor2.G(this._currentColor2)),this._currentSizeGradient&&(K._currentSizeGradient=this._currentSizeGradient,K._currentSize1=this._currentSize1,K._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(K._currentAngularSpeedGradient=this._currentAngularSpeedGradient,K._currentAngularSpeed1=this._currentAngularSpeed1,K._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(K._currentVelocityGradient=this._currentVelocityGradient,K._currentVelocity1=this._currentVelocity1,K._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(K._currentLimitVelocityGradient=this._currentLimitVelocityGradient,K._currentLimitVelocity1=this._currentLimitVelocity1,K._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(K._currentDragGradient=this._currentDragGradient,K._currentDrag1=this._currentDrag1,K._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(K._initialStartSpriteCellId=this._initialStartSpriteCellId,K._initialEndSpriteCellId=this._initialEndSpriteCellId,K._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(K.remapData&&this.remapData?K.remapData.G(this.remapData):K.remapData=new G.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.G(this._randomNoiseCoordinates1),K._randomNoiseCoordinates2.G(this._randomNoiseCoordinates2)):(K._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),K._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}t._Count=0;var KK=T(12812),AK=(T(12852),T(13063)),TK=T(13056),GK=T(12951);function BK(K,A){const T=(0,Q.RandomRange)(0,1);f.oO.LerpToRef(A.color1,A.color2,T,K.color),A.colorDead.subtractToRef(K.color,A._colorDiff),A._colorDiff.scaleToRef(1/K.lifeTime,K.colorStep)}function LK(K,A){K._currentColorGradient=A._colorGradients[0],K._currentColorGradient.getColorToRef(K.color),K._currentColor1.G(K.color),A._colorGradients.length>1?A._colorGradients[1].getColorToRef(K._currentColor2):K._currentColor2.G(K.color)}function fK(K,A){const T=A._colorGradients;w.GetCurrentGradient(A._ratio,T,((A,T,G)=>{A!==K._currentColorGradient&&(K._currentColor1.G(K._currentColor2),T.getColorToRef(K._currentColor2),K._currentColorGradient=A),f.oO.LerpToRef(K._currentColor1,K._currentColor2,G,K.color)}))}function OK(K,A){K.colorStep.scaleToRef(A._scaledUpdateSpeed,A._scaledColorStep),K.color.addInPlace(A._scaledColorStep),K.color.a<0&&(K.color.a=0)}function CK(K,A){w.GetCurrentGradient(A._ratio,A._angularSpeedGradients,((A,T,G)=>{A!==K._currentAngularSpeedGradient&&(K._currentAngularSpeed1=K._currentAngularSpeed2,K._currentAngularSpeed2=T.getFactor(),K._currentAngularSpeedGradient=A),K.angularSpeed=(0,Q.Lerp)(K._currentAngularSpeed1,K._currentAngularSpeed2,G)}))}function QK(K,A){K.angle+=K.angularSpeed*A._scaledUpdateSpeed}function YK(K,A){A.particleEmitterType.startDirectionFunction(A._emitterWorldMatrix,K.direction,K,A.isLocal,A._emitterInverseWorldMatrix)}function ZK(K,A){A.startDirectionFunction(A._emitterWorldMatrix,K.direction,K,A.isLocal)}function xK(K,A){K._currentVelocityGradient=A._velocityGradients[0],K._currentVelocity1=K._currentVelocityGradient.getFactor(),A._velocityGradients.length>1?K._currentVelocity2=A._velocityGradients[1].getFactor():K._currentVelocity2=K._currentVelocity1}function JK(K,A){K._currentLimitVelocityGradient=A._limitVelocityGradients[0],K._currentLimitVelocity1=K._currentLimitVelocityGradient.getFactor(),A._limitVelocityGradients.length>1?K._currentLimitVelocity2=A._limitVelocityGradients[1].getFactor():K._currentLimitVelocity2=K._currentLimitVelocity1}function bK(K,A){w.GetCurrentGradient(A._ratio,A._velocityGradients,((T,G,B)=>{T!==K._currentVelocityGradient&&(K._currentVelocity1=K._currentVelocity2,K._currentVelocity2=G.getFactor(),K._currentVelocityGradient=T),A._directionScale*=(0,Q.Lerp)(K._currentVelocity1,K._currentVelocity2,B)}))}function PK(K,A){w.GetCurrentGradient(A._ratio,A._limitVelocityGradients,((T,G,B)=>{T!==K._currentLimitVelocityGradient&&(K._currentLimitVelocity1=K._currentLimitVelocity2,K._currentLimitVelocity2=G.getFactor(),K._currentLimitVelocityGradient=T);const L=(0,Q.Lerp)(K._currentLimitVelocity1,K._currentLimitVelocity2,B);K.direction.length()>L&&K.direction.scaleInPlace(A.limitVelocityDamping)}))}function FK(K,A){K.direction.scaleToRef(A._directionScale,A._scaledDirection)}function dK(K,A){A.particleEmitterType.startPositionFunction(A._emitterWorldMatrix,K.position,K,A.isLocal)}function NK(K,A){A.startPositionFunction(A._emitterWorldMatrix,K.position,K,A.isLocal)}function DK(K,A){K.ZC?K.ZC.G(K.position):K.ZC=K.position.clone(),G.PA.TransformCoordinatesToRef(K.ZC,A._emitterWorldMatrix,K.position)}function mA(K,A){A.isLocal&&K.ZC?(K.ZC.addInPlace(A._scaledDirection),G.PA.TransformCoordinatesToRef(K.ZC,A._emitterWorldMatrix,K.position)):K.position.addInPlace(A._scaledDirection)}function UK(K,A){K._currentDragGradient=A._dragGradients[0],K._currentDrag1=K._currentDragGradient.getFactor(),A._dragGradients.length>1?K._currentDrag2=A._dragGradients[1].getFactor():K._currentDrag2=K._currentDrag1}function zK(K,A){w.GetCurrentGradient(A._ratio,A._dragGradients,((T,G,B)=>{T!==K._currentDragGradient&&(K._currentDrag1=K._currentDrag2,K._currentDrag2=G.getFactor(),K._currentDragGradient=T);const L=(0,Q.Lerp)(K._currentDrag1,K._currentDrag2,B);A._scaledDirection.scaleInPlace(1-L)}))}function gK(K,A){K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.RO(Math.random(),Math.random(),Math.random()),K._randomNoiseCoordinates2.RO(Math.random(),Math.random(),Math.random())):(K._randomNoiseCoordinates1=new G.PA(Math.random(),Math.random(),Math.random()),K._randomNoiseCoordinates2=new G.PA(Math.random(),Math.random(),Math.random()))}function SK(K,A){const T=A._noiseTextureData,B=A._noiseTextureSize;if(T&&B&&K._randomNoiseCoordinates1){const L=A._fetchR(K._randomNoiseCoordinates1.x,K._randomNoiseCoordinates1.y,B.width,B.height,T),f=A._fetchR(K._randomNoiseCoordinates1.z,K._randomNoiseCoordinates2.x,B.width,B.height,T),O=A._fetchR(K._randomNoiseCoordinates2.y,K._randomNoiseCoordinates2.z,B.width,B.height,T),C=G.TmpVectors.PA[0],Q=G.TmpVectors.PA[1];C.RO((2*L-1)*A.noiseStrength.x,(2*f-1)*A.noiseStrength.y,(2*O-1)*A.noiseStrength.z),C.scaleToRef(A._tempScaledUpdateSpeed,Q),K.direction.addInPlace(Q)}}function lK(K,A){A.gravity.scaleToRef(A._tempScaledUpdateSpeed,A._scaledGravity),K.direction.addInPlace(A._scaledGravity)}function uK(K,A){K.size=(0,Q.RandomRange)(A.minSize,A.maxSize),K.scale.RO((0,Q.RandomRange)(A.minScaleX,A.maxScaleX),(0,Q.RandomRange)(A.minScaleY,A.maxScaleY))}function cK(K,A){K._currentSizeGradient=A._sizeGradients[0],K._currentSize1=K._currentSizeGradient.getFactor(),K.size=K._currentSize1,A._sizeGradients.length>1?K._currentSize2=A._sizeGradients[1].getFactor():K._currentSize2=K._currentSize1,K.scale.RO((0,Q.RandomRange)(A.minScaleX,A.maxScaleX),(0,Q.RandomRange)(A.minScaleY,A.maxScaleY))}function nK(K,A){const T=A._actualFrame/A.targetStopDuration;w.GetCurrentGradient(T,A._startSizeGradients,((T,G,B)=>{T!==A._currentStartSizeGradient&&(A._currentStartSize1=A._currentStartSize2,A._currentStartSize2=G.getFactor(),A._currentStartSizeGradient=T);const L=(0,Q.Lerp)(A._currentStartSize1,A._currentStartSize2,B);K.scale.scaleInPlace(L)}))}function HK(K,A){w.GetCurrentGradient(A._ratio,A._sizeGradients,((A,T,G)=>{A!==K._currentSizeGradient&&(K._currentSize1=K._currentSize2,K._currentSize2=T.getFactor(),K._currentSizeGradient=A),K.size=(0,Q.Lerp)(K._currentSize1,K._currentSize2,G)}))}function eK(K,A){K.remapData=new G.Vector4(0,1,0,1)}function pK(K,A){A._colorRemapGradients&&A._colorRemapGradients.length>0&&w.GetCurrentGradient(A._ratio,A._colorRemapGradients,((A,T,G)=>{const B=(0,Q.Lerp)(A.factor1,T.factor1,G),L=(0,Q.Lerp)(A.factor2,T.factor2,G);K.remapData.x=B,K.remapData.y=L-B})),A._alphaRemapGradients&&A._alphaRemapGradients.length>0&&w.GetCurrentGradient(A._ratio,A._alphaRemapGradients,((A,T,G)=>{const B=(0,Q.Lerp)(A.factor1,T.factor1,G),L=(0,Q.Lerp)(A.factor2,T.factor2,G);K.remapData.z=B,K.remapData.w=L-B}))}function rK(K,A){const T=(0,Q.Clamp)(A._actualFrame/A.targetStopDuration);w.GetCurrentGradient(T,A._lifeTimeGradients,((A,G)=>{const B=A,L=G,f=B.getFactor(),O=L.getFactor(),C=(T-B.gradient)/(L.gradient-B.gradient);K.lifeTime=(0,Q.Lerp)(f,O,C)})),A._emitPower=(0,Q.RandomRange)(A.minEmitPower,A.maxEmitPower)}function hK(K,A){K.lifeTime=(0,Q.RandomRange)(A.minLifeTime,A.maxLifeTime),A._emitPower=(0,Q.RandomRange)(A.minEmitPower,A.maxEmitPower)}function kK(K,A){0===A._emitPower?(K._initialDirection?K._initialDirection.G(K.direction):K._initialDirection=K.direction.clone(),K.direction.set(0,0,0)):(K._initialDirection=null,K.direction.scaleInPlace(A._emitPower)),K.direction.addInPlace(A._inheritedVelocityOffset)}function sK(K,A){K.angularSpeed=(0,Q.RandomRange)(A.minAngularSpeed,A.maxAngularSpeed),K.angle=(0,Q.RandomRange)(A.minInitialRotation,A.maxInitialRotation)}function jK(K,A){K._currentAngularSpeedGradient=A._angularSpeedGradients[0],K.angularSpeed=K._currentAngularSpeedGradient.getFactor(),K._currentAngularSpeed1=K.angularSpeed,A._angularSpeedGradients.length>1?K._currentAngularSpeed2=A._angularSpeedGradients[1].getFactor():K._currentAngularSpeed2=K._currentAngularSpeed1,K.angle=(0,Q.RandomRange)(A.minInitialRotation,A.maxInitialRotation)}function RK(K,A){K._initialStartSpriteCellId=A.startSpriteCellID,K._initialEndSpriteCellId=A.endSpriteCellID,K._initialSpriteCellLoop=A.spriteCellLoop}function vK(K,A){K.previousItem=A.previousItem,K.nextItem=A,A.previousItem&&(A.previousItem.nextItem=K),A.previousItem=K}function IK(K,A){K.previousItem=A,K.nextItem=A.nextItem,A.nextItem&&(A.nextItem.previousItem=K),A.nextItem=K}function oK(K,A){let T=A;for(;T.nextItem;)T=T.nextItem;K.previousItem=T,K.nextItem=T.nextItem,T.nextItem=K}function WK(K){K.previousItem&&(K.previousItem.nextItem=K.nextItem),K.nextItem&&(K.nextItem.previousItem=K.previousItem)}class iK extends C{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(K){this._startDirectionFunction!==K&&(this._startDirectionFunction=K,this._directionProcessing.process=K?ZK:YK)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(K){this._startPositionFunction!==K&&(this._startPositionFunction=K,this._positionCreation.process=K?NK:dK)}set onDispose(K){this._onDisposeObserver&&this.Ff.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ff.add(K)}get O(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(K){this._useRampGradients!==K&&(this._useRampGradients=K,this._resetEffect(),K?(this._rampCreation={process:eK,previousItem:null,nextItem:null},IK(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:pK,previousItem:null,nextItem:null},IK(this._remapGradientProcessing,this._gravityProcessing)):(WK(this._rampCreation),WK(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(K){this._isLocal!==K&&(this._isLocal=K,K?(this._isLocalCreation={process:DK,previousItem:null,nextItem:null},IK(this._isLocalCreation,this._positionCreation)):WK(this._isLocalCreation))}get particles(){return this.mJ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(K){this._animationSheetEnabled!==K&&(this._animationSheetEnabled=K,K?(this._sheetCreation={process:RK,previousItem:null,nextItem:null},IK(this._sheetCreation,this._colorCreation)):WK(this._sheetCreation),this._reset())}getActiveCount(){return this.mJ.length}getClassName(){return"dY"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var K;let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[A])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[A]=new KK.b(this._engine),this._customWrappers[A].effect=K,this._customWrappers[A].drawContext&&(this._customWrappers[A].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(K){if(this.noiseTexture!==K){if(this._noiseTexture=K,!K)return WK(this._noiseCreation),void WK(this._noiseProcessing);this._noiseCreation={process:gK,previousItem:null,nextItem:null},IK(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:SK,previousItem:null,nextItem:null},IK(this._noiseProcessing,this._positionProcessing)}}constructor(K,A,T){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(K),this._emitterInverseWorldMatrix=G.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new G.PA,this.Ff=new a.e,this.onStoppedObservable=new a.e,this.onStartedObservable=new a.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.mJ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new f.oO(0,0,0,0),this._colorDiff=new f.oO(0,0,0,0),this._scaledDirection=G.PA.Zero(),this._scaledGravity=G.PA.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=K=>{},this.recycleParticle=K=>{const A=this.mJ.pop();A!==K&&A.copyTo(K),this._stockParticles.push(A)},this._createParticle=()=>{let K;return 0!==this._stockParticles.length?(K=this._stockParticles.pop(),K._reset()):K=new t(this),this._prepareParticle(K),K},this.paused=!1,this._shadersLoaded=!1,this._capacity=A,this._epsilon=O,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=G.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||E.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Nx.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:hK,previousItem:null,nextItem:null},this._positionCreation={process:dK,previousItem:null,nextItem:null},IK(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:YK,previousItem:null,nextItem:null},IK(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:kK,previousItem:null,nextItem:null},IK(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:uK,previousItem:null,nextItem:null},IK(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:sK,previousItem:null,nextItem:null},IK(this._angleCreation,this._sizeCreation),this._colorCreation={process:BK,previousItem:null,nextItem:null},IK(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,C||(this._colorProcessing={process:OK,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:QK,previousItem:null,nextItem:null},IK(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:FK,previousItem:null,nextItem:null},IK(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:mA,previousItem:null,nextItem:null},IK(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:lK,previousItem:null,nextItem:null},IK(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=L,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new KK.b(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Z,this.updateFunction=K=>{var A;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(A=this.noiseTexture.getContent())||void 0===A||A.then((K=>{this._noiseTextureData=K})));const T=K===this.mJ;for(let G=0;G<K.length;G++){const A=K[G];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const B=A.age;if(A.age+=this._tempScaledUpdateSpeed,A.age>A.lifeTime){const K=A.age-B,T=A.lifeTime-B;this._tempScaledUpdateSpeed=T*this._tempScaledUpdateSpeed/K,A.age=A.lifeTime}this._ratio=A.age/A.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let L=this._updateQueueStart;for(;L;)L.process(A,this),L=L.nextItem;if(this._isAnimationSheetEnabled&&!C&&A.updateCellIndex(),A._inheritParticleInfoToSubEmitters(),A.age>=A.lifeTime){if(this._emitFromParticle(A),A._attachedSubEmitters){for(const K of A._attachedSubEmitters)K.particleSystem.disposeOnStop=!0,K.particleSystem.stop();A._attachedSubEmitters=null}this.recycleParticle(A),T&&G--}else;}}}serialize(K){throw new Error("Method not implemented.")}clone(K,A){throw new Error("Method not implemented.")}_addFactorGradient(K,A,T,G){const B=new y(A,T,G);K.push(B),K.sort(((K,A)=>K.gradient<A.gradient?-1:K.gradient>A.gradient?1:0))}_removeFactorGradient(K,A){if(!K)return;let T=0;for(const G of K){if(G.gradient===A){K.splice(T,1);break}T++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=rK:this._lifeTimeCreation.process=hK}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:nK,previousItem:null,nextItem:null},IK(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(WK(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(K){this.targetStopDuration!==K&&(this._targetStopDuration=K,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(K,A,T){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,K,A,T),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(K){return this._removeFactorGradient(this._lifeTimeGradients,K),this._syncLifeTimeCreation(),this}addSizeGradient(K,A,T){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=cK,this._sizeGradientProcessing={process:HK,previousItem:null,nextItem:null},vK(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,K,A,T),this}removeSizeGradient(K){var A;return this._removeFactorGradient(this._sizeGradients,K),0===(null===(A=this._sizeGradients)||void 0===A?void 0:A.length)&&(WK(this._sizeGradientProcessing),this._sizeCreation.process=uK),this}addColorRemapGradient(K,A,T){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,K,A,T),this}removeColorRemapGradient(K){return this._removeFactorGradient(this._colorRemapGradients,K),this}addAlphaRemapGradient(K,A,T){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,K,A,T),this}removeAlphaRemapGradient(K){return this._removeFactorGradient(this._alphaRemapGradients,K),this}addAngularSpeedGradient(K,A,T){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=jK,this._angularSpeedGradientProcessing={process:CK,previousItem:null,nextItem:null},vK(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,K,A,T),this}removeAngularSpeedGradient(K){var A;return this._removeFactorGradient(this._angularSpeedGradients,K),0===(null===(A=this._angularSpeedGradients)||void 0===A?void 0:A.length)&&(this._angleCreation.process=sK,WK(this._angularSpeedGradientProcessing)),this}addVelocityGradient(K,A,T){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:xK,previousItem:null,nextItem:null},IK(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:bK,previousItem:null,nextItem:null},vK(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,K,A,T),this}removeVelocityGradient(K){var A;return this._removeFactorGradient(this._velocityGradients,K),0===(null===(A=this._velocityGradients)||void 0===A?void 0:A.length)&&(WK(this._velocityCreation),WK(this._velocityGradientProcessing)),this}addLimitVelocityGradient(K,A,T){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:JK,previousItem:null,nextItem:null},IK(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:PK,previousItem:null,nextItem:null},IK(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,K,A,T),this}removeLimitVelocityGradient(K){var A;return this._removeFactorGradient(this._limitVelocityGradients,K),0===(null===(A=this._limitVelocityGradients)||void 0===A?void 0:A.length)&&(WK(this._limitVelocityCreation),WK(this._limitVelocityGradientProcessing)),this}addDragGradient(K,A,T){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:UK,previousItem:null,nextItem:null},vK(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:zK,previousItem:null,nextItem:null},vK(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,K,A,T),this}removeDragGradient(K){var A;return this._removeFactorGradient(this._dragGradients,K),0===(null===(A=this._dragGradients)||void 0===A?void 0:A.length)&&(WK(this._dragCreation),WK(this._dragGradientProcessing)),this}addEmitRateGradient(K,A,T){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,K,A,T),this}removeEmitRateGradient(K){return this._removeFactorGradient(this._emitRateGradients,K),this}addStartSizeGradient(K,A,T){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,K,A,T),this._syncStartSizeCreation(),this}removeStartSizeGradient(K){return this._removeFactorGradient(this._startSizeGradients,K),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const K=new Uint8Array(4*this._rawTextureWidth),A=f.TmpColors.DA[0];for(let T=0;T<this._rawTextureWidth;T++){const G=T/this._rawTextureWidth;w.GetCurrentGradient(G,this._rampGradients,((G,B,L)=>{f.DA.LerpToRef(G.color,B.color,L,A),K[4*T]=255*A.r,K[4*T+1]=255*A.g,K[4*T+2]=255*A.b,K[4*T+3]=255}))}this._rampGradientsTexture=M.b.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((K,A)=>K.gradient<A.gradient?-1:K.gradient>A.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(K,A){this._rampGradients||(this._rampGradients=[]);const T=new q(K,A);return this._rampGradients.push(T),this._syncRampGradientTexture(),this}removeRampGradient(K){return this._removeGradientAndTexture(K,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(K,A,T){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=LK,this._colorProcessing.process=fK);const G=new X(K,A,T);return this._colorGradients.push(G),this._colorGradients.sort(((K,A)=>K.gradient<A.gradient?-1:K.gradient>A.gradient?1:0)),this}removeColorGradient(K){if(!this._colorGradients)return this;let A=0;for(const T of this._colorGradients){if(T.gradient===K){this._colorGradients.splice(A,1);break}A++}return 0===this._colorGradients.length&&(this._colorCreation.process=BK,this._colorProcessing.process=OK),this}resetDrawCache(){if(this._drawWrappers){for(const K of this._drawWrappers)if(K)for(const A of K)null===A||void 0===A||A.dispose();this._drawWrappers=[]}}_fetchR(K,A,T,G,B){return B[4*(((K=.5*Math.abs(K)+.5)*T%T|0)+((A=.5*Math.abs(A)+.5)*G%G|0)*T)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const K=this._engine,A=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*A),this._vertexBuffer=new U.b(K,this._vertexData,!0,A);let T=0;const G=this._vertexBuffer.createVertexBuffer(U.d.PositionKind,T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[U.d.PositionKind]=G,T+=3;const B=this._vertexBuffer.createVertexBuffer(U.d.ColorKind,T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[U.d.ColorKind]=B,T+=4;const L=this._vertexBuffer.createVertexBuffer("angle",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=L,T+=1;const f=this._vertexBuffer.createVertexBuffer("size",T,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=f,T+=2,this._isAnimationSheetEnabled){const K=this._vertexBuffer.createVertexBuffer("cellIndex",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=K,T+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const K=this._vertexBuffer.createVertexBuffer("direction",T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=K,T+=3}if(this._useRampGradients){const K=this._vertexBuffer.createVertexBuffer("remapData",T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=K,T+=4}let O;if(this._useInstancing){const A=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new U.b(K,A,!1,2),O=this._spriteBuffer.createVertexBuffer("offset",0,2)}else O=this._vertexBuffer.createVertexBuffer("offset",T,2,this._vertexBufferSize,this._useInstancing),T+=2;this._vertexBuffers.offset=O,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const K=[],A=[];let T=0;for(let G=0;G<this._capacity;G++)K.push(T),K.push(T+1),K.push(T+2),K.push(T),K.push(T+2),K.push(T+3),A.push(T,T+1,T+1,T+2,T+2,T+3,T+3,T,T,T+3),T+=4;this._indexBuffer=this._engine.createIndexBuffer(K),this._linesIndexBuffer=this._engine.createIndexBuffer(A)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(K)setTimeout((()=>{this.start(0)}),K);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var A;-1!==(null===(A=this.BA)||void 0===A?void 0:A.getClassName().indexOf("Mesh"))&&this.BA.wf(!0);const K=this.noiseTexture;if(K&&K.onGeneratedObservable)K.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let A=0;A<this.preWarmCycles;A++)this.animate(!0),K.render()}))}));else for(let A=0;A<this.preWarmCycles;A++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(K))}_postStop(K){}reset(){this._stockParticles.length=0,this.mJ.length=0}_appendParticleVertex(K,A,T,B){let L=K*this._vertexBufferSize;if(this._vertexData[L++]=A.position.x+this.rQ.x,this._vertexData[L++]=A.position.y+this.rQ.y,this._vertexData[L++]=A.position.z+this.rQ.z,this._vertexData[L++]=A.color.r,this._vertexData[L++]=A.color.g,this._vertexData[L++]=A.color.b,this._vertexData[L++]=A.color.a,this._vertexData[L++]=A.angle,this._vertexData[L++]=A.scale.x*A.size,this._vertexData[L++]=A.scale.y*A.size,this._isAnimationSheetEnabled&&(this._vertexData[L++]=A.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[L++]=A.direction.x,this._vertexData[L++]=A.direction.y,this._vertexData[L++]=A.direction.z);else if(A._initialDirection){let K=A._initialDirection;this.isLocal&&(G.PA.TransformNormalToRef(K,this._emitterWorldMatrix,G.TmpVectors.PA[0]),K=G.TmpVectors.PA[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[L++]=K.x,this._vertexData[L++]=K.y,this._vertexData[L++]=K.z}else{let K=A.direction;this.isLocal&&(G.PA.TransformNormalToRef(K,this._emitterWorldMatrix,G.TmpVectors.PA[0]),K=G.TmpVectors.PA[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[L++]=K.x,this._vertexData[L++]=K.y,this._vertexData[L++]=K.z}this._useRampGradients&&A.remapData&&(this._vertexData[L++]=A.remapData.x,this._vertexData[L++]=A.remapData.y,this._vertexData[L++]=A.remapData.z,this._vertexData[L++]=A.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===T?T=this._epsilon:1===T&&(T=1-this._epsilon),0===B?B=this._epsilon:1===B&&(B=1-this._epsilon)),this._vertexData[L++]=T,this._vertexData[L++]=B)}_prepareParticle(K){}_createNewOnes(K){let A;for(let T=0;T<K&&this.mJ.length!==this._capacity;T++){A=this._createParticle(),this.mJ.push(A);let K=this._createQueueStart;for(;K;)K.process(A,this),K=K.nextItem;A._inheritParticleInfoToSubEmitters()}}_update(K){if(this._alive=this.mJ.length>0,this.BA.position){const K=this.BA;this._emitterWorldMatrix=K.getWorldMatrix()}else{const K=this.BA;this._emitterWorldMatrix=G.Matrix.Translation(K.x,K.y,K.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.mJ),this._createNewOnes(K)}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G=[U.d.PositionKind,U.d.ColorKind,"angle","offset","size"];return K&&G.push("cellIndex"),A||G.push("direction"),T&&G.push("remapData"),G}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,AK.e)(G),K&&G.push("particlesInfos"),A&&G.push("logarithmicDepthConstant"),T&&(G.push("vFogInfos"),G.push("vFogColor")),G}fillDefines(K,A){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,AK.o)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&K.push("#define FOG")),this._isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),A===C.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&K.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case 2:K.push("#define BILLBOARDY");break;case 8:case 9:K.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&K.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:K.push("#define BILLBOARDMODE_ALL")}T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,A,T){A.push(...iK._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),K.push(...iK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,GK.i)(K,this._imageProcessingConfigurationDefines),(0,GK.e)(T,this._imageProcessingConfigurationDefines))}_getWrapper(K){const A=this._getCustomDrawWrapper(K);if(null!==A&&void 0!==A&&A.effect)return A;const T=[];this.fillDefines(T,K);const G=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let B=this._drawWrappers[G];B||(B=this._drawWrappers[G]=[]);let L=B[K];L||(L=new KK.b(this._engine),L.drawContext&&(L.drawContext.useInstancing=this._useInstancing),B[K]=L);const f=T.join("\n");if(L.defines!==f){const K=[],A=[],T=[];this.fillUniformsAttributesAndSamplerNames(A,K,T),L.setEffect(this._engine.createEffect("particles",K,A,T,f,void 0,void 0,void 0,void 0,this._shaderLanguage),f)}return L}animate(){var K;let A,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!T&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(T?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this.manualEmitCount>-1)A=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let K=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const A=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(A,this._emitRateGradients,((A,T,G)=>{A!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=T.getFactor(),this._currentEmitRateGradient=A),K=(0,Q.Lerp)(this._currentEmitRate1,this._currentEmitRate2,G)}))}A=K*this._scaledUpdateSpeed|0,this._newPartsExcess+=K*this._scaledUpdateSpeed-A}if(this._newPartsExcess>1&&(A+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?A=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(A),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!T){let K=0;for(let A=0;A<this.mJ.length;A++){const T=this.mJ[A];this._appendParticleVertices(K,T),K+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.mJ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(K,A){this._appendParticleVertex(K++,A,0,0),this._useInstancing||(this._appendParticleVertex(K++,A,1,0),this._appendParticleVertex(K++,A,1,1),this._appendParticleVertex(K++,A,0,1))}rebuild(){var K;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(K=this._spriteBuffer)||void 0===K||K._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!iK.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(T.bind(T,14007)),Promise.resolve().then(T.bind(T,13962))])):await Promise.all([Promise.resolve().then(T.bind(T,13953)),Promise.resolve().then(T.bind(T,13946))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.BA||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(K){const A=this._getWrapper(K),T=A.effect,B=this._engine;B.enableEffect(A);const L=this.defaultViewMatrix??this._scene.getViewMatrix();if(T.setTexture("diffuseSampler",this.particleTexture),T.setMatrix("view",L),T.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();T.setFloat3("particlesInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,this.spriteCellWidth/K.width)}if(T.setVector2("translationPivot",this.translationPivot),T.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;T.setVector3("eyePosition",K.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),T.setTexture("rampSampler",this._rampGradientsTexture));const f=T.defines;var O,C,Q,Y,Z,x;(this._scene&&((0,AK.g)(T,this,this._scene),this.applyFog&&(0,TK.h)(this._scene,void 0,T)),f.indexOf("#define BILLBOARDMODE_ALL")>=0&&(L.invertToRef(G.TmpVectors.Matrix[0]),T.setMatrix("invView",G.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?B.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,T):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,T)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?B.bindBuffers(this._vertexBuffers,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBuffer:this._indexBuffer,T):B.bindBuffers(this._vertexBuffers,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBufferUseInstancing:null,T);(this.useLogarithmicDepth&&this._scene&&(0,TK.k)(f,T,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(T),this._setEngineBasedOnBlendMode(K),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(T),this._useInstancing)?null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?B.drawElementsType(6,0,10,this.mJ.length):B.drawArraysType(7,0,4,this.mJ.length):null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?B.drawElementsType(1,0,10*this.mJ.length):B.drawElementsType(0,0,6*this.mJ.length);return this.mJ.length}render(){if(!this.isReady()||!this.mJ.length)return 0;const K=this._engine;K.setState&&(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0));let A=0;return A=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),A}_onDispose(){}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(A,T),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const K=this._scene.Nx.indexOf(this);K>-1&&this._scene.Nx.splice(K,1),this._scene._activeParticleSystems.dispose()}this.Ff.notifyObservers(this),this.Ff.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}iK.ForceGLSL=!1;var VK,XK=T(12555);!function(K){K[K.ATTACHED=0]="ATTACHED",K[K.END=1]="END"}(VK||(VK={}));class qK{constructor(K){if(this.particleSystem=K,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!K.BA||!K.BA.dispose){const A=(0,O.b)("BABYLON.AbstractMesh");K.BA=new A("SubemitterSystemEmitter",K.SK()),K._disposeEmitterOnDispose=!0}}clone(){let K=this.particleSystem.BA;if(K){if(K instanceof G.PA)K=K.clone();else if(-1!==K.getClassName().indexOf("Mesh")){K=new((0,O.b)("BABYLON.Mesh"))("",K.SK()),K.isVisible=!1}}else K=new G.PA;const A=new qK(this.particleSystem.clone(this.particleSystem.name,K));return A.particleSystem.name+="Clone",A.type=this.type,A.inheritDirection=this.inheritDirection,A.inheritedVelocityAmount=this.inheritedVelocityAmount,A.particleSystem._disposeEmitterOnDispose=!0,A.particleSystem.disposeOnStop=!0,A}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};return A.type=this.type,A.inheritDirection=this.inheritDirection,A.inheritedVelocityAmount=this.inheritedVelocityAmount,A.particleSystem=this.particleSystem.serialize(K),A}static _ParseParticleSystem(K,A,T){throw(0,XK.c)("ParseParticle")}static Parse(K,A,T){const G=K.particleSystem,B=new qK(qK._ParseParticleSystem(G,A,T,!0));return B.type=K.type,B.inheritDirection=K.inheritDirection,B.inheritedVelocityAmount=K.inheritedVelocityAmount,B.particleSystem._isSubEmitter=!0,B}dispose(){this.particleSystem.dispose()}}var yK=T(12604);function wK(K,A){const T=new d;return T.direction1=K,T.direction2=A,T}function aK(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function MK(){return new N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function EK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.PA(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0);return new D(K,A,T)}function tK(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function KA(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.PA(0,1,0);return new P(K,A,T,B,L)}function AA(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new x(K,A)}function TA(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0);return new J(K,A,T,B)}const GA=G.PA.Zero(),BA=G.PA.Zero(),LA=G.PA.Zero();class fA{constructor(){this.strength=0,this.position=G.PA.Zero()}_processParticle(K,A){this.position.subtractToRef(K.position,GA);const T=GA.lengthSquared()+1;GA.normalize().scaleToRef(this.strength/T,BA),BA.scaleToRef(A._tempScaledUpdateSpeed,LA),K.direction.addInPlace(LA)}serialize(){return{position:this.position.kf(),strength:this.strength}}}class OA extends iK{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=K=>{if(!this._subEmitters||0===this._subEmitters.length)return;const A=Math.floor(Math.random()*this._subEmitters.length);for(const T of this._subEmitters[A])if(1===T.type){const A=T.clone();K._inheritParticleInfoToSubEmitter(A),A.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(A.particleSystem),A.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(K,A){const T=wK(K,A);return this.particleEmitterType=T,T}get flowMap(){return this._flowMap}set flowMap(K){this._flowMap!==K&&(this._flowMap=K,this._flowMapUpdate&&(WK(this._flowMapUpdate),this._flowMapUpdate=null),K&&(this._flowMapUpdate={process:K=>{var A;const T=null===(A=this.SK())||void 0===A?void 0:A.getTransformMatrix();this._flowMap._processParticle(K,this.flowMapStrength*this._tempScaledUpdateSpeed,T)},previousItem:null,nextItem:null},IK(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(K){this._attractors.push(K),1===this._attractors.length&&(this._attractorUpdate={process:K=>{for(const A of this._attractors)A._processParticle(K,this)},previousItem:null,nextItem:null},IK(this._attractorUpdate,this._directionProcessing))}removeAttractor(K){const A=this._attractors.indexOf(K);-1!==A&&this._attractors.splice(A,1),0===this._attractors.length&&WK(this._attractorUpdate)}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(K)}createHemisphericEmitter(){const K=aK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=MK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=EK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.PA(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=tK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=KA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.PA(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=AA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=TA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,A,T,G){const B=new Z;return this.particleEmitterType=B,this.direction1=K,this.direction2=A,this.minEmitBox=T,this.maxEmitBox=G,B}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const K of this.subEmitters)K instanceof OA?this._subEmitters.push([new qK(K)]):K instanceof qK?this._subEmitters.push([K]):K instanceof Array&&this._subEmitters.push(K)}_stopSubEmitters(){if(this.activeSubSystems){for(const K of this.activeSubSystems)K.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const K=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==K&&this._rootParticleSystem.activeSubSystems.splice(K,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(K){K&&this._stopSubEmitters()}_prepareParticle(K){if(this._subEmitters&&this._subEmitters.length>0){const A=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];K._attachedSubEmitters=[];for(const T of A)if(0===T.type){const A=T.clone();K._attachedSubEmitters.push(A),A.particleSystem.start()}}}_onDispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),K&&this.particles)for(const T of this.particles)if(T._attachedSubEmitters)for(let K=T._attachedSubEmitters.length-1;K>=0;K-=1)T._attachedSubEmitters[K].dispose();if(A&&this.activeSubSystems)for(let T=this.activeSubSystems.length-1;T>=0;T-=1)this.activeSubSystems[T].dispose();if(this._subEmitters&&this._subEmitters.length){for(let K=0;K<this._subEmitters.length;K++)for(const A of this._subEmitters[K])A.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.BA&&this.BA.dispose&&this.BA.dispose(!0)}static _Parse(K,A,T,B){let L;L=T instanceof yK.c?null:T;const C=(0,O.b)("BABYLON.Texture");if(C&&L&&(K.texture?A.particleTexture=C.Parse(K.texture,L,B):K.textureName&&(A.particleTexture=new C(B+K.textureName,L,!1,void 0===K.invertY||K.invertY),A.particleTexture.name=K.textureName)),K.emitterId||0===K.emitterId||void 0!==K.BA?K.emitterId&&L?A.BA=L.getLastMeshById(K.emitterId):A.BA=G.PA.mT(K.BA):A.BA=G.PA.Zero(),A.isLocal=!!K.isLocal,void 0!==K.renderingGroupId&&(A.renderingGroupId=K.renderingGroupId),void 0!==K.isBillboardBased&&(A.isBillboardBased=K.isBillboardBased),void 0!==K.billboardMode&&(A.billboardMode=K.billboardMode),void 0!==K.useLogarithmicDepth&&(A.useLogarithmicDepth=K.useLogarithmicDepth),K.animations){for(let T=0;T<K.animations.length;T++){const G=K.animations[T],B=(0,O.b)("BABYLON.Animation");B&&A.animations.push(B.Parse(G))}A.beginAnimationOnStart=K.beginAnimationOnStart,A.beginAnimationFrom=K.beginAnimationFrom,A.beginAnimationTo=K.beginAnimationTo,A.beginAnimationLoop=K.beginAnimationLoop}if(K.autoAnimate&&L&&L.beginAnimation(A,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),A.startDelay=0|K.startDelay,A.minAngularSpeed=K.minAngularSpeed,A.maxAngularSpeed=K.maxAngularSpeed,A.minSize=K.minSize,A.maxSize=K.maxSize,K.minScaleX&&(A.minScaleX=K.minScaleX,A.maxScaleX=K.maxScaleX,A.minScaleY=K.minScaleY,A.maxScaleY=K.maxScaleY),void 0!==K.preWarmCycles&&(A.preWarmCycles=K.preWarmCycles,A.preWarmStepOffset=K.preWarmStepOffset),void 0!==K.minInitialRotation&&(A.minInitialRotation=K.minInitialRotation,A.maxInitialRotation=K.maxInitialRotation),A.minLifeTime=K.minLifeTime,A.maxLifeTime=K.maxLifeTime,A.minEmitPower=K.minEmitPower,A.maxEmitPower=K.maxEmitPower,A.emitRate=K.emitRate,A.gravity=G.PA.mT(K.gravity),K.noiseStrength&&(A.noiseStrength=G.PA.mT(K.noiseStrength)),A.color1=f.oO.mT(K.color1),A.color2=f.oO.mT(K.color2),A.colorDead=f.oO.mT(K.colorDead),A.updateSpeed=K.updateSpeed,A.targetStopDuration=K.targetStopDuration,A.blendMode=K.blendMode,K.colorGradients)for(const G of K.colorGradients)A.addColorGradient(G.gradient,f.oO.mT(G.color1),G.color2?f.oO.mT(G.color2):void 0);if(K.rampGradients){for(const T of K.rampGradients)A.addRampGradient(T.gradient,f.DA.mT(T.color));A.useRampGradients=K.useRampGradients}if(K.colorRemapGradients)for(const G of K.colorRemapGradients)A.addColorRemapGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.alphaRemapGradients)for(const G of K.alphaRemapGradients)A.addAlphaRemapGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.sizeGradients)for(const G of K.sizeGradients)A.addSizeGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.angularSpeedGradients)for(const G of K.angularSpeedGradients)A.addAngularSpeedGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.velocityGradients)for(const G of K.velocityGradients)A.addVelocityGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.dragGradients)for(const G of K.dragGradients)A.addDragGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.emitRateGradients)for(const G of K.emitRateGradients)A.addEmitRateGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.startSizeGradients)for(const G of K.startSizeGradients)A.addStartSizeGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.lifeTimeGradients)for(const G of K.lifeTimeGradients)A.addLifeTimeGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(K.limitVelocityGradients){for(const T of K.limitVelocityGradients)A.addLimitVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);A.limitVelocityDamping=K.limitVelocityDamping}if(K.noiseTexture&&L){const T=(0,O.b)("BABYLON.ProceduralTexture");A.noiseTexture=T.Parse(K.noiseTexture,L,B)}let Q;if(K.particleEmitterType){switch(K.particleEmitterType.type){case"SphereParticleEmitter":Q=new N;break;case"SphereDirectedParticleEmitter":Q=new D;break;case"ConeEmitter":case"ConeParticleEmitter":Q=new x;break;case"ConeDirectedParticleEmitter":Q=new J;break;case"CylinderParticleEmitter":Q=new b;break;case"CylinderDirectedParticleEmitter":Q=new P;break;case"HemisphericParticleEmitter":Q=new F;break;case"PointParticleEmitter":Q=new d;break;case"MeshParticleEmitter":Q=new z;break;case"CustomParticleEmitter":Q=new mK;break;default:Q=new Z}Q.parse(K.particleEmitterType,L)}else Q=new Z,Q.parse(K,L);A.particleEmitterType=Q,A.startSpriteCellID=K.startSpriteCellID,A.endSpriteCellID=K.endSpriteCellID,A.spriteCellLoop=K.spriteCellLoop??!0,A.spriteCellWidth=K.spriteCellWidth,A.spriteCellHeight=K.spriteCellHeight,A.spriteCellChangeSpeed=K.spriteCellChangeSpeed,A.spriteRandomStartCell=K.spriteRandomStartCell,A.disposeOnStop=K.disposeOnStop??!1,A.manualEmitCount=K.manualEmitCount??-1}static Parse(K,A,T){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const O=K.name;let C,Q,Y=null,Z=null;if(A instanceof yK.c?C=A:(Q=A,C=Q.getEngine()),K.customShader&&C.createEffectForParticles){Z=K.customShader;const A=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"";Y=C.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,A)}const x=new OA(O,L||K.aO,A,Y,K.isAnimationSheetEnabled);if(x.customShader=Z,x._rootUrl=T,K.id&&(x.id=K.id),K.subEmitters){x.subEmitters=[];for(const G of K.subEmitters){const K=[];for(const B of G)K.push(qK.Parse(B,A,T));x.subEmitters.push(K)}}if(K.attractors)for(const f of K.attractors){const K=new fA;K.position=G.PA.mT(f.position),K.strength=f.strength,x.addAttractor(K)}return OA._Parse(K,x,A,T),K.textureMask&&(x.textureMask=f.oO.mT(K.textureMask)),K.rQ&&(x.rQ=G.PA.mT(K.rQ)),K.preventAutoStart&&(x.preventAutoStart=K.preventAutoStart),B||x.preventAutoStart||x.start(),x}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};if(OA._Serialize(A,this,K),A.textureMask=this.textureMask.kf(),A.customShader=this.customShader,A.preventAutoStart=this.preventAutoStart,A.rQ=this.rQ.kf(),this.subEmitters){A.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const T of this._subEmitters){const G=[];for(const A of T)G.push(A.serialize(K));A.subEmitters.push(G)}}if(this._attractors&&this._attractors.length){A.attractors=[];for(const K of this._attractors)A.attractors.push(K.serialize())}return A}static _Serialize(K,A,T){if(K.name=A.name,K.id=A.id,K.aO=A.getCapacity(),K.disposeOnStop=A.disposeOnStop,K.manualEmitCount=A.manualEmitCount,A.BA.position){const T=A.BA;K.emitterId=T.id}else{const T=A.BA;K.BA=T.kf()}A.particleEmitterType&&(K.particleEmitterType=A.particleEmitterType.serialize()),A.particleTexture&&(T?K.texture=A.particleTexture.serialize():(K.textureName=A.particleTexture.name,K.invertY=!!A.particleTexture._invertY)),K.isLocal=A.isLocal,r.c.AppendSerializedAnimations(A,K),K.beginAnimationOnStart=A.beginAnimationOnStart,K.beginAnimationFrom=A.beginAnimationFrom,K.beginAnimationTo=A.beginAnimationTo,K.beginAnimationLoop=A.beginAnimationLoop,K.startDelay=A.startDelay,K.renderingGroupId=A.renderingGroupId,K.isBillboardBased=A.isBillboardBased,K.billboardMode=A.billboardMode,K.minAngularSpeed=A.minAngularSpeed,K.maxAngularSpeed=A.maxAngularSpeed,K.minSize=A.minSize,K.maxSize=A.maxSize,K.minScaleX=A.minScaleX,K.maxScaleX=A.maxScaleX,K.minScaleY=A.minScaleY,K.maxScaleY=A.maxScaleY,K.minEmitPower=A.minEmitPower,K.maxEmitPower=A.maxEmitPower,K.minLifeTime=A.minLifeTime,K.maxLifeTime=A.maxLifeTime,K.emitRate=A.emitRate,K.gravity=A.gravity.kf(),K.noiseStrength=A.noiseStrength.kf(),K.color1=A.color1.kf(),K.color2=A.color2.kf(),K.colorDead=A.colorDead.kf(),K.updateSpeed=A.updateSpeed,K.targetStopDuration=A.targetStopDuration,K.blendMode=A.blendMode,K.preWarmCycles=A.preWarmCycles,K.preWarmStepOffset=A.preWarmStepOffset,K.minInitialRotation=A.minInitialRotation,K.maxInitialRotation=A.maxInitialRotation,K.startSpriteCellID=A.startSpriteCellID,K.spriteCellLoop=A.spriteCellLoop,K.endSpriteCellID=A.endSpriteCellID,K.spriteCellChangeSpeed=A.spriteCellChangeSpeed,K.spriteCellWidth=A.spriteCellWidth,K.spriteCellHeight=A.spriteCellHeight,K.spriteRandomStartCell=A.spriteRandomStartCell,K.isAnimationSheetEnabled=A.isAnimationSheetEnabled,K.useLogarithmicDepth=A.useLogarithmicDepth;const G=A.getColorGradients();if(G){K.colorGradients=[];for(const A of G){const T={gradient:A.gradient,color1:A.color1.kf()};A.color2?T.color2=A.color2.kf():T.color2=A.color1.kf(),K.colorGradients.push(T)}}const B=A.getRampGradients();if(B){K.rampGradients=[];for(const A of B){const T={gradient:A.gradient,color:A.color.kf()};K.rampGradients.push(T)}K.useRampGradients=A.useRampGradients}const L=A.getColorRemapGradients();if(L){K.colorRemapGradients=[];for(const A of L){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.colorRemapGradients.push(T)}}const f=A.getAlphaRemapGradients();if(f){K.alphaRemapGradients=[];for(const A of f){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.alphaRemapGradients.push(T)}}const O=A.getSizeGradients();if(O){K.sizeGradients=[];for(const A of O){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.sizeGradients.push(T)}}const C=A.getAngularSpeedGradients();if(C){K.angularSpeedGradients=[];for(const A of C){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.angularSpeedGradients.push(T)}}const Q=A.getVelocityGradients();if(Q){K.velocityGradients=[];for(const A of Q){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.velocityGradients.push(T)}}const Y=A.getDragGradients();if(Y){K.dragGradients=[];for(const A of Y){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.dragGradients.push(T)}}const Z=A.getEmitRateGradients();if(Z){K.emitRateGradients=[];for(const A of Z){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.emitRateGradients.push(T)}}const x=A.getStartSizeGradients();if(x){K.startSizeGradients=[];for(const A of x){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.startSizeGradients.push(T)}}const J=A.getLifeTimeGradients();if(J){K.lifeTimeGradients=[];for(const A of J){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.lifeTimeGradients.push(T)}}const b=A.getLimitVelocityGradients();if(b){K.limitVelocityGradients=[];for(const A of b){const T={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?T.factor2=A.factor2:T.factor2=A.factor1,K.limitVelocityGradients.push(T)}K.limitVelocityDamping=A.limitVelocityDamping}A.noiseTexture&&(K.noiseTexture=A.noiseTexture.serialize())}clone(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G={...this._customWrappers};let B=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){B=this.customShader;const K=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"",A=L.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,K);G[0]?G[0].effect=A:this.setCustomEffect(A,0)}const f=this.serialize(T),O=OA.Parse(f,this._scene||this._engine,this._rootUrl);return O.name=K,O.customShader=B,O._customWrappers=G,void 0===A&&(A=this.BA),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.BA=A,this.preventAutoStart||O.start(),O}}OA.BILLBOARDMODE_Y=2,OA.BILLBOARDMODE_ALL=7,OA.BILLBOARDMODE_STRETCHED=8,OA.BILLBOARDMODE_STRETCHED_LOCAL=9,qK._ParseParticleSystem=OA.Parse;var CA=T(12935),QA=T(12931),YA=T(12826);YA.c.prototype.createTransformFeedback=function(){const K=this._gl.createTransformFeedback();if(!K)throw new Error("Unable to create Transform Feedback");return K},YA.c.prototype.deleteTransformFeedback=function(K){this._gl.deleteTransformFeedback(K)},YA.c.prototype.bindTransformFeedback=function(K){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,K)},YA.c.prototype.beginTransformFeedback=function(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(K?this._gl.POINTS:this._gl.TRIANGLES)},YA.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},YA.c.prototype.setTranformFeedbackVaryings=function(K,A){this._gl.transformFeedbackVaryings(K,A,this._gl.INTERLEAVED_ATTRIBS)},YA.c.prototype.bindTransformFeedbackBuffer=function(K){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K?K.underlyingResource:null)},YA.c.prototype.readTransformFeedbackBuffer=function(K){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K)};const ZA="clipPlaneFragmentDeclaration2",xA="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";S.b.IncludesShadersStore[ZA]||(S.b.IncludesShadersStore[ZA]=xA);T(13845),T(13851),T(13856),T(13864),T(13870),T(13872),T(13876),T(13885);const JA="gpuRenderParticlesPixelShader",bA="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";S.b.ShadersStore[JA]||(S.b.ShadersStore[JA]=bA);const PA="clipPlaneVertexDeclaration2",FA="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";S.b.IncludesShadersStore[PA]||(S.b.IncludesShadersStore[PA]=FA);T(13893),T(13895),T(13903),T(13909);const dA="gpuRenderParticlesVertexShader",NA="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";S.b.ShadersStore[dA]||(S.b.ShadersStore[dA]=NA);class DA extends C{static get IsSupported(){if(!E.b.LastCreatedEngine)return!1;const K=E.b.LastCreatedEngine.getCaps();return K.supportTransformFeedbacks||K.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(K){this._maxActiveParticleCount=Math.min(K,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(K){this.maxActiveParticleCount=K}createPointEmitter(K,A){const T=wK(K,A);return this.particleEmitterType=T,T}createHemisphericEmitter(){const K=aK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=MK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=EK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.PA(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=tK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=KA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.PA(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=AA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=TA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.PA(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.PA(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,A,T,G){const B=new Z;return this.particleEmitterType=B,this.direction1=K,this.direction2=A,this.minEmitBox=T,this.maxEmitBox=G,B}get flowMap(){return this._flowMap}set flowMap(K){this._flowMap!==K&&(this._flowMap=K)}isReady(){if(!this.BA||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==OA.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(OA.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(OA.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";K?setTimeout((()=>{this.start(0)}),K):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var K;let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[A])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[A]=new KK.b(this._engine),this._customWrappers[A].effect=K}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(K,A,T){return super._removeGradientAndTexture(K,A,T),this._releaseBuffers(),this}addColorGradient(K,A){this._colorGradients||(this._colorGradients=[]);const T=new X(K,A);return this._colorGradients.push(T),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(K&&this._colorGradients.sort(((K,A)=>K.gradient<A.gradient?-1:K.gradient>A.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(K){return this._removeGradientAndTexture(K,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const A in this._drawWrappers){var K;null===(K=this._drawWrappers[A].drawContext)||void 0===K||K.reset()}}_addFactorGradient(K,A,T){const G=new y(A,T);K.push(G),this._releaseBuffers()}addSizeGradient(K,A){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,A),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(K){return this._removeGradientAndTexture(K,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(K,A){if(!K)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&K.sort(((K,A)=>K.gradient<A.gradient?-1:K.gradient>A.gradient?1:0));const T=this;T[A]&&(T[A].dispose(),T[A]=null)}addAngularSpeedGradient(K,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,A),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(K){return this._removeGradientAndTexture(K,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(K,A){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,A),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(K){return this._removeGradientAndTexture(K,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(K,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,A),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(K){return this._removeGradientAndTexture(K,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(K,A){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,A),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(K){return this._removeGradientAndTexture(K,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(K){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(K,A,T){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(K),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ff=new a.e,this.onStoppedObservable=new a.e,this.onStartedObservable=new a.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=G.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||E.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Nx.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,O.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,O.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new KK.b(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers={0:new KK.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(A=A??{}).randomTextureSize||delete A.randomTextureSize;const f={aO:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...A},C=A;isFinite(C)&&(f.aO=C),this._capacity=f.aO,this._maxActiveParticleCount=f.aO,this._currentActiveCount=0,this._isAnimationSheetEnabled=L,this.particleEmitterType=new Z;const Q=Math.min(this._engine.getCaps().maxTextureSize,f.randomTextureSize);let Y=[];for(let G=0;G<Q;++G)Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random());this._randomTexture=new M.b(new Float32Array(Y),Q,1,5,T,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Y=[];for(let G=0;G<Q;++G)Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random());this._randomTexture2=new M.b(new Float32Array(Y),Q,1,5,T,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Q}_reset(){this._releaseBuffers()}_createVertexBuffers(K,A,T){const G={};G.position=A.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let B=3;G.age=A.createVertexBuffer("age",B,1,this._attributesStrideSize,!0),B+=1,G.size=A.createVertexBuffer("size",B,3,this._attributesStrideSize,!0),B+=3,G.life=A.createVertexBuffer("life",B,1,this._attributesStrideSize,!0),B+=1,B+=4,this.billboardMode===OA.BILLBOARDMODE_STRETCHED&&(G.direction=A.createVertexBuffer("direction",B,3,this._attributesStrideSize,!0)),B+=3,this._platform.alignDataInBuffer&&(B+=1),this.particleEmitterType instanceof mK&&(B+=3,this._platform.alignDataInBuffer&&(B+=1)),this._colorGradientsTexture||(G.color=A.createVertexBuffer("color",B,4,this._attributesStrideSize,!0),B+=4),this._isBillboardBased||(G.initialDirection=A.createVertexBuffer("initialDirection",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),this.noiseTexture&&(G.noiseCoordinates1=A.createVertexBuffer("noiseCoordinates1",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1),G.noiseCoordinates2=A.createVertexBuffer("noiseCoordinates2",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),G.angle=A.createVertexBuffer("angle",B,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?B++:B+=2,this._isAnimationSheetEnabled&&(G.cellIndex=A.createVertexBuffer("cellIndex",B,1,this._attributesStrideSize,!0),B+=1,this.spriteRandomStartCell&&(G.cellStartOffset=A.createVertexBuffer("cellStartOffset",B,1,this._attributesStrideSize,!0),B+=1)),G.offset=T.createVertexBuffer("offset",0,2),G.uv=T.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(G),this._platform.createVertexBuffers(K,G),this.resetDrawCache()}_initialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!K)return;const A=this._engine,T=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof mK&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const B=this.particleEmitterType instanceof mK,L=G.TmpVectors.PA[0];let f=0;for(let G=0;G<this._capacity;G++)if(T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),B?(this.particleEmitterType.particleDestinationGenerator(G,null,L),T.push(L.x),T.push(L.y),T.push(L.z)):(T.push(0),T.push(0),T.push(0)),this._platform.alignDataInBuffer&&T.push(0),f+=16,B&&(this.particleEmitterType.particlePositionGenerator(G,null,L),T.push(L.x),T.push(L.y),T.push(L.z),this._platform.alignDataInBuffer&&T.push(0),f+=4),this._colorGradientsTexture||(T.push(0),T.push(0),T.push(0),T.push(0),f+=4),this.isBillboardBased||(T.push(0),T.push(0),T.push(0),this._platform.alignDataInBuffer&&T.push(0),f+=4),this.noiseTexture&&(T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),f+=8),T.push(0),f+=1,this._angularSpeedGradientsTexture||(T.push(0),f+=1),this._isAnimationSheetEnabled&&(T.push(0),f+=1,this.spriteRandomStartCell&&(T.push(0),f+=1)),this._platform.alignDataInBuffer){let K=3-(f+3&3);for(f+=K;K-- >0;)T.push(0)}const O=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(T),Q=this._platform.createParticleBuffer(T);this._buffer0=new U.b(A,C,!1,this._attributesStrideSize),this._buffer1=new U.b(A,Q,!1,this._attributesStrideSize),this._spriteBuffer=new U.b(A,O,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let K=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(K+="\n#define BILLBOARD"),this._colorGradientsTexture&&(K+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(K+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(K+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(K+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(K+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(K+="\n#define DRAGGRADIENTS"),this._flowMap&&(K+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(K+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(K+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(K+="\n#define NOISE"),this.isLocal&&(K+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===K||(this._cachedUpdateDefines=K,this._updateBuffer=this._platform.createUpdateBuffer(K)),this._platform.isUpdateBufferReady()}_getWrapper(K){const A=this._getCustomDrawWrapper(K);if(null!==A&&void 0!==A&&A.effect)return A;const T=[];this.fillDefines(T,K);let G=this._drawWrappers[K];G||(G=new KK.b(this._engine),G.drawContext&&(G.drawContext.useInstancing=!0),this._drawWrappers[K]=G);const B=T.join("\n");if(G.defines!==B){const K=[],A=[],T=[];this.fillUniformsAttributesAndSamplerNames(A,K,T),G.setEffect(this._engine.createEffect("gpuRenderParticles",K,A,T,B),B)}return G}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=[U.d.PositionKind,"age","life","size","angle"];return K||B.push(U.d.ColorKind),A&&B.push("cellIndex"),T||B.push("initialDirection"),G&&B.push("direction"),B.push("offset",U.d.UVKind),B}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G=["emitterWM","rQ","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,AK.e)(G),K&&G.push("sheetInfos"),A&&G.push("logarithmicDepthConstant"),T&&(G.push("vFogInfos"),G.push("vFogColor")),G}fillDefines(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,AK.o)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==QA.c.FOGMODE_NONE&&K.push("#define FOG")),A===OA.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this.isLocal&&K.push("#define LOCAL"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case OA.BILLBOARDMODE_Y:K.push("#define BILLBOARDY");break;case OA.BILLBOARDMODE_STRETCHED:K.push("#define BILLBOARDSTRETCHED");break;case OA.BILLBOARDMODE_ALL:K.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&K.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,A,T){A.push(...DA._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===OA.BILLBOARDMODE_STRETCHED)),K.push(...DA._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(CA.b.PrepareUniforms(K,this._imageProcessingConfigurationDefines),CA.b.PrepareSamplers(T,this._imageProcessingConfigurationDefines))}animate(){var K;let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(A?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(K,A){const T=this[A];if(!K||!K.length||T)return;const G=new Float32Array(this._rawTextureWidth);for(let B=0;B<this._rawTextureWidth;B++){const A=B/this._rawTextureWidth;w.GetCurrentGradient(A,K,((K,A,T)=>{G[B]=(0,Q.Lerp)(K.factor1,A.factor1,T)}))}this[A]=M.b.CreateRTexture(G,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[A].name=A.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const K=new Uint8Array(4*this._rawTextureWidth),A=f.TmpColors.oO[0];for(let T=0;T<this._rawTextureWidth;T++){const G=T/this._rawTextureWidth;w.GetCurrentGradient(G,this._colorGradients,((G,B,L)=>{f.oO.LerpToRef(G.color1,B.color1,L,A),K[4*T]=255*A.r,K[4*T+1]=255*A.g,K[4*T+2]=255*A.b,K[4*T+3]=255*A.a}))}this._colorGradientsTexture=M.b.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(K,A){var T,B,L,f;const O=this._getWrapper(K),C=O.effect;this._engine.enableEffect(O);const Q=(null===(T=this._scene)||void 0===T?void 0:T.getViewMatrix())||G.Matrix.IdentityReadOnly;if(C.setMatrix("view",Q),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("rQ",this.rQ),this.isLocal&&C.setMatrix("emitterWM",A),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,K.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;C.setVector3("eyePosition",K.globalPosition)}const Y=C.defines;if(this._scene&&((0,AK.g)(C,this,this._scene),this.applyFog&&(0,TK.h)(this._scene,void 0,C)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0){const K=Q.clone();K.invert(),C.setMatrix("invView",K)}return this.useLogarithmicDepth&&this._scene&&(0,TK.k)(Y,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(K),this._platform.bindDrawBuffers(this._targetIndex,C,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(f=this._scene)&&void 0!==f&&f.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(K){if(!this.BA||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!K)if(this.BA.position){K=this.BA.getWorldMatrix()}else{const A=this.BA;K=G.TmpVectors.Matrix[0],G.Matrix.TranslationToRef(A.x,A.y,A.z,K)}const A=this._engine,T=A.getDepthWrite();if(A.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const K=this.SK();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",K.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",K),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const B=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=B,A.setDepthWrite(T)}render(){let K,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!A&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let K=0;K<this.preWarmCycles;K++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const K=0|this._accumulatedCount;this._accumulatedCount-=K,this._currentActiveCount+=K}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.BA.position){K=this.BA.getWorldMatrix()}else{const A=this.BA;K=G.TmpVectors.Matrix[0],G.Matrix.TranslationToRef(A.x,A.y,A.z,K)}const B=this._engine;this.updateInAnimate||this._update(K);let L=0;return A||T||(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0),L=this.blendMode===OA.BLENDMODE_MULTIPLYADD?this._render(OA.BLENDMODE_MULTIPLY,K)+this._render(OA.BLENDMODE_ADD,K):this._render(this.blendMode,K),this._engine.setAlphaMode(0)),L}rebuild(){const K=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(K,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,K()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const A in this._drawWrappers){this._drawWrappers[A].dispose()}if(this._drawWrappers={},this._scene){const K=this._scene.Nx.indexOf(this);K>-1&&this._scene.Nx.splice(K,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let A=0;A<this._renderVertexBuffers.length;++A){const K=this._renderVertexBuffers[A];for(const A in K)K[A].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ff.notifyObservers(this),this.Ff.clear()}clone(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G={...this._customWrappers};let B=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){B=this.customShader;const K=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"";G[0]=L.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,K,void 0,void 0,void 0,this)}const f=this.serialize(T),O=DA.Parse(f,this._scene||this._engine,this._rootUrl);return O.name=K,O.customShader=B,O._customWrappers=G,void 0===A&&(A=this.BA),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.BA=A,O}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};return OA._Serialize(A,this,K),A.activeParticleCount=this.activeParticleCount,A.randomTextureSize=this._randomTextureSize,A.customShader=this.customShader,A}static Parse(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const L=K.name;let f,O;A instanceof yK.c?f=A:(O=A,f=O.getEngine());const C=new DA(L,{aO:B||K.aO,randomTextureSize:K.randomTextureSize},A,null,K.isAnimationSheetEnabled);if(C._rootUrl=T,K.customShader&&f.createEffectForParticles){const A=K.customShader,T=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",G=f.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,T,void 0,void 0,void 0,C);C.setCustomEffect(G,0),C.customShader=A}return K.id&&(C.id=K.id),K.activeParticleCount&&(C.activeParticleCount=K.activeParticleCount),OA._Parse(K,C,A,T),K.preventAutoStart&&(C.preventAutoStart=K.preventAutoStart),G||C.preventAutoStart||C.start(),C}}var mT=T(12526),UA=T(13916),zA=T(13069);class gA{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(K){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const A of this.systems)A.BA=K;this._emitterNode=K}setEmitterAsSphere(K,A,T){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:K,renderingGroupId:A};const G=(0,UA.d)("emitterSphere",{diameter:K.diameter,segments:K.segments},T);G.renderingGroupId=A;const B=new zA.NA("emitterSphereMaterial",T);B.emissiveColor=K.color,G.material=B;for(const L of this.systems)L.BA=G;this._emitterNode=G}start(K){for(const A of this.systems)K&&(A.BA=K),A.start()}dispose(){for(const K of this.systems)K.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={systems:[]};for(const T of this.systems)A.systems.push(T.serialize(K));return this._emitterNode&&(A.BA=this._emitterCreationOptions),A}static Parse(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0;const B=new gA,L=this.BaseAssetsUrl+"/textures/";A=A||E.b.LastCreatedScene;for(const f of K.systems)B.systems.push(T?DA.Parse(f,A,L,!0,G):OA.Parse(f,A,L,!0,G));if(K.BA){const T=K.BA.options;if("Sphere"===K.BA.kind)B.setEmitterAsSphere({diameter:T.diameter,segments:T.segments,color:f.DA.mT(T.color)},K.BA.renderingGroupId,A)}return B}}gA.BaseAssetsUrl="https://assets.babylonjs.com/particles";var SA=T(12563);class lA{static CreateDefault(K){let A,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,G=arguments.length>2?arguments[2]:void 0;A=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new DA("default system",{aO:T},G):new OA("default system",T,G),A.BA=K;const B=mT.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return A.particleTexture=new h.c(B,A.SK()),A.createConeEmitter(.1,Math.PI/4),A.color1=new f.oO(1,1,1,1),A.color2=new f.oO(1,1,1,1),A.colorDead=new f.oO(1,1,1,0),A.minSize=.1,A.maxSize=.1,A.minEmitPower=2,A.maxEmitPower=2,A.updateSpeed=1/60,A.emitRate=30,A}static CreateAsync(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0;A||(A=E.b.LastCreatedScene);const B={};return A.addPendingData(B),new Promise(((L,f)=>{if(T&&!DA.IsSupported)return A.removePendingData(B),f("Particle system with GPU is not supported.");mT.Tools.LoadFile(`${lA.BaseAssetsUrl}/systems/${K}.json`,(K=>{A.removePendingData(B);const f=JSON.parse(K.toString());return L(gA.Parse(f,A,T,G))}),void 0,void 0,void 0,(()=>(A.removePendingData(B),f(`An error occurred with the creation of your particle system. Check if your type '${K}' exists.`))))}))}static ExportSet(K){const A=new gA;for(const T of K)A.systems.push(T);return A}static ParseFromFileAsync(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",L=arguments.length>5?arguments[5]:void 0;return new Promise(((f,O)=>{const C=new SA.b;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const A=JSON.parse(C.responseText);let O;O=G?DA.Parse(A,T,B,!1,L):OA.Parse(A,T,B,!1,L),K&&(O.name=K),f(O)}else O("Unable to load the particle system")})),C.open("GET",A),C.send()}))}static ParseFromSnippetAsync(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0;if("_BLANK"===K){const K=this.CreateDefault(null);return K.start(),Promise.resolve(K)}return new Promise(((L,f)=>{const O=new SA.b;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const f=JSON.parse(JSON.parse(O.responseText).jsonPayload),C=JSON.parse(f.particleSystem);let Q;Q=T?DA.Parse(C,A,G,!1,B):OA.Parse(C,A,G,!1,B),Q.snippetId=K,L(Q)}else f("Unable to load the snippet "+K)})),O.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),O.send()}))}}lA.BaseAssetsUrl=gA.BaseAssetsUrl,lA.SnippetUrl="https://snippet.babylonjs.com",lA.CreateFromSnippetAsync=lA.ParseFromSnippetAsync;var uA=T(13147),cA=T(12971),nA=T(13924);(0,nA.h)(cA.e.NAME_PARTICLESYSTEM,((K,A,T,G)=>{const B=(0,nA.j)(cA.e.NAME_PARTICLESYSTEM);if(B&&void 0!==K.Nx&&null!==K.Nx)for(let L=0,f=K.Nx.length;L<f;L++){const f=K.Nx[L];T.Nx.push(B(f,A,G))}})),(0,nA.e)(cA.e.NAME_PARTICLESYSTEM,((K,A,T)=>{if(K.activeParticleCount){return DA.Parse(K,A,T)}return OA.Parse(K,A,T)})),yK.c.prototype.createEffectForParticles=function(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Y=arguments.length>9?arguments[9]:void 0,Z=[],x=[];const J=[];return C?C.fillUniformsAttributesAndSamplerNames(x,Z,J):(Z=OA._GetAttributeNamesOrOptions(),x=OA._GetEffectCreationOptions()),-1===B.indexOf(" BILLBOARD")&&(B+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===B.indexOf(" ANIMATESHEET")&&(B+="\n#define ANIMATESHEET\n"),-1===G.indexOf("diffuseSampler")&&G.push("diffuseSampler"),this.createEffect({vertex:Y??(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:K},Z,x.concat(A),J.concat(G),B,L,f,O,void 0,Q,(async()=>{0===Q?await Promise.resolve().then(T.bind(T,13953)):await Promise.resolve().then(T.bind(T,14007))}))},uA.e.prototype.getEmittedParticleSystems=function(){const K=[];for(let A=0;A<this.SK().Nx.length;A++){const T=this.SK().Nx[A];T.BA===this&&K.push(T)}return K},uA.e.prototype.getHierarchyEmittedParticleSystems=function(){const K=[],A=this.getDescendants();A.push(this);for(let T=0;T<this.SK().Nx.length;T++){const G=this.SK().Nx[T],B=G.BA;B.position&&-1!==A.indexOf(B)&&K.push(G)}return K};T(13027),T(13039),T(13129);T(13133),T(13930),T(12895),T(13018),T(13177);T(12889);var HA;T(13938),T(12722);!function(K){K[K.Color=2]="Color",K[K.UV=1]="UV",K[K.Random=0]="Random",K[K.Stated=3]="Stated"}(HA||(HA={}));var eA=T(12920);const pA=new G.PA(0,0,0),rA=new G.PA(0,0,0),hA=new G.PA(0,0,0);class kA{constructor(K,A,T){this.width=K,this.height=A,this.data=T}processFlowable(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;if(!T)return;T instanceof G.Matrix?G.PA.TransformCoordinatesToRef(K.position,T,hA):(hA.x=T.x,hA.y=T.y,hA.z=T.z);const B=.5*hA.x+.5,L=1-(.5*hA.y+.5),f=Math.floor(B*this.width),O=Math.floor(L*this.height);if(f<0||f>=this.width||O<0||O>=this.height)return;const C=4*(O*this.width+f),Q=this.data[C]/255*2-1,Y=this.data[C+1]/255*2-1,Z=this.data[C+2]/255*2-1,x=this.data[C+3]/255;pA.set(Q,Y,Z),pA.scaleToRef(A*x,rA),K.direction.addInPlace(rA)}_processParticle(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;this.processFlowable(K,A,T)}static async FromUrlAsync(K){return await new Promise(((A,T)=>{const G=document.createElement("canvas"),B=G.getContext("2d");let L=null;const f=new Image;f.crossOrigin="anonymous",f.src=K,f.onerror=A=>{T(new Error(`Failed to load image: ${K} : ${A}`))},f.onload=()=>{G.width=f.width,G.height=f.height,B.drawImage(f,0,0),L=B.getImageData(0,0,G.width,G.height),A(new kA(G.width,G.height,L.data))}}))}static async ExtractFromTextureAsync(K){return await new Promise(((A,T)=>{if(!K.isReady())return void K.onLoadObservable.addOnce((async()=>{try{const T=await this.ExtractFromTextureAsync(K);A(T)}catch(G){T(G)}}));const G=K.getSize();eA.i.GetTextureDataAsync(K,G.width,G.height).then((K=>{A(new kA(G.width,G.height,new Uint8ClampedArray(K)))})).catch(T)}))}}var sA,jA,RA,vA,IA,oA,WA,iA,VA;!function(K){K[K.Int=1]="Int",K[K.Float=2]="Float",K[K.Vector2=4]="Vector2",K[K.PA=8]="PA",K[K.Matrix=16]="Matrix",K[K.Particle=32]="Particle",K[K.Texture=64]="Texture",K[K.oO=128]="oO",K[K.FloatGradient=256]="FloatGradient",K[K.Vector2Gradient=512]="Vector2Gradient",K[K.Vector3Gradient=1024]="Vector3Gradient",K[K.Color4Gradient=2048]="Color4Gradient",K[K.System=4096]="System",K[K.AutoDetect=8192]="AutoDetect",K[K.BasedOnInput=16384]="BasedOnInput",K[K.Undefined=32768]="Undefined",K[K.All=65535]="All"}(sA||(sA={})),function(K){K[K.Compatible=0]="Compatible",K[K.TypeIncompatible=1]="TypeIncompatible",K[K.HierarchyIssue=2]="HierarchyIssue"}(jA||(jA={})),function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(RA||(RA={}));class XA{get direction(){return this._direction}get type(){if(this._type===sA.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===sA.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(K){this._type=K}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((K=>K.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(K,A,T){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=sA.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new a.e,this.onDisconnectionObservable=new a.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=A,this.name=K,this._direction=T}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(K){var A;return this.isConnected?null!==(A=this._connectedPoint)&&void 0!==A&&A._storedFunction?this._connectedPoint._storedFunction(K):this._connectedPoint._storedValue:this.value}canConnectTo(K){return 0===this.checkCompatibilityState(K)}checkCompatibilityState(K){const A=this._ownerBlock,T=K.ownerBlock;if(this.type!==K.type&&K.innerType!==sA.AutoDetect)return K.acceptedConnectionPointTypes&&-1!==K.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(K.excludedConnectionPointTypes&&-1!==K.excludedConnectionPointTypes.indexOf(this.type))return 1;let G=T,B=A;return 0===this.direction&&(G=A,B=T),G.isAnAncestorOf(B)?2:0}connectTo(K){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(K))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${K.ownerBlock.name}".${K.name}`;return this._endpoints.push(K),K._connectedPoint=this,this.onConnectionObservable.notifyObservers(K),K.onConnectionObservable.notifyObservers(this),this}disconnectFrom(K){const A=this._endpoints.indexOf(K);return-1===A||(this._endpoints.splice(A,1),K._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(K),K.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(K){let A=1;for(;A<sA.All;)K&A||this.excludedConnectionPointTypes.push(A),A<<=1}serialize(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const A={};return A.name=this.name,A.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.kf?(A.valueType="BABYLON."+this.value.getClassName(),A.value=this.value.kf()):(A.valueType="number",A.value=this.value)),K&&this.connectedPoint&&(A.inputName=this.name,A.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,A.targetConnectionName=this.connectedPoint.name,A.isExposedOnFrame=!0,A.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(A.isExposedOnFrame=!0,A.exposedPortPosition=this.exposedPortPosition),A}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class qA{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(K){this._name=K}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(K){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new a.e,this.Ff=new a.e,this.onInputChangedObservable=new a.e,this.visibleOnFrame=!1,this._name=K,this.uniqueId=k.d.UniqueId}_inputRename(K){return K}_outputRename(K){return K}isAnAncestorOf(K){for(const A of this._outputs)if(A.hasEndpoints)for(const T of A.endpoints){if(T.ownerBlock===K)return!0;if(T.ownerBlock.isAnAncestorOf(K))return!0}return!1}isAnAncestorOfType(K){if(this.getClassName()===K)return!0;for(const A of this._outputs)if(A.hasEndpoints)for(const T of A.endpoints)if(T.ownerBlock.isAnAncestorOfType(K))return!0;return!1}getInputByName(K){const A=this._inputs.filter((A=>A.name===K));return A.length?A[0]:null}_linkConnectionTypes(K,A){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[A]._acceptedConnectionPointType=this._inputs[K]:(this._inputs[K]._linkedConnectionSource=this._inputs[A],this._inputs[K]._isMainLinkSource=!0),this._inputs[A]._linkedConnectionSource=this._inputs[K]}registerInput(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const f=new XA(K,this,0);return f.type=A,f.isOptional=T,f.defaultValue=G,f.value=G,f.valueMin=B,f.valueMax=L,this._inputs.push(f),this.onInputChangedObservable.notifyObservers(f),this}registerOutput(K,A,T){return(T=T??new XA(K,this,1)).type=A,this._outputs.push(T),this}_build(K){}_customBuildStep(K){}build(K){if(this._buildId===K.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((K=>K.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=K.buildId;for(const A of this._inputs){if(!A.connectedPoint){A.isOptional||K.notConnectedNonOptionalInputs.push(A);continue}const T=A.connectedPoint.ownerBlock;T&&T!==this&&!T.isSystem&&T.build(K)}return this._customBuildStep(K),K.verbose&&s.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(K),this.onBuildObservable.notifyObservers(this),!1}serialize(){const K={};K.customType="BABYLON."+this.getClassName(),K.id=this.uniqueId,K.name=this.name,K.visibleOnFrame=this.visibleOnFrame,K.inputs=[],K.outputs=[];for(const A of this.inputs)K.inputs.push(A.serialize());for(const A of this.outputs)K.outputs.push(A.serialize(!1));return K}_deserialize(K){this._name=K.name,this.comments=K.comments,this.visibleOnFrame=!!K.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(K)}_deserializePortDisplayNamesAndExposedOnFrame(K){const A=K.inputs,T=K.outputs;if(A)for(const G of A){const K=this.inputs.find((K=>K.name===G.name));if(!K)return;if(G.displayName&&(K.displayName=G.displayName),G.isExposedOnFrame&&(K.isExposedOnFrame=G.isExposedOnFrame,K.exposedPortPosition=G.exposedPortPosition),void 0!==G.value&&null!==G.value)if("number"===G.valueType)K.value=G.value;else{const A=(0,O.b)(G.valueType);A&&(K.value=A.mT(G.value))}}if(T)for(let G=0;G<T.length;G++){const K=T[G];K.displayName&&(this.outputs[G].displayName=K.displayName),K.isExposedOnFrame&&(this.outputs[G].isExposedOnFrame=K.isExposedOnFrame,this.outputs[G].exposedPortPosition=K.exposedPortPosition)}}clone(){const K=this.serialize(),A=(0,O.b)(K.customType);if(A){const T=new A;return T._deserialize(K),T}return null}dispose(){this.Ff.notifyObservers(this),this.Ff.clear();for(const K of this.inputs)K.dispose();for(const K of this.outputs)K.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function yA(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",G=arguments.length>3?arguments[3]:void 0;return(B,L)=>{let f=B._propStore;f||(f=[],B._propStore=f),f.push({propertyName:L,displayName:K,type:A,groupName:T,options:G??{},className:B.getClassName()})}}(0,e.c)([(0,p.B)("comment")],qA.prototype,"comments",void 0),function(K){K[K.Boolean=0]="Boolean",K[K.Float=1]="Float",K[K.Int=2]="Int",K[K.Vector2=3]="Vector2",K[K.List=4]="List",K[K.oO=5]="oO",K[K.SamplingMode=6]="SamplingMode",K[K.TextureFormat=7]="TextureFormat",K[K.TextureType=8]="TextureType"}(vA||(vA={})),function(K){K[K.None=0]="None",K[K.Position=1]="Position",K[K.Direction=2]="Direction",K[K.Age=3]="Age",K[K.Lifetime=4]="Lifetime",K[K.Color=5]="Color",K[K.ScaledDirection=6]="ScaledDirection",K[K.Scale=7]="Scale",K[K.AgeGradient=8]="AgeGradient",K[K.Angle=9]="Angle",K[K.SpriteCellIndex=16]="SpriteCellIndex",K[K.SpriteCellStart=17]="SpriteCellStart",K[K.SpriteCellEnd=18]="SpriteCellEnd"}(IA||(IA={})),function(K){K[K.None=0]="None",K[K.Time=1]="Time",K[K.Delta=2]="Delta",K[K.Emitter=3]="Emitter"}(oA||(oA={}));class wA{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let K="";for(const A of this.notConnectedNonOptionalInputs)K+=`input ${A.name} from block ${A.ownerBlock.name}[${A.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(K)throw"Build of Node Particle System Set failed:\n"+K}adapt(K,A){const T=K.getConnectedValue(this)||0;if(K.type===A)return T;switch(A){case sA.Vector2:return new G.Vector2(T,T);case sA.PA:return new G.PA(T,T,T);case sA.oO:return new f.oO(T,T,T,T)}return null}getContextualValue(K){if(!this.particleContext||!this.systemContext)return null;switch(K){case IA.Position:return this.particleContext.position;case IA.Direction:return this.particleContext.direction;case IA.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case IA.Color:return this.particleContext.color;case IA.Age:return this.particleContext.age;case IA.Lifetime:return this.particleContext.lifeTime;case IA.Angle:return this.particleContext.angle;case IA.Scale:return this.particleContext.scale;case IA.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case IA.SpriteCellEnd:return this.systemContext.endSpriteCellID;case IA.SpriteCellIndex:return this.particleContext.cellIndex;case IA.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.BA.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.BA.absolutePosition:this.systemContext.BA:null}getSystemValue(K){if(!this.particleContext||!this.systemContext)return null;switch(K){case oA.Time:return this.systemContext._actualFrame;case oA.Delta:return this.systemContext._scaledUpdateSpeed;case oA.Emitter:if(this.isEmitterTransformNode){return this.systemContext.BA.absolutePosition}return this.systemContext.BA}return null}}function aA(K,A,T){const G=new wA;G.dA=A;const B=K.createSystem(G);return B.canStart=()=>!0,B.BA=T.clone(),B.disposeOnStop=!0,B.start(),B}class MA extends qA{constructor(K){super(K),this.blendMode=C.BLENDMODE_ONEONE,this.aO=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",sA.Particle),this.registerInput("texture",sA.Texture),this.registerInput("onStart",sA.System,!0),this.registerInput("onEnd",sA.System,!0),this.registerOutput("system",sA.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(K){K.aO=this.aO,K.buildId=this._buildId++,this.build(K);const A=this.particle.getConnectedValue(K);return A.particleTexture=this.texture.getConnectedValue(K),A.emitRate=this.emitRate,A.blendMode=this.blendMode,A.name=this.name,A._nodeGenerated=!0,A._targetStopDuration=this.targetStopDuration,A.startDelay=this.startDelay,this.system._storedValue=this,A.canStart=()=>!this.doNoStart,A.onStartedObservable.add((T=>{const G=this.onStart.getConnectedValue(K);G&&T.onStartedObservable.addOnce((()=>{K.systemContext=A;const T=aA(G,K.dA,K.emitterPosition);this.Ff.addOnce((()=>{T.dispose()}))}));const B=this.onEnd.getConnectedValue(K);B&&T.onStoppedObservable.addOnce((()=>{K.systemContext=A;const T=aA(B,K.dA,K.emitterPosition);this.Ff.addOnce((()=>{T.dispose()}))}))})),this.Ff.addOnce((()=>{A.dispose()})),A}serialize(){const K=super.serialize();return K.aO=this.aO,K.emitRate=this.emitRate,K.blendMode=this.blendMode,K.doNoStart=this.doNoStart,K.targetStopDuration=this.targetStopDuration,K.startDelay=this.startDelay,K}_deserialize(K){super._deserialize(K),this.aO=K.aO,this.emitRate=K.emitRate,this.doNoStart=!!K.doNoStart,void 0!==K.blendMode&&(this.blendMode=K.blendMode),void 0!==K.targetStopDuration&&(this.targetStopDuration=K.targetStopDuration),void 0!==K.startDelay&&(this.startDelay=K.startDelay)}}(0,e.c)([yA("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:C.BLENDMODE_ONEONE},{label:"Standard",value:C.BLENDMODE_STANDARD},{label:"Add",value:C.BLENDMODE_ADD},{label:"Multiply",value:C.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:C.BLENDMODE_MULTIPLYADD}]})],MA.prototype,"blendMode",void 0),(0,e.c)([yA("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],MA.prototype,"aO",void 0),(0,e.c)([yA("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MA.prototype,"emitRate",void 0),(0,e.c)([yA("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MA.prototype,"targetStopDuration",void 0),(0,e.c)([yA("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MA.prototype,"startDelay",void 0),(0,e.c)([yA("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],MA.prototype,"doNoStart",void 0),(0,O.c)("BABYLON.SystemBlock",MA);class EA extends qA{get type(){if(this._type===sA.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=sA.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=sA.Vector2,this._type;case"PA":return this._type=sA.PA,this._type;case"oO":return this._type=sA.oO,this._type;case"Matrix":return this._type=sA.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===IA.None&&this._systemSource!==oA.None}get systemSource(){return this._systemSource}set systemSource(K){if(this._systemSource=K,K!==oA.None){switch(this._contextualSource=IA.None,this._type=sA.Float,K){case oA.Time:case oA.Delta:this._type=sA.Float;break;case oA.Emitter:this._type=sA.PA}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==IA.None}get contextualValue(){return this._contextualSource}set contextualValue(K){if(this._contextualSource=K,K!==IA.None){switch(this._systemSource=oA.None,K){case IA.Scale:this._type=sA.Vector2;break;case IA.Position:case IA.Direction:case IA.ScaledDirection:this._type=sA.PA;break;case IA.Color:this._type=sA.oO;break;case IA.Age:case IA.Lifetime:case IA.Angle:case IA.AgeGradient:this._type=sA.Float;break;case IA.SpriteCellEnd:case IA.SpriteCellStart:case IA.SpriteCellIndex:this._type=sA.Int}this.output&&(this.output.type=this._type)}}constructor(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sA.AutoDetect;super(K),this._type=sA.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new a.e,this._systemSource=oA.None,this._contextualSource=IA.None,this._type=A,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",A)}get value(){return this._storedValue}set value(K){this.type===sA.Float&&this.min!==this.max&&(K=Math.max(this.min,K),K=Math.min(this.max,K)),this._storedValue=K,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(K){this._valueCallback=K}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case sA.Int:case sA.Float:this.value=0;break;case sA.Vector2:this.value=G.Vector2.Zero();break;case sA.PA:this.value=G.PA.Zero();break;case sA.oO:this.value=new f.oO(1,1,1,1);break;case sA.Matrix:this.value=G.Matrix.Identity()}}_build(K){super._build(K),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=K=>K.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=K=>K.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const K=super.serialize();return K.type=this.type,K.contextualValue=this.contextualValue,K.systemSource=this.systemSource,K.min=this.min,K.max=this.max,K.groupInInspector=this.groupInInspector,K.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.kf?(K.valueType="BABYLON."+this._storedValue.getClassName(),K.value=this._storedValue.kf()):(K.valueType="number",K.value=this._storedValue)),K}_deserialize(K){if(super._deserialize(K),this._type=K.type,this.contextualValue=K.contextualValue,this.systemSource=K.systemSource||oA.None,this.min=K.min||0,this.max=K.max||0,this.groupInInspector=K.groupInInspector||"",void 0!==K.displayInInspector&&(this.displayInInspector=K.displayInInspector),K.valueType)if("number"===K.valueType)this._storedValue=K.value;else{const A=(0,O.b)(K.valueType);A&&(this._storedValue=A.mT(K.value))}}}(0,O.c)("BABYLON.ParticleInputBlock",EA);class tA extends qA{get url(){return this._url}set url(K){this._url!==K&&(this._cachedData=null,this._url=K,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(K){this._textureDataUrl!==K&&(this._cachedData=null,this._textureDataUrl=K,this._url="",this._sourceTexture=null)}set sourceTexture(K){this._sourceTexture!==K&&(this._cachedData=null,this._sourceTexture=K,this._url="",this._textureDataUrl="")}constructor(K){super(K),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",sA.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const K=this.texture._storedValue;return await new Promise(((A,T)=>{if(!K.isReady())return void K.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),A(this._cachedData)}catch(K){T(K)}}));const G=K.getSize();eA.i.GetTextureDataAsync(K,G.width,G.height).then((T=>{this._cachedData={width:G.width,height:G.height,data:new Uint8ClampedArray(T)},K.dispose(),A(this._cachedData)})).catch(T)}))}_build(K){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new h.c(this._textureDataUrl,K.dA):this.texture._storedValue=new h.c(this._url,K.dA):this.texture._storedValue=null}serialize(){const K=super.serialize();return K.url=this.url,K.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(K.textureDataUrl=this.textureDataUrl),K}_deserialize(K){super._deserialize(K),this.url=K.url,this.serializedCachedData=!!K.serializedCachedData,K.textureDataUrl&&(this.textureDataUrl=K.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,O.c)("BABYLON.ParticleTextureSourceBlock",tA);class KT extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("position",sA.PA),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(K){const A=this.particle.getConnectedValue(K);if(this.output._storedValue=A,!this.position.isConnected)return;const T={process:T=>{K.particleContext=T,K.systemContext=A,T.position.G(this.position.getConnectedValue(K))},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T}}(0,O.c)("BABYLON.UpdatePositionBlock",KT),function(K){K[K.Add=0]="Add",K[K.Subtract=1]="Subtract",K[K.Multiply=2]="Multiply",K[K.Divide=3]="Divide",K[K.Max=4]="Max",K[K.Min=5]="Min"}(WA||(WA={}));class AT extends qA{constructor(K){super(K),this.operation=WA.Add,this.registerInput("left",sA.AutoDetect),this.registerInput("right",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this.output._typeConnectionSource=this.left;const A=[sA.Matrix,sA.Particle,sA.Texture,sA.System,sA.FloatGradient,sA.Color4Gradient,sA.Vector2Gradient,sA.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...A),this.right.excludedConnectionPointTypes.push(...A),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(K){let A;const T=this.left,B=this.right;if(!T.isConnected||!B.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=T.type===sA.Float||T.type===sA.Int,O=B.type===sA.Float||B.type===sA.Int,C=L&&O;switch(this.operation){case WA.Add:A=C?K=>T.getConnectedValue(K)+B.getConnectedValue(K):L?K=>K.adapt(T,B.type).add(B.getConnectedValue(K)):K=>T.getConnectedValue(K).add(K.adapt(B,T.type));break;case WA.Subtract:A=C?K=>T.getConnectedValue(K)-B.getConnectedValue(K):L?K=>K.adapt(T,B.type).FA(B.getConnectedValue(K)):K=>T.getConnectedValue(K).FA(K.adapt(B,T.type));break;case WA.Multiply:A=C?K=>T.getConnectedValue(K)*B.getConnectedValue(K):L?K=>K.adapt(T,B.type).multiply(B.getConnectedValue(K)):K=>T.getConnectedValue(K).multiply(K.adapt(B,T.type));break;case WA.Divide:A=C?K=>T.getConnectedValue(K)/B.getConnectedValue(K):L?K=>K.adapt(T,B.type).divide(B.getConnectedValue(K)):K=>T.getConnectedValue(K).divide(K.adapt(B,T.type));break;case WA.Min:if(C)A=K=>Math.min(T.getConnectedValue(K),B.getConnectedValue(K));else{const[K,O]=L?[B,T]:[T,B];switch(K.type){case sA.Vector2:A=A=>G.Vector2.Minimize(K.getConnectedValue(A),A.adapt(O,K.type));break;case sA.PA:A=A=>G.PA.Minimize(K.getConnectedValue(A),A.adapt(O,K.type));break;case sA.oO:A=A=>{const T=K.getConnectedValue(A),{r:G,g:B,b:L,a:C}=A.adapt(O,K.type);return new f.oO(Math.min(T.r,G),Math.min(T.g,B),Math.min(T.b,L),Math.min(T.a,C))}}}break;case WA.Max:if(!C){const[K,O]=L?[B,T]:[T,B];switch(K.type){case sA.Vector2:A=A=>G.Vector2.Maximize(K.getConnectedValue(A),A.adapt(O,K.type));break;case sA.PA:A=A=>G.PA.Maximize(K.getConnectedValue(A),A.adapt(O,K.type));break;case sA.oO:A=A=>{const T=K.getConnectedValue(A),{r:G,g:B,b:L,a:C}=A.adapt(O,K.type);return new f.oO(Math.max(T.r,G),Math.min(T.g,B),Math.min(T.b,L),Math.min(T.a,C))}}break}A=K=>Math.max(T.getConnectedValue(K),B.getConnectedValue(K))}this.output._storedFunction=K=>T.type===sA.Int?0|A(K):A(K)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===sA.Int||this.left.type===sA.Float&&this.right.type!==sA.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[K,A]of[[this.left,this.right],[this.right,this.left]])K.acceptedConnectionPointTypes=[sA.Int,sA.Float],A.isConnected&&(K.acceptedConnectionPointTypes.push(A.type),A.type!==sA.Int&&A.type!==sA.Float||K.acceptedConnectionPointTypes.push(sA.Vector2,sA.PA,sA.oO))}dispose(){super.dispose();for(const K of this._connectionObservers)K.remove();this._connectionObservers.length=0}serialize(){const K=super.serialize();return K.operation=this.operation,K}_deserialize(K){super._deserialize(K),this.operation=K.operation}}(0,e.c)([yA("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:WA.Add},{label:"Subtract",value:WA.Subtract},{label:"Multiply",value:WA.Multiply},{label:"Divide",value:WA.Divide},{label:"Max",value:WA.Max},{label:"Min",value:WA.Min}]})],AT.prototype,"operation",void 0),(0,O.c)("BABYLON.ParticleMathBlock",AT);class TT extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("direction1",sA.PA,!0,new G.PA(0,1,0)),this.registerInput("direction2",sA.PA,!0,new G.PA(0,1,0)),this.registerInput("minEmitBox",sA.PA,!0,new G.PA(-.5,-.5,-.5)),this.registerInput("maxEmitBox",sA.PA,!0,new G.PA(.5,.5,.5)),this.registerOutput("output",sA.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(K){const A=this.particle.getConnectedValue(K);A._directionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.direction1.getConnectedValue(K),L=this.direction2.getConnectedValue(K),f=(0,Q.RandomRange)(B.x,L.x),O=(0,Q.RandomRange)(B.y,L.y),C=(0,Q.RandomRange)(B.z,L.z);K.isEmitterTransformNode?G.PA.TransformNormalFromFloatsToRef(f,O,C,K.emitterWorldMatrix,T.direction):T.direction.RO(f,O,C)},A._positionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.minEmitBox.getConnectedValue(K),L=this.maxEmitBox.getConnectedValue(K),f=(0,Q.RandomRange)(B.x,L.x),O=(0,Q.RandomRange)(B.y,L.y),C=(0,Q.RandomRange)(B.z,L.z);K.isEmitterTransformNode?G.PA.TransformCoordinatesFromFloatsToRef(f,O,C,K.emitterWorldMatrix,T.position):(T.position.RO(f,O,C),T.position.addInPlace(K.emitterPosition))},this.output._storedValue=A}}(0,O.c)("BABYLON.BoxShapeBlock",TT);class GT extends qA{constructor(K){super(K),this.registerInput("emitPower",sA.Float,!0,1),this.registerInput("lifeTime",sA.Float,!0,1),this.registerInput("color",sA.oO,!0,new f.oO(1,1,1,1)),this.registerInput("scale",sA.Vector2,!0,new G.Vector2(1,1)),this.registerInput("angle",sA.Float,!0,0),this.registerOutput("particle",sA.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(K){const A=new OA(this.name,K.aO,K.dA,null,!1,void 0,!0);A.particleEmitterType=new d,A._lifeTimeCreation.process=(A,T)=>{K.particleContext=A,A.lifeTime=this.lifeTime.getConnectedValue(K),T._emitPower=this.emitPower.getConnectedValue(K)},A._colorCreation.process=A=>{K.particleContext=A,A.color.G(this.color.getConnectedValue(K))},A._sizeCreation.process=A=>{K.particleContext=A,A.size=1,A.scale.G(this.scale.getConnectedValue(K))},A._angleCreation.process=A=>{K.particleContext=A,A.angle=this.angle.getConnectedValue(K)},this.particle._storedValue=A}}(0,O.c)("BABYLON.CreateParticleBlock",GT);class BT{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const K=[];for(const A of this.attachedBlocks)A.isInput&&K.push(A);return K}constructor(K){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new a.e,this.name=K}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(K){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(K)&&this.attachedBlocks.push(K);for(const T of K.inputs){const G=T.connectedPoint;if(G){const T=G.ownerBlock;T!==K&&this._initializeBlock(T,A)}}}async buildAsync(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((T=>{const G=new gA;for(const K of this._systemBlocks)this._initializeBlock(K);for(const B of this.systemBlocks){const T=new wA;T.buildId=this._buildId++,T.dA=K,T.verbose=A;const L=B.createSystem(T);T.emitErrors(),G.systems.push(L)}this.onBuildObservable.notifyObservers(this),T(G)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const K=new MA("Particle system"),A=new KT("Update position");A.output.connectTo(K.particle);const T=new EA("Position");T.contextualValue=IA.Position;const G=new EA("Scaled direction");G.contextualValue=IA.ScaledDirection;const B=new AT("Add");B.operation=WA.Add,T.output.connectTo(B.left),G.output.connectTo(B.right),B.output.connectTo(A.position);const L=new GT("Create particle"),f=new TT("Box shape");L.particle.connectTo(f.particle),f.output.connectTo(A.particle);const O=new tA("Texture");O.texture.connectTo(K.texture),O.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(K)}removeBlock(K){const A=this.attachedBlocks.indexOf(K);if(A>-1&&this.attachedBlocks.splice(A,1),K.isSystem){const A=this._systemBlocks.indexOf(K);A>-1&&this._systemBlocks.splice(A,1)}}parseSerializedObject(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A||this.clear();const T={};for(const G of K.hY){const K=(0,O.b)(G.customType);if(K){const A=new K;A._deserialize(G),T[G.id]=A,this.attachedBlocks.push(A),A.isSystem&&this._systemBlocks.push(A)}}for(const G of this.attachedBlocks)if(G.isTeleportOut){const K=G,A=K._tempEntryPointUniqueId;if(A){const G=T[A];G&&G.attachToEndpoint(K)}}for(let G=0;G<K.hY.length;G++){const B=K.hY[G],L=T[B.id];L&&(L.inputs.length&&B.inputs.some((K=>K.targetConnectionName))&&!A||this._restoreConnections(L,K,T))}if(K.locations||K.editorData&&K.editorData.locations){const G=K.locations||K.editorData.locations;for(const K of G)T[K.WG]&&(K.WG=T[K.WG].uniqueId);A&&this.editorData&&this.editorData.locations&&G.concat(this.editorData.locations),K.locations?this.editorData={locations:G}:(this.editorData=K.editorData,this.editorData.locations=G);const B=[];for(const K in T)B[K]=T[K].uniqueId;this.editorData.map=B}this.comment=K.comment}_restoreConnections(K,A,T){for(const G of K.outputs)for(const B of A.hY){const L=T[B.id];if(L)for(const f of B.inputs)if(T[f.targetBlockId]!==K||f.targetConnectionName!==G.name);else{const K=L.getInputByName(f.inputName);if(!K||K.isConnected)continue;G.connectTo(K,!0),this._restoreConnections(L,A,T)}}}serialize(K){const A=K?{}:r.c.Serialize(this);A.editorData=JSON.parse(JSON.stringify(this.editorData));let T=[];K?T=K:A.customType="BABYLON.NodeParticleSystemSet",A.hY=[];for(const G of T)A.hY.push(G.serialize());if(!K)for(const G of this.attachedBlocks)-1===T.indexOf(G)&&A.hY.push(G.serialize());return A}dispose(){for(const K of this.attachedBlocks)K.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(K){const A=new BT(K);return A.setToDefault(),A}static Parse(K){const A=r.c.Parse((()=>new BT(K.name)),K,null);return A.parseSerializedObject(K),A}static ParseFromSnippetAsync(K,A){return"_BLANK"===K?Promise.resolve(BT.CreateDefault("blank")):new Promise(((T,G)=>{const B=new SA.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const f=JSON.parse(JSON.parse(B.responseText).jsonPayload),O=JSON.parse(f.nodeParticle);A||(A=r.c.Parse((()=>new BT(K)),O,null)),A.parseSerializedObject(O),A.snippetId=K;try{T(A)}catch(L){G(L)}}else G("Unable to load the snippet "+K)})),B.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),B.send()}))}}BT.EditorURL=`${mT.Tools._DefaultCdnUrl}/v${yK.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,BT.SnippetUrl="https://snippet.babylonjs.com",(0,e.c)([(0,p.B)()],BT.prototype,"name",void 0),(0,e.c)([(0,p.B)("comment")],BT.prototype,"comment",void 0),function(K){K[K.None=0]="None",K[K.PerParticle=1]="PerParticle",K[K.PerSystem=2]="PerSystem"}(iA||(iA={}));class LT extends qA{constructor(K){super(K),this._currentLockId=-2,this.lockMode=iA.PerParticle,this.registerInput("min",sA.AutoDetect,!0,0),this.registerInput("max",sA.AutoDetect,!0,1),this.registerOutput("output",sA.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(sA.Float|sA.Int|sA.Vector2|sA.PA|sA.oO),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(sA.Float|sA.Int|sA.Vector2|sA.PA|sA.oO),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=sA.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let K=null;switch(this._currentLockId=-2,this.min.type){case sA.AutoDetect:case sA.Int:case sA.Float:K=K=>{const A=this.min.getConnectedValue(K)||0,T=this.max.getConnectedValue(K)||1;return A+Math.random()*(T-A)};break;case sA.Vector2:K=K=>{const A=this.min.getConnectedValue(K)||G.Vector2.Zero(),T=this.max.getConnectedValue(K)||G.Vector2.One();return new G.Vector2(A.x+Math.random()*(T.x-A.x),A.y+Math.random()*(T.y-A.y))};break;case sA.PA:K=K=>{const A=this.min.getConnectedValue(K)||G.PA.Zero(),T=this.max.getConnectedValue(K)||G.PA.One();return new G.PA(A.x+Math.random()*(T.x-A.x),A.y+Math.random()*(T.y-A.y),A.z+Math.random()*(T.z-A.z))};break;case sA.oO:K=K=>{const A=this.min.getConnectedValue(K)||new f.oO(0,0,0,0),T=this.max.getConnectedValue(K)||new f.oO(1,1,1,1);return new f.oO(A.x+Math.random()*(T.x-A.x),A.y+Math.random()*(T.y-A.y),A.z+Math.random()*(T.z-A.z),A.w+Math.random()*(T.w-A.w))}}this.output._storedFunction=A=>{var T;let G=0;switch(this.lockMode){case iA.PerParticle:G=(null===(T=A.particleContext)||void 0===T?void 0:T.id)||-1;break;case iA.PerSystem:G=A.buildId||0}return this._currentLockId!==G&&(this.lockMode!==iA.None&&(this._currentLockId=G),this.output._storedValue=K(A)),this.output._storedValue}}serialize(){const K=super.serialize();return K.lockMode=this.lockMode,K}_deserialize(K){super._deserialize(K),this.lockMode=K.lockMode}}(0,e.c)([yA("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:iA.None},{label:"Per particle",value:iA.PerParticle},{label:"Per system",value:iA.PerSystem}]})],LT.prototype,"lockMode",void 0),(0,O.c)("BABYLON.ParticleRandomBlock",LT);class fT extends qA{constructor(K){super(K),this._currentLockId=-2,this.lockMode=iA.PerParticle,this.registerInput("min",sA.AutoDetect),this.registerInput("max",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const A=[sA.Matrix,sA.Particle,sA.Texture,sA.System,sA.FloatGradient,sA.Color4Gradient,sA.Vector2Gradient,sA.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...A),this.max.excludedConnectionPointTypes.push(...A)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let K=null;switch(this._currentLockId=-2,this.min.type){case sA.Float:case sA.Int:K=K=>{const A=this.min.getConnectedValue(K),T=this.max.getConnectedValue(K);return Math.random()*(T-A)+A};break;case sA.Vector2:K=K=>{const A=this.min.getConnectedValue(K),T=this.max.getConnectedValue(K);return new G.Vector2(Math.random()*(T.x-A.x)+A.x,Math.random()*(T.y-A.y)+A.y)};break;case sA.PA:K=K=>{const A=this.min.getConnectedValue(K),T=this.max.getConnectedValue(K);return new G.PA(Math.random()*(T.x-A.x)+A.x,Math.random()*(T.y-A.y)+A.y,Math.random()*(T.z-A.z)+A.z)};break;case sA.oO:K=K=>{const A=this.min.getConnectedValue(K),T=this.max.getConnectedValue(K);return new f.oO(Math.random()*(T.r-A.r)+A.r,Math.random()*(T.g-A.g)+A.g,Math.random()*(T.b-A.b)+A.b,Math.random()*(T.a-A.a)+A.a)}}this.output._storedFunction=A=>{var T;let G=0;switch(this.lockMode){case iA.PerParticle:G=(null===(T=A.particleContext)||void 0===T?void 0:T.id)||-1;break;case iA.PerSystem:G=A.buildId||0}return this._currentLockId!==G&&(this.lockMode!==iA.None&&(this._currentLockId=G),this.output._storedValue=K(A)),this.output._storedValue}}serialize(){const K=super.serialize();return K.lockMode=this.lockMode,K}_deserialize(K){super._deserialize(K),void 0!==K.lockMode&&(this.lockMode=K.lockMode)}}(0,e.c)([yA("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:iA.None},{label:"Per particle",value:iA.PerParticle},{label:"Per system",value:iA.PerSystem}]})],fT.prototype,"lockMode",void 0),(0,O.c)("BABYLON.RandomRangeBlock",fT);(0,O.c)("BABYLON.ParticleLerpBlock",class extends qA{constructor(K){super(K),this.registerInput("left",sA.AutoDetect),this.registerInput("right",sA.AutoDetect),this.registerInput("gradient",sA.Float,!0,0,0,1),this.registerOutput("output",sA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(sA.Float|sA.Int|sA.Vector2|sA.PA|sA.oO)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const K=(K,A,T)=>(1-K)*A+K*T;this.output._storedFunction=A=>{const T=this.left.getConnectedValue(A),B=this.right.getConnectedValue(A),L=this.gradient.getConnectedValue(A);switch(this.left.type){case sA.Int:case sA.Float:return K(L,T,B);case sA.Vector2:return new G.Vector2(K(L,T.x,B.x),K(L,T.y,B.y));case sA.PA:return new G.PA(K(L,T.x,B.x),K(L,T.y,B.y),K(L,T.z,B.z));case sA.oO:return new f.oO(K(L,T.r,B.r),K(L,T.g,B.g),K(L,T.b,B.b),K(L,T.a,B.a))}return 0}}});(0,O.c)("BABYLON.UpdateDirectionBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("direction",sA.PA),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(K){const A=this.particle.getConnectedValue(K);if(this.output._storedValue=A,!this.direction.isConnected)return;const T={process:T=>{K.particleContext=T,K.systemContext=A,T.direction.G(this.direction.getConnectedValue(K))},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T}});(0,O.c)("BABYLON.UpdateColorBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("color",sA.oO),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(K){const A=this.particle.getConnectedValue(K);if(this.output._storedValue=A,!this.color.isConnected)return;const T={process:T=>{K.particleContext=T,K.systemContext=A,T.color.G(this.color.getConnectedValue(K))},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T}});(0,O.c)("BABYLON.UpdateScaleBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("scale",sA.Vector2),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(K){const A=this.particle.getConnectedValue(K);if(this.output._storedValue=A,!this.scale.isConnected)return;const T={process:T=>{K.particleContext=T,K.systemContext=A,T.scale.G(this.scale.getConnectedValue(K))},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T}});(0,O.c)("BABYLON.UpdateAngleBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("angle",sA.Float),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(K){const A=this.particle.getConnectedValue(K);if(this.output._storedValue=A,!this.angle.isConnected)return;const T={process:T=>{K.particleContext=T,K.systemContext=A,T.angle=this.angle.getConnectedValue(K)},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T}});(0,O.c)("BABYLON.BasicPositionUpdateBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(K){const A=this.particle.getConnectedValue(K),T={process:T=>{K.particleContext=T,K.systemContext=A,T.direction.scaleToRef(A._directionScale,A._scaledDirection),T.position.addInPlace(A._scaledDirection)},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T,this.output._storedValue=A}});(0,O.c)("BABYLON.BasicSpriteUpdateBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(K){const A=this.particle.getConnectedValue(K),T={process:T=>{K.particleContext=T,K.systemContext=A,T.updateCellIndex()},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T,this.output._storedValue=A}});(0,O.c)("BABYLON.UpdateSpriteCellIndexBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("cellIndex",sA.Int),this.registerOutput("output",sA.Particle),this.cellIndex.acceptedConnectionPointTypes=[sA.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(K){const A=this.particle.getConnectedValue(K);if(this.output._storedValue=A,!this.cellIndex.isConnected)return;const T={process:T=>{K.particleContext=T,K.systemContext=A,T.cellIndex=Math.floor(this.cellIndex.getConnectedValue(K))},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T}});class OT extends qA{constructor(K){super(K),this.strength=1,this.registerInput("particle",sA.Particle),this.registerInput("flowMap",sA.Texture),this.registerOutput("output",sA.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(K){var A;const T=this.particle.getConnectedValue(K),G=K.dA;let B;(null===(A=this.flowMap.connectedPoint)||void 0===A?void 0:A.ownerBlock).extractTextureContentAsync().then((K=>{K&&(B=new kA(K.width,K.height,K.data))}));const L={process:K=>{const A=G.getTransformMatrix();B&&B._processParticle(K,this.strength*T._tempScaledUpdateSpeed,A)},previousItem:null,nextItem:null};T._updateQueueStart?oK(L,T._updateQueueStart):T._updateQueueStart=L,this.output._storedValue=T}serialize(){const K=super.serialize();return K.strength=this.strength,K}_deserialize(K){super._deserialize(K),this.strength=K.strength}}(0,e.c)([yA("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OT.prototype,"strength",void 0),(0,O.c)("BABYLON.UpdateFlowMapBlock",OT);(0,O.c)("BABYLON.SphereShapeBlock",class extends qA{constructor(K){super(K),this.registerInput("input",sA.Particle),this.registerInput("radius",sA.Float,!0,1),this.registerInput("radiusRange",sA.Float,!0,1,0,1),this.registerInput("directionRandomizer",sA.Float,!0,0,0,1),this.registerOutput("output",sA.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(K){const A=this.input.getConnectedValue(K);A._directionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.directionRandomizer.getConnectedValue(K),L=T.position.FA(K.emitterPosition).normalize(),f=(0,Q.RandomRange)(0,B),O=(0,Q.RandomRange)(0,B),C=(0,Q.RandomRange)(0,B);L.x+=f,L.y+=O,L.z+=C,L.normalize(),K.isEmitterTransformNode?G.PA.TransformNormalFromFloatsToRef(f,O,C,K.emitterWorldMatrix,T.direction):T.direction.RO(f,O,C)},A._positionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.radius.getConnectedValue(K),L=this.radiusRange.getConnectedValue(K),f=B-(0,Q.RandomRange)(0,B*L),O=(0,Q.RandomRange)(0,1),C=(0,Q.RandomRange)(0,2*Math.PI),Y=Math.acos(2*O-1),Z=f*Math.cos(C)*Math.sin(Y),x=f*Math.cos(Y),J=f*Math.sin(C)*Math.sin(Y);K.isEmitterTransformNode?G.PA.TransformCoordinatesFromFloatsToRef(Z,x,J,K.emitterWorldMatrix,T.position):(T.position.RO(Z,x,J),T.position.addInPlace(K.emitterPosition))},this.output._storedValue=A}});(0,O.c)("BABYLON.PointShapeBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("direction1",sA.PA,!0,new G.PA(0,1,0)),this.registerInput("direction2",sA.PA,!0,new G.PA(0,1,0)),this.registerOutput("output",sA.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){const A=this.particle.getConnectedValue(K);A._directionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.direction1.getConnectedValue(K),L=this.direction2.getConnectedValue(K),f=(0,Q.RandomRange)(B.x,L.x),O=(0,Q.RandomRange)(B.y,L.y),C=(0,Q.RandomRange)(B.z,L.z);K.isEmitterTransformNode?G.PA.TransformNormalFromFloatsToRef(f,O,C,K.emitterWorldMatrix,T.direction):T.direction.RO(f,O,C)},A._positionCreation.process=T=>{K.systemContext=A,K.isEmitterTransformNode?G.PA.TransformCoordinatesFromFloatsToRef(0,0,0,K.emitterWorldMatrix,T.position):T.position.G(K.emitterPosition)},this.output._storedValue=A}});(0,O.c)("BABYLON.CustomShapeBlock",class extends qA{constructor(K){super(K),this.registerInput("particle",sA.Particle),this.registerInput("position",sA.PA,!0,new G.PA(0,0,0)),this.registerInput("direction",sA.PA,!0,new G.PA(0,1,0)),this.registerOutput("output",sA.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){const A=this.particle.getConnectedValue(K);A._directionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.direction.getConnectedValue(K);K.isEmitterTransformNode?G.PA.TransformNormalToRef(B,K.emitterWorldMatrix,T.direction):T.direction.G(B)},A._positionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.position.getConnectedValue(K);K.isEmitterTransformNode?G.PA.TransformCoordinatesToRef(B,K.emitterWorldMatrix,T.position):(T.position.G(B),T.position.addInPlace(K.emitterPosition))},this.output._storedValue=A}});(0,O.c)("BABYLON.CylinderShapeBlock",class extends qA{constructor(K){super(K),this._tempVector=G.PA.Zero(),this.registerInput("particle",sA.Particle),this.registerInput("radius",sA.Float,!0,1),this.registerInput("height",sA.Float,!0,1,0),this.registerInput("radiusRange",sA.Float,!0,1,0,1),this.registerInput("directionRandomizer",sA.Float,!0,0,0,1),this.registerOutput("output",sA.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(K){const A=this.particle.getConnectedValue(K);A._directionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.directionRandomizer.getConnectedValue(K);T.position.subtractToRef(K.emitterPosition,this._tempVector),this._tempVector.normalize(),K.isEmitterTransformNode&&G.PA.TransformNormalToRef(this._tempVector,K.emitterInverseWorldMatrix,this._tempVector);const L=(0,Q.RandomRange)(-B/2,B/2);let f=Math.atan2(this._tempVector.x,this._tempVector.z);f+=(0,Q.RandomRange)(-Math.PI/2,Math.PI/2)*B,this._tempVector.y=L,this._tempVector.x=Math.sin(f),this._tempVector.z=Math.cos(f),this._tempVector.normalize(),K.isEmitterTransformNode?G.PA.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K.emitterWorldMatrix,T.direction):T.direction.G(this._tempVector)},A._positionCreation.process=T=>{K.particleContext=T,K.systemContext=A;const B=this.height.getConnectedValue(K),L=this.radiusRange.getConnectedValue(K),f=this.radius.getConnectedValue(K),O=(0,Q.RandomRange)(-B/2,B/2),C=(0,Q.RandomRange)(0,2*Math.PI),Y=(0,Q.RandomRange)((1-L)*(1-L),1),Z=Math.sqrt(Y)*f,x=Z*Math.cos(C),J=Z*Math.sin(C);K.isEmitterTransformNode?G.PA.TransformCoordinatesFromFloatsToRef(x,O,J,K.emitterWorldMatrix,T.position):(T.position.RO(x,O,J),T.position.addInPlace(K.emitterPosition))},this.output._storedValue=A}});class CT extends qA{constructor(K){super(K),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",sA.Particle),this.registerOutput("output",sA.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);const A=this.particle.getConnectedValue(K);A._isAnimationSheetEnabled=!0,A.spriteCellWidth=this.width,A.spriteCellHeight=this.height,A.startSpriteCellID=this.start,A.endSpriteCellID=this.end,A.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=A}serialize(){const K=super.serialize();return K.width=this.width,K.height=this.height,K.start=this.start,K.end=this.end,K.randomStartCell=this.randomStartCell,K}_deserialize(K){super._deserialize(K),this.width=K.width,this.height=K.height,this.start=K.start,this.end=K.end,this.randomStartCell=K.randomStartCell}}(0,e.c)([yA("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CT.prototype,"start",void 0),(0,e.c)([yA("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CT.prototype,"end",void 0),(0,e.c)([yA("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CT.prototype,"width",void 0),(0,e.c)([yA("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CT.prototype,"height",void 0),(0,e.c)([yA("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CT.prototype,"loop",void 0),(0,e.c)([yA("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CT.prototype,"randomStartCell",void 0),(0,O.c)("BABYLON.SetupSpriteSheetBlock",CT);class QT extends qA{constructor(K){super(K),this.reference=0,this.registerInput("value",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=K=>{switch(K){case sA.Float:return sA.FloatGradient;case sA.Vector2:return sA.Vector2Gradient;case sA.PA:return sA.Vector3Gradient;case sA.oO:return sA.Color4Gradient}return K},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(sA.Float|sA.Vector2|sA.PA|sA.oO)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=K=>null}serialize(){const K=super.serialize();return K.reference=this.reference,K}_deserialize(K){super._deserialize(K),this.reference=K.reference}}(0,e.c)([yA("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],QT.prototype,"reference",void 0),(0,O.c)("BABYLON.ParticleGradientValueBlock",QT);(0,O.c)("BABYLON.ParticleGradientBlock",class extends qA{constructor(K){super(K),this._entryCount=1,this.registerInput("gradient",sA.Float,!0,1,0,1),this.registerInput("value0",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=K=>{switch(K){case sA.FloatGradient:return sA.Float;case sA.Vector2Gradient:return sA.Vector2;case sA.Vector3Gradient:return sA.PA;case sA.Color4Gradient:return sA.oO}return K},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(sA.FloatGradient|sA.Vector2Gradient|sA.Vector3Gradient|sA.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(K){this._inputs[K].onConnectionObservable.add((()=>{this._entryCount>K||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),sA.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const K=[];for(let T=1;T<this._inputs.length;T++){var A;if(this._inputs[T].isConnected)K.push(null===(A=this._inputs[T].connectedPoint)||void 0===A?void 0:A.ownerBlock)}K.sort(((K,A)=>K.reference-A.reference)),this.output._storedFunction=A=>{const T=this.gradient.getConnectedValue(A);if(1===K.length)return K[0].value.getConnectedValue(A);let B=null;for(let L=K.length-1;L>=0;L--){const O=K[L];if(O.reference<=T){const K=O.value.getConnectedValue(A);if(B){const L=B.value.getConnectedValue(A),C=B.reference,Y=O.reference,Z=Math.max(0,Math.min(1,(T-Y)/(C-Y)));switch(this.output.type){case sA.Float:return(0,Q.Lerp)(K,L,Z);case sA.Vector2:return G.Vector2.Lerp(K,L,Z);case sA.PA:return G.PA.Lerp(K,L,Z);case sA.oO:return f.oO.Lerp(K,L,Z)}}return K}B=O}return 0}}});(0,O.c)("BABYLON.ParticleConverterBlock",class extends qA{constructor(K){super(K),this.registerInput("color ",sA.oO,!0),this.registerInput("xyz ",sA.PA,!0),this.registerInput("xy ",sA.Vector2,!0),this.registerInput("zw ",sA.Vector2,!0),this.registerInput("x ",sA.Float,!0),this.registerInput("y ",sA.Float,!0),this.registerInput("z ",sA.Float,!0),this.registerInput("w ",sA.Float,!0),this.registerOutput("color",sA.oO),this.registerOutput("xyz",sA.PA),this.registerOutput("xy",sA.Vector2),this.registerOutput("zw",sA.Vector2),this.registerOutput("x",sA.Float),this.registerOutput("y",sA.Float),this.registerOutput("z",sA.Float),this.registerOutput("w",sA.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(K){return"color "===K?"colorIn":"xyz "===K?"xyzIn":"xy "===K?"xyIn":"zw "===K?"zwIn":"x "===K?"xIn":"y "===K?"yIn":"z "===K?"zIn":"w "===K?"wIn":K}_outputRename(K){switch(K){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return K}}_build(K){super._build(K);const A=this.xIn,T=this.yIn,B=this.zIn,L=this.wIn,O=this.xyIn,C=this.zwIn,Q=this.xyzIn,Y=this.colorIn,Z=this.colorOut,x=this.xyzOut,J=this.xyOut,b=this.zwOut,P=this.xOut,F=this.yOut,d=this.zOut,N=this.wOut,D=K=>{if(Y.isConnected)return Y.getConnectedValue(K);let G=0,Z=0,x=0,J=0;if(A.isConnected&&(G=A.getConnectedValue(K)),T.isConnected&&(Z=T.getConnectedValue(K)),B.isConnected&&(x=B.getConnectedValue(K)),L.isConnected&&(J=L.getConnectedValue(K)),O.isConnected){const A=O.getConnectedValue(K);A&&(G=A.x,Z=A.y)}if(C.isConnected){const A=C.getConnectedValue(K);A&&(x=A.x,J=A.y)}if(Q.isConnected){const A=Q.getConnectedValue(K);A&&(G=A.x,Z=A.y,x=A.z)}return new f.oO(G,Z,x,J)};Z._storedFunction=K=>D(K),x._storedFunction=K=>{const A=D(K);return new G.PA(A.r,A.g,A.b)},J._storedFunction=K=>{const A=D(K);return new G.Vector2(A.r,A.g)},b._storedFunction=K=>{const A=D(K);return new G.Vector2(A.b,A.a)},P._storedFunction=K=>D(K).r,F._storedFunction=K=>D(K).g,d._storedFunction=K=>D(K).b,N._storedFunction=K=>D(K).a}}),function(K){K[K.Cos=0]="Cos",K[K.Sin=1]="Sin",K[K.Abs=2]="Abs",K[K.Exp=3]="Exp",K[K.Exp2=4]="Exp2",K[K.Round=5]="Round",K[K.Floor=6]="Floor",K[K.Ceiling=7]="Ceiling",K[K.Sqrt=8]="Sqrt",K[K.Log=9]="Log",K[K.Tan=10]="Tan",K[K.ArcTan=11]="ArcTan",K[K.ArcCos=12]="ArcCos",K[K.ArcSin=13]="ArcSin",K[K.Sign=14]="Sign",K[K.Negate=15]="Negate",K[K.OneMinus=16]="OneMinus",K[K.Reciprocal=17]="Reciprocal",K[K.ToDegrees=18]="ToDegrees",K[K.ToRadians=19]="ToRadians",K[K.Fract=20]="Fract"}(VA||(VA={}));class YT extends qA{constructor(K){super(K),this.operation=VA.Cos,this.registerInput("input",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(sA.Float|sA.Int|sA.Vector2|sA.PA|sA.oO)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);let A=null;switch(this.operation){case VA.Cos:A=K=>Math.cos(K);break;case VA.Sin:A=K=>Math.sin(K);break;case VA.Abs:A=K=>Math.abs(K);break;case VA.Exp:A=K=>Math.exp(K);break;case VA.Exp2:A=K=>Math.pow(2,K);break;case VA.Round:A=K=>Math.round(K);break;case VA.Floor:A=K=>Math.floor(K);break;case VA.Ceiling:A=K=>Math.ceil(K);break;case VA.Sqrt:A=K=>Math.sqrt(K);break;case VA.Log:A=K=>Math.log(K);break;case VA.Tan:A=K=>Math.tan(K);break;case VA.ArcTan:A=K=>Math.atan(K);break;case VA.ArcCos:A=K=>Math.acos(K);break;case VA.ArcSin:A=K=>Math.asin(K);break;case VA.Sign:A=K=>Math.sign(K);break;case VA.Negate:A=K=>-K;break;case VA.OneMinus:A=K=>1-K;break;case VA.Reciprocal:A=K=>1/K;break;case VA.ToRadians:A=K=>K*Math.PI/180;break;case VA.ToDegrees:A=K=>180*K/Math.PI;break;case VA.Fract:A=K=>K>=0?K-Math.floor(K):K-Math.ceil(K)}if(!A)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case sA.Int:case sA.Float:this.output._storedFunction=K=>{const T=this.input.getConnectedValue(K);return A(T)};break;case sA.Vector2:this.output._storedFunction=K=>{const T=this.input.getConnectedValue(K);return new G.Vector2(A(T.x),A(T.y))};break;case sA.PA:this.output._storedFunction=K=>{const T=this.input.getConnectedValue(K);return new G.PA(A(T.x),A(T.y),A(T.z))};break;case sA.oO:this.output._storedFunction=K=>{const T=this.input.getConnectedValue(K);return new f.oO(A(T.r),A(T.g),A(T.b),A(T.a))}}return this}serialize(){const K=super.serialize();return K.operation=this.operation,K}_deserialize(K){super._deserialize(K),this.operation=K.operation}}(0,e.c)([yA("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:VA.Cos},{label:"Sin",value:VA.Sin},{label:"Abs",value:VA.Abs},{label:"Exp",value:VA.Exp},{label:"Exp2",value:VA.Exp2},{label:"Round",value:VA.Round},{label:"Floor",value:VA.Floor},{label:"Ceiling",value:VA.Ceiling},{label:"Sqrt",value:VA.Sqrt},{label:"Log",value:VA.Log},{label:"Tan",value:VA.Tan},{label:"ArcTan",value:VA.ArcTan},{label:"ArcCos",value:VA.ArcCos},{label:"ArcSin",value:VA.ArcSin},{label:"Sign",value:VA.Sign},{label:"Negate",value:VA.Negate},{label:"OneMinus",value:VA.OneMinus},{label:"Reciprocal",value:VA.Reciprocal},{label:"ToDegrees",value:VA.ToDegrees},{label:"ToRadians",value:VA.ToRadians},{label:"Fract",value:VA.Fract}]})],YT.prototype,"operation",void 0),(0,O.c)("BABYLON.ParticleTrigonometryBlock",YT);var ZT,xT=T(13942);class JT extends qA{constructor(K){super(K),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(sA.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(sA.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(sA.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(sA.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(sA.System),this._inputs[0].excludedConnectionPointTypes.push(sA.Particle),this._inputs[0].excludedConnectionPointTypes.push(sA.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const A=K=>{const A=this.input.getConnectedValue(K);if(this.log.length>=this.stackSize)return A;if(null===A||void 0===A)return this.log.push(["null",""]),A;switch(this.input.type){case sA.Vector2:this.log.push([(0,xT.j)(A,4),A.toString()]);break;case sA.PA:this.log.push([(0,xT.k)(A,4),A.toString()]);break;case sA.oO:this.log.push([`{R: ${A.r.toFixed(4)} G: ${A.g.toFixed(4)} B: ${A.b.toFixed(4)} A: ${A.a.toFixed(4)}}`,A.toString()]);break;default:this.log.push([A.toString(),A.toString()])}return A};this.output.isConnected?this.output._storedFunction=A:this.output._storedValue=A(K)}serialize(){const K=super.serialize();return K.stackSize=this.stackSize,K}_deserialize(K){super._deserialize(K),this.stackSize=K.stackSize}}(0,e.c)([yA("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],JT.prototype,"stackSize",void 0),(0,O.c)("BABYLON.ParticleDebugBlock",JT);(0,O.c)("BABYLON.ParticleElbowBlock",class extends qA{constructor(K){super(K),this.registerInput("input",sA.AutoDetect),this.registerOutput("output",sA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);const A=this._outputs[0],T=this._inputs[0];A._storedFunction=K=>T.getConnectedValue(K)}});(0,O.c)("BABYLON.ParticleTeleportInBlock",class extends qA{get endpoints(){return this._endpoints}constructor(K){super(K),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",sA.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(K){if(this.getClassName()===K)return!0;for(const A of this.endpoints)if(A.isAnAncestorOfType(K))return!0;return!1}isAnAncestorOf(K){for(const A of this.endpoints){if(A===K)return!0;if(A.isAnAncestorOf(K))return!0}return!1}attachToEndpoint(K){K.detach(),this._endpoints.push(K),K._entryPoint=this,K._outputs[0]._typeConnectionSource=this._inputs[0],K._tempEntryPointUniqueId=null,K.name="> "+this.name}detachFromEndpoint(K){const A=this._endpoints.indexOf(K);-1!==A&&(this._endpoints.splice(A,1),K._outputs[0]._typeConnectionSource=null,K._entryPoint=null)}_build(){for(const K of this._endpoints)K.output._storedFunction=K=>this.input.getConnectedValue(K)}});(0,O.c)("BABYLON.ParticleTeleportOutBlock",class extends qA{constructor(K){super(K),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",sA.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(K){this.entryPoint&&this.entryPoint.build(K)}clone(){const K=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(K),K}serialize(){var K;const A=super.serialize();return A.entryPoint=(null===(K=this.entryPoint)||void 0===K?void 0:K.uniqueId)??"",A}_deserialize(K){super._deserialize(K),this._tempEntryPointUniqueId=K.entryPoint}}),function(K){K[K.Equal=0]="Equal",K[K.NotEqual=1]="NotEqual",K[K.LessThan=2]="LessThan",K[K.GreaterThan=3]="GreaterThan",K[K.LessOrEqual=4]="LessOrEqual",K[K.GreaterOrEqual=5]="GreaterOrEqual",K[K.Xor=6]="Xor",K[K.Or=7]="Or",K[K.And=8]="And"}(ZT||(ZT={}));class bT extends qA{constructor(K){super(K),this.test=ZT.Equal,this.epsilon=0,this.registerInput("left",sA.Float),this.registerInput("right",sA.Float,!0,0),this.registerInput("ifTrue",sA.AutoDetect,!0,1),this.registerInput("ifFalse",sA.AutoDetect,!0,0),this.registerOutput("output",sA.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=sA.Float,this._inputs[0].acceptedConnectionPointTypes.push(sA.Int),this._inputs[1].acceptedConnectionPointTypes.push(sA.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const K=K=>{const A=this.left.getConnectedValue(K),T=this.right.getConnectedValue(K);let G=!1;switch(this.test){case ZT.Equal:G=(0,Q.WithinEpsilon)(A,T,this.epsilon);break;case ZT.NotEqual:G=!(0,Q.WithinEpsilon)(A,T,this.epsilon);break;case ZT.LessThan:G=A<T+this.epsilon;break;case ZT.GreaterThan:G=A>T-this.epsilon;break;case ZT.LessOrEqual:G=A<=T+this.epsilon;break;case ZT.GreaterOrEqual:G=A>=T-this.epsilon;break;case ZT.Xor:G=!!A&&!T||!A&&!!T;break;case ZT.Or:G=!!A||!!T;break;case ZT.And:G=!!A&&!!T}return G};this.output._storedFunction=A=>K(A)?this.ifTrue.getConnectedValue(A):this.ifFalse.getConnectedValue(A)}serialize(){const K=super.serialize();return K.test=this.test,K.epsilon=this.epsilon,K}_deserialize(K){super._deserialize(K),this.test=K.test,void 0!==K.epsilon&&(this.epsilon=K.epsilon)}}(0,e.c)([yA("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:ZT.Equal},{label:"NotEqual",value:ZT.NotEqual},{label:"LessThan",value:ZT.LessThan},{label:"GreaterThan",value:ZT.GreaterThan},{label:"LessOrEqual",value:ZT.LessOrEqual},{label:"GreaterOrEqual",value:ZT.GreaterOrEqual},{label:"Xor",value:ZT.Xor},{label:"Or",value:ZT.Or},{label:"And",value:ZT.And}]})],bT.prototype,"test",void 0),(0,e.c)([yA("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],bT.prototype,"epsilon",void 0),(0,O.c)("BABYLON.ParticleConditionBlock",bT);class PT extends qA{constructor(K){super(K),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",sA.Particle),this.registerInput("condition",sA.Float,!0,0),this.registerInput("system",sA.System),this.registerOutput("output",sA.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){this._triggerCount=0;const A=this.input.getConnectedValue(K),T={process:T=>{if(K.particleContext=T,K.systemContext=A,0!==this.condition.getConnectedValue(K)&&(0===this.limit||this._triggerCount<this.limit)){const G=(new Date).getTime();if(this._previousOne&&G-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=G;const B=this.system.getConnectedValue(K);if(B){const G=aA(B,K.dA,T.position);G.Ff.addOnce((()=>{this._triggerCount--})),A.Ff.addOnce((()=>{G.dispose()}))}}},previousItem:null,nextItem:null};A._updateQueueStart?oK(T,A._updateQueueStart):A._updateQueueStart=T,this.output._storedValue=A}serialize(){const K=super.serialize();return K.limit=this.limit,K.delay=this.delay,K}_deserialize(K){super._deserialize(K),void 0!==K.limit&&(this.limit=K.limit),void 0!==K.delay&&(this.delay=K.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,e.c)([yA("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PT.prototype,"limit",void 0),(0,e.c)([yA("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PT.prototype,"delay",void 0),(0,O.c)("BABYLON.ParticleTriggerBlock",PT);T(13946),T(13953),T(13962),T(14007)},13996:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13966:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14021:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneVertex",L="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14013:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14004:(K,A,T)=>{"use strict";var G=T(12618);const B="fogFragment",L="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13990:(K,A,T)=>{"use strict";var G=T(12618);const B="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14030:(K,A,T)=>{"use strict";var G=T(12618);const B="fogVertex",L="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14015:(K,A,T)=>{"use strict";var G=T(12618);const B="fogVertexDeclaration",L="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13983:(K,A,T)=>{"use strict";var G=T(12618);const B="helperFunctions",L="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13968:(K,A,T)=>{"use strict";var G=T(12618);const B="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13987:(K,A,T)=>{"use strict";var G=T(12618);const B="imageProcessingFunctions",L="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13974:(K,A,T)=>{"use strict";var G=T(12618);const B="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14e3:(K,A,T)=>{"use strict";var G=T(12618);const B="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},14032:(K,A,T)=>{"use strict";var G=T(12618);const B="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";G.b.IncludesShadersStoreWGSL[B]||(G.b.IncludesShadersStoreWGSL[B]=L)},13962:(K,A,T)=>{"use strict";T.r(A),T.d(A,{particlesPixelShaderWGSL:()=>f});var G=T(12618);T(13966),T(13968),T(13974),T(13983),T(13987),T(13990),T(13996),T(14e3),T(14004);const B="particlesPixelShader",L="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";G.b.ShadersStoreWGSL[B]||(G.b.ShadersStoreWGSL[B]=L);const f={name:B,shader:L}},14007:(K,A,T)=>{"use strict";T.r(A),T.d(A,{particlesVertexShaderWGSL:()=>f});var G=T(12618);T(14013),T(14015),T(13974),T(14021),T(14030),T(14032);const B="particlesVertexShader",L="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";G.b.ShadersStoreWGSL[B]||(G.b.ShadersStoreWGSL[B]=L);const f={name:B,shader:L}},13872:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13949:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13895:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneVertex",L="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13958:(K,A,T)=>{"use strict";var G=T(12618);const B="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13885:(K,A,T)=>{"use strict";var G=T(12618);const B="fogFragment",L="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13870:(K,A,T)=>{"use strict";var G=T(12618);const B="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13903:(K,A,T)=>{"use strict";var G=T(12618);const B="fogVertex",L="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13893:(K,A,T)=>{"use strict";var G=T(12618);const B="fogVertexDeclaration",L="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13856:(K,A,T)=>{"use strict";var G=T(12618);const B="helperFunctions",L="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13845:(K,A,T)=>{"use strict";var G=T(12618);const B="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13864:(K,A,T)=>{"use strict";var G=T(12618);const B="imageProcessingFunctions",L="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13851:(K,A,T)=>{"use strict";var G=T(12618);const B="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13876:(K,A,T)=>{"use strict";var G=T(12618);const B="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13909:(K,A,T)=>{"use strict";var G=T(12618);const B="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";G.b.IncludesShadersStore[B]||(G.b.IncludesShadersStore[B]=L)},13946:(K,A,T)=>{"use strict";T.r(A),T.d(A,{particlesPixelShader:()=>f});var G=T(12618);T(13949),T(13845),T(13851),T(13856),T(13864),T(13870),T(13872),T(13876),T(13885);const B="particlesPixelShader",L="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";G.b.ShadersStore[B]||(G.b.ShadersStore[B]=L);const f={name:B,shader:L}},13953:(K,A,T)=>{"use strict";T.r(A),T.d(A,{particlesVertexShader:()=>f});var G=T(12618);T(13958),T(13893),T(13851),T(13895),T(13903),T(13909);const B="particlesVertexShader",L="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";G.b.ShadersStore[B]||(G.b.ShadersStore[B]=L);const f={name:B,shader:L}},14302:(K,A,T)=>{"use strict";T.r(A),T.d(A,{FlowGraphGLTFDataProvider:()=>L});var G=T(14262),B=T(14237);class L extends G.e{constructor(K){var A,T;super();const G=K.glTF,L=(null===(A=G.animations)||void 0===A?void 0:A.map((K=>K._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",B.b,L);const f=(null===(T=G.nodes)||void 0===T?void 0:T.map((K=>K._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",B.b,f)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14164:(K,A,T)=>{"use strict";T.d(A,{d:()=>F,e:()=>b,g:()=>J,k:()=>P});var G=T(12700),B=T(13186),L=T(12743),f=T(14173);const O=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class C{constructor(K,A){this._gltf=K,this._infoTree=A}convert(K){let A,T=this._gltf,G=this._infoTree;if(!K.startsWith("/"))throw new Error("Path must start with a /");const B=K.split("/");if(B.shift(),B[B.length-1].includes(".length")){const K=B[B.length-1].split(".");B.pop(),B.push(...K)}let L=!1;for(const C of B){const B="length"===C;if(B&&!G.__array__)throw new Error(`Path ${K} is invalid`);if(G.__ignoreObjectTree__&&(L=!0),G.__array__&&!B)G=G.__array__;else if(G=G[C],!G)throw new Error(`Path ${K} is invalid`);if(!L)if(void 0===T){if(!O.find((A=>A.regex.test(K))))throw new Error(`Path ${K} is invalid`)}else if(!B){var f;T=null===(f=T)||void 0===f?void 0:f[C]}(G.__target__||B)&&(A=T)}return{object:A,info:G}}}function Q(K,A,T,G){const B=Y(K,A);return G?B[T][G]:B[T]}function Y(K,A,T){var G,L;return null===(G=K._data)||void 0===G||null===(L=G[(null===T||void 0===T?void 0:T.fillMode)??B.d.MATERIAL_TriangleFillMode])||void 0===L?void 0:L.babylonMaterial}function Z(K,A){return{offset:{componentsCount:2,type:"Vector2",get:(T,B,L)=>{const f=Q(T,L,K,A);return new G.Vector2(null===f||void 0===f?void 0:f.uOffset,null===f||void 0===f?void 0:f.vOffset)},getTarget:Y,set:(T,G,B,L)=>{const f=Q(G,L,K,A);f.uOffset=T.x,f.vOffset=T.y},getPropertyName:[()=>`${K}${A?"."+A:""}.uOffset`,()=>`${K}${A?"."+A:""}.vOffset`]},rotation:{type:"number",get:(T,G,B)=>{var L;return null===(L=Q(T,B,K,A))||void 0===L?void 0:L.wAng},getTarget:Y,set:(T,G,B,L)=>Q(G,L,K,A).wAng=T,getPropertyName:[()=>`${K}${A?"."+A:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(T,B,L)=>{const f=Q(T,L,K,A);return new G.Vector2(null===f||void 0===f?void 0:f.uScale,null===f||void 0===f?void 0:f.vScale)},getTarget:Y,set:(T,G,B,L)=>{const f=Q(G,L,K,A);f.uScale=T.x,f.vScale=T.y},getPropertyName:[()=>`${K}${A?"."+A:""}.uScale`,()=>`${K}${A?"."+A:""}.vScale`]}}}const x={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:K=>{var A,T;return new G.Vector2((null===(A=K._babylonCamera)||void 0===A?void 0:A.orthoLeft)??0,(null===(T=K._babylonCamera)||void 0===T?void 0:T.orthoRight)??0)},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.orthoLeft=K.x,A._babylonCamera.orthoRight=K.y)},getTarget:K=>K,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:K=>{var A,T;return new G.Vector2((null===(A=K._babylonCamera)||void 0===A?void 0:A.orthoBottom)??0,(null===(T=K._babylonCamera)||void 0===T?void 0:T.orthoTop)??0)},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.orthoBottom=K.x,A._babylonCamera.orthoTop=K.y)},getTarget:K=>K,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:K=>{var A;return null===(A=K._babylonCamera)||void 0===A?void 0:A.maxZ},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.maxZ=K)},getTarget:K=>K,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:K=>{var A;return null===(A=K._babylonCamera)||void 0===A?void 0:A.If},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.If=K)},getTarget:K=>K,getPropertyName:[()=>"If"]}},perspective:{aspectRatio:{type:"number",get:K=>{var A;return null===(A=K._babylonCamera)||void 0===A?void 0:A.getEngine().getAspectRatio(K._babylonCamera)},getTarget:K=>K,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:K=>{var A;return null===(A=K._babylonCamera)||void 0===A?void 0:A.fov},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.fov=K)},getTarget:K=>K,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:K=>{var A;return null===(A=K._babylonCamera)||void 0===A?void 0:A.maxZ},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.maxZ=K)},getTarget:K=>K,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:K=>{var A;return null===(A=K._babylonCamera)||void 0===A?void 0:A.If},set:(K,A)=>{A._babylonCamera&&(A._babylonCamera.If=K)},getTarget:K=>K,getPropertyName:[()=>"If"]}}}},nodes:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"PA",get:K=>{var A;return null===(A=K._babylonTransformNode)||void 0===A?void 0:A.position},set:(K,A)=>{var T;return null===(T=A._babylonTransformNode)||void 0===T?void 0:T.position.G(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:K=>{var A;return null===(A=K._babylonTransformNode)||void 0===A?void 0:A.rotationQuaternion},set:(K,A)=>{var T,G;return null===(T=A._babylonTransformNode)||void 0===T||null===(G=T.rotationQuaternion)||void 0===G?void 0:G.G(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"PA",get:K=>{var A;return null===(A=K._babylonTransformNode)||void 0===A?void 0:A.vO},set:(K,A)=>{var T;return null===(T=A._babylonTransformNode)||void 0===T?void 0:T.vO.G(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"vO"]},weights:{length:{type:"number",get:K=>K._numMorphTargets,getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(K,A)=>{var T,G;return void 0!==A?null===(T=K._primitiveBabylonMeshes)||void 0===T||null===(G=T[0].morphTargetManager)||void 0===G?void 0:G.getTarget(A).influence:void 0},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(K,A)=>[0],getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:K=>{var A,T,B;return G.Matrix.Compose(null===(A=K._babylonTransformNode)||void 0===A?void 0:A.vO,null===(T=K._babylonTransformNode)||void 0===T?void 0:T.rotationQuaternion,null===(B=K._babylonTransformNode)||void 0===B?void 0:B.position)},getTarget:K=>K._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:K=>{var A,T,B,L;const f=G.Matrix.Identity();let O=K.parent;for(;O&&O.parent;)O=O.parent;const C=(null===(A=K._babylonTransformNode)||void 0===A?void 0:A.position._isDirty)||(null===(T=K._babylonTransformNode)||void 0===T||null===(B=T.rotationQuaternion)||void 0===B?void 0:B._isDirty)||(null===(L=K._babylonTransformNode)||void 0===L?void 0:L.vO._isDirty);if(O){var Q;const A=null===(Q=O._babylonTransformNode)||void 0===Q?void 0:Q.wf(!0).invert();var Y,Z;if(A)null===(Y=K._babylonTransformNode)||void 0===Y||null===(Z=Y.wf(C))||void 0===Z||Z.multiplyToRef(A,f)}else K._babylonTransformNode&&f.G(K._babylonTransformNode.wf(C));return f},getTarget:K=>K._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:K=>{var A,T;return null===(A=K._babylonTransformNode)||void 0===A||null===(T=A.getChildren((K=>K instanceof f.b),!0)[0])||void 0===T?void 0:T.VO},getTarget:K=>{var A;return null===(A=K._babylonTransformNode)||void 0===A?void 0:A.getChildren((K=>K instanceof f.b),!0)[0]},set:(K,A)=>{if(A._babylonTransformNode){const T=A._babylonTransformNode.getChildren((K=>K instanceof f.b),!0)[0];T&&(T.VO=K)}}},color:{type:"DA",get:K=>{var A,T;return null===(A=K._babylonTransformNode)||void 0===A||null===(T=A.getChildren((K=>K instanceof f.b),!0)[0])||void 0===T?void 0:T.XO},getTarget:K=>{var A;return null===(A=K._babylonTransformNode)||void 0===A?void 0:A.getChildren((K=>K instanceof f.b),!0)[0]},set:(K,A)=>{if(A._babylonTransformNode){const T=A._babylonTransformNode.getChildren((K=>K instanceof f.b),!0)[0];T&&(T.XO=K)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"DA",get:(K,A,T)=>Y(K,A,T).emissiveColor,set:(K,A,T,G)=>Y(A,T,G).emissiveColor.G(K),getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Z("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(K,A,T)=>{var G;return null===(G=Q(K,T,"bumpTexture"))||void 0===G?void 0:G.level},set:(K,A,T,G)=>{const B=Q(A,G,"bumpTexture");B&&(B.level=K)},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Z("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(K,A,T)=>Y(K,A,T).ambientTextureStrength,set:(K,A,T,G)=>{const B=Y(A,T,G);B&&(B.ambientTextureStrength=K)},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Z("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"oO",get:(K,A,T)=>{const G=Y(K,A,T);return L.oO.FromColor3(G.albedoColor,G.alpha)},set:(K,A,T,G)=>{const B=Y(A,T,G);B.albedoColor.set(K.r,K.g,K.b),B.alpha=K.a},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Z("albedoTexture")}},metallicFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).metallic,set:(K,A,T,G)=>{const B=Y(A,T,G);B&&(B.metallic=K)},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).roughness,set:(K,A,T,G)=>{const B=Y(A,T,G);B&&(B.roughness=K)},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Z("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(K,A,T)=>Y(K,A,T).anisotropy.VO,set:(K,A,T,G)=>{Y(A,T,G).anisotropy.VO=K},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(K,A,T)=>Y(K,A,T).anisotropy.angle,set:(K,A,T,G)=>{Y(A,T,G).anisotropy.angle=K},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Z("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).clearCoat.VO,set:(K,A,T,G)=>{Y(A,T,G).clearCoat.VO=K},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).clearCoat.roughness,set:(K,A,T,G)=>{Y(A,T,G).clearCoat.roughness=K},getTarget:(K,A,T)=>Y(K,A,T),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Z("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(K,A,T)=>{var G;return null===(G=Y(K,A,T).clearCoat.bumpTexture)||void 0===G?void 0:G.level},getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).clearCoat.bumpTexture.level=K},extensions:{KHR_texture_transform:Z("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Z("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(K,A,T)=>Y(K,A,T).subSurface.dispersion,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).subSurface.dispersion=K}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(K,A,T)=>Y(K,A,T).emissiveIntensity,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).emissiveIntensity=K}},KHR_materials_ior:{ior:{type:"number",get:(K,A,T)=>Y(K,A,T).indexOfRefraction,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).indexOfRefraction=K}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).iridescence.VO,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).iridescence.VO=K},iridescenceIor:{type:"number",get:(K,A,T)=>Y(K,A,T).iridescence.indexOfRefraction,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).iridescence.indexOfRefraction=K},iridescenceTexture:{extensions:{KHR_texture_transform:Z("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(K,A,T)=>Y(K,A,T).iridescence.maximumThickness,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).iridescence.maximumThickness=K},iridescenceThicknessMinimum:{type:"number",get:(K,A,T)=>Y(K,A,T).iridescence.minimumThickness,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).iridescence.minimumThickness=K},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Z("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"DA",get:(K,A,T)=>Y(K,A,T).sheen.color,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).sheen.color.G(K)},sheenColorTexture:{extensions:{KHR_texture_transform:Z("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).sheen.VO,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).sheen.VO=K},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Z("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).metallicF0Factor,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).metallicF0Factor=K,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"DA",get:(K,A,T)=>Y(K,A,T).metallicReflectanceColor,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).metallicReflectanceColor.G(K),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Z("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Z("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).subSurface.refractionIntensity,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).subSurface.refractionIntensity=K,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Z("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).subSurface.translucencyIntensity,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).subSurface.translucencyIntensity=K},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Z("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"DA",get:(K,A,T)=>Y(K,A,T).subSurface.translucencyColor,getTarget:Y,set:(K,A,T,G)=>{var B;return K&&(null===(B=Y(A,T,G).subSurface.translucencyColor)||void 0===B?void 0:B.G(K))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Z("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"DA",get:(K,A,T)=>Y(K,A,T).subSurface.tintColor,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).subSurface.tintColor.G(K)},attenuationDistance:{type:"number",get:(K,A,T)=>Y(K,A,T).subSurface.tintColorAtDistance,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).subSurface.tintColorAtDistance=K},thicknessFactor:{type:"number",get:(K,A,T)=>Y(K,A,T).subSurface.maximumThickness,getTarget:Y,set:(K,A,T,G)=>Y(A,T,G).subSurface.maximumThickness=K},thicknessTexture:{extensions:{KHR_texture_transform:Z("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonLight)),getPropertyName:[K=>"length"]},__array__:{__target__:!0,color:{type:"DA",get:K=>{var A;return null===(A=K._babylonLight)||void 0===A?void 0:A.XO},set:(K,A)=>{var T;return null===(T=A._babylonLight)||void 0===T?void 0:T.XO.G(K)},getTarget:K=>K._babylonLight,getPropertyName:[K=>"diffuse"]},VO:{type:"number",get:K=>{var A;return null===(A=K._babylonLight)||void 0===A?void 0:A.VO},set:(K,A)=>A._babylonLight?A._babylonLight.VO=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"intensity"]},range:{type:"number",get:K=>{var A;return null===(A=K._babylonLight)||void 0===A?void 0:A.range},set:(K,A)=>A._babylonLight?A._babylonLight.range=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"range"]},spot:{innerConeAngle:{type:"number",get:K=>{var A;return null===(A=K._babylonLight)||void 0===A?void 0:A.innerAngle},set:(K,A)=>A._babylonLight?A._babylonLight.innerAngle=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"innerConeAngle"]},outerConeAngle:{type:"number",get:K=>{var A;return null===(A=K._babylonLight)||void 0===A?void 0:A.angle},set:(K,A)=>A._babylonLight?A._babylonLight.angle=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonLight)),getPropertyName:[K=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonTexture)),getPropertyName:[K=>"length"]},__array__:{__target__:!0,VO:{type:"number",get:K=>{var A;return null===(A=K._babylonTexture)||void 0===A?void 0:A.level},set:(K,A)=>{A._babylonTexture&&(A._babylonTexture.level=K)},getTarget:K=>K._babylonTexture},rotation:{type:"Quaternion",get:K=>{var A;return K._babylonTexture&&G.Quaternion.FromRotationMatrix(null===(A=K._babylonTexture)||void 0===A?void 0:A.getReflectionTextureMatrix())},set:(K,A)=>{var T;A._babylonTexture&&(null!==(T=A._babylonTexture.SK())&&void 0!==T&&T.useRightHandedSystem||(K=G.Quaternion.Inverse(K)),G.Matrix.FromQuaternionToRef(K,A._babylonTexture.getReflectionTextureMatrix()))},getTarget:K=>K._babylonTexture}}}}},animations:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>{var A;return null===(A=K.primitives[0]._instanceData)||void 0===A?void 0:A.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function J(K){return new C(K,x)}function b(K){const A=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let T=x;for(const G of A)G&&(T=T[G]);if(T&&T.type&&T.get)return T}function P(K,A){const T=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let G=x;for(const B of T)B&&(G=G[B]);G&&G.type&&G.get&&(G.interpolation=A)}function F(K,A){const T=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let G=x;for(const B of T)if(B){if(!G[B]){if("?"===B){G.__ignoreObjectTree__=!0;continue}G[B]={},"__array__"===B&&(G[B].__target__=!0)}G=G[B]}Object.assign(G,A)}},14175:(K,A,T)=>{"use strict";T.r(A),T.d(A,{AnimationPropertyInfo:()=>Q,TransformNodeAnimationPropertyInfo:()=>Y,WeightAnimationPropertyInfo:()=>Z,getQuaternion:()=>O,getVector3:()=>f,getWeights:()=>C});var G=T(13226),B=T(12700),L=T(14164);function f(K,A,T,G){return B.PA.mT(A,T).scaleInPlace(G)}function O(K,A,T,G){return B.Quaternion.mT(A,T).scaleInPlace(G)}function C(K,A,T,G){const B=new Array(K._numMorphTargets);for(let L=0;L<B.length;L++)B[L]=A[T++]*G;return B}class Q{constructor(K,A,T,G){this.type=K,this.name=A,this.getValue=T,this.getStride=G}_buildAnimation(K,A,T){const B=new G.b(K,this.name,A,this.type);return B.setKeys(T),B}}class Y extends Q{buildAnimations(K,A,T,G){const B=[];return B.push({babylonAnimatable:K._babylonTransformNode,babylonAnimation:this._buildAnimation(A,T,G)}),B}}class Z extends Q{buildAnimations(K,A,T,B){const L=[];if(K._numMorphTargets)for(let f=0;f<K._numMorphTargets;f++){const O=new G.b(`${A}_${f}`,this.name,T,this.type);if(O.setKeys(B.map((K=>({frame:K.frame,inTangent:K.inTangent?K.inTangent[f]:void 0,value:K.value[f],outTangent:K.outTangent?K.outTangent[f]:void 0,interpolation:K.interpolation})))),K._primitiveBabylonMeshes)for(const A of K._primitiveBabylonMeshes)if(A.morphTargetManager){const K=A.morphTargetManager.getTarget(f),T=O.clone();K.animations.push(T),L.push({babylonAnimatable:K,babylonAnimation:T})}}return L}}(0,L.k)("/nodes/{}/translation",[new Y(G.b.ANIMATIONTYPE_VECTOR3,"position",f,(()=>3))]),(0,L.k)("/nodes/{}/rotation",[new Y(G.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",O,(()=>4))]),(0,L.k)("/nodes/{}/scale",[new Y(G.b.ANIMATIONTYPE_VECTOR3,"vO",f,(()=>3))]),(0,L.k)("/nodes/{}/weights",[new Z(G.b.ANIMATIONTYPE_FLOAT,"influence",C,(K=>K._numMorphTargets))])},14134:(K,A,T)=>{"use strict";class G{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((K,A)=>{this._resolve=K,this._reject=A}))}}var B=T(12700),L=T(12743),f=T(12526),O=T(13154),C=T(14140),Q=T(14152),Y=T(12534),Z=T(13181),x=T(13226),J=T(13233),b=T(12565),P=T(12548),F=T(12550);class d{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(K){this._useTextureToStoreBoneMatrices=K,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(K,A,T){this.name=K,this.id=A,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=B.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Y.e,this.bones=[],this._scene=T||b.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const G=this._scene.getEngine().getCaps();this._canUseTextureForBones=G.textureFloat&&G.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((K=>!K.getParent()))}getTransformMatrices(K){if(this.needInitialSkinMatrix){if(!K)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return K._bonesTransformMatrices||this.prepare(!0),K._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(K){return this.needInitialSkinMatrix&&K._transformMatrixTexture?K._transformMatrixTexture:this._transformMatrixTexture}SK(){return this._scene}toString(K){let A=`Name: ${this.name}, nBones: ${this.bones.length}`;if(A+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,K){A+=", Ranges: {";let K=!0;for(const T in this._ranges)K&&(A+=", ",K=!1),A+=T;A+="}"}return A}getBoneIndexByName(K){for(let A=0,T=this.bones.length;A<T;A++)if(this.bones[A].name===K)return A;return-1}createAnimationRange(K,A,T){if(!this._ranges[K]){this._ranges[K]=new J.c(K,A,T);for(let G=0,B=this.bones.length;G<B;G++)this.bones[G].animations[0]&&this.bones[G].animations[0].createRange(K,A,T)}}deleteAnimationRange(K){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let T=0,G=this.bones.length;T<G;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].deleteRange(K,A);this._ranges[K]=null}getAnimationRange(K){return this._ranges[K]||null}getAnimationRanges(){const K=[];let A;for(A in this._ranges)K.push(this._ranges[A]);return K}copyAnimationRange(K,A){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[A]||!K.getAnimationRange(A))return!1;let G=!0;const B=this._getHighestAnimationFrame()+1,L={},f=K.bones;let O,C;for(C=0,O=f.length;C<O;C++)L[f[C].name]=f[C];this.bones.length!==f.length&&(P.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${f.length}`),G=!1);const Q=T&&this.dimensionsAtRest&&K.dimensionsAtRest?this.dimensionsAtRest.divide(K.dimensionsAtRest):null;for(C=0,O=this.bones.length;C<O;C++){const K=this.bones[C].name,f=L[K];f?G=G&&this.bones[C].copyAnimationRange(f,A,B,T,Q):(P.d.Warn("copyAnimationRange: not same rig, missing source bone "+K),G=!1)}const Y=K.getAnimationRange(A);return Y&&(this._ranges[A]=new J.c(A,Y.from+B,Y.to+B)),G}returnToRest(){for(const K of this.bones)-1!==K._index&&K.returnToRest()}_getHighestAnimationFrame(){let K=0;for(let A=0,T=this.bones.length;A<T;A++)if(this.bones[A].animations[0]){const T=this.bones[A].animations[0].getHighestFrame();K<T&&(K=T)}return K}beginAnimation(K,A,T,G){const B=this.getAnimationRange(K);return B?this._scene.beginAnimation(this,B.from,B.to,A,T,G):null}static MakeAnimationAdditive(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const G=K.getAnimationRange(T);if(!G)return null;const B=K._scene.getAllAnimatablesByTarget(K);let L=null;for(let O=0;O<B.length;O++){const K=B[O];if(K.fromFrame===(null===G||void 0===G?void 0:G.from)&&K.toFrame===(null===G||void 0===G?void 0:G.to)){L=K;break}}const f=K.getAnimatables();for(let O=0;O<f.length;O++){const K=f[O].animations;if(K)for(let G=0;G<K.length;G++)x.b.MakeAnimationAdditive(K[G],A,T)}return L&&(L.isAdditive=!0),K}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(K){this._meshesWithPoseMatrix.push(K)}_unregisterMeshWithPoseMatrix(K){const A=this._meshesWithPoseMatrix.indexOf(K);A>-1&&this._meshesWithPoseMatrix.splice(A,1)}_computeTransformMatrices(K,A){this.onBeforeComputeObservable.notifyObservers(this);for(let T=0;T<this.bones.length;T++){const G=this.bones[T];G._childUpdateId++;const B=G.getParent();if(B?G.getLocalMatrix().multiplyToRef(B.getFinalMatrix(),G.getFinalMatrix()):A?G.getLocalMatrix().multiplyToRef(A,G.getFinalMatrix()):G.getFinalMatrix().G(G.getLocalMatrix()),-1!==G._index){const A=null===G._index?T:G._index;G.getAbsoluteInverseBindMatrix().multiplyToArray(G.getFinalMatrix(),K,16*A)}}this._identity.copyToArray(K,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const K=this.SK().getRenderId();if(this._currentRenderId===K)return;this._currentRenderId=K}if(this._numBonesWithLinkedTransformNode>0)for(const K of this.bones)if(K._linkedTransformNode){const A=K._linkedTransformNode;K.position=A.position,A.rotationQuaternion?K.rotationQuaternion=A.rotationQuaternion:K.rotation=A.rotation,K.vO=A.vO}if(this.needInitialSkinMatrix)for(const K of this._meshesWithPoseMatrix){const A=K.getPoseMatrix();let T=this._isDirty;if(K._bonesTransformMatrices&&K._bonesTransformMatrices.length===16*(this.bones.length+1)||(K._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),T=!0),T){if(this._synchronizedWithMesh!==K){this._synchronizedWithMesh=K;for(const K of this.bones)if(!K.getParent()){K.getBindMatrix().multiplyToRef(A,B.TmpVectors.Matrix[1]),K._updateAbsoluteBindMatrices(B.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const A=4*(this.bones.length+1);K._transformMatrixTexture&&K._transformMatrixTexture.getSize().width===A||(K._transformMatrixTexture&&K._transformMatrixTexture.dispose(),K._transformMatrixTexture=Z.b.CreateRGBATexture(K._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(K._bonesTransformMatrices,A),this.isUsingTextureForMatrices&&K._transformMatrixTexture&&K._transformMatrixTexture.update(K._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Z.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let K=0;K<this.bones.length;K++)this._animatables.push(this.bones[K])}return this._animatables}clone(K,A){const T=new d(K,A||K,this._scene);T.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let G=0;G<this.bones.length;G++){const K=this.bones[G];let A=null;const B=K.getParent();if(B){const K=this.bones.indexOf(B);A=T.bones[K]}const L=new Q.b(K.name,T,A,K.getBindMatrix().clone(),K.getRestMatrix().clone());L._index=K._index,K._linkedTransformNode&&L.linkTransformNode(K._linkedTransformNode),F.c.DeepCopy(K.animations,L.animations)}if(this._ranges){T._ranges={};for(const K in this._ranges){const A=this._ranges[K];A&&(T._ranges[K]=A.clone())}}return this._isDirty=!0,T.prepare(!0),T}enableBlending(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const A of this.bones)for(const T of A.animations)T.enableBlending=!0,T.blendingSpeed=K}dispose(){if(this._meshesWithPoseMatrix.length=0,this.SK().stopAnimation(this),this.SK().removeSkeleton(this),this._parentContainer){const K=this._parentContainer.skeletons.indexOf(this);K>-1&&this._parentContainer.skeletons.splice(K,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const K={};K.name=this.name,K.id=this.id,this.dimensionsAtRest&&(K.dimensionsAtRest=this.dimensionsAtRest.kf()),K.bones=[],K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){var A;const G=this.bones[T],B=G.getParent(),L={parentBoneIndex:B?this.bones.indexOf(B):-1,index:G.getIndex(),name:G.name,id:G.id,matrix:G.getBindMatrix().kf(),rest:G.getRestMatrix().kf(),linkedTransformNodeId:null===(A=G.getTransformNode())||void 0===A?void 0:A.id};K.bones.push(L),G.length&&(L.length=G.length),G.metadata&&(L.metadata=G.metadata),G.animations&&G.animations.length>0&&(L.animation=G.animations[0].serialize()),K.ranges=[];for(const A in this._ranges){const T=this._ranges[A];if(!T)continue;const G={};G.name=A,G.from=T.from,G.to=T.to,K.ranges.push(G)}}return K}static Parse(K,A){const T=new d(K.name,K.id,A);let G;for(K.dimensionsAtRest&&(T.dimensionsAtRest=B.PA.mT(K.dimensionsAtRest)),T.needInitialSkinMatrix=K.needInitialSkinMatrix,G=0;G<K.bones.length;G++){const A=K.bones[G],L=K.bones[G].index;let f=null;A.parentBoneIndex>-1&&(f=T.bones[A.parentBoneIndex]);const O=A.rest?B.Matrix.mT(A.rest):null,C=new Q.b(A.name,T,f,B.Matrix.mT(A.matrix),O,null,L);void 0!==A.id&&null!==A.id&&(C.id=A.id),A.length&&(C.length=A.length),A.metadata&&(C.metadata=A.metadata),A.animation&&C.animations.push(x.b.Parse(A.animation)),void 0!==A.linkedTransformNodeId&&null!==A.linkedTransformNodeId&&(T._hasWaitingData=!0,C._waitingTransformNodeId=A.linkedTransformNodeId)}if(K.ranges)for(G=0;G<K.ranges.length;G++){const A=K.ranges[G];T.createAnimationRange(A.name,A.from,A.to)}return T}computeAbsoluteMatrices(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||K)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(K)}getPoseMatrix(){let K=null;return this._meshesWithPoseMatrix.length>0&&(K=this._meshesWithPoseMatrix[0].getPoseMatrix()),K}sortBones(){const K=[],A=new Array(this.bones.length);for(let T=0;T<this.bones.length;T++)this._sortBones(T,K,A);this.bones=K}_sortBones(K,A,T){if(T[K])return;T[K]=!0;const G=this.bones[K];if(!G)return;void 0===G._index&&(G._index=K);const B=G.getParent();B&&this._sortBones(this.bones.indexOf(B),A,T),A.push(G)}setCurrentPoseAsRest(){for(const K of this.bones)K.setCurrentPoseAsRest()}}var N=T(13016),D=T(13196),mK=T(12674),U=T(13118),z=T(12768),g=T(13163),S=T(13129),l=T(13147),u=T(13238),c=T(12786),n=T(14104);class H{set areUpdatesFrozen(K){K?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new c.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,K||(K=b.b.LastCreatedScene),this._scene=K,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const K=this._scene.getEngine().getCaps();this._canUseTextureForTargets=K.canUseGLVertexID&&K.textureFloat&&K.maxVertexTextureImageUnits>0&&K.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return H.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?H.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(K){this._numMaxInfluencers!==K&&(this._numMaxInfluencers=K,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(K){this._useTextureToStoreTargets!==K&&(this._useTextureToStoreTargets=K,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var K;return H.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(K=this._scene)&&void 0!==K&&K.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(K){return this._activeTargets.data[K]}getTarget(K){return this._targets[K]}getTargetByName(K){for(const A of this._targets)if(A.name===K)return A;return null}addTarget(K){this._targets.push(K),this._targetInfluenceChangedObservers.push(K.onInfluenceChanged.add((K=>{this.areUpdatesFrozen&&K&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(K)}))),this._targetDataLayoutChangedObservers.push(K._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(K){const A=this._targets.indexOf(K);A>=0&&(this._targets.splice(A,1),K.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(A,1)[0]),K._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(A,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(K)}_bind(K){K.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),K.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),K.setTexture("morphTargets",this._targetStoreTexture),K.setInt("morphTargetCount",this.numInfluencers)}clone(){const K=new H(this._scene);for(const A of this._targets)K.addTarget(A.clone());return K.enablePositionMorphing=this.enablePositionMorphing,K.enableNormalMorphing=this.enableNormalMorphing,K.enableTangentMorphing=this.enableTangentMorphing,K.enableUVMorphing=this.enableUVMorphing,K.enableUV2Morphing=this.enableUV2Morphing,K.enableColorMorphing=this.enableColorMorphing,K}serialize(){const K={};K.id=this.uniqueId,K.targets=[];for(const A of this._targets)K.targets.push(A.serialize());return K}_syncActiveTargets(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const A=!!this._targetStoreTexture,T=this.isUsingTextureForTargets;(this._mustSynchronize||A!==T)&&(this._mustSynchronize=!1,this.synchronize());let G=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let B=-1;for(const L of this._targets)if(B++,0!==L.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=H.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(L),this._morphTargetTextureIndices[G]=B,this._tempInfluences[G++]=L.influence}this._morphTargetTextureIndices.length!==G&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,G)),this._influences&&this._influences.length===G||(this._influences=new Float32Array(G));for(let L=0;L<G;L++)this._influences[L]=this._tempInfluences[L];if(K&&this._scene)for(const L of this._scene.meshes)L.morphTargetManager===this&&(T?L._markSubMeshesAsAttributesDirty():L._syncGeometryWithMorphTargetManager())}synchronize(){var K;if(!this._scene||this.areUpdatesFrozen)return;const A=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(K=this._targetStoreTexture)||void 0===K||K.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>A.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const T of this._targets){this._supportsPositions=this._supportsPositions&&T.hasPositions,this._supportsNormals=this._supportsNormals&&T.hasNormals,this._supportsTangents=this._supportsTangents&&T.hasTangents,this._supportsUVs=this._supportsUVs&&T.hasUVs,this._supportsUV2s=this._supportsUV2s&&T.hasUV2s,this._supportsColors=this._supportsColors&&T.hasColors;const K=T.vertexCount;if(0===this._vertexCount)this._vertexCount=K;else if(this._vertexCount!==K)return void P.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${T.name}": ${K}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const K=A.getCaps().maxTextureSize;this._textureWidth>K&&(this._textureHeight=Math.ceil(this._textureWidth/K),this._textureWidth=K);const T=this._targets.length,G=new Float32Array(T*this._textureWidth*this._textureHeight*4);let B=0;for(let A=0;A<T;A++){const K=this._targets[A],T=K.getPositions(),L=K.getNormals(),f=K.getUVs(),O=K.getTangents(),C=K.getUV2s(),Q=K.getColors();B=A*this._textureWidth*this._textureHeight*4;for(let A=0;A<this._vertexCount;A++)this._supportsPositions&&T&&(G[B]=T[3*A],G[B+1]=T[3*A+1],G[B+2]=T[3*A+2],B+=4),this._supportsNormals&&L&&(G[B]=L[3*A],G[B+1]=L[3*A+1],G[B+2]=L[3*A+2],B+=4),this._supportsUVs&&f&&(G[B]=f[2*A],G[B+1]=f[2*A+1],B+=4),this._supportsTangents&&O&&(G[B]=O[3*A],G[B+1]=O[3*A+1],G[B+2]=O[3*A+2],B+=4),this._supportsUV2s&&C&&(G[B]=C[2*A],G[B+1]=C[2*A+1],B+=4),this._supportsColors&&Q&&(G[B]=Q[4*A],G[B+1]=Q[4*A+1],G[B+2]=Q[4*A+2],G[B+3]=Q[4*A+3],B+=4)}this._targetStoreTexture=n.d.CreateRGBATexture(G,this._textureWidth,this._textureHeight,T,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const T of this._scene.meshes)T.morphTargetManager===this&&T._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const K=this._parentContainer.morphTargetManagers.indexOf(this);K>-1&&this._parentContainer.morphTargetManagers.splice(K,1),this._parentContainer=null}for(const K of this._targets)this._scene.stopAnimation(K)}}static Parse(K,A){const T=new H(A);for(const G of K.targets)T.addTarget(u.d.Parse(G,A));return T}}H.EnableTextureStorage=!0,H.MaxActiveMorphTargetsInVertexAttributeMode=8,H.ConstantTargetCountForTextureMode=0;var e=T(14154),p=T(12571),r=T(13027);const h=new Map,k=h;function s(K,A,T){j(K)&&P.d.Warn(`Extension with the name '${K}' already exists`),h.set(K,{isGLTFExtension:A,factory:T})}function j(K){return h.delete(K)}var R=T(14164),v=T(13288),I=T(12779);class o{static Get(K,A,T){if(!A||void 0==T||!A[T])throw new Error(`${K}: Failed to find index (${T})`);return A[T]}static TryGet(K,A){return K&&void 0!=A&&K[A]?K[A]:null}static Assign(K){if(K)for(let A=0;A<K.length;A++)K[A].index=A}}function W(K){if(K.min&&K.max){const A=K.min,T=K.max,G=B.TmpVectors.PA[0].RO(A[0],A[1],A[2]),L=B.TmpVectors.PA[1].RO(T[0],T[1],T[2]);if(K.normalized&&5126!==K.componentType){let A=1;switch(K.componentType){case 5120:A=127;break;case 5121:A=255;break;case 5122:A=32767;break;case 5123:A=65535}const T=1/A;G.scaleInPlace(T),L.scaleInPlace(T)}return new r.e(G,L)}return null}class i{static RegisterExtension(K,A){s(K,!1,A)}static UnregisterExtension(K){return j(K)}get Sf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(K){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=K}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((K=>K.dispose&&K.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(K,A,T,G,B,L){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=A,this._assetContainer=T,this._loadData(G);let L=null;if(K){const A={};if(this._gltf.nodes)for(const K of this._gltf.nodes)K.name&&(A[K.name]=K.index);L=(K instanceof Array?K:[K]).map((K=>{const T=A[K];if(void 0===T)throw new Error(`Failed to find node '${K}'`);return T}))}return await this._loadAsync(B,f,L,(()=>({meshes:this._getMeshes(),Nx:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=K,this._loadData(A),await this._loadAsync(T,B,null,(()=>{}))}async _loadAsync(K,A,T,G){return await Promise.resolve().then((async()=>{this._rootUrl=K,this._uniqueRootUrl=!K.startsWith("file:")&&A?K:`${K}${Date.now()}/`,this._fileName=A,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const B=`${e.n[e.n.LOADING]} => ${e.n[e.n.READY]}`,L=`${e.n[e.n.LOADING]} => ${e.n[e.n.COMPLETE]}`;this._parent._startPerformanceCounter(B),this._parent._startPerformanceCounter(L),this._parent._setState(e.n.LOADING),this._extensionsOnLoading();const O=new Array;if(!this.parent.loadOnlyMaterials)if(T)O.push(this.loadSceneAsync("/nodes",{nodes:T,index:-1}));else if(void 0!=this._gltf.dA||this._gltf.scenes&&this._gltf.scenes[0]){const K=o.Get("/scene",this._gltf.scenes,this._gltf.dA||0);O.push(this.loadSceneAsync(`/scenes/${K.index}`,K))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let K=0;K<this._gltf.materials.length;++K){const A=this._gltf.materials[K],T="/materials/"+K,G=N.e.TriangleFillMode;O.push(this._loadMaterialAsync(T,A,null,G,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&O.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&O.push(this._compileShadowGeneratorsAsync());const C=Promise.all(O).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.QC(!0);for(const K of this._babylonScene.materials){const A=K;void 0!==A.maxSimultaneousLights&&(A.maxSimultaneousLights=Math.max(A.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(e.n.READY),this._skipStartAnimationStep||this._startAnimations(),G()}));return await C.then((K=>(this._parent._endPerformanceCounter(B),f.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(L),this._parent._setState(e.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(K=>{this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()}))})),K)))})).catch((K=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()),K}))}_loadData(K){if(this._gltf=K.json,this._setupData(),K.bin){const A=this._gltf.buffers;if(A&&A[0]&&!A[0].uri){const T=A[0];(T.byteLength<K.bin.byteLength-3||T.byteLength>K.bin.byteLength)&&P.d.Warn(`Binary buffer length (${T.byteLength}) from JSON does not match chunk length (${K.bin.byteLength})`),this._bin=K.bin}else P.d.Warn("Unexpected BIN chunk")}}_setupData(){if(o.Assign(this._gltf.accessors),o.Assign(this._gltf.animations),o.Assign(this._gltf.buffers),o.Assign(this._gltf.bufferViews),o.Assign(this._gltf.cameras),o.Assign(this._gltf.images),o.Assign(this._gltf.materials),o.Assign(this._gltf.meshes),o.Assign(this._gltf.nodes),o.Assign(this._gltf.samplers),o.Assign(this._gltf.scenes),o.Assign(this._gltf.skins),o.Assign(this._gltf.textures),this._gltf.nodes){const K={};for(const T of this._gltf.nodes)if(T.children)for(const A of T.children)K[A]=T.index;const A=this._createRootNode();for(const T of this._gltf.nodes){const G=K[T.index];T.parent=void 0===G?A:this._gltf.nodes[G]}}}async _loadExtensionsAsync(){const K=[];if(k.forEach(((A,T)=>{var G;!1===(null===(G=this.parent.extensionOptions[T])||void 0===G?void 0:G.enabled)?A.isGLTFExtension&&this.isExtensionUsed(T)&&P.d.Warn(`Extension ${T} is used but has been explicitly disabled.`):A.isGLTFExtension&&!this.isExtensionUsed(T)||K.push((async()=>{const K=await A.factory(this);return K.name!==T&&P.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${K.name} !== ${T}`),this._parent.onExtensionLoadedObservable.notifyObservers(K),K})())})),this._extensions.push(...await Promise.all(K)),this._extensions.sort(((K,A)=>(K.order||Number.MAX_VALUE)-(A.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const T of this._gltf.extensionsRequired){if(!this._extensions.some((K=>K.name===T&&K.enabled))){var A;if(!1===(null===(A=this.parent.extensionOptions[T])||void 0===A?void 0:A.enabled))throw new Error(`Required extension ${T} is disabled`);throw new Error(`Required extension ${T} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new l.e("__root__",this._babylonScene);this._rootBabylonMesh=K,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.QC(!1);const A={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case e.k.AUTO:this._babylonScene.useRightHandedSystem||(A.rotation=[0,1,0,0],A.scale=[1,1,-1],i._LoadTransform(A,this._rootBabylonMesh));break;case e.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(K),A}loadSceneAsync(K,A){const T=this._extensionsLoadSceneAsync(K,A);if(T)return T;const G=new Array;if(this.logOpen(`${K} ${A.name||""}`),A.nodes)for(const B of A.nodes){const A=o.Get(`${K}/nodes/${B}`,this._gltf.nodes,B);G.push(this.loadNodeAsync(`/nodes/${A.index}`,A,(K=>{K.parent=this._rootBabylonMesh})))}for(const B of this._postSceneLoadActions)B();return G.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(G).then((()=>{}))}_forEachPrimitive(K,A){if(K._primitiveBabylonMeshes)for(const T of K._primitiveBabylonMeshes)A(T)}_getGeometries(){const K=[],A=this._gltf.nodes;if(A)for(const T of A)this._forEachPrimitive(T,(A=>{const T=A.Mf;T&&-1===K.indexOf(T)&&K.push(T)}));return K}_getMeshes(){const K=[];this._rootBabylonMesh instanceof S.e&&K.push(this._rootBabylonMesh);const A=this._gltf.nodes;if(A)for(const T of A)this._forEachPrimitive(T,(A=>{K.push(A)}));return K}_getTransformNodes(){const K=[],A=this._gltf.nodes;if(A)for(const T of A)T._babylonTransformNode&&"nx"===T._babylonTransformNode.getClassName()&&K.push(T._babylonTransformNode),T._babylonTransformNodeForSkin&&K.push(T._babylonTransformNodeForSkin);return K}_getSkeletons(){const K=[],A=this._gltf.skins;if(A)for(const T of A)T._data&&K.push(T._data.babylonSkeleton);return K}_getAnimationGroups(){const K=[],A=this._gltf.animations;if(A)for(const T of A)T._babylonAnimationGroup&&K.push(T._babylonAnimationGroup);return K}_startAnimations(){switch(this._parent.animationStartMode){case e.h.NONE:break;case e.h.FIRST:{const K=this._getAnimationGroups();0!==K.length&&K[0].start(!0);break}case e.h.ALL:{const K=this._getAnimationGroups();for(const A of K)A.start(!0);break}default:return void P.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadNodeAsync(K,A,T);if(G)return G;if(A._babylonTransformNode)throw new Error(`${K}: Invalid recursive node hierarchy`);const B=new Array;this.logOpen(`${K} ${A.name||""}`);const L=G=>{if(i.AddPointerMetadata(G,K),i._LoadTransform(A,G),void 0!=A.camera){const T=o.Get(`${K}/camera`,this._gltf.cameras,A.camera);B.push(this.loadCameraAsync(`/cameras/${T.index}`,T,(K=>{K.parent=G,this._babylonScene.useRightHandedSystem||(G.vO.x=-1)})))}if(A.children)for(const T of A.children){const A=o.Get(`${K}/children/${T}`,this._gltf.nodes,T);B.push(this.loadNodeAsync(`/nodes/${A.index}`,A,(K=>{K.parent=G})))}T(G)},f=void 0!=A.mesh,O=this._parent.loadSkins&&void 0!=A.skin;if(!f||O){const K=A.name||`node${A.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new U.b(K,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==A.mesh?A._babylonTransformNode=T:A._babylonTransformNodeForSkin=T,L(T)}if(f)if(O){const T=o.Get(`${K}/mesh`,this._gltf.meshes,A.mesh);B.push(this._loadMeshAsync(`/meshes/${T.index}`,A,T,(T=>{const G=A._babylonTransformNodeForSkin;T.metadata=(0,v.e)(G.metadata,T.metadata||{});const L=o.Get(`${K}/skin`,this._gltf.skins,A.skin);B.push(this._loadSkinAsync(`/skins/${L.index}`,A,L,(K=>{this._forEachPrimitive(A,(A=>{A.skeleton=K})),this._postSceneLoadActions.push((()=>{if(void 0!=L.skeleton){const K=o.Get(`/skins/${L.index}/skeleton`,this._gltf.nodes,L.skeleton).parent;A.index===K.index?T.parent=G.parent:T.parent=K._babylonTransformNode}else T.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:G,skinnedNode:T})}))})))})))}else{const T=o.Get(`${K}/mesh`,this._gltf.meshes,A.mesh);B.push(this._loadMeshAsync(`/meshes/${T.index}`,A,T,L))}return this.logClose(),Promise.all(B).then((()=>(this._forEachPrimitive(A,(K=>{const A=K;!A.isAnInstance&&A.Mf&&A.Mf.useBoundingInfoFromGeometry?K.hK():K.refreshBoundingInfo(!0,!0)})),A._babylonTransformNode)))}_loadMeshAsync(K,A,T,G){const B=T.primitives;if(!B||!B.length)throw new Error(`${K}: Primitives are missing`);void 0==B[0].index&&o.Assign(B);const L=new Array;this.logOpen(`${K} ${T.name||""}`);const f=A.name||`node${A.index}`;if(1===B.length){const G=T.primitives[0];L.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${G.index}`,f,A,T,G,(K=>{A._babylonTransformNode=K,A._primitiveBabylonMeshes=[K]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,A._babylonTransformNode=new U.b(f,this._babylonScene),A._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._primitiveBabylonMeshes=[];for(const G of B)L.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${G.index}`,`${f}_primitive${G.index}`,A,T,G,(K=>{K.parent=A._babylonTransformNode,A._primitiveBabylonMeshes.push(K)})))}return G(A._babylonTransformNode),this.logClose(),Promise.all(L).then((()=>A._babylonTransformNode))}_loadMeshPrimitiveAsync(K,A,T,G,B,L){const f=this._extensionsLoadMeshPrimitiveAsync(K,A,T,G,B,L);if(f)return f;this.logOpen(`${K}`);const O=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==T.skin&&!G.primitives[0].targets;let C,Q;if(O&&B._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=B._instanceData.babylonSourceMesh.createInstance(A),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q=B._instanceData.promise;else{const L=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new l.e(A,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.sideOrientation=this._babylonScene.useRightHandedSystem?N.e.CounterClockWiseSideOrientation:N.e.ClockWiseSideOrientation,this._createMorphTargets(K,T,G,B,f),L.push(this._loadVertexDataAsync(K,B,f).then((async A=>await this._loadMorphTargetsAsync(K,B,f,A).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,A.pK(f),A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Y=i._GetDrawMode(K,B.mode);if(void 0==B.material){let K=this._defaultBabylonMaterialData[Y];K||(K=this._createDefaultMaterial("__GLTFLoader._default",Y),this._parent.onMaterialLoadedObservable.notifyObservers(K),this._defaultBabylonMaterialData[Y]=K),f.material=K}else if(!this.parent.skipMaterials){const A=o.Get(`${K}/material`,this._gltf.materials,B.material);L.push(this._loadMaterialAsync(`/materials/${A.index}`,A,f,Y,(K=>{f.material=K})))}Q=Promise.all(L),O&&(B._instanceData={babylonSourceMesh:f,promise:Q}),C=f}return i.AddPointerMetadata(C,K),this._parent.onMeshLoadedObservable.notifyObservers(C),L(C),this.logClose(),Q.then((()=>C))}_loadVertexDataAsync(K,A,T){const G=this._extensionsLoadVertexDataAsync(K,A,T);if(G)return G;const B=A.attributes;if(!B)throw new Error(`${K}: Attributes are missing`);const L=new Array,f=new g.b(T.name,this._babylonScene);if(void 0==A.indices)T.isUnIndexed=!0;else{const T=o.Get(`${K}/indices`,this._gltf.accessors,A.indices);L.push(this._loadIndicesAccessorAsync(`/accessors/${T.index}`,T).then((K=>{f.setIndices(K)})))}const O=(A,G,O)=>{if(void 0==B[A])return;T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(G)&&T._delayInfo.push(G);const C=o.Get(`${K}/attributes/${A}`,this._gltf.accessors,B[A]);L.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,G).then((K=>{if(K.getKind()===z.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!T.skeleton){const K=W(C);K&&(f._boundingInfo=K,f.useBoundingInfoFromGeometry=!0)}f.setVerticesBuffer(K,C.count)}))),G==z.d.MatricesIndicesExtraKind&&(T.numBoneInfluencers=8),O&&O(C)};return O("POSITION",z.d.PositionKind),O("NORMAL",z.d.NormalKind),O("TANGENT",z.d.TangentKind),O("TEXCOORD_0",z.d.UVKind),O("TEXCOORD_1",z.d.UV2Kind),O("TEXCOORD_2",z.d.UV3Kind),O("TEXCOORD_3",z.d.UV4Kind),O("TEXCOORD_4",z.d.UV5Kind),O("TEXCOORD_5",z.d.UV6Kind),O("JOINTS_0",z.d.MatricesIndicesKind),O("WEIGHTS_0",z.d.MatricesWeightsKind),O("JOINTS_1",z.d.MatricesIndicesExtraKind),O("WEIGHTS_1",z.d.MatricesWeightsExtraKind),O("COLOR_0",z.d.ColorKind,(K=>{"VEC4"===K.type&&(T.hasVertexAlpha=!0)})),Promise.all(L).then((()=>f))}_createMorphTargets(K,A,T,G,B){if(!G.targets||!this._parent.loadMorphTargets)return;if(void 0==A._numMorphTargets)A._numMorphTargets=G.targets.length;else if(G.targets.length!==A._numMorphTargets)throw new Error(`${K}: Primitives do not have the same number of targets`);const L=T.extras?T.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,B.morphTargetManager=new H(this._babylonScene),B.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.morphTargetManager.areUpdatesFrozen=!0;for(let f=0;f<G.targets.length;f++){const K=A.weights?A.weights[f]:T.weights?T.weights[f]:0,G=L?L[f]:`morphTarget${f}`;B.morphTargetManager.addTarget(new u.d(G,K,B.SK()))}}_loadMorphTargetsAsync(K,A,T,G){if(!A.targets||!this._parent.loadMorphTargets)return Promise.resolve();const B=new Array,L=T.morphTargetManager;for(let f=0;f<L.numTargets;f++){const T=L.getTarget(f);B.push(this._loadMorphTargetVertexDataAsync(`${K}/targets/${f}`,G,A.targets[f],T))}return Promise.all(B).then((()=>{L.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(K,A,T,G){const B=new Array,L=(G,L,f)=>{if(void 0==T[G])return;const O=A.getVertexBuffer(L);if(!O)return;const C=o.Get(`${K}/${G}`,this._gltf.accessors,T[G]);B.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((K=>{f(O,K)})))};return L("POSITION",z.d.PositionKind,((K,A)=>{const T=new Float32Array(A.length);K.forEach(A.length,((K,G)=>{T[G]=A[G]+K})),G.setPositions(T)})),L("NORMAL",z.d.NormalKind,((K,A)=>{const T=new Float32Array(A.length);K.forEach(T.length,((K,G)=>{T[G]=A[G]+K})),G.setNormals(T)})),L("TANGENT",z.d.TangentKind,((K,A)=>{const T=new Float32Array(A.length/3*4);let B=0;K.forEach(A.length/3*4,((K,G)=>{(G+1)%4!==0&&(T[B]=A[B]+K,B++)})),G.setTangents(T)})),L("TEXCOORD_0",z.d.UVKind,((K,A)=>{const T=new Float32Array(A.length);K.forEach(A.length,((K,G)=>{T[G]=A[G]+K})),G.setUVs(T)})),L("TEXCOORD_1",z.d.UV2Kind,((K,A)=>{const T=new Float32Array(A.length);K.forEach(A.length,((K,G)=>{T[G]=A[G]+K})),G.setUV2s(T)})),L("COLOR_0",z.d.ColorKind,((A,T)=>{let B=null;const L=A.getSize();if(3===L){B=new Float32Array(T.length/3*4),A.forEach(T.length,((K,A)=>{const G=Math.floor(A/3),L=A%3;B[4*G+L]=T[3*G+L]+K}));for(let K=0;K<T.length/3;++K)B[4*K+3]=1}else{if(4!==L)throw new Error(`${K}: Invalid number of components (${L}) for COLOR_0 attribute`);B=new Float32Array(T.length),A.forEach(T.length,((K,A)=>{B[A]=T[A]+K}))}G.setColors(B)})),await Promise.all(B).then((()=>{}))}static _LoadTransform(K,A){if(void 0!=K.skin)return;let T=B.PA.Zero(),G=B.Quaternion.Identity(),L=B.PA.One();if(K.matrix){B.Matrix.mT(K.matrix).decompose(L,G,T)}else K.translation&&(T=B.PA.mT(K.translation)),K.rotation&&(G=B.Quaternion.mT(K.rotation)),K.scale&&(L=B.PA.mT(K.scale));A.position=T,A.rotationQuaternion=G,A.vO=L}_loadSkinAsync(K,A,T,G){if(!this._parent.loadSkins)return Promise.resolve();const B=this._extensionsLoadSkinAsync(K,A,T);if(B)return B;if(T._data)return G(T._data.babylonSkeleton),T._data.promise;const L=`skeleton${T.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new d(T.name||L,L,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(K,T,f);const O=this._loadSkinInverseBindMatricesDataAsync(K,T).then((K=>{this._updateBoneMatrices(f,K)}));return T._data={babylonSkeleton:f,promise:O},G(f),O}_loadBones(K,A,T){if(void 0==A.skeleton||this._parent.alwaysComputeSkeletonRootNode){const T=this._findSkeletonRootNode(`${K}/joints`,A.joints);if(T)if(void 0===A.skeleton)A.skeleton=T.index;else{const G=(K,A)=>{for(;A.parent;A=A.parent)if(A.parent===K)return!0;return!1},B=o.Get(`${K}/skeleton`,this._gltf.nodes,A.skeleton);B===T||G(B,T)||(P.d.Warn(`${K}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),A.skeleton=T.index)}else P.d.Warn(`${K}: Failed to find common root`)}const G={};for(const B of A.joints){const L=o.Get(`${K}/joints/${B}`,this._gltf.nodes,B);this._loadBone(L,A,T,G)}}_findSkeletonRootNode(K,A){if(0===A.length)return null;const T={};for(const B of A){const A=[];let G=o.Get(`${K}/${B}`,this._gltf.nodes,B);for(;-1!==G.index;)A.unshift(G),G=G.parent;T[B]=A}let G=null;for(let B=0;;++B){let K=T[A[0]];if(B>=K.length)return G;const L=K[B];for(let f=1;f<A.length;++f)if(K=T[A[f]],B>=K.length||L!==K[B])return G;G=L}}_loadBone(K,A,T,G){K._isJoint=!0;let B=G[K.index];if(B)return B;let L=null;K.index!==A.skeleton&&(K.parent&&-1!==K.parent.index?L=this._loadBone(K.parent,A,T,G):void 0!==A.skeleton&&P.d.Warn(`/skins/${A.index}/skeleton: Skeleton node is not a common root`));const f=A.joints.indexOf(K.index);return B=new Q.b(K.name||`joint${K.index}`,T,L,this._getNodeMatrix(K),null,null,f),G[K.index]=B,this._postSceneLoadActions.push((()=>{B.linkTransformNode(K._babylonTransformNode)})),B}_loadSkinInverseBindMatricesDataAsync(K,A){if(void 0==A.inverseBindMatrices)return Promise.resolve(null);const T=o.Get(`${K}/inverseBindMatrices`,this._gltf.accessors,A.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)}_updateBoneMatrices(K,A){for(const T of K.bones){const K=B.Matrix.Identity(),G=T._index;A&&-1!==G&&(B.Matrix.FromArrayToRef(A,16*G,K),K.invertToRef(K));const L=T.getParent();L&&K.multiplyToRef(L.getAbsoluteInverseBindMatrix(),K),T.Xf(K,!1,!1),T._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(K){return K.matrix?B.Matrix.mT(K.matrix):B.Matrix.Compose(K.scale?B.PA.mT(K.scale):B.PA.One(),K.rotation?B.Quaternion.mT(K.rotation):B.Quaternion.Identity(),K.translation?B.PA.mT(K.translation):B.PA.Zero())}loadCameraAsync(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadCameraAsync(K,A,T);if(G)return G;const L=new Array;this.logOpen(`${K} ${A.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new C.d(A.name||`camera${A.index}`,B.PA.Zero(),this._babylonScene,!1);switch(f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._babylonCamera=f,f.setTarget(new B.PA(0,0,-1)),A.type){case"perspective":{const T=A.perspective;if(!T)throw new Error(`${K}: Camera perspective properties are missing`);f.fov=T.yfov,f.If=T.znear,f.maxZ=T.zfar||0;break}case"orthographic":if(!A.orthographic)throw new Error(`${K}: Camera orthographic properties are missing`);f.mode=O.e.ORTHOGRAPHIC_CAMERA,f.orthoLeft=-A.orthographic.xmag,f.orthoRight=A.orthographic.xmag,f.orthoBottom=-A.orthographic.ymag,f.orthoTop=A.orthographic.ymag,f.If=A.orthographic.znear,f.maxZ=A.orthographic.zfar;break;default:throw new Error(`${K}: Invalid camera type (${A.type})`)}return i.AddPointerMetadata(f,K),this._parent.onCameraLoadedObservable.notifyObservers(f),T(f),this.logClose(),Promise.all(L).then((()=>f))}_loadAnimationsAsync(){const K=this._gltf.animations;if(!K)return Promise.resolve();const A=new Array;for(let T=0;T<K.length;T++){const G=K[T];A.push(this.loadAnimationAsync(`/animations/${G.index}`,G).then((K=>{0===K.targetedAnimations.length&&K.dispose()})))}return Promise.all(A).then((()=>{}))}loadAnimationAsync(K,A){const G=this._extensionsLoadAnimationAsync(K,A);return G||T.e(78).then(T.bind(T,15827)).then((T=>{let{AnimationGroup:G}=T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new G(A.name||`animation${A.index}`,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._babylonAnimationGroup=B;const L=new Array;o.Assign(A.channels),o.Assign(A.samplers);for(const f of A.channels)L.push(this._loadAnimationChannelAsync(`${K}/channels/${f.index}`,K,A,f,((K,A)=>{K.animations=K.animations||[],K.animations.push(A),B.addTargetedAnimation(A,K)})));return Promise.all(L).then((()=>(B.normalize(0),B)))}))}async _loadAnimationChannelAsync(K,A,G,B,L){const f=this._extensionsLoadAnimationChannelAsync(K,A,G,B,L);if(f)return await f;if(void 0==B.target.node)return await Promise.resolve();const O=o.Get(`${K}/target/node`,this._gltf.nodes,B.target.node),C=B.target.path,Q="weights"===C;if(Q&&!O._numMorphTargets||!Q&&!O._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!Q&&!O._isJoint)return await Promise.resolve();let Y;switch(await Promise.resolve().then(T.bind(T,14175)),C){case"translation":var Z;Y=null===(Z=(0,R.e)("/nodes/{}/translation"))||void 0===Z?void 0:Z.interpolation;break;case"rotation":var x;Y=null===(x=(0,R.e)("/nodes/{}/rotation"))||void 0===x?void 0:x.interpolation;break;case"scale":var J;Y=null===(J=(0,R.e)("/nodes/{}/scale"))||void 0===J?void 0:J.interpolation;break;case"weights":var b;Y=null===(b=(0,R.e)("/nodes/{}/weights"))||void 0===b?void 0:b.interpolation;break;default:throw new Error(`${K}/target/path: Invalid value (${B.target.path})`)}if(!Y)throw new Error(`${K}/target/path: Could not find interpolation properties for target path (${B.target.path})`);const P={object:O,info:Y};return await this._loadAnimationChannelFromTargetInfoAsync(K,A,G,B,P,L)}_loadAnimationChannelFromTargetInfoAsync(K,A,T,G,B,L){const f=this.parent.targetFps,O=1/f,C=o.Get(`${K}/sampler`,T.samplers,G.sampler);return this._loadAnimationSamplerAsync(`${A}/samplers/${G.sampler}`,C).then((K=>{let A=0;const C=B.object,Q=B.info;for(const B of Q){const Q=B.getStride(C),Y=K.input,Z=K.output,x=new Array(Y.length);let J=0;switch(K.interpolation){case"STEP":for(let K=0;K<Y.length;K++){const A=B.getValue(C,Z,J,1);J+=Q,x[K]={frame:Y[K]*f,value:A,interpolation:1}}break;case"CUBICSPLINE":for(let K=0;K<Y.length;K++){const A=B.getValue(C,Z,J,O);J+=Q;const T=B.getValue(C,Z,J,1);J+=Q;const G=B.getValue(C,Z,J,O);J+=Q,x[K]={frame:Y[K]*f,inTangent:A,value:T,outTangent:G}}break;case"LINEAR":for(let K=0;K<Y.length;K++){const A=B.getValue(C,Z,J,1);J+=Q,x[K]={frame:Y[K]*f,value:A}}}if(J>0){const K=`${T.name||`animation${T.index}`}_channel${G.index}_${A}`,O=B.buildAnimations(C,K,f,x);for(const T of O)A++,L(T.babylonAnimatable,T.babylonAnimation)}}}))}_loadAnimationSamplerAsync(K,A){if(A._data)return A._data;const T=A.interpolation||"LINEAR";switch(T){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${K}/interpolation: Invalid value (${A.interpolation})`)}const G=o.Get(`${K}/input`,this._gltf.accessors,A.input),B=o.Get(`${K}/output`,this._gltf.accessors,A.output);return A._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${G.index}`,G),this._loadFloatAccessorAsync(`/accessors/${B.index}`,B)]).then((K=>{let[A,G]=K;return{input:A,interpolation:T,output:G}})),A._data}loadBufferAsync(K,A,T,G){const B=this._extensionsLoadBufferAsync(K,A,T,G);if(B)return B;if(!A._data)if(A.uri)A._data=this.loadUriAsync(`${K}/uri`,A,A.uri);else{if(!this._bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);A._data=this._bin.readAsync(0,A.byteLength)}return A._data.then((A=>{try{return new Uint8Array(A.buffer,A.byteOffset+T,G)}catch(B){throw new Error(`${K}: ${B.message}`)}}))}loadBufferViewAsync(K,A){const T=this._extensionsLoadBufferViewAsync(K,A);if(T)return T;if(A._data)return A._data;const G=o.Get(`${K}/buffer`,this._gltf.buffers,A.buffer);return A._data=this.loadBufferAsync(`/buffers/${G.index}`,G,A.byteOffset||0,A.byteLength),A._data}_loadAccessorAsync(K,A,T){if(A._data)return A._data;const G=i._GetNumComponents(K,A.type),B=G*z.d.GetTypeByteLength(A.componentType),L=G*A.count;if(void 0==A.bufferView)A._data=Promise.resolve(new T(L));else{const f=o.Get(`${K}/bufferView`,this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((O=>{if(5126!==A.componentType||A.normalized||f.byteStride&&f.byteStride!==B){const K=new T(L);return z.d.ForEach(O,A.byteOffset||0,f.byteStride||B,G,A.componentType,K.length,A.normalized||!1,((A,T)=>{K[T]=A})),K}return i._GetTypedArray(K,A.componentType,O,A.byteOffset,L)}))}if(A.sparse){const L=A.sparse;A._data=A._data.then((f=>{const O=f,C=o.Get(`${K}/sparse/indices/bufferView`,this._gltf.bufferViews,L.indices.bufferView),Q=o.Get(`${K}/sparse/values/bufferView`,this._gltf.bufferViews,L.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)]).then((f=>{let[C,Q]=f;const Y=i._GetTypedArray(`${K}/sparse/indices`,L.indices.componentType,C,L.indices.byteOffset,L.count),Z=G*L.count;let x;if(5126!==A.componentType||A.normalized){const f=i._GetTypedArray(`${K}/sparse/values`,A.componentType,Q,L.values.byteOffset,Z);x=new T(Z),z.d.ForEach(f,0,B,G,A.componentType,x.length,A.normalized||!1,((K,A)=>{x[A]=K}))}else x=i._GetTypedArray(`${K}/sparse/values`,A.componentType,Q,L.values.byteOffset,Z);let J=0;for(let K=0;K<Y.length;K++){let A=Y[K]*G;for(let K=0;K<G;K++)O[A++]=x[J++]}return O}))}))}return A._data}_loadFloatAccessorAsync(K,A){return this._loadAccessorAsync(K,A,Float32Array)}_loadIndicesAccessorAsync(K,A){if("SCALAR"!==A.type)throw new Error(`${K}/type: Invalid value ${A.type}`);if(5121!==A.componentType&&5123!==A.componentType&&5125!==A.componentType)throw new Error(`${K}/componentType: Invalid value ${A.componentType}`);if(A._data)return A._data;if(A.sparse){const T=i._GetTypedArrayConstructor(`${K}/componentType`,A.componentType);A._data=this._loadAccessorAsync(K,A,T)}else{const T=o.Get(`${K}/bufferView`,this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((T=>i._GetTypedArray(K,A.componentType,T,A.byteOffset,A.count)))}return A._data}_loadVertexBufferViewAsync(K){if(K._babylonBuffer)return K._babylonBuffer;const A=this._babylonScene.getEngine();return K._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>new z.b(A,K,!1))),K._babylonBuffer}_loadVertexAccessorAsync(K,A,T){var G;if(null!==(G=A._babylonVertexBuffer)&&void 0!==G&&G[T])return A._babylonVertexBuffer[T];A._babylonVertexBuffer||(A._babylonVertexBuffer={});const B=this._babylonScene.getEngine();if(A.sparse||void 0==A.bufferView)A._babylonVertexBuffer[T]=this._loadFloatAccessorAsync(K,A).then((K=>new z.d(B,K,T,!1)));else{const G=o.Get(`${K}/bufferView`,this._gltf.bufferViews,A.bufferView);A._babylonVertexBuffer[T]=this._loadVertexBufferViewAsync(G).then((L=>{const f=i._GetNumComponents(K,A.type);return new z.d(B,L,T,!1,void 0,G.byteStride,void 0,A.byteOffset,f,A.componentType,A.normalized,!0,void 0,!0)}))}return A._babylonVertexBuffer[T]}_loadMaterialMetallicRoughnessPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return A&&(A.baseColorFactor?(T.albedoColor=L.DA.mT(A.baseColorFactor),T.alpha=A.baseColorFactor[3]):T.albedoColor=L.DA.White(),T.metallic=void 0==A.metallicFactor?1:A.metallicFactor,T.roughness=void 0==A.roughnessFactor?1:A.roughnessFactor,A.baseColorTexture&&G.push(this.loadTextureInfoAsync(`${K}/baseColorTexture`,A.baseColorTexture,(K=>{K.name=`${T.name} (Base Color)`,T.albedoTexture=K}))),A.metallicRoughnessTexture&&(A.metallicRoughnessTexture.nonColorData=!0,G.push(this.loadTextureInfoAsync(`${K}/metallicRoughnessTexture`,A.metallicRoughnessTexture,(K=>{K.name=`${T.name} (Metallic Roughness)`,T.metallicTexture=K}))),T.useMetallnessFromMetallicTextureBlue=!0,T.useRoughnessFromMetallicTextureGreen=!0,T.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(G).then((()=>{}))}_loadMaterialAsync(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const L=this._extensionsLoadMaterialAsync(K,A,T,G,B);if(L)return L;A._data=A._data||{};let f=A._data[G];if(!f){this.logOpen(`${K} ${A.name||""}`);const T=this.createMaterial(K,A,G);f={babylonMaterial:T,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(K,A,T)},A._data[G]=f,i.AddPointerMetadata(T,K),this._parent.onMaterialLoadedObservable.notifyObservers(T),this.logClose()}return T&&(f.babylonMeshes.push(T),T.Ff.addOnce((()=>{const K=f.babylonMeshes.indexOf(T);-1!==K&&f.babylonMeshes.splice(K,1)}))),B(f.babylonMaterial),f.promise.then((()=>f.babylonMaterial))}_createDefaultMaterial(K,A){this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new D.c(K,this._babylonScene);return T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.fillMode=A,T.enableSpecularAntiAliasing=!0,T.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,T.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,T.transparencyMode=D.c.PBRMATERIAL_OPAQUE,T.metallic=1,T.roughness=1,T}createMaterial(K,A,T){const G=this._extensionsCreateMaterial(K,A,T);if(G)return G;const B=A.name||`material${A.index}`;return this._createDefaultMaterial(B,T)}loadMaterialPropertiesAsync(K,A,T){const G=this._extensionsLoadMaterialPropertiesAsync(K,A,T);if(G)return G;const B=new Array;return B.push(this.loadMaterialBasePropertiesAsync(K,A,T)),A.pbrMetallicRoughness&&B.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${K}/pbrMetallicRoughness`,A.pbrMetallicRoughness,T)),this.loadMaterialAlphaProperties(K,A,T),Promise.all(B).then((()=>{}))}loadMaterialBasePropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return T.emissiveColor=A.emissiveFactor?L.DA.mT(A.emissiveFactor):new L.DA(0,0,0),A.doubleSided&&(T.tf=!1,T.twoSidedLighting=!0),A.normalTexture&&(A.normalTexture.nonColorData=!0,G.push(this.loadTextureInfoAsync(`${K}/normalTexture`,A.normalTexture,(K=>{K.name=`${T.name} (Normal)`,T.bumpTexture=K}))),T.invertNormalMapX=!this._babylonScene.useRightHandedSystem,T.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=A.normalTexture.scale&&T.bumpTexture&&(T.bumpTexture.level=A.normalTexture.scale),T.forceIrradianceInFragment=!0),A.occlusionTexture&&(A.occlusionTexture.nonColorData=!0,G.push(this.loadTextureInfoAsync(`${K}/occlusionTexture`,A.occlusionTexture,(K=>{K.name=`${T.name} (Occlusion)`,T.ambientTexture=K}))),T.useAmbientInGrayScale=!0,void 0!=A.occlusionTexture.strength&&(T.ambientTextureStrength=A.occlusionTexture.strength)),A.emissiveTexture&&G.push(this.loadTextureInfoAsync(`${K}/emissiveTexture`,A.emissiveTexture,(K=>{K.name=`${T.name} (Emissive)`,T.emissiveTexture=K}))),Promise.all(G).then((()=>{}))}loadMaterialAlphaProperties(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);switch(A.alphaMode||"OPAQUE"){case"OPAQUE":T.transparencyMode=D.c.PBRMATERIAL_OPAQUE,T.alpha=1;break;case"MASK":T.transparencyMode=D.c.PBRMATERIAL_ALPHATEST,T.alphaCutOff=void 0==A.alphaCutoff?.5:A.alphaCutoff,T.albedoTexture&&(T.albedoTexture.sf=!0);break;case"BLEND":T.transparencyMode=D.c.PBRMATERIAL_ALPHABLEND,T.albedoTexture&&(T.albedoTexture.sf=!0,T.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${K}/alphaMode: Invalid value (${A.alphaMode})`)}}loadTextureInfoAsync(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadTextureInfoAsync(K,A,T);if(G)return G;if(this.logOpen(`${K}`),A.texCoord>=6)throw new Error(`${K}/texCoord: Invalid value (${A.texCoord})`);const B=o.Get(`${K}/index`,this._gltf.textures,A.index);B._textureInfo=A;const L=this._loadTextureAsync(`/textures/${A.index}`,B,(G=>{G.coordinatesIndex=A.texCoord||0,i.AddPointerMetadata(G,K),this._parent.onTextureLoadedObservable.notifyObservers(G),T(G)}));return this.logClose(),L}_loadTextureAsync(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadTextureAsync(K,A,T);if(G)return G;this.logOpen(`${K} ${A.name||""}`);const B=void 0==A.sampler?i.DefaultSampler:o.Get(`${K}/sampler`,this._gltf.samplers,A.sampler),L=o.Get(`${K}/source`,this._gltf.images,A.source),f=this._createTextureAsync(K,B,L,T,void 0,!A._textureInfo.nonColorData);return this.logClose(),f}_createTextureAsync(K,A,T){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},L=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0;const O=this._loadSampler(`/samplers/${A.index}`,A),C=new Array,Q=new G;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y={noMipmap:O.noMipMaps,invertY:!1,samplingMode:O.samplingMode,q:()=>{this._disposed||Q.resolve()},onError:(A,T)=>{this._disposed||Q.reject(new Error(`${K}: ${T&&T.message?T.message:A||"Failed to load texture"}`))},mimeType:T.mimeType??(0,p.i)(T.uri??""),loaderOptions:L,useSRGBBuffer:!!f&&this._parent.useSRGBBuffers},Z=new mK.c(null,this._babylonScene,Y);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(Q.promise),C.push(this.loadImageAsync(`/images/${T.index}`,T).then((K=>{const A=T.uri||`${this._fileName}#image${T.index}`,G=`data:${this._uniqueRootUrl}${A}`;Z.updateURL(G,K);const B=Z.getInternalTexture();B&&(B.label=T.name)}))),Z.wrapU=O.wrapU,Z.wrapV=O.wrapV,B(Z),this._parent.useGltfTextureNames&&(Z.name=T.name||T.uri||`image${T.index}`),Promise.all(C).then((()=>Z))}_loadSampler(K,A){return A._data||(A._data={noMipMaps:9728===A.minFilter||9729===A.minFilter,samplingMode:i._GetTextureSamplingMode(K,A),wrapU:i._GetTextureWrapMode(`${K}/wrapS`,A.wrapS),wrapV:i._GetTextureWrapMode(`${K}/wrapT`,A.wrapT)}),A._data}loadImageAsync(K,A){if(!A._data){if(this.logOpen(`${K} ${A.name||""}`),A.uri)A._data=this.loadUriAsync(`${K}/uri`,A,A.uri);else{const T=o.Get(`${K}/bufferView`,this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}this.logClose()}return A._data}loadUriAsync(K,A,T){const G=this._extensionsLoadUriAsync(K,A,T);if(G)return G;if(!i._ValidateUri(T))throw new Error(`${K}: '${T}' is invalid`);if((0,p.m)(T)){const A=new Uint8Array((0,p.d)(T));return this.log(`${K}: Decoded ${T.substring(0,64)}... (${A.length} bytes)`),Promise.resolve(A)}return this.log(`${K}: Loading ${T}`),this._parent.preprocessUrlAsync(this._rootUrl+T).then((A=>new Promise(((G,B)=>{this._parent._loadFile(this._babylonScene,A,(A=>{this._disposed||(this.log(`${K}: Loaded ${T} (${A.byteLength} bytes)`),G(new Uint8Array(A)))}),!0,(A=>{B(new p.p(`${K}: Failed to load '${T}'${A?": "+A.status+" "+A.statusText:""}`,A))}))}))))}static AddPointerMetadata(K,A){K.metadata=K.metadata||{};const T=K._internalMetadata=K._internalMetadata||{},G=T.Sf=T.Sf||{};(G.pointers=G.pointers||[]).push(A)}static _GetTextureWrapMode(K,A){switch(A=void 0==A?10497:A){case 33071:return mK.c.CLAMP_ADDRESSMODE;case 33648:return mK.c.MIRROR_ADDRESSMODE;case 10497:return mK.c.WRAP_ADDRESSMODE;default:return P.d.Warn(`${K}: Invalid value (${A})`),mK.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(K,A){const T=void 0==A.magFilter?9729:A.magFilter,G=void 0==A.minFilter?9987:A.minFilter;if(9729===T)switch(G){case 9728:return mK.c.LINEAR_NEAREST;case 9729:return mK.c.LINEAR_LINEAR;case 9984:return mK.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return mK.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return mK.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return mK.c.LINEAR_LINEAR_MIPLINEAR;default:return P.d.Warn(`${K}/minFilter: Invalid value (${G})`),mK.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==T&&P.d.Warn(`${K}/magFilter: Invalid value (${T})`),G){case 9728:return mK.c.NEAREST_NEAREST;case 9729:return mK.c.NEAREST_LINEAR;case 9984:return mK.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return mK.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return mK.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return mK.c.NEAREST_LINEAR_MIPLINEAR;default:return P.d.Warn(`${K}/minFilter: Invalid value (${G})`),mK.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(K,A){try{return(0,I.q)(A)}catch(T){throw new Error(`${K}: ${T.message}`)}}static _GetTypedArray(K,A,T,G,B){const L=T.buffer;G=T.byteOffset+(G||0);const f=i._GetTypedArrayConstructor(`${K}/componentType`,A),O=z.d.GetTypeByteLength(A);return G%O!==0?(P.d.Warn(`${K}: Copying buffer as byte offset (${G}) is not a multiple of component type byte length (${O})`),new f(L.slice(G,G+B*O),0)):new f(L,G,B)}static _GetNumComponents(K,A){switch(A){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${K}: Invalid type (${A})`)}static _ValidateUri(K){return f.Tools.IsBase64(K)||-1===K.indexOf("..")}static _GetDrawMode(K,A){switch(void 0==A&&(A=4),A){case 0:return N.e.PointListDrawMode;case 1:return N.e.LineListDrawMode;case 2:return N.e.LineLoopDrawMode;case 3:return N.e.LineStripDrawMode;case 4:return N.e.TriangleFillMode;case 5:return N.e.TriangleStripDrawMode;case 6:return N.e.TriangleFanDrawMode}throw new Error(`${K}: Invalid mesh primitive mode (${A})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const K=new Array;if(this._gltf.materials)for(const A of this._gltf.materials)if(A._data)for(const T in A._data){const G=A._data[T];for(const A of G.babylonMeshes){A.wf(!0);const T=G.babylonMaterial;K.push(T.forceCompilationAsync(A)),K.push(T.forceCompilationAsync(A,{useInstances:!0})),this._parent.useClipPlane&&(K.push(T.forceCompilationAsync(A,{clipPlane:!0})),K.push(T.forceCompilationAsync(A,{clipPlane:!0,useInstances:!0})))}}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const K=new Array,A=this._babylonScene.lights;for(const T of A){const A=T.getShadowGenerator();A&&K.push(A.forceCompilationAsync())}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(K){for(const A of this._extensions)A.enabled&&K(A)}_applyExtensions(K,A,T){for(const G of this._extensions)if(G.enabled){const B=`${G.name}.${A}`,L=K;L._activeLoaderExtensionFunctions=L._activeLoaderExtensionFunctions||{};const f=L._activeLoaderExtensionFunctions;if(!f[B]){f[B]=!0;try{const K=T(G);if(K)return K}finally{delete f[B]}}}return null}_extensionsOnLoading(){this._forEachExtensions((K=>K.onLoading&&K.onLoading()))}_extensionsOnReady(){this._forEachExtensions((K=>K.onReady&&K.onReady()))}_extensionsLoadSceneAsync(K,A){return this._applyExtensions(A,"loadScene",(T=>T.loadSceneAsync&&T.loadSceneAsync(K,A)))}_extensionsLoadNodeAsync(K,A,T){return this._applyExtensions(A,"loadNode",(G=>G.loadNodeAsync&&G.loadNodeAsync(K,A,T)))}_extensionsLoadCameraAsync(K,A,T){return this._applyExtensions(A,"loadCamera",(G=>G.loadCameraAsync&&G.loadCameraAsync(K,A,T)))}_extensionsLoadVertexDataAsync(K,A,T){return this._applyExtensions(A,"loadVertexData",(G=>G._loadVertexDataAsync&&G._loadVertexDataAsync(K,A,T)))}_extensionsLoadMeshPrimitiveAsync(K,A,T,G,B,L){return this._applyExtensions(B,"loadMeshPrimitive",(f=>f._loadMeshPrimitiveAsync&&f._loadMeshPrimitiveAsync(K,A,T,G,B,L)))}_extensionsLoadMaterialAsync(K,A,T,G,B){return this._applyExtensions(A,"loadMaterial",(L=>L._loadMaterialAsync&&L._loadMaterialAsync(K,A,T,G,B)))}_extensionsCreateMaterial(K,A,T){return this._applyExtensions(A,"createMaterial",(G=>G.createMaterial&&G.createMaterial(K,A,T)))}_extensionsLoadMaterialPropertiesAsync(K,A,T){return this._applyExtensions(A,"loadMaterialProperties",(G=>G.loadMaterialPropertiesAsync&&G.loadMaterialPropertiesAsync(K,A,T)))}_extensionsLoadTextureInfoAsync(K,A,T){return this._applyExtensions(A,"loadTextureInfo",(G=>G.loadTextureInfoAsync&&G.loadTextureInfoAsync(K,A,T)))}_extensionsLoadTextureAsync(K,A,T){return this._applyExtensions(A,"loadTexture",(G=>G._loadTextureAsync&&G._loadTextureAsync(K,A,T)))}_extensionsLoadAnimationAsync(K,A){return this._applyExtensions(A,"loadAnimation",(T=>T.loadAnimationAsync&&T.loadAnimationAsync(K,A)))}_extensionsLoadAnimationChannelAsync(K,A,T,G,B){return this._applyExtensions(T,"loadAnimationChannel",(L=>L._loadAnimationChannelAsync&&L._loadAnimationChannelAsync(K,A,T,G,B)))}_extensionsLoadSkinAsync(K,A,T){return this._applyExtensions(T,"loadSkin",(G=>G._loadSkinAsync&&G._loadSkinAsync(K,A,T)))}_extensionsLoadUriAsync(K,A,T){return this._applyExtensions(A,"loadUri",(G=>G._loadUriAsync&&G._loadUriAsync(K,A,T)))}_extensionsLoadBufferViewAsync(K,A){return this._applyExtensions(A,"loadBufferView",(T=>T.loadBufferViewAsync&&T.loadBufferViewAsync(K,A)))}_extensionsLoadBufferAsync(K,A,T,G){return this._applyExtensions(A,"loadBuffer",(B=>B.loadBufferAsync&&B.loadBufferAsync(K,A,T,G)))}static LoadExtensionAsync(K,A,T,G){if(!A.extensions)return null;const B=A.extensions[T];return B?G(`${K}/extensions/${T}`,B):null}static LoadExtraAsync(K,A,T,G){if(!A.extras)return null;const B=A.extras[T];return B?G(`${K}/extras/${T}`,B):null}isExtensionUsed(K){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(K)}logOpen(K){this._parent._logOpen(K)}logClose(){this._parent._logClose()}log(K){this._parent._log(K)}startPerformanceCounter(K){this._parent._startPerformanceCounter(K)}endPerformanceCounter(K){this._parent._endPerformanceCounter(K)}}i.DefaultSampler={index:-1},e.d._CreateGLTF2Loader=K=>new i(K);var V=T(14175),X=T(12883),q=T(12733),y=T(14179),w=T(14185);class a extends w.c{constructor(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",K),this._texture=K.getEngine().createRawCubeTexture(A,T,G,B,L,f,O,C)}update(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,K,A,T,G,B)}updateRGBDAsync(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,y.k)(this._texture,K,A,T,G).then((()=>{}))}clone(){return q.c.Clone((()=>{const K=this.SK(),A=this._texture,T=new a(K,A._bufferViewArray,A.width,A.format,A.type,A.generateMipMaps,A.invertY,A.samplingMode,A._compression);return 13===A.source&&T.updateRGBDAsync(A._bufferViewArrayArray,A._sphericalPolynomial,A._lodGenerationScale,A._lodGenerationOffset),T}),this)}}const M="EXT_lights_image_based";class E{constructor(K){this.name=M,this._loader=K,this.enabled=this._loader.isExtensionUsed(M)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.Sf.extensions;if(K&&K[this.name]){const A=K[this.name];this._lights=A.lights}}loadSceneAsync(K,A){return i.LoadExtensionAsync(K,A,this.name,(async(T,G)=>{this._loader._allMaterialsDirtyRequired=!0;const B=new Array;B.push(this._loader.loadSceneAsync(K,A)),this._loader.logOpen(`${T}`);const L=o.Get(`${T}/light`,this._lights,G.Cf);return B.push(this._loadLightAsync(`/extensions/${this.name}/lights/${G.Cf}`,L).then((K=>{this._loader.babylonScene.environmentTexture=K}))),this._loader.logClose(),await Promise.all(B).then((()=>{}))}))}_loadLightAsync(K,A){if(!A._loaded){const T=new Array;this._loader.logOpen(`${K}`);const G=new Array(A.specularImages.length);for(let B=0;B<A.specularImages.length;B++){const L=A.specularImages[B];G[B]=new Array(L.length);for(let A=0;A<L.length;A++){const f=`${K}/specularImages/${B}/${A}`;this._loader.logOpen(`${f}`);const O=L[A],C=o.Get(f,this._loader.Sf.images,O);T.push(this._loader.loadImageAsync(`/images/${O}`,C).then((K=>{G[B][A]=K}))),this._loader.logClose()}}this._loader.logClose(),A._loaded=Promise.all(T).then((async()=>{const T=new a(this._loader.babylonScene,null,A.specularImageSize);if(T.name=A.name||"environment",A._babylonTexture=T,void 0!=A.VO&&(T.level=A.VO),A.rotation){let K=B.Quaternion.mT(A.rotation);this._loader.babylonScene.useRightHandedSystem||(K=B.Quaternion.Inverse(K)),B.Matrix.FromQuaternionToRef(K,T.getReflectionTextureMatrix())}if(!A.irradianceCoefficients)throw new Error(`${K}: Irradiance coefficients are missing`);const L=X.e.mT(A.irradianceCoefficients);L.scaleInPlace(A.VO),L.convertIrradianceToLambertianRadiance();const f=X.g.FromHarmonics(L),O=(G.length-1)/Math.log2(A.specularImageSize);return await T.updateRGBDAsync(G,f,O)}))}return A._loaded.then((()=>A._babylonTexture))}}j(M),s(M,!0,(K=>new E(K)));T(13266);const t="EXT_mesh_gpu_instancing";class KK{constructor(K){this.name=t,this._loader=K,this.enabled=this._loader.isExtensionUsed(t)}dispose(){this._loader=null}loadNodeAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(K,G)=>{this._loader._disableInstancedMesh++;const L=this._loader.loadNodeAsync(`/nodes/${A.index}`,A,T);if(this._loader._disableInstancedMesh--,!A._primitiveBabylonMeshes)return await L;const f=new Array;let O=0;const C=A=>{if(void 0==G.attributes[A])return void f.push(Promise.resolve(null));const T=o.Get(`${K}/attributes/${A}`,this._loader.Sf.accessors,G.attributes[A]);if(f.push(this._loader._loadFloatAccessorAsync(`/accessors/${T.bufferView}`,T)),0===O)O=T.count;else if(O!==T.count)throw new Error(`${K}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),await L.then((async K=>{const[T,G,L]=await Promise.all(f),C=new Float32Array(16*O);B.TmpVectors.PA[0].RO(0,0,0),B.TmpVectors.Quaternion[0].RO(0,0,0,1),B.TmpVectors.PA[1].RO(1,1,1);for(let A=0;A<O;++A)T&&B.PA.FromArrayToRef(T,3*A,B.TmpVectors.PA[0]),G&&B.Quaternion.FromArrayToRef(G,4*A,B.TmpVectors.Quaternion[0]),L&&B.PA.FromArrayToRef(L,3*A,B.TmpVectors.PA[1]),B.Matrix.ComposeToRef(B.TmpVectors.PA[1],B.TmpVectors.Quaternion[0],B.TmpVectors.PA[0],B.TmpVectors.Matrix[0]),B.TmpVectors.Matrix[0].copyToArray(C,16*A);for(const B of A._primitiveBabylonMeshes)B.sZ("matrix",C,16,!0);return K}))}))}}j(t),s(t,!0,(K=>new KK(K)));let AK=0,TK=null;class GK{static get Default(){return GK._Default||(GK._Default=new GK),GK._Default}constructor(){const K=GK.Configuration.decoder;this._decoderModulePromise=f.Tools.LoadBabylonScriptAsync(K.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(K,A,T,G,B){await this._decoderModulePromise,0===AK&&(MeshoptDecoder.useWorkers(1),AK=1);const L=await MeshoptDecoder.decodeGltfBufferAsync(A,T,K,G,B);return null!==TK&&clearTimeout(TK),TK=setTimeout((()=>{MeshoptDecoder.useWorkers(0),AK=0,TK=null}),1e3),L}}GK.Configuration={decoder:{url:`${f.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},GK._Default=null;const BK="EXT_meshopt_compression";class LK{constructor(K){this.name=BK,this.enabled=K.isExtensionUsed(BK),this._loader=K}dispose(){this._loader=null}loadBufferViewAsync(K,A){return i.LoadExtensionAsync(K,A,this.name,(async(T,G)=>{const B=A;if(B._meshOptData)return await B._meshOptData;const L=o.Get(`${K}/buffer`,this._loader.Sf.buffers,G.buffer);return B._meshOptData=this._loader.loadBufferAsync(`/buffers/${L.index}`,L,G.byteOffset||0,G.byteLength).then((async K=>await GK.Default.decodeGltfBufferAsync(K,G.count,G.byteStride,G.mode,G.filter))),await B._meshOptData}))}}j(BK),s(BK,!0,(K=>new LK(K)));const fK="EXT_texture_webp";class OK{constructor(K){this.name=fK,this._loader=K,this.enabled=K.isExtensionUsed(fK)}dispose(){this._loader=null}_loadTextureAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=void 0==A.sampler?i.DefaultSampler:o.Get(`${K}/sampler`,this._loader.Sf.samplers,A.sampler),f=o.Get(`${G}/source`,this._loader.Sf.images,B.source);return await this._loader._createTextureAsync(K,L,f,(K=>{T(K)}),void 0,!A._textureInfo.nonColorData)}))}}j(fK),s(fK,!0,(K=>new OK(K)));const CK="EXT_texture_avif";class QK{constructor(K){this.name=CK,this._loader=K,this.enabled=K.isExtensionUsed(CK)}dispose(){this._loader=null}_loadTextureAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=void 0==A.sampler?i.DefaultSampler:o.Get(`${K}/sampler`,this._loader.Sf.samplers,A.sampler),f=o.Get(`${G}/source`,this._loader.Sf.images,B.source);return await this._loader._createTextureAsync(K,L,f,(K=>{T(K)}),void 0,!A._textureInfo.nonColorData)}))}}j(CK),s(CK,!0,(K=>new QK(K)));var YK=T(14173),ZK=T(13242);const xK="EXT_lights_ies";class JK{constructor(K){this.name=xK,this._loader=K,this.enabled=this._loader.isExtensionUsed(xK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.Sf.extensions;if(K&&K[this.name]){const A=K[this.name];this._lights=A.lights,o.Assign(this._lights)}}loadNodeAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,f)=>{let O,C;this._loader._allMaterialsDirtyRequired=!0;const Q=await this._loader.loadNodeAsync(K,A,(K=>{C=o.Get(G,this._lights,f.Cf);const A=C.name||K.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O=new YK.b(A,B.PA.Zero(),B.PA.Backward(),0,1,this._loader.babylonScene),O.angle=Math.PI/2,O.innerAngle=0,O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=O,O.falloffType=ZK.b.FALLOFF_GLTF,O.XO=f.color?L.DA.mT(f.color):L.DA.White(),O.VO=f.multiplier||1,O.range=Number.MAX_VALUE,O.parent=K,this._loader._babylonLights.push(O),i.AddPointerMetadata(O,G),T(K)}));let Y;if(C.uri)Y=await this._loader.loadUriAsync(K,C,C.uri);else{const A=o.Get(`${K}/bufferView`,this._loader.Sf.bufferViews,C.bufferView);Y=await this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return O.iesProfileTexture=new mK.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,Y,!0,void 0,void 0,void 0,void 0,".ies"),Q}))}}j(xK),s(xK,!0,(K=>new JK(K)));var bK=T(14201);const PK="KHR_draco_mesh_compression";class FK{constructor(K){this.name=PK,this.useNormalizedFlagFromAccessor=!0,this._loader=K,this.enabled=bK.d.DefaultAvailable&&this._loader.isExtensionUsed(PK)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{if(void 0!=A.mode&&4!==A.mode&&5!==A.mode)throw new Error(`${K}: Unsupported mode ${A.mode}`);const L={},f={},O=(K,G)=>{const O=B.attributes[K];if(void 0!=O&&(T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(G)&&T._delayInfo.push(G),L[G]=O,this.useNormalizedFlagFromAccessor)){const T=o.TryGet(this._loader.Sf.accessors,A.attributes[K]);T&&(f[G]=T.normalized||!1)}};O("POSITION",z.d.PositionKind),O("NORMAL",z.d.NormalKind),O("TANGENT",z.d.TangentKind),O("TEXCOORD_0",z.d.UVKind),O("TEXCOORD_1",z.d.UV2Kind),O("TEXCOORD_2",z.d.UV3Kind),O("TEXCOORD_3",z.d.UV4Kind),O("TEXCOORD_4",z.d.UV5Kind),O("TEXCOORD_5",z.d.UV6Kind),O("JOINTS_0",z.d.MatricesIndicesKind),O("WEIGHTS_0",z.d.MatricesWeightsKind),O("COLOR_0",z.d.ColorKind);const C=o.Get(G,this._loader.Sf.bufferViews,B.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((async G=>{const B=this.dracoDecoder||bK.d.Default,O=o.TryGet(this._loader.Sf.accessors,A.attributes.POSITION),C=this._loader.parent.alwaysComputeBoundingBox||T.skeleton||!O?null:W(O);return await B._decodeMeshToGeometryForGltfAsync(T.name,this._loader.babylonScene,G,L,f,C).catch((A=>{throw new Error(`${K}: ${A.message}`)}))}))),await C._dracoBabylonGeometry}))}}j(PK),s(PK,!0,(K=>new FK(K)));var dK=T(14206),NK=T(12683),DK=T(12688),mA=T(13127),UK=T(13290),zK=T(12651);mA.d.AddNodeConstructor("Light_Type_0",((K,A)=>()=>new gK(K,B.PA.Zero(),A)));class gK extends UK.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(K){this._shadowAngle=K,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(K){const A=this.needCube();if(this._direction=K,this.needCube()!==A&&this._shadowGenerators){const K=this._shadowGenerators.values();for(let A=K.next();!0!==A.done;A=K.next()){A.value.recreateShadowMap()}}}constructor(K,A,T){super(K,T),this._shadowAngle=Math.PI/2,this.position=A}getClassName(){return"PointLight"}getTypeID(){return ZK.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(K){if(this.direction)return super.getShadowDirection(K);switch(K){case 0:return new B.PA(1,0,0);case 1:return new B.PA(-1,0,0);case 2:return new B.PA(0,-1,0);case 3:return new B.PA(0,1,0);case 4:return new B.PA(0,0,1);case 5:return new B.PA(0,0,-1)}return B.PA.Zero()}_setDefaultShadowProjectionMatrix(K,A,T){const G=this.SK().activeCamera;if(!G)return;const L=void 0!==this.shadowMinZ?this.shadowMinZ:G.If,f=void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ,O=this.SK().getEngine().Zf;B.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,O?f:L,O?L:f,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,A){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,A):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,A),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,A),this}transferToNodeMaterialEffect(K,A){return this.computeTransformedInformation()?K.setFloat3(A,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):K.setFloat3(A,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(K,A){K["POINTLIGHT"+A]=!0}}(0,NK.c)([(0,DK.B)()],gK.prototype,"shadowAngle",null),(0,zK.c)("BABYLON.PointLight",gK);const SK="KHR_lights_punctual";class lK{constructor(K){this.name=SK,this._loader=K,this.enabled=this._loader.isExtensionUsed(SK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.Sf.extensions;if(K&&K[this.name]){const A=K[this.name];this._lights=A.lights,o.Assign(this._lights)}}loadNodeAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,f)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(K,A,(K=>{let A;const O=o.Get(G,this._lights,f.Cf),C=O.name||K.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O.type){case"directional":{const K=new dK.d(C,B.PA.Backward(),this._loader.babylonScene);K.position.IO(0),A=K;break}case"point":A=new gK(C,B.PA.Zero(),this._loader.babylonScene);break;case"spot":{const K=new YK.b(C,B.PA.Zero(),B.PA.Backward(),0,1,this._loader.babylonScene);K.angle=2*(O.spot&&O.spot.outerConeAngle||Math.PI/4),K.innerAngle=2*(O.spot&&O.spot.innerConeAngle||0),A=K;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${G}: Invalid light type (${O.type})`)}A._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,O._babylonLight=A,A.falloffType=ZK.b.FALLOFF_GLTF,A.XO=O.color?L.DA.mT(O.color):L.DA.White(),A.VO=void 0==O.VO?1:O.VO,A.range=void 0==O.range?Number.MAX_VALUE:O.range,A.parent=K,this._loader._babylonLights.push(A),i.AddPointerMetadata(A,G),T(K)})))))}}j(SK),s(SK,!0,(K=>new lK(K)));const uK="KHR_materials_pbrSpecularGlossiness";class cK{constructor(K){this.name=uK,this.order=200,this._loader=K,this.enabled=this._loader.isExtensionUsed(uK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialBasePropertiesAsync(K,A,T)),L.push(this._loadSpecularGlossinessPropertiesAsync(G,B,T)),this._loader.loadMaterialAlphaProperties(K,A,T),await Promise.all(L).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return T.metallic=null,T.roughness=null,A.diffuseFactor?(T.albedoColor=L.DA.mT(A.diffuseFactor),T.alpha=A.diffuseFactor[3]):T.albedoColor=L.DA.White(),T.reflectivityColor=A.specularFactor?L.DA.mT(A.specularFactor):L.DA.White(),T.microSurface=void 0==A.glossinessFactor?1:A.glossinessFactor,A.diffuseTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTexture`,A.diffuseTexture,(K=>{K.name=`${T.name} (Diffuse)`,T.albedoTexture=K}))),A.specularGlossinessTexture&&(G.push(this._loader.loadTextureInfoAsync(`${K}/specularGlossinessTexture`,A.specularGlossinessTexture,(K=>{K.name=`${T.name} (Specular Glossiness)`,T.reflectivityTexture=K,T.reflectivityTexture.sf=!0}))),T.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(G).then((()=>{}))}}j(uK),s(uK,!0,(K=>new cK(K)));const nK="KHR_materials_unlit";class HK{constructor(K){this.name=nK,this.order=210,this._loader=K,this.enabled=this._loader.isExtensionUsed(nK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async()=>await this._loadUnlitPropertiesAsync(K,A,T)))}_loadUnlitPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;T.unlit=!0;const B=A.pbrMetallicRoughness;return B&&(B.baseColorFactor?(T.albedoColor=L.DA.mT(B.baseColorFactor),T.alpha=B.baseColorFactor[3]):T.albedoColor=L.DA.White(),B.baseColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/baseColorTexture`,B.baseColorTexture,(K=>{K.name=`${T.name} (Base Color)`,T.albedoTexture=K})))),A.doubleSided&&(T.tf=!1,T.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(K,A,T),Promise.all(G).then((()=>{}))}}j(nK),s(nK,!0,(K=>new HK(K)));const eK="KHR_materials_clearcoat";class pK{constructor(K){this.name=eK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(eK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadClearCoatPropertiesAsync(G,B,T)),await Promise.all(L)}))}_loadClearCoatPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return T.clearCoat.isEnabled=!0,T.clearCoat.useRoughnessFromMainTexture=!1,T.clearCoat.remapF0OnInterfaceChange=!1,void 0!=A.clearcoatFactor?T.clearCoat.VO=A.clearcoatFactor:T.clearCoat.VO=0,A.clearcoatTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatTexture`,A.clearcoatTexture,(K=>{K.name=`${T.name} (ClearCoat)`,T.clearCoat.texture=K}))),void 0!=A.clearcoatRoughnessFactor?T.clearCoat.roughness=A.clearcoatRoughnessFactor:T.clearCoat.roughness=0,A.clearcoatRoughnessTexture&&(A.clearcoatRoughnessTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatRoughnessTexture`,A.clearcoatRoughnessTexture,(K=>{K.name=`${T.name} (ClearCoat Roughness)`,T.clearCoat.textureRoughness=K})))),A.clearcoatNormalTexture&&(A.clearcoatNormalTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatNormalTexture`,A.clearcoatNormalTexture,(K=>{K.name=`${T.name} (ClearCoat Normal)`,T.clearCoat.bumpTexture=K}))),T.invertNormalMapX=!T.SK().useRightHandedSystem,T.invertNormalMapY=T.SK().useRightHandedSystem,void 0!=A.clearcoatNormalTexture.scale&&(T.clearCoat.bumpTexture.level=A.clearcoatNormalTexture.scale)),Promise.all(G).then((()=>{}))}}j(eK),s(eK,!0,(K=>new pK(K)));const rK="KHR_materials_iridescence";class hK{constructor(K){this.name=rK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(rK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadIridescencePropertiesAsync(G,B,T)),await Promise.all(L).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return T.iridescence.isEnabled=!0,T.iridescence.VO=A.iridescenceFactor??0,T.iridescence.indexOfRefraction=A.iridescenceIor??A.iridescenceIOR??1.3,T.iridescence.minimumThickness=A.iridescenceThicknessMinimum??100,T.iridescence.maximumThickness=A.iridescenceThicknessMaximum??400,A.iridescenceTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceTexture`,A.iridescenceTexture,(K=>{K.name=`${T.name} (Iridescence)`,T.iridescence.texture=K}))),A.iridescenceThicknessTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceThicknessTexture`,A.iridescenceThicknessTexture,(K=>{K.name=`${T.name} (Iridescence Thickness)`,T.iridescence.thicknessTexture=K}))),Promise.all(G).then((()=>{}))}}j(rK),s(rK,!0,(K=>new hK(K)));const kK="KHR_materials_anisotropy";class sK{constructor(K){this.name=kK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(kK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadIridescencePropertiesAsync(G,B,T)),await Promise.all(L)}))}async _loadIridescencePropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;T.anisotropy.isEnabled=!0,T.anisotropy.VO=A.anisotropyStrength??0,T.anisotropy.angle=A.anisotropyRotation??0,A.anisotropyTexture&&(A.anisotropyTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${K}/anisotropyTexture`,A.anisotropyTexture,(K=>{K.name=`${T.name} (Anisotropy Intensity)`,T.anisotropy.texture=K})))),await Promise.all(G)}}j(kK),s(kK,!0,(K=>new sK(K)));const jK="KHR_materials_emissive_strength";class RK{constructor(K){this.name=jK,this.order=170,this._loader=K,this.enabled=this._loader.isExtensionUsed(jK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>await this._loader.loadMaterialPropertiesAsync(K,A,T).then((()=>{this._loadEmissiveProperties(G,B,T)}))))}_loadEmissiveProperties(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);void 0!==A.emissiveStrength&&(T.emissiveIntensity=A.emissiveStrength)}}j(jK),s(jK,!0,(K=>new RK(K)));const vK="KHR_materials_sheen";class IK{constructor(K){this.name=vK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(vK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadSheenPropertiesAsync(G,B,T)),await Promise.all(L).then((()=>{}))}))}_loadSheenPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return T.sheen.isEnabled=!0,T.sheen.VO=1,void 0!=A.sheenColorFactor?T.sheen.color=L.DA.mT(A.sheenColorFactor):T.sheen.color=L.DA.Black(),A.sheenColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/sheenColorTexture`,A.sheenColorTexture,(K=>{K.name=`${T.name} (Sheen Color)`,T.sheen.texture=K}))),void 0!==A.sheenRoughnessFactor?T.sheen.roughness=A.sheenRoughnessFactor:T.sheen.roughness=0,A.sheenRoughnessTexture&&(A.sheenRoughnessTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${K}/sheenRoughnessTexture`,A.sheenRoughnessTexture,(K=>{K.name=`${T.name} (Sheen Roughness)`,T.sheen.textureRoughness=K})))),T.sheen.albedoScaling=!0,T.sheen.useRoughnessFromMainTexture=!1,Promise.all(G).then((()=>{}))}}j(vK),s(vK,!0,(K=>new IK(K)));var oK=T(13186);const WK="KHR_materials_specular";class iK{constructor(K){this.name=WK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(WK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;if(L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadSpecularPropertiesAsync(G,B,T)),B.extensions&&B.extensions.EXT_materials_specular_edge_color&&T instanceof D.c){B.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(T.brdf.dielectricSpecularModel=oK.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,T.brdf.conductorSpecularModel=oK.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(L).then((()=>{}))}))}_loadSpecularPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return void 0!==A.specularFactor&&(T.metallicF0Factor=A.specularFactor),void 0!==A.specularColorFactor&&(T.metallicReflectanceColor=L.DA.mT(A.specularColorFactor)),A.specularTexture&&(A.specularTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${K}/specularTexture`,A.specularTexture,(K=>{K.name=`${T.name} (Specular)`,T.metallicReflectanceTexture=K,T.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),A.specularColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/specularColorTexture`,A.specularColorTexture,(K=>{K.name=`${T.name} (Specular Color)`,T.reflectanceTexture=K}))),Promise.all(G).then((()=>{}))}}j(WK),s(WK,!0,(K=>new iK(K)));const VK="KHR_materials_ior";class XK{constructor(K){this.name=VK,this.order=180,this._loader=K,this.enabled=this._loader.isExtensionUsed(VK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadIorPropertiesAsync(G,B,T)),await Promise.all(L).then((()=>{}))}))}_loadIorPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);return void 0!==A.ior?T.indexOfRefraction=A.ior:T.indexOfRefraction=XK._DEFAULT_IOR,Promise.resolve()}}XK._DEFAULT_IOR=1.5,j(VK),s(VK,!0,(K=>new XK(K)));const qK="KHR_materials_variants";class yK{constructor(K){this.name=qK,this._loader=K,this.enabled=this._loader.isExtensionUsed(qK)}dispose(){this._loader=null}static GetAvailableVariants(K){const A=this._GetExtensionMetadata(K);return A?Object.keys(A.variants):[]}getAvailableVariants(K){return yK.GetAvailableVariants(K)}static SelectVariant(K,A){const T=this._GetExtensionMetadata(K);if(!T)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${qK} extension`);const G=K=>{const A=T.variants[K];if(A)for(const T of A)T.mesh.material=T.material};if(A instanceof Array)for(const B of A)G(B);else G(A);T.lastSelected=A}selectVariant(K,A){yK.SelectVariant(K,A)}static Reset(K){const A=this._GetExtensionMetadata(K);if(!A)throw new Error(`Cannot reset on a glTF mesh that does not have the ${qK} extension`);for(const T of A.original)T.mesh.material=T.material;A.lastSelected=null}reset(K){yK.Reset(K)}static GetLastSelectedVariant(K){const A=this._GetExtensionMetadata(K);if(!A)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${qK} extension`);return A.lastSelected}getLastSelectedVariant(K){return yK.GetLastSelectedVariant(K)}static _GetExtensionMetadata(K){var A,T;return(null===K||void 0===K||null===(A=K._internalMetadata)||void 0===A||null===(T=A.Sf)||void 0===T?void 0:T[qK])||null}onLoading(){const K=this._loader.Sf.extensions;if(K&&K[this.name]){const A=K[this.name];this._variants=A.variants}}onReady(){const K=this._loader.rootBabylonMesh;if(K){var A;const T=this._loader.parent.extensionOptions[qK];null!==T&&void 0!==T&&T.defaultVariant&&yK.SelectVariant(K,T.defaultVariant),null===T||void 0===T||null===(A=T.onLoaded)||void 0===A||A.call(T,{get variants(){return yK.GetAvailableVariants(K)},get selectedVariant(){const A=yK.GetLastSelectedVariant(K);return A?Array.isArray(A)?A[0]:A:yK.GetAvailableVariants(K)[0]},set selectedVariant(A){yK.SelectVariant(K,A)}})}}_loadMeshPrimitiveAsync(K,A,T,G,B,L){return i.LoadExtensionAsync(K,B,this.name,(async(f,O)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(K,A,T,G,B,(A=>{if(L(A),A instanceof l.e){const T=i._GetDrawMode(K,B.mode),G=this._loader.rootBabylonMesh,L=G?G._internalMetadata=G._internalMetadata||{}:{},Q=L.Sf=L.Sf||{},Y=Q[qK]=Q[qK]||{lastSelected:null,original:[],variants:{}};Y.original.push({mesh:A,material:A.material});for(let K=0;K<O.mappings.length;++K){const B=O.mappings[K],L=o.Get(`${f}/mappings/${K}/material`,this._loader.Sf.materials,B.material);C.push(this._loader._loadMaterialAsync(`#/materials/${B.material}`,L,A,T,(K=>{for(let T=0;T<B.variants.length;++T){const L=B.variants[T],f=o.Get(`/extensions/${qK}/variants/${L}`,this._variants,L);Y.variants[f.name]=Y.variants[f.name]||[],Y.variants[f.name].push({mesh:A,material:K}),A.onClonedObservable.add((K=>{const T=K;let B=null,L=T;do{if(L=L.parent,!L)return;B=yK._GetExtensionMetadata(L)}while(null===B);if(G&&B===yK._GetExtensionMetadata(G)){L._internalMetadata={};for(const K in G._internalMetadata)L._internalMetadata[K]=G._internalMetadata[K];L._internalMetadata.Sf=[];for(const K in G._internalMetadata.Sf)L._internalMetadata.Sf[K]=G._internalMetadata.Sf[K];L._internalMetadata.Sf[qK]={lastSelected:null,original:[],variants:{}};for(const K of B.original)L._internalMetadata.Sf[qK].original.push({mesh:K.mesh,material:K.material});for(const K in B.variants)if(Object.prototype.hasOwnProperty.call(B.variants,K)){L._internalMetadata.Sf[qK].variants[K]=[];for(const A of B.variants[K])L._internalMetadata.Sf[qK].variants[K].push({mesh:A.mesh,material:A.material})}B=L._internalMetadata.Sf[qK]}for(const G of B.original)G.mesh===A&&(G.mesh=T);for(const G of B.variants[f.name])G.mesh===A&&(G.mesh=T)}))}})))}}}))),await Promise.all(C).then((K=>{let[A]=K;return A}))}))}}j(qK),s(qK,!0,(K=>new yK(K)));var wK=T(12762);class aK{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:oK.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(K,A){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...aK._GetDefaultOptions(),...K},this._scene=A,this._scene._transmissionHelper=this,this.onErrorObservable=new Y.e,this._scene.Ff.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(K){if(!Object.keys(K).filter((A=>this._options[A]!==K[A])).length)return;const A={...this._options,...K},T=this._options;this._options=A,A.renderSize===T.renderSize&&A.renderTargetTextureType===T.renderTargetTextureType&&A.generateMipmaps===T.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=A.samples,this._opaqueRenderTarget.lodGenerationScale=A.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=A.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(K){return!!K&&!!(K instanceof D.c&&K.subSurface.isRefractionEnabled)}_addMesh(K){this._materialObservers[K.uniqueId]=K.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),f.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(K.material)?(K.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(K)&&this._transparentMeshesCache.push(K)):-1===this._opaqueMeshesCache.indexOf(K)&&this._opaqueMeshesCache.push(K)}))}_removeMesh(K){K.onMaterialChangedObservable.remove(this._materialObservers[K.uniqueId]),delete this._materialObservers[K.uniqueId];let A=this._transparentMeshesCache.indexOf(K);-1!==A&&this._transparentMeshesCache.splice(A,1),A=this._opaqueMeshesCache.indexOf(K),-1!==A&&this._opaqueMeshesCache.splice(A,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(K){const A=this._transparentMeshesCache.indexOf(K),T=this._opaqueMeshesCache.indexOf(K);this._shouldRenderAsTransmission(K.material)?(K.material instanceof D.c&&(K.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==T?(this._opaqueMeshesCache.splice(T,1),this._transparentMeshesCache.push(K)):-1===A&&this._transparentMeshesCache.push(K)):-1!==A?(this._transparentMeshesCache.splice(A,1),this._opaqueMeshesCache.push(K)):-1===T&&this._opaqueMeshesCache.push(K)}_isRenderTargetValid(){var K;return null!==(null===(K=this._opaqueRenderTarget)||void 0===K?void 0:K.getInternalTexture())}_setupRenderTargets(){var K;let A;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new wK.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(K=this._options.clearColor)||void 0===K?void 0:K.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((K=>{A=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?K.clearColor.G(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(K.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=A}));for(const T of this._transparentMeshesCache)this._shouldRenderAsTransmission(T.material)&&(T.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const MK="KHR_materials_transmission";class EK{constructor(K){this.name=MK,this.order=175,this._loader=K,this.enabled=this._loader.isExtensionUsed(MK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadTransparentPropertiesAsync(G,A,T,B)),await Promise.all(L).then((()=>{}))}))}_loadTransparentPropertiesAsync(K,A,T,G){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const B=T;if(B.subSurface.isRefractionEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.useAlbedoToTintRefraction=!0,void 0===G.transmissionFactor)return B.subSurface.refractionIntensity=0,B.subSurface.isRefractionEnabled=!1,Promise.resolve();{var L;B.subSurface.refractionIntensity=G.transmissionFactor;const K=B.SK();if(B.subSurface.refractionIntensity&&!K._transmissionHelper)new aK({},B.SK());else if(B.subSurface.refractionIntensity&&(null===(L=K._transmissionHelper)||void 0===L||!L._isRenderTargetValid())){var f;null===(f=K._transmissionHelper)||void 0===f||f._setupRenderTargets()}}return B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,G.transmissionTexture?(G.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/transmissionTexture`,G.transmissionTexture,void 0).then((K=>{K.name=`${T.name} (Transmission)`,B.subSurface.refractionIntensityTexture=K,B.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(MK),s(MK,!0,(K=>new EK(K)));const tK="KHR_materials_diffuse_transmission";class KA{constructor(K){this.name=tK,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(tK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadTranslucentPropertiesAsync(G,A,T,B)),await Promise.all(L).then((()=>{}))}))}_loadTranslucentPropertiesAsync(K,A,T,G){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const B=T;if(B.subSurface.isTranslucencyEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,B.subSurface.useAlbedoToTintTranslucency=!1,void 0===G.diffuseTransmissionFactor)return B.subSurface.translucencyIntensity=0,B.subSurface.isTranslucencyEnabled=!1,Promise.resolve();B.subSurface.translucencyIntensity=G.diffuseTransmissionFactor;const f=new Array;return B.subSurface.useGltfStyleTextures=!0,G.diffuseTransmissionTexture&&(G.diffuseTransmissionTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionTexture`,G.diffuseTransmissionTexture).then((K=>{K.name=`${T.name} (Diffuse Transmission)`,B.subSurface.translucencyIntensityTexture=K})))),void 0!==G.diffuseTransmissionColorFactor?B.subSurface.translucencyColor=L.DA.mT(G.diffuseTransmissionColorFactor):B.subSurface.translucencyColor=L.DA.White(),G.diffuseTransmissionColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionColorTexture`,G.diffuseTransmissionColorTexture).then((K=>{K.name=`${T.name} (Diffuse Transmission Color)`,B.subSurface.translucencyColorTexture=K}))),Promise.all(f).then((()=>{}))}}j(tK),s(tK,!0,(K=>new KA(K)));const AA="KHR_materials_volume";class TA{constructor(K){this.name=AA,this.order=173,this._loader=K,this.enabled=this._loader.isExtensionUsed(AA),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadVolumePropertiesAsync(G,A,T,B)),await Promise.all(L).then((()=>{}))}))}_loadVolumePropertiesAsync(K,A,T,G){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);if(!T.subSurface.isRefractionEnabled&&!T.subSurface.isTranslucencyEnabled||!G.thicknessFactor)return Promise.resolve();T.subSurface.volumeIndexOfRefraction=T.indexOfRefraction;const B=void 0!==G.attenuationDistance?G.attenuationDistance:Number.MAX_VALUE;return T.subSurface.tintColorAtDistance=B,void 0!==G.attenuationColor&&3==G.attenuationColor.length&&T.subSurface.tintColor.RO(G.attenuationColor[0],G.attenuationColor[1],G.attenuationColor[2]),T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=G.thicknessFactor,T.subSurface.useThicknessAsDepth=!0,G.thicknessTexture?(G.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/thicknessTexture`,G.thicknessTexture).then((K=>{K.name=`${T.name} (Thickness)`,T.subSurface.thicknessTexture=K,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(AA),s(AA,!0,(K=>new TA(K)));const GA="KHR_materials_dispersion";class BA{constructor(K){this.name=GA,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(GA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadDispersionPropertiesAsync(G,A,T,B)),await Promise.all(L).then((()=>{}))}))}_loadDispersionPropertiesAsync(K,A,T,G){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);return T.subSurface.isRefractionEnabled&&G.dispersion?(T.subSurface.isDispersionEnabled=!0,T.subSurface.dispersion=G.dispersion,Promise.resolve()):Promise.resolve()}}j(GA),s(GA,!0,(K=>new BA(K)));const LA="EXT_materials_diffuse_roughness";class fA{constructor(K){this.name=LA,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(LA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(K,A,T)),L.push(this._loadDiffuseRoughnessPropertiesAsync(G,B,T)),await Promise.all(L).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(K,A,T){if(!(T instanceof D.c))throw new Error(`${K}: Material type not supported`);const G=new Array;return T.brdf.baseDiffuseModel=oK.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=A.diffuseRoughnessFactor?T.baseDiffuseRoughness=A.diffuseRoughnessFactor:T.baseDiffuseRoughness=0,A.diffuseRoughnessTexture&&G.push(this._loader.loadTextureInfoAsync(`${K}/diffuseRoughnessTexture`,A.diffuseRoughnessTexture,(K=>{K.name=`${T.name} (Diffuse Roughness)`,T.baseDiffuseRoughnessTexture=K}))),Promise.all(G).then((()=>{}))}}j(LA),s(LA,!0,(K=>new fA(K)));const OA="KHR_mesh_quantization";class CA{constructor(K){this.name=OA,this.enabled=K.isExtensionUsed(OA)}dispose(){}}j(OA),s(OA,!0,(K=>new CA(K)));const QA="KHR_texture_basisu";class YA{constructor(K){this.name=QA,this._loader=K,this.enabled=K.isExtensionUsed(QA)}dispose(){this._loader=null}_loadTextureAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>{const L=void 0==A.sampler?i.DefaultSampler:o.Get(`${K}/sampler`,this._loader.Sf.samplers,A.sampler),f=o.Get(`${G}/source`,this._loader.Sf.images,B.source);return await this._loader._createTextureAsync(K,L,f,(K=>{T(K)}),A._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!A._textureInfo.nonColorData)}))}}j(QA),s(QA,!0,(K=>new YA(K)));const ZA="KHR_texture_transform";class xA{constructor(K){this.name=ZA,this._loader=K,this.enabled=this._loader.isExtensionUsed(ZA)}dispose(){this._loader=null}loadTextureInfoAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(G,B)=>await this._loader.loadTextureInfoAsync(K,A,(K=>{if(!(K instanceof mK.c))throw new Error(`${G}: Texture type not supported`);B.offset&&(K.uOffset=B.offset[0],K.vOffset=B.offset[1]),K.uRotationCenter=0,K.vRotationCenter=0,B.rotation&&(K.wAng=-B.rotation),B.scale&&(K.uScale=B.scale[0],K.vScale=B.scale[1]),void 0!=B.texCoord&&(K.coordinatesIndex=B.texCoord),T(K)}))))}}j(ZA),s(ZA,!0,(K=>new xA(K)));const JA="KHR_xmp_json_ld";class bA{constructor(K){this.name=JA,this.order=100,this._loader=K,this.enabled=this._loader.isExtensionUsed(JA)}dispose(){this._loader=null}onLoading(){var K,A,T;if(null===this._loader.rootBabylonMesh)return;const G=null===(K=this._loader.Sf.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld,B=null===(A=this._loader.Sf.asset)||void 0===A||null===(T=A.extensions)||void 0===T?void 0:T.KHR_xmp_json_ld;if(G&&B){const K=+B.packet;G.packets&&K<G.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=G.packets[K])}}}function PA(K,A,T,G){return L.DA.mT(A,T).scale(G)}function FA(K,A,T,G){return A[T]*G}function dA(K,A,T,G){return-A[T]*G}function NA(K,A,T,G){return A[T+1]*G}function DA(K,A,T,G){return A[T]*G*2}function mT(K){return{scale:[new zA(x.b.ANIMATIONTYPE_FLOAT,`${K}.uScale`,FA,(()=>2)),new zA(x.b.ANIMATIONTYPE_FLOAT,`${K}.vScale`,NA,(()=>2))],offset:[new zA(x.b.ANIMATIONTYPE_FLOAT,`${K}.uOffset`,FA,(()=>2)),new zA(x.b.ANIMATIONTYPE_FLOAT,`${K}.vOffset`,NA,(()=>2))],rotation:[new zA(x.b.ANIMATIONTYPE_FLOAT,`${K}.wAng`,dA,(()=>1))]}}j(JA),s(JA,!0,(K=>new bA(K)));class UA extends V.AnimationPropertyInfo{buildAnimations(K,A,T,G){return[{babylonAnimatable:K._babylonCamera,babylonAnimation:this._buildAnimation(A,T,G)}]}}class zA extends V.AnimationPropertyInfo{buildAnimations(K,A,T,G){const B=[];for(const L in K._data)B.push({babylonAnimatable:K._data[L].babylonMaterial,babylonAnimation:this._buildAnimation(A,T,G)});return B}}class gA extends V.AnimationPropertyInfo{buildAnimations(K,A,T,G){return[{babylonAnimatable:K._babylonLight,babylonAnimation:this._buildAnimation(A,T,G)}]}}(0,R.k)("/cameras/{}/orthographic/xmag",[new UA(x.b.ANIMATIONTYPE_FLOAT,"orthoLeft",dA,(()=>1)),new UA(x.b.ANIMATIONTYPE_FLOAT,"orthoRight",NA,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/ymag",[new UA(x.b.ANIMATIONTYPE_FLOAT,"orthoBottom",dA,(()=>1)),new UA(x.b.ANIMATIONTYPE_FLOAT,"orthoTop",NA,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/zfar",[new UA(x.b.ANIMATIONTYPE_FLOAT,"maxZ",FA,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/znear",[new UA(x.b.ANIMATIONTYPE_FLOAT,"If",FA,(()=>1))]),(0,R.k)("/cameras/{}/perspective/yfov",[new UA(x.b.ANIMATIONTYPE_FLOAT,"fov",FA,(()=>1))]),(0,R.k)("/cameras/{}/perspective/zfar",[new UA(x.b.ANIMATIONTYPE_FLOAT,"maxZ",FA,(()=>1))]),(0,R.k)("/cameras/{}/perspective/znear",[new UA(x.b.ANIMATIONTYPE_FLOAT,"If",FA,(()=>1))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new zA(x.b.ANIMATIONTYPE_COLOR3,"albedoColor",PA,(()=>4)),new zA(x.b.ANIMATIONTYPE_FLOAT,"alpha",(function(K,A,T,G){return A[T+3]*G}),(()=>4))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"metallic",FA,(()=>1))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"roughness",FA,(()=>1))]);const SA=mT("albedoTexture");(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",SA.scale),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",SA.offset),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",SA.rotation);const lA=mT("metallicTexture");(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",lA.scale),(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",lA.offset),(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",lA.rotation),(0,R.k)("/materials/{}/emissiveFactor",[new zA(x.b.ANIMATIONTYPE_COLOR3,"emissiveColor",PA,(()=>3))]);const uA=mT("bumpTexture");(0,R.k)("/materials/{}/normalTexture/scale",[new zA(x.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",FA,(()=>1))]),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",uA.scale),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",uA.offset),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",uA.rotation),(0,R.k)("/materials/{}/occlusionTexture/strength",[new zA(x.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",FA,(()=>1))]);const cA=mT("ambientTexture");(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",cA.scale),(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",cA.offset),(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",cA.rotation);const nA=mT("emissiveTexture");(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",nA.scale),(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",nA.offset),(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",nA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new zA(x.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new zA(x.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",FA,(()=>1))]);const HA=mT("anisotropy.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",HA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",HA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",HA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",FA,(()=>1))]);const eA=mT("clearCoat.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",eA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",eA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",eA.rotation);const pA=mT("clearCoat.bumpTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new zA(x.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",pA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",pA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",pA.rotation);const rA=mT("clearCoat.textureRoughness");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",rA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",rA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",rA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new zA(x.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new zA(x.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new zA(x.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new zA(x.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",FA,(()=>1))]);const hA=mT("iridescence.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",hA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",hA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",hA.rotation);const kA=mT("iridescence.thicknessTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",kA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",kA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",kA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new zA(x.b.ANIMATIONTYPE_COLOR3,"sheen.color",PA,(()=>3))]),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",FA,(()=>1))]);const sA=mT("sheen.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",sA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",sA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",sA.rotation);const jA=mT("sheen.textureRoughness");(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",jA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",jA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",jA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new zA(x.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",PA,(()=>3))]);const RA=mT("metallicReflectanceTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",RA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",RA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",RA.rotation);const vA=mT("reflectanceTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",vA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",vA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",vA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",FA,(()=>1))]);const IA=mT("subSurface.refractionIntensityTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",IA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",IA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",IA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new zA(x.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",PA,(()=>3))]),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new zA(x.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",FA,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",FA,(()=>1))]);const oA=mT("subSurface.thicknessTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",oA.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",oA.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",oA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new zA(x.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",FA,(()=>1))]);const WA=mT("subSurface.translucencyIntensityTexture");(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",WA.scale),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",WA.offset),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",WA.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new zA(x.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",PA,(()=>3))]);const iA=mT("subSurface.translucencyColorTexture");(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",iA.scale),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",iA.offset),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",iA.rotation),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new gA(x.b.ANIMATIONTYPE_COLOR3,"diffuse",PA,(()=>3))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new gA(x.b.ANIMATIONTYPE_FLOAT,"intensity",FA,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new gA(x.b.ANIMATIONTYPE_FLOAT,"range",FA,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new gA(x.b.ANIMATIONTYPE_FLOAT,"innerAngle",DA,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new gA(x.b.ANIMATIONTYPE_FLOAT,"angle",DA,(()=>1))]),(0,R.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new gA(x.b.ANIMATIONTYPE_COLOR3,"diffuse",PA,(()=>3))]),(0,R.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new gA(x.b.ANIMATIONTYPE_FLOAT,"intensity",FA,(()=>1))]);const VA="KHR_animation_pointer";class XA{constructor(K){this.name=VA,this._loader=K,this._pathToObjectConverter=(0,R.g)(this._loader.Sf)}get enabled(){return this._loader.isExtensionUsed(VA)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(K,A,T,G,B){var L;const f=null===(L=G.target.extensions)||void 0===L?void 0:L.KHR_animation_pointer;if(!f||!this._pathToObjectConverter)return null;"pointer"!==G.target.path&&P.d.Warn(`${K}/target/path: Value (${G.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=G.target.node&&P.d.Warn(`${K}/target/node: Value (${G.target.node}) must not be present when using the ${this.name} extension`);const O=`${K}/extensions/${this.name}`,C=f.pointer;if(!C)throw new Error(`${O}: Pointer is missing`);try{const L=this._pathToObjectConverter.convert(C);if(!L.info.interpolation)throw new Error(`${O}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(K,A,T,G,{object:L.object,info:L.info.interpolation},B)}catch(Q){return P.d.Warn(`${O}/pointer: Invalid pointer (${C}) skipped`),null}}}j(VA),s(VA,!0,(K=>new XA(K)));class qA{constructor(K,A,T){this.frame=K,this.action=A,this.onlyOnce=T,this.isDone=!1}_clone(){return new qA(this.frame,this.action,this.onlyOnce)}}var yA=T(12555),wA=T(12604),aA=T(12596);class MA{get loop(){return this._loop}set loop(K){K!==this._loop&&(this._loop=K,this.updateOptions({loop:K}))}get currentTime(){var K;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(K=wA.c.audioEngine)&&void 0!==K&&K.audioContext&&(this.isPlaying||this.isPaused)){const K=this.isPaused?0:wA.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+K}return 0}get spatialSound(){return this._spatialSound}set spatialSound(K){if(K==this._spatialSound)return;const A=this.isPlaying;this.pause(),K?(this._spatialSound=K,this._updateSpatialParameters()):this._disableSpatialSound(),A&&this.play()}constructor(K,A,T){var G;let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Y.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=B.PA.Zero(),this._localDirection=new B.PA(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=K,T=T||b.b.LastCreatedScene)if(this._scene=T,MA._SceneComponentInitialization(T),this._readyToPlayCallback=L,this._customAttenuationFunction=(K,A,T,G,B)=>A<T?K*(1-A/T):0,O&&(this.autoplay=O.autoplay||!1,this._loop=O.loop||!1,void 0!==O.volume&&(this._volume=O.volume),this._spatialSound=O.spatialSound??!1,this.maxDistance=O.maxDistance??100,this.useCustomAttenuation=O.useCustomAttenuation??!1,this.rolloffFactor=O.rolloffFactor||1,this.refDistance=O.refDistance||1,this.distanceModel=O.distanceModel||"linear",this._playbackRate=O.playbackRate||1,this._streaming=O.streaming??!1,this._length=O.length,this._offset=O.offset),null!==(G=wA.c.audioEngine)&&void 0!==G&&G.canUseWebAudio&&wA.c.audioEngine.audioContext){this._soundGain=wA.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let K=!0;if(A)try{"string"===typeof A?(this._urlType="String",this._url=A):A instanceof ArrayBuffer?this._urlType="ArrayBuffer":A instanceof HTMLMediaElement?this._urlType="MediaElement":A instanceof MediaStream?this._urlType="MediaStream":A instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(A)&&(this._urlType="Array");let T=[],G=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wA.c.audioEngine.audioContext.createMediaElementSource(A),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wA.c.audioEngine.audioContext.createMediaStreamSource(A),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":A.byteLength>0&&(G=!0,this._soundLoaded(A));break;case"AudioBuffer":this._audioBufferLoaded(A);break;case"String":T.push(A);case"Array":0===T.length&&(T=A);for(let K=0;K<T.length;K++){const A=T[K];if(G=O&&O.skipCodecCheck||-1!==A.indexOf(".mp3",A.length-4)&&wA.c.audioEngine.isMP3supported||-1!==A.indexOf(".ogg",A.length-4)&&wA.c.audioEngine.isOGGsupported||-1!==A.indexOf(".wav",A.length-4)||-1!==A.indexOf(".m4a",A.length-4)||-1!==A.indexOf(".mp4",A.length-4)||-1!==A.indexOf("blob:"),G){this._streaming?(this._htmlAudioElement=new Audio(A),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,f.Tools.SetCorsBehavior(A,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(A,(K=>{this._soundLoaded(K)}),void 0,!0,!0,(K=>{K&&P.d.Error("XHR "+K.status+" error on: "+A+"."),P.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:K=!1}K?G||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):P.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){P.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),wA.c.audioEngine&&!wA.c.audioEngine.WarnedWebAudioUnsupported&&(P.d.Error("Web Audio is not supported by your browser."),wA.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var K;null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(K){var A;null!==(A=wA.c.audioEngine)&&void 0!==A&&A.audioContext&&(this._audioBuffer=K,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(K){var A;null!==(A=wA.c.audioEngine)&&void 0!==A&&A.audioContext&&wA.c.audioEngine.audioContext.decodeAudioData(K,(K=>{this._audioBufferLoaded(K)}),(K=>{P.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+K)}))}setAudioBuffer(K){var A;null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&(this._audioBuffer=K,this._isReadyToPlay=!0)}updateOptions(K){K&&(this.loop=K.loop??this.loop,this.maxDistance=K.maxDistance??this.maxDistance,this.useCustomAttenuation=K.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=K.rolloffFactor??this.rolloffFactor,this.refDistance=K.refDistance??this.refDistance,this.distanceModel=K.distanceModel??this.distanceModel,this._playbackRate=K.playbackRate??this._playbackRate,this._length=K.length??void 0,this.spatialSound=K.spatialSound??this._spatialSound,this._setOffset(K.offset??void 0),this.setVolume(K.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var K;null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&wA.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??wA.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var K;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(K=this._soundPanner)||void 0===K||K.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var K;null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(K){var A;null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(K),this._isOutputConnected=!0)}setDirectionalCone(K,A,T){A<K?P.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=K,this._coneOuterAngle=A,this._coneOuterGain=T,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!=this._coneInnerAngle){var A;if(this._coneOuterAngle<K)return void P.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K,null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!=this._coneOuterAngle){var A;if(K<this._coneInnerAngle)return void P.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K,null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(K){var A;K.equals(this._position)||(this._position.G(K),null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(K){var A;this._localDirection=K,null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const K=this._connectedTransformNode.getWorldMatrix(),A=B.PA.TransformNormal(this._localDirection,K);A.normalize(),this._soundPanner.orientationX.value=A.x,this._soundPanner.orientationY.value=A.y,this._soundPanner.orientationZ.value=A.z}updateDistanceFromListener(){var K;if(null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const K=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.FA(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,K,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(K){this._customAttenuationFunction=K}play(K,A,T){var G;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(G=wA.c.audioEngine)&&void 0!==G&&G.audioContext)try{var B,L;this._clearTimeoutsAndObservers();let G=K?(null===(B=wA.c.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+K:null===(L=wA.c.audioEngine)||void 0===L?void 0:L.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=wA.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const K=()=>{var T;if(null!==(T=wA.c.audioEngine)&&void 0!==T&&T.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=A??0;const T=this._htmlAudioElement.play();void 0!==T&&T.catch((()=>{var A,T;(null===(A=wA.c.audioEngine)||void 0===A||A.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(T=wA.c.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{K()})))}))}else{var G;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(G=wA.c.audioEngine)||void 0===G?void 0:G.onAudioUnlockedObservable.addOnce((()=>{K()}))}};K()}}else{var f;const B=()=>{var B;if(null!==(B=wA.c.audioEngine)&&void 0!==B&&B.audioContext){var L;if(T=T||this._length,void 0!==A&&this._setOffset(A),this._soundSource){const K=this._soundSource;K.onended=()=>{K.disconnect()}}if(this._soundSource=null===(L=wA.c.audioEngine)||void 0===L?void 0:L.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var f;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==A&&(this._soundSource.loopStart=A),void 0!==T&&(this._soundSource.loopEnd=(0|A)+T),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},G=K?(null===(f=wA.c.audioEngine)||void 0===f?void 0:f.audioContext.currentTime)+K:wA.c.audioEngine.audioContext.currentTime;const B=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(G,B,this.loop?void 0:T)}}};"suspended"===(null===(f=wA.c.audioEngine)||void 0===f?void 0:f.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var K;"suspended"===(null===(K=wA.c.audioEngine)||void 0===K?void 0:K.audioContext.state)?(wA.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=wA.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{B()})))):B()}),500):B()}this._startTime=G,this.isPlaying=!0,this.isPaused=!1}catch(O){P.d.Error("Error while trying to play audio: "+this.name+", "+O.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(K){var A;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var T;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(T=this._streamingSource)||void 0===T||T.disconnect();this.isPlaying=!1}else if(null!==(A=wA.c.audioEngine)&&void 0!==A&&A.audioContext&&this._soundSource){const A=K?wA.c.audioEngine.audioContext.currentTime+K:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(A)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var K;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(K=wA.c.audioEngine)&&void 0!==K&&K.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wA.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(K,A){var T;null!==(T=wA.c.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._soundGain&&(A&&wA.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(wA.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,wA.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(K,wA.c.audioEngine.audioContext.currentTime+A)):this._soundGain.gain.value=K),this._volume=K}setPlaybackRate(K){this._playbackRate=K,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(K){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=K,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=K=>this._onRegisterAfterWorldMatrixUpdate(K),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(K){var A;if(K.getBoundingInfo){const A=K.getBoundingInfo();this.setPosition(A.boundingSphere.centerWorld)}else this.setPosition(K.absolutePosition);null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const K=()=>{(0,aA.f)((()=>this._isReadyToPlay),(()=>{T._audioBuffer=this.getAudioBuffer(),T._isReadyToPlay=!0,T.autoplay&&T.play(0,this._offset,this._length)}),void 0,300)},A={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},T=new MA(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,A);return this.useCustomAttenuation&&T.setAttenuationFunction(this._customAttenuationFunction),T.setPosition(this._position),T.setPlaybackRate(this._playbackRate),K(),T}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const K={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(K.connectedMeshId=this._connectedTransformNode.id),K.position=this._position.kf(),K.refDistance=this.refDistance,K.distanceModel=this.distanceModel,K.isDirectional=this._isDirectional,K.localDirectionToMesh=this._localDirection.kf(),K.coneInnerAngle=this._coneInnerAngle,K.coneOuterAngle=this._coneOuterAngle,K.coneOuterGain=this._coneOuterGain),K}static Parse(K,A,T,G){const L=K.name;let f;f=K.url?T+K.url:T+L;const O={autoplay:K.autoplay,loop:K.loop,volume:K.volume,spatialSound:K.spatialSound,maxDistance:K.maxDistance,rolloffFactor:K.rolloffFactor,refDistance:K.refDistance,distanceModel:K.distanceModel,playbackRate:K.playbackRate};let C;if(G){const K=()=>{(0,aA.f)((()=>G._isReadyToPlay),(()=>{C._audioBuffer=G.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)}),void 0,300)};C=new MA(L,new ArrayBuffer(0),A,null,O),K()}else C=new MA(L,f,A,(()=>{A.removePendingData(C)}),O),A.addPendingData(C);if(K.position){const A=B.PA.mT(K.position);C.setPosition(A)}if(K.isDirectional&&(C.setDirectionalCone(K.coneInnerAngle||360,K.coneOuterAngle||360,K.coneOuterGain||0),K.localDirectionToMesh)){const A=B.PA.mT(K.localDirectionToMesh);C.setLocalDirectionToMesh(A)}if(K.connectedMeshId){const T=A.getMeshById(K.connectedMeshId);T&&C.attachToMesh(T)}return K.metadata&&(C.metadata=K.metadata),C}_setOffset(K){this._offset!==K&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=K)}_clearTimeoutsAndObservers(){var K;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(K=wA.c.audioEngine)||void 0===K||K.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}MA._SceneComponentInitialization=K=>{throw(0,yA.c)("AudioSceneComponent")},(0,zK.c)("BABYLON.Sound",MA);class EA{constructor(K,A,T){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],A.length!==T.length)throw new Error("Sounds length does not equal weights length");this.loop=K,this._weights=T;let G=0;for(const L of T)G+=L;const B=G>0?1/G:0;for(let L=0;L<this._weights.length;L++)this._weights[L]*=B;this._sounds=A;for(const L of this._sounds)L.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!==this._coneInnerAngle){if(this._coneOuterAngle<K)return void P.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K;for(const A of this._sounds)A.directionalConeInnerAngle=K}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!==this._coneOuterAngle){if(K<this._coneInnerAngle)return void P.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K;for(const A of this._sounds)A.directionalConeOuterAngle=K}}get volume(){return this._volume}set volume(K){if(K!==this._volume)for(const A of this._sounds)A.setVolume(K)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(K){if(!this.isPaused){this.stop();const K=Math.random();let A=0;for(let T=0;T<this._weights.length;T++)if(A+=this._weights[T],K<=A){this._currentIndex=T;break}}const A=this._sounds[this._currentIndex??0];A.isReady()?A.play(0,this.isPaused?void 0:K):A.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class tA{constructor(K){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(K=K||b.b.LastCreatedScene)&&(this._scene=K,this.soundCollection=[],this._options=A,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var K;null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&wA.c.audioEngine.audioContext&&(this._outputAudioNode=wA.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(wA.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(wA.c.audioEngine&&wA.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(K){var A;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&K.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==K.soundTrackId&&(-1===K.soundTrackId?this._scene.mainSoundTrack.removeSound(K):this._scene.soundTracks&&this._scene.soundTracks[K.soundTrackId].removeSound(K)),this.soundCollection.push(K),K.soundTrackId=this.id}removeSound(K){const A=this.soundCollection.indexOf(K);-1!==A&&this.soundCollection.splice(A,1)}setVolume(K){var A;null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=K)}switchPanningModelToHRTF(){var K;if(null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let A=0;A<this.soundCollection.length;A++)this.soundCollection[A].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var K;if(null!==(K=wA.c.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let A=0;A<this.soundCollection.length;A++)this.soundCollection[A].switchPanningModelToEqualPower()}connectToAnalyser(K){var A;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=K,null!==(A=wA.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,wA.c.audioEngine.masterGain))}}var KT=T(12971),AT=T(12931),TT=T(12540);wA.c.AudioEngineFactory=(K,A,T)=>new GT(K,A,T);class GT{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Y.e,this.onAudioLockedObservable=new Y.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,TT.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const G=document.createElement("audio");this._hostElement=K,this._audioContext=A,this._audioDestination=T;try{G&&G.canPlayType&&(G.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||G.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(B){}try{G&&G.canPlayType&&G.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(B){}}lock(){this._triggerSuspendedState()}unlock(){var K,A;if("running"===(null===(K=this._audioContext)||void 0===K?void 0:K.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(A=this._audioContext)||void 0===A||A.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{P.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var K;null===(K=this._audioContext)||void 0===K||K.addEventListener("statechange",(()=>{var K;this.unlocked&&"running"!==(null===(K=this._audioContext)||void 0===K?void 0:K.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var K;return null!==(K=this._audioContext)&&void 0!==K&&K.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(K){this.canUseWebAudio=!1,P.d.Error("Web Audio: "+K.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(K){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const K=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",A=document.createElement("style");A.appendChild(document.createTextNode(K)),document.getElementsByTagName("head")[0].appendChild(A),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var K;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(K=this._audioContext)||void 0===K||K.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(K){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=K)}connectToAnalyser(K){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=K,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var BT=T(12553);(0,T(13924).h)(KT.e.NAME_AUDIO,((K,A,T,G)=>{let B,L=[];if(T.fJ=T.fJ||[],void 0!==K.fJ&&null!==K.fJ)for(let O=0,C=K.fJ.length;O<C;O++){var f;const C=K.fJ[O];null!==(f=wA.c.audioEngine)&&void 0!==f&&f.canUseWebAudio?(C.url||(C.url=C.name),L[C.url]?T.fJ.push(MA.Parse(C,A,G,L[C.url])):(B=MA.Parse(C,A,G),L[C.url]=B,T.fJ.push(B))):T.fJ.push(new MA(C.name,null,A))}L=[]})),Object.defineProperty(AT.c.prototype,"mainSoundTrack",{get:function(){let K=this._getComponent(KT.e.NAME_AUDIO);return K||(K=new LT(this),this.o(K)),this._mainSoundTrack||(this._mainSoundTrack=new tA(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),AT.c.prototype.getSoundByName=function(K){let A;for(A=0;A<this.mainSoundTrack.soundCollection.length;A++)if(this.mainSoundTrack.soundCollection[A].name===K)return this.mainSoundTrack.soundCollection[A];if(this.soundTracks)for(let T=0;T<this.soundTracks.length;T++)for(A=0;A<this.soundTracks[T].soundCollection.length;A++)if(this.soundTracks[T].soundCollection[A].name===K)return this.soundTracks[T].soundCollection[A];return null},Object.defineProperty(AT.c.prototype,"audioEnabled",{get:function(){let K=this._getComponent(KT.e.NAME_AUDIO);return K||(K=new LT(this),this.o(K)),K.audioEnabled},set:function(K){let A=this._getComponent(KT.e.NAME_AUDIO);A||(A=new LT(this),this.o(A)),K?A.enableAudio():A.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(AT.c.prototype,"headphone",{get:function(){let K=this._getComponent(KT.e.NAME_AUDIO);return K||(K=new LT(this),this.o(K)),K.headphone},set:function(K){let A=this._getComponent(KT.e.NAME_AUDIO);A||(A=new LT(this),this.o(A)),K?A.switchAudioModeForHeadphones():A.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(AT.c.prototype,"audioListenerPositionProvider",{get:function(){let K=this._getComponent(KT.e.NAME_AUDIO);return K||(K=new LT(this),this.o(K)),K.audioListenerPositionProvider},set:function(K){let A=this._getComponent(KT.e.NAME_AUDIO);if(A||(A=new LT(this),this.o(A)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");A.audioListenerPositionProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(AT.c.prototype,"audioListenerRotationProvider",{get:function(){let K=this._getComponent(KT.e.NAME_AUDIO);return K||(K=new LT(this),this.o(K)),K.audioListenerRotationProvider},set:function(K){let A=this._getComponent(KT.e.NAME_AUDIO);if(A||(A=new LT(this),this.o(A)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");A.audioListenerRotationProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(AT.c.prototype,"audioPositioningRefreshRate",{get:function(){let K=this._getComponent(KT.e.NAME_AUDIO);return K||(K=new LT(this),this.o(K)),K.audioPositioningRefreshRate},set:function(K){let A=this._getComponent(KT.e.NAME_AUDIO);A||(A=new LT(this),this.o(A)),A.audioPositioningRefreshRate=K},enumerable:!0,configurable:!0});class LT{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(K){this.name=KT.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new B.PA,this._cachedCameraPosition=new B.PA,this._lastCheck=0,this._invertMatrixTemp=new B.Matrix,this._cameraDirectionTemp=new B.PA,(K=K||b.b.LastCreatedScene)&&(this.dA=K,K.soundTracks=[],K.fJ=[])}register(){this.dA._afterRenderStage.registerStep(KT.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(K){if(K.fJ=[],this.dA.soundTracks)for(let A=0;A<this.dA.soundTracks.length;A++){const T=this.dA.soundTracks[A];for(let A=0;A<T.soundCollection.length;A++)K.fJ.push(T.soundCollection[A].serialize())}}addFromContainer(K){if(K.fJ)for(const A of K.fJ)A.play(),A.autoplay=!0,this.dA.mainSoundTrack.addSound(A)}removeFromContainer(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(K.fJ)for(const T of K.fJ)T.stop(),T.autoplay=!1,this.dA.mainSoundTrack.removeSound(T),A&&T.dispose()}dispose(){const K=this.dA;if(K._mainSoundTrack&&K.mainSoundTrack.dispose(),K.soundTracks)for(let A=0;A<K.soundTracks.length;A++)K.soundTracks[A].dispose()}disableAudio(){const K=this.dA;let A;for(this._audioEnabled=!1,wA.c.audioEngine&&wA.c.audioEngine.audioContext&&wA.c.audioEngine.audioContext.suspend(),A=0;A<K.mainSoundTrack.soundCollection.length;A++)K.mainSoundTrack.soundCollection[A].pause();if(K.soundTracks)for(A=0;A<K.soundTracks.length;A++)for(let T=0;T<K.soundTracks[A].soundCollection.length;T++)K.soundTracks[A].soundCollection[T].pause()}enableAudio(){const K=this.dA;let A;for(this._audioEnabled=!0,wA.c.audioEngine&&wA.c.audioEngine.audioContext&&wA.c.audioEngine.audioContext.resume(),A=0;A<K.mainSoundTrack.soundCollection.length;A++)K.mainSoundTrack.soundCollection[A].isPaused&&K.mainSoundTrack.soundCollection[A].play();if(K.soundTracks)for(A=0;A<K.soundTracks.length;A++)for(let T=0;T<K.soundTracks[A].soundCollection.length;T++)K.soundTracks[A].soundCollection[T].isPaused&&K.soundTracks[A].soundCollection[T].play()}switchAudioModeForHeadphones(){const K=this.dA;if(this._headphone=!0,K.mainSoundTrack.switchPanningModelToHRTF(),K.soundTracks)for(let A=0;A<K.soundTracks.length;A++)K.soundTracks[A].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const K=this.dA;if(this._headphone=!1,K.mainSoundTrack.switchPanningModelToEqualPower(),K.soundTracks)for(let A=0;A<K.soundTracks.length;A++)K.soundTracks[A].switchPanningModelToEqualPower()}_afterRender(){const K=BT.d.Now;if(this._lastCheck&&K-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=K;const A=this.dA;if(!this._audioEnabled||!A._mainSoundTrack||!A.soundTracks||0===A._mainSoundTrack.soundCollection.length&&1===A.soundTracks.length)return;const T=wA.c.audioEngine;if(T&&T.audioContext){let K,G=A.activeCamera;if(A.activeCameras&&A.activeCameras.length>0&&(G=A.activeCameras[0]),this.audioListenerPositionProvider){const K=this.audioListenerPositionProvider();T.audioContext.listener.setPosition(K.x||0,K.y||0,K.z||0)}else G?this._cachedCameraPosition.equals(G.globalPosition)||(this._cachedCameraPosition.G(G.globalPosition),T.audioContext.listener.setPosition(G.globalPosition.x,G.globalPosition.y,G.globalPosition.z)):T.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const K=this.audioListenerRotationProvider();T.audioContext.listener.setOrientation(K.x||0,K.y||0,K.z||0,0,1,0)}else G?(G.rigCameras&&G.rigCameras.length>0&&(G=G.rigCameras[0]),G.getViewMatrix().invertToRef(this._invertMatrixTemp),B.PA.TransformNormalToRef(LT._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.G(this._cameraDirectionTemp),T.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):T.audioContext.listener.setOrientation(0,0,0,0,1,0);for(K=0;K<A.mainSoundTrack.soundCollection.length;K++){const T=A.mainSoundTrack.soundCollection[K];T.useCustomAttenuation&&T.updateDistanceFromListener()}if(A.soundTracks)for(K=0;K<A.soundTracks.length;K++)for(let T=0;T<A.soundTracks[K].soundCollection.length;T++){const G=A.soundTracks[K].soundCollection[T];G.useCustomAttenuation&&G.updateDistanceFromListener()}}}}LT._CameraDirection=new B.PA(0,0,-1),MA._SceneComponentInitialization=K=>{let A=K._getComponent(KT.e.NAME_AUDIO);A||(A=new LT(K),K.o(A))};const fT="MSFT_audio_emitter";class OT{constructor(K){this.name=fT,this._loader=K,this.enabled=this._loader.isExtensionUsed(fT)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const K=this._loader.Sf.extensions;if(K&&K[this.name]){const A=K[this.name];this._clips=A.clips,this._emitters=A.emitters,o.Assign(this._clips),o.Assign(this._emitters)}}loadSceneAsync(K,A){return i.LoadExtensionAsync(K,A,this.name,(async(T,G)=>{const B=new Array;B.push(this._loader.loadSceneAsync(K,A));for(const K of G.emitters){const A=o.Get(`${T}/emitters`,this._emitters,K);if(void 0!=A.refDistance||void 0!=A.maxDistance||void 0!=A.rolloffFactor||void 0!=A.distanceModel||void 0!=A.innerAngle||void 0!=A.outerAngle)throw new Error(`${T}: Direction or Distance properties are not allowed on emitters attached to a scene`);B.push(this._loadEmitterAsync(`${T}/emitters/${A.index}`,A))}await Promise.all(B)}))}loadNodeAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(K,G)=>{const L=new Array,O=await this._loader.loadNodeAsync(K,A,(A=>{for(const T of G.emitters){const G=o.Get(`${K}/emitters`,this._emitters,T);L.push(this._loadEmitterAsync(`${K}/emitters/${G.index}`,G).then((()=>{for(const K of G._babylonSounds)K.attachToMesh(A),void 0==G.innerAngle&&void 0==G.outerAngle||(K.setLocalDirectionToMesh(B.PA.Forward()),K.setDirectionalCone(2*f.Tools.ToDegrees(void 0==G.innerAngle?Math.PI:G.innerAngle),2*f.Tools.ToDegrees(void 0==G.outerAngle?Math.PI:G.outerAngle),0))})))}T(A)}));return await Promise.all(L),O}))}loadAnimationAsync(K,A){return i.LoadExtensionAsync(K,A,this.name,(async(T,G)=>{const B=await this._loader.loadAnimationAsync(K,A),L=new Array;o.Assign(G.events);for(const f of G.events)L.push(this._loadAnimationEventAsync(`${T}/events/${f.index}`,K,A,f,B));return await Promise.all(L),B}))}_loadClipAsync(K,A){if(A._objectURL)return A._objectURL;let T;if(A.uri)T=this._loader.loadUriAsync(K,A,A.uri);else{const G=o.Get(`${K}/bufferView`,this._loader.Sf.bufferViews,A.bufferView);T=this._loader.loadBufferViewAsync(`/bufferViews/${G.index}`,G)}return A._objectURL=T.then((K=>URL.createObjectURL(new Blob([K],{type:A.mimeType})))),A._objectURL}_loadEmitterAsync(K,A){if(A._babylonSounds=A._babylonSounds||[],!A._babylonData){const K=new Array,T=A.name||`emitter${A.index}`,G={loop:!1,autoplay:!1,volume:void 0==A.volume?1:A.volume};for(let L=0;L<A.clips.length;L++){const B=`/extensions/${this.name}/clips`,f=o.Get(B,this._clips,A.clips[L].clip);K.push(this._loadClipAsync(`${B}/${A.clips[L].clip}`,f).then((K=>{const B=A._babylonSounds[L]=new MA(T,K,this._loader.babylonScene,null,G);B.refDistance=A.refDistance||1,B.maxDistance=A.maxDistance||256,B.rolloffFactor=A.rolloffFactor||1,B.distanceModel=A.distanceModel||"exponential"})))}const B=Promise.all(K).then((()=>{const K=A.clips.map((K=>K.weight||1)),T=new EA(A.loop||!1,A._babylonSounds,K);A.innerAngle&&(T.directionalConeInnerAngle=2*f.Tools.ToDegrees(A.innerAngle)),A.outerAngle&&(T.directionalConeOuterAngle=2*f.Tools.ToDegrees(A.outerAngle)),A.volume&&(T.volume=A.volume),A._babylonData.sound=T}));A._babylonData={loaded:B}}return A._babylonData.loaded}_getEventAction(K,A,T,G,B){switch(T){case"play":return K=>{const T=(B||0)+(K-G);A.play(T)};case"stop":return()=>{A.stop()};case"pause":return()=>{A.pause()};default:throw new Error(`${K}: Unsupported action ${T}`)}}_loadAnimationEventAsync(K,A,T,G,B){if(0==B.targetedAnimations.length)return Promise.resolve();const L=B.targetedAnimations[0],f=G.BA,O=o.Get(`/extensions/${this.name}/emitters`,this._emitters,f);return this._loadEmitterAsync(K,O).then((()=>{const A=O._babylonData.sound;if(A){const T=new qA(G.time,this._getEventAction(K,A,G.action,G.time,G.startOffset));L.animation.addEvent(T),B.onAnimationGroupEndObservable.add((()=>{A.stop()})),B.onAnimationGroupPauseObservable.add((()=>{A.pause()}))}}))}}j(fT),s(fT,!0,(K=>new OT(K)));const CT="MSFT_lod";class QT{constructor(K){var A;this.name=CT,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Y.e,this.onMaterialLODsLoadedObservable=new Y.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=K,this.maxLODsToLoad=(null===(A=this._loader.parent.extensionOptions[CT])||void 0===A?void 0:A.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(CT)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let K=0;K<this._nodePromiseLODs.length;K++){const A=Promise.all(this._nodePromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Node LOD ${K}`),this._loader.log(`Loaded node LOD ${K}`)),this.onNodeLODsLoadedObservable.notifyObservers(K),K!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${K+1}`),this._loadBufferLOD(this._nodeBufferLODs,K+1),this._nodeSignalLODs[K]&&this._nodeSignalLODs[K].resolve())}));this._loader._completePromises.push(A)}for(let K=0;K<this._materialPromiseLODs.length;K++){const A=Promise.all(this._materialPromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Material LOD ${K}`),this._loader.log(`Loaded material LOD ${K}`)),this.onMaterialLODsLoadedObservable.notifyObservers(K),K!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${K+1}`),this._loadBufferLOD(this._materialBufferLODs,K+1),this._materialSignalLODs[K]&&this._materialSignalLODs[K].resolve())}));this._loader._completePromises.push(A)}}loadSceneAsync(K,A){const T=this._loader.loadSceneAsync(K,A);return this._loadBufferLOD(this._bufferLODs,0),T}loadNodeAsync(K,A,T){return i.LoadExtensionAsync(K,A,this.name,(async(K,B)=>{let L;const f=this._getLODs(K,A,this._loader.Sf.nodes,B.ids);this._loader.logOpen(`${K}`);for(let A=0;A<f.length;A++){const K=f[A];0!==A&&(this._nodeIndexLOD=A,this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new G);const B=K=>{T(K),K.QC(!1)},O=this._loader.loadNodeAsync(`/nodes/${K.index}`,K,B).then((K=>{if(0!==A){const K=f[A-1];K._babylonTransformNode&&(this._disposeTransformNode(K._babylonTransformNode),delete K._babylonTransformNode)}return K.QC(!0),K}));this._nodePromiseLODs[A]=this._nodePromiseLODs[A]||[],0===A?L=O:(this._nodeIndexLOD=null,this._nodePromiseLODs[A].push(O))}return this._loader.logClose(),await L}))}_loadMaterialAsync(K,A,T,G,B){return this._nodeIndexLOD?null:i.LoadExtensionAsync(K,A,this.name,(async(K,L)=>{let f;const O=this._getLODs(K,A,this._loader.Sf.materials,L.ids);this._loader.logOpen(`${K}`);for(let A=0;A<O.length;A++){const K=O[A];0!==A&&(this._materialIndexLOD=A);const L=this._loader._loadMaterialAsync(`/materials/${K.index}`,K,T,G,(K=>{0===A&&B(K)})).then((K=>{if(0!==A){B(K);const T=O[A-1]._data;T[G]&&(this._disposeMaterials([T[G].babylonMaterial]),delete T[G])}return K}));this._materialPromiseLODs[A]=this._materialPromiseLODs[A]||[],0===A?f=L:(this._materialIndexLOD=null,this._materialPromiseLODs[A].push(L))}return this._loader.logClose(),await f}))}_loadUriAsync(K,A,T){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const B=this._nodeIndexLOD-1;return this._nodeSignalLODs[B]=this._nodeSignalLODs[B]||new G,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(K,A,T)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const B=this._materialIndexLOD-1;return this._materialSignalLODs[B]=this._materialSignalLODs[B]||new G,this._materialSignalLODs[B].promise.then((async()=>await this._loader.loadUriAsync(K,A,T)))}return null}loadBufferAsync(K,A,T,B){if(this._loader.parent.useRangeRequests&&!A.uri){if(!this._loader.bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);const A=async(K,A)=>{const L=T,f=L+B-1;let O=K[A];return O?(O.start=Math.min(O.start,L),O.end=Math.max(O.end,f)):(O={start:L,end:f,loaded:new G},K[A]=O),await O.loaded.promise.then((K=>new Uint8Array(K.buffer,K.byteOffset+T-O.start,B)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?A(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?A(this._materialBufferLODs,this._materialIndexLOD):A(this._bufferLODs,0)}return null}_loadBufferLOD(K,A){const T=K[A];T&&(this._loader.log(`Loading buffer range [${T.start}-${T.end}]`),this._loader.bin.readAsync(T.start,T.end-T.start+1).then((K=>{T.loaded.resolve(K)}),(K=>{T.loaded.reject(K)})))}_getLODs(K,A,T,G){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const B=[];for(let L=G.length-1;L>=0;L--)if(B.push(o.Get(`${K}/ids/${G[L]}`,T,G[L])),B.length===this.maxLODsToLoad)return B;return B.push(A),B}_disposeTransformNode(K){const A=[],T=K.material;T&&A.push(T);for(const B of K.getChildMeshes())B.material&&A.push(B.material);K.dispose();const G=A.filter((K=>this._loader.babylonScene.meshes.every((A=>A.material!=K))));this._disposeMaterials(G)}_disposeMaterials(K){const A={};for(const T of K){for(const K of T.getActiveTextures())A[K.uniqueId]=K;T.dispose()}for(const T in A)for(const K of this._loader.babylonScene.materials)K.hasTexture(A[T])&&delete A[T];for(const T in A)A[T].dispose()}}j(CT),s(CT,!0,(K=>new QT(K)));const YT="MSFT_minecraftMesh";class ZT{constructor(K){this.name=YT,this._loader=K,this.enabled=this._loader.isExtensionUsed(YT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtraAsync(K,A,this.name,(async(G,B)=>{if(B){if(!(T instanceof D.c))throw new Error(`${G}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(K,A,T);return T.needAlphaBlending()&&(T.forceDepthWrite=!0,T.separateCullingPass=!0),T.tf=T.forceDepthWrite,T.twoSidedLighting=!0,await B}}))}}j(YT),s(YT,!0,(K=>new ZT(K)));const xT="MSFT_sRGBFactors";class JT{constructor(K){this.name=xT,this._loader=K,this.enabled=this._loader.isExtensionUsed(xT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,A,T){return i.LoadExtraAsync(K,A,this.name,(async(G,B)=>{if(B){if(!(T instanceof D.c))throw new Error(`${G}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(K,A,T),L=T.SK().getEngine().useExactSrgbConversions;return T.albedoTexture||T.albedoColor.toLinearSpaceToRef(T.albedoColor,L),T.reflectivityTexture||T.reflectivityColor.toLinearSpaceToRef(T.reflectivityColor,L),await B}}))}}j(xT),s(xT,!0,(K=>new JT(K)));var bT=T(14215);const PT={};var FT=T(14283),dT=T(14259),NT=T(14223),DT=T(14237);function mG(K,A){for(const T of K)for(const K of T.dataOutputs)if(K.uniqueId===A)return K;throw new Error("Could not find data out connection with unique id "+A)}function UT(K,A){for(const T of K)if(T instanceof dT.e)for(const K of T.signalInputs)if(K.uniqueId===A)return K;throw new Error("Could not find signal in connection with unique id "+A)}async function zT(K,A){const G=await Promise.all(K.allBlocks.map((async K=>{const A=function(K){switch(K){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([T.e(78),T.e(79)]).then(T.bind(T,15832))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await T.e(80).then(T.bind(T,15834))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await T.e(81).then(T.bind(T,15842))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await T.e(82).then(T.bind(T,15848))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await T.e(83).then(T.bind(T,15851))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await T.e(84).then(T.bind(T,15854))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await T.e(85).then(T.bind(T,15862))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await T.e(86).then(T.bind(T,15864))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await T.e(87).then(T.bind(T,15866))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await T.e(90).then(T.bind(T,15901))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await T.e(90).then(T.bind(T,15901))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await T.e(90).then(T.bind(T,15901))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await T.e(90).then(T.bind(T,15901))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await T.e(95).then(T.bind(T,15907))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await T.e(96).then(T.bind(T,15914))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await T.e(97).then(T.bind(T,15922))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await T.e(98).then(T.bind(T,15929))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await T.e(99).then(T.bind(T,15934))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await T.e(100).then(T.bind(T,15941))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await T.e(101).then(T.bind(T,15946))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await T.e(102).then(T.bind(T,15951))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await T.e(103).then(T.bind(T,15958))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await T.e(104).then(T.bind(T,15960))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await T.e(105).then(T.bind(T,15969))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await T.e(106).then(T.bind(T,15974))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await T.e(107).then(T.bind(T,15980))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await T.e(108).then(T.bind(T,15982))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await T.e(109).then(T.bind(T,15989))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await T.e(110).then(T.bind(T,15991))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await T.e(111).then(T.bind(T,15999))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await T.e(112).then(T.bind(T,16008))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await T.e(113).then(T.bind(T,16011))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await T.e(92).then(T.bind(T,16018))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await T.e(114).then(T.bind(T,16022))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await T.e(115).then(T.bind(T,16031))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await T.e(116).then(T.bind(T,16034))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await T.e(93).then(T.bind(T,16043))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await T.e(88).then(T.bind(T,15871))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await T.e(94).then(T.bind(T,16046))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await T.e(89).then(T.bind(T,15894))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await T.e(90).then(T.bind(T,15901))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await T.e(90).then(T.bind(T,15901))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await T.e(91).then(T.bind(T,16048))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await T.e(91).then(T.bind(T,16048))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await T.e(91).then(T.bind(T,16048))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await T.e(91).then(T.bind(T,16048))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await T.e(91).then(T.bind(T,16048))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await T.e(91).then(T.bind(T,16048))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await T.e(117).then(T.bind(T,16054))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await T.e(118).then(T.bind(T,16060))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await T.e(119).then(T.bind(T,16068))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await T.e(120).then(T.bind(T,16076))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await T.e(121).then(T.bind(T,16085))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await T.e(122).then(T.bind(T,16088))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await T.e(123).then(T.bind(T,16094))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await T.e(124).then(T.bind(T,16099))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await T.e(125).then(T.bind(T,16108))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await T.e(126).then(T.bind(T,16112))).FlowGraphDataSwitchBlock;default:if(PT[K])return PT[K];throw new Error(`Unknown block name ${K}`)}}(K.className);return await A()})));return function(K,A,T){const G=A.coordinator.createGraph(),B=[],L=A.valueParseFunction??NT.d;for(let f=0;f<K.allBlocks.length;f++){const O=ST(K.allBlocks[f],{dA:A.coordinator.config.dA,pathConverter:A.pathConverter,assetsContainer:A.coordinator.config.dA,valueParseFunction:L},T[f]);B.push(O),O instanceof FT.e&&G.addEventBlock(O)}for(const f of B){for(const K of f.dataInputs)for(const A of K.connectedPointIds){const T=mG(B,A);K.connectTo(T)}if(f instanceof dT.e)for(const K of f.signalOutputs)for(const A of K.connectedPointIds){const T=UT(B,A);K.connectTo(T)}}for(const f of K.executionContexts)gT(f,{graph:G,valueParseFunction:L},K.rightHanded);return G}(K,A,G)}function gT(K,A,T){const G=A.graph.createContext();K.enableLogging&&(G.enableLogging=!0),G.treatDataAsRightHanded=T||!1;const B=A.valueParseFunction??NT.d;G.uniqueId=K.uniqueId;const L=G.SK();if(K._assetsContext){var f,O,C,Q,Y,Z,x,J,b,P;const A=K._assetsContext,T={meshes:null===(f=A.meshes)||void 0===f?void 0:f.map((K=>L.getMeshById(K))),lights:null===(O=A.lights)||void 0===O?void 0:O.map((K=>L.getLightByName(K))),cameras:null===(C=A.cameras)||void 0===C?void 0:C.map((K=>L.getCameraByName(K))),materials:null===(Q=A.materials)||void 0===Q?void 0:Q.map((K=>L.getMaterialById(K))),textures:null===(Y=A.textures)||void 0===Y?void 0:Y.map((K=>L.getTextureByName(K))),animations:null===(Z=A.animations)||void 0===Z?void 0:Z.map((K=>L.animations.find((A=>A.name===K)))),skeletons:null===(x=A.skeletons)||void 0===x?void 0:x.map((K=>L.getSkeletonByName(K))),Nx:null===(J=A.Nx)||void 0===J?void 0:J.map((K=>L.getParticleSystemById(K))),animationGroups:null===(b=A.animationGroups)||void 0===b?void 0:b.map((K=>L.getAnimationGroupByName(K))),transformNodes:null===(P=A.transformNodes)||void 0===P?void 0:P.map((K=>L.getTransformNodeById(K))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],fJ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};G.assetsContext=T}for(const F in K._userVariables){const A=B(F,K._userVariables,G.assetsContext,L);G.userVariables[F]=A}for(const F in K._connectionValues){const A=B(F,K._connectionValues,G.assetsContext,L);G._setConnectionValueByKey(F,A)}return G}function ST(K,A,T){const G={},B=A.valueParseFunction??NT.d;if(K.config)for(const f in K.config)G[f]=B(f,K.config,A.assetsContainer||A.dA,A.dA);if((0,NT.i)(K.className)){if(!A.pathConverter)throw new Error("Path converter is required for this block");G.pathConverter=A.pathConverter}const L=new T(G);L.uniqueId=K.uniqueId;for(let f=0;f<K.dataInputs.length;f++){const A=L.getDataInput(K.dataInputs[f].name);if(!A)throw new Error("Could not find data input with name "+K.dataInputs[f].name+" in block "+K.className);A.deserialize(K.dataInputs[f])}for(let f=0;f<K.dataOutputs.length;f++){const A=L.getDataOutput(K.dataOutputs[f].name);if(!A)throw new Error("Could not find data output with name "+K.dataOutputs[f].name+" in block "+K.className);A.deserialize(K.dataOutputs[f])}return L.metadata=K.metadata,L.deserialize&&L.deserialize(K),L}function lT(K){const[A,T]=K.split(":");return uT({op:A,extension:T})}function uT(K){var A;let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const G=K.extension?null===(A=nT[K.extension])||void 0===A?void 0:A[K.op]:HT[K.op];if(!G&&(P.d.Warn(`No mapping found for operation ${K.op} and extension ${K.extension||"KHR_interactivity"}`),T)){const A={},T={flows:{}};if(K.inputValueSockets){A.values={};for(const T in K.inputValueSockets)A.values[T]={name:T}}return K.outputValueSockets&&(T.values={},Object.keys(K.outputValueSockets).forEach((K=>{T.values[K]={name:K}}))),{hY:[],inputs:A,outputs:T}}return G}function cT(K,A,T){nT[A]||(nT[A]={}),nT[A][K]=T}const nT={BABYLON:{"flow/log":{hY:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},HT={"event/onStart":{hY:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{hY:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{hY:["FlowGraphSendCustomEventBlock"],extraProcessor(K,A,T,G,B){if("event/send"!==A.op||!K.configuration||1!==Object.keys(K.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=K.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const f=G.arrays.events[L],O=B[0];return O.config||(O.config={}),O.config.eventId=f.eventId,O.config.eventData=f.eventData,B}},"event/receive":{hY:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(K,A){var T;if(!K.configuration)return P.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const G=K.configuration.event;if(!G)return P.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const B=G.value[0];if("number"!==typeof B)return P.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(T=A.events)||void 0===T?void 0:T[B])?{valid:!0}:(P.d.Error(`Event with id ${B} not found`),{valid:!1,error:`Event with id ${B} not found`})},extraProcessor(K,A,T,G,B){if("event/receive"!==A.op||!K.configuration||1!==Object.keys(K.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=K.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const f=G.arrays.events[L],O=B[0];return O.config||(O.config={}),O.config.eventId=f.eventId,O.config.eventData=f.eventData,B}},"math/e":eT("FlowGraphEBlock"),"math/pi":eT("FlowGraphPIBlock"),"math/inf":eT("FlowGraphInfBlock"),"math/nan":eT("FlowGraphNaNBlock"),"math/abs":eT("FlowGraphAbsBlock"),"math/sign":eT("FlowGraphSignBlock"),"math/trunc":eT("FlowGraphTruncBlock"),"math/floor":eT("FlowGraphFloorBlock"),"math/ceil":eT("FlowGraphCeilBlock"),"math/round":{hY:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B){var L;return(L=B[0]).config||(L.config={}),B[0].config.roundHalfAwayFromZero=!0,B}},"math/fract":eT("FlowGraphFractBlock"),"math/neg":eT("FlowGraphNegationBlock"),"math/add":eT("FlowGraphAddBlock",["a","b"],!0),"math/sub":eT("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{hY:["FlowGraphMultiplyBlock"],extraProcessor(K,A,T,G,B){var L;(L=B[0]).config||(L.config={}),B[0].config.useMatrixPerComponent=!0,B[0].config.preventIntegerFloatArithmetic=!0;let f=-1;return Object.keys(K.values||{}).find((A=>{var T;return void 0!==(null===(T=K.values)||void 0===T?void 0:T[A].type)&&(f=K.values[A].type,!0)})),-1!==f&&(B[0].config.type=G.arrays.types[f].flowGraphType),B},validation:K=>K.values?pT(K):{valid:!0}},"math/div":eT("FlowGraphDivideBlock",["a","b"],!0),"math/rem":eT("FlowGraphModuloBlock",["a","b"]),"math/min":eT("FlowGraphMinBlock",["a","b"]),"math/max":eT("FlowGraphMaxBlock",["a","b"]),"math/clamp":eT("FlowGraphClampBlock",["a","b","c"]),"math/saturate":eT("FlowGraphSaturateBlock"),"math/mix":eT("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":eT("FlowGraphEqualityBlock",["a","b"]),"math/lt":eT("FlowGraphLessThanBlock",["a","b"]),"math/le":eT("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":eT("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":eT("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":eT("FlowGraphIsNaNBlock"),"math/isinf":eT("FlowGraphIsInfBlock"),"math/select":{hY:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{hY:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":eT("FlowGraphSinBlock"),"math/cos":eT("FlowGraphCosBlock"),"math/tan":eT("FlowGraphTanBlock"),"math/asin":eT("FlowGraphASinBlock"),"math/acos":eT("FlowGraphACosBlock"),"math/atan":eT("FlowGraphATanBlock"),"math/atan2":eT("FlowGraphATan2Block",["a","b"]),"math/sinh":eT("FlowGraphSinhBlock"),"math/cosh":eT("FlowGraphCoshBlock"),"math/tanh":eT("FlowGraphTanhBlock"),"math/asinh":eT("FlowGraphASinhBlock"),"math/acosh":eT("FlowGraphACoshBlock"),"math/atanh":eT("FlowGraphATanhBlock"),"math/exp":eT("FlowGraphExponentialBlock"),"math/log":eT("FlowGraphLogBlock"),"math/log2":eT("FlowGraphLog2Block"),"math/log10":eT("FlowGraphLog10Block"),"math/sqrt":eT("FlowGraphSquareRootBlock"),"math/cbrt":eT("FlowGraphCubeRootBlock"),"math/pow":eT("FlowGraphPowerBlock",["a","b"]),"math/length":eT("FlowGraphLengthBlock"),"math/normalize":eT("FlowGraphNormalizeBlock"),"math/dot":eT("FlowGraphDotBlock",["a","b"]),"math/cross":eT("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":eT("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":eT("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{hY:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{hY:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{hY:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{hY:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{hY:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{hY:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{hY:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":eT("FlowGraphTransposeBlock"),"math/determinant":eT("FlowGraphDeterminantBlock"),"math/inverse":eT("FlowGraphInvertMatrixBlock"),"math/matmul":eT("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{hY:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"vO",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B,L){const f=B[0].dataInputs.find((K=>"rotationQuaternion"===K.name));if(!f)throw new Error("Rotation quaternion input not found");return L._connectionValues[f.uniqueId]&&(L._connectionValues[f.uniqueId].type="Quaternion"),B}},"math/matDecompose":{hY:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"vO"}}}},"math/quatConjugate":eT("FlowGraphConjugateBlock",["a"]),"math/quatMul":{hY:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B){var L;return(L=B[0]).config||(L.config={}),B[0].config.type="Quaternion",B}},"math/quatAngleBetween":eT("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{hY:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":eT("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":eT("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{hY:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B){var L;return(L=B[0]).config||(L.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract2x2":{hY:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{hY:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B){var L;return(L=B[0]).config||(L.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract3x3":{hY:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{hY:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B){var L;return(L=B[0]).config||(L.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract4x4":{hY:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{hY:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B,L){var f,O;(O=B[0]).config||(O.config={});const C=B[0].dataInputs[0];return B[0].config.valueType=(null===(f=L._connectionValues[C.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",B}},"math/and":{hY:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B,L){var f,O,C;(C=B[0]).config||(C.config={});const Q=B[0].dataInputs[0],Y=B[0].dataInputs[1];return B[0].config.valueType=(null===(f=L._connectionValues[Q.uniqueId])||void 0===f?void 0:f.type)??(null===(O=L._connectionValues[Y.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",B}},"math/or":{hY:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B,L){var f,O,C;(C=B[0]).config||(C.config={});const Q=B[0].dataInputs[0],Y=B[0].dataInputs[1];return B[0].config.valueType=(null===(f=L._connectionValues[Q.uniqueId])||void 0===f?void 0:f.type)??(null===(O=L._connectionValues[Y.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",B}},"math/xor":{hY:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,A,T,G,B,L){var f,O,C;(C=B[0]).config||(C.config={});const Q=B[0].dataInputs[0],Y=B[0].dataInputs[1];return B[0].config.valueType=(null===(f=L._connectionValues[Q.uniqueId])||void 0===f?void 0:f.type)??(null===(O=L._connectionValues[Y.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",B}},"math/asr":eT("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":eT("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":eT("FlowGraphLeadingZerosBlock"),"math/ctz":eT("FlowGraphTrailingZerosBlock"),"math/popcnt":eT("FlowGraphOneBitsCounterBlock"),"math/rad":eT("FlowGraphDegToRadBlock"),"math/deg":eT("FlowGraphRadToDegBlock"),"type/boolToInt":eT("FlowGraphBooleanToInt"),"type/boolToFloat":eT("FlowGraphBooleanToFloat"),"type/intToBool":eT("FlowGraphIntToBoolean"),"type/intToFloat":eT("FlowGraphIntToFloat"),"type/floatToInt":eT("FlowGraphFloatToInt"),"type/floatToBool":eT("FlowGraphFloatToBoolean"),"flow/sequence":{hY:["FlowGraphSequenceBlock"],extraProcessor(K,A,T,G,B){const L=B[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(K.flows||[]).length,L.signalOutputs.forEach(((K,A)=>{K.name="out_"+A})),B}},"flow/branch":{hY:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{hY:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(K){if(K.configuration&&K.configuration.cases){const A=K.configuration.cases.value;if(!A.every((K=>"number"===typeof K&&/^-?\d+$/.test(K.toString()))))return P.d.Warn("Switch cases should be integers. Using empty array instead."),K.configuration.cases.value=[],{valid:!0};const T=new Set(A);K.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(K,A,T,G,B){if("flow/switch"!==A.op||!K.flows||0===Object.keys(K.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return B[0].signalOutputs.forEach((K=>{"default"!==K.name&&(K.name="out_"+K.name)})),B}},"flow/while":{hY:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{hY:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(K,A,T,G,B){const L=B[0];return L.config||(L.config={}),L.config.incrementIndexWhenLoopDone=!0,B}},"flow/doN":{hY:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{hY:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(K,A,T,G,B){if("flow/multiGate"!==A.op||!K.flows||0===Object.keys(K.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const L=B[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(K.flows).length,L.signalOutputs.forEach(((K,A)=>{K.name="out_"+A})),B}},"flow/waitAll":{hY:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(K){var A,T;return"number"!==typeof(null===(A=K.configuration)||void 0===A||null===(T=A.inputFlows)||void 0===T?void 0:T.value[0])&&(K.configuration=K.configuration||{inputFlows:{value:[0]}},K.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{hY:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{hY:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{hY:["FlowGraphCancelDelayBlock"]},"variable/get":{hY:["FlowGraphGetVariableBlock"],validation(K){var A,T;return null!==(A=K.configuration)&&void 0!==A&&null!==(T=A.variable)&&void 0!==T&&T.value?{valid:!0}:(P.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(K,A)=>[A.getVariableName(K[0])]}}},"variable/set":{hY:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(K,A)=>[A.getVariableName(K[0])]}}},"variable/setMultiple":{hY:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(K,A)=>[K[0].map((K=>A.getVariableName(K)))]}},extraProcessor:(K,A,T,G,B)=>(B[0].dataInputs.forEach((K=>{K.name=G.getVariableName(+K.name)})),B)},"variable/interpolate":{hY:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(K,A)=>[A.getVariableName(K[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:K=>!0===K[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dT:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dT:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dT:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dT:"FlowGraphPlayAnimationBlock"},out:{name:"out",dT:"FlowGraphPlayAnimationBlock"},done:{name:"done",dT:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(K,A,T,G,B){var L,f,O;const C=B[0],Q=null===(L=K.configuration)||void 0===L?void 0:L.variable.value[0];if("number"!==typeof Q)throw P.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const Y=G.arrays.staticVariables[Q];"undefined"===typeof C.config.animationType.value&&(G.arrays.staticVariables,C.config.animationType.value=(0,DT.H)(Y.type));const Z=B[4];return Z.config||(Z.config={}),(f=Z.config).variable||(f.variable={}),Z.config.variable.value=G.getVariableName(Q),(O=B[3]).config||(O.config={}),B}},"pointer/get":{hY:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",dT:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,A,T,G,B)=>(B.forEach((K=>{"FlowGraphJsonPointerParserBlock"===K.className&&(K.config||(K.config={}),K.config.outputValue=!0)})),B)},"pointer/set":{hY:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",dT:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,A,T,G,B)=>(B.forEach((K=>{"FlowGraphJsonPointerParserBlock"===K.className&&(K.config||(K.config={}),K.config.outputValue=!0)})),B)},"pointer/interpolate":{hY:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",dT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",dT:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dT:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dT:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dT:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dT:"FlowGraphPlayAnimationBlock"},out:{name:"out",dT:"FlowGraphPlayAnimationBlock"},done:{name:"done",dT:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,A,T,G,B)=>(B.forEach((A=>{"FlowGraphJsonPointerParserBlock"===A.className?(A.config||(A.config={}),A.config.outputValue=!0):"FlowGraphInterpolationBlock"===A.className&&(A.config||(A.config={}),Object.keys(K.values||[]).forEach((T=>{var B;const L=null===(B=K.values)||void 0===B?void 0:B[T];if("value"===T&&L){const K=L.type;void 0!==K&&(A.config.animationType=G.arrays.types[K].flowGraphType)}})))})),B)},"animation/start":{hY:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dT:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(K,A)=>[K[0]*A._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(K,A)=>[K[0]*A._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,A,T,G,B,L,f){const O=B[B.length-1];return O.config||(O.config={}),O.config.glTF=f,B}},"animation/stop":{hY:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dT:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,A,T,G,B,L,f){const O=B[B.length-1];return O.config||(O.config={}),O.config.glTF=f,B}},"animation/stopAt":{hY:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",dT:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(K,A)=>[K[0]*A._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,A,T,G,B,L,f){const O=B[B.length-1];return O.config||(O.config={}),O.config.glTF=f,B}},"math/switch":{hY:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(K){if(K.configuration&&K.configuration.cases){const A=K.configuration.cases.value;if(!A.every((K=>"number"===typeof K&&/^-?\d+$/.test(K.toString()))))return P.d.Warn("Switch cases should be integers. Using empty array instead."),K.configuration.cases.value=[],{valid:!0};const T=new Set(A);K.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(K,A,T,G,B){const L=B[0];return L.dataInputs.forEach((K=>{"default"!==K.name&&"case"!==K.name&&(K.name="in_"+K.name)})),L.config||(L.config={}),L.config.treatCasesAsIntegers=!0,B}},"debug/log":{hY:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function eT(K){let A=arguments.length>2?arguments[2]:void 0;return{hY:[K],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((K,A)=>(K[A]={name:A},K)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(K,T,G,B,L){var f;if(A){(f=L[0]).config||(f.config={}),L[0].config.preventIntegerFloatArithmetic=!0;let A=-1;Object.keys(K.values||{}).find((T=>{var G;return void 0!==(null===(G=K.values)||void 0===G?void 0:G[T].type)&&(A=K.values[T].type,!0)})),-1!==A&&(L[0].config.type=B.arrays.types[A].flowGraphType)}return L},validation:K=>A?pT(K):{valid:!0}}}function pT(K){if(K.values){const A=Object.keys(K.values).map((A=>K.values[A].type)).filter((K=>void 0!==K));if(!A.every((K=>K===A[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}HT["math/compose"]=HT["math/matCompose"],HT["math/decompose"]=HT["math/matDecompose"];var rT=T(12653);const hT={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"PA",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class kT{constructor(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=K,this._gltf=A,this._animationTargetFps=T,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const K of this._interactivityGraph.types)this._types.push(hT[K.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const K of this._interactivityGraph.declarations){const A=uT(K);if(!A)throw P.d.Error(["No mapping found for declaration",K]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:A,fullOperationName:K.extension?K.op+":"+K.extension:K.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const K of this._interactivityGraph.variables){const A=this._parseVariable(K);this._staticVariables.push(A)}}_parseVariable(K,A){const T=this._types[K.type];if(!T)throw P.d.Error(["No type found for variable",K]),new Error("Error parsing variables");if(K.value&&K.value.length!==T.length)throw P.d.Error(["Invalid value length for variable",K,T]),new Error("Error parsing variables");const G=K.value||[];if(!G.length)switch(T.flowGraphType){case"boolean":G.push(!1);break;case"FlowGraphInteger":G.push(0);break;case"number":G.push(NaN);break;case"Vector2":G.push(NaN,NaN);break;case"PA":G.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":G.fill(NaN,0,4);break;case"Matrix":G.fill(NaN,0,16);break;case"Matrix3D":G.fill(NaN,0,9)}return"number"===T.elementType&&"string"===typeof G[0]&&(G[0]=parseFloat(G[0])),{type:T.flowGraphType,value:A?A(G,this):G}}_parseEvents(){if(this._interactivityGraph.events)for(const K of this._interactivityGraph.events){const A={eventId:K.id||"internalEvent_"+this._internalEventsCounter++};K.values&&(A.eventData=Object.keys(K.values).map((A=>{var T;const G=null===(T=K.values)||void 0===T?void 0:T[A];if(!G)throw P.d.Error(["No value found for event key",A]),new Error("Error parsing events");const B=this._types[G.type];if(!B)throw P.d.Error(["No type found for event value",G]),new Error("Error parsing events");const L="undefined"!==typeof G.value?this._parseVariable(G):void 0;return{id:A,type:B.flowGraphType,eventData:!0,value:L}}))),this._events.push(A)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const A of this._interactivityGraph.nodes){if("number"!==typeof A.declaration)throw P.d.Error(["No declaration found for node",A]),new Error("Error parsing nodes");const T=this._mappings[A.declaration];if(!T)throw P.d.Error(["No mapping found for node",A]),new Error("Error parsing nodes");if(T.flowGraphMapping.validation){const G=T.flowGraphMapping.validation(A,this._interactivityGraph,this._gltf);var K;if(!G.valid)throw new Error(`Error validating interactivity node ${null===(K=this._interactivityGraph.declarations)||void 0===K?void 0:K[A.declaration].op} - ${G.error}`)}const G=[];for(const K of T.flowGraphMapping.hY){const B=this._getEmptyBlock(K,T.fullOperationName);this._parseNodeConfiguration(A,B,T.flowGraphMapping,K),G.push(B)}this._nodes.push({hY:G,fullOperationName:T.fullOperationName})}}_getEmptyBlock(K,A){return{uniqueId:(0,rT.d)(),className:K,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:A,metadata:{}}}_parseNodeConfiguration(K,A,T,G){const B=A.config;if(K.configuration){const A=Object.keys(K.configuration);for(const O of A){var L,f;const A=null===(L=K.configuration)||void 0===L?void 0:L[O];if(!A)throw P.d.Error(["No value found for node configuration",O]),new Error("Error parsing node configuration");const C=null===(f=T.configuration)||void 0===f?void 0:f[O];if(C&&C.dT?C.dT===G:0===T.hY.indexOf(G)){const K=(null===C||void 0===C?void 0:C.name)||O;A&&"undefined"!==typeof A.value||"undefined"===typeof(null===C||void 0===C?void 0:C.defaultValue)?A.value.length>=0?B[K]={value:1===A.value.length?A.value[0]:A.value}:P.d.Warn(["Invalid value for node configuration",A]):B[K]={value:C.defaultValue},C&&C.dataTransformer&&(B[K].value=C.dataTransformer([B[K].value],this)[0])}}}}_parseNodeConnections(K){for(let z=0;z<this._nodes.length;z++){var A;const g=null===(A=this._interactivityGraph.nodes)||void 0===A?void 0:A[z];if(!g)throw P.d.Error(["No node found for interactivity node",this._nodes[z]]),new Error("Error parsing node connections");const S=this._nodes[z],l=this._mappings[g.declaration];if(!l)throw P.d.Error(["No mapping found for node",g]),new Error("Error parsing node connections");const u=g.flows||{},c=Object.keys(u).sort();for(const K of c){var T,G,B,L;const A=u[K],Q=null===(T=l.flowGraphMapping.outputs)||void 0===T||null===(G=T.flows)||void 0===G?void 0:G[K],Y=(null===Q||void 0===Q?void 0:Q.name)||K,Z=this._createNewSocketConnection(Y,!0);(Q&&Q.dT&&S.hY.find((K=>K.className===Q.dT))||S.hY[0]).signalOutputs.push(Z);const x=A.node,J=this._nodes[x];if(!J)throw P.d.Error(["No node found for input node id",x]),new Error("Error parsing node connections");const b=lT(J.fullOperationName);if(!b)throw P.d.Error(["No mapping found for input node",J]),new Error("Error parsing node connections");let F=null===(B=b.inputs)||void 0===B||null===(L=B.flows)||void 0===L?void 0:L[A.socket||"in"],d=!1;if(!F)for(const K in null===(f=b.inputs)||void 0===f?void 0:f.flows){var f,O,C;if(K.startsWith("[")&&K.endsWith("]"))d=!0,F=null===(O=b.inputs)||void 0===O||null===(C=O.flows)||void 0===C?void 0:C[K]}const N=F?d?F.name.replace("$1",A.socket||""):F.name:A.socket||"in",D=F&&F.dT&&J.hY.find((K=>K.className===F.dT))||J.hY[0];let mK=D.signalInputs.find((K=>K.name===N));mK||(mK=this._createNewSocketConnection(N),D.signalInputs.push(mK)),mK.connectedPointIds.push(Z.uniqueId),Z.connectedPointIds.push(mK.uniqueId)}const n=g.values||{},H=Object.keys(n);for(const A of H){var Q,Y;const T=n[A];let G=null===(Q=l.flowGraphMapping.inputs)||void 0===Q||null===(Y=Q.values)||void 0===Y?void 0:Y[A],B=!1;if(!G)for(const K in null===(Z=l.flowGraphMapping.inputs)||void 0===Z?void 0:Z.values){var Z,x,J;if(K.startsWith("[")&&K.endsWith("]"))B=!0,G=null===(x=l.flowGraphMapping.inputs)||void 0===x||null===(J=x.values)||void 0===J?void 0:J[K]}const L=G?B?G.name.replace("$1",A):G.name:A,f=this._createNewSocketConnection(L);if((G&&G.dT&&S.hY.find((K=>K.className===G.dT))||S.hY[0]).dataInputs.push(f),void 0!==T.value){const A=this._parseVariable(T,G&&G.dataTransformer);K._connectionValues[f.uniqueId]=A}else{if("undefined"===typeof T.node)throw P.d.Error(["Invalid value for value connection",T]),new Error("Error parsing node connections");{var b,F,d;const K=T.node,A=T.socket||"value",G=this._nodes[K];if(!G)throw P.d.Error(["No node found for output socket reference",T]),new Error("Error parsing node connections");const B=lT(G.fullOperationName);if(!B)throw P.d.Error(["No mapping found for output socket reference",T]),new Error("Error parsing node connections");let L=null===(b=B.outputs)||void 0===b||null===(F=b.values)||void 0===F?void 0:F[A],O=!1;if(!L)for(const T in null===(N=B.outputs)||void 0===N?void 0:N.values){var N,D,mK;if(T.startsWith("[")&&T.endsWith("]"))O=!0,L=null===(D=B.outputs)||void 0===D||null===(mK=D.values)||void 0===mK?void 0:mK[T]}const C=L?O?L.name.replace("$1",A):null===(d=L)||void 0===d?void 0:d.name:A,Q=L&&L.dT&&G.hY.find((K=>K.className===L.dT))||G.hY[0];let Y=Q.dataOutputs.find((K=>K.name===C));Y||(Y=this._createNewSocketConnection(C,!0),Q.dataOutputs.push(Y)),f.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(f.uniqueId)}}}if(l.flowGraphMapping.interBlockConnectors)for(const K of l.flowGraphMapping.interBlockConnectors){const A=K.input,T=K.output,G=K.isVariable;this._connectFlowGraphNodes(A,T,S.hY[K.inputBlockIndex],S.hY[K.outputBlockIndex],G)}if(l.flowGraphMapping.extraProcessor){var U;const A=null===(U=this._interactivityGraph.declarations)||void 0===U?void 0:U[g.declaration];if(!A)throw P.d.Error(["No declaration found for extra processor",g]),new Error("Error parsing node connections");S.hY=l.flowGraphMapping.extraProcessor(g,A,l.flowGraphMapping,this,S.hY,K,this._gltf)}}}_createNewSocketConnection(K,A){return{uniqueId:(0,rT.d)(),name:K,_connectionType:A?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(K,A,T,G,B){const L=B?T.dataInputs:T.signalInputs,f=B?G.dataOutputs:G.signalOutputs,O=L.find((A=>A.name===K))||this._createNewSocketConnection(K),C=f.find((K=>K.name===A))||this._createNewSocketConnection(A,!0);L.find((A=>A.name===K))||L.push(O),f.find((K=>K.name===A))||f.push(C),O.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(O.uniqueId)}getVariableName(K){return"staticVariable_"+K}serializeToFlowGraph(){const K={uniqueId:(0,rT.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(K);for(let A=0;A<this._staticVariables.length;A++){const T=this._staticVariables[A];K._userVariables[this.getVariableName(A)]=T}return{rightHanded:!0,allBlocks:this._nodes.reduce(((K,A)=>K.concat(A.hY)),[]),executionContexts:[K]}}}const sT="KHR_interactivity";class jT{constructor(K){this._loader=K,this.name=sT,this.enabled=this._loader.isExtensionUsed(sT),this._pathConverter=(0,R.g)(this._loader.Sf),K._skipStartAnimationStep=!0;const A=K.babylonScene;A&&function(K){(0,R.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!K.activeCamera)return new B.Quaternion(NaN,NaN,NaN,NaN);const A=B.Quaternion.FromRotationMatrix(K.activeCamera.getWorldMatrix()).normalize();return K.useRightHandedSystem||(A.w*=-1,A.x*=-1),A},type:"Quaternion",getTarget:()=>K.activeCamera}),(0,R.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!K.activeCamera)return new B.PA(NaN,NaN,NaN);const A=K.activeCamera.getWorldMatrix().getTranslation();return K.useRightHandedSystem||(A.x*=-1),A},type:"PA",getTarget:()=>K.activeCamera}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:K=>{var A;return(null===(A=K._babylonAnimationGroup)||void 0===A?void 0:A.isPlaying)??!1},type:"boolean",getTarget:K=>K._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:K=>{var A;return((null===(A=K._babylonAnimationGroup)||void 0===A?void 0:A.from)??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:K=>{var A;return((null===(A=K._babylonAnimationGroup)||void 0===A?void 0:A.to)??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:K=>{var A;return((null===(A=K._babylonAnimationGroup)||void 0===A?void 0:A.getCurrentFrame())??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:K=>{var A;return((null===(A=K._babylonAnimationGroup)||void 0===A?void 0:A.getCurrentFrame())??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup})}(A)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var K;if(!this._loader.babylonScene||!this._pathConverter)return;const A=this._loader.babylonScene,T=null===(K=this._loader.Sf.extensions)||void 0===K?void 0:K.KHR_interactivity;if(!T)return;const G=new bT.c({dA:A});G.dispatchEventsSynchronously=!1;const B=T.graphs.map((K=>new kT(K,this._loader.Sf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(B.map((async K=>await zT(K,{coordinator:G,pathConverter:this._pathConverter})))),G.start()}}var RT;RT=async()=>(await Promise.resolve().then(T.bind(T,14302))).FlowGraphGLTFDataProvider,PT[`${sT}/${"FlowGraphGLTFDataProvider"}`]=RT,j(sT),s(sT,!0,(K=>new jT(K)));const vT="KHR_node_visibility";(0,R.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:K=>{const A=K._babylonTransformNode;return!A||void 0===A.isVisible||A.isVisible},set:(K,A)=>{var T,G;null===(T=A._primitiveBabylonMeshes)||void 0===T||T.forEach((K=>{K.inheritVisibility=!0})),A._babylonTransformNode&&(A._babylonTransformNode.isVisible=K),null===(G=A._primitiveBabylonMeshes)||void 0===G||G.forEach((A=>{A.isVisible=K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class IT{constructor(K){this.name=vT,this._loader=K,this.enabled=K.isExtensionUsed(vT)}async onReady(){var K;null===(K=this._loader.Sf.nodes)||void 0===K||K.forEach((K=>{var A,T,G,B;(null===(A=K._primitiveBabylonMeshes)||void 0===A||A.forEach((K=>{K.inheritVisibility=!0})),null!==(T=K.extensions)&&void 0!==T&&T.KHR_node_visibility)&&(!1===(null===(G=K.extensions)||void 0===G?void 0:G.KHR_node_visibility.visible)&&(K._babylonTransformNode&&(K._babylonTransformNode.isVisible=!1),null===(B=K._primitiveBabylonMeshes)||void 0===B||B.forEach((K=>{K.isVisible=!1}))))}))}dispose(){this._loader=null}}j(vT),s(vT,!0,(K=>new IT(K)));const oT="KHR_node_selectability";cT("event/onSelect",oT,{hY:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dT:"FlowGraphGetVariableBlock",dataTransformer:K=>["pickedMesh_"+K[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",dT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,A,T,G,B,L,f){var O,C,Q,Y,Z,x;const J=B[B.length-1];J.config=J.config||{},J.config.glTF=f;const b=null===(O=K.configuration)||void 0===O||null===(C=O.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const P="pickedMesh_"+b;return B[1].config.variable=P,L._userVariables[P]={className:"Mesh",id:null===f||void 0===f||null===(Q=f.nodes)||void 0===Q||null===(Y=Q[b]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===f||void 0===f||null===(Z=f.nodes)||void 0===Z||null===(x=Z[b]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},B}}),(0,R.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:K=>{const A=K._babylonTransformNode;return!A||void 0===A.GQ||A.GQ},set:(K,A)=>{var T;null===(T=A._primitiveBabylonMeshes)||void 0===T||T.forEach((A=>{A.GQ=K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"GQ"],type:"boolean"});class WT{constructor(K){this.name=oT,this._loader=K,this.enabled=K.isExtensionUsed(oT)}async onReady(){var K;null===(K=this._loader.Sf.nodes)||void 0===K||K.forEach((K=>{var A,T,G;null!==(A=K.extensions)&&void 0!==A&&A.KHR_node_selectability&&!1===(null===(T=K.extensions)||void 0===T?void 0:T.KHR_node_selectability.selectable)&&(null===(G=K._babylonTransformNode)||void 0===G||G.getChildMeshes().forEach((K=>{K.GQ=!1})))}))}dispose(){this._loader=null}}j(oT),s(oT,!0,(K=>new WT(K)));const iT="KHR_node_hoverability",VT="targetMeshPointerOver_";cT("event/onHoverIn",iT,{hY:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dT:"FlowGraphGetVariableBlock",dataTransformer:K=>[VT+K[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,A,T,G,B,L,f){var O,C,Q,Y,Z,x;const J=B[B.length-1];J.config=J.config||{},J.config.glTF=f;const b=null===(O=K.configuration)||void 0===O||null===(C=O.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const P=VT+b;return B[1].config.variable=P,L._userVariables[P]={className:"Mesh",id:null===f||void 0===f||null===(Q=f.nodes)||void 0===Q||null===(Y=Q[b]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===f||void 0===f||null===(Z=f.nodes)||void 0===Z||null===(x=Z[b]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},B}});const XT="targetMeshPointerOut_";cT("event/onHoverOut",iT,{hY:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dT:"FlowGraphGetVariableBlock",dataTransformer:K=>[XT+K[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,A,T,G,B,L,f){var O,C,Q,Y,Z,x;const J=B[B.length-1];J.config=J.config||{},J.config.glTF=f;const b=null===(O=K.configuration)||void 0===O||null===(C=O.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const P=XT+b;return B[1].config.variable=P,L._userVariables[P]={className:"Mesh",id:null===f||void 0===f||null===(Q=f.nodes)||void 0===Q||null===(Y=Q[b]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===f||void 0===f||null===(Z=f.nodes)||void 0===Z||null===(x=Z[b]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},B}}),(0,R.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:K=>{const A=K._babylonTransformNode;return!A||void 0===A.pointerOverDisableMeshTesting||A.pointerOverDisableMeshTesting},set:(K,A)=>{var T;null===(T=A._primitiveBabylonMeshes)||void 0===T||T.forEach((A=>{A.pointerOverDisableMeshTesting=!K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class qT{constructor(K){this.name=iT,this._loader=K,this.enabled=K.isExtensionUsed(iT)}async onReady(){var K;null===(K=this._loader.Sf.nodes)||void 0===K||K.forEach((K=>{var A,T,G;null!==(A=K.extensions)&&void 0!==A&&A.KHR_node_hoverability&&!1===(null===(T=K.extensions)||void 0===T?void 0:T.KHR_node_hoverability.hoverable)&&(null===(G=K._babylonTransformNode)||void 0===G||G.getChildMeshes().forEach((K=>{K.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}j(iT),s(iT,!0,(K=>new qT(K)));const yT="ExtrasAsMetadata";class wT{_assignExtras(K,A){if(A.extras&&Object.keys(A.extras).length>0){const T=K.metadata=K.metadata||{};(T.Sf=T.Sf||{}).extras=A.extras}}constructor(K){this.name=yT,this.enabled=!0,this._loader=K}dispose(){this._loader=null}loadNodeAsync(K,A,T){return this._loader.loadNodeAsync(K,A,(K=>{this._assignExtras(K,A),T(K)}))}loadCameraAsync(K,A,T){return this._loader.loadCameraAsync(K,A,(K=>{this._assignExtras(K,A),T(K)}))}createMaterial(K,A,T){const G=this._loader.createMaterial(K,A,T);return this._assignExtras(G,A),G}}j(yT),s(yT,!1,(K=>new wT(K)));T(14302)},14154:(K,A,T)=>{"use strict";T.d(A,{d:()=>p,h:()=>l,k:()=>S,n:()=>u});var G=T(12534),B=T(12526),L=T(13831),f=T(13147),O=T(13118),C=T(13129),Q=T(12548),Y=T(12565),Z=T(13142),x=T(13242),J=T(13154),b=T(12736);class P{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Nx=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.fJ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(K){this._environmentTexture=K}getNodes(){let K=[];K=K.concat(this.meshes),K=K.concat(this.lights),K=K.concat(this.cameras),K=K.concat(this.transformNodes);for(const A of this.skeletons)K=K.concat(A.bones);return K}}class F extends P{}class d{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const K=this.rootNodes;for(const G of K)G.dispose();K.length=0;const A=this.skeletons;for(const G of A)G.dispose();A.length=0;const T=this.animationGroups;for(const G of T)G.dispose();T.length=0}}class N extends P{constructor(K){super(),this._wasAddedToScene=!1,(K=K||Y.b.LastCreatedScene)&&(this.dA=K,this.proceduralTextures=[],K.Ff.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=K.getEngine().onContextRestoredObservable.add((()=>{for(const K of this.geometries)K._rebuild();for(const K of this.meshes)K._rebuild();for(const K of this.Nx)K.rebuild();for(const K of this.textures)K._rebuild()})))}_topologicalSort(K){const A=new Map;for(const f of K)A.set(f.uniqueId,f);const T={dependsOn:new Map,dependedBy:new Map};for(const f of K){const K=f.uniqueId;T.dependsOn.set(K,new Set),T.dependedBy.set(K,new Set)}for(const f of K){const K=f.uniqueId,G=T.dependsOn.get(K);if(f instanceof Z.e){const B=f.sourceMesh;A.has(B.uniqueId)&&(G.add(B.uniqueId),T.dependedBy.get(B.uniqueId).add(K))}const B=T.dependedBy.get(K);for(const L of f.getDescendants()){const G=L.uniqueId;if(A.has(G)){B.add(G);T.dependsOn.get(G).add(K)}}}const G=[],B=[];for(const f of K){const K=f.uniqueId;0===T.dependsOn.get(K).size&&(B.push(f),A.delete(K))}const L=B;for(;L.length>0;){const K=L.shift();G.push(K);const B=T.dependedBy.get(K.uniqueId);for(const G of Array.from(B.values())){const B=T.dependsOn.get(G);B.delete(K.uniqueId),0===B.size&&A.get(G)&&(L.push(A.get(G)),A.delete(G))}}return A.size>0&&(Q.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),A.forEach((K=>{Q.d.Error(K.name)}))),G}_addNodeAndDescendantsToList(K,A,T,G){if(T&&(!G||G(T))&&!A.has(T.uniqueId)){K.push(T),A.add(T.uniqueId);for(const B of T.getDescendants(!0))this._addNodeAndDescendantsToList(K,A,B,G)}}_isNodeInContainer(K){return K instanceof C.e&&-1!==this.meshes.indexOf(K)||(K instanceof O.b&&-1!==this.transformNodes.indexOf(K)||(K instanceof x.b&&-1!==this.lights.indexOf(K)||K instanceof J.e&&-1!==this.cameras.indexOf(K)))}_isValidHierarchy(){for(const K of this.meshes)if(K.parent&&!this._isNodeInContainer(K.parent))return Q.d.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.transformNodes)if(K.parent&&!this._isNodeInContainer(K.parent))return Q.d.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.lights)if(K.parent&&!this._isNodeInContainer(K.parent))return Q.d.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.cameras)if(K.parent&&!this._isNodeInContainer(K.parent))return Q.d.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(K){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const G={},L={},O=new d,C=[],Q=[],Y={doNotInstantiate:!0,...T},Z=[],x=new Set;for(const B of this.transformNodes)null===B.parent&&this._addNodeAndDescendantsToList(Z,x,B,Y.predicate);for(const B of this.meshes)null===B.parent&&this._addNodeAndDescendantsToList(Z,x,B,Y.predicate);const J=this._topologicalSort(Z),b=(T,B)=>{if(((A,T)=>{if(G[A.uniqueId]=T.uniqueId,L[T.uniqueId]=T,K&&(T.name=K(A.name)),T instanceof f.e){const K=T;if(K.morphTargetManager){const T=A.morphTargetManager;K.morphTargetManager=T.clone();for(let A=0;A<T.numTargets;A++){const B=T.getTarget(A),f=K.morphTargetManager.getTarget(A);G[B.uniqueId]=f.uniqueId,L[f.uniqueId]=f}}}})(T,B),T.parent){const K=G[T.parent.uniqueId],A=L[K];B.parent=A||T.parent}if(B.position&&T.position&&B.position.G(T.position),B.rotationQuaternion&&T.rotationQuaternion&&B.rotationQuaternion.G(T.rotationQuaternion),B.rotation&&T.rotation&&B.rotation.G(T.rotation),B.vO&&T.vO&&B.vO.G(T.vO),B.material){const f=B;if(f.material)if(A){const A=T.material;if(-1===Q.indexOf(A)){let T=A.clone(K?K(A.name):"Clone of "+A.name);if(Q.push(A),G[A.uniqueId]=T.uniqueId,L[T.uniqueId]=T,"MultiMaterial"===A.getClassName()){const B=A;for(const A of B.WO)A&&(T=A.clone(K?K(A.name):"Clone of "+A.name),Q.push(A),G[A.uniqueId]=T.uniqueId,L[T.uniqueId]=T);B.WO=B.WO.map((K=>K&&L[G[K.uniqueId]]))}}"InstancedMesh"!==f.getClassName()&&(f.material=L[G[A.uniqueId]])}else"MultiMaterial"===f.material.getClassName()?-1===this.dA.multiMaterials.indexOf(f.material)&&this.dA.addMultiMaterial(f.material):-1===this.dA.materials.indexOf(f.material)&&this.dA.addMaterial(f.material)}null===B.parent&&O.rootNodes.push(B)};for(const B of J)if("InstancedMesh"===B.getClassName()){const K=B,A=K.sourceMesh,T=G[A.uniqueId];b(K,("number"===typeof T?L[T]:A).createInstance(K.name))}else{let K=!0;"nx"===B.getClassName()||"Node"===B.getClassName()||B.skeleton||!B.getTotalVertices||0===B.getTotalVertices()?K=!1:Y.doNotInstantiate&&(K="function"===typeof Y.doNotInstantiate?!Y.doNotInstantiate(B):!Y.doNotInstantiate);const A=K?B.createInstance(`instance of ${B.name}`):B.clone(`Clone of ${B.name}`,null,!0);if(!A)throw new Error(`Could not clone or instantiate node on Asset Container ${B.name}`);b(B,A)}for(const B of this.skeletons){if(Y.predicate&&!Y.predicate(B))continue;const A=B.clone(K?K(B.name):"Clone of "+B.name);for(const K of this.meshes)if(K.skeleton===B&&!K.isAnInstance){const T=L[G[K.uniqueId]];if(!T||T.isAnInstance)continue;if(T.skeleton=A,-1!==C.indexOf(A))continue;C.push(A);for(const K of A.bones)K._linkedTransformNode&&(K._linkedTransformNode=L[G[K._linkedTransformNode.uniqueId]])}O.skeletons.push(A)}for(const B of this.animationGroups){if(Y.predicate&&!Y.predicate(B))continue;const A=B.clone(K?K(B.name):"Clone of "+B.name,(K=>L[G[K.uniqueId]]||K));O.animationGroups.push(A)}return O}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.dA.environmentTexture=this.environmentTexture);for(const K of this.dA._serializableComponents)K.addFromContainer(this);this.dA.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const A=[];for(const T of this.cameras)K&&!K(T)||(this.dA.addCamera(T),A.push(T));for(const T of this.lights)K&&!K(T)||(this.dA.addLight(T),A.push(T));for(const T of this.meshes)K&&!K(T)||(this.dA.UY(T),A.push(T));for(const T of this.skeletons)K&&!K(T)||this.dA.addSkeleton(T);for(const T of this.animations)K&&!K(T)||this.dA.addAnimation(T);for(const T of this.animationGroups)K&&!K(T)||this.dA.addAnimationGroup(T);for(const T of this.multiMaterials)K&&!K(T)||this.dA.addMultiMaterial(T);for(const T of this.materials)K&&!K(T)||this.dA.addMaterial(T);for(const T of this.morphTargetManagers)K&&!K(T)||this.dA.addMorphTargetManager(T);for(const T of this.geometries)K&&!K(T)||this.dA.addGeometry(T);for(const T of this.transformNodes)K&&!K(T)||(this.dA.addTransformNode(T),A.push(T));for(const T of this.actionManagers)K&&!K(T)||this.dA.addActionManager(T);for(const T of this.textures)K&&!K(T)||this.dA.addTexture(T);for(const T of this.reflectionProbes)K&&!K(T)||this.dA.addReflectionProbe(T);for(const T of A)T.parent&&-1===this.dA.getNodes().indexOf(T.parent)&&(T.setParent?T.setParent(null):T.parent=null)}removeAllFromScene(){this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.dA.environmentTexture&&(this.dA.environmentTexture=null);for(const K of this.dA._serializableComponents)K.removeFromContainer(this)}removeFromScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const A of this.cameras)K&&!K(A)||this.dA.removeCamera(A);for(const A of this.lights)K&&!K(A)||this.dA.removeLight(A);for(const A of this.meshes)K&&!K(A)||this.dA.mZ(A,!0);for(const A of this.skeletons)K&&!K(A)||this.dA.removeSkeleton(A);for(const A of this.animations)K&&!K(A)||this.dA.removeAnimation(A);for(const A of this.animationGroups)K&&!K(A)||this.dA.removeAnimationGroup(A);for(const A of this.multiMaterials)K&&!K(A)||this.dA.removeMultiMaterial(A);for(const A of this.materials)K&&!K(A)||this.dA.removeMaterial(A);for(const A of this.morphTargetManagers)K&&!K(A)||this.dA.removeMorphTargetManager(A);for(const A of this.geometries)K&&!K(A)||this.dA.removeGeometry(A);for(const A of this.transformNodes)K&&!K(A)||this.dA.removeTransformNode(A);for(const A of this.actionManagers)K&&!K(A)||this.dA.removeActionManager(A);for(const A of this.textures)K&&!K(A)||this.dA.removeTexture(A);for(const A of this.reflectionProbes)K&&!K(A)||this.dA.removeReflectionProbe(A)}dispose(){const K=this.cameras.slice(0);for(const J of K)J.dispose();this.cameras.length=0;const A=this.lights.slice(0);for(const J of A)J.dispose();this.lights.length=0;const T=this.meshes.slice(0);for(const J of T)J.dispose();this.meshes.length=0;const G=this.skeletons.slice(0);for(const J of G)J.dispose();this.skeletons.length=0;const B=this.animationGroups.slice(0);for(const J of B)J.dispose();this.animationGroups.length=0;const L=this.multiMaterials.slice(0);for(const J of L)J.dispose();this.multiMaterials.length=0;const f=this.materials.slice(0);for(const J of f)J.dispose();this.materials.length=0;const O=this.geometries.slice(0);for(const J of O)J.dispose();this.geometries.length=0;const C=this.transformNodes.slice(0);for(const J of C)J.dispose();this.transformNodes.length=0;const Q=this.actionManagers.slice(0);for(const J of Q)J.dispose();this.actionManagers.length=0;const Y=this.textures.slice(0);for(const J of Y)J.dispose();this.textures.length=0;const Z=this.reflectionProbes.slice(0);for(const J of Z)J.dispose();this.reflectionProbes.length=0;const x=this.morphTargetManagers.slice(0);for(const J of x)J.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const J of this.dA._serializableComponents)J.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.dA.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(K,A,T){if(K&&A)for(const G of K){let K=!0;if(T)for(const A of T)if(G===A){K=!1;break}K&&(A.push(G),G._parentContainer=this)}}moveAllFromScene(K){this._wasAddedToScene=!1,void 0===K&&(K=new F);for(const A in this)Object.prototype.hasOwnProperty.call(this,A)&&(this[A]=this[A]||("_environmentTexture"===A?null:[]),this._moveAssets(this.dA[A],this[A],K[A]));this.environmentTexture=this.dA.environmentTexture,this.removeAllFromScene()}createRootMesh(){const K=new f.e("assetContainerRootMesh",this.dA);for(const A of this.meshes)A.parent||K.addChild(A);return this.meshes.unshift(K),K}mergeAnimationsTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.b.LastCreatedScene,A=arguments.length>1?arguments[1]:void 0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!K)return Q.d.Error("No scene available to merge animations to"),[];const G=T||(A=>{let T=null;const G=A.animations.length?A.animations[0].targetProperty:"",B=A.name.split(".").join("").split("_primitive")[0];switch(G){case"position":case"rotationQuaternion":T=K.getTransformNodeByName(A.name)||K.getTransformNodeByName(B);break;case"influence":T=K.getMorphTargetByName(A.name)||K.getMorphTargetByName(B);break;default:T=K.getNodeByName(A.name)||K.getNodeByName(B)}return T}),B=this.getNodes();for(const O of B){const K=G(O);if(null!==K){for(const A of O.animations){const T=K.animations.filter((K=>K.targetProperty===A.targetProperty));for(const A of T){const T=K.animations.indexOf(A,0);T>-1&&K.animations.splice(T,1)}}K.animations=K.animations.concat(O.animations)}}const L=[],f=this.animationGroups.slice();for(const O of f){L.push(O.clone(O.name,G));for(const K of O.animatables)K.stop()}for(const O of A){const A=G(O.target);A&&(K.beginAnimation(A,O.fromFrame,O.toFrame,O.loopAnimation,O.speedRatio,O.onAnimationEnd?O.onAnimationEnd:void 0,void 0,!0,void 0,O.onAnimationLoop?O.onAnimationLoop:void 0),K.stopAnimation(O.target))}return L}populateRootNodes(){this.rootNodes.length=0;for(const K of this.meshes)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.transformNodes)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.lights)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.cameras)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)}addAllAssetsToContainer(K){if(!K)return;const A=[],T=new Set;for(A.push(K);A.length>0;){const K=A.pop();if(K instanceof f.e?(K.Mf&&-1===this.geometries.indexOf(K.Mf)&&this.geometries.push(K.Mf),this.meshes.push(K)):K instanceof Z.e?this.meshes.push(K):K instanceof O.b?this.transformNodes.push(K):K instanceof x.b?this.lights.push(K):K instanceof J.e&&this.cameras.push(K),K instanceof C.e){if(K.material&&-1===this.materials.indexOf(K.material)){this.materials.push(K.material);for(const A of K.material.getActiveTextures())-1===this.textures.indexOf(A)&&this.textures.push(A)}K.skeleton&&-1===this.skeletons.indexOf(K.skeleton)&&this.skeletons.push(K.skeleton),K.morphTargetManager&&-1===this.morphTargetManagers.indexOf(K.morphTargetManager)&&this.morphTargetManagers.push(K.morphTargetManager)}for(const G of K.getChildren())T.has(G)||A.push(G);T.add(K)}this.populateRootNodes()}_getByTags(K,A,T){if(void 0===A)return K;const G=[];for(const B in K){const L=K[B];b.c&&b.c.MatchesQuery(L,A)&&(!T||T(L))&&G.push(L)}return G}getMeshesByTags(K,A){return this._getByTags(this.meshes,K,A)}getCamerasByTags(K,A){return this._getByTags(this.cameras,K,A)}getLightsByTags(K,A){return this._getByTags(this.lights,K,A)}getMaterialsByTags(K,A){return this._getByTags(this.materials,K,A).concat(this._getByTags(this.multiMaterials,K,A))}getTransformNodesByTags(K,A){return this._getByTags(this.transformNodes,K,A)}}var D=T(12579);class mK{constructor(K){this.byteOffset=0,this.buffer=K}async loadAsync(K){const A=await this.buffer.readAsync(this.byteOffset,K);this._dataView=new DataView(A.buffer,A.byteOffset,A.byteLength),this._dataByteOffset=0}readUint32(){const K=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,K}readUint8Array(K){const A=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,K);return this._dataByteOffset+=K,this.byteOffset+=K,A}readString(K){return(0,D.i)(this.readUint8Array(K))}skipBytes(K){this._dataByteOffset+=K,this.byteOffset+=K}}var U=T(14157);const z="Z2xURg",g={name:"Sf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:K=>-1!==K.indexOf("asset")&&-1!==K.indexOf("version")||K.startsWith("data:base64,"+z)||K.startsWith("data:;base64,"+z)||K.startsWith("data:application/octet-stream;base64,"+z)||K.startsWith("data:model/gltf-binary;base64,"+z)};var S,l,u,c=T(12571),n=T(12573);function H(K,A,T){try{return Promise.resolve(new Uint8Array(K,A,T))}catch(G){return Promise.reject(G)}}!function(K){K[K.AUTO=0]="AUTO",K[K.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(S||(S={})),function(K){K[K.NONE=0]="NONE",K[K.FIRST=1]="FIRST",K[K.ALL=2]="ALL"}(l||(l={})),function(K){K[K.LOADING=0]="LOADING",K[K.READY=1]="READY",K[K.COMPLETE=2]="COMPLETE"}(u||(u={}));class e{constructor(){this.coordinateSystemMode=S.AUTO,this.animationStartMode=l.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=K=>Promise.resolve(K),this.extensionOptions={}}G(K){K&&(this.onParsed=K.onParsed,this.coordinateSystemMode=K.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=K.animationStartMode??this.animationStartMode,this.loadNodeAnimations=K.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=K.loadSkins??this.loadSkins,this.loadMorphTargets=K.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=K.compileMaterials??this.compileMaterials,this.useClipPlane=K.useClipPlane??this.useClipPlane,this.compileShadowGenerators=K.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=K.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=K.useRangeRequests??this.useRangeRequests,this.createInstances=K.createInstances??this.createInstances,this.alwaysComputeBoundingBox=K.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=K.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=K.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=K.skipMaterials??this.skipMaterials,this.useSRGBBuffers=K.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=K.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=K.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=K.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=K.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=K.customRootNode,this.onMeshLoaded=K.onMeshLoaded,this.onSkinLoaded=K.onSkinLoaded,this.onTextureLoaded=K.onTextureLoaded,this.onMaterialLoaded=K.onMaterialLoaded,this.onCameraLoaded=K.onCameraLoaded,this.extensionOptions=K.extensionOptions??this.extensionOptions)}}class p extends e{constructor(K){super(),this.onParsedObservable=new G.e,this.onMeshLoadedObservable=new G.e,this.onSkinLoadedObservable=new G.e,this.onTextureLoadedObservable=new G.e,this.onMaterialLoadedObservable=new G.e,this.onCameraLoadedObservable=new G.e,this.onCompleteObservable=new G.e,this.onErrorObservable=new G.e,this.Ff=new G.e,this.onExtensionLoadedObservable=new G.e,this.validate=!1,this.onValidatedObservable=new G.e,this._loader=null,this._state=null,this._requests=new Array,this.name=g.name,this.extensions=g.extensions,this.onLoaderStateChangedObservable=new G.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.G(K)}set onParsed(K){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),K&&(this._onParsedObserver=this.onParsedObservable.add(K))}set onMeshLoaded(K){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),K&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(K))}set onSkinLoaded(K){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),K&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((A=>K(A.node,A.skinnedNode))))}set onTextureLoaded(K){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),K&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(K))}set onMaterialLoaded(K){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),K&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(K))}set onCameraLoaded(K){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),K&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(K))}set onComplete(K){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(K)}set onError(K){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(K)}set onDispose(K){this._onDisposeObserver&&this.Ff.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ff.add(K)}set onExtensionLoaded(K){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(K)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(K){this._loggingEnabled!==K&&(this._loggingEnabled=K,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(K){this._capturePerformanceCounters!==K&&(this._capturePerformanceCounters=K,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(K){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(K)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const K of this._requests)K.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=K=>Promise.resolve(K),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ff.notifyObservers(void 0),this.Ff.clear()}loadFile(K,A,T,L,f,O,C,Y){if(ArrayBuffer.isView(A))return this._loadBinary(K,A,T,L,C,Y),null;this._progressCallback=f;const Z=A.name||B.Tools.GetFilename(A);if(O){if(this.useRangeRequests){this.validate&&Q.d.Warn("glTF validation is not supported when range requests are enabled");const T={abort:()=>{},onCompleteObservable:new G.e},B={readAsync:(T,G)=>new Promise(((B,L)=>{this._loadFile(K,A,(K=>{B(new Uint8Array(K))}),!0,(K=>{L(K)}),(K=>{K.setRequestHeader("Range",`bytes=${T}-${T+G-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new mK(B)).then((K=>{T.onCompleteObservable.notifyObservers(T),L(K)}),C?K=>C(void 0,K):void 0),T}return this._loadFile(K,A,(A=>{this._validate(K,new Uint8Array(A,0,A.byteLength),T,Z),this._unpackBinaryAsync(new mK({readAsync:(K,T)=>H(A,K,T),byteLength:A.byteLength})).then((K=>{L(K)}),C?K=>C(void 0,K):void 0)}),!0,C)}return this._loadFile(K,A,(A=>{try{this._validate(K,A,T,Z),L({json:this._parseJson(A)})}catch{C&&C()}}),!1,C)}_loadBinary(K,A,T,G,B,L){this._validate(K,new Uint8Array(A.buffer,A.byteOffset,A.byteLength),T,L),this._unpackBinaryAsync(new mK({readAsync:(K,T)=>function(K,A,T){try{if(A<0||A>=K.byteLength)throw new RangeError("Offset is out of range.");if(A+T>K.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(K.buffer,K.byteOffset+A,T))}catch(G){return Promise.reject(G)}}(A,K,T),byteLength:A.byteLength})).then((K=>{G(K)}),B?K=>B(void 0,K):void 0)}importMeshAsync(K,A,T,G,B,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(T),this._loader.importMeshAsync(K,A,null,T,G,B,L))))}loadAsync(K,A,T,G,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(A),this._loader.loadAsync(K,A,T,G,B))))}loadAssetContainerAsync(K,A,T,G,B){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(A);const L=new N(K),f=[];this.onMaterialLoadedObservable.add((K=>{f.push(K)}));const O=[];this.onTextureLoadedObservable.add((K=>{O.push(K)}));const C=[];this.onCameraLoadedObservable.add((K=>{C.push(K)}));const Q=[];return this.onMeshLoadedObservable.add((K=>{K.morphTargetManager&&Q.push(K.morphTargetManager)})),this._loader.importMeshAsync(null,K,L,A,T,G,B).then((K=>(Array.prototype.push.apply(L.geometries,K.geometries),Array.prototype.push.apply(L.meshes,K.meshes),Array.prototype.push.apply(L.Nx,K.Nx),Array.prototype.push.apply(L.skeletons,K.skeletons),Array.prototype.push.apply(L.animationGroups,K.animationGroups),Array.prototype.push.apply(L.materials,f),Array.prototype.push.apply(L.textures,O),Array.prototype.push.apply(L.lights,K.lights),Array.prototype.push.apply(L.transformNodes,K.transformNodes),Array.prototype.push.apply(L.cameras,C),Array.prototype.push.apply(L.morphTargetManagers,Q),L)))}))}canDirectLoad(K){return g.canDirectLoad(K)}directLoad(K,A){if(A.startsWith("base64,"+z)||A.startsWith(";base64,"+z)||A.startsWith("application/octet-stream;base64,"+z)||A.startsWith("model/gltf-binary;base64,"+z)){const T=(0,c.d)(A);return this._validate(K,new Uint8Array(T,0,T.byteLength)),this._unpackBinaryAsync(new mK({readAsync:(K,A)=>H(T,K,A),byteLength:T.byteLength}))}return this._validate(K,A),Promise.resolve({json:this._parseJson(A)})}createPlugin(K){return new p(K[g.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((K,A)=>{this.onCompleteObservable.addOnce((()=>{K()})),this.onErrorObservable.addOnce((K=>{A(K)}))}))}_setState(K){this._state!==K&&(this._state=K,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(u[this._state]))}_loadFile(K,A,T,G,B,L){const f=K._loadFile(A,T,(K=>{this._onProgress(K,f)}),!0,G,B,L);return f.onCompleteObservable.add((()=>{f._lengthComputable=!0,f._total=f._loaded})),this._requests.push(f),f}_onProgress(K,A){if(!this._progressCallback)return;A._lengthComputable=K.lengthComputable,A._loaded=K.loaded,A._total=K.total;let T=!0,G=0,B=0;for(const L of this._requests){if(void 0===L._lengthComputable||void 0===L._loaded||void 0===L._total)return;T=T&&L._lengthComputable,G+=L._loaded,B+=L._total}this._progressCallback({lengthComputable:T,loaded:G,total:T?B:0})}_validate(K,A){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),U.d.ValidateAsync(A,T,G,(A=>this.preprocessUrlAsync(T+A).then((A=>K._loadFileAsync(A,void 0,!0,!0).then((K=>new Uint8Array(K,0,K.byteLength))))))).then((K=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(K),this.onValidatedObservable.clear()}),(K=>{this._endPerformanceCounter("Validate JSON"),B.Tools.Warn(`Failed to validate: ${K.message}`),this.onValidatedObservable.clear()})))}_getLoader(K){const A=K.json.asset||{};this._log(`Asset version: ${A.version}`),A.minVersion&&this._log(`Asset minimum version: ${A.minVersion}`),A.generator&&this._log(`Asset generator: ${A.generator}`);const T=p._parseVersion(A.version);if(!T)throw new Error("Invalid version: "+A.version);if(void 0!==A.minVersion){const K=p._parseVersion(A.minVersion);if(!K)throw new Error("Invalid minimum version: "+A.minVersion);if(p._compareVersion(K,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+A.minVersion)}const G={1:p._CreateGLTF1Loader,2:p._CreateGLTF2Loader}[T.major];if(!G)throw new Error("Unsupported version: "+A.version);return G(this)}_parseJson(K){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${K.length}`);const A=JSON.parse(K);return this._endPerformanceCounter("Parse JSON"),A}_unpackBinaryAsync(K){return this._startPerformanceCounter("Unpack Binary"),K.loadAsync(20).then((()=>{const A=K.readUint32();if(1179937895!==A)throw new n.i("Unexpected magic: "+A,n.g.GLTFLoaderUnexpectedMagicError);const T=K.readUint32();this.loggingEnabled&&this._log(`Binary version: ${T}`);const G=K.readUint32();let B;switch(this.useRangeRequests||G===K.buffer.byteLength||Q.d.Warn(`Length in header does not match actual data length: ${G} != ${K.buffer.byteLength}`),T){case 1:B=this._unpackBinaryV1Async(K,G);break;case 2:B=this._unpackBinaryV2Async(K,G);break;default:throw new Error("Unsupported version: "+T)}return this._endPerformanceCounter("Unpack Binary"),B}))}_unpackBinaryV1Async(K,A){const T=K.readUint32(),G=K.readUint32();if(0!==G)throw new Error(`Unexpected content format: ${G}`);const B=A-K.byteOffset,L={json:this._parseJson(K.readString(T)),bin:null};if(0!==B){const A=K.byteOffset;L.bin={readAsync:(T,G)=>K.buffer.readAsync(A+T,G),byteLength:B}}return Promise.resolve(L)}_unpackBinaryV2Async(K,A){const T=1313821514,G=5130562,B=K.readUint32();if(K.readUint32()!==T)throw new Error("First chunk format is not JSON");return K.byteOffset+B===A?K.loadAsync(B).then((()=>({json:this._parseJson(K.readString(B)),bin:null}))):K.loadAsync(B+8).then((()=>{const L={json:this._parseJson(K.readString(B)),bin:null},f=()=>{const B=K.readUint32();switch(K.readUint32()){case T:throw new Error("Unexpected JSON chunk");case G:{const A=K.byteOffset;L.bin={readAsync:(T,G)=>K.buffer.readAsync(A+T,G),byteLength:B},K.skipBytes(B);break}default:K.skipBytes(B)}return K.byteOffset!==A?K.loadAsync(8).then(f):Promise.resolve(L)};return f()}))}static _parseVersion(K){if("1.0"===K||"1.0.1"===K)return{major:1,minor:0};const A=(K+"").match(/^(\d+)\.(\d+)/);return A?{major:parseInt(A[1]),minor:parseInt(A[2])}:null}static _compareVersion(K,A){return K.major>A.major?1:K.major<A.major?-1:K.minor>A.minor?1:K.minor<A.minor?-1:0}_logOpen(K){this._log(K),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(K){const A=p._logSpaces.substring(0,2*this._logIndentLevel);Q.d.Log(`${A}${K}`)}_logDisabled(K){}_startPerformanceCounterEnabled(K){B.Tools.StartPerformanceCounter(K)}_startPerformanceCounterDisabled(K){}_endPerformanceCounterEnabled(K){B.Tools.EndPerformanceCounter(K)}_endPerformanceCounterDisabled(K){}}p.IncrementalLoading=!0,p.HomogeneousCoordinates=!1,p._logSpaces="                                ",(0,L.d)(new p)},14157:(K,A,T)=>{"use strict";T.d(A,{d:()=>f});var G=T(12526);function B(K,A,T,G){const B={externalResourceFunction:G};return T&&(B.uri="file:"===A?T:A+T),ArrayBuffer.isView(K)?GLTFValidator.validateBytes(K,B):GLTFValidator.validateString(K,B)}function L(){const K=[];onmessage=A=>{const T=A.data;switch(T.id){case"init":importScripts(T.url);break;case"validate":B(T.data,T.rootUrl,T.fileName,(A=>new Promise(((T,G)=>{const B=K.length;K.push({resolve:T,reject:G}),postMessage({id:"getExternalResource",index:B,uri:A})})))).then((K=>{postMessage({id:"validate.resolve",value:K})}),(K=>{postMessage({id:"validate.reject",reason:K})}));break;case"getExternalResource.resolve":K[T.index].resolve(T.value);break;case"getExternalResource.reject":K[T.index].reject(T.reason)}}}class f{static ValidateAsync(K,A,T,f){return"function"===typeof Worker?new Promise(((O,C)=>{const Q=`${B}(${L})()`,Y=URL.createObjectURL(new Blob([Q],{type:"application/javascript"})),Z=new Worker(Y),x=K=>{Z.removeEventListener("error",x),Z.removeEventListener("message",J),C(K)},J=K=>{const A=K.data;switch(A.id){case"getExternalResource":f(A.uri).then((K=>{Z.postMessage({id:"getExternalResource.resolve",index:A.index,value:K},[K.buffer])}),(K=>{Z.postMessage({id:"getExternalResource.reject",index:A.index,reason:K})}));break;case"validate.resolve":Z.removeEventListener("error",x),Z.removeEventListener("message",J),O(A.value),Z.terminate();break;case"validate.reject":Z.removeEventListener("error",x),Z.removeEventListener("message",J),C(A.reason),Z.terminate()}};if(Z.addEventListener("error",x),Z.addEventListener("message",J),Z.postMessage({id:"init",url:G.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(K)){const G=K.slice();Z.postMessage({id:"validate",data:G,rootUrl:A,fileName:T},[G.buffer])}else Z.postMessage({id:"validate",data:K,rootUrl:A,fileName:T})})):(this._LoadScriptPromise||(this._LoadScriptPromise=G.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>B(K,A,T,f))))}}f.Configuration={url:`${G.Tools._DefaultCdnUrl}/gltf_validator.js`}},14882:(K,A,T)=>{"use strict";T.d(A,{e:()=>g});var G=T(12683),B=T(12688),L=T(12733),f=T(12700),O=T(13081),C=T(13011),Q=T(12768),Y=T(12931),Z=T(12651),x=T(12618);T(13949),T(13851),T(13870),T(13856),T(13872),T(13876),T(13885);const J="imageProcessingCompatibility",b="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";x.b.IncludesShadersStore[J]||(x.b.IncludesShadersStore[J]=b);const P="skyPixelShader",F="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";x.b.ShadersStore[P]||(x.b.ShadersStore[P]=F);T(13958),T(13893),T(13895),T(13909),T(13903);const d="skyVertexShader",N="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";x.b.ShadersStore[d]||(x.b.ShadersStore[d]=N);var D=T(13009),mK=T(13063),U=T(13056);class z extends O.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class g extends C.e{constructor(K,A){super(K,A),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new f.PA(0,100,0),this.useSunPosition=!1,this.cameraOffset=f.PA.Zero(),this.up=f.PA.Up(),this.dithering=!1,this._cameraPosition=f.PA.Zero(),this._skyOrientation=new f.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(K,A){const T=A._drawWrapper;if(this.isFrozen&&T.effect&&T._wasPreviouslyReady)return!0;A.materialDefines||(A.materialDefines=new z);const G=A.materialDefines,B=this.SK();if(this._isReadyForSubMesh(A))return!0;if((0,U.Z)(K,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,G),(0,U.P)(K,G,!0,!1),G.IMAGEPROCESSINGPOSTPROCESS!==B.imageProcessingConfiguration.applyByPostProcess&&G.markAsMiscDirty(),G.DITHER!==this.dithering&&G.markAsMiscDirty(),G.isDirty){G.markAsProcessed(),B.resetCachedMaterial();const K=new D.d;G.FOG&&K.addFallback(1,"FOG"),G.IMAGEPROCESSINGPOSTPROCESS=B.imageProcessingConfiguration.applyByPostProcess,G.DITHER=this.dithering;const T=[Q.d.PositionKind];G.VERTEXCOLOR&&T.push(Q.d.ColorKind);const L="sky",f=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,mK.e)(f);const O=G.toString();A.setEffect(B.getEngine().createEffect(L,T,f,[],O,K,this.onCompiled,this.onError),G,this._materialContext)}return!(!A.effect||!A.effect.isReady())&&(G._renderId=B.getRenderId(),T._wasPreviouslyReady=!0,!0)}bindForSubMesh(K,A,T){const G=this.SK(),B=T.materialDefines;if(!B)return;const L=T.effect;if(!L)return;this._activeEffect=L,this.bindOnlyWorldMatrix(K),this._activeEffect.setMatrix("viewProjection",G.getTransformMatrix()),this._mustRebind(G,L,T)&&((0,mK.g)(L,this,G),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,U.k)(B,L,G)),G.fogEnabled&&A.applyFog&&G.fogMode!==Y.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",G.getViewMatrix()),(0,U.h)(G,A,this._activeEffect);const O=G.activeCamera;if(O){const K=O.getWorldMatrix();this._cameraPosition.x=K.m[12],this._cameraPosition.y=K.m[13],this._cameraPosition.z=K.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const K=Math.PI*(this.inclination-.5),A=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(A)*Math.cos(K),this.sunPosition.y=this.distance*Math.sin(-K),this.sunPosition.z=this.distance*Math.sin(A)*Math.cos(K),f.Quaternion.FromUnitVectorsToRef(f.PA.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(A,this._activeEffect,T)}getAnimatables(){return[]}dispose(K){super.dispose(K)}clone(K){return L.c.Clone((()=>new g(K,this.SK())),this)}serialize(){const K=super.serialize();return K.customType="BABYLON.SkyMaterial",K}getClassName(){return"SkyMaterial"}static Parse(K,A,T){return L.c.Parse((()=>new g(K.name,A)),K,A,T)}}(0,G.c)([(0,B.B)()],g.prototype,"luminance",void 0),(0,G.c)([(0,B.B)()],g.prototype,"turbidity",void 0),(0,G.c)([(0,B.B)()],g.prototype,"rayleigh",void 0),(0,G.c)([(0,B.B)()],g.prototype,"mieCoefficient",void 0),(0,G.c)([(0,B.B)()],g.prototype,"mieDirectionalG",void 0),(0,G.c)([(0,B.B)()],g.prototype,"distance",void 0),(0,G.c)([(0,B.B)()],g.prototype,"inclination",void 0),(0,G.c)([(0,B.B)()],g.prototype,"azimuth",void 0),(0,G.c)([(0,B.A)()],g.prototype,"sunPosition",void 0),(0,G.c)([(0,B.B)()],g.prototype,"useSunPosition",void 0),(0,G.c)([(0,B.A)()],g.prototype,"cameraOffset",void 0),(0,G.c)([(0,B.A)()],g.prototype,"up",void 0),(0,G.c)([(0,B.B)()],g.prototype,"dithering",void 0),(0,Z.c)("BABYLON.SkyMaterial",g)},13382:(K,A,T)=>{"use strict";function G(K,A){A.headers=K.headers||{},A.statusMessage=K.statusText,A.statusCode=K.status,A.data=K.response}function B(K,A,T){return new Promise((function(B,L){T=T||{};var f,O,C,Q=new XMLHttpRequest,Y=T.body,Z=T.headers||{};for(f in T.timeout&&(Q.timeout=T.timeout),Q.ontimeout=Q.onerror=function(K){K.timeout="timeout"==K.type,L(K)},Q.open(K,A.href||A),Q.onload=function(){for(C=Q.getAllResponseHeaders().trim().split(/[\r\n]+/),G(Q,Q);O=C.shift();)O=O.split(": "),Q.headers[O.shift().toLowerCase()]=O.join(": ");if((O=Q.headers["content-type"])&&~O.indexOf("application/json"))try{Q.data=JSON.parse(Q.data,T.reviver)}catch(K){return G(Q,K),L(K)}(Q.status>=400?L:B)(Q)},typeof FormData<"u"&&Y instanceof FormData||Y&&"object"==typeof Y&&(Z["content-type"]="application/json",Y=JSON.stringify(Y)),Q.withCredentials=!!T.withCredentials,Z)Q.setRequestHeader(f,Z[f]);Q.send(Y)}))}T.r(A),T.d(A,{del:()=>C,get:()=>L,patch:()=>O,post:()=>f,put:()=>Q,send:()=>B});var L=B.bind(B,"GET"),f=B.bind(B,"POST"),O=B.bind(B,"PATCH"),C=B.bind(B,"DELETE"),Q=B.bind(B,"PUT")},14979:(K,A,T)=>{"use strict";T.d(A,{e:()=>Z});const G=.5*(Math.sqrt(3)-1),B=(3-Math.sqrt(3))/6,L=1/3,f=1/6,O=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,Q=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Y=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Z=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const A="function"==typeof K?K:function(K){let A=0,T=0,G=0,B=1;const L=function(){let K=4022871197;return function(A){A=A.toString();for(let T=0;T<A.length;T++){K+=A.charCodeAt(T);let G=.02519603282416938*K;K=G>>>0,G-=K,G*=K,K=G>>>0,G-=K,K+=4294967296*G}return 2.3283064365386963e-10*(K>>>0)}}();A=L(" "),T=L(" "),G=L(" "),A-=L(K),A<0&&(A+=1);T-=L(K),T<0&&(T+=1);G-=L(K),G<0&&(G+=1);return function(){const K=2091639*A+2.3283064365386963e-10*B;return A=T,T=G,G=K-(B=0|K)}}(K);this.p=function(K){const A=new Uint8Array(256);for(let T=0;T<256;T++)A[T]=T;for(let T=0;T<255;T++){const G=T+~~(K()*(256-T)),B=A[T];A[T]=A[G],A[G]=B}return A}(A),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let T=0;T<512;T++)this.perm[T]=this.p[255&T],this.permMod12[T]=this.perm[T]%12}noise2D(K,A){const T=this.permMod12,L=this.perm;let f=0,O=0,C=0;const Y=(K+A)*G,Z=Math.floor(K+Y),x=Math.floor(A+Y),J=(Z+x)*B,b=K-(Z-J),P=A-(x-J);let F,d;b>P?(F=1,d=0):(F=0,d=1);const N=b-F+B,D=P-d+B,mK=b-1+2*B,U=P-1+2*B,z=255&Z,g=255&x;let S=.5-b*b-P*P;if(S>=0){const K=3*T[z+L[g]];S*=S,f=S*S*(Q[K]*b+Q[K+1]*P)}let l=.5-N*N-D*D;if(l>=0){const K=3*T[z+F+L[g+d]];l*=l,O=l*l*(Q[K]*N+Q[K+1]*D)}let u=.5-mK*mK-U*U;if(u>=0){const K=3*T[z+1+L[g+1]];u*=u,C=u*u*(Q[K]*mK+Q[K+1]*U)}return 70*(f+O+C)}noise3D(K,A,T){const G=this.permMod12,B=this.perm;let O,C,Y,Z;const x=(K+A+T)*L,J=Math.floor(K+x),b=Math.floor(A+x),P=Math.floor(T+x),F=(J+b+P)*f,d=K-(J-F),N=A-(b-F),D=T-(P-F);let mK,U,z,g,S,l;d>=N?N>=D?(mK=1,U=0,z=0,g=1,S=1,l=0):d>=D?(mK=1,U=0,z=0,g=1,S=0,l=1):(mK=0,U=0,z=1,g=1,S=0,l=1):N<D?(mK=0,U=0,z=1,g=0,S=1,l=1):d<D?(mK=0,U=1,z=0,g=0,S=1,l=1):(mK=0,U=1,z=0,g=1,S=1,l=0);const u=d-mK+f,c=N-U+f,n=D-z+f,H=d-g+2*f,e=N-S+2*f,p=D-l+2*f,r=d-1+.5,h=N-1+.5,k=D-1+.5,s=255&J,j=255&b,R=255&P;let v=.6-d*d-N*N-D*D;if(v<0)O=0;else{const K=3*G[s+B[j+B[R]]];v*=v,O=v*v*(Q[K]*d+Q[K+1]*N+Q[K+2]*D)}let I=.6-u*u-c*c-n*n;if(I<0)C=0;else{const K=3*G[s+mK+B[j+U+B[R+z]]];I*=I,C=I*I*(Q[K]*u+Q[K+1]*c+Q[K+2]*n)}let o=.6-H*H-e*e-p*p;if(o<0)Y=0;else{const K=3*G[s+g+B[j+S+B[R+l]]];o*=o,Y=o*o*(Q[K]*H+Q[K+1]*e+Q[K+2]*p)}let W=.6-r*r-h*h-k*k;if(W<0)Z=0;else{const K=3*G[s+1+B[j+1+B[R+1]]];W*=W,Z=W*W*(Q[K]*r+Q[K+1]*h+Q[K+2]*k)}return 32*(O+C+Y+Z)}noise4D(K,A,T,G){const B=this.perm;let L,f,Q,Z,x;const J=(K+A+T+G)*O,b=Math.floor(K+J),P=Math.floor(A+J),F=Math.floor(T+J),d=Math.floor(G+J),N=(b+P+F+d)*C,D=K-(b-N),mK=A-(P-N),U=T-(F-N),z=G-(d-N);let g=0,S=0,l=0,u=0;D>mK?g++:S++,D>U?g++:l++,D>z?g++:u++,mK>U?S++:l++,mK>z?S++:u++,U>z?l++:u++;const c=g>=3?1:0,n=S>=3?1:0,H=l>=3?1:0,e=u>=3?1:0,p=g>=2?1:0,r=S>=2?1:0,h=l>=2?1:0,k=u>=2?1:0,s=g>=1?1:0,j=S>=1?1:0,R=l>=1?1:0,v=u>=1?1:0,I=D-c+C,o=mK-n+C,W=U-H+C,i=z-e+C,V=D-p+2*C,X=mK-r+2*C,q=U-h+2*C,y=z-k+2*C,w=D-s+3*C,a=mK-j+3*C,M=U-R+3*C,E=z-v+3*C,t=D-1+4*C,KK=mK-1+4*C,AK=U-1+4*C,TK=z-1+4*C,GK=255&b,BK=255&P,LK=255&F,fK=255&d;let OK=.6-D*D-mK*mK-U*U-z*z;if(OK<0)L=0;else{const K=B[GK+B[BK+B[LK+B[fK]]]]%32*4;OK*=OK,L=OK*OK*(Y[K]*D+Y[K+1]*mK+Y[K+2]*U+Y[K+3]*z)}let CK=.6-I*I-o*o-W*W-i*i;if(CK<0)f=0;else{const K=B[GK+c+B[BK+n+B[LK+H+B[fK+e]]]]%32*4;CK*=CK,f=CK*CK*(Y[K]*I+Y[K+1]*o+Y[K+2]*W+Y[K+3]*i)}let QK=.6-V*V-X*X-q*q-y*y;if(QK<0)Q=0;else{const K=B[GK+p+B[BK+r+B[LK+h+B[fK+k]]]]%32*4;QK*=QK,Q=QK*QK*(Y[K]*V+Y[K+1]*X+Y[K+2]*q+Y[K+3]*y)}let YK=.6-w*w-a*a-M*M-E*E;if(YK<0)Z=0;else{const K=B[GK+s+B[BK+j+B[LK+R+B[fK+v]]]]%32*4;YK*=YK,Z=YK*YK*(Y[K]*w+Y[K+1]*a+Y[K+2]*M+Y[K+3]*E)}let ZK=.6-t*t-KK*KK-AK*AK-TK*TK;if(ZK<0)x=0;else{const K=B[GK+1+B[BK+1+B[LK+1+B[fK+1]]]]%32*4;ZK*=ZK,x=ZK*ZK*(Y[K]*t+Y[K+1]*KK+Y[K+2]*AK+Y[K+3]*TK)}return 27*(L+f+Q+Z+x)}}}}]);